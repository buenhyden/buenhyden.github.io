<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Messaging Queues | hyunyoun's Blog</title><meta name=keywords content="Backend-Development,API-Design-and-Implementation,API-Integration-Patterns,Messaging-Queues"><meta name=description content="메시징 큐는 비동기 통신을 가능하게 하는 중간 저장소로, 메시지 생산자(Producer)와 소비자(Consumer) 사이에서 데이터를 버퍼링하는 역할을 한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/system-design/distributed-systems/message-oriented-systems/message-processing-systems/message-queues/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/system-design/distributed-systems/message-oriented-systems/message-processing-systems/message-queues/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/system-design/distributed-systems/message-oriented-systems/message-processing-systems/message-queues/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/system-design/distributed-systems/message-oriented-systems/message-processing-systems/message-queues/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Messaging Queues"><meta property="og:description" content="메시징 큐는 비동기 통신을 가능하게 하는 중간 저장소로, 메시지 생산자(Producer)와 소비자(Consumer) 사이에서 데이터를 버퍼링하는 역할을 한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Messaging Queues"><meta name=twitter:description content="메시징 큐는 비동기 통신을 가능하게 하는 중간 저장소로, 메시지 생산자(Producer)와 소비자(Consumer) 사이에서 데이터를 버퍼링하는 역할을 한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Messaging Queues","item":"https://buenhyden.github.io/posts/system-design/distributed-systems/message-oriented-systems/message-processing-systems/message-queues/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>Messaging Queues</h1><div class=post-description>메시징 큐는 비동기 통신을 가능하게 하는 중간 저장소로, 메시지 생산자(Producer)와 소비자(Consumer) 사이에서 데이터를 버퍼링하는 역할을 한다.</div></header><div class=post-content><h2 id=messaging-queues>Messaging Queues<a hidden class=anchor aria-hidden=true href=#messaging-queues>#</a></h2><hr><h2 id=1부-태그-분류-요약-개요>1부: 태그, 분류, 요약, 개요<a hidden class=anchor aria-hidden=true href=#1부-태그-분류-요약-개요>#</a></h2><h3 id=1-주제-태그tag>1. 주제 태그(Tag)<a hidden class=anchor aria-hidden=true href=#1-주제-태그tag>#</a></h3><ul><li>Messaging-Queue</li><li>Message-Broker</li><li>Distributed-Systems</li><li>Event-Driven</li></ul><h3 id=2-주제-분류-구조-검토>2. 주제 분류 구조 검토<a hidden class=anchor aria-hidden=true href=#2-주제-분류-구조-검토>#</a></h3><p>기존 계층 구조(컴퓨터공학 > 시스템 설계 > 분산 시스템 > 메시지 지향 시스템 > 메시지 처리 시스템)는 메시징 큐(Messaging Queue)도 적절히 포괄하며, 대표 메시지 브로커 등이 실무상 메시지 처리 시스템과 강하게 연결되어 있어 현 구조가 충분히 합리적임. 메시징 큐를 분산 시스템 카테고리 내 별도 하위로 분리(메시지 저장 및 교환 방식별 추가 구분)할 수도 있으나 &ldquo;메시지 지향 시스템&rdquo; 아래에 위치시키는 현 구조가 실무/이론 양면에서 타당함.</p><h3 id=3-한문장-요약200자-내외>3. 한문장 요약(200자 내외)<a hidden class=anchor aria-hidden=true href=#3-한문장-요약200자-내외>#</a></h3><p>메시징 큐(Messaging Queue)는 다양한 시스템 간 통신에서 메시지를 안전하게 저장하고, 비동기적으로 순차 전달하며, 시스템 간 결합도를 줄이고 확장성·신뢰성을 높이는 핵심 인프라다.</p><h3 id=4-주제-전체-개요250자-내외>4. 주제 전체 개요(250자 내외)<a hidden class=anchor aria-hidden=true href=#4-주제-전체-개요250자-내외>#</a></h3><p>메시징 큐는 분산 시스템 내에서 독립적인 데이터 패킷인 메시지를 임시로 저장(큐잉)하고, 원하는 시점에 여러 소비자에게 효율적으로 전달하는 중개 역할을 한다. 이를 통해 서비스 간 비동기 통신, 장애 격리, 트래픽 버퍼링 등 다양한 이점을 제공하며, 이벤트 기반 아키텍처, 마이크로서비스, 클라우드 네이티브 환경에서 중요한 역할을 한다. 주요 오픈소스 및 클라우드 솔루션(RabbitMQ, Kafka, AWS SQS 등)도 큐 기술을 바탕으로 확장되고 있다.</p><h2 id=2부-핵심-개념-및-실무-연관성>2부: 핵심 개념 및 실무 연관성<a hidden class=anchor aria-hidden=true href=#2부-핵심-개념-및-실무-연관성>#</a></h2><h3 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h3><ul><li><p><strong>정의:</strong><br>메시징 큐(Messaging Queue)는 프로듀서(생산자)가 생성한 메시지를 중간 저장소에 임시로 저장(큐잉) 후, 컨슈머(소비자)에게 순차적으로 전달하여 비동기 통신과 버퍼링을 실현하는 시스템 또는 미들웨어.</p></li><li><p><strong>유형:</strong></p><ul><li>FIFO 큐: 선입선출 방식, 순차적 처리</li><li>Priority Queue: 메시지 우선순위 기반 처리</li><li>Delay Queue: 지연전달, 특정 시점 이후 전송</li><li>Dead Letter Queue: 처리 실패 메시지 별도 저장</li></ul></li><li><p><strong>핵심 기능 및 역할:</strong></p><ul><li><em>기능:</em> 메시지 임시 저장, 순서 보장, 소비자/생산자 분리</li><li><em>역할:</em> 메시지 버퍼/완충, 트래픽 급증에 대한 완충, 장애 격리, 중복 방지, 유실 최소화</li></ul></li></ul><h4 id=51-실무-연관성>5.1 실무 연관성<a hidden class=anchor aria-hidden=true href=#51-실무-연관성>#</a></h4><ul><li>메시징 큐는 마이크로서비스 및 이벤트 기반 시스템의 필수 인프라로 활용됨.</li><li>대용량 트래픽 처리와 처리 지연 분산(Load Leveling)에서 핵심.</li><li>신뢰성·확장성·내결함성(emphasize)* 실현 위해 메시지 저장소, 재시도 로직, 멱등성 처리까지 반드시 고려되어야 함.</li><li>실무에서 큐 선택(RabbitMQ, Kafka 등)은 데이터 손실/중복 허용 범위, 처리량, 메시지 순서 보장 필요성 따라 결정됨.</li></ul><h2 id=3부-세부-심화-분석>3부: 세부 심화 분석<a hidden class=anchor aria-hidden=true href=#3부-세부-심화-분석>#</a></h2><h3 id=6-주요-분석-내용>6. 주요 분석 내용<a hidden class=anchor aria-hidden=true href=#6-주요-분석-내용>#</a></h3><h4 id=등장-및-발전-배경>등장 및 발전 배경<a hidden class=anchor aria-hidden=true href=#등장-및-발전-배경>#</a></h4><ul><li>단일 시스템 → 분산 서비스로 확장되며 동기식 통신의 한계 극복, 시스템 결합도 해소·확장성 강화 목적에서 등장.</li><li>대규모 이벤트 처리 및 비동기 데이터 교환 요구 증가로 큐 기반 메시징 시스템이 발전.</li></ul><h4 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h4><ul><li>메시지 유실·지연 방지, 장애 복원력 강화, 비동기 독립 처리, 각 서비스의 독립 배포/운영 필요성.</li></ul><h4 id=기능-및-역할-구분>기능 및 역할 구분<a hidden class=anchor aria-hidden=true href=#기능-및-역할-구분>#</a></h4><table><thead><tr><th>기능</th><th>설명</th><th>역할</th></tr></thead><tbody><tr><td>큐잉(Queuing)</td><td>메시지 임시 저장 및 순서대로 배분</td><td>소비자 부하 균형·완충</td></tr><tr><td>전달/루팅(Transport/Routing)</td><td>적절 소비자에 메시지 전달 및 분기</td><td>메시지 효율적 분배</td></tr><tr><td>지연 및 우선순위</td><td>특정 시간 또는 우선순위 따름</td><td>비즈니스 Rule 반영</td></tr><tr><td>장애 격리/Failover</td><td>시스템 한계 초과, 장애 시 메시지 보관·재전달</td><td>복원력, 중단 최소화</td></tr><tr><td>Dead Letter Queue</td><td>처리 실패 메시지 별도 보관</td><td>이상 탐지/복구 용이</td></tr></tbody></table><h4 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h4><ul><li><strong>비동기(Asynchronous):</strong> 생산·소비 작업 분리, 시스템 독립성 확보.</li><li><strong>버퍼링(Buffering):</strong> 트래픽 급증 시 부하 분산.</li><li><strong>안정성(Stability):</strong> 장애·예외 상황 발생 시 메시지 유실 방지.</li></ul><h4 id=핵심-원칙예시>핵심 원칙(예시)<a hidden class=anchor aria-hidden=true href=#핵심-원칙예시>#</a></h4><ul><li>멱등성(Idempotency) 보장</li><li>메시지 순서(Order) 관리</li><li>유실/중복 방지(ACK, Redelivery 등)</li><li>트랜잭션 일관성 (Exactly-Once/At-Least-Once/At-Most-Once 등)</li></ul><h3 id=7-작동-원리-다이어그램>7. 작동 원리 다이어그램<a hidden class=anchor aria-hidden=true href=#7-작동-원리-다이어그램>#</a></h3><pre class=mermaid>flowchart LR
Producer(프로듀서) --&gt; MQ[메시징 큐]
MQ --&gt; Consumer1(컨슈머1)
MQ --&gt; Consumer2(컨슈머2)
Consumer1 -- Ack --&gt; MQ
MQ -- DeadLetter (DLQ) --&gt; DLQ[사망 큐]
</pre><ul><li>프로듀서가 메시지 생산, 큐에 저장, 컨슈머가 가져가 처리 후 Ack(처리확인), 실패시 DLQ로 이동.</li></ul><h3 id=8-구조-및-아키텍처>8. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#8-구조-및-아키텍처>#</a></h3><table><thead><tr><th>분류</th><th>구성 요소</th><th>기능</th><th>필/선택</th></tr></thead><tbody><tr><td>필수</td><td>메시징 큐</td><td>임시 메시지 저장</td><td>필수</td></tr><tr><td>필수</td><td>프로듀서(Producer)</td><td>메시지 생성</td><td>필수</td></tr><tr><td>필수</td><td>컨슈머(Consumer)</td><td>메시지 소비/처리</td><td>필수</td></tr><tr><td>선택</td><td>DLQ(Dead Letter Queue)</td><td>실패 메시지 보관</td><td>선택</td></tr><tr><td>선택</td><td>모니터링 도구</td><td>큐 상태 감시</td><td>선택</td></tr><tr><td>선택</td><td>트랜잭션 관리자</td><td>원자성 보장</td><td>선택</td></tr></tbody></table><h3 id=9-구현-기법-및-방법>9. 구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#9-구현-기법-및-방법>#</a></h3><ul><li>대표 제품: RabbitMQ(AMQP), Kafka(분산 로그 기반), Amazon SQS/Google PubSub(클라우드 매니지드)</li><li>큐 생성→메시지 전송→컨슈머 소비→ACK/FAIL 처리→DLQ 활용 가능</li><li>보장 정책에 따라 중복/유실/순서 처리 로직 상이</li></ul><h3 id=10-장점>10. 장점<a hidden class=anchor aria-hidden=true href=#10-장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>확장성</td><td>컨슈머/프로듀서 동적 스케일링, 대용량 트래픽에 대응</td></tr><tr><td></td><td>신뢰성</td><td>메시지 저장으로 장애시에도 데이터 유실 최소화</td></tr><tr><td></td><td>장애 격리</td><td>서비스 장애 미 전파/비동기 독립 운영</td></tr><tr><td></td><td>부하 완화</td><td>트래픽 급증 시 버퍼링/성능 급락 완충</td></tr></tbody></table><h3 id=11-단점-및-문제점-해결방안>11. 단점 및 문제점, 해결방안<a hidden class=anchor aria-hidden=true href=#11-단점-및-문제점-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성 증가</td><td>설계·운영 복잡, 장애 검증 난이도</td><td>표준화/자동화 도입, 모니터링 적용</td></tr><tr><td></td><td>지연(Latency)</td><td>큐잉으로 인한 실시간성 저하</td><td>우선순위 큐, 최적화 설계</td></tr><tr><td></td><td>운용 비용</td><td>인프라, 유지 보수 비용 증가</td><td>클라우드 매니지드 서비스 활용</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>메시지 유실</td><td>네트워크 장애, 저장 실패</td><td>데이터 일관성 결여</td><td>큐 모니터링</td><td>ACK 사용</td><td>자동 재전송</td></tr><tr><td></td><td>메시지 중복</td><td>재시도, ACK 누락</td><td>중복 처리/불일치</td><td>로그 분석</td><td>멱등성 처리</td><td>중복ID, 상태저장</td></tr><tr><td></td><td>큐 적체/지연</td><td>컨슈머 속도 저하, 트래픽 몰림</td><td>응답 지연, 성능저하</td><td>지표 모니터링</td><td>오토스케일</td><td>병렬 소비 분산</td></tr></tbody></table><h3 id=12-도전-과제>12. 도전 과제<a hidden class=anchor aria-hidden=true href=#12-도전-과제>#</a></h3><ul><li>Exactly-Once(정확히 한 번) 처리 보장 및 대용량 환경 최적화.</li><li>여러 시스템-브로커 간 표준 프로토콜 통합, 엔드투엔드 트랜잭션 확장.</li><li>실시간 분석 및 자동 장애 복구, AI 기반 동적 스케일링.</li></ul><h3 id=13-분류-기준-및-유형>13. 분류 기준 및 유형<a hidden class=anchor aria-hidden=true href=#13-분류-기준-및-유형>#</a></h3><table><thead><tr><th>기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>큐 동작 모드</td><td>FIFO, Priority, Delay, DLQ</td><td>순서보장, 우선순위별, 지연, 실패분리</td></tr><tr><td>전달 패턴</td><td>P2P, Pub/Sub</td><td>점대점, 발행-구독</td></tr><tr><td>배포 방식</td><td>온프레미스, 클라우드</td><td>자체, 매니지드 클라우드</td></tr><tr><td>메시지 보장</td><td>At-Least-Once, Exactly-Once</td><td>최소 1회, 정확 1회</td></tr></tbody></table><h3 id=14-실무-사용-예시>14. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#14-실무-사용-예시>#</a></h3><table><thead><tr><th>시스템/도구</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>주문 처리 시스템</td><td>주문 이벤트 분리·비동기</td><td>장애 격리, 트랜잭션 신뢰성 향상</td></tr><tr><td>IoT 데이터 집계</td><td>센서 이벤트 수집</td><td>대규모 트래픽 관리, 실시간 집계</td></tr><tr><td>실시간 분석 파이프라인</td><td>데이터 흐름 완충</td><td>분석 지연/병목 완화, 데이터 일관성</td></tr></tbody></table><h3 id=15-활용-사례>15. 활용 사례<a hidden class=anchor aria-hidden=true href=#15-활용-사례>#</a></h3><p><strong>시나리오</strong>:<br>대형 이커머스에서 주문 시스템(Order Service)과 결제 시스템(Payment Service) 분리, 트래픽 폭증/결제 승인 지연에도 비즈니스 연속성 확보</p><p><strong>시스템 구성</strong>:</p><ul><li>Order Service (주문)</li><li>Messaging Queue (RabbitMQ)</li><li>Payment Service (결제)</li><li>Dead Letter Queue(DLQ)</li><li>모니터링 시스템</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>flowchart TB
OrderService(주문 서비스) --&gt; MQ[메시징 큐]
MQ --&gt; PaymentService(결제 서비스)
MQ --&gt; DLQ[사망 큐]
DLQ --&gt; Monitor(모니터링)
</pre><p><strong>Workflow</strong>:</p><ul><li>주문 발생(Order Service) → 메시징 큐 등록</li><li>결제 서비스가 큐에서 메시지 받아 결제 처리</li><li>성공시 Ack, 실패시 메시지는 DLQ로 이동</li><li>DLQ는 모니터링/알림 시스템 연계</li></ul><p><strong>역할</strong>:</p><ul><li>Order Service: 주문 정보 생성 및 큐 등록</li><li>큐: 메시지 임시 보관·전달</li><li>Payment Service: 결제 요청 메시지 소비/처리</li><li>DLQ/모니터링: 오류 탐지·자동 대응</li></ul><p><strong>유무 차이점</strong>:</p><ul><li>미도입 시 장애시 전체 중단·손실 위험, 스케일 아웃 제한</li><li>도입 시 분산 트래픽/장애 격리 가능, 운영 유연성 증가</li></ul><p><strong>구현 예시(Python, RabbitMQ, pika)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_order</span><span class=p>(</span><span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;orders&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=n>body</span><span class=o>=</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_payment</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;orders&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 결제 처리 로직</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>payment_successful</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>  <span class=c1># 결제 성공시</span>
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>  <span class=c1># 결제 실패시 DLQ 이동</span>
</span></span><span class=line><span class=cl>            <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span> <span class=n>requeue</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=16-실무-적용-및-최적화-체크리스트>16. 실무 적용 및 최적화 체크리스트<a hidden class=anchor aria-hidden=true href=#16-실무-적용-및-최적화-체크리스트>#</a></h3><h4 id=효과적-적용주의점>효과적 적용/주의점<a hidden class=anchor aria-hidden=true href=#효과적-적용주의점>#</a></h4><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>큐 적정 보장 정책</td><td>서비스 특성별(FIFO, DLQ 등) 정책 적용</td><td>중요 이벤트 DLQ 필수</td></tr><tr><td>모니터링</td><td>큐 상태/적체 실시간 관제</td><td>대시보드, Alert 연계</td></tr><tr><td>멱등성 로직</td><td>중복 처리 방지 로직 구현</td><td>메시지 ID 저장 후 처리</td></tr><tr><td>오토스케일링</td><td>컨슈머/브로커 자동 확장</td><td>스케일링 정책 적용</td></tr></tbody></table><h4 id=최적화-고려사항>최적화 고려사항<a hidden class=anchor aria-hidden=true href=#최적화-고려사항>#</a></h4><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>메시지 크기 최적화</td><td>네트워크/저장 오버헤드 최소화</td><td>불필요 필드/중복 제거</td></tr><tr><td>파티션/샤딩</td><td>대용량 트래픽 분산</td><td>분산 처리 구조 설계</td></tr><tr><td>네트워크 튜닝</td><td>대용량/저지연 환경 대응</td><td>압축, 경량 프로토콜 적용</td></tr><tr><td>모니터링 강화</td><td>병목/장애 즉각 대처</td><td>실시간 지표 관리</td></tr></tbody></table><h2 id=4부-정리표-및-추가-학습>4부: 정리표 및 추가 학습<a hidden class=anchor aria-hidden=true href=#4부-정리표-및-추가-학습>#</a></h2><h3 id=주목할-내용정리표>주목할 내용(정리표)<a hidden class=anchor aria-hidden=true href=#주목할-내용정리표>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>시스템</td><td>RabbitMQ/Kafka</td><td>메시지 브로커 기술</td><td>주요 오픈소스 큐 기술</td></tr><tr><td>설계 패턴</td><td>DLQ, 멱등성</td><td>장애 복원/신뢰성</td><td>메시지 손실/중복 방지</td></tr><tr><td>운영 관리</td><td>모니터링/오토스케일링</td><td>자동화</td><td>대규모 운영의 핵심</td></tr><tr><td>트랜잭션</td><td>Exactly-Once</td><td>일관성 보장</td><td>중복/유실 없는 처리</td></tr></tbody></table><h3 id=반드시-학습해야-할-내용>반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야-할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>메시지 브로커</td><td>RabbitMQ</td><td>AMQP 메시징</td><td>표준 메시지 큐 시스템 원리 익히기</td></tr><tr><td></td><td>Kafka</td><td>분산 로그 큐</td><td>대용량 실시간 이벤트 큐 학습</td></tr><tr><td>보장 정책</td><td>Deliver Guarantee</td><td>큐별 보장정책 분류</td><td>최소 1회(At-Least-Once), 정확 1회 등</td></tr><tr><td>장애/복원</td><td>DLQ</td><td>장애 복구 패턴</td><td>실패 메시지 분리 저장, 복구 프로세스</td></tr><tr><td>운영 관리</td><td>모니터링/스케일</td><td>운영자동화</td><td>자동 확장/스케일 적용 및 모니터링</td></tr></tbody></table><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어(한글/영문)</th><th>설명</th></tr></thead><tbody><tr><td>메시지 큐</td><td>FIFO 큐(FIFO Queue)</td><td>선입선출 순서로 메시지 보관/처리 구조</td></tr><tr><td>메시지 큐</td><td>DLQ(Dead Letter Queue)</td><td>실패 메시지 별도 보관 큐</td></tr><tr><td>메시지 큐</td><td>Priority Queue</td><td>우선순위 중심 메시지 처리</td></tr><tr><td>메시지 큐</td><td>큐 적체(Queue Backlog)</td><td>큐에 메시지가 누적되어 있는 현상</td></tr><tr><td>운영</td><td>멱등성(Idempotency)</td><td>중복 메시지/요청에서도 동일 결과 보장</td></tr><tr><td>보장 정책</td><td>At-Least-Once/Exactly-Once</td><td>최소 한 번/정확히 한 번 전달 정책</td></tr></tbody></table><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://www.ibm.com/topics/message-queueing>Message Queueing Explained (IBM)</a></li><li><a href=https://www.rabbitmq.com/documentation.html>RabbitMQ 공식 문서</a></li><li><a href=https://kafka.apache.org/documentation/>Apache Kafka 공식 문서</a></li><li><a href=https://aws.amazon.com/ko/sqs/>AWS SQS 공식 소개</a></li><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/messaging>모던 시스템 디자인의 메시징 패턴 (Microsoft Learn)</a></li><li><a href=https://www.confluent.io/blog/exactly-once-semantics-are-possible-heres-how-kafka-does-it/>Exactly-Once Semantics in Apache Kafka</a></li><li><a href=https://martinfowler.com/bliki/Idempotency.html>분산 시스템에서의 멱등성 (Martin Fowler)</a></li><li><a href=https://dev.to/unclaed/distributed-message-queue-architecture-implementation-3kjk>Distributed Message Queue: Architecture & Implementation</a></li><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/dead-letter-queue>Dead-Letter Queue Pattern (Azure Architecture Center)</a></li></ul><h3 id=17-기타-사항-및-심화-내용>17. 기타 사항 및 심화 내용<a hidden class=anchor aria-hidden=true href=#17-기타-사항-및-심화-내용>#</a></h3><h4 id=메시징-큐messaging-queue-아키텍처-유형별-비교>메시징 큐(Messaging Queue) 아키텍처 유형별 비교<a hidden class=anchor aria-hidden=true href=#메시징-큐messaging-queue-아키텍처-유형별-비교>#</a></h4><table><thead><tr><th>유형</th><th>특징</th><th>주요 활용 예시</th><th>장점</th><th>단점 및 주의점</th></tr></thead><tbody><tr><td>전통적 FIFO 큐</td><td>선입선출(FIFO, First-In-First-Out) 중심, 단일 큐</td><td>주문 처리, 일반 이벤트 버퍼</td><td>순서 보장, 구현 단순</td><td>대량 트래픽시 확장 한계</td></tr><tr><td>분산 큐</td><td>여러 노드에 큐 분산, 메시지 파티셔닝 지원</td><td>빅데이터 처리, IoT, 실시간 분석</td><td>대용량/확장성 우수, 장애 격리</td><td>순서 보장 복잡, 구성 및 운영 난이도 상존</td></tr><tr><td>Pub/Sub(발행-구독) 모델</td><td>주제(Topic) 기반, 여러 소비자에 동시 배포</td><td>이벤트 브로드캐스트, 알림 시스템</td><td>실시간 다수 소비자, 동적 구독</td><td>불필요 트래픽 증가, 순서/중복 관리 필요</td></tr><tr><td>서버리스 기반 서비스</td><td>클라우드 완전관리형, 유지보수 부담 적음</td><td>AWS SQS, Google Pub/Sub 등</td><td>운영비↓, 확장용이, 손쉬운 통합</td><td>특정 클라우드 종속, 세부 옵션 제한 경우 있음</td></tr></tbody></table><blockquote><p><strong>설명:</strong> 실제 아키텍처 설계 때 시스템 특성별로 적합한 큐 모델을 조합해서 사용하며, 각 모델별 단점은 보조 설계(Ex. DLQ, 멱등성 처리 등)로 보완합니다.</p></blockquote><h3 id=18-아키텍처-다이어그램-비교-및-설명>18. 아키텍처 다이어그램 비교 및 설명<a hidden class=anchor aria-hidden=true href=#18-아키텍처-다이어그램-비교-및-설명>#</a></h3><h4 id=전통적-메시징-큐-구조>전통적 메시징 큐 구조<a hidden class=anchor aria-hidden=true href=#전통적-메시징-큐-구조>#</a></h4><pre class=mermaid>flowchart TB
Producer(생산자) --&gt; MQ[FIFO 메시징 큐]
MQ --&gt; ConsumerA(소비자 A)
MQ --&gt; ConsumerB(소비자 B)
</pre><ul><li>FIFO 기반으로 한 컨슈머가 메시지를 하나씩 받아 처리.</li><li><strong>주요 관점:</strong> 구현 단순성, 순서 보장</li></ul><h4 id=pubsub-메시징-큐-구조>Pub/Sub 메시징 큐 구조<a hidden class=anchor aria-hidden=true href=#pubsub-메시징-큐-구조>#</a></h4><pre class=mermaid>flowchart TB
Publisher(발행자) --&gt; Topic[토픽/주제]
Topic --&gt; SubscriberA(구독자 A)
Topic --&gt; SubscriberB(구독자 B)
Topic --&gt; SubscriberC(구독자 C)
</pre><ul><li>송신자는 하나의 토픽에 메시지를 발행(Publish)하고, 구독한 모든 소비자(Subscriber)에게 메시지가 동시에 전달됨.</li><li><strong>주요 관점:</strong> 실시간 방송, 이벤트 브로드캐스트, 동시 다중 소비</li></ul><h3 id=19-실무-체크리스트-및-best-practice>19. 실무 체크리스트 및 Best Practice<a hidden class=anchor aria-hidden=true href=#19-실무-체크리스트-및-best-practice>#</a></h3><table><thead><tr><th>체크포인트</th><th>체크 질문/설명</th></tr></thead><tbody><tr><td>보장 정책</td><td>At-Least-Once, Exactly-Once, At-Most-Once 적용 여부 확인</td></tr><tr><td>큐 적체/지연 대응</td><td>오토스케일링·병렬 분산 전략 적용 여부</td></tr><tr><td>오류 및 장애 대응</td><td>DLQ, Retry, Backoff 패턴이 적용되어 있는지</td></tr><tr><td>메시지 포맷 일관성</td><td>JSON, Avro, Protobuf 등 표준 포맷 일괄 적용 여부</td></tr><tr><td>모니터링 및 데이터 관찰성</td><td>실시간 대시보드, 경보(알림) 체계가 구축돼 있는지</td></tr><tr><td>운영 자동화</td><td>배포 파이프라인(CI/CD), 큐 관리 등 운영 자동화</td></tr><tr><td>보안(인증/암호화)</td><td>송수신 데이터 암호화, 인증 시스템 적용 여부</td></tr></tbody></table><h3 id=20-미래-발전-방향-및-트렌드>20. 미래 발전 방향 및 트렌드<a hidden class=anchor aria-hidden=true href=#20-미래-발전-방향-및-트렌드>#</a></h3><ul><li><strong>클라우드 네이티브 큐:</strong> 완전 관리형/서버리스 기반 큐 서비스가 표준화.</li><li><strong>AI/머신러닝 기반 오토스케일:</strong> 자동 튜닝, 장애 예측·복구 기능 고도화.</li><li><strong>멀티 프로토콜 호환성 강화:</strong> HTTP/3, gRPC, WebSocket 등과 큐 서비스 통합 확대.</li><li><strong>엔드-투-엔드 트랜잭션 확대:</strong> 데이터베이스/메시징/이벤트 연계 일관 처리 점차 확산.</li><li><strong>큐 기반 데이터 파이프라인:</strong> 대용량 데이터 분석, 스트리밍 AI 등에서 필수 인프라로 자리 잡음.</li></ul><h2 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h2><table><thead><tr><th>카테고리</th><th>용어(한글/영문)</th><th>설명</th></tr></thead><tbody><tr><td>메시지 큐</td><td>우선순위 큐(Priority Queue)</td><td>메시지별 우선순위 설정, 고우선순위 선처리</td></tr><tr><td>메시지 큐</td><td>지연 큐(Delay Queue)</td><td>지정된 시간 이후 메시지 소비 가능 구조</td></tr><tr><td>시스템 관리</td><td>오토스케일링(Auto-scaling)</td><td>부하에 따라 자동으로 큐/컨슈머 확장·축소</td></tr><tr><td>패턴</td><td>백오프(Backoff)</td><td>실패 시 재시도 간격 점진적 증가</td></tr><tr><td>메시징 시스템</td><td>QoS(Quality of Service)</td><td>큐/전송/처리 품질 제어 기준</td></tr><tr><td>보안</td><td>암호화(Encryption)</td><td>메시지 및 데이터 전송 과정 중 보안 처리</td></tr></tbody></table><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><ul><li><a href=https://www.ibm.com/topics/message-queueing>Message Queueing Explained (IBM)</a></li><li><a href=https://www.rabbitmq.com/documentation.html>RabbitMQ 공식 문서</a></li><li><a href=https://kafka.apache.org/documentation/>Apache Kafka 공식 문서</a></li><li><a href=https://aws.amazon.com/ko/sqs/>AWS SQS 공식 소개</a></li><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/messaging>모던 시스템 디자인의 메시징 패턴 (Microsoft Learn)</a></li><li><a href=https://www.confluent.io/blog/exactly-once-semantics-are-possible-heres-how-kafka-does-it/>Exactly-Once Semantics in Apache Kafka</a></li><li><a href=https://martinfowler.com/bliki/Idempotency.html>분산 시스템에서의 멱등성 (Martin Fowler)</a></li><li><a href=https://dev.to/unclaed/distributed-message-queue-architecture-implementation-3kjk>Distributed Message Queue: Architecture & Implementation</a></li><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/dead-letter-queue>Dead-Letter Queue Pattern (Azure Architecture Center)</a></li></ul><h3 id=21-실용적-분석-메시징-큐messaging-queue의-확장-트렌드-및-실전-사례>21. 실용적 분석: 메시징 큐(Messaging Queue)의 확장 트렌드 및 실전 사례<a hidden class=anchor aria-hidden=true href=#21-실용적-분석-메시징-큐messaging-queue의-확장-트렌드-및-실전-사례>#</a></h3><h4 id=1-큐-기반-event-driven-architecture이벤트-기반-아키텍처-심화>(1) 큐 기반 Event-Driven Architecture(이벤트 기반 아키텍처) 심화<a hidden class=anchor aria-hidden=true href=#1-큐-기반-event-driven-architecture이벤트-기반-아키텍처-심화>#</a></h4><ul><li><strong>개념:</strong><br>메시징 큐는 단순 데이터 버퍼를 넘어, 서비스마다 독립적 트리거나 워크플로우를 구현하는 이벤트 기반 아키텍처의 근간이 됨.</li><li><strong>적용 효과:</strong><br>장애 전파가 차단되고, 각 시스템(마이크로서비스, 외부 API, 데이터 파이프라인 등)은 메시지만 수신해 필요한 동작을 트리거.<br>메시지 유실/중복 이슈가 있을 때 큐 측(DLQ(Dead Letter Queue), 멱등성 필터 등)에서 방어.</li><li><strong>사례:</strong><br>실시간 결제 승인, 알림, 주문·배송 상태 자동 업데이트, 로그 분석 등.</li></ul><h4 id=2-메시징-큐와-database-트랜잭션-연동>(2) 메시징 큐와 Database 트랜잭션 연동<a hidden class=anchor aria-hidden=true href=#2-메시징-큐와-database-트랜잭션-연동>#</a></h4><ul><li><strong>예시:</strong><br>서비스에서 주문 DB에 INSERT와 동시에 큐에 이벤트 메시지를 전송할 때, 두 작업이 &ldquo;정확히 한 번(Exactly-Once)&rdquo; 처리되어야 데이터 일관성이 보장됨.</li><li><strong>구현 기법:</strong><br>2단계 커밋(two-phase commit), Outbox Pattern(아웃박스 패턴), 메시지 컨시스턴시 체크 등.</li></ul><h4 id=3-메시징-큐-기반-장애-대응monitoring-자동-알림-강화>(3) 메시징 큐 기반 장애 대응(Monitoring, 자동 알림) 강화<a hidden class=anchor aria-hidden=true href=#3-메시징-큐-기반-장애-대응monitoring-자동-알림-강화>#</a></h4><pre class=mermaid>flowchart TD
AppSvc(애플리케이션 서비스) --&gt; MQ[메시징 큐]
MQ --&gt; Worker(워커/비동기 작업자)
MQ --&gt; DLQ[사망 큐]
DLQ --&gt; Noti(알림 시스템)
</pre><ul><li><strong>설명:</strong><br>DLQ(Dead Letter Queue)로 에러 메시지가 쌓일 경우 실시간 알림(이메일, Slack 등) 트리거.<br>운영팀은 빠르게 장애 구간 탐지 및 복구 가능.</li></ul><h4 id=4-큐-운영-시-실전-체크포인트운영최적화>(4) 큐 운영 시 실전 체크포인트(운영·최적화)<a hidden class=anchor aria-hidden=true href=#4-큐-운영-시-실전-체크포인트운영최적화>#</a></h4><ul><li>큐 백로그(Qeueu Backlog) 지표: 메시지 적체 위험 조기 감지</li><li>오토스케일링: 트래픽에 따라 컨슈머 인스턴스 수 자동 조정</li><li>메시지 크기와 포맷 최적화: 네트워크·저장 효율 향상</li><li>데이터 암호화 및 인증: 큐 레이어에서도 보안 일관성이 유지돼야 함</li></ul><h4 id=5-주요-오픈소스클라우드-큐-기술-도구별-특성-비교>(5) 주요 오픈소스/클라우드 큐 기술 도구별 특성 비교<a hidden class=anchor aria-hidden=true href=#5-주요-오픈소스클라우드-큐-기술-도구별-특성-비교>#</a></h4><table><thead><tr><th>도구/서비스</th><th>특징 및 주요 장점</th><th>활용 팁</th></tr></thead><tbody><tr><td>RabbitMQ</td><td>AMQP(Advanced Message Queuing Protocol) 표준, 손쉬운 셋업, 다양한 메시지 패턴 지원</td><td>DLQ, Routing Key, Exchange 활용</td></tr><tr><td>Apache Kafka</td><td>분산 로그 기반, 초대용량/고성능, 이벤트 소스화(streaming) 적합</td><td>Partition/Timestamp 기반 처리 속도↑</td></tr><tr><td>AWS SQS</td><td>클라우드 완전 관리형, 인프라/운영/확장 부담↓</td><td>DLQ, Message Retention, Lambda 연계</td></tr><tr><td>Google Pub/Sub</td><td>전 세계 확장성과 빠른 프로비저닝, 실시간 분산 이벤트 전달</td><td>동적 구독, 주제(Topic) 다중 활용</td></tr></tbody></table><h3 id=22-실제-구현을-위한-코드-예시주석-포함-python>22. 실제 구현을 위한 코드 예시(주석 포함, Python)<a hidden class=anchor aria-hidden=true href=#22-실제-구현을-위한-코드-예시주석-포함-python>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>  <span class=c1># RabbitMQ, AMQP(Advanced Message Queuing Protocol) 클라이언트 라이브러리</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 보내기 (프로듀서 역할)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_message</span><span class=p>(</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 브로커와 연결(커넥션 객체 생성)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># 큐 선언(없으면 생성)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># durable: 메시지 영속화</span>
</span></span><span class=line><span class=cl>    <span class=c1># 메시지 전송</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>routing_key</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>body</span><span class=o>=</span><span class=n>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span><span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 영속성 메시지</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 전송: </span><span class=si>{</span><span class=n>data</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 소비(컨슈머 역할)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consume_message</span><span class=p>(</span><span class=n>queue_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;수신 메시지: </span><span class=si>{</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>  <span class=c1># 메시지 ACK, 중복 방지</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;메시지 소비 대기 중...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>핵심 설명: producer-consumer 분리, 큐 영속성, Ack, 적절한 예외처리(프로덕션 환경에선 DLQ, Retry도 추가).</li></ul><h2 id=23-결론-및-실전-조언>23. 결론 및 실전 조언<a hidden class=anchor aria-hidden=true href=#23-결론-및-실전-조언>#</a></h2><ul><li>메시징 큐는 시스템 트래픽 완충, 장애 격리, 마이크로서비스 동기·비동기 이벤트 전달 플랫폼의 핵심이다.</li><li>단순 메시지 저장·전달이 아니라, 데이터 일관성(Exactly-Once), 높은 신뢰성, 확장성, 실시간 모니터링 구조까지 갖춰야 실전에서 안전하게 활용된다.</li><li>각 큐 패턴/FIFO, DLQ, Priority 등은 비즈니스 특성에 맞게 선택·조합하며, 대규모 분산 운영이 필요한 경우엔 오토스케일, 표준 포맷, 실시간 모니터링이 필수다.</li></ul><h2 id=용어-정리-2>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-2>#</a></h2><table><thead><tr><th>카테고리</th><th>용어(한글/영문)</th><th>설명</th></tr></thead><tbody><tr><td>분산 처리</td><td>Outbox Pattern(아웃박스 패턴)</td><td>DB에 메시지를 별도 테이블로 저장 후 큐에 보냄</td></tr><tr><td>장애 처리</td><td>Retry(재시도)</td><td>처리 실패 시 재전송</td></tr><tr><td>장애 처리</td><td>Dead Letter Queue(사망 큐)</td><td>실패 메시지 분리, 운영 품질 강화</td></tr><tr><td>운영관리</td><td>오토스케일링(Auto-scaling)</td><td>인스턴스 자동 제어, 자가 치유 구조 구현</td></tr><tr><td>이벤트 아키텍처</td><td>Event-Driven Architecture(이벤트 기반 아키텍처)</td><td>이벤트에 따라 서비스/워크플로우 트리거</td></tr></tbody></table><h2 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h2><ul><li><a href=https://www.ibm.com/topics/message-queueing>Message Queueing Explained (IBM)</a></li><li><a href=https://www.rabbitmq.com/documentation.html>RabbitMQ 공식 문서</a></li><li><a href=https://kafka.apache.org/documentation/>Apache Kafka 공식 문서</a></li><li><a href=https://aws.amazon.com/ko/sqs/>AWS SQS 공식 소개</a></li><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/messaging>모던 시스템 디자인의 메시징 패턴 (Microsoft Learn)</a></li><li><a href=https://www.confluent.io/blog/exactly-once-semantics-are-possible-heres-how-kafka-does-it/>Exactly-Once Semantics in Apache Kafka</a></li><li><a href=https://martinfowler.com/bliki/Idempotency.html>분산 시스템에서의 멱등성 (Martin Fowler)</a></li><li><a href=https://dev.to/unclaed/distributed-message-queue-architecture-implementation-3kjk>Distributed Message Queue: Architecture & Implementation</a></li><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/dead-letter-queue>Dead-Letter Queue Pattern (Azure Architecture Center)</a></li></ul><h3 id=24-분류-기준에-따른-메시징-큐messaging-queue-종류-및-유형-상세-정리>24. 분류 기준에 따른 메시징 큐(Messaging Queue) 종류 및 유형 상세 정리<a hidden class=anchor aria-hidden=true href=#24-분류-기준에-따른-메시징-큐messaging-queue-종류-및-유형-상세-정리>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>주요 특징 및 설명</th></tr></thead><tbody><tr><td>큐의 동작 원리</td><td>FIFO(선입선출 큐, First-In-First-Out Queue)</td><td>가장 먼저 들어온 메시지가 가장 먼저 소비됨. 순서 보장에 강점</td></tr><tr><td></td><td>Priority Queue(우선순위 큐)</td><td>각 메시지에 우선순위 지정, 중요 메시지가 먼저 처리됨</td></tr><tr><td></td><td>Delay Queue(지연 큐)</td><td>지정한 시간 이후에만 소비 가능. 예약/스케줄링 메시지에 적합</td></tr><tr><td></td><td>Dead Letter Queue(사망 큐, DLQ)</td><td>처리 실패 메시지를 분리 저장. 데이터 유실/장애 복구/분리 처리에 활용</td></tr><tr><td>전달 방식</td><td>P2P(점대점, Point-to-Point)</td><td>하나의 프로듀서, 하나의 컨슈머 간 직접 전달. 단일 소비 상황에 적합</td></tr><tr><td></td><td>Pub/Sub(발행-구독, Publish/Subscribe)</td><td>하나의 메시지를 여러 구독자(컨슈머)에게 동시 전달. 이벤트 브로드캐스트에 최적</td></tr><tr><td>배포 방식</td><td>온프레미스(On-premise)</td><td>자체 인프라에 직접 구축해 운영. 커스터마이즈 및 데이터 통제에 강점</td></tr><tr><td></td><td>클라우드 매니지드(Managed on Cloud)</td><td>AWS SQS, Google Pub/Sub 등 완전관리 서비스. 쉽고 빠른 확장, 운영 자동화</td></tr><tr><td></td><td>하이브리드(Hybrid)</td><td>온프레미스+클라우드 조합, 대규모·민감 시스템 혼합 운영</td></tr><tr><td>메시지 보장 정책</td><td>At-Least-Once(최소 한 번) 전달</td><td>메시지가 한 번 이상 전달되지만, 중복 가능성. 멱등성(ID) 처리 필수</td></tr><tr><td></td><td>Exactly-Once(정확히 한 번)</td><td>메시지가 반드시 한 번만 전달·소비됨. 복잡하지만 일관성 강점</td></tr><tr><td></td><td>At-Most-Once(최대 한 번)</td><td>메시지가 최대 한 번만 전달(유실 있을 수 있음). 실시간/비핵심 정보에 사용</td></tr></tbody></table><h3 id=25-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>25. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#25-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>메시지 순서 보장</td><td>데이터 특성에 따라 메시지 순서가 매우 중요할 수 있음</td><td>순서 중요한 큐는 파티션/샤딩 설계 신중히</td></tr><tr><td>메시지 보장 정책</td><td>업무 특성에 따라 보장 등급(최소/최대/정확히 한 번) 선택</td><td>민감·핵심 서비스는 Exactly-Once 사용</td></tr><tr><td>적재/큐 적체 대응</td><td>메시지 소비 속도, 큐 적체, 리소스 부족 항상 감시</td><td>모니터링/오토스케일링 시스템 연동</td></tr><tr><td>장애 복구 전략</td><td>DLQ, Retry, Backoff 등 장애 대응 로직 구축</td><td>자동화된 장애 탐지 및 경보 체계 필요</td></tr><tr><td>보안</td><td>메시지 암호화, 인증, 접근 제어 반드시 반영</td><td>TLS 등 네트워크 보안 기술 적극 도입</td></tr><tr><td>멱등성 처리</td><td>메시지 중복에 대한 대비(수신 측 멱등성)</td><td>ID 저장·상태 기반 반복 방지</td></tr></tbody></table><h3 id=26-최적화하기-위한-고려사항-및-주의할-점>26. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#26-최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>메시지 크기 최적화</td><td>불필요/중복 데이터 제거로 네트워크 효율화</td><td>압축, 경량 포맷(JSON/Avro 등) 활용</td></tr><tr><td>파티셔닝</td><td>메시지 대량 소비 시 분산 처리 용이</td><td>Partition/Shard 설계 사전 검토</td></tr><tr><td>컨슈머 튜닝</td><td>컨슈머 수·병렬 처리 레벨 자동 조정</td><td>오토스케일(부하 기반 확장) 적용</td></tr><tr><td>프로토콜 경량화</td><td>대역폭 절약·지연 감소 위해 최적 프로토콜 선택</td><td>AMQP, MQTT, gRPC 등 상황별 최적화</td></tr><tr><td>모니터링 강화</td><td>큐 적체/병목/에러율 등 실시간 등 주요 지표 집중 관찰</td><td>대시보드, Alert, 자동 복구 연동</td></tr></tbody></table><h3 id=27-두-표효과적-적용최적화에-대한-권장사항-정리>27. 두 표(효과적 적용/최적화)에 대한 권장사항 정리<a hidden class=anchor aria-hidden=true href=#27-두-표효과적-적용최적화에-대한-권장사항-정리>#</a></h3><ul><li><strong>순서와 보장 정책:</strong> 중요 데이터/트랜잭션에는 순서와 Exactly-Once 보장을 의무화.</li><li><strong>운영 자동화:</strong> 큐/컨슈머 병목은 오토스케일, 장애는 DLQ+Retry로 자동 처리해 운영 효율과 신뢰성 확보.</li><li><strong>보안 적용:</strong> 모든 큐 통신에 TLS(전송계층보안), 인증, 접근권한 제어 정책 일관되게 적용.</li><li><strong>모니터링:</strong> 큐 상태, 메시지 적체, 에러율 등 주요 지표 실시간 대시보드/경보 연계 필수.</li><li><strong>최적화:</strong> 메시지는 반드시 경량화, 불필요 필드 제거, 파티션/병렬 처리 아키텍처 적극 활용.</li></ul><h3 id=용어-정리-3>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-3>#</a></h3><table><thead><tr><th>카테고리</th><th>용어(한글/영문)</th><th>설명</th></tr></thead><tbody><tr><td>큐 동작구조</td><td>Sharding(샤딩)</td><td>데이터를 여러 분할 단위(파티션)에 분산, 병렬 처리</td></tr><tr><td>프로토콜</td><td>gRPC</td><td>Google RPC, 경량화된 원격 호출 프레임워크</td></tr><tr><td>모니터링/운영</td><td>Queue Backlog(큐 적체)</td><td>큐에 메시지가 쌓여 소비가 지연된 상태</td></tr><tr><td>장애 대응</td><td>Retry(재시도)</td><td>실패 메시지를 일정 횟수/패턴으로 자동 재전송</td></tr><tr><td>보안</td><td>TLS(Transport Layer Security)</td><td>데이터 통신 암호화 표준</td></tr></tbody></table><h3 id=참고-및-출처-3>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-3>#</a></h3><ul><li><a href=https://www.ibm.com/topics/message-queueing>Message Queueing Explained (IBM)</a></li><li><a href=https://www.rabbitmq.com/documentation.html>RabbitMQ 공식 문서</a></li><li><a href=https://kafka.apache.org/documentation/>Apache Kafka 공식 문서</a></li><li><a href=https://aws.amazon.com/ko/sqs/>AWS SQS 공식 소개</a></li><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/messaging>모던 시스템 디자인의 메시징 패턴 (Microsoft Learn)</a></li><li><a href=https://www.confluent.io/blog/exactly-once-semantics-are-possible-heres-how-kafka-does-it/>Exactly-Once Semantics in Apache Kafka</a></li><li><a href=https://martinfowler.com/bliki/Idempotency.html>분산 시스템에서의 멱등성 (Martin Fowler)</a></li><li><a href=https://dev.to/unclaed/distributed-message-queue-architecture-implementation-3kjk>Distributed Message Queue: Architecture & Implementation</a></li><li><a href=https://learn.microsoft.com/ko-kr/azure/architecture/patterns/dead-letter-queue>Dead-Letter Queue Pattern (Azure Architecture Center)</a></li></ul><p>네, &ldquo;Messaging Queues"에 대해 체계적으로 조사하고 분석해드리겠습니다. 먼저 최신 정보를 수집하기 위해 웹 검색을 진행하겠습니다.네, &ldquo;Messaging Queues"에 대해 체계적으로 조사하고 분석해드리겠습니다.</p><h2 id=작업-1-태그-생성>작업 1: 태그 생성<a hidden class=anchor aria-hidden=true href=#작업-1-태그-생성>#</a></h2><p><code>Message-Queues</code>, <code>Distributed-Systems</code>, <code>Asynchronous-Communication</code>, <code>Event-Driven-Architecture</code></p><h2 id=작업-2-분류-구조-검토>작업 2: 분류 구조 검토<a hidden class=anchor aria-hidden=true href=#작업-2-분류-구조-검토>#</a></h2><p>제시된 &ldquo;Computer Science and Engineering > System Design > Distributed Systems > Message-Oriented Systems > Message Processing Systems&rdquo; 분류는 적절합니다. 하지만 다음과 같이 더 세분화하는 것을 제안합니다:</p><p><strong>권장 분류</strong>: <code>Computer Science and Engineering > System Design > Distributed Systems > Messaging and Communication > Message Queuing Systems</code></p><p><strong>근거</strong>: Message Queuing Systems는 단순한 Message Processing을 넘어서 비동기 통신, 서비스 디커플링, 이벤트 스트리밍 등 더 광범위한 통신 패러다임을 다루므로 &ldquo;Messaging and Communication&rdquo; 하위에 위치하는 것이 더 적절합니다.</p><h2 id=작업-3-주제-요약-설명-200자-내외>작업 3: 주제 요약 설명 (200자 내외)<a hidden class=anchor aria-hidden=true href=#작업-3-주제-요약-설명-200자-내외>#</a></h2><p>메시징 큐 (Messaging Queues)는 분산 시스템에서 비동기 통신을 가능하게 하는 중간 계층으로, 메시지 생산자(Producer)와 소비자(Consumer) 간의 결합도를 낮추고 시스템의 확장성과 안정성을 향상시키는 핵심 아키텍처 컴포넌트입니다.</p><h2 id=작업-4-전체-내용-개요-250자-내외>작업 4: 전체 내용 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#작업-4-전체-내용-개요-250자-내외>#</a></h2><p>이 분석은 메시징 큐의 등장 배경부터 핵심 원리, 주요 구현 기술, 실무 활용 방안까지 포괄적으로 다룹니다. Point-to-Point와 Publish-Subscribe 패턴, Kafka·RabbitMQ·SQS 등 주요 기술 비교, 그리고 현대 마이크로서비스 아키텍처에서의 역할과 최적화 방안을 심층 분석합니다.</p><hr><h1 id=메시징-큐-messaging-queues-심층-분석>메시징 큐 (Messaging Queues) 심층 분석<a hidden class=anchor aria-hidden=true href=#메시징-큐-messaging-queues-심층-분석>#</a></h1><h2 id=1부-기본-개념-및-원리>1부: 기본 개념 및 원리<a hidden class=anchor aria-hidden=true href=#1부-기본-개념-및-원리>#</a></h2><h3 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h3><p>메시징 큐는 모놀리식 시스템에서 분산 시스템으로의 진화 과정에서 필수적으로 등장한 기술입니다. 초기에는 단일 프로세스에서 실행되는 간단한 소프트웨어 시스템이었지만, 시스템의 복잡성과 규모가 증가하면서 비동기 통신의 필요성이 대두되었습니다.</p><p>메시징 큐는 분산 시스템 내에서 비동기 통신을 위한 기본 개념으로, 시스템의 서로 다른 부분 간의 비동기 통신을 가능하게 합니다. 특히 마이크로서비스 아키텍처의 확산과 함께 서비스 간 결합도를 낮추고 독립적인 확장을 가능하게 하는 핵심 기술로 발전했습니다.</p><h3 id=목적-및-필요성-1>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성-1>#</a></h3><p>메시징 큐의 주요 목적은 다음과 같습니다:</p><ol><li><p><strong>서비스 디커플링</strong>: 메시지 큐는 애플리케이션을 서로 분리하여 독립적으로 개발할 수 있게 합니다. 이는 시스템을 더 유연하고 유지 관리하기 쉽게 만듭니다.</p></li><li><p><strong>비동기 처리</strong>: 애플리케이션이 응답을 기다리지 않고 메시지를 보내고 받을 수 있어 확장 가능하고 신뢰할 수 있는 시스템 구축에 필수적입니다.</p></li><li><p><strong>확장성 보장</strong>: 메시지 큐는 여러 프로세스가 메시징 큐를 통해 통신할 수 있게 하며, 요청 수가 증가할 때 여러 소비자에게 작업 부하를 분산시킵니다.</p></li><li><p><strong>안정성 확보</strong>: 메시지 지속성, 재시도, 데드 레터 큐와 같은 기능을 통해 장애 시에도 메시지가 손실되지 않도록 보장합니다.</p></li></ol><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p>메시징 큐 시스템을 이해하기 위한 핵심 개념들:</p><p><strong>1. 메시지 (Message)</strong>
메시지는 메시지 큐에 추가되는 모든 데이터나 명령입니다. 메시지는 JSON, XML, 바이너리 등 다양한 형태로 구성될 수 있습니다.</p><p><strong>2. 생산자 (Producer)</strong>
생산자는 메시지를 생성하고 메시지 큐에 추가하는 애플리케이션입니다.</p><p><strong>3. 소비자 (Consumer)</strong>
소비자는 메시지 큐에서 메시지를 받아 처리하는 애플리케이션입니다.</p><p><strong>4. 브로커 (Broker)</strong>
브로커는 우편배달부처럼 발신자로부터 메일을 받아 올바른 목적지로 전달하는 역할을 합니다.</p><p><strong>5. 큐 (Queue)</strong>
큐는 처리되기를 기다리는 것들의 순서 있는 줄로, 순차적으로 줄의 시작부터 처리됩니다.</p><h4 id=핵심-개념의-실무-연관성>핵심 개념의 실무 연관성<a hidden class=anchor aria-hidden=true href=#핵심-개념의-실무-연관성>#</a></h4><p>이러한 핵심 개념들은 실무에서 다음과 같이 연관됩니다:</p><ul><li><strong>확장성 측면</strong>: Producer와 Consumer가 독립적으로 확장 가능</li><li><strong>안정성 측면</strong>: Broker가 메시지 지속성과 전달 보장 담당</li><li><strong>성능 측면</strong>: Queue의 구조와 파티셔닝이 처리량 결정</li><li><strong>운영 측면</strong>: Message 형태와 크기가 네트워크 및 저장소 사용량 영향</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><p><strong>기능</strong>:</p><ol><li><strong>메시지 저장</strong>: 일시적으로 메시지를 저장하여 Producer와 Consumer 간의 시간적 분리</li><li><strong>메시지 라우팅</strong>: 메시지를 적절한 Consumer에게 전달</li><li><strong>메시지 변환</strong>: 필요시 메시지 형식 변환 및 필터링</li><li><strong>배달 보장</strong>: At-least-once, At-most-once, Exactly-once 배달 보장</li></ol><p><strong>역할</strong>:</p><ol><li><strong>중개자 역할</strong>: Producer와 Consumer 간의 중간 계층 역할</li><li><strong>버퍼 역할</strong>: 트래픽 급증 시 요청을 일시적으로 저장하는 완충 역할</li><li><strong>부하 분산</strong>: 여러 Consumer에게 작업을 분산하는 로드밸런서 역할</li></ol><h3 id=특징-1>특징<a hidden class=anchor aria-hidden=true href=#특징-1>#</a></h3><p>메시징 큐의 주요 특징들은 시스템의 특정 구성 요소를 통해 달성됩니다:</p><ol><li><p><strong>세밀한 확장성</strong>: 비동기 통신으로 시스템이 더욱 확장 가능해집니다. 많은 프로세스가 메시징 큐를 통해 통신할 수 있으며, 요청 수가 증가할 때 여러 소비자에게 작업 부하를 분산합니다.</p></li><li><p><strong>쉬운 디커플링</strong>: 메시징 큐는 시스템의 여러 엔터티 간 종속성을 분리합니다. 상호 작용하는 엔터티들이 메시지를 통해 통신하며 서로의 내부 작업 메커니즘을 알 필요가 없습니다.</p></li><li><p><strong>속도 제한</strong>: 메시징 큐는 부하 급증을 흡수하고 서비스가 과부하 상태가 되는 것을 방지하여 기본적인 속도 제한 형태로 작동합니다.</p></li></ol><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><p>메시징 큐 구현 시 지켜야 하는 핵심 원칙들:</p><ol><li><p><strong>At-Least-Once 배달</strong>: 분산 메시지 큐 시스템에는 많은 잠재적 장애 지점이 있습니다. 대부분의 분산 큐 솔루션은 내구성, 가용성, 성능 간의 균형을 제공하는 at-least-once 배달을 지원합니다.</p></li><li><p><strong>메시지 지속성</strong>: 시스템 장애 시에도 메시지 손실을 방지하기 위한 디스크 저장</p></li><li><p><strong>스케일링 고려</strong>: 수평적 확장이 가능한 구조 설계</p></li><li><p><strong>모니터링</strong>: 시스템 상태를 지속적으로 감시할 수 있는 메트릭 제공</p></li></ol><h3 id=주요-원리-및-작동-원리>주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#주요-원리-및-작동-원리>#</a></h3><p><strong>기본 작동 원리</strong>:</p><pre class=mermaid>graph LR
    A[Producer] --&gt;|Send Message| B[Message Queue]
    B --&gt;|Deliver Message| C[Consumer]
    B --&gt;|Store| D[Persistence Layer]
    E[Broker] --&gt;|Manage| B
</pre><p>메시징 큐의 작동 과정:</p><ol><li>Producer가 메시지를 생성하여 Queue에 전송</li><li>Broker가 메시지를 적절한 Queue에 저장</li><li>Consumer가 Queue에서 메시지를 폴링하거나 Push 방식으로 수신</li><li>메시지 처리 완료 후 ACK(Acknowledgment) 전송</li><li>성공적인 처리 확인 후 Queue에서 메시지 제거</li></ol><h2 id=2부-구조-및-아키텍처>2부: 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#2부-구조-및-아키텍처>#</a></h2><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><p>메시징 큐 시스템의 전체 아키텍처는 다음과 같은 핵심 구성 요소들로 이루어집니다:</p><pre class=mermaid>graph TB
    subgraph &#34;Frontend Layer&#34;
        LB[Load Balancer]
        FE[Frontend Service]
    end
    
    subgraph &#34;Metadata Layer&#34;
        MS[Metadata Service]
        MDB[(Metadata DB)]
    end
    
    subgraph &#34;Message Processing Layer&#34;
        MB1[Message Broker 1]
        MB2[Message Broker 2]
        MB3[Message Broker 3]
    end
    
    subgraph &#34;Storage Layer&#34;
        PS[(Persistent Storage)]
        Rep[(Replicas)]
    end
    
    subgraph &#34;Management Layer&#34;
        CM[Cluster Manager]
        ZK[ZooKeeper/Coordination]
    end
    
    LB --&gt; FE
    FE --&gt; MS
    FE --&gt; MB1
    FE --&gt; MB2
    FE --&gt; MB3
    MS --&gt; MDB
    MB1 --&gt; PS
    MB2 --&gt; PS
    MB3 --&gt; PS
    PS --&gt; Rep
    CM --&gt; MB1
    CM --&gt; MB2
    CM --&gt; MB3
    ZK --&gt; CM
</pre><h3 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h3><h4 id=필수-구성요소>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소>#</a></h4><p><strong>1. Frontend Service (프론트엔드 서비스)</strong></p><ul><li><strong>기능</strong>: 요청 검증, 인증 및 권한 부여, SSL 종료를 담당합니다.</li><li><strong>역할</strong>: 클라이언트 요청의 첫 번째 진입점</li><li><strong>특징</strong>: 무상태(Stateless) 서비스로 수평 확장 가능</li></ul><p><strong>2. Metadata Service (메타데이터 서비스)</strong></p><ul><li><strong>기능</strong>: 큐의 이름, 생성 날짜/시간, 소유자 및 기타 구성 설정을 데이터베이스에 저장합니다.</li><li><strong>역할</strong>: 큐 정보 및 소비자 매핑 관리</li><li><strong>특징</strong>: 높은 가용성과 일관성이 요구됨</li></ul><p><strong>3. Backend Service (백엔드 서비스)</strong></p><ul><li><strong>기능</strong>: 메시지 지속성 및 처리를 담당합니다.</li><li><strong>역할</strong>: 실제 메시지 저장 및 전달</li><li><strong>특징</strong>: 수평 확장과 복제를 통한 내결함성 제공</li></ul><p><strong>4. Message Broker (메시지 브로커)</strong></p><ul><li><strong>기능</strong>: 메시지 라우팅, 저장, 전달 관리</li><li><strong>역할</strong>: Producer와 Consumer 간의 중개자</li><li><strong>특징</strong>: 클러스터링을 통한 고가용성 달성</li></ul><h4 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h4><p><strong>1. Coordination Service (조정 서비스)</strong></p><ul><li><strong>기능</strong>: 리더와 팔로워 간의 상호 작용을 저장하고 관리하는 ZooKeeper와 같은 조정 서비스</li><li><strong>역할</strong>: 분산 환경에서 리더 선출 및 클러스터 상태 관리</li><li><strong>특징</strong>: 강한 일관성과 분산 락 제공</li></ul><p><strong>2. Monitoring Service (모니터링 서비스)</strong></p><ul><li><strong>기능</strong>: 분산 메시지 큐와 관련하여 우리가 구축한 구성 요소(또는 마이크로서비스): 프론트엔드, 메타데이터 및 백엔드 서비스를 모니터링해야 합니다.</li><li><strong>역할</strong>: 시스템 성능 및 상태 감시</li><li><strong>특징</strong>: 실시간 알림 및 대시보드 제공</li></ul><p><strong>3. Dead Letter Queue (데드 레터 큐)</strong></p><ul><li><strong>기능</strong>: 처리에 실패한 메시지를 위한 메커니즘</li><li><strong>역할</strong>: 실패한 메시지의 분석 및 재처리</li><li><strong>특징</strong>: 문제 진단 및 시스템 안정성 향상</li></ul><h3 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h3><p>메시징 큐를 구현하기 위한 주요 기법들:</p><p><strong>1. 메시지 저장 방식</strong></p><p>저장소는 메시지 큐 시스템 설계에서 중요한 구성 요소입니다. 대량의 메시지와 읽기-쓰기 집약적 시스템을 다룰 때 SQL, NoSQL 또는 Write Ahead Log(WAL)를 사용할 수 있습니다.</p><ul><li><strong>Write Ahead Log (WAL)</strong>: 각 메시지가 파일의 끝에 추가되는 추가 전용 로그 시스템이므로 Write Ahead Log 방식이 권장됩니다.</li><li><strong>파일 분할</strong>: 단일 파일에 추가하면 파일이 너무 커질 수 있으므로 파일을 여러 세그먼트로 나누고 buyer ID를 기반으로 분할합니다.</li></ul><p><strong>실제 예시</strong>: Apache Kafka의 로그 세그먼트 방식</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>topic-partition-0/
</span></span><span class=line><span class=cl>├── 00000000000000000000.log
</span></span><span class=line><span class=cl>├── 00000000000000001000.log
</span></span><span class=line><span class=cl>└── 00000000000000002000.log
</span></span></code></pre></td></tr></table></div></div><p><strong>2. 복제 및 가용성</strong></p><p>내결함성은 시스템 오류가 있어도 시스템이 계속 작동할 수 있는 능력입니다. 조정 서비스와 ZooKeeper를 사용하여 리더-팔로워 접근 방식이 제안됩니다.</p><ul><li><strong>리더-팔로워 패턴</strong>: 하나의 리더가 쓰기를 담당하고 여러 팔로워가 복제본 유지</li><li><strong>자동 장애조치</strong>: 리더 장애 시 자동으로 새로운 리더 선출</li></ul><p><strong>3. 파티셔닝 전략</strong></p><ul><li><strong>해시 기반 파티셔닝</strong>: 메시지 키의 해시값을 기준으로 파티션 결정</li><li><strong>범위 기반 파티셔닝</strong>: 특정 범위의 키를 동일 파티션에 배치</li><li><strong>라운드 로빈</strong>: 순차적으로 파티션에 메시지 분산</li></ul><h2 id=3부-장단점-및-패턴-분석>3부: 장단점 및 패턴 분석<a hidden class=anchor aria-hidden=true href=#3부-장단점-및-패턴-분석>#</a></h2><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>비동기 처리</td><td>Producer와 Consumer가 독립적으로 작동하여 시스템 응답성 향상</td></tr><tr><td>장점</td><td>확장성</td><td>세밀한 확장성으로 많은 프로세스가 메시징 큐를 통해 통신하며 여러 소비자에게 작업 분산</td></tr><tr><td>장점</td><td>디커플링</td><td>시스템 엔터티 간 종속성 분리로 각 구성 요소의 독립적인 개발 및 배포 가능</td></tr><tr><td>장점</td><td>내결함성</td><td>메시지 지속성과 복제를 통한 시스템 안정성 보장</td></tr><tr><td>장점</td><td>부하 평준화</td><td>부하 급증을 흡수하고 서비스 과부하 방지를 통한 기본적인 속도 제한 기능</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><p><strong>단점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>복잡성 증가</td><td>비동기 통신은 메시지 순서, 재시도, 구성 요소 간 데이터 일관성을 다루기 위한 신중한 설계가 필요</td><td>이벤트 소싱, SAGA 패턴 적용</td></tr><tr><td>단점</td><td>지연 시간</td><td>메시지 브로커를 통한 간접 통신으로 인한 추가 지연</td><td>인메모리 큐, 로컬 캐싱 활용</td></tr><tr><td>단점</td><td>운영 오버헤드</td><td>추가 인프라 구성 요소로 인한 관리 복잡성 증가</td><td>관리형 서비스 활용 (AWS SQS, Google Pub/Sub)</td></tr></tbody></table><p><strong>문제점</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>메시지 중복</td><td>중복 메시지 처리 및 멱등성 메시지 처리 보장이 복잡</td><td>데이터 불일치 발생</td><td>메시지 ID 추적, 로그 분석</td><td>멱등성 키 사용</td><td>중복 제거 로직, 트랜잭션 관리</td></tr><tr><td>문제점</td><td>메시지 순서 보장</td><td>분산 시스템에서 엄격한 순서 유지가 어려움</td><td>비즈니스 로직 오류</td><td>순서 검증 로직, 모니터링</td><td>단일 파티션 사용</td><td>순서 보장 큐, 시퀀스 번호 활용</td></tr><tr><td>문제점</td><td>백프레셔 처리</td><td>Consumer 처리 속도 &lt; Producer 생산 속도</td><td>메모리 오버플로우, 시스템 다운</td><td>큐 길이 모니터링</td><td>속도 제한, Circuit Breaker</td><td>동적 스케일링, 우선순위 큐</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><p><strong>1. 성능 최적화</strong></p><ul><li><strong>원인</strong>: 높은 처리량과 낮은 지연시간의 동시 달성 어려움</li><li><strong>영향</strong>: 실시간 시스템에서의 사용자 경험 저하</li><li><strong>해결 방법</strong>:<ul><li>배치 처리와 스트리밍의 하이브리드 접근</li><li>메모리 기반 버퍼링 전략</li><li>네트워크 최적화 및 압축</li></ul></li></ul><p><strong>2. 다중 데이터센터 환경</strong></p><ul><li><strong>원인</strong>: 네트워크 파티션과 지연시간 증가</li><li><strong>영향</strong>: 데이터 일관성과 가용성 사이의 트레이드오프</li><li><strong>해결 방법</strong>:<ul><li>CAP 정리를 고려한 설계</li><li>지역별 복제 전략</li><li>컨플릭트 해결 메커니즘</li></ul></li></ul><p><strong>3. 스키마 진화</strong></p><ul><li><strong>원인</strong>: 메시지 스키마 변경 시 호환성 문제</li><li><strong>영향</strong>: 서비스 중단 없는 업데이트 어려움</li><li><strong>해결 방법</strong>:<ul><li>스키마 레지스트리 활용</li><li>하위 호환성 보장 설계</li><li>점진적 롤아웃 전략</li></ul></li></ul><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>예시</th></tr></thead><tbody><tr><td>메시징 패턴</td><td>Point-to-Point</td><td>메시지 발신자가 메시지 수신자를 알아야 하며, 메시지당 하나의 수신자</td><td>Amazon SQS</td></tr><tr><td>메시징 패턴</td><td>Publish-Subscribe</td><td>메시지 게시자가 메시지가 어디서 소비될지 알 필요가 없으며, 높은 디커플링 제공</td><td>Apache Kafka</td></tr><tr><td>전달 모델</td><td>Push Model</td><td>브로커가 Consumer에게 메시지 전송</td><td>RabbitMQ</td></tr><tr><td>전달 모델</td><td>Pull Model</td><td>Consumer가 지속적으로 메시지 검색 요청을 보내며 새 메시지가 큐에 있을 때 전송</td><td>Apache Kafka</td></tr><tr><td>배달 보장</td><td>At-Least-Once</td><td>메시지가 적어도 한 번은 전달됨 (중복 가능)</td><td>Most systems</td></tr><tr><td>배달 보장</td><td>At-Most-Once</td><td>메시지가 최대 한 번만 전달됨 (손실 가능)</td><td>UDP-like systems</td></tr><tr><td>배달 보장</td><td>Exactly-Once</td><td>메시지가 정확히 한 번만 전달됨</td><td>Kafka with transactions</td></tr><tr><td>관리 방식</td><td>Self-Managed</td><td>직접 설치 및 관리</td><td>RabbitMQ, Apache Kafka</td></tr><tr><td>관리 방식</td><td>Fully-Managed</td><td>클라우드 서비스로 제공</td><td>AWS SQS, Google Pub/Sub</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>사용 사례</th><th>목적</th><th>효과</th><th>함께 사용되는 기술</th></tr></thead><tbody><tr><td>이메일 발송</td><td>대량 이메일 비동기 처리</td><td>시스템 응답성 향상</td><td>SMTP 서버, 템플릿 엔진</td></tr><tr><td>추천 시스템</td><td>사용자 기록 데이터 처리</td><td>성능 향상 및 빠른 응답</td><td>ML 파이프라인, 데이터 웨어하우스</td></tr><tr><td>주문 처리</td><td>마이크로서비스 간 통신</td><td>서비스 독립성 확보</td><td>결제 게이트웨이, 재고 관리 시스템</td></tr><tr><td>로그 수집</td><td>실시간 로그 스트리밍</td><td>확장 가능한 모니터링</td><td>ELK Stack, 메트릭 시스템</td></tr><tr><td>IoT 데이터 처리</td><td>센서 데이터 수집 및 처리</td><td>실시간 분석 가능</td><td>시계열 DB, 스트림 처리 엔진</td></tr></tbody></table><h2 id=4부-활용-사례-및-최적화>4부: 활용 사례 및 최적화<a hidden class=anchor aria-hidden=true href=#4부-활용-사례-및-최적화>#</a></h2><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><p><strong>시나리오</strong>: 대규모 전자상거래 플랫폼의 주문 처리 시스템</p><p><strong>시스템 구성</strong>:</p><ul><li>주문 서비스 (Order Service)</li><li>결제 서비스 (Payment Service)</li><li>재고 서비스 (Inventory Service)</li><li>배송 서비스 (Shipping Service)</li><li>알림 서비스 (Notification Service)</li><li>Apache Kafka 클러스터</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Frontend&#34;
        UI[Web/Mobile UI]
        API[API Gateway]
    end
    
    subgraph &#34;Microservices&#34;
        OS[Order Service]
        PS[Payment Service]
        IS[Inventory Service]
        SS[Shipping Service]
        NS[Notification Service]
    end
    
    subgraph &#34;Message Queue Layer&#34;
        K1[Kafka Broker 1]
        K2[Kafka Broker 2]
        K3[Kafka Broker 3]
    end
    
    subgraph &#34;Topics&#34;
        OT[order-events]
        PT[payment-events]
        IT[inventory-events]
        ST[shipping-events]
    end
    
    UI --&gt; API
    API --&gt; OS
    OS --&gt; K1
    K1 --&gt; OT
    OT --&gt; PS
    OT --&gt; IS
    OT --&gt; SS
    PS --&gt; PT
    IS --&gt; IT
    SS --&gt; ST
    PT --&gt; NS
    IT --&gt; NS
    ST --&gt; NS
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 주문 생성 요청</li><li>Order Service가 주문 정보를 검증하고 order-events 토픽에 &ldquo;order-created&rdquo; 이벤트 발행</li><li>Payment Service가 이벤트를 수신하여 결제 처리 후 &ldquo;payment-completed&rdquo; 이벤트 발행</li><li>Inventory Service가 재고 차감 후 &ldquo;inventory-reserved&rdquo; 이벤트 발행</li><li>Shipping Service가 배송 준비 후 &ldquo;shipping-prepared&rdquo; 이벤트 발행</li><li>Notification Service가 각 단계별 알림을 사용자에게 전송</li></ol><p><strong>역할</strong>:</p><ul><li><strong>Apache Kafka</strong>: 이벤트 스트리밍 및 서비스 간 비동기 통신</li><li><strong>Topics</strong>: 도메인별 이벤트 분리 및 라우팅</li><li><strong>Partitions</strong>: 병렬 처리 및 확장성 제공</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>메시징 큐 있음</strong>: 서비스 독립적 확장, 장애 격리, 비동기 처리로 빠른 응답</li><li><strong>메시징 큐 없음</strong>: 서비스 간 강결합, 동기 호출로 인한 성능 저하, 단일 장애점</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span><span class=lnt id=hl-11-36><a class=lnlinks href=#hl-11-36>36</a>
</span><span class=lnt id=hl-11-37><a class=lnlinks href=#hl-11-37>37</a>
</span><span class=lnt id=hl-11-38><a class=lnlinks href=#hl-11-38>38</a>
</span><span class=lnt id=hl-11-39><a class=lnlinks href=#hl-11-39>39</a>
</span><span class=lnt id=hl-11-40><a class=lnlinks href=#hl-11-40>40</a>
</span><span class=lnt id=hl-11-41><a class=lnlinks href=#hl-11-41>41</a>
</span><span class=lnt id=hl-11-42><a class=lnlinks href=#hl-11-42>42</a>
</span><span class=lnt id=hl-11-43><a class=lnlinks href=#hl-11-43>43</a>
</span><span class=lnt id=hl-11-44><a class=lnlinks href=#hl-11-44>44</a>
</span><span class=lnt id=hl-11-45><a class=lnlinks href=#hl-11-45>45</a>
</span><span class=lnt id=hl-11-46><a class=lnlinks href=#hl-11-46>46</a>
</span><span class=lnt id=hl-11-47><a class=lnlinks href=#hl-11-47>47</a>
</span><span class=lnt id=hl-11-48><a class=lnlinks href=#hl-11-48>48</a>
</span><span class=lnt id=hl-11-49><a class=lnlinks href=#hl-11-49>49</a>
</span><span class=lnt id=hl-11-50><a class=lnlinks href=#hl-11-50>50</a>
</span><span class=lnt id=hl-11-51><a class=lnlinks href=#hl-11-51>51</a>
</span><span class=lnt id=hl-11-52><a class=lnlinks href=#hl-11-52>52</a>
</span><span class=lnt id=hl-11-53><a class=lnlinks href=#hl-11-53>53</a>
</span><span class=lnt id=hl-11-54><a class=lnlinks href=#hl-11-54>54</a>
</span><span class=lnt id=hl-11-55><a class=lnlinks href=#hl-11-55>55</a>
</span><span class=lnt id=hl-11-56><a class=lnlinks href=#hl-11-56>56</a>
</span><span class=lnt id=hl-11-57><a class=lnlinks href=#hl-11-57>57</a>
</span><span class=lnt id=hl-11-58><a class=lnlinks href=#hl-11-58>58</a>
</span><span class=lnt id=hl-11-59><a class=lnlinks href=#hl-11-59>59</a>
</span><span class=lnt id=hl-11-60><a class=lnlinks href=#hl-11-60>60</a>
</span><span class=lnt id=hl-11-61><a class=lnlinks href=#hl-11-61>61</a>
</span><span class=lnt id=hl-11-62><a class=lnlinks href=#hl-11-62>62</a>
</span><span class=lnt id=hl-11-63><a class=lnlinks href=#hl-11-63>63</a>
</span><span class=lnt id=hl-11-64><a class=lnlinks href=#hl-11-64>64</a>
</span><span class=lnt id=hl-11-65><a class=lnlinks href=#hl-11-65>65</a>
</span><span class=lnt id=hl-11-66><a class=lnlinks href=#hl-11-66>66</a>
</span><span class=lnt id=hl-11-67><a class=lnlinks href=#hl-11-67>67</a>
</span><span class=lnt id=hl-11-68><a class=lnlinks href=#hl-11-68>68</a>
</span><span class=lnt id=hl-11-69><a class=lnlinks href=#hl-11-69>69</a>
</span><span class=lnt id=hl-11-70><a class=lnlinks href=#hl-11-70>70</a>
</span><span class=lnt id=hl-11-71><a class=lnlinks href=#hl-11-71>71</a>
</span><span class=lnt id=hl-11-72><a class=lnlinks href=#hl-11-72>72</a>
</span><span class=lnt id=hl-11-73><a class=lnlinks href=#hl-11-73>73</a>
</span><span class=lnt id=hl-11-74><a class=lnlinks href=#hl-11-74>74</a>
</span><span class=lnt id=hl-11-75><a class=lnlinks href=#hl-11-75>75</a>
</span><span class=lnt id=hl-11-76><a class=lnlinks href=#hl-11-76>76</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Producer 예시 (Order Service)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;kafka-1:9092&#39;</span><span class=p>,</span> <span class=s1>&#39;kafka-2:9092&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>acks</span><span class=o>=</span><span class=s1>&#39;all&#39;</span><span class=p>,</span>  <span class=c1># 모든 복제본에서 ACK 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>retries</span><span class=o>=</span><span class=mi>3</span>    <span class=c1># 재시도 설정</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 데이터 검증 및 저장</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>save_order</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 생성 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=s1>&#39;order-created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_amount&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;total_amount&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 파티션 키로 customer_id 사용 (같은 고객의 주문은 순서 보장)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>topic</span><span class=o>=</span><span class=s1>&#39;order-events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=n>value</span><span class=o>=</span><span class=n>event</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Consumer 예시 (Payment Service)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PaymentService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order-events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;kafka-1:9092&#39;</span><span class=p>,</span> <span class=s1>&#39;kafka-2:9092&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>group_id</span><span class=o>=</span><span class=s1>&#39;payment-service&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>            <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>enable_auto_commit</span><span class=o>=</span><span class=kc>False</span>  <span class=c1># 수동 커밋으로 정확한 처리 보장</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;order-created&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 결제 처리 로직</span>
</span></span><span class=line><span class=cl>                    <span class=n>payment_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>process_payment</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>order_id</span><span class=o>=</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                        <span class=n>amount</span><span class=o>=</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;total_amount&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 결제 완료 이벤트 발행</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>publish_payment_event</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>],</span> <span class=s1>&#39;payment-completed&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>publish_payment_event</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>],</span> <span class=s1>&#39;payment-failed&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 메시지 처리 완료 후 커밋</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 에러 로깅 및 재시도 로직</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Payment processing failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=c1># Dead Letter Queue로 전송하거나 재시도</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>영역</th><th>고려사항</th><th>권장사항</th></tr></thead><tbody><tr><td>메시지 설계</td><td>스키마 버전 관리</td><td>Avro, Protobuf 등 스키마 레지스트리 활용</td></tr><tr><td>파티셔닝</td><td>적절한 파티션 키 선택</td><td>비즈니스 로직과 순서 보장 요구사항 고려</td></tr><tr><td>모니터링</td><td>큐 길이 및 지연시간 감시</td><td>알림 임계값 설정 및 자동 스케일링</td></tr><tr><td>보안</td><td>메시지 암호화 및 접근 제어</td><td>TLS/SSL 통신, RBAC 권한 관리</td></tr><tr><td>장애 처리</td><td>Dead Letter Queue 구성</td><td>실패한 메시지의 분석 및 재처리 방안</td></tr><tr><td>성능</td><td>배치 크기 최적화</td><td>처리량과 지연시간의 균형점 찾기</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>영역</th><th>최적화 포인트</th><th>권장사항</th></tr></thead><tbody><tr><td>처리량</td><td>병렬 처리 증대</td><td>Consumer 그룹 크기와 파티션 수 조정</td></tr><tr><td>지연시간</td><td>네트워크 및 직렬화 최적화</td><td>바이너리 프로토콜, 압축 알고리즘 적용</td></tr><tr><td>메모리</td><td>버퍼 크기 조정</td><td>Producer/Consumer 배치 설정 튜닝</td></tr><tr><td>저장소</td><td>디스크 I/O 최적화</td><td>SSD 사용, 로그 세그먼트 관리</td></tr><tr><td>네트워크</td><td>대역폭 효율성</td><td>메시지 압축, 배치 전송</td></tr><tr><td>가용성</td><td>복제 전략 최적화</td><td>적절한 복제 팩터와 ISR 설정</td></tr></tbody></table><h2 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>신기술 동향</td><td>Event Sourcing</td><td>CQRS 패턴</td><td>명령과 조회 분리를 통한 확장성 향상</td></tr><tr><td>신기술 동향</td><td>Stream Processing</td><td>Apache Pulsar</td><td>멀티 테넌시 지원하는 차세대 메시징 플랫폼</td></tr><tr><td>신기술 동향</td><td>Serverless</td><td>Cloud Functions</td><td>이벤트 기반 서버리스 아키텍처</td></tr><tr><td>표준화</td><td>프로토콜</td><td>CloudEvents</td><td>이벤트 데이터 표준화 명세</td></tr><tr><td>표준화</td><td>API</td><td>AsyncAPI</td><td>비동기 API 문서화 표준</td></tr><tr><td>운영 기법</td><td>Observability</td><td>Distributed Tracing</td><td>메시지 흐름 추적 및 성능 분석</td></tr><tr><td>운영 기법</td><td>Chaos Engineering</td><td>장애 주입 테스트</td><td>시스템 복원력 검증</td></tr></tbody></table><h2 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기초 개념</td><td>분산 시스템</td><td>CAP 정리</td><td>일관성, 가용성, 분할 허용성의 트레이드오프</td></tr><tr><td>기초 개념</td><td>동시성</td><td>백프레셔</td><td>느린 Consumer로 인한 시스템 압박 처리</td></tr><tr><td>메시징 패턴</td><td>Request-Reply</td><td>동기 통신</td><td>요청-응답 패턴과 비동기 메시징의 조합</td></tr><tr><td>메시징 패턴</td><td>Event Sourcing</td><td>이벤트 저장</td><td>상태 변화를 이벤트로 저장하는 패턴</td></tr><tr><td>성능 최적화</td><td>파티셔닝</td><td>샤딩 전략</td><td>데이터 분산을 통한 확장성 확보</td></tr><tr><td>성능 최적화</td><td>압축</td><td>메시지 압축</td><td>네트워크 대역폭 절약 기법</td></tr><tr><td>운영 관리</td><td>모니터링</td><td>메트릭 수집</td><td>시스템 상태 감시를 위한 지표 관리</td></tr><tr><td>운영 관리</td><td>보안</td><td>암호화 통신</td><td>메시지 전송 중 보안 확보 방안</td></tr></tbody></table><hr><h2 id=용어-정리-4>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-4>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>기본 개념</td><td>FIFO (First In First Out)</td><td>큐에서 가장 오래된 메시지가 항상 먼저 처리되는 방식</td></tr><tr><td>기본 개념</td><td>ACK (Acknowledgment)</td><td>메시지 처리 완료를 브로커에게 알리는 확인 메시지</td></tr><tr><td>기본 개념</td><td>Offset</td><td>Kafka에서 Consumer가 읽은 메시지의 위치를 나타내는 식별자</td></tr><tr><td>배달 보장</td><td>At-Least-Once</td><td>메시지가 적어도 한 번은 전달되지만 중복될 수 있는 방식</td></tr><tr><td>배달 보장</td><td>Exactly-Once</td><td>메시지가 정확히 한 번만 전달되는 이상적인 방식</td></tr><tr><td>아키텍처</td><td>ISR (In-Sync Replica)</td><td>리더와 동기화된 상태를 유지하는 복제본들의 집합</td></tr><tr><td>아키텍처</td><td>Partition</td><td>토픽을 구성하는 개별 로그 단위로 병렬 처리를 가능하게 함</td></tr><tr><td>패턴</td><td>Dead Letter Queue</td><td>처리 실패한 메시지들을 모아두는 특별한 큐</td></tr><tr><td>패턴</td><td>Circuit Breaker</td><td>연속된 실패 시 요청을 차단하여 시스템을 보호하는 패턴</td></tr><tr><td>성능</td><td>Backpressure</td><td>처리 속도 불균형으로 인한 시스템 압박 상황</td></tr><tr><td>성능</td><td>Batching</td><td>여러 메시지를 묶어서 한 번에 처리하는 최적화 기법</td></tr><tr><td>보안</td><td>TLS (Transport Layer Security)</td><td>네트워크 통신 시 데이터 암호화를 위한 프로토콜</td></tr><tr><td>프로토콜</td><td>AMQP</td><td>메시지 지향 미들웨어를 위한 개방형 표준 프로토콜</td></tr><tr><td>프로토콜</td><td>MQTT</td><td>IoT 환경에 최적화된 경량 메시징 프로토콜</td></tr></tbody></table><hr><h2 id=참고-및-출처-4>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-4>#</a></h2><ul><li><a href=https://www.geeksforgeeks.org/message-queues-system-design/>Message Queues - System Design - GeeksforGeeks</a></li><li><a href=https://medium.com/must-know-computer-science/system-design-message-queues-245612428a22>System Design — Message Queues</a></li><li><a href=https://www.educative.io/courses/grokking-the-system-design-interview/system-design-the-distributed-messaging-queue>System Design: The Distributed Messaging Queue</a></li><li><a href=https://www.geeksforgeeks.org/distributed-messaging-system-system-design/>Distributed Messaging System | System Design - GeeksforGeeks</a></li><li><a href=https://www.freecodecamp.org/news/message-queues-in-distributed-systesms/>How Message Queues Work in Distributed Systems</a></li><li><a href=https://www.tryexponent.com/blog/distributed-message-queue-system-design-mock-interview>Design a Distributed Message Queue: System Design Mock Interview - Exponent</a></li><li><a href=https://naina0405.substack.com/p/complete-system-design-101-distributed>Complete System Design 101 : Distributed Message Queues and 100+ System Design Case Studies</a></li><li><a href=https://dev.to/jayaprasanna_roddam/system-design-messaging-queues-and-event-driven-architecture-3994>System design: Messaging Queues and Event-Driven Architecture - DEV Community</a></li><li><a href=https://systemdesignschool.io/blog/message-queue>Understanding Message Queues: Enhancing Scalability and Reliability in Distributed Systems & Microservices Architecture</a></li><li><a href=https://serhatgiydiren.com/system-design-interview-distributed-message-queue/>System Design Interview – Distributed Message Queue – Serhat Giydiren</a></li><li><a href=https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern>Publish–subscribe pattern - Wikipedia</a></li><li><a href=https://aws.amazon.com/what-is/pub-sub-messaging/>What is Pub/Sub Messaging? - Pub/Sub Messaging Explained - AWS</a></li><li><a href=https://aws.amazon.com/compare/the-difference-between-rabbitmq-and-kafka/>RabbitMQ vs Kafka - Difference Between Message Queue Systems - AWS</a></li><li><a href=https://ably.com/topic/apache-kafka-vs-rabbitmq-vs-aws-sns-sqs>Apache Kafka vs RabbitMQ vs AWS SNS/SQS: Which message broker is best?</a></li></ul><p>네, 추가로 조사할 수 있는 중요한 내용들이 여러 가지 있습니다. 더 깊이 있는 분석을 위해 다음 영역들을 추가 조사해보겠습니다:네, 추가로 조사한 중요한 내용들이 있습니다! 현재 제공한 분석 외에 다음과 같은 심화 내용들을 추가로 조사했습니다:</p><h2 id=7-주제에-대한-추가-조사-내용>7. 주제에 대한 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#7-주제에-대한-추가-조사-내용>#</a></h2><h3 id=최신-기술-동향-및-차세대-메시징-시스템>최신 기술 동향 및 차세대 메시징 시스템<a hidden class=anchor aria-hidden=true href=#최신-기술-동향-및-차세대-메시징-시스템>#</a></h3><p><strong>1. Apache Pulsar - 차세대 클라우드 네이티브 메시징 플랫폼</strong></p><p>Apache Pulsar는 클라우드를 위해 구축된 오픈소스 분산 메시징 및 스트리밍 플랫폼입니다. 메시지는 개별적으로 소비되고 확인되거나 10ms 미만의 지연시간으로 스트림으로 소비될 수 있습니다.</p><p><strong>주요 특징</strong>:</p><ul><li><strong>멀티 테넌시</strong>: 조직 전체에 하나의 클러스터를 유지하며 테넌트를 사용하여 접근 제어</li><li><strong>지오 복제</strong>: 서로 다른 지역의 Pulsar 클러스터 간 유연하고 구성 가능한 복제 전략</li><li><strong>계층화된 저장소</strong>: Amazon S3와 같은 저렴한 저장소 솔루션으로 오래된 데이터를 오프로드하면서 최신 데이터는 접근 가능하게 유지</li></ul><p><strong>성능 우위</strong>: Pulsar는 Kafka에 비해 2.5배의 최대 처리량을 달성하며, 일관된 한 자리수 게시 지연시간을 제공하여 Kafka보다 100배 낮습니다.</p><p><strong>2. NATS - 경량 고성능 메시징</strong></p><p>NATS는 2011년에 클라우드 네이티브 애플리케이션, IoT 메시징, 마이크로서비스 아키텍처를 위한 경량 메시징 시스템으로 등장했습니다.</p><p><strong>특징</strong>:</p><ul><li><strong>초저지연</strong>: NATS는 최소 지연시간을 제공하여 실시간 애플리케이션에 이상적입니다</li><li><strong>주제 기반 모델</strong>: 메시지가 토픽 대신 주제(subject)로 분류되어 더 유연하고 동적인 메시지 라우팅을 가능하게 합니다</li><li><strong>경량 설계</strong>: 최소한의 리소스 소비와 복잡성으로 분산 환경에 최적화</li></ul><h3 id=고급-아키텍처-패턴>고급 아키텍처 패턴<a hidden class=anchor aria-hidden=true href=#고급-아키텍처-패턴>#</a></h3><p><strong>1. Transactional Outbox Pattern</strong></p><p>서비스 명령은 일반적으로 데이터베이스의 애그리게이트를 생성/업데이트/삭제하고 메시지 브로커에 메시지/이벤트를 보내야 합니다. 이 패턴은 분산 시스템에서 발생하는 이중 쓰기(dual write) 문제를 해결합니다.</p><p><strong>작동 원리</strong>:</p><ol><li>먼저 비즈니스 객체를 업데이트하는 트랜잭션의 일부로 메시지/이벤트를 데이터베이스 OUTBOX 테이블에 작성</li><li>별도의 Message Relay가 Outbox에서 메시지를 읽어 브로커로 전송</li><li>성공적인 전송 후 메시지 상태를 업데이트</li></ol><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Outbox Pattern 구현 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>db</span><span class=o>.</span><span class=n>transaction</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=c1># 1. 비즈니스 데이터 저장</span>
</span></span><span class=line><span class=cl>            <span class=n>order</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>save_order</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 2. Outbox에 이벤트 저장 (동일 트랜잭션)</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;aggregate_id&#39;</span><span class=p>:</span> <span class=n>order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;payload&#39;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>order_data</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;PENDING&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>outbox_repository</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>    <span class=c1># 별도 프로세스: Message Relay</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>publish_pending_events</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>pending_events</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>outbox_repository</span><span class=o>.</span><span class=n>find_pending</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>pending_events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>message_broker</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>outbox_repository</span><span class=o>.</span><span class=n>mark_published</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 재시도 로직</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>handle_publish_failure</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>2. Saga Pattern</strong></p><p>여러 서비스에 걸친 각 비즈니스 트랜잭션을 Saga로 구현합니다. Saga는 로컬 트랜잭션의 시퀀스입니다.</p><p><strong>Saga Orchestration 예시</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Saga Orchestrator&#34;
        SO[Saga Orchestrator]
    end
    
    subgraph &#34;Services&#34;
        OS[Order Service]
        PS[Payment Service]
        IS[Inventory Service]
        SS[Shipping Service]
    end
    
    SO --&gt;|1. Create Order| OS
    SO --&gt;|2. Process Payment| PS
    SO --&gt;|3. Reserve Inventory| IS
    SO --&gt;|4. Prepare Shipping| SS
    
    OS --&gt;|Order Created| SO
    PS --&gt;|Payment Failed| SO
    SO --&gt;|Compensate: Cancel Order| OS
</pre><p><strong>3. Inbox Pattern</strong></p><p>Inbox Pattern은 Outbox Pattern과 유사합니다. 들어오는 메시지(예: 큐에서)를 처리하는 데 사용됩니다.</p><h3 id=성능-벤치마킹-및-테스팅-전략>성능 벤치마킹 및 테스팅 전략<a hidden class=anchor aria-hidden=true href=#성능-벤치마킹-및-테스팅-전략>#</a></h3><p><strong>1. 메시징 큐 성능 비교</strong></p><p>우리의 평가는 두 가지 기본 성능 메트릭을 중심으로 합니다: 지연시간과 처리량. 지연시간은 메시지가 발신자에서 수신자로 이동하는 데 걸리는 시간을 측정하고, 처리량은 주어진 시간 내에 처리되는 메시지 수를 정량화합니다.</p><p><strong>벤치마크 결과</strong> (OpenMessaging Benchmark Framework 기준):</p><table><thead><tr><th>메시징 시스템</th><th>평균 지연시간</th><th>최대 처리량</th><th>특징</th></tr></thead><tbody><tr><td>Redis Pub/Sub</td><td>1.5ms 피크</td><td>높음</td><td>경량, 비영속적</td></tr><tr><td>NATS</td><td>1.2ms 피크</td><td>높음</td><td>초저지연, 경량</td></tr><tr><td>Apache Kafka</td><td>~10ms</td><td>매우 높음</td><td>고처리량, 영속성</td></tr><tr><td>RabbitMQ</td><td>5-15ms</td><td>보통</td><td>유연한 라우팅, 안정성</td></tr></tbody></table><p><strong>2. Chaos Engineering과 메시징 큐</strong></p><p>Chaos Engineering은 시스템의 복원력을 테스트하고 약점을 식별하기 위해 의도적으로 실패와 장애를 시스템에 도입하는 관행입니다.</p><p><strong>메시징 큐에 적용되는 Chaos 실험</strong>:</p><ul><li><strong>브로커 장애</strong>: 메시지 브로커 인스턴스 무작위 종료</li><li><strong>네트워크 파티션</strong>: 네트워크 연결 분리로 인한 영향 측정</li><li><strong>지연시간 주입</strong>: 네트워크 지연시간을 인위적으로 증가시켜 시스템이 느린 통신을 어떻게 처리하는지 확인</li><li><strong>리소스 압박</strong>: CPU나 메모리를 한계까지 밀어붙여 스트레스 상황에서의 동작 평가</li></ul><p><strong>Chaos Engineering 구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Gremlin을 사용한 Chaos 실험</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MessageQueueChaosTest</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_broker_failure_resilience</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 1. 정상 상태 확인</span>
</span></span><span class=line><span class=cl>        <span class=n>baseline_metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>collect_baseline_metrics</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 2. Chaos 실험 실행</span>
</span></span><span class=line><span class=cl>        <span class=n>chaos_experiment</span> <span class=o>=</span> <span class=n>GremlinClient</span><span class=p>()</span><span class=o>.</span><span class=n>create_experiment</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;target&#39;</span><span class=p>:</span> <span class=s1>&#39;kafka-broker-1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;attack&#39;</span><span class=p>:</span> <span class=s1>&#39;shutdown&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;duration&#39;</span><span class=p>:</span> <span class=mi>300</span>  <span class=c1># 5분간 셧다운</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 3. 시스템 동작 관찰</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>chaos_experiment</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>monitor_system_behavior</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=c1># 4. 복구 확인</span>
</span></span><span class=line><span class=cl>        <span class=n>recovery_metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>collect_recovery_metrics</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 5. 결과 분석</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>assert_minimal_impact</span><span class=p>(</span><span class=n>baseline_metrics</span><span class=p>,</span> <span class=n>metrics</span><span class=p>,</span> <span class=n>recovery_metrics</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=클라우드-네이티브-및-서버리스-통합>클라우드 네이티브 및 서버리스 통합<a hidden class=anchor aria-hidden=true href=#클라우드-네이티브-및-서버리스-통합>#</a></h3><p><strong>1. 서버리스 메시징</strong></p><p>Pulsar Functions를 사용하여 완전한 애플리케이션을 배포하지 않고도 Java, Go 또는 Python을 사용하여 메시지를 처리할 수 있습니다.</p><p><strong>2. Kubernetes 환경에서의 메시징</strong></p><ul><li><strong>Operator 패턴</strong>: Kafka, Pulsar 등의 운영 자동화</li><li><strong>서비스 메시</strong>: Istio, Linkerd와 메시징 큐 통합</li><li><strong>Auto Scaling</strong>: HPA (Horizontal Pod Autoscaler)와 연동</li></ul><h3 id=비용-최적화-및-운영-전략>비용 최적화 및 운영 전략<a hidden class=anchor aria-hidden=true href=#비용-최적화-및-운영-전략>#</a></h3><p><strong>1. 계층화된 저장소 전략</strong></p><p>오픈 테이블 형식인 Apache Iceberg와 Delta Lake에 데이터를 효율적으로 저장합니다.</p><p><strong>2. 멀티 클라우드 전략</strong></p><ul><li><strong>비용 최적화</strong>: Ursa의 리더리스 아키텍처로 비용을 95% 절감</li><li><strong>벤더 락인 방지</strong>: 클라우드 중립적 솔루션 선택</li></ul><h3 id=보안-및-규정-준수>보안 및 규정 준수<a hidden class=anchor aria-hidden=true href=#보안-및-규정-준수>#</a></h3><p><strong>1. 고급 보안 기능</strong></p><ul><li><strong>Zero Trust Architecture</strong>: 모든 메시지 검증</li><li><strong>End-to-End Encryption</strong>: 메시지 생성부터 소비까지 암호화</li><li><strong>RBAC (Role-Based Access Control)</strong>: 세밀한 권한 관리</li></ul><p><strong>2. 규정 준수</strong></p><ul><li><strong>GDPR</strong>: 개인정보 처리 추적성</li><li><strong>HIPAA</strong>: 의료 데이터 보안</li><li><strong>SOX</strong>: 금융 데이터 감사 로그</li></ul><h3 id=미래-기술-동향>미래 기술 동향<a hidden class=anchor aria-hidden=true href=#미래-기술-동향>#</a></h3><p><strong>1. AI/ML 통합</strong></p><ul><li><strong>지능형 라우팅</strong>: ML 기반 메시지 라우팅 최적화</li><li><strong>예측적 스케일링</strong>: 트래픽 패턴 학습을 통한 자동 확장</li><li><strong>이상 탐지</strong>: AI 기반 시스템 모니터링</li></ul><p><strong>2. Edge Computing 지원</strong></p><ul><li><strong>엣지 메시징</strong>: IoT 디바이스를 위한 경량 프로토콜</li><li><strong>Hybrid 아키텍처</strong>: 클라우드-엣지 간 원활한 메시지 흐름</li></ul><p>이러한 추가 내용들은 현대적인 메시징 큐 시스템을 설계하고 운영하는 데 필수적인 고급 개념들입니다. 특히 마이크로서비스 아키텍처, 클라우드 네이티브 환경, 그리고 대규모 분산 시스템에서 메시징 큐를 효과적으로 활용하기 위한 실용적인 지침을 제공합니다.</p><hr><h2 id=part1-기본-요약-및-구조-검토>Part 1: 기본 요약 및 구조 검토<a hidden class=anchor aria-hidden=true href=#part1-기본-요약-및-구조-검토>#</a></h2><h3 id=1-키워드-태그-topic-tags>1. 키워드 태그 (Topic Tags)<a hidden class=anchor aria-hidden=true href=#1-키워드-태그-topic-tags>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Messaging-Queue  
</span></span><span class=line><span class=cl>Message-Queuing  
</span></span><span class=line><span class=cl>Asynchronous-Communication  
</span></span><span class=line><span class=cl>Message-Oriented-Middleware
</span></span></code></pre></td></tr></table></div></div><h3 id=2-분류-구조-검토>2. 분류 구조 검토<a hidden class=anchor aria-hidden=true href=#2-분류-구조-검토>#</a></h3><p>현재 구조인</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Distributed Systems &gt; Message‑Oriented Systems &gt; Message Processing Systems
</span></span></code></pre></td></tr></table></div></div><p>는 타당합니다. “Messaging Queues”는 메시지 처리 시스템의 핵심 구성요소이므로, <strong>Message-Oriented Middleware</strong> 카테고리 하위에 “Messaging Queues”로 명확히 위치시키는 것이 적절합니다.</p><h3 id=3-200자-내외-요약>3. 200자 내외 요약<a hidden class=anchor aria-hidden=true href=#3-200자-내외-요약>#</a></h3><p>메시지 큐(Messaging Queue)는 비동기 방식의 생산자‑컨슈머 패턴을 통해 메시지를 중간 저장하고 전달하는 시스템입니다. 서비스 간 결합도를 낮추고, 비동기 처리, 부하 분산, 장애 격리를 가능하게 하며 일괄 처리 및 배경 작업에 널리 활용됩니다. 메시지 삭제 보장 및 재시도 로직으로 신뢰성 구축이 핵심입니다.</p><h3 id=4-전체-개요-250자-내외>4. 전체 개요 (250자 내외)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-250자-내외>#</a></h3><p>Messaging Queue 시스템은 분산 서비스 간 독립적 메시지 전달을 책임지는 미들웨어입니다. 생산자가 보내는 메시지를 큐에 저장하고, 소비자는 큐에서 읽어 처리함으로써 비동기 워크플로우를 구현합니다. 주요 기능으로는 메시지 큐잉, 전송 보장(at-least‑once 등), 오류 처리(DLQ), 순서 보장, 확장성 등이 포함됩니다. 실무에서는 RabbitMQ, AWS SQS, IBM MQ 등이 사용되며, 대용량 태스크 처리, 마이크로서비스 간 통신, 백엔드 워크로드 분산 등에 적용됩니다.</p><hr><h2 id=part2-핵심-개념-및-이론적-분석>Part 2: 핵심 개념 및 이론적 분석<a hidden class=anchor aria-hidden=true href=#part2-핵심-개념-및-이론적-분석>#</a></h2><h3 id=5-핵심-개념-1>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-1>#</a></h3><ul><li><strong>Message (메시지)</strong>: 데이터 페이로드 + 메타데이터(헤더, timestamp, priority 등) (<a href="https://blog.algomaster.io/p/message-queues?utm_source=chatgpt.com" title="What are Message Queues and When to Use Them?">blog.algomaster.io</a>)</li><li><strong>Producer / Publisher (생산자)</strong>: 메시지를 큐로 전송하는 서비스 (<a href="https://blog.algomaster.io/p/message-queues?utm_source=chatgpt.com" title="What are Message Queues and When to Use Them?">blog.algomaster.io</a>)</li><li><strong>Consumer / Subscriber (소비자)</strong>: 큐에서 메시지를 꺼내 처리하는 서비스 (<a href="https://blog.algomaster.io/p/message-queues?utm_source=chatgpt.com" title="What are Message Queues and When to Use Them?">blog.algomaster.io</a>)</li><li><strong>Queue (큐)</strong>: FIFO 또는 우선순위로 메시지를 저장하는 데이터 구조 (<a href="https://blog.algomaster.io/p/message-queues?utm_source=chatgpt.com" title="What are Message Queues and When to Use Them?">blog.algomaster.io</a>)</li><li><strong>Broker / Queue Manager (브로커)</strong>: 메시지를 저장, 전달, ACK/NACK, DLQ 처리 등을 담당하는 미들웨어 (<a href="https://blog.algomaster.io/p/message-queues?utm_source=chatgpt.com" title="What are Message Queues and When to Use Them?">blog.algomaster.io</a>)</li><li><strong>Delivery Semantics (전송 보장)</strong>: at-least-once, at-most-once, exactly-once 등 처리 보증 수준 (<a href="https://en.wikipedia.org/wiki/Message_queue?utm_source=chatgpt.com" title="Message queue">위키백과</a>, <a href="https://www.paubox.com/blog/what-is-message-queuing?utm_source=chatgpt.com" title="What is message queuing? - Paubox">paubox.com</a>)</li><li><strong>Dead‑Letter Queue (DLQ)</strong>: 처리 실패 메시지를 저장해 재시도 또는 분석에 활용하는 별도 큐 (<a href="https://www.paubox.com/blog/what-is-message-queuing?utm_source=chatgpt.com" title="What is message queuing? - Paubox">paubox.com</a>, <a href="https://en.wikipedia.org/wiki/Message_queue?utm_source=chatgpt.com" title="Message queue">위키백과</a>)</li><li><strong>Decoupling (느슨한 결합)</strong>: 서비스 간 직접 호출 없이 메시지 큐로 통신 처리 (<a href="https://www.paubox.com/blog/what-is-message-queuing?utm_source=chatgpt.com" title="What is message queuing? - Paubox">paubox.com</a>)</li><li><strong>Load Buffering & Spike Handling (부하 버퍼링)</strong>: 트래픽 급증 시 큐에 메시지를 잠시 보관해 시스템 안정 확보 (<a href="https://www.educative.io/blog/message-queues-system-design?utm_source=chatgpt.com" title="Messaging queues in System Design - Educative.io">educative.io</a>)</li></ul><h4 id=51-실무-구현-연관성>5.1 실무 구현 연관성<a hidden class=anchor aria-hidden=true href=#51-실무-구현-연관성>#</a></h4><p>이 개념들은 RabbitMQ, AWS SQS, IBM MQ 등에서 핵심적으로 구현되며, 큐 구성, ACK/NACK 설정, DLQ 정책, 메시지 포맷, 리트라이 로직 등을 설계할 때 직접 적용됩니다. 예: RabbitMQ의 Exchange‑Queue 바인딩 전략, SQS의 레드라인 정책 설정 등에서 적용됩니다 (<a href="https://www.cloudamqp.com/blog/rabbitmq-use-cases-explaining-message-queues-and-when-to-use-them.html?utm_source=chatgpt.com" title="RabbitMQ Use cases: Explaining message queues and when to use ...">CloudAMQP</a>, <a href="https://en.wikipedia.org/wiki/Amazon_Simple_Queue_Service?utm_source=chatgpt.com" title="Amazon Simple Queue Service">위키백과</a>).</p><hr><h2 id=part3-주요-기능-구조-구현-및-적용>Part 3: 주요 기능, 구조, 구현 및 적용<a hidden class=anchor aria-hidden=true href=#part3-주요-기능-구조-구현-및-적용>#</a></h2><h3 id=6-등장-및-발전-배경>6. 등장 및 발전 배경<a hidden class=anchor aria-hidden=true href=#6-등장-및-발전-배경>#</a></h3><ul><li>초기에는 UNIX SysV, POSIX API 수준에서 IPC 용도로 메시지 큐가 존재했고 (<a href="https://en.wikipedia.org/wiki/Message_queue?utm_source=chatgpt.com" title="Message queue">위키백과</a>),</li><li>이후 IBM QTAM, MSMQ, JMS, AMQP 프로토콜이 표준화됨 (<a href="https://redmonk.com/kholterhoff/2024/12/12/why-message-queues-endure-a-history/?utm_source=chatgpt.com" title="Why Message Queues Endure: A History – console.log() - RedMonk">RedMonk</a>),</li><li>현재는 RabbitMQ, ActiveMQ, AWS SQS 등 M queue 방식 미들웨어가 클라우드와 마이크로서비스 설계 핵심 인프라로 자리 잡았습니다.</li></ul><h3 id=7-목적-및-필요성-purpose--need>7. 목적 및 필요성 (Purpose & Need)<a hidden class=anchor aria-hidden=true href=#7-목적-및-필요성-purpose--need>#</a></h3><p>메시지 큐의 목적은 다음과 같습니다:</p><ul><li>비동기 처리로 응답 속도 최적화</li><li>서비스 간 느슨한 결합 구현</li><li>버퍼링을 통한 Spike (부하 급증) 관리</li><li>장애 시 재시도 가능성을 통한 결함 내성</li><li>워크플로우 이행 및 배경 작업 분리 처리</li></ul><p>이 필요성은 HTTP 요청 지연 방지, 확장성 확보, 장애 격리 및 업무 분업 구조 설계에서 드러납니다 (<a href="https://aws.amazon.com/message-queue/?utm_source=chatgpt.com" title="What is a Message Queue? - AWS">Amazon Web Services, Inc.</a>, <a href="https://www.paubox.com/blog/what-is-message-queuing?utm_source=chatgpt.com" title="What is message queuing? - Paubox">paubox.com</a>).</p><h3 id=8-주요-기능-및-역할>8. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#8-주요-기능-및-역할>#</a></h3><h4 id=기능-functions>기능 (Functions)<a hidden class=anchor aria-hidden=true href=#기능-functions>#</a></h4><ul><li>메시지 큐잉 및 페이로드 저장</li><li>메시지 조회/삭제(ACK 기반)</li><li>재시도/타임아웃 및 DLQ 처리</li><li>순서 보장 및 우선순위 처리</li></ul><h4 id=역할-roles>역할 (Roles)<a hidden class=anchor aria-hidden=true href=#역할-roles>#</a></h4><ul><li><strong>Producer</strong>: 메시지를 큐에 넣는 주체</li><li><strong>Broker</strong>: 메시지 저장, 라우팅, 오류 처리 책임</li><li><strong>Consumer</strong>: 메시지 읽기 및 처리, ACK/NACK 처리</li></ul><p>이 역할은 기능과 1:1 대응하며, 각각이 메시지 생명주기(Lifecycle)의 특정 단계에 책임을 가집니다.</p><h3 id=9-특징-characteristics>9. 특징 (Characteristics)<a hidden class=anchor aria-hidden=true href=#9-특징-characteristics>#</a></h3><ul><li><strong>비동기 처리</strong>: 생산자‑소비자 시간 분리</li><li><strong>버퍼링 및 부하 제어</strong>: Spike에 대한 안정성 제공</li><li><strong>순서 보장</strong>: FIFO 혹은 메시지 그룹 단위</li><li><strong>신뢰성 / 내구성</strong>: 디스크 영속 옵션, 재시도 로직, DLQ</li><li><strong>확장성</strong>: 병렬 소비자 추가로 처리량 확장</li></ul><p>이러한 특징들은 큐 기반 설계, ACK/NACK, DLQ, 클러스터링 등의 기능을 통해 달성됩니다.</p><h3 id=10-작동-원리-및-방식>10. 작동 원리 및 방식<a hidden class=anchor aria-hidden=true href=#10-작동-원리-및-방식>#</a></h3><pre class=mermaid>graph LR
Producer --&gt;|enqueue| Broker
Broker --&gt; Queue
Queue --&gt; Consumer
Consumer --&gt;|ack| Broker
Broker -- if fail --&gt; DLQ
</pre><ul><li><strong>enqueue</strong>: producer가 메시지를 큐에 저장</li><li><strong>consume + ack/nack</strong>: consumer가 메시지를 읽고 성공/실패 피드백</li><li>실패시 <strong>DLQ 전송</strong></li><li>순서 보장은 FIFO 구조 또는 메시지 그룹핑 전략</li></ul><h3 id=11-구조-및-아키텍처--구성-요소>11. 구조 및 아키텍처 / 구성 요소<a hidden class=anchor aria-hidden=true href=#11-구조-및-아키텍처--구성-요소>#</a></h3><h4 id=필수-구성-요소>필수 구성 요소<a hidden class=anchor aria-hidden=true href=#필수-구성-요소>#</a></h4><ul><li>Producer, Broker, Queue, Consumer, DLQ, persistence (디스크 또는 memory 큐), ACK/NACK 처리</li></ul><h4 id=선택-구성-요소>선택 구성 요소<a hidden class=anchor aria-hidden=true href=#선택-구성-요소>#</a></h4><ul><li>Priority queues, delayed queues, routing/exchange support (AMQP), message filtering</li></ul><pre class=mermaid>subgraph Broker
Queue
DLQ
end
Producer --&gt; Broker
Broker --&gt; Queue
Queue --&gt; Consumer
Broker --&gt; DLQ
</pre><hr><h2 id=part4-장점-단점-실무-적용-및-기타>Part 4: 장점, 단점, 실무 적용 및 기타<a hidden class=anchor aria-hidden=true href=#part4-장점-단점-실무-적용-및-기타>#</a></h2><h3 id=12-장점-advantages>12. 장점 (Advantages)<a hidden class=anchor aria-hidden=true href=#12-장점-advantages>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>느슨한 결합</td><td>Producer와 Consumer가 직접 의존하지 않음</td></tr><tr><td></td><td>부하 분산</td><td>큐를 통해 메시지 저장 및 소비자 확장 가능</td></tr><tr><td></td><td>장애 내성</td><td>실패 시 메시지는 DLQ 또는 큐에 남음</td></tr><tr><td></td><td>비동기 처리</td><td>사용자 응답과 무관하게 작업 처리</td></tr><tr><td></td><td>신뢰성 보장</td><td>ACK 기반 메시지 확실한 처리를 보장</td></tr></tbody></table><h3 id=13-단점-및-문제점-해결방안>13. 단점 및 문제점, 해결방안<a hidden class=anchor aria-hidden=true href=#13-단점-및-문제점-해결방안>#</a></h3><h4 id=단점-1>단점<a hidden class=anchor aria-hidden=true href=#단점-1>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>운영 복잡도</td><td>브로커 설치, 큐 설정, 모니터링 필요</td><td>관리 UI, 관리 자동화 도구 사용</td></tr><tr><td></td><td>지연 가능성</td><td>큐잉 또는 소비 지연으로 Latency 발생</td><td>메시지 TTL, consumer 수평 확장</td></tr><tr><td></td><td>순서 보장 어려움</td><td>병렬 소비자 또는 그룹핑 없이 순서 유지 곤란</td><td>메시지 그룹 또는 FIFO 전략 사용</td></tr><tr><td></td><td>중복 처리 리스크</td><td>at-least-once 방식에서 중복 가능</td><td>멱등성 처리 설계</td></tr></tbody></table><h4 id=문제점-1>문제점<a hidden class=anchor aria-hidden=true href=#문제점-1>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>문제점</td><td>메시지 손실</td><td>브로커 실패</td><td>데이터 유실</td><td>모니터링 및 DLQ 탐지</td><td>영속성 설정, replication</td><td>고가용 구성 적용</td></tr><tr><td>문제점</td><td>소비 지연</td><td>소비자 병목</td><td>시스템 지연</td><td>지표 모니터링</td><td>Consumer 수평 확장</td><td>자동 스케일링, consumer 증가</td></tr></tbody></table><h3 id=14-실무-사용-예시-1>14. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#14-실무-사용-예시-1>#</a></h3><table><thead><tr><th>사용 예시</th><th>목적</th><th>연계 시스템</th><th>효과</th></tr></thead><tbody><tr><td>이메일 전송</td><td>백그라운드 작업 분리</td><td>Web frontend → Email queue → Email sender</td><td>사용자 응답 빠르고 안정적 메일 전송</td></tr><tr><td>이미지 리사이징</td><td>대용량 이미지 처리 분리</td><td>Upload → MQ → Worker → S3</td><td>처리 지연 없이 이미지 최적화 작업 진행</td></tr><tr><td>주문 처리 파이프라인</td><td>비동기 주문, 결제, 재고 업데이트</td><td>Order service → Queue → Inventory, Billing services</td><td>마이크로서비스 간 결합 최소화, 재시도 가능</td></tr></tbody></table><h3 id=15-활용-사례-detailed>15. 활용 사례 (Detailed)<a hidden class=anchor aria-hidden=true href=#15-활용-사례-detailed>#</a></h3><h2 id=활용-사례-1>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례-1>#</a></h2><p><strong>시나리오</strong>:
이커머스 주문 후 이메일 알림, 재고 시스템 업데이트, 회계 처리 병렬화</p><p><strong>시스템 구성</strong>:</p><ul><li><p>Producer: Order API 서비스 → <code>order-queue</code></p></li><li><p>Consumer:</p><ul><li>Email Service (알림 메일 발송)</li><li>Inventory Service (재고 차감)</li><li>Accounting Service (회계 기록)</li></ul></li><li><p>Broker: RabbitMQ 관리자</p></li><li><p>DLQ: 실패 메시지 모니터링 및 자동 재처리</p></li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TD
OrderAPI --&gt;|push| RabbitMQ[Broker]
RabbitMQ --&gt; OrderQueue
OrderQueue --&gt; EmailService
OrderQueue --&gt; InventoryService
OrderQueue --&gt; AccountingService
RabbitMQ --&gt; DLQ
DLQ --&gt; MonitoringService
</pre><p><strong>Workflow</strong>:</p><ul><li>주문 발생 시 메시지 3개 생성 → 큐에 저장</li><li>개별 서비스들이 병렬로 메시지 소비</li><li>각 소비 성공 시 ACK, 실패 시 메시지 DLQ 전송</li></ul><p><strong>역할</strong>:</p><ul><li>OrderAPI = Producer</li><li>Email, Inventory, Accounting 서비스 = Consumers</li><li>RabbitMQ = Broker</li><li>DLQ = 오류 처리 및 운영 관찰 역할</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>메시지 큐 미사용 시: 동기 호출 → 높은 결합도, 장애 전파, 응답 지연</li><li>메시지 큐 사용 시: 비동기 메시징, 확장 독립성, 장애 격리 및 재처리 가능</li></ul><p><strong>구현 예시 (Python)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7>7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Producer: 메시지 세 가지 생성</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order-queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>msg</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;order_id&#39;</span><span class=p>:</span><span class=s1>&#39;123&#39;</span><span class=p>,</span><span class=s1>&#39;type&#39;</span><span class=p>:</span><span class=s1>&#39;email&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order-queue&#39;</span><span class=p>,</span> <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>msg</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1># 이후 inventory, accounting 타입의 메시지도 publish</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Consumer: Email Service</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>send_email</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order-queue&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=16-도전-과제-challenges>16. 도전 과제 (Challenges)<a hidden class=anchor aria-hidden=true href=#16-도전-과제-challenges>#</a></h3><table><thead><tr><th>카테고리</th><th>문제</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>신뢰성</td><td>Exactly-once 처리 어려움</td><td>중복 가능성, 브로커 한계</td><td>중복 처리 또는 누락</td><td>모니터링, 로그 분석</td><td>멱등성 설계, transactional broker</td><td>Kafka queue feature, idempotent consumers</td></tr><tr><td>확장성</td><td>스파이크 대응 한계</td><td>소비자 수 부족, 큐 과부하</td><td>지연, 메시지 누락</td><td>큐 길이 모니터링, 지연 추적</td><td>오토스케일링, DLQ 정책</td><td>k8s 기반 auto-scaling consumers</td></tr><tr><td>보안</td><td>메시지 무결성 및 인증 문제</td><td>인증 미설정, 암호화 부재</td><td>데이터 유출, 무단 접근</td><td>ACL 로그, TLS 상태 점검</td><td>TLS, 인증, ACL 구성</td><td>Broker 보안 설정 강화</td></tr></tbody></table><h3 id=17-분류-기준에-따른-종류-및-유형>17. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#17-분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>기준</th><th>유형</th><th>특징</th></tr></thead><tbody><tr><td>전송 모델</td><td>Queue-based vs Pub/Sub</td><td>단일 consumer 또는 다중 subscriber</td></tr><tr><td>배치 순서 보장</td><td>FIFO vs Priority queue</td><td>FIFO 순서 vs 우선순위 기반 처리</td></tr><tr><td>전송 보장 수준</td><td>At-least-once, At-most-once</td><td>중복 또는 누락 가능성 수준 설정</td></tr><tr><td>온프레미스 vs 클라우드</td><td>Self‑hosted vs Managed</td><td>예: RabbitMQ vs AWS SQS</td></tr><tr><td>프로토콜</td><td>AMQP, JMS, MQTT, HTTP</td><td>상호운용 및 경량 메시지 타입 차이</td></tr></tbody></table><h3 id=18-실무-적용-고려사항-및-주의점>18. 실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#18-실무-적용-고려사항-및-주의점>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>메시지 크기 제한</td><td>브로커 설정에 따라 payload 크기 제한 있음</td><td>Protobuf/Avro 사용, 메시지 압축</td></tr><tr><td>TTL 및 보존 정책</td><td>메시지 만료와 큐 크기 관리 필요</td><td>TTL 설정, DLQ 정책 설계</td></tr><tr><td>메시지 그룹 설계</td><td>순서 보장 필요 시 그룹핑 전략 설계 필요</td><td>동일 그룹 key 기반 routing</td></tr><tr><td>모니터링 도구 구성</td><td>지연, 큐 길이, 실패율을 실시간 확인</td><td>Prometheus + Grafana 구성</td></tr><tr><td>보안 설정</td><td>인증·접근제어 미흡 시 보안 취약</td><td>TLS + SASL + ACL 적용</td></tr></tbody></table><h3 id=19-최적화-고려사항-및-권장사항>19. 최적화 고려사항 및 권장사항<a hidden class=anchor aria-hidden=true href=#19-최적화-고려사항-및-권장사항>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>메시지 배치 사이즈</td><td>작은 배치: overhead 증가, 큰 배치: 지연 발생</td><td>테스트 기반 최적 batch size 설정</td></tr><tr><td>압축 사용</td><td>네트워크 대역폭 및 저장 공간 절감</td><td>Gzip, Snappy 압축 활성화</td></tr><tr><td>멀티 소비자 설정</td><td>과도한 소비자 수는 오히려 파티션 경쟁 유발 가능</td><td>균형있는 consumer scaling 구성</td></tr><tr><td>리소스 튜닝</td><td>메모리, I/O, 스레드 설정 부적절 시 병목 발생</td><td>브로커 설정 튜닝, JVM 옵션 조정</td></tr><tr><td>ACK 타이밍 관리</td><td>자동 커밋 vs 수동 커밋 선택에 따른 재처리 영향</td><td>수동 커밋 + 멱등 처리 패턴 권장</td></tr></tbody></table><hr><h2 id=용어-정리-5>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-5>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>기본</td><td>Producer, Consumer</td><td>메시지를 보내는 주체와 받는 주체</td></tr><tr><td>메시지 관리</td><td>Dead‑Letter Queue</td><td>실패 메시지를 별도 저장하여 분석/재처리 용이</td></tr><tr><td>전송 보장</td><td>At-least-once</td><td>메시지가 최소 한 번 이상 전달 보장</td></tr><tr><td>규약</td><td>AMQP</td><td>표준 메시지 큐 프로토콜 (RabbitMQ 등에서 사용) (<a href="https://blog.algomaster.io/p/message-queues?utm_source=chatgpt.com" title="What are Message Queues and When to Use Them?">blog.algomaster.io</a>, <a href="https://en.wikipedia.org/wiki/Apache_Kafka?utm_source=chatgpt.com" title="Apache Kafka">위키백과</a>, <a href="https://en.wikipedia.org/wiki/Message_queue?utm_source=chatgpt.com" title="Message queue">위키백과</a>, <a href="https://sharmarajdak.sh/blog/the-what-why-and-how-of-message-queues/?utm_source=chatgpt.com" title="The what, why, and how of Message Queues - Dakshraj Sharma">sharmarajdak.sh</a>, <a href="https://en.wikipedia.org/wiki/Amazon_Simple_Queue_Service?utm_source=chatgpt.com" title="Amazon Simple Queue Service">위키백과</a>)</td></tr></tbody></table><hr><h2 id=참고-및-출처-5>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-5>#</a></h2><ul><li>Message Queue 개념 및 사용 목적: IBM, AWS, Contrast Security 등 (<a href="https://www.contrastsecurity.com/security-influencers/what-is-a-message-queue-importance-use-cases-and-vulnerabilities-contrast-security?utm_source=chatgpt.com" title="What are message queues? When to use them? - Contrast Security">contrastsecurity.com</a>)</li><li>RabbitMQ 활용 사례: CloudAMQP 블로그 (이미지 처리, 마이크로서비스 간 연계 등) (<a href="https://www.cloudamqp.com/blog/rabbitmq-use-cases-explaining-message-queues-and-when-to-use-them.html?utm_source=chatgpt.com" title="RabbitMQ Use cases: Explaining message queues and when to use ...">CloudAMQP</a>)</li><li>Messaging queues 시스템 정의 및 역사: 위키피디아 및 RedMonk 블로그 (<a href="https://redmonk.com/kholterhoff/2024/12/12/why-message-queues-endure-a-history/?utm_source=chatgpt.com" title="Why Message Queues Endure: A History – console.log() - RedMonk">RedMonk</a>)</li></ul><hr><p>필요한 특정 항목(예: 플랫폼 비교 RabbitMQ vs Kafka 큐 기능, 코드 설정 예시, IAM 기반 접근 제어 예시 등)이 있다면 요청 주시면 그에 맞춰 정리해드리겠습니다.</p><p>계속 이어서 “Messaging Queues” 주제에 대한 심화 분석을 완료합니다. 이번에는 <strong>추가 조사 내용, 주의할 점 요약, 추가 학습 항목, 그리고 주목할 내용</strong> 중심으로 정리했습니다.</p><hr><h2 id=part-5-추가-조사-내용-및-주목할-점>Part 5: 추가 조사 내용 및 주목할 점<a hidden class=anchor aria-hidden=true href=#part-5-추가-조사-내용-및-주목할-점>#</a></h2><h3 id=617-주제와-관련한-추가-조사-내용>6‑17. 주제와 관련한 추가 조사 내용<a hidden class=anchor aria-hidden=true href=#617-주제와-관련한-추가-조사-내용>#</a></h3><p>다음 항목은 실무 적용 시 반드시 고려해야 할 추가 키워드입니다:</p><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>메시지 전달 모델 세분화</td><td>Message Queue(포인트-투-포인트)와 Pub/Sub, Event Streams 구별 [[turn0search10]]</td></tr><tr><td>처리 방식 선택 지침</td><td>Queue는 단일 소비자 처리, Pub/Sub는 브로드캐스트 목적 [[turn0search2]]</td></tr><tr><td>흐름 제어(Flow Control)</td><td>스파이크 시 큐 초과 방지를 위한 전략 필요 [[turn0search21]]</td></tr></tbody></table><hr><h3 id=9-주목할-내용>9. 주목할 내용<a hidden class=anchor aria-hidden=true href=#9-주목할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>패턴</td><td>메시지 전달 모델</td><td>Point-to-Point Queue vs Pub/Sub</td><td>큐는 1:1 처리, Pub/Sub은 다수 브로드캐스트 [[turn0search2]]</td></tr><tr><td>성능</td><td>Throughput 비교</td><td>Kafka vs RabbitMQ</td><td>Kafka는 높은 처리량, RabbitMQ는 낮은 latency에서 성능 우수 [[turn0search5]]</td></tr><tr><td>안정성</td><td>순서 보장 모델</td><td>FIFO 그룹, 파티션 단위 우선 순서 유지</td><td>SQS FIFO 그룹 순서, Kafka는 파티션 기반 순서 보장 [[turn0search21]]</td></tr><tr><td>시스템 설계</td><td>흐름 제어 필요성</td><td>큐 용량 초과 방지 메커니즘 필요</td><td>Gregor Hohpe 강조 [[turn0search21]]</td></tr></tbody></table><hr><h2 id=part-6-반드시-학습해야-할-내용>Part 6: 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#part-6-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>전달 모델</td><td>Pub/Sub vs Queue</td><td>전달 패턴 구조 이해</td><td>메시지 전파 방식과 소비자 관계 구별 [[turn0search2]]</td></tr><tr><td>표준 및 프로토콜</td><td>AMQP / MQTT / JMS</td><td>상호운용 및 메시징 표준</td><td>AMQP는 RabbitMQ, MQTT 경량, JMS Java 표준 [[turn0search18]]</td></tr><tr><td>성능 최적화</td><td>벤치마크 이해</td><td>대역폭 및 latency 특성 학습</td><td>Kafka는 초당 수십만 메시지, RabbitMQ는 낮은 로드에서 지연 적음 [[turn0search5]]</td></tr></tbody></table><hr><h2 id=part-7-용어-정리>Part 7: 용어 정리<a hidden class=anchor aria-hidden=true href=#part-7-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>전달 모델</td><td>Point-to-Point</td><td>하나의 소비자에게 메시지를 전송하는 모델</td></tr><tr><td>전달 모델</td><td>Pub/Sub</td><td>하나의 발행자에서 여러 구독자에게 메시지 복제 전달</td></tr><tr><td>표준 / 프로토콜</td><td>AMQP</td><td>RabbitMQ 등에서 사용하는 ISO 표준 메시지 큐 프로토콜 [[turn0search18]]</td></tr><tr><td>성능 비교</td><td>Throughput</td><td>처리량 기준: Kafka는 수십만 msg/s, RabbitMQ는 일부 상황에서 낮은 부하에서 저지연 [[turn0search5]]</td></tr></tbody></table><hr><h2 id=part-8-참고-및-출처>Part 8: 참고 및 출처<a hidden class=anchor aria-hidden=true href=#part-8-참고-및-출처>#</a></h2><ul><li>Message queue/queuing 개념 및 사용 목적과 효과에 대한 정의 및 예시 정리: [[turn0search18]]</li><li>Pub/Sub와 Queue 비교 및 선택 가이드: [[turn0search2]]</li><li>흐름 제어 및 큐 용량 관리 중요성: [[turn0search21]]</li><li>Kafka와 RabbitMQ의 처리량/지연 성능 차이 분석: [[turn0search5]]</li><li>FIFO 및 순서 보장 관련 서비스 모델: Amazon SQS FIFO 및 Azure Service Bus: [[turn0search21]]</li></ul><hr><p>계속 이어서 <strong>“Messaging Queues”</strong> 주제의 심화 내용을 <strong>최적화</strong>, <strong>흐름 제어</strong>, <strong>추가 학습 항목</strong>, <strong>주목할 내용</strong> 위주로 정리했습니다.</p><hr><h2 id=part-5-흐름-제어-및-최적화-고려사항>Part 5: 흐름 제어 및 최적화 고려사항<a hidden class=anchor aria-hidden=true href=#part-5-흐름-제어-및-최적화-고려사항>#</a></h2><h3 id=-흐름-제어flow-control--백프레셔-처리-backpressure>🔧 흐름 제어(Flow Control) & 백프레셔 처리 (Backpressure)<a hidden class=anchor aria-hidden=true href=#-흐름-제어flow-control--백프레셔-처리-backpressure>#</a></h3><ul><li>큐가 처리 가능한 메시지보다 많은 메시지를 수신할 경우 <strong>백프레셔</strong>가 필요하며, 이를 통해 생산자에게 메시지 전송률을 조절하도록 신호를 보냅니다 (<a href="https://blog.algomaster.io/p/message-queues?utm_source=chatgpt.com" title="What are Message Queues and When to Use Them?">blog.seancoughlin.me</a>).</li><li>Google Cloud Pub/Sub의 경우 클라이언트에 <strong>최대 메시지 수 및 바이트 수 제한</strong> 설정을 통해 스파이크를 제어할 수 있습니다 (<a href="https://en.wikipedia.org/wiki/Message_queue?utm_source=chatgpt.com" title="Message queue">Google Cloud</a>).</li></ul><h3 id=-최적화-고려사항>📈 최적화 고려사항<a hidden class=anchor aria-hidden=true href=#-최적화-고려사항>#</a></h3><ul><li><strong>큐 길이 제한 (Bounded Queues)</strong> 설정과 <strong>TTL (Time-To-Live)</strong> 정책을 적절히 활용해 오래된 메시지가 시스템을 지연시키는 것을 방지합니다 (<a href="https://www.paubox.com/blog/what-is-message-queuing?utm_source=chatgpt.com" title="What is message queuing? - Paubox">Medium</a>).</li><li>메시지 배치 처리, 압축, consumer 수평 확장 등을 통해 성능과 안정성을 균형 있게 유지합니다 (<a href="https://blog.algomaster.io/p/message-queues?utm_source=chatgpt.com" title="What are Message Queues and When to Use Them?">blog.seancoughlin.me</a>, <a href="https://www.educative.io/blog/message-queues-system-design?utm_source=chatgpt.com" title="Messaging queues in System Design - Educative.io">blog.algomaster.io</a>).</li></ul><hr><h2 id=part-6-플랫폼-성능-비교-및-주목-항목>Part 6: 플랫폼 성능 비교 및 주목 항목<a hidden class=anchor aria-hidden=true href=#part-6-플랫폼-성능-비교-및-주목-항목>#</a></h2><h3 id=-kafka-vs-rabbitmq-주요-차이-비교>📊 Kafka vs RabbitMQ 주요 차이 비교<a hidden class=anchor aria-hidden=true href=#-kafka-vs-rabbitmq-주요-차이-비교>#</a></h3><table><thead><tr><th>항목</th><th>Kafka</th><th>RabbitMQ</th></tr></thead><tbody><tr><td>처리량</td><td>수백만 msg/s (단일 서버에서도 최대 100k~1M msg/s) (<a href="https://www.cloudamqp.com/blog/rabbitmq-use-cases-explaining-message-queues-and-when-to-use-them.html?utm_source=chatgpt.com" title="RabbitMQ Use cases: Explaining message queues and when to use ...">openlogic.com</a>)</td><td>일반적으로 수천~수만 msg/s; 고성능 위해 클러스터 필요 (<a href="https://en.wikipedia.org/wiki/Amazon_Simple_Queue_Service?utm_source=chatgpt.com" title="Amazon Simple Queue Service">Amazon Web Services, Inc.</a>, <a href="https://www.cloudamqp.com/blog/rabbitmq-use-cases-explaining-message-queues-and-when-to-use-them.html?utm_source=chatgpt.com" title="RabbitMQ Use cases: Explaining message queues and when to use ...">openlogic.com</a>, <a href="https://redmonk.com/kholterhoff/2024/12/12/why-message-queues-endure-a-history/?utm_source=chatgpt.com" title="Why Message Queues Endure: A History – console.log() - RedMonk">Upsolver</a>)</td></tr><tr><td>지연 (Latency)</td><td>고처리량 환경에서도 평균 낮음, fsync 설정 시 P99.9까지 낮음 (<a href="https://aws.amazon.com/message-queue/?utm_source=chatgpt.com" title="What is a Message Queue? - AWS">Confluent</a>, <a href="https://en.wikipedia.org/wiki/Apache_Kafka?utm_source=chatgpt.com" title="Apache Kafka">statsig.com</a>)</td><td>낮은 부하에서는 낮은 지연, 고부하 시 지연 증가 가능성 있음 (<a href="https://en.wikipedia.org/wiki/Amazon_Simple_Queue_Service?utm_source=chatgpt.com" title="Amazon Simple Queue Service">Amazon Web Services, Inc.</a>, <a href="https://sharmarajdak.sh/blog/the-what-why-and-how-of-message-queues/?utm_source=chatgpt.com" title="The what, why, and how of Message Queues - Dakshraj Sharma">Stack Overflow</a>)</td></tr><tr><td>확장성</td><td>수평 확장 우수, 대규모 장애 격리 가능 (<a href="https://www.contrastsecurity.com/security-influencers/what-is-a-message-queue-importance-use-cases-and-vulnerabilities-contrast-security?utm_source=chatgpt.com" title="What are message queues? When to use them? - Contrast Security">Quix</a>, <a href="https://en.wikipedia.org/wiki/Apache_Kafka?utm_source=chatgpt.com" title="Apache Kafka">statsig.com</a>)</td><td>수평 확장 가능하지만 Kafka보다는 복잡 (<a href="https://en.wikipedia.org/wiki/RabbitMQ?utm_source=chatgpt.com" title=RabbitMQ>위키백과</a>, <a href="https://sharmarajdak.sh/blog/the-what-why-and-how-of-message-queues/?utm_source=chatgpt.com" title="The what, why, and how of Message Queues - Dakshraj Sharma">Stack Overflow</a>)</td></tr></tbody></table><h3 id=-주목할-항목-정리>🔦 주목할 항목 정리<a hidden class=anchor aria-hidden=true href=#-주목할-항목-정리>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>설명</th></tr></thead><tbody><tr><td>성능</td><td>처리량 (Throughput)</td><td>Kafka는 매우 높은 처리량 제공, RabbitMQ는 수천~수만 수준 (<a href="https://aws.amazon.com/message-queue/?utm_source=chatgpt.com" title="What is a Message Queue? - AWS">Confluent</a>)</td></tr><tr><td>안정성</td><td>백프레셔 & TTL</td><td>래싱 spike 방지, 메시지 만료로 큐 오버플로우 통제 (<a href="https://www.enterpriseintegrationpatterns.com/ramblings/queues_flow_control.html?utm_source=chatgpt.com" title="Queues invert control flow but require flow control">Enterprise Integration Patterns</a>, <a href="https://en.wikipedia.org/wiki/Message_queue?utm_source=chatgpt.com" title="Message queue">Google Cloud</a>)</td></tr><tr><td>시스템 패턴</td><td>전송 모델</td><td>Point-to-Point Queue vs Pub/Sub 구조 차이점 (<a href="https://www.contrastsecurity.com/security-influencers/what-is-a-message-queue-importance-use-cases-and-vulnerabilities-contrast-security?utm_source=chatgpt.com" title="What are message queues? When to use them? - Contrast Security">Quix</a>, <a href="https://www.educative.io/blog/message-queues-system-design?utm_source=chatgpt.com" title="Messaging queues in System Design - Educative.io">blog.algomaster.io</a>)</td></tr></tbody></table><hr><h2 id=part-7-추가-학습해야-할-주제>Part 7: 추가 학습해야 할 주제<a hidden class=anchor aria-hidden=true href=#part-7-추가-학습해야-할-주제>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>전달 모델</td><td>Queue vs Pub/Sub</td><td>맞춤형 사용 방식</td><td>메시지 전달 방식 차이와 설계 선택 이유 이해 (<a href="https://fastercapital.com/topics/best-practices-for-message-queuing-in-enterprise-integration.html?utm_source=chatgpt.com" title="Best Practices For Message Queuing In Enterprise Integration">FasterCapital</a>)</td></tr><tr><td>프로토콜/표준</td><td>AMQP, MQTT, JMS</td><td>상호운용성</td><td>다양한 메시지 브로커 프로토콜 이해 필요 (<a href="https://fastercapital.com/topics/best-practices-for-message-queuing-in-enterprise-integration.html?utm_source=chatgpt.com" title="Best Practices For Message Queuing In Enterprise Integration">FasterCapital</a>, <a href="https://en.wikipedia.org/wiki/RabbitMQ?utm_source=chatgpt.com" title=RabbitMQ>위키백과</a>)</td></tr><tr><td>최적화</td><td>벤치마킹 및 튜닝</td><td>throughput, latency</td><td>구조적 성능 개선 전략 및 테스트 필요 (<a href="https://aws.amazon.com/message-queue/?utm_source=chatgpt.com" title="What is a Message Queue? - AWS">Confluent</a>, <a href="https://blog.algomaster.io/p/message-queues?utm_source=chatgpt.com" title="What are Message Queues and When to Use Them?">blog.seancoughlin.me</a>)</td></tr><tr><td>운영 안정성</td><td>Ack, DLQ, retry</td><td>오류 처리 전략</td><td>중복, 손실, 소비 실패 대응 전략 필수 (<a href="https://www.educative.io/blog/message-queues-system-design?utm_source=chatgpt.com" title="Messaging queues in System Design - Educative.io">blog.algomaster.io</a>, <a href="https://fastercapital.com/topics/best-practices-for-message-queuing-in-enterprise-integration.html?utm_source=chatgpt.com" title="Best Practices For Message Queuing In Enterprise Integration">FasterCapital</a>)</td></tr></tbody></table><hr><h2 id=part-8-요약-및-권고사항>Part 8: 요약 및 권고사항<a hidden class=anchor aria-hidden=true href=#part-8-요약-및-권고사항>#</a></h2><ul><li>메시지 큐는 비동기 통신, 부하 분산, 장애 격리 등을 위한 강력한 인프라입니다.</li><li>고처리량이 필요한 환경에선 Kafka, 복잡한 라우팅과 낮은 지연에선 RabbitMQ가 적합합니다.</li><li><strong>백프레셔</strong>, <strong>큐 제한</strong>, <strong>TTL 정책</strong>, <strong>IDEMPOTENCY 구현</strong>, <strong>DLQ 전략</strong> 등은 운영 품질을 좌우하는 핵심 요소입니다.</li><li>실제 도입 시에는 벤치마크, 모니터링, 보안 설정, 흐름 제어 전략 등 실무 수준의 대응이 필요합니다.</li></ul><p>필요하신 특정 예시(예: SQS FIFO TTL 설정, RabbitMQ 흐름 제어 코드, Kafka Consumer backpressure 설정 등)에 대해서도 깊이 있는 설명을 드릴 수 있으니 요청 주시면 바로 설계해 드리겠습니다!</p><p>다음은 &ldquo;Messaging Queues&rdquo; 주제의 심화를 위한 마지막 정리입니다. 핵심은 **흐름 제어(Backpressure)**와 <strong>최적화</strong>, 비교 대비, 추가 학습해야 할 항목들입니다.</p><hr><h2 id=-흐름-제어backpressure-핵심-전략>✅ 흐름 제어(Backpressure) 핵심 전략<a hidden class=anchor aria-hidden=true href=#-흐름-제어backpressure-핵심-전략>#</a></h2><ul><li><p><strong>Backpressure</strong>는 생산자보다 소비자가 느릴 때 생기는 메시지 누적을 제어하는 메커니즘입니다. 소비자의 처리 속도에 맞추어 생산 속도를 조절하여 시스템 과부하를 방지합니다 (<a href="https://blog.algomaster.io/p/message-queues?utm_source=chatgpt.com" title="What are Message Queues and When to Use Them?">Enterprise Integration Patterns</a>, <a href="https://en.wikipedia.org/wiki/Message_queue?utm_source=chatgpt.com" title="Message queue">DEV Community</a>).</p></li><li><p>주요 기법:</p><ul><li><strong>Flow control</strong>: 큐 크기를 모니터링하여 생산 속도 조절 (윈도우링, 토큰 버킷 방식 등) (<a href="https://www.paubox.com/blog/what-is-message-queuing?utm_source=chatgpt.com" title="What is message queuing? - Paubox">akashrajpurohit.com</a>).</li><li><strong>Rate limiting & Circuit breaker</strong>: 과도한 요청을 거절하거나 제한하여 시스템 안정성 유지 (<a href="https://www.educative.io/blog/message-queues-system-design?utm_source=chatgpt.com" title="Messaging queues in System Design - Educative.io">Medium</a>).</li><li><strong>Buffering</strong>: 큐에 임시 저장 후 처리하되, 용량 초과 시 TTL 또는 Tail Drop 적용 (<a href="https://www.cloudamqp.com/blog/rabbitmq-use-cases-explaining-message-queues-and-when-to-use-them.html?utm_source=chatgpt.com" title="RabbitMQ Use cases: Explaining message queues and when to use ...">GitHub</a>).</li><li><strong>Scale-out</strong>: 소비자 수평 확장을 통해 병목 해소 (<a href="https://en.wikipedia.org/wiki/Amazon_Simple_Queue_Service?utm_source=chatgpt.com" title="Amazon Simple Queue Service">Confluent</a>).</li><li><strong>Backoff 전략</strong>: 실패 시 재시도 간격을 점진적으로 늘려 소비자 부담을 완화.</li></ul></li></ul><hr><h2 id=-플랫폼-성능-비교-요약>📈 플랫폼 성능 비교 요약<a hidden class=anchor aria-hidden=true href=#-플랫폼-성능-비교-요약>#</a></h2><p>Kafka와 RabbitMQ의 비교는 다음과 같습니다:</p><table><thead><tr><th>항목</th><th><strong>Kafka</strong></th><th><strong>RabbitMQ</strong></th></tr></thead><tbody><tr><td>처리량</td><td>수백만 msg/s 빠르게 처리, RabbitMQ 대비 15배 이상 빠름 (<a href="https://en.wikipedia.org/wiki/Amazon_Simple_Queue_Service?utm_source=chatgpt.com" title="Amazon Simple Queue Service">Confluent</a>)</td><td>일반적으로 4K–10K msg/s, 수십만 msg/s 가능하지만 많은 리소스 필요 (<a href="https://www.cloudamqp.com/blog/rabbitmq-use-cases-explaining-message-queues-and-when-to-use-them.html?utm_source=chatgpt.com" title="RabbitMQ Use cases: Explaining message queues and when to use ...">GitHub</a>, <a href="https://redmonk.com/kholterhoff/2024/12/12/why-message-queues-endure-a-history/?utm_source=chatgpt.com" title="Why Message Queues Endure: A History – console.log() - RedMonk">openlogic.com</a>, <a href="https://aws.amazon.com/message-queue/?utm_source=chatgpt.com" title="What is a Message Queue? - AWS">Upsolver</a>)</td></tr><tr><td>지연</td><td>고처리량 환경에서도 낮은 지연 유지 가능 (<a href="https://www.cloudamqp.com/blog/rabbitmq-use-cases-explaining-message-queues-and-when-to-use-them.html?utm_source=chatgpt.com" title="RabbitMQ Use cases: Explaining message queues and when to use ...">GitHub</a>, <a href="https://en.wikipedia.org/wiki/Amazon_Simple_Queue_Service?utm_source=chatgpt.com" title="Amazon Simple Queue Service">Confluent</a>)</td><td>낮은 부하에서 낮은 지연, 부하 증가 시 지연 급증 (<a href="https://www.cloudamqp.com/blog/rabbitmq-use-cases-explaining-message-queues-and-when-to-use-them.html?utm_source=chatgpt.com" title="RabbitMQ Use cases: Explaining message queues and when to use ...">GitHub</a>, <a href="https://en.wikipedia.org/wiki/Apache_Kafka?utm_source=chatgpt.com" title="Apache Kafka">Amazon Web Services, Inc.</a>)</td></tr><tr><td>확장성</td><td>수평 확장 용이, 파티셔닝과 클러스터링 기반 확장성 우수 (<a href="https://sharmarajdak.sh/blog/the-what-why-and-how-of-message-queues/?utm_source=chatgpt.com" title="The what, why, and how of Message Queues - Dakshraj Sharma">Quix</a>, <a href="https://www.contrastsecurity.com/security-influencers/what-is-a-message-queue-importance-use-cases-and-vulnerabilities-contrast-security?utm_source=chatgpt.com" title="What are message queues? When to use them? - Contrast Security">ProjectPro</a>)</td><td>수평 확장 가능하나 복잡하고 한계가 있음 (<a href="https://sharmarajdak.sh/blog/the-what-why-and-how-of-message-queues/?utm_source=chatgpt.com" title="The what, why, and how of Message Queues - Dakshraj Sharma">Quix</a>, <a href="https://en.wikipedia.org/wiki/RabbitMQ?utm_source=chatgpt.com" title=RabbitMQ>위키백과</a>)</td></tr><tr><td>내구성 및 복제</td><td>내장된 복제 구조, KRaft 기반 안정적 구성 지원 (<a href="https://www.enterpriseintegrationpatterns.com/ramblings/queues_flow_control.html?utm_source=chatgpt.com" title="Queues invert control flow but require flow control">위키백과</a>, <a href="https://sharmarajdak.sh/blog/the-what-why-and-how-of-message-queues/?utm_source=chatgpt.com" title="The what, why, and how of Message Queues - Dakshraj Sharma">Quix</a>)</td><td>미러 큐 등 복제 지원하지만 성능 저하 발생할 수 있음 (<a href="https://www.cloudamqp.com/blog/rabbitmq-use-cases-explaining-message-queues-and-when-to-use-them.html?utm_source=chatgpt.com" title="RabbitMQ Use cases: Explaining message queues and when to use ...">GitHub</a>, <a href="https://en.wikipedia.org/wiki/RabbitMQ?utm_source=chatgpt.com" title=RabbitMQ>위키백과</a>)</td></tr></tbody></table><p>✅ Kafka는 대량 데이터 처리, 이벤트 스트리밍, 내구성 기반 메시지 처리에 적합하며, RabbitMQ는 복잡한 라우팅 및 낮은 지연을 요구하는 워크플로우에 적합합니다.</p><hr><h2 id=-주목할-추가-내용-정리>🔍 주목할 추가 내용 정리<a hidden class=anchor aria-hidden=true href=#-주목할-추가-내용-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>설명</th></tr></thead><tbody><tr><td>흐름 제어</td><td>Backpressure 모델</td><td>큐 크기 또는 서버 처리 상태 기반 생산 속도 제어 | 소비자 주도형 호출 방식 추천 (<a href="https://sharmarajdak.sh/blog/the-what-why-and-how-of-message-queues/?utm_source=chatgpt.com" title="The what, why, and how of Message Queues - Dakshraj Sharma">Quix</a>)</td></tr><tr><td>성능</td><td>처리량 비교</td><td>Kafka는 수백만 msg/s 처리, RabbitMQ는 리소스에 따라 성능 차이 큼 (<a href="https://en.wikipedia.org/wiki/Amazon_Simple_Queue_Service?utm_source=chatgpt.com" title="Amazon Simple Queue Service">Confluent</a>, <a href="https://www.cloudamqp.com/blog/rabbitmq-use-cases-explaining-message-queues-and-when-to-use-them.html?utm_source=chatgpt.com" title="RabbitMQ Use cases: Explaining message queues and when to use ...">GitHub</a>)</td></tr><tr><td>시스템 패턴</td><td>Queue vs Pub/Sub</td><td>단일 소비 - Point-to-Point, 다수 소비 - Pub/Sub 구조에 따라 설계 선택 (<a href="https://fastercapital.com/topics/best-practices-for-message-queuing-in-enterprise-integration.html?utm_source=chatgpt.com" title="Best Practices For Message Queuing In Enterprise Integration">Clear Measure</a>, <a href="https://sharmarajdak.sh/blog/the-what-why-and-how-of-message-queues/?utm_source=chatgpt.com" title="The what, why, and how of Message Queues - Dakshraj Sharma">Quix</a>)</td></tr></tbody></table><hr><h2 id=-추가-학습해야-할-주제>🎯 추가 학습해야 할 주제<a hidden class=anchor aria-hidden=true href=#-추가-학습해야-할-주제>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>전달 모델</td><td>Queue vs Pub/Sub</td><td>전달 구조 설계 이론</td><td>소비자 수, 라우팅 패턴에 따라 구조 선택 기준 이해 필요 (<a href="https://fastercapital.com/topics/best-practices-for-message-queuing-in-enterprise-integration.html?utm_source=chatgpt.com" title="Best Practices For Message Queuing In Enterprise Integration">Clear Measure</a>)</td></tr><tr><td>표준/프로토콜</td><td>AMQP, MQTT, JMS</td><td>프로토콜 이해 및 상호운용성</td><td>다양한 브로커에서 지원되는 메시징 표준 학습 (<a href="https://redmonk.com/kholterhoff/2024/12/12/why-message-queues-endure-a-history/?utm_source=chatgpt.com" title="Why Message Queues Endure: A History – console.log() - RedMonk">openlogic.com</a>, <a href="https://en.wikipedia.org/wiki/RabbitMQ?utm_source=chatgpt.com" title=RabbitMQ>위키백과</a>)</td></tr><tr><td>최적화</td><td>벤치마킹 & 튜닝</td><td>throughput, latency 최적화 전략</td><td>클러스터 구성, 배치, 압축, I/O 설정 등 분석 필요 (<a href="https://en.wikipedia.org/wiki/Amazon_Simple_Queue_Service?utm_source=chatgpt.com" title="Amazon Simple Queue Service">Confluent</a>, <a href="https://www.contrastsecurity.com/security-influencers/what-is-a-message-queue-importance-use-cases-and-vulnerabilities-contrast-security?utm_source=chatgpt.com" title="What are message queues? When to use them? - Contrast Security">ProjectPro</a>)</td></tr><tr><td>오류 처리</td><td>ACK/NACK, DLQ, Retry 전략</td><td>재시도 로직, 중복 처리 제어</td><td>신뢰성 유지 전략 및 운영 자동화 방안 설계 중요</td></tr></tbody></table><hr><h2 id=-요약-및-마무리>✅ 요약 및 마무리<a hidden class=anchor aria-hidden=true href=#-요약-및-마무리>#</a></h2><ul><li><strong>Backpressure 기법</strong>, 즉 생산자 속도 제어와 큐 용량 관리 전략은 메시지 큐 운영 안정성을 결정합니다.</li><li><strong>Kafka</strong>는 대규모 처리 및 낮은 비용 대비 높은 처리량 면에서 우수하며, <strong>RabbitMQ</strong>는 복잡 라우팅 및 단순 워크큐 처리에 적합합니다.</li><li><strong>모니터링, TTL 정책, 메시지 압축, 파티셔닝, 멱등성 구현</strong> 등은 실무 적용 시 반드시 고려되어야 합니다.</li><li>구체적 사용 사례나 코드, 설정 예시(예: RabbitMQ 흐름 제어 코드, Kafka consumer backpressure 설정, AWS SQS 사용 시 TTL 정책 등)가 필요하시면 언제든 요청 주시면 준비해 드리겠습니다!</li></ul><p>알겠습니다. 이번에는 <strong>메시지 큐(Messaging Queues)</strong> 주제의 내용을 마무리 정리하며, 남은 주요 항목들을 심화해 정리해드립니다.</p><hr><h2 id=part9기타-사항--메시지-큐와-연계되는-중요한-개념들>Part 9: “기타 사항” – 메시지 큐와 연계되는 중요한 개념들<a hidden class=anchor aria-hidden=true href=#part9기타-사항--메시지-큐와-연계되는-중요한-개념들>#</a></h2><ul><li><strong>스키마 관리</strong>: 메시지 포맷을 Avro 또는 Protobuf 형식으로 관리하고, Schema Registry를 통해 호환성 유지 전략을 설계해야 합니다.</li><li><strong>모니터링 및 트레이싱</strong>: Kafka Connect Metric, RabbitMQ Management UI, Prometheus + Grafana, OpenTelemetry 기반 트레이싱을 통해 메시지 흐름, 소비 지연, 오류 상태 등을 실시간 파악할 수 있어야 합니다.</li><li><strong>정책 및 거버넌스</strong>: GDPR, PCI, DLP 등 법적 요구사항에 따라 메시지 암호화, 접근 제어, 감사 로그 등도 큐 구성 시 반드시 고려되어야 합니다.</li><li><strong>멀티 테넌시 설계</strong>: 다중 고객이나 테넌트 환경에서는 메시지 격리, 네임스페이스 관리, ACL, 리소스 쿼터 제한 등을 설계해야 안전합니다.</li></ul><hr><h2 id=part10-종합적인-요약-및-향후-적용-방향>Part 10: 종합적인 요약 및 향후 적용 방향<a hidden class=anchor aria-hidden=true href=#part10-종합적인-요약-및-향후-적용-방향>#</a></h2><h3 id=-요약>🔍 요약<a hidden class=anchor aria-hidden=true href=#-요약>#</a></h3><p>메시지 큐(Messaging Queue)는 비동기 메시지 전달을 위한 핵심 인프라로서, <strong>생산자-브로커-소비자</strong> 모델 기반으로 구성됩니다. 핵심 기능으로는 <strong>메시지 저장</strong>, <strong>순서 보장</strong>, <strong>전송 보장</strong>, <strong>오류 처리</strong> 등이 있으며, <strong>비동기 처리</strong>, <strong>부하 완화</strong>, <strong>장애 격리</strong>, <strong>확장성</strong> 확보가 주목적입니다.</p><p>RabbitMQ는 라우팅 유연성과 낮은 지연을 제공하는 큐 기반 시스템에 적합하며, Kafka는 고처리량/내구성/파티셔닝 특성이 강점인 로그 기반 시스템입니다. AWS SQS는 관리형 큐로 운영 복잡도를 줄이고 빠르게 적용 가능한 옵션입니다.</p><p>핵심 운영 전략에는 <strong>Backpressure 처리</strong>, <strong>큐 길이 및 TTL 정책</strong>, <strong>DLQ 기반 오류 처리</strong>, <strong>모니터링</strong>, <strong>보안 설정</strong>, <strong>스키마 관리</strong>, <strong>벤치마킹 기반 튜닝</strong>이 포함됩니다.</p><hr><h3 id=-향후-적용-방향-제안>🚀 향후 적용 방향 제안<a hidden class=anchor aria-hidden=true href=#-향후-적용-방향-제안>#</a></h3><p>원하시는 경우 아래 주제들을 중심으로 더 심화된 설계와 코드 샘플, 아키텍처 설계 등을 제공해 드릴 수 있습니다:</p><table><thead><tr><th>제안 주제</th><th>설명</th></tr></thead><tbody><tr><td>RabbitMQ 흐름 제어 코드</td><td>소비자 처리 속도 기반 동적 윈도우링 예시 등</td></tr><tr><td>Kafka consumer backpressure 설정</td><td>fetch size, poll interval, pause() API 등 예시</td></tr><tr><td>AWS SQS FIFO 설정 및 TTL 예시</td><td>FIFO 그룹, DelayQueue 설정, Visibility Timeout 조정</td></tr><tr><td>Schema Registry 구성 및 버전 관리 예시</td><td>Avro 기반 메시지 버전 호환 설계</td></tr><tr><td>보안 구성 예시</td><td>TLS, SASL, ACL, IAM 정책 설정 예시</td></tr><tr><td>트레이싱 & 모니터링 구성</td><td>OpenTelemetry + Prometheus + Grafana 구성 예시</td></tr></tbody></table><p>원하는 주제를 말씀해주시면 코드 샘플과 설정 예시, 다이어그램 포함하여 설계해 드립니다.</p><hr><h2 id=part11-용어-정리>Part 11: 용어 정리<a hidden class=anchor aria-hidden=true href=#part11-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>운영 전략</td><td>Backpressure</td><td>생산자 속도를 소비자 처리량에 맞추는 흐름 제어 메커니즘</td></tr><tr><td>운영 전략</td><td>TTL (Time-To-Live)</td><td>큐에 남아 있는 메시지의 최대 보존 시간</td></tr><tr><td>표준/프로토콜</td><td>AMQP</td><td>RabbitMQ 등에서 사용하는 메시지 큐 표준 프로토콜</td></tr><tr><td>메시지 포맷</td><td>Schema Registry</td><td>Avro/Protobuf 기반 메시지 스키마 관리 시스템</td></tr><tr><td>오류 처리</td><td>Dead‑Letter Queue (DLQ)</td><td>실패 메시지를 별도로 보관해 재처리 또는 분석에 활용하는 큐</td></tr><tr><td>메시지 보장</td><td>Delivery Semantics</td><td>at-least-once, at-most-once, exactly-once 전송 보증 방식</td></tr><tr><td>패턴 설계</td><td>Point-to-Point / Pub/Sub</td><td>1:1 메시징 vs 1:다수 구독자 메시징 구조</td></tr></tbody></table><hr><h2 id=part12-참고-및-출처>Part 12: 참고 및 출처<a hidden class=anchor aria-hidden=true href=#part12-참고-및-출처>#</a></h2><ul><li>메시지 큐 및 Backpressure 기법: Enterprise Integration Patterns 블로그</li><li>Queue vs Pub/Sub 전달 모델 비교: ClearMeasure, Quix 블로그</li><li>Kafka vs RabbitMQ 성능 벤치마크: Confluent 및 OpenLogic 분석</li><li>AMQP, TTL, DLQ, Schema Registry, 모니터링 사례: 각 브로커 공식 문서 및 커뮤니티 블로그</li></ul><hr><p>이로써 “Messaging Queues” 주제의 전반적인 분석이 완성되었습니다. 특정 적용 사례나 코드 예시, 플랫폼 구성 등이 필요하시면 언제든지 요청해주세요!</p><hr><p>메시징 큐는 현대 시스템 아키텍처에서 핵심적인 통합 패턴으로, 특히 분산 시스템과 마이크로서비스 환경에서 중요한 역할을 한다. 이는 시스템 간의 느슨한 결합, 확장성, 복원력, 비동기 통신 등 다양한 이점을 제공하기 때문이다.</p><p>특히 API 통합 측면에서 메시징 큐는 다음과 같은 중요한 역할을 한다:</p><ol><li><strong>트래픽 관리</strong>: API 게이트웨이와 메시징 큐를 결합하여 급증하는 트래픽을 효과적으로 관리할 수 있다.</li><li><strong>서비스 격리</strong>: 서비스 간 직접적인 의존성을 제거하여 한 서비스의 장애가 전체 시스템에 미치는 영향을 최소화한다.</li><li><strong>비동기 통신</strong>: 즉각적인 응답이 필요 없는 작업을 비동기적으로 처리하여 API 응답 시간을 개선한다.</li><li><strong>데이터 통합</strong>: 여러 시스템 간의 데이터 흐름을 조정하고 일관성을 유지한다.</li><li><strong>이벤트 기반 아키텍처</strong>: 이벤트 생성, 전파, 소비를 지원하여 이벤트 기반 시스템의 기반이 된다.</li></ol><p>메시징 큐를 효과적으로 활용하기 위해서는 메시지 설계, 큐 구조, 오류 처리, 확장성, 모니터링 등 다양한 측면에서 신중한 계획과 구현이 필요하다. 또한 비즈니스 요구사항과 기술적 제약을 고려하여 적절한 메시징 기술을 선택하는 것이 중요하다.</p><p>최신 클라우드 네이티브 환경에서는 Kafka, RabbitMQ, Amazon SQS/SNS, Google Pub/Sub 등 다양한 메시징 솔루션을 활용할 수 있으며, 각각의 솔루션은 특정 사용 사례와 요구사항에 더 적합하다. 각 조직의 상황에 맞는 메시징 큐 전략을 수립하고 구현하는 것이 성공적인 API 통합의 핵심 요소이다.</p><p>결론적으로, 메시징 큐는 단순한 통신 메커니즘 이상의 의미를 가진다. 이는 확장 가능하고, 유연하며, 복원력 있는 시스템 아키텍처를 구축하기 위한 전략적 도구이다. API 통합 패턴으로서 메시징 큐를 이해하고 활용함으로써, 조직은 더 강력하고 미래 지향적인 시스템을 구축할 수 있다.</p><h3 id=메시징-큐의-기본-개념>메시징 큐의 기본 개념<a hidden class=anchor aria-hidden=true href=#메시징-큐의-기본-개념>#</a></h3><p>메시징 큐는 비동기 통신을 가능하게 하는 중간 저장소로, 메시지 생산자(Producer)와 소비자(Consumer) 사이에서 데이터를 버퍼링하는 역할을 한다. 이는 마치 우체통과 같이 작동한다 - 발신자가 메시지를 보내면 우체통(큐)에 저장되고, 수신자는 자신의 속도와 능력에 맞춰 메시지를 가져가 처리한다.</p><p>메시징 큐의 핵심 기능은 다음과 같다:</p><ol><li><strong>비동기 통신</strong>: 생산자와 소비자가 동시에 활성화될 필요가 없음</li><li><strong>버퍼링</strong>: 일시적인 부하 증가나 소비자 장애 시 메시지 보존</li><li><strong>분리(Decoupling)</strong>: 시스템 구성 요소 간의 직접적인 의존성 제거</li><li><strong>부하 분산</strong>: 여러 소비자 간에 작업 분배 가능</li></ol><h3 id=메시징-큐의-주요-구성-요소>메시징 큐의 주요 구성 요소<a hidden class=anchor aria-hidden=true href=#메시징-큐의-주요-구성-요소>#</a></h3><h4 id=메시지message>메시지(Message)<a hidden class=anchor aria-hidden=true href=#메시지message>#</a></h4><p>메시징 시스템의 기본 단위로, 일반적으로 다음 요소로 구성된다:</p><ul><li><strong>헤더(Header)</strong>: 메타데이터(메시지 ID, 타임스탬프, 우선순위 등)</li><li><strong>본문(Body)</strong>: 실제 전송되는 데이터(JSON, XML, 바이너리 등)</li><li><strong>속성(Properties)</strong>: 라우팅 키, 만료 시간 등의 추가 정보</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17>17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18>18</a>
</span><span class=lnt id=hl-22-19><a class=lnlinks href=#hl-22-19>19</a>
</span><span class=lnt id=hl-22-20><a class=lnlinks href=#hl-22-20>20</a>
</span><span class=lnt id=hl-22-21><a class=lnlinks href=#hl-22-21>21</a>
</span><span class=lnt id=hl-22-22><a class=lnlinks href=#hl-22-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=c1>// 메시지 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;header&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;messageId&#34;</span><span class=p>:</span> <span class=s2>&#34;msg-123456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-03-23T10:15:30Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;priority&#34;</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;orderId&#34;</span><span class=p>:</span> <span class=s2>&#34;ORD-9876&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;customerId&#34;</span><span class=p>:</span> <span class=s2>&#34;CUST-5432&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nt>&#34;productId&#34;</span><span class=p>:</span> <span class=s2>&#34;PROD-001&#34;</span><span class=p>,</span> <span class=nt>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nt>&#34;productId&#34;</span><span class=p>:</span> <span class=s2>&#34;PROD-015&#34;</span><span class=p>,</span> <span class=nt>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;totalAmount&#34;</span><span class=p>:</span> <span class=mf>79.98</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;routingKey&#34;</span><span class=p>:</span> <span class=s2>&#34;orders.new&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;contentType&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;expirationTime&#34;</span><span class=p>:</span> <span class=mi>86400</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=큐queue>큐(Queue)<a hidden class=anchor aria-hidden=true href=#큐queue>#</a></h4><p>메시지가 저장되는 데이터 구조로, 일반적으로 FIFO(First-In-First-Out) 방식을 따른다.</p><p>큐의 특성은 다음과 같다:</p><ul><li><strong>내구성(Durability)</strong>: 시스템 재시작 후에도 메시지 보존 여부</li><li><strong>배타성(Exclusivity)</strong>: 단일 소비자만 접근 가능 여부</li><li><strong>자동 삭제(Auto-delete)</strong>: 모든 소비자 연결 해제 시 자동 삭제 여부</li></ul><h4 id=익스체인지exchange>익스체인지(Exchange)<a hidden class=anchor aria-hidden=true href=#익스체인지exchange>#</a></h4><p>일부 메시징 시스템(RabbitMQ 등)에서 사용되는 개념으로, 생산자로부터 메시지를 받아 라우팅 규칙에 따라 적절한 큐로 전달한다.</p><p>주요 타입은 다음과 같다:</p><ul><li><strong>다이렉트(Direct)</strong>: 정확한 라우팅 키 매칭</li><li><strong>토픽(Topic)</strong>: 패턴 기반 라우팅</li><li><strong>팬아웃(Fanout)</strong>: 모든 바인딩된 큐에 브로드캐스트</li><li><strong>헤더(Headers)</strong>: 헤더 속성 기반 라우팅</li></ul><h4 id=생산자producer>생산자(Producer)<a hidden class=anchor aria-hidden=true href=#생산자producer>#</a></h4><p>메시지를 생성하고 메시징 시스템에 전송하는 애플리케이션이다.</p><p>생산자의 주요 책임은 다음과 같다:</p><ul><li>메시지 형식 정의 및 생성</li><li>적절한 라우팅 정보 제공</li><li>필요시 전송 확인 처리</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17>17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18>18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19>19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20>20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21>21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22>22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23>23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24>24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25>25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26>26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27>27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28>28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29>29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30>30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31>31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32>32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33>33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RabbitMQ를 사용한 메시지 생산자 예시 (Python)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 큐 선언</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 생성</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;orderId&#39;</span><span class=p>:</span> <span class=s1>&#39;ORD-9876&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;customerId&#39;</span><span class=p>:</span> <span class=s1>&#39;CUST-5432&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s1>&#39;productId&#39;</span><span class=p>:</span> <span class=s1>&#39;PROD-001&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s1>&#39;productId&#39;</span><span class=p>:</span> <span class=s1>&#39;PROD-015&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;totalAmount&#39;</span><span class=p>:</span> <span class=mf>79.98</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 발행</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>properties</span><span class=o>=</span><span class=n>pika</span><span class=o>.</span><span class=n>BasicProperties</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>delivery_mode</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>  <span class=c1># 메시지 지속성 보장</span>
</span></span><span class=line><span class=cl>        <span class=n>content_type</span><span class=o>=</span><span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 메시지 발행: </span><span class=si>{</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;orderId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=소비자consumer>소비자(Consumer)<a hidden class=anchor aria-hidden=true href=#소비자consumer>#</a></h4><p>큐에서 메시지를 수신하고 처리하는 애플리케이션이다.</p><p>소비자의 주요 책임은 다음과 같다:</p><ul><li>메시지 수신 및 처리</li><li>처리 성공/실패 확인(Acknowledgment)</li><li>오류 처리 및 재시도 전략 구현</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29>29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30>30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31>31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32>32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33>33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34>34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RabbitMQ를 사용한 메시지 소비자 예시 (Python)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 큐 선언 (생산자와 동일한 큐)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 한 번에 하나의 메시지만 처리하도록 설정</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 메시지 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 중: </span><span class=si>{</span><span class=n>order</span><span class=p>[</span><span class=s1>&#39;orderId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 실제 비즈니스 로직 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>process_order</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 처리 완료 확인</span>
</span></span><span class=line><span class=cl>    <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 완료: </span><span class=si>{</span><span class=n>order</span><span class=p>[</span><span class=s1>&#39;orderId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_order</span><span class=p>(</span><span class=n>order</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 주문 처리 로직 구현</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 소비 시작</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_processing&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;주문 처리 서비스 실행 중... Ctrl+C로 종료&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=api-통합을-위한-메시징-큐-패턴>API 통합을 위한 메시징 큐 패턴<a hidden class=anchor aria-hidden=true href=#api-통합을-위한-메시징-큐-패턴>#</a></h3><h4 id=작업-큐work-queue-패턴>작업 큐(Work Queue) 패턴<a hidden class=anchor aria-hidden=true href=#작업-큐work-queue-패턴>#</a></h4><p>시간이 많이 소요되거나 리소스 집약적인 작업을 비동기적으로 처리하기 위한 패턴이다. API 요청을 즉시 처리하는 대신 큐에 작업을 추가하고 응답을 빠르게 반환한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37>37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38>38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39>39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40>40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41>41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42>42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43>43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44>44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45>45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46>46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47>47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48>48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49>49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50>50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51>51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52>52</a>
</span><span class=lnt id=hl-25-53><a class=lnlinks href=#hl-25-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js Express API 엔드포인트 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// RabbitMQ 연결
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>connectQueue</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>connection</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;amqp://localhost&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>channel</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;image_processing&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>connectQueue</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이미지 처리 API 엔드포인트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/api/images/process&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>imageUrl</span><span class=p>,</span> <span class=nx>filters</span><span class=p>,</span> <span class=nx>userId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 작업 ID 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>jobId</span> <span class=o>=</span> <span class=nx>generateJobId</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 작업을 큐에 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>channel</span><span class=p>.</span><span class=nx>sendToQueue</span><span class=p>(</span><span class=s1>&#39;image_processing&#39;</span><span class=p>,</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>imageUrl</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>filters</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>})),</span> <span class=p>{</span> <span class=nx>persistent</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 작업 ID와 상태 반환
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>202</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;processing&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>statusUrl</span><span class=o>:</span> <span class=sb>`/api/jobs/</span><span class=si>${</span><span class=nx>jobId</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 작업 상태 확인 API 엔드포인트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/api/jobs/:jobId&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>jobId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 작업 상태 조회 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>jobStatus</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>getJobStatus</span><span class=p>(</span><span class=nx>jobId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>jobStatus</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mi>3000</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;API 서버가 포트 3000에서 실행 중입니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=게시-구독pub-sub-패턴>게시-구독(Pub-Sub) 패턴<a hidden class=anchor aria-hidden=true href=#게시-구독pub-sub-패턴>#</a></h4><p>하나의 메시지를 여러 소비자에게 전달하는 패턴으로, 이벤트 기반 아키텍처의 기반이 된다. 이벤트가 발생하면 관심 있는 모든 서비스가 알림을 받을 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15>15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16>16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17>17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18>18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19>19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20>20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21>21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22>22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23>23</a>
</span><span class=lnt id=hl-26-24><a class=lnlinks href=#hl-26-24>24</a>
</span><span class=lnt id=hl-26-25><a class=lnlinks href=#hl-26-25>25</a>
</span><span class=lnt id=hl-26-26><a class=lnlinks href=#hl-26-26>26</a>
</span><span class=lnt id=hl-26-27><a class=lnlinks href=#hl-26-27>27</a>
</span><span class=lnt id=hl-26-28><a class=lnlinks href=#hl-26-28>28</a>
</span><span class=lnt id=hl-26-29><a class=lnlinks href=#hl-26-29>29</a>
</span><span class=lnt id=hl-26-30><a class=lnlinks href=#hl-26-30>30</a>
</span><span class=lnt id=hl-26-31><a class=lnlinks href=#hl-26-31>31</a>
</span><span class=lnt id=hl-26-32><a class=lnlinks href=#hl-26-32>32</a>
</span><span class=lnt id=hl-26-33><a class=lnlinks href=#hl-26-33>33</a>
</span><span class=lnt id=hl-26-34><a class=lnlinks href=#hl-26-34>34</a>
</span><span class=lnt id=hl-26-35><a class=lnlinks href=#hl-26-35>35</a>
</span><span class=lnt id=hl-26-36><a class=lnlinks href=#hl-26-36>36</a>
</span><span class=lnt id=hl-26-37><a class=lnlinks href=#hl-26-37>37</a>
</span><span class=lnt id=hl-26-38><a class=lnlinks href=#hl-26-38>38</a>
</span><span class=lnt id=hl-26-39><a class=lnlinks href=#hl-26-39>39</a>
</span><span class=lnt id=hl-26-40><a class=lnlinks href=#hl-26-40>40</a>
</span><span class=lnt id=hl-26-41><a class=lnlinks href=#hl-26-41>41</a>
</span><span class=lnt id=hl-26-42><a class=lnlinks href=#hl-26-42>42</a>
</span><span class=lnt id=hl-26-43><a class=lnlinks href=#hl-26-43>43</a>
</span><span class=lnt id=hl-26-44><a class=lnlinks href=#hl-26-44>44</a>
</span><span class=lnt id=hl-26-45><a class=lnlinks href=#hl-26-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// C# 이벤트 발행 서비스 예시</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderService</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IMessageBroker</span> <span class=n>_messageBroker</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IOrderRepository</span> <span class=n>_orderRepository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>OrderService</span><span class=p>(</span><span class=n>IMessageBroker</span> <span class=n>messageBroker</span><span class=p>,</span> <span class=n>IOrderRepository</span> <span class=n>orderRepository</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_messageBroker</span> <span class=p>=</span> <span class=n>messageBroker</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_orderRepository</span> <span class=p>=</span> <span class=n>orderRepository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=n>Order</span><span class=p>&gt;</span> <span class=n>CreateOrderAsync</span><span class=p>(</span><span class=n>OrderRequest</span> <span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 생성 및 저장</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>order</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Order</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Id</span> <span class=p>=</span> <span class=n>Guid</span><span class=p>.</span><span class=n>NewGuid</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>CustomerId</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>CustomerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Items</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>Items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>TotalAmount</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>Items</span><span class=p>.</span><span class=n>Sum</span><span class=p>(</span><span class=n>i</span> <span class=p>=&gt;</span> <span class=n>i</span><span class=p>.</span><span class=n>Price</span> <span class=p>*</span> <span class=n>i</span><span class=p>.</span><span class=n>Quantity</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>Status</span> <span class=p>=</span> <span class=n>OrderStatus</span><span class=p>.</span><span class=n>Created</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>CreatedAt</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>UtcNow</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>_orderRepository</span><span class=p>.</span><span class=n>SaveAsync</span><span class=p>(</span><span class=n>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 생성 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>_messageBroker</span><span class=p>.</span><span class=n>PublishAsync</span><span class=p>(</span><span class=s>&#34;orders.created&#34;</span><span class=p>,</span> <span class=k>new</span> <span class=n>OrderCreatedEvent</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderId</span> <span class=p>=</span> <span class=n>order</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>CustomerId</span> <span class=p>=</span> <span class=n>order</span><span class=p>.</span><span class=n>CustomerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>TotalAmount</span> <span class=p>=</span> <span class=n>order</span><span class=p>.</span><span class=n>TotalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Items</span> <span class=p>=</span> <span class=n>order</span><span class=p>.</span><span class=n>Items</span><span class=p>.</span><span class=n>Select</span><span class=p>(</span><span class=n>i</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=n>OrderItemEvent</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>ProductId</span> <span class=p>=</span> <span class=n>i</span><span class=p>.</span><span class=n>ProductId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>Quantity</span> <span class=p>=</span> <span class=n>i</span><span class=p>.</span><span class=n>Quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>Price</span> <span class=p>=</span> <span class=n>i</span><span class=p>.</span><span class=n>Price</span>
</span></span><span class=line><span class=cl>            <span class=p>}).</span><span class=n>ToList</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>CreatedAt</span> <span class=p>=</span> <span class=n>order</span><span class=p>.</span><span class=n>CreatedAt</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=요청-응답request-reply-패턴>요청-응답(Request-Reply) 패턴<a hidden class=anchor aria-hidden=true href=#요청-응답request-reply-패턴>#</a></h4><p>비동기적인 요청-응답 상호작용을 구현하는 패턴으로, 응답 큐와 상관관계 ID를 사용하여 응답을 추적한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17>17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18>18</a>
</span><span class=lnt id=hl-27-19><a class=lnlinks href=#hl-27-19>19</a>
</span><span class=lnt id=hl-27-20><a class=lnlinks href=#hl-27-20>20</a>
</span><span class=lnt id=hl-27-21><a class=lnlinks href=#hl-27-21>21</a>
</span><span class=lnt id=hl-27-22><a class=lnlinks href=#hl-27-22>22</a>
</span><span class=lnt id=hl-27-23><a class=lnlinks href=#hl-27-23>23</a>
</span><span class=lnt id=hl-27-24><a class=lnlinks href=#hl-27-24>24</a>
</span><span class=lnt id=hl-27-25><a class=lnlinks href=#hl-27-25>25</a>
</span><span class=lnt id=hl-27-26><a class=lnlinks href=#hl-27-26>26</a>
</span><span class=lnt id=hl-27-27><a class=lnlinks href=#hl-27-27>27</a>
</span><span class=lnt id=hl-27-28><a class=lnlinks href=#hl-27-28>28</a>
</span><span class=lnt id=hl-27-29><a class=lnlinks href=#hl-27-29>29</a>
</span><span class=lnt id=hl-27-30><a class=lnlinks href=#hl-27-30>30</a>
</span><span class=lnt id=hl-27-31><a class=lnlinks href=#hl-27-31>31</a>
</span><span class=lnt id=hl-27-32><a class=lnlinks href=#hl-27-32>32</a>
</span><span class=lnt id=hl-27-33><a class=lnlinks href=#hl-27-33>33</a>
</span><span class=lnt id=hl-27-34><a class=lnlinks href=#hl-27-34>34</a>
</span><span class=lnt id=hl-27-35><a class=lnlinks href=#hl-27-35>35</a>
</span><span class=lnt id=hl-27-36><a class=lnlinks href=#hl-27-36>36</a>
</span><span class=lnt id=hl-27-37><a class=lnlinks href=#hl-27-37>37</a>
</span><span class=lnt id=hl-27-38><a class=lnlinks href=#hl-27-38>38</a>
</span><span class=lnt id=hl-27-39><a class=lnlinks href=#hl-27-39>39</a>
</span><span class=lnt id=hl-27-40><a class=lnlinks href=#hl-27-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java Spring Boot 요청-응답 패턴 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ProductService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>requestQueue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;product.info.request&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>replyQueue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;product.info.reply&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ProductService</span><span class=p>(</span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>rabbitTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>ProductInfo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getProductInfo</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>productId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>ProductInfo</span><span class=o>&gt;</span><span class=w> </span><span class=n>future</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>correlationId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 응답을 수신할 콜백 등록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>requestQueue</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>ProductInfoRequest</span><span class=p>(</span><span class=n>productId</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>message</span><span class=p>.</span><span class=na>getMessageProperties</span><span class=p>().</span><span class=na>setReplyTo</span><span class=p>(</span><span class=n>replyQueue</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>message</span><span class=p>.</span><span class=na>getMessageProperties</span><span class=p>().</span><span class=na>setCorrelationId</span><span class=p>(</span><span class=n>correlationId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비동기 응답 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>receive</span><span class=p>(</span><span class=n>replyQueue</span><span class=p>,</span><span class=w> </span><span class=n>30000</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>correlationId</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=na>getMessageProperties</span><span class=p>().</span><span class=na>getCorrelationId</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ProductInfo</span><span class=w> </span><span class=n>productInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ProductInfo</span><span class=p>)</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>getMessageConverter</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>fromMessage</span><span class=p>(</span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>future</span><span class=p>.</span><span class=na>complete</span><span class=p>(</span><span class=n>productInfo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>future</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=경쟁-소비자competing-consumers-패턴>경쟁 소비자(Competing Consumers) 패턴<a hidden class=anchor aria-hidden=true href=#경쟁-소비자competing-consumers-패턴>#</a></h4><p>여러 소비자가 동일한 큐에서 메시지를 처리하여 부하를 분산하는 패턴이다. 메시지 처리량을 높이고 시스템의 확장성을 개선한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18>18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19>19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20>20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21>21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22>22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23>23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24>24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25>25</a>
</span><span class=lnt id=hl-28-26><a class=lnlinks href=#hl-28-26>26</a>
</span><span class=lnt id=hl-28-27><a class=lnlinks href=#hl-28-27>27</a>
</span><span class=lnt id=hl-28-28><a class=lnlinks href=#hl-28-28>28</a>
</span><span class=lnt id=hl-28-29><a class=lnlinks href=#hl-28-29>29</a>
</span><span class=lnt id=hl-28-30><a class=lnlinks href=#hl-28-30>30</a>
</span><span class=lnt id=hl-28-31><a class=lnlinks href=#hl-28-31>31</a>
</span><span class=lnt id=hl-28-32><a class=lnlinks href=#hl-28-32>32</a>
</span><span class=lnt id=hl-28-33><a class=lnlinks href=#hl-28-33>33</a>
</span><span class=lnt id=hl-28-34><a class=lnlinks href=#hl-28-34>34</a>
</span><span class=lnt id=hl-28-35><a class=lnlinks href=#hl-28-35>35</a>
</span><span class=lnt id=hl-28-36><a class=lnlinks href=#hl-28-36>36</a>
</span><span class=lnt id=hl-28-37><a class=lnlinks href=#hl-28-37>37</a>
</span><span class=lnt id=hl-28-38><a class=lnlinks href=#hl-28-38>38</a>
</span><span class=lnt id=hl-28-39><a class=lnlinks href=#hl-28-39>39</a>
</span><span class=lnt id=hl-28-40><a class=lnlinks href=#hl-28-40>40</a>
</span><span class=lnt id=hl-28-41><a class=lnlinks href=#hl-28-41>41</a>
</span><span class=lnt id=hl-28-42><a class=lnlinks href=#hl-28-42>42</a>
</span><span class=lnt id=hl-28-43><a class=lnlinks href=#hl-28-43>43</a>
</span><span class=lnt id=hl-28-44><a class=lnlinks href=#hl-28-44>44</a>
</span><span class=lnt id=hl-28-45><a class=lnlinks href=#hl-28-45>45</a>
</span><span class=lnt id=hl-28-46><a class=lnlinks href=#hl-28-46>46</a>
</span><span class=lnt id=hl-28-47><a class=lnlinks href=#hl-28-47>47</a>
</span><span class=lnt id=hl-28-48><a class=lnlinks href=#hl-28-48>48</a>
</span><span class=lnt id=hl-28-49><a class=lnlinks href=#hl-28-49>49</a>
</span><span class=lnt id=hl-28-50><a class=lnlinks href=#hl-28-50>50</a>
</span><span class=lnt id=hl-28-51><a class=lnlinks href=#hl-28-51>51</a>
</span><span class=lnt id=hl-28-52><a class=lnlinks href=#hl-28-52>52</a>
</span><span class=lnt id=hl-28-53><a class=lnlinks href=#hl-28-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python FastAPI 경쟁 소비자 패턴 예시 (Celery 사용)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>BackgroundTasks</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>celery</span> <span class=kn>import</span> <span class=n>Celery</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Celery 설정</span>
</span></span><span class=line><span class=cl><span class=n>celery_app</span> <span class=o>=</span> <span class=n>Celery</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;tasks&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>broker</span><span class=o>=</span><span class=s1>&#39;redis://localhost:6379/0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>backend</span><span class=o>=</span><span class=s1>&#39;redis://localhost:6379/0&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 데이터 처리 작업 정의</span>
</span></span><span class=line><span class=cl><span class=nd>@celery_app.task</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_data_chunk</span><span class=p>(</span><span class=n>chunk_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Chunk </span><span class=si>{</span><span class=n>chunk_id</span><span class=si>}</span><span class=s2> 처리 시작: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=si>}</span><span class=s2> 항목&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제 데이터 처리 로직</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 데이터 처리 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>[</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;value&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>2</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Chunk </span><span class=si>{</span><span class=n>chunk_id</span><span class=si>}</span><span class=s2> 처리 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/api/data/process&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>process_large_dataset</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>],</span> <span class=n>background_tasks</span><span class=p>:</span> <span class=n>BackgroundTasks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 대용량 데이터를 청크로 분할</span>
</span></span><span class=line><span class=cl>    <span class=n>chunk_size</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>    <span class=n>data_chunks</span> <span class=o>=</span> <span class=p>[</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>chunk_size</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=n>chunk_size</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 각 청크를 별도 작업으로 큐에 추가</span>
</span></span><span class=line><span class=cl>    <span class=n>task_ids</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>chunk</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>data_chunks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>task</span> <span class=o>=</span> <span class=n>process_data_chunk</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>chunk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>task_ids</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>task</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=si>}</span><span class=s2> 항목이 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>data_chunks</span><span class=p>)</span><span class=si>}</span><span class=s2> 청크로 처리 중입니다.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;task_ids&#34;</span><span class=p>:</span> <span class=n>task_ids</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;status_url&#34;</span><span class=p>:</span> <span class=s2>&#34;/api/tasks/status&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/api/tasks/status&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_tasks_status</span><span class=p>(</span><span class=n>task_ids</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>task_id</span> <span class=ow>in</span> <span class=n>task_ids</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>task</span> <span class=o>=</span> <span class=n>celery_app</span><span class=o>.</span><span class=n>AsyncResult</span><span class=p>(</span><span class=n>task_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=n>task_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=n>task</span><span class=o>.</span><span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;result&#34;</span><span class=p>:</span> <span class=n>task</span><span class=o>.</span><span class=n>result</span> <span class=k>if</span> <span class=n>task</span><span class=o>.</span><span class=n>ready</span><span class=p>()</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐의-고급-기능과-패턴>메시징 큐의 고급 기능과 패턴<a hidden class=anchor aria-hidden=true href=#메시징-큐의-고급-기능과-패턴>#</a></h3><h4 id=메시지-우선순위priority>메시지 우선순위(Priority)<a hidden class=anchor aria-hidden=true href=#메시지-우선순위priority>#</a></h4><p>중요도에 따라 메시지 처리 순서를 조정하는 기능이다. 긴급한 메시지가 먼저 처리되도록 한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13>13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14>14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15>15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16>16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17>17</a>
</span><span class=lnt id=hl-29-18><a class=lnlinks href=#hl-29-18>18</a>
</span><span class=lnt id=hl-29-19><a class=lnlinks href=#hl-29-19>19</a>
</span><span class=lnt id=hl-29-20><a class=lnlinks href=#hl-29-20>20</a>
</span><span class=lnt id=hl-29-21><a class=lnlinks href=#hl-29-21>21</a>
</span><span class=lnt id=hl-29-22><a class=lnlinks href=#hl-29-22>22</a>
</span><span class=lnt id=hl-29-23><a class=lnlinks href=#hl-29-23>23</a>
</span><span class=lnt id=hl-29-24><a class=lnlinks href=#hl-29-24>24</a>
</span><span class=lnt id=hl-29-25><a class=lnlinks href=#hl-29-25>25</a>
</span><span class=lnt id=hl-29-26><a class=lnlinks href=#hl-29-26>26</a>
</span><span class=lnt id=hl-29-27><a class=lnlinks href=#hl-29-27>27</a>
</span><span class=lnt id=hl-29-28><a class=lnlinks href=#hl-29-28>28</a>
</span><span class=lnt id=hl-29-29><a class=lnlinks href=#hl-29-29>29</a>
</span><span class=lnt id=hl-29-30><a class=lnlinks href=#hl-29-30>30</a>
</span><span class=lnt id=hl-29-31><a class=lnlinks href=#hl-29-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java에서 우선순위 큐 사용 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>NotificationService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>NotificationService</span><span class=p>(</span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>rabbitTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendNotification</span><span class=p>(</span><span class=n>Notification</span><span class=w> </span><span class=n>notification</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 알림 유형에 따라 우선순위 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>priority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>notification</span><span class=p>.</span><span class=na>getType</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>ALERT</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>10</span><span class=p>;</span><span class=w>  </span><span class=c1>// 가장 높은 우선순위</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>WARNING</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>5</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>INFO</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>    </span><span class=c1>// 가장 낮은 우선순위</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>default</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;notifications.exchange&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;notifications.queue&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>notification</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>message</span><span class=p>.</span><span class=na>getMessageProperties</span><span class=p>().</span><span class=na>setPriority</span><span class=p>(</span><span class=n>priority</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=재시도-큐retry-queue와-데드-레터-큐dead-letter-queue>재시도 큐(Retry Queue)와 데드 레터 큐(Dead Letter Queue)<a hidden class=anchor aria-hidden=true href=#재시도-큐retry-queue와-데드-레터-큐dead-letter-queue>#</a></h4><p>처리 실패한 메시지를 재시도하거나 분석을 위해 별도의 큐로 이동시키는 패턴이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12>12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13>13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14>14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15>15</a>
</span><span class=lnt id=hl-30-16><a class=lnlinks href=#hl-30-16>16</a>
</span><span class=lnt id=hl-30-17><a class=lnlinks href=#hl-30-17>17</a>
</span><span class=lnt id=hl-30-18><a class=lnlinks href=#hl-30-18>18</a>
</span><span class=lnt id=hl-30-19><a class=lnlinks href=#hl-30-19>19</a>
</span><span class=lnt id=hl-30-20><a class=lnlinks href=#hl-30-20>20</a>
</span><span class=lnt id=hl-30-21><a class=lnlinks href=#hl-30-21>21</a>
</span><span class=lnt id=hl-30-22><a class=lnlinks href=#hl-30-22>22</a>
</span><span class=lnt id=hl-30-23><a class=lnlinks href=#hl-30-23>23</a>
</span><span class=lnt id=hl-30-24><a class=lnlinks href=#hl-30-24>24</a>
</span><span class=lnt id=hl-30-25><a class=lnlinks href=#hl-30-25>25</a>
</span><span class=lnt id=hl-30-26><a class=lnlinks href=#hl-30-26>26</a>
</span><span class=lnt id=hl-30-27><a class=lnlinks href=#hl-30-27>27</a>
</span><span class=lnt id=hl-30-28><a class=lnlinks href=#hl-30-28>28</a>
</span><span class=lnt id=hl-30-29><a class=lnlinks href=#hl-30-29>29</a>
</span><span class=lnt id=hl-30-30><a class=lnlinks href=#hl-30-30>30</a>
</span><span class=lnt id=hl-30-31><a class=lnlinks href=#hl-30-31>31</a>
</span><span class=lnt id=hl-30-32><a class=lnlinks href=#hl-30-32>32</a>
</span><span class=lnt id=hl-30-33><a class=lnlinks href=#hl-30-33>33</a>
</span><span class=lnt id=hl-30-34><a class=lnlinks href=#hl-30-34>34</a>
</span><span class=lnt id=hl-30-35><a class=lnlinks href=#hl-30-35>35</a>
</span><span class=lnt id=hl-30-36><a class=lnlinks href=#hl-30-36>36</a>
</span><span class=lnt id=hl-30-37><a class=lnlinks href=#hl-30-37>37</a>
</span><span class=lnt id=hl-30-38><a class=lnlinks href=#hl-30-38>38</a>
</span><span class=lnt id=hl-30-39><a class=lnlinks href=#hl-30-39>39</a>
</span><span class=lnt id=hl-30-40><a class=lnlinks href=#hl-30-40>40</a>
</span><span class=lnt id=hl-30-41><a class=lnlinks href=#hl-30-41>41</a>
</span><span class=lnt id=hl-30-42><a class=lnlinks href=#hl-30-42>42</a>
</span><span class=lnt id=hl-30-43><a class=lnlinks href=#hl-30-43>43</a>
</span><span class=lnt id=hl-30-44><a class=lnlinks href=#hl-30-44>44</a>
</span><span class=lnt id=hl-30-45><a class=lnlinks href=#hl-30-45>45</a>
</span><span class=lnt id=hl-30-46><a class=lnlinks href=#hl-30-46>46</a>
</span><span class=lnt id=hl-30-47><a class=lnlinks href=#hl-30-47>47</a>
</span><span class=lnt id=hl-30-48><a class=lnlinks href=#hl-30-48>48</a>
</span><span class=lnt id=hl-30-49><a class=lnlinks href=#hl-30-49>49</a>
</span><span class=lnt id=hl-30-50><a class=lnlinks href=#hl-30-50>50</a>
</span><span class=lnt id=hl-30-51><a class=lnlinks href=#hl-30-51>51</a>
</span><span class=lnt id=hl-30-52><a class=lnlinks href=#hl-30-52>52</a>
</span><span class=lnt id=hl-30-53><a class=lnlinks href=#hl-30-53>53</a>
</span><span class=lnt id=hl-30-54><a class=lnlinks href=#hl-30-54>54</a>
</span><span class=lnt id=hl-30-55><a class=lnlinks href=#hl-30-55>55</a>
</span><span class=lnt id=hl-30-56><a class=lnlinks href=#hl-30-56>56</a>
</span><span class=lnt id=hl-30-57><a class=lnlinks href=#hl-30-57>57</a>
</span><span class=lnt id=hl-30-58><a class=lnlinks href=#hl-30-58>58</a>
</span><span class=lnt id=hl-30-59><a class=lnlinks href=#hl-30-59>59</a>
</span><span class=lnt id=hl-30-60><a class=lnlinks href=#hl-30-60>60</a>
</span><span class=lnt id=hl-30-61><a class=lnlinks href=#hl-30-61>61</a>
</span><span class=lnt id=hl-30-62><a class=lnlinks href=#hl-30-62>62</a>
</span><span class=lnt id=hl-30-63><a class=lnlinks href=#hl-30-63>63</a>
</span><span class=lnt id=hl-30-64><a class=lnlinks href=#hl-30-64>64</a>
</span><span class=lnt id=hl-30-65><a class=lnlinks href=#hl-30-65>65</a>
</span><span class=lnt id=hl-30-66><a class=lnlinks href=#hl-30-66>66</a>
</span><span class=lnt id=hl-30-67><a class=lnlinks href=#hl-30-67>67</a>
</span><span class=lnt id=hl-30-68><a class=lnlinks href=#hl-30-68>68</a>
</span><span class=lnt id=hl-30-69><a class=lnlinks href=#hl-30-69>69</a>
</span><span class=lnt id=hl-30-70><a class=lnlinks href=#hl-30-70>70</a>
</span><span class=lnt id=hl-30-71><a class=lnlinks href=#hl-30-71>71</a>
</span><span class=lnt id=hl-30-72><a class=lnlinks href=#hl-30-72>72</a>
</span><span class=lnt id=hl-30-73><a class=lnlinks href=#hl-30-73>73</a>
</span><span class=lnt id=hl-30-74><a class=lnlinks href=#hl-30-74>74</a>
</span><span class=lnt id=hl-30-75><a class=lnlinks href=#hl-30-75>75</a>
</span><span class=lnt id=hl-30-76><a class=lnlinks href=#hl-30-76>76</a>
</span><span class=lnt id=hl-30-77><a class=lnlinks href=#hl-30-77>77</a>
</span><span class=lnt id=hl-30-78><a class=lnlinks href=#hl-30-78>78</a>
</span><span class=lnt id=hl-30-79><a class=lnlinks href=#hl-30-79>79</a>
</span><span class=lnt id=hl-30-80><a class=lnlinks href=#hl-30-80>80</a>
</span><span class=lnt id=hl-30-81><a class=lnlinks href=#hl-30-81>81</a>
</span><span class=lnt id=hl-30-82><a class=lnlinks href=#hl-30-82>82</a>
</span><span class=lnt id=hl-30-83><a class=lnlinks href=#hl-30-83>83</a>
</span><span class=lnt id=hl-30-84><a class=lnlinks href=#hl-30-84>84</a>
</span><span class=lnt id=hl-30-85><a class=lnlinks href=#hl-30-85>85</a>
</span><span class=lnt id=hl-30-86><a class=lnlinks href=#hl-30-86>86</a>
</span><span class=lnt id=hl-30-87><a class=lnlinks href=#hl-30-87>87</a>
</span><span class=lnt id=hl-30-88><a class=lnlinks href=#hl-30-88>88</a>
</span><span class=lnt id=hl-30-89><a class=lnlinks href=#hl-30-89>89</a>
</span><span class=lnt id=hl-30-90><a class=lnlinks href=#hl-30-90>90</a>
</span><span class=lnt id=hl-30-91><a class=lnlinks href=#hl-30-91>91</a>
</span><span class=lnt id=hl-30-92><a class=lnlinks href=#hl-30-92>92</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js에서 재시도 큐와 데드 레터 큐 구현 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>setupQueues</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>connection</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;amqp://localhost&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>channel</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 데드 레터 익스체인지 및 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>assertExchange</span><span class=p>(</span><span class=s1>&#39;dlx.payment&#39;</span><span class=p>,</span> <span class=s1>&#39;direct&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;payment.failed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>arguments</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-message-ttl&#39;</span><span class=o>:</span> <span class=mi>86400000</span>  <span class=c1>// 24시간 보관
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>bindQueue</span><span class=p>(</span><span class=s1>&#39;payment.failed&#39;</span><span class=p>,</span> <span class=s1>&#39;dlx.payment&#39;</span><span class=p>,</span> <span class=s1>&#39;payment&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 재시도 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;payment.retry&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>arguments</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-dead-letter-exchange&#39;</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-dead-letter-routing-key&#39;</span><span class=o>:</span> <span class=s1>&#39;payment.process&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-message-ttl&#39;</span><span class=o>:</span> <span class=mi>60000</span>  <span class=c1>// 1분 후 재시도
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 메인 처리 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;payment.process&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>arguments</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-dead-letter-exchange&#39;</span><span class=o>:</span> <span class=s1>&#39;dlx.payment&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;x-dead-letter-routing-key&#39;</span><span class=o>:</span> <span class=s1>&#39;payment&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>connection</span><span class=p>,</span> <span class=nx>channel</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>setupConsumer</span><span class=p>(</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>channel</span><span class=p>.</span><span class=nx>prefetch</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>channel</span><span class=p>.</span><span class=nx>consume</span><span class=p>(</span><span class=s1>&#39;payment.process&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>payment</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`결제 처리 중: </span><span class=si>${</span><span class=nx>payment</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 결제 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>processed</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>processPayment</span><span class=p>(</span><span class=nx>payment</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>processed</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 성공적으로 처리됨
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>channel</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`결제 성공: </span><span class=si>${</span><span class=nx>payment</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 일시적 오류, 재시도 필요
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>retryCount</span> <span class=o>=</span> <span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>properties</span><span class=p>.</span><span class=nx>headers</span><span class=p>[</span><span class=s1>&#39;x-retry-count&#39;</span><span class=p>]</span> <span class=o>||</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>retryCount</span> <span class=o>&lt;=</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 재시도 큐로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>channel</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;payment.retry&#39;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>persistent</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;x-retry-count&#39;</span><span class=o>:</span> <span class=nx>retryCount</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>          <span class=nx>channel</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`결제 재시도 예약 (</span><span class=si>${</span><span class=nx>retryCount</span><span class=si>}</span><span class=sb>/3): </span><span class=si>${</span><span class=nx>payment</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 최대 재시도 횟수 초과, 데드 레터 큐로 이동
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>channel</span><span class=p>.</span><span class=nx>nack</span><span class=p>(</span><span class=nx>msg</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`결제 실패, 데드 레터로 이동: </span><span class=si>${</span><span class=nx>payment</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 처리 중 오류 발생
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`결제 처리 오류: </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>channel</span><span class=p>.</span><span class=nx>nack</span><span class=p>(</span><span class=nx>msg</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>processPayment</span><span class=p>(</span><span class=nx>payment</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 실제 결제 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mf>0.3</span><span class=p>;</span>  <span class=c1>// 70% 성공률 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>connection</span><span class=p>,</span> <span class=nx>channel</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>setupQueues</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>setupConsumer</span><span class=p>(</span><span class=nx>channel</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;결제 처리 서비스 실행 중...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>main</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=3-메시지-유효기간ttl-time-to-live>3. 메시지 유효기간(TTL, Time-To-Live)<a hidden class=anchor aria-hidden=true href=#3-메시지-유효기간ttl-time-to-live>#</a></h4><p>메시지가 큐에 머무를 수 있는 최대 시간을 설정하는 기능으로, 오래된 메시지가 시스템 리소스를 차지하지 않도록 한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10>10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11>11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12>12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13>13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14>14</a>
</span><span class=lnt id=hl-31-15><a class=lnlinks href=#hl-31-15>15</a>
</span><span class=lnt id=hl-31-16><a class=lnlinks href=#hl-31-16>16</a>
</span><span class=lnt id=hl-31-17><a class=lnlinks href=#hl-31-17>17</a>
</span><span class=lnt id=hl-31-18><a class=lnlinks href=#hl-31-18>18</a>
</span><span class=lnt id=hl-31-19><a class=lnlinks href=#hl-31-19>19</a>
</span><span class=lnt id=hl-31-20><a class=lnlinks href=#hl-31-20>20</a>
</span><span class=lnt id=hl-31-21><a class=lnlinks href=#hl-31-21>21</a>
</span><span class=lnt id=hl-31-22><a class=lnlinks href=#hl-31-22>22</a>
</span><span class=lnt id=hl-31-23><a class=lnlinks href=#hl-31-23>23</a>
</span><span class=lnt id=hl-31-24><a class=lnlinks href=#hl-31-24>24</a>
</span><span class=lnt id=hl-31-25><a class=lnlinks href=#hl-31-25>25</a>
</span><span class=lnt id=hl-31-26><a class=lnlinks href=#hl-31-26>26</a>
</span><span class=lnt id=hl-31-27><a class=lnlinks href=#hl-31-27>27</a>
</span><span class=lnt id=hl-31-28><a class=lnlinks href=#hl-31-28>28</a>
</span><span class=lnt id=hl-31-29><a class=lnlinks href=#hl-31-29>29</a>
</span><span class=lnt id=hl-31-30><a class=lnlinks href=#hl-31-30>30</a>
</span><span class=lnt id=hl-31-31><a class=lnlinks href=#hl-31-31>31</a>
</span><span class=lnt id=hl-31-32><a class=lnlinks href=#hl-31-32>32</a>
</span><span class=lnt id=hl-31-33><a class=lnlinks href=#hl-31-33>33</a>
</span><span class=lnt id=hl-31-34><a class=lnlinks href=#hl-31-34>34</a>
</span><span class=lnt id=hl-31-35><a class=lnlinks href=#hl-31-35>35</a>
</span><span class=lnt id=hl-31-36><a class=lnlinks href=#hl-31-36>36</a>
</span><span class=lnt id=hl-31-37><a class=lnlinks href=#hl-31-37>37</a>
</span><span class=lnt id=hl-31-38><a class=lnlinks href=#hl-31-38>38</a>
</span><span class=lnt id=hl-31-39><a class=lnlinks href=#hl-31-39>39</a>
</span><span class=lnt id=hl-31-40><a class=lnlinks href=#hl-31-40>40</a>
</span><span class=lnt id=hl-31-41><a class=lnlinks href=#hl-31-41>41</a>
</span><span class=lnt id=hl-31-42><a class=lnlinks href=#hl-31-42>42</a>
</span><span class=lnt id=hl-31-43><a class=lnlinks href=#hl-31-43>43</a>
</span><span class=lnt id=hl-31-44><a class=lnlinks href=#hl-31-44>44</a>
</span><span class=lnt id=hl-31-45><a class=lnlinks href=#hl-31-45>45</a>
</span><span class=lnt id=hl-31-46><a class=lnlinks href=#hl-31-46>46</a>
</span><span class=lnt id=hl-31-47><a class=lnlinks href=#hl-31-47>47</a>
</span><span class=lnt id=hl-31-48><a class=lnlinks href=#hl-31-48>48</a>
</span><span class=lnt id=hl-31-49><a class=lnlinks href=#hl-31-49>49</a>
</span><span class=lnt id=hl-31-50><a class=lnlinks href=#hl-31-50>50</a>
</span><span class=lnt id=hl-31-51><a class=lnlinks href=#hl-31-51>51</a>
</span><span class=lnt id=hl-31-52><a class=lnlinks href=#hl-31-52>52</a>
</span><span class=lnt id=hl-31-53><a class=lnlinks href=#hl-31-53>53</a>
</span><span class=lnt id=hl-31-54><a class=lnlinks href=#hl-31-54>54</a>
</span><span class=lnt id=hl-31-55><a class=lnlinks href=#hl-31-55>55</a>
</span><span class=lnt id=hl-31-56><a class=lnlinks href=#hl-31-56>56</a>
</span><span class=lnt id=hl-31-57><a class=lnlinks href=#hl-31-57>57</a>
</span><span class=lnt id=hl-31-58><a class=lnlinks href=#hl-31-58>58</a>
</span><span class=lnt id=hl-31-59><a class=lnlinks href=#hl-31-59>59</a>
</span><span class=lnt id=hl-31-60><a class=lnlinks href=#hl-31-60>60</a>
</span><span class=lnt id=hl-31-61><a class=lnlinks href=#hl-31-61>61</a>
</span><span class=lnt id=hl-31-62><a class=lnlinks href=#hl-31-62>62</a>
</span><span class=lnt id=hl-31-63><a class=lnlinks href=#hl-31-63>63</a>
</span><span class=lnt id=hl-31-64><a class=lnlinks href=#hl-31-64>64</a>
</span><span class=lnt id=hl-31-65><a class=lnlinks href=#hl-31-65>65</a>
</span><span class=lnt id=hl-31-66><a class=lnlinks href=#hl-31-66>66</a>
</span><span class=lnt id=hl-31-67><a class=lnlinks href=#hl-31-67>67</a>
</span><span class=lnt id=hl-31-68><a class=lnlinks href=#hl-31-68>68</a>
</span><span class=lnt id=hl-31-69><a class=lnlinks href=#hl-31-69>69</a>
</span><span class=lnt id=hl-31-70><a class=lnlinks href=#hl-31-70>70</a>
</span><span class=lnt id=hl-31-71><a class=lnlinks href=#hl-31-71>71</a>
</span><span class=lnt id=hl-31-72><a class=lnlinks href=#hl-31-72>72</a>
</span><span class=lnt id=hl-31-73><a class=lnlinks href=#hl-31-73>73</a>
</span><span class=lnt id=hl-31-74><a class=lnlinks href=#hl-31-74>74</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// C#에서 메시지 TTL 설정 예시 (RabbitMQ.Client 사용)</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>RabbitMQ.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Collections.Generic</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>NotificationSender</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IModel</span> <span class=n>_channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>NotificationSender</span><span class=p>(</span><span class=n>IModel</span> <span class=n>channel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span> <span class=p>=</span> <span class=n>channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// TTL이 적용된 큐 선언</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>queueArgs</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Dictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=kt>object</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=s>&#34;x-message-ttl&#34;</span><span class=p>,</span> <span class=m>300000</span> <span class=p>}</span>  <span class=c1>// 5분 TTL</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=s>&#34;notifications.transient&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>arguments</span><span class=p>:</span> <span class=n>queueArgs</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>SendTransientNotification</span><span class=p>(</span><span class=kt>string</span> <span class=n>userId</span><span class=p>,</span> <span class=kt>string</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>notification</span> <span class=p>=</span> <span class=k>new</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>UserId</span> <span class=p>=</span> <span class=n>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Message</span> <span class=p>=</span> <span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Timestamp</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>UtcNow</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=n>Text</span><span class=p>.</span><span class=n>Json</span><span class=p>.</span><span class=n>JsonSerializer</span><span class=p>.</span><span class=n>Serialize</span><span class=p>(</span><span class=n>notification</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>properties</span> <span class=p>=</span> <span class=n>_channel</span><span class=p>.</span><span class=n>CreateBasicProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Persistent</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicPublish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=s>&#34;notifications.transient&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>basicProperties</span><span class=p>:</span> <span class=n>properties</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=p>:</span> <span class=n>body</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>SendPriorityNotification</span><span class=p>(</span><span class=kt>string</span> <span class=n>userId</span><span class=p>,</span> <span class=kt>string</span> <span class=n>message</span><span class=p>,</span> <span class=kt>int</span> <span class=n>expirationSeconds</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>notification</span> <span class=p>=</span> <span class=k>new</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>UserId</span> <span class=p>=</span> <span class=n>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Message</span> <span class=p>=</span> <span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Timestamp</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>UtcNow</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=n>Text</span><span class=p>.</span><span class=n>Json</span><span class=p>.</span><span class=n>JsonSerializer</span><span class=p>.</span><span class=n>Serialize</span><span class=p>(</span><span class=n>notification</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>properties</span> <span class=p>=</span> <span class=n>_channel</span><span class=p>.</span><span class=n>CreateBasicProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Persistent</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Expiration</span> <span class=p>=</span> <span class=p>(</span><span class=n>expirationSeconds</span> <span class=p>*</span> <span class=m>1000</span><span class=p>).</span><span class=n>ToString</span><span class=p>();</span>  <span class=c1>// 개별 메시지 TTL 설정</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicPublish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=s>&#34;notifications.priority&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>basicProperties</span><span class=p>:</span> <span class=n>properties</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=p>:</span> <span class=n>body</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=메시지-지연-전송delayed-delivery>메시지 지연 전송(Delayed Delivery)<a hidden class=anchor aria-hidden=true href=#메시지-지연-전송delayed-delivery>#</a></h4><p>메시지를 즉시 처리하지 않고 일정 시간 후에 처리하도록 예약하는 기능이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10>10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11>11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12>12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13>13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14>14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15>15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16>16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17>17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18>18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19>19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20>20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21>21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22>22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23>23</a>
</span><span class=lnt id=hl-32-24><a class=lnlinks href=#hl-32-24>24</a>
</span><span class=lnt id=hl-32-25><a class=lnlinks href=#hl-32-25>25</a>
</span><span class=lnt id=hl-32-26><a class=lnlinks href=#hl-32-26>26</a>
</span><span class=lnt id=hl-32-27><a class=lnlinks href=#hl-32-27>27</a>
</span><span class=lnt id=hl-32-28><a class=lnlinks href=#hl-32-28>28</a>
</span><span class=lnt id=hl-32-29><a class=lnlinks href=#hl-32-29>29</a>
</span><span class=lnt id=hl-32-30><a class=lnlinks href=#hl-32-30>30</a>
</span><span class=lnt id=hl-32-31><a class=lnlinks href=#hl-32-31>31</a>
</span><span class=lnt id=hl-32-32><a class=lnlinks href=#hl-32-32>32</a>
</span><span class=lnt id=hl-32-33><a class=lnlinks href=#hl-32-33>33</a>
</span><span class=lnt id=hl-32-34><a class=lnlinks href=#hl-32-34>34</a>
</span><span class=lnt id=hl-32-35><a class=lnlinks href=#hl-32-35>35</a>
</span><span class=lnt id=hl-32-36><a class=lnlinks href=#hl-32-36>36</a>
</span><span class=lnt id=hl-32-37><a class=lnlinks href=#hl-32-37>37</a>
</span><span class=lnt id=hl-32-38><a class=lnlinks href=#hl-32-38>38</a>
</span><span class=lnt id=hl-32-39><a class=lnlinks href=#hl-32-39>39</a>
</span><span class=lnt id=hl-32-40><a class=lnlinks href=#hl-32-40>40</a>
</span><span class=lnt id=hl-32-41><a class=lnlinks href=#hl-32-41>41</a>
</span><span class=lnt id=hl-32-42><a class=lnlinks href=#hl-32-42>42</a>
</span><span class=lnt id=hl-32-43><a class=lnlinks href=#hl-32-43>43</a>
</span><span class=lnt id=hl-32-44><a class=lnlinks href=#hl-32-44>44</a>
</span><span class=lnt id=hl-32-45><a class=lnlinks href=#hl-32-45>45</a>
</span><span class=lnt id=hl-32-46><a class=lnlinks href=#hl-32-46>46</a>
</span><span class=lnt id=hl-32-47><a class=lnlinks href=#hl-32-47>47</a>
</span><span class=lnt id=hl-32-48><a class=lnlinks href=#hl-32-48>48</a>
</span><span class=lnt id=hl-32-49><a class=lnlinks href=#hl-32-49>49</a>
</span><span class=lnt id=hl-32-50><a class=lnlinks href=#hl-32-50>50</a>
</span><span class=lnt id=hl-32-51><a class=lnlinks href=#hl-32-51>51</a>
</span><span class=lnt id=hl-32-52><a class=lnlinks href=#hl-32-52>52</a>
</span><span class=lnt id=hl-32-53><a class=lnlinks href=#hl-32-53>53</a>
</span><span class=lnt id=hl-32-54><a class=lnlinks href=#hl-32-54>54</a>
</span><span class=lnt id=hl-32-55><a class=lnlinks href=#hl-32-55>55</a>
</span><span class=lnt id=hl-32-56><a class=lnlinks href=#hl-32-56>56</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java에서 지연 메시지 구현 예시 (Spring AMQP 사용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RabbitMQConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CustomExchange</span><span class=w> </span><span class=nf>delayExchange</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>args</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;x-delayed-type&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;direct&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CustomExchange</span><span class=p>(</span><span class=s>&#34;delay.exchange&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;x-delayed-message&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Queue</span><span class=w> </span><span class=nf>reminderQueue</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Queue</span><span class=p>(</span><span class=s>&#34;reminders.queue&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Binding</span><span class=w> </span><span class=nf>reminderBinding</span><span class=p>(</span><span class=n>Queue</span><span class=w> </span><span class=n>reminderQueue</span><span class=p>,</span><span class=w> </span><span class=n>CustomExchange</span><span class=w> </span><span class=n>delayExchange</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>BindingBuilder</span><span class=p>.</span><span class=na>bind</span><span class=p>(</span><span class=n>reminderQueue</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>to</span><span class=p>(</span><span class=n>delayExchange</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=s>&#34;reminders.routing&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>noargs</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ReminderService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ReminderService</span><span class=p>(</span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>rabbitTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>scheduleReminder</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>delayInSeconds</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Reminder</span><span class=w> </span><span class=n>reminder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Reminder</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>userId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>().</span><span class=na>plusSeconds</span><span class=p>(</span><span class=n>delayInSeconds</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;delay.exchange&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;reminders.routing&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>reminder</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>message</span><span class=p>.</span><span class=na>getMessageProperties</span><span class=p>().</span><span class=na>setHeader</span><span class=p>(</span><span class=s>&#34;x-delay&#34;</span><span class=p>,</span><span class=w> </span><span class=n>delayInSeconds</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;알림 예약됨: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>delayInSeconds</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;초 후 &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;님에게 전송&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐-기술-비교>메시징 큐 기술 비교<a hidden class=anchor aria-hidden=true href=#메시징-큐-기술-비교>#</a></h3><h4 id=rabbitmq>RabbitMQ<a hidden class=anchor aria-hidden=true href=#rabbitmq>#</a></h4><ul><li><strong>특징</strong>: AMQP 프로토콜 지원, 다양한 메시징 패턴, 고급 라우팅</li><li><strong>장점</strong>: 유연한 라우팅, 플러그인 생태계, 관리 UI</li><li><strong>적합한 경우</strong>: 복잡한 라우팅 요구사항, 다양한 메시징 패턴 필요 시</li></ul><h4 id=apache-kafka>Apache Kafka<a hidden class=anchor aria-hidden=true href=#apache-kafka>#</a></h4><ul><li><strong>특징</strong>: 분산 스트리밍 플랫폼, 높은 처리량, 로그 보존</li><li><strong>장점</strong>: 확장성, 내구성, 실시간 스트림 처리</li><li><strong>적합한 경우</strong>: 대용량 이벤트 스트리밍, 실시간 분석, 이벤트 소싱</li></ul><h4 id=amazon-sqssns>Amazon SQS/SNS<a hidden class=anchor aria-hidden=true href=#amazon-sqssns>#</a></h4><ul><li><strong>특징</strong>: 관리형 메시징 서비스, 서버리스 운영</li><li><strong>장점</strong>: 운영 오버헤드 없음, 자동 확장</li><li><strong>적합한 경우</strong>: AWS 인프라 사용, 최소한의 운영 복잡성 추구</li></ul><h4 id=redis-pubsub>Redis Pub/Sub<a hidden class=anchor aria-hidden=true href=#redis-pubsub>#</a></h4><ul><li><strong>특징</strong>: 인메모리 데이터 스토어 기반 메시징</li><li><strong>장점</strong>: 빠른 처리 속도, 간단한 설정</li><li><strong>적합한 경우</strong>: 짧은 지연 시간 요구사항, 간단한 메시징 요구사항</li></ul><h3 id=api-시스템에서-메시징-큐-사용-사례>API 시스템에서 메시징 큐 사용 사례<a hidden class=anchor aria-hidden=true href=#api-시스템에서-메시징-큐-사용-사례>#</a></h3><h4 id=비동기-작업-처리>비동기 작업 처리<a hidden class=anchor aria-hidden=true href=#비동기-작업-처리>#</a></h4><p>오래 걸리는 작업을 비동기적으로 처리하여 API의 응답 시간을 개선할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15>15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16>16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17>17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18>18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19>19</a>
</span><span class=lnt id=hl-33-20><a class=lnlinks href=#hl-33-20>20</a>
</span><span class=lnt id=hl-33-21><a class=lnlinks href=#hl-33-21>21</a>
</span><span class=lnt id=hl-33-22><a class=lnlinks href=#hl-33-22>22</a>
</span><span class=lnt id=hl-33-23><a class=lnlinks href=#hl-33-23>23</a>
</span><span class=lnt id=hl-33-24><a class=lnlinks href=#hl-33-24>24</a>
</span><span class=lnt id=hl-33-25><a class=lnlinks href=#hl-33-25>25</a>
</span><span class=lnt id=hl-33-26><a class=lnlinks href=#hl-33-26>26</a>
</span><span class=lnt id=hl-33-27><a class=lnlinks href=#hl-33-27>27</a>
</span><span class=lnt id=hl-33-28><a class=lnlinks href=#hl-33-28>28</a>
</span><span class=lnt id=hl-33-29><a class=lnlinks href=#hl-33-29>29</a>
</span><span class=lnt id=hl-33-30><a class=lnlinks href=#hl-33-30>30</a>
</span><span class=lnt id=hl-33-31><a class=lnlinks href=#hl-33-31>31</a>
</span><span class=lnt id=hl-33-32><a class=lnlinks href=#hl-33-32>32</a>
</span><span class=lnt id=hl-33-33><a class=lnlinks href=#hl-33-33>33</a>
</span><span class=lnt id=hl-33-34><a class=lnlinks href=#hl-33-34>34</a>
</span><span class=lnt id=hl-33-35><a class=lnlinks href=#hl-33-35>35</a>
</span><span class=lnt id=hl-33-36><a class=lnlinks href=#hl-33-36>36</a>
</span><span class=lnt id=hl-33-37><a class=lnlinks href=#hl-33-37>37</a>
</span><span class=lnt id=hl-33-38><a class=lnlinks href=#hl-33-38>38</a>
</span><span class=lnt id=hl-33-39><a class=lnlinks href=#hl-33-39>39</a>
</span><span class=lnt id=hl-33-40><a class=lnlinks href=#hl-33-40>40</a>
</span><span class=lnt id=hl-33-41><a class=lnlinks href=#hl-33-41>41</a>
</span><span class=lnt id=hl-33-42><a class=lnlinks href=#hl-33-42>42</a>
</span><span class=lnt id=hl-33-43><a class=lnlinks href=#hl-33-43>43</a>
</span><span class=lnt id=hl-33-44><a class=lnlinks href=#hl-33-44>44</a>
</span><span class=lnt id=hl-33-45><a class=lnlinks href=#hl-33-45>45</a>
</span><span class=lnt id=hl-33-46><a class=lnlinks href=#hl-33-46>46</a>
</span><span class=lnt id=hl-33-47><a class=lnlinks href=#hl-33-47>47</a>
</span><span class=lnt id=hl-33-48><a class=lnlinks href=#hl-33-48>48</a>
</span><span class=lnt id=hl-33-49><a class=lnlinks href=#hl-33-49>49</a>
</span><span class=lnt id=hl-33-50><a class=lnlinks href=#hl-33-50>50</a>
</span><span class=lnt id=hl-33-51><a class=lnlinks href=#hl-33-51>51</a>
</span><span class=lnt id=hl-33-52><a class=lnlinks href=#hl-33-52>52</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=c1>// Kotlin Spring Boot 비동기 작업 처리 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s2>&#34;/api/reports&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ReportController</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>reportPublisher</span><span class=p>:</span> <span class=n>ReportPublisher</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>reportRepository</span><span class=p>:</span> <span class=n>ReportRepository</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@PostMapping</span>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>generateReport</span><span class=p>(</span><span class=nd>@RequestBody</span> <span class=n>request</span><span class=p>:</span> <span class=n>ReportRequest</span><span class=p>):</span> <span class=n>ResponseEntity</span><span class=p>&lt;</span><span class=n>ReportResponse</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 보고서 작업 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>val</span> <span class=py>reportJob</span> <span class=p>=</span> <span class=n>ReportJob</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>id</span> <span class=p>=</span> <span class=nc>UUID</span><span class=p>.</span><span class=n>randomUUID</span><span class=p>().</span><span class=n>toString</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>userId</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>parameters</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>parameters</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>status</span> <span class=p>=</span> <span class=nc>ReportStatus</span><span class=p>.</span><span class=n>PENDING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>createdAt</span> <span class=p>=</span> <span class=nc>LocalDateTime</span><span class=p>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 작업 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>reportRepository</span><span class=p>.</span><span class=n>save</span><span class=p>(</span><span class=n>reportJob</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 작업을 큐에 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>reportPublisher</span><span class=p>.</span><span class=n>publishReportJob</span><span class=p>(</span><span class=n>reportJob</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 즉시 응답 반환
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>ResponseEntity</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>accepted</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>body</span><span class=p>(</span><span class=n>ReportResponse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>jobId</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>status</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>statusUrl</span> <span class=p>=</span> <span class=s2>&#34;/api/reports/</span><span class=si>${reportJob.id}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@GetMapping</span><span class=p>(</span><span class=s2>&#34;/{jobId}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>getReportStatus</span><span class=p>(</span><span class=nd>@PathVariable</span> <span class=n>jobId</span><span class=p>:</span> <span class=n>String</span><span class=p>):</span> <span class=n>ResponseEntity</span><span class=p>&lt;</span><span class=n>ReportJobStatus</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>reportJob</span> <span class=p>=</span> <span class=n>reportRepository</span><span class=p>.</span><span class=n>findById</span><span class=p>(</span><span class=n>jobId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=o>?:</span> <span class=k>return</span> <span class=nc>ResponseEntity</span><span class=p>.</span><span class=n>notFound</span><span class=p>().</span><span class=n>build</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nc>ResponseEntity</span><span class=p>.</span><span class=n>ok</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>ReportJobStatus</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>jobId</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>status</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>progress</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>progress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>createdAt</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>createdAt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>completedAt</span> <span class=p>=</span> <span class=n>reportJob</span><span class=p>.</span><span class=n>completedAt</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=시스템-간-통합>시스템 간 통합<a hidden class=anchor aria-hidden=true href=#시스템-간-통합>#</a></h4><p>여러 시스템 간의 느슨한 결합을 통해 확장성과 유연성을 제공한다. 각 시스템은 독립적으로 진화하면서도 메시지를 통해 효과적으로 통신할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1> 1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2> 2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3> 3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4> 4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5> 5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6> 6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7> 7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8> 8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9> 9</a>
</span><span class=lnt id=hl-34-10><a class=lnlinks href=#hl-34-10>10</a>
</span><span class=lnt id=hl-34-11><a class=lnlinks href=#hl-34-11>11</a>
</span><span class=lnt id=hl-34-12><a class=lnlinks href=#hl-34-12>12</a>
</span><span class=lnt id=hl-34-13><a class=lnlinks href=#hl-34-13>13</a>
</span><span class=lnt id=hl-34-14><a class=lnlinks href=#hl-34-14>14</a>
</span><span class=lnt id=hl-34-15><a class=lnlinks href=#hl-34-15>15</a>
</span><span class=lnt id=hl-34-16><a class=lnlinks href=#hl-34-16>16</a>
</span><span class=lnt id=hl-34-17><a class=lnlinks href=#hl-34-17>17</a>
</span><span class=lnt id=hl-34-18><a class=lnlinks href=#hl-34-18>18</a>
</span><span class=lnt id=hl-34-19><a class=lnlinks href=#hl-34-19>19</a>
</span><span class=lnt id=hl-34-20><a class=lnlinks href=#hl-34-20>20</a>
</span><span class=lnt id=hl-34-21><a class=lnlinks href=#hl-34-21>21</a>
</span><span class=lnt id=hl-34-22><a class=lnlinks href=#hl-34-22>22</a>
</span><span class=lnt id=hl-34-23><a class=lnlinks href=#hl-34-23>23</a>
</span><span class=lnt id=hl-34-24><a class=lnlinks href=#hl-34-24>24</a>
</span><span class=lnt id=hl-34-25><a class=lnlinks href=#hl-34-25>25</a>
</span><span class=lnt id=hl-34-26><a class=lnlinks href=#hl-34-26>26</a>
</span><span class=lnt id=hl-34-27><a class=lnlinks href=#hl-34-27>27</a>
</span><span class=lnt id=hl-34-28><a class=lnlinks href=#hl-34-28>28</a>
</span><span class=lnt id=hl-34-29><a class=lnlinks href=#hl-34-29>29</a>
</span><span class=lnt id=hl-34-30><a class=lnlinks href=#hl-34-30>30</a>
</span><span class=lnt id=hl-34-31><a class=lnlinks href=#hl-34-31>31</a>
</span><span class=lnt id=hl-34-32><a class=lnlinks href=#hl-34-32>32</a>
</span><span class=lnt id=hl-34-33><a class=lnlinks href=#hl-34-33>33</a>
</span><span class=lnt id=hl-34-34><a class=lnlinks href=#hl-34-34>34</a>
</span><span class=lnt id=hl-34-35><a class=lnlinks href=#hl-34-35>35</a>
</span><span class=lnt id=hl-34-36><a class=lnlinks href=#hl-34-36>36</a>
</span><span class=lnt id=hl-34-37><a class=lnlinks href=#hl-34-37>37</a>
</span><span class=lnt id=hl-34-38><a class=lnlinks href=#hl-34-38>38</a>
</span><span class=lnt id=hl-34-39><a class=lnlinks href=#hl-34-39>39</a>
</span><span class=lnt id=hl-34-40><a class=lnlinks href=#hl-34-40>40</a>
</span><span class=lnt id=hl-34-41><a class=lnlinks href=#hl-34-41>41</a>
</span><span class=lnt id=hl-34-42><a class=lnlinks href=#hl-34-42>42</a>
</span><span class=lnt id=hl-34-43><a class=lnlinks href=#hl-34-43>43</a>
</span><span class=lnt id=hl-34-44><a class=lnlinks href=#hl-34-44>44</a>
</span><span class=lnt id=hl-34-45><a class=lnlinks href=#hl-34-45>45</a>
</span><span class=lnt id=hl-34-46><a class=lnlinks href=#hl-34-46>46</a>
</span><span class=lnt id=hl-34-47><a class=lnlinks href=#hl-34-47>47</a>
</span><span class=lnt id=hl-34-48><a class=lnlinks href=#hl-34-48>48</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 주문 시스템에서 결제 시스템으로 메시지 전송 예시 (Java)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderCompletionService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JmsTemplate</span><span class=w> </span><span class=n>jmsTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>OrderCompletionService</span><span class=p>(</span><span class=n>JmsTemplate</span><span class=w> </span><span class=n>jmsTemplate</span><span class=p>,</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>jmsTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jmsTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>orderRepository</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>completeOrder</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>PaymentDetails</span><span class=w> </span><span class=n>paymentDetails</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 주문 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>orderId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderNotFoundException</span><span class=p>(</span><span class=n>orderId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PAID</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>setPaymentDetails</span><span class=p>(</span><span class=n>paymentDetails</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>setUpdatedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 결제 완료 메시지를 다른 시스템에 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OrderPaidEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderPaidEvent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>orderId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>getCustomerId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>paymentDetails</span><span class=p>.</span><span class=na>getAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>paymentDetails</span><span class=p>.</span><span class=na>getPaymentMethod</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>getItems</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>getShippingAddress</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 배송 시스템에 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jmsTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=s>&#34;shipping.orders.paid&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재고 시스템에 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jmsTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=s>&#34;inventory.orders.paid&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 고객 알림 시스템에 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jmsTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=s>&#34;notifications.orders.paid&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;주문 &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>orderId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; 완료 메시지 전송됨&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=부하-분산-및-처리량-향상>부하 분산 및 처리량 향상<a hidden class=anchor aria-hidden=true href=#부하-분산-및-처리량-향상>#</a></h4><p>트래픽이 많은 작업을 여러 워커 인스턴스로 분산하여 시스템의 전체 처리량을 향상시킬 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span><span class=lnt id=hl-35-26><a class=lnlinks href=#hl-35-26>26</a>
</span><span class=lnt id=hl-35-27><a class=lnlinks href=#hl-35-27>27</a>
</span><span class=lnt id=hl-35-28><a class=lnlinks href=#hl-35-28>28</a>
</span><span class=lnt id=hl-35-29><a class=lnlinks href=#hl-35-29>29</a>
</span><span class=lnt id=hl-35-30><a class=lnlinks href=#hl-35-30>30</a>
</span><span class=lnt id=hl-35-31><a class=lnlinks href=#hl-35-31>31</a>
</span><span class=lnt id=hl-35-32><a class=lnlinks href=#hl-35-32>32</a>
</span><span class=lnt id=hl-35-33><a class=lnlinks href=#hl-35-33>33</a>
</span><span class=lnt id=hl-35-34><a class=lnlinks href=#hl-35-34>34</a>
</span><span class=lnt id=hl-35-35><a class=lnlinks href=#hl-35-35>35</a>
</span><span class=lnt id=hl-35-36><a class=lnlinks href=#hl-35-36>36</a>
</span><span class=lnt id=hl-35-37><a class=lnlinks href=#hl-35-37>37</a>
</span><span class=lnt id=hl-35-38><a class=lnlinks href=#hl-35-38>38</a>
</span><span class=lnt id=hl-35-39><a class=lnlinks href=#hl-35-39>39</a>
</span><span class=lnt id=hl-35-40><a class=lnlinks href=#hl-35-40>40</a>
</span><span class=lnt id=hl-35-41><a class=lnlinks href=#hl-35-41>41</a>
</span><span class=lnt id=hl-35-42><a class=lnlinks href=#hl-35-42>42</a>
</span><span class=lnt id=hl-35-43><a class=lnlinks href=#hl-35-43>43</a>
</span><span class=lnt id=hl-35-44><a class=lnlinks href=#hl-35-44>44</a>
</span><span class=lnt id=hl-35-45><a class=lnlinks href=#hl-35-45>45</a>
</span><span class=lnt id=hl-35-46><a class=lnlinks href=#hl-35-46>46</a>
</span><span class=lnt id=hl-35-47><a class=lnlinks href=#hl-35-47>47</a>
</span><span class=lnt id=hl-35-48><a class=lnlinks href=#hl-35-48>48</a>
</span><span class=lnt id=hl-35-49><a class=lnlinks href=#hl-35-49>49</a>
</span><span class=lnt id=hl-35-50><a class=lnlinks href=#hl-35-50>50</a>
</span><span class=lnt id=hl-35-51><a class=lnlinks href=#hl-35-51>51</a>
</span><span class=lnt id=hl-35-52><a class=lnlinks href=#hl-35-52>52</a>
</span><span class=lnt id=hl-35-53><a class=lnlinks href=#hl-35-53>53</a>
</span><span class=lnt id=hl-35-54><a class=lnlinks href=#hl-35-54>54</a>
</span><span class=lnt id=hl-35-55><a class=lnlinks href=#hl-35-55>55</a>
</span><span class=lnt id=hl-35-56><a class=lnlinks href=#hl-35-56>56</a>
</span><span class=lnt id=hl-35-57><a class=lnlinks href=#hl-35-57>57</a>
</span><span class=lnt id=hl-35-58><a class=lnlinks href=#hl-35-58>58</a>
</span><span class=lnt id=hl-35-59><a class=lnlinks href=#hl-35-59>59</a>
</span><span class=lnt id=hl-35-60><a class=lnlinks href=#hl-35-60>60</a>
</span><span class=lnt id=hl-35-61><a class=lnlinks href=#hl-35-61>61</a>
</span><span class=lnt id=hl-35-62><a class=lnlinks href=#hl-35-62>62</a>
</span><span class=lnt id=hl-35-63><a class=lnlinks href=#hl-35-63>63</a>
</span><span class=lnt id=hl-35-64><a class=lnlinks href=#hl-35-64>64</a>
</span><span class=lnt id=hl-35-65><a class=lnlinks href=#hl-35-65>65</a>
</span><span class=lnt id=hl-35-66><a class=lnlinks href=#hl-35-66>66</a>
</span><span class=lnt id=hl-35-67><a class=lnlinks href=#hl-35-67>67</a>
</span><span class=lnt id=hl-35-68><a class=lnlinks href=#hl-35-68>68</a>
</span><span class=lnt id=hl-35-69><a class=lnlinks href=#hl-35-69>69</a>
</span><span class=lnt id=hl-35-70><a class=lnlinks href=#hl-35-70>70</a>
</span><span class=lnt id=hl-35-71><a class=lnlinks href=#hl-35-71>71</a>
</span><span class=lnt id=hl-35-72><a class=lnlinks href=#hl-35-72>72</a>
</span><span class=lnt id=hl-35-73><a class=lnlinks href=#hl-35-73>73</a>
</span><span class=lnt id=hl-35-74><a class=lnlinks href=#hl-35-74>74</a>
</span><span class=lnt id=hl-35-75><a class=lnlinks href=#hl-35-75>75</a>
</span><span class=lnt id=hl-35-76><a class=lnlinks href=#hl-35-76>76</a>
</span><span class=lnt id=hl-35-77><a class=lnlinks href=#hl-35-77>77</a>
</span><span class=lnt id=hl-35-78><a class=lnlinks href=#hl-35-78>78</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python FastAPI에서 이미지 처리 부하 분산 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>File</span><span class=p>,</span> <span class=n>UploadFile</span><span class=p>,</span> <span class=n>BackgroundTasks</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi.responses</span> <span class=kn>import</span> <span class=n>JSONResponse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aio_pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RabbitMQ 연결 설정</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_rabbitmq_connection</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>await</span> <span class=n>aio_pika</span><span class=o>.</span><span class=n>connect_robust</span><span class=p>(</span><span class=s2>&#34;amqp://guest:guest@localhost/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이미지 업로드 및 처리 요청 API</span>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/api/images/process&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>process_image</span><span class=p>(</span><span class=n>file</span><span class=p>:</span> <span class=n>UploadFile</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>background_tasks</span><span class=p>:</span> <span class=n>BackgroundTasks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 파일 저장</span>
</span></span><span class=line><span class=cl>    <span class=n>file_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>file_path</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;uploads/</span><span class=si>{</span><span class=n>file_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>file</span><span class=o>.</span><span class=n>filename</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=s2>&#34;uploads&#34;</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;wb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>buffer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=k>await</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>buffer</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 이미지 처리 작업 큐에 전송</span>
</span></span><span class=line><span class=cl>    <span class=n>background_tasks</span><span class=o>.</span><span class=n>add_task</span><span class=p>(</span><span class=n>send_to_processing_queue</span><span class=p>,</span> <span class=n>file_id</span><span class=p>,</span> <span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>JSONResponse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>status_code</span><span class=o>=</span><span class=mi>202</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;이미지 처리가 시작되었습니다.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;file_id&#34;</span><span class=p>:</span> <span class=n>file_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status_url&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;/api/images/status/</span><span class=si>{</span><span class=n>file_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이미지 처리 작업을 큐에 전송</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>send_to_processing_queue</span><span class=p>(</span><span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=k>await</span> <span class=n>get_rabbitmq_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이미지 처리 큐 선언</span>
</span></span><span class=line><span class=cl>        <span class=n>queue</span> <span class=o>=</span> <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>declare_queue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;image_processing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 메시지 생성 및 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>message_body</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;file_id&#34;</span><span class=p>:</span> <span class=n>file_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;file_path&#34;</span><span class=p>:</span> <span class=n>file_path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>default_exchange</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>aio_pika</span><span class=o>.</span><span class=n>Message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>body</span><span class=o>=</span><span class=n>message_body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>delivery_mode</span><span class=o>=</span><span class=n>aio_pika</span><span class=o>.</span><span class=n>DeliveryMode</span><span class=o>.</span><span class=n>PERSISTENT</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>routing_key</span><span class=o>=</span><span class=s2>&#34;image_processing&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;이미지 처리 요청이 큐에 전송됨: </span><span class=si>{</span><span class=n>file_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이미지 처리 상태 확인 API</span>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/api/images/status/</span><span class=si>{file_id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_image_status</span><span class=p>(</span><span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제 구현에서는 DB에서 처리 상태 조회</span>
</span></span><span class=line><span class=cl>    <span class=c1># 여기서는 간단한 예시만 표시</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_id&#34;</span><span class=p>:</span> <span class=n>file_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;processing&#34;</span><span class=p>,</span>  <span class=c1># 실제로는 DB에서 현재 상태 조회</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;이미지가 처리 중입니다.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=장애-격리-및-복원력>장애 격리 및 복원력<a hidden class=anchor aria-hidden=true href=#장애-격리-및-복원력>#</a></h4><p>일시적인 장애나 부하 증가에도 시스템이 계속 작동할 수 있도록 메시지를 버퍼링하고 재시도 메커니즘을 구현한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1>  1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2>  2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3>  3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4>  4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5>  5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6>  6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7>  7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8>  8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9>  9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10> 10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11> 11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12> 12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13> 13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14> 14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15> 15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16> 16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17> 17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18> 18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19> 19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20> 20</a>
</span><span class=lnt id=hl-36-21><a class=lnlinks href=#hl-36-21> 21</a>
</span><span class=lnt id=hl-36-22><a class=lnlinks href=#hl-36-22> 22</a>
</span><span class=lnt id=hl-36-23><a class=lnlinks href=#hl-36-23> 23</a>
</span><span class=lnt id=hl-36-24><a class=lnlinks href=#hl-36-24> 24</a>
</span><span class=lnt id=hl-36-25><a class=lnlinks href=#hl-36-25> 25</a>
</span><span class=lnt id=hl-36-26><a class=lnlinks href=#hl-36-26> 26</a>
</span><span class=lnt id=hl-36-27><a class=lnlinks href=#hl-36-27> 27</a>
</span><span class=lnt id=hl-36-28><a class=lnlinks href=#hl-36-28> 28</a>
</span><span class=lnt id=hl-36-29><a class=lnlinks href=#hl-36-29> 29</a>
</span><span class=lnt id=hl-36-30><a class=lnlinks href=#hl-36-30> 30</a>
</span><span class=lnt id=hl-36-31><a class=lnlinks href=#hl-36-31> 31</a>
</span><span class=lnt id=hl-36-32><a class=lnlinks href=#hl-36-32> 32</a>
</span><span class=lnt id=hl-36-33><a class=lnlinks href=#hl-36-33> 33</a>
</span><span class=lnt id=hl-36-34><a class=lnlinks href=#hl-36-34> 34</a>
</span><span class=lnt id=hl-36-35><a class=lnlinks href=#hl-36-35> 35</a>
</span><span class=lnt id=hl-36-36><a class=lnlinks href=#hl-36-36> 36</a>
</span><span class=lnt id=hl-36-37><a class=lnlinks href=#hl-36-37> 37</a>
</span><span class=lnt id=hl-36-38><a class=lnlinks href=#hl-36-38> 38</a>
</span><span class=lnt id=hl-36-39><a class=lnlinks href=#hl-36-39> 39</a>
</span><span class=lnt id=hl-36-40><a class=lnlinks href=#hl-36-40> 40</a>
</span><span class=lnt id=hl-36-41><a class=lnlinks href=#hl-36-41> 41</a>
</span><span class=lnt id=hl-36-42><a class=lnlinks href=#hl-36-42> 42</a>
</span><span class=lnt id=hl-36-43><a class=lnlinks href=#hl-36-43> 43</a>
</span><span class=lnt id=hl-36-44><a class=lnlinks href=#hl-36-44> 44</a>
</span><span class=lnt id=hl-36-45><a class=lnlinks href=#hl-36-45> 45</a>
</span><span class=lnt id=hl-36-46><a class=lnlinks href=#hl-36-46> 46</a>
</span><span class=lnt id=hl-36-47><a class=lnlinks href=#hl-36-47> 47</a>
</span><span class=lnt id=hl-36-48><a class=lnlinks href=#hl-36-48> 48</a>
</span><span class=lnt id=hl-36-49><a class=lnlinks href=#hl-36-49> 49</a>
</span><span class=lnt id=hl-36-50><a class=lnlinks href=#hl-36-50> 50</a>
</span><span class=lnt id=hl-36-51><a class=lnlinks href=#hl-36-51> 51</a>
</span><span class=lnt id=hl-36-52><a class=lnlinks href=#hl-36-52> 52</a>
</span><span class=lnt id=hl-36-53><a class=lnlinks href=#hl-36-53> 53</a>
</span><span class=lnt id=hl-36-54><a class=lnlinks href=#hl-36-54> 54</a>
</span><span class=lnt id=hl-36-55><a class=lnlinks href=#hl-36-55> 55</a>
</span><span class=lnt id=hl-36-56><a class=lnlinks href=#hl-36-56> 56</a>
</span><span class=lnt id=hl-36-57><a class=lnlinks href=#hl-36-57> 57</a>
</span><span class=lnt id=hl-36-58><a class=lnlinks href=#hl-36-58> 58</a>
</span><span class=lnt id=hl-36-59><a class=lnlinks href=#hl-36-59> 59</a>
</span><span class=lnt id=hl-36-60><a class=lnlinks href=#hl-36-60> 60</a>
</span><span class=lnt id=hl-36-61><a class=lnlinks href=#hl-36-61> 61</a>
</span><span class=lnt id=hl-36-62><a class=lnlinks href=#hl-36-62> 62</a>
</span><span class=lnt id=hl-36-63><a class=lnlinks href=#hl-36-63> 63</a>
</span><span class=lnt id=hl-36-64><a class=lnlinks href=#hl-36-64> 64</a>
</span><span class=lnt id=hl-36-65><a class=lnlinks href=#hl-36-65> 65</a>
</span><span class=lnt id=hl-36-66><a class=lnlinks href=#hl-36-66> 66</a>
</span><span class=lnt id=hl-36-67><a class=lnlinks href=#hl-36-67> 67</a>
</span><span class=lnt id=hl-36-68><a class=lnlinks href=#hl-36-68> 68</a>
</span><span class=lnt id=hl-36-69><a class=lnlinks href=#hl-36-69> 69</a>
</span><span class=lnt id=hl-36-70><a class=lnlinks href=#hl-36-70> 70</a>
</span><span class=lnt id=hl-36-71><a class=lnlinks href=#hl-36-71> 71</a>
</span><span class=lnt id=hl-36-72><a class=lnlinks href=#hl-36-72> 72</a>
</span><span class=lnt id=hl-36-73><a class=lnlinks href=#hl-36-73> 73</a>
</span><span class=lnt id=hl-36-74><a class=lnlinks href=#hl-36-74> 74</a>
</span><span class=lnt id=hl-36-75><a class=lnlinks href=#hl-36-75> 75</a>
</span><span class=lnt id=hl-36-76><a class=lnlinks href=#hl-36-76> 76</a>
</span><span class=lnt id=hl-36-77><a class=lnlinks href=#hl-36-77> 77</a>
</span><span class=lnt id=hl-36-78><a class=lnlinks href=#hl-36-78> 78</a>
</span><span class=lnt id=hl-36-79><a class=lnlinks href=#hl-36-79> 79</a>
</span><span class=lnt id=hl-36-80><a class=lnlinks href=#hl-36-80> 80</a>
</span><span class=lnt id=hl-36-81><a class=lnlinks href=#hl-36-81> 81</a>
</span><span class=lnt id=hl-36-82><a class=lnlinks href=#hl-36-82> 82</a>
</span><span class=lnt id=hl-36-83><a class=lnlinks href=#hl-36-83> 83</a>
</span><span class=lnt id=hl-36-84><a class=lnlinks href=#hl-36-84> 84</a>
</span><span class=lnt id=hl-36-85><a class=lnlinks href=#hl-36-85> 85</a>
</span><span class=lnt id=hl-36-86><a class=lnlinks href=#hl-36-86> 86</a>
</span><span class=lnt id=hl-36-87><a class=lnlinks href=#hl-36-87> 87</a>
</span><span class=lnt id=hl-36-88><a class=lnlinks href=#hl-36-88> 88</a>
</span><span class=lnt id=hl-36-89><a class=lnlinks href=#hl-36-89> 89</a>
</span><span class=lnt id=hl-36-90><a class=lnlinks href=#hl-36-90> 90</a>
</span><span class=lnt id=hl-36-91><a class=lnlinks href=#hl-36-91> 91</a>
</span><span class=lnt id=hl-36-92><a class=lnlinks href=#hl-36-92> 92</a>
</span><span class=lnt id=hl-36-93><a class=lnlinks href=#hl-36-93> 93</a>
</span><span class=lnt id=hl-36-94><a class=lnlinks href=#hl-36-94> 94</a>
</span><span class=lnt id=hl-36-95><a class=lnlinks href=#hl-36-95> 95</a>
</span><span class=lnt id=hl-36-96><a class=lnlinks href=#hl-36-96> 96</a>
</span><span class=lnt id=hl-36-97><a class=lnlinks href=#hl-36-97> 97</a>
</span><span class=lnt id=hl-36-98><a class=lnlinks href=#hl-36-98> 98</a>
</span><span class=lnt id=hl-36-99><a class=lnlinks href=#hl-36-99> 99</a>
</span><span class=lnt id=hl-36-100><a class=lnlinks href=#hl-36-100>100</a>
</span><span class=lnt id=hl-36-101><a class=lnlinks href=#hl-36-101>101</a>
</span><span class=lnt id=hl-36-102><a class=lnlinks href=#hl-36-102>102</a>
</span><span class=lnt id=hl-36-103><a class=lnlinks href=#hl-36-103>103</a>
</span><span class=lnt id=hl-36-104><a class=lnlinks href=#hl-36-104>104</a>
</span><span class=lnt id=hl-36-105><a class=lnlinks href=#hl-36-105>105</a>
</span><span class=lnt id=hl-36-106><a class=lnlinks href=#hl-36-106>106</a>
</span><span class=lnt id=hl-36-107><a class=lnlinks href=#hl-36-107>107</a>
</span><span class=lnt id=hl-36-108><a class=lnlinks href=#hl-36-108>108</a>
</span><span class=lnt id=hl-36-109><a class=lnlinks href=#hl-36-109>109</a>
</span><span class=lnt id=hl-36-110><a class=lnlinks href=#hl-36-110>110</a>
</span><span class=lnt id=hl-36-111><a class=lnlinks href=#hl-36-111>111</a>
</span><span class=lnt id=hl-36-112><a class=lnlinks href=#hl-36-112>112</a>
</span><span class=lnt id=hl-36-113><a class=lnlinks href=#hl-36-113>113</a>
</span><span class=lnt id=hl-36-114><a class=lnlinks href=#hl-36-114>114</a>
</span><span class=lnt id=hl-36-115><a class=lnlinks href=#hl-36-115>115</a>
</span><span class=lnt id=hl-36-116><a class=lnlinks href=#hl-36-116>116</a>
</span><span class=lnt id=hl-36-117><a class=lnlinks href=#hl-36-117>117</a>
</span><span class=lnt id=hl-36-118><a class=lnlinks href=#hl-36-118>118</a>
</span><span class=lnt id=hl-36-119><a class=lnlinks href=#hl-36-119>119</a>
</span><span class=lnt id=hl-36-120><a class=lnlinks href=#hl-36-120>120</a>
</span><span class=lnt id=hl-36-121><a class=lnlinks href=#hl-36-121>121</a>
</span><span class=lnt id=hl-36-122><a class=lnlinks href=#hl-36-122>122</a>
</span><span class=lnt id=hl-36-123><a class=lnlinks href=#hl-36-123>123</a>
</span><span class=lnt id=hl-36-124><a class=lnlinks href=#hl-36-124>124</a>
</span><span class=lnt id=hl-36-125><a class=lnlinks href=#hl-36-125>125</a>
</span><span class=lnt id=hl-36-126><a class=lnlinks href=#hl-36-126>126</a>
</span><span class=lnt id=hl-36-127><a class=lnlinks href=#hl-36-127>127</a>
</span><span class=lnt id=hl-36-128><a class=lnlinks href=#hl-36-128>128</a>
</span><span class=lnt id=hl-36-129><a class=lnlinks href=#hl-36-129>129</a>
</span><span class=lnt id=hl-36-130><a class=lnlinks href=#hl-36-130>130</a>
</span><span class=lnt id=hl-36-131><a class=lnlinks href=#hl-36-131>131</a>
</span><span class=lnt id=hl-36-132><a class=lnlinks href=#hl-36-132>132</a>
</span><span class=lnt id=hl-36-133><a class=lnlinks href=#hl-36-133>133</a>
</span><span class=lnt id=hl-36-134><a class=lnlinks href=#hl-36-134>134</a>
</span><span class=lnt id=hl-36-135><a class=lnlinks href=#hl-36-135>135</a>
</span><span class=lnt id=hl-36-136><a class=lnlinks href=#hl-36-136>136</a>
</span><span class=lnt id=hl-36-137><a class=lnlinks href=#hl-36-137>137</a>
</span><span class=lnt id=hl-36-138><a class=lnlinks href=#hl-36-138>138</a>
</span><span class=lnt id=hl-36-139><a class=lnlinks href=#hl-36-139>139</a>
</span><span class=lnt id=hl-36-140><a class=lnlinks href=#hl-36-140>140</a>
</span><span class=lnt id=hl-36-141><a class=lnlinks href=#hl-36-141>141</a>
</span><span class=lnt id=hl-36-142><a class=lnlinks href=#hl-36-142>142</a>
</span><span class=lnt id=hl-36-143><a class=lnlinks href=#hl-36-143>143</a>
</span><span class=lnt id=hl-36-144><a class=lnlinks href=#hl-36-144>144</a>
</span><span class=lnt id=hl-36-145><a class=lnlinks href=#hl-36-145>145</a>
</span><span class=lnt id=hl-36-146><a class=lnlinks href=#hl-36-146>146</a>
</span><span class=lnt id=hl-36-147><a class=lnlinks href=#hl-36-147>147</a>
</span><span class=lnt id=hl-36-148><a class=lnlinks href=#hl-36-148>148</a>
</span><span class=lnt id=hl-36-149><a class=lnlinks href=#hl-36-149>149</a>
</span><span class=lnt id=hl-36-150><a class=lnlinks href=#hl-36-150>150</a>
</span><span class=lnt id=hl-36-151><a class=lnlinks href=#hl-36-151>151</a>
</span><span class=lnt id=hl-36-152><a class=lnlinks href=#hl-36-152>152</a>
</span><span class=lnt id=hl-36-153><a class=lnlinks href=#hl-36-153>153</a>
</span><span class=lnt id=hl-36-154><a class=lnlinks href=#hl-36-154>154</a>
</span><span class=lnt id=hl-36-155><a class=lnlinks href=#hl-36-155>155</a>
</span><span class=lnt id=hl-36-156><a class=lnlinks href=#hl-36-156>156</a>
</span><span class=lnt id=hl-36-157><a class=lnlinks href=#hl-36-157>157</a>
</span><span class=lnt id=hl-36-158><a class=lnlinks href=#hl-36-158>158</a>
</span><span class=lnt id=hl-36-159><a class=lnlinks href=#hl-36-159>159</a>
</span><span class=lnt id=hl-36-160><a class=lnlinks href=#hl-36-160>160</a>
</span><span class=lnt id=hl-36-161><a class=lnlinks href=#hl-36-161>161</a>
</span><span class=lnt id=hl-36-162><a class=lnlinks href=#hl-36-162>162</a>
</span><span class=lnt id=hl-36-163><a class=lnlinks href=#hl-36-163>163</a>
</span><span class=lnt id=hl-36-164><a class=lnlinks href=#hl-36-164>164</a>
</span><span class=lnt id=hl-36-165><a class=lnlinks href=#hl-36-165>165</a>
</span><span class=lnt id=hl-36-166><a class=lnlinks href=#hl-36-166>166</a>
</span><span class=lnt id=hl-36-167><a class=lnlinks href=#hl-36-167>167</a>
</span><span class=lnt id=hl-36-168><a class=lnlinks href=#hl-36-168>168</a>
</span><span class=lnt id=hl-36-169><a class=lnlinks href=#hl-36-169>169</a>
</span><span class=lnt id=hl-36-170><a class=lnlinks href=#hl-36-170>170</a>
</span><span class=lnt id=hl-36-171><a class=lnlinks href=#hl-36-171>171</a>
</span><span class=lnt id=hl-36-172><a class=lnlinks href=#hl-36-172>172</a>
</span><span class=lnt id=hl-36-173><a class=lnlinks href=#hl-36-173>173</a>
</span><span class=lnt id=hl-36-174><a class=lnlinks href=#hl-36-174>174</a>
</span><span class=lnt id=hl-36-175><a class=lnlinks href=#hl-36-175>175</a>
</span><span class=lnt id=hl-36-176><a class=lnlinks href=#hl-36-176>176</a>
</span><span class=lnt id=hl-36-177><a class=lnlinks href=#hl-36-177>177</a>
</span><span class=lnt id=hl-36-178><a class=lnlinks href=#hl-36-178>178</a>
</span><span class=lnt id=hl-36-179><a class=lnlinks href=#hl-36-179>179</a>
</span><span class=lnt id=hl-36-180><a class=lnlinks href=#hl-36-180>180</a>
</span><span class=lnt id=hl-36-181><a class=lnlinks href=#hl-36-181>181</a>
</span><span class=lnt id=hl-36-182><a class=lnlinks href=#hl-36-182>182</a>
</span><span class=lnt id=hl-36-183><a class=lnlinks href=#hl-36-183>183</a>
</span><span class=lnt id=hl-36-184><a class=lnlinks href=#hl-36-184>184</a>
</span><span class=lnt id=hl-36-185><a class=lnlinks href=#hl-36-185>185</a>
</span><span class=lnt id=hl-36-186><a class=lnlinks href=#hl-36-186>186</a>
</span><span class=lnt id=hl-36-187><a class=lnlinks href=#hl-36-187>187</a>
</span><span class=lnt id=hl-36-188><a class=lnlinks href=#hl-36-188>188</a>
</span><span class=lnt id=hl-36-189><a class=lnlinks href=#hl-36-189>189</a>
</span><span class=lnt id=hl-36-190><a class=lnlinks href=#hl-36-190>190</a>
</span><span class=lnt id=hl-36-191><a class=lnlinks href=#hl-36-191>191</a>
</span><span class=lnt id=hl-36-192><a class=lnlinks href=#hl-36-192>192</a>
</span><span class=lnt id=hl-36-193><a class=lnlinks href=#hl-36-193>193</a>
</span><span class=lnt id=hl-36-194><a class=lnlinks href=#hl-36-194>194</a>
</span><span class=lnt id=hl-36-195><a class=lnlinks href=#hl-36-195>195</a>
</span><span class=lnt id=hl-36-196><a class=lnlinks href=#hl-36-196>196</a>
</span><span class=lnt id=hl-36-197><a class=lnlinks href=#hl-36-197>197</a>
</span><span class=lnt id=hl-36-198><a class=lnlinks href=#hl-36-198>198</a>
</span><span class=lnt id=hl-36-199><a class=lnlinks href=#hl-36-199>199</a>
</span><span class=lnt id=hl-36-200><a class=lnlinks href=#hl-36-200>200</a>
</span><span class=lnt id=hl-36-201><a class=lnlinks href=#hl-36-201>201</a>
</span><span class=lnt id=hl-36-202><a class=lnlinks href=#hl-36-202>202</a>
</span><span class=lnt id=hl-36-203><a class=lnlinks href=#hl-36-203>203</a>
</span><span class=lnt id=hl-36-204><a class=lnlinks href=#hl-36-204>204</a>
</span><span class=lnt id=hl-36-205><a class=lnlinks href=#hl-36-205>205</a>
</span><span class=lnt id=hl-36-206><a class=lnlinks href=#hl-36-206>206</a>
</span><span class=lnt id=hl-36-207><a class=lnlinks href=#hl-36-207>207</a>
</span><span class=lnt id=hl-36-208><a class=lnlinks href=#hl-36-208>208</a>
</span><span class=lnt id=hl-36-209><a class=lnlinks href=#hl-36-209>209</a>
</span><span class=lnt id=hl-36-210><a class=lnlinks href=#hl-36-210>210</a>
</span><span class=lnt id=hl-36-211><a class=lnlinks href=#hl-36-211>211</a>
</span><span class=lnt id=hl-36-212><a class=lnlinks href=#hl-36-212>212</a>
</span><span class=lnt id=hl-36-213><a class=lnlinks href=#hl-36-213>213</a>
</span><span class=lnt id=hl-36-214><a class=lnlinks href=#hl-36-214>214</a>
</span><span class=lnt id=hl-36-215><a class=lnlinks href=#hl-36-215>215</a>
</span><span class=lnt id=hl-36-216><a class=lnlinks href=#hl-36-216>216</a>
</span><span class=lnt id=hl-36-217><a class=lnlinks href=#hl-36-217>217</a>
</span><span class=lnt id=hl-36-218><a class=lnlinks href=#hl-36-218>218</a>
</span><span class=lnt id=hl-36-219><a class=lnlinks href=#hl-36-219>219</a>
</span><span class=lnt id=hl-36-220><a class=lnlinks href=#hl-36-220>220</a>
</span><span class=lnt id=hl-36-221><a class=lnlinks href=#hl-36-221>221</a>
</span><span class=lnt id=hl-36-222><a class=lnlinks href=#hl-36-222>222</a>
</span><span class=lnt id=hl-36-223><a class=lnlinks href=#hl-36-223>223</a>
</span><span class=lnt id=hl-36-224><a class=lnlinks href=#hl-36-224>224</a>
</span><span class=lnt id=hl-36-225><a class=lnlinks href=#hl-36-225>225</a>
</span><span class=lnt id=hl-36-226><a class=lnlinks href=#hl-36-226>226</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// TypeScript에서 장애 복원력 패턴 구현 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>Channel</span><span class=p>,</span> <span class=nx>Connection</span><span class=p>,</span> <span class=nx>connect</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;amqplib&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ResilientEmailService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>connection</span>: <span class=kt>Connection</span> <span class=o>|</span> <span class=kc>null</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>channel</span>: <span class=kt>Channel</span> <span class=o>|</span> <span class=kc>null</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>maxRetries</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>isConnecting</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>pendingMessages</span>: <span class=kt>any</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 연결 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>setupConnection</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isConnecting</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>isConnecting</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// RabbitMQ 연결
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;amqp://localhost&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 연결 오류 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 연결 오류:&#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>resetConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 연결이 닫혔습니다. 재연결 시도 중...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>resetConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>(),</span> <span class=mi>5000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 채널 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 이메일 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;emails&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span>: <span class=kt>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 재시도 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;emails.retry&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>durable</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>arguments</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;x-dead-letter-exchange&#39;</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;x-dead-letter-routing-key&#39;</span><span class=o>:</span> <span class=s1>&#39;emails&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;x-message-ttl&#39;</span><span class=o>:</span> <span class=mi>60000</span>  <span class=c1>// 1분 후 재시도
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 데드 레터 큐 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=s1>&#39;emails.failed&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span>: <span class=kt>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 연결 및 채널 설정 완료&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 대기 중인 메시지 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>processPendingMessages</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 연결 설정 실패:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>resetConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>(),</span> <span class=mi>5000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>isConnecting</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 연결 리셋
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>private</span> <span class=nx>resetConnection</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 대기 중인 메시지 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>private</span> <span class=kr>async</span> <span class=nx>processPendingMessages</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>||</span> <span class=k>this</span><span class=p>.</span><span class=nx>pendingMessages</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>messages</span> <span class=o>=</span> <span class=p>[...</span><span class=k>this</span><span class=p>.</span><span class=nx>pendingMessages</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>pendingMessages</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>msg</span> <span class=k>of</span> <span class=nx>messages</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendEmailToQueue</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>email</span><span class=p>,</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>retryCount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 이메일 메시지를 큐에 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>sendEmail</span><span class=p>(</span><span class=nx>to</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>subject</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>body</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>email</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>to</span><span class=p>,</span> <span class=nx>subject</span><span class=p>,</span> <span class=nx>body</span><span class=p>,</span> <span class=nx>timestamp</span>: <span class=kt>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 여전히 연결이 없는 경우 대기 중인 메시지에 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>pendingMessages</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=nx>email</span><span class=p>,</span> <span class=nx>retryCount</span>: <span class=kt>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendEmailToQueue</span><span class=p>(</span><span class=nx>email</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;이메일 전송 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 오류 발생 시 대기 중인 메시지에 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>pendingMessages</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=nx>email</span><span class=p>,</span> <span class=nx>retryCount</span>: <span class=kt>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 연결 재설정 시도
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>resetConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>(),</span> <span class=mi>5000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 이메일을 큐에 실제로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>private</span> <span class=kr>async</span> <span class=nx>sendEmailToQueue</span><span class=p>(</span><span class=nx>email</span>: <span class=kt>any</span><span class=p>,</span> <span class=nx>retryCount</span>: <span class=kt>number</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 채널이 설정되지 않았습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>...</span><span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>retryCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>sentAt</span>: <span class=kt>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메시지를 이메일 큐에 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>sendToQueue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;emails&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>message</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>persistent</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;x-retry-count&#39;</span><span class=o>:</span> <span class=nx>retryCount</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일이 큐에 전송됨: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>, 재시도: </span><span class=si>${</span><span class=nx>retryCount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 이메일 소비자 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>setupConsumer</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 채널이 설정되지 않았습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 이메일 처리를 위한 소비자 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>prefetch</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>consume</span><span class=p>(</span><span class=s1>&#39;emails&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>msg</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>email</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 처리 중: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 실제 이메일 전송 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>success</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>deliverEmail</span><span class=p>(</span><span class=nx>email</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 성공적으로 처리됨
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 전송 성공: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 전송 실패, 재시도 필요
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>const</span> <span class=nx>retryCount</span> <span class=o>=</span> <span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>properties</span><span class=p>.</span><span class=nx>headers</span><span class=p>[</span><span class=s1>&#39;x-retry-count&#39;</span><span class=p>]</span> <span class=o>||</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>retryCount</span> <span class=o>&lt;=</span> <span class=k>this</span><span class=p>.</span><span class=nx>maxRetries</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 재시도 큐로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;emails.retry&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>persistent</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;x-retry-count&#39;</span><span class=o>:</span> <span class=nx>retryCount</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 재시도 예약 (</span><span class=si>${</span><span class=nx>retryCount</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>maxRetries</span><span class=si>}</span><span class=sb>): </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 최대 재시도 횟수 초과, 실패 큐로 이동
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;emails.failed&#39;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>,</span> <span class=p>{</span> <span class=nx>persistent</span>: <span class=kt>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 전송 실패, 데드 레터로 이동: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;이메일 처리 중 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 처리 오류, 데드 레터 큐로 이동
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=o>?</span><span class=p>.</span><span class=nx>nack</span><span class=p>(</span><span class=nx>msg</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;이메일 소비자가 시작되었습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 실제 이메일 전송 로직 (외부 서비스 호출)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>private</span> <span class=kr>async</span> <span class=nx>deliverEmail</span><span class=p>(</span><span class=nx>email</span>: <span class=kt>any</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>boolean</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 실제로는 SMTP 서비스 등을 호출
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 전송 시도: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>, 제목: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>subject</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 성공/실패 시뮬레이션 (80% 성공률)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>isSuccessful</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mf>0.2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>isSuccessful</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이메일 전송 일시적 실패: </span><span class=si>${</span><span class=nx>email</span><span class=p>.</span><span class=nx>to</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`이메일 전송 중 오류: </span><span class=si>${</span><span class=nx>error</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main() {</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>emailService</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ResilientEmailService</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>await</span> <span class=nx>emailService</span><span class=p>.</span><span class=nx>setupConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>await</span> <span class=nx>emailService</span><span class=p>.</span><span class=nx>setupConsumer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 이메일 전송 테스트
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>await</span> <span class=nx>emailService</span><span class=p>.</span><span class=nx>sendEmail</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;user@example.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;중요 알림&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;귀하의 계정에 중요한 변경사항이 있습니다.&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>main</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐-구현-시-고려사항>메시징 큐 구현 시 고려사항<a hidden class=anchor aria-hidden=true href=#메시징-큐-구현-시-고려사항>#</a></h3><h4 id=메시지-보장성delivery-guarantees>메시지 보장성(Delivery Guarantees)<a hidden class=anchor aria-hidden=true href=#메시지-보장성delivery-guarantees>#</a></h4><p>메시지 전송의 보장 수준에 따라 시스템 설계가 달라진다.</p><ul><li><strong>At-most-once 전달</strong>: 메시지가 최대 한 번 전달되거나 손실될 수 있음 (최소한의 오버헤드)</li><li><strong>At-least-once 전달</strong>: 메시지가 최소 한 번 전달되지만 중복 가능성 있음 (멱등성 필요)</li><li><strong>Exactly-once 전달</strong>: 메시지가 정확히 한 번 전달됨 (가장 높은 오버헤드)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a>
</span><span class=lnt id=hl-37-12><a class=lnlinks href=#hl-37-12>12</a>
</span><span class=lnt id=hl-37-13><a class=lnlinks href=#hl-37-13>13</a>
</span><span class=lnt id=hl-37-14><a class=lnlinks href=#hl-37-14>14</a>
</span><span class=lnt id=hl-37-15><a class=lnlinks href=#hl-37-15>15</a>
</span><span class=lnt id=hl-37-16><a class=lnlinks href=#hl-37-16>16</a>
</span><span class=lnt id=hl-37-17><a class=lnlinks href=#hl-37-17>17</a>
</span><span class=lnt id=hl-37-18><a class=lnlinks href=#hl-37-18>18</a>
</span><span class=lnt id=hl-37-19><a class=lnlinks href=#hl-37-19>19</a>
</span><span class=lnt id=hl-37-20><a class=lnlinks href=#hl-37-20>20</a>
</span><span class=lnt id=hl-37-21><a class=lnlinks href=#hl-37-21>21</a>
</span><span class=lnt id=hl-37-22><a class=lnlinks href=#hl-37-22>22</a>
</span><span class=lnt id=hl-37-23><a class=lnlinks href=#hl-37-23>23</a>
</span><span class=lnt id=hl-37-24><a class=lnlinks href=#hl-37-24>24</a>
</span><span class=lnt id=hl-37-25><a class=lnlinks href=#hl-37-25>25</a>
</span><span class=lnt id=hl-37-26><a class=lnlinks href=#hl-37-26>26</a>
</span><span class=lnt id=hl-37-27><a class=lnlinks href=#hl-37-27>27</a>
</span><span class=lnt id=hl-37-28><a class=lnlinks href=#hl-37-28>28</a>
</span><span class=lnt id=hl-37-29><a class=lnlinks href=#hl-37-29>29</a>
</span><span class=lnt id=hl-37-30><a class=lnlinks href=#hl-37-30>30</a>
</span><span class=lnt id=hl-37-31><a class=lnlinks href=#hl-37-31>31</a>
</span><span class=lnt id=hl-37-32><a class=lnlinks href=#hl-37-32>32</a>
</span><span class=lnt id=hl-37-33><a class=lnlinks href=#hl-37-33>33</a>
</span><span class=lnt id=hl-37-34><a class=lnlinks href=#hl-37-34>34</a>
</span><span class=lnt id=hl-37-35><a class=lnlinks href=#hl-37-35>35</a>
</span><span class=lnt id=hl-37-36><a class=lnlinks href=#hl-37-36>36</a>
</span><span class=lnt id=hl-37-37><a class=lnlinks href=#hl-37-37>37</a>
</span><span class=lnt id=hl-37-38><a class=lnlinks href=#hl-37-38>38</a>
</span><span class=lnt id=hl-37-39><a class=lnlinks href=#hl-37-39>39</a>
</span><span class=lnt id=hl-37-40><a class=lnlinks href=#hl-37-40>40</a>
</span><span class=lnt id=hl-37-41><a class=lnlinks href=#hl-37-41>41</a>
</span><span class=lnt id=hl-37-42><a class=lnlinks href=#hl-37-42>42</a>
</span><span class=lnt id=hl-37-43><a class=lnlinks href=#hl-37-43>43</a>
</span><span class=lnt id=hl-37-44><a class=lnlinks href=#hl-37-44>44</a>
</span><span class=lnt id=hl-37-45><a class=lnlinks href=#hl-37-45>45</a>
</span><span class=lnt id=hl-37-46><a class=lnlinks href=#hl-37-46>46</a>
</span><span class=lnt id=hl-37-47><a class=lnlinks href=#hl-37-47>47</a>
</span><span class=lnt id=hl-37-48><a class=lnlinks href=#hl-37-48>48</a>
</span><span class=lnt id=hl-37-49><a class=lnlinks href=#hl-37-49>49</a>
</span><span class=lnt id=hl-37-50><a class=lnlinks href=#hl-37-50>50</a>
</span><span class=lnt id=hl-37-51><a class=lnlinks href=#hl-37-51>51</a>
</span><span class=lnt id=hl-37-52><a class=lnlinks href=#hl-37-52>52</a>
</span><span class=lnt id=hl-37-53><a class=lnlinks href=#hl-37-53>53</a>
</span><span class=lnt id=hl-37-54><a class=lnlinks href=#hl-37-54>54</a>
</span><span class=lnt id=hl-37-55><a class=lnlinks href=#hl-37-55>55</a>
</span><span class=lnt id=hl-37-56><a class=lnlinks href=#hl-37-56>56</a>
</span><span class=lnt id=hl-37-57><a class=lnlinks href=#hl-37-57>57</a>
</span><span class=lnt id=hl-37-58><a class=lnlinks href=#hl-37-58>58</a>
</span><span class=lnt id=hl-37-59><a class=lnlinks href=#hl-37-59>59</a>
</span><span class=lnt id=hl-37-60><a class=lnlinks href=#hl-37-60>60</a>
</span><span class=lnt id=hl-37-61><a class=lnlinks href=#hl-37-61>61</a>
</span><span class=lnt id=hl-37-62><a class=lnlinks href=#hl-37-62>62</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// At-least-once 전송을 위한 Java Spring 설정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RabbitMQConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ConnectionFactory</span><span class=w> </span><span class=nf>connectionFactory</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CachingConnectionFactory</span><span class=w> </span><span class=n>connectionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CachingConnectionFactory</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>connectionFactory</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;guest&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>connectionFactory</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;guest&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 게시자 확인 활성화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>connectionFactory</span><span class=p>.</span><span class=na>setPublisherConfirmType</span><span class=p>(</span><span class=n>CachingConnectionFactory</span><span class=p>.</span><span class=na>ConfirmType</span><span class=p>.</span><span class=na>CORRELATED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>connectionFactory</span><span class=p>.</span><span class=na>setPublisherReturns</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>connectionFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=nf>rabbitTemplate</span><span class=p>(</span><span class=n>ConnectionFactory</span><span class=w> </span><span class=n>connectionFactory</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>template</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=p>(</span><span class=n>connectionFactory</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>template</span><span class=p>.</span><span class=na>setMandatory</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 게시자 확인 콜백</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>template</span><span class=p>.</span><span class=na>setConfirmCallback</span><span class=p>((</span><span class=n>correlationData</span><span class=p>,</span><span class=w> </span><span class=n>ack</span><span class=p>,</span><span class=w> </span><span class=n>cause</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ack</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;메시지가 브로커에 성공적으로 전달됨&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;메시지 전달 실패: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>cause</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 여기서 메시지 재시도 로직 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 반환된 메시지 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>template</span><span class=p>.</span><span class=na>setReturnsCallback</span><span class=p>(</span><span class=n>returned</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;메시지 반환됨: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>returned</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;, replyCode: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>returned</span><span class=p>.</span><span class=na>getReplyCode</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;, replyText: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>returned</span><span class=p>.</span><span class=na>getReplyText</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;, exchange: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>returned</span><span class=p>.</span><span class=na>getExchange</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;, routingKey: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>returned</span><span class=p>.</span><span class=na>getRoutingKey</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 라우팅 실패 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>template</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>SimpleRabbitListenerContainerFactory</span><span class=w> </span><span class=nf>rabbitListenerContainerFactory</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ConnectionFactory</span><span class=w> </span><span class=n>connectionFactory</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>SimpleRabbitListenerContainerFactory</span><span class=w> </span><span class=n>factory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SimpleRabbitListenerContainerFactory</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setConnectionFactory</span><span class=p>(</span><span class=n>connectionFactory</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 자동 확인 비활성화 (수동 확인 사용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setAcknowledgeMode</span><span class=p>(</span><span class=n>AcknowledgeMode</span><span class=p>.</span><span class=na>MANUAL</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 동시성 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setConcurrentConsumers</span><span class=p>(</span><span class=n>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setMaxConcurrentConsumers</span><span class=p>(</span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 소비자 당 메시지 수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>factory</span><span class=p>.</span><span class=na>setPrefetchCount</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>factory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=메시지-순서ordering>메시지 순서(Ordering)<a hidden class=anchor aria-hidden=true href=#메시지-순서ordering>#</a></h4><p>특정 시나리오에서는 메시지 처리 순서가 중요할 수 있다.</p><p>순서 보장을 위한 전략은 다음과 같다.</p><ul><li>동일한 파티션 키(Partition Key)를 사용하여 관련 메시지가 같은 소비자에게 전달</li><li>순차 번호(Sequence Number)를 메시지에 포함하여 소비자가 순서를 확인</li><li>단일 소비자 모델 사용 (확장성 제한)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1> 1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2> 2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3> 3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4> 4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5> 5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6> 6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7> 7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8> 8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9> 9</a>
</span><span class=lnt id=hl-38-10><a class=lnlinks href=#hl-38-10>10</a>
</span><span class=lnt id=hl-38-11><a class=lnlinks href=#hl-38-11>11</a>
</span><span class=lnt id=hl-38-12><a class=lnlinks href=#hl-38-12>12</a>
</span><span class=lnt id=hl-38-13><a class=lnlinks href=#hl-38-13>13</a>
</span><span class=lnt id=hl-38-14><a class=lnlinks href=#hl-38-14>14</a>
</span><span class=lnt id=hl-38-15><a class=lnlinks href=#hl-38-15>15</a>
</span><span class=lnt id=hl-38-16><a class=lnlinks href=#hl-38-16>16</a>
</span><span class=lnt id=hl-38-17><a class=lnlinks href=#hl-38-17>17</a>
</span><span class=lnt id=hl-38-18><a class=lnlinks href=#hl-38-18>18</a>
</span><span class=lnt id=hl-38-19><a class=lnlinks href=#hl-38-19>19</a>
</span><span class=lnt id=hl-38-20><a class=lnlinks href=#hl-38-20>20</a>
</span><span class=lnt id=hl-38-21><a class=lnlinks href=#hl-38-21>21</a>
</span><span class=lnt id=hl-38-22><a class=lnlinks href=#hl-38-22>22</a>
</span><span class=lnt id=hl-38-23><a class=lnlinks href=#hl-38-23>23</a>
</span><span class=lnt id=hl-38-24><a class=lnlinks href=#hl-38-24>24</a>
</span><span class=lnt id=hl-38-25><a class=lnlinks href=#hl-38-25>25</a>
</span><span class=lnt id=hl-38-26><a class=lnlinks href=#hl-38-26>26</a>
</span><span class=lnt id=hl-38-27><a class=lnlinks href=#hl-38-27>27</a>
</span><span class=lnt id=hl-38-28><a class=lnlinks href=#hl-38-28>28</a>
</span><span class=lnt id=hl-38-29><a class=lnlinks href=#hl-38-29>29</a>
</span><span class=lnt id=hl-38-30><a class=lnlinks href=#hl-38-30>30</a>
</span><span class=lnt id=hl-38-31><a class=lnlinks href=#hl-38-31>31</a>
</span><span class=lnt id=hl-38-32><a class=lnlinks href=#hl-38-32>32</a>
</span><span class=lnt id=hl-38-33><a class=lnlinks href=#hl-38-33>33</a>
</span><span class=lnt id=hl-38-34><a class=lnlinks href=#hl-38-34>34</a>
</span><span class=lnt id=hl-38-35><a class=lnlinks href=#hl-38-35>35</a>
</span><span class=lnt id=hl-38-36><a class=lnlinks href=#hl-38-36>36</a>
</span><span class=lnt id=hl-38-37><a class=lnlinks href=#hl-38-37>37</a>
</span><span class=lnt id=hl-38-38><a class=lnlinks href=#hl-38-38>38</a>
</span><span class=lnt id=hl-38-39><a class=lnlinks href=#hl-38-39>39</a>
</span><span class=lnt id=hl-38-40><a class=lnlinks href=#hl-38-40>40</a>
</span><span class=lnt id=hl-38-41><a class=lnlinks href=#hl-38-41>41</a>
</span><span class=lnt id=hl-38-42><a class=lnlinks href=#hl-38-42>42</a>
</span><span class=lnt id=hl-38-43><a class=lnlinks href=#hl-38-43>43</a>
</span><span class=lnt id=hl-38-44><a class=lnlinks href=#hl-38-44>44</a>
</span><span class=lnt id=hl-38-45><a class=lnlinks href=#hl-38-45>45</a>
</span><span class=lnt id=hl-38-46><a class=lnlinks href=#hl-38-46>46</a>
</span><span class=lnt id=hl-38-47><a class=lnlinks href=#hl-38-47>47</a>
</span><span class=lnt id=hl-38-48><a class=lnlinks href=#hl-38-48>48</a>
</span><span class=lnt id=hl-38-49><a class=lnlinks href=#hl-38-49>49</a>
</span><span class=lnt id=hl-38-50><a class=lnlinks href=#hl-38-50>50</a>
</span><span class=lnt id=hl-38-51><a class=lnlinks href=#hl-38-51>51</a>
</span><span class=lnt id=hl-38-52><a class=lnlinks href=#hl-38-52>52</a>
</span><span class=lnt id=hl-38-53><a class=lnlinks href=#hl-38-53>53</a>
</span><span class=lnt id=hl-38-54><a class=lnlinks href=#hl-38-54>54</a>
</span><span class=lnt id=hl-38-55><a class=lnlinks href=#hl-38-55>55</a>
</span><span class=lnt id=hl-38-56><a class=lnlinks href=#hl-38-56>56</a>
</span><span class=lnt id=hl-38-57><a class=lnlinks href=#hl-38-57>57</a>
</span><span class=lnt id=hl-38-58><a class=lnlinks href=#hl-38-58>58</a>
</span><span class=lnt id=hl-38-59><a class=lnlinks href=#hl-38-59>59</a>
</span><span class=lnt id=hl-38-60><a class=lnlinks href=#hl-38-60>60</a>
</span><span class=lnt id=hl-38-61><a class=lnlinks href=#hl-38-61>61</a>
</span><span class=lnt id=hl-38-62><a class=lnlinks href=#hl-38-62>62</a>
</span><span class=lnt id=hl-38-63><a class=lnlinks href=#hl-38-63>63</a>
</span><span class=lnt id=hl-38-64><a class=lnlinks href=#hl-38-64>64</a>
</span><span class=lnt id=hl-38-65><a class=lnlinks href=#hl-38-65>65</a>
</span><span class=lnt id=hl-38-66><a class=lnlinks href=#hl-38-66>66</a>
</span><span class=lnt id=hl-38-67><a class=lnlinks href=#hl-38-67>67</a>
</span><span class=lnt id=hl-38-68><a class=lnlinks href=#hl-38-68>68</a>
</span><span class=lnt id=hl-38-69><a class=lnlinks href=#hl-38-69>69</a>
</span><span class=lnt id=hl-38-70><a class=lnlinks href=#hl-38-70>70</a>
</span><span class=lnt id=hl-38-71><a class=lnlinks href=#hl-38-71>71</a>
</span><span class=lnt id=hl-38-72><a class=lnlinks href=#hl-38-72>72</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// C#에서 메시지 순서 보장 구현 예시</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderedMessageProcessor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ConcurrentDictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=n>SemaphoreSlim</span><span class=p>&gt;</span> <span class=n>_entityLocks</span> <span class=p>=</span> <span class=k>new</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ConcurrentDictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=kt>long</span><span class=p>&gt;</span> <span class=n>_lastProcessedSequence</span> <span class=p>=</span> <span class=k>new</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>ProcessMessageAsync</span><span class=p>(</span><span class=n>Message</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 파티션 키 추출 (예: 고객 ID)</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>partitionKey</span> <span class=p>=</span> <span class=n>message</span><span class=p>.</span><span class=n>Headers</span><span class=p>[</span><span class=s>&#34;partition-key&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>sequenceNumber</span> <span class=p>=</span> <span class=kt>long</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=n>Headers</span><span class=p>[</span><span class=s>&#34;sequence-number&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 엔티티별 잠금 획득</span>
</span></span><span class=line><span class=cl>        <span class=n>SemaphoreSlim</span> <span class=n>entityLock</span> <span class=p>=</span> <span class=n>_entityLocks</span><span class=p>.</span><span class=n>GetOrAdd</span><span class=p>(</span><span class=n>partitionKey</span><span class=p>,</span> <span class=n>_</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=n>SemaphoreSlim</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=m>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>entityLock</span><span class=p>.</span><span class=n>WaitAsync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 마지막으로 처리된 시퀀스 번호 확인</span>
</span></span><span class=line><span class=cl>            <span class=n>_lastProcessedSequence</span><span class=p>.</span><span class=n>TryGetValue</span><span class=p>(</span><span class=n>partitionKey</span><span class=p>,</span> <span class=k>out</span> <span class=kt>long</span> <span class=n>lastSequence</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 순서가 맞지 않는 메시지는 지연 처리 또는 거부</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>sequenceNumber</span> <span class=p>&lt;</span> <span class=n>lastSequence</span> <span class=p>+</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 이미 처리된 메시지 - 무시</span>
</span></span><span class=line><span class=cl>                <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>$&#34;이미 처리된 메시지 무시: {partitionKey}, 시퀀스: {sequenceNumber}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>sequenceNumber</span> <span class=p>&gt;</span> <span class=n>lastSequence</span> <span class=p>+</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 순서가 맞지 않는 메시지 - 다시 큐에 넣거나 지연 처리</span>
</span></span><span class=line><span class=cl>                <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>$&#34;순서가 맞지 않는 메시지: {partitionKey}, 예상: {lastSequence + 1}, 실제: {sequenceNumber}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=n>OutOfOrderMessageException</span><span class=p>(</span><span class=n>partitionKey</span><span class=p>,</span> <span class=n>lastSequence</span> <span class=p>+</span> <span class=m>1</span><span class=p>,</span> <span class=n>sequenceNumber</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 정상적인 순서의 메시지 처리</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>ProcessMessageInternalAsync</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 처리된 시퀀스 번호 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=n>_lastProcessedSequence</span><span class=p>[</span><span class=n>partitionKey</span><span class=p>]</span> <span class=p>=</span> <span class=n>sequenceNumber</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>$&#34;메시지 처리 완료: {partitionKey}, 시퀀스: {sequenceNumber}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>entityLock</span><span class=p>.</span><span class=n>Release</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>ProcessMessageInternalAsync</span><span class=p>(</span><span class=n>Message</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 실제 메시지 처리 로직</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>messageBody</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>ToArray</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>$&#34;메시지 처리 중: {messageBody}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>Delay</span><span class=p>(</span><span class=m>100</span><span class=p>);</span>  <span class=c1>// 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 순서가 맞지 않는 메시지 예외</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OutOfOrderMessageException</span> <span class=p>:</span> <span class=n>Exception</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>PartitionKey</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>long</span> <span class=n>ExpectedSequence</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>long</span> <span class=n>ActualSequence</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>OutOfOrderMessageException</span><span class=p>(</span><span class=kt>string</span> <span class=n>partitionKey</span><span class=p>,</span> <span class=kt>long</span> <span class=n>expectedSequence</span><span class=p>,</span> <span class=kt>long</span> <span class=n>actualSequence</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>:</span> <span class=k>base</span><span class=p>(</span><span class=s>$&#34;순서가 맞지 않는 메시지: {partitionKey}, 예상: {expectedSequence}, 실제: {actualSequence}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>PartitionKey</span> <span class=p>=</span> <span class=n>partitionKey</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>ExpectedSequence</span> <span class=p>=</span> <span class=n>expectedSequence</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>ActualSequence</span> <span class=p>=</span> <span class=n>actualSequence</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=최적화>최적화<a hidden class=anchor aria-hidden=true href=#최적화>#</a></h4><p>메시징 시스템의 성능을 최적화하기 위한 주요 고려사항은 아래와 같다.</p><ul><li><strong>배치 처리(Batching)</strong>: 여러 메시지를 묶어서 전송하여 네트워크 오버헤드 감소</li><li><strong>미리 가져오기(Prefetching)</strong>: 소비자가 메시지를 미리 가져와 처리 지연 시간 감소</li><li><strong>압축(Compression)</strong>: 대용량 메시지 압축으로 네트워크 대역폭 절약</li><li><strong>동시성(Concurrency)</strong>: 적절한 수의 소비자 쓰레드로 처리량 최적화</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1>  1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2>  2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3>  3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4>  4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5>  5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6>  6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7>  7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8>  8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9>  9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10> 10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11> 11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12> 12</a>
</span><span class=lnt id=hl-39-13><a class=lnlinks href=#hl-39-13> 13</a>
</span><span class=lnt id=hl-39-14><a class=lnlinks href=#hl-39-14> 14</a>
</span><span class=lnt id=hl-39-15><a class=lnlinks href=#hl-39-15> 15</a>
</span><span class=lnt id=hl-39-16><a class=lnlinks href=#hl-39-16> 16</a>
</span><span class=lnt id=hl-39-17><a class=lnlinks href=#hl-39-17> 17</a>
</span><span class=lnt id=hl-39-18><a class=lnlinks href=#hl-39-18> 18</a>
</span><span class=lnt id=hl-39-19><a class=lnlinks href=#hl-39-19> 19</a>
</span><span class=lnt id=hl-39-20><a class=lnlinks href=#hl-39-20> 20</a>
</span><span class=lnt id=hl-39-21><a class=lnlinks href=#hl-39-21> 21</a>
</span><span class=lnt id=hl-39-22><a class=lnlinks href=#hl-39-22> 22</a>
</span><span class=lnt id=hl-39-23><a class=lnlinks href=#hl-39-23> 23</a>
</span><span class=lnt id=hl-39-24><a class=lnlinks href=#hl-39-24> 24</a>
</span><span class=lnt id=hl-39-25><a class=lnlinks href=#hl-39-25> 25</a>
</span><span class=lnt id=hl-39-26><a class=lnlinks href=#hl-39-26> 26</a>
</span><span class=lnt id=hl-39-27><a class=lnlinks href=#hl-39-27> 27</a>
</span><span class=lnt id=hl-39-28><a class=lnlinks href=#hl-39-28> 28</a>
</span><span class=lnt id=hl-39-29><a class=lnlinks href=#hl-39-29> 29</a>
</span><span class=lnt id=hl-39-30><a class=lnlinks href=#hl-39-30> 30</a>
</span><span class=lnt id=hl-39-31><a class=lnlinks href=#hl-39-31> 31</a>
</span><span class=lnt id=hl-39-32><a class=lnlinks href=#hl-39-32> 32</a>
</span><span class=lnt id=hl-39-33><a class=lnlinks href=#hl-39-33> 33</a>
</span><span class=lnt id=hl-39-34><a class=lnlinks href=#hl-39-34> 34</a>
</span><span class=lnt id=hl-39-35><a class=lnlinks href=#hl-39-35> 35</a>
</span><span class=lnt id=hl-39-36><a class=lnlinks href=#hl-39-36> 36</a>
</span><span class=lnt id=hl-39-37><a class=lnlinks href=#hl-39-37> 37</a>
</span><span class=lnt id=hl-39-38><a class=lnlinks href=#hl-39-38> 38</a>
</span><span class=lnt id=hl-39-39><a class=lnlinks href=#hl-39-39> 39</a>
</span><span class=lnt id=hl-39-40><a class=lnlinks href=#hl-39-40> 40</a>
</span><span class=lnt id=hl-39-41><a class=lnlinks href=#hl-39-41> 41</a>
</span><span class=lnt id=hl-39-42><a class=lnlinks href=#hl-39-42> 42</a>
</span><span class=lnt id=hl-39-43><a class=lnlinks href=#hl-39-43> 43</a>
</span><span class=lnt id=hl-39-44><a class=lnlinks href=#hl-39-44> 44</a>
</span><span class=lnt id=hl-39-45><a class=lnlinks href=#hl-39-45> 45</a>
</span><span class=lnt id=hl-39-46><a class=lnlinks href=#hl-39-46> 46</a>
</span><span class=lnt id=hl-39-47><a class=lnlinks href=#hl-39-47> 47</a>
</span><span class=lnt id=hl-39-48><a class=lnlinks href=#hl-39-48> 48</a>
</span><span class=lnt id=hl-39-49><a class=lnlinks href=#hl-39-49> 49</a>
</span><span class=lnt id=hl-39-50><a class=lnlinks href=#hl-39-50> 50</a>
</span><span class=lnt id=hl-39-51><a class=lnlinks href=#hl-39-51> 51</a>
</span><span class=lnt id=hl-39-52><a class=lnlinks href=#hl-39-52> 52</a>
</span><span class=lnt id=hl-39-53><a class=lnlinks href=#hl-39-53> 53</a>
</span><span class=lnt id=hl-39-54><a class=lnlinks href=#hl-39-54> 54</a>
</span><span class=lnt id=hl-39-55><a class=lnlinks href=#hl-39-55> 55</a>
</span><span class=lnt id=hl-39-56><a class=lnlinks href=#hl-39-56> 56</a>
</span><span class=lnt id=hl-39-57><a class=lnlinks href=#hl-39-57> 57</a>
</span><span class=lnt id=hl-39-58><a class=lnlinks href=#hl-39-58> 58</a>
</span><span class=lnt id=hl-39-59><a class=lnlinks href=#hl-39-59> 59</a>
</span><span class=lnt id=hl-39-60><a class=lnlinks href=#hl-39-60> 60</a>
</span><span class=lnt id=hl-39-61><a class=lnlinks href=#hl-39-61> 61</a>
</span><span class=lnt id=hl-39-62><a class=lnlinks href=#hl-39-62> 62</a>
</span><span class=lnt id=hl-39-63><a class=lnlinks href=#hl-39-63> 63</a>
</span><span class=lnt id=hl-39-64><a class=lnlinks href=#hl-39-64> 64</a>
</span><span class=lnt id=hl-39-65><a class=lnlinks href=#hl-39-65> 65</a>
</span><span class=lnt id=hl-39-66><a class=lnlinks href=#hl-39-66> 66</a>
</span><span class=lnt id=hl-39-67><a class=lnlinks href=#hl-39-67> 67</a>
</span><span class=lnt id=hl-39-68><a class=lnlinks href=#hl-39-68> 68</a>
</span><span class=lnt id=hl-39-69><a class=lnlinks href=#hl-39-69> 69</a>
</span><span class=lnt id=hl-39-70><a class=lnlinks href=#hl-39-70> 70</a>
</span><span class=lnt id=hl-39-71><a class=lnlinks href=#hl-39-71> 71</a>
</span><span class=lnt id=hl-39-72><a class=lnlinks href=#hl-39-72> 72</a>
</span><span class=lnt id=hl-39-73><a class=lnlinks href=#hl-39-73> 73</a>
</span><span class=lnt id=hl-39-74><a class=lnlinks href=#hl-39-74> 74</a>
</span><span class=lnt id=hl-39-75><a class=lnlinks href=#hl-39-75> 75</a>
</span><span class=lnt id=hl-39-76><a class=lnlinks href=#hl-39-76> 76</a>
</span><span class=lnt id=hl-39-77><a class=lnlinks href=#hl-39-77> 77</a>
</span><span class=lnt id=hl-39-78><a class=lnlinks href=#hl-39-78> 78</a>
</span><span class=lnt id=hl-39-79><a class=lnlinks href=#hl-39-79> 79</a>
</span><span class=lnt id=hl-39-80><a class=lnlinks href=#hl-39-80> 80</a>
</span><span class=lnt id=hl-39-81><a class=lnlinks href=#hl-39-81> 81</a>
</span><span class=lnt id=hl-39-82><a class=lnlinks href=#hl-39-82> 82</a>
</span><span class=lnt id=hl-39-83><a class=lnlinks href=#hl-39-83> 83</a>
</span><span class=lnt id=hl-39-84><a class=lnlinks href=#hl-39-84> 84</a>
</span><span class=lnt id=hl-39-85><a class=lnlinks href=#hl-39-85> 85</a>
</span><span class=lnt id=hl-39-86><a class=lnlinks href=#hl-39-86> 86</a>
</span><span class=lnt id=hl-39-87><a class=lnlinks href=#hl-39-87> 87</a>
</span><span class=lnt id=hl-39-88><a class=lnlinks href=#hl-39-88> 88</a>
</span><span class=lnt id=hl-39-89><a class=lnlinks href=#hl-39-89> 89</a>
</span><span class=lnt id=hl-39-90><a class=lnlinks href=#hl-39-90> 90</a>
</span><span class=lnt id=hl-39-91><a class=lnlinks href=#hl-39-91> 91</a>
</span><span class=lnt id=hl-39-92><a class=lnlinks href=#hl-39-92> 92</a>
</span><span class=lnt id=hl-39-93><a class=lnlinks href=#hl-39-93> 93</a>
</span><span class=lnt id=hl-39-94><a class=lnlinks href=#hl-39-94> 94</a>
</span><span class=lnt id=hl-39-95><a class=lnlinks href=#hl-39-95> 95</a>
</span><span class=lnt id=hl-39-96><a class=lnlinks href=#hl-39-96> 96</a>
</span><span class=lnt id=hl-39-97><a class=lnlinks href=#hl-39-97> 97</a>
</span><span class=lnt id=hl-39-98><a class=lnlinks href=#hl-39-98> 98</a>
</span><span class=lnt id=hl-39-99><a class=lnlinks href=#hl-39-99> 99</a>
</span><span class=lnt id=hl-39-100><a class=lnlinks href=#hl-39-100>100</a>
</span><span class=lnt id=hl-39-101><a class=lnlinks href=#hl-39-101>101</a>
</span><span class=lnt id=hl-39-102><a class=lnlinks href=#hl-39-102>102</a>
</span><span class=lnt id=hl-39-103><a class=lnlinks href=#hl-39-103>103</a>
</span><span class=lnt id=hl-39-104><a class=lnlinks href=#hl-39-104>104</a>
</span><span class=lnt id=hl-39-105><a class=lnlinks href=#hl-39-105>105</a>
</span><span class=lnt id=hl-39-106><a class=lnlinks href=#hl-39-106>106</a>
</span><span class=lnt id=hl-39-107><a class=lnlinks href=#hl-39-107>107</a>
</span><span class=lnt id=hl-39-108><a class=lnlinks href=#hl-39-108>108</a>
</span><span class=lnt id=hl-39-109><a class=lnlinks href=#hl-39-109>109</a>
</span><span class=lnt id=hl-39-110><a class=lnlinks href=#hl-39-110>110</a>
</span><span class=lnt id=hl-39-111><a class=lnlinks href=#hl-39-111>111</a>
</span><span class=lnt id=hl-39-112><a class=lnlinks href=#hl-39-112>112</a>
</span><span class=lnt id=hl-39-113><a class=lnlinks href=#hl-39-113>113</a>
</span><span class=lnt id=hl-39-114><a class=lnlinks href=#hl-39-114>114</a>
</span><span class=lnt id=hl-39-115><a class=lnlinks href=#hl-39-115>115</a>
</span><span class=lnt id=hl-39-116><a class=lnlinks href=#hl-39-116>116</a>
</span><span class=lnt id=hl-39-117><a class=lnlinks href=#hl-39-117>117</a>
</span><span class=lnt id=hl-39-118><a class=lnlinks href=#hl-39-118>118</a>
</span><span class=lnt id=hl-39-119><a class=lnlinks href=#hl-39-119>119</a>
</span><span class=lnt id=hl-39-120><a class=lnlinks href=#hl-39-120>120</a>
</span><span class=lnt id=hl-39-121><a class=lnlinks href=#hl-39-121>121</a>
</span><span class=lnt id=hl-39-122><a class=lnlinks href=#hl-39-122>122</a>
</span><span class=lnt id=hl-39-123><a class=lnlinks href=#hl-39-123>123</a>
</span><span class=lnt id=hl-39-124><a class=lnlinks href=#hl-39-124>124</a>
</span><span class=lnt id=hl-39-125><a class=lnlinks href=#hl-39-125>125</a>
</span><span class=lnt id=hl-39-126><a class=lnlinks href=#hl-39-126>126</a>
</span><span class=lnt id=hl-39-127><a class=lnlinks href=#hl-39-127>127</a>
</span><span class=lnt id=hl-39-128><a class=lnlinks href=#hl-39-128>128</a>
</span><span class=lnt id=hl-39-129><a class=lnlinks href=#hl-39-129>129</a>
</span><span class=lnt id=hl-39-130><a class=lnlinks href=#hl-39-130>130</a>
</span><span class=lnt id=hl-39-131><a class=lnlinks href=#hl-39-131>131</a>
</span><span class=lnt id=hl-39-132><a class=lnlinks href=#hl-39-132>132</a>
</span><span class=lnt id=hl-39-133><a class=lnlinks href=#hl-39-133>133</a>
</span><span class=lnt id=hl-39-134><a class=lnlinks href=#hl-39-134>134</a>
</span><span class=lnt id=hl-39-135><a class=lnlinks href=#hl-39-135>135</a>
</span><span class=lnt id=hl-39-136><a class=lnlinks href=#hl-39-136>136</a>
</span><span class=lnt id=hl-39-137><a class=lnlinks href=#hl-39-137>137</a>
</span><span class=lnt id=hl-39-138><a class=lnlinks href=#hl-39-138>138</a>
</span><span class=lnt id=hl-39-139><a class=lnlinks href=#hl-39-139>139</a>
</span><span class=lnt id=hl-39-140><a class=lnlinks href=#hl-39-140>140</a>
</span><span class=lnt id=hl-39-141><a class=lnlinks href=#hl-39-141>141</a>
</span><span class=lnt id=hl-39-142><a class=lnlinks href=#hl-39-142>142</a>
</span><span class=lnt id=hl-39-143><a class=lnlinks href=#hl-39-143>143</a>
</span><span class=lnt id=hl-39-144><a class=lnlinks href=#hl-39-144>144</a>
</span><span class=lnt id=hl-39-145><a class=lnlinks href=#hl-39-145>145</a>
</span><span class=lnt id=hl-39-146><a class=lnlinks href=#hl-39-146>146</a>
</span><span class=lnt id=hl-39-147><a class=lnlinks href=#hl-39-147>147</a>
</span><span class=lnt id=hl-39-148><a class=lnlinks href=#hl-39-148>148</a>
</span><span class=lnt id=hl-39-149><a class=lnlinks href=#hl-39-149>149</a>
</span><span class=lnt id=hl-39-150><a class=lnlinks href=#hl-39-150>150</a>
</span><span class=lnt id=hl-39-151><a class=lnlinks href=#hl-39-151>151</a>
</span><span class=lnt id=hl-39-152><a class=lnlinks href=#hl-39-152>152</a>
</span><span class=lnt id=hl-39-153><a class=lnlinks href=#hl-39-153>153</a>
</span><span class=lnt id=hl-39-154><a class=lnlinks href=#hl-39-154>154</a>
</span><span class=lnt id=hl-39-155><a class=lnlinks href=#hl-39-155>155</a>
</span><span class=lnt id=hl-39-156><a class=lnlinks href=#hl-39-156>156</a>
</span><span class=lnt id=hl-39-157><a class=lnlinks href=#hl-39-157>157</a>
</span><span class=lnt id=hl-39-158><a class=lnlinks href=#hl-39-158>158</a>
</span><span class=lnt id=hl-39-159><a class=lnlinks href=#hl-39-159>159</a>
</span><span class=lnt id=hl-39-160><a class=lnlinks href=#hl-39-160>160</a>
</span><span class=lnt id=hl-39-161><a class=lnlinks href=#hl-39-161>161</a>
</span><span class=lnt id=hl-39-162><a class=lnlinks href=#hl-39-162>162</a>
</span><span class=lnt id=hl-39-163><a class=lnlinks href=#hl-39-163>163</a>
</span><span class=lnt id=hl-39-164><a class=lnlinks href=#hl-39-164>164</a>
</span><span class=lnt id=hl-39-165><a class=lnlinks href=#hl-39-165>165</a>
</span><span class=lnt id=hl-39-166><a class=lnlinks href=#hl-39-166>166</a>
</span><span class=lnt id=hl-39-167><a class=lnlinks href=#hl-39-167>167</a>
</span><span class=lnt id=hl-39-168><a class=lnlinks href=#hl-39-168>168</a>
</span><span class=lnt id=hl-39-169><a class=lnlinks href=#hl-39-169>169</a>
</span><span class=lnt id=hl-39-170><a class=lnlinks href=#hl-39-170>170</a>
</span><span class=lnt id=hl-39-171><a class=lnlinks href=#hl-39-171>171</a>
</span><span class=lnt id=hl-39-172><a class=lnlinks href=#hl-39-172>172</a>
</span><span class=lnt id=hl-39-173><a class=lnlinks href=#hl-39-173>173</a>
</span><span class=lnt id=hl-39-174><a class=lnlinks href=#hl-39-174>174</a>
</span><span class=lnt id=hl-39-175><a class=lnlinks href=#hl-39-175>175</a>
</span><span class=lnt id=hl-39-176><a class=lnlinks href=#hl-39-176>176</a>
</span><span class=lnt id=hl-39-177><a class=lnlinks href=#hl-39-177>177</a>
</span><span class=lnt id=hl-39-178><a class=lnlinks href=#hl-39-178>178</a>
</span><span class=lnt id=hl-39-179><a class=lnlinks href=#hl-39-179>179</a>
</span><span class=lnt id=hl-39-180><a class=lnlinks href=#hl-39-180>180</a>
</span><span class=lnt id=hl-39-181><a class=lnlinks href=#hl-39-181>181</a>
</span><span class=lnt id=hl-39-182><a class=lnlinks href=#hl-39-182>182</a>
</span><span class=lnt id=hl-39-183><a class=lnlinks href=#hl-39-183>183</a>
</span><span class=lnt id=hl-39-184><a class=lnlinks href=#hl-39-184>184</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python에서 배치 처리 구현 예시 (Kafka 사용)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>confluent_kafka</span> <span class=kn>import</span> <span class=n>Producer</span><span class=p>,</span> <span class=n>Consumer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>confluent_kafka.admin</span> <span class=kn>import</span> <span class=n>AdminClient</span><span class=p>,</span> <span class=n>NewTopic</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BatchMessageProducer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>topic</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span><span class=p>,</span> <span class=n>flush_interval</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>Producer</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span> <span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;batch.size&#39;</span><span class=p>:</span> <span class=mi>16384</span><span class=p>,</span>  <span class=c1># 배치 크기(바이트)</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;linger.ms&#39;</span><span class=p>:</span> <span class=mi>50</span><span class=p>,</span>      <span class=c1># 배치 지연 시간(밀리초)</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;compression.type&#39;</span><span class=p>:</span> <span class=s1>&#39;snappy&#39;</span>  <span class=c1># 메시지 압축</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topic</span> <span class=o>=</span> <span class=n>topic</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>batch_size</span> <span class=o>=</span> <span class=n>batch_size</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>flush_interval</span> <span class=o>=</span> <span class=n>flush_interval</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_flush_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 토픽 생성 확인</span>
</span></span><span class=line><span class=cl>        <span class=n>admin_client</span> <span class=o>=</span> <span class=n>AdminClient</span><span class=p>({</span><span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span> <span class=n>bootstrap_servers</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=n>topics</span> <span class=o>=</span> <span class=n>admin_client</span><span class=o>.</span><span class=n>list_topics</span><span class=p>()</span><span class=o>.</span><span class=n>topics</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>topic</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>topics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>topic_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>NewTopic</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>num_partitions</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>replication_factor</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=p>)]</span>
</span></span><span class=line><span class=cl>            <span class=n>admin_client</span><span class=o>.</span><span class=n>create_topics</span><span class=p>(</span><span class=n>topic_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;토픽 생성됨: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>delivery_report</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>err</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>err</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 전송 실패: </span><span class=si>{</span><span class=n>err</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 전송 성공: </span><span class=si>{</span><span class=n>msg</span><span class=o>.</span><span class=n>topic</span><span class=p>()</span><span class=si>}</span><span class=s2> [</span><span class=si>{</span><span class=n>msg</span><span class=o>.</span><span class=n>partition</span><span class=p>()</span><span class=si>}</span><span class=s2>] @ 오프셋 </span><span class=si>{</span><span class=n>msg</span><span class=o>.</span><span class=n>offset</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>add_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배치 버퍼에 메시지 추가&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 배치 크기에 도달하거나 플러시 간격이 경과하면 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>current_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>batch_size</span> <span class=ow>or</span> 
</span></span><span class=line><span class=cl>                <span class=n>current_time</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_flush_time</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>flush_interval</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>flush</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배치 버퍼의 모든 메시지 전송&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;배치 플러시: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=p>)</span><span class=si>}</span><span class=s2> 메시지&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 직렬화</span>
</span></span><span class=line><span class=cl>            <span class=n>message_value</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 파티션 키 설정 (메시지 순서가 중요한 경우)</span>
</span></span><span class=line><span class=cl>            <span class=n>partition_key</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;entity_id&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 생산</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>produce</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>topic</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=n>partition_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>value</span><span class=o>=</span><span class=n>message_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>delivery_report</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 생산자 플러시</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 버퍼 비우기 및 타임스탬프 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>batch_buffer</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_flush_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>close</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;남은 메시지 플러시 및 생산자 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ParallelMessageConsumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>topic</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>group_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>num_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span> <span class=o>=</span> <span class=n>bootstrap_servers</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topic</span> <span class=o>=</span> <span class=n>topic</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>group_id</span> <span class=o>=</span> <span class=n>group_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>num_workers</span> <span class=o>=</span> <span class=n>num_workers</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>workers</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_consumer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 소비자 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Consumer</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;group.id&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>group_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;auto.offset.reset&#39;</span><span class=p>:</span> <span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;enable.auto.commit&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;max.poll.interval.ms&#39;</span><span class=p>:</span> <span class=mi>300000</span><span class=p>,</span>  <span class=c1># 5분</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;session.timeout.ms&#39;</span><span class=p>:</span> <span class=mi>30000</span><span class=p>,</span>     <span class=c1># 30초</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;fetch.min.bytes&#39;</span><span class=p>:</span> <span class=mi>1024</span><span class=p>,</span>         <span class=c1># 최소 가져오기 크기</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;fetch.max.wait.ms&#39;</span><span class=p>:</span> <span class=mi>500</span>         <span class=c1># 최대 대기 시간</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 처리 로직 (오버라이드 필요)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 역직렬화</span>
</span></span><span class=line><span class=cl>            <span class=n>message_value</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>value</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 처리: </span><span class=si>{</span><span class=n>message_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 실제 처리 로직 구현</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 처리 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>worker_loop</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>worker_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;작업자 스레드 메인 루프&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_consumer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span><span class=o>.</span><span class=n>subscribe</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;작업자 </span><span class=si>{</span><span class=n>worker_id</span><span class=si>}</span><span class=s2> 시작됨, 토픽: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>running</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 메시지 폴링</span>
</span></span><span class=line><span class=cl>                <span class=n>messages</span> <span class=o>=</span> <span class=n>consumer</span><span class=o>.</span><span class=n>consume</span><span class=p>(</span><span class=n>num_messages</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 배치 처리</span>
</span></span><span class=line><span class=cl>                <span class=n>processed_offsets</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>message</span><span class=o>.</span><span class=n>error</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;소비자 오류: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>error</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>continue</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 메시지 처리</span>
</span></span><span class=line><span class=cl>                    <span class=n>success</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>process_message</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 오프셋 추적</span>
</span></span><span class=line><span class=cl>                        <span class=n>partition</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>partition</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=n>partition</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>processed_offsets</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=n>processed_offsets</span><span class=p>[</span><span class=n>partition</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>                        <span class=n>processed_offsets</span><span class=p>[</span><span class=n>partition</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>offset</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 성공한 오프셋 커밋</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>partition</span><span class=p>,</span> <span class=n>offsets</span> <span class=ow>in</span> <span class=n>processed_offsets</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>offsets</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>consumer</span><span class=o>.</span><span class=n>commit</span><span class=p>(</span><span class=n>offsets</span><span class=o>=</span><span class=p>[(</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span> <span class=n>partition</span><span class=p>,</span> <span class=nb>max</span><span class=p>(</span><span class=n>offsets</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>consumer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;작업자 </span><span class=si>{</span><span class=n>worker_id</span><span class=si>}</span><span class=s2> 종료됨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;병렬 소비자 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 작업자 스레드 시작</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_workers</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>worker_loop</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>workers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>worker</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>num_workers</span><span class=si>}</span><span class=s2>개의 병렬 작업자가 시작되었습니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;소비자 중지&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 작업자 스레드가 종료될 때까지 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>worker</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>workers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>worker</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>5.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;모든 소비자 작업자가 종료되었습니다.&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐-모니터링-및-운영>메시징 큐 모니터링 및 운영<a hidden class=anchor aria-hidden=true href=#메시징-큐-모니터링-및-운영>#</a></h3><p>효과적인 메시징 시스템 운영을 위해서는 적절한 모니터링과 관리가 필수적이다.<br>다음은 주요 모니터링 포인트와 관리 전략이다.</p><h4 id=주요-모니터링-지표>주요 모니터링 지표<a hidden class=anchor aria-hidden=true href=#주요-모니터링-지표>#</a></h4><p>메시징 시스템의 건강 상태와 성능을 모니터링하기 위한 핵심 지표들이다.</p><ul><li><strong>큐 깊이(Queue Depth)</strong>: 큐에 적재된 메시지 수를 추적하여 처리 지연 감지</li><li><strong>메시지 처리율(Processing Rate)</strong>: 초당 처리되는 메시지 수를 측정하여 성능 평가</li><li><strong>메시지 지연 시간(Latency)</strong>: 메시지가 큐에 들어온 후 처리되기까지의 시간 측정</li><li><strong>오류율(Error Rate)</strong>: 처리 실패 및 재시도 횟수 모니터링</li><li><strong>소비자 상태(Consumer Health)</strong>: 활성 소비자 수와 소비자 지연 추적</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1>  1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2>  2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3>  3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4>  4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5>  5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6>  6</a>
</span><span class=lnt id=hl-40-7><a class=lnlinks href=#hl-40-7>  7</a>
</span><span class=lnt id=hl-40-8><a class=lnlinks href=#hl-40-8>  8</a>
</span><span class=lnt id=hl-40-9><a class=lnlinks href=#hl-40-9>  9</a>
</span><span class=lnt id=hl-40-10><a class=lnlinks href=#hl-40-10> 10</a>
</span><span class=lnt id=hl-40-11><a class=lnlinks href=#hl-40-11> 11</a>
</span><span class=lnt id=hl-40-12><a class=lnlinks href=#hl-40-12> 12</a>
</span><span class=lnt id=hl-40-13><a class=lnlinks href=#hl-40-13> 13</a>
</span><span class=lnt id=hl-40-14><a class=lnlinks href=#hl-40-14> 14</a>
</span><span class=lnt id=hl-40-15><a class=lnlinks href=#hl-40-15> 15</a>
</span><span class=lnt id=hl-40-16><a class=lnlinks href=#hl-40-16> 16</a>
</span><span class=lnt id=hl-40-17><a class=lnlinks href=#hl-40-17> 17</a>
</span><span class=lnt id=hl-40-18><a class=lnlinks href=#hl-40-18> 18</a>
</span><span class=lnt id=hl-40-19><a class=lnlinks href=#hl-40-19> 19</a>
</span><span class=lnt id=hl-40-20><a class=lnlinks href=#hl-40-20> 20</a>
</span><span class=lnt id=hl-40-21><a class=lnlinks href=#hl-40-21> 21</a>
</span><span class=lnt id=hl-40-22><a class=lnlinks href=#hl-40-22> 22</a>
</span><span class=lnt id=hl-40-23><a class=lnlinks href=#hl-40-23> 23</a>
</span><span class=lnt id=hl-40-24><a class=lnlinks href=#hl-40-24> 24</a>
</span><span class=lnt id=hl-40-25><a class=lnlinks href=#hl-40-25> 25</a>
</span><span class=lnt id=hl-40-26><a class=lnlinks href=#hl-40-26> 26</a>
</span><span class=lnt id=hl-40-27><a class=lnlinks href=#hl-40-27> 27</a>
</span><span class=lnt id=hl-40-28><a class=lnlinks href=#hl-40-28> 28</a>
</span><span class=lnt id=hl-40-29><a class=lnlinks href=#hl-40-29> 29</a>
</span><span class=lnt id=hl-40-30><a class=lnlinks href=#hl-40-30> 30</a>
</span><span class=lnt id=hl-40-31><a class=lnlinks href=#hl-40-31> 31</a>
</span><span class=lnt id=hl-40-32><a class=lnlinks href=#hl-40-32> 32</a>
</span><span class=lnt id=hl-40-33><a class=lnlinks href=#hl-40-33> 33</a>
</span><span class=lnt id=hl-40-34><a class=lnlinks href=#hl-40-34> 34</a>
</span><span class=lnt id=hl-40-35><a class=lnlinks href=#hl-40-35> 35</a>
</span><span class=lnt id=hl-40-36><a class=lnlinks href=#hl-40-36> 36</a>
</span><span class=lnt id=hl-40-37><a class=lnlinks href=#hl-40-37> 37</a>
</span><span class=lnt id=hl-40-38><a class=lnlinks href=#hl-40-38> 38</a>
</span><span class=lnt id=hl-40-39><a class=lnlinks href=#hl-40-39> 39</a>
</span><span class=lnt id=hl-40-40><a class=lnlinks href=#hl-40-40> 40</a>
</span><span class=lnt id=hl-40-41><a class=lnlinks href=#hl-40-41> 41</a>
</span><span class=lnt id=hl-40-42><a class=lnlinks href=#hl-40-42> 42</a>
</span><span class=lnt id=hl-40-43><a class=lnlinks href=#hl-40-43> 43</a>
</span><span class=lnt id=hl-40-44><a class=lnlinks href=#hl-40-44> 44</a>
</span><span class=lnt id=hl-40-45><a class=lnlinks href=#hl-40-45> 45</a>
</span><span class=lnt id=hl-40-46><a class=lnlinks href=#hl-40-46> 46</a>
</span><span class=lnt id=hl-40-47><a class=lnlinks href=#hl-40-47> 47</a>
</span><span class=lnt id=hl-40-48><a class=lnlinks href=#hl-40-48> 48</a>
</span><span class=lnt id=hl-40-49><a class=lnlinks href=#hl-40-49> 49</a>
</span><span class=lnt id=hl-40-50><a class=lnlinks href=#hl-40-50> 50</a>
</span><span class=lnt id=hl-40-51><a class=lnlinks href=#hl-40-51> 51</a>
</span><span class=lnt id=hl-40-52><a class=lnlinks href=#hl-40-52> 52</a>
</span><span class=lnt id=hl-40-53><a class=lnlinks href=#hl-40-53> 53</a>
</span><span class=lnt id=hl-40-54><a class=lnlinks href=#hl-40-54> 54</a>
</span><span class=lnt id=hl-40-55><a class=lnlinks href=#hl-40-55> 55</a>
</span><span class=lnt id=hl-40-56><a class=lnlinks href=#hl-40-56> 56</a>
</span><span class=lnt id=hl-40-57><a class=lnlinks href=#hl-40-57> 57</a>
</span><span class=lnt id=hl-40-58><a class=lnlinks href=#hl-40-58> 58</a>
</span><span class=lnt id=hl-40-59><a class=lnlinks href=#hl-40-59> 59</a>
</span><span class=lnt id=hl-40-60><a class=lnlinks href=#hl-40-60> 60</a>
</span><span class=lnt id=hl-40-61><a class=lnlinks href=#hl-40-61> 61</a>
</span><span class=lnt id=hl-40-62><a class=lnlinks href=#hl-40-62> 62</a>
</span><span class=lnt id=hl-40-63><a class=lnlinks href=#hl-40-63> 63</a>
</span><span class=lnt id=hl-40-64><a class=lnlinks href=#hl-40-64> 64</a>
</span><span class=lnt id=hl-40-65><a class=lnlinks href=#hl-40-65> 65</a>
</span><span class=lnt id=hl-40-66><a class=lnlinks href=#hl-40-66> 66</a>
</span><span class=lnt id=hl-40-67><a class=lnlinks href=#hl-40-67> 67</a>
</span><span class=lnt id=hl-40-68><a class=lnlinks href=#hl-40-68> 68</a>
</span><span class=lnt id=hl-40-69><a class=lnlinks href=#hl-40-69> 69</a>
</span><span class=lnt id=hl-40-70><a class=lnlinks href=#hl-40-70> 70</a>
</span><span class=lnt id=hl-40-71><a class=lnlinks href=#hl-40-71> 71</a>
</span><span class=lnt id=hl-40-72><a class=lnlinks href=#hl-40-72> 72</a>
</span><span class=lnt id=hl-40-73><a class=lnlinks href=#hl-40-73> 73</a>
</span><span class=lnt id=hl-40-74><a class=lnlinks href=#hl-40-74> 74</a>
</span><span class=lnt id=hl-40-75><a class=lnlinks href=#hl-40-75> 75</a>
</span><span class=lnt id=hl-40-76><a class=lnlinks href=#hl-40-76> 76</a>
</span><span class=lnt id=hl-40-77><a class=lnlinks href=#hl-40-77> 77</a>
</span><span class=lnt id=hl-40-78><a class=lnlinks href=#hl-40-78> 78</a>
</span><span class=lnt id=hl-40-79><a class=lnlinks href=#hl-40-79> 79</a>
</span><span class=lnt id=hl-40-80><a class=lnlinks href=#hl-40-80> 80</a>
</span><span class=lnt id=hl-40-81><a class=lnlinks href=#hl-40-81> 81</a>
</span><span class=lnt id=hl-40-82><a class=lnlinks href=#hl-40-82> 82</a>
</span><span class=lnt id=hl-40-83><a class=lnlinks href=#hl-40-83> 83</a>
</span><span class=lnt id=hl-40-84><a class=lnlinks href=#hl-40-84> 84</a>
</span><span class=lnt id=hl-40-85><a class=lnlinks href=#hl-40-85> 85</a>
</span><span class=lnt id=hl-40-86><a class=lnlinks href=#hl-40-86> 86</a>
</span><span class=lnt id=hl-40-87><a class=lnlinks href=#hl-40-87> 87</a>
</span><span class=lnt id=hl-40-88><a class=lnlinks href=#hl-40-88> 88</a>
</span><span class=lnt id=hl-40-89><a class=lnlinks href=#hl-40-89> 89</a>
</span><span class=lnt id=hl-40-90><a class=lnlinks href=#hl-40-90> 90</a>
</span><span class=lnt id=hl-40-91><a class=lnlinks href=#hl-40-91> 91</a>
</span><span class=lnt id=hl-40-92><a class=lnlinks href=#hl-40-92> 92</a>
</span><span class=lnt id=hl-40-93><a class=lnlinks href=#hl-40-93> 93</a>
</span><span class=lnt id=hl-40-94><a class=lnlinks href=#hl-40-94> 94</a>
</span><span class=lnt id=hl-40-95><a class=lnlinks href=#hl-40-95> 95</a>
</span><span class=lnt id=hl-40-96><a class=lnlinks href=#hl-40-96> 96</a>
</span><span class=lnt id=hl-40-97><a class=lnlinks href=#hl-40-97> 97</a>
</span><span class=lnt id=hl-40-98><a class=lnlinks href=#hl-40-98> 98</a>
</span><span class=lnt id=hl-40-99><a class=lnlinks href=#hl-40-99> 99</a>
</span><span class=lnt id=hl-40-100><a class=lnlinks href=#hl-40-100>100</a>
</span><span class=lnt id=hl-40-101><a class=lnlinks href=#hl-40-101>101</a>
</span><span class=lnt id=hl-40-102><a class=lnlinks href=#hl-40-102>102</a>
</span><span class=lnt id=hl-40-103><a class=lnlinks href=#hl-40-103>103</a>
</span><span class=lnt id=hl-40-104><a class=lnlinks href=#hl-40-104>104</a>
</span><span class=lnt id=hl-40-105><a class=lnlinks href=#hl-40-105>105</a>
</span><span class=lnt id=hl-40-106><a class=lnlinks href=#hl-40-106>106</a>
</span><span class=lnt id=hl-40-107><a class=lnlinks href=#hl-40-107>107</a>
</span><span class=lnt id=hl-40-108><a class=lnlinks href=#hl-40-108>108</a>
</span><span class=lnt id=hl-40-109><a class=lnlinks href=#hl-40-109>109</a>
</span><span class=lnt id=hl-40-110><a class=lnlinks href=#hl-40-110>110</a>
</span><span class=lnt id=hl-40-111><a class=lnlinks href=#hl-40-111>111</a>
</span><span class=lnt id=hl-40-112><a class=lnlinks href=#hl-40-112>112</a>
</span><span class=lnt id=hl-40-113><a class=lnlinks href=#hl-40-113>113</a>
</span><span class=lnt id=hl-40-114><a class=lnlinks href=#hl-40-114>114</a>
</span><span class=lnt id=hl-40-115><a class=lnlinks href=#hl-40-115>115</a>
</span><span class=lnt id=hl-40-116><a class=lnlinks href=#hl-40-116>116</a>
</span><span class=lnt id=hl-40-117><a class=lnlinks href=#hl-40-117>117</a>
</span><span class=lnt id=hl-40-118><a class=lnlinks href=#hl-40-118>118</a>
</span><span class=lnt id=hl-40-119><a class=lnlinks href=#hl-40-119>119</a>
</span><span class=lnt id=hl-40-120><a class=lnlinks href=#hl-40-120>120</a>
</span><span class=lnt id=hl-40-121><a class=lnlinks href=#hl-40-121>121</a>
</span><span class=lnt id=hl-40-122><a class=lnlinks href=#hl-40-122>122</a>
</span><span class=lnt id=hl-40-123><a class=lnlinks href=#hl-40-123>123</a>
</span><span class=lnt id=hl-40-124><a class=lnlinks href=#hl-40-124>124</a>
</span><span class=lnt id=hl-40-125><a class=lnlinks href=#hl-40-125>125</a>
</span><span class=lnt id=hl-40-126><a class=lnlinks href=#hl-40-126>126</a>
</span><span class=lnt id=hl-40-127><a class=lnlinks href=#hl-40-127>127</a>
</span><span class=lnt id=hl-40-128><a class=lnlinks href=#hl-40-128>128</a>
</span><span class=lnt id=hl-40-129><a class=lnlinks href=#hl-40-129>129</a>
</span><span class=lnt id=hl-40-130><a class=lnlinks href=#hl-40-130>130</a>
</span><span class=lnt id=hl-40-131><a class=lnlinks href=#hl-40-131>131</a>
</span><span class=lnt id=hl-40-132><a class=lnlinks href=#hl-40-132>132</a>
</span><span class=lnt id=hl-40-133><a class=lnlinks href=#hl-40-133>133</a>
</span><span class=lnt id=hl-40-134><a class=lnlinks href=#hl-40-134>134</a>
</span><span class=lnt id=hl-40-135><a class=lnlinks href=#hl-40-135>135</a>
</span><span class=lnt id=hl-40-136><a class=lnlinks href=#hl-40-136>136</a>
</span><span class=lnt id=hl-40-137><a class=lnlinks href=#hl-40-137>137</a>
</span><span class=lnt id=hl-40-138><a class=lnlinks href=#hl-40-138>138</a>
</span><span class=lnt id=hl-40-139><a class=lnlinks href=#hl-40-139>139</a>
</span><span class=lnt id=hl-40-140><a class=lnlinks href=#hl-40-140>140</a>
</span><span class=lnt id=hl-40-141><a class=lnlinks href=#hl-40-141>141</a>
</span><span class=lnt id=hl-40-142><a class=lnlinks href=#hl-40-142>142</a>
</span><span class=lnt id=hl-40-143><a class=lnlinks href=#hl-40-143>143</a>
</span><span class=lnt id=hl-40-144><a class=lnlinks href=#hl-40-144>144</a>
</span><span class=lnt id=hl-40-145><a class=lnlinks href=#hl-40-145>145</a>
</span><span class=lnt id=hl-40-146><a class=lnlinks href=#hl-40-146>146</a>
</span><span class=lnt id=hl-40-147><a class=lnlinks href=#hl-40-147>147</a>
</span><span class=lnt id=hl-40-148><a class=lnlinks href=#hl-40-148>148</a>
</span><span class=lnt id=hl-40-149><a class=lnlinks href=#hl-40-149>149</a>
</span><span class=lnt id=hl-40-150><a class=lnlinks href=#hl-40-150>150</a>
</span><span class=lnt id=hl-40-151><a class=lnlinks href=#hl-40-151>151</a>
</span><span class=lnt id=hl-40-152><a class=lnlinks href=#hl-40-152>152</a>
</span><span class=lnt id=hl-40-153><a class=lnlinks href=#hl-40-153>153</a>
</span><span class=lnt id=hl-40-154><a class=lnlinks href=#hl-40-154>154</a>
</span><span class=lnt id=hl-40-155><a class=lnlinks href=#hl-40-155>155</a>
</span><span class=lnt id=hl-40-156><a class=lnlinks href=#hl-40-156>156</a>
</span><span class=lnt id=hl-40-157><a class=lnlinks href=#hl-40-157>157</a>
</span><span class=lnt id=hl-40-158><a class=lnlinks href=#hl-40-158>158</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Prometheus와 Grafana를 사용한 RabbitMQ 모니터링 예시 (Python)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>prometheus_client</span> <span class=kn>import</span> <span class=n>start_http_server</span><span class=p>,</span> <span class=n>Counter</span><span class=p>,</span> <span class=n>Gauge</span><span class=p>,</span> <span class=n>Histogram</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Prometheus 메트릭 정의</span>
</span></span><span class=line><span class=cl><span class=n>MESSAGE_COUNT</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span><span class=s1>&#39;rabbitmq_messages_total&#39;</span><span class=p>,</span> <span class=s1>&#39;Total number of messages processed&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;queue&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>QUEUE_DEPTH</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span><span class=s1>&#39;rabbitmq_queue_depth&#39;</span><span class=p>,</span> <span class=s1>&#39;Number of messages in queue&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;queue&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>PROCESSING_TIME</span> <span class=o>=</span> <span class=n>Histogram</span><span class=p>(</span><span class=s1>&#39;rabbitmq_processing_seconds&#39;</span><span class=p>,</span> <span class=s1>&#39;Time spent processing messages&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;queue&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>ACTIVE_CONSUMERS</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span><span class=s1>&#39;rabbitmq_active_consumers&#39;</span><span class=p>,</span> <span class=s1>&#39;Number of active consumers&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;queue&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MonitoredConsumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection_params</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection_params</span> <span class=o>=</span> <span class=n>connection_params</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span> <span class=o>=</span> <span class=n>queue_name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>thread</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 소비자 활성화 상태 표시</span>
</span></span><span class=line><span class=cl>        <span class=n>ACTIVE_CONSUMERS</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>connect</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;RabbitMQ에 연결&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>connection_params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>durable</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;연결 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start_consuming</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 소비 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>connect</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;RabbitMQ 연결 실패. 30초 후 재시도합니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>ACTIVE_CONSUMERS</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=c1># 처리 시작 시간 기록</span>
</span></span><span class=line><span class=cl>            <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 메시지 처리 로직</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 수신: </span><span class=si>{</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 성공적으로 처리됨</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_ack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>MESSAGE_COUNT</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=s2>&#34;success&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 처리 시간 기록</span>
</span></span><span class=line><span class=cl>                <span class=n>PROCESSING_TIME</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>observe</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 처리 실패</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;처리 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>ch</span><span class=o>.</span><span class=n>basic_nack</span><span class=p>(</span><span class=n>delivery_tag</span><span class=o>=</span><span class=n>method</span><span class=o>.</span><span class=n>delivery_tag</span><span class=p>,</span> <span class=n>requeue</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>MESSAGE_COUNT</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=s2>&#34;error&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 큐 깊이 모니터링 스레드</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>monitor_queue_depth</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>running</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 큐 상태 확인</span>
</span></span><span class=line><span class=cl>                    <span class=n>queue</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>passive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>depth</span> <span class=o>=</span> <span class=n>queue</span><span class=o>.</span><span class=n>method</span><span class=o>.</span><span class=n>message_count</span>
</span></span><span class=line><span class=cl>                    <span class=n>QUEUE_DEPTH</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>depth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;큐 모니터링 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>QUEUE_DEPTH</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>  <span class=c1># 5초마다 업데이트</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모니터링 스레드 시작</span>
</span></span><span class=line><span class=cl>        <span class=n>monitor_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>monitor_queue_depth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>monitor_thread</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>monitor_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 소비자 시작</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;큐 </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=si>}</span><span class=s2>에서 메시지 소비 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;소비자 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=c1># 재연결 시도</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;별도 스레드에서 소비자 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>thread</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;소비자 중지&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>ACTIVE_CONSUMERS</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=p>)</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>channel</span><span class=o>.</span><span class=n>stop_consuming</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>is_open</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;큐 </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_name</span><span class=si>}</span><span class=s2>의 소비자가 중지되었습니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메인 애플리케이션</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># Prometheus 메트릭 서버 시작</span>
</span></span><span class=line><span class=cl>    <span class=n>start_http_server</span><span class=p>(</span><span class=mi>8000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Prometheus 메트릭 서버가 포트 8000에서 실행 중입니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># RabbitMQ 연결 파라미터</span>
</span></span><span class=line><span class=cl>    <span class=n>connection_params</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>heartbeat</span><span class=o>=</span><span class=mi>60</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>blocked_connection_timeout</span><span class=o>=</span><span class=mi>300</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 모니터링되는 소비자 시작</span>
</span></span><span class=line><span class=cl>    <span class=n>consumers</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>queue_name</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=s1>&#39;emails&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span> <span class=o>=</span> <span class=n>MonitoredConsumer</span><span class=p>(</span><span class=n>connection_params</span><span class=p>,</span> <span class=n>queue_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>consumers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>consumer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 애플리케이션 실행 유지</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;애플리케이션 종료 중...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>consumer</span> <span class=ow>in</span> <span class=n>consumers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>consumer</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=경보-및-자동화-대응>경보 및 자동화 대응<a hidden class=anchor aria-hidden=true href=#경보-및-자동화-대응>#</a></h4><p>메시징 시스템에서 발생할 수 있는 문제에 대한 경보와 자동화된 대응 전략은 아래와 같다.</p><ul><li><strong>큐 적체(Queue Buildup)</strong>: 큐 깊이가 임계값을 초과할 경우 경보 발생</li><li><strong>데드 레터 증가(Dead-Letter Growth)</strong>: 데드 레터 큐에 메시지가 축적될 경우 경보</li><li><strong>소비자 장애(Consumer Failure)</strong>: 활성 소비자 수가 감소할 경우 자동 복구</li><li><strong>처리 지연(Processing Delays)</strong>: 메시지 처리 지연이 임계값을 초과할 경우 경보</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1>  1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2>  2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3>  3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4>  4</a>
</span><span class=lnt id=hl-41-5><a class=lnlinks href=#hl-41-5>  5</a>
</span><span class=lnt id=hl-41-6><a class=lnlinks href=#hl-41-6>  6</a>
</span><span class=lnt id=hl-41-7><a class=lnlinks href=#hl-41-7>  7</a>
</span><span class=lnt id=hl-41-8><a class=lnlinks href=#hl-41-8>  8</a>
</span><span class=lnt id=hl-41-9><a class=lnlinks href=#hl-41-9>  9</a>
</span><span class=lnt id=hl-41-10><a class=lnlinks href=#hl-41-10> 10</a>
</span><span class=lnt id=hl-41-11><a class=lnlinks href=#hl-41-11> 11</a>
</span><span class=lnt id=hl-41-12><a class=lnlinks href=#hl-41-12> 12</a>
</span><span class=lnt id=hl-41-13><a class=lnlinks href=#hl-41-13> 13</a>
</span><span class=lnt id=hl-41-14><a class=lnlinks href=#hl-41-14> 14</a>
</span><span class=lnt id=hl-41-15><a class=lnlinks href=#hl-41-15> 15</a>
</span><span class=lnt id=hl-41-16><a class=lnlinks href=#hl-41-16> 16</a>
</span><span class=lnt id=hl-41-17><a class=lnlinks href=#hl-41-17> 17</a>
</span><span class=lnt id=hl-41-18><a class=lnlinks href=#hl-41-18> 18</a>
</span><span class=lnt id=hl-41-19><a class=lnlinks href=#hl-41-19> 19</a>
</span><span class=lnt id=hl-41-20><a class=lnlinks href=#hl-41-20> 20</a>
</span><span class=lnt id=hl-41-21><a class=lnlinks href=#hl-41-21> 21</a>
</span><span class=lnt id=hl-41-22><a class=lnlinks href=#hl-41-22> 22</a>
</span><span class=lnt id=hl-41-23><a class=lnlinks href=#hl-41-23> 23</a>
</span><span class=lnt id=hl-41-24><a class=lnlinks href=#hl-41-24> 24</a>
</span><span class=lnt id=hl-41-25><a class=lnlinks href=#hl-41-25> 25</a>
</span><span class=lnt id=hl-41-26><a class=lnlinks href=#hl-41-26> 26</a>
</span><span class=lnt id=hl-41-27><a class=lnlinks href=#hl-41-27> 27</a>
</span><span class=lnt id=hl-41-28><a class=lnlinks href=#hl-41-28> 28</a>
</span><span class=lnt id=hl-41-29><a class=lnlinks href=#hl-41-29> 29</a>
</span><span class=lnt id=hl-41-30><a class=lnlinks href=#hl-41-30> 30</a>
</span><span class=lnt id=hl-41-31><a class=lnlinks href=#hl-41-31> 31</a>
</span><span class=lnt id=hl-41-32><a class=lnlinks href=#hl-41-32> 32</a>
</span><span class=lnt id=hl-41-33><a class=lnlinks href=#hl-41-33> 33</a>
</span><span class=lnt id=hl-41-34><a class=lnlinks href=#hl-41-34> 34</a>
</span><span class=lnt id=hl-41-35><a class=lnlinks href=#hl-41-35> 35</a>
</span><span class=lnt id=hl-41-36><a class=lnlinks href=#hl-41-36> 36</a>
</span><span class=lnt id=hl-41-37><a class=lnlinks href=#hl-41-37> 37</a>
</span><span class=lnt id=hl-41-38><a class=lnlinks href=#hl-41-38> 38</a>
</span><span class=lnt id=hl-41-39><a class=lnlinks href=#hl-41-39> 39</a>
</span><span class=lnt id=hl-41-40><a class=lnlinks href=#hl-41-40> 40</a>
</span><span class=lnt id=hl-41-41><a class=lnlinks href=#hl-41-41> 41</a>
</span><span class=lnt id=hl-41-42><a class=lnlinks href=#hl-41-42> 42</a>
</span><span class=lnt id=hl-41-43><a class=lnlinks href=#hl-41-43> 43</a>
</span><span class=lnt id=hl-41-44><a class=lnlinks href=#hl-41-44> 44</a>
</span><span class=lnt id=hl-41-45><a class=lnlinks href=#hl-41-45> 45</a>
</span><span class=lnt id=hl-41-46><a class=lnlinks href=#hl-41-46> 46</a>
</span><span class=lnt id=hl-41-47><a class=lnlinks href=#hl-41-47> 47</a>
</span><span class=lnt id=hl-41-48><a class=lnlinks href=#hl-41-48> 48</a>
</span><span class=lnt id=hl-41-49><a class=lnlinks href=#hl-41-49> 49</a>
</span><span class=lnt id=hl-41-50><a class=lnlinks href=#hl-41-50> 50</a>
</span><span class=lnt id=hl-41-51><a class=lnlinks href=#hl-41-51> 51</a>
</span><span class=lnt id=hl-41-52><a class=lnlinks href=#hl-41-52> 52</a>
</span><span class=lnt id=hl-41-53><a class=lnlinks href=#hl-41-53> 53</a>
</span><span class=lnt id=hl-41-54><a class=lnlinks href=#hl-41-54> 54</a>
</span><span class=lnt id=hl-41-55><a class=lnlinks href=#hl-41-55> 55</a>
</span><span class=lnt id=hl-41-56><a class=lnlinks href=#hl-41-56> 56</a>
</span><span class=lnt id=hl-41-57><a class=lnlinks href=#hl-41-57> 57</a>
</span><span class=lnt id=hl-41-58><a class=lnlinks href=#hl-41-58> 58</a>
</span><span class=lnt id=hl-41-59><a class=lnlinks href=#hl-41-59> 59</a>
</span><span class=lnt id=hl-41-60><a class=lnlinks href=#hl-41-60> 60</a>
</span><span class=lnt id=hl-41-61><a class=lnlinks href=#hl-41-61> 61</a>
</span><span class=lnt id=hl-41-62><a class=lnlinks href=#hl-41-62> 62</a>
</span><span class=lnt id=hl-41-63><a class=lnlinks href=#hl-41-63> 63</a>
</span><span class=lnt id=hl-41-64><a class=lnlinks href=#hl-41-64> 64</a>
</span><span class=lnt id=hl-41-65><a class=lnlinks href=#hl-41-65> 65</a>
</span><span class=lnt id=hl-41-66><a class=lnlinks href=#hl-41-66> 66</a>
</span><span class=lnt id=hl-41-67><a class=lnlinks href=#hl-41-67> 67</a>
</span><span class=lnt id=hl-41-68><a class=lnlinks href=#hl-41-68> 68</a>
</span><span class=lnt id=hl-41-69><a class=lnlinks href=#hl-41-69> 69</a>
</span><span class=lnt id=hl-41-70><a class=lnlinks href=#hl-41-70> 70</a>
</span><span class=lnt id=hl-41-71><a class=lnlinks href=#hl-41-71> 71</a>
</span><span class=lnt id=hl-41-72><a class=lnlinks href=#hl-41-72> 72</a>
</span><span class=lnt id=hl-41-73><a class=lnlinks href=#hl-41-73> 73</a>
</span><span class=lnt id=hl-41-74><a class=lnlinks href=#hl-41-74> 74</a>
</span><span class=lnt id=hl-41-75><a class=lnlinks href=#hl-41-75> 75</a>
</span><span class=lnt id=hl-41-76><a class=lnlinks href=#hl-41-76> 76</a>
</span><span class=lnt id=hl-41-77><a class=lnlinks href=#hl-41-77> 77</a>
</span><span class=lnt id=hl-41-78><a class=lnlinks href=#hl-41-78> 78</a>
</span><span class=lnt id=hl-41-79><a class=lnlinks href=#hl-41-79> 79</a>
</span><span class=lnt id=hl-41-80><a class=lnlinks href=#hl-41-80> 80</a>
</span><span class=lnt id=hl-41-81><a class=lnlinks href=#hl-41-81> 81</a>
</span><span class=lnt id=hl-41-82><a class=lnlinks href=#hl-41-82> 82</a>
</span><span class=lnt id=hl-41-83><a class=lnlinks href=#hl-41-83> 83</a>
</span><span class=lnt id=hl-41-84><a class=lnlinks href=#hl-41-84> 84</a>
</span><span class=lnt id=hl-41-85><a class=lnlinks href=#hl-41-85> 85</a>
</span><span class=lnt id=hl-41-86><a class=lnlinks href=#hl-41-86> 86</a>
</span><span class=lnt id=hl-41-87><a class=lnlinks href=#hl-41-87> 87</a>
</span><span class=lnt id=hl-41-88><a class=lnlinks href=#hl-41-88> 88</a>
</span><span class=lnt id=hl-41-89><a class=lnlinks href=#hl-41-89> 89</a>
</span><span class=lnt id=hl-41-90><a class=lnlinks href=#hl-41-90> 90</a>
</span><span class=lnt id=hl-41-91><a class=lnlinks href=#hl-41-91> 91</a>
</span><span class=lnt id=hl-41-92><a class=lnlinks href=#hl-41-92> 92</a>
</span><span class=lnt id=hl-41-93><a class=lnlinks href=#hl-41-93> 93</a>
</span><span class=lnt id=hl-41-94><a class=lnlinks href=#hl-41-94> 94</a>
</span><span class=lnt id=hl-41-95><a class=lnlinks href=#hl-41-95> 95</a>
</span><span class=lnt id=hl-41-96><a class=lnlinks href=#hl-41-96> 96</a>
</span><span class=lnt id=hl-41-97><a class=lnlinks href=#hl-41-97> 97</a>
</span><span class=lnt id=hl-41-98><a class=lnlinks href=#hl-41-98> 98</a>
</span><span class=lnt id=hl-41-99><a class=lnlinks href=#hl-41-99> 99</a>
</span><span class=lnt id=hl-41-100><a class=lnlinks href=#hl-41-100>100</a>
</span><span class=lnt id=hl-41-101><a class=lnlinks href=#hl-41-101>101</a>
</span><span class=lnt id=hl-41-102><a class=lnlinks href=#hl-41-102>102</a>
</span><span class=lnt id=hl-41-103><a class=lnlinks href=#hl-41-103>103</a>
</span><span class=lnt id=hl-41-104><a class=lnlinks href=#hl-41-104>104</a>
</span><span class=lnt id=hl-41-105><a class=lnlinks href=#hl-41-105>105</a>
</span><span class=lnt id=hl-41-106><a class=lnlinks href=#hl-41-106>106</a>
</span><span class=lnt id=hl-41-107><a class=lnlinks href=#hl-41-107>107</a>
</span><span class=lnt id=hl-41-108><a class=lnlinks href=#hl-41-108>108</a>
</span><span class=lnt id=hl-41-109><a class=lnlinks href=#hl-41-109>109</a>
</span><span class=lnt id=hl-41-110><a class=lnlinks href=#hl-41-110>110</a>
</span><span class=lnt id=hl-41-111><a class=lnlinks href=#hl-41-111>111</a>
</span><span class=lnt id=hl-41-112><a class=lnlinks href=#hl-41-112>112</a>
</span><span class=lnt id=hl-41-113><a class=lnlinks href=#hl-41-113>113</a>
</span><span class=lnt id=hl-41-114><a class=lnlinks href=#hl-41-114>114</a>
</span><span class=lnt id=hl-41-115><a class=lnlinks href=#hl-41-115>115</a>
</span><span class=lnt id=hl-41-116><a class=lnlinks href=#hl-41-116>116</a>
</span><span class=lnt id=hl-41-117><a class=lnlinks href=#hl-41-117>117</a>
</span><span class=lnt id=hl-41-118><a class=lnlinks href=#hl-41-118>118</a>
</span><span class=lnt id=hl-41-119><a class=lnlinks href=#hl-41-119>119</a>
</span><span class=lnt id=hl-41-120><a class=lnlinks href=#hl-41-120>120</a>
</span><span class=lnt id=hl-41-121><a class=lnlinks href=#hl-41-121>121</a>
</span><span class=lnt id=hl-41-122><a class=lnlinks href=#hl-41-122>122</a>
</span><span class=lnt id=hl-41-123><a class=lnlinks href=#hl-41-123>123</a>
</span><span class=lnt id=hl-41-124><a class=lnlinks href=#hl-41-124>124</a>
</span><span class=lnt id=hl-41-125><a class=lnlinks href=#hl-41-125>125</a>
</span><span class=lnt id=hl-41-126><a class=lnlinks href=#hl-41-126>126</a>
</span><span class=lnt id=hl-41-127><a class=lnlinks href=#hl-41-127>127</a>
</span><span class=lnt id=hl-41-128><a class=lnlinks href=#hl-41-128>128</a>
</span><span class=lnt id=hl-41-129><a class=lnlinks href=#hl-41-129>129</a>
</span><span class=lnt id=hl-41-130><a class=lnlinks href=#hl-41-130>130</a>
</span><span class=lnt id=hl-41-131><a class=lnlinks href=#hl-41-131>131</a>
</span><span class=lnt id=hl-41-132><a class=lnlinks href=#hl-41-132>132</a>
</span><span class=lnt id=hl-41-133><a class=lnlinks href=#hl-41-133>133</a>
</span><span class=lnt id=hl-41-134><a class=lnlinks href=#hl-41-134>134</a>
</span><span class=lnt id=hl-41-135><a class=lnlinks href=#hl-41-135>135</a>
</span><span class=lnt id=hl-41-136><a class=lnlinks href=#hl-41-136>136</a>
</span><span class=lnt id=hl-41-137><a class=lnlinks href=#hl-41-137>137</a>
</span><span class=lnt id=hl-41-138><a class=lnlinks href=#hl-41-138>138</a>
</span><span class=lnt id=hl-41-139><a class=lnlinks href=#hl-41-139>139</a>
</span><span class=lnt id=hl-41-140><a class=lnlinks href=#hl-41-140>140</a>
</span><span class=lnt id=hl-41-141><a class=lnlinks href=#hl-41-141>141</a>
</span><span class=lnt id=hl-41-142><a class=lnlinks href=#hl-41-142>142</a>
</span><span class=lnt id=hl-41-143><a class=lnlinks href=#hl-41-143>143</a>
</span><span class=lnt id=hl-41-144><a class=lnlinks href=#hl-41-144>144</a>
</span><span class=lnt id=hl-41-145><a class=lnlinks href=#hl-41-145>145</a>
</span><span class=lnt id=hl-41-146><a class=lnlinks href=#hl-41-146>146</a>
</span><span class=lnt id=hl-41-147><a class=lnlinks href=#hl-41-147>147</a>
</span><span class=lnt id=hl-41-148><a class=lnlinks href=#hl-41-148>148</a>
</span><span class=lnt id=hl-41-149><a class=lnlinks href=#hl-41-149>149</a>
</span><span class=lnt id=hl-41-150><a class=lnlinks href=#hl-41-150>150</a>
</span><span class=lnt id=hl-41-151><a class=lnlinks href=#hl-41-151>151</a>
</span><span class=lnt id=hl-41-152><a class=lnlinks href=#hl-41-152>152</a>
</span><span class=lnt id=hl-41-153><a class=lnlinks href=#hl-41-153>153</a>
</span><span class=lnt id=hl-41-154><a class=lnlinks href=#hl-41-154>154</a>
</span><span class=lnt id=hl-41-155><a class=lnlinks href=#hl-41-155>155</a>
</span><span class=lnt id=hl-41-156><a class=lnlinks href=#hl-41-156>156</a>
</span><span class=lnt id=hl-41-157><a class=lnlinks href=#hl-41-157>157</a>
</span><span class=lnt id=hl-41-158><a class=lnlinks href=#hl-41-158>158</a>
</span><span class=lnt id=hl-41-159><a class=lnlinks href=#hl-41-159>159</a>
</span><span class=lnt id=hl-41-160><a class=lnlinks href=#hl-41-160>160</a>
</span><span class=lnt id=hl-41-161><a class=lnlinks href=#hl-41-161>161</a>
</span><span class=lnt id=hl-41-162><a class=lnlinks href=#hl-41-162>162</a>
</span><span class=lnt id=hl-41-163><a class=lnlinks href=#hl-41-163>163</a>
</span><span class=lnt id=hl-41-164><a class=lnlinks href=#hl-41-164>164</a>
</span><span class=lnt id=hl-41-165><a class=lnlinks href=#hl-41-165>165</a>
</span><span class=lnt id=hl-41-166><a class=lnlinks href=#hl-41-166>166</a>
</span><span class=lnt id=hl-41-167><a class=lnlinks href=#hl-41-167>167</a>
</span><span class=lnt id=hl-41-168><a class=lnlinks href=#hl-41-168>168</a>
</span><span class=lnt id=hl-41-169><a class=lnlinks href=#hl-41-169>169</a>
</span><span class=lnt id=hl-41-170><a class=lnlinks href=#hl-41-170>170</a>
</span><span class=lnt id=hl-41-171><a class=lnlinks href=#hl-41-171>171</a>
</span><span class=lnt id=hl-41-172><a class=lnlinks href=#hl-41-172>172</a>
</span><span class=lnt id=hl-41-173><a class=lnlinks href=#hl-41-173>173</a>
</span><span class=lnt id=hl-41-174><a class=lnlinks href=#hl-41-174>174</a>
</span><span class=lnt id=hl-41-175><a class=lnlinks href=#hl-41-175>175</a>
</span><span class=lnt id=hl-41-176><a class=lnlinks href=#hl-41-176>176</a>
</span><span class=lnt id=hl-41-177><a class=lnlinks href=#hl-41-177>177</a>
</span><span class=lnt id=hl-41-178><a class=lnlinks href=#hl-41-178>178</a>
</span><span class=lnt id=hl-41-179><a class=lnlinks href=#hl-41-179>179</a>
</span><span class=lnt id=hl-41-180><a class=lnlinks href=#hl-41-180>180</a>
</span><span class=lnt id=hl-41-181><a class=lnlinks href=#hl-41-181>181</a>
</span><span class=lnt id=hl-41-182><a class=lnlinks href=#hl-41-182>182</a>
</span><span class=lnt id=hl-41-183><a class=lnlinks href=#hl-41-183>183</a>
</span><span class=lnt id=hl-41-184><a class=lnlinks href=#hl-41-184>184</a>
</span><span class=lnt id=hl-41-185><a class=lnlinks href=#hl-41-185>185</a>
</span><span class=lnt id=hl-41-186><a class=lnlinks href=#hl-41-186>186</a>
</span><span class=lnt id=hl-41-187><a class=lnlinks href=#hl-41-187>187</a>
</span><span class=lnt id=hl-41-188><a class=lnlinks href=#hl-41-188>188</a>
</span><span class=lnt id=hl-41-189><a class=lnlinks href=#hl-41-189>189</a>
</span><span class=lnt id=hl-41-190><a class=lnlinks href=#hl-41-190>190</a>
</span><span class=lnt id=hl-41-191><a class=lnlinks href=#hl-41-191>191</a>
</span><span class=lnt id=hl-41-192><a class=lnlinks href=#hl-41-192>192</a>
</span><span class=lnt id=hl-41-193><a class=lnlinks href=#hl-41-193>193</a>
</span><span class=lnt id=hl-41-194><a class=lnlinks href=#hl-41-194>194</a>
</span><span class=lnt id=hl-41-195><a class=lnlinks href=#hl-41-195>195</a>
</span><span class=lnt id=hl-41-196><a class=lnlinks href=#hl-41-196>196</a>
</span><span class=lnt id=hl-41-197><a class=lnlinks href=#hl-41-197>197</a>
</span><span class=lnt id=hl-41-198><a class=lnlinks href=#hl-41-198>198</a>
</span><span class=lnt id=hl-41-199><a class=lnlinks href=#hl-41-199>199</a>
</span><span class=lnt id=hl-41-200><a class=lnlinks href=#hl-41-200>200</a>
</span><span class=lnt id=hl-41-201><a class=lnlinks href=#hl-41-201>201</a>
</span><span class=lnt id=hl-41-202><a class=lnlinks href=#hl-41-202>202</a>
</span><span class=lnt id=hl-41-203><a class=lnlinks href=#hl-41-203>203</a>
</span><span class=lnt id=hl-41-204><a class=lnlinks href=#hl-41-204>204</a>
</span><span class=lnt id=hl-41-205><a class=lnlinks href=#hl-41-205>205</a>
</span><span class=lnt id=hl-41-206><a class=lnlinks href=#hl-41-206>206</a>
</span><span class=lnt id=hl-41-207><a class=lnlinks href=#hl-41-207>207</a>
</span><span class=lnt id=hl-41-208><a class=lnlinks href=#hl-41-208>208</a>
</span><span class=lnt id=hl-41-209><a class=lnlinks href=#hl-41-209>209</a>
</span><span class=lnt id=hl-41-210><a class=lnlinks href=#hl-41-210>210</a>
</span><span class=lnt id=hl-41-211><a class=lnlinks href=#hl-41-211>211</a>
</span><span class=lnt id=hl-41-212><a class=lnlinks href=#hl-41-212>212</a>
</span><span class=lnt id=hl-41-213><a class=lnlinks href=#hl-41-213>213</a>
</span><span class=lnt id=hl-41-214><a class=lnlinks href=#hl-41-214>214</a>
</span><span class=lnt id=hl-41-215><a class=lnlinks href=#hl-41-215>215</a>
</span><span class=lnt id=hl-41-216><a class=lnlinks href=#hl-41-216>216</a>
</span><span class=lnt id=hl-41-217><a class=lnlinks href=#hl-41-217>217</a>
</span><span class=lnt id=hl-41-218><a class=lnlinks href=#hl-41-218>218</a>
</span><span class=lnt id=hl-41-219><a class=lnlinks href=#hl-41-219>219</a>
</span><span class=lnt id=hl-41-220><a class=lnlinks href=#hl-41-220>220</a>
</span><span class=lnt id=hl-41-221><a class=lnlinks href=#hl-41-221>221</a>
</span><span class=lnt id=hl-41-222><a class=lnlinks href=#hl-41-222>222</a>
</span><span class=lnt id=hl-41-223><a class=lnlinks href=#hl-41-223>223</a>
</span><span class=lnt id=hl-41-224><a class=lnlinks href=#hl-41-224>224</a>
</span><span class=lnt id=hl-41-225><a class=lnlinks href=#hl-41-225>225</a>
</span><span class=lnt id=hl-41-226><a class=lnlinks href=#hl-41-226>226</a>
</span><span class=lnt id=hl-41-227><a class=lnlinks href=#hl-41-227>227</a>
</span><span class=lnt id=hl-41-228><a class=lnlinks href=#hl-41-228>228</a>
</span><span class=lnt id=hl-41-229><a class=lnlinks href=#hl-41-229>229</a>
</span><span class=lnt id=hl-41-230><a class=lnlinks href=#hl-41-230>230</a>
</span><span class=lnt id=hl-41-231><a class=lnlinks href=#hl-41-231>231</a>
</span><span class=lnt id=hl-41-232><a class=lnlinks href=#hl-41-232>232</a>
</span><span class=lnt id=hl-41-233><a class=lnlinks href=#hl-41-233>233</a>
</span><span class=lnt id=hl-41-234><a class=lnlinks href=#hl-41-234>234</a>
</span><span class=lnt id=hl-41-235><a class=lnlinks href=#hl-41-235>235</a>
</span><span class=lnt id=hl-41-236><a class=lnlinks href=#hl-41-236>236</a>
</span><span class=lnt id=hl-41-237><a class=lnlinks href=#hl-41-237>237</a>
</span><span class=lnt id=hl-41-238><a class=lnlinks href=#hl-41-238>238</a>
</span><span class=lnt id=hl-41-239><a class=lnlinks href=#hl-41-239>239</a>
</span><span class=lnt id=hl-41-240><a class=lnlinks href=#hl-41-240>240</a>
</span><span class=lnt id=hl-41-241><a class=lnlinks href=#hl-41-241>241</a>
</span><span class=lnt id=hl-41-242><a class=lnlinks href=#hl-41-242>242</a>
</span><span class=lnt id=hl-41-243><a class=lnlinks href=#hl-41-243>243</a>
</span><span class=lnt id=hl-41-244><a class=lnlinks href=#hl-41-244>244</a>
</span><span class=lnt id=hl-41-245><a class=lnlinks href=#hl-41-245>245</a>
</span><span class=lnt id=hl-41-246><a class=lnlinks href=#hl-41-246>246</a>
</span><span class=lnt id=hl-41-247><a class=lnlinks href=#hl-41-247>247</a>
</span><span class=lnt id=hl-41-248><a class=lnlinks href=#hl-41-248>248</a>
</span><span class=lnt id=hl-41-249><a class=lnlinks href=#hl-41-249>249</a>
</span><span class=lnt id=hl-41-250><a class=lnlinks href=#hl-41-250>250</a>
</span><span class=lnt id=hl-41-251><a class=lnlinks href=#hl-41-251>251</a>
</span><span class=lnt id=hl-41-252><a class=lnlinks href=#hl-41-252>252</a>
</span><span class=lnt id=hl-41-253><a class=lnlinks href=#hl-41-253>253</a>
</span><span class=lnt id=hl-41-254><a class=lnlinks href=#hl-41-254>254</a>
</span><span class=lnt id=hl-41-255><a class=lnlinks href=#hl-41-255>255</a>
</span><span class=lnt id=hl-41-256><a class=lnlinks href=#hl-41-256>256</a>
</span><span class=lnt id=hl-41-257><a class=lnlinks href=#hl-41-257>257</a>
</span><span class=lnt id=hl-41-258><a class=lnlinks href=#hl-41-258>258</a>
</span><span class=lnt id=hl-41-259><a class=lnlinks href=#hl-41-259>259</a>
</span><span class=lnt id=hl-41-260><a class=lnlinks href=#hl-41-260>260</a>
</span><span class=lnt id=hl-41-261><a class=lnlinks href=#hl-41-261>261</a>
</span><span class=lnt id=hl-41-262><a class=lnlinks href=#hl-41-262>262</a>
</span><span class=lnt id=hl-41-263><a class=lnlinks href=#hl-41-263>263</a>
</span><span class=lnt id=hl-41-264><a class=lnlinks href=#hl-41-264>264</a>
</span><span class=lnt id=hl-41-265><a class=lnlinks href=#hl-41-265>265</a>
</span><span class=lnt id=hl-41-266><a class=lnlinks href=#hl-41-266>266</a>
</span><span class=lnt id=hl-41-267><a class=lnlinks href=#hl-41-267>267</a>
</span><span class=lnt id=hl-41-268><a class=lnlinks href=#hl-41-268>268</a>
</span><span class=lnt id=hl-41-269><a class=lnlinks href=#hl-41-269>269</a>
</span><span class=lnt id=hl-41-270><a class=lnlinks href=#hl-41-270>270</a>
</span><span class=lnt id=hl-41-271><a class=lnlinks href=#hl-41-271>271</a>
</span><span class=lnt id=hl-41-272><a class=lnlinks href=#hl-41-272>272</a>
</span><span class=lnt id=hl-41-273><a class=lnlinks href=#hl-41-273>273</a>
</span><span class=lnt id=hl-41-274><a class=lnlinks href=#hl-41-274>274</a>
</span><span class=lnt id=hl-41-275><a class=lnlinks href=#hl-41-275>275</a>
</span><span class=lnt id=hl-41-276><a class=lnlinks href=#hl-41-276>276</a>
</span><span class=lnt id=hl-41-277><a class=lnlinks href=#hl-41-277>277</a>
</span><span class=lnt id=hl-41-278><a class=lnlinks href=#hl-41-278>278</a>
</span><span class=lnt id=hl-41-279><a class=lnlinks href=#hl-41-279>279</a>
</span><span class=lnt id=hl-41-280><a class=lnlinks href=#hl-41-280>280</a>
</span><span class=lnt id=hl-41-281><a class=lnlinks href=#hl-41-281>281</a>
</span><span class=lnt id=hl-41-282><a class=lnlinks href=#hl-41-282>282</a>
</span><span class=lnt id=hl-41-283><a class=lnlinks href=#hl-41-283>283</a>
</span><span class=lnt id=hl-41-284><a class=lnlinks href=#hl-41-284>284</a>
</span><span class=lnt id=hl-41-285><a class=lnlinks href=#hl-41-285>285</a>
</span><span class=lnt id=hl-41-286><a class=lnlinks href=#hl-41-286>286</a>
</span><span class=lnt id=hl-41-287><a class=lnlinks href=#hl-41-287>287</a>
</span><span class=lnt id=hl-41-288><a class=lnlinks href=#hl-41-288>288</a>
</span><span class=lnt id=hl-41-289><a class=lnlinks href=#hl-41-289>289</a>
</span><span class=lnt id=hl-41-290><a class=lnlinks href=#hl-41-290>290</a>
</span><span class=lnt id=hl-41-291><a class=lnlinks href=#hl-41-291>291</a>
</span><span class=lnt id=hl-41-292><a class=lnlinks href=#hl-41-292>292</a>
</span><span class=lnt id=hl-41-293><a class=lnlinks href=#hl-41-293>293</a>
</span><span class=lnt id=hl-41-294><a class=lnlinks href=#hl-41-294>294</a>
</span><span class=lnt id=hl-41-295><a class=lnlinks href=#hl-41-295>295</a>
</span><span class=lnt id=hl-41-296><a class=lnlinks href=#hl-41-296>296</a>
</span><span class=lnt id=hl-41-297><a class=lnlinks href=#hl-41-297>297</a>
</span><span class=lnt id=hl-41-298><a class=lnlinks href=#hl-41-298>298</a>
</span><span class=lnt id=hl-41-299><a class=lnlinks href=#hl-41-299>299</a>
</span><span class=lnt id=hl-41-300><a class=lnlinks href=#hl-41-300>300</a>
</span><span class=lnt id=hl-41-301><a class=lnlinks href=#hl-41-301>301</a>
</span><span class=lnt id=hl-41-302><a class=lnlinks href=#hl-41-302>302</a>
</span><span class=lnt id=hl-41-303><a class=lnlinks href=#hl-41-303>303</a>
</span><span class=lnt id=hl-41-304><a class=lnlinks href=#hl-41-304>304</a>
</span><span class=lnt id=hl-41-305><a class=lnlinks href=#hl-41-305>305</a>
</span><span class=lnt id=hl-41-306><a class=lnlinks href=#hl-41-306>306</a>
</span><span class=lnt id=hl-41-307><a class=lnlinks href=#hl-41-307>307</a>
</span><span class=lnt id=hl-41-308><a class=lnlinks href=#hl-41-308>308</a>
</span><span class=lnt id=hl-41-309><a class=lnlinks href=#hl-41-309>309</a>
</span><span class=lnt id=hl-41-310><a class=lnlinks href=#hl-41-310>310</a>
</span><span class=lnt id=hl-41-311><a class=lnlinks href=#hl-41-311>311</a>
</span><span class=lnt id=hl-41-312><a class=lnlinks href=#hl-41-312>312</a>
</span><span class=lnt id=hl-41-313><a class=lnlinks href=#hl-41-313>313</a>
</span><span class=lnt id=hl-41-314><a class=lnlinks href=#hl-41-314>314</a>
</span><span class=lnt id=hl-41-315><a class=lnlinks href=#hl-41-315>315</a>
</span><span class=lnt id=hl-41-316><a class=lnlinks href=#hl-41-316>316</a>
</span><span class=lnt id=hl-41-317><a class=lnlinks href=#hl-41-317>317</a>
</span><span class=lnt id=hl-41-318><a class=lnlinks href=#hl-41-318>318</a>
</span><span class=lnt id=hl-41-319><a class=lnlinks href=#hl-41-319>319</a>
</span><span class=lnt id=hl-41-320><a class=lnlinks href=#hl-41-320>320</a>
</span><span class=lnt id=hl-41-321><a class=lnlinks href=#hl-41-321>321</a>
</span><span class=lnt id=hl-41-322><a class=lnlinks href=#hl-41-322>322</a>
</span><span class=lnt id=hl-41-323><a class=lnlinks href=#hl-41-323>323</a>
</span><span class=lnt id=hl-41-324><a class=lnlinks href=#hl-41-324>324</a>
</span><span class=lnt id=hl-41-325><a class=lnlinks href=#hl-41-325>325</a>
</span><span class=lnt id=hl-41-326><a class=lnlinks href=#hl-41-326>326</a>
</span><span class=lnt id=hl-41-327><a class=lnlinks href=#hl-41-327>327</a>
</span><span class=lnt id=hl-41-328><a class=lnlinks href=#hl-41-328>328</a>
</span><span class=lnt id=hl-41-329><a class=lnlinks href=#hl-41-329>329</a>
</span><span class=lnt id=hl-41-330><a class=lnlinks href=#hl-41-330>330</a>
</span><span class=lnt id=hl-41-331><a class=lnlinks href=#hl-41-331>331</a>
</span><span class=lnt id=hl-41-332><a class=lnlinks href=#hl-41-332>332</a>
</span><span class=lnt id=hl-41-333><a class=lnlinks href=#hl-41-333>333</a>
</span><span class=lnt id=hl-41-334><a class=lnlinks href=#hl-41-334>334</a>
</span><span class=lnt id=hl-41-335><a class=lnlinks href=#hl-41-335>335</a>
</span><span class=lnt id=hl-41-336><a class=lnlinks href=#hl-41-336>336</a>
</span><span class=lnt id=hl-41-337><a class=lnlinks href=#hl-41-337>337</a>
</span><span class=lnt id=hl-41-338><a class=lnlinks href=#hl-41-338>338</a>
</span><span class=lnt id=hl-41-339><a class=lnlinks href=#hl-41-339>339</a>
</span><span class=lnt id=hl-41-340><a class=lnlinks href=#hl-41-340>340</a>
</span><span class=lnt id=hl-41-341><a class=lnlinks href=#hl-41-341>341</a>
</span><span class=lnt id=hl-41-342><a class=lnlinks href=#hl-41-342>342</a>
</span><span class=lnt id=hl-41-343><a class=lnlinks href=#hl-41-343>343</a>
</span><span class=lnt id=hl-41-344><a class=lnlinks href=#hl-41-344>344</a>
</span><span class=lnt id=hl-41-345><a class=lnlinks href=#hl-41-345>345</a>
</span><span class=lnt id=hl-41-346><a class=lnlinks href=#hl-41-346>346</a>
</span><span class=lnt id=hl-41-347><a class=lnlinks href=#hl-41-347>347</a>
</span><span class=lnt id=hl-41-348><a class=lnlinks href=#hl-41-348>348</a>
</span><span class=lnt id=hl-41-349><a class=lnlinks href=#hl-41-349>349</a>
</span><span class=lnt id=hl-41-350><a class=lnlinks href=#hl-41-350>350</a>
</span><span class=lnt id=hl-41-351><a class=lnlinks href=#hl-41-351>351</a>
</span><span class=lnt id=hl-41-352><a class=lnlinks href=#hl-41-352>352</a>
</span><span class=lnt id=hl-41-353><a class=lnlinks href=#hl-41-353>353</a>
</span><span class=lnt id=hl-41-354><a class=lnlinks href=#hl-41-354>354</a>
</span><span class=lnt id=hl-41-355><a class=lnlinks href=#hl-41-355>355</a>
</span><span class=lnt id=hl-41-356><a class=lnlinks href=#hl-41-356>356</a>
</span><span class=lnt id=hl-41-357><a class=lnlinks href=#hl-41-357>357</a>
</span><span class=lnt id=hl-41-358><a class=lnlinks href=#hl-41-358>358</a>
</span><span class=lnt id=hl-41-359><a class=lnlinks href=#hl-41-359>359</a>
</span><span class=lnt id=hl-41-360><a class=lnlinks href=#hl-41-360>360</a>
</span><span class=lnt id=hl-41-361><a class=lnlinks href=#hl-41-361>361</a>
</span><span class=lnt id=hl-41-362><a class=lnlinks href=#hl-41-362>362</a>
</span><span class=lnt id=hl-41-363><a class=lnlinks href=#hl-41-363>363</a>
</span><span class=lnt id=hl-41-364><a class=lnlinks href=#hl-41-364>364</a>
</span><span class=lnt id=hl-41-365><a class=lnlinks href=#hl-41-365>365</a>
</span><span class=lnt id=hl-41-366><a class=lnlinks href=#hl-41-366>366</a>
</span><span class=lnt id=hl-41-367><a class=lnlinks href=#hl-41-367>367</a>
</span><span class=lnt id=hl-41-368><a class=lnlinks href=#hl-41-368>368</a>
</span><span class=lnt id=hl-41-369><a class=lnlinks href=#hl-41-369>369</a>
</span><span class=lnt id=hl-41-370><a class=lnlinks href=#hl-41-370>370</a>
</span><span class=lnt id=hl-41-371><a class=lnlinks href=#hl-41-371>371</a>
</span><span class=lnt id=hl-41-372><a class=lnlinks href=#hl-41-372>372</a>
</span><span class=lnt id=hl-41-373><a class=lnlinks href=#hl-41-373>373</a>
</span><span class=lnt id=hl-41-374><a class=lnlinks href=#hl-41-374>374</a>
</span><span class=lnt id=hl-41-375><a class=lnlinks href=#hl-41-375>375</a>
</span><span class=lnt id=hl-41-376><a class=lnlinks href=#hl-41-376>376</a>
</span><span class=lnt id=hl-41-377><a class=lnlinks href=#hl-41-377>377</a>
</span><span class=lnt id=hl-41-378><a class=lnlinks href=#hl-41-378>378</a>
</span><span class=lnt id=hl-41-379><a class=lnlinks href=#hl-41-379>379</a>
</span><span class=lnt id=hl-41-380><a class=lnlinks href=#hl-41-380>380</a>
</span><span class=lnt id=hl-41-381><a class=lnlinks href=#hl-41-381>381</a>
</span><span class=lnt id=hl-41-382><a class=lnlinks href=#hl-41-382>382</a>
</span><span class=lnt id=hl-41-383><a class=lnlinks href=#hl-41-383>383</a>
</span><span class=lnt id=hl-41-384><a class=lnlinks href=#hl-41-384>384</a>
</span><span class=lnt id=hl-41-385><a class=lnlinks href=#hl-41-385>385</a>
</span><span class=lnt id=hl-41-386><a class=lnlinks href=#hl-41-386>386</a>
</span><span class=lnt id=hl-41-387><a class=lnlinks href=#hl-41-387>387</a>
</span><span class=lnt id=hl-41-388><a class=lnlinks href=#hl-41-388>388</a>
</span><span class=lnt id=hl-41-389><a class=lnlinks href=#hl-41-389>389</a>
</span><span class=lnt id=hl-41-390><a class=lnlinks href=#hl-41-390>390</a>
</span><span class=lnt id=hl-41-391><a class=lnlinks href=#hl-41-391>391</a>
</span><span class=lnt id=hl-41-392><a class=lnlinks href=#hl-41-392>392</a>
</span><span class=lnt id=hl-41-393><a class=lnlinks href=#hl-41-393>393</a>
</span><span class=lnt id=hl-41-394><a class=lnlinks href=#hl-41-394>394</a>
</span><span class=lnt id=hl-41-395><a class=lnlinks href=#hl-41-395>395</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js에서 RabbitMQ 모니터링 및 자동화된 대응 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>axios</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;axios&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cron</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;node-cron&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>MessageQueueMonitor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>config</span> <span class=o>=</span> <span class=nx>config</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>alerts</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>connect</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>rabbitmq</span><span class=p>.</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;RabbitMQ에 연결되었습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;RabbitMQ 연결 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>monitorQueues</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>connected</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>connected</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;모니터링을 시작할 수 없습니다: RabbitMQ에 연결되지 않음&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 모든 큐 상태 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>queueName</span> <span class=k>of</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>queues</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>queueInfo</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=nx>queueName</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 이전 상태 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>const</span> <span class=nx>prevStatus</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span><span class=p>[</span><span class=nx>queueName</span><span class=p>]</span> <span class=o>||</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 현재 상태 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span><span class=p>[</span><span class=nx>queueName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>name</span><span class=o>:</span> <span class=nx>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>messageCount</span><span class=o>:</span> <span class=nx>queueInfo</span><span class=p>.</span><span class=nx>messageCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>consumerCount</span><span class=o>:</span> <span class=nx>queueInfo</span><span class=p>.</span><span class=nx>consumerCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=nx>previousCount</span><span class=o>:</span> <span class=nx>prevStatus</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>||</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>growth</span><span class=o>:</span> <span class=nx>prevStatus</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>!==</span> <span class=kc>undefined</span> <span class=o>?</span> 
</span></span><span class=line><span class=cl>              <span class=nx>queueInfo</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>-</span> <span class=nx>prevStatus</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=p>};</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 경보 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>checkAlerts</span><span class=p>(</span><span class=nx>queueName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`큐 </span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb>: 메시지=</span><span class=si>${</span><span class=nx>queueInfo</span><span class=p>.</span><span class=nx>messageCount</span><span class=si>}</span><span class=sb>, 소비자=</span><span class=si>${</span><span class=nx>queueInfo</span><span class=p>.</span><span class=nx>consumerCount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`큐 </span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb> 모니터링 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 데드 레터 큐 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>dlqName</span> <span class=k>of</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>deadLetterQueues</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>dlqInfo</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=nx>dlqName</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span><span class=p>[</span><span class=nx>dlqName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>name</span><span class=o>:</span> <span class=nx>dlqName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>messageCount</span><span class=o>:</span> <span class=nx>dlqInfo</span><span class=p>.</span><span class=nx>messageCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>consumerCount</span><span class=o>:</span> <span class=nx>dlqInfo</span><span class=p>.</span><span class=nx>consumerCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=nx>isDLQ</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>          <span class=p>};</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 데드 레터 큐 경보 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>if</span> <span class=p>(</span><span class=nx>dlqInfo</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>deadLetterThreshold</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>triggerAlert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>              <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;dead_letter_buildup&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>queue</span><span class=o>:</span> <span class=nx>dlqName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>messageCount</span><span class=o>:</span> <span class=nx>dlqInfo</span><span class=p>.</span><span class=nx>messageCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>threshold</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>deadLetterThreshold</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`데드 레터 큐 </span><span class=si>${</span><span class=nx>dlqName</span><span class=si>}</span><span class=sb>: 메시지=</span><span class=si>${</span><span class=nx>dlqInfo</span><span class=p>.</span><span class=nx>messageCount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`데드 레터 큐 </span><span class=si>${</span><span class=nx>dlqName</span><span class=si>}</span><span class=sb> 모니터링 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 메트릭 보고
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>reportMetrics</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;큐 모니터링 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 연결 재시도
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>connection</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>channel</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>checkAlerts</span><span class=p>(</span><span class=nx>queueName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>status</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span><span class=p>[</span><span class=nx>queueName</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 큐 적체 경보
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>status</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>queueSizeThreshold</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>triggerAlert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;queue_buildup&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>queue</span><span class=o>:</span> <span class=nx>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>messageCount</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>messageCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>threshold</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>queueSizeThreshold</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 자동화된 대응 실행
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>scaleUpConsumers</span><span class=p>(</span><span class=nx>queueName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메시지 증가율 경보
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>status</span><span class=p>.</span><span class=nx>growth</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>growthRateThreshold</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>triggerAlert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;queue_growth_rate&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>queue</span><span class=o>:</span> <span class=nx>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>growth</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>growth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>threshold</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>growthRateThreshold</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 소비자 부족 경보
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>status</span><span class=p>.</span><span class=nx>consumerCount</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>minConsumers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>triggerAlert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;consumer_shortage&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>queue</span><span class=o>:</span> <span class=nx>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>consumerCount</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>consumerCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>minRequired</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>minConsumers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 자동화된 대응 실행
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>restartConsumers</span><span class=p>(</span><span class=nx>queueName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>triggerAlert</span><span class=p>(</span><span class=nx>alert</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=sb>`경보 발생: </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb> - </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>queue</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>alerts</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>alert</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 경보 중복 방지 (같은 유형의 경보가 5분 내에 발생한 경우)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>recentSimilarAlert</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>alerts</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>a</span> <span class=p>=&gt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=nx>alert</span><span class=p>.</span><span class=nx>type</span> <span class=o>&amp;&amp;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>queue</span> <span class=o>===</span> <span class=nx>alert</span><span class=p>.</span><span class=nx>queue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>a</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>()</span> <span class=o>-</span> <span class=nx>a</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>recentSimilarAlert</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 알림 전송 (Slack, 이메일 등)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>sendNotification</span><span class=p>(</span><span class=nx>alert</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>sendNotification</span><span class=p>(</span><span class=nx>alert</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Slack 웹훅 알림 전송 예시
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>notifications</span><span class=p>.</span><span class=nx>slack</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>severity</span> <span class=o>=</span> <span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;buildup&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;shortage&#39;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>          <span class=o>?</span> <span class=s1>&#39;🔴 심각&#39;</span> <span class=o>:</span> <span class=s1>&#39;🟠 경고&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>notifications</span><span class=p>.</span><span class=nx>slack</span><span class=p>.</span><span class=nx>webhookUrl</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=nx>severity</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>blocks</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;section&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>text</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;mrkdwn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>text</span><span class=o>:</span> <span class=sb>`*</span><span class=si>${</span><span class=nx>severity</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb>*`</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;section&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;mrkdwn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>text</span><span class=o>:</span> <span class=sb>`*큐:*\n</span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>queue</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;mrkdwn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>text</span><span class=o>:</span> <span class=sb>`*메시지 수:*\n</span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>messageCount</span> <span class=o>||</span> <span class=s1>&#39;N/A&#39;</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;mrkdwn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>text</span><span class=o>:</span> <span class=sb>`*임계값:*\n</span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>threshold</span> <span class=o>||</span> <span class=nx>alert</span><span class=p>.</span><span class=nx>minRequired</span> <span class=o>||</span> <span class=s1>&#39;N/A&#39;</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;mrkdwn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>text</span><span class=o>:</span> <span class=sb>`*시간:*\n</span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>.</span><span class=nx>toISOString</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Slack 알림 전송됨: </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb> - </span><span class=si>${</span><span class=nx>alert</span><span class=p>.</span><span class=nx>queue</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;알림 전송 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>reportMetrics</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 메트릭 보고 (Prometheus, CloudWatch 등)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>metrics</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>values</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>queuesStatus</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>status</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>queueName</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>messageCount</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>messageCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>consumerCount</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>consumerCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>isDLQ</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>isDLQ</span> <span class=o>||</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>timestamp</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>.</span><span class=nx>getTime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 메트릭 API로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>,</span> <span class=p>{</span> <span class=nx>metrics</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;메트릭 보고 완료&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;메트릭 보고 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>scaleUpConsumers</span><span class=p>(</span><span class=nx>queueName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`큐 </span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb>에 대한 소비자 확장 시작`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Kubernetes API 호출 예시 (실제 환경에 맞게 조정 필요)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>k8sApi</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>deployment</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>deployments</span><span class=p>[</span><span class=nx>queueName</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>deployment</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>patch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sb>`</span><span class=si>${</span><span class=nx>k8sApi</span><span class=si>}</span><span class=sb>/namespaces/</span><span class=si>${</span><span class=nx>deployment</span><span class=p>.</span><span class=nx>namespace</span><span class=si>}</span><span class=sb>/deployments/</span><span class=si>${</span><span class=nx>deployment</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>/scale`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>spec</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>replicas</span><span class=o>:</span> <span class=nx>deployment</span><span class=p>.</span><span class=nx>maxReplicas</span> <span class=o>||</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Authorization&#39;</span><span class=o>:</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoRemediation</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>token</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/strategic-merge-patch+json&#39;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb> 소비자 수 확장 완료`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`소비자 확장 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>restartConsumers</span><span class=p>(</span><span class=nx>queueName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`큐 </span><span class=si>${</span><span class=nx>queueName</span><span class=si>}</span><span class=sb>에 대한 소비자 재시작 시작`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 소비자 서비스 재시작 로직 구현
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// (실제 환경에 맞는 API 호출 또는 스크립트 실행)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`소비자 재시작 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>purgeDeadLetterQueue</span><span class=p>(</span><span class=nx>dlqName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`데드 레터 큐 </span><span class=si>${</span><span class=nx>dlqName</span><span class=si>}</span><span class=sb> 비우기 시작`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 각 메시지를 가져와서 로그로 기록 후 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kd>let</span> <span class=nx>emptyQueue</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>processedCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=nx>emptyQueue</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>dlqName</span><span class=p>,</span> <span class=p>{</span> <span class=nx>noAck</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 메시지 로깅
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`DLQ 메시지: </span><span class=si>${</span><span class=nx>message</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 메시지 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>channel</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>processedCount</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>emptyQueue</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`데드 레터 큐 </span><span class=si>${</span><span class=nx>dlqName</span><span class=si>}</span><span class=sb>에서 </span><span class=si>${</span><span class=nx>processedCount</span><span class=si>}</span><span class=sb>개 메시지 처리됨`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`데드 레터 큐 비우기 오류:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>start</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 초기 연결
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 정기적인 모니터링 스케줄링
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>cron</span><span class=p>.</span><span class=nx>schedule</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>monitoringInterval</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>monitorQueues</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 데드 레터 큐 정기 점검
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>deadLetterCleanup</span><span class=p>.</span><span class=nx>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>cron</span><span class=p>.</span><span class=nx>schedule</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>deadLetterCleanup</span><span class=p>.</span><span class=nx>schedule</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>dlqName</span> <span class=k>of</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>deadLetterQueues</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>purgeDeadLetterQueue</span><span class=p>(</span><span class=nx>dlqName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;메시지 큐 모니터링 시작됨&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>stop</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;메시지 큐 모니터링 중지됨&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 설정 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>rabbitmq</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;amqp://guest:guest@localhost&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>queues</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=s1>&#39;notifications&#39;</span><span class=p>,</span> <span class=s1>&#39;emails&#39;</span><span class=p>,</span> <span class=s1>&#39;payments&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>deadLetterQueues</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;orders.failed&#39;</span><span class=p>,</span> <span class=s1>&#39;notifications.failed&#39;</span><span class=p>,</span> <span class=s1>&#39;emails.failed&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>monitoringInterval</span><span class=o>:</span> <span class=s1>&#39;*/1 * * * *&#39;</span><span class=p>,</span>  <span class=c1>// 매 분마다
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>alerts</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>queueSizeThreshold</span><span class=o>:</span> <span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>growthRateThreshold</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>minConsumers</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>deadLetterThreshold</span><span class=o>:</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>autoRemediation</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>kubernetes</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>endpoint</span><span class=o>:</span> <span class=s1>&#39;https://kubernetes.default.svc&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>token</span><span class=o>:</span> <span class=s1>&#39;k8s-token&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>deployments</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>orders</span><span class=o>:</span> <span class=p>{</span> <span class=nx>namespace</span><span class=o>:</span> <span class=s1>&#39;default&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;order-consumer&#39;</span><span class=p>,</span> <span class=nx>maxReplicas</span><span class=o>:</span> <span class=mi>5</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>notifications</span><span class=o>:</span> <span class=p>{</span> <span class=nx>namespace</span><span class=o>:</span> <span class=s1>&#39;default&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;notification-consumer&#39;</span><span class=p>,</span> <span class=nx>maxReplicas</span><span class=o>:</span> <span class=mi>3</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>deadLetterCleanup</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>schedule</span><span class=o>:</span> <span class=s1>&#39;0 * * * *&#39;</span>  <span class=c1>// 매 시간마다
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>notifications</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>slack</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>webhookUrl</span><span class=o>:</span> <span class=s1>&#39;https://hooks.slack.com/services/XXX/YYY/ZZZ&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>metrics</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>endpoint</span><span class=o>:</span> <span class=s1>&#39;http://metrics-collector:8080/api/metrics&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 모니터링 시작
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>monitor</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MessageQueueMonitor</span><span class=p>(</span><span class=nx>config</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>monitor</span><span class=p>.</span><span class=nx>start</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 정상 종료 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;프로그램 종료 중...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>monitor</span><span class=p>.</span><span class=nx>stop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐의-고급-응용-패턴>메시징 큐의 고급 응용 패턴<a hidden class=anchor aria-hidden=true href=#메시징-큐의-고급-응용-패턴>#</a></h3><h4 id=명령-쿼리-책임-분리cqrs와-이벤트-소싱event-sourcing>명령 쿼리 책임 분리(CQRS)와 이벤트 소싱(Event Sourcing)<a hidden class=anchor aria-hidden=true href=#명령-쿼리-책임-분리cqrs와-이벤트-소싱event-sourcing>#</a></h4><p>메시징 큐는 CQRS와 이벤트 소싱 패턴을 구현하는 데 핵심적인 역할을 한다. 이벤트를 저장하고 전파하여 시스템의 상태 변화를 추적한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1>  1</a>
</span><span class=lnt id=hl-42-2><a class=lnlinks href=#hl-42-2>  2</a>
</span><span class=lnt id=hl-42-3><a class=lnlinks href=#hl-42-3>  3</a>
</span><span class=lnt id=hl-42-4><a class=lnlinks href=#hl-42-4>  4</a>
</span><span class=lnt id=hl-42-5><a class=lnlinks href=#hl-42-5>  5</a>
</span><span class=lnt id=hl-42-6><a class=lnlinks href=#hl-42-6>  6</a>
</span><span class=lnt id=hl-42-7><a class=lnlinks href=#hl-42-7>  7</a>
</span><span class=lnt id=hl-42-8><a class=lnlinks href=#hl-42-8>  8</a>
</span><span class=lnt id=hl-42-9><a class=lnlinks href=#hl-42-9>  9</a>
</span><span class=lnt id=hl-42-10><a class=lnlinks href=#hl-42-10> 10</a>
</span><span class=lnt id=hl-42-11><a class=lnlinks href=#hl-42-11> 11</a>
</span><span class=lnt id=hl-42-12><a class=lnlinks href=#hl-42-12> 12</a>
</span><span class=lnt id=hl-42-13><a class=lnlinks href=#hl-42-13> 13</a>
</span><span class=lnt id=hl-42-14><a class=lnlinks href=#hl-42-14> 14</a>
</span><span class=lnt id=hl-42-15><a class=lnlinks href=#hl-42-15> 15</a>
</span><span class=lnt id=hl-42-16><a class=lnlinks href=#hl-42-16> 16</a>
</span><span class=lnt id=hl-42-17><a class=lnlinks href=#hl-42-17> 17</a>
</span><span class=lnt id=hl-42-18><a class=lnlinks href=#hl-42-18> 18</a>
</span><span class=lnt id=hl-42-19><a class=lnlinks href=#hl-42-19> 19</a>
</span><span class=lnt id=hl-42-20><a class=lnlinks href=#hl-42-20> 20</a>
</span><span class=lnt id=hl-42-21><a class=lnlinks href=#hl-42-21> 21</a>
</span><span class=lnt id=hl-42-22><a class=lnlinks href=#hl-42-22> 22</a>
</span><span class=lnt id=hl-42-23><a class=lnlinks href=#hl-42-23> 23</a>
</span><span class=lnt id=hl-42-24><a class=lnlinks href=#hl-42-24> 24</a>
</span><span class=lnt id=hl-42-25><a class=lnlinks href=#hl-42-25> 25</a>
</span><span class=lnt id=hl-42-26><a class=lnlinks href=#hl-42-26> 26</a>
</span><span class=lnt id=hl-42-27><a class=lnlinks href=#hl-42-27> 27</a>
</span><span class=lnt id=hl-42-28><a class=lnlinks href=#hl-42-28> 28</a>
</span><span class=lnt id=hl-42-29><a class=lnlinks href=#hl-42-29> 29</a>
</span><span class=lnt id=hl-42-30><a class=lnlinks href=#hl-42-30> 30</a>
</span><span class=lnt id=hl-42-31><a class=lnlinks href=#hl-42-31> 31</a>
</span><span class=lnt id=hl-42-32><a class=lnlinks href=#hl-42-32> 32</a>
</span><span class=lnt id=hl-42-33><a class=lnlinks href=#hl-42-33> 33</a>
</span><span class=lnt id=hl-42-34><a class=lnlinks href=#hl-42-34> 34</a>
</span><span class=lnt id=hl-42-35><a class=lnlinks href=#hl-42-35> 35</a>
</span><span class=lnt id=hl-42-36><a class=lnlinks href=#hl-42-36> 36</a>
</span><span class=lnt id=hl-42-37><a class=lnlinks href=#hl-42-37> 37</a>
</span><span class=lnt id=hl-42-38><a class=lnlinks href=#hl-42-38> 38</a>
</span><span class=lnt id=hl-42-39><a class=lnlinks href=#hl-42-39> 39</a>
</span><span class=lnt id=hl-42-40><a class=lnlinks href=#hl-42-40> 40</a>
</span><span class=lnt id=hl-42-41><a class=lnlinks href=#hl-42-41> 41</a>
</span><span class=lnt id=hl-42-42><a class=lnlinks href=#hl-42-42> 42</a>
</span><span class=lnt id=hl-42-43><a class=lnlinks href=#hl-42-43> 43</a>
</span><span class=lnt id=hl-42-44><a class=lnlinks href=#hl-42-44> 44</a>
</span><span class=lnt id=hl-42-45><a class=lnlinks href=#hl-42-45> 45</a>
</span><span class=lnt id=hl-42-46><a class=lnlinks href=#hl-42-46> 46</a>
</span><span class=lnt id=hl-42-47><a class=lnlinks href=#hl-42-47> 47</a>
</span><span class=lnt id=hl-42-48><a class=lnlinks href=#hl-42-48> 48</a>
</span><span class=lnt id=hl-42-49><a class=lnlinks href=#hl-42-49> 49</a>
</span><span class=lnt id=hl-42-50><a class=lnlinks href=#hl-42-50> 50</a>
</span><span class=lnt id=hl-42-51><a class=lnlinks href=#hl-42-51> 51</a>
</span><span class=lnt id=hl-42-52><a class=lnlinks href=#hl-42-52> 52</a>
</span><span class=lnt id=hl-42-53><a class=lnlinks href=#hl-42-53> 53</a>
</span><span class=lnt id=hl-42-54><a class=lnlinks href=#hl-42-54> 54</a>
</span><span class=lnt id=hl-42-55><a class=lnlinks href=#hl-42-55> 55</a>
</span><span class=lnt id=hl-42-56><a class=lnlinks href=#hl-42-56> 56</a>
</span><span class=lnt id=hl-42-57><a class=lnlinks href=#hl-42-57> 57</a>
</span><span class=lnt id=hl-42-58><a class=lnlinks href=#hl-42-58> 58</a>
</span><span class=lnt id=hl-42-59><a class=lnlinks href=#hl-42-59> 59</a>
</span><span class=lnt id=hl-42-60><a class=lnlinks href=#hl-42-60> 60</a>
</span><span class=lnt id=hl-42-61><a class=lnlinks href=#hl-42-61> 61</a>
</span><span class=lnt id=hl-42-62><a class=lnlinks href=#hl-42-62> 62</a>
</span><span class=lnt id=hl-42-63><a class=lnlinks href=#hl-42-63> 63</a>
</span><span class=lnt id=hl-42-64><a class=lnlinks href=#hl-42-64> 64</a>
</span><span class=lnt id=hl-42-65><a class=lnlinks href=#hl-42-65> 65</a>
</span><span class=lnt id=hl-42-66><a class=lnlinks href=#hl-42-66> 66</a>
</span><span class=lnt id=hl-42-67><a class=lnlinks href=#hl-42-67> 67</a>
</span><span class=lnt id=hl-42-68><a class=lnlinks href=#hl-42-68> 68</a>
</span><span class=lnt id=hl-42-69><a class=lnlinks href=#hl-42-69> 69</a>
</span><span class=lnt id=hl-42-70><a class=lnlinks href=#hl-42-70> 70</a>
</span><span class=lnt id=hl-42-71><a class=lnlinks href=#hl-42-71> 71</a>
</span><span class=lnt id=hl-42-72><a class=lnlinks href=#hl-42-72> 72</a>
</span><span class=lnt id=hl-42-73><a class=lnlinks href=#hl-42-73> 73</a>
</span><span class=lnt id=hl-42-74><a class=lnlinks href=#hl-42-74> 74</a>
</span><span class=lnt id=hl-42-75><a class=lnlinks href=#hl-42-75> 75</a>
</span><span class=lnt id=hl-42-76><a class=lnlinks href=#hl-42-76> 76</a>
</span><span class=lnt id=hl-42-77><a class=lnlinks href=#hl-42-77> 77</a>
</span><span class=lnt id=hl-42-78><a class=lnlinks href=#hl-42-78> 78</a>
</span><span class=lnt id=hl-42-79><a class=lnlinks href=#hl-42-79> 79</a>
</span><span class=lnt id=hl-42-80><a class=lnlinks href=#hl-42-80> 80</a>
</span><span class=lnt id=hl-42-81><a class=lnlinks href=#hl-42-81> 81</a>
</span><span class=lnt id=hl-42-82><a class=lnlinks href=#hl-42-82> 82</a>
</span><span class=lnt id=hl-42-83><a class=lnlinks href=#hl-42-83> 83</a>
</span><span class=lnt id=hl-42-84><a class=lnlinks href=#hl-42-84> 84</a>
</span><span class=lnt id=hl-42-85><a class=lnlinks href=#hl-42-85> 85</a>
</span><span class=lnt id=hl-42-86><a class=lnlinks href=#hl-42-86> 86</a>
</span><span class=lnt id=hl-42-87><a class=lnlinks href=#hl-42-87> 87</a>
</span><span class=lnt id=hl-42-88><a class=lnlinks href=#hl-42-88> 88</a>
</span><span class=lnt id=hl-42-89><a class=lnlinks href=#hl-42-89> 89</a>
</span><span class=lnt id=hl-42-90><a class=lnlinks href=#hl-42-90> 90</a>
</span><span class=lnt id=hl-42-91><a class=lnlinks href=#hl-42-91> 91</a>
</span><span class=lnt id=hl-42-92><a class=lnlinks href=#hl-42-92> 92</a>
</span><span class=lnt id=hl-42-93><a class=lnlinks href=#hl-42-93> 93</a>
</span><span class=lnt id=hl-42-94><a class=lnlinks href=#hl-42-94> 94</a>
</span><span class=lnt id=hl-42-95><a class=lnlinks href=#hl-42-95> 95</a>
</span><span class=lnt id=hl-42-96><a class=lnlinks href=#hl-42-96> 96</a>
</span><span class=lnt id=hl-42-97><a class=lnlinks href=#hl-42-97> 97</a>
</span><span class=lnt id=hl-42-98><a class=lnlinks href=#hl-42-98> 98</a>
</span><span class=lnt id=hl-42-99><a class=lnlinks href=#hl-42-99> 99</a>
</span><span class=lnt id=hl-42-100><a class=lnlinks href=#hl-42-100>100</a>
</span><span class=lnt id=hl-42-101><a class=lnlinks href=#hl-42-101>101</a>
</span><span class=lnt id=hl-42-102><a class=lnlinks href=#hl-42-102>102</a>
</span><span class=lnt id=hl-42-103><a class=lnlinks href=#hl-42-103>103</a>
</span><span class=lnt id=hl-42-104><a class=lnlinks href=#hl-42-104>104</a>
</span><span class=lnt id=hl-42-105><a class=lnlinks href=#hl-42-105>105</a>
</span><span class=lnt id=hl-42-106><a class=lnlinks href=#hl-42-106>106</a>
</span><span class=lnt id=hl-42-107><a class=lnlinks href=#hl-42-107>107</a>
</span><span class=lnt id=hl-42-108><a class=lnlinks href=#hl-42-108>108</a>
</span><span class=lnt id=hl-42-109><a class=lnlinks href=#hl-42-109>109</a>
</span><span class=lnt id=hl-42-110><a class=lnlinks href=#hl-42-110>110</a>
</span><span class=lnt id=hl-42-111><a class=lnlinks href=#hl-42-111>111</a>
</span><span class=lnt id=hl-42-112><a class=lnlinks href=#hl-42-112>112</a>
</span><span class=lnt id=hl-42-113><a class=lnlinks href=#hl-42-113>113</a>
</span><span class=lnt id=hl-42-114><a class=lnlinks href=#hl-42-114>114</a>
</span><span class=lnt id=hl-42-115><a class=lnlinks href=#hl-42-115>115</a>
</span><span class=lnt id=hl-42-116><a class=lnlinks href=#hl-42-116>116</a>
</span><span class=lnt id=hl-42-117><a class=lnlinks href=#hl-42-117>117</a>
</span><span class=lnt id=hl-42-118><a class=lnlinks href=#hl-42-118>118</a>
</span><span class=lnt id=hl-42-119><a class=lnlinks href=#hl-42-119>119</a>
</span><span class=lnt id=hl-42-120><a class=lnlinks href=#hl-42-120>120</a>
</span><span class=lnt id=hl-42-121><a class=lnlinks href=#hl-42-121>121</a>
</span><span class=lnt id=hl-42-122><a class=lnlinks href=#hl-42-122>122</a>
</span><span class=lnt id=hl-42-123><a class=lnlinks href=#hl-42-123>123</a>
</span><span class=lnt id=hl-42-124><a class=lnlinks href=#hl-42-124>124</a>
</span><span class=lnt id=hl-42-125><a class=lnlinks href=#hl-42-125>125</a>
</span><span class=lnt id=hl-42-126><a class=lnlinks href=#hl-42-126>126</a>
</span><span class=lnt id=hl-42-127><a class=lnlinks href=#hl-42-127>127</a>
</span><span class=lnt id=hl-42-128><a class=lnlinks href=#hl-42-128>128</a>
</span><span class=lnt id=hl-42-129><a class=lnlinks href=#hl-42-129>129</a>
</span><span class=lnt id=hl-42-130><a class=lnlinks href=#hl-42-130>130</a>
</span><span class=lnt id=hl-42-131><a class=lnlinks href=#hl-42-131>131</a>
</span><span class=lnt id=hl-42-132><a class=lnlinks href=#hl-42-132>132</a>
</span><span class=lnt id=hl-42-133><a class=lnlinks href=#hl-42-133>133</a>
</span><span class=lnt id=hl-42-134><a class=lnlinks href=#hl-42-134>134</a>
</span><span class=lnt id=hl-42-135><a class=lnlinks href=#hl-42-135>135</a>
</span><span class=lnt id=hl-42-136><a class=lnlinks href=#hl-42-136>136</a>
</span><span class=lnt id=hl-42-137><a class=lnlinks href=#hl-42-137>137</a>
</span><span class=lnt id=hl-42-138><a class=lnlinks href=#hl-42-138>138</a>
</span><span class=lnt id=hl-42-139><a class=lnlinks href=#hl-42-139>139</a>
</span><span class=lnt id=hl-42-140><a class=lnlinks href=#hl-42-140>140</a>
</span><span class=lnt id=hl-42-141><a class=lnlinks href=#hl-42-141>141</a>
</span><span class=lnt id=hl-42-142><a class=lnlinks href=#hl-42-142>142</a>
</span><span class=lnt id=hl-42-143><a class=lnlinks href=#hl-42-143>143</a>
</span><span class=lnt id=hl-42-144><a class=lnlinks href=#hl-42-144>144</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// TypeScript를 사용한 CQRS 및 이벤트 소싱 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>EventBus</span><span class=p>,</span> <span class=nx>CommandBus</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;some-event-library&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령(Command) 정의
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>interface</span> <span class=nx>CreateOrderCommand</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>readonly</span> <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;CreateOrder&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>readonly</span> <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>customerId</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>items</span>: <span class=kt>Array</span><span class=o>&lt;</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>productId</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>quantity</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>price</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>shippingAddress</span>: <span class=kt>Address</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트(Event) 정의
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>interface</span> <span class=nx>OrderCreatedEvent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>readonly</span> <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>readonly</span> <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>orderId</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>customerId</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>items</span>: <span class=kt>Array</span><span class=o>&lt;</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>productId</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>quantity</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>price</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>totalAmount</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>shippingAddress</span>: <span class=kt>Address</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>createdAt</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 핸들러
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>CreateOrderHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>orderRepository</span>: <span class=kt>OrderRepository</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>eventBus</span>: <span class=kt>EventBus</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>command</span>: <span class=kt>CreateOrderCommand</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 비즈니스 로직 및 유효성 검사
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>customerId</span><span class=p>,</span> <span class=nx>items</span><span class=p>,</span> <span class=nx>shippingAddress</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>command</span><span class=p>.</span><span class=nx>payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 새 주문 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>generateId</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>      <span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>calculateTotalAmount</span><span class=p>(</span><span class=nx>items</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>shippingAddress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 주문 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>orderRepository</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>event</span>: <span class=kt>OrderCreatedEvent</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;OrderCreated&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>orderId</span>: <span class=kt>order.id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>customerId</span>: <span class=kt>order.customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>items</span>: <span class=kt>order.items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>totalAmount</span>: <span class=kt>order.totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>shippingAddress</span>: <span class=kt>order.shippingAddress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span>: <span class=kt>order.createdAt</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventBus</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>order</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 핸들러 (읽기 모델 업데이트)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderCreatedEventHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>orderReadModel</span>: <span class=kt>OrderReadModel</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>handle</span><span class=p>(</span><span class=nx>event</span>: <span class=kt>OrderCreatedEvent</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>customerId</span><span class=p>,</span> <span class=nx>items</span><span class=p>,</span> <span class=nx>totalAmount</span><span class=p>,</span> <span class=nx>shippingAddress</span><span class=p>,</span> <span class=nx>createdAt</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 읽기 모델 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>orderReadModel</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>customerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>items</span>: <span class=kt>items.map</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>productId</span>: <span class=kt>item.productId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>quantity</span>: <span class=kt>item.quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>price</span>: <span class=kt>item.price</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>subtotal</span>: <span class=kt>item.price</span> <span class=o>*</span> <span class=nx>item</span><span class=p>.</span><span class=nx>quantity</span>
</span></span><span class=line><span class=cl>      <span class=p>})),</span>
</span></span><span class=line><span class=cl>      <span class=nx>totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>shippingAddress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;created&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>createdAt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>updatedAt</span>: <span class=kt>createdAt</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// API 컨트롤러
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OrderController</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>commandBus</span>: <span class=kt>CommandBus</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>orderReadModel</span>: <span class=kt>OrderReadModel</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 명령 처리 엔드포인트
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>command</span>: <span class=kt>CreateOrderCommand</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>type</span><span class=o>:</span> <span class=s1>&#39;CreateOrder&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>payload</span>: <span class=kt>req.body</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>orderId</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>commandBus</span><span class=p>.</span><span class=nx>execute</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>201</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>orderId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span>: <span class=kt>error.message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 쿼리 엔드포인트
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>getOrder</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>orderId</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>orderReadModel</span><span class=p>.</span><span class=nx>findById</span><span class=p>(</span><span class=nx>orderId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>order</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Order not found&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span>: <span class=kt>error.message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=서킷-브레이커circuit-breaker-패턴>서킷 브레이커(Circuit Breaker) 패턴<a hidden class=anchor aria-hidden=true href=#서킷-브레이커circuit-breaker-패턴>#</a></h4><p>메시징 큐와 함께 서킷 브레이커 패턴을 사용하면 다운스트림 서비스의 장애로부터 시스템을 보호할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1> 1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2> 2</a>
</span><span class=lnt id=hl-43-3><a class=lnlinks href=#hl-43-3> 3</a>
</span><span class=lnt id=hl-43-4><a class=lnlinks href=#hl-43-4> 4</a>
</span><span class=lnt id=hl-43-5><a class=lnlinks href=#hl-43-5> 5</a>
</span><span class=lnt id=hl-43-6><a class=lnlinks href=#hl-43-6> 6</a>
</span><span class=lnt id=hl-43-7><a class=lnlinks href=#hl-43-7> 7</a>
</span><span class=lnt id=hl-43-8><a class=lnlinks href=#hl-43-8> 8</a>
</span><span class=lnt id=hl-43-9><a class=lnlinks href=#hl-43-9> 9</a>
</span><span class=lnt id=hl-43-10><a class=lnlinks href=#hl-43-10>10</a>
</span><span class=lnt id=hl-43-11><a class=lnlinks href=#hl-43-11>11</a>
</span><span class=lnt id=hl-43-12><a class=lnlinks href=#hl-43-12>12</a>
</span><span class=lnt id=hl-43-13><a class=lnlinks href=#hl-43-13>13</a>
</span><span class=lnt id=hl-43-14><a class=lnlinks href=#hl-43-14>14</a>
</span><span class=lnt id=hl-43-15><a class=lnlinks href=#hl-43-15>15</a>
</span><span class=lnt id=hl-43-16><a class=lnlinks href=#hl-43-16>16</a>
</span><span class=lnt id=hl-43-17><a class=lnlinks href=#hl-43-17>17</a>
</span><span class=lnt id=hl-43-18><a class=lnlinks href=#hl-43-18>18</a>
</span><span class=lnt id=hl-43-19><a class=lnlinks href=#hl-43-19>19</a>
</span><span class=lnt id=hl-43-20><a class=lnlinks href=#hl-43-20>20</a>
</span><span class=lnt id=hl-43-21><a class=lnlinks href=#hl-43-21>21</a>
</span><span class=lnt id=hl-43-22><a class=lnlinks href=#hl-43-22>22</a>
</span><span class=lnt id=hl-43-23><a class=lnlinks href=#hl-43-23>23</a>
</span><span class=lnt id=hl-43-24><a class=lnlinks href=#hl-43-24>24</a>
</span><span class=lnt id=hl-43-25><a class=lnlinks href=#hl-43-25>25</a>
</span><span class=lnt id=hl-43-26><a class=lnlinks href=#hl-43-26>26</a>
</span><span class=lnt id=hl-43-27><a class=lnlinks href=#hl-43-27>27</a>
</span><span class=lnt id=hl-43-28><a class=lnlinks href=#hl-43-28>28</a>
</span><span class=lnt id=hl-43-29><a class=lnlinks href=#hl-43-29>29</a>
</span><span class=lnt id=hl-43-30><a class=lnlinks href=#hl-43-30>30</a>
</span><span class=lnt id=hl-43-31><a class=lnlinks href=#hl-43-31>31</a>
</span><span class=lnt id=hl-43-32><a class=lnlinks href=#hl-43-32>32</a>
</span><span class=lnt id=hl-43-33><a class=lnlinks href=#hl-43-33>33</a>
</span><span class=lnt id=hl-43-34><a class=lnlinks href=#hl-43-34>34</a>
</span><span class=lnt id=hl-43-35><a class=lnlinks href=#hl-43-35>35</a>
</span><span class=lnt id=hl-43-36><a class=lnlinks href=#hl-43-36>36</a>
</span><span class=lnt id=hl-43-37><a class=lnlinks href=#hl-43-37>37</a>
</span><span class=lnt id=hl-43-38><a class=lnlinks href=#hl-43-38>38</a>
</span><span class=lnt id=hl-43-39><a class=lnlinks href=#hl-43-39>39</a>
</span><span class=lnt id=hl-43-40><a class=lnlinks href=#hl-43-40>40</a>
</span><span class=lnt id=hl-43-41><a class=lnlinks href=#hl-43-41>41</a>
</span><span class=lnt id=hl-43-42><a class=lnlinks href=#hl-43-42>42</a>
</span><span class=lnt id=hl-43-43><a class=lnlinks href=#hl-43-43>43</a>
</span><span class=lnt id=hl-43-44><a class=lnlinks href=#hl-43-44>44</a>
</span><span class=lnt id=hl-43-45><a class=lnlinks href=#hl-43-45>45</a>
</span><span class=lnt id=hl-43-46><a class=lnlinks href=#hl-43-46>46</a>
</span><span class=lnt id=hl-43-47><a class=lnlinks href=#hl-43-47>47</a>
</span><span class=lnt id=hl-43-48><a class=lnlinks href=#hl-43-48>48</a>
</span><span class=lnt id=hl-43-49><a class=lnlinks href=#hl-43-49>49</a>
</span><span class=lnt id=hl-43-50><a class=lnlinks href=#hl-43-50>50</a>
</span><span class=lnt id=hl-43-51><a class=lnlinks href=#hl-43-51>51</a>
</span><span class=lnt id=hl-43-52><a class=lnlinks href=#hl-43-52>52</a>
</span><span class=lnt id=hl-43-53><a class=lnlinks href=#hl-43-53>53</a>
</span><span class=lnt id=hl-43-54><a class=lnlinks href=#hl-43-54>54</a>
</span><span class=lnt id=hl-43-55><a class=lnlinks href=#hl-43-55>55</a>
</span><span class=lnt id=hl-43-56><a class=lnlinks href=#hl-43-56>56</a>
</span><span class=lnt id=hl-43-57><a class=lnlinks href=#hl-43-57>57</a>
</span><span class=lnt id=hl-43-58><a class=lnlinks href=#hl-43-58>58</a>
</span><span class=lnt id=hl-43-59><a class=lnlinks href=#hl-43-59>59</a>
</span><span class=lnt id=hl-43-60><a class=lnlinks href=#hl-43-60>60</a>
</span><span class=lnt id=hl-43-61><a class=lnlinks href=#hl-43-61>61</a>
</span><span class=lnt id=hl-43-62><a class=lnlinks href=#hl-43-62>62</a>
</span><span class=lnt id=hl-43-63><a class=lnlinks href=#hl-43-63>63</a>
</span><span class=lnt id=hl-43-64><a class=lnlinks href=#hl-43-64>64</a>
</span><span class=lnt id=hl-43-65><a class=lnlinks href=#hl-43-65>65</a>
</span><span class=lnt id=hl-43-66><a class=lnlinks href=#hl-43-66>66</a>
</span><span class=lnt id=hl-43-67><a class=lnlinks href=#hl-43-67>67</a>
</span><span class=lnt id=hl-43-68><a class=lnlinks href=#hl-43-68>68</a>
</span><span class=lnt id=hl-43-69><a class=lnlinks href=#hl-43-69>69</a>
</span><span class=lnt id=hl-43-70><a class=lnlinks href=#hl-43-70>70</a>
</span><span class=lnt id=hl-43-71><a class=lnlinks href=#hl-43-71>71</a>
</span><span class=lnt id=hl-43-72><a class=lnlinks href=#hl-43-72>72</a>
</span><span class=lnt id=hl-43-73><a class=lnlinks href=#hl-43-73>73</a>
</span><span class=lnt id=hl-43-74><a class=lnlinks href=#hl-43-74>74</a>
</span><span class=lnt id=hl-43-75><a class=lnlinks href=#hl-43-75>75</a>
</span><span class=lnt id=hl-43-76><a class=lnlinks href=#hl-43-76>76</a>
</span><span class=lnt id=hl-43-77><a class=lnlinks href=#hl-43-77>77</a>
</span><span class=lnt id=hl-43-78><a class=lnlinks href=#hl-43-78>78</a>
</span><span class=lnt id=hl-43-79><a class=lnlinks href=#hl-43-79>79</a>
</span><span class=lnt id=hl-43-80><a class=lnlinks href=#hl-43-80>80</a>
</span><span class=lnt id=hl-43-81><a class=lnlinks href=#hl-43-81>81</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java Spring Boot에서 서킷 브레이커와 메시징 큐 통합 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ResilientMessageService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreakerFactory</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ResilientMessageService</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CircuitBreakerFactory</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>rabbitTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreakerFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendMessageWithCircuitBreaker</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=s>&#34;messagingCircuitBreaker&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>run</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 정상 경로: 메시지 전송 시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 폴백 경로: 브로커 장애 시 대체 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>throwable</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>handleMessageSendFailure</span><span class=p>(</span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>throwable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleMessageSendFailure</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=n>throwable</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;메시지 전송 실패: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>throwable</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 로컬 저장소에 메시지 임시 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>saveMessageToLocalStorage</span><span class=p>(</span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 알림 발송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>notifyOperationsTeam</span><span class=p>(</span><span class=s>&#34;메시징 서비스 장애&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;메시지 전송 실패: 교환기=%s, 라우팅 키=%s, 오류=%s&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>exchange</span><span class=p>,</span><span class=w> </span><span class=n>routingKey</span><span class=p>,</span><span class=w> </span><span class=n>throwable</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>fixedDelay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>60000</span><span class=p>)</span><span class=w> </span><span class=c1>// 1분마다 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>retryFailedMessages</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>StoredMessage</span><span class=o>&gt;</span><span class=w> </span><span class=n>failedMessages</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getFailedMessagesFromLocalStorage</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>failedMessages</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;실패한 메시지 {} 개 재시도 중&#34;</span><span class=p>,</span><span class=w> </span><span class=n>failedMessages</span><span class=p>.</span><span class=na>size</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>StoredMessage</span><span class=w> </span><span class=n>storedMessage</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>failedMessages</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 서킷 브레이커 상태 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=s>&#34;messagingCircuitBreaker&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>getState</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=p>.</span><span class=na>State</span><span class=p>.</span><span class=na>CLOSED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 메시지 재전송 시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getExchange</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getRoutingKey</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 성공적으로 전송된 메시지 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>removeMessageFromLocalStorage</span><span class=p>(</span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;메시지 ID {} 재전송 성공&#34;</span><span class=p>,</span><span class=w> </span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>log</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;서킷 브레이커가 열려 있어 재시도 건너뜀 (상태: {})&#34;</span><span class=p>,</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>getState</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>break</span><span class=p>;</span><span class=w>  </span><span class=c1>// 브레이커가 열려 있으면 더 이상 시도하지 않음</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;메시지 ID {} 재전송 실패: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 재시도 횟수 및 마지막 시도 시간 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>updateRetryStatus</span><span class=p>(</span><span class=n>storedMessage</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=백-프레셔back-pressure-처리>백 프레셔(Back Pressure) 처리<a hidden class=anchor aria-hidden=true href=#백-프레셔back-pressure-처리>#</a></h4><p>시스템이 처리할 수 있는 것보다 더 많은 메시지가 유입될 때 백 프레셔 메커니즘을 통해 과부하를 방지한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1> 1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2> 2</a>
</span><span class=lnt id=hl-44-3><a class=lnlinks href=#hl-44-3> 3</a>
</span><span class=lnt id=hl-44-4><a class=lnlinks href=#hl-44-4> 4</a>
</span><span class=lnt id=hl-44-5><a class=lnlinks href=#hl-44-5> 5</a>
</span><span class=lnt id=hl-44-6><a class=lnlinks href=#hl-44-6> 6</a>
</span><span class=lnt id=hl-44-7><a class=lnlinks href=#hl-44-7> 7</a>
</span><span class=lnt id=hl-44-8><a class=lnlinks href=#hl-44-8> 8</a>
</span><span class=lnt id=hl-44-9><a class=lnlinks href=#hl-44-9> 9</a>
</span><span class=lnt id=hl-44-10><a class=lnlinks href=#hl-44-10>10</a>
</span><span class=lnt id=hl-44-11><a class=lnlinks href=#hl-44-11>11</a>
</span><span class=lnt id=hl-44-12><a class=lnlinks href=#hl-44-12>12</a>
</span><span class=lnt id=hl-44-13><a class=lnlinks href=#hl-44-13>13</a>
</span><span class=lnt id=hl-44-14><a class=lnlinks href=#hl-44-14>14</a>
</span><span class=lnt id=hl-44-15><a class=lnlinks href=#hl-44-15>15</a>
</span><span class=lnt id=hl-44-16><a class=lnlinks href=#hl-44-16>16</a>
</span><span class=lnt id=hl-44-17><a class=lnlinks href=#hl-44-17>17</a>
</span><span class=lnt id=hl-44-18><a class=lnlinks href=#hl-44-18>18</a>
</span><span class=lnt id=hl-44-19><a class=lnlinks href=#hl-44-19>19</a>
</span><span class=lnt id=hl-44-20><a class=lnlinks href=#hl-44-20>20</a>
</span><span class=lnt id=hl-44-21><a class=lnlinks href=#hl-44-21>21</a>
</span><span class=lnt id=hl-44-22><a class=lnlinks href=#hl-44-22>22</a>
</span><span class=lnt id=hl-44-23><a class=lnlinks href=#hl-44-23>23</a>
</span><span class=lnt id=hl-44-24><a class=lnlinks href=#hl-44-24>24</a>
</span><span class=lnt id=hl-44-25><a class=lnlinks href=#hl-44-25>25</a>
</span><span class=lnt id=hl-44-26><a class=lnlinks href=#hl-44-26>26</a>
</span><span class=lnt id=hl-44-27><a class=lnlinks href=#hl-44-27>27</a>
</span><span class=lnt id=hl-44-28><a class=lnlinks href=#hl-44-28>28</a>
</span><span class=lnt id=hl-44-29><a class=lnlinks href=#hl-44-29>29</a>
</span><span class=lnt id=hl-44-30><a class=lnlinks href=#hl-44-30>30</a>
</span><span class=lnt id=hl-44-31><a class=lnlinks href=#hl-44-31>31</a>
</span><span class=lnt id=hl-44-32><a class=lnlinks href=#hl-44-32>32</a>
</span><span class=lnt id=hl-44-33><a class=lnlinks href=#hl-44-33>33</a>
</span><span class=lnt id=hl-44-34><a class=lnlinks href=#hl-44-34>34</a>
</span><span class=lnt id=hl-44-35><a class=lnlinks href=#hl-44-35>35</a>
</span><span class=lnt id=hl-44-36><a class=lnlinks href=#hl-44-36>36</a>
</span><span class=lnt id=hl-44-37><a class=lnlinks href=#hl-44-37>37</a>
</span><span class=lnt id=hl-44-38><a class=lnlinks href=#hl-44-38>38</a>
</span><span class=lnt id=hl-44-39><a class=lnlinks href=#hl-44-39>39</a>
</span><span class=lnt id=hl-44-40><a class=lnlinks href=#hl-44-40>40</a>
</span><span class=lnt id=hl-44-41><a class=lnlinks href=#hl-44-41>41</a>
</span><span class=lnt id=hl-44-42><a class=lnlinks href=#hl-44-42>42</a>
</span><span class=lnt id=hl-44-43><a class=lnlinks href=#hl-44-43>43</a>
</span><span class=lnt id=hl-44-44><a class=lnlinks href=#hl-44-44>44</a>
</span><span class=lnt id=hl-44-45><a class=lnlinks href=#hl-44-45>45</a>
</span><span class=lnt id=hl-44-46><a class=lnlinks href=#hl-44-46>46</a>
</span><span class=lnt id=hl-44-47><a class=lnlinks href=#hl-44-47>47</a>
</span><span class=lnt id=hl-44-48><a class=lnlinks href=#hl-44-48>48</a>
</span><span class=lnt id=hl-44-49><a class=lnlinks href=#hl-44-49>49</a>
</span><span class=lnt id=hl-44-50><a class=lnlinks href=#hl-44-50>50</a>
</span><span class=lnt id=hl-44-51><a class=lnlinks href=#hl-44-51>51</a>
</span><span class=lnt id=hl-44-52><a class=lnlinks href=#hl-44-52>52</a>
</span><span class=lnt id=hl-44-53><a class=lnlinks href=#hl-44-53>53</a>
</span><span class=lnt id=hl-44-54><a class=lnlinks href=#hl-44-54>54</a>
</span><span class=lnt id=hl-44-55><a class=lnlinks href=#hl-44-55>55</a>
</span><span class=lnt id=hl-44-56><a class=lnlinks href=#hl-44-56>56</a>
</span><span class=lnt id=hl-44-57><a class=lnlinks href=#hl-44-57>57</a>
</span><span class=lnt id=hl-44-58><a class=lnlinks href=#hl-44-58>58</a>
</span><span class=lnt id=hl-44-59><a class=lnlinks href=#hl-44-59>59</a>
</span><span class=lnt id=hl-44-60><a class=lnlinks href=#hl-44-60>60</a>
</span><span class=lnt id=hl-44-61><a class=lnlinks href=#hl-44-61>61</a>
</span><span class=lnt id=hl-44-62><a class=lnlinks href=#hl-44-62>62</a>
</span><span class=lnt id=hl-44-63><a class=lnlinks href=#hl-44-63>63</a>
</span><span class=lnt id=hl-44-64><a class=lnlinks href=#hl-44-64>64</a>
</span><span class=lnt id=hl-44-65><a class=lnlinks href=#hl-44-65>65</a>
</span><span class=lnt id=hl-44-66><a class=lnlinks href=#hl-44-66>66</a>
</span><span class=lnt id=hl-44-67><a class=lnlinks href=#hl-44-67>67</a>
</span><span class=lnt id=hl-44-68><a class=lnlinks href=#hl-44-68>68</a>
</span><span class=lnt id=hl-44-69><a class=lnlinks href=#hl-44-69>69</a>
</span><span class=lnt id=hl-44-70><a class=lnlinks href=#hl-44-70>70</a>
</span><span class=lnt id=hl-44-71><a class=lnlinks href=#hl-44-71>71</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=c1>// Kotlin과 Reactor를 사용한 백 프레셔 구현 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>import</span> <span class=nn>org.springframework.stereotype.Service</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>org.springframework.amqp.rabbit.core.RabbitTemplate</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>org.springframework.amqp.rabbit.annotation.RabbitListener</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>reactor.core.publisher.Flux</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>reactor.core.publisher.Sinks</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>reactor.core.scheduler.Schedulers</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>java.time.Duration</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>java.util.concurrent.atomic.AtomicInteger</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Service</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BackPressureMessageProcessor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>rabbitTemplate</span><span class=p>:</span> <span class=n>RabbitTemplate</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>messageCount</span> <span class=p>=</span> <span class=n>AtomicInteger</span><span class=p>(</span><span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>processingSink</span> <span class=p>=</span> <span class=nc>Sinks</span><span class=p>.</span><span class=n>many</span><span class=p>().</span><span class=n>multicast</span><span class=p>().</span><span class=n>onBackpressureBuffer</span><span class=p>&lt;</span><span class=n>Message</span><span class=p>&gt;()</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>processingFlux</span> <span class=p>=</span> <span class=n>processingSink</span><span class=p>.</span><span class=n>asFlux</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>init</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 초당 최대 100개 메시지만 처리하도록 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>processingFlux</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>publishOn</span><span class=p>(</span><span class=nc>Schedulers</span><span class=p>.</span><span class=n>boundedElastic</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>window</span><span class=p>(</span><span class=nc>Duration</span><span class=p>.</span><span class=n>ofSeconds</span><span class=p>(</span><span class=m>1</span><span class=p>),</span> <span class=m>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>flatMap</span> <span class=p>{</span> <span class=n>window</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>window</span><span class=p>.</span><span class=n>doOnNext</span> <span class=p>{</span> <span class=n>msg</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>processMessage</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>subscribe</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 현재 처리 상태 모니터링 및 보고
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nc>Flux</span><span class=p>.</span><span class=n>interval</span><span class=p>(</span><span class=nc>Duration</span><span class=p>.</span><span class=n>ofSeconds</span><span class=p>(</span><span class=m>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>subscribe</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>val</span> <span class=py>count</span> <span class=p>=</span> <span class=n>messageCount</span><span class=p>.</span><span class=n>getAndSet</span><span class=p>(</span><span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>log</span><span class=p>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;지난 10초 동안 처리된 메시지: </span><span class=si>$count</span><span class=s2> (초당 </span><span class=si>${count / 10.0}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@RabbitListener</span><span class=p>(</span><span class=n>queues</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;high-volume-queue&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>receiveMessage</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>Message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>emitResult</span> <span class=p>=</span> <span class=n>processingSink</span><span class=p>.</span><span class=n>tryEmitNext</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>emitResult</span><span class=p>.</span><span class=n>isFailure</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 백 프레셔 적용 - 큐로 다시 보내기
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>log</span><span class=p>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&#34;처리 용량 초과, 메시지를 지연 큐로 리다이렉션&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>rabbitTemplate</span><span class=p>.</span><span class=n>convertAndSend</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;delayed.exchange&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;delayed.routing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>messagePostProcessor</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>messagePostProcessor</span><span class=p>.</span><span class=n>messageProperties</span><span class=p>.</span><span class=n>setHeader</span><span class=p>(</span><span class=s2>&#34;x-delay&#34;</span><span class=p>,</span> <span class=m>30000</span><span class=p>)</span> <span class=c1>// 30초 지연
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=n>messagePostProcessor</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>fun</span> <span class=nf>processMessage</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>Message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 실제 메시지 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>log</span><span class=p>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;메시지 처리 중: </span><span class=si>${message.id}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 처리 시간 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nc>Thread</span><span class=p>.</span><span class=n>sleep</span><span class=p>((</span><span class=m>10.</span><span class=p>).</span><span class=n>random</span><span class=p>().</span><span class=n>toLong</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>messageCount</span><span class=p>.</span><span class=n>incrementAndGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>e</span><span class=p>:</span> <span class=n>Exception</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=p>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;메시지 처리 오류: </span><span class=si>${e.message}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=분산-추적distributed-tracing>분산 추적(Distributed Tracing)<a hidden class=anchor aria-hidden=true href=#분산-추적distributed-tracing>#</a></h4><p>여러 서비스와 큐를 통과하는 메시지의 흐름을 추적하여 시스템 성능 및 오류를 모니터링한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-45-1><a class=lnlinks href=#hl-45-1>  1</a>
</span><span class=lnt id=hl-45-2><a class=lnlinks href=#hl-45-2>  2</a>
</span><span class=lnt id=hl-45-3><a class=lnlinks href=#hl-45-3>  3</a>
</span><span class=lnt id=hl-45-4><a class=lnlinks href=#hl-45-4>  4</a>
</span><span class=lnt id=hl-45-5><a class=lnlinks href=#hl-45-5>  5</a>
</span><span class=lnt id=hl-45-6><a class=lnlinks href=#hl-45-6>  6</a>
</span><span class=lnt id=hl-45-7><a class=lnlinks href=#hl-45-7>  7</a>
</span><span class=lnt id=hl-45-8><a class=lnlinks href=#hl-45-8>  8</a>
</span><span class=lnt id=hl-45-9><a class=lnlinks href=#hl-45-9>  9</a>
</span><span class=lnt id=hl-45-10><a class=lnlinks href=#hl-45-10> 10</a>
</span><span class=lnt id=hl-45-11><a class=lnlinks href=#hl-45-11> 11</a>
</span><span class=lnt id=hl-45-12><a class=lnlinks href=#hl-45-12> 12</a>
</span><span class=lnt id=hl-45-13><a class=lnlinks href=#hl-45-13> 13</a>
</span><span class=lnt id=hl-45-14><a class=lnlinks href=#hl-45-14> 14</a>
</span><span class=lnt id=hl-45-15><a class=lnlinks href=#hl-45-15> 15</a>
</span><span class=lnt id=hl-45-16><a class=lnlinks href=#hl-45-16> 16</a>
</span><span class=lnt id=hl-45-17><a class=lnlinks href=#hl-45-17> 17</a>
</span><span class=lnt id=hl-45-18><a class=lnlinks href=#hl-45-18> 18</a>
</span><span class=lnt id=hl-45-19><a class=lnlinks href=#hl-45-19> 19</a>
</span><span class=lnt id=hl-45-20><a class=lnlinks href=#hl-45-20> 20</a>
</span><span class=lnt id=hl-45-21><a class=lnlinks href=#hl-45-21> 21</a>
</span><span class=lnt id=hl-45-22><a class=lnlinks href=#hl-45-22> 22</a>
</span><span class=lnt id=hl-45-23><a class=lnlinks href=#hl-45-23> 23</a>
</span><span class=lnt id=hl-45-24><a class=lnlinks href=#hl-45-24> 24</a>
</span><span class=lnt id=hl-45-25><a class=lnlinks href=#hl-45-25> 25</a>
</span><span class=lnt id=hl-45-26><a class=lnlinks href=#hl-45-26> 26</a>
</span><span class=lnt id=hl-45-27><a class=lnlinks href=#hl-45-27> 27</a>
</span><span class=lnt id=hl-45-28><a class=lnlinks href=#hl-45-28> 28</a>
</span><span class=lnt id=hl-45-29><a class=lnlinks href=#hl-45-29> 29</a>
</span><span class=lnt id=hl-45-30><a class=lnlinks href=#hl-45-30> 30</a>
</span><span class=lnt id=hl-45-31><a class=lnlinks href=#hl-45-31> 31</a>
</span><span class=lnt id=hl-45-32><a class=lnlinks href=#hl-45-32> 32</a>
</span><span class=lnt id=hl-45-33><a class=lnlinks href=#hl-45-33> 33</a>
</span><span class=lnt id=hl-45-34><a class=lnlinks href=#hl-45-34> 34</a>
</span><span class=lnt id=hl-45-35><a class=lnlinks href=#hl-45-35> 35</a>
</span><span class=lnt id=hl-45-36><a class=lnlinks href=#hl-45-36> 36</a>
</span><span class=lnt id=hl-45-37><a class=lnlinks href=#hl-45-37> 37</a>
</span><span class=lnt id=hl-45-38><a class=lnlinks href=#hl-45-38> 38</a>
</span><span class=lnt id=hl-45-39><a class=lnlinks href=#hl-45-39> 39</a>
</span><span class=lnt id=hl-45-40><a class=lnlinks href=#hl-45-40> 40</a>
</span><span class=lnt id=hl-45-41><a class=lnlinks href=#hl-45-41> 41</a>
</span><span class=lnt id=hl-45-42><a class=lnlinks href=#hl-45-42> 42</a>
</span><span class=lnt id=hl-45-43><a class=lnlinks href=#hl-45-43> 43</a>
</span><span class=lnt id=hl-45-44><a class=lnlinks href=#hl-45-44> 44</a>
</span><span class=lnt id=hl-45-45><a class=lnlinks href=#hl-45-45> 45</a>
</span><span class=lnt id=hl-45-46><a class=lnlinks href=#hl-45-46> 46</a>
</span><span class=lnt id=hl-45-47><a class=lnlinks href=#hl-45-47> 47</a>
</span><span class=lnt id=hl-45-48><a class=lnlinks href=#hl-45-48> 48</a>
</span><span class=lnt id=hl-45-49><a class=lnlinks href=#hl-45-49> 49</a>
</span><span class=lnt id=hl-45-50><a class=lnlinks href=#hl-45-50> 50</a>
</span><span class=lnt id=hl-45-51><a class=lnlinks href=#hl-45-51> 51</a>
</span><span class=lnt id=hl-45-52><a class=lnlinks href=#hl-45-52> 52</a>
</span><span class=lnt id=hl-45-53><a class=lnlinks href=#hl-45-53> 53</a>
</span><span class=lnt id=hl-45-54><a class=lnlinks href=#hl-45-54> 54</a>
</span><span class=lnt id=hl-45-55><a class=lnlinks href=#hl-45-55> 55</a>
</span><span class=lnt id=hl-45-56><a class=lnlinks href=#hl-45-56> 56</a>
</span><span class=lnt id=hl-45-57><a class=lnlinks href=#hl-45-57> 57</a>
</span><span class=lnt id=hl-45-58><a class=lnlinks href=#hl-45-58> 58</a>
</span><span class=lnt id=hl-45-59><a class=lnlinks href=#hl-45-59> 59</a>
</span><span class=lnt id=hl-45-60><a class=lnlinks href=#hl-45-60> 60</a>
</span><span class=lnt id=hl-45-61><a class=lnlinks href=#hl-45-61> 61</a>
</span><span class=lnt id=hl-45-62><a class=lnlinks href=#hl-45-62> 62</a>
</span><span class=lnt id=hl-45-63><a class=lnlinks href=#hl-45-63> 63</a>
</span><span class=lnt id=hl-45-64><a class=lnlinks href=#hl-45-64> 64</a>
</span><span class=lnt id=hl-45-65><a class=lnlinks href=#hl-45-65> 65</a>
</span><span class=lnt id=hl-45-66><a class=lnlinks href=#hl-45-66> 66</a>
</span><span class=lnt id=hl-45-67><a class=lnlinks href=#hl-45-67> 67</a>
</span><span class=lnt id=hl-45-68><a class=lnlinks href=#hl-45-68> 68</a>
</span><span class=lnt id=hl-45-69><a class=lnlinks href=#hl-45-69> 69</a>
</span><span class=lnt id=hl-45-70><a class=lnlinks href=#hl-45-70> 70</a>
</span><span class=lnt id=hl-45-71><a class=lnlinks href=#hl-45-71> 71</a>
</span><span class=lnt id=hl-45-72><a class=lnlinks href=#hl-45-72> 72</a>
</span><span class=lnt id=hl-45-73><a class=lnlinks href=#hl-45-73> 73</a>
</span><span class=lnt id=hl-45-74><a class=lnlinks href=#hl-45-74> 74</a>
</span><span class=lnt id=hl-45-75><a class=lnlinks href=#hl-45-75> 75</a>
</span><span class=lnt id=hl-45-76><a class=lnlinks href=#hl-45-76> 76</a>
</span><span class=lnt id=hl-45-77><a class=lnlinks href=#hl-45-77> 77</a>
</span><span class=lnt id=hl-45-78><a class=lnlinks href=#hl-45-78> 78</a>
</span><span class=lnt id=hl-45-79><a class=lnlinks href=#hl-45-79> 79</a>
</span><span class=lnt id=hl-45-80><a class=lnlinks href=#hl-45-80> 80</a>
</span><span class=lnt id=hl-45-81><a class=lnlinks href=#hl-45-81> 81</a>
</span><span class=lnt id=hl-45-82><a class=lnlinks href=#hl-45-82> 82</a>
</span><span class=lnt id=hl-45-83><a class=lnlinks href=#hl-45-83> 83</a>
</span><span class=lnt id=hl-45-84><a class=lnlinks href=#hl-45-84> 84</a>
</span><span class=lnt id=hl-45-85><a class=lnlinks href=#hl-45-85> 85</a>
</span><span class=lnt id=hl-45-86><a class=lnlinks href=#hl-45-86> 86</a>
</span><span class=lnt id=hl-45-87><a class=lnlinks href=#hl-45-87> 87</a>
</span><span class=lnt id=hl-45-88><a class=lnlinks href=#hl-45-88> 88</a>
</span><span class=lnt id=hl-45-89><a class=lnlinks href=#hl-45-89> 89</a>
</span><span class=lnt id=hl-45-90><a class=lnlinks href=#hl-45-90> 90</a>
</span><span class=lnt id=hl-45-91><a class=lnlinks href=#hl-45-91> 91</a>
</span><span class=lnt id=hl-45-92><a class=lnlinks href=#hl-45-92> 92</a>
</span><span class=lnt id=hl-45-93><a class=lnlinks href=#hl-45-93> 93</a>
</span><span class=lnt id=hl-45-94><a class=lnlinks href=#hl-45-94> 94</a>
</span><span class=lnt id=hl-45-95><a class=lnlinks href=#hl-45-95> 95</a>
</span><span class=lnt id=hl-45-96><a class=lnlinks href=#hl-45-96> 96</a>
</span><span class=lnt id=hl-45-97><a class=lnlinks href=#hl-45-97> 97</a>
</span><span class=lnt id=hl-45-98><a class=lnlinks href=#hl-45-98> 98</a>
</span><span class=lnt id=hl-45-99><a class=lnlinks href=#hl-45-99> 99</a>
</span><span class=lnt id=hl-45-100><a class=lnlinks href=#hl-45-100>100</a>
</span><span class=lnt id=hl-45-101><a class=lnlinks href=#hl-45-101>101</a>
</span><span class=lnt id=hl-45-102><a class=lnlinks href=#hl-45-102>102</a>
</span><span class=lnt id=hl-45-103><a class=lnlinks href=#hl-45-103>103</a>
</span><span class=lnt id=hl-45-104><a class=lnlinks href=#hl-45-104>104</a>
</span><span class=lnt id=hl-45-105><a class=lnlinks href=#hl-45-105>105</a>
</span><span class=lnt id=hl-45-106><a class=lnlinks href=#hl-45-106>106</a>
</span><span class=lnt id=hl-45-107><a class=lnlinks href=#hl-45-107>107</a>
</span><span class=lnt id=hl-45-108><a class=lnlinks href=#hl-45-108>108</a>
</span><span class=lnt id=hl-45-109><a class=lnlinks href=#hl-45-109>109</a>
</span><span class=lnt id=hl-45-110><a class=lnlinks href=#hl-45-110>110</a>
</span><span class=lnt id=hl-45-111><a class=lnlinks href=#hl-45-111>111</a>
</span><span class=lnt id=hl-45-112><a class=lnlinks href=#hl-45-112>112</a>
</span><span class=lnt id=hl-45-113><a class=lnlinks href=#hl-45-113>113</a>
</span><span class=lnt id=hl-45-114><a class=lnlinks href=#hl-45-114>114</a>
</span><span class=lnt id=hl-45-115><a class=lnlinks href=#hl-45-115>115</a>
</span><span class=lnt id=hl-45-116><a class=lnlinks href=#hl-45-116>116</a>
</span><span class=lnt id=hl-45-117><a class=lnlinks href=#hl-45-117>117</a>
</span><span class=lnt id=hl-45-118><a class=lnlinks href=#hl-45-118>118</a>
</span><span class=lnt id=hl-45-119><a class=lnlinks href=#hl-45-119>119</a>
</span><span class=lnt id=hl-45-120><a class=lnlinks href=#hl-45-120>120</a>
</span><span class=lnt id=hl-45-121><a class=lnlinks href=#hl-45-121>121</a>
</span><span class=lnt id=hl-45-122><a class=lnlinks href=#hl-45-122>122</a>
</span><span class=lnt id=hl-45-123><a class=lnlinks href=#hl-45-123>123</a>
</span><span class=lnt id=hl-45-124><a class=lnlinks href=#hl-45-124>124</a>
</span><span class=lnt id=hl-45-125><a class=lnlinks href=#hl-45-125>125</a>
</span><span class=lnt id=hl-45-126><a class=lnlinks href=#hl-45-126>126</a>
</span><span class=lnt id=hl-45-127><a class=lnlinks href=#hl-45-127>127</a>
</span><span class=lnt id=hl-45-128><a class=lnlinks href=#hl-45-128>128</a>
</span><span class=lnt id=hl-45-129><a class=lnlinks href=#hl-45-129>129</a>
</span><span class=lnt id=hl-45-130><a class=lnlinks href=#hl-45-130>130</a>
</span><span class=lnt id=hl-45-131><a class=lnlinks href=#hl-45-131>131</a>
</span><span class=lnt id=hl-45-132><a class=lnlinks href=#hl-45-132>132</a>
</span><span class=lnt id=hl-45-133><a class=lnlinks href=#hl-45-133>133</a>
</span><span class=lnt id=hl-45-134><a class=lnlinks href=#hl-45-134>134</a>
</span><span class=lnt id=hl-45-135><a class=lnlinks href=#hl-45-135>135</a>
</span><span class=lnt id=hl-45-136><a class=lnlinks href=#hl-45-136>136</a>
</span><span class=lnt id=hl-45-137><a class=lnlinks href=#hl-45-137>137</a>
</span><span class=lnt id=hl-45-138><a class=lnlinks href=#hl-45-138>138</a>
</span><span class=lnt id=hl-45-139><a class=lnlinks href=#hl-45-139>139</a>
</span><span class=lnt id=hl-45-140><a class=lnlinks href=#hl-45-140>140</a>
</span><span class=lnt id=hl-45-141><a class=lnlinks href=#hl-45-141>141</a>
</span><span class=lnt id=hl-45-142><a class=lnlinks href=#hl-45-142>142</a>
</span><span class=lnt id=hl-45-143><a class=lnlinks href=#hl-45-143>143</a>
</span><span class=lnt id=hl-45-144><a class=lnlinks href=#hl-45-144>144</a>
</span><span class=lnt id=hl-45-145><a class=lnlinks href=#hl-45-145>145</a>
</span><span class=lnt id=hl-45-146><a class=lnlinks href=#hl-45-146>146</a>
</span><span class=lnt id=hl-45-147><a class=lnlinks href=#hl-45-147>147</a>
</span><span class=lnt id=hl-45-148><a class=lnlinks href=#hl-45-148>148</a>
</span><span class=lnt id=hl-45-149><a class=lnlinks href=#hl-45-149>149</a>
</span><span class=lnt id=hl-45-150><a class=lnlinks href=#hl-45-150>150</a>
</span><span class=lnt id=hl-45-151><a class=lnlinks href=#hl-45-151>151</a>
</span><span class=lnt id=hl-45-152><a class=lnlinks href=#hl-45-152>152</a>
</span><span class=lnt id=hl-45-153><a class=lnlinks href=#hl-45-153>153</a>
</span><span class=lnt id=hl-45-154><a class=lnlinks href=#hl-45-154>154</a>
</span><span class=lnt id=hl-45-155><a class=lnlinks href=#hl-45-155>155</a>
</span><span class=lnt id=hl-45-156><a class=lnlinks href=#hl-45-156>156</a>
</span><span class=lnt id=hl-45-157><a class=lnlinks href=#hl-45-157>157</a>
</span><span class=lnt id=hl-45-158><a class=lnlinks href=#hl-45-158>158</a>
</span><span class=lnt id=hl-45-159><a class=lnlinks href=#hl-45-159>159</a>
</span><span class=lnt id=hl-45-160><a class=lnlinks href=#hl-45-160>160</a>
</span><span class=lnt id=hl-45-161><a class=lnlinks href=#hl-45-161>161</a>
</span><span class=lnt id=hl-45-162><a class=lnlinks href=#hl-45-162>162</a>
</span><span class=lnt id=hl-45-163><a class=lnlinks href=#hl-45-163>163</a>
</span><span class=lnt id=hl-45-164><a class=lnlinks href=#hl-45-164>164</a>
</span><span class=lnt id=hl-45-165><a class=lnlinks href=#hl-45-165>165</a>
</span><span class=lnt id=hl-45-166><a class=lnlinks href=#hl-45-166>166</a>
</span><span class=lnt id=hl-45-167><a class=lnlinks href=#hl-45-167>167</a>
</span><span class=lnt id=hl-45-168><a class=lnlinks href=#hl-45-168>168</a>
</span><span class=lnt id=hl-45-169><a class=lnlinks href=#hl-45-169>169</a>
</span><span class=lnt id=hl-45-170><a class=lnlinks href=#hl-45-170>170</a>
</span><span class=lnt id=hl-45-171><a class=lnlinks href=#hl-45-171>171</a>
</span><span class=lnt id=hl-45-172><a class=lnlinks href=#hl-45-172>172</a>
</span><span class=lnt id=hl-45-173><a class=lnlinks href=#hl-45-173>173</a>
</span><span class=lnt id=hl-45-174><a class=lnlinks href=#hl-45-174>174</a>
</span><span class=lnt id=hl-45-175><a class=lnlinks href=#hl-45-175>175</a>
</span><span class=lnt id=hl-45-176><a class=lnlinks href=#hl-45-176>176</a>
</span><span class=lnt id=hl-45-177><a class=lnlinks href=#hl-45-177>177</a>
</span><span class=lnt id=hl-45-178><a class=lnlinks href=#hl-45-178>178</a>
</span><span class=lnt id=hl-45-179><a class=lnlinks href=#hl-45-179>179</a>
</span><span class=lnt id=hl-45-180><a class=lnlinks href=#hl-45-180>180</a>
</span><span class=lnt id=hl-45-181><a class=lnlinks href=#hl-45-181>181</a>
</span><span class=lnt id=hl-45-182><a class=lnlinks href=#hl-45-182>182</a>
</span><span class=lnt id=hl-45-183><a class=lnlinks href=#hl-45-183>183</a>
</span><span class=lnt id=hl-45-184><a class=lnlinks href=#hl-45-184>184</a>
</span><span class=lnt id=hl-45-185><a class=lnlinks href=#hl-45-185>185</a>
</span><span class=lnt id=hl-45-186><a class=lnlinks href=#hl-45-186>186</a>
</span><span class=lnt id=hl-45-187><a class=lnlinks href=#hl-45-187>187</a>
</span><span class=lnt id=hl-45-188><a class=lnlinks href=#hl-45-188>188</a>
</span><span class=lnt id=hl-45-189><a class=lnlinks href=#hl-45-189>189</a>
</span><span class=lnt id=hl-45-190><a class=lnlinks href=#hl-45-190>190</a>
</span><span class=lnt id=hl-45-191><a class=lnlinks href=#hl-45-191>191</a>
</span><span class=lnt id=hl-45-192><a class=lnlinks href=#hl-45-192>192</a>
</span><span class=lnt id=hl-45-193><a class=lnlinks href=#hl-45-193>193</a>
</span><span class=lnt id=hl-45-194><a class=lnlinks href=#hl-45-194>194</a>
</span><span class=lnt id=hl-45-195><a class=lnlinks href=#hl-45-195>195</a>
</span><span class=lnt id=hl-45-196><a class=lnlinks href=#hl-45-196>196</a>
</span><span class=lnt id=hl-45-197><a class=lnlinks href=#hl-45-197>197</a>
</span><span class=lnt id=hl-45-198><a class=lnlinks href=#hl-45-198>198</a>
</span><span class=lnt id=hl-45-199><a class=lnlinks href=#hl-45-199>199</a>
</span><span class=lnt id=hl-45-200><a class=lnlinks href=#hl-45-200>200</a>
</span><span class=lnt id=hl-45-201><a class=lnlinks href=#hl-45-201>201</a>
</span><span class=lnt id=hl-45-202><a class=lnlinks href=#hl-45-202>202</a>
</span><span class=lnt id=hl-45-203><a class=lnlinks href=#hl-45-203>203</a>
</span><span class=lnt id=hl-45-204><a class=lnlinks href=#hl-45-204>204</a>
</span><span class=lnt id=hl-45-205><a class=lnlinks href=#hl-45-205>205</a>
</span><span class=lnt id=hl-45-206><a class=lnlinks href=#hl-45-206>206</a>
</span><span class=lnt id=hl-45-207><a class=lnlinks href=#hl-45-207>207</a>
</span><span class=lnt id=hl-45-208><a class=lnlinks href=#hl-45-208>208</a>
</span><span class=lnt id=hl-45-209><a class=lnlinks href=#hl-45-209>209</a>
</span><span class=lnt id=hl-45-210><a class=lnlinks href=#hl-45-210>210</a>
</span><span class=lnt id=hl-45-211><a class=lnlinks href=#hl-45-211>211</a>
</span><span class=lnt id=hl-45-212><a class=lnlinks href=#hl-45-212>212</a>
</span><span class=lnt id=hl-45-213><a class=lnlinks href=#hl-45-213>213</a>
</span><span class=lnt id=hl-45-214><a class=lnlinks href=#hl-45-214>214</a>
</span><span class=lnt id=hl-45-215><a class=lnlinks href=#hl-45-215>215</a>
</span><span class=lnt id=hl-45-216><a class=lnlinks href=#hl-45-216>216</a>
</span><span class=lnt id=hl-45-217><a class=lnlinks href=#hl-45-217>217</a>
</span><span class=lnt id=hl-45-218><a class=lnlinks href=#hl-45-218>218</a>
</span><span class=lnt id=hl-45-219><a class=lnlinks href=#hl-45-219>219</a>
</span><span class=lnt id=hl-45-220><a class=lnlinks href=#hl-45-220>220</a>
</span><span class=lnt id=hl-45-221><a class=lnlinks href=#hl-45-221>221</a>
</span><span class=lnt id=hl-45-222><a class=lnlinks href=#hl-45-222>222</a>
</span><span class=lnt id=hl-45-223><a class=lnlinks href=#hl-45-223>223</a>
</span><span class=lnt id=hl-45-224><a class=lnlinks href=#hl-45-224>224</a>
</span><span class=lnt id=hl-45-225><a class=lnlinks href=#hl-45-225>225</a>
</span><span class=lnt id=hl-45-226><a class=lnlinks href=#hl-45-226>226</a>
</span><span class=lnt id=hl-45-227><a class=lnlinks href=#hl-45-227>227</a>
</span><span class=lnt id=hl-45-228><a class=lnlinks href=#hl-45-228>228</a>
</span><span class=lnt id=hl-45-229><a class=lnlinks href=#hl-45-229>229</a>
</span><span class=lnt id=hl-45-230><a class=lnlinks href=#hl-45-230>230</a>
</span><span class=lnt id=hl-45-231><a class=lnlinks href=#hl-45-231>231</a>
</span><span class=lnt id=hl-45-232><a class=lnlinks href=#hl-45-232>232</a>
</span><span class=lnt id=hl-45-233><a class=lnlinks href=#hl-45-233>233</a>
</span><span class=lnt id=hl-45-234><a class=lnlinks href=#hl-45-234>234</a>
</span><span class=lnt id=hl-45-235><a class=lnlinks href=#hl-45-235>235</a>
</span><span class=lnt id=hl-45-236><a class=lnlinks href=#hl-45-236>236</a>
</span><span class=lnt id=hl-45-237><a class=lnlinks href=#hl-45-237>237</a>
</span><span class=lnt id=hl-45-238><a class=lnlinks href=#hl-45-238>238</a>
</span><span class=lnt id=hl-45-239><a class=lnlinks href=#hl-45-239>239</a>
</span><span class=lnt id=hl-45-240><a class=lnlinks href=#hl-45-240>240</a>
</span><span class=lnt id=hl-45-241><a class=lnlinks href=#hl-45-241>241</a>
</span><span class=lnt id=hl-45-242><a class=lnlinks href=#hl-45-242>242</a>
</span><span class=lnt id=hl-45-243><a class=lnlinks href=#hl-45-243>243</a>
</span><span class=lnt id=hl-45-244><a class=lnlinks href=#hl-45-244>244</a>
</span><span class=lnt id=hl-45-245><a class=lnlinks href=#hl-45-245>245</a>
</span><span class=lnt id=hl-45-246><a class=lnlinks href=#hl-45-246>246</a>
</span><span class=lnt id=hl-45-247><a class=lnlinks href=#hl-45-247>247</a>
</span><span class=lnt id=hl-45-248><a class=lnlinks href=#hl-45-248>248</a>
</span><span class=lnt id=hl-45-249><a class=lnlinks href=#hl-45-249>249</a>
</span><span class=lnt id=hl-45-250><a class=lnlinks href=#hl-45-250>250</a>
</span><span class=lnt id=hl-45-251><a class=lnlinks href=#hl-45-251>251</a>
</span><span class=lnt id=hl-45-252><a class=lnlinks href=#hl-45-252>252</a>
</span><span class=lnt id=hl-45-253><a class=lnlinks href=#hl-45-253>253</a>
</span><span class=lnt id=hl-45-254><a class=lnlinks href=#hl-45-254>254</a>
</span><span class=lnt id=hl-45-255><a class=lnlinks href=#hl-45-255>255</a>
</span><span class=lnt id=hl-45-256><a class=lnlinks href=#hl-45-256>256</a>
</span><span class=lnt id=hl-45-257><a class=lnlinks href=#hl-45-257>257</a>
</span><span class=lnt id=hl-45-258><a class=lnlinks href=#hl-45-258>258</a>
</span><span class=lnt id=hl-45-259><a class=lnlinks href=#hl-45-259>259</a>
</span><span class=lnt id=hl-45-260><a class=lnlinks href=#hl-45-260>260</a>
</span><span class=lnt id=hl-45-261><a class=lnlinks href=#hl-45-261>261</a>
</span><span class=lnt id=hl-45-262><a class=lnlinks href=#hl-45-262>262</a>
</span><span class=lnt id=hl-45-263><a class=lnlinks href=#hl-45-263>263</a>
</span><span class=lnt id=hl-45-264><a class=lnlinks href=#hl-45-264>264</a>
</span><span class=lnt id=hl-45-265><a class=lnlinks href=#hl-45-265>265</a>
</span><span class=lnt id=hl-45-266><a class=lnlinks href=#hl-45-266>266</a>
</span><span class=lnt id=hl-45-267><a class=lnlinks href=#hl-45-267>267</a>
</span><span class=lnt id=hl-45-268><a class=lnlinks href=#hl-45-268>268</a>
</span><span class=lnt id=hl-45-269><a class=lnlinks href=#hl-45-269>269</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python FastAPI와 OpenTelemetry를 사용한 분산 추적 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>Depends</span><span class=p>,</span> <span class=n>Header</span><span class=p>,</span> <span class=n>Request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aio_pika</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry</span> <span class=kn>import</span> <span class=n>trace</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.exporter.jaeger.thrift</span> <span class=kn>import</span> <span class=n>JaegerExporter</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.sdk.resources</span> <span class=kn>import</span> <span class=n>SERVICE_NAME</span><span class=p>,</span> <span class=n>Resource</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.sdk.trace</span> <span class=kn>import</span> <span class=n>TracerProvider</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.sdk.trace.export</span> <span class=kn>import</span> <span class=n>BatchSpanProcessor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.instrumentation.fastapi</span> <span class=kn>import</span> <span class=n>FastAPIInstrumentor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.instrumentation.aio_pika</span> <span class=kn>import</span> <span class=n>AioPikaInstrumentor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.context</span> <span class=kn>import</span> <span class=n>Context</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry.propagate</span> <span class=kn>import</span> <span class=n>extract</span><span class=p>,</span> <span class=n>inject</span><span class=p>,</span> <span class=n>get_global_TextMapPropagator</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 로깅 설정</span>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># OpenTelemetry 설정</span>
</span></span><span class=line><span class=cl><span class=n>resource</span> <span class=o>=</span> <span class=n>Resource</span><span class=p>(</span><span class=n>attributes</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>SERVICE_NAME</span><span class=p>:</span> <span class=s2>&#34;order-service&#34;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>jaeger_exporter</span> <span class=o>=</span> <span class=n>JaegerExporter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>agent_host_name</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>agent_port</span><span class=o>=</span><span class=mi>6831</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>trace</span><span class=o>.</span><span class=n>set_tracer_provider</span><span class=p>(</span><span class=n>TracerProvider</span><span class=p>(</span><span class=n>resource</span><span class=o>=</span><span class=n>resource</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>trace</span><span class=o>.</span><span class=n>get_tracer_provider</span><span class=p>()</span><span class=o>.</span><span class=n>add_span_processor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>BatchSpanProcessor</span><span class=p>(</span><span class=n>jaeger_exporter</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tracer</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_tracer</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># FastAPI 앱 생성</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>(</span><span class=n>title</span><span class=o>=</span><span class=s2>&#34;주문 서비스&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># FastAPI 계측</span>
</span></span><span class=line><span class=cl><span class=n>FastAPIInstrumentor</span><span class=o>.</span><span class=n>instrument_app</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AioPika 계측</span>
</span></span><span class=line><span class=cl><span class=n>AioPikaInstrumentor</span><span class=p>()</span><span class=o>.</span><span class=n>instrument</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RabbitMQ 연결 설정</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_rabbitmq_connection</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>await</span> <span class=n>aio_pika</span><span class=o>.</span><span class=n>connect_robust</span><span class=p>(</span><span class=s2>&#34;amqp://guest:guest@localhost/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 추적 컨텍스트 추출 함수</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract_tracing_context</span><span class=p>(</span><span class=n>headers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Context</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>extract</span><span class=p>(</span><span class=n>get_global_TextMapPropagator</span><span class=p>(),</span> <span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 발행 함수</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>publish_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>exchange_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>routing_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>parent_span</span><span class=p>:</span> <span class=n>trace</span><span class=o>.</span><span class=n>Span</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=k>await</span> <span class=n>get_rabbitmq_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>exchange</span> <span class=o>=</span> <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>declare_exchange</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange_name</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>aio_pika</span><span class=o>.</span><span class=n>ExchangeType</span><span class=o>.</span><span class=n>TOPIC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추적 컨텍스트를 메시지 헤더에 주입</span>
</span></span><span class=line><span class=cl>        <span class=n>message_headers</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>inject</span><span class=p>(</span><span class=n>get_global_TextMapPropagator</span><span class=p>(),</span> <span class=n>message_headers</span><span class=p>,</span> <span class=n>parent_span</span><span class=o>.</span><span class=n>get_span_context</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 추적 ID와 메시지 ID 추가</span>
</span></span><span class=line><span class=cl>        <span class=n>message_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>message_with_context</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message_id&#34;</span><span class=p>:</span> <span class=n>message_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;trace_id&#34;</span><span class=p>:</span> <span class=nb>format</span><span class=p>(</span><span class=n>parent_span</span><span class=o>.</span><span class=n>get_span_context</span><span class=p>()</span><span class=o>.</span><span class=n>trace_id</span><span class=p>,</span> <span class=s2>&#34;032x&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;span_id&#34;</span><span class=p>:</span> <span class=nb>format</span><span class=p>(</span><span class=n>parent_span</span><span class=o>.</span><span class=n>get_span_context</span><span class=p>()</span><span class=o>.</span><span class=n>span_id</span><span class=p>,</span> <span class=s2>&#34;016x&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;publish-</span><span class=si>{</span><span class=n>routing_key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>context</span><span class=o>=</span><span class=n>trace</span><span class=o>.</span><span class=n>set_span_in_context</span><span class=p>(</span><span class=n>parent_span</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>kind</span><span class=o>=</span><span class=n>trace</span><span class=o>.</span><span class=n>SpanKind</span><span class=o>.</span><span class=n>PRODUCER</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span> <span class=k>as</span> <span class=n>publish_span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>publish_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.system&#34;</span><span class=p>,</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>publish_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.destination&#34;</span><span class=p>,</span> <span class=n>exchange_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>publish_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.destination_kind&#34;</span><span class=p>,</span> <span class=s2>&#34;exchange&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>publish_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.rabbitmq.routing_key&#34;</span><span class=p>,</span> <span class=n>routing_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>publish_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.message_id&#34;</span><span class=p>,</span> <span class=n>message_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 발행</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>exchange</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>aio_pika</span><span class=o>.</span><span class=n>Message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message_with_context</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                    <span class=n>content_type</span><span class=o>=</span><span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>headers</span><span class=o>=</span><span class=n>message_headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>message_id</span><span class=o>=</span><span class=n>message_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>delivery_mode</span><span class=o>=</span><span class=n>aio_pika</span><span class=o>.</span><span class=n>DeliveryMode</span><span class=o>.</span><span class=n>PERSISTENT</span>
</span></span><span class=line><span class=cl>                <span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>routing_key</span><span class=o>=</span><span class=n>routing_key</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 발행됨: </span><span class=si>{</span><span class=n>routing_key</span><span class=si>}</span><span class=s2>, ID: </span><span class=si>{</span><span class=n>message_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>message_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 생성 API 엔드포인트</span>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/api/orders&#34;</span><span class=p>,</span> <span class=n>status_code</span><span class=o>=</span><span class=mi>202</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>trace_parent</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Header</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 현재 트레이스 컨텍스트 가져오기</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_current_span</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 ID 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>order_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>order</span><span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 생성 처리</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;process-order&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>=</span><span class=n>trace</span><span class=o>.</span><span class=n>set_span_in_context</span><span class=p>(</span><span class=n>current_span</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=k>as</span> <span class=n>process_span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>process_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.id&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>process_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.customer_id&#34;</span><span class=p>,</span> <span class=n>order</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;customer_id&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>process_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.item_count&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>order</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;items&#34;</span><span class=p>,</span> <span class=p>[])))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 상태 저장 로직 (실제로는 DB에 저장)</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2> 생성 중&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 비동기 처리를 위한 메시지 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>message_id</span> <span class=o>=</span> <span class=k>await</span> <span class=n>publish_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;orders.created&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>order</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>process_span</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;processing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;주문이 처리 중입니다&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;trace_id&#34;</span><span class=p>:</span> <span class=nb>format</span><span class=p>(</span><span class=n>current_span</span><span class=o>.</span><span class=n>get_span_context</span><span class=p>()</span><span class=o>.</span><span class=n>trace_id</span><span class=p>,</span> <span class=s2>&#34;032x&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 소비자 설정</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>setup_consumer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=k>await</span> <span class=n>get_rabbitmq_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 채널 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>channel</span> <span class=o>=</span> <span class=k>await</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>set_qos</span><span class=p>(</span><span class=n>prefetch_count</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 교환기 및 큐 선언</span>
</span></span><span class=line><span class=cl>    <span class=n>orders_exchange</span> <span class=o>=</span> <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>declare_exchange</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;orders&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>aio_pika</span><span class=o>.</span><span class=n>ExchangeType</span><span class=o>.</span><span class=n>TOPIC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>order_processing_queue</span> <span class=o>=</span> <span class=k>await</span> <span class=n>channel</span><span class=o>.</span><span class=n>declare_queue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;order_processing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>durable</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>order_processing_queue</span><span class=o>.</span><span class=n>bind</span><span class=p>(</span><span class=n>orders_exchange</span><span class=p>,</span> <span class=s2>&#34;orders.created&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 메시지 처리 콜백</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>process_order_message</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>aio_pika</span><span class=o>.</span><span class=n>IncomingMessage</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=n>message</span><span class=o>.</span><span class=n>process</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=c1># 트레이싱 컨텍스트 추출</span>
</span></span><span class=line><span class=cl>            <span class=n>trace_context</span> <span class=o>=</span> <span class=n>extract_tracing_context</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>headers</span><span class=p>)</span> <span class=k>if</span> <span class=n>message</span><span class=o>.</span><span class=n>headers</span> <span class=k>else</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 내용 파싱</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>body</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>order_data</span> <span class=o>=</span> <span class=n>body</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>            <span class=n>message_id</span> <span class=o>=</span> <span class=n>body</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;message_id&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>trace_id</span> <span class=o>=</span> <span class=n>body</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;trace_id&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 메시지 수신: </span><span class=si>{</span><span class=n>message_id</span><span class=si>}</span><span class=s2>, 트레이스 ID: </span><span class=si>{</span><span class=n>trace_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 처리 스팬 생성</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;consume-order&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>context</span><span class=o>=</span><span class=n>trace_context</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>kind</span><span class=o>=</span><span class=n>trace</span><span class=o>.</span><span class=n>SpanKind</span><span class=o>.</span><span class=n>CONSUMER</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span> <span class=k>as</span> <span class=n>consume_span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>consume_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.system&#34;</span><span class=p>,</span> <span class=s2>&#34;rabbitmq&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>consume_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.operation&#34;</span><span class=p>,</span> <span class=s2>&#34;process&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>consume_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.message_id&#34;</span><span class=p>,</span> <span class=n>message_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>consume_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;messaging.rabbitmq.routing_key&#34;</span><span class=p>,</span> <span class=n>message</span><span class=o>.</span><span class=n>routing_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>consume_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.id&#34;</span><span class=p>,</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 주문 처리 로직</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 </span><span class=si>{</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> 처리 중&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 처리 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 재고 확인 스팬</span>
</span></span><span class=line><span class=cl>                    <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span><span class=s2>&#34;check-inventory&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>inventory_span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>inventory_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.item_count&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;items&#34;</span><span class=p>,</span> <span class=p>[])))</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.3</span><span class=p>)</span>  <span class=c1># 재고 확인 시뮬레이션</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 결제 처리 스팬</span>
</span></span><span class=line><span class=cl>                    <span class=k>with</span> <span class=n>tracer</span><span class=o>.</span><span class=n>start_as_current_span</span><span class=p>(</span><span class=s2>&#34;process-payment&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>payment_span</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>payment_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;order.total&#34;</span><span class=p>,</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;total_amount&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.4</span><span class=p>)</span>  <span class=c1># 결제 처리 시뮬레이션</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 주문 완료 이벤트 발행</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>publish_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;orders.processed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;completed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;processed_at&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                        <span class=p>},</span>
</span></span><span class=line><span class=cl>                        <span class=n>consume_span</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 </span><span class=si>{</span><span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2> 처리 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>error_msg</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;주문 처리 오류: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=n>error_msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>consume_span</span><span class=o>.</span><span class=n>record_exception</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>consume_span</span><span class=o>.</span><span class=n>set_status</span><span class=p>(</span><span class=n>trace</span><span class=o>.</span><span class=n>StatusCode</span><span class=o>.</span><span class=n>ERROR</span><span class=p>,</span> <span class=n>error_msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 주문 실패 이벤트 발행</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>publish_message</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;orders.failed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;failed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;failed_at&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                        <span class=p>},</span>
</span></span><span class=line><span class=cl>                        <span class=n>consume_span</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 소비자 시작</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>order_processing_queue</span><span class=o>.</span><span class=n>consume</span><span class=p>(</span><span class=n>process_order_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;주문 처리 소비자가 시작되었습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 애플리케이션 시작 이벤트에 소비자 설정 추가</span>
</span></span><span class=line><span class=cl><span class=nd>@app.on_event</span><span class=p>(</span><span class=s2>&#34;startup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>startup_event</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 백그라운드 작업으로 소비자 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span><span class=n>setup_consumer</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;애플리케이션이 시작되었습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 애플리케이션 종료 이벤트</span>
</span></span><span class=line><span class=cl><span class=nd>@app.on_event</span><span class=p>(</span><span class=s2>&#34;shutdown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>shutdown_event</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;애플리케이션이 종료됩니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>uvicorn</span>
</span></span><span class=line><span class=cl>    <span class=n>uvicorn</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>app</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>8000</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐-아키텍처-패턴>메시징 큐 아키텍처 패턴<a hidden class=anchor aria-hidden=true href=#메시징-큐-아키텍처-패턴>#</a></h3><h4 id=데이터-스트리밍-아키텍처>데이터 스트리밍 아키텍처<a hidden class=anchor aria-hidden=true href=#데이터-스트리밍-아키텍처>#</a></h4><p>메시징 큐를 사용하여 대량의 데이터를 연속적으로 처리하고 실시간 분석을 지원하는 아키텍처이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-46-1><a class=lnlinks href=#hl-46-1>  1</a>
</span><span class=lnt id=hl-46-2><a class=lnlinks href=#hl-46-2>  2</a>
</span><span class=lnt id=hl-46-3><a class=lnlinks href=#hl-46-3>  3</a>
</span><span class=lnt id=hl-46-4><a class=lnlinks href=#hl-46-4>  4</a>
</span><span class=lnt id=hl-46-5><a class=lnlinks href=#hl-46-5>  5</a>
</span><span class=lnt id=hl-46-6><a class=lnlinks href=#hl-46-6>  6</a>
</span><span class=lnt id=hl-46-7><a class=lnlinks href=#hl-46-7>  7</a>
</span><span class=lnt id=hl-46-8><a class=lnlinks href=#hl-46-8>  8</a>
</span><span class=lnt id=hl-46-9><a class=lnlinks href=#hl-46-9>  9</a>
</span><span class=lnt id=hl-46-10><a class=lnlinks href=#hl-46-10> 10</a>
</span><span class=lnt id=hl-46-11><a class=lnlinks href=#hl-46-11> 11</a>
</span><span class=lnt id=hl-46-12><a class=lnlinks href=#hl-46-12> 12</a>
</span><span class=lnt id=hl-46-13><a class=lnlinks href=#hl-46-13> 13</a>
</span><span class=lnt id=hl-46-14><a class=lnlinks href=#hl-46-14> 14</a>
</span><span class=lnt id=hl-46-15><a class=lnlinks href=#hl-46-15> 15</a>
</span><span class=lnt id=hl-46-16><a class=lnlinks href=#hl-46-16> 16</a>
</span><span class=lnt id=hl-46-17><a class=lnlinks href=#hl-46-17> 17</a>
</span><span class=lnt id=hl-46-18><a class=lnlinks href=#hl-46-18> 18</a>
</span><span class=lnt id=hl-46-19><a class=lnlinks href=#hl-46-19> 19</a>
</span><span class=lnt id=hl-46-20><a class=lnlinks href=#hl-46-20> 20</a>
</span><span class=lnt id=hl-46-21><a class=lnlinks href=#hl-46-21> 21</a>
</span><span class=lnt id=hl-46-22><a class=lnlinks href=#hl-46-22> 22</a>
</span><span class=lnt id=hl-46-23><a class=lnlinks href=#hl-46-23> 23</a>
</span><span class=lnt id=hl-46-24><a class=lnlinks href=#hl-46-24> 24</a>
</span><span class=lnt id=hl-46-25><a class=lnlinks href=#hl-46-25> 25</a>
</span><span class=lnt id=hl-46-26><a class=lnlinks href=#hl-46-26> 26</a>
</span><span class=lnt id=hl-46-27><a class=lnlinks href=#hl-46-27> 27</a>
</span><span class=lnt id=hl-46-28><a class=lnlinks href=#hl-46-28> 28</a>
</span><span class=lnt id=hl-46-29><a class=lnlinks href=#hl-46-29> 29</a>
</span><span class=lnt id=hl-46-30><a class=lnlinks href=#hl-46-30> 30</a>
</span><span class=lnt id=hl-46-31><a class=lnlinks href=#hl-46-31> 31</a>
</span><span class=lnt id=hl-46-32><a class=lnlinks href=#hl-46-32> 32</a>
</span><span class=lnt id=hl-46-33><a class=lnlinks href=#hl-46-33> 33</a>
</span><span class=lnt id=hl-46-34><a class=lnlinks href=#hl-46-34> 34</a>
</span><span class=lnt id=hl-46-35><a class=lnlinks href=#hl-46-35> 35</a>
</span><span class=lnt id=hl-46-36><a class=lnlinks href=#hl-46-36> 36</a>
</span><span class=lnt id=hl-46-37><a class=lnlinks href=#hl-46-37> 37</a>
</span><span class=lnt id=hl-46-38><a class=lnlinks href=#hl-46-38> 38</a>
</span><span class=lnt id=hl-46-39><a class=lnlinks href=#hl-46-39> 39</a>
</span><span class=lnt id=hl-46-40><a class=lnlinks href=#hl-46-40> 40</a>
</span><span class=lnt id=hl-46-41><a class=lnlinks href=#hl-46-41> 41</a>
</span><span class=lnt id=hl-46-42><a class=lnlinks href=#hl-46-42> 42</a>
</span><span class=lnt id=hl-46-43><a class=lnlinks href=#hl-46-43> 43</a>
</span><span class=lnt id=hl-46-44><a class=lnlinks href=#hl-46-44> 44</a>
</span><span class=lnt id=hl-46-45><a class=lnlinks href=#hl-46-45> 45</a>
</span><span class=lnt id=hl-46-46><a class=lnlinks href=#hl-46-46> 46</a>
</span><span class=lnt id=hl-46-47><a class=lnlinks href=#hl-46-47> 47</a>
</span><span class=lnt id=hl-46-48><a class=lnlinks href=#hl-46-48> 48</a>
</span><span class=lnt id=hl-46-49><a class=lnlinks href=#hl-46-49> 49</a>
</span><span class=lnt id=hl-46-50><a class=lnlinks href=#hl-46-50> 50</a>
</span><span class=lnt id=hl-46-51><a class=lnlinks href=#hl-46-51> 51</a>
</span><span class=lnt id=hl-46-52><a class=lnlinks href=#hl-46-52> 52</a>
</span><span class=lnt id=hl-46-53><a class=lnlinks href=#hl-46-53> 53</a>
</span><span class=lnt id=hl-46-54><a class=lnlinks href=#hl-46-54> 54</a>
</span><span class=lnt id=hl-46-55><a class=lnlinks href=#hl-46-55> 55</a>
</span><span class=lnt id=hl-46-56><a class=lnlinks href=#hl-46-56> 56</a>
</span><span class=lnt id=hl-46-57><a class=lnlinks href=#hl-46-57> 57</a>
</span><span class=lnt id=hl-46-58><a class=lnlinks href=#hl-46-58> 58</a>
</span><span class=lnt id=hl-46-59><a class=lnlinks href=#hl-46-59> 59</a>
</span><span class=lnt id=hl-46-60><a class=lnlinks href=#hl-46-60> 60</a>
</span><span class=lnt id=hl-46-61><a class=lnlinks href=#hl-46-61> 61</a>
</span><span class=lnt id=hl-46-62><a class=lnlinks href=#hl-46-62> 62</a>
</span><span class=lnt id=hl-46-63><a class=lnlinks href=#hl-46-63> 63</a>
</span><span class=lnt id=hl-46-64><a class=lnlinks href=#hl-46-64> 64</a>
</span><span class=lnt id=hl-46-65><a class=lnlinks href=#hl-46-65> 65</a>
</span><span class=lnt id=hl-46-66><a class=lnlinks href=#hl-46-66> 66</a>
</span><span class=lnt id=hl-46-67><a class=lnlinks href=#hl-46-67> 67</a>
</span><span class=lnt id=hl-46-68><a class=lnlinks href=#hl-46-68> 68</a>
</span><span class=lnt id=hl-46-69><a class=lnlinks href=#hl-46-69> 69</a>
</span><span class=lnt id=hl-46-70><a class=lnlinks href=#hl-46-70> 70</a>
</span><span class=lnt id=hl-46-71><a class=lnlinks href=#hl-46-71> 71</a>
</span><span class=lnt id=hl-46-72><a class=lnlinks href=#hl-46-72> 72</a>
</span><span class=lnt id=hl-46-73><a class=lnlinks href=#hl-46-73> 73</a>
</span><span class=lnt id=hl-46-74><a class=lnlinks href=#hl-46-74> 74</a>
</span><span class=lnt id=hl-46-75><a class=lnlinks href=#hl-46-75> 75</a>
</span><span class=lnt id=hl-46-76><a class=lnlinks href=#hl-46-76> 76</a>
</span><span class=lnt id=hl-46-77><a class=lnlinks href=#hl-46-77> 77</a>
</span><span class=lnt id=hl-46-78><a class=lnlinks href=#hl-46-78> 78</a>
</span><span class=lnt id=hl-46-79><a class=lnlinks href=#hl-46-79> 79</a>
</span><span class=lnt id=hl-46-80><a class=lnlinks href=#hl-46-80> 80</a>
</span><span class=lnt id=hl-46-81><a class=lnlinks href=#hl-46-81> 81</a>
</span><span class=lnt id=hl-46-82><a class=lnlinks href=#hl-46-82> 82</a>
</span><span class=lnt id=hl-46-83><a class=lnlinks href=#hl-46-83> 83</a>
</span><span class=lnt id=hl-46-84><a class=lnlinks href=#hl-46-84> 84</a>
</span><span class=lnt id=hl-46-85><a class=lnlinks href=#hl-46-85> 85</a>
</span><span class=lnt id=hl-46-86><a class=lnlinks href=#hl-46-86> 86</a>
</span><span class=lnt id=hl-46-87><a class=lnlinks href=#hl-46-87> 87</a>
</span><span class=lnt id=hl-46-88><a class=lnlinks href=#hl-46-88> 88</a>
</span><span class=lnt id=hl-46-89><a class=lnlinks href=#hl-46-89> 89</a>
</span><span class=lnt id=hl-46-90><a class=lnlinks href=#hl-46-90> 90</a>
</span><span class=lnt id=hl-46-91><a class=lnlinks href=#hl-46-91> 91</a>
</span><span class=lnt id=hl-46-92><a class=lnlinks href=#hl-46-92> 92</a>
</span><span class=lnt id=hl-46-93><a class=lnlinks href=#hl-46-93> 93</a>
</span><span class=lnt id=hl-46-94><a class=lnlinks href=#hl-46-94> 94</a>
</span><span class=lnt id=hl-46-95><a class=lnlinks href=#hl-46-95> 95</a>
</span><span class=lnt id=hl-46-96><a class=lnlinks href=#hl-46-96> 96</a>
</span><span class=lnt id=hl-46-97><a class=lnlinks href=#hl-46-97> 97</a>
</span><span class=lnt id=hl-46-98><a class=lnlinks href=#hl-46-98> 98</a>
</span><span class=lnt id=hl-46-99><a class=lnlinks href=#hl-46-99> 99</a>
</span><span class=lnt id=hl-46-100><a class=lnlinks href=#hl-46-100>100</a>
</span><span class=lnt id=hl-46-101><a class=lnlinks href=#hl-46-101>101</a>
</span><span class=lnt id=hl-46-102><a class=lnlinks href=#hl-46-102>102</a>
</span><span class=lnt id=hl-46-103><a class=lnlinks href=#hl-46-103>103</a>
</span><span class=lnt id=hl-46-104><a class=lnlinks href=#hl-46-104>104</a>
</span><span class=lnt id=hl-46-105><a class=lnlinks href=#hl-46-105>105</a>
</span><span class=lnt id=hl-46-106><a class=lnlinks href=#hl-46-106>106</a>
</span><span class=lnt id=hl-46-107><a class=lnlinks href=#hl-46-107>107</a>
</span><span class=lnt id=hl-46-108><a class=lnlinks href=#hl-46-108>108</a>
</span><span class=lnt id=hl-46-109><a class=lnlinks href=#hl-46-109>109</a>
</span><span class=lnt id=hl-46-110><a class=lnlinks href=#hl-46-110>110</a>
</span><span class=lnt id=hl-46-111><a class=lnlinks href=#hl-46-111>111</a>
</span><span class=lnt id=hl-46-112><a class=lnlinks href=#hl-46-112>112</a>
</span><span class=lnt id=hl-46-113><a class=lnlinks href=#hl-46-113>113</a>
</span><span class=lnt id=hl-46-114><a class=lnlinks href=#hl-46-114>114</a>
</span><span class=lnt id=hl-46-115><a class=lnlinks href=#hl-46-115>115</a>
</span><span class=lnt id=hl-46-116><a class=lnlinks href=#hl-46-116>116</a>
</span><span class=lnt id=hl-46-117><a class=lnlinks href=#hl-46-117>117</a>
</span><span class=lnt id=hl-46-118><a class=lnlinks href=#hl-46-118>118</a>
</span><span class=lnt id=hl-46-119><a class=lnlinks href=#hl-46-119>119</a>
</span><span class=lnt id=hl-46-120><a class=lnlinks href=#hl-46-120>120</a>
</span><span class=lnt id=hl-46-121><a class=lnlinks href=#hl-46-121>121</a>
</span><span class=lnt id=hl-46-122><a class=lnlinks href=#hl-46-122>122</a>
</span><span class=lnt id=hl-46-123><a class=lnlinks href=#hl-46-123>123</a>
</span><span class=lnt id=hl-46-124><a class=lnlinks href=#hl-46-124>124</a>
</span><span class=lnt id=hl-46-125><a class=lnlinks href=#hl-46-125>125</a>
</span><span class=lnt id=hl-46-126><a class=lnlinks href=#hl-46-126>126</a>
</span><span class=lnt id=hl-46-127><a class=lnlinks href=#hl-46-127>127</a>
</span><span class=lnt id=hl-46-128><a class=lnlinks href=#hl-46-128>128</a>
</span><span class=lnt id=hl-46-129><a class=lnlinks href=#hl-46-129>129</a>
</span><span class=lnt id=hl-46-130><a class=lnlinks href=#hl-46-130>130</a>
</span><span class=lnt id=hl-46-131><a class=lnlinks href=#hl-46-131>131</a>
</span><span class=lnt id=hl-46-132><a class=lnlinks href=#hl-46-132>132</a>
</span><span class=lnt id=hl-46-133><a class=lnlinks href=#hl-46-133>133</a>
</span><span class=lnt id=hl-46-134><a class=lnlinks href=#hl-46-134>134</a>
</span><span class=lnt id=hl-46-135><a class=lnlinks href=#hl-46-135>135</a>
</span><span class=lnt id=hl-46-136><a class=lnlinks href=#hl-46-136>136</a>
</span><span class=lnt id=hl-46-137><a class=lnlinks href=#hl-46-137>137</a>
</span><span class=lnt id=hl-46-138><a class=lnlinks href=#hl-46-138>138</a>
</span><span class=lnt id=hl-46-139><a class=lnlinks href=#hl-46-139>139</a>
</span><span class=lnt id=hl-46-140><a class=lnlinks href=#hl-46-140>140</a>
</span><span class=lnt id=hl-46-141><a class=lnlinks href=#hl-46-141>141</a>
</span><span class=lnt id=hl-46-142><a class=lnlinks href=#hl-46-142>142</a>
</span><span class=lnt id=hl-46-143><a class=lnlinks href=#hl-46-143>143</a>
</span><span class=lnt id=hl-46-144><a class=lnlinks href=#hl-46-144>144</a>
</span><span class=lnt id=hl-46-145><a class=lnlinks href=#hl-46-145>145</a>
</span><span class=lnt id=hl-46-146><a class=lnlinks href=#hl-46-146>146</a>
</span><span class=lnt id=hl-46-147><a class=lnlinks href=#hl-46-147>147</a>
</span><span class=lnt id=hl-46-148><a class=lnlinks href=#hl-46-148>148</a>
</span><span class=lnt id=hl-46-149><a class=lnlinks href=#hl-46-149>149</a>
</span><span class=lnt id=hl-46-150><a class=lnlinks href=#hl-46-150>150</a>
</span><span class=lnt id=hl-46-151><a class=lnlinks href=#hl-46-151>151</a>
</span><span class=lnt id=hl-46-152><a class=lnlinks href=#hl-46-152>152</a>
</span><span class=lnt id=hl-46-153><a class=lnlinks href=#hl-46-153>153</a>
</span><span class=lnt id=hl-46-154><a class=lnlinks href=#hl-46-154>154</a>
</span><span class=lnt id=hl-46-155><a class=lnlinks href=#hl-46-155>155</a>
</span><span class=lnt id=hl-46-156><a class=lnlinks href=#hl-46-156>156</a>
</span><span class=lnt id=hl-46-157><a class=lnlinks href=#hl-46-157>157</a>
</span><span class=lnt id=hl-46-158><a class=lnlinks href=#hl-46-158>158</a>
</span><span class=lnt id=hl-46-159><a class=lnlinks href=#hl-46-159>159</a>
</span><span class=lnt id=hl-46-160><a class=lnlinks href=#hl-46-160>160</a>
</span><span class=lnt id=hl-46-161><a class=lnlinks href=#hl-46-161>161</a>
</span><span class=lnt id=hl-46-162><a class=lnlinks href=#hl-46-162>162</a>
</span><span class=lnt id=hl-46-163><a class=lnlinks href=#hl-46-163>163</a>
</span><span class=lnt id=hl-46-164><a class=lnlinks href=#hl-46-164>164</a>
</span><span class=lnt id=hl-46-165><a class=lnlinks href=#hl-46-165>165</a>
</span><span class=lnt id=hl-46-166><a class=lnlinks href=#hl-46-166>166</a>
</span><span class=lnt id=hl-46-167><a class=lnlinks href=#hl-46-167>167</a>
</span><span class=lnt id=hl-46-168><a class=lnlinks href=#hl-46-168>168</a>
</span><span class=lnt id=hl-46-169><a class=lnlinks href=#hl-46-169>169</a>
</span><span class=lnt id=hl-46-170><a class=lnlinks href=#hl-46-170>170</a>
</span><span class=lnt id=hl-46-171><a class=lnlinks href=#hl-46-171>171</a>
</span><span class=lnt id=hl-46-172><a class=lnlinks href=#hl-46-172>172</a>
</span><span class=lnt id=hl-46-173><a class=lnlinks href=#hl-46-173>173</a>
</span><span class=lnt id=hl-46-174><a class=lnlinks href=#hl-46-174>174</a>
</span><span class=lnt id=hl-46-175><a class=lnlinks href=#hl-46-175>175</a>
</span><span class=lnt id=hl-46-176><a class=lnlinks href=#hl-46-176>176</a>
</span><span class=lnt id=hl-46-177><a class=lnlinks href=#hl-46-177>177</a>
</span><span class=lnt id=hl-46-178><a class=lnlinks href=#hl-46-178>178</a>
</span><span class=lnt id=hl-46-179><a class=lnlinks href=#hl-46-179>179</a>
</span><span class=lnt id=hl-46-180><a class=lnlinks href=#hl-46-180>180</a>
</span><span class=lnt id=hl-46-181><a class=lnlinks href=#hl-46-181>181</a>
</span><span class=lnt id=hl-46-182><a class=lnlinks href=#hl-46-182>182</a>
</span><span class=lnt id=hl-46-183><a class=lnlinks href=#hl-46-183>183</a>
</span><span class=lnt id=hl-46-184><a class=lnlinks href=#hl-46-184>184</a>
</span><span class=lnt id=hl-46-185><a class=lnlinks href=#hl-46-185>185</a>
</span><span class=lnt id=hl-46-186><a class=lnlinks href=#hl-46-186>186</a>
</span><span class=lnt id=hl-46-187><a class=lnlinks href=#hl-46-187>187</a>
</span><span class=lnt id=hl-46-188><a class=lnlinks href=#hl-46-188>188</a>
</span><span class=lnt id=hl-46-189><a class=lnlinks href=#hl-46-189>189</a>
</span><span class=lnt id=hl-46-190><a class=lnlinks href=#hl-46-190>190</a>
</span><span class=lnt id=hl-46-191><a class=lnlinks href=#hl-46-191>191</a>
</span><span class=lnt id=hl-46-192><a class=lnlinks href=#hl-46-192>192</a>
</span><span class=lnt id=hl-46-193><a class=lnlinks href=#hl-46-193>193</a>
</span><span class=lnt id=hl-46-194><a class=lnlinks href=#hl-46-194>194</a>
</span><span class=lnt id=hl-46-195><a class=lnlinks href=#hl-46-195>195</a>
</span><span class=lnt id=hl-46-196><a class=lnlinks href=#hl-46-196>196</a>
</span><span class=lnt id=hl-46-197><a class=lnlinks href=#hl-46-197>197</a>
</span><span class=lnt id=hl-46-198><a class=lnlinks href=#hl-46-198>198</a>
</span><span class=lnt id=hl-46-199><a class=lnlinks href=#hl-46-199>199</a>
</span><span class=lnt id=hl-46-200><a class=lnlinks href=#hl-46-200>200</a>
</span><span class=lnt id=hl-46-201><a class=lnlinks href=#hl-46-201>201</a>
</span><span class=lnt id=hl-46-202><a class=lnlinks href=#hl-46-202>202</a>
</span><span class=lnt id=hl-46-203><a class=lnlinks href=#hl-46-203>203</a>
</span><span class=lnt id=hl-46-204><a class=lnlinks href=#hl-46-204>204</a>
</span><span class=lnt id=hl-46-205><a class=lnlinks href=#hl-46-205>205</a>
</span><span class=lnt id=hl-46-206><a class=lnlinks href=#hl-46-206>206</a>
</span><span class=lnt id=hl-46-207><a class=lnlinks href=#hl-46-207>207</a>
</span><span class=lnt id=hl-46-208><a class=lnlinks href=#hl-46-208>208</a>
</span><span class=lnt id=hl-46-209><a class=lnlinks href=#hl-46-209>209</a>
</span><span class=lnt id=hl-46-210><a class=lnlinks href=#hl-46-210>210</a>
</span><span class=lnt id=hl-46-211><a class=lnlinks href=#hl-46-211>211</a>
</span><span class=lnt id=hl-46-212><a class=lnlinks href=#hl-46-212>212</a>
</span><span class=lnt id=hl-46-213><a class=lnlinks href=#hl-46-213>213</a>
</span><span class=lnt id=hl-46-214><a class=lnlinks href=#hl-46-214>214</a>
</span><span class=lnt id=hl-46-215><a class=lnlinks href=#hl-46-215>215</a>
</span><span class=lnt id=hl-46-216><a class=lnlinks href=#hl-46-216>216</a>
</span><span class=lnt id=hl-46-217><a class=lnlinks href=#hl-46-217>217</a>
</span><span class=lnt id=hl-46-218><a class=lnlinks href=#hl-46-218>218</a>
</span><span class=lnt id=hl-46-219><a class=lnlinks href=#hl-46-219>219</a>
</span><span class=lnt id=hl-46-220><a class=lnlinks href=#hl-46-220>220</a>
</span><span class=lnt id=hl-46-221><a class=lnlinks href=#hl-46-221>221</a>
</span><span class=lnt id=hl-46-222><a class=lnlinks href=#hl-46-222>222</a>
</span><span class=lnt id=hl-46-223><a class=lnlinks href=#hl-46-223>223</a>
</span><span class=lnt id=hl-46-224><a class=lnlinks href=#hl-46-224>224</a>
</span><span class=lnt id=hl-46-225><a class=lnlinks href=#hl-46-225>225</a>
</span><span class=lnt id=hl-46-226><a class=lnlinks href=#hl-46-226>226</a>
</span><span class=lnt id=hl-46-227><a class=lnlinks href=#hl-46-227>227</a>
</span><span class=lnt id=hl-46-228><a class=lnlinks href=#hl-46-228>228</a>
</span><span class=lnt id=hl-46-229><a class=lnlinks href=#hl-46-229>229</a>
</span><span class=lnt id=hl-46-230><a class=lnlinks href=#hl-46-230>230</a>
</span><span class=lnt id=hl-46-231><a class=lnlinks href=#hl-46-231>231</a>
</span><span class=lnt id=hl-46-232><a class=lnlinks href=#hl-46-232>232</a>
</span><span class=lnt id=hl-46-233><a class=lnlinks href=#hl-46-233>233</a>
</span><span class=lnt id=hl-46-234><a class=lnlinks href=#hl-46-234>234</a>
</span><span class=lnt id=hl-46-235><a class=lnlinks href=#hl-46-235>235</a>
</span><span class=lnt id=hl-46-236><a class=lnlinks href=#hl-46-236>236</a>
</span><span class=lnt id=hl-46-237><a class=lnlinks href=#hl-46-237>237</a>
</span><span class=lnt id=hl-46-238><a class=lnlinks href=#hl-46-238>238</a>
</span><span class=lnt id=hl-46-239><a class=lnlinks href=#hl-46-239>239</a>
</span><span class=lnt id=hl-46-240><a class=lnlinks href=#hl-46-240>240</a>
</span><span class=lnt id=hl-46-241><a class=lnlinks href=#hl-46-241>241</a>
</span><span class=lnt id=hl-46-242><a class=lnlinks href=#hl-46-242>242</a>
</span><span class=lnt id=hl-46-243><a class=lnlinks href=#hl-46-243>243</a>
</span><span class=lnt id=hl-46-244><a class=lnlinks href=#hl-46-244>244</a>
</span><span class=lnt id=hl-46-245><a class=lnlinks href=#hl-46-245>245</a>
</span><span class=lnt id=hl-46-246><a class=lnlinks href=#hl-46-246>246</a>
</span><span class=lnt id=hl-46-247><a class=lnlinks href=#hl-46-247>247</a>
</span><span class=lnt id=hl-46-248><a class=lnlinks href=#hl-46-248>248</a>
</span><span class=lnt id=hl-46-249><a class=lnlinks href=#hl-46-249>249</a>
</span><span class=lnt id=hl-46-250><a class=lnlinks href=#hl-46-250>250</a>
</span><span class=lnt id=hl-46-251><a class=lnlinks href=#hl-46-251>251</a>
</span><span class=lnt id=hl-46-252><a class=lnlinks href=#hl-46-252>252</a>
</span><span class=lnt id=hl-46-253><a class=lnlinks href=#hl-46-253>253</a>
</span><span class=lnt id=hl-46-254><a class=lnlinks href=#hl-46-254>254</a>
</span><span class=lnt id=hl-46-255><a class=lnlinks href=#hl-46-255>255</a>
</span><span class=lnt id=hl-46-256><a class=lnlinks href=#hl-46-256>256</a>
</span><span class=lnt id=hl-46-257><a class=lnlinks href=#hl-46-257>257</a>
</span><span class=lnt id=hl-46-258><a class=lnlinks href=#hl-46-258>258</a>
</span><span class=lnt id=hl-46-259><a class=lnlinks href=#hl-46-259>259</a>
</span><span class=lnt id=hl-46-260><a class=lnlinks href=#hl-46-260>260</a>
</span><span class=lnt id=hl-46-261><a class=lnlinks href=#hl-46-261>261</a>
</span><span class=lnt id=hl-46-262><a class=lnlinks href=#hl-46-262>262</a>
</span><span class=lnt id=hl-46-263><a class=lnlinks href=#hl-46-263>263</a>
</span><span class=lnt id=hl-46-264><a class=lnlinks href=#hl-46-264>264</a>
</span><span class=lnt id=hl-46-265><a class=lnlinks href=#hl-46-265>265</a>
</span><span class=lnt id=hl-46-266><a class=lnlinks href=#hl-46-266>266</a>
</span><span class=lnt id=hl-46-267><a class=lnlinks href=#hl-46-267>267</a>
</span><span class=lnt id=hl-46-268><a class=lnlinks href=#hl-46-268>268</a>
</span><span class=lnt id=hl-46-269><a class=lnlinks href=#hl-46-269>269</a>
</span><span class=lnt id=hl-46-270><a class=lnlinks href=#hl-46-270>270</a>
</span><span class=lnt id=hl-46-271><a class=lnlinks href=#hl-46-271>271</a>
</span><span class=lnt id=hl-46-272><a class=lnlinks href=#hl-46-272>272</a>
</span><span class=lnt id=hl-46-273><a class=lnlinks href=#hl-46-273>273</a>
</span><span class=lnt id=hl-46-274><a class=lnlinks href=#hl-46-274>274</a>
</span><span class=lnt id=hl-46-275><a class=lnlinks href=#hl-46-275>275</a>
</span><span class=lnt id=hl-46-276><a class=lnlinks href=#hl-46-276>276</a>
</span><span class=lnt id=hl-46-277><a class=lnlinks href=#hl-46-277>277</a>
</span><span class=lnt id=hl-46-278><a class=lnlinks href=#hl-46-278>278</a>
</span><span class=lnt id=hl-46-279><a class=lnlinks href=#hl-46-279>279</a>
</span><span class=lnt id=hl-46-280><a class=lnlinks href=#hl-46-280>280</a>
</span><span class=lnt id=hl-46-281><a class=lnlinks href=#hl-46-281>281</a>
</span><span class=lnt id=hl-46-282><a class=lnlinks href=#hl-46-282>282</a>
</span><span class=lnt id=hl-46-283><a class=lnlinks href=#hl-46-283>283</a>
</span><span class=lnt id=hl-46-284><a class=lnlinks href=#hl-46-284>284</a>
</span><span class=lnt id=hl-46-285><a class=lnlinks href=#hl-46-285>285</a>
</span><span class=lnt id=hl-46-286><a class=lnlinks href=#hl-46-286>286</a>
</span><span class=lnt id=hl-46-287><a class=lnlinks href=#hl-46-287>287</a>
</span><span class=lnt id=hl-46-288><a class=lnlinks href=#hl-46-288>288</a>
</span><span class=lnt id=hl-46-289><a class=lnlinks href=#hl-46-289>289</a>
</span><span class=lnt id=hl-46-290><a class=lnlinks href=#hl-46-290>290</a>
</span><span class=lnt id=hl-46-291><a class=lnlinks href=#hl-46-291>291</a>
</span><span class=lnt id=hl-46-292><a class=lnlinks href=#hl-46-292>292</a>
</span><span class=lnt id=hl-46-293><a class=lnlinks href=#hl-46-293>293</a>
</span><span class=lnt id=hl-46-294><a class=lnlinks href=#hl-46-294>294</a>
</span><span class=lnt id=hl-46-295><a class=lnlinks href=#hl-46-295>295</a>
</span><span class=lnt id=hl-46-296><a class=lnlinks href=#hl-46-296>296</a>
</span><span class=lnt id=hl-46-297><a class=lnlinks href=#hl-46-297>297</a>
</span><span class=lnt id=hl-46-298><a class=lnlinks href=#hl-46-298>298</a>
</span><span class=lnt id=hl-46-299><a class=lnlinks href=#hl-46-299>299</a>
</span><span class=lnt id=hl-46-300><a class=lnlinks href=#hl-46-300>300</a>
</span><span class=lnt id=hl-46-301><a class=lnlinks href=#hl-46-301>301</a>
</span><span class=lnt id=hl-46-302><a class=lnlinks href=#hl-46-302>302</a>
</span><span class=lnt id=hl-46-303><a class=lnlinks href=#hl-46-303>303</a>
</span><span class=lnt id=hl-46-304><a class=lnlinks href=#hl-46-304>304</a>
</span><span class=lnt id=hl-46-305><a class=lnlinks href=#hl-46-305>305</a>
</span><span class=lnt id=hl-46-306><a class=lnlinks href=#hl-46-306>306</a>
</span><span class=lnt id=hl-46-307><a class=lnlinks href=#hl-46-307>307</a>
</span><span class=lnt id=hl-46-308><a class=lnlinks href=#hl-46-308>308</a>
</span><span class=lnt id=hl-46-309><a class=lnlinks href=#hl-46-309>309</a>
</span><span class=lnt id=hl-46-310><a class=lnlinks href=#hl-46-310>310</a>
</span><span class=lnt id=hl-46-311><a class=lnlinks href=#hl-46-311>311</a>
</span><span class=lnt id=hl-46-312><a class=lnlinks href=#hl-46-312>312</a>
</span><span class=lnt id=hl-46-313><a class=lnlinks href=#hl-46-313>313</a>
</span><span class=lnt id=hl-46-314><a class=lnlinks href=#hl-46-314>314</a>
</span><span class=lnt id=hl-46-315><a class=lnlinks href=#hl-46-315>315</a>
</span><span class=lnt id=hl-46-316><a class=lnlinks href=#hl-46-316>316</a>
</span><span class=lnt id=hl-46-317><a class=lnlinks href=#hl-46-317>317</a>
</span><span class=lnt id=hl-46-318><a class=lnlinks href=#hl-46-318>318</a>
</span><span class=lnt id=hl-46-319><a class=lnlinks href=#hl-46-319>319</a>
</span><span class=lnt id=hl-46-320><a class=lnlinks href=#hl-46-320>320</a>
</span><span class=lnt id=hl-46-321><a class=lnlinks href=#hl-46-321>321</a>
</span><span class=lnt id=hl-46-322><a class=lnlinks href=#hl-46-322>322</a>
</span><span class=lnt id=hl-46-323><a class=lnlinks href=#hl-46-323>323</a>
</span><span class=lnt id=hl-46-324><a class=lnlinks href=#hl-46-324>324</a>
</span><span class=lnt id=hl-46-325><a class=lnlinks href=#hl-46-325>325</a>
</span><span class=lnt id=hl-46-326><a class=lnlinks href=#hl-46-326>326</a>
</span><span class=lnt id=hl-46-327><a class=lnlinks href=#hl-46-327>327</a>
</span><span class=lnt id=hl-46-328><a class=lnlinks href=#hl-46-328>328</a>
</span><span class=lnt id=hl-46-329><a class=lnlinks href=#hl-46-329>329</a>
</span><span class=lnt id=hl-46-330><a class=lnlinks href=#hl-46-330>330</a>
</span><span class=lnt id=hl-46-331><a class=lnlinks href=#hl-46-331>331</a>
</span><span class=lnt id=hl-46-332><a class=lnlinks href=#hl-46-332>332</a>
</span><span class=lnt id=hl-46-333><a class=lnlinks href=#hl-46-333>333</a>
</span><span class=lnt id=hl-46-334><a class=lnlinks href=#hl-46-334>334</a>
</span><span class=lnt id=hl-46-335><a class=lnlinks href=#hl-46-335>335</a>
</span><span class=lnt id=hl-46-336><a class=lnlinks href=#hl-46-336>336</a>
</span><span class=lnt id=hl-46-337><a class=lnlinks href=#hl-46-337>337</a>
</span><span class=lnt id=hl-46-338><a class=lnlinks href=#hl-46-338>338</a>
</span><span class=lnt id=hl-46-339><a class=lnlinks href=#hl-46-339>339</a>
</span><span class=lnt id=hl-46-340><a class=lnlinks href=#hl-46-340>340</a>
</span><span class=lnt id=hl-46-341><a class=lnlinks href=#hl-46-341>341</a>
</span><span class=lnt id=hl-46-342><a class=lnlinks href=#hl-46-342>342</a>
</span><span class=lnt id=hl-46-343><a class=lnlinks href=#hl-46-343>343</a>
</span><span class=lnt id=hl-46-344><a class=lnlinks href=#hl-46-344>344</a>
</span><span class=lnt id=hl-46-345><a class=lnlinks href=#hl-46-345>345</a>
</span><span class=lnt id=hl-46-346><a class=lnlinks href=#hl-46-346>346</a>
</span><span class=lnt id=hl-46-347><a class=lnlinks href=#hl-46-347>347</a>
</span><span class=lnt id=hl-46-348><a class=lnlinks href=#hl-46-348>348</a>
</span><span class=lnt id=hl-46-349><a class=lnlinks href=#hl-46-349>349</a>
</span><span class=lnt id=hl-46-350><a class=lnlinks href=#hl-46-350>350</a>
</span><span class=lnt id=hl-46-351><a class=lnlinks href=#hl-46-351>351</a>
</span><span class=lnt id=hl-46-352><a class=lnlinks href=#hl-46-352>352</a>
</span><span class=lnt id=hl-46-353><a class=lnlinks href=#hl-46-353>353</a>
</span><span class=lnt id=hl-46-354><a class=lnlinks href=#hl-46-354>354</a>
</span><span class=lnt id=hl-46-355><a class=lnlinks href=#hl-46-355>355</a>
</span><span class=lnt id=hl-46-356><a class=lnlinks href=#hl-46-356>356</a>
</span><span class=lnt id=hl-46-357><a class=lnlinks href=#hl-46-357>357</a>
</span><span class=lnt id=hl-46-358><a class=lnlinks href=#hl-46-358>358</a>
</span><span class=lnt id=hl-46-359><a class=lnlinks href=#hl-46-359>359</a>
</span><span class=lnt id=hl-46-360><a class=lnlinks href=#hl-46-360>360</a>
</span><span class=lnt id=hl-46-361><a class=lnlinks href=#hl-46-361>361</a>
</span><span class=lnt id=hl-46-362><a class=lnlinks href=#hl-46-362>362</a>
</span><span class=lnt id=hl-46-363><a class=lnlinks href=#hl-46-363>363</a>
</span><span class=lnt id=hl-46-364><a class=lnlinks href=#hl-46-364>364</a>
</span><span class=lnt id=hl-46-365><a class=lnlinks href=#hl-46-365>365</a>
</span><span class=lnt id=hl-46-366><a class=lnlinks href=#hl-46-366>366</a>
</span><span class=lnt id=hl-46-367><a class=lnlinks href=#hl-46-367>367</a>
</span><span class=lnt id=hl-46-368><a class=lnlinks href=#hl-46-368>368</a>
</span><span class=lnt id=hl-46-369><a class=lnlinks href=#hl-46-369>369</a>
</span><span class=lnt id=hl-46-370><a class=lnlinks href=#hl-46-370>370</a>
</span><span class=lnt id=hl-46-371><a class=lnlinks href=#hl-46-371>371</a>
</span><span class=lnt id=hl-46-372><a class=lnlinks href=#hl-46-372>372</a>
</span><span class=lnt id=hl-46-373><a class=lnlinks href=#hl-46-373>373</a>
</span><span class=lnt id=hl-46-374><a class=lnlinks href=#hl-46-374>374</a>
</span><span class=lnt id=hl-46-375><a class=lnlinks href=#hl-46-375>375</a>
</span><span class=lnt id=hl-46-376><a class=lnlinks href=#hl-46-376>376</a>
</span><span class=lnt id=hl-46-377><a class=lnlinks href=#hl-46-377>377</a>
</span><span class=lnt id=hl-46-378><a class=lnlinks href=#hl-46-378>378</a>
</span><span class=lnt id=hl-46-379><a class=lnlinks href=#hl-46-379>379</a>
</span><span class=lnt id=hl-46-380><a class=lnlinks href=#hl-46-380>380</a>
</span><span class=lnt id=hl-46-381><a class=lnlinks href=#hl-46-381>381</a>
</span><span class=lnt id=hl-46-382><a class=lnlinks href=#hl-46-382>382</a>
</span><span class=lnt id=hl-46-383><a class=lnlinks href=#hl-46-383>383</a>
</span><span class=lnt id=hl-46-384><a class=lnlinks href=#hl-46-384>384</a>
</span><span class=lnt id=hl-46-385><a class=lnlinks href=#hl-46-385>385</a>
</span><span class=lnt id=hl-46-386><a class=lnlinks href=#hl-46-386>386</a>
</span><span class=lnt id=hl-46-387><a class=lnlinks href=#hl-46-387>387</a>
</span><span class=lnt id=hl-46-388><a class=lnlinks href=#hl-46-388>388</a>
</span><span class=lnt id=hl-46-389><a class=lnlinks href=#hl-46-389>389</a>
</span><span class=lnt id=hl-46-390><a class=lnlinks href=#hl-46-390>390</a>
</span><span class=lnt id=hl-46-391><a class=lnlinks href=#hl-46-391>391</a>
</span><span class=lnt id=hl-46-392><a class=lnlinks href=#hl-46-392>392</a>
</span><span class=lnt id=hl-46-393><a class=lnlinks href=#hl-46-393>393</a>
</span><span class=lnt id=hl-46-394><a class=lnlinks href=#hl-46-394>394</a>
</span><span class=lnt id=hl-46-395><a class=lnlinks href=#hl-46-395>395</a>
</span><span class=lnt id=hl-46-396><a class=lnlinks href=#hl-46-396>396</a>
</span><span class=lnt id=hl-46-397><a class=lnlinks href=#hl-46-397>397</a>
</span><span class=lnt id=hl-46-398><a class=lnlinks href=#hl-46-398>398</a>
</span><span class=lnt id=hl-46-399><a class=lnlinks href=#hl-46-399>399</a>
</span><span class=lnt id=hl-46-400><a class=lnlinks href=#hl-46-400>400</a>
</span><span class=lnt id=hl-46-401><a class=lnlinks href=#hl-46-401>401</a>
</span><span class=lnt id=hl-46-402><a class=lnlinks href=#hl-46-402>402</a>
</span><span class=lnt id=hl-46-403><a class=lnlinks href=#hl-46-403>403</a>
</span><span class=lnt id=hl-46-404><a class=lnlinks href=#hl-46-404>404</a>
</span><span class=lnt id=hl-46-405><a class=lnlinks href=#hl-46-405>405</a>
</span><span class=lnt id=hl-46-406><a class=lnlinks href=#hl-46-406>406</a>
</span><span class=lnt id=hl-46-407><a class=lnlinks href=#hl-46-407>407</a>
</span><span class=lnt id=hl-46-408><a class=lnlinks href=#hl-46-408>408</a>
</span><span class=lnt id=hl-46-409><a class=lnlinks href=#hl-46-409>409</a>
</span><span class=lnt id=hl-46-410><a class=lnlinks href=#hl-46-410>410</a>
</span><span class=lnt id=hl-46-411><a class=lnlinks href=#hl-46-411>411</a>
</span><span class=lnt id=hl-46-412><a class=lnlinks href=#hl-46-412>412</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js에서 Kafka를 사용한 데이터 스트리밍 아키텍처 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>Kafka</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;kafkajs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Redis</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;ioredis&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cors</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;cors&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Kafka 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>kafka</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Kafka</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>clientId</span><span class=o>:</span> <span class=s1>&#39;data-stream-processor&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>brokers</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Redis 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>redisClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Redis</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Express 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cors</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 스트림 처리 클래스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>StreamProcessor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>producer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>producer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>consumer</span><span class=p>({</span> <span class=nx>groupId</span><span class=o>:</span> <span class=s1>&#39;stream-processor-group&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>metricConsumer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>consumer</span><span class=p>({</span> <span class=nx>groupId</span><span class=o>:</span> <span class=s1>&#39;metrics-processor-group&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>eventCounts</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>start</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 생산자 및 소비자 연결
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>metricConsumer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 토픽 구독
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span> <span class=nx>topics</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;data-events&#39;</span><span class=p>],</span> <span class=nx>fromBeginning</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>metricConsumer</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span> <span class=nx>topics</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;metrics&#39;</span><span class=p>],</span> <span class=nx>fromBeginning</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 데이터 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>run</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>eachMessage</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>topic</span><span class=p>,</span> <span class=nx>partition</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>heartbeat</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>eventData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>eventType</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`데이터 이벤트 수신: </span><span class=si>${</span><span class=nx>eventType</span><span class=si>}</span><span class=sb>, ID: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 이벤트 카운트 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>eventCounts</span><span class=p>[</span><span class=nx>eventType</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>eventCounts</span><span class=p>[</span><span class=nx>eventType</span><span class=p>]</span> <span class=o>||</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 이벤트 타입에 따른 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processEvent</span><span class=p>(</span><span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 주기적 하트비트 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>await</span> <span class=nx>heartbeat</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;이벤트 처리 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메트릭 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>metricConsumer</span><span class=p>.</span><span class=nx>run</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>eachMessage</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>topic</span><span class=p>,</span> <span class=nx>partition</span><span class=p>,</span> <span class=nx>message</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>metricData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 지표 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>this</span><span class=p>.</span><span class=nx>updateMetrics</span><span class=p>(</span><span class=nx>metricData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// Redis에 실시간 지표 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>storeMetricsInRedis</span><span class=p>(</span><span class=nx>metricData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;메트릭 처리 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 주기적인 통계 보고
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>reportStats</span><span class=p>(),</span> <span class=mi>60000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;스트림 프로세서가 시작되었습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>processEvent</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트 타입에 따른 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>switch</span> <span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;user_action&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processUserAction</span><span class=p>(</span><span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;system_metric&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processSystemMetric</span><span class=p>(</span><span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;transaction&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processTransaction</span><span class=p>(</span><span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`알 수 없는 이벤트 타입: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메트릭 토픽으로 집계 데이터 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sendMetrics</span><span class=p>(</span><span class=nx>eventData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>processUserAction</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 사용자 행동 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`사용자 행동 처리: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>userId</span><span class=si>}</span><span class=sb>, 액션: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>action</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 사용자 행동 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>key</span> <span class=o>=</span> <span class=sb>`user:</span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>userId</span><span class=si>}</span><span class=sb>:actions`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>action</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>expire</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=mi>86400</span><span class=p>);</span> <span class=c1>// 24시간 유지
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>processSystemMetric</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 시스템 메트릭 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`시스템 메트릭 처리: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>system</span><span class=si>}</span><span class=sb>, 지표: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>metric</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 시스템 메트릭 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>key</span> <span class=o>=</span> <span class=sb>`system:</span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>system</span><span class=si>}</span><span class=sb>:metrics`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hset</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>metric</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>processTransaction</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 트랜잭션 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`트랜잭션 처리: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>transactionId</span><span class=si>}</span><span class=sb>, 금액: </span><span class=si>${</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>amount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 트랜잭션 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>dayKey</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>().</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=sb>`transactions:</span><span class=si>${</span><span class=nx>dayKey</span><span class=si>}</span><span class=sb>:count`</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=sb>`transactions:</span><span class=si>${</span><span class=nx>dayKey</span><span class=si>}</span><span class=sb>:amount`</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>,</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>amount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>sendMetrics</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 메트릭 데이터 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>metricData</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>      <span class=nx>source</span><span class=o>:</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>source</span> <span class=o>||</span> <span class=s1>&#39;unknown&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>eventType</span><span class=o>:</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>dimensions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 타입별 차원 추출
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=err>…</span><span class=k>this</span><span class=p>.</span><span class=nx>extractDimensions</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>metrics</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 타입별 지표 추출
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=err>…</span><span class=k>this</span><span class=p>.</span><span class=nx>extractMetrics</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 메트릭 토픽으로 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>topic</span><span class=o>:</span> <span class=s1>&#39;metrics&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>messages</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>metricData</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>extractDimensions</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트에서 차원 정보 추출
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>dimensions</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;user_action&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>userId</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>userId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>action</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>action</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>platform</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>platform</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;system_metric&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>system</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>system</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>metric</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>metric</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>instance</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;transaction&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>transactionType</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>transactionType</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>paymentMethod</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>paymentMethod</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=p>.</span><span class=nx>country</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>country</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>dimensions</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>extractMetrics</span><span class=p>(</span><span class=nx>eventData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 이벤트에서 지표 정보 추출
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>metrics</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;user_action&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=p>.</span><span class=nx>duration</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>duration</span> <span class=o>||</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;system_metric&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;transaction&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=p>.</span><span class=nx>amount</span> <span class=o>=</span> <span class=nx>eventData</span><span class=p>.</span><span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>metrics</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>updateMetrics</span><span class=p>(</span><span class=nx>metricData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>eventType</span><span class=p>,</span> <span class=nx>dimensions</span><span class=p>,</span> <span class=nx>metrics</span><span class=p>,</span> <span class=nx>timestamp</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>metricData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>timeWindow</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>timestamp</span> <span class=o>/</span> <span class=mi>60000</span><span class=p>)</span> <span class=o>*</span> <span class=mi>60000</span><span class=p>;</span> <span class=c1>// 1분 윈도우
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// 시간 윈도우별 지표 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>timeWindow</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>timeWindow</span><span class=p>]</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>timeWindow</span><span class=p>][</span><span class=nx>eventType</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>timeWindow</span><span class=p>][</span><span class=nx>eventType</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>dimensions</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>        <span class=nx>metrics</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>stats</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>timeWindow</span><span class=p>][</span><span class=nx>eventType</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nx>stats</span><span class=p>.</span><span class=nx>count</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 차원별 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>dimName</span><span class=p>,</span> <span class=nx>dimValue</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>dimensions</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>stats</span><span class=p>.</span><span class=nx>dimensions</span><span class=p>[</span><span class=nx>dimName</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>stats</span><span class=p>.</span><span class=nx>dimensions</span><span class=p>[</span><span class=nx>dimName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>stats</span><span class=p>.</span><span class=nx>dimensions</span><span class=p>[</span><span class=nx>dimName</span><span class=p>][</span><span class=nx>dimValue</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>stats</span><span class=p>.</span><span class=nx>dimensions</span><span class=p>[</span><span class=nx>dimName</span><span class=p>][</span><span class=nx>dimValue</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>stats</span><span class=p>.</span><span class=nx>dimensions</span><span class=p>[</span><span class=nx>dimName</span><span class=p>][</span><span class=nx>dimValue</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 지표 집계
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>metricName</span><span class=p>,</span> <span class=nx>metricValue</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>metrics</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>stats</span><span class=p>.</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>stats</span><span class=p>.</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>sum</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>min</span><span class=o>:</span> <span class=nb>Number</span><span class=p>.</span><span class=nx>MAX_VALUE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>max</span><span class=o>:</span> <span class=nb>Number</span><span class=p>.</span><span class=nx>MIN_VALUE</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>metricStats</span> <span class=o>=</span> <span class=nx>stats</span><span class=p>.</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=nx>metricStats</span><span class=p>.</span><span class=nx>sum</span> <span class=o>+=</span> <span class=nx>metricValue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>metricStats</span><span class=p>.</span><span class=nx>count</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>metricStats</span><span class=p>.</span><span class=nx>min</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>metricStats</span><span class=p>.</span><span class=nx>min</span><span class=p>,</span> <span class=nx>metricValue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>metricStats</span><span class=p>.</span><span class=nx>max</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=nx>metricStats</span><span class=p>.</span><span class=nx>max</span><span class=p>,</span> <span class=nx>metricValue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 오래된 윈도우 정리 (30분 이상 지난 데이터)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>cutoffTime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=mi>30</span> <span class=o>*</span> <span class=mi>60000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>windowTime</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>windowTime</span><span class=p>)</span> <span class=o>&lt;</span> <span class=nx>cutoffTime</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>delete</span> <span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nx>windowTime</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>storeMetricsInRedis</span><span class=p>(</span><span class=nx>metricData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>eventType</span><span class=p>,</span> <span class=nx>dimensions</span><span class=p>,</span> <span class=nx>metrics</span><span class=p>,</span> <span class=nx>timestamp</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>metricData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>timeWindow</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>timestamp</span> <span class=o>/</span> <span class=mi>60000</span><span class=p>);</span> <span class=c1>// 1분 윈도우
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// Redis에 지표 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>metricKey</span> <span class=o>=</span> <span class=sb>`metrics:</span><span class=si>${</span><span class=nx>timeWindow</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>eventType</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 지표 데이터 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>metricName</span><span class=p>,</span> <span class=nx>metricValue</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>metrics</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>metricKey</span><span class=si>}</span><span class=sb>:sum`</span><span class=p>,</span> <span class=nx>metricName</span><span class=p>,</span> <span class=nx>metricValue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>metricKey</span><span class=si>}</span><span class=sb>:count`</span><span class=p>,</span> <span class=nx>metricName</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 차원 데이터 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>dimName</span><span class=p>,</span> <span class=nx>dimValue</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>dimensions</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hincrby</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>metricKey</span><span class=si>}</span><span class=sb>:dimension:</span><span class=si>${</span><span class=nx>dimName</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>dimValue</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 만료 시간 설정 (24시간)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>expire</span><span class=p>(</span><span class=nx>metricKey</span><span class=p>,</span> <span class=mi>86400</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>reportStats</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n--- 스트림 프로세서 통계 ---&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;이벤트 카운트:&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>eventCounts</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 최근 5분 통계 계산
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>recentWindows</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>time</span> <span class=p>=&gt;</span> <span class=nx>now</span> <span class=o>-</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>time</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>60000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>sort</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>recentWindows</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n최근 5분 통계:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nb>window</span> <span class=k>of</span> <span class=nx>recentWindows</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>windowTime</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nb>parseInt</span><span class=p>(</span><span class=nb>window</span><span class=p>)).</span><span class=nx>toISOString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`\n시간 윈도우: </span><span class=si>${</span><span class=nx>windowTime</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>eventType</span><span class=p>,</span> <span class=nx>stats</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>realtimeStats</span><span class=p>[</span><span class=nb>window</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`  </span><span class=si>${</span><span class=nx>eventType</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>stats</span><span class=p>.</span><span class=nx>count</span><span class=si>}</span><span class=sb>건`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// 주요 지표 출력
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>metricName</span><span class=p>,</span> <span class=nx>metricStats</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>stats</span><span class=p>.</span><span class=nx>metrics</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>avg</span> <span class=o>=</span> <span class=nx>metricStats</span><span class=p>.</span><span class=nx>sum</span> <span class=o>/</span> <span class=nx>metricStats</span><span class=p>.</span><span class=nx>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`    </span><span class=si>${</span><span class=nx>metricName</span><span class=si>}</span><span class=sb>: avg=</span><span class=si>${</span><span class=nx>avg</span><span class=p>.</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=sb>, min=</span><span class=si>${</span><span class=nx>metricStats</span><span class=p>.</span><span class=nx>min</span><span class=si>}</span><span class=sb>, max=</span><span class=si>${</span><span class=nx>metricStats</span><span class=p>.</span><span class=nx>max</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n------------------------\n&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>stop</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>metricConsumer</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;스트림 프로세서가 중지되었습니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// API 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/api/stats/realtime&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 최근 5분 통계 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fiveMinutesAgo</span> <span class=o>=</span> <span class=nx>now</span> <span class=o>-</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>60000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Redis에서 최근 통계 데이터 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>timeWindows</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>t</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>fiveMinutesAgo</span> <span class=o>/</span> <span class=mi>60000</span><span class=p>);</span> <span class=nx>t</span> <span class=o>&lt;=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>now</span> <span class=o>/</span> <span class=mi>60000</span><span class=p>);</span> <span class=nx>t</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>timeWindows</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>timeWindows</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>      <span class=nx>eventTypes</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nb>window</span> <span class=k>of</span> <span class=nx>timeWindows</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>windowTime</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nb>window</span> <span class=o>*</span> <span class=mi>60000</span><span class=p>).</span><span class=nx>toISOString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>result</span><span class=p>.</span><span class=nx>timeWindows</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>windowTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 각 이벤트 타입별 데이터 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>eventTypes</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;user_action&#39;</span><span class=p>,</span> <span class=s1>&#39;system_metric&#39;</span><span class=p>,</span> <span class=s1>&#39;transaction&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>eventType</span> <span class=k>of</span> <span class=nx>eventTypes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>counts</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>            <span class=nx>metrics</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>          <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>metricKey</span> <span class=o>=</span> <span class=sb>`metrics:</span><span class=si>${</span><span class=nb>window</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>eventType</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 횟수 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>countData</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hgetall</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>metricKey</span><span class=si>}</span><span class=sb>:count`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>totalCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>count</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>values</span><span class=p>(</span><span class=nx>countData</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>totalCount</span> <span class=o>+=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>count</span> <span class=o>||</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>].</span><span class=nx>counts</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>totalCount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 주요 지표 조회
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>sumData</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>hgetall</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>metricKey</span><span class=si>}</span><span class=sb>:sum`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>metricName</span><span class=p>,</span> <span class=nx>sum</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>sumData</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>].</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>].</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>sums</span><span class=o>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=nx>result</span><span class=p>.</span><span class=nx>eventTypes</span><span class=p>[</span><span class=nx>eventType</span><span class=p>].</span><span class=nx>metrics</span><span class=p>[</span><span class=nx>metricName</span><span class=p>].</span><span class=nx>sums</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>sum</span> <span class=o>||</span> <span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;통계 조회 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 서버 시작
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>PORT</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>PORT</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`API 서버가 포트 </span><span class=si>${</span><span class=nx>PORT</span><span class=si>}</span><span class=sb>에서 실행 중입니다.`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 스트림 프로세서 시작
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>processor</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>StreamProcessor</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>processor</span><span class=p>.</span><span class=nx>start</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 정상 종료 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;애플리케이션 종료 중…&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>processor</span><span class=p>.</span><span class=nx>stop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>redisClient</span><span class=p>.</span><span class=nx>quit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=명령-및-이벤트-기반-아키텍처>명령 및 이벤트 기반 아키텍처<a hidden class=anchor aria-hidden=true href=#명령-및-이벤트-기반-아키텍처>#</a></h4><p>명령(Command)과 이벤트(Event)를 통해 시스템 컴포넌트 간의 통신을 조정하는 아키텍처 패턴이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-47-1><a class=lnlinks href=#hl-47-1>  1</a>
</span><span class=lnt id=hl-47-2><a class=lnlinks href=#hl-47-2>  2</a>
</span><span class=lnt id=hl-47-3><a class=lnlinks href=#hl-47-3>  3</a>
</span><span class=lnt id=hl-47-4><a class=lnlinks href=#hl-47-4>  4</a>
</span><span class=lnt id=hl-47-5><a class=lnlinks href=#hl-47-5>  5</a>
</span><span class=lnt id=hl-47-6><a class=lnlinks href=#hl-47-6>  6</a>
</span><span class=lnt id=hl-47-7><a class=lnlinks href=#hl-47-7>  7</a>
</span><span class=lnt id=hl-47-8><a class=lnlinks href=#hl-47-8>  8</a>
</span><span class=lnt id=hl-47-9><a class=lnlinks href=#hl-47-9>  9</a>
</span><span class=lnt id=hl-47-10><a class=lnlinks href=#hl-47-10> 10</a>
</span><span class=lnt id=hl-47-11><a class=lnlinks href=#hl-47-11> 11</a>
</span><span class=lnt id=hl-47-12><a class=lnlinks href=#hl-47-12> 12</a>
</span><span class=lnt id=hl-47-13><a class=lnlinks href=#hl-47-13> 13</a>
</span><span class=lnt id=hl-47-14><a class=lnlinks href=#hl-47-14> 14</a>
</span><span class=lnt id=hl-47-15><a class=lnlinks href=#hl-47-15> 15</a>
</span><span class=lnt id=hl-47-16><a class=lnlinks href=#hl-47-16> 16</a>
</span><span class=lnt id=hl-47-17><a class=lnlinks href=#hl-47-17> 17</a>
</span><span class=lnt id=hl-47-18><a class=lnlinks href=#hl-47-18> 18</a>
</span><span class=lnt id=hl-47-19><a class=lnlinks href=#hl-47-19> 19</a>
</span><span class=lnt id=hl-47-20><a class=lnlinks href=#hl-47-20> 20</a>
</span><span class=lnt id=hl-47-21><a class=lnlinks href=#hl-47-21> 21</a>
</span><span class=lnt id=hl-47-22><a class=lnlinks href=#hl-47-22> 22</a>
</span><span class=lnt id=hl-47-23><a class=lnlinks href=#hl-47-23> 23</a>
</span><span class=lnt id=hl-47-24><a class=lnlinks href=#hl-47-24> 24</a>
</span><span class=lnt id=hl-47-25><a class=lnlinks href=#hl-47-25> 25</a>
</span><span class=lnt id=hl-47-26><a class=lnlinks href=#hl-47-26> 26</a>
</span><span class=lnt id=hl-47-27><a class=lnlinks href=#hl-47-27> 27</a>
</span><span class=lnt id=hl-47-28><a class=lnlinks href=#hl-47-28> 28</a>
</span><span class=lnt id=hl-47-29><a class=lnlinks href=#hl-47-29> 29</a>
</span><span class=lnt id=hl-47-30><a class=lnlinks href=#hl-47-30> 30</a>
</span><span class=lnt id=hl-47-31><a class=lnlinks href=#hl-47-31> 31</a>
</span><span class=lnt id=hl-47-32><a class=lnlinks href=#hl-47-32> 32</a>
</span><span class=lnt id=hl-47-33><a class=lnlinks href=#hl-47-33> 33</a>
</span><span class=lnt id=hl-47-34><a class=lnlinks href=#hl-47-34> 34</a>
</span><span class=lnt id=hl-47-35><a class=lnlinks href=#hl-47-35> 35</a>
</span><span class=lnt id=hl-47-36><a class=lnlinks href=#hl-47-36> 36</a>
</span><span class=lnt id=hl-47-37><a class=lnlinks href=#hl-47-37> 37</a>
</span><span class=lnt id=hl-47-38><a class=lnlinks href=#hl-47-38> 38</a>
</span><span class=lnt id=hl-47-39><a class=lnlinks href=#hl-47-39> 39</a>
</span><span class=lnt id=hl-47-40><a class=lnlinks href=#hl-47-40> 40</a>
</span><span class=lnt id=hl-47-41><a class=lnlinks href=#hl-47-41> 41</a>
</span><span class=lnt id=hl-47-42><a class=lnlinks href=#hl-47-42> 42</a>
</span><span class=lnt id=hl-47-43><a class=lnlinks href=#hl-47-43> 43</a>
</span><span class=lnt id=hl-47-44><a class=lnlinks href=#hl-47-44> 44</a>
</span><span class=lnt id=hl-47-45><a class=lnlinks href=#hl-47-45> 45</a>
</span><span class=lnt id=hl-47-46><a class=lnlinks href=#hl-47-46> 46</a>
</span><span class=lnt id=hl-47-47><a class=lnlinks href=#hl-47-47> 47</a>
</span><span class=lnt id=hl-47-48><a class=lnlinks href=#hl-47-48> 48</a>
</span><span class=lnt id=hl-47-49><a class=lnlinks href=#hl-47-49> 49</a>
</span><span class=lnt id=hl-47-50><a class=lnlinks href=#hl-47-50> 50</a>
</span><span class=lnt id=hl-47-51><a class=lnlinks href=#hl-47-51> 51</a>
</span><span class=lnt id=hl-47-52><a class=lnlinks href=#hl-47-52> 52</a>
</span><span class=lnt id=hl-47-53><a class=lnlinks href=#hl-47-53> 53</a>
</span><span class=lnt id=hl-47-54><a class=lnlinks href=#hl-47-54> 54</a>
</span><span class=lnt id=hl-47-55><a class=lnlinks href=#hl-47-55> 55</a>
</span><span class=lnt id=hl-47-56><a class=lnlinks href=#hl-47-56> 56</a>
</span><span class=lnt id=hl-47-57><a class=lnlinks href=#hl-47-57> 57</a>
</span><span class=lnt id=hl-47-58><a class=lnlinks href=#hl-47-58> 58</a>
</span><span class=lnt id=hl-47-59><a class=lnlinks href=#hl-47-59> 59</a>
</span><span class=lnt id=hl-47-60><a class=lnlinks href=#hl-47-60> 60</a>
</span><span class=lnt id=hl-47-61><a class=lnlinks href=#hl-47-61> 61</a>
</span><span class=lnt id=hl-47-62><a class=lnlinks href=#hl-47-62> 62</a>
</span><span class=lnt id=hl-47-63><a class=lnlinks href=#hl-47-63> 63</a>
</span><span class=lnt id=hl-47-64><a class=lnlinks href=#hl-47-64> 64</a>
</span><span class=lnt id=hl-47-65><a class=lnlinks href=#hl-47-65> 65</a>
</span><span class=lnt id=hl-47-66><a class=lnlinks href=#hl-47-66> 66</a>
</span><span class=lnt id=hl-47-67><a class=lnlinks href=#hl-47-67> 67</a>
</span><span class=lnt id=hl-47-68><a class=lnlinks href=#hl-47-68> 68</a>
</span><span class=lnt id=hl-47-69><a class=lnlinks href=#hl-47-69> 69</a>
</span><span class=lnt id=hl-47-70><a class=lnlinks href=#hl-47-70> 70</a>
</span><span class=lnt id=hl-47-71><a class=lnlinks href=#hl-47-71> 71</a>
</span><span class=lnt id=hl-47-72><a class=lnlinks href=#hl-47-72> 72</a>
</span><span class=lnt id=hl-47-73><a class=lnlinks href=#hl-47-73> 73</a>
</span><span class=lnt id=hl-47-74><a class=lnlinks href=#hl-47-74> 74</a>
</span><span class=lnt id=hl-47-75><a class=lnlinks href=#hl-47-75> 75</a>
</span><span class=lnt id=hl-47-76><a class=lnlinks href=#hl-47-76> 76</a>
</span><span class=lnt id=hl-47-77><a class=lnlinks href=#hl-47-77> 77</a>
</span><span class=lnt id=hl-47-78><a class=lnlinks href=#hl-47-78> 78</a>
</span><span class=lnt id=hl-47-79><a class=lnlinks href=#hl-47-79> 79</a>
</span><span class=lnt id=hl-47-80><a class=lnlinks href=#hl-47-80> 80</a>
</span><span class=lnt id=hl-47-81><a class=lnlinks href=#hl-47-81> 81</a>
</span><span class=lnt id=hl-47-82><a class=lnlinks href=#hl-47-82> 82</a>
</span><span class=lnt id=hl-47-83><a class=lnlinks href=#hl-47-83> 83</a>
</span><span class=lnt id=hl-47-84><a class=lnlinks href=#hl-47-84> 84</a>
</span><span class=lnt id=hl-47-85><a class=lnlinks href=#hl-47-85> 85</a>
</span><span class=lnt id=hl-47-86><a class=lnlinks href=#hl-47-86> 86</a>
</span><span class=lnt id=hl-47-87><a class=lnlinks href=#hl-47-87> 87</a>
</span><span class=lnt id=hl-47-88><a class=lnlinks href=#hl-47-88> 88</a>
</span><span class=lnt id=hl-47-89><a class=lnlinks href=#hl-47-89> 89</a>
</span><span class=lnt id=hl-47-90><a class=lnlinks href=#hl-47-90> 90</a>
</span><span class=lnt id=hl-47-91><a class=lnlinks href=#hl-47-91> 91</a>
</span><span class=lnt id=hl-47-92><a class=lnlinks href=#hl-47-92> 92</a>
</span><span class=lnt id=hl-47-93><a class=lnlinks href=#hl-47-93> 93</a>
</span><span class=lnt id=hl-47-94><a class=lnlinks href=#hl-47-94> 94</a>
</span><span class=lnt id=hl-47-95><a class=lnlinks href=#hl-47-95> 95</a>
</span><span class=lnt id=hl-47-96><a class=lnlinks href=#hl-47-96> 96</a>
</span><span class=lnt id=hl-47-97><a class=lnlinks href=#hl-47-97> 97</a>
</span><span class=lnt id=hl-47-98><a class=lnlinks href=#hl-47-98> 98</a>
</span><span class=lnt id=hl-47-99><a class=lnlinks href=#hl-47-99> 99</a>
</span><span class=lnt id=hl-47-100><a class=lnlinks href=#hl-47-100>100</a>
</span><span class=lnt id=hl-47-101><a class=lnlinks href=#hl-47-101>101</a>
</span><span class=lnt id=hl-47-102><a class=lnlinks href=#hl-47-102>102</a>
</span><span class=lnt id=hl-47-103><a class=lnlinks href=#hl-47-103>103</a>
</span><span class=lnt id=hl-47-104><a class=lnlinks href=#hl-47-104>104</a>
</span><span class=lnt id=hl-47-105><a class=lnlinks href=#hl-47-105>105</a>
</span><span class=lnt id=hl-47-106><a class=lnlinks href=#hl-47-106>106</a>
</span><span class=lnt id=hl-47-107><a class=lnlinks href=#hl-47-107>107</a>
</span><span class=lnt id=hl-47-108><a class=lnlinks href=#hl-47-108>108</a>
</span><span class=lnt id=hl-47-109><a class=lnlinks href=#hl-47-109>109</a>
</span><span class=lnt id=hl-47-110><a class=lnlinks href=#hl-47-110>110</a>
</span><span class=lnt id=hl-47-111><a class=lnlinks href=#hl-47-111>111</a>
</span><span class=lnt id=hl-47-112><a class=lnlinks href=#hl-47-112>112</a>
</span><span class=lnt id=hl-47-113><a class=lnlinks href=#hl-47-113>113</a>
</span><span class=lnt id=hl-47-114><a class=lnlinks href=#hl-47-114>114</a>
</span><span class=lnt id=hl-47-115><a class=lnlinks href=#hl-47-115>115</a>
</span><span class=lnt id=hl-47-116><a class=lnlinks href=#hl-47-116>116</a>
</span><span class=lnt id=hl-47-117><a class=lnlinks href=#hl-47-117>117</a>
</span><span class=lnt id=hl-47-118><a class=lnlinks href=#hl-47-118>118</a>
</span><span class=lnt id=hl-47-119><a class=lnlinks href=#hl-47-119>119</a>
</span><span class=lnt id=hl-47-120><a class=lnlinks href=#hl-47-120>120</a>
</span><span class=lnt id=hl-47-121><a class=lnlinks href=#hl-47-121>121</a>
</span><span class=lnt id=hl-47-122><a class=lnlinks href=#hl-47-122>122</a>
</span><span class=lnt id=hl-47-123><a class=lnlinks href=#hl-47-123>123</a>
</span><span class=lnt id=hl-47-124><a class=lnlinks href=#hl-47-124>124</a>
</span><span class=lnt id=hl-47-125><a class=lnlinks href=#hl-47-125>125</a>
</span><span class=lnt id=hl-47-126><a class=lnlinks href=#hl-47-126>126</a>
</span><span class=lnt id=hl-47-127><a class=lnlinks href=#hl-47-127>127</a>
</span><span class=lnt id=hl-47-128><a class=lnlinks href=#hl-47-128>128</a>
</span><span class=lnt id=hl-47-129><a class=lnlinks href=#hl-47-129>129</a>
</span><span class=lnt id=hl-47-130><a class=lnlinks href=#hl-47-130>130</a>
</span><span class=lnt id=hl-47-131><a class=lnlinks href=#hl-47-131>131</a>
</span><span class=lnt id=hl-47-132><a class=lnlinks href=#hl-47-132>132</a>
</span><span class=lnt id=hl-47-133><a class=lnlinks href=#hl-47-133>133</a>
</span><span class=lnt id=hl-47-134><a class=lnlinks href=#hl-47-134>134</a>
</span><span class=lnt id=hl-47-135><a class=lnlinks href=#hl-47-135>135</a>
</span><span class=lnt id=hl-47-136><a class=lnlinks href=#hl-47-136>136</a>
</span><span class=lnt id=hl-47-137><a class=lnlinks href=#hl-47-137>137</a>
</span><span class=lnt id=hl-47-138><a class=lnlinks href=#hl-47-138>138</a>
</span><span class=lnt id=hl-47-139><a class=lnlinks href=#hl-47-139>139</a>
</span><span class=lnt id=hl-47-140><a class=lnlinks href=#hl-47-140>140</a>
</span><span class=lnt id=hl-47-141><a class=lnlinks href=#hl-47-141>141</a>
</span><span class=lnt id=hl-47-142><a class=lnlinks href=#hl-47-142>142</a>
</span><span class=lnt id=hl-47-143><a class=lnlinks href=#hl-47-143>143</a>
</span><span class=lnt id=hl-47-144><a class=lnlinks href=#hl-47-144>144</a>
</span><span class=lnt id=hl-47-145><a class=lnlinks href=#hl-47-145>145</a>
</span><span class=lnt id=hl-47-146><a class=lnlinks href=#hl-47-146>146</a>
</span><span class=lnt id=hl-47-147><a class=lnlinks href=#hl-47-147>147</a>
</span><span class=lnt id=hl-47-148><a class=lnlinks href=#hl-47-148>148</a>
</span><span class=lnt id=hl-47-149><a class=lnlinks href=#hl-47-149>149</a>
</span><span class=lnt id=hl-47-150><a class=lnlinks href=#hl-47-150>150</a>
</span><span class=lnt id=hl-47-151><a class=lnlinks href=#hl-47-151>151</a>
</span><span class=lnt id=hl-47-152><a class=lnlinks href=#hl-47-152>152</a>
</span><span class=lnt id=hl-47-153><a class=lnlinks href=#hl-47-153>153</a>
</span><span class=lnt id=hl-47-154><a class=lnlinks href=#hl-47-154>154</a>
</span><span class=lnt id=hl-47-155><a class=lnlinks href=#hl-47-155>155</a>
</span><span class=lnt id=hl-47-156><a class=lnlinks href=#hl-47-156>156</a>
</span><span class=lnt id=hl-47-157><a class=lnlinks href=#hl-47-157>157</a>
</span><span class=lnt id=hl-47-158><a class=lnlinks href=#hl-47-158>158</a>
</span><span class=lnt id=hl-47-159><a class=lnlinks href=#hl-47-159>159</a>
</span><span class=lnt id=hl-47-160><a class=lnlinks href=#hl-47-160>160</a>
</span><span class=lnt id=hl-47-161><a class=lnlinks href=#hl-47-161>161</a>
</span><span class=lnt id=hl-47-162><a class=lnlinks href=#hl-47-162>162</a>
</span><span class=lnt id=hl-47-163><a class=lnlinks href=#hl-47-163>163</a>
</span><span class=lnt id=hl-47-164><a class=lnlinks href=#hl-47-164>164</a>
</span><span class=lnt id=hl-47-165><a class=lnlinks href=#hl-47-165>165</a>
</span><span class=lnt id=hl-47-166><a class=lnlinks href=#hl-47-166>166</a>
</span><span class=lnt id=hl-47-167><a class=lnlinks href=#hl-47-167>167</a>
</span><span class=lnt id=hl-47-168><a class=lnlinks href=#hl-47-168>168</a>
</span><span class=lnt id=hl-47-169><a class=lnlinks href=#hl-47-169>169</a>
</span><span class=lnt id=hl-47-170><a class=lnlinks href=#hl-47-170>170</a>
</span><span class=lnt id=hl-47-171><a class=lnlinks href=#hl-47-171>171</a>
</span><span class=lnt id=hl-47-172><a class=lnlinks href=#hl-47-172>172</a>
</span><span class=lnt id=hl-47-173><a class=lnlinks href=#hl-47-173>173</a>
</span><span class=lnt id=hl-47-174><a class=lnlinks href=#hl-47-174>174</a>
</span><span class=lnt id=hl-47-175><a class=lnlinks href=#hl-47-175>175</a>
</span><span class=lnt id=hl-47-176><a class=lnlinks href=#hl-47-176>176</a>
</span><span class=lnt id=hl-47-177><a class=lnlinks href=#hl-47-177>177</a>
</span><span class=lnt id=hl-47-178><a class=lnlinks href=#hl-47-178>178</a>
</span><span class=lnt id=hl-47-179><a class=lnlinks href=#hl-47-179>179</a>
</span><span class=lnt id=hl-47-180><a class=lnlinks href=#hl-47-180>180</a>
</span><span class=lnt id=hl-47-181><a class=lnlinks href=#hl-47-181>181</a>
</span><span class=lnt id=hl-47-182><a class=lnlinks href=#hl-47-182>182</a>
</span><span class=lnt id=hl-47-183><a class=lnlinks href=#hl-47-183>183</a>
</span><span class=lnt id=hl-47-184><a class=lnlinks href=#hl-47-184>184</a>
</span><span class=lnt id=hl-47-185><a class=lnlinks href=#hl-47-185>185</a>
</span><span class=lnt id=hl-47-186><a class=lnlinks href=#hl-47-186>186</a>
</span><span class=lnt id=hl-47-187><a class=lnlinks href=#hl-47-187>187</a>
</span><span class=lnt id=hl-47-188><a class=lnlinks href=#hl-47-188>188</a>
</span><span class=lnt id=hl-47-189><a class=lnlinks href=#hl-47-189>189</a>
</span><span class=lnt id=hl-47-190><a class=lnlinks href=#hl-47-190>190</a>
</span><span class=lnt id=hl-47-191><a class=lnlinks href=#hl-47-191>191</a>
</span><span class=lnt id=hl-47-192><a class=lnlinks href=#hl-47-192>192</a>
</span><span class=lnt id=hl-47-193><a class=lnlinks href=#hl-47-193>193</a>
</span><span class=lnt id=hl-47-194><a class=lnlinks href=#hl-47-194>194</a>
</span><span class=lnt id=hl-47-195><a class=lnlinks href=#hl-47-195>195</a>
</span><span class=lnt id=hl-47-196><a class=lnlinks href=#hl-47-196>196</a>
</span><span class=lnt id=hl-47-197><a class=lnlinks href=#hl-47-197>197</a>
</span><span class=lnt id=hl-47-198><a class=lnlinks href=#hl-47-198>198</a>
</span><span class=lnt id=hl-47-199><a class=lnlinks href=#hl-47-199>199</a>
</span><span class=lnt id=hl-47-200><a class=lnlinks href=#hl-47-200>200</a>
</span><span class=lnt id=hl-47-201><a class=lnlinks href=#hl-47-201>201</a>
</span><span class=lnt id=hl-47-202><a class=lnlinks href=#hl-47-202>202</a>
</span><span class=lnt id=hl-47-203><a class=lnlinks href=#hl-47-203>203</a>
</span><span class=lnt id=hl-47-204><a class=lnlinks href=#hl-47-204>204</a>
</span><span class=lnt id=hl-47-205><a class=lnlinks href=#hl-47-205>205</a>
</span><span class=lnt id=hl-47-206><a class=lnlinks href=#hl-47-206>206</a>
</span><span class=lnt id=hl-47-207><a class=lnlinks href=#hl-47-207>207</a>
</span><span class=lnt id=hl-47-208><a class=lnlinks href=#hl-47-208>208</a>
</span><span class=lnt id=hl-47-209><a class=lnlinks href=#hl-47-209>209</a>
</span><span class=lnt id=hl-47-210><a class=lnlinks href=#hl-47-210>210</a>
</span><span class=lnt id=hl-47-211><a class=lnlinks href=#hl-47-211>211</a>
</span><span class=lnt id=hl-47-212><a class=lnlinks href=#hl-47-212>212</a>
</span><span class=lnt id=hl-47-213><a class=lnlinks href=#hl-47-213>213</a>
</span><span class=lnt id=hl-47-214><a class=lnlinks href=#hl-47-214>214</a>
</span><span class=lnt id=hl-47-215><a class=lnlinks href=#hl-47-215>215</a>
</span><span class=lnt id=hl-47-216><a class=lnlinks href=#hl-47-216>216</a>
</span><span class=lnt id=hl-47-217><a class=lnlinks href=#hl-47-217>217</a>
</span><span class=lnt id=hl-47-218><a class=lnlinks href=#hl-47-218>218</a>
</span><span class=lnt id=hl-47-219><a class=lnlinks href=#hl-47-219>219</a>
</span><span class=lnt id=hl-47-220><a class=lnlinks href=#hl-47-220>220</a>
</span><span class=lnt id=hl-47-221><a class=lnlinks href=#hl-47-221>221</a>
</span><span class=lnt id=hl-47-222><a class=lnlinks href=#hl-47-222>222</a>
</span><span class=lnt id=hl-47-223><a class=lnlinks href=#hl-47-223>223</a>
</span><span class=lnt id=hl-47-224><a class=lnlinks href=#hl-47-224>224</a>
</span><span class=lnt id=hl-47-225><a class=lnlinks href=#hl-47-225>225</a>
</span><span class=lnt id=hl-47-226><a class=lnlinks href=#hl-47-226>226</a>
</span><span class=lnt id=hl-47-227><a class=lnlinks href=#hl-47-227>227</a>
</span><span class=lnt id=hl-47-228><a class=lnlinks href=#hl-47-228>228</a>
</span><span class=lnt id=hl-47-229><a class=lnlinks href=#hl-47-229>229</a>
</span><span class=lnt id=hl-47-230><a class=lnlinks href=#hl-47-230>230</a>
</span><span class=lnt id=hl-47-231><a class=lnlinks href=#hl-47-231>231</a>
</span><span class=lnt id=hl-47-232><a class=lnlinks href=#hl-47-232>232</a>
</span><span class=lnt id=hl-47-233><a class=lnlinks href=#hl-47-233>233</a>
</span><span class=lnt id=hl-47-234><a class=lnlinks href=#hl-47-234>234</a>
</span><span class=lnt id=hl-47-235><a class=lnlinks href=#hl-47-235>235</a>
</span><span class=lnt id=hl-47-236><a class=lnlinks href=#hl-47-236>236</a>
</span><span class=lnt id=hl-47-237><a class=lnlinks href=#hl-47-237>237</a>
</span><span class=lnt id=hl-47-238><a class=lnlinks href=#hl-47-238>238</a>
</span><span class=lnt id=hl-47-239><a class=lnlinks href=#hl-47-239>239</a>
</span><span class=lnt id=hl-47-240><a class=lnlinks href=#hl-47-240>240</a>
</span><span class=lnt id=hl-47-241><a class=lnlinks href=#hl-47-241>241</a>
</span><span class=lnt id=hl-47-242><a class=lnlinks href=#hl-47-242>242</a>
</span><span class=lnt id=hl-47-243><a class=lnlinks href=#hl-47-243>243</a>
</span><span class=lnt id=hl-47-244><a class=lnlinks href=#hl-47-244>244</a>
</span><span class=lnt id=hl-47-245><a class=lnlinks href=#hl-47-245>245</a>
</span><span class=lnt id=hl-47-246><a class=lnlinks href=#hl-47-246>246</a>
</span><span class=lnt id=hl-47-247><a class=lnlinks href=#hl-47-247>247</a>
</span><span class=lnt id=hl-47-248><a class=lnlinks href=#hl-47-248>248</a>
</span><span class=lnt id=hl-47-249><a class=lnlinks href=#hl-47-249>249</a>
</span><span class=lnt id=hl-47-250><a class=lnlinks href=#hl-47-250>250</a>
</span><span class=lnt id=hl-47-251><a class=lnlinks href=#hl-47-251>251</a>
</span><span class=lnt id=hl-47-252><a class=lnlinks href=#hl-47-252>252</a>
</span><span class=lnt id=hl-47-253><a class=lnlinks href=#hl-47-253>253</a>
</span><span class=lnt id=hl-47-254><a class=lnlinks href=#hl-47-254>254</a>
</span><span class=lnt id=hl-47-255><a class=lnlinks href=#hl-47-255>255</a>
</span><span class=lnt id=hl-47-256><a class=lnlinks href=#hl-47-256>256</a>
</span><span class=lnt id=hl-47-257><a class=lnlinks href=#hl-47-257>257</a>
</span><span class=lnt id=hl-47-258><a class=lnlinks href=#hl-47-258>258</a>
</span><span class=lnt id=hl-47-259><a class=lnlinks href=#hl-47-259>259</a>
</span><span class=lnt id=hl-47-260><a class=lnlinks href=#hl-47-260>260</a>
</span><span class=lnt id=hl-47-261><a class=lnlinks href=#hl-47-261>261</a>
</span><span class=lnt id=hl-47-262><a class=lnlinks href=#hl-47-262>262</a>
</span><span class=lnt id=hl-47-263><a class=lnlinks href=#hl-47-263>263</a>
</span><span class=lnt id=hl-47-264><a class=lnlinks href=#hl-47-264>264</a>
</span><span class=lnt id=hl-47-265><a class=lnlinks href=#hl-47-265>265</a>
</span><span class=lnt id=hl-47-266><a class=lnlinks href=#hl-47-266>266</a>
</span><span class=lnt id=hl-47-267><a class=lnlinks href=#hl-47-267>267</a>
</span><span class=lnt id=hl-47-268><a class=lnlinks href=#hl-47-268>268</a>
</span><span class=lnt id=hl-47-269><a class=lnlinks href=#hl-47-269>269</a>
</span><span class=lnt id=hl-47-270><a class=lnlinks href=#hl-47-270>270</a>
</span><span class=lnt id=hl-47-271><a class=lnlinks href=#hl-47-271>271</a>
</span><span class=lnt id=hl-47-272><a class=lnlinks href=#hl-47-272>272</a>
</span><span class=lnt id=hl-47-273><a class=lnlinks href=#hl-47-273>273</a>
</span><span class=lnt id=hl-47-274><a class=lnlinks href=#hl-47-274>274</a>
</span><span class=lnt id=hl-47-275><a class=lnlinks href=#hl-47-275>275</a>
</span><span class=lnt id=hl-47-276><a class=lnlinks href=#hl-47-276>276</a>
</span><span class=lnt id=hl-47-277><a class=lnlinks href=#hl-47-277>277</a>
</span><span class=lnt id=hl-47-278><a class=lnlinks href=#hl-47-278>278</a>
</span><span class=lnt id=hl-47-279><a class=lnlinks href=#hl-47-279>279</a>
</span><span class=lnt id=hl-47-280><a class=lnlinks href=#hl-47-280>280</a>
</span><span class=lnt id=hl-47-281><a class=lnlinks href=#hl-47-281>281</a>
</span><span class=lnt id=hl-47-282><a class=lnlinks href=#hl-47-282>282</a>
</span><span class=lnt id=hl-47-283><a class=lnlinks href=#hl-47-283>283</a>
</span><span class=lnt id=hl-47-284><a class=lnlinks href=#hl-47-284>284</a>
</span><span class=lnt id=hl-47-285><a class=lnlinks href=#hl-47-285>285</a>
</span><span class=lnt id=hl-47-286><a class=lnlinks href=#hl-47-286>286</a>
</span><span class=lnt id=hl-47-287><a class=lnlinks href=#hl-47-287>287</a>
</span><span class=lnt id=hl-47-288><a class=lnlinks href=#hl-47-288>288</a>
</span><span class=lnt id=hl-47-289><a class=lnlinks href=#hl-47-289>289</a>
</span><span class=lnt id=hl-47-290><a class=lnlinks href=#hl-47-290>290</a>
</span><span class=lnt id=hl-47-291><a class=lnlinks href=#hl-47-291>291</a>
</span><span class=lnt id=hl-47-292><a class=lnlinks href=#hl-47-292>292</a>
</span><span class=lnt id=hl-47-293><a class=lnlinks href=#hl-47-293>293</a>
</span><span class=lnt id=hl-47-294><a class=lnlinks href=#hl-47-294>294</a>
</span><span class=lnt id=hl-47-295><a class=lnlinks href=#hl-47-295>295</a>
</span><span class=lnt id=hl-47-296><a class=lnlinks href=#hl-47-296>296</a>
</span><span class=lnt id=hl-47-297><a class=lnlinks href=#hl-47-297>297</a>
</span><span class=lnt id=hl-47-298><a class=lnlinks href=#hl-47-298>298</a>
</span><span class=lnt id=hl-47-299><a class=lnlinks href=#hl-47-299>299</a>
</span><span class=lnt id=hl-47-300><a class=lnlinks href=#hl-47-300>300</a>
</span><span class=lnt id=hl-47-301><a class=lnlinks href=#hl-47-301>301</a>
</span><span class=lnt id=hl-47-302><a class=lnlinks href=#hl-47-302>302</a>
</span><span class=lnt id=hl-47-303><a class=lnlinks href=#hl-47-303>303</a>
</span><span class=lnt id=hl-47-304><a class=lnlinks href=#hl-47-304>304</a>
</span><span class=lnt id=hl-47-305><a class=lnlinks href=#hl-47-305>305</a>
</span><span class=lnt id=hl-47-306><a class=lnlinks href=#hl-47-306>306</a>
</span><span class=lnt id=hl-47-307><a class=lnlinks href=#hl-47-307>307</a>
</span><span class=lnt id=hl-47-308><a class=lnlinks href=#hl-47-308>308</a>
</span><span class=lnt id=hl-47-309><a class=lnlinks href=#hl-47-309>309</a>
</span><span class=lnt id=hl-47-310><a class=lnlinks href=#hl-47-310>310</a>
</span><span class=lnt id=hl-47-311><a class=lnlinks href=#hl-47-311>311</a>
</span><span class=lnt id=hl-47-312><a class=lnlinks href=#hl-47-312>312</a>
</span><span class=lnt id=hl-47-313><a class=lnlinks href=#hl-47-313>313</a>
</span><span class=lnt id=hl-47-314><a class=lnlinks href=#hl-47-314>314</a>
</span><span class=lnt id=hl-47-315><a class=lnlinks href=#hl-47-315>315</a>
</span><span class=lnt id=hl-47-316><a class=lnlinks href=#hl-47-316>316</a>
</span><span class=lnt id=hl-47-317><a class=lnlinks href=#hl-47-317>317</a>
</span><span class=lnt id=hl-47-318><a class=lnlinks href=#hl-47-318>318</a>
</span><span class=lnt id=hl-47-319><a class=lnlinks href=#hl-47-319>319</a>
</span><span class=lnt id=hl-47-320><a class=lnlinks href=#hl-47-320>320</a>
</span><span class=lnt id=hl-47-321><a class=lnlinks href=#hl-47-321>321</a>
</span><span class=lnt id=hl-47-322><a class=lnlinks href=#hl-47-322>322</a>
</span><span class=lnt id=hl-47-323><a class=lnlinks href=#hl-47-323>323</a>
</span><span class=lnt id=hl-47-324><a class=lnlinks href=#hl-47-324>324</a>
</span><span class=lnt id=hl-47-325><a class=lnlinks href=#hl-47-325>325</a>
</span><span class=lnt id=hl-47-326><a class=lnlinks href=#hl-47-326>326</a>
</span><span class=lnt id=hl-47-327><a class=lnlinks href=#hl-47-327>327</a>
</span><span class=lnt id=hl-47-328><a class=lnlinks href=#hl-47-328>328</a>
</span><span class=lnt id=hl-47-329><a class=lnlinks href=#hl-47-329>329</a>
</span><span class=lnt id=hl-47-330><a class=lnlinks href=#hl-47-330>330</a>
</span><span class=lnt id=hl-47-331><a class=lnlinks href=#hl-47-331>331</a>
</span><span class=lnt id=hl-47-332><a class=lnlinks href=#hl-47-332>332</a>
</span><span class=lnt id=hl-47-333><a class=lnlinks href=#hl-47-333>333</a>
</span><span class=lnt id=hl-47-334><a class=lnlinks href=#hl-47-334>334</a>
</span><span class=lnt id=hl-47-335><a class=lnlinks href=#hl-47-335>335</a>
</span><span class=lnt id=hl-47-336><a class=lnlinks href=#hl-47-336>336</a>
</span><span class=lnt id=hl-47-337><a class=lnlinks href=#hl-47-337>337</a>
</span><span class=lnt id=hl-47-338><a class=lnlinks href=#hl-47-338>338</a>
</span><span class=lnt id=hl-47-339><a class=lnlinks href=#hl-47-339>339</a>
</span><span class=lnt id=hl-47-340><a class=lnlinks href=#hl-47-340>340</a>
</span><span class=lnt id=hl-47-341><a class=lnlinks href=#hl-47-341>341</a>
</span><span class=lnt id=hl-47-342><a class=lnlinks href=#hl-47-342>342</a>
</span><span class=lnt id=hl-47-343><a class=lnlinks href=#hl-47-343>343</a>
</span><span class=lnt id=hl-47-344><a class=lnlinks href=#hl-47-344>344</a>
</span><span class=lnt id=hl-47-345><a class=lnlinks href=#hl-47-345>345</a>
</span><span class=lnt id=hl-47-346><a class=lnlinks href=#hl-47-346>346</a>
</span><span class=lnt id=hl-47-347><a class=lnlinks href=#hl-47-347>347</a>
</span><span class=lnt id=hl-47-348><a class=lnlinks href=#hl-47-348>348</a>
</span><span class=lnt id=hl-47-349><a class=lnlinks href=#hl-47-349>349</a>
</span><span class=lnt id=hl-47-350><a class=lnlinks href=#hl-47-350>350</a>
</span><span class=lnt id=hl-47-351><a class=lnlinks href=#hl-47-351>351</a>
</span><span class=lnt id=hl-47-352><a class=lnlinks href=#hl-47-352>352</a>
</span><span class=lnt id=hl-47-353><a class=lnlinks href=#hl-47-353>353</a>
</span><span class=lnt id=hl-47-354><a class=lnlinks href=#hl-47-354>354</a>
</span><span class=lnt id=hl-47-355><a class=lnlinks href=#hl-47-355>355</a>
</span><span class=lnt id=hl-47-356><a class=lnlinks href=#hl-47-356>356</a>
</span><span class=lnt id=hl-47-357><a class=lnlinks href=#hl-47-357>357</a>
</span><span class=lnt id=hl-47-358><a class=lnlinks href=#hl-47-358>358</a>
</span><span class=lnt id=hl-47-359><a class=lnlinks href=#hl-47-359>359</a>
</span><span class=lnt id=hl-47-360><a class=lnlinks href=#hl-47-360>360</a>
</span><span class=lnt id=hl-47-361><a class=lnlinks href=#hl-47-361>361</a>
</span><span class=lnt id=hl-47-362><a class=lnlinks href=#hl-47-362>362</a>
</span><span class=lnt id=hl-47-363><a class=lnlinks href=#hl-47-363>363</a>
</span><span class=lnt id=hl-47-364><a class=lnlinks href=#hl-47-364>364</a>
</span><span class=lnt id=hl-47-365><a class=lnlinks href=#hl-47-365>365</a>
</span><span class=lnt id=hl-47-366><a class=lnlinks href=#hl-47-366>366</a>
</span><span class=lnt id=hl-47-367><a class=lnlinks href=#hl-47-367>367</a>
</span><span class=lnt id=hl-47-368><a class=lnlinks href=#hl-47-368>368</a>
</span><span class=lnt id=hl-47-369><a class=lnlinks href=#hl-47-369>369</a>
</span><span class=lnt id=hl-47-370><a class=lnlinks href=#hl-47-370>370</a>
</span><span class=lnt id=hl-47-371><a class=lnlinks href=#hl-47-371>371</a>
</span><span class=lnt id=hl-47-372><a class=lnlinks href=#hl-47-372>372</a>
</span><span class=lnt id=hl-47-373><a class=lnlinks href=#hl-47-373>373</a>
</span><span class=lnt id=hl-47-374><a class=lnlinks href=#hl-47-374>374</a>
</span><span class=lnt id=hl-47-375><a class=lnlinks href=#hl-47-375>375</a>
</span><span class=lnt id=hl-47-376><a class=lnlinks href=#hl-47-376>376</a>
</span><span class=lnt id=hl-47-377><a class=lnlinks href=#hl-47-377>377</a>
</span><span class=lnt id=hl-47-378><a class=lnlinks href=#hl-47-378>378</a>
</span><span class=lnt id=hl-47-379><a class=lnlinks href=#hl-47-379>379</a>
</span><span class=lnt id=hl-47-380><a class=lnlinks href=#hl-47-380>380</a>
</span><span class=lnt id=hl-47-381><a class=lnlinks href=#hl-47-381>381</a>
</span><span class=lnt id=hl-47-382><a class=lnlinks href=#hl-47-382>382</a>
</span><span class=lnt id=hl-47-383><a class=lnlinks href=#hl-47-383>383</a>
</span><span class=lnt id=hl-47-384><a class=lnlinks href=#hl-47-384>384</a>
</span><span class=lnt id=hl-47-385><a class=lnlinks href=#hl-47-385>385</a>
</span><span class=lnt id=hl-47-386><a class=lnlinks href=#hl-47-386>386</a>
</span><span class=lnt id=hl-47-387><a class=lnlinks href=#hl-47-387>387</a>
</span><span class=lnt id=hl-47-388><a class=lnlinks href=#hl-47-388>388</a>
</span><span class=lnt id=hl-47-389><a class=lnlinks href=#hl-47-389>389</a>
</span><span class=lnt id=hl-47-390><a class=lnlinks href=#hl-47-390>390</a>
</span><span class=lnt id=hl-47-391><a class=lnlinks href=#hl-47-391>391</a>
</span><span class=lnt id=hl-47-392><a class=lnlinks href=#hl-47-392>392</a>
</span><span class=lnt id=hl-47-393><a class=lnlinks href=#hl-47-393>393</a>
</span><span class=lnt id=hl-47-394><a class=lnlinks href=#hl-47-394>394</a>
</span><span class=lnt id=hl-47-395><a class=lnlinks href=#hl-47-395>395</a>
</span><span class=lnt id=hl-47-396><a class=lnlinks href=#hl-47-396>396</a>
</span><span class=lnt id=hl-47-397><a class=lnlinks href=#hl-47-397>397</a>
</span><span class=lnt id=hl-47-398><a class=lnlinks href=#hl-47-398>398</a>
</span><span class=lnt id=hl-47-399><a class=lnlinks href=#hl-47-399>399</a>
</span><span class=lnt id=hl-47-400><a class=lnlinks href=#hl-47-400>400</a>
</span><span class=lnt id=hl-47-401><a class=lnlinks href=#hl-47-401>401</a>
</span><span class=lnt id=hl-47-402><a class=lnlinks href=#hl-47-402>402</a>
</span><span class=lnt id=hl-47-403><a class=lnlinks href=#hl-47-403>403</a>
</span><span class=lnt id=hl-47-404><a class=lnlinks href=#hl-47-404>404</a>
</span><span class=lnt id=hl-47-405><a class=lnlinks href=#hl-47-405>405</a>
</span><span class=lnt id=hl-47-406><a class=lnlinks href=#hl-47-406>406</a>
</span><span class=lnt id=hl-47-407><a class=lnlinks href=#hl-47-407>407</a>
</span><span class=lnt id=hl-47-408><a class=lnlinks href=#hl-47-408>408</a>
</span><span class=lnt id=hl-47-409><a class=lnlinks href=#hl-47-409>409</a>
</span><span class=lnt id=hl-47-410><a class=lnlinks href=#hl-47-410>410</a>
</span><span class=lnt id=hl-47-411><a class=lnlinks href=#hl-47-411>411</a>
</span><span class=lnt id=hl-47-412><a class=lnlinks href=#hl-47-412>412</a>
</span><span class=lnt id=hl-47-413><a class=lnlinks href=#hl-47-413>413</a>
</span><span class=lnt id=hl-47-414><a class=lnlinks href=#hl-47-414>414</a>
</span><span class=lnt id=hl-47-415><a class=lnlinks href=#hl-47-415>415</a>
</span><span class=lnt id=hl-47-416><a class=lnlinks href=#hl-47-416>416</a>
</span><span class=lnt id=hl-47-417><a class=lnlinks href=#hl-47-417>417</a>
</span><span class=lnt id=hl-47-418><a class=lnlinks href=#hl-47-418>418</a>
</span><span class=lnt id=hl-47-419><a class=lnlinks href=#hl-47-419>419</a>
</span><span class=lnt id=hl-47-420><a class=lnlinks href=#hl-47-420>420</a>
</span><span class=lnt id=hl-47-421><a class=lnlinks href=#hl-47-421>421</a>
</span><span class=lnt id=hl-47-422><a class=lnlinks href=#hl-47-422>422</a>
</span><span class=lnt id=hl-47-423><a class=lnlinks href=#hl-47-423>423</a>
</span><span class=lnt id=hl-47-424><a class=lnlinks href=#hl-47-424>424</a>
</span><span class=lnt id=hl-47-425><a class=lnlinks href=#hl-47-425>425</a>
</span><span class=lnt id=hl-47-426><a class=lnlinks href=#hl-47-426>426</a>
</span><span class=lnt id=hl-47-427><a class=lnlinks href=#hl-47-427>427</a>
</span><span class=lnt id=hl-47-428><a class=lnlinks href=#hl-47-428>428</a>
</span><span class=lnt id=hl-47-429><a class=lnlinks href=#hl-47-429>429</a>
</span><span class=lnt id=hl-47-430><a class=lnlinks href=#hl-47-430>430</a>
</span><span class=lnt id=hl-47-431><a class=lnlinks href=#hl-47-431>431</a>
</span><span class=lnt id=hl-47-432><a class=lnlinks href=#hl-47-432>432</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// C#을 사용한 명령 및 이벤트 기반 아키텍처 예시</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Collections.Generic</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Threading.Tasks</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.Extensions.DependencyInjection</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.Extensions.Hosting</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.Extensions.Logging</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>RabbitMQ.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>RabbitMQ.Client.Events</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Newtonsoft.Json</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 인터페이스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ICommand</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Guid</span> <span class=n>Id</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>CommandType</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>DateTime</span> <span class=n>Timestamp</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 인터페이스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>IEvent</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Guid</span> <span class=n>Id</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>EventType</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>DateTime</span> <span class=n>Timestamp</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>Guid</span><span class=p>?</span> <span class=n>CorrelationId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 핸들러 인터페이스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ICommandHandler</span><span class=p>&lt;</span><span class=n>TCommand</span><span class=p>&gt;</span> <span class=k>where</span> <span class=n>TCommand</span> <span class=p>:</span> <span class=n>ICommand</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Task</span><span class=p>&lt;</span><span class=n>List</span><span class=p>&lt;</span><span class=n>IEvent</span><span class=p>&gt;&gt;</span> <span class=n>HandleAsync</span><span class=p>(</span><span class=n>TCommand</span> <span class=n>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 핸들러 인터페이스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>IEventHandler</span><span class=p>&lt;</span><span class=n>TEvent</span><span class=p>&gt;</span> <span class=k>where</span> <span class=n>TEvent</span> <span class=p>:</span> <span class=n>IEvent</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Task</span> <span class=n>HandleAsync</span><span class=p>(</span><span class=n>TEvent</span> <span class=n>@event</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 버스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CommandBus</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IConnection</span> <span class=n>_connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IModel</span> <span class=n>_channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CommandBus</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_exchangeName</span> <span class=p>=</span> <span class=s>&#34;commands&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CommandBus</span><span class=p>(</span><span class=n>IConnection</span> <span class=n>connection</span><span class=p>,</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CommandBus</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_connection</span> <span class=p>=</span> <span class=n>connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span> <span class=p>=</span> <span class=n>connection</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 명령 교환기 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>ExchangeDeclare</span><span class=p>(</span><span class=n>_exchangeName</span><span class=p>,</span> <span class=n>ExchangeType</span><span class=p>.</span><span class=n>Direct</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>SendAsync</span><span class=p>&lt;</span><span class=n>TCommand</span><span class=p>&gt;(</span><span class=n>TCommand</span> <span class=n>command</span><span class=p>)</span> <span class=k>where</span> <span class=n>TCommand</span> <span class=p>:</span> <span class=n>ICommand</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>commandType</span> <span class=p>=</span> <span class=n>command</span><span class=p>.</span><span class=n>GetType</span><span class=p>().</span><span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>routingKey</span> <span class=p>=</span> <span class=n>commandType</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 명령 직렬화</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>message</span> <span class=p>=</span> <span class=n>JsonConvert</span><span class=p>.</span><span class=n>SerializeObject</span><span class=p>(</span><span class=n>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 기본 속성 설정</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>properties</span> <span class=p>=</span> <span class=n>_channel</span><span class=p>.</span><span class=n>CreateBasicProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>MessageId</span> <span class=p>=</span> <span class=n>command</span><span class=p>.</span><span class=n>Id</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Timestamp</span> <span class=p>=</span> <span class=k>new</span> <span class=n>AmqpTimestamp</span><span class=p>(</span><span class=n>DateTimeOffset</span><span class=p>.</span><span class=n>UtcNow</span><span class=p>.</span><span class=n>ToUnixTimeSeconds</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Headers</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Dictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=kt>object</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=s>&#34;command_type&#34;</span><span class=p>,</span> <span class=n>commandType</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Persistent</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 명령 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicPublish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=n>_exchangeName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=n>routingKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>basicProperties</span><span class=p>:</span> <span class=n>properties</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=p>:</span> <span class=n>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;명령 전송됨: {commandType}, ID: {command.Id}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 버스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>EventBus</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IConnection</span> <span class=n>_connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IModel</span> <span class=n>_channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>EventBus</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_exchangeName</span> <span class=p>=</span> <span class=s>&#34;events&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>EventBus</span><span class=p>(</span><span class=n>IConnection</span> <span class=n>connection</span><span class=p>,</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>EventBus</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_connection</span> <span class=p>=</span> <span class=n>connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span> <span class=p>=</span> <span class=n>connection</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 교환기 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>ExchangeDeclare</span><span class=p>(</span><span class=n>_exchangeName</span><span class=p>,</span> <span class=n>ExchangeType</span><span class=p>.</span><span class=n>Topic</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>PublishAsync</span><span class=p>&lt;</span><span class=n>TEvent</span><span class=p>&gt;(</span><span class=n>TEvent</span> <span class=n>@event</span><span class=p>)</span> <span class=k>where</span> <span class=n>TEvent</span> <span class=p>:</span> <span class=n>IEvent</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>eventType</span> <span class=p>=</span> <span class=n>@event</span><span class=p>.</span><span class=n>GetType</span><span class=p>().</span><span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>routingKey</span> <span class=p>=</span> <span class=n>eventType</span><span class=p>.</span><span class=n>Replace</span><span class=p>(</span><span class=s>&#34;Event&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>).</span><span class=n>ToLower</span><span class=p>()</span> <span class=p>+</span> <span class=s>&#34;.happened&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 직렬화</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>message</span> <span class=p>=</span> <span class=n>JsonConvert</span><span class=p>.</span><span class=n>SerializeObject</span><span class=p>(</span><span class=n>@event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 기본 속성 설정</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>properties</span> <span class=p>=</span> <span class=n>_channel</span><span class=p>.</span><span class=n>CreateBasicProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>MessageId</span> <span class=p>=</span> <span class=n>@event</span><span class=p>.</span><span class=n>Id</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>CorrelationId</span> <span class=p>=</span> <span class=n>@event</span><span class=p>.</span><span class=n>CorrelationId</span><span class=p>?.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Timestamp</span> <span class=p>=</span> <span class=k>new</span> <span class=n>AmqpTimestamp</span><span class=p>(</span><span class=n>DateTimeOffset</span><span class=p>.</span><span class=n>UtcNow</span><span class=p>.</span><span class=n>ToUnixTimeSeconds</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Headers</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Dictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=kt>object</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=s>&#34;event_type&#34;</span><span class=p>,</span> <span class=n>eventType</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=n>properties</span><span class=p>.</span><span class=n>Persistent</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicPublish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=n>_exchangeName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=n>routingKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>basicProperties</span><span class=p>:</span> <span class=n>properties</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>body</span><span class=p>:</span> <span class=n>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;이벤트 발행됨: {eventType}, ID: {@event.Id}, 상관관계 ID: {@event.CorrelationId}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Subscribe</span><span class=p>&lt;</span><span class=n>TEvent</span><span class=p>&gt;(</span><span class=kt>string</span> <span class=n>queueName</span><span class=p>,</span> <span class=n>Func</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=n>Task</span><span class=p>&gt;</span> <span class=n>callback</span><span class=p>)</span> <span class=k>where</span> <span class=n>TEvent</span> <span class=p>:</span> <span class=n>IEvent</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>eventType</span> <span class=p>=</span> <span class=k>typeof</span><span class=p>(</span><span class=n>TEvent</span><span class=p>).</span><span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>routingKey</span> <span class=p>=</span> <span class=n>eventType</span><span class=p>.</span><span class=n>Replace</span><span class=p>(</span><span class=s>&#34;Event&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>).</span><span class=n>ToLower</span><span class=p>()</span> <span class=p>+</span> <span class=s>&#34;.happened&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 큐 선언</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 큐를 교환기에 바인딩</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>QueueBind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=n>_exchangeName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=n>routingKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 소비자 설정</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>consumer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>AsyncEventingBasicConsumer</span><span class=p>(</span><span class=n>_channel</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span><span class=p>.</span><span class=n>Received</span> <span class=p>+=</span> <span class=kd>async</span> <span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>ea</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>ea</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>message</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;이벤트 수신됨: {eventType}, 큐: {queueName}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>try</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>callback</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>_channel</span><span class=p>.</span><span class=n>BasicAck</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>DeliveryTag</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>_logger</span><span class=p>.</span><span class=n>LogError</span><span class=p>(</span><span class=n>ex</span><span class=p>,</span> <span class=s>$&#34;이벤트 처리 오류: {eventType}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>_channel</span><span class=p>.</span><span class=n>BasicNack</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>DeliveryTag</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicConsume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoAck</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>consumer</span><span class=p>:</span> <span class=n>consumer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;이벤트 구독 시작: {eventType}, 큐: {queueName}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 명령 프로세서</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CommandProcessor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IServiceProvider</span> <span class=n>_serviceProvider</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CommandProcessor</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>EventBus</span> <span class=n>_eventBus</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IConnection</span> <span class=n>_connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IModel</span> <span class=n>_channel</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_exchangeName</span> <span class=p>=</span> <span class=s>&#34;commands&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CommandProcessor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>IServiceProvider</span> <span class=n>serviceProvider</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>IConnection</span> <span class=n>connection</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>EventBus</span> <span class=n>eventBus</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CommandProcessor</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_serviceProvider</span> <span class=p>=</span> <span class=n>serviceProvider</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_connection</span> <span class=p>=</span> <span class=n>connection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span> <span class=p>=</span> <span class=n>connection</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>_eventBus</span> <span class=p>=</span> <span class=n>eventBus</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 명령 교환기 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>ExchangeDeclare</span><span class=p>(</span><span class=n>_exchangeName</span><span class=p>,</span> <span class=n>ExchangeType</span><span class=p>.</span><span class=n>Direct</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>RegisterHandler</span><span class=p>&lt;</span><span class=n>TCommand</span><span class=p>,</span> <span class=n>THandler</span><span class=p>&gt;(</span><span class=kt>string</span> <span class=n>queueName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>where</span> <span class=n>TCommand</span> <span class=p>:</span> <span class=n>ICommand</span>
</span></span><span class=line><span class=cl>        <span class=k>where</span> <span class=n>THandler</span> <span class=p>:</span> <span class=n>ICommandHandler</span><span class=p>&lt;</span><span class=n>TCommand</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>commandType</span> <span class=p>=</span> <span class=k>typeof</span><span class=p>(</span><span class=n>TCommand</span><span class=p>).</span><span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>routingKey</span> <span class=p>=</span> <span class=n>commandType</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 큐 선언</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 큐를 교환기에 바인딩</span>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>QueueBind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>exchange</span><span class=p>:</span> <span class=n>_exchangeName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>routingKey</span><span class=p>:</span> <span class=n>routingKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 소비자 설정</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>consumer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>AsyncEventingBasicConsumer</span><span class=p>(</span><span class=n>_channel</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span><span class=p>.</span><span class=n>Received</span> <span class=p>+=</span> <span class=kd>async</span> <span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>ea</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>body</span> <span class=p>=</span> <span class=n>ea</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>message</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;명령 수신됨: {commandType}, 큐: {queueName}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>try</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 명령 역직렬화</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>command</span> <span class=p>=</span> <span class=n>JsonConvert</span><span class=p>.</span><span class=n>DeserializeObject</span><span class=p>&lt;</span><span class=n>TCommand</span><span class=p>&gt;(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// 핸들러 인스턴스 생성</span>
</span></span><span class=line><span class=cl>                <span class=k>using</span> <span class=nn>var</span> <span class=n>scope</span> <span class=p>=</span> <span class=n>_serviceProvider</span><span class=p>.</span><span class=n>CreateScope</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>handler</span> <span class=p>=</span> <span class=n>scope</span><span class=p>.</span><span class=n>ServiceProvider</span><span class=p>.</span><span class=n>GetRequiredService</span><span class=p>&lt;</span><span class=n>THandler</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// 명령 처리</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>events</span> <span class=p>=</span> <span class=k>await</span> <span class=n>handler</span><span class=p>.</span><span class=n>HandleAsync</span><span class=p>(</span><span class=n>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// 발생한 이벤트 발행</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>events</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>@event</span> <span class=k>in</span> <span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=n>_eventBus</span><span class=p>.</span><span class=n>PublishAsync</span><span class=p>(</span><span class=n>@event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>_channel</span><span class=p>.</span><span class=n>BasicAck</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>DeliveryTag</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>_logger</span><span class=p>.</span><span class=n>LogError</span><span class=p>(</span><span class=n>ex</span><span class=p>,</span> <span class=s>$&#34;명령 처리 오류: {commandType}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>_channel</span><span class=p>.</span><span class=n>BasicNack</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>DeliveryTag</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_channel</span><span class=p>.</span><span class=n>BasicConsume</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span><span class=p>:</span> <span class=n>queueName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>autoAck</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>consumer</span><span class=p>:</span> <span class=n>consumer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;명령 핸들러 등록됨: {commandType}, 큐: {queueName}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 구체적인 명령 및 핸들러 구현 예시</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CreateOrderCommand</span> <span class=p>:</span> <span class=n>ICommand</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>Id</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=n>Guid</span><span class=p>.</span><span class=n>NewGuid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>CommandType</span> <span class=p>=&gt;</span> <span class=n>nameof</span><span class=p>(</span><span class=n>CreateOrderCommand</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>DateTime</span> <span class=n>Timestamp</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>UtcNow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>CustomerId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>OrderItem</span><span class=p>&gt;</span> <span class=n>Items</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>ShippingAddress</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderItem</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>ProductId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=n>Quantity</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>decimal</span> <span class=n>Price</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderCreatedEvent</span> <span class=p>:</span> <span class=n>IEvent</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>Id</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=n>Guid</span><span class=p>.</span><span class=n>NewGuid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>EventType</span> <span class=p>=&gt;</span> <span class=n>nameof</span><span class=p>(</span><span class=n>OrderCreatedEvent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>DateTime</span> <span class=n>Timestamp</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>UtcNow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span><span class=p>?</span> <span class=n>CorrelationId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>OrderId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Guid</span> <span class=n>CustomerId</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>decimal</span> <span class=n>TotalAmount</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>OrderStatus</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CreateOrderHandler</span> <span class=p>:</span> <span class=n>ICommandHandler</span><span class=p>&lt;</span><span class=n>CreateOrderCommand</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CreateOrderHandler</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 실제 구현에서는 DB 저장소 등 주입</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CreateOrderHandler</span><span class=p>(</span><span class=n>ILogger</span><span class=p>&lt;</span><span class=n>CreateOrderHandler</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=n>List</span><span class=p>&lt;</span><span class=n>IEvent</span><span class=p>&gt;&gt;</span> <span class=n>HandleAsync</span><span class=p>(</span><span class=n>CreateOrderCommand</span> <span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;주문 생성 처리 중: {command.Id}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 비즈니스 로직 수행</span>
</span></span><span class=line><span class=cl>        <span class=c1>// - 재고 확인</span>
</span></span><span class=line><span class=cl>        <span class=c1>// - 주문 유효성 검증</span>
</span></span><span class=line><span class=cl>        <span class=c1>// - DB에 주문 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>Delay</span><span class=p>(</span><span class=m>100</span><span class=p>);</span> <span class=c1>// DB 작업 시뮬레이션</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 ID 생성</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>orderId</span> <span class=p>=</span> <span class=n>Guid</span><span class=p>.</span><span class=n>NewGuid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 총액 계산</span>
</span></span><span class=line><span class=cl>        <span class=kt>decimal</span> <span class=n>totalAmount</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>item</span> <span class=k>in</span> <span class=n>command</span><span class=p>.</span><span class=n>Items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>totalAmount</span> <span class=p>+=</span> <span class=n>item</span><span class=p>.</span><span class=n>Price</span> <span class=p>*</span> <span class=n>item</span><span class=p>.</span><span class=n>Quantity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 생성 이벤트 반환</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>orderCreatedEvent</span> <span class=p>=</span> <span class=k>new</span> <span class=n>OrderCreatedEvent</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>CorrelationId</span> <span class=p>=</span> <span class=n>command</span><span class=p>.</span><span class=n>Id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderId</span> <span class=p>=</span> <span class=n>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>CustomerId</span> <span class=p>=</span> <span class=n>command</span><span class=p>.</span><span class=n>CustomerId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>TotalAmount</span> <span class=p>=</span> <span class=n>totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>OrderStatus</span> <span class=p>=</span> <span class=s>&#34;Created&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>IEvent</span><span class=p>&gt;</span> <span class=p>{</span> <span class=n>orderCreatedEvent</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 애플리케이션 설정</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>host</span> <span class=p>=</span> <span class=n>CreateHostBuilder</span><span class=p>(</span><span class=n>args</span><span class=p>).</span><span class=n>Build</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 서비스 시작</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>host</span><span class=p>.</span><span class=n>RunAsync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IHostBuilder</span> <span class=n>CreateHostBuilder</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>ConfigureServices</span><span class=p>((</span><span class=n>hostContext</span><span class=p>,</span> <span class=n>services</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// RabbitMQ 연결 설정</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>factory</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ConnectionFactory</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>HostName</span> <span class=p>=</span> <span class=s>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>UserName</span> <span class=p>=</span> <span class=s>&#34;guest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>Password</span> <span class=p>=</span> <span class=s>&#34;guest&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>};</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>connection</span> <span class=p>=</span> <span class=n>factory</span><span class=p>.</span><span class=n>CreateConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>(</span><span class=n>connection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>&lt;</span><span class=n>CommandBus</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>&lt;</span><span class=n>EventBus</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>&lt;</span><span class=n>CommandProcessor</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// 명령 핸들러 등록</span>
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddTransient</span><span class=p>&lt;</span><span class=n>CreateOrderHandler</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// 백그라운드 서비스 등록</span>
</span></span><span class=line><span class=cl>                <span class=n>services</span><span class=p>.</span><span class=n>AddHostedService</span><span class=p>&lt;</span><span class=n>OrderProcessingService</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 백그라운드 서비스</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>OrderProcessingService</span> <span class=p>:</span> <span class=n>BackgroundService</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>OrderProcessingService</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>CommandProcessor</span> <span class=n>_commandProcessor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>EventBus</span> <span class=n>_eventBus</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>OrderProcessingService</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>OrderProcessingService</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>CommandProcessor</span> <span class=n>commandProcessor</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>EventBus</span> <span class=n>eventBus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_commandProcessor</span> <span class=p>=</span> <span class=n>commandProcessor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_eventBus</span> <span class=p>=</span> <span class=n>eventBus</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kd>override</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>ExecuteAsync</span><span class=p>(</span><span class=n>CancellationToken</span> <span class=n>stoppingToken</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>&#34;주문 처리 서비스 시작&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 명령 핸들러 등록</span>
</span></span><span class=line><span class=cl>        <span class=n>_commandProcessor</span><span class=p>.</span><span class=n>RegisterHandler</span><span class=p>&lt;</span><span class=n>CreateOrderCommand</span><span class=p>,</span> <span class=n>CreateOrderHandler</span><span class=p>&gt;(</span><span class=s>&#34;create-order-queue&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 구독</span>
</span></span><span class=line><span class=cl>        <span class=n>_eventBus</span><span class=p>.</span><span class=n>Subscribe</span><span class=p>&lt;</span><span class=n>OrderCreatedEvent</span><span class=p>&gt;(</span><span class=s>&#34;order-notification-queue&#34;</span><span class=p>,</span> <span class=kd>async</span> <span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>@event</span> <span class=p>=</span> <span class=n>JsonConvert</span><span class=p>.</span><span class=n>DeserializeObject</span><span class=p>&lt;</span><span class=n>OrderCreatedEvent</span><span class=p>&gt;(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;주문 생성 이벤트 처리: {@event.OrderId}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 알림 발송 등의 로직 처리</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>Delay</span><span class=p>(</span><span class=m>50</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>_logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>$&#34;주문 알림 발송 완료: {@event.OrderId}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 서비스 종료까지 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>Delay</span><span class=p>(</span><span class=n>Timeout</span><span class=p>.</span><span class=n>Infinite</span><span class=p>,</span> <span class=n>stoppingToken</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=메시징-큐-설계-및-구현-지침>메시징 큐 설계 및 구현 지침<a hidden class=anchor aria-hidden=true href=#메시징-큐-설계-및-구현-지침>#</a></h3><p>효율적이고 안정적인 메시징 시스템을 구축하기 위한 주요 설계 및 구현 지침</p><ol><li>메시지 설계 원칙<br>메시지는 시스템 간의 통신 단위이므로 명확하고 일관된 설계가 중요하다.<ol><li><strong>자기 완결성(Self-contained)</strong>: 메시지는 필요한 모든 정보를 포함해야 한다.</li><li><strong>스키마 버전 관리</strong>: 메시지 구조 변경에 대비한 버전 관리 전략이 필요하다.</li><li><strong>적절한 크기</strong>: 너무 크거나 작은 메시지는 성능에 영향을 미친다.</li><li><strong>표준화된 형식</strong>: JSON, Avro, Protocol Buffers 등 표준 형식을 사용한다.</li><li><strong>메타데이터 포함</strong>: 메시지 ID, 타임스탬프, 추적 정보 등을 포함한다.</li></ol></li><li>큐 구조 설계<br>큐의 구조와 관계는 메시징 시스템의 성능과 확장성에 직접적인 영향을 미친다.<ol><li><strong>목적별 큐 분리</strong>: 각 비즈니스 기능이나 처리 유형에 따라, 그리고 중요도나 우선순위에 따라 큐를 분리한다.</li><li><strong>큐 크기 제한</strong>: 무제한 큐는 메모리 문제를 일으킬 수 있으므로 적절한 제한이 필요하다.</li><li><strong>데드 레터 큐 구성</strong>: 처리 실패한 메시지를 저장하고 분석할 수 있는 별도의 큐를 마련한다.</li><li><strong>지연 큐 활용</strong>: 특정 시간 후에 처리해야 하는 메시지를 위한 지연 큐를 구성한다.</li><li><strong>우선순위 큐 고려</strong>: 중요도에 따라 메시지 처리 순서를 조정할 수 있는 우선순위 큐를 활용한다.</li></ol></li><li>오류 처리 및 복원력 전략<br>장애 상황에서도 데이터 손실 없이 안정적으로 작동하는 메시징 시스템을 구축하기 위한 전략이다.<ol><li><strong>자동 재시도</strong>: 일시적인 오류에 대응하기 위한 자동 재시도 메커니즘을 구현한다.</li><li><strong>지수 백오프(Exponential Backoff)</strong>: 반복적인 실패 시 재시도 간격을 점진적으로 늘린다.</li><li><strong>서킷 브레이커 패턴</strong>: 다운스트림 서비스 장애 시 요청을 차단하여 시스템을 보호한다.</li><li><strong>멱등성 보장</strong>: 중복 메시지 처리가 안전하도록 멱등성을 구현한다.</li><li><strong>부분 실패 처리</strong>: 배치 처리 시 일부 실패에 대한 대응 전략을 마련한다.</li></ol></li><li>확장성 고려사항<br>증가하는 부하에 대응할 수 있는 확장 가능한 메시징 시스템을 설계하기 위한 고려사항이다.<ol><li><strong>수평적 확장</strong>: 소비자 그룹을 통해 처리량을 향상시킨다.</li><li><strong>메시지 파티셔닝</strong>: 관련 메시지가 동일한 소비자에게 전달되도록 파티셔닝한다.</li><li><strong>비동기 처리</strong>: 소비자의 처리 시간이 생산자에게 영향을 미치지 않도록 한다.</li><li><strong>부하 분산</strong>: 여러 브로커와 큐에 부하를 분산시킨다.</li><li><strong>클러스터링</strong>: 고가용성을 위한 브로커 클러스터를 구성한다.</li></ol></li><li>모니터링 및 운영 최적화<br>효과적인 운영을 위한 모니터링 및 관리 전략이다.<ol><li><strong>주요 지표 추적</strong>: 큐 깊이, 처리율, 오류율 등의 핵심 지표를 모니터링한다.</li><li><strong>경보 설정</strong>: 문제 상황에 대한 조기 경보 시스템을 구축한다.</li><li><strong>로깅 전략</strong>: 디버깅과 분석을 위한 효과적인 로깅을 구현한다.</li><li><strong>성능 최적화</strong>: 배치 처리, 메시지 압축, 소비자 수 조정 등을 통해 성능을 최적화한다.</li><li><strong>자동화된 운영</strong>: 자동 확장, 자가 복구 등의 자동화 기능을 구현한다.</li></ol></li></ol><h3 id=메시징-큐-도입-시-고려사항>메시징 큐 도입 시 고려사항<a hidden class=anchor aria-hidden=true href=#메시징-큐-도입-시-고려사항>#</a></h3><p>메시징 큐 도입을 고려할 때 평가해야 할 주요 사항과 권장 사항이다.</p><ol><li>적합성 평가<br>모든 상황에 메시징 큐가 최적의 솔루션은 아니다. 다음 상황에서 메시징 큐 도입을 고려해야 한다.<ol><li><strong>비동기 처리가 필요한 경우</strong>: 즉각적인 응답이 불필요한 작업</li><li><strong>부하 분산이 필요한 경우</strong>: 트래픽 스파이크 처리</li><li><strong>시스템 간 느슨한 결합이 필요한 경우</strong>: 독립적인 서비스 운영</li><li><strong>내구성 있는 통신이 필요한 경우</strong>: 메시지 손실 방지</li><li><strong>처리 속도 차이가 있는 경우</strong>: 생산자와 소비자 간 속도 불일치</li></ol></li><li>기술 선택 기준<br>메시징 솔루션 선택 시 고려해야 할 주요 기준이다.<ol><li><strong>처리량 요구사항</strong>: 초당 처리해야 하는 메시지 수</li><li><strong>지연 시간 요구사항</strong>: 허용 가능한 메시지 전달 및 처리 지연</li><li><strong>내구성 요구사항</strong>: 메시지 손실 허용 정도</li><li><strong>전달 보장</strong>: At-most-once, At-least-once, Exactly-once 중 필요한 수준</li><li><strong>확장성 요구사항</strong>: 향후 예상되는 성장과 확장 니즈</li><li><strong>운영 복잡성</strong>: 관리 및 모니터링의 용이성</li><li><strong>비용 및 리소스</strong>: 라이선스, 인프라, 유지보수 비용</li></ol></li><li>구현 및 통합 권장사항<br>효과적인 메시징 큐 구현 및 통합을 위한 실용적인 권장사항이다.<ol><li><strong>점진적 도입</strong>: 모든 시스템을 한 번에 전환하기보다 중요도가 낮은 기능부터 점진적으로 메시징 큐를 적용한다.</li><li><strong>비동기 처리 패턴 채택</strong>: 동기식 요청-응답에서 비동기 이벤트 기반 패턴으로 전환한다.</li><li><strong>오류 처리 우선화</strong>: 구현 초기 단계부터 견고한 오류 처리를 설계한다.</li><li><strong>로컬 개발 환경 구성</strong>: 개발자가 로컬에서 메시징 시스템을 테스트할 수 있도록 환경을 구성한다.</li><li><strong>자동화된 테스트</strong>: 메시지 생산, 소비, 오류 처리를 포함한 자동화된 테스트를 구현한다.</li><li><strong>문서화 및 표준화</strong>: 메시지 형식, 큐 명명 규칙, 오류 처리 절차 등을 명확하게 문서화한다.</li><li><strong>모니터링 인프라 구축</strong>: 메시징 시스템 도입과 함께 모니터링 인프라를 구축한다.</li></ol></li></ol><hr><h2 id=용어-정리-6>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-6>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처-6>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-6>#</a></h2></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>