<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Queue vs. Topic | hyunyoun's Blog</title><meta name=keywords content="Systems-and-Infrastructure,Infrastructure,Infrastructure-Components,Messaging-Systems,Event-Brokers-vs-Message-Brokers,Queue-vs-Topic,Queue,Topic"><meta name=description content="Queue 와 Topic 은 메시징 시스템의 핵심 통신 패턴으로, Queue 는 point-to-point 모델을 통해 단일 소비자에게 메시지를 전달하는 반면, Topic 은 publish-subscribe 모델을 사용하여 다중 구독자에게 메시지를 브로드캐스트한다. 각각 다른 사용 사례와 특성을 가지며 분산 시스템 설계에서 중요한 역할을 담당한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/system-design/system-components/application-and-execution-core/messaging-systems/event-brokers-vs-message-brokers/queue-vs-topic/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/system-design/system-components/application-and-execution-core/messaging-systems/event-brokers-vs-message-brokers/queue-vs-topic/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/system-design/system-components/application-and-execution-core/messaging-systems/event-brokers-vs-message-brokers/queue-vs-topic/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Queue vs. Topic"><meta property="og:description" content="Queue 와 Topic 은 메시징 시스템의 핵심 통신 패턴으로, Queue 는 point-to-point 모델을 통해 단일 소비자에게 메시지를 전달하는 반면, Topic 은 publish-subscribe 모델을 사용하여 다중 구독자에게 메시지를 브로드캐스트한다. 각각 다른 사용 사례와 특성을 가지며 분산 시스템 설계에서 중요한 역할을 담당한다."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-22T13:39:00+00:00"><meta property="article:modified_time" content="2025-04-22T13:39:00+00:00"><meta property="article:tag" content="Systems-and-Infrastructure"><meta property="article:tag" content="Infrastructure"><meta property="article:tag" content="Infrastructure-Components"><meta property="article:tag" content="Messaging-Systems"><meta property="article:tag" content="Event-Brokers-vs-Message-Brokers"><meta property="article:tag" content="Queue-vs-Topic"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Queue vs. Topic"><meta name=twitter:description content="Queue 와 Topic 은 메시징 시스템의 핵심 통신 패턴으로, Queue 는 point-to-point 모델을 통해 단일 소비자에게 메시지를 전달하는 반면, Topic 은 publish-subscribe 모델을 사용하여 다중 구독자에게 메시지를 브로드캐스트한다. 각각 다른 사용 사례와 특성을 가지며 분산 시스템 설계에서 중요한 역할을 담당한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Queue vs. Topic","item":"https://buenhyden.github.io/posts/system-design/system-components/application-and-execution-core/messaging-systems/event-brokers-vs-message-brokers/queue-vs-topic/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Queue vs. Topic","name":"Queue vs. Topic","description":"Queue 와 Topic 은 메시징 시스템의 핵심 통신 패턴으로, Queue 는 point-to-point 모델을 통해 단일 소비자에게 메시지를 전달하는 반면, Topic 은 publish-subscribe 모델을 사용하여 다중 구독자에게 메시지를 브로드캐스트한다. 각각 다른 사용 사례와 특성을 가지며 분산 시스템 설계에서 중요한 역할을 담당한다.","keywords":["Systems-and-Infrastructure","Infrastructure","Infrastructure-Components","Messaging-Systems","Event-Brokers-vs-Message-Brokers","Queue-vs-Topic","Queue","Topic"],"articleBody":"Queue vs. Topic Queue 와 Topic 은 메시지 기반 시스템에서 데이터 전달 구조의 핵심 요소로, 시스템 아키텍처와 소비자 처리 방식에 따라 선택된다. Queue 는 Point-to-Point 방식으로 하나의 소비자에게 메시지를 전달하며 작업 분산에 유리하다. 반면 Topic 은 Publish-Subscribe 모델로, 다수의 구독자가 동일한 메시지를 수신할 수 있어 이벤트 브로드캐스팅이나 실시간 알림에 적합하다. 각 방식은 메시지 순서, 중복 수신, 확장성 등 다양한 구현 요소에서 차이를 가지며, 적절한 선택이 시스템 안정성과 확장성에 큰 영향을 미친다.\n핵심 개념 기본 개념 Queue (큐)\n정의: Point-to-Point 메시징 패턴으로, 메시지가 단일 소비자에게 전달되는 통신 모델 특성: FIFO (First-In-First-Out) 순서 보장, 메시지 지속성, 부하 분산 동작 방식: 프로듀서가 큐에 메시지를 전송하면, 여러 컨슈머 중 하나만이 해당 메시지를 소비 Topic (토픽)\n정의: Publish-Subscribe 메시징 패턴으로, 메시지가 여러 구독자에게 브로드캐스트되는 통신 모델 특성: 일대다 통신, 메시지 복제, 실시간 이벤트 전파 동작 방식: 퍼블리셔가 토픽에 메시지를 게시하면, 해당 토픽을 구독하는 모든 컨슈머가 메시지 사본을 수신 실무 구현을 위한 연관성 분석 메시지 브로커 (Message Broker) 연관성\nApache Kafka, RabbitMQ, ActiveMQ 등에서 Queue 와 Topic 패턴 모두 지원 브로커는 메시지 라우팅, 지속성, 보안 기능 제공 확장성 (Scalability) 측면\nQueue: 컨슈머 그룹을 통한 수평적 확장 Topic: 파티셔닝과 구독자 확장을 통한 대규모 처리 내결함성 (Fault Tolerance) 구현\n메시지 복제, 확인 응답 (Acknowledgment), 재시도 메커니즘 Dead Letter Queue/Topic 을 통한 실패 메시지 처리 Queue vs. Topic 비교 Queue 와 Topic 은 메시징 시스템 내에서 메시지 전달, 소비 방식, 신뢰성, 스케일링 방식, 활용 목적 등 다양한 기준에서 차이가 난다.\n기본 특성 비교 구분 Queue Topic 통신 모델 Point-to-Point Publish-Subscribe 메시지 소비 단일 컨슈머 다중 구독자 메시지 순서 FIFO 보장 파티션 내에서만 보장 메시지 지속성 소비 후 삭제 보존 기간에 따라 유지 부하 분산 Round-robin 방식 구독자별 독립적 처리 성능 특성 비교 구분 Queue Topic 처리량 (Throughput) 중간 - 높음 높음 지연 시간 (Latency) 낮음 중간 메모리 사용량 낮음 높음 (구독자 수에 비례) 네트워크 사용량 효율적 구독자 수에 따라 증가 확장성 제한적 높음 사용 사례 비교 구분 Queue Topic 작업 분산 적합 부적합 이벤트 브로드캐스트 부적합 적합 데이터 스트리밍 제한적 적합 마이크로서비스 통신 적합 적합 실시간 알림 부적합 적합 작동 방식 Queue 작동 원리 sequenceDiagram participant P as Producer participant Q as Queue participant C1 as Consumer 1 participant C2 as Consumer 2 P-\u003e\u003eQ: Send Message 1 P-\u003e\u003eQ: Send Message 2 P-\u003e\u003eQ: Send Message 3 Q-\u003e\u003eC1: Deliver Message 1 C1-\u003e\u003eQ: Acknowledge Q-\u003e\u003eC2: Deliver Message 2 C2-\u003e\u003eQ: Acknowledge Q-\u003e\u003eC1: Deliver Message 3 C1-\u003e\u003eQ: Acknowledge Topic 작동 원리 sequenceDiagram participant P as Publisher participant T as Topic participant S1 as Subscriber 1 participant S2 as Subscriber 2 P-\u003e\u003eT: Publish Message T-\u003e\u003eS1: Broadcast Copy 1 T-\u003e\u003eS2: Broadcast Copy 2 S1-\u003e\u003eT: Acknowledge S2-\u003e\u003eT: Acknowledge 도전 과제 카테고리 도전 과제 원인 또는 설명 실무적 영향 대응 전략 / 해결 방안 확장성/부하 분산 파티션 불균형, 소비자 병목 키 기반 파티셔닝 불균형, 핫 파티션, 소비자 수 제한 특정 파티션/큐에 부하 집중, 처리량 저하 키 해시 분산 설계, 파티션 재조정, 컨슈머 그룹 확장, 큐 샤딩 스케일링 안정성 컨슈머 리밸런싱 처리 지연 컨슈머 동적 증가/감소, 네트워크 장애 발생 시 리밸런싱 이벤트 트리거됨 일시적 처리 중단, 메시지 재전송 발생 점진적 스케일링, 상태 기반 할당, 협력적 리밸런싱 (Cooperative Rebalancing) 성능/처리량 직렬화 오버헤드, 백프레셔 무거운 메시지 포맷 (JSON 등), 빠른 생산자 - 느린 소비자 속도 불일치 CPU 부하, 처리량 저하, 큐 적체, 시스템 불안정 Avro/Protobuf 적용, 배치 처리, prefetch/poll 설정 조정, 회로 차단기 패턴 (Circuit Breaker) 일관성/정확성 메시지 순서 보장 어려움 병렬 소비, 토픽 파티션 분산 처리, 소비자 순서 무시 이벤트 순서 불일치로 인한 비즈니스 로직 오류 파티션 키 고정, 단일 소비자 처리, Kafka FIFO 처리, Vector Clock, 이벤트 소싱 적용 신뢰성 메시지 유실, 중복 처리 문제 Ack 실패, 컨슈머 장애, 중복 전송으로 인해 발생 데이터 누락, 중복 처리, 결과 무결성 손상 DLQ 구성, Ack + Retry 정책, 멱등성 (ID+Hash 기반) 소비자 구현 운영/관찰성 메시지 흐름 및 상태 추적 어려움 큐는 처리 후 삭제, 토픽은 병렬 소비자 존재 → 추적 어려움 SLA 준수 실패, 디버깅 난이도 증가 Trace ID 삽입, 중앙 로깅 + 분산 트레이싱 도입 (OpenTelemetry, Zipkin 등) 통합/마이그레이션 큐 ↔ 토픽 전환 시 데이터 정합성 보장 문제 구조 전환 시 메시지 중복/유실 가능, 중단 없는 서비스 이전 어려움 전환 중단 시 서비스 중단 또는 누락 이벤트 발생 가능 중간 브로커 구성, 양방향 브릿지 메시징, 임시 병행 구독 전략 아키텍처 복잡도 혼합 패턴 구성 시 복잡성 증가 Queue/Topic 혼합 사용 시 흐름 파악, 장애 추적, 권한 설정 등 어려움 운영 비용 증가, 장애 확산 시 전체 영향도 증가 도메인별 메시징 전략 수립, 토픽 명명 일관화, 문서화 및 메시지 흐름 시각화 보안/접근 제어 구독자/컨슈머 인증/인가 누락 ACL 미적용, 인증 토큰 부재, 메시지 노출 우려 보안 취약점, 메시지 도난 가능성 Role 기반 RBAC, TLS 암호화, JWT/OAuth 기반 메시지 인증 적용 Queue 기반 시스템은 확장성과 병렬성 한계, 처리 병목이 주요 이슈이며, 소비자 확장 전략과 작업 큐 분산 설계가 핵심. Topic 기반 시스템은 병렬성은 뛰어나나 순서 보장, 메시지 정합성 유지, 모니터링에서 도전 과제가 두드러짐. 모든 아키텍처 공통 이슈는 신뢰성 확보 (DLQ, 멱등성), 관찰성 향상 (Trace, 상태 저장), 스케일 안정화 (리밸런싱, 파티션 튜닝) 에 집중해야 한다. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점 카테고리 고려 항목 Queue(큐) 고려사항 Topic(토픽) 고려사항 권장 사항 및 주의점 전달 패턴 메시징 모델 1:1 처리 (Point-to-Point) 1:N 처리 (Publish-Subscribe) 요구 사항에 따라 메시징 패턴을 일관되게 설계 순서 보장 FIFO 처리 단일 소비자 구성 시 순서 보장. FIFO Queue 또는 순차 처리 설계 필요 Partition 내 순서 보장만 가능, 전체 순서 보장은 어려움 순서 요구 시 단일 파티션/소비자 설정 또는 순서 제어 로직 구현 확장성 소비자 수 및 병렬 처리 소비자 수를 늘려 작업 병렬화 (Worker Pool) Partition + Consumer Group 구조로 병렬 소비 Partition 수 ≥ Consumer 수 권장. 파티션 증설 시 메시지 재분배 고려 필요 장애 복원력 장애 및 실패 대응 DLQ 구성 필수. 메시지 누락 대비 Ack 기반 재처리 로직 필요 Durable Subscription, Offset 기반 재처리 및 Replay 가능 DLQ + 재처리 전략 함께 구성. Topic 은 재생 정책 (log compaction 등) 고려 중복 방지 Idempotency 처리 동일 메시지 재수신 방지를 위한 멱등성 설계 필요 각 구독자 단위로 중복 수신 방지 처리 필요 메시지 해시, UUID, Redis Lock 등 멱등성 로직 적용 모니터링 시스템 상태 추적 큐 깊이, 메시지 지연, 소비 실패 추적 구독자별 처리율, Offset lag, 파티션 상태 추적 Prometheus + Grafana, DLQ 로그 추적, APM 연계 성능 최적화 처리량/지연 튜닝 Batch 전송, Prefetch 설정, 워커 수 조정 Compression, BatchSize, Zero-Copy 전송 등 Throughput ↔ Latency 트레이드오프 균형화 설계 운영 관리 메시지 보존 및 재처리 일반적으로 소비 후 메시지 삭제 메시지 로그 보존 설정으로 재처리 및 분석 가능 (Kafka log.retention 등) 장기 보관 필요 시 Topic 선택 + TTL 설정 조합 보안 인증/암호화/권한 관리 TLS, 사용자 인증, 역할 기반 접근 제어 (RBAC) TLS, 구독 필터링, ACL 및 Consumer 인증 민감도에 따라 차등 보안 설정, 브로커 레벨 + 애플리케이션 레벨 이중 보안 적용 운영 자동화 오토스케일링/백프레셔 메시지 증가 시 Worker 자동 확장 + 메시지 Pull 속도 조절 소비 속도에 따라 Backpressure 전략 도입 필요 KEDA, Kubernetes HPA 연동, Kafka Lag 기반 스케일링 트리거 고려 설계 복잡도 혼합 설계 시 주의점 Queue/Topic 혼용 시 데이터 흐름 혼란 및 유지보수 난이도 증가 가능 기능 분리 목적의 멀티 토픽 구성 시 구독자 설계가 복잡해질 수 있음 도메인 기준 메시징 구조 일관성 확보. 기능별 별도 토픽 설계로 복잡도 분리 스키마 설계 메시지 포맷/진화 JSON/Protobuf/Avro 등 표준 포맷 유지 필요 스키마 진화 발생 시 하위 호환성 확보 필요 Schema Registry 도입 권장, 버전 관리 포함 실무 설계 및 운영 팁 요약 항목 권장 전략 요약 순서 보장 FIFO 가 중요한 경우 큐 사용. Topic 은 파티션 내부에서만 순서 보장 가능 확장성과 병렬 처리 Topic + Partition + Consumer Group 조합이 가장 효율적인 병렬 처리 구조 신뢰성과 재처리 DLQ, Retry Queue, Ack/Nack 조합을 통한 메시지 유실 방지 전략 필수 모니터링 및 자동화 Kafka Lag, Queue Length, Failure Count 등 지표 기반 오토스케일링 및 알림 시스템 구축 권장 보안 TLS, 인증 키, 토픽 구독 필터링, RBAC 조합으로 전방위 보안 체계 구축 가능 복합 구조 설계 시 CQRS, Saga 등 복합 아키텍처에서 Queue 와 Topic 을 혼합 사용 시 도메인 기반 구분 및 명확한 흐름 설계 필수 최적화하기 위한 고려사항 및 주의할 점 카테고리 최적화 항목 Queue(큐) 최적화 전략 Topic(토픽) 최적화 전략 실무 권장사항 요약 메시지 크기/포맷 메시지 크기 및 직렬화 최적화 메시지 크기 10MB 이하 유지, JSON 대신 Avro/Protobuf 활용 이벤트 페이로드 최소화, 경량 직렬화 포맷 사용 JSON → Avro 전환, Schema Registry 로 일관성 유지 처리량/지연 시간 병렬 처리 및 Throughput Prefetch 조정, Consumer 수 증가, 멀티 워커 구성 파티션 수 증가, 컨슈머 그룹 병렬 처리 처리량 기준 → Partition/Consumer 수 동적 조정 백프레셔 소비자 부하 제어 메시지 rate limit 설정, reject + requeue 전략 구독자 수 조절, 이벤트 필터링/샤딩 적용 처리 병목 시 prefetch 또는 poll 조정, CPU 모니터링 필수 리소스 최적화 시스템 자원 할당 및 스케일링 CPU/메모리/디스크 모니터링, 워커 오토스케일링 구성 브로커/컨슈머 오토스케일링, 클러스터 모니터링 Kubernetes + HPA/KEDA 조합 권장 스토리지 최적화 메시지 저장소 관리 TTL 설정, 수동/자동 배치 삭제, 디스크 압축 설정 Retention 정책 설정, 파티션 간 균등 분산 Kafka 는 retention.ms, RabbitMQ 는 max-length 등 관리 필요 신뢰성/오류 처리 장애 대응 전략 DLQ 구성, 재시도 + 지수 백오프, manual ack 설정 Durable Subscription, 재전송 정책, Offset commit 전략 DLQ 는 필수 구성 요소, 오류 로깅 및 Alerting 도입 권장 확장성 설계 수평 확장 구조 큐 단위 분리, 컨슈머 워커 클러스터 구성 파티션 기반 구독자 병렬화, 구독자 샤딩 및 부하 분산 사용자 그룹별 큐 or 파티션 구성, 클러스터 수준 확장 고려 지연 최소화 네트워크/연결 관리 연결 풀링, 메시지 배치 처리, 전용 회선 구성 로컬 배치 처리, 고속 네트워크 구성, 메시지 필터링 적용 네트워크 지연 발생 시 RPC → 비동기 메시징 전환 고려 중복/멱등성 보장 Idempotency 메시지 해시, Unique ID, 중복 방지 DB Key 적용 이벤트 ID 기반 멱등성 로직, 구독자별 deduplication 처리 재처리에도 안전한 메시지 구조 설계 (e.g., DB Upsert 패턴) 운영 편의성 모니터링 및 Alerting 큐 길이, 처리 시간, 실패률 모니터링 + Alert 구성 토픽 오프셋 지연, 구독자 상태 모니터링 Prometheus + Grafana, Kafka UI, RabbitMQ Management Plugin 활용 Queue 는 작업 단위 (Task) 중심 처리에 최적화되어 있고, Topic 은 이벤트 브로드캐스트 처리에 강점을 가진다. **공통적으로 병목 구간 식별, 리소스 모니터링, 자동화된 장애 처리 (DLQ + Alert)**가 중요하다. Kafka, RabbitMQ, SQS/SNS 등 각 브로커에 따라 일부 설정 방식이 다르므로 시스템에 맞는 최적화 전략 수립 필요. 직렬화 포맷과 메시지 크기 최적화는 네트워크/스토리지 부하를 줄이는 데 핵심이다. 실무 적용 예시 도메인/시스템 사용 목적 메시징 방식 적용 방식 예시 기대 효과 및 특징 주문 처리 시스템 비동기 작업 처리 Queue 주문 요청 → 큐 (RabbitMQ/SQS) → 백엔드 워커 중복 방지, 신뢰성 확보, 부하 분산 알림 시스템 실시간 이벤트 브로드캐스트 Topic 이벤트 발생 → 토픽 (Kafka/PubSub) → 모바일/Web/Slack 등 다중 구독자 동시 사용자 대상 브로드캐스트, 반응 속도 향상 로그 수집 및 분석 로그 집계 및 전처리 Queue 서버 로그 → 큐 → 로그 파서/적재기 → DB/S3 등 안정적인 수집, 실패 메시지 재처리, 단일 소비 구조 다중 로그 시스템 연동 Topic 앱 로그 → 토픽 → Kibana + S3 + Data Lake 등 다수 분석 시스템에 병렬 전송, 유연한 로그 분기 처리 IoT/센서 데이터 대규모 이벤트 스트림 처리 Topic 센서 이벤트 → 토픽 → 실시간 분석기 + 알림 시스템 실시간 통계, 이벤트 기반 경고 시스템 구축 가능 ETL 파이프라인 배치/순차 처리 Queue Data Ingest → 큐 → 변환 작업 순차 수행 처리 순서 보장, 실패 처리 용이 실시간 스트리밍 처리 Topic 실시간 데이터 수집 → 토픽 → 분석기, 대시보드, 저장 시스템 병렬 전달 고속 처리, 병렬 확장, 비동기 이벤트 기반 처리 마이크로서비스 통신 명령/작업 분산 전달 Queue A 서비스 → 큐 → B 서비스 워커로 명령 전달 명령 처리의 확장성, 느슨한 결합, 트랜잭션 가능 이벤트 기반 상호 작용 Topic 도메인 이벤트 → 토픽 발행 → 여러 서비스 구독 (이메일, 포인트, 감사 로그 등) CQRS/Event Sourcing 구현, 기능 확장 용이 데이터 적재/복제 멀티 싱크 처리 Topic 원본 시스템 → 토픽 → 여러 데이터 저장소로 동시에 전송 일관된 데이터 적재, 리플레이/재처리 가능 지속 가능성/모니터링 장애 대비, 재처리 DLQ (보조 구성) 처리 실패 메시지 → DLQ → 재시도 큐 또는 관리자 알림 처리 신뢰성 향상, 재처리 전략 수립 용이 활용 사례 사례 1: 실시간 알림 시스템 - Topic 패턴 시스템 구성\nflowchart TD Backend[Backend Service] --\u003e Broker[메시징 브로커] Broker --\u003e Topic[알림 토픽] Topic --\u003e User1[User App 1] Topic --\u003e User2[User App 2] Topic --\u003e User3[User App 3] Broker -.-\u003e DLQ Workflow\nBackend 에서 알림 이벤트 생성 후 토픽으로 발행 토픽 구독 중인 모든 User App 에게 동시에 메시지 전송 개별 앱이 각자 알림 확인, 실패 시 DLQ 보관 주제의 역할: 동일 이벤트의 멀티 소비, 브로드캐스트, 확장성과 실시간성\n유무 차이: Topic 없으면 각 대상마다 별도 메시지 송신 필요 → 시스템 과부하, 누락/지연 위험\n구현 예시\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # Kafka 토픽 방식 알림 발행 및 소비 예시 from kafka import KafkaProducer, KafkaConsumer # Producer: 알림 이벤트 발행 producer = KafkaProducer(bootstrap_servers=['localhost:9092']) producer.send('notify-topic', b'{\"event\":\"ALERT\",\"msg\":\"서버 점검 공지\"}') # Consumer: 알림 구독 consumer = KafkaConsumer( 'notify-topic', bootstrap_servers=['localhost:9092'], auto_offset_reset='earliest', group_id='user-app' ) for msg in consumer: print(f\"[User App] 수신된 알림: {msg.value.decode()}\") # 여러 User App 인스턴스가 동시에 구독하면 각각 메시지 수신 사례 2: 전자상거래 주문 처리 시스템 시스템 구성:\nQueue 기반 주문 처리\ngraph LR UI[웹 인터페이스] --\u003e OQ[주문 큐] OQ --\u003e OP1[주문 처리 워커 1] OQ --\u003e OP2[주문 처리 워커 2] OQ --\u003e OP3[주문 처리 워커 3] OP1 --\u003e DB[(주문 DB)] OP2 --\u003e DB OP3 --\u003e DB Topic 기반 이벤트 처리\ngraph TB OP[주문 처리 완료] --\u003e ET[이벤트 토픽] ET --\u003e IS[재고 서비스] ET --\u003e NS[알림 서비스] ET --\u003e AS[분석 서비스] ET --\u003e BS[빌링 서비스] Workflow:\nQueue 워크플로우 사용자 주문 접수 → 주문 큐에 메시지 추가 주문 처리 워커들이 경쟁적으로 주문 획득 주문 검증 및 처리 → 데이터베이스 업데이트 처리 완료 확인 응답 Topic 워크플로우 주문 처리 완료 → 이벤트 토픽에 발행 재고 서비스: 재고 차감 알림 서비스: 고객 알림 발송 분석 서비스: 판매 데이터 수집 빌링 서비스: 정산 처리 Queue vs. Topic 유무에 따른 차이점\nQueue 미사용 시 동기식 처리로 응답 시간 증가 트래픽 급증 시 시스템 과부하 단일 장애점 위험 증가 Topic 미사용 시 서비스 간 강한 결합 순차적 처리로 전체 지연 발생 새로운 서비스 추가 시 기존 코드 수정 필요 구현 예시:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499 500 501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550 551 552 553 554 555 556 557 558 559 560 561 562 563 564 565 566 567 568 569 570 571 572 573 574 575 576 577 578 579 580 581 582 583 584 585 586 587 588 589 590 591 592 593 594 595 596 597 598 599 600 601 602 603 604 605 606 607 608 609 610 611 612 613 614 615 616 617 618 619 620 621 622 623 624 625 626 627 628 629 630 631 632 633 634 635 636 637 638 639 640 641 642 643 644 645 646 647 648 649 650 651 652 653 654 655 656 657 658 659 660 661 662 663 664 665 666 667 668 669 670 671 672 673 674 675 676 677 678 679 680 681 682 683 684 685 686 687 688 689 690 691 692 693 694 695 696 697 698 699 700 701 702 703 704 705 706 707 708 709 710 711 712 713 714 715 716 717 718 719 720 721 722 723 724 725 726 727 728 729 730 731 732 733 734 735 736 737 738 739 740 741 742 743 744 745 746 747 748 749 750 751 752 753 754 755 756 757 758 759 760 761 762 763 764 765 766 767 768 769 770 771 772 773 774 775 776 777 778 779 \"\"\" Apache Kafka를 활용한 Queue와 Topic 패턴 구현 - kafka-python 라이브러리 사용 - Queue: 단일 파티션 + 컨슈머 그룹 활용 - Topic: 다중 파티션 + 다중 컨슈머 그룹 활용 설치 필요 라이브러리: pip install kafka-python \"\"\" import asyncio import json import logging from typing import Dict, List, Optional, Callable, Any from dataclasses import dataclass, asdict from datetime import datetime import uuid import threading from kafka import KafkaProducer, KafkaConsumer, KafkaAdminClient from kafka.admin import NewTopic from kafka.errors import TopicAlreadyExistsError, KafkaError import signal import sys # 로깅 설정 logging.basicConfig(level=logging.INFO) logger = logging.getLogger(__name__) @dataclass class KafkaMessage: \"\"\"Kafka 메시지 클래스\"\"\" id: str content: Dict[str, Any] timestamp: datetime partition: Optional[int] = None offset: Optional[int] = None key: Optional[str] = None def to_dict(self) -\u003e Dict: \"\"\"메시지를 딕셔너리로 변환\"\"\" data = asdict(self) data['timestamp'] = self.timestamp.isoformat() return data @classmethod def from_kafka_message(cls, msg) -\u003e 'KafkaMessage': \"\"\"Kafka ConsumerRecord에서 KafkaMessage 생성\"\"\" try: content = json.loads(msg.value.decode('utf-8')) return cls( id=content.get('id', str(uuid.uuid4())), content=content.get('content', {}), timestamp=datetime.fromisoformat(content.get('timestamp', datetime.now().isoformat())), partition=msg.partition, offset=msg.offset, key=msg.key.decode('utf-8') if msg.key else None ) except Exception as e: logger.error(f\"메시지 파싱 오류: {e}\") return cls( id=str(uuid.uuid4()), content={\"raw_value\": msg.value.decode('utf-8', errors='ignore')}, timestamp=datetime.now(), partition=msg.partition, offset=msg.offset ) class KafkaQueueProducer: \"\"\" Kafka를 활용한 Queue 패턴 프로듀서 - 단일 파티션으로 순서 보장 - Round-robin 방식으로 컨슈머에게 분배 \"\"\" def __init__(self, bootstrap_servers: str = 'localhost:9092'): self.bootstrap_servers = bootstrap_servers self.producer = None self._setup_producer() def _setup_producer(self): \"\"\"Kafka 프로듀서 설정\"\"\" try: self.producer = KafkaProducer( bootstrap_servers=self.bootstrap_servers, value_serializer=lambda x: json.dumps(x).encode('utf-8'), key_serializer=lambda x: x.encode('utf-8') if x else None, # 안정성을 위한 설정 acks='all', # 모든 replica 확인 retries=3, # 재시도 횟수 enable_idempotence=True, # 중복 방지 max_in_flight_requests_per_connection=1 # 순서 보장 ) logger.info(\"Kafka 프로듀서 초기화 완료\") except Exception as e: logger.error(f\"Kafka 프로듀서 초기화 실패: {e}\") raise async def send_to_queue(self, topic_name: str, content: Dict[str, Any], key: Optional[str] = None) -\u003e str: \"\"\" Queue에 메시지 전송 Args: topic_name: 토픽 이름 content: 메시지 내용 key: 파티션 키 (순서 보장용) Returns: str: 메시지 ID \"\"\" message_id = str(uuid.uuid4()) message_data = { 'id': message_id, 'content': content, 'timestamp': datetime.now().isoformat() } try: # 비동기 전송 future = self.producer.send( topic_name, value=message_data, key=key, partition=0 # Queue 패턴을 위해 단일 파티션 사용 ) # 전송 결과 대기 record_metadata = future.get(timeout=10) logger.info(f\"Queue 메시지 전송 완료 - Topic: {topic_name}, \" f\"ID: {message_id}, Partition: {record_metadata.partition}, \" f\"Offset: {record_metadata.offset}\") return message_id except Exception as e: logger.error(f\"Queue 메시지 전송 실패 - Topic: {topic_name}, Error: {e}\") raise async def send_batch_to_queue(self, topic_name: str, messages: List[Dict[str, Any]]) -\u003e List[str]: \"\"\"배치 메시지 전송\"\"\" message_ids = [] for content in messages: message_id = await self.send_to_queue(topic_name, content) message_ids.append(message_id) return message_ids def close(self): \"\"\"프로듀서 종료\"\"\" if self.producer: self.producer.close() logger.info(\"Kafka 프로듀서 종료\") class KafkaQueueConsumer: \"\"\" Kafka를 활용한 Queue 패턴 컨슈머 - 컨슈머 그룹을 통한 메시지 분산 처리 - 자동 오프셋 커밋으로 중복 처리 방지 \"\"\" def __init__(self, topic_name: str, consumer_group: str, consumer_id: str, bootstrap_servers: str = 'localhost:9092'): self.topic_name = topic_name self.consumer_group = consumer_group self.consumer_id = consumer_id self.bootstrap_servers = bootstrap_servers self.consumer = None self.is_running = False self.message_handler: Optional[Callable] = None self.processed_count = 0 self.error_count = 0 self._setup_consumer() def _setup_consumer(self): \"\"\"Kafka 컨슈머 설정\"\"\" try: self.consumer = KafkaConsumer( self.topic_name, bootstrap_servers=self.bootstrap_servers, group_id=self.consumer_group, client_id=self.consumer_id, # 자동 오프셋 커밋으로 at-least-once 보장 enable_auto_commit=True, auto_commit_interval_ms=1000, # 가장 오래된 메시지부터 소비 auto_offset_reset='earliest', # 세션 타임아웃 설정 session_timeout_ms=30000, heartbeat_interval_ms=10000, # 메시지 크기 제한 max_partition_fetch_bytes=1048576, # 1MB fetch_max_wait_ms=500 ) logger.info(f\"Kafka 컨슈머 초기화 완료 - Group: {self.consumer_group}, \" f\"Consumer: {self.consumer_id}\") except Exception as e: logger.error(f\"Kafka 컨슈머 초기화 실패: {e}\") raise async def start_consuming(self, message_handler: Callable[[KafkaMessage], bool]): \"\"\" 메시지 소비 시작 Args: message_handler: 메시지 처리 함수 (KafkaMessage -\u003e bool) \"\"\" self.message_handler = message_handler self.is_running = True logger.info(f\"Queue 컨슈머 시작 - Consumer: {self.consumer_id}\") try: while self.is_running: # 메시지 폴링 (타임아웃 1초) msg_pack = self.consumer.poll(timeout_ms=1000) if not msg_pack: continue # 수신된 메시지 처리 for topic_partition, messages in msg_pack.items(): for msg in messages: try: kafka_message = KafkaMessage.from_kafka_message(msg) logger.info(f\"메시지 수신 - Consumer: {self.consumer_id}, \" f\"ID: {kafka_message.id}, \" f\"Partition: {kafka_message.partition}, \" f\"Offset: {kafka_message.offset}\") # 메시지 처리 success = await self._process_message(kafka_message) if success: self.processed_count += 1 else: self.error_count += 1 except Exception as e: self.error_count += 1 logger.error(f\"메시지 처리 오류 - Consumer: {self.consumer_id}, \" f\"Error: {e}\") except Exception as e: logger.error(f\"컨슈머 실행 오류 - Consumer: {self.consumer_id}, Error: {e}\") finally: self.close() async def _process_message(self, message: KafkaMessage) -\u003e bool: \"\"\"메시지 처리\"\"\" try: if self.message_handler: # 동기 함수인 경우 스레드 풀에서 실행 if asyncio.iscoroutinefunction(self.message_handler): result = await self.message_handler(message) else: loop = asyncio.get_event_loop() result = await loop.run_in_executor(None, self.message_handler, message) logger.info(f\"메시지 처리 완료 - Consumer: {self.consumer_id}, \" f\"Message: {message.id}\") return result return True except Exception as e: logger.error(f\"메시지 처리 실패 - Consumer: {self.consumer_id}, \" f\"Message: {message.id}, Error: {e}\") return False def stop(self): \"\"\"컨슈머 정지\"\"\" self.is_running = False logger.info(f\"Queue 컨슈머 정지 요청 - Consumer: {self.consumer_id}\") def close(self): \"\"\"컨슈머 종료\"\"\" if self.consumer: self.consumer.close() logger.info(f\"Kafka 컨슈머 종료 - Consumer: {self.consumer_id}\") def get_stats(self) -\u003e Dict: \"\"\"컨슈머 통계\"\"\" return { \"consumer_id\": self.consumer_id, \"consumer_group\": self.consumer_group, \"topic_name\": self.topic_name, \"processed_count\": self.processed_count, \"error_count\": self.error_count, \"is_running\": self.is_running } class KafkaTopicProducer: \"\"\" Kafka를 활용한 Topic 패턴 프로듀서 (Publish-Subscribe) - 다중 파티션으로 확장성 제공 - 다중 컨슈머 그룹에 메시지 브로드캐스트 \"\"\" def __init__(self, bootstrap_servers: str = 'localhost:9092'): self.bootstrap_servers = bootstrap_servers self.producer = None self._setup_producer() def _setup_producer(self): \"\"\"Kafka 프로듀서 설정\"\"\" try: self.producer = KafkaProducer( bootstrap_servers=self.bootstrap_servers, value_serializer=lambda x: json.dumps(x).encode('utf-8'), key_serializer=lambda x: x.encode('utf-8') if x else None, # 처리량 최적화를 위한 설정 acks=1, # 리더만 확인 (성능 vs 안정성) compression_type='snappy', # 압축으로 네트워크 효율성 batch_size=16384, # 배치 크기 linger_ms=5, # 배치 대기 시간 retries=3 ) logger.info(\"Kafka Topic 프로듀서 초기화 완료\") except Exception as e: logger.error(f\"Kafka Topic 프로듀서 초기화 실패: {e}\") raise async def publish_to_topic(self, topic_name: str, content: Dict[str, Any], key: Optional[str] = None, headers: Optional[Dict] = None) -\u003e str: \"\"\" Topic에 메시지 발행 Args: topic_name: 토픽 이름 content: 메시지 내용 key: 파티션 키 headers: 메시지 헤더 Returns: str: 메시지 ID \"\"\" message_id = str(uuid.uuid4()) message_data = { 'id': message_id, 'content': content, 'timestamp': datetime.now().isoformat(), 'headers': headers or {} } try: # 헤더 변환 (Kafka는 바이트 헤더만 지원) kafka_headers = [] if headers: kafka_headers = [(k, json.dumps(v).encode('utf-8')) for k, v in headers.items()] # 비동기 전송 (파티션은 키에 따라 자동 결정) future = self.producer.send( topic_name, value=message_data, key=key, headers=kafka_headers ) # 전송 결과 대기 record_metadata = future.get(timeout=10) logger.info(f\"Topic 메시지 발행 완료 - Topic: {topic_name}, \" f\"ID: {message_id}, Partition: {record_metadata.partition}, \" f\"Offset: {record_metadata.offset}\") return message_id except Exception as e: logger.error(f\"Topic 메시지 발행 실패 - Topic: {topic_name}, Error: {e}\") raise async def publish_batch_to_topic(self, topic_name: str, messages: List[Dict[str, Any]]) -\u003e List[str]: \"\"\"배치 메시지 발행\"\"\" message_ids = [] for content in messages: message_id = await self.publish_to_topic(topic_name, content) message_ids.append(message_id) # 배치 전송 완료 대기 self.producer.flush() return message_ids def close(self): \"\"\"프로듀서 종료\"\"\" if self.producer: self.producer.close() logger.info(\"Kafka Topic 프로듀서 종료\") class KafkaTopicSubscriber: \"\"\" Kafka를 활용한 Topic 패턴 구독자 - 독립적인 컨슈머 그룹으로 모든 메시지 수신 - 다중 파티션에서 병렬 처리 \"\"\" def __init__(self, topic_name: str, subscriber_group: str, subscriber_id: str, bootstrap_servers: str = 'localhost:9092'): self.topic_name = topic_name self.subscriber_group = subscriber_group self.subscriber_id = subscriber_id self.bootstrap_servers = bootstrap_servers self.consumer = None self.is_running = False self.message_handler: Optional[Callable] = None self.processed_count = 0 self.error_count = 0 self._setup_consumer() def _setup_consumer(self): \"\"\"Kafka 컨슈머 설정\"\"\" try: self.consumer = KafkaConsumer( self.topic_name, bootstrap_servers=self.bootstrap_servers, group_id=self.subscriber_group, # 각 구독자는 별도 그룹 client_id=self.subscriber_id, enable_auto_commit=True, auto_commit_interval_ms=1000, # 최신 메시지부터 소비 (실시간 스트리밍용) auto_offset_reset='latest', session_timeout_ms=30000, heartbeat_interval_ms=10000, # 처리량 최적화 fetch_min_bytes=1024, fetch_max_wait_ms=500, max_partition_fetch_bytes=1048576 ) logger.info(f\"Kafka Topic 구독자 초기화 완료 - Group: {self.subscriber_group}, \" f\"Subscriber: {self.subscriber_id}\") except Exception as e: logger.error(f\"Kafka Topic 구독자 초기화 실패: {e}\") raise async def start_subscribing(self, message_handler: Callable[[KafkaMessage], bool]): \"\"\" 토픽 구독 시작 Args: message_handler: 메시지 처리 함수 \"\"\" self.message_handler = message_handler self.is_running = True logger.info(f\"Topic 구독자 시작 - Subscriber: {self.subscriber_id}\") try: while self.is_running: msg_pack = self.consumer.poll(timeout_ms=1000) if not msg_pack: continue # 수신된 메시지 처리 (다중 파티션) for topic_partition, messages in msg_pack.items(): for msg in messages: try: kafka_message = KafkaMessage.from_kafka_message(msg) logger.info(f\"메시지 수신 - Subscriber: {self.subscriber_id}, \" f\"ID: {kafka_message.id}, \" f\"Partition: {kafka_message.partition}\") # 메시지 처리 success = await self._process_message(kafka_message) if success: self.processed_count += 1 else: self.error_count += 1 except Exception as e: self.error_count += 1 logger.error(f\"메시지 처리 오류 - Subscriber: {self.subscriber_id}, \" f\"Error: {e}\") except Exception as e: logger.error(f\"구독자 실행 오류 - Subscriber: {self.subscriber_id}, Error: {e}\") finally: self.close() async def _process_message(self, message: KafkaMessage) -\u003e bool: \"\"\"메시지 처리\"\"\" try: if self.message_handler: if asyncio.iscoroutinefunction(self.message_handler): result = await self.message_handler(message) else: loop = asyncio.get_event_loop() result = await loop.run_in_executor(None, self.message_handler, message) logger.info(f\"메시지 처리 완료 - Subscriber: {self.subscriber_id}, \" f\"Message: {message.id}\") return result return True except Exception as e: logger.error(f\"메시지 처리 실패 - Subscriber: {self.subscriber_id}, \" f\"Message: {message.id}, Error: {e}\") return False def stop(self): \"\"\"구독자 정지\"\"\" self.is_running = False logger.info(f\"Topic 구독자 정지 요청 - Subscriber: {self.subscriber_id}\") def close(self): \"\"\"구독자 종료\"\"\" if self.consumer: self.consumer.close() logger.info(f\"Kafka Topic 구독자 종료 - Subscriber: {self.subscriber_id}\") def get_stats(self) -\u003e Dict: \"\"\"구독자 통계\"\"\" return { \"subscriber_id\": self.subscriber_id, \"subscriber_group\": self.subscriber_group, \"topic_name\": self.topic_name, \"processed_count\": self.processed_count, \"error_count\": self.error_count, \"is_running\": self.is_running } class KafkaTopicManager: \"\"\"Kafka 토픽 관리 클래스\"\"\" def __init__(self, bootstrap_servers: str = 'localhost:9092'): self.bootstrap_servers = bootstrap_servers self.admin_client = KafkaAdminClient( bootstrap_servers=bootstrap_servers, client_id='topic_manager' ) def create_topic(self, topic_name: str, num_partitions: int = 1, replication_factor: int = 1) -\u003e bool: \"\"\"토픽 생성\"\"\" try: topic = NewTopic( name=topic_name, num_partitions=num_partitions, replication_factor=replication_factor ) self.admin_client.create_topics([topic]) logger.info(f\"토픽 생성 완료 - Name: {topic_name}, \" f\"Partitions: {num_partitions}\") return True except TopicAlreadyExistsError: logger.info(f\"토픽이 이미 존재함 - Name: {topic_name}\") return True except Exception as e: logger.error(f\"토픽 생성 실패 - Name: {topic_name}, Error: {e}\") return False def close(self): \"\"\"어드민 클라이언트 종료\"\"\" self.admin_client.close() # 메시지 핸들러 예시들 async def order_queue_handler(message: KafkaMessage) -\u003e bool: \"\"\"주문 큐 처리 핸들러\"\"\" try: order_data = message.content order_id = order_data.get('order_id') customer_id = order_data.get('customer_id') amount = order_data.get('amount') logger.info(f\"[주문 처리] Order: {order_id}, Customer: {customer_id}, \" f\"Amount: {amount}\") # 주문 처리 시뮬레이션 await asyncio.sleep(0.1) return True except Exception as e: logger.error(f\"주문 처리 실패: {e}\") return False async def inventory_topic_handler(message: KafkaMessage) -\u003e bool: \"\"\"재고 토픽 구독 핸들러\"\"\" try: event_data = message.content if event_data.get('event_type') == 'order_completed': order_id = event_data.get('order_id') items = event_data.get('items', []) logger.info(f\"[재고 서비스] 주문 {order_id}에 대한 재고 차감: {items}\") await asyncio.sleep(0.05) return True except Exception as e: logger.error(f\"재고 처리 실패: {e}\") return False async def notification_topic_handler(message: KafkaMessage) -\u003e bool: \"\"\"알림 토픽 구독 핸들러\"\"\" try: event_data = message.content if event_data.get('event_type') == 'order_completed': customer_id = event_data.get('customer_id') order_id = event_data.get('order_id') logger.info(f\"[알림 서비스] 고객 {customer_id}에게 주문 {order_id} 완료 알림 발송\") await asyncio.sleep(0.02) return True except Exception as e: logger.error(f\"알림 처리 실패: {e}\") return False # 사용 예시 async def kafka_queue_example(): \"\"\"Kafka Queue 패턴 예시\"\"\" topic_manager = KafkaTopicManager() # 큐용 토픽 생성 (단일 파티션) queue_topic = \"order_processing_queue\" topic_manager.create_topic(queue_topic, num_partitions=1) # 프로듀서 생성 producer = KafkaQueueProducer() # 컨슈머 생성 (같은 그룹 - 작업 분산) consumer_group = \"order_workers\" consumer1 = KafkaQueueConsumer(queue_topic, consumer_group, \"worker_1\") consumer2 = KafkaQueueConsumer(queue_topic, consumer_group, \"worker_2\") consumer3 = KafkaQueueConsumer(queue_topic, consumer_group, \"worker_3\") try: # 컨슈머 시작 (백그라운드) consumer_tasks = [ asyncio.create_task(consumer1.start_consuming(order_queue_handler)), asyncio.create_task(consumer2.start_consuming(order_queue_handler)), asyncio.create_task(consumer3.start_consuming(order_queue_handler)) ] logger.info(\"=== Kafka Queue 패턴 시작 ===\") # 주문 메시지 전송 orders = [ { \"order_id\": f\"ORD-{i:03d}\", \"customer_id\": f\"CUST-{i%5:03d}\", \"amount\": 1000 + i*100, \"items\": [f\"item-{i}\"] } for i in range(1, 11) ] await producer.send_batch_to_queue(queue_topic, orders) # 처리 완료 대기 await asyncio.sleep(5) # 통계 출력 logger.info(\"=== Queue 처리 결과 ===\") for consumer in [consumer1, consumer2, consumer3]: stats = consumer.get_stats() logger.info(f\"Consumer {stats['consumer_id']}: \" f\"처리됨={stats['processed_count']}, \" f\"에러={stats['error_count']}\") finally: # 정리 consumer1.stop() consumer2.stop() consumer3.stop() for task in consumer_tasks: task.cancel() producer.close() topic_manager.close() async def kafka_topic_example(): \"\"\"Kafka Topic 패턴 예시\"\"\" topic_manager = KafkaTopicManager() # 토픽용 토픽 생성 (다중 파티션) event_topic = \"order_events\" topic_manager.create_topic(event_topic, num_partitions=3) # 프로듀서 생성 producer = KafkaTopicProducer() # 구독자 생성 (각기 다른 그룹 - 모든 메시지 수신) inventory_subscriber = KafkaTopicSubscriber( event_topic, \"inventory_service\", \"inventory_1\" ) notification_subscriber = KafkaTopicSubscriber( event_topic, \"notification_service\", \"notification_1\" ) try: # 구독자 시작 (백그라운드) subscriber_tasks = [ asyncio.create_task( inventory_subscriber.start_subscribing(inventory_topic_handler) ), asyncio.create_task( notification_subscriber.start_subscribing(notification_topic_handler) ) ] logger.info(\"=== Kafka Topic 패턴 시작 ===\") # 잠시 대기 (구독자 준비 시간) await asyncio.sleep(2) # 이벤트 메시지 발행 events = [ { \"event_type\": \"order_completed\", \"order_id\": f\"ORD-{i:03d}\", \"customer_id\": f\"CUST-{i%3:03d}\", \"amount\": 1500 + i*200, \"items\": [f\"item-{i}\", f\"item-{i+5}\"] } for i in range(1, 6) ] await producer.publish_batch_to_topic(event_topic, events) # 처리 완료 대기 await asyncio.sleep(5) # 통계 출력 logger.info(\"=== Topic 처리 결과 ===\") for subscriber in [inventory_subscriber, notification_subscriber]: stats = subscriber.get_stats() logger.info(f\"Subscriber {stats['subscriber_id']}: \" f\"처리됨={stats['processed_count']}, \" f\"에러={stats['error_count']}\") finally: # 정리 inventory_subscriber.stop() notification_subscriber.stop() for task in subscriber_tasks: task.cancel() producer.close() topic_manager.close() # 메인 실행 함수 async def main(): \"\"\"메인 실행 함수\"\"\" def signal_handler(signum, frame): logger.info(\"프로그램 종료 신호 받음\") sys.exit(0) # 시그널 핸들러 등록 signal.signal(signal.SIGINT, signal_handler) signal.signal(signal.SIGTERM, signal_handler) try: logger.info(\"Kafka 예시 시작\") # Queue 패턴 예시 실행 await kafka_queue_example() await asyncio.sleep(2) # Topic 패턴 예시 실행 await kafka_topic_example() logger.info(\"Kafka 예시 완료\") except Exception as e: logger.error(f\"실행 중 오류 발생: {e}\") logger.info(\"프로그램 종료\") if __name__ == \"__main__\": asyncio.run(main()) 사례 3: 주문 처리 시스템 시스템 구성:\n구성 요소 설명 Queue order_queue: 작업 (Task) 전용. FIFO 처리 보장. Exchange events: fanout 타입. 모든 구독자에게 메시지를 broadcast. Producer 주문 생성 시스템. Queue 에 작업 메시지 전송 또는 이벤트 발행. Consumer 주문 처리 시스템. Queue 에서 작업 수신 후 처리. Subscriber 이벤트 처리 시스템들. 이벤트를 받아 로그 기록, 알림 등 수행. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ┌───────────────┐ │ Order Client │ └──────┬────────┘ │ ▼ ┌────────────────────┐ │ RabbitMQ Broker │ │ ┌───────────────┐ │ │ │ Queue: order │ │◄───── Consumer (Order Processor) │ └───────────────┘ │ │ ┌───────────────┐ │ │ │ Exchange: │ │ │ │ events(fan) │ │◄───── Multiple Subscribers │ └───────────────┘ │ └────────────────────┘ Queue 방식 (Point-to-Point): order_queue 라는 이름의 큐에 메시지를 하나의 소비자가 처리. FIFO 기반으로 작업 (Task) 처리가 적합. Topic 방식 (Fanout Exchange 사용): events 라는 fanout exchange 를 통해 여러 소비자에게 동시에 브로드캐스트. 이벤트 알림/상태 변경 전파에 적합. 메시지 흐름 (Workflow):\nQueue 기반 (작업 처리용) Producer (producer_queue.py): order_queue 에 \"order_id\": 12345, \"status\": \"NEW\" 메시지 전송. Consumer (consumer_queue.py): 큐에 메시지가 도착하면 한 명의 소비자가 처리. 메시지는 큐에서 제거됨. Topic 기반 (이벤트 브로드캐스트용) Producer (producer_topic.py): events exchange 에 \"event\": \"ORDER_CREATED\" 메시지 전송. fanout 타입으로, 라우팅 키 없이 모든 바인딩된 큐에 전송. Subscriber (subscriber_topic.py): 빈 queue 선언 후 events exchange 에 바인딩. 동일한 이벤트를 여러 구독자들이 동시에 수신 가능. 구현 예시:\nQueue 예시 (Point-to-Point)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # producer_queue.py import pika connection = pika.BlockingConnection(pika.ConnectionParameters('localhost')) channel = connection.channel() channel.queue_declare(queue='order_queue') # 주문 메시지 발행 channel.basic_publish(exchange='', routing_key='order_queue', body='{\"order_id\": 12345, \"status\": \"NEW\"}') print(\"Order sent to Queue\") connection.close() 1 2 3 4 5 6 7 8 9 10 11 12 13 # consumer_queue.py import pika def callback(ch, method, properties, body): print(f\"[x] Received Order: {body}\") connection = pika.BlockingConnection(pika.ConnectionParameters('localhost')) channel = connection.channel() channel.queue_declare(queue='order_queue') channel.basic_consume(queue='order_queue', on_message_callback=callback, auto_ack=True) print(\"Waiting for orders…\") channel.start_consuming() Topic 예시 (Publish-Subscribe)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # producer_topic.py import pika connection = pika.BlockingConnection(pika.ConnectionParameters('localhost')) channel = connection.channel() # Topic exchange 선언 channel.exchange_declare(exchange='events', exchange_type='fanout') # 이벤트 브로드캐스트 channel.basic_publish(exchange='events', routing_key='', body='{\"event\": \"ORDER_CREATED\"}') print(\"Event broadcasted\") connection.close() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # subscriber_topic.py import pika def callback(ch, method, properties, body): print(f\"[x] Received Event: {body}\") connection = pika.BlockingConnection(pika.ConnectionParameters('localhost')) channel = connection.channel() # 이벤트 exchange 선언 channel.exchange_declare(exchange='events', exchange_type='fanout') result = channel.queue_declare(queue='', exclusive=True) queue_name = result.method.queue # 이벤트 구독 channel.queue_bind(exchange='events', queue=queue_name) channel.basic_consume(queue=queue_name, on_message_callback=callback, auto_ack=True) print(\"Waiting for events…\") channel.start_consuming() 사례 4: 사용자 알림 시스템 (Kafka Topic 기반) 앱에서 사용자 이벤트가 발생했을 때, 여러 컴포넌트가 이를 실시간으로 반응해야 하는 구조 구성\n시스템 구성:\nProducer: 사용자 앱에서 행동 발생 시 이벤트 발행 Topic: Kafka Topic–user-events Consumers: Notification Service (푸시알림) Logging Service (감사 기록) Analytics Engine (실시간 통계) flowchart TD App[Mobile App] --\u003e KafkaTopic[\"Kafka Topic: user-events\"] KafkaTopic --\u003e NotiService[Notification Service] KafkaTopic --\u003e LogService[Logging Service] KafkaTopic --\u003e AnalyticsEngine[Analytics Engine] Workflow:\n사용자가 앱에서 특정 행동을 수행함 이벤트가 Kafka Topic 에 발행됨 각각의 서비스가 독립적으로 해당 이벤트를 수신하고 자체 처리 수행 Kafka Topic 유무에 따른 차이:\n구분 존재할 경우 존재하지 않을 경우 메시지 처리 구조 느슨한 결합, 병렬 분기 강결합, 동기 호출 중심 확장성 독립적 확장 용이 하나의 호출 체인에 의존 유지보수 각 서비스 단위 테스트 용이 전체 시스템 수정 필요 주목할 내용 카테고리 항목 설명 관련 기술 / 시스템 전달 방식 Push vs Pull Queue 는 Pull 기반 소비, Topic 은 Push 또는 Hybrid 방식 가능. Kafka (Pull), SNS (Push), MQTT 확장성 설계 Partitioning 메시지를 물리적으로 분할하여 트래픽을 분산하고 병렬 처리를 통해 성능을 향상시킴. Kafka Partition, SQS Shard Consumer Scaling Consumer Group 을 통한 병렬 소비 확장. Partition 수와 균형 있게 설계되어야 함. Kafka Consumer Group, Celery Workers 신뢰성/무결성 Acknowledgment (Ack) 메시지 수신 확인을 통해 손실 방지 및 재전송 제어. Kafka Offset Commit, RabbitMQ Ack Dead Letter Queue 처리 실패 메시지를 보관하여 재처리 가능하도록 함. 장애 분석 및 경고 트리거로도 활용 가능. Kafka DLQ, RabbitMQ DLX Idempotency 중복된 메시지라도 같은 결과를 보장하는 소비자 처리 로직 설계. 중복 이벤트 발생 시 데이터 무결성 유지. Webhook, Event Consumer 처리 전략 Offset \u0026 Replay 메시지의 소비 위치를 관리하여 리플레이, 복기, 재처리 등 고급 처리 전략을 구현 가능. Kafka Offset, Pulsar Cursor TTL (Time-To-Live) 메시지의 생명 주기를 제한하여 오랫동안 소비되지 않는 메시지를 자동으로 정리. SQS Message TTL, Kafka Retention 라우팅/필터링 Message Routing Topic/Exchange 기반의 메시지 라우팅 설계. Routing Key 와 Binding Rule 로 목적지 결정. RabbitMQ Exchange, SNS Topic Filter Attribute Filtering 메시지 속성 기반으로 구독자가 원하는 조건만 필터링 수신. SNS Filter Policy, JMS Selectors 패턴/조합 CQRS + Pub/Sub CQRS(Command/Query 분리) 구조와 Topic 기반 메시징 결합으로 읽기/쓰기 모델 최적화. Event Sourcing with Kafka 성능 최적화 Batch \u0026 Compression 메시지 묶음 전송과 압축 적용으로 Throughput 향상 및 전송 비용 절감. Kafka Batch Size, GZIP Compression 전송 품질 보장 QoS Level 메시지 전송 품질 설정: At Most Once / At Least Once / Exactly Once MQTT QoS, Kafka Delivery Semantics 장애 회복 Backpressure Handling 소비자가 처리 속도를 초과할 경우, 흐름 제어 및 재시도/대기 메커니즘으로 안정화 필요. Reactive Streams, Kafka Lag Monitor Queue 중심 시스템은 작업 처리 (Task Queue) 용도에 최적이며, Pull 기반, 1:1 처리, Ack/DLQ 중심의 신뢰성 보장 구조. Topic 중심 시스템은 이벤트 브로드캐스트 및 다수 소비자 처리에 유리하며, Push 기반 + 필터링 + 확장성 중심 설계가 필요. Kafka 와 RabbitMQ 는 각각의 특징을 극대화하며, 다양한 **복합 아키텍처 (CQRS, Event Sourcing, Retry Workflow)**에서 병행 사용됨. 실제 아키텍처 설계 시 성능, 확장성, 무결성, 복원력, 필터링, 그리고 QoS 정책까지 종합적으로 고려해야 함. 반드시 학습해야할 내용 카테고리 주제 핵심 개념 / 항목 설명 및 실무 적용 포인트 메시징 모델 Queue vs. Topic P2P (1:1), Pub/Sub (1:N) Queue 는 단일 소비자 처리에 적합, Topic 은 다수 구독자에게 브로드캐스트 용도 메시징 프로토콜 AMQP, MQTT AMQP = 복잡한 라우팅, MQTT = 경량 통신 RabbitMQ → AMQP 기반 / IoT 및 저전력 → MQTT 사용 (예: 센서 데이터) 메시지 보장 QoS (At-Least-Once 등) At-Most-Once / At-Least-Once / Exactly-Once 메시지 유실/중복 방지 및 시스템 신뢰성 확보. Kafka 는 At-least-once 기본, Exactly-once 지원 필요 시 구성 필요 신뢰성/순서 Ack, Offset, Delivery Semantics Auto/Manual Ack, Kafka Offset 메시지 누락 방지, 재처리 가능성 확보. Ack 와 Offset 을 통해 중복 처리 방지 및 순서 보장 확장성 설계 Partitioning Kafka, RabbitMQ 의 파티션 설계 병렬 소비 및 부하 분산을 위한 핵심 요소. 파티션 수 결정 → Throughput 결정됨 에러 처리 DLQ (Dead Letter Queue) 처리 실패 메시지 격리 재처리, 로깅, 경고를 위한 DLQ 구성 필수. Kafka, RabbitMQ, AWS SQS 모두 DLQ 전략 존재 백프레셔 Backpressure Kafka max.poll.records, RabbitMQ prefetch 소비자 처리 속도 제어 및 생산자 과부하 방지. 처리 병목 구간 진단 및 트래픽 제어 데이터 포맷 Avro, Protobuf, JSON 직렬화 포맷 선택 Avro/Protobuf → 이진 포맷, 속도/용량 우수. JSON → 디버깅 용이하나 느리고 크다 멱등성 Idempotency 메시지 재처리 안전성 같은 메시지 중복 수신 시 결과 일관성 보장. Redis, DB transaction key 활용 등으로 보장 가능 아키텍처 설계 Event-Driven Architecture Loose Coupling, Scalability, Observability 서비스 간 직접 연결 지양. Kafka/NATS 등으로 비동기 이벤트 중심 아키텍처 설계 시 고려해야 할 요소 클라우드 서비스 AWS SQS/SNS, Azure, GCP PubSub Serverless 메시징 서비스 비교 SQS(Queue), SNS(Topic), EventBridge(EDA 연동) → 비용, 확장성, TTL, DLQ, 멱등성 기능 비교 필요 실시간 처리 Kafka Streams, Flink 메시징 + 실시간 데이터 흐름 통합 Kafka Streams → Kafka-native 스트림 처리. Flink → 고급 상태 관리, CEP 등 포함 실시간 분석 DevOps 연계 Kubernetes + Kafka / KEDA 메시지 기반 오토스케일링 메시지 수 (큐 길이) 기반 Horizontal Pod Autoscaler 구현. KEDA + Kafka/RabbitMQ 연동 가능 보안 인증, 암호화, 접근제어 메시지 암호화, IAM 인증 TLS 전송 암호화, JWT 또는 IAM 기반 접근 제어. Kafka 는 ACL 구성, SQS 는 IAM 정책 설정 필수 용어 정리 카테고리 용어 설명 관련 기술/모델 전달 방식 Queue (큐) Point-to-Point 기반 구조. 단일 소비자에게 메시지를 순서대로 (FIFO) 전달. RabbitMQ, SQS, Celery Topic (토픽) Publish-Subscribe 기반 구조. 다수 소비자가 같은 메시지를 수신. Kafka, Pub/Sub, SNS Exchange 메시지를 큐 또는 토픽으로 라우팅하는 라우터 역할. RabbitMQ 의 핵심 컴포넌트. RabbitMQ (Direct/Fanout/Topic/Header) Virtual Topic 큐와 토픽을 조합한 패턴. Pub/Sub 구조 위에 큐 기반 소비자를 추가하여 병렬성 제공. ActiveMQ 처리 전략 FIFO First-In-First-Out. 메시지를 받은 순서대로 소비자에게 전달. 대부분의 큐 시스템에서 기본값 Round-Robin 여러 소비자에게 순환 방식으로 메시지를 분배. RabbitMQ Consumer Load Balancing Fan-out 메시지를 여러 수신자에게 복제하여 전달하는 방식. SNS → SQS, Kafka Partition (파티션) 하나의 토픽 또는 큐를 병렬 처리 가능한 단위로 나눈 구조. Kafka Partition Consumer Group 동일 토픽을 병렬로 처리하기 위한 소비자 집합 단위. 각 파티션은 하나의 그룹 내 소비자에게만 전달됨. Kafka 신뢰성 보장 Acknowledgment (Ack) 메시지 수신/처리 완료를 브로커에 알림으로써 메시지 삭제 또는 재전송 제어. Kafka, RabbitMQ Idempotency 동일 메시지에 대한 중복 처리 방지. 재처리 시 결과가 동일하도록 설계. Kafka Consumer, Webhook 처리 등 Durable Subscription 구독자가 오프라인이어도 메시지를 보존하여 수신 가능하도록 하는 옵션. JMS, MQTT 에러 처리 DLQ (Dead Letter Queue) 처리 실패 메시지를 별도로 저장하여 재처리하거나 로그 확인을 가능하게 하는 큐. RabbitMQ, Kafka, SQS Backpressure 소비자가 처리 가능한 속도보다 빠르게 데이터가 도착할 경우 이를 제어하는 메커니즘. Reactive Streams, Kafka 성능 메트릭 Throughput 단위 시간당 처리 가능한 메시지 수. Kafka: TPS, RabbitMQ: msg/sec Latency 메시지 생성부터 소비까지 걸리는 시간. 전송 시간 + 처리 시간 포함 QoS QoS Level 메시지 전달 보장 수준: At-most-once / At-least-once / Exactly-once MQTT, Kafka 중개자 구성 Broker (브로커) 메시지를 생산자에서 소비자에게 중계하는 핵심 구성 요소. Kafka, RabbitMQ, Pulsar Offset 소비자의 메시지 읽기 위치를 나타내는 지표. 재처리 또는 순서 보장에 활용. Kafka, Pulsar 참고 및 출처 Queues vs Topics: Understanding the Differences in Messaging Frameworks | Medium JMS Topic vs Queues - Stack Overflow How does a Queue compare to a Topic - ActiveMQ Azure Service Bus messaging - queues, topics, and subscriptions | Microsoft Learn Apache Kafka Architecture: What You Need to Know | Upsolver Amazon SQS best practices - AWS Apache Kafka Patterns and Anti-Patterns - DZone Message Queues - System Design - GeeksforGeeks Pub-Sub vs. Message Queues | Baeldung DEV Community: Queues vs Topics Solace Docs: Topic Endpoints and Queues Hevo Data: Kafka Queue vs. Topic System Design School: Message Queue vs Pub-Sub InfoQ: Choosing the Right Message Broker Tibco Queue vs Topic 비교 RabbitMQ AMQP Best Practice in Microservice Architecture Apache Kafka 공식 문서 RabbitMQ 공식 문서: Exchanges and Queues AWS SNS vs SQS 공식 문서 Google Pub/Sub 공식 문서 Microsoft Azure: Message Queues vs Topics vs Subscriptions (ko) Martin Fowler: Event Sourcing ","wordCount":"6720","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2025-04-22T13:39:00Z","dateModified":"2025-04-22T13:39:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/system-design/system-components/application-and-execution-core/messaging-systems/event-brokers-vs-message-brokers/queue-vs-topic/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1 class="post-title entry-hint-parent">Queue vs. Topic</h1><div class=post-description>Queue 와 Topic 은 메시징 시스템의 핵심 통신 패턴으로, Queue 는 point-to-point 모델을 통해 단일 소비자에게 메시지를 전달하는 반면, Topic 은 publish-subscribe 모델을 사용하여 다중 구독자에게 메시지를 브로드캐스트한다. 각각 다른 사용 사례와 특성을 가지며 분산 시스템 설계에서 중요한 역할을 담당한다.</div><div class=post-meta><span title='2025-04-22 13:39:00 +0000 UTC'>April 22, 2025</span>&nbsp;·&nbsp;32 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/System%20Design/System%20Components/Application%20and%20Execution%20Core/Messaging%20Systems/Event%20Brokers%20vs%20Message%20Brokers/queue-vs-topic.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#queue-vs-topic>Queue vs. Topic</a><ul><li><a href=#핵심-개념>핵심 개념</a></li><li><a href=#queue-vs-topic-비교>Queue vs. Topic 비교</a></li><li><a href=#작동-방식>작동 방식</a></li><li><a href=#도전-과제>도전 과제</a></li><li><a href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점</a></li><li><a href=#최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점</a></li><li><a href=#실무-적용-예시>실무 적용 예시</a></li><li><a href=#활용-사례>활용 사례</a></li><li><a href=#주목할-내용>주목할 내용</a></li><li><a href=#반드시-학습해야할-내용>반드시 학습해야할 내용</a></li></ul></li><li><a href=#용어-정리>용어 정리</a></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=queue-vs-topic>Queue vs. Topic<a hidden class=anchor aria-hidden=true href=#queue-vs-topic>#</a></h2><p>Queue 와 Topic 은 메시지 기반 시스템에서 데이터 전달 구조의 핵심 요소로, 시스템 아키텍처와 소비자 처리 방식에 따라 선택된다. Queue 는 Point-to-Point 방식으로 하나의 소비자에게 메시지를 전달하며 작업 분산에 유리하다. 반면 Topic 은 Publish-Subscribe 모델로, 다수의 구독자가 동일한 메시지를 수신할 수 있어 이벤트 브로드캐스팅이나 실시간 알림에 적합하다. 각 방식은 메시지 순서, 중복 수신, 확장성 등 다양한 구현 요소에서 차이를 가지며, 적절한 선택이 시스템 안정성과 확장성에 큰 영향을 미친다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><h4 id=기본-개념>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념>#</a></h4><p><strong>Queue (큐)</strong></p><ul><li><strong>정의</strong>: Point-to-Point 메시징 패턴으로, 메시지가 단일 소비자에게 전달되는 통신 모델</li><li><strong>특성</strong>: FIFO (First-In-First-Out) 순서 보장, 메시지 지속성, 부하 분산</li><li><strong>동작 방식</strong>: 프로듀서가 큐에 메시지를 전송하면, 여러 컨슈머 중 하나만이 해당 메시지를 소비</li></ul><p><strong>Topic (토픽)</strong></p><ul><li><strong>정의</strong>: Publish-Subscribe 메시징 패턴으로, 메시지가 여러 구독자에게 브로드캐스트되는 통신 모델</li><li><strong>특성</strong>: 일대다 통신, 메시지 복제, 실시간 이벤트 전파</li><li><strong>동작 방식</strong>: 퍼블리셔가 토픽에 메시지를 게시하면, 해당 토픽을 구독하는 모든 컨슈머가 메시지 사본을 수신</li></ul><h4 id=실무-구현을-위한-연관성-분석>실무 구현을 위한 연관성 분석<a hidden class=anchor aria-hidden=true href=#실무-구현을-위한-연관성-분석>#</a></h4><p><strong>메시지 브로커 (Message Broker) 연관성</strong></p><ul><li>Apache Kafka, RabbitMQ, ActiveMQ 등에서 Queue 와 Topic 패턴 모두 지원</li><li>브로커는 메시지 라우팅, 지속성, 보안 기능 제공</li></ul><p><strong>확장성 (Scalability) 측면</strong></p><ul><li>Queue: 컨슈머 그룹을 통한 수평적 확장</li><li>Topic: 파티셔닝과 구독자 확장을 통한 대규모 처리</li></ul><p><strong>내결함성 (Fault Tolerance) 구현</strong></p><ul><li>메시지 복제, 확인 응답 (Acknowledgment), 재시도 메커니즘</li><li>Dead Letter Queue/Topic 을 통한 실패 메시지 처리</li></ul><h3 id=queue-vs-topic-비교>Queue vs. Topic 비교<a hidden class=anchor aria-hidden=true href=#queue-vs-topic-비교>#</a></h3><p>Queue 와 Topic 은 메시징 시스템 내에서 메시지 전달, 소비 방식, 신뢰성, 스케일링 방식, 활용 목적 등 다양한 기준에서 차이가 난다.</p><h4 id=기본-특성-비교>기본 특성 비교<a hidden class=anchor aria-hidden=true href=#기본-특성-비교>#</a></h4><table><thead><tr><th>구분</th><th>Queue</th><th>Topic</th></tr></thead><tbody><tr><td>통신 모델</td><td>Point-to-Point</td><td>Publish-Subscribe</td></tr><tr><td>메시지 소비</td><td>단일 컨슈머</td><td>다중 구독자</td></tr><tr><td>메시지 순서</td><td>FIFO 보장</td><td>파티션 내에서만 보장</td></tr><tr><td>메시지 지속성</td><td>소비 후 삭제</td><td>보존 기간에 따라 유지</td></tr><tr><td>부하 분산</td><td>Round-robin 방식</td><td>구독자별 독립적 처리</td></tr></tbody></table><h4 id=성능-특성-비교>성능 특성 비교<a hidden class=anchor aria-hidden=true href=#성능-특성-비교>#</a></h4><table><thead><tr><th>구분</th><th>Queue</th><th>Topic</th></tr></thead><tbody><tr><td>처리량 (Throughput)</td><td>중간 - 높음</td><td>높음</td></tr><tr><td>지연 시간 (Latency)</td><td>낮음</td><td>중간</td></tr><tr><td>메모리 사용량</td><td>낮음</td><td>높음 (구독자 수에 비례)</td></tr><tr><td>네트워크 사용량</td><td>효율적</td><td>구독자 수에 따라 증가</td></tr><tr><td>확장성</td><td>제한적</td><td>높음</td></tr></tbody></table><h4 id=사용-사례-비교>사용 사례 비교<a hidden class=anchor aria-hidden=true href=#사용-사례-비교>#</a></h4><table><thead><tr><th>구분</th><th>Queue</th><th>Topic</th></tr></thead><tbody><tr><td>작업 분산</td><td>적합</td><td>부적합</td></tr><tr><td>이벤트 브로드캐스트</td><td>부적합</td><td>적합</td></tr><tr><td>데이터 스트리밍</td><td>제한적</td><td>적합</td></tr><tr><td>마이크로서비스 통신</td><td>적합</td><td>적합</td></tr><tr><td>실시간 알림</td><td>부적합</td><td>적합</td></tr></tbody></table><h3 id=작동-방식>작동 방식<a hidden class=anchor aria-hidden=true href=#작동-방식>#</a></h3><h4 id=queue-작동-원리>Queue 작동 원리<a hidden class=anchor aria-hidden=true href=#queue-작동-원리>#</a></h4><pre class=mermaid>sequenceDiagram
    participant P as Producer
    participant Q as Queue
    participant C1 as Consumer 1
    participant C2 as Consumer 2
    
    P-&gt;&gt;Q: Send Message 1
    P-&gt;&gt;Q: Send Message 2
    P-&gt;&gt;Q: Send Message 3
    
    Q-&gt;&gt;C1: Deliver Message 1
    C1-&gt;&gt;Q: Acknowledge
    
    Q-&gt;&gt;C2: Deliver Message 2
    C2-&gt;&gt;Q: Acknowledge
    
    Q-&gt;&gt;C1: Deliver Message 3
    C1-&gt;&gt;Q: Acknowledge
</pre><h4 id=topic-작동-원리>Topic 작동 원리<a hidden class=anchor aria-hidden=true href=#topic-작동-원리>#</a></h4><pre class=mermaid>sequenceDiagram
    participant P as Publisher
    participant T as Topic
    participant S1 as Subscriber 1
    participant S2 as Subscriber 2
    
    P-&gt;&gt;T: Publish Message
    
    T-&gt;&gt;S1: Broadcast Copy 1
    T-&gt;&gt;S2: Broadcast Copy 2
    
    S1-&gt;&gt;T: Acknowledge
    S2-&gt;&gt;T: Acknowledge
</pre><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>도전 과제</th><th>원인 또는 설명</th><th>실무적 영향</th><th>대응 전략 / 해결 방안</th></tr></thead><tbody><tr><td><strong>확장성/부하 분산</strong></td><td>파티션 불균형, 소비자 병목</td><td>키 기반 파티셔닝 불균형, 핫 파티션, 소비자 수 제한</td><td>특정 파티션/큐에 부하 집중, 처리량 저하</td><td>키 해시 분산 설계, 파티션 재조정, 컨슈머 그룹 확장, 큐 샤딩</td></tr><tr><td><strong>스케일링 안정성</strong></td><td>컨슈머 리밸런싱 처리 지연</td><td>컨슈머 동적 증가/감소, 네트워크 장애 발생 시 리밸런싱 이벤트 트리거됨</td><td>일시적 처리 중단, 메시지 재전송 발생</td><td>점진적 스케일링, 상태 기반 할당, 협력적 리밸런싱 (Cooperative Rebalancing)</td></tr><tr><td><strong>성능/처리량</strong></td><td>직렬화 오버헤드, 백프레셔</td><td>무거운 메시지 포맷 (JSON 등), 빠른 생산자 - 느린 소비자 속도 불일치</td><td>CPU 부하, 처리량 저하, 큐 적체, 시스템 불안정</td><td>Avro/Protobuf 적용, 배치 처리, prefetch/poll 설정 조정, 회로 차단기 패턴 (Circuit Breaker)</td></tr><tr><td><strong>일관성/정확성</strong></td><td>메시지 순서 보장 어려움</td><td>병렬 소비, 토픽 파티션 분산 처리, 소비자 순서 무시</td><td>이벤트 순서 불일치로 인한 비즈니스 로직 오류</td><td>파티션 키 고정, 단일 소비자 처리, Kafka FIFO 처리, Vector Clock, 이벤트 소싱 적용</td></tr><tr><td><strong>신뢰성</strong></td><td>메시지 유실, 중복 처리 문제</td><td>Ack 실패, 컨슈머 장애, 중복 전송으로 인해 발생</td><td>데이터 누락, 중복 처리, 결과 무결성 손상</td><td>DLQ 구성, Ack + Retry 정책, 멱등성 (ID+Hash 기반) 소비자 구현</td></tr><tr><td><strong>운영/관찰성</strong></td><td>메시지 흐름 및 상태 추적 어려움</td><td>큐는 처리 후 삭제, 토픽은 병렬 소비자 존재 → 추적 어려움</td><td>SLA 준수 실패, 디버깅 난이도 증가</td><td>Trace ID 삽입, 중앙 로깅 + 분산 트레이싱 도입 (OpenTelemetry, Zipkin 등)</td></tr><tr><td><strong>통합/마이그레이션</strong></td><td>큐 ↔ 토픽 전환 시 데이터 정합성 보장 문제</td><td>구조 전환 시 메시지 중복/유실 가능, 중단 없는 서비스 이전 어려움</td><td>전환 중단 시 서비스 중단 또는 누락 이벤트 발생 가능</td><td>중간 브로커 구성, 양방향 브릿지 메시징, 임시 병행 구독 전략</td></tr><tr><td><strong>아키텍처 복잡도</strong></td><td>혼합 패턴 구성 시 복잡성 증가</td><td>Queue/Topic 혼합 사용 시 흐름 파악, 장애 추적, 권한 설정 등 어려움</td><td>운영 비용 증가, 장애 확산 시 전체 영향도 증가</td><td>도메인별 메시징 전략 수립, 토픽 명명 일관화, 문서화 및 메시지 흐름 시각화</td></tr><tr><td><strong>보안/접근 제어</strong></td><td>구독자/컨슈머 인증/인가 누락</td><td>ACL 미적용, 인증 토큰 부재, 메시지 노출 우려</td><td>보안 취약점, 메시지 도난 가능성</td><td>Role 기반 RBAC, TLS 암호화, JWT/OAuth 기반 메시지 인증 적용</td></tr></tbody></table><ul><li><strong>Queue 기반 시스템</strong>은 확장성과 병렬성 한계, 처리 병목이 주요 이슈이며, <strong>소비자 확장 전략</strong>과 <strong>작업 큐 분산 설계</strong>가 핵심.</li><li><strong>Topic 기반 시스템</strong>은 <strong>병렬성은 뛰어나나 순서 보장, 메시지 정합성 유지, 모니터링</strong>에서 도전 과제가 두드러짐.</li><li><strong>모든 아키텍처 공통 이슈</strong>는 신뢰성 확보 (DLQ, 멱등성), 관찰성 향상 (Trace, 상태 저장), 스케일 안정화 (리밸런싱, 파티션 튜닝) 에 집중해야 한다.</li></ul><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>고려 항목</th><th>Queue(큐) 고려사항</th><th>Topic(토픽) 고려사항</th><th>권장 사항 및 주의점</th></tr></thead><tbody><tr><td><strong>전달 패턴</strong></td><td>메시징 모델</td><td>1:1 처리 (Point-to-Point)</td><td>1:N 처리 (Publish-Subscribe)</td><td>요구 사항에 따라 메시징 패턴을 일관되게 설계</td></tr><tr><td><strong>순서 보장</strong></td><td>FIFO 처리</td><td>단일 소비자 구성 시 순서 보장. FIFO Queue 또는 순차 처리 설계 필요</td><td>Partition 내 순서 보장만 가능, 전체 순서 보장은 어려움</td><td>순서 요구 시 단일 파티션/소비자 설정 또는 순서 제어 로직 구현</td></tr><tr><td><strong>확장성</strong></td><td>소비자 수 및 병렬 처리</td><td>소비자 수를 늘려 작업 병렬화 (Worker Pool)</td><td>Partition + Consumer Group 구조로 병렬 소비</td><td>Partition 수 ≥ Consumer 수 권장. 파티션 증설 시 메시지 재분배 고려 필요</td></tr><tr><td><strong>장애 복원력</strong></td><td>장애 및 실패 대응</td><td>DLQ 구성 필수. 메시지 누락 대비 Ack 기반 재처리 로직 필요</td><td>Durable Subscription, Offset 기반 재처리 및 Replay 가능</td><td>DLQ + 재처리 전략 함께 구성. Topic 은 재생 정책 (log compaction 등) 고려</td></tr><tr><td><strong>중복 방지</strong></td><td>Idempotency 처리</td><td>동일 메시지 재수신 방지를 위한 멱등성 설계 필요</td><td>각 구독자 단위로 중복 수신 방지 처리 필요</td><td>메시지 해시, UUID, Redis Lock 등 멱등성 로직 적용</td></tr><tr><td><strong>모니터링</strong></td><td>시스템 상태 추적</td><td>큐 깊이, 메시지 지연, 소비 실패 추적</td><td>구독자별 처리율, Offset lag, 파티션 상태 추적</td><td>Prometheus + Grafana, DLQ 로그 추적, APM 연계</td></tr><tr><td><strong>성능 최적화</strong></td><td>처리량/지연 튜닝</td><td>Batch 전송, Prefetch 설정, 워커 수 조정</td><td>Compression, BatchSize, Zero-Copy 전송 등</td><td>Throughput ↔ Latency 트레이드오프 균형화 설계</td></tr><tr><td><strong>운영 관리</strong></td><td>메시지 보존 및 재처리</td><td>일반적으로 소비 후 메시지 삭제</td><td>메시지 로그 보존 설정으로 재처리 및 분석 가능 (Kafka log.retention 등)</td><td>장기 보관 필요 시 Topic 선택 + TTL 설정 조합</td></tr><tr><td><strong>보안</strong></td><td>인증/암호화/권한 관리</td><td>TLS, 사용자 인증, 역할 기반 접근 제어 (RBAC)</td><td>TLS, 구독 필터링, ACL 및 Consumer 인증</td><td>민감도에 따라 차등 보안 설정, 브로커 레벨 + 애플리케이션 레벨 이중 보안 적용</td></tr><tr><td><strong>운영 자동화</strong></td><td>오토스케일링/백프레셔</td><td>메시지 증가 시 Worker 자동 확장 + 메시지 Pull 속도 조절</td><td>소비 속도에 따라 Backpressure 전략 도입 필요</td><td>KEDA, Kubernetes HPA 연동, Kafka Lag 기반 스케일링 트리거 고려</td></tr><tr><td><strong>설계 복잡도</strong></td><td>혼합 설계 시 주의점</td><td>Queue/Topic 혼용 시 데이터 흐름 혼란 및 유지보수 난이도 증가 가능</td><td>기능 분리 목적의 멀티 토픽 구성 시 구독자 설계가 복잡해질 수 있음</td><td>도메인 기준 메시징 구조 일관성 확보. 기능별 별도 토픽 설계로 복잡도 분리</td></tr><tr><td><strong>스키마 설계</strong></td><td>메시지 포맷/진화</td><td>JSON/Protobuf/Avro 등 표준 포맷 유지 필요</td><td>스키마 진화 발생 시 하위 호환성 확보 필요</td><td>Schema Registry 도입 권장, 버전 관리 포함</td></tr></tbody></table><h4 id=실무-설계-및-운영-팁-요약>실무 설계 및 운영 팁 요약<a hidden class=anchor aria-hidden=true href=#실무-설계-및-운영-팁-요약>#</a></h4><table><thead><tr><th>항목</th><th>권장 전략 요약</th></tr></thead><tbody><tr><td><strong>순서 보장</strong></td><td>FIFO 가 중요한 경우 큐 사용. Topic 은 파티션 내부에서만 순서 보장 가능</td></tr><tr><td><strong>확장성과 병렬 처리</strong></td><td>Topic + Partition + Consumer Group 조합이 가장 효율적인 병렬 처리 구조</td></tr><tr><td><strong>신뢰성과 재처리</strong></td><td>DLQ, Retry Queue, Ack/Nack 조합을 통한 메시지 유실 방지 전략 필수</td></tr><tr><td><strong>모니터링 및 자동화</strong></td><td>Kafka Lag, Queue Length, Failure Count 등 지표 기반 오토스케일링 및 알림 시스템 구축 권장</td></tr><tr><td><strong>보안</strong></td><td>TLS, 인증 키, 토픽 구독 필터링, RBAC 조합으로 전방위 보안 체계 구축 가능</td></tr><tr><td><strong>복합 구조 설계 시</strong></td><td>CQRS, Saga 등 복합 아키텍처에서 Queue 와 Topic 을 혼합 사용 시 도메인 기반 구분 및 명확한 흐름 설계 필수</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>최적화 항목</th><th>Queue(큐) 최적화 전략</th><th>Topic(토픽) 최적화 전략</th><th>실무 권장사항 요약</th></tr></thead><tbody><tr><td><strong>메시지 크기/포맷</strong></td><td>메시지 크기 및 직렬화 최적화</td><td>메시지 크기 10MB 이하 유지, JSON 대신 Avro/Protobuf 활용</td><td>이벤트 페이로드 최소화, 경량 직렬화 포맷 사용</td><td>JSON → Avro 전환, Schema Registry 로 일관성 유지</td></tr><tr><td><strong>처리량/지연 시간</strong></td><td>병렬 처리 및 Throughput</td><td>Prefetch 조정, Consumer 수 증가, 멀티 워커 구성</td><td>파티션 수 증가, 컨슈머 그룹 병렬 처리</td><td>처리량 기준 → Partition/Consumer 수 동적 조정</td></tr><tr><td><strong>백프레셔</strong></td><td>소비자 부하 제어</td><td>메시지 rate limit 설정, reject + requeue 전략</td><td>구독자 수 조절, 이벤트 필터링/샤딩 적용</td><td>처리 병목 시 prefetch 또는 poll 조정, CPU 모니터링 필수</td></tr><tr><td><strong>리소스 최적화</strong></td><td>시스템 자원 할당 및 스케일링</td><td>CPU/메모리/디스크 모니터링, 워커 오토스케일링 구성</td><td>브로커/컨슈머 오토스케일링, 클러스터 모니터링</td><td>Kubernetes + HPA/KEDA 조합 권장</td></tr><tr><td><strong>스토리지 최적화</strong></td><td>메시지 저장소 관리</td><td>TTL 설정, 수동/자동 배치 삭제, 디스크 압축 설정</td><td>Retention 정책 설정, 파티션 간 균등 분산</td><td>Kafka 는 retention.ms, RabbitMQ 는 max-length 등 관리 필요</td></tr><tr><td><strong>신뢰성/오류 처리</strong></td><td>장애 대응 전략</td><td>DLQ 구성, 재시도 + 지수 백오프, manual ack 설정</td><td>Durable Subscription, 재전송 정책, Offset commit 전략</td><td>DLQ 는 필수 구성 요소, 오류 로깅 및 Alerting 도입 권장</td></tr><tr><td><strong>확장성 설계</strong></td><td>수평 확장 구조</td><td>큐 단위 분리, 컨슈머 워커 클러스터 구성</td><td>파티션 기반 구독자 병렬화, 구독자 샤딩 및 부하 분산</td><td>사용자 그룹별 큐 or 파티션 구성, 클러스터 수준 확장 고려</td></tr><tr><td><strong>지연 최소화</strong></td><td>네트워크/연결 관리</td><td>연결 풀링, 메시지 배치 처리, 전용 회선 구성</td><td>로컬 배치 처리, 고속 네트워크 구성, 메시지 필터링 적용</td><td>네트워크 지연 발생 시 RPC → 비동기 메시징 전환 고려</td></tr><tr><td><strong>중복/멱등성 보장</strong></td><td>Idempotency</td><td>메시지 해시, Unique ID, 중복 방지 DB Key 적용</td><td>이벤트 ID 기반 멱등성 로직, 구독자별 deduplication 처리</td><td>재처리에도 안전한 메시지 구조 설계 (e.g., DB Upsert 패턴)</td></tr><tr><td><strong>운영 편의성</strong></td><td>모니터링 및 Alerting</td><td>큐 길이, 처리 시간, 실패률 모니터링 + Alert 구성</td><td>토픽 오프셋 지연, 구독자 상태 모니터링</td><td>Prometheus + Grafana, Kafka UI, RabbitMQ Management Plugin 활용</td></tr></tbody></table><ul><li><strong>Queue 는 작업 단위 (Task) 중심 처리</strong>에 최적화되어 있고, <strong>Topic 은 이벤트 브로드캐스트 처리</strong>에 강점을 가진다.</li><li>**공통적으로 병목 구간 식별, 리소스 모니터링, 자동화된 장애 처리 (DLQ + Alert)**가 중요하다.</li><li><strong>Kafka, RabbitMQ, SQS/SNS 등</strong> 각 브로커에 따라 일부 설정 방식이 다르므로 시스템에 맞는 최적화 전략 수립 필요.</li><li><strong>직렬화 포맷과 메시지 크기 최적화</strong>는 네트워크/스토리지 부하를 줄이는 데 핵심이다.</li></ul><h3 id=실무-적용-예시>실무 적용 예시<a hidden class=anchor aria-hidden=true href=#실무-적용-예시>#</a></h3><table><thead><tr><th>도메인/시스템</th><th>사용 목적</th><th>메시징 방식</th><th>적용 방식 예시</th><th>기대 효과 및 특징</th></tr></thead><tbody><tr><td><strong>주문 처리 시스템</strong></td><td>비동기 작업 처리</td><td><strong>Queue</strong></td><td>주문 요청 → 큐 (RabbitMQ/SQS) → 백엔드 워커</td><td>중복 방지, 신뢰성 확보, 부하 분산</td></tr><tr><td><strong>알림 시스템</strong></td><td>실시간 이벤트 브로드캐스트</td><td><strong>Topic</strong></td><td>이벤트 발생 → 토픽 (Kafka/PubSub) → 모바일/Web/Slack 등 다중 구독자</td><td>동시 사용자 대상 브로드캐스트, 반응 속도 향상</td></tr><tr><td><strong>로그 수집 및 분석</strong></td><td>로그 집계 및 전처리</td><td><strong>Queue</strong></td><td>서버 로그 → 큐 → 로그 파서/적재기 → DB/S3 등</td><td>안정적인 수집, 실패 메시지 재처리, 단일 소비 구조</td></tr><tr><td></td><td>다중 로그 시스템 연동</td><td><strong>Topic</strong></td><td>앱 로그 → 토픽 → Kibana + S3 + Data Lake 등</td><td>다수 분석 시스템에 병렬 전송, 유연한 로그 분기 처리</td></tr><tr><td><strong>IoT/센서 데이터</strong></td><td>대규모 이벤트 스트림 처리</td><td><strong>Topic</strong></td><td>센서 이벤트 → 토픽 → 실시간 분석기 + 알림 시스템</td><td>실시간 통계, 이벤트 기반 경고 시스템 구축 가능</td></tr><tr><td><strong>ETL 파이프라인</strong></td><td>배치/순차 처리</td><td><strong>Queue</strong></td><td>Data Ingest → 큐 → 변환 작업 순차 수행</td><td>처리 순서 보장, 실패 처리 용이</td></tr><tr><td></td><td>실시간 스트리밍 처리</td><td><strong>Topic</strong></td><td>실시간 데이터 수집 → 토픽 → 분석기, 대시보드, 저장 시스템 병렬 전달</td><td>고속 처리, 병렬 확장, 비동기 이벤트 기반 처리</td></tr><tr><td><strong>마이크로서비스 통신</strong></td><td>명령/작업 분산 전달</td><td><strong>Queue</strong></td><td>A 서비스 → 큐 → B 서비스 워커로 명령 전달</td><td>명령 처리의 확장성, 느슨한 결합, 트랜잭션 가능</td></tr><tr><td></td><td>이벤트 기반 상호 작용</td><td><strong>Topic</strong></td><td>도메인 이벤트 → 토픽 발행 → 여러 서비스 구독 (이메일, 포인트, 감사 로그 등)</td><td>CQRS/Event Sourcing 구현, 기능 확장 용이</td></tr><tr><td><strong>데이터 적재/복제</strong></td><td>멀티 싱크 처리</td><td><strong>Topic</strong></td><td>원본 시스템 → 토픽 → 여러 데이터 저장소로 동시에 전송</td><td>일관된 데이터 적재, 리플레이/재처리 가능</td></tr><tr><td><strong>지속 가능성/모니터링</strong></td><td>장애 대비, 재처리</td><td><strong>DLQ (보조 구성)</strong></td><td>처리 실패 메시지 → DLQ → 재시도 큐 또는 관리자 알림 처리</td><td>신뢰성 향상, 재처리 전략 수립 용이</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-실시간-알림-시스템---topic-패턴>사례 1: 실시간 알림 시스템 - Topic 패턴<a hidden class=anchor aria-hidden=true href=#사례-1-실시간-알림-시스템---topic-패턴>#</a></h4><p><strong>시스템 구성</strong></p><pre class=mermaid>flowchart TD
    Backend[Backend Service] --&gt; Broker[메시징 브로커]
    Broker --&gt; Topic[알림 토픽]
    Topic --&gt; User1[User App 1]
    Topic --&gt; User2[User App 2]
    Topic --&gt; User3[User App 3]
    Broker -.-&gt; DLQ
</pre><p><strong>Workflow</strong></p><ol><li>Backend 에서 알림 이벤트 생성 후 토픽으로 발행</li><li>토픽 구독 중인 모든 User App 에게 동시에 메시지 전송</li><li>개별 앱이 각자 알림 확인, 실패 시 DLQ 보관</li></ol><p><strong>주제의 역할:</strong> 동일 이벤트의 멀티 소비, 브로드캐스트, 확장성과 실시간성<br><strong>유무 차이:</strong> Topic 없으면 각 대상마다 별도 메시지 송신 필요 → 시스템 과부하, 누락/지연 위험</p><p><strong>구현 예시</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Kafka 토픽 방식 알림 발행 및 소비 예시</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span><span class=p>,</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Producer: 알림 이벤트 발행</span>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span><span class=n>bootstrap_servers</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;notify-topic&#39;</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;{&#34;event&#34;:&#34;ALERT&#34;,&#34;msg&#34;:&#34;서버 점검 공지&#34;}&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Consumer: 알림 구독</span>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;notify-topic&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>group_id</span><span class=o>=</span><span class=s1>&#39;user-app&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[User App] 수신된 알림: </span><span class=si>{</span><span class=n>msg</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 여러 User App 인스턴스가 동시에 구독하면 각각 메시지 수신</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-2-전자상거래-주문-처리-시스템>사례 2: 전자상거래 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-2-전자상거래-주문-처리-시스템>#</a></h4><p><strong>시스템 구성</strong>:</p><p><strong>Queue 기반 주문 처리</strong></p><pre class=mermaid>graph LR
    UI[웹 인터페이스] --&gt; OQ[주문 큐]
    OQ --&gt; OP1[주문 처리 워커 1]
    OQ --&gt; OP2[주문 처리 워커 2]
    OQ --&gt; OP3[주문 처리 워커 3]
    OP1 --&gt; DB[(주문 DB)]
    OP2 --&gt; DB
    OP3 --&gt; DB
</pre><p><strong>Topic 기반 이벤트 처리</strong></p><pre class=mermaid>graph TB
    OP[주문 처리 완료] --&gt; ET[이벤트 토픽]
    ET --&gt; IS[재고 서비스]
    ET --&gt; NS[알림 서비스]
    ET --&gt; AS[분석 서비스]
    ET --&gt; BS[빌링 서비스]
</pre><p><strong>Workflow</strong>:</p><ul><li><strong>Queue 워크플로우</strong><ol><li>사용자 주문 접수 → 주문 큐에 메시지 추가</li><li>주문 처리 워커들이 경쟁적으로 주문 획득</li><li>주문 검증 및 처리 → 데이터베이스 업데이트</li><li>처리 완료 확인 응답</li></ol></li><li><strong>Topic 워크플로우</strong><ol><li>주문 처리 완료 → 이벤트 토픽에 발행</li><li>재고 서비스: 재고 차감</li><li>알림 서비스: 고객 알림 발송</li><li>분석 서비스: 판매 데이터 수집</li><li>빌링 서비스: 정산 처리</li></ol></li></ul><p><strong>Queue vs. Topic 유무에 따른 차이점</strong></p><ul><li><strong>Queue 미사용 시</strong><ul><li>동기식 처리로 응답 시간 증가</li><li>트래픽 급증 시 시스템 과부하</li><li>단일 장애점 위험 증가</li></ul></li><li><strong>Topic 미사용 시</strong><ul><li>서비스 간 강한 결합</li><li>순차적 처리로 전체 지연 발생</li><li>새로운 서비스 추가 시 기존 코드 수정 필요</li></ul></li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>  1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>  2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>  3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>  4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>  5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6>  6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7>  7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8>  8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9>  9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10> 10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11> 11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12> 12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13> 13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14> 14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15> 15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16> 16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17> 17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18> 18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19> 19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20> 20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21> 21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22> 22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23> 23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24> 24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25> 25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26> 26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27> 27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28> 28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29> 29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30> 30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31> 31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32> 32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33> 33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34> 34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35> 35</a>
</span><span class=lnt id=hl-6-36><a class=lnlinks href=#hl-6-36> 36</a>
</span><span class=lnt id=hl-6-37><a class=lnlinks href=#hl-6-37> 37</a>
</span><span class=lnt id=hl-6-38><a class=lnlinks href=#hl-6-38> 38</a>
</span><span class=lnt id=hl-6-39><a class=lnlinks href=#hl-6-39> 39</a>
</span><span class=lnt id=hl-6-40><a class=lnlinks href=#hl-6-40> 40</a>
</span><span class=lnt id=hl-6-41><a class=lnlinks href=#hl-6-41> 41</a>
</span><span class=lnt id=hl-6-42><a class=lnlinks href=#hl-6-42> 42</a>
</span><span class=lnt id=hl-6-43><a class=lnlinks href=#hl-6-43> 43</a>
</span><span class=lnt id=hl-6-44><a class=lnlinks href=#hl-6-44> 44</a>
</span><span class=lnt id=hl-6-45><a class=lnlinks href=#hl-6-45> 45</a>
</span><span class=lnt id=hl-6-46><a class=lnlinks href=#hl-6-46> 46</a>
</span><span class=lnt id=hl-6-47><a class=lnlinks href=#hl-6-47> 47</a>
</span><span class=lnt id=hl-6-48><a class=lnlinks href=#hl-6-48> 48</a>
</span><span class=lnt id=hl-6-49><a class=lnlinks href=#hl-6-49> 49</a>
</span><span class=lnt id=hl-6-50><a class=lnlinks href=#hl-6-50> 50</a>
</span><span class=lnt id=hl-6-51><a class=lnlinks href=#hl-6-51> 51</a>
</span><span class=lnt id=hl-6-52><a class=lnlinks href=#hl-6-52> 52</a>
</span><span class=lnt id=hl-6-53><a class=lnlinks href=#hl-6-53> 53</a>
</span><span class=lnt id=hl-6-54><a class=lnlinks href=#hl-6-54> 54</a>
</span><span class=lnt id=hl-6-55><a class=lnlinks href=#hl-6-55> 55</a>
</span><span class=lnt id=hl-6-56><a class=lnlinks href=#hl-6-56> 56</a>
</span><span class=lnt id=hl-6-57><a class=lnlinks href=#hl-6-57> 57</a>
</span><span class=lnt id=hl-6-58><a class=lnlinks href=#hl-6-58> 58</a>
</span><span class=lnt id=hl-6-59><a class=lnlinks href=#hl-6-59> 59</a>
</span><span class=lnt id=hl-6-60><a class=lnlinks href=#hl-6-60> 60</a>
</span><span class=lnt id=hl-6-61><a class=lnlinks href=#hl-6-61> 61</a>
</span><span class=lnt id=hl-6-62><a class=lnlinks href=#hl-6-62> 62</a>
</span><span class=lnt id=hl-6-63><a class=lnlinks href=#hl-6-63> 63</a>
</span><span class=lnt id=hl-6-64><a class=lnlinks href=#hl-6-64> 64</a>
</span><span class=lnt id=hl-6-65><a class=lnlinks href=#hl-6-65> 65</a>
</span><span class=lnt id=hl-6-66><a class=lnlinks href=#hl-6-66> 66</a>
</span><span class=lnt id=hl-6-67><a class=lnlinks href=#hl-6-67> 67</a>
</span><span class=lnt id=hl-6-68><a class=lnlinks href=#hl-6-68> 68</a>
</span><span class=lnt id=hl-6-69><a class=lnlinks href=#hl-6-69> 69</a>
</span><span class=lnt id=hl-6-70><a class=lnlinks href=#hl-6-70> 70</a>
</span><span class=lnt id=hl-6-71><a class=lnlinks href=#hl-6-71> 71</a>
</span><span class=lnt id=hl-6-72><a class=lnlinks href=#hl-6-72> 72</a>
</span><span class=lnt id=hl-6-73><a class=lnlinks href=#hl-6-73> 73</a>
</span><span class=lnt id=hl-6-74><a class=lnlinks href=#hl-6-74> 74</a>
</span><span class=lnt id=hl-6-75><a class=lnlinks href=#hl-6-75> 75</a>
</span><span class=lnt id=hl-6-76><a class=lnlinks href=#hl-6-76> 76</a>
</span><span class=lnt id=hl-6-77><a class=lnlinks href=#hl-6-77> 77</a>
</span><span class=lnt id=hl-6-78><a class=lnlinks href=#hl-6-78> 78</a>
</span><span class=lnt id=hl-6-79><a class=lnlinks href=#hl-6-79> 79</a>
</span><span class=lnt id=hl-6-80><a class=lnlinks href=#hl-6-80> 80</a>
</span><span class=lnt id=hl-6-81><a class=lnlinks href=#hl-6-81> 81</a>
</span><span class=lnt id=hl-6-82><a class=lnlinks href=#hl-6-82> 82</a>
</span><span class=lnt id=hl-6-83><a class=lnlinks href=#hl-6-83> 83</a>
</span><span class=lnt id=hl-6-84><a class=lnlinks href=#hl-6-84> 84</a>
</span><span class=lnt id=hl-6-85><a class=lnlinks href=#hl-6-85> 85</a>
</span><span class=lnt id=hl-6-86><a class=lnlinks href=#hl-6-86> 86</a>
</span><span class=lnt id=hl-6-87><a class=lnlinks href=#hl-6-87> 87</a>
</span><span class=lnt id=hl-6-88><a class=lnlinks href=#hl-6-88> 88</a>
</span><span class=lnt id=hl-6-89><a class=lnlinks href=#hl-6-89> 89</a>
</span><span class=lnt id=hl-6-90><a class=lnlinks href=#hl-6-90> 90</a>
</span><span class=lnt id=hl-6-91><a class=lnlinks href=#hl-6-91> 91</a>
</span><span class=lnt id=hl-6-92><a class=lnlinks href=#hl-6-92> 92</a>
</span><span class=lnt id=hl-6-93><a class=lnlinks href=#hl-6-93> 93</a>
</span><span class=lnt id=hl-6-94><a class=lnlinks href=#hl-6-94> 94</a>
</span><span class=lnt id=hl-6-95><a class=lnlinks href=#hl-6-95> 95</a>
</span><span class=lnt id=hl-6-96><a class=lnlinks href=#hl-6-96> 96</a>
</span><span class=lnt id=hl-6-97><a class=lnlinks href=#hl-6-97> 97</a>
</span><span class=lnt id=hl-6-98><a class=lnlinks href=#hl-6-98> 98</a>
</span><span class=lnt id=hl-6-99><a class=lnlinks href=#hl-6-99> 99</a>
</span><span class=lnt id=hl-6-100><a class=lnlinks href=#hl-6-100>100</a>
</span><span class=lnt id=hl-6-101><a class=lnlinks href=#hl-6-101>101</a>
</span><span class=lnt id=hl-6-102><a class=lnlinks href=#hl-6-102>102</a>
</span><span class=lnt id=hl-6-103><a class=lnlinks href=#hl-6-103>103</a>
</span><span class=lnt id=hl-6-104><a class=lnlinks href=#hl-6-104>104</a>
</span><span class=lnt id=hl-6-105><a class=lnlinks href=#hl-6-105>105</a>
</span><span class=lnt id=hl-6-106><a class=lnlinks href=#hl-6-106>106</a>
</span><span class=lnt id=hl-6-107><a class=lnlinks href=#hl-6-107>107</a>
</span><span class=lnt id=hl-6-108><a class=lnlinks href=#hl-6-108>108</a>
</span><span class=lnt id=hl-6-109><a class=lnlinks href=#hl-6-109>109</a>
</span><span class=lnt id=hl-6-110><a class=lnlinks href=#hl-6-110>110</a>
</span><span class=lnt id=hl-6-111><a class=lnlinks href=#hl-6-111>111</a>
</span><span class=lnt id=hl-6-112><a class=lnlinks href=#hl-6-112>112</a>
</span><span class=lnt id=hl-6-113><a class=lnlinks href=#hl-6-113>113</a>
</span><span class=lnt id=hl-6-114><a class=lnlinks href=#hl-6-114>114</a>
</span><span class=lnt id=hl-6-115><a class=lnlinks href=#hl-6-115>115</a>
</span><span class=lnt id=hl-6-116><a class=lnlinks href=#hl-6-116>116</a>
</span><span class=lnt id=hl-6-117><a class=lnlinks href=#hl-6-117>117</a>
</span><span class=lnt id=hl-6-118><a class=lnlinks href=#hl-6-118>118</a>
</span><span class=lnt id=hl-6-119><a class=lnlinks href=#hl-6-119>119</a>
</span><span class=lnt id=hl-6-120><a class=lnlinks href=#hl-6-120>120</a>
</span><span class=lnt id=hl-6-121><a class=lnlinks href=#hl-6-121>121</a>
</span><span class=lnt id=hl-6-122><a class=lnlinks href=#hl-6-122>122</a>
</span><span class=lnt id=hl-6-123><a class=lnlinks href=#hl-6-123>123</a>
</span><span class=lnt id=hl-6-124><a class=lnlinks href=#hl-6-124>124</a>
</span><span class=lnt id=hl-6-125><a class=lnlinks href=#hl-6-125>125</a>
</span><span class=lnt id=hl-6-126><a class=lnlinks href=#hl-6-126>126</a>
</span><span class=lnt id=hl-6-127><a class=lnlinks href=#hl-6-127>127</a>
</span><span class=lnt id=hl-6-128><a class=lnlinks href=#hl-6-128>128</a>
</span><span class=lnt id=hl-6-129><a class=lnlinks href=#hl-6-129>129</a>
</span><span class=lnt id=hl-6-130><a class=lnlinks href=#hl-6-130>130</a>
</span><span class=lnt id=hl-6-131><a class=lnlinks href=#hl-6-131>131</a>
</span><span class=lnt id=hl-6-132><a class=lnlinks href=#hl-6-132>132</a>
</span><span class=lnt id=hl-6-133><a class=lnlinks href=#hl-6-133>133</a>
</span><span class=lnt id=hl-6-134><a class=lnlinks href=#hl-6-134>134</a>
</span><span class=lnt id=hl-6-135><a class=lnlinks href=#hl-6-135>135</a>
</span><span class=lnt id=hl-6-136><a class=lnlinks href=#hl-6-136>136</a>
</span><span class=lnt id=hl-6-137><a class=lnlinks href=#hl-6-137>137</a>
</span><span class=lnt id=hl-6-138><a class=lnlinks href=#hl-6-138>138</a>
</span><span class=lnt id=hl-6-139><a class=lnlinks href=#hl-6-139>139</a>
</span><span class=lnt id=hl-6-140><a class=lnlinks href=#hl-6-140>140</a>
</span><span class=lnt id=hl-6-141><a class=lnlinks href=#hl-6-141>141</a>
</span><span class=lnt id=hl-6-142><a class=lnlinks href=#hl-6-142>142</a>
</span><span class=lnt id=hl-6-143><a class=lnlinks href=#hl-6-143>143</a>
</span><span class=lnt id=hl-6-144><a class=lnlinks href=#hl-6-144>144</a>
</span><span class=lnt id=hl-6-145><a class=lnlinks href=#hl-6-145>145</a>
</span><span class=lnt id=hl-6-146><a class=lnlinks href=#hl-6-146>146</a>
</span><span class=lnt id=hl-6-147><a class=lnlinks href=#hl-6-147>147</a>
</span><span class=lnt id=hl-6-148><a class=lnlinks href=#hl-6-148>148</a>
</span><span class=lnt id=hl-6-149><a class=lnlinks href=#hl-6-149>149</a>
</span><span class=lnt id=hl-6-150><a class=lnlinks href=#hl-6-150>150</a>
</span><span class=lnt id=hl-6-151><a class=lnlinks href=#hl-6-151>151</a>
</span><span class=lnt id=hl-6-152><a class=lnlinks href=#hl-6-152>152</a>
</span><span class=lnt id=hl-6-153><a class=lnlinks href=#hl-6-153>153</a>
</span><span class=lnt id=hl-6-154><a class=lnlinks href=#hl-6-154>154</a>
</span><span class=lnt id=hl-6-155><a class=lnlinks href=#hl-6-155>155</a>
</span><span class=lnt id=hl-6-156><a class=lnlinks href=#hl-6-156>156</a>
</span><span class=lnt id=hl-6-157><a class=lnlinks href=#hl-6-157>157</a>
</span><span class=lnt id=hl-6-158><a class=lnlinks href=#hl-6-158>158</a>
</span><span class=lnt id=hl-6-159><a class=lnlinks href=#hl-6-159>159</a>
</span><span class=lnt id=hl-6-160><a class=lnlinks href=#hl-6-160>160</a>
</span><span class=lnt id=hl-6-161><a class=lnlinks href=#hl-6-161>161</a>
</span><span class=lnt id=hl-6-162><a class=lnlinks href=#hl-6-162>162</a>
</span><span class=lnt id=hl-6-163><a class=lnlinks href=#hl-6-163>163</a>
</span><span class=lnt id=hl-6-164><a class=lnlinks href=#hl-6-164>164</a>
</span><span class=lnt id=hl-6-165><a class=lnlinks href=#hl-6-165>165</a>
</span><span class=lnt id=hl-6-166><a class=lnlinks href=#hl-6-166>166</a>
</span><span class=lnt id=hl-6-167><a class=lnlinks href=#hl-6-167>167</a>
</span><span class=lnt id=hl-6-168><a class=lnlinks href=#hl-6-168>168</a>
</span><span class=lnt id=hl-6-169><a class=lnlinks href=#hl-6-169>169</a>
</span><span class=lnt id=hl-6-170><a class=lnlinks href=#hl-6-170>170</a>
</span><span class=lnt id=hl-6-171><a class=lnlinks href=#hl-6-171>171</a>
</span><span class=lnt id=hl-6-172><a class=lnlinks href=#hl-6-172>172</a>
</span><span class=lnt id=hl-6-173><a class=lnlinks href=#hl-6-173>173</a>
</span><span class=lnt id=hl-6-174><a class=lnlinks href=#hl-6-174>174</a>
</span><span class=lnt id=hl-6-175><a class=lnlinks href=#hl-6-175>175</a>
</span><span class=lnt id=hl-6-176><a class=lnlinks href=#hl-6-176>176</a>
</span><span class=lnt id=hl-6-177><a class=lnlinks href=#hl-6-177>177</a>
</span><span class=lnt id=hl-6-178><a class=lnlinks href=#hl-6-178>178</a>
</span><span class=lnt id=hl-6-179><a class=lnlinks href=#hl-6-179>179</a>
</span><span class=lnt id=hl-6-180><a class=lnlinks href=#hl-6-180>180</a>
</span><span class=lnt id=hl-6-181><a class=lnlinks href=#hl-6-181>181</a>
</span><span class=lnt id=hl-6-182><a class=lnlinks href=#hl-6-182>182</a>
</span><span class=lnt id=hl-6-183><a class=lnlinks href=#hl-6-183>183</a>
</span><span class=lnt id=hl-6-184><a class=lnlinks href=#hl-6-184>184</a>
</span><span class=lnt id=hl-6-185><a class=lnlinks href=#hl-6-185>185</a>
</span><span class=lnt id=hl-6-186><a class=lnlinks href=#hl-6-186>186</a>
</span><span class=lnt id=hl-6-187><a class=lnlinks href=#hl-6-187>187</a>
</span><span class=lnt id=hl-6-188><a class=lnlinks href=#hl-6-188>188</a>
</span><span class=lnt id=hl-6-189><a class=lnlinks href=#hl-6-189>189</a>
</span><span class=lnt id=hl-6-190><a class=lnlinks href=#hl-6-190>190</a>
</span><span class=lnt id=hl-6-191><a class=lnlinks href=#hl-6-191>191</a>
</span><span class=lnt id=hl-6-192><a class=lnlinks href=#hl-6-192>192</a>
</span><span class=lnt id=hl-6-193><a class=lnlinks href=#hl-6-193>193</a>
</span><span class=lnt id=hl-6-194><a class=lnlinks href=#hl-6-194>194</a>
</span><span class=lnt id=hl-6-195><a class=lnlinks href=#hl-6-195>195</a>
</span><span class=lnt id=hl-6-196><a class=lnlinks href=#hl-6-196>196</a>
</span><span class=lnt id=hl-6-197><a class=lnlinks href=#hl-6-197>197</a>
</span><span class=lnt id=hl-6-198><a class=lnlinks href=#hl-6-198>198</a>
</span><span class=lnt id=hl-6-199><a class=lnlinks href=#hl-6-199>199</a>
</span><span class=lnt id=hl-6-200><a class=lnlinks href=#hl-6-200>200</a>
</span><span class=lnt id=hl-6-201><a class=lnlinks href=#hl-6-201>201</a>
</span><span class=lnt id=hl-6-202><a class=lnlinks href=#hl-6-202>202</a>
</span><span class=lnt id=hl-6-203><a class=lnlinks href=#hl-6-203>203</a>
</span><span class=lnt id=hl-6-204><a class=lnlinks href=#hl-6-204>204</a>
</span><span class=lnt id=hl-6-205><a class=lnlinks href=#hl-6-205>205</a>
</span><span class=lnt id=hl-6-206><a class=lnlinks href=#hl-6-206>206</a>
</span><span class=lnt id=hl-6-207><a class=lnlinks href=#hl-6-207>207</a>
</span><span class=lnt id=hl-6-208><a class=lnlinks href=#hl-6-208>208</a>
</span><span class=lnt id=hl-6-209><a class=lnlinks href=#hl-6-209>209</a>
</span><span class=lnt id=hl-6-210><a class=lnlinks href=#hl-6-210>210</a>
</span><span class=lnt id=hl-6-211><a class=lnlinks href=#hl-6-211>211</a>
</span><span class=lnt id=hl-6-212><a class=lnlinks href=#hl-6-212>212</a>
</span><span class=lnt id=hl-6-213><a class=lnlinks href=#hl-6-213>213</a>
</span><span class=lnt id=hl-6-214><a class=lnlinks href=#hl-6-214>214</a>
</span><span class=lnt id=hl-6-215><a class=lnlinks href=#hl-6-215>215</a>
</span><span class=lnt id=hl-6-216><a class=lnlinks href=#hl-6-216>216</a>
</span><span class=lnt id=hl-6-217><a class=lnlinks href=#hl-6-217>217</a>
</span><span class=lnt id=hl-6-218><a class=lnlinks href=#hl-6-218>218</a>
</span><span class=lnt id=hl-6-219><a class=lnlinks href=#hl-6-219>219</a>
</span><span class=lnt id=hl-6-220><a class=lnlinks href=#hl-6-220>220</a>
</span><span class=lnt id=hl-6-221><a class=lnlinks href=#hl-6-221>221</a>
</span><span class=lnt id=hl-6-222><a class=lnlinks href=#hl-6-222>222</a>
</span><span class=lnt id=hl-6-223><a class=lnlinks href=#hl-6-223>223</a>
</span><span class=lnt id=hl-6-224><a class=lnlinks href=#hl-6-224>224</a>
</span><span class=lnt id=hl-6-225><a class=lnlinks href=#hl-6-225>225</a>
</span><span class=lnt id=hl-6-226><a class=lnlinks href=#hl-6-226>226</a>
</span><span class=lnt id=hl-6-227><a class=lnlinks href=#hl-6-227>227</a>
</span><span class=lnt id=hl-6-228><a class=lnlinks href=#hl-6-228>228</a>
</span><span class=lnt id=hl-6-229><a class=lnlinks href=#hl-6-229>229</a>
</span><span class=lnt id=hl-6-230><a class=lnlinks href=#hl-6-230>230</a>
</span><span class=lnt id=hl-6-231><a class=lnlinks href=#hl-6-231>231</a>
</span><span class=lnt id=hl-6-232><a class=lnlinks href=#hl-6-232>232</a>
</span><span class=lnt id=hl-6-233><a class=lnlinks href=#hl-6-233>233</a>
</span><span class=lnt id=hl-6-234><a class=lnlinks href=#hl-6-234>234</a>
</span><span class=lnt id=hl-6-235><a class=lnlinks href=#hl-6-235>235</a>
</span><span class=lnt id=hl-6-236><a class=lnlinks href=#hl-6-236>236</a>
</span><span class=lnt id=hl-6-237><a class=lnlinks href=#hl-6-237>237</a>
</span><span class=lnt id=hl-6-238><a class=lnlinks href=#hl-6-238>238</a>
</span><span class=lnt id=hl-6-239><a class=lnlinks href=#hl-6-239>239</a>
</span><span class=lnt id=hl-6-240><a class=lnlinks href=#hl-6-240>240</a>
</span><span class=lnt id=hl-6-241><a class=lnlinks href=#hl-6-241>241</a>
</span><span class=lnt id=hl-6-242><a class=lnlinks href=#hl-6-242>242</a>
</span><span class=lnt id=hl-6-243><a class=lnlinks href=#hl-6-243>243</a>
</span><span class=lnt id=hl-6-244><a class=lnlinks href=#hl-6-244>244</a>
</span><span class=lnt id=hl-6-245><a class=lnlinks href=#hl-6-245>245</a>
</span><span class=lnt id=hl-6-246><a class=lnlinks href=#hl-6-246>246</a>
</span><span class=lnt id=hl-6-247><a class=lnlinks href=#hl-6-247>247</a>
</span><span class=lnt id=hl-6-248><a class=lnlinks href=#hl-6-248>248</a>
</span><span class=lnt id=hl-6-249><a class=lnlinks href=#hl-6-249>249</a>
</span><span class=lnt id=hl-6-250><a class=lnlinks href=#hl-6-250>250</a>
</span><span class=lnt id=hl-6-251><a class=lnlinks href=#hl-6-251>251</a>
</span><span class=lnt id=hl-6-252><a class=lnlinks href=#hl-6-252>252</a>
</span><span class=lnt id=hl-6-253><a class=lnlinks href=#hl-6-253>253</a>
</span><span class=lnt id=hl-6-254><a class=lnlinks href=#hl-6-254>254</a>
</span><span class=lnt id=hl-6-255><a class=lnlinks href=#hl-6-255>255</a>
</span><span class=lnt id=hl-6-256><a class=lnlinks href=#hl-6-256>256</a>
</span><span class=lnt id=hl-6-257><a class=lnlinks href=#hl-6-257>257</a>
</span><span class=lnt id=hl-6-258><a class=lnlinks href=#hl-6-258>258</a>
</span><span class=lnt id=hl-6-259><a class=lnlinks href=#hl-6-259>259</a>
</span><span class=lnt id=hl-6-260><a class=lnlinks href=#hl-6-260>260</a>
</span><span class=lnt id=hl-6-261><a class=lnlinks href=#hl-6-261>261</a>
</span><span class=lnt id=hl-6-262><a class=lnlinks href=#hl-6-262>262</a>
</span><span class=lnt id=hl-6-263><a class=lnlinks href=#hl-6-263>263</a>
</span><span class=lnt id=hl-6-264><a class=lnlinks href=#hl-6-264>264</a>
</span><span class=lnt id=hl-6-265><a class=lnlinks href=#hl-6-265>265</a>
</span><span class=lnt id=hl-6-266><a class=lnlinks href=#hl-6-266>266</a>
</span><span class=lnt id=hl-6-267><a class=lnlinks href=#hl-6-267>267</a>
</span><span class=lnt id=hl-6-268><a class=lnlinks href=#hl-6-268>268</a>
</span><span class=lnt id=hl-6-269><a class=lnlinks href=#hl-6-269>269</a>
</span><span class=lnt id=hl-6-270><a class=lnlinks href=#hl-6-270>270</a>
</span><span class=lnt id=hl-6-271><a class=lnlinks href=#hl-6-271>271</a>
</span><span class=lnt id=hl-6-272><a class=lnlinks href=#hl-6-272>272</a>
</span><span class=lnt id=hl-6-273><a class=lnlinks href=#hl-6-273>273</a>
</span><span class=lnt id=hl-6-274><a class=lnlinks href=#hl-6-274>274</a>
</span><span class=lnt id=hl-6-275><a class=lnlinks href=#hl-6-275>275</a>
</span><span class=lnt id=hl-6-276><a class=lnlinks href=#hl-6-276>276</a>
</span><span class=lnt id=hl-6-277><a class=lnlinks href=#hl-6-277>277</a>
</span><span class=lnt id=hl-6-278><a class=lnlinks href=#hl-6-278>278</a>
</span><span class=lnt id=hl-6-279><a class=lnlinks href=#hl-6-279>279</a>
</span><span class=lnt id=hl-6-280><a class=lnlinks href=#hl-6-280>280</a>
</span><span class=lnt id=hl-6-281><a class=lnlinks href=#hl-6-281>281</a>
</span><span class=lnt id=hl-6-282><a class=lnlinks href=#hl-6-282>282</a>
</span><span class=lnt id=hl-6-283><a class=lnlinks href=#hl-6-283>283</a>
</span><span class=lnt id=hl-6-284><a class=lnlinks href=#hl-6-284>284</a>
</span><span class=lnt id=hl-6-285><a class=lnlinks href=#hl-6-285>285</a>
</span><span class=lnt id=hl-6-286><a class=lnlinks href=#hl-6-286>286</a>
</span><span class=lnt id=hl-6-287><a class=lnlinks href=#hl-6-287>287</a>
</span><span class=lnt id=hl-6-288><a class=lnlinks href=#hl-6-288>288</a>
</span><span class=lnt id=hl-6-289><a class=lnlinks href=#hl-6-289>289</a>
</span><span class=lnt id=hl-6-290><a class=lnlinks href=#hl-6-290>290</a>
</span><span class=lnt id=hl-6-291><a class=lnlinks href=#hl-6-291>291</a>
</span><span class=lnt id=hl-6-292><a class=lnlinks href=#hl-6-292>292</a>
</span><span class=lnt id=hl-6-293><a class=lnlinks href=#hl-6-293>293</a>
</span><span class=lnt id=hl-6-294><a class=lnlinks href=#hl-6-294>294</a>
</span><span class=lnt id=hl-6-295><a class=lnlinks href=#hl-6-295>295</a>
</span><span class=lnt id=hl-6-296><a class=lnlinks href=#hl-6-296>296</a>
</span><span class=lnt id=hl-6-297><a class=lnlinks href=#hl-6-297>297</a>
</span><span class=lnt id=hl-6-298><a class=lnlinks href=#hl-6-298>298</a>
</span><span class=lnt id=hl-6-299><a class=lnlinks href=#hl-6-299>299</a>
</span><span class=lnt id=hl-6-300><a class=lnlinks href=#hl-6-300>300</a>
</span><span class=lnt id=hl-6-301><a class=lnlinks href=#hl-6-301>301</a>
</span><span class=lnt id=hl-6-302><a class=lnlinks href=#hl-6-302>302</a>
</span><span class=lnt id=hl-6-303><a class=lnlinks href=#hl-6-303>303</a>
</span><span class=lnt id=hl-6-304><a class=lnlinks href=#hl-6-304>304</a>
</span><span class=lnt id=hl-6-305><a class=lnlinks href=#hl-6-305>305</a>
</span><span class=lnt id=hl-6-306><a class=lnlinks href=#hl-6-306>306</a>
</span><span class=lnt id=hl-6-307><a class=lnlinks href=#hl-6-307>307</a>
</span><span class=lnt id=hl-6-308><a class=lnlinks href=#hl-6-308>308</a>
</span><span class=lnt id=hl-6-309><a class=lnlinks href=#hl-6-309>309</a>
</span><span class=lnt id=hl-6-310><a class=lnlinks href=#hl-6-310>310</a>
</span><span class=lnt id=hl-6-311><a class=lnlinks href=#hl-6-311>311</a>
</span><span class=lnt id=hl-6-312><a class=lnlinks href=#hl-6-312>312</a>
</span><span class=lnt id=hl-6-313><a class=lnlinks href=#hl-6-313>313</a>
</span><span class=lnt id=hl-6-314><a class=lnlinks href=#hl-6-314>314</a>
</span><span class=lnt id=hl-6-315><a class=lnlinks href=#hl-6-315>315</a>
</span><span class=lnt id=hl-6-316><a class=lnlinks href=#hl-6-316>316</a>
</span><span class=lnt id=hl-6-317><a class=lnlinks href=#hl-6-317>317</a>
</span><span class=lnt id=hl-6-318><a class=lnlinks href=#hl-6-318>318</a>
</span><span class=lnt id=hl-6-319><a class=lnlinks href=#hl-6-319>319</a>
</span><span class=lnt id=hl-6-320><a class=lnlinks href=#hl-6-320>320</a>
</span><span class=lnt id=hl-6-321><a class=lnlinks href=#hl-6-321>321</a>
</span><span class=lnt id=hl-6-322><a class=lnlinks href=#hl-6-322>322</a>
</span><span class=lnt id=hl-6-323><a class=lnlinks href=#hl-6-323>323</a>
</span><span class=lnt id=hl-6-324><a class=lnlinks href=#hl-6-324>324</a>
</span><span class=lnt id=hl-6-325><a class=lnlinks href=#hl-6-325>325</a>
</span><span class=lnt id=hl-6-326><a class=lnlinks href=#hl-6-326>326</a>
</span><span class=lnt id=hl-6-327><a class=lnlinks href=#hl-6-327>327</a>
</span><span class=lnt id=hl-6-328><a class=lnlinks href=#hl-6-328>328</a>
</span><span class=lnt id=hl-6-329><a class=lnlinks href=#hl-6-329>329</a>
</span><span class=lnt id=hl-6-330><a class=lnlinks href=#hl-6-330>330</a>
</span><span class=lnt id=hl-6-331><a class=lnlinks href=#hl-6-331>331</a>
</span><span class=lnt id=hl-6-332><a class=lnlinks href=#hl-6-332>332</a>
</span><span class=lnt id=hl-6-333><a class=lnlinks href=#hl-6-333>333</a>
</span><span class=lnt id=hl-6-334><a class=lnlinks href=#hl-6-334>334</a>
</span><span class=lnt id=hl-6-335><a class=lnlinks href=#hl-6-335>335</a>
</span><span class=lnt id=hl-6-336><a class=lnlinks href=#hl-6-336>336</a>
</span><span class=lnt id=hl-6-337><a class=lnlinks href=#hl-6-337>337</a>
</span><span class=lnt id=hl-6-338><a class=lnlinks href=#hl-6-338>338</a>
</span><span class=lnt id=hl-6-339><a class=lnlinks href=#hl-6-339>339</a>
</span><span class=lnt id=hl-6-340><a class=lnlinks href=#hl-6-340>340</a>
</span><span class=lnt id=hl-6-341><a class=lnlinks href=#hl-6-341>341</a>
</span><span class=lnt id=hl-6-342><a class=lnlinks href=#hl-6-342>342</a>
</span><span class=lnt id=hl-6-343><a class=lnlinks href=#hl-6-343>343</a>
</span><span class=lnt id=hl-6-344><a class=lnlinks href=#hl-6-344>344</a>
</span><span class=lnt id=hl-6-345><a class=lnlinks href=#hl-6-345>345</a>
</span><span class=lnt id=hl-6-346><a class=lnlinks href=#hl-6-346>346</a>
</span><span class=lnt id=hl-6-347><a class=lnlinks href=#hl-6-347>347</a>
</span><span class=lnt id=hl-6-348><a class=lnlinks href=#hl-6-348>348</a>
</span><span class=lnt id=hl-6-349><a class=lnlinks href=#hl-6-349>349</a>
</span><span class=lnt id=hl-6-350><a class=lnlinks href=#hl-6-350>350</a>
</span><span class=lnt id=hl-6-351><a class=lnlinks href=#hl-6-351>351</a>
</span><span class=lnt id=hl-6-352><a class=lnlinks href=#hl-6-352>352</a>
</span><span class=lnt id=hl-6-353><a class=lnlinks href=#hl-6-353>353</a>
</span><span class=lnt id=hl-6-354><a class=lnlinks href=#hl-6-354>354</a>
</span><span class=lnt id=hl-6-355><a class=lnlinks href=#hl-6-355>355</a>
</span><span class=lnt id=hl-6-356><a class=lnlinks href=#hl-6-356>356</a>
</span><span class=lnt id=hl-6-357><a class=lnlinks href=#hl-6-357>357</a>
</span><span class=lnt id=hl-6-358><a class=lnlinks href=#hl-6-358>358</a>
</span><span class=lnt id=hl-6-359><a class=lnlinks href=#hl-6-359>359</a>
</span><span class=lnt id=hl-6-360><a class=lnlinks href=#hl-6-360>360</a>
</span><span class=lnt id=hl-6-361><a class=lnlinks href=#hl-6-361>361</a>
</span><span class=lnt id=hl-6-362><a class=lnlinks href=#hl-6-362>362</a>
</span><span class=lnt id=hl-6-363><a class=lnlinks href=#hl-6-363>363</a>
</span><span class=lnt id=hl-6-364><a class=lnlinks href=#hl-6-364>364</a>
</span><span class=lnt id=hl-6-365><a class=lnlinks href=#hl-6-365>365</a>
</span><span class=lnt id=hl-6-366><a class=lnlinks href=#hl-6-366>366</a>
</span><span class=lnt id=hl-6-367><a class=lnlinks href=#hl-6-367>367</a>
</span><span class=lnt id=hl-6-368><a class=lnlinks href=#hl-6-368>368</a>
</span><span class=lnt id=hl-6-369><a class=lnlinks href=#hl-6-369>369</a>
</span><span class=lnt id=hl-6-370><a class=lnlinks href=#hl-6-370>370</a>
</span><span class=lnt id=hl-6-371><a class=lnlinks href=#hl-6-371>371</a>
</span><span class=lnt id=hl-6-372><a class=lnlinks href=#hl-6-372>372</a>
</span><span class=lnt id=hl-6-373><a class=lnlinks href=#hl-6-373>373</a>
</span><span class=lnt id=hl-6-374><a class=lnlinks href=#hl-6-374>374</a>
</span><span class=lnt id=hl-6-375><a class=lnlinks href=#hl-6-375>375</a>
</span><span class=lnt id=hl-6-376><a class=lnlinks href=#hl-6-376>376</a>
</span><span class=lnt id=hl-6-377><a class=lnlinks href=#hl-6-377>377</a>
</span><span class=lnt id=hl-6-378><a class=lnlinks href=#hl-6-378>378</a>
</span><span class=lnt id=hl-6-379><a class=lnlinks href=#hl-6-379>379</a>
</span><span class=lnt id=hl-6-380><a class=lnlinks href=#hl-6-380>380</a>
</span><span class=lnt id=hl-6-381><a class=lnlinks href=#hl-6-381>381</a>
</span><span class=lnt id=hl-6-382><a class=lnlinks href=#hl-6-382>382</a>
</span><span class=lnt id=hl-6-383><a class=lnlinks href=#hl-6-383>383</a>
</span><span class=lnt id=hl-6-384><a class=lnlinks href=#hl-6-384>384</a>
</span><span class=lnt id=hl-6-385><a class=lnlinks href=#hl-6-385>385</a>
</span><span class=lnt id=hl-6-386><a class=lnlinks href=#hl-6-386>386</a>
</span><span class=lnt id=hl-6-387><a class=lnlinks href=#hl-6-387>387</a>
</span><span class=lnt id=hl-6-388><a class=lnlinks href=#hl-6-388>388</a>
</span><span class=lnt id=hl-6-389><a class=lnlinks href=#hl-6-389>389</a>
</span><span class=lnt id=hl-6-390><a class=lnlinks href=#hl-6-390>390</a>
</span><span class=lnt id=hl-6-391><a class=lnlinks href=#hl-6-391>391</a>
</span><span class=lnt id=hl-6-392><a class=lnlinks href=#hl-6-392>392</a>
</span><span class=lnt id=hl-6-393><a class=lnlinks href=#hl-6-393>393</a>
</span><span class=lnt id=hl-6-394><a class=lnlinks href=#hl-6-394>394</a>
</span><span class=lnt id=hl-6-395><a class=lnlinks href=#hl-6-395>395</a>
</span><span class=lnt id=hl-6-396><a class=lnlinks href=#hl-6-396>396</a>
</span><span class=lnt id=hl-6-397><a class=lnlinks href=#hl-6-397>397</a>
</span><span class=lnt id=hl-6-398><a class=lnlinks href=#hl-6-398>398</a>
</span><span class=lnt id=hl-6-399><a class=lnlinks href=#hl-6-399>399</a>
</span><span class=lnt id=hl-6-400><a class=lnlinks href=#hl-6-400>400</a>
</span><span class=lnt id=hl-6-401><a class=lnlinks href=#hl-6-401>401</a>
</span><span class=lnt id=hl-6-402><a class=lnlinks href=#hl-6-402>402</a>
</span><span class=lnt id=hl-6-403><a class=lnlinks href=#hl-6-403>403</a>
</span><span class=lnt id=hl-6-404><a class=lnlinks href=#hl-6-404>404</a>
</span><span class=lnt id=hl-6-405><a class=lnlinks href=#hl-6-405>405</a>
</span><span class=lnt id=hl-6-406><a class=lnlinks href=#hl-6-406>406</a>
</span><span class=lnt id=hl-6-407><a class=lnlinks href=#hl-6-407>407</a>
</span><span class=lnt id=hl-6-408><a class=lnlinks href=#hl-6-408>408</a>
</span><span class=lnt id=hl-6-409><a class=lnlinks href=#hl-6-409>409</a>
</span><span class=lnt id=hl-6-410><a class=lnlinks href=#hl-6-410>410</a>
</span><span class=lnt id=hl-6-411><a class=lnlinks href=#hl-6-411>411</a>
</span><span class=lnt id=hl-6-412><a class=lnlinks href=#hl-6-412>412</a>
</span><span class=lnt id=hl-6-413><a class=lnlinks href=#hl-6-413>413</a>
</span><span class=lnt id=hl-6-414><a class=lnlinks href=#hl-6-414>414</a>
</span><span class=lnt id=hl-6-415><a class=lnlinks href=#hl-6-415>415</a>
</span><span class=lnt id=hl-6-416><a class=lnlinks href=#hl-6-416>416</a>
</span><span class=lnt id=hl-6-417><a class=lnlinks href=#hl-6-417>417</a>
</span><span class=lnt id=hl-6-418><a class=lnlinks href=#hl-6-418>418</a>
</span><span class=lnt id=hl-6-419><a class=lnlinks href=#hl-6-419>419</a>
</span><span class=lnt id=hl-6-420><a class=lnlinks href=#hl-6-420>420</a>
</span><span class=lnt id=hl-6-421><a class=lnlinks href=#hl-6-421>421</a>
</span><span class=lnt id=hl-6-422><a class=lnlinks href=#hl-6-422>422</a>
</span><span class=lnt id=hl-6-423><a class=lnlinks href=#hl-6-423>423</a>
</span><span class=lnt id=hl-6-424><a class=lnlinks href=#hl-6-424>424</a>
</span><span class=lnt id=hl-6-425><a class=lnlinks href=#hl-6-425>425</a>
</span><span class=lnt id=hl-6-426><a class=lnlinks href=#hl-6-426>426</a>
</span><span class=lnt id=hl-6-427><a class=lnlinks href=#hl-6-427>427</a>
</span><span class=lnt id=hl-6-428><a class=lnlinks href=#hl-6-428>428</a>
</span><span class=lnt id=hl-6-429><a class=lnlinks href=#hl-6-429>429</a>
</span><span class=lnt id=hl-6-430><a class=lnlinks href=#hl-6-430>430</a>
</span><span class=lnt id=hl-6-431><a class=lnlinks href=#hl-6-431>431</a>
</span><span class=lnt id=hl-6-432><a class=lnlinks href=#hl-6-432>432</a>
</span><span class=lnt id=hl-6-433><a class=lnlinks href=#hl-6-433>433</a>
</span><span class=lnt id=hl-6-434><a class=lnlinks href=#hl-6-434>434</a>
</span><span class=lnt id=hl-6-435><a class=lnlinks href=#hl-6-435>435</a>
</span><span class=lnt id=hl-6-436><a class=lnlinks href=#hl-6-436>436</a>
</span><span class=lnt id=hl-6-437><a class=lnlinks href=#hl-6-437>437</a>
</span><span class=lnt id=hl-6-438><a class=lnlinks href=#hl-6-438>438</a>
</span><span class=lnt id=hl-6-439><a class=lnlinks href=#hl-6-439>439</a>
</span><span class=lnt id=hl-6-440><a class=lnlinks href=#hl-6-440>440</a>
</span><span class=lnt id=hl-6-441><a class=lnlinks href=#hl-6-441>441</a>
</span><span class=lnt id=hl-6-442><a class=lnlinks href=#hl-6-442>442</a>
</span><span class=lnt id=hl-6-443><a class=lnlinks href=#hl-6-443>443</a>
</span><span class=lnt id=hl-6-444><a class=lnlinks href=#hl-6-444>444</a>
</span><span class=lnt id=hl-6-445><a class=lnlinks href=#hl-6-445>445</a>
</span><span class=lnt id=hl-6-446><a class=lnlinks href=#hl-6-446>446</a>
</span><span class=lnt id=hl-6-447><a class=lnlinks href=#hl-6-447>447</a>
</span><span class=lnt id=hl-6-448><a class=lnlinks href=#hl-6-448>448</a>
</span><span class=lnt id=hl-6-449><a class=lnlinks href=#hl-6-449>449</a>
</span><span class=lnt id=hl-6-450><a class=lnlinks href=#hl-6-450>450</a>
</span><span class=lnt id=hl-6-451><a class=lnlinks href=#hl-6-451>451</a>
</span><span class=lnt id=hl-6-452><a class=lnlinks href=#hl-6-452>452</a>
</span><span class=lnt id=hl-6-453><a class=lnlinks href=#hl-6-453>453</a>
</span><span class=lnt id=hl-6-454><a class=lnlinks href=#hl-6-454>454</a>
</span><span class=lnt id=hl-6-455><a class=lnlinks href=#hl-6-455>455</a>
</span><span class=lnt id=hl-6-456><a class=lnlinks href=#hl-6-456>456</a>
</span><span class=lnt id=hl-6-457><a class=lnlinks href=#hl-6-457>457</a>
</span><span class=lnt id=hl-6-458><a class=lnlinks href=#hl-6-458>458</a>
</span><span class=lnt id=hl-6-459><a class=lnlinks href=#hl-6-459>459</a>
</span><span class=lnt id=hl-6-460><a class=lnlinks href=#hl-6-460>460</a>
</span><span class=lnt id=hl-6-461><a class=lnlinks href=#hl-6-461>461</a>
</span><span class=lnt id=hl-6-462><a class=lnlinks href=#hl-6-462>462</a>
</span><span class=lnt id=hl-6-463><a class=lnlinks href=#hl-6-463>463</a>
</span><span class=lnt id=hl-6-464><a class=lnlinks href=#hl-6-464>464</a>
</span><span class=lnt id=hl-6-465><a class=lnlinks href=#hl-6-465>465</a>
</span><span class=lnt id=hl-6-466><a class=lnlinks href=#hl-6-466>466</a>
</span><span class=lnt id=hl-6-467><a class=lnlinks href=#hl-6-467>467</a>
</span><span class=lnt id=hl-6-468><a class=lnlinks href=#hl-6-468>468</a>
</span><span class=lnt id=hl-6-469><a class=lnlinks href=#hl-6-469>469</a>
</span><span class=lnt id=hl-6-470><a class=lnlinks href=#hl-6-470>470</a>
</span><span class=lnt id=hl-6-471><a class=lnlinks href=#hl-6-471>471</a>
</span><span class=lnt id=hl-6-472><a class=lnlinks href=#hl-6-472>472</a>
</span><span class=lnt id=hl-6-473><a class=lnlinks href=#hl-6-473>473</a>
</span><span class=lnt id=hl-6-474><a class=lnlinks href=#hl-6-474>474</a>
</span><span class=lnt id=hl-6-475><a class=lnlinks href=#hl-6-475>475</a>
</span><span class=lnt id=hl-6-476><a class=lnlinks href=#hl-6-476>476</a>
</span><span class=lnt id=hl-6-477><a class=lnlinks href=#hl-6-477>477</a>
</span><span class=lnt id=hl-6-478><a class=lnlinks href=#hl-6-478>478</a>
</span><span class=lnt id=hl-6-479><a class=lnlinks href=#hl-6-479>479</a>
</span><span class=lnt id=hl-6-480><a class=lnlinks href=#hl-6-480>480</a>
</span><span class=lnt id=hl-6-481><a class=lnlinks href=#hl-6-481>481</a>
</span><span class=lnt id=hl-6-482><a class=lnlinks href=#hl-6-482>482</a>
</span><span class=lnt id=hl-6-483><a class=lnlinks href=#hl-6-483>483</a>
</span><span class=lnt id=hl-6-484><a class=lnlinks href=#hl-6-484>484</a>
</span><span class=lnt id=hl-6-485><a class=lnlinks href=#hl-6-485>485</a>
</span><span class=lnt id=hl-6-486><a class=lnlinks href=#hl-6-486>486</a>
</span><span class=lnt id=hl-6-487><a class=lnlinks href=#hl-6-487>487</a>
</span><span class=lnt id=hl-6-488><a class=lnlinks href=#hl-6-488>488</a>
</span><span class=lnt id=hl-6-489><a class=lnlinks href=#hl-6-489>489</a>
</span><span class=lnt id=hl-6-490><a class=lnlinks href=#hl-6-490>490</a>
</span><span class=lnt id=hl-6-491><a class=lnlinks href=#hl-6-491>491</a>
</span><span class=lnt id=hl-6-492><a class=lnlinks href=#hl-6-492>492</a>
</span><span class=lnt id=hl-6-493><a class=lnlinks href=#hl-6-493>493</a>
</span><span class=lnt id=hl-6-494><a class=lnlinks href=#hl-6-494>494</a>
</span><span class=lnt id=hl-6-495><a class=lnlinks href=#hl-6-495>495</a>
</span><span class=lnt id=hl-6-496><a class=lnlinks href=#hl-6-496>496</a>
</span><span class=lnt id=hl-6-497><a class=lnlinks href=#hl-6-497>497</a>
</span><span class=lnt id=hl-6-498><a class=lnlinks href=#hl-6-498>498</a>
</span><span class=lnt id=hl-6-499><a class=lnlinks href=#hl-6-499>499</a>
</span><span class=lnt id=hl-6-500><a class=lnlinks href=#hl-6-500>500</a>
</span><span class=lnt id=hl-6-501><a class=lnlinks href=#hl-6-501>501</a>
</span><span class=lnt id=hl-6-502><a class=lnlinks href=#hl-6-502>502</a>
</span><span class=lnt id=hl-6-503><a class=lnlinks href=#hl-6-503>503</a>
</span><span class=lnt id=hl-6-504><a class=lnlinks href=#hl-6-504>504</a>
</span><span class=lnt id=hl-6-505><a class=lnlinks href=#hl-6-505>505</a>
</span><span class=lnt id=hl-6-506><a class=lnlinks href=#hl-6-506>506</a>
</span><span class=lnt id=hl-6-507><a class=lnlinks href=#hl-6-507>507</a>
</span><span class=lnt id=hl-6-508><a class=lnlinks href=#hl-6-508>508</a>
</span><span class=lnt id=hl-6-509><a class=lnlinks href=#hl-6-509>509</a>
</span><span class=lnt id=hl-6-510><a class=lnlinks href=#hl-6-510>510</a>
</span><span class=lnt id=hl-6-511><a class=lnlinks href=#hl-6-511>511</a>
</span><span class=lnt id=hl-6-512><a class=lnlinks href=#hl-6-512>512</a>
</span><span class=lnt id=hl-6-513><a class=lnlinks href=#hl-6-513>513</a>
</span><span class=lnt id=hl-6-514><a class=lnlinks href=#hl-6-514>514</a>
</span><span class=lnt id=hl-6-515><a class=lnlinks href=#hl-6-515>515</a>
</span><span class=lnt id=hl-6-516><a class=lnlinks href=#hl-6-516>516</a>
</span><span class=lnt id=hl-6-517><a class=lnlinks href=#hl-6-517>517</a>
</span><span class=lnt id=hl-6-518><a class=lnlinks href=#hl-6-518>518</a>
</span><span class=lnt id=hl-6-519><a class=lnlinks href=#hl-6-519>519</a>
</span><span class=lnt id=hl-6-520><a class=lnlinks href=#hl-6-520>520</a>
</span><span class=lnt id=hl-6-521><a class=lnlinks href=#hl-6-521>521</a>
</span><span class=lnt id=hl-6-522><a class=lnlinks href=#hl-6-522>522</a>
</span><span class=lnt id=hl-6-523><a class=lnlinks href=#hl-6-523>523</a>
</span><span class=lnt id=hl-6-524><a class=lnlinks href=#hl-6-524>524</a>
</span><span class=lnt id=hl-6-525><a class=lnlinks href=#hl-6-525>525</a>
</span><span class=lnt id=hl-6-526><a class=lnlinks href=#hl-6-526>526</a>
</span><span class=lnt id=hl-6-527><a class=lnlinks href=#hl-6-527>527</a>
</span><span class=lnt id=hl-6-528><a class=lnlinks href=#hl-6-528>528</a>
</span><span class=lnt id=hl-6-529><a class=lnlinks href=#hl-6-529>529</a>
</span><span class=lnt id=hl-6-530><a class=lnlinks href=#hl-6-530>530</a>
</span><span class=lnt id=hl-6-531><a class=lnlinks href=#hl-6-531>531</a>
</span><span class=lnt id=hl-6-532><a class=lnlinks href=#hl-6-532>532</a>
</span><span class=lnt id=hl-6-533><a class=lnlinks href=#hl-6-533>533</a>
</span><span class=lnt id=hl-6-534><a class=lnlinks href=#hl-6-534>534</a>
</span><span class=lnt id=hl-6-535><a class=lnlinks href=#hl-6-535>535</a>
</span><span class=lnt id=hl-6-536><a class=lnlinks href=#hl-6-536>536</a>
</span><span class=lnt id=hl-6-537><a class=lnlinks href=#hl-6-537>537</a>
</span><span class=lnt id=hl-6-538><a class=lnlinks href=#hl-6-538>538</a>
</span><span class=lnt id=hl-6-539><a class=lnlinks href=#hl-6-539>539</a>
</span><span class=lnt id=hl-6-540><a class=lnlinks href=#hl-6-540>540</a>
</span><span class=lnt id=hl-6-541><a class=lnlinks href=#hl-6-541>541</a>
</span><span class=lnt id=hl-6-542><a class=lnlinks href=#hl-6-542>542</a>
</span><span class=lnt id=hl-6-543><a class=lnlinks href=#hl-6-543>543</a>
</span><span class=lnt id=hl-6-544><a class=lnlinks href=#hl-6-544>544</a>
</span><span class=lnt id=hl-6-545><a class=lnlinks href=#hl-6-545>545</a>
</span><span class=lnt id=hl-6-546><a class=lnlinks href=#hl-6-546>546</a>
</span><span class=lnt id=hl-6-547><a class=lnlinks href=#hl-6-547>547</a>
</span><span class=lnt id=hl-6-548><a class=lnlinks href=#hl-6-548>548</a>
</span><span class=lnt id=hl-6-549><a class=lnlinks href=#hl-6-549>549</a>
</span><span class=lnt id=hl-6-550><a class=lnlinks href=#hl-6-550>550</a>
</span><span class=lnt id=hl-6-551><a class=lnlinks href=#hl-6-551>551</a>
</span><span class=lnt id=hl-6-552><a class=lnlinks href=#hl-6-552>552</a>
</span><span class=lnt id=hl-6-553><a class=lnlinks href=#hl-6-553>553</a>
</span><span class=lnt id=hl-6-554><a class=lnlinks href=#hl-6-554>554</a>
</span><span class=lnt id=hl-6-555><a class=lnlinks href=#hl-6-555>555</a>
</span><span class=lnt id=hl-6-556><a class=lnlinks href=#hl-6-556>556</a>
</span><span class=lnt id=hl-6-557><a class=lnlinks href=#hl-6-557>557</a>
</span><span class=lnt id=hl-6-558><a class=lnlinks href=#hl-6-558>558</a>
</span><span class=lnt id=hl-6-559><a class=lnlinks href=#hl-6-559>559</a>
</span><span class=lnt id=hl-6-560><a class=lnlinks href=#hl-6-560>560</a>
</span><span class=lnt id=hl-6-561><a class=lnlinks href=#hl-6-561>561</a>
</span><span class=lnt id=hl-6-562><a class=lnlinks href=#hl-6-562>562</a>
</span><span class=lnt id=hl-6-563><a class=lnlinks href=#hl-6-563>563</a>
</span><span class=lnt id=hl-6-564><a class=lnlinks href=#hl-6-564>564</a>
</span><span class=lnt id=hl-6-565><a class=lnlinks href=#hl-6-565>565</a>
</span><span class=lnt id=hl-6-566><a class=lnlinks href=#hl-6-566>566</a>
</span><span class=lnt id=hl-6-567><a class=lnlinks href=#hl-6-567>567</a>
</span><span class=lnt id=hl-6-568><a class=lnlinks href=#hl-6-568>568</a>
</span><span class=lnt id=hl-6-569><a class=lnlinks href=#hl-6-569>569</a>
</span><span class=lnt id=hl-6-570><a class=lnlinks href=#hl-6-570>570</a>
</span><span class=lnt id=hl-6-571><a class=lnlinks href=#hl-6-571>571</a>
</span><span class=lnt id=hl-6-572><a class=lnlinks href=#hl-6-572>572</a>
</span><span class=lnt id=hl-6-573><a class=lnlinks href=#hl-6-573>573</a>
</span><span class=lnt id=hl-6-574><a class=lnlinks href=#hl-6-574>574</a>
</span><span class=lnt id=hl-6-575><a class=lnlinks href=#hl-6-575>575</a>
</span><span class=lnt id=hl-6-576><a class=lnlinks href=#hl-6-576>576</a>
</span><span class=lnt id=hl-6-577><a class=lnlinks href=#hl-6-577>577</a>
</span><span class=lnt id=hl-6-578><a class=lnlinks href=#hl-6-578>578</a>
</span><span class=lnt id=hl-6-579><a class=lnlinks href=#hl-6-579>579</a>
</span><span class=lnt id=hl-6-580><a class=lnlinks href=#hl-6-580>580</a>
</span><span class=lnt id=hl-6-581><a class=lnlinks href=#hl-6-581>581</a>
</span><span class=lnt id=hl-6-582><a class=lnlinks href=#hl-6-582>582</a>
</span><span class=lnt id=hl-6-583><a class=lnlinks href=#hl-6-583>583</a>
</span><span class=lnt id=hl-6-584><a class=lnlinks href=#hl-6-584>584</a>
</span><span class=lnt id=hl-6-585><a class=lnlinks href=#hl-6-585>585</a>
</span><span class=lnt id=hl-6-586><a class=lnlinks href=#hl-6-586>586</a>
</span><span class=lnt id=hl-6-587><a class=lnlinks href=#hl-6-587>587</a>
</span><span class=lnt id=hl-6-588><a class=lnlinks href=#hl-6-588>588</a>
</span><span class=lnt id=hl-6-589><a class=lnlinks href=#hl-6-589>589</a>
</span><span class=lnt id=hl-6-590><a class=lnlinks href=#hl-6-590>590</a>
</span><span class=lnt id=hl-6-591><a class=lnlinks href=#hl-6-591>591</a>
</span><span class=lnt id=hl-6-592><a class=lnlinks href=#hl-6-592>592</a>
</span><span class=lnt id=hl-6-593><a class=lnlinks href=#hl-6-593>593</a>
</span><span class=lnt id=hl-6-594><a class=lnlinks href=#hl-6-594>594</a>
</span><span class=lnt id=hl-6-595><a class=lnlinks href=#hl-6-595>595</a>
</span><span class=lnt id=hl-6-596><a class=lnlinks href=#hl-6-596>596</a>
</span><span class=lnt id=hl-6-597><a class=lnlinks href=#hl-6-597>597</a>
</span><span class=lnt id=hl-6-598><a class=lnlinks href=#hl-6-598>598</a>
</span><span class=lnt id=hl-6-599><a class=lnlinks href=#hl-6-599>599</a>
</span><span class=lnt id=hl-6-600><a class=lnlinks href=#hl-6-600>600</a>
</span><span class=lnt id=hl-6-601><a class=lnlinks href=#hl-6-601>601</a>
</span><span class=lnt id=hl-6-602><a class=lnlinks href=#hl-6-602>602</a>
</span><span class=lnt id=hl-6-603><a class=lnlinks href=#hl-6-603>603</a>
</span><span class=lnt id=hl-6-604><a class=lnlinks href=#hl-6-604>604</a>
</span><span class=lnt id=hl-6-605><a class=lnlinks href=#hl-6-605>605</a>
</span><span class=lnt id=hl-6-606><a class=lnlinks href=#hl-6-606>606</a>
</span><span class=lnt id=hl-6-607><a class=lnlinks href=#hl-6-607>607</a>
</span><span class=lnt id=hl-6-608><a class=lnlinks href=#hl-6-608>608</a>
</span><span class=lnt id=hl-6-609><a class=lnlinks href=#hl-6-609>609</a>
</span><span class=lnt id=hl-6-610><a class=lnlinks href=#hl-6-610>610</a>
</span><span class=lnt id=hl-6-611><a class=lnlinks href=#hl-6-611>611</a>
</span><span class=lnt id=hl-6-612><a class=lnlinks href=#hl-6-612>612</a>
</span><span class=lnt id=hl-6-613><a class=lnlinks href=#hl-6-613>613</a>
</span><span class=lnt id=hl-6-614><a class=lnlinks href=#hl-6-614>614</a>
</span><span class=lnt id=hl-6-615><a class=lnlinks href=#hl-6-615>615</a>
</span><span class=lnt id=hl-6-616><a class=lnlinks href=#hl-6-616>616</a>
</span><span class=lnt id=hl-6-617><a class=lnlinks href=#hl-6-617>617</a>
</span><span class=lnt id=hl-6-618><a class=lnlinks href=#hl-6-618>618</a>
</span><span class=lnt id=hl-6-619><a class=lnlinks href=#hl-6-619>619</a>
</span><span class=lnt id=hl-6-620><a class=lnlinks href=#hl-6-620>620</a>
</span><span class=lnt id=hl-6-621><a class=lnlinks href=#hl-6-621>621</a>
</span><span class=lnt id=hl-6-622><a class=lnlinks href=#hl-6-622>622</a>
</span><span class=lnt id=hl-6-623><a class=lnlinks href=#hl-6-623>623</a>
</span><span class=lnt id=hl-6-624><a class=lnlinks href=#hl-6-624>624</a>
</span><span class=lnt id=hl-6-625><a class=lnlinks href=#hl-6-625>625</a>
</span><span class=lnt id=hl-6-626><a class=lnlinks href=#hl-6-626>626</a>
</span><span class=lnt id=hl-6-627><a class=lnlinks href=#hl-6-627>627</a>
</span><span class=lnt id=hl-6-628><a class=lnlinks href=#hl-6-628>628</a>
</span><span class=lnt id=hl-6-629><a class=lnlinks href=#hl-6-629>629</a>
</span><span class=lnt id=hl-6-630><a class=lnlinks href=#hl-6-630>630</a>
</span><span class=lnt id=hl-6-631><a class=lnlinks href=#hl-6-631>631</a>
</span><span class=lnt id=hl-6-632><a class=lnlinks href=#hl-6-632>632</a>
</span><span class=lnt id=hl-6-633><a class=lnlinks href=#hl-6-633>633</a>
</span><span class=lnt id=hl-6-634><a class=lnlinks href=#hl-6-634>634</a>
</span><span class=lnt id=hl-6-635><a class=lnlinks href=#hl-6-635>635</a>
</span><span class=lnt id=hl-6-636><a class=lnlinks href=#hl-6-636>636</a>
</span><span class=lnt id=hl-6-637><a class=lnlinks href=#hl-6-637>637</a>
</span><span class=lnt id=hl-6-638><a class=lnlinks href=#hl-6-638>638</a>
</span><span class=lnt id=hl-6-639><a class=lnlinks href=#hl-6-639>639</a>
</span><span class=lnt id=hl-6-640><a class=lnlinks href=#hl-6-640>640</a>
</span><span class=lnt id=hl-6-641><a class=lnlinks href=#hl-6-641>641</a>
</span><span class=lnt id=hl-6-642><a class=lnlinks href=#hl-6-642>642</a>
</span><span class=lnt id=hl-6-643><a class=lnlinks href=#hl-6-643>643</a>
</span><span class=lnt id=hl-6-644><a class=lnlinks href=#hl-6-644>644</a>
</span><span class=lnt id=hl-6-645><a class=lnlinks href=#hl-6-645>645</a>
</span><span class=lnt id=hl-6-646><a class=lnlinks href=#hl-6-646>646</a>
</span><span class=lnt id=hl-6-647><a class=lnlinks href=#hl-6-647>647</a>
</span><span class=lnt id=hl-6-648><a class=lnlinks href=#hl-6-648>648</a>
</span><span class=lnt id=hl-6-649><a class=lnlinks href=#hl-6-649>649</a>
</span><span class=lnt id=hl-6-650><a class=lnlinks href=#hl-6-650>650</a>
</span><span class=lnt id=hl-6-651><a class=lnlinks href=#hl-6-651>651</a>
</span><span class=lnt id=hl-6-652><a class=lnlinks href=#hl-6-652>652</a>
</span><span class=lnt id=hl-6-653><a class=lnlinks href=#hl-6-653>653</a>
</span><span class=lnt id=hl-6-654><a class=lnlinks href=#hl-6-654>654</a>
</span><span class=lnt id=hl-6-655><a class=lnlinks href=#hl-6-655>655</a>
</span><span class=lnt id=hl-6-656><a class=lnlinks href=#hl-6-656>656</a>
</span><span class=lnt id=hl-6-657><a class=lnlinks href=#hl-6-657>657</a>
</span><span class=lnt id=hl-6-658><a class=lnlinks href=#hl-6-658>658</a>
</span><span class=lnt id=hl-6-659><a class=lnlinks href=#hl-6-659>659</a>
</span><span class=lnt id=hl-6-660><a class=lnlinks href=#hl-6-660>660</a>
</span><span class=lnt id=hl-6-661><a class=lnlinks href=#hl-6-661>661</a>
</span><span class=lnt id=hl-6-662><a class=lnlinks href=#hl-6-662>662</a>
</span><span class=lnt id=hl-6-663><a class=lnlinks href=#hl-6-663>663</a>
</span><span class=lnt id=hl-6-664><a class=lnlinks href=#hl-6-664>664</a>
</span><span class=lnt id=hl-6-665><a class=lnlinks href=#hl-6-665>665</a>
</span><span class=lnt id=hl-6-666><a class=lnlinks href=#hl-6-666>666</a>
</span><span class=lnt id=hl-6-667><a class=lnlinks href=#hl-6-667>667</a>
</span><span class=lnt id=hl-6-668><a class=lnlinks href=#hl-6-668>668</a>
</span><span class=lnt id=hl-6-669><a class=lnlinks href=#hl-6-669>669</a>
</span><span class=lnt id=hl-6-670><a class=lnlinks href=#hl-6-670>670</a>
</span><span class=lnt id=hl-6-671><a class=lnlinks href=#hl-6-671>671</a>
</span><span class=lnt id=hl-6-672><a class=lnlinks href=#hl-6-672>672</a>
</span><span class=lnt id=hl-6-673><a class=lnlinks href=#hl-6-673>673</a>
</span><span class=lnt id=hl-6-674><a class=lnlinks href=#hl-6-674>674</a>
</span><span class=lnt id=hl-6-675><a class=lnlinks href=#hl-6-675>675</a>
</span><span class=lnt id=hl-6-676><a class=lnlinks href=#hl-6-676>676</a>
</span><span class=lnt id=hl-6-677><a class=lnlinks href=#hl-6-677>677</a>
</span><span class=lnt id=hl-6-678><a class=lnlinks href=#hl-6-678>678</a>
</span><span class=lnt id=hl-6-679><a class=lnlinks href=#hl-6-679>679</a>
</span><span class=lnt id=hl-6-680><a class=lnlinks href=#hl-6-680>680</a>
</span><span class=lnt id=hl-6-681><a class=lnlinks href=#hl-6-681>681</a>
</span><span class=lnt id=hl-6-682><a class=lnlinks href=#hl-6-682>682</a>
</span><span class=lnt id=hl-6-683><a class=lnlinks href=#hl-6-683>683</a>
</span><span class=lnt id=hl-6-684><a class=lnlinks href=#hl-6-684>684</a>
</span><span class=lnt id=hl-6-685><a class=lnlinks href=#hl-6-685>685</a>
</span><span class=lnt id=hl-6-686><a class=lnlinks href=#hl-6-686>686</a>
</span><span class=lnt id=hl-6-687><a class=lnlinks href=#hl-6-687>687</a>
</span><span class=lnt id=hl-6-688><a class=lnlinks href=#hl-6-688>688</a>
</span><span class=lnt id=hl-6-689><a class=lnlinks href=#hl-6-689>689</a>
</span><span class=lnt id=hl-6-690><a class=lnlinks href=#hl-6-690>690</a>
</span><span class=lnt id=hl-6-691><a class=lnlinks href=#hl-6-691>691</a>
</span><span class=lnt id=hl-6-692><a class=lnlinks href=#hl-6-692>692</a>
</span><span class=lnt id=hl-6-693><a class=lnlinks href=#hl-6-693>693</a>
</span><span class=lnt id=hl-6-694><a class=lnlinks href=#hl-6-694>694</a>
</span><span class=lnt id=hl-6-695><a class=lnlinks href=#hl-6-695>695</a>
</span><span class=lnt id=hl-6-696><a class=lnlinks href=#hl-6-696>696</a>
</span><span class=lnt id=hl-6-697><a class=lnlinks href=#hl-6-697>697</a>
</span><span class=lnt id=hl-6-698><a class=lnlinks href=#hl-6-698>698</a>
</span><span class=lnt id=hl-6-699><a class=lnlinks href=#hl-6-699>699</a>
</span><span class=lnt id=hl-6-700><a class=lnlinks href=#hl-6-700>700</a>
</span><span class=lnt id=hl-6-701><a class=lnlinks href=#hl-6-701>701</a>
</span><span class=lnt id=hl-6-702><a class=lnlinks href=#hl-6-702>702</a>
</span><span class=lnt id=hl-6-703><a class=lnlinks href=#hl-6-703>703</a>
</span><span class=lnt id=hl-6-704><a class=lnlinks href=#hl-6-704>704</a>
</span><span class=lnt id=hl-6-705><a class=lnlinks href=#hl-6-705>705</a>
</span><span class=lnt id=hl-6-706><a class=lnlinks href=#hl-6-706>706</a>
</span><span class=lnt id=hl-6-707><a class=lnlinks href=#hl-6-707>707</a>
</span><span class=lnt id=hl-6-708><a class=lnlinks href=#hl-6-708>708</a>
</span><span class=lnt id=hl-6-709><a class=lnlinks href=#hl-6-709>709</a>
</span><span class=lnt id=hl-6-710><a class=lnlinks href=#hl-6-710>710</a>
</span><span class=lnt id=hl-6-711><a class=lnlinks href=#hl-6-711>711</a>
</span><span class=lnt id=hl-6-712><a class=lnlinks href=#hl-6-712>712</a>
</span><span class=lnt id=hl-6-713><a class=lnlinks href=#hl-6-713>713</a>
</span><span class=lnt id=hl-6-714><a class=lnlinks href=#hl-6-714>714</a>
</span><span class=lnt id=hl-6-715><a class=lnlinks href=#hl-6-715>715</a>
</span><span class=lnt id=hl-6-716><a class=lnlinks href=#hl-6-716>716</a>
</span><span class=lnt id=hl-6-717><a class=lnlinks href=#hl-6-717>717</a>
</span><span class=lnt id=hl-6-718><a class=lnlinks href=#hl-6-718>718</a>
</span><span class=lnt id=hl-6-719><a class=lnlinks href=#hl-6-719>719</a>
</span><span class=lnt id=hl-6-720><a class=lnlinks href=#hl-6-720>720</a>
</span><span class=lnt id=hl-6-721><a class=lnlinks href=#hl-6-721>721</a>
</span><span class=lnt id=hl-6-722><a class=lnlinks href=#hl-6-722>722</a>
</span><span class=lnt id=hl-6-723><a class=lnlinks href=#hl-6-723>723</a>
</span><span class=lnt id=hl-6-724><a class=lnlinks href=#hl-6-724>724</a>
</span><span class=lnt id=hl-6-725><a class=lnlinks href=#hl-6-725>725</a>
</span><span class=lnt id=hl-6-726><a class=lnlinks href=#hl-6-726>726</a>
</span><span class=lnt id=hl-6-727><a class=lnlinks href=#hl-6-727>727</a>
</span><span class=lnt id=hl-6-728><a class=lnlinks href=#hl-6-728>728</a>
</span><span class=lnt id=hl-6-729><a class=lnlinks href=#hl-6-729>729</a>
</span><span class=lnt id=hl-6-730><a class=lnlinks href=#hl-6-730>730</a>
</span><span class=lnt id=hl-6-731><a class=lnlinks href=#hl-6-731>731</a>
</span><span class=lnt id=hl-6-732><a class=lnlinks href=#hl-6-732>732</a>
</span><span class=lnt id=hl-6-733><a class=lnlinks href=#hl-6-733>733</a>
</span><span class=lnt id=hl-6-734><a class=lnlinks href=#hl-6-734>734</a>
</span><span class=lnt id=hl-6-735><a class=lnlinks href=#hl-6-735>735</a>
</span><span class=lnt id=hl-6-736><a class=lnlinks href=#hl-6-736>736</a>
</span><span class=lnt id=hl-6-737><a class=lnlinks href=#hl-6-737>737</a>
</span><span class=lnt id=hl-6-738><a class=lnlinks href=#hl-6-738>738</a>
</span><span class=lnt id=hl-6-739><a class=lnlinks href=#hl-6-739>739</a>
</span><span class=lnt id=hl-6-740><a class=lnlinks href=#hl-6-740>740</a>
</span><span class=lnt id=hl-6-741><a class=lnlinks href=#hl-6-741>741</a>
</span><span class=lnt id=hl-6-742><a class=lnlinks href=#hl-6-742>742</a>
</span><span class=lnt id=hl-6-743><a class=lnlinks href=#hl-6-743>743</a>
</span><span class=lnt id=hl-6-744><a class=lnlinks href=#hl-6-744>744</a>
</span><span class=lnt id=hl-6-745><a class=lnlinks href=#hl-6-745>745</a>
</span><span class=lnt id=hl-6-746><a class=lnlinks href=#hl-6-746>746</a>
</span><span class=lnt id=hl-6-747><a class=lnlinks href=#hl-6-747>747</a>
</span><span class=lnt id=hl-6-748><a class=lnlinks href=#hl-6-748>748</a>
</span><span class=lnt id=hl-6-749><a class=lnlinks href=#hl-6-749>749</a>
</span><span class=lnt id=hl-6-750><a class=lnlinks href=#hl-6-750>750</a>
</span><span class=lnt id=hl-6-751><a class=lnlinks href=#hl-6-751>751</a>
</span><span class=lnt id=hl-6-752><a class=lnlinks href=#hl-6-752>752</a>
</span><span class=lnt id=hl-6-753><a class=lnlinks href=#hl-6-753>753</a>
</span><span class=lnt id=hl-6-754><a class=lnlinks href=#hl-6-754>754</a>
</span><span class=lnt id=hl-6-755><a class=lnlinks href=#hl-6-755>755</a>
</span><span class=lnt id=hl-6-756><a class=lnlinks href=#hl-6-756>756</a>
</span><span class=lnt id=hl-6-757><a class=lnlinks href=#hl-6-757>757</a>
</span><span class=lnt id=hl-6-758><a class=lnlinks href=#hl-6-758>758</a>
</span><span class=lnt id=hl-6-759><a class=lnlinks href=#hl-6-759>759</a>
</span><span class=lnt id=hl-6-760><a class=lnlinks href=#hl-6-760>760</a>
</span><span class=lnt id=hl-6-761><a class=lnlinks href=#hl-6-761>761</a>
</span><span class=lnt id=hl-6-762><a class=lnlinks href=#hl-6-762>762</a>
</span><span class=lnt id=hl-6-763><a class=lnlinks href=#hl-6-763>763</a>
</span><span class=lnt id=hl-6-764><a class=lnlinks href=#hl-6-764>764</a>
</span><span class=lnt id=hl-6-765><a class=lnlinks href=#hl-6-765>765</a>
</span><span class=lnt id=hl-6-766><a class=lnlinks href=#hl-6-766>766</a>
</span><span class=lnt id=hl-6-767><a class=lnlinks href=#hl-6-767>767</a>
</span><span class=lnt id=hl-6-768><a class=lnlinks href=#hl-6-768>768</a>
</span><span class=lnt id=hl-6-769><a class=lnlinks href=#hl-6-769>769</a>
</span><span class=lnt id=hl-6-770><a class=lnlinks href=#hl-6-770>770</a>
</span><span class=lnt id=hl-6-771><a class=lnlinks href=#hl-6-771>771</a>
</span><span class=lnt id=hl-6-772><a class=lnlinks href=#hl-6-772>772</a>
</span><span class=lnt id=hl-6-773><a class=lnlinks href=#hl-6-773>773</a>
</span><span class=lnt id=hl-6-774><a class=lnlinks href=#hl-6-774>774</a>
</span><span class=lnt id=hl-6-775><a class=lnlinks href=#hl-6-775>775</a>
</span><span class=lnt id=hl-6-776><a class=lnlinks href=#hl-6-776>776</a>
</span><span class=lnt id=hl-6-777><a class=lnlinks href=#hl-6-777>777</a>
</span><span class=lnt id=hl-6-778><a class=lnlinks href=#hl-6-778>778</a>
</span><span class=lnt id=hl-6-779><a class=lnlinks href=#hl-6-779>779</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Apache Kafka를 활용한 Queue와 Topic 패턴 구현
</span></span></span><span class=line><span class=cl><span class=s2>- kafka-python 라이브러리 사용
</span></span></span><span class=line><span class=cl><span class=s2>- Queue: 단일 파티션 + 컨슈머 그룹 활용
</span></span></span><span class=line><span class=cl><span class=s2>- Topic: 다중 파티션 + 다중 컨슈머 그룹 활용
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>설치 필요 라이브러리:
</span></span></span><span class=line><span class=cl><span class=s2>pip install kafka-python
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Callable</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span><span class=p>,</span> <span class=n>asdict</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span><span class=p>,</span> <span class=n>KafkaConsumer</span><span class=p>,</span> <span class=n>KafkaAdminClient</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka.admin</span> <span class=kn>import</span> <span class=n>NewTopic</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka.errors</span> <span class=kn>import</span> <span class=n>TopicAlreadyExistsError</span><span class=p>,</span> <span class=n>KafkaError</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>signal</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 로깅 설정</span>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>KafkaMessage</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kafka 메시지 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>partition</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>offset</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>to_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지를 딕셔너리로 변환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>asdict</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span><span class=p>[</span><span class=s1>&#39;timestamp&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@classmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>from_kafka_message</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>msg</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s1>&#39;KafkaMessage&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka ConsumerRecord에서 KafkaMessage 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>cls</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nb>id</span><span class=o>=</span><span class=n>content</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())),</span>
</span></span><span class=line><span class=cl>                <span class=n>content</span><span class=o>=</span><span class=n>content</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;content&#39;</span><span class=p>,</span> <span class=p>{}),</span>
</span></span><span class=line><span class=cl>                <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>fromisoformat</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;timestamp&#39;</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>())),</span>
</span></span><span class=line><span class=cl>                <span class=n>partition</span><span class=o>=</span><span class=n>msg</span><span class=o>.</span><span class=n>partition</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>offset</span><span class=o>=</span><span class=n>msg</span><span class=o>.</span><span class=n>offset</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=n>msg</span><span class=o>.</span><span class=n>key</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=n>msg</span><span class=o>.</span><span class=n>key</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 파싱 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>cls</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nb>id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                <span class=n>content</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;raw_value&#34;</span><span class=p>:</span> <span class=n>msg</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)},</span>
</span></span><span class=line><span class=cl>                <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=n>partition</span><span class=o>=</span><span class=n>msg</span><span class=o>.</span><span class=n>partition</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>offset</span><span class=o>=</span><span class=n>msg</span><span class=o>.</span><span class=n>offset</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>KafkaQueueProducer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Kafka를 활용한 Queue 패턴 프로듀서
</span></span></span><span class=line><span class=cl><span class=s2>    - 단일 파티션으로 순서 보장
</span></span></span><span class=line><span class=cl><span class=s2>    - Round-robin 방식으로 컨슈머에게 분배
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;localhost:9092&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span> <span class=o>=</span> <span class=n>bootstrap_servers</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_setup_producer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_setup_producer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 프로듀서 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>bootstrap_servers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>key_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=n>x</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=c1># 안정성을 위한 설정</span>
</span></span><span class=line><span class=cl>                <span class=n>acks</span><span class=o>=</span><span class=s1>&#39;all&#39;</span><span class=p>,</span>  <span class=c1># 모든 replica 확인</span>
</span></span><span class=line><span class=cl>                <span class=n>retries</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>   <span class=c1># 재시도 횟수</span>
</span></span><span class=line><span class=cl>                <span class=n>enable_idempotence</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># 중복 방지</span>
</span></span><span class=line><span class=cl>                <span class=n>max_in_flight_requests_per_connection</span><span class=o>=</span><span class=mi>1</span>  <span class=c1># 순서 보장</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Kafka 프로듀서 초기화 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Kafka 프로듀서 초기화 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>send_to_queue</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>content</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                           <span class=n>key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Queue에 메시지 전송
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            topic_name: 토픽 이름
</span></span></span><span class=line><span class=cl><span class=s2>            content: 메시지 내용
</span></span></span><span class=line><span class=cl><span class=s2>            key: 파티션 키 (순서 보장용)
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            str: 메시지 ID
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>message_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>message_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>message_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;content&#39;</span><span class=p>:</span> <span class=n>content</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 비동기 전송</span>
</span></span><span class=line><span class=cl>            <span class=n>future</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>topic_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>value</span><span class=o>=</span><span class=n>message_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=n>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>partition</span><span class=o>=</span><span class=mi>0</span>  <span class=c1># Queue 패턴을 위해 단일 파티션 사용</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 전송 결과 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>record_metadata</span> <span class=o>=</span> <span class=n>future</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Queue 메시지 전송 완료 - Topic: </span><span class=si>{</span><span class=n>topic_name</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;ID: </span><span class=si>{</span><span class=n>message_id</span><span class=si>}</span><span class=s2>, Partition: </span><span class=si>{</span><span class=n>record_metadata</span><span class=o>.</span><span class=n>partition</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;Offset: </span><span class=si>{</span><span class=n>record_metadata</span><span class=o>.</span><span class=n>offset</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>message_id</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Queue 메시지 전송 실패 - Topic: </span><span class=si>{</span><span class=n>topic_name</span><span class=si>}</span><span class=s2>, Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>send_batch_to_queue</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                 <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배치 메시지 전송&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>message_ids</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>message_id</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>send_to_queue</span><span class=p>(</span><span class=n>topic_name</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>message_ids</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>message_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>message_ids</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>close</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;프로듀서 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Kafka 프로듀서 종료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>KafkaQueueConsumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Kafka를 활용한 Queue 패턴 컨슈머
</span></span></span><span class=line><span class=cl><span class=s2>    - 컨슈머 그룹을 통한 메시지 분산 처리
</span></span></span><span class=line><span class=cl><span class=s2>    - 자동 오프셋 커밋으로 중복 처리 방지
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>consumer_group</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>consumer_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;localhost:9092&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topic_name</span> <span class=o>=</span> <span class=n>topic_name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer_group</span> <span class=o>=</span> <span class=n>consumer_group</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span> <span class=o>=</span> <span class=n>consumer_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span> <span class=o>=</span> <span class=n>bootstrap_servers</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Callable</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>processed_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>error_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_setup_consumer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_setup_consumer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 컨슈머 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>topic_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>bootstrap_servers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>group_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_group</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>client_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=c1># 자동 오프셋 커밋으로 at-least-once 보장</span>
</span></span><span class=line><span class=cl>                <span class=n>enable_auto_commit</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>auto_commit_interval_ms</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=c1># 가장 오래된 메시지부터 소비</span>
</span></span><span class=line><span class=cl>                <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=c1># 세션 타임아웃 설정</span>
</span></span><span class=line><span class=cl>                <span class=n>session_timeout_ms</span><span class=o>=</span><span class=mi>30000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>heartbeat_interval_ms</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=c1># 메시지 크기 제한</span>
</span></span><span class=line><span class=cl>                <span class=n>max_partition_fetch_bytes</span><span class=o>=</span><span class=mi>1048576</span><span class=p>,</span>  <span class=c1># 1MB</span>
</span></span><span class=line><span class=cl>                <span class=n>fetch_max_wait_ms</span><span class=o>=</span><span class=mi>500</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Kafka 컨슈머 초기화 완료 - Group: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_group</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;Consumer: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Kafka 컨슈머 초기화 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start_consuming</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message_handler</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[</span><span class=n>KafkaMessage</span><span class=p>],</span> <span class=nb>bool</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        메시지 소비 시작
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            message_handler: 메시지 처리 함수 (KafkaMessage -&gt; bool)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span> <span class=o>=</span> <span class=n>message_handler</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Queue 컨슈머 시작 - Consumer: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 메시지 폴링 (타임아웃 1초)</span>
</span></span><span class=line><span class=cl>                <span class=n>msg_pack</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>poll</span><span class=p>(</span><span class=n>timeout_ms</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>msg_pack</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 수신된 메시지 처리</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>topic_partition</span><span class=p>,</span> <span class=n>messages</span> <span class=ow>in</span> <span class=n>msg_pack</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=n>kafka_message</span> <span class=o>=</span> <span class=n>KafkaMessage</span><span class=o>.</span><span class=n>from_kafka_message</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            
</span></span><span class=line><span class=cl>                            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 수신 - Consumer: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                                       <span class=sa>f</span><span class=s2>&#34;ID: </span><span class=si>{</span><span class=n>kafka_message</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                                       <span class=sa>f</span><span class=s2>&#34;Partition: </span><span class=si>{</span><span class=n>kafka_message</span><span class=o>.</span><span class=n>partition</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                                       <span class=sa>f</span><span class=s2>&#34;Offset: </span><span class=si>{</span><span class=n>kafka_message</span><span class=o>.</span><span class=n>offset</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            
</span></span><span class=line><span class=cl>                            <span class=c1># 메시지 처리</span>
</span></span><span class=line><span class=cl>                            <span class=n>success</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_message</span><span class=p>(</span><span class=n>kafka_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            
</span></span><span class=line><span class=cl>                            <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                                <span class=bp>self</span><span class=o>.</span><span class=n>processed_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                                <span class=bp>self</span><span class=o>.</span><span class=n>error_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                                
</span></span><span class=line><span class=cl>                        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=bp>self</span><span class=o>.</span><span class=n>error_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 처리 오류 - Consumer: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                                       <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;컨슈머 실행 오류 - Consumer: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2>, Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_process_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>KafkaMessage</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 동기 함수인 경우 스레드 풀에서 실행</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>iscoroutinefunction</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>loop</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>loop</span><span class=o>.</span><span class=n>run_in_executor</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 처리 완료 - Consumer: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                           <span class=sa>f</span><span class=s2>&#34;Message: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 처리 실패 - Consumer: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                        <span class=sa>f</span><span class=s2>&#34;Message: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>, Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;컨슈머 정지&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Queue 컨슈머 정지 요청 - Consumer: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>close</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;컨슈머 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Kafka 컨슈머 종료 - Consumer: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;컨슈머 통계&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;consumer_id&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;consumer_group&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer_group</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;topic_name&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>topic_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;processed_count&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>processed_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;error_count&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;is_running&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>KafkaTopicProducer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Kafka를 활용한 Topic 패턴 프로듀서 (Publish-Subscribe)
</span></span></span><span class=line><span class=cl><span class=s2>    - 다중 파티션으로 확장성 제공
</span></span></span><span class=line><span class=cl><span class=s2>    - 다중 컨슈머 그룹에 메시지 브로드캐스트
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;localhost:9092&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span> <span class=o>=</span> <span class=n>bootstrap_servers</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_setup_producer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_setup_producer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 프로듀서 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>bootstrap_servers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>key_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=n>x</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=c1># 처리량 최적화를 위한 설정</span>
</span></span><span class=line><span class=cl>                <span class=n>acks</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>  <span class=c1># 리더만 확인 (성능 vs 안정성)</span>
</span></span><span class=line><span class=cl>                <span class=n>compression_type</span><span class=o>=</span><span class=s1>&#39;snappy&#39;</span><span class=p>,</span>  <span class=c1># 압축으로 네트워크 효율성</span>
</span></span><span class=line><span class=cl>                <span class=n>batch_size</span><span class=o>=</span><span class=mi>16384</span><span class=p>,</span>  <span class=c1># 배치 크기</span>
</span></span><span class=line><span class=cl>                <span class=n>linger_ms</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>  <span class=c1># 배치 대기 시간</span>
</span></span><span class=line><span class=cl>                <span class=n>retries</span><span class=o>=</span><span class=mi>3</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Kafka Topic 프로듀서 초기화 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Kafka Topic 프로듀서 초기화 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish_to_topic</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>content</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                              <span class=n>key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                              <span class=n>headers</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Topic에 메시지 발행
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            topic_name: 토픽 이름
</span></span></span><span class=line><span class=cl><span class=s2>            content: 메시지 내용
</span></span></span><span class=line><span class=cl><span class=s2>            key: 파티션 키
</span></span></span><span class=line><span class=cl><span class=s2>            headers: 메시지 헤더
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            str: 메시지 ID
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>message_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>message_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>message_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;content&#39;</span><span class=p>:</span> <span class=n>content</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;headers&#39;</span><span class=p>:</span> <span class=n>headers</span> <span class=ow>or</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 헤더 변환 (Kafka는 바이트 헤더만 지원)</span>
</span></span><span class=line><span class=cl>            <span class=n>kafka_headers</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>headers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>kafka_headers</span> <span class=o>=</span> <span class=p>[(</span><span class=n>k</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>                               <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>headers</span><span class=o>.</span><span class=n>items</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 비동기 전송 (파티션은 키에 따라 자동 결정)</span>
</span></span><span class=line><span class=cl>            <span class=n>future</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>topic_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>value</span><span class=o>=</span><span class=n>message_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=n>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>headers</span><span class=o>=</span><span class=n>kafka_headers</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 전송 결과 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>record_metadata</span> <span class=o>=</span> <span class=n>future</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Topic 메시지 발행 완료 - Topic: </span><span class=si>{</span><span class=n>topic_name</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;ID: </span><span class=si>{</span><span class=n>message_id</span><span class=si>}</span><span class=s2>, Partition: </span><span class=si>{</span><span class=n>record_metadata</span><span class=o>.</span><span class=n>partition</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;Offset: </span><span class=si>{</span><span class=n>record_metadata</span><span class=o>.</span><span class=n>offset</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>message_id</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Topic 메시지 발행 실패 - Topic: </span><span class=si>{</span><span class=n>topic_name</span><span class=si>}</span><span class=s2>, Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>publish_batch_to_topic</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                    <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배치 메시지 발행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>message_ids</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>message_id</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>publish_to_topic</span><span class=p>(</span><span class=n>topic_name</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>message_ids</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>message_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 배치 전송 완료 대기</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>message_ids</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>close</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;프로듀서 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Kafka Topic 프로듀서 종료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>KafkaTopicSubscriber</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Kafka를 활용한 Topic 패턴 구독자
</span></span></span><span class=line><span class=cl><span class=s2>    - 독립적인 컨슈머 그룹으로 모든 메시지 수신
</span></span></span><span class=line><span class=cl><span class=s2>    - 다중 파티션에서 병렬 처리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>subscriber_group</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>subscriber_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;localhost:9092&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topic_name</span> <span class=o>=</span> <span class=n>topic_name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscriber_group</span> <span class=o>=</span> <span class=n>subscriber_group</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span> <span class=o>=</span> <span class=n>subscriber_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span> <span class=o>=</span> <span class=n>bootstrap_servers</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Callable</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>processed_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>error_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_setup_consumer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_setup_consumer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Kafka 컨슈머 설정&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>topic_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>bootstrap_servers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>group_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_group</span><span class=p>,</span>  <span class=c1># 각 구독자는 별도 그룹</span>
</span></span><span class=line><span class=cl>                <span class=n>client_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>enable_auto_commit</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>auto_commit_interval_ms</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=c1># 최신 메시지부터 소비 (실시간 스트리밍용)</span>
</span></span><span class=line><span class=cl>                <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;latest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>session_timeout_ms</span><span class=o>=</span><span class=mi>30000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>heartbeat_interval_ms</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=c1># 처리량 최적화</span>
</span></span><span class=line><span class=cl>                <span class=n>fetch_min_bytes</span><span class=o>=</span><span class=mi>1024</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>fetch_max_wait_ms</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>max_partition_fetch_bytes</span><span class=o>=</span><span class=mi>1048576</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Kafka Topic 구독자 초기화 완료 - Group: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_group</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;Subscriber: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Kafka Topic 구독자 초기화 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start_subscribing</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message_handler</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[</span><span class=n>KafkaMessage</span><span class=p>],</span> <span class=nb>bool</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        토픽 구독 시작
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            message_handler: 메시지 처리 함수
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span> <span class=o>=</span> <span class=n>message_handler</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Topic 구독자 시작 - Subscriber: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>msg_pack</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>poll</span><span class=p>(</span><span class=n>timeout_ms</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>msg_pack</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 수신된 메시지 처리 (다중 파티션)</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>topic_partition</span><span class=p>,</span> <span class=n>messages</span> <span class=ow>in</span> <span class=n>msg_pack</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=n>kafka_message</span> <span class=o>=</span> <span class=n>KafkaMessage</span><span class=o>.</span><span class=n>from_kafka_message</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            
</span></span><span class=line><span class=cl>                            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 수신 - Subscriber: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                                       <span class=sa>f</span><span class=s2>&#34;ID: </span><span class=si>{</span><span class=n>kafka_message</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                                       <span class=sa>f</span><span class=s2>&#34;Partition: </span><span class=si>{</span><span class=n>kafka_message</span><span class=o>.</span><span class=n>partition</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            
</span></span><span class=line><span class=cl>                            <span class=c1># 메시지 처리</span>
</span></span><span class=line><span class=cl>                            <span class=n>success</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_message</span><span class=p>(</span><span class=n>kafka_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            
</span></span><span class=line><span class=cl>                            <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                                <span class=bp>self</span><span class=o>.</span><span class=n>processed_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                                <span class=bp>self</span><span class=o>.</span><span class=n>error_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                                
</span></span><span class=line><span class=cl>                        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=bp>self</span><span class=o>.</span><span class=n>error_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 처리 오류 - Subscriber: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                                       <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;구독자 실행 오류 - Subscriber: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=si>}</span><span class=s2>, Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_process_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>KafkaMessage</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;메시지 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>iscoroutinefunction</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>loop</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>loop</span><span class=o>.</span><span class=n>run_in_executor</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>message_handler</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 처리 완료 - Subscriber: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                           <span class=sa>f</span><span class=s2>&#34;Message: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;메시지 처리 실패 - Subscriber: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                        <span class=sa>f</span><span class=s2>&#34;Message: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>, Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;구독자 정지&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Topic 구독자 정지 요청 - Subscriber: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>close</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;구독자 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Kafka Topic 구독자 종료 - Subscriber: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;구독자 통계&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;subscriber_id&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscriber_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;subscriber_group&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscriber_group</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;topic_name&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>topic_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;processed_count&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>processed_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;error_count&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;is_running&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_running</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>KafkaTopicManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kafka 토픽 관리 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;localhost:9092&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span> <span class=o>=</span> <span class=n>bootstrap_servers</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>admin_client</span> <span class=o>=</span> <span class=n>KafkaAdminClient</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>client_id</span><span class=o>=</span><span class=s1>&#39;topic_manager&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_topic</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>num_partitions</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                    <span class=n>replication_factor</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;토픽 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>topic</span> <span class=o>=</span> <span class=n>NewTopic</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span><span class=o>=</span><span class=n>topic_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>num_partitions</span><span class=o>=</span><span class=n>num_partitions</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>replication_factor</span><span class=o>=</span><span class=n>replication_factor</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>admin_client</span><span class=o>.</span><span class=n>create_topics</span><span class=p>([</span><span class=n>topic</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;토픽 생성 완료 - Name: </span><span class=si>{</span><span class=n>topic_name</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;Partitions: </span><span class=si>{</span><span class=n>num_partitions</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>TopicAlreadyExistsError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;토픽이 이미 존재함 - Name: </span><span class=si>{</span><span class=n>topic_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;토픽 생성 실패 - Name: </span><span class=si>{</span><span class=n>topic_name</span><span class=si>}</span><span class=s2>, Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>close</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;어드민 클라이언트 종료&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>admin_client</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메시지 핸들러 예시들</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>order_queue_handler</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>KafkaMessage</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;주문 큐 처리 핸들러&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>order_data</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;order_id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>customer_id</span> <span class=o>=</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customer_id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>amount</span> <span class=o>=</span> <span class=n>order_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;amount&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[주문 처리] Order: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>, Customer: </span><span class=si>{</span><span class=n>customer_id</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                   <span class=sa>f</span><span class=s2>&#34;Amount: </span><span class=si>{</span><span class=n>amount</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 처리 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>inventory_topic_handler</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>KafkaMessage</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;재고 토픽 구독 핸들러&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>event_data</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;event_type&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=s1>&#39;order_completed&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;order_id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>items</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;items&#39;</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[재고 서비스] 주문 </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>에 대한 재고 차감: </span><span class=si>{</span><span class=n>items</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.05</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 처리 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>notification_topic_handler</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>KafkaMessage</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;알림 토픽 구독 핸들러&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>event_data</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;event_type&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=s1>&#39;order_completed&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>customer_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customer_id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;order_id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[알림 서비스] 고객 </span><span class=si>{</span><span class=n>customer_id</span><span class=si>}</span><span class=s2>에게 주문 </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2> 완료 알림 발송&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.02</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;알림 처리 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>kafka_queue_example</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kafka Queue 패턴 예시&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>topic_manager</span> <span class=o>=</span> <span class=n>KafkaTopicManager</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 큐용 토픽 생성 (단일 파티션)</span>
</span></span><span class=line><span class=cl>    <span class=n>queue_topic</span> <span class=o>=</span> <span class=s2>&#34;order_processing_queue&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>topic_manager</span><span class=o>.</span><span class=n>create_topic</span><span class=p>(</span><span class=n>queue_topic</span><span class=p>,</span> <span class=n>num_partitions</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 프로듀서 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaQueueProducer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 컨슈머 생성 (같은 그룹 - 작업 분산)</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer_group</span> <span class=o>=</span> <span class=s2>&#34;order_workers&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer1</span> <span class=o>=</span> <span class=n>KafkaQueueConsumer</span><span class=p>(</span><span class=n>queue_topic</span><span class=p>,</span> <span class=n>consumer_group</span><span class=p>,</span> <span class=s2>&#34;worker_1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer2</span> <span class=o>=</span> <span class=n>KafkaQueueConsumer</span><span class=p>(</span><span class=n>queue_topic</span><span class=p>,</span> <span class=n>consumer_group</span><span class=p>,</span> <span class=s2>&#34;worker_2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer3</span> <span class=o>=</span> <span class=n>KafkaQueueConsumer</span><span class=p>(</span><span class=n>queue_topic</span><span class=p>,</span> <span class=n>consumer_group</span><span class=p>,</span> <span class=s2>&#34;worker_3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 컨슈머 시작 (백그라운드)</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer_tasks</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span><span class=n>consumer1</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>(</span><span class=n>order_queue_handler</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>            <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span><span class=n>consumer2</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>(</span><span class=n>order_queue_handler</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>            <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span><span class=n>consumer3</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>(</span><span class=n>order_queue_handler</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;=== Kafka Queue 패턴 시작 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 주문 메시지 전송</span>
</span></span><span class=line><span class=cl>        <span class=n>orders</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;ORD-</span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s2>03d</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;CUST-</span><span class=si>{</span><span class=n>i</span><span class=o>%</span><span class=mi>5</span><span class=si>:</span><span class=s2>03d</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=mi>1000</span> <span class=o>+</span> <span class=n>i</span><span class=o>*</span><span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&#34;item-</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>11</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>producer</span><span class=o>.</span><span class=n>send_batch_to_queue</span><span class=p>(</span><span class=n>queue_topic</span><span class=p>,</span> <span class=n>orders</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 처리 완료 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 통계 출력</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;=== Queue 처리 결과 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>consumer</span> <span class=ow>in</span> <span class=p>[</span><span class=n>consumer1</span><span class=p>,</span> <span class=n>consumer2</span><span class=p>,</span> <span class=n>consumer3</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>stats</span> <span class=o>=</span> <span class=n>consumer</span><span class=o>.</span><span class=n>get_stats</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Consumer </span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;consumer_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;처리됨=</span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;processed_count&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;에러=</span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;error_count&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 정리</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer1</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer2</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer3</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>task</span> <span class=ow>in</span> <span class=n>consumer_tasks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>task</span><span class=o>.</span><span class=n>cancel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>producer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>topic_manager</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>kafka_topic_example</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kafka Topic 패턴 예시&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>topic_manager</span> <span class=o>=</span> <span class=n>KafkaTopicManager</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 토픽용 토픽 생성 (다중 파티션)</span>
</span></span><span class=line><span class=cl>    <span class=n>event_topic</span> <span class=o>=</span> <span class=s2>&#34;order_events&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>topic_manager</span><span class=o>.</span><span class=n>create_topic</span><span class=p>(</span><span class=n>event_topic</span><span class=p>,</span> <span class=n>num_partitions</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 프로듀서 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaTopicProducer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 구독자 생성 (각기 다른 그룹 - 모든 메시지 수신)</span>
</span></span><span class=line><span class=cl>    <span class=n>inventory_subscriber</span> <span class=o>=</span> <span class=n>KafkaTopicSubscriber</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>event_topic</span><span class=p>,</span> <span class=s2>&#34;inventory_service&#34;</span><span class=p>,</span> <span class=s2>&#34;inventory_1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>notification_subscriber</span> <span class=o>=</span> <span class=n>KafkaTopicSubscriber</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>event_topic</span><span class=p>,</span> <span class=s2>&#34;notification_service&#34;</span><span class=p>,</span> <span class=s2>&#34;notification_1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 구독자 시작 (백그라운드)</span>
</span></span><span class=line><span class=cl>        <span class=n>subscriber_tasks</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>inventory_subscriber</span><span class=o>.</span><span class=n>start_subscribing</span><span class=p>(</span><span class=n>inventory_topic_handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>notification_subscriber</span><span class=o>.</span><span class=n>start_subscribing</span><span class=p>(</span><span class=n>notification_topic_handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;=== Kafka Topic 패턴 시작 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 잠시 대기 (구독자 준비 시간)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 메시지 발행</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;order_completed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;ORD-</span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s2>03d</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;CUST-</span><span class=si>{</span><span class=n>i</span><span class=o>%</span><span class=mi>3</span><span class=si>:</span><span class=s2>03d</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=mi>1500</span> <span class=o>+</span> <span class=n>i</span><span class=o>*</span><span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&#34;item-</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;item-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>5</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>producer</span><span class=o>.</span><span class=n>publish_batch_to_topic</span><span class=p>(</span><span class=n>event_topic</span><span class=p>,</span> <span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 처리 완료 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 통계 출력</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;=== Topic 처리 결과 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>subscriber</span> <span class=ow>in</span> <span class=p>[</span><span class=n>inventory_subscriber</span><span class=p>,</span> <span class=n>notification_subscriber</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>stats</span> <span class=o>=</span> <span class=n>subscriber</span><span class=o>.</span><span class=n>get_stats</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Subscriber </span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;subscriber_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;처리됨=</span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;processed_count&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;에러=</span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;error_count&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 정리</span>
</span></span><span class=line><span class=cl>        <span class=n>inventory_subscriber</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>notification_subscriber</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>task</span> <span class=ow>in</span> <span class=n>subscriber_tasks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>task</span><span class=o>.</span><span class=n>cancel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>producer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>topic_manager</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메인 실행 함수</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메인 실행 함수&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>signal_handler</span><span class=p>(</span><span class=n>signum</span><span class=p>,</span> <span class=n>frame</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;프로그램 종료 신호 받음&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 시그널 핸들러 등록</span>
</span></span><span class=line><span class=cl>    <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGINT</span><span class=p>,</span> <span class=n>signal_handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGTERM</span><span class=p>,</span> <span class=n>signal_handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Kafka 예시 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Queue 패턴 예시 실행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>kafka_queue_example</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Topic 패턴 예시 실행</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>kafka_topic_example</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Kafka 예시 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;실행 중 오류 발생: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;프로그램 종료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-3-주문-처리-시스템>사례 3: 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-3-주문-처리-시스템>#</a></h4><p><strong>시스템 구성</strong>:</p><table><thead><tr><th>구성 요소</th><th>설명</th></tr></thead><tbody><tr><td><strong>Queue</strong></td><td><code>order_queue</code>: 작업 (Task) 전용. FIFO 처리 보장.</td></tr><tr><td><strong>Exchange</strong></td><td><code>events</code>: fanout 타입. 모든 구독자에게 메시지를 broadcast.</td></tr><tr><td><strong>Producer</strong></td><td>주문 생성 시스템. Queue 에 작업 메시지 전송 또는 이벤트 발행.</td></tr><tr><td><strong>Consumer</strong></td><td>주문 처리 시스템. Queue 에서 작업 수신 후 처리.</td></tr><tr><td><strong>Subscriber</strong></td><td>이벤트 처리 시스템들. 이벤트를 받아 로그 기록, 알림 등 수행.</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌───────────────┐
</span></span><span class=line><span class=cl>│  Order Client │
</span></span><span class=line><span class=cl>└──────┬────────┘
</span></span><span class=line><span class=cl>       │
</span></span><span class=line><span class=cl>       ▼
</span></span><span class=line><span class=cl>┌────────────────────┐
</span></span><span class=line><span class=cl>│   RabbitMQ Broker  │
</span></span><span class=line><span class=cl>│ ┌───────────────┐ │
</span></span><span class=line><span class=cl>│ │ Queue: order  │ │◄───── Consumer (Order Processor)
</span></span><span class=line><span class=cl>│ └───────────────┘ │
</span></span><span class=line><span class=cl>│ ┌───────────────┐ │
</span></span><span class=line><span class=cl>│ │ Exchange:     │ │
</span></span><span class=line><span class=cl>│ │   events(fan) │ │◄───── Multiple Subscribers
</span></span><span class=line><span class=cl>│ └───────────────┘ │
</span></span><span class=line><span class=cl>└────────────────────┘
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Queue 방식 (Point-to-Point)</strong>:<ul><li><code>order_queue</code> 라는 이름의 큐에 메시지를 <strong>하나의 소비자가 처리</strong>.</li><li>FIFO 기반으로 작업 (Task) 처리가 적합.</li></ul></li><li><strong>Topic 방식 (Fanout Exchange 사용)</strong>:<ul><li><code>events</code> 라는 fanout exchange 를 통해 <strong>여러 소비자에게 동시에 브로드캐스트</strong>.</li><li>이벤트 알림/상태 변경 전파에 적합.</li></ul></li></ul><p><strong>메시지 흐름 (Workflow)</strong>:</p><ul><li>Queue 기반 (작업 처리용)<ol><li><strong>Producer</strong> (<code>producer_queue.py</code>):<ul><li><code>order_queue</code> 에 <code>"order_id": 12345, "status": "NEW"</code> 메시지 전송.</li></ul></li><li><strong>Consumer</strong> (<code>consumer_queue.py</code>):<ul><li>큐에 메시지가 도착하면 <strong>한 명의 소비자가 처리</strong>.</li><li>메시지는 큐에서 제거됨.</li></ul></li></ol></li><li>Topic 기반 (이벤트 브로드캐스트용)<ol><li><strong>Producer</strong> (<code>producer_topic.py</code>):<ul><li><code>events</code> exchange 에 <code>"event": "ORDER_CREATED"</code> 메시지 전송.</li><li><code>fanout</code> 타입으로, <strong>라우팅 키 없이 모든 바인딩된 큐에 전송</strong>.</li></ul></li><li><strong>Subscriber</strong> (<code>subscriber_topic.py</code>):<ul><li>빈 queue 선언 후 <code>events</code> exchange 에 바인딩.</li><li>동일한 이벤트를 <strong>여러 구독자들이 동시에 수신</strong> 가능.</li></ul></li></ol></li></ul><p><strong>구현 예시</strong>:</p><ol><li><p>Queue 예시 (Point-to-Point)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># producer_queue.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주문 메시지 발행</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>body</span><span class=o>=</span><span class=s1>&#39;{&#34;order_id&#34;: 12345, &#34;status&#34;: &#34;NEW&#34;}&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Order sent to Queue&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># consumer_queue.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[x] Received Order: </span><span class=si>{</span><span class=n>body</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;order_queue&#39;</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span> <span class=n>auto_ack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Waiting for orders…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Topic 예시 (Publish-Subscribe)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># producer_topic.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Topic exchange 선언</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;events&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;fanout&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 브로드캐스트</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_publish</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>routing_key</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>body</span><span class=o>=</span><span class=s1>&#39;{&#34;event&#34;: &#34;ORDER_CREATED&#34;}&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Event broadcasted&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># subscriber_topic.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pika</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>callback</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>properties</span><span class=p>,</span> <span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[x] Received Event: </span><span class=si>{</span><span class=n>body</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>connection</span> <span class=o>=</span> <span class=n>pika</span><span class=o>.</span><span class=n>BlockingConnection</span><span class=p>(</span><span class=n>pika</span><span class=o>.</span><span class=n>ConnectionParameters</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>channel</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>channel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 exchange 선언</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>exchange_declare</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;events&#39;</span><span class=p>,</span> <span class=n>exchange_type</span><span class=o>=</span><span class=s1>&#39;fanout&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>channel</span><span class=o>.</span><span class=n>queue_declare</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>exclusive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>queue_name</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>method</span><span class=o>.</span><span class=n>queue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 구독</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>queue_bind</span><span class=p>(</span><span class=n>exchange</span><span class=o>=</span><span class=s1>&#39;events&#39;</span><span class=p>,</span> <span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>basic_consume</span><span class=p>(</span><span class=n>queue</span><span class=o>=</span><span class=n>queue_name</span><span class=p>,</span> <span class=n>on_message_callback</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span> <span class=n>auto_ack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Waiting for events…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>channel</span><span class=o>.</span><span class=n>start_consuming</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=사례-4-사용자-알림-시스템-kafka-topic-기반>사례 4: 사용자 알림 시스템 (Kafka Topic 기반)<a hidden class=anchor aria-hidden=true href=#사례-4-사용자-알림-시스템-kafka-topic-기반>#</a></h4><p>앱에서 사용자 이벤트가 발생했을 때, 여러 컴포넌트가 이를 실시간으로 반응해야 하는 구조 구성</p><p><strong>시스템 구성</strong>:</p><ul><li><strong>Producer</strong>: 사용자 앱에서 행동 발생 시 이벤트 발행</li><li><strong>Topic</strong>: Kafka Topic–<code>user-events</code></li><li><strong>Consumers</strong>:<ul><li>Notification Service (푸시알림)</li><li>Logging Service (감사 기록)</li><li>Analytics Engine (실시간 통계)</li></ul></li></ul><pre class=mermaid>flowchart TD
  App[Mobile App] --&gt; KafkaTopic[&#34;Kafka Topic: user-events&#34;]
  KafkaTopic --&gt; NotiService[Notification Service]
  KafkaTopic --&gt; LogService[Logging Service]
  KafkaTopic --&gt; AnalyticsEngine[Analytics Engine]
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 앱에서 특정 행동을 수행함</li><li>이벤트가 Kafka Topic 에 발행됨</li><li>각각의 서비스가 독립적으로 해당 이벤트를 수신하고 자체 처리 수행</li></ol><p><strong>Kafka Topic 유무에 따른 차이</strong>:</p><table><thead><tr><th>구분</th><th>존재할 경우</th><th>존재하지 않을 경우</th></tr></thead><tbody><tr><td>메시지 처리 구조</td><td>느슨한 결합, 병렬 분기</td><td>강결합, 동기 호출 중심</td></tr><tr><td>확장성</td><td>독립적 확장 용이</td><td>하나의 호출 체인에 의존</td></tr><tr><td>유지보수</td><td>각 서비스 단위 테스트 용이</td><td>전체 시스템 수정 필요</td></tr></tbody></table><h3 id=주목할-내용>주목할 내용<a hidden class=anchor aria-hidden=true href=#주목할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>관련 기술 / 시스템</th></tr></thead><tbody><tr><td><strong>전달 방식</strong></td><td><strong>Push vs Pull</strong></td><td>Queue 는 Pull 기반 소비, Topic 은 Push 또는 Hybrid 방식 가능.</td><td>Kafka (Pull), SNS (Push), MQTT</td></tr><tr><td><strong>확장성 설계</strong></td><td><strong>Partitioning</strong></td><td>메시지를 물리적으로 분할하여 트래픽을 분산하고 병렬 처리를 통해 성능을 향상시킴.</td><td>Kafka Partition, SQS Shard</td></tr><tr><td></td><td><strong>Consumer Scaling</strong></td><td>Consumer Group 을 통한 병렬 소비 확장. Partition 수와 균형 있게 설계되어야 함.</td><td>Kafka Consumer Group, Celery Workers</td></tr><tr><td><strong>신뢰성/무결성</strong></td><td><strong>Acknowledgment (Ack)</strong></td><td>메시지 수신 확인을 통해 손실 방지 및 재전송 제어.</td><td>Kafka Offset Commit, RabbitMQ Ack</td></tr><tr><td></td><td><strong>Dead Letter Queue</strong></td><td>처리 실패 메시지를 보관하여 재처리 가능하도록 함. 장애 분석 및 경고 트리거로도 활용 가능.</td><td>Kafka DLQ, RabbitMQ DLX</td></tr><tr><td></td><td><strong>Idempotency</strong></td><td>중복된 메시지라도 같은 결과를 보장하는 소비자 처리 로직 설계. 중복 이벤트 발생 시 데이터 무결성 유지.</td><td>Webhook, Event Consumer</td></tr><tr><td><strong>처리 전략</strong></td><td><strong>Offset & Replay</strong></td><td>메시지의 소비 위치를 관리하여 리플레이, 복기, 재처리 등 고급 처리 전략을 구현 가능.</td><td>Kafka Offset, Pulsar Cursor</td></tr><tr><td></td><td><strong>TTL (Time-To-Live)</strong></td><td>메시지의 생명 주기를 제한하여 오랫동안 소비되지 않는 메시지를 자동으로 정리.</td><td>SQS Message TTL, Kafka Retention</td></tr><tr><td><strong>라우팅/필터링</strong></td><td><strong>Message Routing</strong></td><td>Topic/Exchange 기반의 메시지 라우팅 설계. Routing Key 와 Binding Rule 로 목적지 결정.</td><td>RabbitMQ Exchange, SNS Topic Filter</td></tr><tr><td></td><td><strong>Attribute Filtering</strong></td><td>메시지 속성 기반으로 구독자가 원하는 조건만 필터링 수신.</td><td>SNS Filter Policy, JMS Selectors</td></tr><tr><td><strong>패턴/조합</strong></td><td><strong>CQRS + Pub/Sub</strong></td><td>CQRS(Command/Query 분리) 구조와 Topic 기반 메시징 결합으로 읽기/쓰기 모델 최적화.</td><td>Event Sourcing with Kafka</td></tr><tr><td><strong>성능 최적화</strong></td><td><strong>Batch & Compression</strong></td><td>메시지 묶음 전송과 압축 적용으로 Throughput 향상 및 전송 비용 절감.</td><td>Kafka Batch Size, GZIP Compression</td></tr><tr><td><strong>전송 품질 보장</strong></td><td><strong>QoS Level</strong></td><td>메시지 전송 품질 설정: At Most Once / At Least Once / Exactly Once</td><td>MQTT QoS, Kafka Delivery Semantics</td></tr><tr><td><strong>장애 회복</strong></td><td><strong>Backpressure Handling</strong></td><td>소비자가 처리 속도를 초과할 경우, 흐름 제어 및 재시도/대기 메커니즘으로 안정화 필요.</td><td>Reactive Streams, Kafka Lag Monitor</td></tr></tbody></table><ul><li><strong>Queue 중심</strong> 시스템은 <strong>작업 처리 (Task Queue)</strong> 용도에 최적이며, <strong>Pull 기반, 1:1 처리</strong>, <strong>Ack/DLQ 중심의 신뢰성 보장</strong> 구조.</li><li><strong>Topic 중심</strong> 시스템은 <strong>이벤트 브로드캐스트</strong> 및 <strong>다수 소비자 처리</strong>에 유리하며, <strong>Push 기반 + 필터링 + 확장성 중심 설계</strong>가 필요.</li><li>Kafka 와 RabbitMQ 는 각각의 특징을 극대화하며, 다양한 **복합 아키텍처 (CQRS, Event Sourcing, Retry Workflow)**에서 병행 사용됨.</li><li>실제 아키텍처 설계 시 <strong>성능, 확장성, 무결성, 복원력, 필터링</strong>, 그리고 <strong>QoS 정책</strong>까지 종합적으로 고려해야 함.</li></ul><h3 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>핵심 개념 / 항목</th><th>설명 및 실무 적용 포인트</th></tr></thead><tbody><tr><td><strong>메시징 모델</strong></td><td>Queue vs. Topic</td><td>P2P (1:1), Pub/Sub (1:N)</td><td>Queue 는 단일 소비자 처리에 적합, Topic 은 다수 구독자에게 브로드캐스트 용도</td></tr><tr><td><strong>메시징 프로토콜</strong></td><td>AMQP, MQTT</td><td>AMQP = 복잡한 라우팅, MQTT = 경량 통신</td><td>RabbitMQ → AMQP 기반 / IoT 및 저전력 → MQTT 사용 (예: 센서 데이터)</td></tr><tr><td><strong>메시지 보장</strong></td><td>QoS (At-Least-Once 등)</td><td>At-Most-Once / At-Least-Once / Exactly-Once</td><td>메시지 유실/중복 방지 및 시스템 신뢰성 확보. Kafka 는 At-least-once 기본, Exactly-once 지원 필요 시 구성 필요</td></tr><tr><td><strong>신뢰성/순서</strong></td><td>Ack, Offset, Delivery Semantics</td><td>Auto/Manual Ack, Kafka Offset</td><td>메시지 누락 방지, 재처리 가능성 확보. Ack 와 Offset 을 통해 중복 처리 방지 및 순서 보장</td></tr><tr><td><strong>확장성 설계</strong></td><td>Partitioning</td><td>Kafka, RabbitMQ 의 파티션 설계</td><td>병렬 소비 및 부하 분산을 위한 핵심 요소. 파티션 수 결정 → Throughput 결정됨</td></tr><tr><td><strong>에러 처리</strong></td><td>DLQ (Dead Letter Queue)</td><td>처리 실패 메시지 격리</td><td>재처리, 로깅, 경고를 위한 DLQ 구성 필수. Kafka, RabbitMQ, AWS SQS 모두 DLQ 전략 존재</td></tr><tr><td><strong>백프레셔</strong></td><td>Backpressure</td><td>Kafka <code>max.poll.records</code>, RabbitMQ <code>prefetch</code></td><td>소비자 처리 속도 제어 및 생산자 과부하 방지. 처리 병목 구간 진단 및 트래픽 제어</td></tr><tr><td><strong>데이터 포맷</strong></td><td>Avro, Protobuf, JSON</td><td>직렬화 포맷 선택</td><td>Avro/Protobuf → 이진 포맷, 속도/용량 우수. JSON → 디버깅 용이하나 느리고 크다</td></tr><tr><td><strong>멱등성</strong></td><td>Idempotency</td><td>메시지 재처리 안전성</td><td>같은 메시지 중복 수신 시 결과 일관성 보장. Redis, DB transaction key 활용 등으로 보장 가능</td></tr><tr><td><strong>아키텍처 설계</strong></td><td>Event-Driven Architecture</td><td>Loose Coupling, Scalability, Observability</td><td>서비스 간 직접 연결 지양. Kafka/NATS 등으로 비동기 이벤트 중심 아키텍처 설계 시 고려해야 할 요소</td></tr><tr><td><strong>클라우드 서비스</strong></td><td>AWS SQS/SNS, Azure, GCP PubSub</td><td>Serverless 메시징 서비스 비교</td><td>SQS(Queue), SNS(Topic), EventBridge(EDA 연동) → 비용, 확장성, TTL, DLQ, 멱등성 기능 비교 필요</td></tr><tr><td><strong>실시간 처리</strong></td><td>Kafka Streams, Flink</td><td>메시징 + 실시간 데이터 흐름 통합</td><td>Kafka Streams → Kafka-native 스트림 처리. Flink → 고급 상태 관리, CEP 등 포함 실시간 분석</td></tr><tr><td><strong>DevOps 연계</strong></td><td>Kubernetes + Kafka / KEDA</td><td>메시지 기반 오토스케일링</td><td>메시지 수 (큐 길이) 기반 Horizontal Pod Autoscaler 구현. KEDA + Kafka/RabbitMQ 연동 가능</td></tr><tr><td><strong>보안</strong></td><td>인증, 암호화, 접근제어</td><td>메시지 암호화, IAM 인증</td><td>TLS 전송 암호화, JWT 또는 IAM 기반 접근 제어. Kafka 는 ACL 구성, SQS 는 IAM 정책 설정 필수</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th><th>관련 기술/모델</th></tr></thead><tbody><tr><td><strong>전달 방식</strong></td><td><strong>Queue (큐)</strong></td><td>Point-to-Point 기반 구조. 단일 소비자에게 메시지를 순서대로 (FIFO) 전달.</td><td>RabbitMQ, SQS, Celery</td></tr><tr><td></td><td><strong>Topic (토픽)</strong></td><td>Publish-Subscribe 기반 구조. 다수 소비자가 같은 메시지를 수신.</td><td>Kafka, Pub/Sub, SNS</td></tr><tr><td></td><td><strong>Exchange</strong></td><td>메시지를 큐 또는 토픽으로 라우팅하는 라우터 역할. RabbitMQ 의 핵심 컴포넌트.</td><td>RabbitMQ (Direct/Fanout/Topic/Header)</td></tr><tr><td></td><td><strong>Virtual Topic</strong></td><td>큐와 토픽을 조합한 패턴. Pub/Sub 구조 위에 큐 기반 소비자를 추가하여 병렬성 제공.</td><td>ActiveMQ</td></tr><tr><td><strong>처리 전략</strong></td><td><strong>FIFO</strong></td><td>First-In-First-Out. 메시지를 받은 순서대로 소비자에게 전달.</td><td>대부분의 큐 시스템에서 기본값</td></tr><tr><td></td><td><strong>Round-Robin</strong></td><td>여러 소비자에게 순환 방식으로 메시지를 분배.</td><td>RabbitMQ Consumer Load Balancing</td></tr><tr><td></td><td><strong>Fan-out</strong></td><td>메시지를 여러 수신자에게 복제하여 전달하는 방식.</td><td>SNS → SQS, Kafka</td></tr><tr><td></td><td><strong>Partition (파티션)</strong></td><td>하나의 토픽 또는 큐를 병렬 처리 가능한 단위로 나눈 구조.</td><td>Kafka Partition</td></tr><tr><td></td><td><strong>Consumer Group</strong></td><td>동일 토픽을 병렬로 처리하기 위한 소비자 집합 단위. 각 파티션은 하나의 그룹 내 소비자에게만 전달됨.</td><td>Kafka</td></tr><tr><td><strong>신뢰성 보장</strong></td><td><strong>Acknowledgment (Ack)</strong></td><td>메시지 수신/처리 완료를 브로커에 알림으로써 메시지 삭제 또는 재전송 제어.</td><td>Kafka, RabbitMQ</td></tr><tr><td></td><td><strong>Idempotency</strong></td><td>동일 메시지에 대한 중복 처리 방지. 재처리 시 결과가 동일하도록 설계.</td><td>Kafka Consumer, Webhook 처리 등</td></tr><tr><td></td><td><strong>Durable Subscription</strong></td><td>구독자가 오프라인이어도 메시지를 보존하여 수신 가능하도록 하는 옵션.</td><td>JMS, MQTT</td></tr><tr><td><strong>에러 처리</strong></td><td><strong>DLQ (Dead Letter Queue)</strong></td><td>처리 실패 메시지를 별도로 저장하여 재처리하거나 로그 확인을 가능하게 하는 큐.</td><td>RabbitMQ, Kafka, SQS</td></tr><tr><td></td><td><strong>Backpressure</strong></td><td>소비자가 처리 가능한 속도보다 빠르게 데이터가 도착할 경우 이를 제어하는 메커니즘.</td><td>Reactive Streams, Kafka</td></tr><tr><td><strong>성능 메트릭</strong></td><td><strong>Throughput</strong></td><td>단위 시간당 처리 가능한 메시지 수.</td><td>Kafka: TPS, RabbitMQ: msg/sec</td></tr><tr><td></td><td><strong>Latency</strong></td><td>메시지 생성부터 소비까지 걸리는 시간.</td><td>전송 시간 + 처리 시간 포함</td></tr><tr><td><strong>QoS</strong></td><td><strong>QoS Level</strong></td><td>메시지 전달 보장 수준: At-most-once / At-least-once / Exactly-once</td><td>MQTT, Kafka</td></tr><tr><td><strong>중개자 구성</strong></td><td><strong>Broker (브로커)</strong></td><td>메시지를 생산자에서 소비자에게 중계하는 핵심 구성 요소.</td><td>Kafka, RabbitMQ, Pulsar</td></tr><tr><td></td><td><strong>Offset</strong></td><td>소비자의 메시지 읽기 위치를 나타내는 지표. 재처리 또는 순서 보장에 활용.</td><td>Kafka, Pulsar</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://medium.com/version-1/queues-vs-topics-understanding-the-differences-in-messaging-frameworks-88861e2effa8>Queues vs Topics: Understanding the Differences in Messaging Frameworks | Medium</a></li><li><a href=https://stackoverflow.com/questions/5576415/jms-topic-vs-queues>JMS Topic vs Queues - Stack Overflow</a></li><li><a href=https://activemq.apache.org/components/classic/documentation/how-does-a-queue-compare-to-a-topic>How does a Queue compare to a Topic - ActiveMQ</a></li><li><a href=https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-queues-topics-subscriptions>Azure Service Bus messaging - queues, topics, and subscriptions | Microsoft Learn</a></li><li><a href=https://www.upsolver.com/blog/apache-kafka-architecture-what-you-need-to-know>Apache Kafka Architecture: What You Need to Know | Upsolver</a></li><li><a href=https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-best-practices.html>Amazon SQS best practices - AWS</a></li><li><a href=https://dzone.com/refcardz/apache-kafka-patterns-and-anti-patterns>Apache Kafka Patterns and Anti-Patterns - DZone</a></li><li><a href=https://www.geeksforgeeks.org/message-queues-system-design/>Message Queues - System Design - GeeksforGeeks</a></li><li><a href=https://www.baeldung.com/pub-sub-vs-message-queues>Pub-Sub vs. Message Queues | Baeldung</a></li><li><a href=https://dev.to/geampiere/queues-vs-topics-3e67>DEV Community: Queues vs Topics</a></li><li><a href=https://docs.solace.com/Get-Started/topic-endpoints-queues.htm>Solace Docs: Topic Endpoints and Queues</a></li><li><a href=https://hevodata.com/learn/kafka-queue/>Hevo Data: Kafka Queue vs. Topic</a></li><li><a href=https://systemdesignschool.io/blog/message-queue-vs-pub-sub>System Design School: Message Queue vs Pub-Sub</a></li><li><a href=https://www.infoq.com/articles/choosing-message-broker/>InfoQ: Choosing the Right Message Broker</a></li><li><a href=https://apix-drive.com/en/blog/other/tibco-queue-vs-topic>Tibco Queue vs Topic 비교</a></li><li><a href=https://stackoverflow.com/questions/32220312/rabbitmq-amqp-best-practice-queue-topic-design-in-a-microservice-architecture>RabbitMQ AMQP Best Practice in Microservice Architecture</a></li><li><a href=https://kafka.apache.org/documentation/>Apache Kafka 공식 문서</a></li><li><a href=https://www.rabbitmq.com/tutorials/amqp-concepts.html>RabbitMQ 공식 문서: Exchanges and Queues</a></li><li><a href=https://aws.amazon.com/sns/faqs/>AWS SNS vs SQS 공식 문서</a></li><li><a href=https://cloud.google.com/pubsub/docs/overview>Google Pub/Sub 공식 문서</a></li><li><a href=https://learn.microsoft.com/ko-kr/azure/service-bus-messaging/message-queues-vs-topics-queues>Microsoft Azure: Message Queues vs Topics vs Subscriptions (ko)</a></li><li><a href=https://martinfowler.com/eaaDev/EventSourcing.html>Martin Fowler: Event Sourcing</a></li></ul><hr></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/systems-and-infrastructure/>Systems-and-Infrastructure</a></li><li><a href=https://buenhyden.github.io/tags/infrastructure/>Infrastructure</a></li><li><a href=https://buenhyden.github.io/tags/infrastructure-components/>Infrastructure-Components</a></li><li><a href=https://buenhyden.github.io/tags/messaging-systems/>Messaging-Systems</a></li><li><a href=https://buenhyden.github.io/tags/event-brokers-vs-message-brokers/>Event-Brokers-vs-Message-Brokers</a></li><li><a href=https://buenhyden.github.io/tags/queue-vs-topic/>Queue-vs-Topic</a></li><li><a href=https://buenhyden.github.io/tags/queue/>Queue</a></li><li><a href=https://buenhyden.github.io/tags/topic/>Topic</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/system-design/quality-attribute/quality-attributes/run-time-reliability-and-efficiency/availability/availability-in-numbers/><span class=title>« Prev</span><br><span>Availability in Numbers</span>
</a><a class=next href=https://buenhyden.github.io/posts/software-engineering/design-and-architecture/architecture-styles-and-patterns/architecture-patterns/integration-patterns/api-integration/event-driven-apis-vs-pub-and-sub-apis/><span class=title>Next »</span><br><span>Event-driven APIs vs. Pub and Sub APIs</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>