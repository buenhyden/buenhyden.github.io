<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Asynchronous Execution | hyunyoun's Blog</title><meta name=keywords content="System-Design,System-Design-Fundamentals,Execution-Models,Timing-Models,Asynchronous-Execution,Non-Blocking"><meta name=description content="비동기 실행은 작업 완료를 기다리지 않고 다른 작업을 병행 처리하는 모델로, I/O 지연을 줄이고 자원을 효율적으로 활용해 응답성을 높인다. 이벤트 루프 기반의 태스크 스케줄링으로 구현되며, 콜백·프로미스·async/await 등이 사용된다. I/O-bound에 유리하지만 복잡성과 디버깅 난이도가 단점이다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/system-design/system-design-fundamentals/execution-models/timing-models/asynchronous-execution/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/system-design/system-design-fundamentals/execution-models/timing-models/asynchronous-execution/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/system-design/system-design-fundamentals/execution-models/timing-models/asynchronous-execution/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/system-design/system-design-fundamentals/execution-models/timing-models/asynchronous-execution/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Asynchronous Execution"><meta property="og:description" content="비동기 실행은 작업 완료를 기다리지 않고 다른 작업을 병행 처리하는 모델로, I/O 지연을 줄이고 자원을 효율적으로 활용해 응답성을 높인다. 이벤트 루프 기반의 태스크 스케줄링으로 구현되며, 콜백·프로미스·async/await 등이 사용된다. I/O-bound에 유리하지만 복잡성과 디버깅 난이도가 단점이다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Asynchronous Execution"><meta name=twitter:description content="비동기 실행은 작업 완료를 기다리지 않고 다른 작업을 병행 처리하는 모델로, I/O 지연을 줄이고 자원을 효율적으로 활용해 응답성을 높인다. 이벤트 루프 기반의 태스크 스케줄링으로 구현되며, 콜백·프로미스·async/await 등이 사용된다. I/O-bound에 유리하지만 복잡성과 디버깅 난이도가 단점이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Asynchronous Execution","item":"https://buenhyden.github.io/posts/system-design/system-design-fundamentals/execution-models/timing-models/asynchronous-execution/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>Asynchronous Execution</h1><div class=post-description>비동기 실행은 작업 완료를 기다리지 않고 다른 작업을 병행 처리하는 모델로, I/O 지연을 줄이고 자원을 효율적으로 활용해 응답성을 높인다. 이벤트 루프 기반의 태스크 스케줄링으로 구현되며, 콜백·프로미스·async/await 등이 사용된다. I/O-bound에 유리하지만 복잡성과 디버깅 난이도가 단점이다.</div></header><div class=post-content><h2 id=asynchronous-execution>Asynchronous Execution<a hidden class=anchor aria-hidden=true href=#asynchronous-execution>#</a></h2><p>비동기 실행은 요청한 작업이 완료되기를 기다리지 않고 여러 작업을 병행 처리하는 실행 모델로, CPU·I/O 자원을 효율적으로 활용해 응답성과 처리량을 높인다.</p><p>네트워크 호출, 파일 입출력, UI 이벤트 처리 등 지연이 발생하는 작업에서 효과적이며, 콜백, 프로미스, async/await, 코루틴, 이벤트 루프, 메시지 큐 등 다양한 방식으로 구현된다.</p><p>JavaScript(Event Loop), Python(asyncio), Java(CompletableFuture), Go(goroutine), Kotlin(coroutine) 등 언어별 지원이 광범위하다.</p><p>구성 요소는 이벤트 루프, 워커 풀, completion handler 등이 있으며, 반응형 시스템, 마이크로서비스, 분산 아키텍처에서 성능과 확장성을 극대화한다. 단, 동시성 제어 복잡성과 오류 처리 난이도가 수반된다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><table><thead><tr><th>관점</th><th>개념</th><th>설명</th></tr></thead><tbody><tr><td><strong>이론</strong></td><td>동시성 vs 병렬성</td><td>개념 구분, 자원 활용 방식</td></tr><tr><td></td><td>논블로킹 I/O</td><td>호출 즉시 반환, 자원 효율성</td></tr><tr><td></td><td>이벤트 루프</td><td>단일 스레드 비동기 처리 핵심</td></tr><tr><td></td><td>Reactor/Proactor</td><td>이벤트 처리 설계 패턴</td></tr><tr><td><strong>실무</strong></td><td>비동기 프로그래밍 패턴</td><td>async/await, Promise, Callback</td></tr><tr><td></td><td>메시지 큐</td><td>서비스 간 비동기 통신</td></tr><tr><td></td><td>Actor 모델</td><td>상태 격리 및 메시지 패싱</td></tr><tr><td></td><td>백프레셔</td><td>과부하 제어</td></tr><tr><td></td><td>관측성</td><td>모니터링 및 디버깅</td></tr><tr><td></td><td>에러 핸들링</td><td>예외 전파, 복구 전략</td></tr><tr><td><strong>기본</strong></td><td>블로킹 vs 논블로킹</td><td>실행 흐름 차이</td></tr><tr><td></td><td>동기 vs 비동기</td><td>처리 시점 차이</td></tr><tr><td></td><td>스레드 풀</td><td>병렬 처리 관리</td></tr><tr><td></td><td>코루틴</td><td>중단·재개 가능한 함수</td></tr><tr><td></td><td>async/await</td><td>코루틴 기반 비동기 표현</td></tr><tr><td><strong>심화</strong></td><td>구조적 동시성</td><td>작업 수명 주기 관리</td></tr><tr><td></td><td>CSP</td><td>통신 기반 동시성 모델</td></tr><tr><td></td><td>분산 비동기 처리</td><td>클라우드·메시징 시스템 통합</td></tr><tr><td></td><td>고급 흐름 제어</td><td>Rate Limiting, Circuit Breaker</td></tr><tr><td></td><td>성능 최적화</td><td>Context Switch 감소, Lock 최소화</td></tr></tbody></table><h4 id=실무-구현-연관성>실무 구현 연관성<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성>#</a></h4><p>비동기 실행은 서버, 데이터 처리, UI/UX, IoT 등 거의 모든 현대 시스템의 성능·확장성·안정성에 영향을 미친다. 각 패턴과 개념은 상황별로 선택·조합되어야 하며, 관측성과 흐름 제어가 성공적인 운영의 핵심이다.</p><table><thead><tr><th>적용 영역</th><th>적용 방식</th><th>주요 이점</th></tr></thead><tbody><tr><td><strong>웹/API 서버</strong></td><td>이벤트 루프 기반 프레임워크 (Node.js, aiohttp)</td><td>높은 동시 처리량, 저메모리</td></tr><tr><td><strong>데이터 파이프라인</strong></td><td>큐 + 워커 (Kafka, Celery)</td><td>비동기 배치, 재처리 용이</td></tr><tr><td><strong>프런트엔드</strong></td><td>브라우저 이벤트 루프, Web Worker</td><td>UI 응답성 향상</td></tr><tr><td><strong>모바일/IoT</strong></td><td>네트워크 비동기 처리, 저전력 설계</td><td>지연 최소화, 배터리 절약</td></tr><tr><td><strong>분산 시스템</strong></td><td>메시지 브로커 + 비동기 RPC</td><td>서비스 디커플링, 장애 격리</td></tr><tr><td><strong>실시간 처리</strong></td><td>WebSocket, gRPC 스트리밍</td><td>낮은 지연, 연속 데이터 처리</td></tr><tr><td><strong>CPU-bound 작업</strong></td><td>스레드 풀, 병렬 처리</td><td>처리 속도 향상</td></tr></tbody></table><ul><li><strong>핵심 개념</strong>: 비동기 실행, 논블로킹 I/O, 동시성/병렬성, 이벤트 루프·패턴, 코루틴·async/await, 메시지 큐·Actor 모델, 백프레셔, 구조적 동시성, 관측성, 에러 핸들링, 분산 비동기 패턴.</li><li><strong>관점별 필수 요소</strong>: 이론 (개념·패턴), 실무 (프레임워크·운영), 기본 (구성 요소), 심화 (고급 모델·최적화).</li><li><strong>실무 적용</strong>: 서버 성능 확장, 데이터 처리 효율, UI 응답성, IoT 전력 효율, 분산 서비스 안정성, 실시간 처리 최적화.</li></ul><h3 id=기초-개념-foundation-understanding>기초 개념 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#기초-개념-foundation-understanding>#</a></h3><h4 id=개념-정의-및-본질적-이해>개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질적-이해>#</a></h4><p><strong>비동기 실행</strong>은 작업의 <strong>대기 (완료)</strong> 와 <strong>실행</strong>을 분리한다.<br><strong>완료를 기다리지 않고</strong> 다른 작업을 <strong>겹쳐 처리</strong>하는 <strong>논블로킹·이벤트 기반</strong> 모델이다.<br>이벤트 루프가 큐에서 완료 신호/잡을 꺼내 실행하며, JS/Node 는 단일 스레드에서도 커널 위임으로 논블로킹 I/O 를 달성한다.<br>Python <code>asyncio</code> 는 I/O-bound 에 적합하고 블로킹 코드는 스레드/프로세스로 오프로딩한다.<br>C# <code>async/await</code> 는 중단·재개 의미론으로 같은 본질을 제공한다. <strong>동시성</strong>을 제공하지만 <strong>병렬성</strong>과는 구별된다.</p><h5 id=동기-vs-비동기-비교>동기 vs. 비동기 비교<a hidden class=anchor aria-hidden=true href=#동기-vs-비동기-비교>#</a></h5><table><thead><tr><th>구분</th><th>동기 (Synchronous)</th><th>비동기 (Asynchronous)</th></tr></thead><tbody><tr><td><strong>실행 방식</strong></td><td>한 작업이 끝나야 다음 작업 시작</td><td>작업 완료를 기다리지 않고 다음 작업 진행</td></tr><tr><td><strong>흐름 제어</strong></td><td>블로킹 (Blocking)</td><td>논블로킹 (Non-blocking)</td></tr><tr><td><strong>응답성</strong></td><td>작업 대기 중 응답 불가</td><td>대기 중에도 다른 작업 처리 가능</td></tr><tr><td><strong>효율성</strong></td><td>I/O 대기 시 자원 낭비</td><td>I/O 대기 시간에 다른 작업 수행 가능</td></tr><tr><td><strong>적합한 작업</strong></td><td>CPU-bound 처리</td><td>I/O-bound 처리</td></tr><tr><td><strong>구현 난이도</strong></td><td>상대적으로 단순</td><td>상대적으로 복잡 (콜백, 상태 관리 필요)</td></tr><tr><td><strong>예시 상황</strong></td><td>파일 압축 후 전송</td><td>파일 전송 중 UI 업데이트</td></tr><tr><td><strong>대표 활용</strong></td><td>단일 스레드 계산 작업</td><td>네트워크 요청, DB 쿼리, 파일 읽기</td></tr></tbody></table><p><strong>동기 vs 비동기 비교</strong>:</p><pre class=mermaid>graph TD
    subgraph &#34;동기 실행 (Synchronous)&#34;
        A1[작업 1 시작] --&gt; A2[작업 1 완료 대기]
        A2 --&gt; A3[작업 2 시작]
        A3 --&gt; A4[작업 2 완료 대기]
        A4 --&gt; A5[작업 3 시작]
    end
    
    subgraph &#34;비동기 실행 (Asynchronous)&#34;
        B1[작업 1 시작] --&gt; B2[작업 2 시작]
        B2 --&gt; B3[작업 3 시작]
        B1 --&gt; B4[작업 1 완료 처리]
        B2 --&gt; B5[작업 2 완료 처리]
        B3 --&gt; B6[작업 3 완료 처리]
    end
</pre><h5 id=비동기-실행-vs-병렬-처리의-차이>비동기 실행 vs. 병렬 처리의 차이<a hidden class=anchor aria-hidden=true href=#비동기-실행-vs-병렬-처리의-차이>#</a></h5><table><thead><tr><th>구분</th><th>비동기 실행 (Asynchronous Execution)</th><th>병렬 처리 (Parallel Processing)</th></tr></thead><tbody><tr><td>초점</td><td>대기 없는 실행 (Non-blocking)</td><td>동시에 여러 CPU 에서 실행</td></tr><tr><td>자원 활용</td><td>단일 쓰레드 + 비동기 이벤트 관리</td><td>CPU 코어 병렬 활용</td></tr><tr><td>주요 대상</td><td>I/O 작업, 네트워크 통신</td><td>CPU-intensive 연산</td></tr><tr><td>예시</td><td>Node.js, Python asyncio</td><td>Python multiprocessing, CUDA</td></tr></tbody></table><h5 id=언어별-이벤트-루프--스케줄링-차이>언어별 이벤트 루프 & 스케줄링 차이<a hidden class=anchor aria-hidden=true href=#언어별-이벤트-루프--스케줄링-차이>#</a></h5><table><thead><tr><th>언어 / 환경</th><th>이벤트 루프 구조</th><th>태스크 큐/스케줄링 방식</th><th>특징</th></tr></thead><tbody><tr><td><strong>JavaScript / Node.js</strong></td><td>단일 스레드 이벤트 루프</td><td><strong>태스크 큐</strong>(macro/micro task) 로 구분. microtask(프로미스) 우선 실행 후 macrotask(타이머 등) 실행</td><td>런투컴플리션 (run-to-completion) 모델. 브라우저와 Node.js 의 큐 동작 세부 차이 있음</td></tr><tr><td><strong>Python / asyncio</strong></td><td>단일 스레드 이벤트 루프</td><td><code>asyncio</code> 의 이벤트 루프가 코루틴을 스케줄. <code>await</code> 시 제어권 반환 후 다른 태스크 실행</td><td>I/O-bound 최적화. 블로킹 호출은 <code>run_in_executor</code> 로 별도 스레드/프로세스에서 실행</td></tr><tr><td><strong>C# /.NET async/await</strong></td><td>런타임 스케줄러 (TaskScheduler) 기반</td><td><code>await</code> 시 호출자를 일시 중단하고 완료 후 원래 컨텍스트에서 재개</td><td>스레드풀 기반. CPU-bound/I/O-bound 모두 지원. <code>ConfigureAwait(false)</code> 로 컨텍스트 전환 제어 가능</td></tr><tr><td><strong>Go</strong></td><td>런타임 스케줄러 (M:N)</td><td>고루틴을 여러 OS 스레드에 매핑</td><td>이벤트 루프 대신 스케줄러가 코루틴 (고루틴) 관리. 동기·비동기 경계가 언어 수준에서 추상화</td></tr><tr><td><strong>Rust (Tokio, async-std)</strong></td><td>실행기 (Executor) 기반</td><td>Future 폴링 기반. 태스크가 준비될 때까지 실행기에서 대기</td><td>Zero-cost abstraction 지향. 멀티스레드 런타임 선택 가능</td></tr></tbody></table><pre class=mermaid>flowchart TB
    JS[&#34;JS/Node: 단일 스레드 + Event Loop + Micro/Macro Task&#34;] --&gt; IO[&#34;OS/libuv에 I/O 위임&#34;]
    PY[&#34;Python/asyncio: 코루틴 + Event Loop + Selector&#34;] --&gt; EXE[&#34;블로킹은 Executor로 오프로딩&#34;]
    CS[&#34;C#/.NET: Task + await + ThreadPool + SyncContext&#34;] --&gt; IOCP2[&#34;IOCP와 컨텍스트 재개&#34;]
    GO[&#34;Go: 고루틴 + G-M-P 스케줄러 + netpoller&#34;] --&gt; MNP2[&#34;블로킹 감지/전환&#34;]
    RS[&#34;Rust/Tokio: Future + Executor + Reactor + Waker&#34;] --&gt; READY[&#34;이벤트→Waker→Ready Queue&#34;]
</pre><h6 id=javascript--nodejs>JavaScript / Node.js<a hidden class=anchor aria-hidden=true href=#javascript--nodejs>#</a></h6><p><strong>동작 원리</strong></p><ul><li>단일 스레드 이벤트 루프 기반.</li><li>I/O 작업은 OS/Libuv 에 위임 후, 완료 시 콜백 큐에 태스크 등록.</li><li><strong>Run-to-completion</strong>: 한 태스크가 끝날 때까지 중단 없이 실행.</li></ul><p><strong>큐 구조</strong></p><ul><li><strong>Macrotask Queue</strong>: setTimeout, setInterval, I/O 콜백 등.</li><li><strong>Microtask Queue</strong>: Promise <code>.then</code>, <code>queueMicrotask</code> 등.</li><li>이벤트 루프 한 번 돌 때 <strong>Microtask 먼저</strong>, 그 다음 Macrotask 실행.</li></ul><p><strong>OS 레벨 호출 흐름</strong></p><ol><li>JS 코드 실행 → I/O 요청 발생 → Libuv 가 OS 비동기 API 호출</li><li>OS 가 완료 이벤트 발생 → Libuv 이벤트 큐에 콜백 등록</li><li>이벤트 루프가 큐에서 꺼내 실행</li></ol><p><strong>장점</strong>: 단일 스레드로 동시성 처리, 오버헤드 적음<br><strong>단점</strong>: CPU-bound 작업 시 메인 루프 블로킹 위험</p><pre class=mermaid>flowchart LR
    subgraph JS[&#34;JavaScript 런타임(단일 스레드)&#34;]
        CS[Call Stack]
        EL[Event Loop]
        MTQ[&#34;Microtask Queue&lt;br/&gt;(Promise.then, queueMicrotask)&#34;]
        MAQ[&#34;Macrotask Queue&lt;br/&gt;(setTimeout, I/O callbacks)&#34;]
    end

    subgraph Host[&#34;Host APIs / libuv&#34;]
        UV[libuv]
        OS[(OS 비동기 I/O)]
    end

    CS --&gt;|I/O 호출| UV --&gt; OS
    OS --&gt;|완료 이벤트| UV --&gt; MAQ
    CS --&gt;|Promise resolve| MTQ
    EL --&gt;|MTQ 우선 소진| MTQ --&gt; CS
    EL --&gt;|그 다음| MAQ --&gt; CS
    CS --&gt; EL
</pre><h6 id=python--asyncio>Python / Asyncio<a hidden class=anchor aria-hidden=true href=#python--asyncio>#</a></h6><p><strong>동작 원리</strong></p><ul><li>단일 스레드, 협력적 코루틴 스케줄링.</li><li><code>await</code> 로 제어권을 이벤트 루프에 반환, 다른 태스크로 전환.</li><li>I/O 대기는 OS 비동기 호출 (epoll/kqueue 등) 에 위임.</li></ul><p><strong>큐 구조</strong></p><ul><li>Ready Queue: 실행 대기 코루틴</li><li>Future/Task 객체: 완료 시 콜백 호출</li></ul><p><strong>OS 레벨 호출 흐름</strong></p><ol><li>코루틴에서 I/O 요청 → asyncio 가 OS 이벤트 감시 (epoll 등) 등록</li><li>이벤트 발생 시 Ready Queue 에 태스크 추가</li><li>이벤트 루프가 태스크 실행</li></ol><p><strong>장점</strong>: 간결한 async/await 문법, I/O-bound 성능 우수<br><strong>단점</strong>: CPU-bound 작업 처리 시 별도 스레드/프로세스 필요</p><pre class=mermaid>flowchart LR
    subgraph APP[&#34;Python App (async/await)&#34;]
        C1[Coroutine A]
        C2[Coroutine B]
        AW[await: 제어권 반환]
    end

    subgraph LOOP[&#34;asyncio Event Loop&#34;]
        RQ[Ready Queue]
        FUT[Future/Task]
        SEL[&#34;Selector&lt;br/&gt;(epoll/kqueue/IOCP)&#34;]
        EXE[&#34;Executor&lt;br/&gt;(Thread/Process)&#34;]
    end

    subgraph OS[&#34;OS 비동기 I/O&#34;]
        K[(커널 이벤트)]
    end

    C1 --&gt;|await I/O| AW --&gt; LOOP
    C2 --&gt;|await I/O| AW
    LOOP --&gt; SEL --&gt; K
    K --&gt;|완료 신호| SEL --&gt; FUT --&gt; RQ --&gt; C1
    APP --&gt;|블로킹 함수| EXE --&gt; LOOP
</pre><h6 id=c-net-asyncawait>C# /.NET async/await<a hidden class=anchor aria-hidden=true href=#c-net-asyncawait>#</a></h6><p><strong>동작 원리</strong></p><ul><li>Task 기반 비동기. <code>await</code> 시 현재 메서드 중단 → 제어권 반환.</li><li>완료 시 <strong>원래 컨텍스트</strong>(UI 스레드 등) 로 복귀.</li></ul><p><strong>큐 구조</strong></p><ul><li>Task Scheduler 가 태스크를 스레드풀에 분배.</li><li>컨텍스트 전환 여부는 <code>ConfigureAwait</code> 로 제어.</li></ul><p><strong>OS 레벨 호출 흐름</strong></p><ol><li>비동기 API 호출 → OS 비동기 핸들 등록</li><li>완료 시 CLR 런타임이 콜백 실행</li></ol><p><strong>장점</strong>: CPU/I/O-bound 모두 효율적, 스레드풀 재사용<br><strong>단점</strong>: 잘못된 컨텍스트 전환은 성능 저하 유발</p><pre class=mermaid>flowchart LR
    subgraph APP[&#34;.NET App&#34;]
        M[async Method]
        AWAIT[await: 중단/재개 포인트]
        CONT[&#34;Continuation(후속작업)&#34;]
    end

    subgraph RUNTIME[&#34;.NET Runtime&#34;]
        TS[TaskScheduler]
        TP[ThreadPool]
        SC[&#34;SynchronizationContext(UI/ASP.NET)&#34;]
        IOCP[IO Completion Ports]
    end

    M --&gt; AWAIT --&gt; TS
    TS --&gt;|I/O 비동기 등록| IOCP
    IOCP --&gt;|완료| TS --&gt; TP --&gt; CONT
    CONT --&gt;|기본: 원 컨텍스트로| SC --&gt; APP
    CONT --&gt;|&#34;ConfigureAwait(false)&#34;| APP
</pre><h6 id=go>Go<a hidden class=anchor aria-hidden=true href=#go>#</a></h6><p><strong>동작 원리</strong></p><ul><li>M:N 스케줄러로 고루틴을 OS 스레드에 매핑.</li><li>런타임이 블로킹 호출 감지 시 다른 고루틴으로 스위칭.</li></ul><p><strong>큐 구조</strong></p><ul><li>각 P(Processor) 에 로컬 큐 존재, 필요 시 글로벌 큐에서 가져옴.</li></ul><p><strong>OS 레벨 호출 흐름</strong></p><ol><li>고루틴이 네트워크 호출 시 런타임 netpoller 사용</li><li>OS 비동기 이벤트 발생 시 대기 고루틴 재개</li></ol><p><strong>장점</strong>: 개발자가 동기식 코드처럼 작성 가능<br><strong>단점</strong>: 런타임 오버헤드 존재, 메모리 관리 주의 필요</p><pre class=mermaid>flowchart LR
    subgraph GO[&#34;Go Runtime&#34;]
        Gs[&#34;고루틴들(G)&#34;]
        Pq[&#34;로컬 런큐(각 P)&#34;]
        GQ[글로벌 런큐]
        MNP[Netpoller]
        SP[&#34;스케줄러(M:N)&#34;]
    end

    subgraph OS[&#34;OS Threads&#34;]
        M1[OS Thread M1]
        M2[OS Thread M2]
        NET[(OS 네트워크 이벤트)]
    end

    Gs --&gt; Pq
    Pq --&gt;|고루틴 스틸/밸런싱| GQ
    SP --&gt;|할당| M1
    SP --&gt;|할당| M2
    Gs --&gt;|네트워크 호출| MNP
    NET --&gt;|이벤트| MNP --&gt; Pq
    M1 --&gt; SP
    M2 --&gt; SP
</pre><h6 id=rust-tokio-예시>Rust (Tokio 예시)<a hidden class=anchor aria-hidden=true href=#rust-tokio-예시>#</a></h6><p><strong>동작 원리</strong></p><ul><li>Future 기반. <code>poll()</code> 메서드가 준비될 때까지 실행기에서 대기.</li><li>cooperative scheduling: 태스크가 명시적으로 yield 해야 함.</li></ul><p><strong>큐 구조</strong></p><ul><li>Ready Queue: 실행 가능한 Future</li><li>Reactor: OS 이벤트 감시 (epoll 등)</li></ul><p><strong>OS 레벨 호출 흐름</strong></p><ol><li>Future 가 I/O 요청 → Reactor 에 등록</li><li>OS 이벤트 발생 시 Ready Queue 로 이동</li><li>Executor 가 poll() 호출해 진행</li></ol><p><strong>장점</strong>: Zero-cost abstraction, 멀티스레드 실행기 가능<br><strong>단점</strong>: 수동적인 yield 필요, 러닝커브 높음</p><pre class=mermaid>flowchart LR
    subgraph APP[&#34;Rust async (Futures)&#34;]
        F1[Future A]
        F2[Future B]
        W[&#34;Waker(깨우기 콜백)&#34;]
    end

    subgraph TOKIO[&#34;Tokio Runtime&#34;]
        EX[&#34;Executor(스케줄러)&#34;]
        R[&#34;Reactor(epoll/kqueue/IOCP)&#34;]
        RQ[Ready Queue]
    end

    subgraph OS[&#34;OS 비동기 I/O&#34;]
        IO[(커널 이벤트)]
    end

    F1 --&gt;|poll| EX
    F2 --&gt;|poll| EX
    EX --&gt;|I/O 등록| R --&gt; IO
    IO --&gt;|완료| R --&gt; W --&gt; RQ --&gt; EX --&gt; F1
</pre><h4 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h4><h5 id=등장-배경>등장 배경<a hidden class=anchor aria-hidden=true href=#등장-배경>#</a></h5><p>대용량 네트워크·스토리지 접근에서 발생하는 I/O 대기와 스레드 블로킹은 CPU 유휴 시간과 낮은 처리량, UI/서버의 지연을 야기했다.<br>분산·클라우드 전환과 실시간 상호작용 수요가 커지면서, 이벤트 루프와 커널 이벤트 통지 (epoll/kqueue/IOCP) 위에서 작업을 분해·스케줄링하는 <strong>비동기 실행 모델</strong>이 표준 해법으로 부상했다.<br>언어는 콜백에서 Promise/Future 로, 다시 <strong>async/await·코루틴</strong>·<strong>구조적 동시성</strong>으로 진화해 가독성과 오류 처리·취소·관측 가능성을 강화했고, 커널은 <strong>io_uring</strong> 등 고성능 AIO 로 오버헤드를 낮췄다.</p><h5 id=발전-과정>발전 과정<a hidden class=anchor aria-hidden=true href=#발전-과정>#</a></h5><table><thead><tr><th>시기</th><th>기술/패턴</th><th>핵심 아이디어</th><th>대표 구현/근거</th></tr></thead><tbody><tr><td>1960s–70s</td><td>인터럽트, Actor, CSP</td><td>비동기 이벤트, 메시지·채널 기반 병행</td><td>Hewitt(1973), Hoare(1978)</td></tr><tr><td>1990s</td><td>브라우저 비동기</td><td>백그라운드 통신으로 UX 개선 기반</td><td>XHR→AJAX(2005)</td></tr><tr><td>2000–02</td><td>kqueue/epoll</td><td>스케일러블 이벤트 통지</td><td>FreeBSD 4.1, Linux 2.5.44/45</td></tr><tr><td>1990s–</td><td>IOCP</td><td>완료 통지 + 스레드 풀 모델</td><td>Win32 IOCP</td></tr><tr><td>2009</td><td>Node.js/libuv</td><td>단일 루프 + 워커풀 추상화</td><td>libuv 디자인</td></tr><tr><td>2014–17</td><td>언어 문법 정착</td><td>asyncio, JS async/await</td><td>PEP 3156/492, ES2017</td></tr><tr><td>2015</td><td>Reactive Streams</td><td>논블로킹 백프레셔 표준</td><td>RS 1.0.0</td></tr><tr><td>2018</td><td>Kotlin coroutines</td><td>구조적 동시성 보급</td><td>Kotlin 1.3</td></tr><tr><td>2019</td><td>io_uring</td><td>유저·커널 링 버퍼 AIO</td><td>Axboe 논문</td></tr><tr><td>2021–23</td><td>구조적 동시성</td><td>태스크 수명·에러의 스코프화</td><td>Swift 5.5, JEP 428/453</td></tr></tbody></table><pre class=mermaid>timeline
    title 비동기 실행 발전 타임라인
    1960s-70s : 인터럽트/Actor(1973)/CSP(1978)
    2000 : FreeBSD kqueue
    2002 : Linux epoll
    2005 : AJAX 용어 보급
    2009 : Node.js(+libuv)
    2014-15 : Python asyncio / async·await(PY)
    2015 : Reactive Streams 1.0.0
    2017 : JS ES2017 async/await
    2018 : Kotlin coroutines 안정화
    2019 : Linux io_uring
    2021-23 : 구조적 동시성(Swift 5.5, Java JEP 428/453)
</pre><h4 id=핵심-목적-및-필요성>핵심 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#핵심-목적-및-필요성>#</a></h4><table><thead><tr><th></th><th>카테고리</th><th>목적/가치</th><th>설명</th></tr></thead><tbody><tr><td>기술적</td><td><strong>성능</strong></td><td>성능 최적화</td><td>I/O 대기 시간 동안 다른 작업 수행, 처리량 증가</td></tr><tr><td></td><td><strong>응답성</strong></td><td>빠른 응답성</td><td>메인 흐름 블로킹 방지, UI 및 시스템 반응 속도 향상</td></tr><tr><td></td><td><strong>효율성</strong></td><td>자원 절약</td><td>스레드·메모리 사용 최적화, 병목 현상 최소화</td></tr><tr><td></td><td><strong>확장성</strong></td><td>확장성 강화</td><td>동일 자원으로 더 많은 동시 요청 처리 가능</td></tr><tr><td>비즈니스</td><td><strong>비용</strong></td><td>비용 효율</td><td>하드웨어·운영 비용 절감</td></tr><tr><td></td><td><strong>안정성</strong></td><td>탄력성 확보</td><td>장애나 지연 발생 시 전체 시스템 영향 최소화</td></tr><tr><td></td><td><strong>사용자 경험</strong></td><td>UX 향상</td><td>빠른 반응과 안정적인 서비스로 사용자 만족도 제고</td></tr></tbody></table><p><strong>비동기 실행</strong>이 단순한 기술 최적화 수단이 아니라,</p><ul><li><strong>성능·응답성</strong> 측면에서 처리량과 반응 속도를 끌어올리고,</li><li><strong>효율성·확장성·비용 절감</strong>을 통해 운영 효율을 높이며,</li><li><strong>안정성·사용자 경험</strong>까지 포함한 종합적인 가치 제안을 제공한다는 점을 보여준다.<br>즉, <strong>기술적·운영적·비즈니스적 측면</strong>을 동시에 강화하는 전략적 접근이라고 볼 수 있다.</li></ul><h4 id=주요-특징-및-차별점-기술적-근거>주요 특징 및 차별점 (기술적 근거)<a hidden class=anchor aria-hidden=true href=#주요-특징-및-차별점-기술적-근거>#</a></h4><p>비동기 실행은 <strong>논블로킹</strong>과 <strong>이벤트 기반 설계</strong>를 통해 I/O 대기 시간을 숨기고, 단일 또는 적은 스레드로도 <strong>고동시성</strong>을 달성하는 실행 모델이다.</p><p>OS 레벨의 비동기 I/O(epoll, kqueue, IOCP) 와 이벤트 루프/스케줄러를 활용해 컨텍스트 스위칭과 메모리 사용을 최소화한다.<br>백프레셔 메커니즘은 생산자 - 소비자 속도 불균형을 조절해 안정성을 보장한다.<br>반면, 상태 관리·흐름 제어 복잡성으로 인해 동기 모델 대비 개발·디버깅 난이도가 높다.</p><table><thead><tr><th>특징</th><th>설명</th><th>기술적 근거</th><th>차별점</th></tr></thead><tbody><tr><td><strong>논블로킹</strong></td><td>작업 완료 대기 없이 실행 지속</td><td>OS 비동기 I/O (epoll, kqueue, IOCP)</td><td>컨텍스트 스위칭·대기 시간 최소화, 처리량 향상</td></tr><tr><td><strong>동시성</strong></td><td>여러 작업이 겹쳐 진행</td><td>이벤트 루프·스케줄러가 태스크 전환</td><td>CPU 유휴 시간 감소, 응답성 향상</td></tr><tr><td><strong>이벤트 기반</strong></td><td>완료 시 이벤트/콜백 실행</td><td>옵저버 패턴, Reactor/Proactor 패턴</td><td>느슨한 결합, 확장성 용이</td></tr><tr><td><strong>자원 효율성</strong></td><td>적은 스레드로 다수 작업 처리</td><td>단일 스레드 + 큐 기반 스케줄링</td><td>멀티스레딩 대비 메모리·스레드 비용 절감</td></tr><tr><td><strong>백프레셔</strong></td><td>생산자 - 소비자 속도 차이 제어</td><td>버퍼링·플로우 컨트롤, Reactive Streams</td><td>과부하 방지, 시스템 안정성</td></tr><tr><td><strong>개발 난이도</strong></td><td>상태·흐름 제어 복잡성</td><td>비동기 콜백 체인, 디버깅 도구 한계</td><td>동기 대비 코드 가독성·유지보수성 저하</td></tr></tbody></table><ul><li><strong>성능 최적화</strong>: 논블로킹 + 동시성 → CPU·메모리 자원 효율, 처리량·응답성 향상.</li><li><strong>아키텍처적 특징</strong>: 이벤트 기반 설계, 느슨한 결합 구조 → 확장성과 유지보수성 향상.</li><li><strong>안정성 보장</strong>: 백프레셔로 처리 속도 균형 유지 → 과부하 방지.</li><li><strong>한계점</strong>: 코드 복잡도·디버깅 난이도 증가 → 설계·도구 선택 중요.</li></ul><h3 id=핵심-원리-core-theory>핵심 원리 (Core Theory)<a hidden class=anchor aria-hidden=true href=#핵심-원리-core-theory>#</a></h3><h4 id=핵심-설계-원칙-및-철학>핵심 설계 원칙 및 철학<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙-및-철학>#</a></h4><p>비동기 실행의 설계 원칙은 <strong>작업 시작과 완료의 분리</strong>를 통해 결합도를 줄이고, <strong>논블로킹</strong>과 <strong>이벤트 기반 설계</strong>로 시스템 전체의 응답성과 확장성을 극대화하는 데 있다.</p><p>작은 단위의 비동기 작업은 <strong>조합성</strong>을 갖춰 체이닝·파이프라인으로 복잡한 흐름을 구성하며, <strong>명시적 오류 전파</strong>를 통해 안정성을 유지한다.<br><strong>백프레셔</strong>는 처리 속도 차이를 조율해 자원 고갈을 방지하고, <strong>공정성</strong> 있는 스케줄링은 특정 작업이 시스템을 독점하지 않게 한다.</p><p>이러한 철학은 OS 레벨 비동기 I/O 와 런타임 스케줄러 전략에 기반하며, 언어·환경별 구현 차이를 갖는다.</p><table><thead><tr><th>원칙</th><th>설명</th><th>구현 방법</th><th>기술적 근거</th><th>이점</th></tr></thead><tbody><tr><td><strong>분리 (Separation)</strong></td><td>시작과 완료 시점 분리</td><td>콜백, Promise, Future, Observer</td><td>결합도 감소, SRP 준수</td><td>유지보수성 향상</td></tr><tr><td><strong>논블로킹</strong></td><td>작업 대기 없이 실행 지속</td><td>OS 비동기 I/O, 이벤트 루프</td><td>epoll/kqueue/IOCP 기반</td><td>응답성·처리량 증가</td></tr><tr><td><strong>이벤트 기반</strong></td><td>상태 변화 시 이벤트 전파</td><td>옵저버/퍼블리셔 - 서브스크라이버 패턴</td><td>느슨한 결합 구조</td><td>확장성·모듈성 향상</td></tr><tr><td><strong>조합성</strong></td><td>작은 단위 결합해 복잡한 흐름 구성</td><td>체이닝, 파이프라인, gather/WhenAll</td><td>함수형·모듈형 설계</td><td>재사용성·가독성 증가</td></tr><tr><td><strong>오류 전파</strong></td><td>비동기 예외 처리</td><td>try/await-catch, 에러 콜백</td><td>안정성 확보</td><td>장애 전파 최소화</td></tr><tr><td><strong>백프레셔</strong></td><td>속도 차이 제어</td><td>버퍼링, 스로틀링, Flow Control</td><td>Reactive Streams, Stream API</td><td>자원 고갈 방지</td></tr><tr><td><strong>공정성 (Fairness)</strong></td><td>태스크 독점 방지</td><td>라운드 로빈, 우선순위 큐, cooperative yield</td><td>스케줄러 정책</td><td>처리 균형 유지</td></tr></tbody></table><ul><li><strong>효율성</strong>: 분리·논블로킹 설계로 자원 활용 극대화, 처리량·응답성 향상.</li><li><strong>구조적 품질</strong>: 이벤트 기반·조합성으로 모듈성·확장성 강화.</li><li><strong>안정성</strong>: 오류 전파·백프레셔로 장애 확산과 과부하 방지.</li><li><strong>공정성</strong>: 스케줄러 정책으로 특정 태스크 독점 방지.</li></ul><h4 id=기본-원리-및-동작-메커니즘>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘>#</a></h4><h5 id=기본-원리>기본 원리<a hidden class=anchor aria-hidden=true href=#기본-원리>#</a></h5><p>비동기 실행은 <strong>Non-blocking I/O</strong>를 기반으로, 작업 시작과 완료를 분리하고 <strong>이벤트 기반 구조</strong>로 상태 변화를 전달한다.<br>작업은 큐에 저장돼 우선순위에 따라 처리되며, CPU 와 I/O 작업을 분리·병렬화한다. 또한 <strong>백프레셔</strong>로 자원 사용을 최적화하고, 오류·취소 처리를 통해 안정성과 유연성을 확보한다.</p><table><thead><tr><th>원리</th><th>설명</th><th>구현 예시</th></tr></thead><tbody><tr><td>Non-blocking I/O</td><td>작업 요청 후 대기 없이 다음 처리로 진행</td><td>epoll, kqueue, IOCP, io_uring</td></tr><tr><td>등록/완료 분리</td><td>작업 시작과 완료 시점을 분리해 흐름 유지</td><td>콜백, Promise, Future</td></tr><tr><td>이벤트 기반</td><td>상태 변화 시 이벤트로 알림</td><td>Observer, Pub/Sub</td></tr><tr><td>작업 큐 관리</td><td>태스크를 큐에 저장 후 순차/우선순위 처리</td><td>매크로·마이크로태스크 큐</td></tr><tr><td>병렬 처리</td><td>CPU 바운드·I/O 바운드 분리 처리</td><td>스레드 풀, 워크 스틸링</td></tr><tr><td>백프레셔</td><td>생산·소비 속도 균형 유지</td><td>버퍼링, 스로틀링</td></tr><tr><td>오류/취소 처리</td><td>예외 전파와 작업 중단 지원</td><td>try-catch, cancel API</td></tr></tbody></table><h5 id=동작-메커니즘>동작 메커니즘<a hidden class=anchor aria-hidden=true href=#동작-메커니즘>#</a></h5><p>애플리케이션은 비동기 작업을 런타임에 등록하고 즉시 반환된다. 런타임은 커널에 Non-blocking I/O 를 제출하고, 커널은 완료 시 이벤트로 통지한다. 런타임은 해당 태스크를 큐에 등록하고, 이벤트 루프가 콜백 호출 또는 await 재개를 통해 결과를 처리한다.</p><pre class=mermaid>sequenceDiagram
    participant Client as 클라이언트/애플리케이션 코드
    participant Runtime as 비동기 런타임(Event Loop + Scheduler)
    participant Kernel as 커널 I/O 서브시스템
    Client-&gt;&gt;Runtime: 비동기 작업 등록 (콜백/Promise/async)
    Runtime-&gt;&gt;Kernel: Non-blocking I/O 요청(epoll/kqueue/IOCP/io_uring)
    Kernel--&gt;&gt;Runtime: I/O 완료 이벤트 통지
    Runtime-&gt;&gt;Runtime: 작업 큐에 태스크 등록(우선순위 반영)
    Runtime-&gt;&gt;Client: 콜백 호출 또는 await 재개
</pre><h4 id=아키텍처-및-구성-요소>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소>#</a></h4><pre class=mermaid>flowchart TB
  %% 라벨 줄바꿈은 &lt;br/&gt; 사용, 점선+라벨은 -.-&gt;|label| 형식으로

  subgraph AppLayer[&#34;App Layer&#34;]
    A[&#34;Application Code&lt;br/&gt;(Coroutine/Promise/Future)&#34;]
    CB[&#34;Circuit Breaker / Timeout / Retry&#34;]
    OBS[&#34;Observability Hooks&lt;br/&gt;(Trace/Metric/Log)&#34;]
  end

  subgraph AsyncRuntime[&#34;Async Runtime&#34;]
    EL[&#34;Event Loop&#34;]
    QM[&#34;Microtask Queue&#34;]
    QT[&#34;Task/Timer/IO Queue&#34;]
    SCH[&#34;Scheduler Policies&lt;br/&gt;(QoS/Dedicated Pool)&#34;]
    TP[&#34;Thread Pool&lt;br/&gt;(CPU-bound/Blocking)&#34;]
    BP[&#34;Backpressure Controller&lt;br/&gt;(credits/window)&#34;]
  end

  subgraph OSIO[&#34;OS / IO&#34;]
    DEMUX[&#34;OS Demultiplexer&lt;br/&gt;(epoll/kqueue/IOCP)&#34;]
    NET[&#34;Network / Filesystem&#34;]
  end

  subgraph Integration[&#34;Integration&#34;]
    MQ[&#34;Message Queue&lt;br/&gt;(Kafka/RabbitMQ)&#34;]
  end

  %% 연결
  A --&gt;|await/then/submit| EL
  EL --&gt; QM
  EL --&gt; QT
  EL --&gt;|offload| TP
  DEMUX --&gt;|I/O ready or completion| EL
  EL --&gt;|dispatch| A
  A --&gt;|emit| MQ
  BP -.-&gt;|flow control| A
  CB -.-&gt;|protect| A
  OBS -.-&gt;|instrumentation| EL
  QT --- DEMUX
  DEMUX --- NET
  SCH -.-&gt;|choose executor| TP
</pre><h5 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h5><table><thead><tr><th>구분</th><th>구성 요소</th><th>설명</th><th>주요 역할</th><th>핵심 기능</th><th>특징/트레이드오프</th><th>대표 구현/예시</th></tr></thead><tbody><tr><td>필수</td><td><strong>Async Runtime</strong></td><td>비동기 엔진 (루프·큐·타이머·소켓 관리)</td><td>루프 수명/리소스 관리</td><td>태스크 스케줄, I/O 연계</td><td>런타임 종속성 높음</td><td><strong>libuv</strong>, <strong>asyncio</strong></td></tr><tr><td>필수</td><td><strong>Event Loop</strong></td><td>준비된 작업 디스패치</td><td>콜백/코루틴 재개</td><td>단일 스레드 협력형 실행</td><td>블로킹 금지</td><td>Node.js Loop, Python Loop</td></tr><tr><td>필수</td><td><strong>Ready/Callback Queue</strong></td><td>완료·준비 작업 대기열</td><td>실행 순서 보장</td><td>마이크로태스크/태스크 우선순위</td><td>우선순위 역전/굶주림 주의</td><td>브라우저/Node 큐</td></tr><tr><td>필수 (언어 추상화)</td><td><strong>Coroutine / Promise / Future / Task</strong></td><td>미래 값/중단·재개</td><td>의존 작업 연결</td><td>await/then, 체이닝</td><td>누락된 await, 예외 전파 주의</td><td>JS Promise, Python Future, Java CompletableFuture</td></tr><tr><td>선택</td><td><strong>Thread Pool</strong></td><td>CPU-bound/블로킹 오프로딩</td><td>병렬 처리/격리</td><td>워커 관리, Executor</td><td>컨텍스트 스위칭 비용</td><td>ForkJoinPool, ThreadPoolExecutor</td></tr><tr><td>선택</td><td><strong>Message Queue</strong></td><td>서비스 간 비동기 통신</td><td>버퍼링/리플레이</td><td>Pub/Sub, 파티션</td><td>일관성/순서 보장 고려</td><td>RabbitMQ, Kafka</td></tr><tr><td>권장</td><td><strong>Scheduler(정책)</strong></td><td>실행 우선순위/풀 선택</td><td>QoS/격리</td><td>전용 풀, 스케줄링 정책</td><td>복잡도 증가</td><td>Reactor/RxJava Scheduler</td></tr><tr><td>권장</td><td><strong>Backpressure</strong></td><td>생산/소비 속도 정합</td><td>흐름 제어</td><td>요청 기반/크레딧/윈도우</td><td>과소/과도 제어 리스크</td><td>Reactive Streams</td></tr><tr><td>권장</td><td><strong>Circuit Breaker</strong></td><td>실패 격리</td><td>고장 전파 차단</td><td>상태 (CLOSED/OPEN/HALF_OPEN)</td><td>오탐/임계치 튜닝 필요</td><td>Resilience4j, (과거 Hystrix)</td></tr><tr><td>권장</td><td><strong>Timeout/Retry</strong></td><td>타임리미터·재시도</td><td>장애 복구</td><td>지수 백오프/지연</td><td>멱등성 필수</td><td>Resilience4j TimeLimiter</td></tr><tr><td>권장</td><td><strong>Observability</strong></td><td>가시성 확보</td><td>추적/메트릭/로그</td><td>컨텍스트 전파</td><td>오버헤드/샘플링</td><td>OpenTelemetry 등</td></tr><tr><td>내부 기반</td><td><strong>I/O 디멀티플렉서</strong></td><td>OS 레벨 I/O 완료/준비 통지</td><td>효율적 대기</td><td>epoll/kqueue/IOCP</td><td>플랫폼 의존</td><td>Windows IOCP, epoll</td></tr></tbody></table><h4 id=주요-기능과-역할>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할>#</a></h4><table><thead><tr><th>기능 카테고리</th><th>주요 역할</th><th>구현 방식</th><th>기술적 근거</th></tr></thead><tbody><tr><td><strong>작업 스케줄링</strong></td><td>비동기 작업 순서·우선순위·공정성 제어</td><td>Priority Queue, Round Robin, Timer Wheel</td><td>이벤트 루프·태스크 큐</td></tr><tr><td><strong>상태 관리</strong></td><td>작업 진행·완료 상태 추적</td><td>Promise state, Future state, Callback 등록</td><td>비동기 흐름 제어·에러 전파</td></tr><tr><td><strong>에러 처리</strong></td><td>비동기 예외 수집·전파</td><td>try/await-catch, error callback, AggregateException</td><td>안정성 확보</td></tr><tr><td><strong>자원 관리</strong></td><td>CPU, 메모리, I/O 자원 효율적 사용</td><td>Thread Pool, Connection Pool, Work-stealing</td><td>성능·확장성 보장</td></tr><tr><td><strong>플로우 제어</strong></td><td>생산·소비 속도 균형 유지</td><td>Backpressure, Rate Limiting, Flow Control</td><td>과부하 방지</td></tr><tr><td><strong>I/O 통합</strong></td><td>다양한 I/O 소스 통합 관리</td><td>epoll/kqueue/IOCP, Reactor/Proactor</td><td>네트워크·파일·타이머 처리</td></tr><tr><td><strong>취소/타임아웃</strong></td><td>불필요·장기 실행 작업 중단</td><td>CancellationToken, Timeout 설정</td><td>리소스 낭비 방지</td></tr></tbody></table><h5 id=기능간-관계>기능간 관계<a hidden class=anchor aria-hidden=true href=#기능간-관계>#</a></h5><table><thead><tr><th>기능 A</th><th>기능 B</th><th>관계 설명</th></tr></thead><tbody><tr><td>작업 스케줄링</td><td>상태 관리</td><td>상태 변화에 따라 다음 실행 작업 결정</td></tr><tr><td>상태 관리</td><td>에러 처리</td><td>실패 상태를 에러 처리 모듈로 전달</td></tr><tr><td>자원 관리</td><td>플로우 제어</td><td>자원 사용량에 따라 처리 속도 조절</td></tr><tr><td>플로우 제어</td><td>작업 스케줄링</td><td>속도 제한에 따라 태스크 투입 시점 변경</td></tr><tr><td>I/O 통합</td><td>작업 스케줄링</td><td>완료 이벤트 발생 시 다음 태스크 스케줄링</td></tr><tr><td>취소/타임아웃</td><td>자원 관리</td><td>중단된 작업의 자원 즉시 회수</td></tr></tbody></table><p>비동기 실행의 주요 기능은 <strong>작업을 관리하고 상태·에러·자원을 제어</strong>하는 것이 핵심이다.<br>스케줄링과 플로우 제어는 시스템 부하와 응답성 균형을 맞추고, 상태 관리와 에러 처리는 안정성을 보장한다.<br>자원 관리와 I/O 통합은 성능을 극대화하며, 취소/타임아웃은 불필요한 낭비를 방지한다.<br>각 기능은 독립적이지만, 서로 긴밀히 연결되어 전체 런타임의 효율을 결정한다.</p><h3 id=특성-분석-characteristics-analysis>특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#특성-분석-characteristics-analysis>#</a></h3><h4 id=장점-및-이점>장점 및 이점<a hidden class=anchor aria-hidden=true href=#장점-및-이점>#</a></h4><p>비동기 실행은 <strong>논블로킹 I/O</strong>와 <strong>이벤트 기반 스케줄링</strong>을 통해 I/O 대기 시간을 다른 작업에 활용함으로써 높은 처리량과 응답성을 제공한다.<br>적은 수의 스레드로 수많은 동시 작업을 처리해 메모리·CPU 사용을 줄이며, idle 시간을 최소화해 에너지 효율과 인프라 비용 절감을 가능하게 한다.<br>Stateless 설계와 독립적 컴포넌트 구성으로 수평 확장과 장애 격리가 용이하며, async/await·Promise 등 현대적 추상화를 통해 코드 흐름을 단순화할 수 있다.<br>다만 CPU-bound 환경에서는 효과가 제한적일 수 있고, 복잡한 비동기 흐름 관리가 필요하다.</p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th><th>실무 효과</th></tr></thead><tbody><tr><td>성능</td><td>높은 처리량</td><td>I/O 대기 시간에 다른 작업 실행</td><td>논블로킹 I/O, 이벤트 루프</td><td>10,000+ 동시 연결 처리</td></tr><tr><td>자원 효율성</td><td>메모리·CPU 절약</td><td>적은 스레드로 고동시성</td><td>컨텍스트 스위칭 감소, 스레드풀 최적화</td><td>인스턴스/코어당 처리량 증가</td></tr><tr><td>응답성</td><td>지연 감소</td><td>요청 즉시 반환 가능</td><td>Non-blocking 구조</td><td>P95/P99 지연 감소, UI 반응성 향상</td></tr><tr><td>확장성</td><td>수평 확장 용이</td><td>Stateless·독립 구성</td><td>로드밸런싱·장애 격리</td><td>마이크로서비스·멀티노드 배포 용이</td></tr><tr><td>비용·에너지</td><td>비용·전력 절감</td><td>idle 시간 최소화</td><td>이벤트 기반 동작</td><td>서버·전력 소비 20~30% 절감</td></tr><tr><td>유지보수성</td><td>흐름 단순화</td><td>명확한 제어 흐름</td><td>async/await, Promise 추상화</td><td>코드 가독성·유지보수성 향상</td></tr></tbody></table><p>비동기 실행은 처리량과 응답성을 높이고 자원 효율을 개선하는 동시에, 확장성과 비용 절감 효과를 제공한다. 또한 현대적 언어 기능으로 코드 흐름을 단순화할 수 있다. 그러나 CPU-bound 작업에는 효과가 제한되며, 복잡한 비동기 로직은 오히려 유지보수 난이도를 높일 수 있다.</p><h4 id=단점-및-제약사항과-해결방안>단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#단점-및-제약사항과-해결방안>#</a></h4><p>비동기 실행은 높은 성능과 확장성을 제공하지만, <strong>코드 복잡성 증가, 디버깅·오류 처리 난이도, 자원 관리 문제</strong> 등이 수반된다.</p><p>주요 단점은 다음과 같다:</p><ol><li><strong>코드 복잡성/가독성 저하</strong>: 콜백 지옥, 흐름 분절 → async/await·구조적 동시성으로 단순화.</li><li><strong>디버깅 어려움</strong>: 호출 스택 단절 → 분산 트레이싱, async 스택 캡처, 구조화 로깅.</li><li><strong>오류 처리 복잡성</strong>: 비동기 오류 전파 → 일관된 에러 핸들링 패턴 적용.</li><li><strong>백프레셔 실패</strong>: 무제한 생산 → 큐 모니터링, 속도 제한, 토큰 버킷.</li><li><strong>이벤트 루프 블로킹</strong>: CPU-bound 작업 → 워커 스레드·멀티프로세싱.</li><li><strong>경쟁 상태</strong>: 공유 자원 동시 접근 → 락, 불변 데이터 구조.</li><li><strong>메모리 누수</strong>: 콜백 참조 누적 → 타임아웃, 약한 참조.</li><li><strong>순서 제어 어려움</strong>: 완료 순서 예측 불가 → 순서 큐, 타임스탬프.</li><li><strong>학습 곡선</strong>: 새 패러다임 학습 → 점진적 도입, 추상화 라이브러리 활용.</li><li><strong>관찰 가능성 부족</strong>: 호출 체인 추적 어려움 → APM, 로그 상관키.</li><li><strong>취소 어려움</strong>: 장기 실행 태스크 중단 불가 → cancel 토큰·timeout 전략.</li><li><strong>플랫폼 제약</strong>: 특정 OS API 종속 → 크로스플랫폼 라이브러리 활용.</li><li><strong>보안 위험</strong>: 비동기 요청 폭주 → 레이트 리밋, 인증 강화.</li></ol><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th><th>대안 기술</th></tr></thead><tbody><tr><td>복잡성</td><td>코드 가독성 저하</td><td>콜백 지옥, 흐름 분절</td><td>유지보수 어려움</td><td>코드 리뷰</td><td>async/await, 구조적 동시성</td><td>Promise 체이닝, 패턴 적용</td><td>Reactive Streams, Coroutines</td></tr><tr><td>디버깅</td><td>호출 스택 단절</td><td>비동기 호출 경로 불명확</td><td>장애 분석 지연</td><td>분산 트레이싱, async 스택</td><td>구조화 로깅, 상관키 삽입</td><td>APM 연동</td><td>OpenTelemetry</td></tr><tr><td>에러 처리</td><td>오류 전파 복잡</td><td>비동기 에러 캐치 어려움</td><td>장애 전파</td><td>테스트·모니터링</td><td>에러 처리 일원화</td><td>try-catch+await, Circuit Breaker</td><td>액터 모델</td></tr><tr><td>자원 관리</td><td>백프레셔 실패</td><td>무제한 생산</td><td>메모리 폭증, 타임아웃</td><td>큐 모니터링</td><td>속도 제한</td><td>토큰 버킷, 윈도우 제한</td><td>메시지 브로커</td></tr><tr><td>성능</td><td>이벤트 루프 블로킹</td><td>CPU-heavy 작업</td><td>전체 지연</td><td>loop lag 측정</td><td>오프로딩</td><td>워커 스레드·멀티프로세싱</td><td>GPU 가속, 배치</td></tr><tr><td>동시성</td><td>경쟁 상태</td><td>공유 자원 동시 접근</td><td>데이터 불일치</td><td>로그·테스트</td><td>불변 객체</td><td>락, 원자 연산</td><td>STM, CQRS</td></tr><tr><td>메모리</td><td>콜백 참조 누적</td><td>cleanup 누락</td><td>메모리 누수</td><td>메모리 프로파일링</td><td>자원 해제</td><td>약한 참조</td><td>GC 튜닝</td></tr><tr><td>순서</td><td>순서 제어 어려움</td><td>완료 시점 불확정</td><td>결과 혼동</td><td>타임스탬프</td><td>순서 큐</td><td>정렬·재조합</td><td>분산 락</td></tr><tr><td>운영</td><td>학습 곡선</td><td>새 패러다임</td><td>생산성 저하</td><td>교육 이력</td><td>점진 도입</td><td>프레임워크 활용</td><td>고수준 API</td></tr><tr><td>운영</td><td>관찰 가능성 부족</td><td>호출 경로 추적 어려움</td><td>장애 원인 파악 지연</td><td>트레이싱</td><td>APM 연동</td><td>상관키 로깅</td><td>OpenTelemetry</td></tr><tr><td>운영</td><td>취소 어려움</td><td>API 미지원</td><td>자원 낭비</td><td>타임아웃 체크</td><td>취소 토큰</td><td>cancel()</td><td>구조적 동시성</td></tr><tr><td>호환성</td><td>플랫폼 제약</td><td>OS API 종속</td><td>이식성 저하</td><td>빌드 검증</td><td>추상화 계층</td><td>libuv, Netty</td><td>멀티런타임 지원</td></tr><tr><td>보안</td><td>요청 폭주</td><td>비동기 요청 악용</td><td>서비스 거부</td><td>보안 모니터링</td><td>레이트 리밋</td><td>인증·인가 강화</td><td>WAF, API Gateway</td></tr></tbody></table><p>비동기 실행은 성능·확장성을 높이지만, <strong>복잡성·디버깅·에러 처리 난이도·자원 관리 문제</strong>가 동반된다.<br>효과적인 운영을 위해 <strong>코드 단순화, 에러 처리 표준화, 백프레셔·취소·관찰 가능성 강화</strong>가 필수다.<br>또한 플랫폼 제약과 보안 리스크를 고려해 추상화 라이브러리와 보안 정책을 병행해야 안정성과 이식성을 확보할 수 있다.</p><h4 id=트레이드오프-관계-분석>트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석>#</a></h4><table><thead><tr><th>A vs B</th><th>A 선택 시 장점</th><th>A 선택 시 단점</th><th>B 선택 시 장점</th><th>B 선택 시 단점</th><th>선택 기준 (When A / When B)</th></tr></thead><tbody><tr><td>성능/확장성 vs 단순성</td><td>처리량·동시성↑, 비용/요금 효율</td><td>복잡성↑, 디버깅 난도↑</td><td>구현·학습 비용↓, 빠른 출시</td><td>스케일·성능 한계</td><td><strong>A</strong>: 트래픽·SLA 엄격<br><strong>B</strong>: 팀 역량·시장 속도 중시</td></tr><tr><td>메모리 효율 vs CPU 오버헤드</td><td>스레드↓, 메모리↓</td><td>루프 병목·관리 비용</td><td>구현 단순, 병렬 쉽게</td><td>메모리↑, 스위칭↑</td><td><strong>A</strong>: 메모리 제약, 고동시성<br><strong>B</strong>: 짧고 무거운 연산</td></tr><tr><td>단일 루프 vs 멀티스레드</td><td>락↓, 모델 단순</td><td>CPU-bound 취약</td><td>계산 병렬성↑</td><td>동기화 비용·복잡성</td><td><strong>A</strong>: I/O 중심<br><strong>B</strong>: 연산 중심</td></tr><tr><td>콜백 vs async/await</td><td>런타임 오버헤드↓</td><td>가독성/에러 처리 난도</td><td>가독성·예외 전파↑</td><td>약간의 오버헤드, await 누락 리스크</td><td><strong>A</strong>: 저수준/단순 파이프라인<br><strong>B</strong>: 복잡 비즈로직</td></tr><tr><td>푸시 (리액티브) vs 풀 (폴링)</td><td>지연↓, 자원 효율, backpressure</td><td>설계·튜닝 복잡</td><td>단순, 격리 쉬움</td><td>중복/지연↑, 낭비↑</td><td><strong>A</strong>: 스트리밍/실시간<br><strong>B</strong>: 저빈도·간헐</td></tr><tr><td>비동기 (I/O) vs 동기/병렬 (CPU)</td><td>대기 숨김, 처리량↑</td><td>관측/도구 필요</td><td>계산 성능↑</td><td>I/O 대기 비효율</td><td><strong>A</strong>: 네트워크/디스크 대기 큼<br><strong>B</strong>: 연산 비중 큼</td></tr><tr><td>실시간 vs CRUD</td><td>UX·응답성↑</td><td>예측·테스트 난도</td><td>생산성·유지보수↑</td><td>스케일/지연 한계</td><td><strong>A</strong>: 사용자 체감 중요<br><strong>B</strong>: 내부툴·일반 CRUD</td></tr></tbody></table><ul><li><strong>워크로드 특성 (I/O vs CPU)</strong>, <strong>SLA(지연·가용성)</strong>, <strong>팀 역량·운영 성숙도</strong>, <strong>자원 제약 (메모리/코어)</strong> 가 선택을 좌우한다.</li><li>고동시성·실시간 요구가 높을수록 <strong>비동기·푸시·단일 루프 중심</strong>으로, 계산 집약·단순 요구일수록 <strong>병렬·동기·풀 기반</strong>이 유리하다.</li><li>어떤 선택이든 **관측성 (Tracing/메트릭), 백프레셔, 취소/타임아웃, 스케줄링 정책 (QoS/페어니스)**이 운영 품질을 결정한다.</li></ul><h4 id=성능-특성-및-확장성-분석>성능 특성 및 확장성 분석<a hidden class=anchor aria-hidden=true href=#성능-특성-및-확장성-분석>#</a></h4><p>비동기 실행의 성능은 <strong>I/O 대기 은닉</strong>과 <strong>큐/스케줄링 효율</strong>에 좌우된다.</p><p>관측은 <strong>처리량 (RPS/QPS)</strong>, <strong>지연 분포 (P95/P99)</strong>, <strong>이벤트 루프 지연</strong>, <strong>큐 길이·대기시간</strong>, <strong>GC/메모리</strong>를 기본 축으로 삼는다.</p><p>포화 전까지는 처리량이 선형적으로 증가하지만, 큐가 차오르면 지연이 급격히 증가 (대기시간 폭증) 한다.<br>수직 확장은 이벤트 루프·네트워크·GC·커널 I/O 경로 (epoll/io_uring) 최적화로 단일 인스턴스 상한을 끌어올리고, 수평 확장은 <strong>멀티 루프/프로세스 클러스터링/샤딩 + 로드밸런싱 + 오토스케일</strong>로 처리량을 늘린다.</p><p>병목은 <strong>지표 간 상관</strong>(예: P99↑ & CPU idle → 외부 I/O 병목) 을 기반으로 진단하고, <strong>백프레셔/레이트 리미트</strong>로 폭주를 제어한다. 최종적으로는 **SLO 중심 (예: 오류율 & P99)**의 용량 계획과 **관측 가능성 (Tracing/Metrics/Logs)**으로 선순환을 만든다.</p><h5 id=핵심-지표와-수집>핵심 지표와 수집<a hidden class=anchor aria-hidden=true href=#핵심-지표와-수집>#</a></h5><table><thead><tr><th>지표</th><th>의미</th><th>수집/계산 방법</th><th>임계 관찰 포인트</th></tr></thead><tbody><tr><td>RPS/QPS</td><td>단위 시간 처리량</td><td>서버·LB 카운터, 워크로드 툴</td><td>증가 정체/하강 지점 (포화)</td></tr><tr><td>P95/P99 지연</td><td>tail latency</td><td>히스토그램/TDigest</td><td>업/다운스트림 지표와 상관</td></tr><tr><td>Event Loop Lag</td><td>루프 지연/드리프트</td><td>짧은 주기 타이머 편차</td><td>GC·동기 블로킹 상관 상승</td></tr><tr><td>큐 길이/대기</td><td>대기 중 태스크 수/시간</td><td>브로커·스레드풀·내부 큐</td><td>길이 급증 시 스로틀/드랍</td></tr><tr><td>GC/메모리</td><td>할당·수거·힙</td><td>런타임/OS 지표</td><td>pause-time vs P99 상관</td></tr></tbody></table><h5 id=증상--원인--대책>증상 → 원인 → 대책<a hidden class=anchor aria-hidden=true href=#증상--원인--대책>#</a></h5><table><thead><tr><th>증상</th><th>가능한 원인</th><th>대책</th></tr></thead><tbody><tr><td>P99↑, CPU 여유</td><td>DB/캐시 미스, 네트워크 RTT↑, 커넥션 풀 고갈</td><td>캐시/TLS 재사용, 풀 사이즈·타임아웃 조정, 배치·파이프라인</td></tr><tr><td>loop lag↑</td><td>대객체 처리, 동기 블로킹, 긴 콜백</td><td>워커 오프로딩, 청크 처리, 스트리밍, 스케줄 분할</td></tr><tr><td>큐 길이↑·타임아웃</td><td>입력 폭주, 백프레셔 부재</td><td>레이트 리미터·큐 한도·우선순위/드랍 정책</td></tr><tr><td>GC pause↑</td><td>단기 객체 폭주, 힙 과소/과대</td><td>힙 튜닝, 객체 재사용, 풀링, 세대별 비율 조정</td></tr><tr><td>RPS 정체</td><td>락/컨텐션, 단일 리소스 샤드</td><td>샤딩, 락 프리/분할, 멀티 인스턴스</td></tr></tbody></table><h5 id=확장-전략-레버>확장 전략 (레버)<a hidden class=anchor aria-hidden=true href=#확장-전략-레버>#</a></h5><table><thead><tr><th>범주</th><th>레버</th><th>구체화</th></tr></thead><tbody><tr><td>수직 (Scale-Up)</td><td>I/O 경로 최적화</td><td>epoll/io_uring, sendfile/zero-copy</td></tr><tr><td></td><td>이벤트 루프</td><td>멀티 루프/핫 패스 최적화, 핸들러 짧게 유지</td></tr><tr><td></td><td>메모리/GC</td><td>힙 상·하한, 풀링, 압도적 할당 경로 제거</td></tr><tr><td>수평 (Scale-Out)</td><td>프로세스/노드 확장</td><td>클러스터링, 샤딩 (키 설계), 무상태화</td></tr><tr><td></td><td>트래픽 제어</td><td>오토스케일, 레이트 리미터, 큐 기반 완충</td></tr><tr><td></td><td>데이터 계층</td><td>캐시 - 프론트, CQRS/리드모델, 리플리카</td></tr></tbody></table><ul><li>** 지표 5 종 (RPS, P95/P99, loop lag, 큐, GC/메모리)** 을 공통 언어로 삼아 포화를 조기 감지한다.</li><li>수직은 &ldquo;<strong>핫 패스 단축 + I/O 경로 최적화 + GC 안정화</strong>&rdquo;, 수평은 &ldquo;<strong>무상태화 + 샤딩/클러스터 + 오토스케일</strong>&rdquo; 이 핵심.</li><li>증상과 지표의 <strong>상관관계</strong>로 병목을 찾아 <strong>백프레셔/레이트 리미트</strong>로 폭주를 제어하면 tail latency 를 안정화할 수 있다.</li></ul><h3 id=구현-및-분류-implementation--classification>구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#구현-및-분류-implementation--classification>#</a></h3><h4 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h4><table><thead><tr><th>분류</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td>콜백 (Callback)</td><td>완료 시 함수를 호출해 결과 전달</td><td>비동기 함수, 콜백, 에러 콜백</td><td>등록/완료 분리, 콜백 실행</td><td>최소 오버헤드, 단순 처리</td><td>단순 I/O, 빠른 이벤트 응답</td><td>콜백 지옥 위험, 흐름 분절</td></tr><tr><td>Promise/Future</td><td>미래 값/에러를 캡슐화</td><td>then/catch, 상태 (P/F/R)</td><td>체이닝으로 조합</td><td>가독성·에러 처리 개선</td><td>순차/병렬 조합 필요한 웹클라이언트/서버</td><td>제어 흐름 명확, 에러 전파 용이</td></tr><tr><td>async/await(코루틴)</td><td>비동기를 동기처럼 표현</td><td>async 함수, await, 예외</td><td>스택 보존, 일시중단·재개</td><td>가독성·디버깅 향상</td><td>복잡한 비동기 로직, 서비스 코어</td><td>구조적 동시성·취소 결합 용이</td></tr><tr><td>이벤트 루프 + 워커 풀</td><td>I/O 는 루프, CPU 는 워커로 분리</td><td>이벤트 루프, 큐, 스레드/프로세스 풀</td><td>Non-blocking + 오프로딩</td><td>루프 블로킹 방지</td><td>혼합 (I/O+CPU) 워크로드</td><td>지연 안정화, 처리량 향상</td></tr><tr><td>리액티브 스트림</td><td>비동기 스트림 + 배압</td><td>Publisher/Subscriber, Operator</td><td>pull/push, backpressure</td><td>폭주 제어, 스트림 조합</td><td>스트리밍, 실시간 처리</td><td>연산자 풍부, 학습 필요</td></tr><tr><td>액터 모델</td><td>상태 격리, 메시지 기반</td><td>Actor, Mailbox, Supervisor</td><td>메시지 큐·단일 스레드 상태</td><td>고립·복구·스케일</td><td>상태 ful·고동시성 서비스</td><td>장애 격리·재시작 정책</td></tr><tr><td>CSP(채널)</td><td>채널로 통신, 공유상태 회피</td><td>Goroutine/채널 (Go)</td><td>순차적 통신, 동기화</td><td>단순하고 안전한 동시성</td><td>파이프라인, fan-in/out</td><td>코드 간결, 설계 직관적</td></tr><tr><td>메시지 브로커 기반</td><td>비동기 메시지로 결합도 완화</td><td>Kafka/RabbitMQ/SQS, 소비자</td><td>지속/재시도, 내구성</td><td>백프레셔·버퍼·스파이크 흡수</td><td>마이크로서비스, 비동기 워크플로</td><td>내구·확장, 운영 구성 필요</td></tr></tbody></table><h5 id=콜백---javascript>콜백 - JavaScript<a hidden class=anchor aria-hidden=true href=#콜백---javascript>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// I/O 완료 시 콜백으로 결과 전달 (오류-우선 콜백 규약)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>readUser</span><span class=p>(</span><span class=nx>id</span><span class=p>,</span> <span class=nx>cb</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>id</span><span class=p>)</span> <span class=k>return</span> <span class=nx>cb</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;invalid id&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nx>cb</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=p>{</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Lee&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=mi>50</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>readUser</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=k>return</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;user:&#39;</span><span class=p>,</span> <span class=nx>user</span><span class=p>);</span> <span class=c1>// { id:1, name:&#39;Lee&#39; }
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=promisefuture---javascript>Promise/Future - JavaScript<a hidden class=anchor aria-hidden=true href=#promisefuture---javascript>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3>3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4>4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5>5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6>6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7>7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8>8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Promise로 비동기 값을 캡슐화하고 then/catch로 조합
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>readUserP</span> <span class=o>=</span> <span class=p>(</span><span class=nx>id</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>res</span><span class=p>,</span> <span class=nx>rej</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>id</span> <span class=o>?</span> <span class=nx>res</span><span class=p>({</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Lee&#39;</span> <span class=p>})</span> <span class=o>:</span> <span class=nx>rej</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;invalid&#39;</span><span class=p>))),</span> <span class=mi>50</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>readUserP</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>u</span> <span class=p>=&gt;</span> <span class=nx>readUserP</span><span class=p>(</span><span class=nx>u</span><span class=p>.</span><span class=nx>id</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>u2</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;chained:&#39;</span><span class=p>,</span> <span class=nx>u2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>e</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;error:&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>.</span><span class=nx>message</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=asyncawait코루틴---python-asyncio>async/await(코루틴) - Python (asyncio)<a hidden class=anchor aria-hidden=true href=#asyncawait코루틴---python-asyncio>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span><span class=o>,</span> <span class=nn>aiohttp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>fetch_json</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>url</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 타임아웃/예외는 상위에서 통합 처리 가능</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span> <span class=k>as</span> <span class=n>r</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>await</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>()</span> <span class=k>as</span> <span class=n>s</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 구조적 동시성: TaskGroup으로 스코프 내 관리</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>TaskGroup</span><span class=p>()</span> <span class=k>as</span> <span class=n>tg</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>t1</span> <span class=o>=</span> <span class=n>tg</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span><span class=n>fetch_json</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=s2>&#34;https://httpbin.org/json&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>t2</span> <span class=o>=</span> <span class=n>tg</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span><span class=n>fetch_json</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=s2>&#34;https://httpbin.org/uuid&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>t1</span><span class=o>.</span><span class=n>result</span><span class=p>(),</span> <span class=n>t2</span><span class=o>.</span><span class=n>result</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=이벤트-루프--워커-풀---python-run_in_executor>이벤트 루프 + 워커 풀 - Python (run_in_executor)<a hidden class=anchor aria-hidden=true href=#이벤트-루프--워커-풀---python-run_in_executor>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>concurrent.futures</span> <span class=kn>import</span> <span class=n>ThreadPoolExecutor</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>cpu_heavy</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10_000_00</span><span class=p>):</span>  <span class=c1># CPU 바운드</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>+=</span> <span class=p>(</span><span class=n>i</span> <span class=o>%</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>loop</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_running_loop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>ThreadPoolExecutor</span><span class=p>(</span><span class=n>max_workers</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span> <span class=k>as</span> <span class=n>pool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 이벤트 루프를 막지 않고 CPU 작업을 워커로 오프로딩</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>loop</span><span class=o>.</span><span class=n>run_in_executor</span><span class=p>(</span><span class=n>pool</span><span class=p>,</span> <span class=n>cpu_heavy</span><span class=p>,</span> <span class=mi>7</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;sum:&#34;</span><span class=p>,</span> <span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=리액티브-스트림---rxjs-javascript>리액티브 스트림 - RxJS (JavaScript)<a hidden class=anchor aria-hidden=true href=#리액티브-스트림---rxjs-javascript>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// npm i rxjs
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>interval</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;rxjs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>map</span><span class=p>,</span> <span class=nx>filter</span><span class=p>,</span> <span class=nx>take</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;rxjs/operators&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>interval</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>              <span class=c1>// 100ms마다 값 발행(0,1,2,…)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>map</span><span class=p>(</span><span class=nx>x</span> <span class=p>=&gt;</span> <span class=nx>x</span> <span class=o>*</span> <span class=mi>2</span><span class=p>),</span>       <span class=c1>// 변환
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>filter</span><span class=p>(</span><span class=nx>x</span> <span class=p>=&gt;</span> <span class=nx>x</span> <span class=o>%</span> <span class=mi>3</span><span class=p>),</span>    <span class=c1>// 조건 필터
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>take</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>               <span class=c1>// 백프레셔/종료 제어의 한 유형
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=o>:</span> <span class=nx>v</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;v=&#39;</span><span class=p>,</span> <span class=nx>v</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>error</span><span class=o>:</span> <span class=nx>e</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>e</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>complete</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;done&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=메시지-브로커-기반---nodejs--amqplib-rabbitmq>메시지 브로커 기반 - Node.js + Amqplib (RabbitMQ)<a hidden class=anchor aria-hidden=true href=#메시지-브로커-기반---nodejs--amqplib-rabbitmq>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// npm i amqplib
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>amqp</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;amqplib&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>conn</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>amqp</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=s1>&#39;amqp://localhost&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>ch</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>conn</span><span class=p>.</span><span class=nx>createChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>q</span> <span class=o>=</span> <span class=s1>&#39;tasks&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>ch</span><span class=p>.</span><span class=nx>assertQueue</span><span class=p>(</span><span class=nx>q</span><span class=p>,</span> <span class=p>{</span> <span class=nx>durable</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 생산자
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>ch</span><span class=p>.</span><span class=nx>sendToQueue</span><span class=p>(</span><span class=nx>q</span><span class=p>,</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>jobId</span><span class=o>:</span> <span class=mi>1</span> <span class=p>})),</span> <span class=p>{</span> <span class=nx>persistent</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 소비자 (prefetch=1로 백프레셔)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>ch</span><span class=p>.</span><span class=nx>prefetch</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>ch</span><span class=p>.</span><span class=nx>consume</span><span class=p>(</span><span class=nx>q</span><span class=p>,</span> <span class=nx>msg</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>task</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;process:&#39;</span><span class=p>,</span> <span class=nx>task</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 처리 후 ack — 실패 시 nack/requeue 가능
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ch</span><span class=p>.</span><span class=nx>ack</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>})();</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=분류-기준에-따른-유형>분류 기준에 따른 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형>#</a></h4><table><thead><tr><th>분류 기준</th><th>유형</th><th>핵심 설명</th><th>장점</th><th>한계/주의</th><th>대표 기술/예시</th><th>적합 사례</th></tr></thead><tbody><tr><td>표현/추상화</td><td>콜백</td><td>함수로 완료 통지</td><td>오버헤드 낮음</td><td>가독성·에러 전파 취약</td><td>Node 콜백, libuv</td><td>저수준 I/O 핸들링</td></tr><tr><td></td><td>Promise/Future</td><td>미래 값, 체이닝</td><td>조합 용이</td><td>then/future 지옥 가능</td><td>JS Promise, Java CompletableFuture</td><td>비동기 단계적 처리</td></tr><tr><td></td><td>async/await(코루틴)</td><td>문법 레벨 대기/재개</td><td>가독성·예외 전파 우수</td><td>런타임 오버헤드, await 누락 주의</td><td>Python asyncio, Kotlin coroutines</td><td>복잡한 비즈 로직</td></tr><tr><td>스케줄링/실행</td><td>이벤트 루프</td><td>단일 (또는 N) 루프 디스패치</td><td>고동시성 I/O</td><td>블로킹 금지</td><td>Node.js, asyncio, Netty</td><td>네트워크 서버</td></tr><tr><td></td><td>하이브리드 (루프 + 풀)</td><td>I/O 는 루프, CPU 는 풀</td><td>효율·균형</td><td>경계 관리 필요</td><td>aiohttp+ThreadPool</td><td>일반 웹/API 서버</td></tr><tr><td>통신/동시성</td><td>액터 모델</td><td>메시지·상태 격리</td><td>결합도↓, 장애 격리</td><td>메시지 설계 난도</td><td>Akka, Orleans, Erlang</td><td>분산·상태 ful 서비스</td></tr><tr><td></td><td>CSP</td><td>채널로 통신</td><td>단순·명확</td><td>채널 설계 필요</td><td>Go 고루틴 + 채널</td><td>동시 파이프라인</td></tr><tr><td></td><td>메시지 큐</td><td>비동기 브로커 연계</td><td>버퍼링·리플레이</td><td>일관성·순서 이슈</td><td>Kafka, RabbitMQ</td><td>마이크로서비스 통합</td></tr><tr><td>스레딩/자원</td><td>단일 루프</td><td>1 스레드 I/O</td><td>락 회피</td><td>CPU-bound 취약</td><td>Node.js</td><td>고연결 I/O</td></tr><tr><td></td><td>멀티 루프/샤딩</td><td>코어별 루프</td><td>스케일↑</td><td>워크 분배 복잡</td><td>Netty, Nginx</td><td>초고동시성</td></tr><tr><td></td><td>스레드 풀/Executor</td><td>병렬 워커</td><td>CPU 작업 유리</td><td>컨텍스트 스위칭</td><td>ForkJoinPool, Executor</td><td>이미지/암호화/압축</td></tr><tr><td>동작 대상</td><td>Async I/O</td><td>네트워크/파일</td><td>대기 흡수</td><td>헤드 - 오브 - 라인 주의</td><td>epoll/kqueue/IOCP</td><td>API, 프록시</td></tr><tr><td></td><td>Async Compute</td><td>비동기 연산</td><td>UI/루프 보호</td><td>결국 병렬 필요</td><td>GPU/오프로딩</td><td>백그라운드 연산</td></tr><tr><td>처리/흐름</td><td>이벤트 기반</td><td>이벤트 도착 시 처리</td><td>단순·직관</td><td>순서·우선순위 관리</td><td>EventEmitter, 핸들러</td><td>GUI/서버</td></tr><tr><td></td><td>스트림/리액티브</td><td>연속 데이터·백프레셔</td><td>지연·자원 효율</td><td>설계·튜닝 난도</td><td>Reactive Streams, Rx</td><td>실시간 스트리밍</td></tr><tr><td></td><td>태스크/배치</td><td>작업 단위 처리</td><td>회복·재시도 용이</td><td>지연↑</td><td>Celery, Quartz</td><td>ETL/배치</td></tr><tr><td>품질/운영 (보강)</td><td>구조적 동시성</td><td>작업 트리·수명 관리</td><td>누수·좀비 작업 방지</td><td>초기 설계 필요</td><td>Kotlin/Swift structured</td><td>대규모 async 서비스</td></tr><tr><td></td><td>흐름 제어</td><td>백프레셔/취소/타임아웃</td><td>안정성·탄력성↑</td><td>정책 튜닝</td><td>Reactive backpressure, Timeouts</td><td>스트림·외부 API</td></tr></tbody></table><ul><li>비동기는 <strong>단일 선택</strong>이 아니라 <strong>여러 축의 조합</strong>이다.</li><li><strong>표현</strong>은 개발 생산성과 오류 모델을, <strong>스케줄링/스레딩</strong>은 처리량·지연·자원 효율을, <strong>통신 모델</strong>은 결합도·확장성과 장애 격리를 좌우한다.</li><li>** 워크로드 (I/O vs 연산)** 와 ** 처리/흐름 (이벤트/스트림/태스크)** 에 맞춰 조합을 선택하고, <strong>구조적 동시성·백프레셔·취소/타임아웃</strong>으로 운영 품질을 보장하면 된다.</li></ul><h4 id=도구-및-프레임워크-생태계>도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#도구-및-프레임워크-생태계>#</a></h4><table><thead><tr><th>카테고리</th><th>대표 도구/프레임워크</th><th>주요 특징</th><th>적용 예시</th></tr></thead><tbody><tr><td>언어·런타임</td><td>JS(Promise, async/await), Python(asyncio, uvloop), Java(CompletableFuture, RxJava, Netty), Go(Goroutines), Rust(Tokio), Kotlin(Coroutines), Erlang/Elixir(OTP)</td><td>언어 차원의 비동기 지원</td><td>웹·시스템·마이크로서비스 전반</td></tr><tr><td>웹/네트워크</td><td>Express.js, FastAPI, Spring WebFlux, ASP.NET Core, gRPC, SSE, WebSocket, HTTP/2·3</td><td>비동기 요청·스트리밍 처리</td><td>API 서버, 실시간 서비스</td></tr><tr><td>메시징/스트리밍</td><td>Kafka, RabbitMQ, Redis Streams, NATS, AWS SQS, Google Pub/Sub</td><td>이벤트 기반 비동기 통신</td><td>이벤트 소싱, 데이터 스트림</td></tr><tr><td>잡/워크플로우</td><td>Celery, Airflow, Temporal, Argo, AWS Step Functions, Netflix Conductor</td><td>비동기 잡 실행·오케스트레이션</td><td>배치 처리, 분산 워크플로우</td></tr><tr><td>DB 비동기 드라이버</td><td>MongoDB, PostgreSQL, Cassandra</td><td>논블로킹 I/O, 연결 풀</td><td>고동시성 데이터 액세스</td></tr><tr><td>모니터링·관측</td><td>New Relic, AppDynamics, OpenTelemetry, Jaeger, Zipkin</td><td>성능 추적·분산 트레이싱</td><td>병목 분석, SLO 모니터링</td></tr><tr><td>테스트·디버깅·프로파일링</td><td>Jest async tests, pytest-asyncio, Mockito, Sinon.js, Chrome DevTools, Visual Studio, Go pprof, tokio-console, async-profiler, py-spy</td><td>비동기 코드 검증·성능 분석</td><td>개발·운영 병목 제거</td></tr></tbody></table><ul><li><strong>언어·런타임</strong>: 각 언어가 제공하는 비동기 모델은 생태계 기반이며, 성능·개발 편의성에 큰 영향.</li><li><strong>웹/네트워크</strong>: 실시간·스트리밍 서비스의 핵심이며 HTTP/3, gRPC 등 차세대 프로토콜이 주도.</li><li><strong>메시징</strong>: 비동기 아키텍처에서 서비스 간 결합도를 줄이고 확장성을 높이는 핵심 축.</li><li><strong>워크플로우</strong>: 대규모 비동기 작업 조율과 실패 복구 자동화에 중요.</li><li><strong>DB 드라이버</strong>: 고동시성 환경에서 데이터 접근 병목 완화.</li><li><strong>모니터링</strong>: 성능 보장과 문제 진단의 필수 요소, OpenTelemetry 표준 확산 중.</li><li><strong>테스트·디버깅</strong>: 비동기 로직은 재현·분석 난이도가 높아, 특화된 도구가 필수.</li></ul><p><strong>프레임워크 생태계</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;웹 프레임워크&#34;
        A[Express.js] --&gt; A1[Node.js 기반]
        B[FastAPI] --&gt; B1[Python 기반]
        C[Spring WebFlux] --&gt; C1[Java 기반]
        D[ASP.NET Core] --&gt; D1[C# 기반]
    end
    
    subgraph &#34;메시징 시스템&#34;
        E[Apache Kafka] --&gt; E1[스트림 처리]
        F[RabbitMQ] --&gt; F1[메시지 큐]
        G[Redis Streams] --&gt; G1[실시간 스트림]
    end
    
    subgraph &#34;데이터베이스&#34;
        H[MongoDB] --&gt; H1[비동기 드라이버]
        I[PostgreSQL] --&gt; I1[비동기 연결 풀]
        J[Cassandra] --&gt; J1[분산 비동기]
    end
</pre><h4 id=표준-및-규격-준수사항>표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#표준-및-규격-준수사항>#</a></h4><table><thead><tr><th>표준/규격</th><th>설명</th><th>적용 범위</th><th>핵심 요구사항</th><th>관련 설계 원칙</th></tr></thead><tbody><tr><td>POSIX AIO</td><td>POSIX 표준 비동기 파일·네트워크 I/O API</td><td>Unix/Linux 기반 시스템</td><td>비차단 I/O 호출, 시그널/스레드 기반 완료 통보</td><td>예외 전파, 취소 가능성</td></tr><tr><td>Reactive Streams</td><td>비동기 스트림 처리·백프레셔 표준</td><td>JVM·다중 언어 구현</td><td>Publisher/Subscriber 인터페이스, 흐름 제어</td><td>백프레셔, 컨텍스트 보존</td></tr><tr><td>AMQP</td><td>메시지 브로커 표준 프로토콜</td><td>RabbitMQ, ActiveMQ 등</td><td>신뢰성 있는 메시지 전송·라우팅</td><td>예외 전파, 취소 가능성</td></tr><tr><td>HTTP/2 & 3(QUIC)</td><td>멀티플렉싱·스트리밍 지원 HTTP 표준</td><td>웹·API 서버·클라이언트</td><td>스트림 단위 흐름제어, 헤더 압축</td><td>백프레셔</td></tr><tr><td>gRPC</td><td>HTTP/2 기반 스트리밍 RPC</td><td>마이크로서비스 간 통신</td><td>양방향 스트리밍, 플로우 제어, Protobuf 직렬화</td><td>백프레셔, 컨텍스트 보존</td></tr><tr><td>WebSocket</td><td>양방향 실시간 통신 표준</td><td>브라우저·서버</td><td>연결 유지·메시지 이벤트 기반 처리</td><td>취소 가능성</td></tr><tr><td>OpenTelemetry</td><td>분산 추적·메트릭·로그 표준</td><td>전역 관측·모니터링</td><td>Trace Context 전파, 지표 수집</td><td>컨텍스트 보존, 예외 전파</td></tr><tr><td>W3C Trace Context</td><td>분산 트레이싱 컨텍스트 규격</td><td>OpenTelemetry·APM</td><td>traceparent/tracestate 헤더</td><td>컨텍스트 보존</td></tr></tbody></table><p>비동기 실행 환경에서 표준 준수는 상호운용성과 안정성을 보장한다.</p><ul><li><strong>I/O·네트워크 계층</strong>: POSIX AIO, HTTP/2·3, gRPC, WebSocket 은 비차단·스트리밍 처리를 위한 기반 표준.</li><li><strong>메시징·스트림 계층</strong>: Reactive Streams, AMQP 는 백프레셔·메시지 전달 보장에 필수.</li><li><strong>관측·운영 계층</strong>: OpenTelemetry, W3C Trace Context 는 분산 환경에서 추적·메트릭·로그 표준화에 기여.</li><li>설계 원칙 (백프레셔, 취소 가능성, 예외 전파, 컨텍스트 보존) 은 표준을 구현·활용할 때 반드시 동반 고려해야 함.</li></ul><h3 id=실무-적용-practical-application>실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#실무-적용-practical-application>#</a></h3><h4 id=실제-도입-사례>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례>#</a></h4><table><thead><tr><th>조직/도메인</th><th>도입 배경</th><th>기술 조합 (핵심)</th><th>아키텍처 포인트</th><th>확인된 효과/지표</th></tr></thead><tbody><tr><td>Netflix (API/게이트웨이)</td><td>복잡한 팬아웃, 높은 동시성, 다양 기기 대응</td><td><strong>RxJava(리액티브 조합)</strong> + <strong>Hystrix(격벽/회로차단)</strong></td><td>논블로킹 조합/타임아웃/폴백, 장애 격리</td><td>리액티브 모델 채택으로 고동시성 API 구성 (정성적)</td></tr><tr><td>Discord (실시간 메시징)</td><td>수백만 동시 커넥션, WS 이벤트 급증</td><td><strong>Elixir/BEAM + WebSocket 게이트웨이</strong>, zstd</td><td>장기 커넥션 샤딩/게이트웨이, 압축 최적화</td><td><strong>대역폭 ~40% 절감 (2024)</strong> / <strong>12M+ 동시 접속·초당 26M 이벤트 (2020)</strong></td></tr><tr><td>Uber (모바일 실시간/푸시)</td><td>다수 앱의 실시간 동기화·알림</td><td><strong>gRPC 양방향 스트리밍 (QUIC/HTTP3)</strong> + Netty</td><td>단일 채널 스트림/ACK 실시간화, 흐름제어, HTTP/3</td><td>QUIC 실험 기준 <strong>테일 지연 10–30% 개선</strong>(HTTPS 트래픽)</td></tr><tr><td>Uber (마이크로서비스 통신)</td><td>서비스 간 대규모 이벤트 스트리밍</td><td><strong>Kafka(퍼브섭/버퍼링)</strong></td><td>파티셔닝/컨슈머 프록시, 재처리·리플레이</td><td><strong>300+ 서비스에서 표준 채택</strong></td></tr></tbody></table><ul><li><strong>공통 패턴</strong><ul><li><strong>논블로킹 처리 + 백프레셔/흐름제어</strong>: 스트림/게이트웨이의 안정성 핵심.</li><li><strong>탄력성 (회로차단·타임아웃·폴백)</strong>: 외부 의존성 장애가 전체로 전파되는 것을 차단.</li><li><strong>샤딩/파티셔닝</strong>: 장기 커넥션 (WS)·이벤트 스트리밍 (Kafka) 모두 핵심 스케일 축.</li><li><strong>표준화된 프로토콜/프레임워크</strong>: gRPC·QUIC/HTTP3, Rx/Reactive 등으로 멀티 언어/플랫폼 통합.</li></ul></li><li><strong>트레이드오프</strong><ul><li>복잡성 (디버깅/운영) ↑ ↔ 처리량/자원 효율/테일 지연 ↓.</li><li>리액티브/스트리밍은 <strong>관측성 (트레이싱·큐/지표)</strong> 없이는 운영 난도 상승.</li></ul></li><li><strong>도입 순서 가이드</strong><ol><li><strong>핫패스 식별</strong>(p95/p99·큐 체류시간·드롭율),</li><li><strong>비동기화/오프로딩 경계 설정</strong>(I/O vs CPU),</li><li><strong>흐름제어/탄력성 기본 구성</strong>(백프레셔·타임아웃·서킷브레이커),</li><li><strong>샤딩/스케줄링 정책</strong>(QoS/페어니스),</li><li><strong>실험/롤아웃</strong>(다크런·카나리 + 가드).</li></ol></li></ul><h4 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h4><h5 id=실습-예제-이벤트-루프백프레셔타임아웃취소-이해>실습 예제: 이벤트 루프/백프레셔/타임아웃/취소 이해<a hidden class=anchor aria-hidden=true href=#실습-예제-이벤트-루프백프레셔타임아웃취소-이해>#</a></h5><p><strong>학습 목표</strong>: 이벤트 루프/백프레셔/타임아웃/취소 이해</p><p><strong>시나리오</strong>: URL 리스트를 병렬 크롤링하여 응답 본문 길이 수집</p><p><strong>시스템 구성</strong>:</p><ul><li>CLI(명령) → asyncio 러너 → aiohttp 클라이언트 → 결과 집계</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
  CLI --&gt; R[Async Runner]
  R --&gt; L[Event Loop]
  L --&gt; C[aiohttp Client]
  C --&gt;|I/O| Web[Remote Sites]
</pre><p><strong>Workflow</strong>:</p><ol><li>URL 입력 → 2. 세마포어로 동시성 제한 → 3. 타임아웃 적용 → 4. 실패 재시도 → 5. 결과 집계/로그</li></ol><p><strong>핵심 역할</strong>: 비동기 I/O, 백프레셔, 타임아웃/재시도</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 동기 requests → 스레드 수↑, 처리량↓</li><li>도입 후: 단일 프로세스에서 수백 동시 연결 처리</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18>18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19>19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20>20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21>21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22>22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23>23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24>24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25>25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span><span class=o>,</span> <span class=nn>aiohttp</span><span class=o>,</span> <span class=nn>async_timeout</span><span class=o>,</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>fetch_len</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>retries</span><span class=o>=</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 비동기 I/O 호출: 이벤트 루프가 대기 없이 다른 태스크를 처리</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>retries</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>async</span> <span class=k>with</span> <span class=n>async_timeout</span><span class=o>.</span><span class=n>timeout</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>async</span> <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span> <span class=k>as</span> <span class=n>resp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>text</span> <span class=o>=</span> <span class=k>await</span> <span class=n>resp</span><span class=o>.</span><span class=n>text</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>attempt</span> <span class=o>==</span> <span class=n>retries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;ERR:</span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.2</span> <span class=o>*</span> <span class=p>(</span><span class=n>attempt</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>  <span class=c1># 지수 백오프(간단)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=n>urls</span><span class=p>,</span> <span class=n>concurrency</span><span class=o>=</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sem</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=n>concurrency</span><span class=p>)</span>  <span class=c1># 백프레셔 핵심</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>()</span> <span class=k>as</span> <span class=n>s</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>def</span> <span class=nf>bounded</span><span class=p>(</span><span class=n>u</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>            <span class=k>async</span> <span class=k>with</span> <span class=n>sem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=k>await</span> <span class=n>fetch_len</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=n>bounded</span><span class=p>(</span><span class=n>u</span><span class=p>)</span> <span class=k>for</span> <span class=n>u</span> <span class=ow>in</span> <span class=n>urls</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># asyncio.run(run([…]))</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>구현 예시 (Node.js)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node: AbortController로 타임아웃/취소, 제한 동시성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>fetch</span> <span class=o>=</span> <span class=p>(</span><span class=err>…</span><span class=nx>a</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=kr>import</span><span class=p>(</span><span class=s1>&#39;node-fetch&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>(({</span><span class=k>default</span><span class=o>:</span><span class=nx>f</span><span class=p>})</span> <span class=p>=&gt;</span> <span class=nx>f</span><span class=p>(</span><span class=err>…</span><span class=nx>a</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>fetchLen</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>ms</span><span class=o>=</span><span class=mi>3000</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>ctl</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AbortController</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>ctl</span><span class=p>.</span><span class=nx>abort</span><span class=p>(),</span> <span class=nx>ms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=p>{</span> <span class=nx>signal</span><span class=o>:</span> <span class=nx>ctl</span><span class=p>.</span><span class=nx>signal</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>text</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>res</span><span class=p>.</span><span class=nx>text</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>text</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=sb>`ERR:</span><span class=si>${</span><span class=nx>e</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=실습-예제-비동기-함수-실행과-주-프로그램-흐름의-분리>실습 예제: 비동기 함수 실행과 주 프로그램 흐름의 분리<a hidden class=anchor aria-hidden=true href=#실습-예제-비동기-함수-실행과-주-프로그램-흐름의-분리>#</a></h5><p><strong>학습 목표</strong>: 비동기 함수 실행과 주 프로그램 흐름의 분리</p><p><strong>시나리오</strong>: 서버에서 여러 요청을 동시에 처리</p><p><strong>시스템 구성</strong>:</p><ul><li>요청 핸들러 (Handler), 작업 큐, 응답 콜백</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    Client --&gt;|Request| Handler
    Handler --&gt;|Queue Registration| WorkQueue
    WorkQueue --&gt;|Execution| Worker
    Worker --&gt;|Result Callback| Handler
</pre><p><strong>Workflow</strong>:</p><ol><li>클라이언트가 요청</li><li>핸들러가 작업을 큐에 등록</li><li>작업자는 비동기적으로 처리</li><li>결과를 핸들러로 반환해 응답</li></ol><p><strong>핵심 역할</strong>: Handler 가 비동기 등록 및 응답, Worker 가 병렬 처리 담당</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 요청 순차 처리, 대기 시간 ↑, 처리량 ↓</li><li>도입 후: 동시 처리, 응답성·처리량 ↑</li></ul><p><strong>구현 예시</strong> (Python/asyncio):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>async_task</span><span class=p>(</span><span class=n>task_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>task_id</span><span class=si>}</span><span class=s2> 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 실제 비동기 동작</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>task_id</span><span class=si>}</span><span class=s2> 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;작업 </span><span class=si>{</span><span class=n>task_id</span><span class=si>}</span><span class=s2> 결과&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span><span class=n>async_task</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># asyncio.run(main()) # 실제 사용 시 이 함수로 실행</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>async_task 는 실제 비동기 작업을 나타내며, 작업이 동시에 실행됨을 확인할 수 있다.</li></ul><h5 id=실습-예제-비동기-웹-크롤러-구현을-통한-비동기-패턴-이해>실습 예제: 비동기 웹 크롤러 구현을 통한 비동기 패턴 이해<a hidden class=anchor aria-hidden=true href=#실습-예제-비동기-웹-크롤러-구현을-통한-비동기-패턴-이해>#</a></h5><p><strong>학습 목표</strong>: 비동기 웹 크롤러 구현을 통한 비동기 패턴 이해</p><p><strong>시나리오</strong>: 여러 웹사이트에서 동시에 데이터를 수집하는 웹 크롤러</p><p><strong>시스템 구성</strong>:</p><ul><li>비동기 HTTP 클라이언트 (aiohttp)</li><li>작업 큐 관리자 (asyncio.Queue)</li><li>결과 저장소 (비동기 파일 I/O)</li><li>에러 핸들러 및 재시도 로직</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[Main Controller] --&gt; B[URL Queue]
    B --&gt; C[Worker Pool]
    C --&gt; D[HTTP Client]
    D --&gt; E[Response Parser]
    E --&gt; F[Result Storage]
    
    G[Error Handler] --&gt; H[Retry Queue]
    H --&gt; B
    
    D --&gt; G
    E --&gt; G
</pre><p><strong>Workflow</strong>:</p><ol><li>URL 목록을 비동기 큐에 추가</li><li>워커 풀에서 URL 을 병렬로 처리</li><li>HTTP 요청을 비동기로 실행</li><li>응답을 파싱하여 데이터 추출</li><li>결과를 비동기로 저장</li><li>에러 발생 시 재시도 큐에 추가</li></ol><p><strong>핵심 역할</strong>:</p><ul><li><strong>비동기 I/O</strong>: 네트워크 대기 시간 동안 다른 요청 처리</li><li><strong>동시성 제어</strong>: 제한된 워커로 효율적인 자원 사용</li><li><strong>에러 복원력</strong>: 실패한 요청의 자동 재시도</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 순차적 크롤링으로 100 개 URL 처리에 100 초 소요</li><li>도입 후: 병렬 비동기 처리로 동일 작업을 10 초에 완료</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>  1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>  2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3>  3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4>  4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5>  5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6>  6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7>  7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8>  8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9>  9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10> 10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11> 11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12> 12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13> 13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14> 14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15> 15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16> 16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17> 17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18> 18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19> 19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20> 20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21> 21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22> 22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23> 23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24> 24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25> 25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26> 26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27> 27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28> 28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29> 29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30> 30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31> 31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32> 32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33> 33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34> 34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35> 35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36> 36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37> 37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38> 38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39> 39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40> 40</a>
</span><span class=lnt id=hl-23-41><a class=lnlinks href=#hl-23-41> 41</a>
</span><span class=lnt id=hl-23-42><a class=lnlinks href=#hl-23-42> 42</a>
</span><span class=lnt id=hl-23-43><a class=lnlinks href=#hl-23-43> 43</a>
</span><span class=lnt id=hl-23-44><a class=lnlinks href=#hl-23-44> 44</a>
</span><span class=lnt id=hl-23-45><a class=lnlinks href=#hl-23-45> 45</a>
</span><span class=lnt id=hl-23-46><a class=lnlinks href=#hl-23-46> 46</a>
</span><span class=lnt id=hl-23-47><a class=lnlinks href=#hl-23-47> 47</a>
</span><span class=lnt id=hl-23-48><a class=lnlinks href=#hl-23-48> 48</a>
</span><span class=lnt id=hl-23-49><a class=lnlinks href=#hl-23-49> 49</a>
</span><span class=lnt id=hl-23-50><a class=lnlinks href=#hl-23-50> 50</a>
</span><span class=lnt id=hl-23-51><a class=lnlinks href=#hl-23-51> 51</a>
</span><span class=lnt id=hl-23-52><a class=lnlinks href=#hl-23-52> 52</a>
</span><span class=lnt id=hl-23-53><a class=lnlinks href=#hl-23-53> 53</a>
</span><span class=lnt id=hl-23-54><a class=lnlinks href=#hl-23-54> 54</a>
</span><span class=lnt id=hl-23-55><a class=lnlinks href=#hl-23-55> 55</a>
</span><span class=lnt id=hl-23-56><a class=lnlinks href=#hl-23-56> 56</a>
</span><span class=lnt id=hl-23-57><a class=lnlinks href=#hl-23-57> 57</a>
</span><span class=lnt id=hl-23-58><a class=lnlinks href=#hl-23-58> 58</a>
</span><span class=lnt id=hl-23-59><a class=lnlinks href=#hl-23-59> 59</a>
</span><span class=lnt id=hl-23-60><a class=lnlinks href=#hl-23-60> 60</a>
</span><span class=lnt id=hl-23-61><a class=lnlinks href=#hl-23-61> 61</a>
</span><span class=lnt id=hl-23-62><a class=lnlinks href=#hl-23-62> 62</a>
</span><span class=lnt id=hl-23-63><a class=lnlinks href=#hl-23-63> 63</a>
</span><span class=lnt id=hl-23-64><a class=lnlinks href=#hl-23-64> 64</a>
</span><span class=lnt id=hl-23-65><a class=lnlinks href=#hl-23-65> 65</a>
</span><span class=lnt id=hl-23-66><a class=lnlinks href=#hl-23-66> 66</a>
</span><span class=lnt id=hl-23-67><a class=lnlinks href=#hl-23-67> 67</a>
</span><span class=lnt id=hl-23-68><a class=lnlinks href=#hl-23-68> 68</a>
</span><span class=lnt id=hl-23-69><a class=lnlinks href=#hl-23-69> 69</a>
</span><span class=lnt id=hl-23-70><a class=lnlinks href=#hl-23-70> 70</a>
</span><span class=lnt id=hl-23-71><a class=lnlinks href=#hl-23-71> 71</a>
</span><span class=lnt id=hl-23-72><a class=lnlinks href=#hl-23-72> 72</a>
</span><span class=lnt id=hl-23-73><a class=lnlinks href=#hl-23-73> 73</a>
</span><span class=lnt id=hl-23-74><a class=lnlinks href=#hl-23-74> 74</a>
</span><span class=lnt id=hl-23-75><a class=lnlinks href=#hl-23-75> 75</a>
</span><span class=lnt id=hl-23-76><a class=lnlinks href=#hl-23-76> 76</a>
</span><span class=lnt id=hl-23-77><a class=lnlinks href=#hl-23-77> 77</a>
</span><span class=lnt id=hl-23-78><a class=lnlinks href=#hl-23-78> 78</a>
</span><span class=lnt id=hl-23-79><a class=lnlinks href=#hl-23-79> 79</a>
</span><span class=lnt id=hl-23-80><a class=lnlinks href=#hl-23-80> 80</a>
</span><span class=lnt id=hl-23-81><a class=lnlinks href=#hl-23-81> 81</a>
</span><span class=lnt id=hl-23-82><a class=lnlinks href=#hl-23-82> 82</a>
</span><span class=lnt id=hl-23-83><a class=lnlinks href=#hl-23-83> 83</a>
</span><span class=lnt id=hl-23-84><a class=lnlinks href=#hl-23-84> 84</a>
</span><span class=lnt id=hl-23-85><a class=lnlinks href=#hl-23-85> 85</a>
</span><span class=lnt id=hl-23-86><a class=lnlinks href=#hl-23-86> 86</a>
</span><span class=lnt id=hl-23-87><a class=lnlinks href=#hl-23-87> 87</a>
</span><span class=lnt id=hl-23-88><a class=lnlinks href=#hl-23-88> 88</a>
</span><span class=lnt id=hl-23-89><a class=lnlinks href=#hl-23-89> 89</a>
</span><span class=lnt id=hl-23-90><a class=lnlinks href=#hl-23-90> 90</a>
</span><span class=lnt id=hl-23-91><a class=lnlinks href=#hl-23-91> 91</a>
</span><span class=lnt id=hl-23-92><a class=lnlinks href=#hl-23-92> 92</a>
</span><span class=lnt id=hl-23-93><a class=lnlinks href=#hl-23-93> 93</a>
</span><span class=lnt id=hl-23-94><a class=lnlinks href=#hl-23-94> 94</a>
</span><span class=lnt id=hl-23-95><a class=lnlinks href=#hl-23-95> 95</a>
</span><span class=lnt id=hl-23-96><a class=lnlinks href=#hl-23-96> 96</a>
</span><span class=lnt id=hl-23-97><a class=lnlinks href=#hl-23-97> 97</a>
</span><span class=lnt id=hl-23-98><a class=lnlinks href=#hl-23-98> 98</a>
</span><span class=lnt id=hl-23-99><a class=lnlinks href=#hl-23-99> 99</a>
</span><span class=lnt id=hl-23-100><a class=lnlinks href=#hl-23-100>100</a>
</span><span class=lnt id=hl-23-101><a class=lnlinks href=#hl-23-101>101</a>
</span><span class=lnt id=hl-23-102><a class=lnlinks href=#hl-23-102>102</a>
</span><span class=lnt id=hl-23-103><a class=lnlinks href=#hl-23-103>103</a>
</span><span class=lnt id=hl-23-104><a class=lnlinks href=#hl-23-104>104</a>
</span><span class=lnt id=hl-23-105><a class=lnlinks href=#hl-23-105>105</a>
</span><span class=lnt id=hl-23-106><a class=lnlinks href=#hl-23-106>106</a>
</span><span class=lnt id=hl-23-107><a class=lnlinks href=#hl-23-107>107</a>
</span><span class=lnt id=hl-23-108><a class=lnlinks href=#hl-23-108>108</a>
</span><span class=lnt id=hl-23-109><a class=lnlinks href=#hl-23-109>109</a>
</span><span class=lnt id=hl-23-110><a class=lnlinks href=#hl-23-110>110</a>
</span><span class=lnt id=hl-23-111><a class=lnlinks href=#hl-23-111>111</a>
</span><span class=lnt id=hl-23-112><a class=lnlinks href=#hl-23-112>112</a>
</span><span class=lnt id=hl-23-113><a class=lnlinks href=#hl-23-113>113</a>
</span><span class=lnt id=hl-23-114><a class=lnlinks href=#hl-23-114>114</a>
</span><span class=lnt id=hl-23-115><a class=lnlinks href=#hl-23-115>115</a>
</span><span class=lnt id=hl-23-116><a class=lnlinks href=#hl-23-116>116</a>
</span><span class=lnt id=hl-23-117><a class=lnlinks href=#hl-23-117>117</a>
</span><span class=lnt id=hl-23-118><a class=lnlinks href=#hl-23-118>118</a>
</span><span class=lnt id=hl-23-119><a class=lnlinks href=#hl-23-119>119</a>
</span><span class=lnt id=hl-23-120><a class=lnlinks href=#hl-23-120>120</a>
</span><span class=lnt id=hl-23-121><a class=lnlinks href=#hl-23-121>121</a>
</span><span class=lnt id=hl-23-122><a class=lnlinks href=#hl-23-122>122</a>
</span><span class=lnt id=hl-23-123><a class=lnlinks href=#hl-23-123>123</a>
</span><span class=lnt id=hl-23-124><a class=lnlinks href=#hl-23-124>124</a>
</span><span class=lnt id=hl-23-125><a class=lnlinks href=#hl-23-125>125</a>
</span><span class=lnt id=hl-23-126><a class=lnlinks href=#hl-23-126>126</a>
</span><span class=lnt id=hl-23-127><a class=lnlinks href=#hl-23-127>127</a>
</span><span class=lnt id=hl-23-128><a class=lnlinks href=#hl-23-128>128</a>
</span><span class=lnt id=hl-23-129><a class=lnlinks href=#hl-23-129>129</a>
</span><span class=lnt id=hl-23-130><a class=lnlinks href=#hl-23-130>130</a>
</span><span class=lnt id=hl-23-131><a class=lnlinks href=#hl-23-131>131</a>
</span><span class=lnt id=hl-23-132><a class=lnlinks href=#hl-23-132>132</a>
</span><span class=lnt id=hl-23-133><a class=lnlinks href=#hl-23-133>133</a>
</span><span class=lnt id=hl-23-134><a class=lnlinks href=#hl-23-134>134</a>
</span><span class=lnt id=hl-23-135><a class=lnlinks href=#hl-23-135>135</a>
</span><span class=lnt id=hl-23-136><a class=lnlinks href=#hl-23-136>136</a>
</span><span class=lnt id=hl-23-137><a class=lnlinks href=#hl-23-137>137</a>
</span><span class=lnt id=hl-23-138><a class=lnlinks href=#hl-23-138>138</a>
</span><span class=lnt id=hl-23-139><a class=lnlinks href=#hl-23-139>139</a>
</span><span class=lnt id=hl-23-140><a class=lnlinks href=#hl-23-140>140</a>
</span><span class=lnt id=hl-23-141><a class=lnlinks href=#hl-23-141>141</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aiohttp</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aiofiles</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CrawlResult</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;크롤링 결과를 담는 데이터 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>status_code</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>content_length</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>error</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AsyncWebCrawler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;비동기 웹 크롤러 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span> <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>max_workers</span> <span class=o>=</span> <span class=n>max_workers</span>  <span class=c1># 동시 처리 워커 수 제한</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>max_retries</span> <span class=o>=</span> <span class=n>max_retries</span>  <span class=c1># 최대 재시도 횟수</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>session</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=fm>__aenter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;비동기 컨텍스트 매니저 진입&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>session</span> <span class=o>=</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=fm>__aexit__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exc_type</span><span class=p>,</span> <span class=n>exc_val</span><span class=p>,</span> <span class=n>exc_tb</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;비동기 컨텍스트 매니저 종료 - 자원 정리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>fetch_url</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>semaphore</span><span class=p>:</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>CrawlResult</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;단일 URL을 비동기로 크롤링&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=n>semaphore</span><span class=p>:</span>  <span class=c1># 동시 연결 수 제한</span>
</span></span><span class=line><span class=cl>            <span class=n>retries</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=n>retries</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_retries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 비동기 HTTP 요청 - 여기서 다른 작업들이 대기하지 않고 진행</span>
</span></span><span class=line><span class=cl>                    <span class=k>async</span> <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>content</span> <span class=o>=</span> <span class=k>await</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=c1># 간단한 제목 추출 (실제로는 BeautifulSoup 등 사용)</span>
</span></span><span class=line><span class=cl>                        <span class=n>title</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=s1>&#39;&lt;title&gt;&#39;</span> <span class=ow>in</span> <span class=n>content</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=n>start</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s1>&#39;&lt;title&gt;&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl>                            <span class=n>end</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s1>&#39;&lt;/title&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=n>title</span> <span class=o>=</span> <span class=n>content</span><span class=p>[</span><span class=n>start</span><span class=p>:</span><span class=n>end</span><span class=p>]</span> <span class=k>if</span> <span class=n>end</span> <span class=o>&gt;</span> <span class=n>start</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=n>CrawlResult</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>status_code</span><span class=o>=</span><span class=n>response</span><span class=o>.</span><span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>content_length</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                            <span class=n>title</span><span class=o>=</span><span class=n>title</span>
</span></span><span class=line><span class=cl>                        <span class=p>)</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>retries</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>retries</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_retries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 최대 재시도 횟수 초과 시 에러 결과 반환</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=n>CrawlResult</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>status_code</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>content_length</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 재시도 전 잠시 대기 (지수 백오프)</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>retries</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>crawl_urls</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>urls</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>CrawlResult</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;여러 URL을 병렬로 크롤링&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 동시 연결 수를 제한하는 세마포어</span>
</span></span><span class=line><span class=cl>        <span class=n>semaphore</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>max_workers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모든 URL에 대해 비동기 태스크 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>fetch_url</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>semaphore</span><span class=p>)</span> <span class=k>for</span> <span class=n>url</span> <span class=ow>in</span> <span class=n>urls</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모든 태스크를 병렬로 실행하고 결과 수집</span>
</span></span><span class=line><span class=cl>        <span class=c1># asyncio.gather는 모든 작업이 완료될 때까지 대기</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>,</span> <span class=n>return_exceptions</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 예외 처리 결과 변환</span>
</span></span><span class=line><span class=cl>        <span class=n>processed_results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>results</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=ne>Exception</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>processed_results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>CrawlResult</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>url</span><span class=o>=</span><span class=n>urls</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=n>status_code</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>content_length</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>error</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>processed_results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>processed_results</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>save_results</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>results</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>CrawlResult</span><span class=p>],</span> <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결과를 비동기로 파일에 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=n>aiofiles</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;URL,Status,Length,Title,Error</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>line</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>url</span><span class=si>}</span><span class=s2>,</span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>,</span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>content_length</span><span class=si>}</span><span class=s2>,&#34;</span> \
</span></span><span class=line><span class=cl>                       <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>title</span> <span class=ow>or</span> <span class=s1>&#39;&#39;</span><span class=si>}</span><span class=s2>,</span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>error</span> <span class=ow>or</span> <span class=s1>&#39;&#39;</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=c1># 파일 I/O도 비동기로 처리하여 블로킹 방지</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;메인 실행 함수&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>urls</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/2&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/3&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/status/200&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/status/404&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 비동기 컨텍스트 매니저로 크롤러 실행</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>AsyncWebCrawler</span><span class=p>(</span><span class=n>max_workers</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span> <span class=k>as</span> <span class=n>crawler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;크롤링 시작: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>urls</span><span class=p>)</span><span class=si>}</span><span class=s2>개 URL 처리&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모든 URL을 병렬로 크롤링</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>crawler</span><span class=o>.</span><span class=n>crawl_urls</span><span class=p>(</span><span class=n>urls</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 결과를 비동기로 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>crawler</span><span class=o>.</span><span class=n>save_results</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=s1>&#39;crawl_results.csv&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>end_time</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 결과 출력</span>
</span></span><span class=line><span class=cl>        <span class=n>successful</span> <span class=o>=</span> <span class=nb>len</span><span class=p>([</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>results</span> <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>error</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;완료: </span><span class=si>{</span><span class=n>successful</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>urls</span><span class=p>)</span><span class=si>}</span><span class=s2> 성공&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;소요 시간: </span><span class=si>{</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>초&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;비동기 처리로 동시에 여러 요청을 처리하여 전체 시간 단축&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 이벤트 루프 실행</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=실제-도입-사례의-코드-구현>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현>#</a></h4><h5 id=실시간-메시징-시스템>실시간 메시징 시스템<a hidden class=anchor aria-hidden=true href=#실시간-메시징-시스템>#</a></h5><p><strong>비즈니스 배경</strong>: 수백만 사용자가 동시에 채팅하는 실시간 메시징 플랫폼에서 메시지 전달 지연 최소화 및 서버 자원 효율성 달성</p><p><strong>기술적 요구사항</strong>:</p><ul><li>실시간 양방향 통신 (WebSocket)</li><li>메시지 라우팅 및 브로드캐스팅</li><li>수평적 확장 가능한 아키텍처</li><li>메시지 순서 보장</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>WebSocket 게이트웨이 서버 (Node.js)</li><li>메시지 브로커 (Redis Pub/Sub)</li><li>사용자 세션 관리자</li><li>메시지 라우터</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;클라이언트&#34;
        A[Discord Client 1]
        B[Discord Client 2]
        C[Discord Client N]
    end
    
    subgraph &#34;게이트웨이 레이어&#34;
        D[WebSocket Gateway 1]
        E[WebSocket Gateway 2]
        F[WebSocket Gateway N]
    end
    
    subgraph &#34;메시징 레이어&#34;
        G[Redis Pub/Sub]
        H[Message Router]
        I[Session Manager]
    end
    
    A --&gt; D
    B --&gt; E
    C --&gt; F
    
    D --&gt; G
    E --&gt; G
    F --&gt; G
    
    G --&gt; H
    H --&gt; I
</pre><p><strong>Workflow</strong>:</p><ol><li>클라이언트가 WebSocket 으로 게이트웨이에 연결</li><li>사용자 세션 정보를 Redis 에 등록</li><li>메시지 수신 시 Redis Pub/Sub 으로 라우팅</li><li>해당 채널 구독자들에게 실시간 브로드캐스트</li><li>연결이 끊어진 사용자는 자동으로 세션 정리</li></ol><p><strong>핵심 역할</strong>:</p><ul><li><strong>비동기 WebSocket</strong>: 수천 개의 동시 연결 처리</li><li><strong>이벤트 기반 라우팅</strong>: 메시지를 실시간으로 적절한 수신자에게 전달</li><li><strong>논블로킹 I/O</strong>: Redis 통신 중에도 다른 연결 처리 계속</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 동기 방식으로 1000 명 동시 접속 시 서버 과부하</li><li>도입 후: 비동기 방식으로 10 만명 동시 접속 가능, 메시지 지연 50ms 이하</li></ul><p><strong>구현 예시</strong> (Node.js):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>  1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2>  2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3>  3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4>  4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5>  5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6>  6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7>  7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8>  8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9>  9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10> 10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11> 11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12> 12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13> 13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14> 14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15> 15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16> 16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17> 17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18> 18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19> 19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20> 20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21> 21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22> 22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23> 23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24> 24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25> 25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26> 26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27> 27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28> 28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29> 29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30> 30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31> 31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32> 32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33> 33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34> 34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35> 35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36> 36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37> 37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38> 38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39> 39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40> 40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41> 41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42> 42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43> 43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44> 44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45> 45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46> 46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47> 47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48> 48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49> 49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50> 50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51> 51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52> 52</a>
</span><span class=lnt id=hl-25-53><a class=lnlinks href=#hl-25-53> 53</a>
</span><span class=lnt id=hl-25-54><a class=lnlinks href=#hl-25-54> 54</a>
</span><span class=lnt id=hl-25-55><a class=lnlinks href=#hl-25-55> 55</a>
</span><span class=lnt id=hl-25-56><a class=lnlinks href=#hl-25-56> 56</a>
</span><span class=lnt id=hl-25-57><a class=lnlinks href=#hl-25-57> 57</a>
</span><span class=lnt id=hl-25-58><a class=lnlinks href=#hl-25-58> 58</a>
</span><span class=lnt id=hl-25-59><a class=lnlinks href=#hl-25-59> 59</a>
</span><span class=lnt id=hl-25-60><a class=lnlinks href=#hl-25-60> 60</a>
</span><span class=lnt id=hl-25-61><a class=lnlinks href=#hl-25-61> 61</a>
</span><span class=lnt id=hl-25-62><a class=lnlinks href=#hl-25-62> 62</a>
</span><span class=lnt id=hl-25-63><a class=lnlinks href=#hl-25-63> 63</a>
</span><span class=lnt id=hl-25-64><a class=lnlinks href=#hl-25-64> 64</a>
</span><span class=lnt id=hl-25-65><a class=lnlinks href=#hl-25-65> 65</a>
</span><span class=lnt id=hl-25-66><a class=lnlinks href=#hl-25-66> 66</a>
</span><span class=lnt id=hl-25-67><a class=lnlinks href=#hl-25-67> 67</a>
</span><span class=lnt id=hl-25-68><a class=lnlinks href=#hl-25-68> 68</a>
</span><span class=lnt id=hl-25-69><a class=lnlinks href=#hl-25-69> 69</a>
</span><span class=lnt id=hl-25-70><a class=lnlinks href=#hl-25-70> 70</a>
</span><span class=lnt id=hl-25-71><a class=lnlinks href=#hl-25-71> 71</a>
</span><span class=lnt id=hl-25-72><a class=lnlinks href=#hl-25-72> 72</a>
</span><span class=lnt id=hl-25-73><a class=lnlinks href=#hl-25-73> 73</a>
</span><span class=lnt id=hl-25-74><a class=lnlinks href=#hl-25-74> 74</a>
</span><span class=lnt id=hl-25-75><a class=lnlinks href=#hl-25-75> 75</a>
</span><span class=lnt id=hl-25-76><a class=lnlinks href=#hl-25-76> 76</a>
</span><span class=lnt id=hl-25-77><a class=lnlinks href=#hl-25-77> 77</a>
</span><span class=lnt id=hl-25-78><a class=lnlinks href=#hl-25-78> 78</a>
</span><span class=lnt id=hl-25-79><a class=lnlinks href=#hl-25-79> 79</a>
</span><span class=lnt id=hl-25-80><a class=lnlinks href=#hl-25-80> 80</a>
</span><span class=lnt id=hl-25-81><a class=lnlinks href=#hl-25-81> 81</a>
</span><span class=lnt id=hl-25-82><a class=lnlinks href=#hl-25-82> 82</a>
</span><span class=lnt id=hl-25-83><a class=lnlinks href=#hl-25-83> 83</a>
</span><span class=lnt id=hl-25-84><a class=lnlinks href=#hl-25-84> 84</a>
</span><span class=lnt id=hl-25-85><a class=lnlinks href=#hl-25-85> 85</a>
</span><span class=lnt id=hl-25-86><a class=lnlinks href=#hl-25-86> 86</a>
</span><span class=lnt id=hl-25-87><a class=lnlinks href=#hl-25-87> 87</a>
</span><span class=lnt id=hl-25-88><a class=lnlinks href=#hl-25-88> 88</a>
</span><span class=lnt id=hl-25-89><a class=lnlinks href=#hl-25-89> 89</a>
</span><span class=lnt id=hl-25-90><a class=lnlinks href=#hl-25-90> 90</a>
</span><span class=lnt id=hl-25-91><a class=lnlinks href=#hl-25-91> 91</a>
</span><span class=lnt id=hl-25-92><a class=lnlinks href=#hl-25-92> 92</a>
</span><span class=lnt id=hl-25-93><a class=lnlinks href=#hl-25-93> 93</a>
</span><span class=lnt id=hl-25-94><a class=lnlinks href=#hl-25-94> 94</a>
</span><span class=lnt id=hl-25-95><a class=lnlinks href=#hl-25-95> 95</a>
</span><span class=lnt id=hl-25-96><a class=lnlinks href=#hl-25-96> 96</a>
</span><span class=lnt id=hl-25-97><a class=lnlinks href=#hl-25-97> 97</a>
</span><span class=lnt id=hl-25-98><a class=lnlinks href=#hl-25-98> 98</a>
</span><span class=lnt id=hl-25-99><a class=lnlinks href=#hl-25-99> 99</a>
</span><span class=lnt id=hl-25-100><a class=lnlinks href=#hl-25-100>100</a>
</span><span class=lnt id=hl-25-101><a class=lnlinks href=#hl-25-101>101</a>
</span><span class=lnt id=hl-25-102><a class=lnlinks href=#hl-25-102>102</a>
</span><span class=lnt id=hl-25-103><a class=lnlinks href=#hl-25-103>103</a>
</span><span class=lnt id=hl-25-104><a class=lnlinks href=#hl-25-104>104</a>
</span><span class=lnt id=hl-25-105><a class=lnlinks href=#hl-25-105>105</a>
</span><span class=lnt id=hl-25-106><a class=lnlinks href=#hl-25-106>106</a>
</span><span class=lnt id=hl-25-107><a class=lnlinks href=#hl-25-107>107</a>
</span><span class=lnt id=hl-25-108><a class=lnlinks href=#hl-25-108>108</a>
</span><span class=lnt id=hl-25-109><a class=lnlinks href=#hl-25-109>109</a>
</span><span class=lnt id=hl-25-110><a class=lnlinks href=#hl-25-110>110</a>
</span><span class=lnt id=hl-25-111><a class=lnlinks href=#hl-25-111>111</a>
</span><span class=lnt id=hl-25-112><a class=lnlinks href=#hl-25-112>112</a>
</span><span class=lnt id=hl-25-113><a class=lnlinks href=#hl-25-113>113</a>
</span><span class=lnt id=hl-25-114><a class=lnlinks href=#hl-25-114>114</a>
</span><span class=lnt id=hl-25-115><a class=lnlinks href=#hl-25-115>115</a>
</span><span class=lnt id=hl-25-116><a class=lnlinks href=#hl-25-116>116</a>
</span><span class=lnt id=hl-25-117><a class=lnlinks href=#hl-25-117>117</a>
</span><span class=lnt id=hl-25-118><a class=lnlinks href=#hl-25-118>118</a>
</span><span class=lnt id=hl-25-119><a class=lnlinks href=#hl-25-119>119</a>
</span><span class=lnt id=hl-25-120><a class=lnlinks href=#hl-25-120>120</a>
</span><span class=lnt id=hl-25-121><a class=lnlinks href=#hl-25-121>121</a>
</span><span class=lnt id=hl-25-122><a class=lnlinks href=#hl-25-122>122</a>
</span><span class=lnt id=hl-25-123><a class=lnlinks href=#hl-25-123>123</a>
</span><span class=lnt id=hl-25-124><a class=lnlinks href=#hl-25-124>124</a>
</span><span class=lnt id=hl-25-125><a class=lnlinks href=#hl-25-125>125</a>
</span><span class=lnt id=hl-25-126><a class=lnlinks href=#hl-25-126>126</a>
</span><span class=lnt id=hl-25-127><a class=lnlinks href=#hl-25-127>127</a>
</span><span class=lnt id=hl-25-128><a class=lnlinks href=#hl-25-128>128</a>
</span><span class=lnt id=hl-25-129><a class=lnlinks href=#hl-25-129>129</a>
</span><span class=lnt id=hl-25-130><a class=lnlinks href=#hl-25-130>130</a>
</span><span class=lnt id=hl-25-131><a class=lnlinks href=#hl-25-131>131</a>
</span><span class=lnt id=hl-25-132><a class=lnlinks href=#hl-25-132>132</a>
</span><span class=lnt id=hl-25-133><a class=lnlinks href=#hl-25-133>133</a>
</span><span class=lnt id=hl-25-134><a class=lnlinks href=#hl-25-134>134</a>
</span><span class=lnt id=hl-25-135><a class=lnlinks href=#hl-25-135>135</a>
</span><span class=lnt id=hl-25-136><a class=lnlinks href=#hl-25-136>136</a>
</span><span class=lnt id=hl-25-137><a class=lnlinks href=#hl-25-137>137</a>
</span><span class=lnt id=hl-25-138><a class=lnlinks href=#hl-25-138>138</a>
</span><span class=lnt id=hl-25-139><a class=lnlinks href=#hl-25-139>139</a>
</span><span class=lnt id=hl-25-140><a class=lnlinks href=#hl-25-140>140</a>
</span><span class=lnt id=hl-25-141><a class=lnlinks href=#hl-25-141>141</a>
</span><span class=lnt id=hl-25-142><a class=lnlinks href=#hl-25-142>142</a>
</span><span class=lnt id=hl-25-143><a class=lnlinks href=#hl-25-143>143</a>
</span><span class=lnt id=hl-25-144><a class=lnlinks href=#hl-25-144>144</a>
</span><span class=lnt id=hl-25-145><a class=lnlinks href=#hl-25-145>145</a>
</span><span class=lnt id=hl-25-146><a class=lnlinks href=#hl-25-146>146</a>
</span><span class=lnt id=hl-25-147><a class=lnlinks href=#hl-25-147>147</a>
</span><span class=lnt id=hl-25-148><a class=lnlinks href=#hl-25-148>148</a>
</span><span class=lnt id=hl-25-149><a class=lnlinks href=#hl-25-149>149</a>
</span><span class=lnt id=hl-25-150><a class=lnlinks href=#hl-25-150>150</a>
</span><span class=lnt id=hl-25-151><a class=lnlinks href=#hl-25-151>151</a>
</span><span class=lnt id=hl-25-152><a class=lnlinks href=#hl-25-152>152</a>
</span><span class=lnt id=hl-25-153><a class=lnlinks href=#hl-25-153>153</a>
</span><span class=lnt id=hl-25-154><a class=lnlinks href=#hl-25-154>154</a>
</span><span class=lnt id=hl-25-155><a class=lnlinks href=#hl-25-155>155</a>
</span><span class=lnt id=hl-25-156><a class=lnlinks href=#hl-25-156>156</a>
</span><span class=lnt id=hl-25-157><a class=lnlinks href=#hl-25-157>157</a>
</span><span class=lnt id=hl-25-158><a class=lnlinks href=#hl-25-158>158</a>
</span><span class=lnt id=hl-25-159><a class=lnlinks href=#hl-25-159>159</a>
</span><span class=lnt id=hl-25-160><a class=lnlinks href=#hl-25-160>160</a>
</span><span class=lnt id=hl-25-161><a class=lnlinks href=#hl-25-161>161</a>
</span><span class=lnt id=hl-25-162><a class=lnlinks href=#hl-25-162>162</a>
</span><span class=lnt id=hl-25-163><a class=lnlinks href=#hl-25-163>163</a>
</span><span class=lnt id=hl-25-164><a class=lnlinks href=#hl-25-164>164</a>
</span><span class=lnt id=hl-25-165><a class=lnlinks href=#hl-25-165>165</a>
</span><span class=lnt id=hl-25-166><a class=lnlinks href=#hl-25-166>166</a>
</span><span class=lnt id=hl-25-167><a class=lnlinks href=#hl-25-167>167</a>
</span><span class=lnt id=hl-25-168><a class=lnlinks href=#hl-25-168>168</a>
</span><span class=lnt id=hl-25-169><a class=lnlinks href=#hl-25-169>169</a>
</span><span class=lnt id=hl-25-170><a class=lnlinks href=#hl-25-170>170</a>
</span><span class=lnt id=hl-25-171><a class=lnlinks href=#hl-25-171>171</a>
</span><span class=lnt id=hl-25-172><a class=lnlinks href=#hl-25-172>172</a>
</span><span class=lnt id=hl-25-173><a class=lnlinks href=#hl-25-173>173</a>
</span><span class=lnt id=hl-25-174><a class=lnlinks href=#hl-25-174>174</a>
</span><span class=lnt id=hl-25-175><a class=lnlinks href=#hl-25-175>175</a>
</span><span class=lnt id=hl-25-176><a class=lnlinks href=#hl-25-176>176</a>
</span><span class=lnt id=hl-25-177><a class=lnlinks href=#hl-25-177>177</a>
</span><span class=lnt id=hl-25-178><a class=lnlinks href=#hl-25-178>178</a>
</span><span class=lnt id=hl-25-179><a class=lnlinks href=#hl-25-179>179</a>
</span><span class=lnt id=hl-25-180><a class=lnlinks href=#hl-25-180>180</a>
</span><span class=lnt id=hl-25-181><a class=lnlinks href=#hl-25-181>181</a>
</span><span class=lnt id=hl-25-182><a class=lnlinks href=#hl-25-182>182</a>
</span><span class=lnt id=hl-25-183><a class=lnlinks href=#hl-25-183>183</a>
</span><span class=lnt id=hl-25-184><a class=lnlinks href=#hl-25-184>184</a>
</span><span class=lnt id=hl-25-185><a class=lnlinks href=#hl-25-185>185</a>
</span><span class=lnt id=hl-25-186><a class=lnlinks href=#hl-25-186>186</a>
</span><span class=lnt id=hl-25-187><a class=lnlinks href=#hl-25-187>187</a>
</span><span class=lnt id=hl-25-188><a class=lnlinks href=#hl-25-188>188</a>
</span><span class=lnt id=hl-25-189><a class=lnlinks href=#hl-25-189>189</a>
</span><span class=lnt id=hl-25-190><a class=lnlinks href=#hl-25-190>190</a>
</span><span class=lnt id=hl-25-191><a class=lnlinks href=#hl-25-191>191</a>
</span><span class=lnt id=hl-25-192><a class=lnlinks href=#hl-25-192>192</a>
</span><span class=lnt id=hl-25-193><a class=lnlinks href=#hl-25-193>193</a>
</span><span class=lnt id=hl-25-194><a class=lnlinks href=#hl-25-194>194</a>
</span><span class=lnt id=hl-25-195><a class=lnlinks href=#hl-25-195>195</a>
</span><span class=lnt id=hl-25-196><a class=lnlinks href=#hl-25-196>196</a>
</span><span class=lnt id=hl-25-197><a class=lnlinks href=#hl-25-197>197</a>
</span><span class=lnt id=hl-25-198><a class=lnlinks href=#hl-25-198>198</a>
</span><span class=lnt id=hl-25-199><a class=lnlinks href=#hl-25-199>199</a>
</span><span class=lnt id=hl-25-200><a class=lnlinks href=#hl-25-200>200</a>
</span><span class=lnt id=hl-25-201><a class=lnlinks href=#hl-25-201>201</a>
</span><span class=lnt id=hl-25-202><a class=lnlinks href=#hl-25-202>202</a>
</span><span class=lnt id=hl-25-203><a class=lnlinks href=#hl-25-203>203</a>
</span><span class=lnt id=hl-25-204><a class=lnlinks href=#hl-25-204>204</a>
</span><span class=lnt id=hl-25-205><a class=lnlinks href=#hl-25-205>205</a>
</span><span class=lnt id=hl-25-206><a class=lnlinks href=#hl-25-206>206</a>
</span><span class=lnt id=hl-25-207><a class=lnlinks href=#hl-25-207>207</a>
</span><span class=lnt id=hl-25-208><a class=lnlinks href=#hl-25-208>208</a>
</span><span class=lnt id=hl-25-209><a class=lnlinks href=#hl-25-209>209</a>
</span><span class=lnt id=hl-25-210><a class=lnlinks href=#hl-25-210>210</a>
</span><span class=lnt id=hl-25-211><a class=lnlinks href=#hl-25-211>211</a>
</span><span class=lnt id=hl-25-212><a class=lnlinks href=#hl-25-212>212</a>
</span><span class=lnt id=hl-25-213><a class=lnlinks href=#hl-25-213>213</a>
</span><span class=lnt id=hl-25-214><a class=lnlinks href=#hl-25-214>214</a>
</span><span class=lnt id=hl-25-215><a class=lnlinks href=#hl-25-215>215</a>
</span><span class=lnt id=hl-25-216><a class=lnlinks href=#hl-25-216>216</a>
</span><span class=lnt id=hl-25-217><a class=lnlinks href=#hl-25-217>217</a>
</span><span class=lnt id=hl-25-218><a class=lnlinks href=#hl-25-218>218</a>
</span><span class=lnt id=hl-25-219><a class=lnlinks href=#hl-25-219>219</a>
</span><span class=lnt id=hl-25-220><a class=lnlinks href=#hl-25-220>220</a>
</span><span class=lnt id=hl-25-221><a class=lnlinks href=#hl-25-221>221</a>
</span><span class=lnt id=hl-25-222><a class=lnlinks href=#hl-25-222>222</a>
</span><span class=lnt id=hl-25-223><a class=lnlinks href=#hl-25-223>223</a>
</span><span class=lnt id=hl-25-224><a class=lnlinks href=#hl-25-224>224</a>
</span><span class=lnt id=hl-25-225><a class=lnlinks href=#hl-25-225>225</a>
</span><span class=lnt id=hl-25-226><a class=lnlinks href=#hl-25-226>226</a>
</span><span class=lnt id=hl-25-227><a class=lnlinks href=#hl-25-227>227</a>
</span><span class=lnt id=hl-25-228><a class=lnlinks href=#hl-25-228>228</a>
</span><span class=lnt id=hl-25-229><a class=lnlinks href=#hl-25-229>229</a>
</span><span class=lnt id=hl-25-230><a class=lnlinks href=#hl-25-230>230</a>
</span><span class=lnt id=hl-25-231><a class=lnlinks href=#hl-25-231>231</a>
</span><span class=lnt id=hl-25-232><a class=lnlinks href=#hl-25-232>232</a>
</span><span class=lnt id=hl-25-233><a class=lnlinks href=#hl-25-233>233</a>
</span><span class=lnt id=hl-25-234><a class=lnlinks href=#hl-25-234>234</a>
</span><span class=lnt id=hl-25-235><a class=lnlinks href=#hl-25-235>235</a>
</span><span class=lnt id=hl-25-236><a class=lnlinks href=#hl-25-236>236</a>
</span><span class=lnt id=hl-25-237><a class=lnlinks href=#hl-25-237>237</a>
</span><span class=lnt id=hl-25-238><a class=lnlinks href=#hl-25-238>238</a>
</span><span class=lnt id=hl-25-239><a class=lnlinks href=#hl-25-239>239</a>
</span><span class=lnt id=hl-25-240><a class=lnlinks href=#hl-25-240>240</a>
</span><span class=lnt id=hl-25-241><a class=lnlinks href=#hl-25-241>241</a>
</span><span class=lnt id=hl-25-242><a class=lnlinks href=#hl-25-242>242</a>
</span><span class=lnt id=hl-25-243><a class=lnlinks href=#hl-25-243>243</a>
</span><span class=lnt id=hl-25-244><a class=lnlinks href=#hl-25-244>244</a>
</span><span class=lnt id=hl-25-245><a class=lnlinks href=#hl-25-245>245</a>
</span><span class=lnt id=hl-25-246><a class=lnlinks href=#hl-25-246>246</a>
</span><span class=lnt id=hl-25-247><a class=lnlinks href=#hl-25-247>247</a>
</span><span class=lnt id=hl-25-248><a class=lnlinks href=#hl-25-248>248</a>
</span><span class=lnt id=hl-25-249><a class=lnlinks href=#hl-25-249>249</a>
</span><span class=lnt id=hl-25-250><a class=lnlinks href=#hl-25-250>250</a>
</span><span class=lnt id=hl-25-251><a class=lnlinks href=#hl-25-251>251</a>
</span><span class=lnt id=hl-25-252><a class=lnlinks href=#hl-25-252>252</a>
</span><span class=lnt id=hl-25-253><a class=lnlinks href=#hl-25-253>253</a>
</span><span class=lnt id=hl-25-254><a class=lnlinks href=#hl-25-254>254</a>
</span><span class=lnt id=hl-25-255><a class=lnlinks href=#hl-25-255>255</a>
</span><span class=lnt id=hl-25-256><a class=lnlinks href=#hl-25-256>256</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>WebSocket</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;ws&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Redis</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;redis&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>http</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DiscordMessageGateway</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>server</span> <span class=o>=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>wss</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WebSocket</span><span class=p>.</span><span class=nx>Server</span><span class=p>({</span> <span class=nx>server</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>server</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Redis 클라이언트 설정 (Publisher와 Subscriber 분리)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>publisher</span> <span class=o>=</span> <span class=nx>Redis</span><span class=p>.</span><span class=nx>createClient</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>subscriber</span> <span class=o>=</span> <span class=nx>Redis</span><span class=p>.</span><span class=nx>createClient</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 사용자 세션 관리 (connection_id -&gt; user_info)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>sessions</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 채널별 구독자 관리 (channel_id -&gt; Set of connection_ids)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>channelSubscriptions</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>setupEventHandlers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>setupEventHandlers</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// WebSocket 연결 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>wss</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;connection&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>ws</span><span class=p>,</span> <span class=nx>request</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>connectionId</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateConnectionId</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`새 연결: </span><span class=si>${</span><span class=nx>connectionId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 연결별 이벤트 핸들러 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleMessage</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>,</span> <span class=nx>ws</span><span class=p>,</span> <span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>handleDisconnection</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`WebSocket 에러 (</span><span class=si>${</span><span class=nx>connectionId</span><span class=si>}</span><span class=sb>):`</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>handleDisconnection</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 연결 정보 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>ws</span><span class=p>.</span><span class=nx>connectionId</span> <span class=o>=</span> <span class=nx>connectionId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>sessions</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>,</span> <span class=p>{</span> <span class=nx>ws</span><span class=p>,</span> <span class=nx>user</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span> <span class=nx>channels</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Set</span><span class=p>()</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Redis 메시지 구독 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>subscriber</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>channel</span><span class=p>,</span> <span class=nx>message</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>broadcastToChannel</span><span class=p>(</span><span class=nx>channel</span><span class=p>,</span> <span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleMessage</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>,</span> <span class=nx>ws</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>session</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>sessions</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>switch</span> <span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s1>&#39;auth&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 사용자 인증 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleAuthentication</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>,</span> <span class=nx>message</span><span class=p>.</span><span class=nx>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s1>&#39;join_channel&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 채널 참여 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleChannelJoin</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>,</span> <span class=nx>message</span><span class=p>.</span><span class=nx>payload</span><span class=p>.</span><span class=nx>channelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s1>&#39;send_message&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 메시지 전송 처리 - 여기서 비동기 처리의 핵심
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleMessageSend</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>,</span> <span class=nx>message</span><span class=p>.</span><span class=nx>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s1>&#39;leave_channel&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 채널 나가기 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleChannelLeave</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>,</span> <span class=nx>message</span><span class=p>.</span><span class=nx>payload</span><span class=p>.</span><span class=nx>channelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`메시지 처리 에러 (</span><span class=si>${</span><span class=nx>connectionId</span><span class=si>}</span><span class=sb>):`</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;메시지 처리 중 오류가 발생했습니다.&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleAuthentication</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>,</span> <span class=nx>authData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 실제로는 JWT 토큰 검증 등의 과정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>session</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>sessions</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>session</span><span class=p>.</span><span class=nx>user</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>id</span><span class=o>:</span> <span class=nx>authData</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>username</span><span class=o>:</span> <span class=nx>authData</span><span class=p>.</span><span class=nx>username</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Redis에 사용자 세션 정보 저장 (다른 게이트웨이 서버와 공유)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>publisher</span><span class=p>.</span><span class=nx>setex</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sb>`session:</span><span class=si>${</span><span class=nx>connectionId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=mi>3600</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>session</span><span class=p>.</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>session</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;auth_success&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span> <span class=nx>connectionId</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleChannelJoin</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>,</span> <span class=nx>channelId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>session</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>sessions</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>session</span><span class=p>.</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>session</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;인증이 필요합니다.&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}));</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 채널 구독자 목록에 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>channelSubscriptions</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>channelId</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>channelSubscriptions</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>channelId</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Set</span><span class=p>());</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Redis 채널 구독 (비동기 처리)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>subscriber</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=sb>`channel:</span><span class=si>${</span><span class=nx>channelId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>channelSubscriptions</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>channelId</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>session</span><span class=p>.</span><span class=nx>channels</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>channelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>session</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;channel_joined&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span> <span class=nx>channelId</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleMessageSend</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>,</span> <span class=nx>messageData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>session</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>sessions</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>session</span><span class=p>.</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>channelId</span><span class=p>,</span> <span class=nx>content</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>messageData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 메시지 객체 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>id</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateMessageId</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=nx>channelId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>content</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>author</span><span class=o>:</span> <span class=nx>session</span><span class=p>.</span><span class=nx>user</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Redis Pub/Sub을 통해 메시지 브로드캐스트 (비동기)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// 이 부분이 핵심: Redis에 발행하는 동안 다른 연결들의 처리가 블로킹되지 않음
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>publisher</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sb>`channel:</span><span class=si>${</span><span class=nx>channelId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 발신자에게 전송 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>session</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;message_sent&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>payload</span><span class=o>:</span> <span class=p>{</span> <span class=nx>messageId</span><span class=o>:</span> <span class=nx>message</span><span class=p>.</span><span class=nx>id</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>broadcastToChannel</span><span class=p>(</span><span class=nx>channel</span><span class=p>,</span> <span class=nx>messageData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>channelId</span> <span class=o>=</span> <span class=nx>channel</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=s1>&#39;channel:&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>subscribers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>channelSubscriptions</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>channelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>subscribers</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>messageData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 채널의 모든 구독자에게 비동기로 메시지 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>subscribers</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>connectionId</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>session</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>sessions</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>session</span> <span class=o>&amp;&amp;</span> <span class=nx>session</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>readyState</span> <span class=o>===</span> <span class=nx>WebSocket</span><span class=p>.</span><span class=nx>OPEN</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 각 WebSocket 전송도 비동기로 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nx>session</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;new_message&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>payload</span><span class=o>:</span> <span class=nx>message</span>
</span></span><span class=line><span class=cl>                <span class=p>}),</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`메시지 전송 실패 (</span><span class=si>${</span><span class=nx>connectionId</span><span class=si>}</span><span class=sb>):`</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>this</span><span class=p>.</span><span class=nx>handleDisconnection</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>handleDisconnection</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>session</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>sessions</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>session</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 모든 채널에서 사용자 제거
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>session</span><span class=p>.</span><span class=nx>channels</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>channelId</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>subscribers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>channelSubscriptions</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>channelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>subscribers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>subscribers</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 채널에 구독자가 없으면 Redis 구독 해제
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=k>if</span> <span class=p>(</span><span class=nx>subscribers</span><span class=p>.</span><span class=nx>size</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=k>this</span><span class=p>.</span><span class=nx>subscriber</span><span class=p>.</span><span class=nx>unsubscribe</span><span class=p>(</span><span class=sb>`channel:</span><span class=si>${</span><span class=nx>channelId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>this</span><span class=p>.</span><span class=nx>channelSubscriptions</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>channelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 세션 정리
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>this</span><span class=p>.</span><span class=nx>sessions</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>connectionId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// Redis에서 세션 정보 삭제 (비동기)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>this</span><span class=p>.</span><span class=nx>publisher</span><span class=p>.</span><span class=nx>del</span><span class=p>(</span><span class=sb>`session:</span><span class=si>${</span><span class=nx>connectionId</span><span class=si>}</span><span class=sb>`</span><span class=p>).</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`연결 종료: </span><span class=si>${</span><span class=nx>connectionId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>generateConnectionId</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`conn_</span><span class=si>${</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=si>}</span><span class=sb>_</span><span class=si>${</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>).</span><span class=nx>substr</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>9</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>generateMessageId</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`msg_</span><span class=si>${</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=si>}</span><span class=sb>_</span><span class=si>${</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>).</span><span class=nx>substr</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>9</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>start</span><span class=p>(</span><span class=nx>port</span> <span class=o>=</span> <span class=mi>3000</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Redis 연결
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>publisher</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>subscriber</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// HTTP 서버 시작
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>server</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Discord Gateway Server 시작: 포트 </span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;비동기 WebSocket과 Redis Pub/Sub으로 실시간 메시징 처리&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>gateway</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DiscordMessageGateway</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>gateway</span><span class=p>.</span><span class=nx>start</span><span class=p>(</span><span class=mi>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 프로세스 종료 시 정리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;서버 종료 중...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>gateway</span><span class=p>.</span><span class=nx>publisher</span><span class=p>.</span><span class=nx>quit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>gateway</span><span class=p>.</span><span class=nx>subscriber</span><span class=p>.</span><span class=nx>quit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li>성능 개선: 동시 연결 수 100 배 증가 (1K → 100K)</li><li>운영 효율성: 메시지 지연 시간 95% 감소 (1 초 → 50ms)</li><li>비용 절감: 서버 인스턴스 60% 감소로 월 운영비 절약</li></ul><h5 id=대용량-데이터-etl-비동기-파이프라인-구축>대용량 데이터 ETL 비동기 파이프라인 구축<a hidden class=anchor aria-hidden=true href=#대용량-데이터-etl-비동기-파이프라인-구축>#</a></h5><p><strong>비즈니스 배경</strong>: 실시간 데이터 적재 및 분석 성능, 확장성 요구</p><p><strong>기술적 요구</strong>: 메시지 브로커 기반 비동기 처리, 에러/순서 관리</p><p><strong>시스템 구성</strong>:</p><ul><li>데이터 수집, 메시지 큐, 워커, 결과 저장</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Data Pipeline&#34;
        A[수집 서버] --&gt; B[메시지 큐]
        B --&gt; C[워커]
        C --&gt; D[결과 저장소]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>서버에서 데이터 수집 → 큐 등록</li><li>워커가 큐에서 작업을 비동기적으로 처리</li><li>처리 결과를 저장소에 저장</li></ol><p><strong>핵심 역할</strong>: 메시지 큐가 비동기적 작업 분배 담당</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 순차 ETL, 속도/확장성 한계</li><li>도입 후: 비동기 분산 처리, 성능·신뢰성 극대화</li></ul><p><strong>구현 예시</strong> (메시지 큐 - 예시 YAML):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1>1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2>2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3>3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4>4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5>5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6>6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7>7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>etl-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>queue_type</span><span class=p>:</span><span class=w> </span><span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>worker_concurrency</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;10&#34;</span><span class=w>  </span><span class=c># 비동기 워커 병렬 처리 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>error_handling</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;retry&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li>성능 개선: 처리속도 3~10 배 상승</li><li>운영 효율성: 장애/지연시 자동 분산 처리</li><li>비용 절감: 서버 자원/운영 비용 절감</li></ul><h5 id=이미지-썸네일-파이프라인-s3--sqs--워커>이미지 썸네일 파이프라인 (S3 + SQS + 워커)<a hidden class=anchor aria-hidden=true href=#이미지-썸네일-파이프라인-s3--sqs--워커>#</a></h5><p><strong>비즈니스 배경</strong>: 업로드 폭주 시 동기 처리 병목 → 사용자 응답성 저하</p><p><strong>기술적 요구사항</strong>: 비동기 수락, 작업 내구성, 재시도, 백프레셔</p><p><strong>시스템 구성</strong>:</p><ul><li>API(업로드 메타 수락, 작업 ID 반환)</li><li>S3(원본 저장) ↔ SQS(작업 큐) ↔ 워커 (썸네일 생성) ↔ S3(결과) ↔ 콜백</li></ul><p><strong>시스템 구성 다이어그램</strong></p><pre class=mermaid>graph TB
  U[User] --&gt; API[Async API]
  API --&gt; S3[(S3 Raw)]
  API --&gt; Q[(SQS Queue)]
  Q --&gt; W[Async Worker]
  W --&gt; S3T[(S3 Thumbs)]
  W --&gt; CB[Callback/Webhook]
  OBS[Metrics/Logs] -.-&gt; API
  OBS -.-&gt; W
</pre><p><strong>Workflow</strong>:</p><ol><li>API 가 즉시 202 Accepted + job_id 반환</li><li>작업 메시지를 SQS 에 enqueue</li><li>워커가 병렬 처리 (동시성 제한)</li><li>성공/실패 메트릭 및 콜백</li></ol><p><strong>구현 예시 (Python 워커, 핵심만)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13>13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14>14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15>15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16>16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17>17</a>
</span><span class=lnt id=hl-29-18><a class=lnlinks href=#hl-29-18>18</a>
</span><span class=lnt id=hl-29-19><a class=lnlinks href=#hl-29-19>19</a>
</span><span class=lnt id=hl-29-20><a class=lnlinks href=#hl-29-20>20</a>
</span><span class=lnt id=hl-29-21><a class=lnlinks href=#hl-29-21>21</a>
</span><span class=lnt id=hl-29-22><a class=lnlinks href=#hl-29-22>22</a>
</span><span class=lnt id=hl-29-23><a class=lnlinks href=#hl-29-23>23</a>
</span><span class=lnt id=hl-29-24><a class=lnlinks href=#hl-29-24>24</a>
</span><span class=lnt id=hl-29-25><a class=lnlinks href=#hl-29-25>25</a>
</span><span class=lnt id=hl-29-26><a class=lnlinks href=#hl-29-26>26</a>
</span><span class=lnt id=hl-29-27><a class=lnlinks href=#hl-29-27>27</a>
</span><span class=lnt id=hl-29-28><a class=lnlinks href=#hl-29-28>28</a>
</span><span class=lnt id=hl-29-29><a class=lnlinks href=#hl-29-29>29</a>
</span><span class=lnt id=hl-29-30><a class=lnlinks href=#hl-29-30>30</a>
</span><span class=lnt id=hl-29-31><a class=lnlinks href=#hl-29-31>31</a>
</span><span class=lnt id=hl-29-32><a class=lnlinks href=#hl-29-32>32</a>
</span><span class=lnt id=hl-29-33><a class=lnlinks href=#hl-29-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 핵심: 비동기 다운로드/업로드 + 동시성 제한 + 재시도</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span><span class=o>,</span> <span class=nn>aioboto3</span><span class=o>,</span> <span class=nn>aiohttp</span><span class=o>,</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>io</span> <span class=kn>import</span> <span class=n>BytesIO</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>CONCURRENCY</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;CONCURRENCY&#34;</span><span class=p>,</span> <span class=s2>&#34;32&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>process_one</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span> <span class=n>s3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># msg에 s3://bucket/key 포함</span>
</span></span><span class=line><span class=cl>    <span class=n>bucket</span><span class=p>,</span> <span class=n>key</span> <span class=o>=</span> <span class=n>msg</span><span class=p>[</span><span class=s2>&#34;bucket&#34;</span><span class=p>],</span> <span class=n>msg</span><span class=p>[</span><span class=s2>&#34;key&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1># S3 비동기 다운로드</span>
</span></span><span class=line><span class=cl>    <span class=n>obj</span> <span class=o>=</span> <span class=k>await</span> <span class=n>s3</span><span class=o>.</span><span class=n>get_object</span><span class=p>(</span><span class=n>Bucket</span><span class=o>=</span><span class=n>bucket</span><span class=p>,</span> <span class=n>Key</span><span class=o>=</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=k>await</span> <span class=n>obj</span><span class=p>[</span><span class=s2>&#34;Body&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>im</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>BytesIO</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>im</span><span class=o>.</span><span class=n>thumbnail</span><span class=p>((</span><span class=mi>320</span><span class=p>,</span> <span class=mi>320</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=n>BytesIO</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>im</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=s2>&#34;JPEG&#34;</span><span class=p>,</span> <span class=n>quality</span><span class=o>=</span><span class=mi>85</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 결과 업로드</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>s3</span><span class=o>.</span><span class=n>put_object</span><span class=p>(</span><span class=n>Bucket</span><span class=o>=</span><span class=n>bucket</span><span class=p>,</span> <span class=n>Key</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;thumbs/</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>.jpg&#34;</span><span class=p>,</span> <span class=n>Body</span><span class=o>=</span><span class=n>out</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>worker_loop</span><span class=p>(</span><span class=n>messages</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sem</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=n>CONCURRENCY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span> <span class=o>=</span> <span class=n>aioboto3</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s2>&#34;s3&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>s3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>def</span> <span class=nf>bounded</span><span class=p>(</span><span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>async</span> <span class=k>with</span> <span class=n>sem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>          <span class=c1># 간단 재시도</span>
</span></span><span class=line><span class=cl>                    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=k>await</span> <span class=n>process_one</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>s3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=n>bounded</span><span class=p>(</span><span class=n>m</span><span class=p>)</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>messages</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li>성능 개선: 동일 인스턴스에서 처리량 <strong>3~10 배</strong>(I/O 패턴/이미지 크기 의존)</li><li>운영 효율성: 스케일 아웃이 큐/워커 개수로 선형적</li><li>비용 절감: 프로비저닝 코어/메모리 축소</li></ul><h5 id=100-명-동시-접속-사용자가-파일-업로드>100 명 동시 접속 사용자가 파일 업로드<a hidden class=anchor aria-hidden=true href=#100-명-동시-접속-사용자가-파일-업로드>#</a></h5><p><strong>시나리오</strong>:<br>100 명 동시 접속 사용자가 파일 업로드를 요청할 때, 서버가 파일 저장 작업을 비동기 큐에 넣고 바로 응답, 작업 완료 시 사용자에게 알림.</p><p><strong>시스템 구성</strong>:</p><ul><li>프론트엔드 (사용자)</li><li>웹 서버 (비동기 처리 API)</li><li>메시지 큐 (비동기 작업 저장)</li><li>워커 (파일 저장 실제 실행)</li><li>노티피케이션 서버 (결과 알림)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>flowchart TD
  A[프론트엔드]
  B[웹 서버]
  C[메시지 큐]
  D[워커]
  E[노티피케이션 서버]

  A --&gt; B
  B --&gt; C
  C --&gt; D
  D --&gt; E
  E --&gt; A
</pre><p><strong>Workflow</strong>:</p><ul><li>사용자가 파일 업로드 → 웹 서버 비동기 API 호출</li><li>웹 서버: 요청 즉시 " 업로드 중 " 응답 및 메시지 큐에 작업 저장</li><li>워커가 큐에서 작업 꺼내 파일 저장</li><li>완료 시 노티피케이션 서버에서 사용자에 완료 알림</li></ul><p><strong>역할</strong>:</p><ul><li>웹 서버: 요청 분리 후 반환</li><li>메시지 큐: 작업 분리·스케줄 관리</li><li>워커: 실제 처리</li><li>노티피케이션: 작업 결과 통지</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>유: 웹 서버 과부하 감소, 대기 시간 최소화, 높은 동시성 구현</li><li>무: 모든 요청 동기 처리, 서버 과부하 및 대기 시간 증가</li></ul><p><strong>구현 예시 (Python, FastAPI & Celery 사용):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10>10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11>11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12>12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13>13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14>14</a>
</span><span class=lnt id=hl-31-15><a class=lnlinks href=#hl-31-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span><span class=p>,</span> <span class=n>BackgroundTasks</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>celery</span> <span class=kn>import</span> <span class=n>Celery</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>celery_app</span> <span class=o>=</span> <span class=n>Celery</span><span class=p>(</span><span class=s1>&#39;tasks&#39;</span><span class=p>,</span> <span class=n>broker</span><span class=o>=</span><span class=s1>&#39;redis://localhost:6379/0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@celery_app.task</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>save_file_task</span><span class=p>(</span><span class=n>file_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 파일 저장 로직</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/upload&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>upload_file</span><span class=p>(</span><span class=n>file</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>save_file_task</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=n>file</span><span class=p>)</span>  <span class=c1># 비동기 워커로 파일 저장 요청</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;업로드 중입니다. 완료 후 알림이 전송됩니다.&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=실시간-채팅-서버에서-사용자-입력을-비동기-처리>실시간 채팅 서버에서 사용자 입력을 비동기 처리<a hidden class=anchor aria-hidden=true href=#실시간-채팅-서버에서-사용자-입력을-비동기-처리>#</a></h5><p><strong>시나리오</strong>: 실시간 채팅 서버에서 사용자 입력을 비동기 처리하여 고속 응답성과 메시지 저장을 병렬로 수행하고자 한다.</p><p><strong>시스템 구성</strong>:</p><ul><li>클라이언트: 채팅 입력</li><li>API 게이트웨이: 요청 라우팅</li><li>메시지 큐: 메시지 임시 저장</li><li>워커 서버: 메시지 처리 및 저장</li><li>DB: 메시지 영속 저장</li><li>WebSocket 서버: 실시간 브로드캐스팅</li></ul><p><strong>시스템 구성 다이어그램</strong></p><pre class=mermaid>graph LR
Client --&gt;|WebSocket| Gateway
Gateway --&gt;|SendMessage| MessageQueue
MessageQueue --&gt; Worker
Worker --&gt; Database
Worker --&gt;|Broadcast| WebSocketServer
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 채팅 입력 → WebSocket 연결 통해 전송</li><li>Gateway 는 메시지를 큐에 push</li><li>Worker 가 큐에서 pull → DB 저장 → 메시지 브로드캐스트</li><li>사용자들은 실시간으로 메시지 수신</li></ol><p><strong>역할</strong>:</p><ul><li><strong>Gateway</strong>: 비동기 메시지 수신 및 전달</li><li><strong>Message Queue</strong>: 느린 소비자를 위한 buffer 역할</li><li><strong>Worker</strong>: 메시지를 처리하고 DB 에 저장 (비동기)</li><li><strong>WebSocket Server</strong>: 비동기 방식으로 사용자에게 메시지 전파</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>있을 때</strong>: 시스템은 고속, 병렬적 처리 가능, 장애에도 유연</li><li><strong>없을 때</strong>: 블로킹 발생, 응답 지연, 장애시 전체 시스템 영향</li></ul><p><strong>구현 예시 (Python asyncio)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aiohttp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 비동기 메시지 전송 함수</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>send_message_to_queue</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>()</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;http://message-queue.local/api/send&#34;</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=n>message</span><span class=p>})</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메인 함수</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>send_message_to_queue</span><span class=p>(</span><span class=s2>&#34;Hello, Async Chat!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=대규모-전자상거래-플랫폼의-주문-처리-시스템>대규모 전자상거래 플랫폼의 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#대규모-전자상거래-플랫폼의-주문-처리-시스템>#</a></h5><p><strong>시나리오</strong>: 대규모 전자상거래 플랫폼의 주문 처리 시스템</p><p><strong>시스템 구성</strong>:</p><ul><li>Node.js 기반 API 서버 (Express.js)</li><li>MongoDB 비동기 드라이버</li><li>Redis 캐시 시스템</li><li>메시지 큐 (RabbitMQ)</li><li>결제 게이트웨이 연동</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[Client Request] --&gt; B[Load Balancer]
    B --&gt; C[API Server&lt;br/&gt;Event Loop]
    C --&gt; D[Order Validation]
    D --&gt; E[Inventory Check&lt;br/&gt;Async DB Query]
    E --&gt; F[Payment Processing&lt;br/&gt;External API]
    F --&gt; G[Order Creation&lt;br/&gt;Database Write]
    G --&gt; H[Message Queue&lt;br/&gt;Async Notification]
    H --&gt; I[Email Service]
    H --&gt; J[SMS Service]
    H --&gt; K[Push Notification]
    
    C --&gt; L[Redis Cache&lt;br/&gt;Session Management]
    E --&gt; M[MongoDB&lt;br/&gt;Product Database]
    G --&gt; N[PostgreSQL&lt;br/&gt;Order Database]
</pre><p><strong>Workflow</strong>:</p><ol><li>클라이언트 주문 요청 수신</li><li>비동기적으로 재고 확인, 결제 처리, 주문 생성 동시 진행</li><li>각 단계별 콜백 체인을 통한 후속 처리</li><li>메시지 큐를 통한 알림 서비스 비동기 호출</li><li>에러 발생 시 롤백 및 보상 트랜잭션 실행</li></ol><p><strong>역할</strong>:</p><ul><li>이벤트 루프: 수천 개의 동시 주문 요청 처리</li><li>비동기 DB 드라이버: I/O 차단 없는 데이터베이스 조회</li><li>메시지 큐: 알림 서비스와의 느슨한 결합</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>비동기 적용 전</strong>: 초당 500 주문 처리, 평균 응답 시간 2 초</li><li><strong>비동기 적용 후</strong>: 초당 5000 주문 처리, 평균 응답 시간 200ms</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span><span class=lnt id=hl-35-26><a class=lnlinks href=#hl-35-26>26</a>
</span><span class=lnt id=hl-35-27><a class=lnlinks href=#hl-35-27>27</a>
</span><span class=lnt id=hl-35-28><a class=lnlinks href=#hl-35-28>28</a>
</span><span class=lnt id=hl-35-29><a class=lnlinks href=#hl-35-29>29</a>
</span><span class=lnt id=hl-35-30><a class=lnlinks href=#hl-35-30>30</a>
</span><span class=lnt id=hl-35-31><a class=lnlinks href=#hl-35-31>31</a>
</span><span class=lnt id=hl-35-32><a class=lnlinks href=#hl-35-32>32</a>
</span><span class=lnt id=hl-35-33><a class=lnlinks href=#hl-35-33>33</a>
</span><span class=lnt id=hl-35-34><a class=lnlinks href=#hl-35-34>34</a>
</span><span class=lnt id=hl-35-35><a class=lnlinks href=#hl-35-35>35</a>
</span><span class=lnt id=hl-35-36><a class=lnlinks href=#hl-35-36>36</a>
</span><span class=lnt id=hl-35-37><a class=lnlinks href=#hl-35-37>37</a>
</span><span class=lnt id=hl-35-38><a class=lnlinks href=#hl-35-38>38</a>
</span><span class=lnt id=hl-35-39><a class=lnlinks href=#hl-35-39>39</a>
</span><span class=lnt id=hl-35-40><a class=lnlinks href=#hl-35-40>40</a>
</span><span class=lnt id=hl-35-41><a class=lnlinks href=#hl-35-41>41</a>
</span><span class=lnt id=hl-35-42><a class=lnlinks href=#hl-35-42>42</a>
</span><span class=lnt id=hl-35-43><a class=lnlinks href=#hl-35-43>43</a>
</span><span class=lnt id=hl-35-44><a class=lnlinks href=#hl-35-44>44</a>
</span><span class=lnt id=hl-35-45><a class=lnlinks href=#hl-35-45>45</a>
</span><span class=lnt id=hl-35-46><a class=lnlinks href=#hl-35-46>46</a>
</span><span class=lnt id=hl-35-47><a class=lnlinks href=#hl-35-47>47</a>
</span><span class=lnt id=hl-35-48><a class=lnlinks href=#hl-35-48>48</a>
</span><span class=lnt id=hl-35-49><a class=lnlinks href=#hl-35-49>49</a>
</span><span class=lnt id=hl-35-50><a class=lnlinks href=#hl-35-50>50</a>
</span><span class=lnt id=hl-35-51><a class=lnlinks href=#hl-35-51>51</a>
</span><span class=lnt id=hl-35-52><a class=lnlinks href=#hl-35-52>52</a>
</span><span class=lnt id=hl-35-53><a class=lnlinks href=#hl-35-53>53</a>
</span><span class=lnt id=hl-35-54><a class=lnlinks href=#hl-35-54>54</a>
</span><span class=lnt id=hl-35-55><a class=lnlinks href=#hl-35-55>55</a>
</span><span class=lnt id=hl-35-56><a class=lnlinks href=#hl-35-56>56</a>
</span><span class=lnt id=hl-35-57><a class=lnlinks href=#hl-35-57>57</a>
</span><span class=lnt id=hl-35-58><a class=lnlinks href=#hl-35-58>58</a>
</span><span class=lnt id=hl-35-59><a class=lnlinks href=#hl-35-59>59</a>
</span><span class=lnt id=hl-35-60><a class=lnlinks href=#hl-35-60>60</a>
</span><span class=lnt id=hl-35-61><a class=lnlinks href=#hl-35-61>61</a>
</span><span class=lnt id=hl-35-62><a class=lnlinks href=#hl-35-62>62</a>
</span><span class=lnt id=hl-35-63><a class=lnlinks href=#hl-35-63>63</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Express.js 기반 비동기 주문 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/api/orders&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>items</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 병렬 처리를 위한 Promise 배열
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>promises</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=nx>checkInventory</span><span class=p>(</span><span class=nx>items</span><span class=p>),</span>           <span class=c1>// 재고 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>validateUser</span><span class=p>(</span><span class=nx>userId</span><span class=p>),</span>           <span class=c1>// 사용자 검증  
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>calculateShipping</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>)</span>     <span class=c1>// 배송비 계산
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>];</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 모든 검증 작업을 병렬로 실행
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=p>[</span><span class=nx>inventory</span><span class=p>,</span> <span class=nx>user</span><span class=p>,</span> <span class=nx>shipping</span><span class=p>]</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span><span class=nx>promises</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 결제 처리 (외부 API 호출)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>payment</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>processPayment</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>amount</span><span class=o>:</span> <span class=nx>calculateTotal</span><span class=p>(</span><span class=nx>items</span><span class=p>,</span> <span class=nx>shipping</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>userId</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 생성 (데이터베이스 저장)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>order</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>createOrder</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>items</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>payment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>shipping</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 비동기 알림 전송 (fire-and-forget)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>sendNotifications</span><span class=p>(</span><span class=nx>order</span><span class=p>).</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> 
</span></span><span class=line><span class=cl>            <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Notification failed:&#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>orderId</span><span class=o>:</span> <span class=nx>order</span><span class=p>.</span><span class=nx>id</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Order processing failed:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> 
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> 
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 비동기 알림 전송 함수
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>sendNotifications</span><span class=p>(</span><span class=nx>order</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>notifications</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>emailService</span><span class=p>.</span><span class=nx>sendOrderConfirmation</span><span class=p>(</span><span class=nx>order</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>smsService</span><span class=p>.</span><span class=nx>sendOrderSMS</span><span class=p>(</span><span class=nx>order</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>pushService</span><span class=p>.</span><span class=nx>sendOrderPush</span><span class=p>(</span><span class=nx>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 알림 서비스들을 병렬로 실행
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>results</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>allSettled</span><span class=p>(</span><span class=nx>notifications</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 실패한 알림에 대한 로깅
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>results</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>result</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=s1>&#39;rejected&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>logger</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=sb>`Notification </span><span class=si>${</span><span class=nx>index</span><span class=si>}</span><span class=sb> failed:`</span><span class=p>,</span> <span class=nx>result</span><span class=p>.</span><span class=nx>reason</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=비동기-결제-처리-시스템>비동기 결제 처리 시스템<a hidden class=anchor aria-hidden=true href=#비동기-결제-처리-시스템>#</a></h5><p><strong>시나리오 개요/요구사항</strong>:</p><ul><li><strong>비즈니스 상황:</strong> 온라인 쇼핑몰/플랫폼에서 동시 다수 결제 요청이 발생.</li><li><strong>핵심 요구사항:</strong> 신속 응답 (결제 대기 최소화), 결제 실패/재시도 관리, 외부 결제 모듈 연결, 실시간 모니터링.</li><li><strong>도입 효과:</strong> 처리량 극대화, 사용자 경험 (UX) 향상, 장애가 전체 서비스로 전파되는 문제 예방.</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>웹 프론트엔드 (Web Frontend)</li><li>결제 요청 API 게이트웨이 (API Gateway)</li><li>결제 작업 큐 (Payment Queue, Kafka/Redis/RabbitMQ)</li><li>결제 워커 (Payment Worker, 병렬 처리)</li><li>외부 결제 모듈 (PG 사 API)</li><li>결과 저장소/알림 (Payment DB/Notification Queue)</li></ul><pre class=mermaid>graph TB
    A[웹 프론트엔드] --&gt; B[&#34;API Gateway(게이트웨이)&#34;]
    B --&gt; C[&#34;결제 작업 큐(Payment Queue)&#34;]
    C --&gt; D[&#34;결제 워커(Payment Worker)&#34;]
    D -- 결제 요청/결과 --&gt; E[&#34;외부 결제 모듈(PG)&#34;]
    D --&gt; F[결과 저장소]
    D --&gt; G[알림 큐]
</pre><ul><li>사용자는 결제 요청 시 즉시 응답 받으며, 실제 결제는 작업 큐에 등록된 후 워커가 별도로 병렬 처리한다. 결제 결과에 따라 DB 저장 및 사용자 알림을 트리거한다.</li></ul><p><strong>아키텍처 패턴 분석</strong>:</p><ul><li><strong>비동기 큐 기반 분리 (Queue-based Decoupling)</strong><ul><li>결제 요청은 즉시 큐에 등록, 실제 결제 처리 및 DB 저장/알림 전파는 비동기 수행.</li></ul></li><li><strong>병렬 워커 분산 처리 (Parallel Worker Processing)</strong><ul><li>여러 워커가 큐의 작업을 병렬로 소화하여, 트랜잭션 처리량 및 성능 극대화.</li></ul></li><li><strong>실패 격리/재시도 (Dead Letter Queue, Retry Policy)</strong><ul><li>결제 실패 시 DLQ(Dead Letter Queue) 로 격리, 자동 재시도 및 로그 저장.</li></ul></li></ul><p><strong>실무 코드 예시</strong>: Python + FastAPI + aiokafka</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a>
</span><span class=lnt id=hl-37-12><a class=lnlinks href=#hl-37-12>12</a>
</span><span class=lnt id=hl-37-13><a class=lnlinks href=#hl-37-13>13</a>
</span><span class=lnt id=hl-37-14><a class=lnlinks href=#hl-37-14>14</a>
</span><span class=lnt id=hl-37-15><a class=lnlinks href=#hl-37-15>15</a>
</span><span class=lnt id=hl-37-16><a class=lnlinks href=#hl-37-16>16</a>
</span><span class=lnt id=hl-37-17><a class=lnlinks href=#hl-37-17>17</a>
</span><span class=lnt id=hl-37-18><a class=lnlinks href=#hl-37-18>18</a>
</span><span class=lnt id=hl-37-19><a class=lnlinks href=#hl-37-19>19</a>
</span><span class=lnt id=hl-37-20><a class=lnlinks href=#hl-37-20>20</a>
</span><span class=lnt id=hl-37-21><a class=lnlinks href=#hl-37-21>21</a>
</span><span class=lnt id=hl-37-22><a class=lnlinks href=#hl-37-22>22</a>
</span><span class=lnt id=hl-37-23><a class=lnlinks href=#hl-37-23>23</a>
</span><span class=lnt id=hl-37-24><a class=lnlinks href=#hl-37-24>24</a>
</span><span class=lnt id=hl-37-25><a class=lnlinks href=#hl-37-25>25</a>
</span><span class=lnt id=hl-37-26><a class=lnlinks href=#hl-37-26>26</a>
</span><span class=lnt id=hl-37-27><a class=lnlinks href=#hl-37-27>27</a>
</span><span class=lnt id=hl-37-28><a class=lnlinks href=#hl-37-28>28</a>
</span><span class=lnt id=hl-37-29><a class=lnlinks href=#hl-37-29>29</a>
</span><span class=lnt id=hl-37-30><a class=lnlinks href=#hl-37-30>30</a>
</span><span class=lnt id=hl-37-31><a class=lnlinks href=#hl-37-31>31</a>
</span><span class=lnt id=hl-37-32><a class=lnlinks href=#hl-37-32>32</a>
</span><span class=lnt id=hl-37-33><a class=lnlinks href=#hl-37-33>33</a>
</span><span class=lnt id=hl-37-34><a class=lnlinks href=#hl-37-34>34</a>
</span><span class=lnt id=hl-37-35><a class=lnlinks href=#hl-37-35>35</a>
</span><span class=lnt id=hl-37-36><a class=lnlinks href=#hl-37-36>36</a>
</span><span class=lnt id=hl-37-37><a class=lnlinks href=#hl-37-37>37</a>
</span><span class=lnt id=hl-37-38><a class=lnlinks href=#hl-37-38>38</a>
</span><span class=lnt id=hl-37-39><a class=lnlinks href=#hl-37-39>39</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 간단 결제 요청 API: Kafka 큐에 메시지 등록</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>aiokafka</span> <span class=kn>import</span> <span class=n>AIOKafkaProducer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.on_event</span><span class=p>(</span><span class=s2>&#34;startup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>setup_kafka</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>producer</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span> <span class=o>=</span> <span class=n>AIOKafkaProducer</span><span class=p>(</span><span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>producer</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.post</span><span class=p>(</span><span class=s2>&#34;/pay&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>pay_request</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 결제 요청 데이터 큐에 등록</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>producer</span><span class=o>.</span><span class=n>send_and_wait</span><span class=p>(</span><span class=s2>&#34;payment-queue&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;result&#34;</span><span class=p>:</span> <span class=s2>&#34;결제 처리중, 완료 시 알림 발송&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 워커: Kafka에서 메시지 소비 후 외부 결제 API 호출 및 결과 핸들링</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>aiokafka</span> <span class=kn>import</span> <span class=n>AIOKafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>payment_worker</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer</span> <span class=o>=</span> <span class=n>AIOKafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;payment-queue&#34;</span><span class=p>,</span> <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s2>&#34;localhost:9092&#34;</span><span class=p>,</span> <span class=n>group_id</span><span class=o>=</span><span class=s2>&#34;worker-group&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>consumer</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=c1># 외부 결제 API 호출 예시</span>
</span></span><span class=line><span class=cl>            <span class=n>res</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;https://pg.example.com/pay&#34;</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># 결제 결과에 따라 DB 저장, 알림 처리 등 추가 구현</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>consumer</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># async 실행 예시</span>
</span></span><span class=line><span class=cl><span class=c1># asyncio.run(payment_worker())</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>/pay</code> API 는 실시간으로 큐에 결제 요청을 등록하고 즉시 응답한다.</li><li>결제 워커는 Kafka 에서 비동기적으로 메시지를 소비, 실제 PG 사 (전자결제 대행사) 의 API 에 결제 요청을 수행한다.</li></ul><p><strong>장애 처리 및 모니터링 구조</strong>:</p><ul><li><strong>Dead Letter Queue(DLQ):</strong> 결제 실패/에러 발생 시 별도 DLQ 에 저장, 추후 자동 재시도 및 모니터링.</li><li><strong>알림 큐:</strong> 결제 성공/실패 알림 비동기 발송 (푸시, 이메일 등)</li><li><strong>메트릭 수집:</strong> 처리량, 지연, 실패율 등 실시간 모니터링. Prometheus, Grafana 등과 연동 가능.</li></ul><h5 id=이벤트-드리븐-event-driven-architecture-시스템>이벤트 드리븐 (Event-Driven Architecture) 시스템<a hidden class=anchor aria-hidden=true href=#이벤트-드리븐-event-driven-architecture-시스템>#</a></h5><p><strong>시나리오</strong>:</p><ul><li>다양한 서비스 또는 컴포넌트에서 " 이벤트 (event)" 가 발생할 때마다, 해당 이벤트를 감지·처리하는 독립적 구조.</li><li>예: 주문 생성, 결제 완료, 회원 가입 이벤트 등.</li></ul><p><strong>핵심 개념</strong>:</p><ul><li>이벤트 발생 → 이벤트 브로커 (Event Broker, Kafka 등) 등록 → 여러 컨슈머 (Consumer) 가 비동기로 이벤트를 처리.</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>이벤트 생산자 (Event Producer)</li><li>이벤트 브로커 (Event Broker, Apache Kafka 등)</li><li>이벤트 컨슈머 (Event Consumer, Microservice)</li><li>이벤트 저장소 (Event Store)</li></ul><pre class=mermaid>graph TB
    A[이벤트 생산자] --&gt; B[&#34;이벤트 브로커(Kafka 등)&#34;]
    B --&gt; C[이벤트 컨슈머A]
    B --&gt; D[이벤트 컨슈머B]
    C --&gt; E[이벤트 저장소]
    D --&gt; F[외부 시스템 연동]
</pre><p><strong>코드 예시</strong>: Python/kafka-python 사용</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1> 1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2> 2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3> 3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4> 4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5> 5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6> 6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7> 7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8> 8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9> 9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10>10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11>11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12>12</a>
</span><span class=lnt id=hl-39-13><a class=lnlinks href=#hl-39-13>13</a>
</span><span class=lnt id=hl-39-14><a class=lnlinks href=#hl-39-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span><span class=p>,</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 생산자: 주문 생성 이벤트 발행</span>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span><span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>event</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;order_created&#34;</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=mi>123</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;event-topic&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>event</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 컨슈머: 주문 생성 이벤트 비동기 처리</span>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span><span class=s1>&#39;event-topic&#39;</span><span class=p>,</span> <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>event_data</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;order_created&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 여기서 주문 생성 처리 로직 실행</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 이벤트 처리: </span><span class=si>{</span><span class=n>event_data</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>비동기 이벤트 흐름에 따라</li><li>생산자는 즉시 이벤트를 브로커에 등록</li><li>컨슈머는 브로커에서 메시지 (이벤트) 를 비동기로 소비.</li></ul><p><strong>운영 포인트</strong>:</p><ul><li>이벤트 스키마 (Event Schema) 표준화, 중복 이벤트 처리 방지, 장애 시 DLQ(Dead Letter Queue) 활용.</li><li>확장성은 컨슈머 인스턴스를 자유롭게 확장 (Scale-out) 할 수 있음.</li></ul><h5 id=로그-처리-log-processing-시스템>로그 처리 (Log Processing) 시스템<a hidden class=anchor aria-hidden=true href=#로그-처리-log-processing-시스템>#</a></h5><p><strong>시나리오</strong>:</p><ul><li>다양한 시스템 (서버, DB, 애플리케이션) 에서 발생하는 로그를 실시간으로 수집, 비동기로 분석·저장하는 구조.</li></ul><p><strong>핵심 개념</strong>:</p><ul><li>로그 발생 → 로그 큐 (Log Queue) 에 등록 → 워커 (Worker) 가 비동기로 처리 및 저장소에 적재.</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>로그 수집기 (Log Collector, Filebeat 등)</li><li>로그 큐/브로커 (Kafka, Redis 등)</li><li>로그 워커 (Log Worker, Fluentd 등)</li><li>로그 저장소 (Elasticsearch 등)</li></ul><pre class=mermaid>graph TB
    A[서버/애플리케이션] --&gt; B[로그 수집기]
    B --&gt; C[로그 큐]
    C --&gt; D[로그 워커]
    D --&gt; E[로그 저장소]
</pre><p><strong>빠른 실행 개요</strong>:</p><ol><li>필수 패키지</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install kafka-python <span class=nv>elasticsearch</span><span class=o>==</span>8.* python-dateutil
</span></span></code></pre></td></tr></table></div></div><ol><li>환경변수 (필요시 기본값 사용됨)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1>1</a>
</span><span class=lnt id=hl-42-2><a class=lnlinks href=#hl-42-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>KAFKA_BOOTSTRAP</span><span class=o>=</span>localhost:9092
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ES_URL</span><span class=o>=</span>http://localhost:9200
</span></span></code></pre></td></tr></table></div></div><ol><li>토픽 생성 (최초 1 회)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python log_pipeline.py setup-topics
</span></span></code></pre></td></tr></table></div></div><ol><li>저장소 (Elasticsearch) 인덱스 준비 (최초 1 회)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python log_pipeline.py setup-index
</span></span></code></pre></td></tr></table></div></div><ol><li>수집기 (샘플 로그 생성 또는 파일 tail) 실행</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-45-1><a class=lnlinks href=#hl-45-1>1</a>
</span><span class=lnt id=hl-45-2><a class=lnlinks href=#hl-45-2>2</a>
</span><span class=lnt id=hl-45-3><a class=lnlinks href=#hl-45-3>3</a>
</span><span class=lnt id=hl-45-4><a class=lnlinks href=#hl-45-4>4</a>
</span><span class=lnt id=hl-45-5><a class=lnlinks href=#hl-45-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 샘플 이벤트 생성(1초 간격)</span>
</span></span><span class=line><span class=cl>python log_pipeline.py collector --service web-api
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 또는 파일 tail (마지막 라인부터 이어보기)</span>
</span></span><span class=line><span class=cl>python log_pipeline.py collector --service web-api --logfile /var/log/app.log
</span></span></code></pre></td></tr></table></div></div><ol><li>워커 실행 (소비→정규화→ES 벌크 적재, 실패 시 DLQ 전송)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-46-1><a class=lnlinks href=#hl-46-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python log_pipeline.py worker
</span></span></code></pre></td></tr></table></div></div><blockquote><p>기본 토픽: <code>logs.ingest</code> / DLQ: <code>logs.dlq</code> / 인덱스: <code>system-logs</code></p></blockquote><p><strong>코드 예시</strong>: <code>log_pipeline.py</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-47-1><a class=lnlinks href=#hl-47-1>  1</a>
</span><span class=lnt id=hl-47-2><a class=lnlinks href=#hl-47-2>  2</a>
</span><span class=lnt id=hl-47-3><a class=lnlinks href=#hl-47-3>  3</a>
</span><span class=lnt id=hl-47-4><a class=lnlinks href=#hl-47-4>  4</a>
</span><span class=lnt id=hl-47-5><a class=lnlinks href=#hl-47-5>  5</a>
</span><span class=lnt id=hl-47-6><a class=lnlinks href=#hl-47-6>  6</a>
</span><span class=lnt id=hl-47-7><a class=lnlinks href=#hl-47-7>  7</a>
</span><span class=lnt id=hl-47-8><a class=lnlinks href=#hl-47-8>  8</a>
</span><span class=lnt id=hl-47-9><a class=lnlinks href=#hl-47-9>  9</a>
</span><span class=lnt id=hl-47-10><a class=lnlinks href=#hl-47-10> 10</a>
</span><span class=lnt id=hl-47-11><a class=lnlinks href=#hl-47-11> 11</a>
</span><span class=lnt id=hl-47-12><a class=lnlinks href=#hl-47-12> 12</a>
</span><span class=lnt id=hl-47-13><a class=lnlinks href=#hl-47-13> 13</a>
</span><span class=lnt id=hl-47-14><a class=lnlinks href=#hl-47-14> 14</a>
</span><span class=lnt id=hl-47-15><a class=lnlinks href=#hl-47-15> 15</a>
</span><span class=lnt id=hl-47-16><a class=lnlinks href=#hl-47-16> 16</a>
</span><span class=lnt id=hl-47-17><a class=lnlinks href=#hl-47-17> 17</a>
</span><span class=lnt id=hl-47-18><a class=lnlinks href=#hl-47-18> 18</a>
</span><span class=lnt id=hl-47-19><a class=lnlinks href=#hl-47-19> 19</a>
</span><span class=lnt id=hl-47-20><a class=lnlinks href=#hl-47-20> 20</a>
</span><span class=lnt id=hl-47-21><a class=lnlinks href=#hl-47-21> 21</a>
</span><span class=lnt id=hl-47-22><a class=lnlinks href=#hl-47-22> 22</a>
</span><span class=lnt id=hl-47-23><a class=lnlinks href=#hl-47-23> 23</a>
</span><span class=lnt id=hl-47-24><a class=lnlinks href=#hl-47-24> 24</a>
</span><span class=lnt id=hl-47-25><a class=lnlinks href=#hl-47-25> 25</a>
</span><span class=lnt id=hl-47-26><a class=lnlinks href=#hl-47-26> 26</a>
</span><span class=lnt id=hl-47-27><a class=lnlinks href=#hl-47-27> 27</a>
</span><span class=lnt id=hl-47-28><a class=lnlinks href=#hl-47-28> 28</a>
</span><span class=lnt id=hl-47-29><a class=lnlinks href=#hl-47-29> 29</a>
</span><span class=lnt id=hl-47-30><a class=lnlinks href=#hl-47-30> 30</a>
</span><span class=lnt id=hl-47-31><a class=lnlinks href=#hl-47-31> 31</a>
</span><span class=lnt id=hl-47-32><a class=lnlinks href=#hl-47-32> 32</a>
</span><span class=lnt id=hl-47-33><a class=lnlinks href=#hl-47-33> 33</a>
</span><span class=lnt id=hl-47-34><a class=lnlinks href=#hl-47-34> 34</a>
</span><span class=lnt id=hl-47-35><a class=lnlinks href=#hl-47-35> 35</a>
</span><span class=lnt id=hl-47-36><a class=lnlinks href=#hl-47-36> 36</a>
</span><span class=lnt id=hl-47-37><a class=lnlinks href=#hl-47-37> 37</a>
</span><span class=lnt id=hl-47-38><a class=lnlinks href=#hl-47-38> 38</a>
</span><span class=lnt id=hl-47-39><a class=lnlinks href=#hl-47-39> 39</a>
</span><span class=lnt id=hl-47-40><a class=lnlinks href=#hl-47-40> 40</a>
</span><span class=lnt id=hl-47-41><a class=lnlinks href=#hl-47-41> 41</a>
</span><span class=lnt id=hl-47-42><a class=lnlinks href=#hl-47-42> 42</a>
</span><span class=lnt id=hl-47-43><a class=lnlinks href=#hl-47-43> 43</a>
</span><span class=lnt id=hl-47-44><a class=lnlinks href=#hl-47-44> 44</a>
</span><span class=lnt id=hl-47-45><a class=lnlinks href=#hl-47-45> 45</a>
</span><span class=lnt id=hl-47-46><a class=lnlinks href=#hl-47-46> 46</a>
</span><span class=lnt id=hl-47-47><a class=lnlinks href=#hl-47-47> 47</a>
</span><span class=lnt id=hl-47-48><a class=lnlinks href=#hl-47-48> 48</a>
</span><span class=lnt id=hl-47-49><a class=lnlinks href=#hl-47-49> 49</a>
</span><span class=lnt id=hl-47-50><a class=lnlinks href=#hl-47-50> 50</a>
</span><span class=lnt id=hl-47-51><a class=lnlinks href=#hl-47-51> 51</a>
</span><span class=lnt id=hl-47-52><a class=lnlinks href=#hl-47-52> 52</a>
</span><span class=lnt id=hl-47-53><a class=lnlinks href=#hl-47-53> 53</a>
</span><span class=lnt id=hl-47-54><a class=lnlinks href=#hl-47-54> 54</a>
</span><span class=lnt id=hl-47-55><a class=lnlinks href=#hl-47-55> 55</a>
</span><span class=lnt id=hl-47-56><a class=lnlinks href=#hl-47-56> 56</a>
</span><span class=lnt id=hl-47-57><a class=lnlinks href=#hl-47-57> 57</a>
</span><span class=lnt id=hl-47-58><a class=lnlinks href=#hl-47-58> 58</a>
</span><span class=lnt id=hl-47-59><a class=lnlinks href=#hl-47-59> 59</a>
</span><span class=lnt id=hl-47-60><a class=lnlinks href=#hl-47-60> 60</a>
</span><span class=lnt id=hl-47-61><a class=lnlinks href=#hl-47-61> 61</a>
</span><span class=lnt id=hl-47-62><a class=lnlinks href=#hl-47-62> 62</a>
</span><span class=lnt id=hl-47-63><a class=lnlinks href=#hl-47-63> 63</a>
</span><span class=lnt id=hl-47-64><a class=lnlinks href=#hl-47-64> 64</a>
</span><span class=lnt id=hl-47-65><a class=lnlinks href=#hl-47-65> 65</a>
</span><span class=lnt id=hl-47-66><a class=lnlinks href=#hl-47-66> 66</a>
</span><span class=lnt id=hl-47-67><a class=lnlinks href=#hl-47-67> 67</a>
</span><span class=lnt id=hl-47-68><a class=lnlinks href=#hl-47-68> 68</a>
</span><span class=lnt id=hl-47-69><a class=lnlinks href=#hl-47-69> 69</a>
</span><span class=lnt id=hl-47-70><a class=lnlinks href=#hl-47-70> 70</a>
</span><span class=lnt id=hl-47-71><a class=lnlinks href=#hl-47-71> 71</a>
</span><span class=lnt id=hl-47-72><a class=lnlinks href=#hl-47-72> 72</a>
</span><span class=lnt id=hl-47-73><a class=lnlinks href=#hl-47-73> 73</a>
</span><span class=lnt id=hl-47-74><a class=lnlinks href=#hl-47-74> 74</a>
</span><span class=lnt id=hl-47-75><a class=lnlinks href=#hl-47-75> 75</a>
</span><span class=lnt id=hl-47-76><a class=lnlinks href=#hl-47-76> 76</a>
</span><span class=lnt id=hl-47-77><a class=lnlinks href=#hl-47-77> 77</a>
</span><span class=lnt id=hl-47-78><a class=lnlinks href=#hl-47-78> 78</a>
</span><span class=lnt id=hl-47-79><a class=lnlinks href=#hl-47-79> 79</a>
</span><span class=lnt id=hl-47-80><a class=lnlinks href=#hl-47-80> 80</a>
</span><span class=lnt id=hl-47-81><a class=lnlinks href=#hl-47-81> 81</a>
</span><span class=lnt id=hl-47-82><a class=lnlinks href=#hl-47-82> 82</a>
</span><span class=lnt id=hl-47-83><a class=lnlinks href=#hl-47-83> 83</a>
</span><span class=lnt id=hl-47-84><a class=lnlinks href=#hl-47-84> 84</a>
</span><span class=lnt id=hl-47-85><a class=lnlinks href=#hl-47-85> 85</a>
</span><span class=lnt id=hl-47-86><a class=lnlinks href=#hl-47-86> 86</a>
</span><span class=lnt id=hl-47-87><a class=lnlinks href=#hl-47-87> 87</a>
</span><span class=lnt id=hl-47-88><a class=lnlinks href=#hl-47-88> 88</a>
</span><span class=lnt id=hl-47-89><a class=lnlinks href=#hl-47-89> 89</a>
</span><span class=lnt id=hl-47-90><a class=lnlinks href=#hl-47-90> 90</a>
</span><span class=lnt id=hl-47-91><a class=lnlinks href=#hl-47-91> 91</a>
</span><span class=lnt id=hl-47-92><a class=lnlinks href=#hl-47-92> 92</a>
</span><span class=lnt id=hl-47-93><a class=lnlinks href=#hl-47-93> 93</a>
</span><span class=lnt id=hl-47-94><a class=lnlinks href=#hl-47-94> 94</a>
</span><span class=lnt id=hl-47-95><a class=lnlinks href=#hl-47-95> 95</a>
</span><span class=lnt id=hl-47-96><a class=lnlinks href=#hl-47-96> 96</a>
</span><span class=lnt id=hl-47-97><a class=lnlinks href=#hl-47-97> 97</a>
</span><span class=lnt id=hl-47-98><a class=lnlinks href=#hl-47-98> 98</a>
</span><span class=lnt id=hl-47-99><a class=lnlinks href=#hl-47-99> 99</a>
</span><span class=lnt id=hl-47-100><a class=lnlinks href=#hl-47-100>100</a>
</span><span class=lnt id=hl-47-101><a class=lnlinks href=#hl-47-101>101</a>
</span><span class=lnt id=hl-47-102><a class=lnlinks href=#hl-47-102>102</a>
</span><span class=lnt id=hl-47-103><a class=lnlinks href=#hl-47-103>103</a>
</span><span class=lnt id=hl-47-104><a class=lnlinks href=#hl-47-104>104</a>
</span><span class=lnt id=hl-47-105><a class=lnlinks href=#hl-47-105>105</a>
</span><span class=lnt id=hl-47-106><a class=lnlinks href=#hl-47-106>106</a>
</span><span class=lnt id=hl-47-107><a class=lnlinks href=#hl-47-107>107</a>
</span><span class=lnt id=hl-47-108><a class=lnlinks href=#hl-47-108>108</a>
</span><span class=lnt id=hl-47-109><a class=lnlinks href=#hl-47-109>109</a>
</span><span class=lnt id=hl-47-110><a class=lnlinks href=#hl-47-110>110</a>
</span><span class=lnt id=hl-47-111><a class=lnlinks href=#hl-47-111>111</a>
</span><span class=lnt id=hl-47-112><a class=lnlinks href=#hl-47-112>112</a>
</span><span class=lnt id=hl-47-113><a class=lnlinks href=#hl-47-113>113</a>
</span><span class=lnt id=hl-47-114><a class=lnlinks href=#hl-47-114>114</a>
</span><span class=lnt id=hl-47-115><a class=lnlinks href=#hl-47-115>115</a>
</span><span class=lnt id=hl-47-116><a class=lnlinks href=#hl-47-116>116</a>
</span><span class=lnt id=hl-47-117><a class=lnlinks href=#hl-47-117>117</a>
</span><span class=lnt id=hl-47-118><a class=lnlinks href=#hl-47-118>118</a>
</span><span class=lnt id=hl-47-119><a class=lnlinks href=#hl-47-119>119</a>
</span><span class=lnt id=hl-47-120><a class=lnlinks href=#hl-47-120>120</a>
</span><span class=lnt id=hl-47-121><a class=lnlinks href=#hl-47-121>121</a>
</span><span class=lnt id=hl-47-122><a class=lnlinks href=#hl-47-122>122</a>
</span><span class=lnt id=hl-47-123><a class=lnlinks href=#hl-47-123>123</a>
</span><span class=lnt id=hl-47-124><a class=lnlinks href=#hl-47-124>124</a>
</span><span class=lnt id=hl-47-125><a class=lnlinks href=#hl-47-125>125</a>
</span><span class=lnt id=hl-47-126><a class=lnlinks href=#hl-47-126>126</a>
</span><span class=lnt id=hl-47-127><a class=lnlinks href=#hl-47-127>127</a>
</span><span class=lnt id=hl-47-128><a class=lnlinks href=#hl-47-128>128</a>
</span><span class=lnt id=hl-47-129><a class=lnlinks href=#hl-47-129>129</a>
</span><span class=lnt id=hl-47-130><a class=lnlinks href=#hl-47-130>130</a>
</span><span class=lnt id=hl-47-131><a class=lnlinks href=#hl-47-131>131</a>
</span><span class=lnt id=hl-47-132><a class=lnlinks href=#hl-47-132>132</a>
</span><span class=lnt id=hl-47-133><a class=lnlinks href=#hl-47-133>133</a>
</span><span class=lnt id=hl-47-134><a class=lnlinks href=#hl-47-134>134</a>
</span><span class=lnt id=hl-47-135><a class=lnlinks href=#hl-47-135>135</a>
</span><span class=lnt id=hl-47-136><a class=lnlinks href=#hl-47-136>136</a>
</span><span class=lnt id=hl-47-137><a class=lnlinks href=#hl-47-137>137</a>
</span><span class=lnt id=hl-47-138><a class=lnlinks href=#hl-47-138>138</a>
</span><span class=lnt id=hl-47-139><a class=lnlinks href=#hl-47-139>139</a>
</span><span class=lnt id=hl-47-140><a class=lnlinks href=#hl-47-140>140</a>
</span><span class=lnt id=hl-47-141><a class=lnlinks href=#hl-47-141>141</a>
</span><span class=lnt id=hl-47-142><a class=lnlinks href=#hl-47-142>142</a>
</span><span class=lnt id=hl-47-143><a class=lnlinks href=#hl-47-143>143</a>
</span><span class=lnt id=hl-47-144><a class=lnlinks href=#hl-47-144>144</a>
</span><span class=lnt id=hl-47-145><a class=lnlinks href=#hl-47-145>145</a>
</span><span class=lnt id=hl-47-146><a class=lnlinks href=#hl-47-146>146</a>
</span><span class=lnt id=hl-47-147><a class=lnlinks href=#hl-47-147>147</a>
</span><span class=lnt id=hl-47-148><a class=lnlinks href=#hl-47-148>148</a>
</span><span class=lnt id=hl-47-149><a class=lnlinks href=#hl-47-149>149</a>
</span><span class=lnt id=hl-47-150><a class=lnlinks href=#hl-47-150>150</a>
</span><span class=lnt id=hl-47-151><a class=lnlinks href=#hl-47-151>151</a>
</span><span class=lnt id=hl-47-152><a class=lnlinks href=#hl-47-152>152</a>
</span><span class=lnt id=hl-47-153><a class=lnlinks href=#hl-47-153>153</a>
</span><span class=lnt id=hl-47-154><a class=lnlinks href=#hl-47-154>154</a>
</span><span class=lnt id=hl-47-155><a class=lnlinks href=#hl-47-155>155</a>
</span><span class=lnt id=hl-47-156><a class=lnlinks href=#hl-47-156>156</a>
</span><span class=lnt id=hl-47-157><a class=lnlinks href=#hl-47-157>157</a>
</span><span class=lnt id=hl-47-158><a class=lnlinks href=#hl-47-158>158</a>
</span><span class=lnt id=hl-47-159><a class=lnlinks href=#hl-47-159>159</a>
</span><span class=lnt id=hl-47-160><a class=lnlinks href=#hl-47-160>160</a>
</span><span class=lnt id=hl-47-161><a class=lnlinks href=#hl-47-161>161</a>
</span><span class=lnt id=hl-47-162><a class=lnlinks href=#hl-47-162>162</a>
</span><span class=lnt id=hl-47-163><a class=lnlinks href=#hl-47-163>163</a>
</span><span class=lnt id=hl-47-164><a class=lnlinks href=#hl-47-164>164</a>
</span><span class=lnt id=hl-47-165><a class=lnlinks href=#hl-47-165>165</a>
</span><span class=lnt id=hl-47-166><a class=lnlinks href=#hl-47-166>166</a>
</span><span class=lnt id=hl-47-167><a class=lnlinks href=#hl-47-167>167</a>
</span><span class=lnt id=hl-47-168><a class=lnlinks href=#hl-47-168>168</a>
</span><span class=lnt id=hl-47-169><a class=lnlinks href=#hl-47-169>169</a>
</span><span class=lnt id=hl-47-170><a class=lnlinks href=#hl-47-170>170</a>
</span><span class=lnt id=hl-47-171><a class=lnlinks href=#hl-47-171>171</a>
</span><span class=lnt id=hl-47-172><a class=lnlinks href=#hl-47-172>172</a>
</span><span class=lnt id=hl-47-173><a class=lnlinks href=#hl-47-173>173</a>
</span><span class=lnt id=hl-47-174><a class=lnlinks href=#hl-47-174>174</a>
</span><span class=lnt id=hl-47-175><a class=lnlinks href=#hl-47-175>175</a>
</span><span class=lnt id=hl-47-176><a class=lnlinks href=#hl-47-176>176</a>
</span><span class=lnt id=hl-47-177><a class=lnlinks href=#hl-47-177>177</a>
</span><span class=lnt id=hl-47-178><a class=lnlinks href=#hl-47-178>178</a>
</span><span class=lnt id=hl-47-179><a class=lnlinks href=#hl-47-179>179</a>
</span><span class=lnt id=hl-47-180><a class=lnlinks href=#hl-47-180>180</a>
</span><span class=lnt id=hl-47-181><a class=lnlinks href=#hl-47-181>181</a>
</span><span class=lnt id=hl-47-182><a class=lnlinks href=#hl-47-182>182</a>
</span><span class=lnt id=hl-47-183><a class=lnlinks href=#hl-47-183>183</a>
</span><span class=lnt id=hl-47-184><a class=lnlinks href=#hl-47-184>184</a>
</span><span class=lnt id=hl-47-185><a class=lnlinks href=#hl-47-185>185</a>
</span><span class=lnt id=hl-47-186><a class=lnlinks href=#hl-47-186>186</a>
</span><span class=lnt id=hl-47-187><a class=lnlinks href=#hl-47-187>187</a>
</span><span class=lnt id=hl-47-188><a class=lnlinks href=#hl-47-188>188</a>
</span><span class=lnt id=hl-47-189><a class=lnlinks href=#hl-47-189>189</a>
</span><span class=lnt id=hl-47-190><a class=lnlinks href=#hl-47-190>190</a>
</span><span class=lnt id=hl-47-191><a class=lnlinks href=#hl-47-191>191</a>
</span><span class=lnt id=hl-47-192><a class=lnlinks href=#hl-47-192>192</a>
</span><span class=lnt id=hl-47-193><a class=lnlinks href=#hl-47-193>193</a>
</span><span class=lnt id=hl-47-194><a class=lnlinks href=#hl-47-194>194</a>
</span><span class=lnt id=hl-47-195><a class=lnlinks href=#hl-47-195>195</a>
</span><span class=lnt id=hl-47-196><a class=lnlinks href=#hl-47-196>196</a>
</span><span class=lnt id=hl-47-197><a class=lnlinks href=#hl-47-197>197</a>
</span><span class=lnt id=hl-47-198><a class=lnlinks href=#hl-47-198>198</a>
</span><span class=lnt id=hl-47-199><a class=lnlinks href=#hl-47-199>199</a>
</span><span class=lnt id=hl-47-200><a class=lnlinks href=#hl-47-200>200</a>
</span><span class=lnt id=hl-47-201><a class=lnlinks href=#hl-47-201>201</a>
</span><span class=lnt id=hl-47-202><a class=lnlinks href=#hl-47-202>202</a>
</span><span class=lnt id=hl-47-203><a class=lnlinks href=#hl-47-203>203</a>
</span><span class=lnt id=hl-47-204><a class=lnlinks href=#hl-47-204>204</a>
</span><span class=lnt id=hl-47-205><a class=lnlinks href=#hl-47-205>205</a>
</span><span class=lnt id=hl-47-206><a class=lnlinks href=#hl-47-206>206</a>
</span><span class=lnt id=hl-47-207><a class=lnlinks href=#hl-47-207>207</a>
</span><span class=lnt id=hl-47-208><a class=lnlinks href=#hl-47-208>208</a>
</span><span class=lnt id=hl-47-209><a class=lnlinks href=#hl-47-209>209</a>
</span><span class=lnt id=hl-47-210><a class=lnlinks href=#hl-47-210>210</a>
</span><span class=lnt id=hl-47-211><a class=lnlinks href=#hl-47-211>211</a>
</span><span class=lnt id=hl-47-212><a class=lnlinks href=#hl-47-212>212</a>
</span><span class=lnt id=hl-47-213><a class=lnlinks href=#hl-47-213>213</a>
</span><span class=lnt id=hl-47-214><a class=lnlinks href=#hl-47-214>214</a>
</span><span class=lnt id=hl-47-215><a class=lnlinks href=#hl-47-215>215</a>
</span><span class=lnt id=hl-47-216><a class=lnlinks href=#hl-47-216>216</a>
</span><span class=lnt id=hl-47-217><a class=lnlinks href=#hl-47-217>217</a>
</span><span class=lnt id=hl-47-218><a class=lnlinks href=#hl-47-218>218</a>
</span><span class=lnt id=hl-47-219><a class=lnlinks href=#hl-47-219>219</a>
</span><span class=lnt id=hl-47-220><a class=lnlinks href=#hl-47-220>220</a>
</span><span class=lnt id=hl-47-221><a class=lnlinks href=#hl-47-221>221</a>
</span><span class=lnt id=hl-47-222><a class=lnlinks href=#hl-47-222>222</a>
</span><span class=lnt id=hl-47-223><a class=lnlinks href=#hl-47-223>223</a>
</span><span class=lnt id=hl-47-224><a class=lnlinks href=#hl-47-224>224</a>
</span><span class=lnt id=hl-47-225><a class=lnlinks href=#hl-47-225>225</a>
</span><span class=lnt id=hl-47-226><a class=lnlinks href=#hl-47-226>226</a>
</span><span class=lnt id=hl-47-227><a class=lnlinks href=#hl-47-227>227</a>
</span><span class=lnt id=hl-47-228><a class=lnlinks href=#hl-47-228>228</a>
</span><span class=lnt id=hl-47-229><a class=lnlinks href=#hl-47-229>229</a>
</span><span class=lnt id=hl-47-230><a class=lnlinks href=#hl-47-230>230</a>
</span><span class=lnt id=hl-47-231><a class=lnlinks href=#hl-47-231>231</a>
</span><span class=lnt id=hl-47-232><a class=lnlinks href=#hl-47-232>232</a>
</span><span class=lnt id=hl-47-233><a class=lnlinks href=#hl-47-233>233</a>
</span><span class=lnt id=hl-47-234><a class=lnlinks href=#hl-47-234>234</a>
</span><span class=lnt id=hl-47-235><a class=lnlinks href=#hl-47-235>235</a>
</span><span class=lnt id=hl-47-236><a class=lnlinks href=#hl-47-236>236</a>
</span><span class=lnt id=hl-47-237><a class=lnlinks href=#hl-47-237>237</a>
</span><span class=lnt id=hl-47-238><a class=lnlinks href=#hl-47-238>238</a>
</span><span class=lnt id=hl-47-239><a class=lnlinks href=#hl-47-239>239</a>
</span><span class=lnt id=hl-47-240><a class=lnlinks href=#hl-47-240>240</a>
</span><span class=lnt id=hl-47-241><a class=lnlinks href=#hl-47-241>241</a>
</span><span class=lnt id=hl-47-242><a class=lnlinks href=#hl-47-242>242</a>
</span><span class=lnt id=hl-47-243><a class=lnlinks href=#hl-47-243>243</a>
</span><span class=lnt id=hl-47-244><a class=lnlinks href=#hl-47-244>244</a>
</span><span class=lnt id=hl-47-245><a class=lnlinks href=#hl-47-245>245</a>
</span><span class=lnt id=hl-47-246><a class=lnlinks href=#hl-47-246>246</a>
</span><span class=lnt id=hl-47-247><a class=lnlinks href=#hl-47-247>247</a>
</span><span class=lnt id=hl-47-248><a class=lnlinks href=#hl-47-248>248</a>
</span><span class=lnt id=hl-47-249><a class=lnlinks href=#hl-47-249>249</a>
</span><span class=lnt id=hl-47-250><a class=lnlinks href=#hl-47-250>250</a>
</span><span class=lnt id=hl-47-251><a class=lnlinks href=#hl-47-251>251</a>
</span><span class=lnt id=hl-47-252><a class=lnlinks href=#hl-47-252>252</a>
</span><span class=lnt id=hl-47-253><a class=lnlinks href=#hl-47-253>253</a>
</span><span class=lnt id=hl-47-254><a class=lnlinks href=#hl-47-254>254</a>
</span><span class=lnt id=hl-47-255><a class=lnlinks href=#hl-47-255>255</a>
</span><span class=lnt id=hl-47-256><a class=lnlinks href=#hl-47-256>256</a>
</span><span class=lnt id=hl-47-257><a class=lnlinks href=#hl-47-257>257</a>
</span><span class=lnt id=hl-47-258><a class=lnlinks href=#hl-47-258>258</a>
</span><span class=lnt id=hl-47-259><a class=lnlinks href=#hl-47-259>259</a>
</span><span class=lnt id=hl-47-260><a class=lnlinks href=#hl-47-260>260</a>
</span><span class=lnt id=hl-47-261><a class=lnlinks href=#hl-47-261>261</a>
</span><span class=lnt id=hl-47-262><a class=lnlinks href=#hl-47-262>262</a>
</span><span class=lnt id=hl-47-263><a class=lnlinks href=#hl-47-263>263</a>
</span><span class=lnt id=hl-47-264><a class=lnlinks href=#hl-47-264>264</a>
</span><span class=lnt id=hl-47-265><a class=lnlinks href=#hl-47-265>265</a>
</span><span class=lnt id=hl-47-266><a class=lnlinks href=#hl-47-266>266</a>
</span><span class=lnt id=hl-47-267><a class=lnlinks href=#hl-47-267>267</a>
</span><span class=lnt id=hl-47-268><a class=lnlinks href=#hl-47-268>268</a>
</span><span class=lnt id=hl-47-269><a class=lnlinks href=#hl-47-269>269</a>
</span><span class=lnt id=hl-47-270><a class=lnlinks href=#hl-47-270>270</a>
</span><span class=lnt id=hl-47-271><a class=lnlinks href=#hl-47-271>271</a>
</span><span class=lnt id=hl-47-272><a class=lnlinks href=#hl-47-272>272</a>
</span><span class=lnt id=hl-47-273><a class=lnlinks href=#hl-47-273>273</a>
</span><span class=lnt id=hl-47-274><a class=lnlinks href=#hl-47-274>274</a>
</span><span class=lnt id=hl-47-275><a class=lnlinks href=#hl-47-275>275</a>
</span><span class=lnt id=hl-47-276><a class=lnlinks href=#hl-47-276>276</a>
</span><span class=lnt id=hl-47-277><a class=lnlinks href=#hl-47-277>277</a>
</span><span class=lnt id=hl-47-278><a class=lnlinks href=#hl-47-278>278</a>
</span><span class=lnt id=hl-47-279><a class=lnlinks href=#hl-47-279>279</a>
</span><span class=lnt id=hl-47-280><a class=lnlinks href=#hl-47-280>280</a>
</span><span class=lnt id=hl-47-281><a class=lnlinks href=#hl-47-281>281</a>
</span><span class=lnt id=hl-47-282><a class=lnlinks href=#hl-47-282>282</a>
</span><span class=lnt id=hl-47-283><a class=lnlinks href=#hl-47-283>283</a>
</span><span class=lnt id=hl-47-284><a class=lnlinks href=#hl-47-284>284</a>
</span><span class=lnt id=hl-47-285><a class=lnlinks href=#hl-47-285>285</a>
</span><span class=lnt id=hl-47-286><a class=lnlinks href=#hl-47-286>286</a>
</span><span class=lnt id=hl-47-287><a class=lnlinks href=#hl-47-287>287</a>
</span><span class=lnt id=hl-47-288><a class=lnlinks href=#hl-47-288>288</a>
</span><span class=lnt id=hl-47-289><a class=lnlinks href=#hl-47-289>289</a>
</span><span class=lnt id=hl-47-290><a class=lnlinks href=#hl-47-290>290</a>
</span><span class=lnt id=hl-47-291><a class=lnlinks href=#hl-47-291>291</a>
</span><span class=lnt id=hl-47-292><a class=lnlinks href=#hl-47-292>292</a>
</span><span class=lnt id=hl-47-293><a class=lnlinks href=#hl-47-293>293</a>
</span><span class=lnt id=hl-47-294><a class=lnlinks href=#hl-47-294>294</a>
</span><span class=lnt id=hl-47-295><a class=lnlinks href=#hl-47-295>295</a>
</span><span class=lnt id=hl-47-296><a class=lnlinks href=#hl-47-296>296</a>
</span><span class=lnt id=hl-47-297><a class=lnlinks href=#hl-47-297>297</a>
</span><span class=lnt id=hl-47-298><a class=lnlinks href=#hl-47-298>298</a>
</span><span class=lnt id=hl-47-299><a class=lnlinks href=#hl-47-299>299</a>
</span><span class=lnt id=hl-47-300><a class=lnlinks href=#hl-47-300>300</a>
</span><span class=lnt id=hl-47-301><a class=lnlinks href=#hl-47-301>301</a>
</span><span class=lnt id=hl-47-302><a class=lnlinks href=#hl-47-302>302</a>
</span><span class=lnt id=hl-47-303><a class=lnlinks href=#hl-47-303>303</a>
</span><span class=lnt id=hl-47-304><a class=lnlinks href=#hl-47-304>304</a>
</span><span class=lnt id=hl-47-305><a class=lnlinks href=#hl-47-305>305</a>
</span><span class=lnt id=hl-47-306><a class=lnlinks href=#hl-47-306>306</a>
</span><span class=lnt id=hl-47-307><a class=lnlinks href=#hl-47-307>307</a>
</span><span class=lnt id=hl-47-308><a class=lnlinks href=#hl-47-308>308</a>
</span><span class=lnt id=hl-47-309><a class=lnlinks href=#hl-47-309>309</a>
</span><span class=lnt id=hl-47-310><a class=lnlinks href=#hl-47-310>310</a>
</span><span class=lnt id=hl-47-311><a class=lnlinks href=#hl-47-311>311</a>
</span><span class=lnt id=hl-47-312><a class=lnlinks href=#hl-47-312>312</a>
</span><span class=lnt id=hl-47-313><a class=lnlinks href=#hl-47-313>313</a>
</span><span class=lnt id=hl-47-314><a class=lnlinks href=#hl-47-314>314</a>
</span><span class=lnt id=hl-47-315><a class=lnlinks href=#hl-47-315>315</a>
</span><span class=lnt id=hl-47-316><a class=lnlinks href=#hl-47-316>316</a>
</span><span class=lnt id=hl-47-317><a class=lnlinks href=#hl-47-317>317</a>
</span><span class=lnt id=hl-47-318><a class=lnlinks href=#hl-47-318>318</a>
</span><span class=lnt id=hl-47-319><a class=lnlinks href=#hl-47-319>319</a>
</span><span class=lnt id=hl-47-320><a class=lnlinks href=#hl-47-320>320</a>
</span><span class=lnt id=hl-47-321><a class=lnlinks href=#hl-47-321>321</a>
</span><span class=lnt id=hl-47-322><a class=lnlinks href=#hl-47-322>322</a>
</span><span class=lnt id=hl-47-323><a class=lnlinks href=#hl-47-323>323</a>
</span><span class=lnt id=hl-47-324><a class=lnlinks href=#hl-47-324>324</a>
</span><span class=lnt id=hl-47-325><a class=lnlinks href=#hl-47-325>325</a>
</span><span class=lnt id=hl-47-326><a class=lnlinks href=#hl-47-326>326</a>
</span><span class=lnt id=hl-47-327><a class=lnlinks href=#hl-47-327>327</a>
</span><span class=lnt id=hl-47-328><a class=lnlinks href=#hl-47-328>328</a>
</span><span class=lnt id=hl-47-329><a class=lnlinks href=#hl-47-329>329</a>
</span><span class=lnt id=hl-47-330><a class=lnlinks href=#hl-47-330>330</a>
</span><span class=lnt id=hl-47-331><a class=lnlinks href=#hl-47-331>331</a>
</span><span class=lnt id=hl-47-332><a class=lnlinks href=#hl-47-332>332</a>
</span><span class=lnt id=hl-47-333><a class=lnlinks href=#hl-47-333>333</a>
</span><span class=lnt id=hl-47-334><a class=lnlinks href=#hl-47-334>334</a>
</span><span class=lnt id=hl-47-335><a class=lnlinks href=#hl-47-335>335</a>
</span><span class=lnt id=hl-47-336><a class=lnlinks href=#hl-47-336>336</a>
</span><span class=lnt id=hl-47-337><a class=lnlinks href=#hl-47-337>337</a>
</span><span class=lnt id=hl-47-338><a class=lnlinks href=#hl-47-338>338</a>
</span><span class=lnt id=hl-47-339><a class=lnlinks href=#hl-47-339>339</a>
</span><span class=lnt id=hl-47-340><a class=lnlinks href=#hl-47-340>340</a>
</span><span class=lnt id=hl-47-341><a class=lnlinks href=#hl-47-341>341</a>
</span><span class=lnt id=hl-47-342><a class=lnlinks href=#hl-47-342>342</a>
</span><span class=lnt id=hl-47-343><a class=lnlinks href=#hl-47-343>343</a>
</span><span class=lnt id=hl-47-344><a class=lnlinks href=#hl-47-344>344</a>
</span><span class=lnt id=hl-47-345><a class=lnlinks href=#hl-47-345>345</a>
</span><span class=lnt id=hl-47-346><a class=lnlinks href=#hl-47-346>346</a>
</span><span class=lnt id=hl-47-347><a class=lnlinks href=#hl-47-347>347</a>
</span><span class=lnt id=hl-47-348><a class=lnlinks href=#hl-47-348>348</a>
</span><span class=lnt id=hl-47-349><a class=lnlinks href=#hl-47-349>349</a>
</span><span class=lnt id=hl-47-350><a class=lnlinks href=#hl-47-350>350</a>
</span><span class=lnt id=hl-47-351><a class=lnlinks href=#hl-47-351>351</a>
</span><span class=lnt id=hl-47-352><a class=lnlinks href=#hl-47-352>352</a>
</span><span class=lnt id=hl-47-353><a class=lnlinks href=#hl-47-353>353</a>
</span><span class=lnt id=hl-47-354><a class=lnlinks href=#hl-47-354>354</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>엔드투엔드 로그 파이프라인 예시
</span></span></span><span class=line><span class=cl><span class=s2>- 구성: 로그 수집기(Collector) → Kafka(Queue/Broker) → 워커(Worker) → Elasticsearch(Storage)
</span></span></span><span class=line><span class=cl><span class=s2>- 모드: setup-topics / setup-index / collector / worker
</span></span></span><span class=line><span class=cl><span class=s2>- 특징:
</span></span></span><span class=line><span class=cl><span class=s2>  * Kafka 토픽 자동 생성(ingest, dlq)
</span></span></span><span class=line><span class=cl><span class=s2>  * Collector: 샘플 로그 생성 또는 파일 tail → Kafka Producer 전송
</span></span></span><span class=line><span class=cl><span class=s2>  * Worker: Kafka Consumer → JSON 파싱/정규화 → ES Bulk 적재
</span></span></span><span class=line><span class=cl><span class=s2>  * 재시도/백오프, DLQ로 실패 이벤트 격리
</span></span></span><span class=line><span class=cl><span class=s2>  * 간단한 스키마/매핑 생성(ES)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>argparse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>signal</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timezone</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dateutil</span> <span class=kn>import</span> <span class=n>parser</span> <span class=k>as</span> <span class=n>dtparser</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span><span class=p>,</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka.admin</span> <span class=kn>import</span> <span class=n>KafkaAdminClient</span><span class=p>,</span> <span class=n>NewTopic</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka.errors</span> <span class=kn>import</span> <span class=n>TopicAlreadyExistsError</span><span class=p>,</span> <span class=n>NoBrokersAvailable</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>elasticsearch</span> <span class=kn>import</span> <span class=n>Elasticsearch</span><span class=p>,</span> <span class=n>helpers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --------- 환경 기본값 ---------</span>
</span></span><span class=line><span class=cl><span class=n>KAFKA_BOOTSTRAP</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;KAFKA_BOOTSTRAP&#34;</span><span class=p>,</span> <span class=s2>&#34;localhost:9092&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ES_URL</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;ES_URL&#34;</span><span class=p>,</span> <span class=s2>&#34;http://localhost:9200&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>TOPIC_INGEST</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;TOPIC_INGEST&#34;</span><span class=p>,</span> <span class=s2>&#34;logs.ingest&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>TOPIC_DLQ</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;TOPIC_DLQ&#34;</span><span class=p>,</span> <span class=s2>&#34;logs.dlq&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ES_INDEX</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;ES_INDEX&#34;</span><span class=p>,</span> <span class=s2>&#34;system-logs&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># graceful stop 플래그</span>
</span></span><span class=line><span class=cl><span class=n>STOP</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>_now_iso</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>)</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=cl><span class=c1># Kafka Admin: 토픽 생성</span>
</span></span><span class=line><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>setup_topics</span><span class=p>(</span><span class=n>replication_factor</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>partitions</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kafka 토픽(ingest, dlq) 생성.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>admin</span> <span class=o>=</span> <span class=n>KafkaAdminClient</span><span class=p>(</span><span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>KAFKA_BOOTSTRAP</span><span class=p>,</span> <span class=n>client_id</span><span class=o>=</span><span class=s2>&#34;log-pipeline-admin&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>NoBrokersAvailable</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[setup-topics] Kafka에 연결할 수 없음: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>topics</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=p>[</span><span class=n>TOPIC_INGEST</span><span class=p>,</span> <span class=n>TOPIC_DLQ</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>topics</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>NewTopic</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span> <span class=n>num_partitions</span><span class=o>=</span><span class=n>partitions</span><span class=p>,</span> <span class=n>replication_factor</span><span class=o>=</span><span class=n>replication_factor</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>admin</span><span class=o>.</span><span class=n>create_topics</span><span class=p>(</span><span class=n>new_topics</span><span class=o>=</span><span class=n>topics</span><span class=p>,</span> <span class=n>validate_only</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[setup-topics] 생성 완료: </span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>t</span><span class=o>.</span><span class=n>name</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>topics</span><span class=p>])</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>TopicAlreadyExistsError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[setup-topics] 토픽이 이미 존재함. 건너뜀.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>admin</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=cl><span class=c1># Elasticsearch: 인덱스 준비</span>
</span></span><span class=line><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>setup_index</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Elasticsearch 인덱스(매핑) 생성. 존재 시 스킵.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>es</span> <span class=o>=</span> <span class=n>Elasticsearch</span><span class=p>(</span><span class=n>ES_URL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>es</span><span class=o>.</span><span class=n>indices</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=n>ES_INDEX</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[setup-index] 인덱스 &#39;</span><span class=si>{</span><span class=n>ES_INDEX</span><span class=si>}</span><span class=s2>&#39; 이미 존재. 건너뜀.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>mapping</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;mappings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;@timestamp&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;date&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;service&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;keyword&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;keyword&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;level&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;keyword&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;tags&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;keyword&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;number_of_shards&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;number_of_replicas&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>es</span><span class=o>.</span><span class=n>indices</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=n>ES_INDEX</span><span class=p>,</span> <span class=n>body</span><span class=o>=</span><span class=n>mapping</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[setup-index] 인덱스 &#39;</span><span class=si>{</span><span class=n>ES_INDEX</span><span class=si>}</span><span class=s2>&#39; 생성 완료.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=cl><span class=c1># Producer(Collector)</span>
</span></span><span class=line><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_producer</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>KafkaProducer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kafka Producer 생성. acks=all, idempotent 전송(가능한 경우)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>KAFKA_BOOTSTRAP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>acks</span><span class=o>=</span><span class=s2>&#34;all&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>linger_ms</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>retries</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>key_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>v</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>enable_idempotence</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>tail_file</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;파일을 tail -F 처럼 끝에서부터 이어 읽는다.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s2>&#34;ignore&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 파일 끝으로 이동</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>SEEK_END</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=ow>not</span> <span class=n>STOP</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>line</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>readline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>line</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>collector_main</span><span class=p>(</span><span class=n>service</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>logfile</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>host</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    로그 수집기:
</span></span></span><span class=line><span class=cl><span class=s2>      - 옵션1: 샘플 JSON 이벤트를 주기적으로 생성해서 Kafka로 전송
</span></span></span><span class=line><span class=cl><span class=s2>      - 옵션2: 실제 로그 파일을 tail 하여 라인을 JSON로 감싸 Kafka로 전송
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span> <span class=o>=</span> <span class=n>build_producer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span> <span class=o>=</span> <span class=n>host</span> <span class=ow>or</span> <span class=n>os</span><span class=o>.</span><span class=n>uname</span><span class=p>()</span><span class=o>.</span><span class=n>nodename</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[collector] 시작: service=</span><span class=si>{</span><span class=n>service</span><span class=si>}</span><span class=s2>, logfile=</span><span class=si>{</span><span class=n>logfile</span> <span class=ow>or</span> <span class=s1>&#39;sample events&#39;</span><span class=si>}</span><span class=s2>, host=</span><span class=si>{</span><span class=n>host</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>logfile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 파일 tail → JSON 래핑 → Kafka</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>tail_file</span><span class=p>(</span><span class=n>logfile</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;@timestamp&#34;</span><span class=p>:</span> <span class=n>_now_iso</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;service&#34;</span><span class=p>:</span> <span class=n>service</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=n>host</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;INFO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=n>line</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=n>line</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;tags&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;filebeat&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>TOPIC_INGEST</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=n>service</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 샘플 이벤트 생성</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=ow>not</span> <span class=n>STOP</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>event</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;@timestamp&#34;</span><span class=p>:</span> <span class=n>_now_iso</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;service&#34;</span><span class=p>:</span> <span class=n>service</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=n>host</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;INFO&#34;</span> <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>5</span> <span class=k>else</span> <span class=s2>&#34;WARN&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;sample event #</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;sample_raw_line </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;tags&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;synthetic&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>TOPIC_INGEST</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=n>service</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>producer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[collector] 종료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=cl><span class=c1># Consumer(Worker)</span>
</span></span><span class=line><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_consumer</span><span class=p>(</span><span class=n>group_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;log-workers&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>KafkaConsumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kafka Consumer 생성.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>TOPIC_INGEST</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>KAFKA_BOOTSTRAP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>group_id</span><span class=o>=</span><span class=n>group_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>enable_auto_commit</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s2>&#34;latest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>max_poll_records</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>v</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>key_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>v</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer_timeout_ms</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_dlq_producer</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>KafkaProducer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;DLQ 전송용 Producer.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>KAFKA_BOOTSTRAP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>acks</span><span class=o>=</span><span class=s2>&#34;all&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>key_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>v</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>normalize_record</span><span class=p>(</span><span class=n>rec</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    레코드 정규화:
</span></span></span><span class=line><span class=cl><span class=s2>      - @timestamp 파싱/보정
</span></span></span><span class=line><span class=cl><span class=s2>      - 필수 필드 보장(service/host/level/message/raw)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>rec</span><span class=p>)</span>  <span class=c1># 얕은 복사</span>
</span></span><span class=line><span class=cl>    <span class=c1># 타임스탬프 정규화</span>
</span></span><span class=line><span class=cl>    <span class=n>ts</span> <span class=o>=</span> <span class=n>rec</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;@timestamp&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>rec</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;timestamp&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=p>[</span><span class=s2>&#34;@timestamp&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>dtparser</span><span class=o>.</span><span class=n>isoparse</span><span class=p>(</span><span class=n>ts</span><span class=p>)</span><span class=o>.</span><span class=n>astimezone</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>)</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span> <span class=k>if</span> <span class=n>ts</span> <span class=k>else</span> <span class=n>_now_iso</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=p>[</span><span class=s2>&#34;@timestamp&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>_now_iso</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># 기본 필드 보강</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s2>&#34;service&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s2>&#34;host&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s2>&#34;level&#34;</span><span class=p>,</span> <span class=s2>&#34;INFO&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s2>&#34;message&#34;</span><span class=p>,</span> <span class=n>rec</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;message&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>rec</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;raw&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;raw&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>out</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=p>[</span><span class=s2>&#34;raw&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>rec</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 태그는 배열 보장</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;tags&#34;</span> <span class=ow>in</span> <span class=n>out</span> <span class=ow>and</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>out</span><span class=p>[</span><span class=s2>&#34;tags&#34;</span><span class=p>],</span> <span class=nb>list</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=p>[</span><span class=s2>&#34;tags&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>out</span><span class=p>[</span><span class=s2>&#34;tags&#34;</span><span class=p>])]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>out</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>es_bulk_index</span><span class=p>(</span><span class=n>es</span><span class=p>:</span> <span class=n>Elasticsearch</span><span class=p>,</span> <span class=n>docs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Elasticsearch 벌크 적재(실패 시 예외 발생).&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>actions</span> <span class=o>=</span> <span class=p>({</span><span class=s2>&#34;_index&#34;</span><span class=p>:</span> <span class=n>ES_INDEX</span><span class=p>,</span> <span class=s2>&#34;_op_type&#34;</span><span class=p>:</span> <span class=s2>&#34;index&#34;</span><span class=p>,</span> <span class=s2>&#34;_source&#34;</span><span class=p>:</span> <span class=n>d</span><span class=p>}</span> <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>docs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>helpers</span><span class=o>.</span><span class=n>bulk</span><span class=p>(</span><span class=n>es</span><span class=p>,</span> <span class=n>actions</span><span class=p>,</span> <span class=n>request_timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>worker_main</span><span class=p>(</span><span class=n>batch_size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span><span class=p>,</span> <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=n>backoff_base</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    로그 워커:
</span></span></span><span class=line><span class=cl><span class=s2>      - Kafka에서 배치로 메시지 poll
</span></span></span><span class=line><span class=cl><span class=s2>      - 정규화/필수 필드 보강
</span></span></span><span class=line><span class=cl><span class=s2>      - ES 벌크 적재(실패 시 지수 백오프 재시도, 끝내 실패하면 DLQ 전송)
</span></span></span><span class=line><span class=cl><span class=s2>      - 성공 시 수동 커밋
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer</span> <span class=o>=</span> <span class=n>build_consumer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>dlq</span> <span class=o>=</span> <span class=n>build_dlq_producer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>es</span> <span class=o>=</span> <span class=n>Elasticsearch</span><span class=p>(</span><span class=n>ES_URL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[worker] 시작: batch_size=</span><span class=si>{</span><span class=n>batch_size</span><span class=si>}</span><span class=s2>, max_retries=</span><span class=si>{</span><span class=n>max_retries</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=ow>not</span> <span class=n>STOP</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>polled</span> <span class=o>=</span> <span class=n>consumer</span><span class=o>.</span><span class=n>poll</span><span class=p>(</span><span class=n>timeout_ms</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>max_records</span><span class=o>=</span><span class=n>batch_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>batch_docs</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=n>batch_offsets</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># poll 결과는 {TopicPartition: [ConsumerRecord, ...]} 형태</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>tp</span><span class=p>,</span> <span class=n>records</span> <span class=ow>in</span> <span class=n>polled</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>records</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>doc</span> <span class=o>=</span> <span class=n>normalize_record</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>batch_docs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>batch_offsets</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>tp</span><span class=p>,</span> <span class=n>r</span><span class=o>.</span><span class=n>offset</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 파싱/정규화 실패: DLQ로 즉시 전송</span>
</span></span><span class=line><span class=cl>                        <span class=n>dlq_payload</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;normalize_error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=n>r</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;meta&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;partition&#34;</span><span class=p>:</span> <span class=n>tp</span><span class=o>.</span><span class=n>partition</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;offset&#34;</span><span class=p>:</span> <span class=n>r</span><span class=o>.</span><span class=n>offset</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;topic&#34;</span><span class=p>:</span> <span class=n>tp</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;@timestamp&#34;</span><span class=p>:</span> <span class=n>_now_iso</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                            <span class=p>},</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=n>dlq</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>TOPIC_DLQ</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=s2>&#34;normalize_error&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=n>dlq_payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>batch_docs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># ES 벌크 적재 with 재시도</span>
</span></span><span class=line><span class=cl>            <span class=n>attempt</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>es_bulk_index</span><span class=p>(</span><span class=n>es</span><span class=p>,</span> <span class=n>batch_docs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 성공 시 수동 커밋(배치 마지막 오프셋까지)</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=n>tp</span><span class=p>,</span> <span class=n>offset</span> <span class=ow>in</span> <span class=nb>set</span><span class=p>(</span><span class=n>batch_offsets</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=n>consumer</span><span class=o>.</span><span class=n>commit</span><span class=p>({</span><span class=n>tp</span><span class=p>:</span> <span class=n>offset</span> <span class=o>+</span> <span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>attempt</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>attempt</span> <span class=o>&gt;</span> <span class=n>max_retries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 최종 실패: 배치 전체를 DLQ로 전송</span>
</span></span><span class=line><span class=cl>                        <span class=n>dlq_payload</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;es_bulk_error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;docs&#34;</span><span class=p>:</span> <span class=n>batch_docs</span><span class=p>[:</span><span class=mi>10</span><span class=p>],</span>  <span class=c1># DLQ 페이로드 과대 방지(샘플만 저장)</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;meta&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;count&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>batch_docs</span><span class=p>),</span> <span class=s2>&#34;@timestamp&#34;</span><span class=p>:</span> <span class=n>_now_iso</span><span class=p>()},</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=n>dlq</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>TOPIC_DLQ</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=s2>&#34;es_bulk_error&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=n>dlq_payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 실패 배치는 스킵하고 다음 배치로 진행(오프셋 커밋 안 함 → 재처리 가능)</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span>
</span></span><span class=line><span class=cl>                    <span class=n>sleep_s</span> <span class=o>=</span> <span class=n>backoff_base</span> <span class=o>*</span> <span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=p>(</span><span class=n>attempt</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[worker] ES 벌크 실패, 재시도 </span><span class=si>{</span><span class=n>attempt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>max_retries</span><span class=si>}</span><span class=s2> (backoff </span><span class=si>{</span><span class=n>sleep_s</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>s): </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>sleep_s</span><span class=p>,</span> <span class=mf>5.0</span><span class=p>))</span>  <span class=c1># 백오프 상한</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>consumer</span><span class=o>.</span><span class=n>close</span><span class=p>(</span><span class=n>autocommit</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>dlq</span><span class=o>.</span><span class=n>flush</span><span class=p>();</span> <span class=n>dlq</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[worker] 종료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=cl><span class=c1># 엔트리포인트</span>
</span></span><span class=line><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>_install_signal_handlers</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_handler</span><span class=p>(</span><span class=n>signum</span><span class=p>,</span> <span class=n>frame</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>global</span> <span class=n>STOP</span>
</span></span><span class=line><span class=cl>        <span class=n>STOP</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[signal] stop requested (</span><span class=si>{</span><span class=n>signum</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>sig</span> <span class=ow>in</span> <span class=p>[</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGINT</span><span class=p>,</span> <span class=n>signal</span><span class=o>.</span><span class=n>SIGTERM</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>sig</span><span class=p>,</span> <span class=n>_handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>_install_signal_handlers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span> <span class=o>=</span> <span class=n>argparse</span><span class=o>.</span><span class=n>ArgumentParser</span><span class=p>(</span><span class=n>description</span><span class=o>=</span><span class=s2>&#34;Log Processing Pipeline (Collector → Kafka → Worker → Elasticsearch)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sub</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>add_subparsers</span><span class=p>(</span><span class=n>dest</span><span class=o>=</span><span class=s2>&#34;cmd&#34;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sub</span><span class=o>.</span><span class=n>add_parser</span><span class=p>(</span><span class=s2>&#34;setup-topics&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Kafka 토픽(ingest, dlq) 생성&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sub</span><span class=o>.</span><span class=n>add_parser</span><span class=p>(</span><span class=s2>&#34;setup-index&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Elasticsearch 인덱스 생성&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p_col</span> <span class=o>=</span> <span class=n>sub</span><span class=o>.</span><span class=n>add_parser</span><span class=p>(</span><span class=s2>&#34;collector&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;로그 수집기 실행&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p_col</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--service&#34;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;서비스 이름(키로 사용)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p_col</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--logfile&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;tail할 로그 파일 경로(없으면 샘플 이벤트 생성)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p_col</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--host&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;호스트 이름(미지정시 시스템 호스트 사용)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p_w</span> <span class=o>=</span> <span class=n>sub</span><span class=o>.</span><span class=n>add_parser</span><span class=p>(</span><span class=s2>&#34;worker&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;로그 워커 실행&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p_w</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--batch-size&#34;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p_w</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--max-retries&#34;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p_w</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--backoff-base&#34;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>float</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>cmd</span> <span class=o>==</span> <span class=s2>&#34;setup-topics&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>setup_topics</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>cmd</span> <span class=o>==</span> <span class=s2>&#34;setup-index&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>setup_index</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>cmd</span> <span class=o>==</span> <span class=s2>&#34;collector&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>collector_main</span><span class=p>(</span><span class=n>service</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>service</span><span class=p>,</span> <span class=n>logfile</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>logfile</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>cmd</span> <span class=o>==</span> <span class=s2>&#34;worker&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>worker_main</span><span class=p>(</span><span class=n>batch_size</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>batch_size</span><span class=p>,</span> <span class=n>max_retries</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>max_retries</span><span class=p>,</span> <span class=n>backoff_base</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>backoff_base</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Unknown command&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>로그 수집기 (Collector)</strong>: <code>collector_main()</code><ul><li>파일을 tail 하거나 샘플 이벤트를 **Kafka 토픽 <code>logs.ingest</code>**로 전송</li></ul></li><li><strong>큐/브로커 (Kafka)</strong>: <code>setup_topics()</code> 로 <strong><code>logs.ingest</code>/<code>logs.dlq</code></strong> 생성, Producer/Consumer 로 송수신</li><li><strong>워커 (Worker)</strong>: <code>worker_main()</code><ul><li>Kafka 에서 배치 Poll → <code>normalize_record()</code> 로 정규화 → <code>helpers.bulk()</code> 로 <strong>Elasticsearch 적재</strong></li><li>실패 시 지수 백오프 재시도, 최종 실패는 **DLQ(<code>logs.dlq</code>)**로 전송</li></ul></li><li><strong>저장소 (Elasticsearch)</strong>: <code>setup_index()</code> 로 인덱스/매핑 생성 → 벌크 적재</li></ul><h5 id=실시간-알림-시스템-nodejs--redis--websocket>실시간 알림 시스템 (Node.js + Redis + WebSocket)<a hidden class=anchor aria-hidden=true href=#실시간-알림-시스템-nodejs--redis--websocket>#</a></h5><p><strong>시나리오</strong>:</p><ul><li>특정 유저 이벤트 발생 시 실시간 알림 (PUSH, SMS, 이메일 등) 을 비동기로 발송.</li></ul><p><strong>핵심 개념</strong>:</p><ul><li>알림 요청 이벤트 생성 → 알림 이벤트 큐에 등록 → 워커가 비동기 발송.</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>알림 이벤트 생성기 (Notification Producer, API)</li><li>알림 큐 (Notification Queue, Redis/Kafka)</li><li>알림 워커 (Notification Worker, 서버리스 Lambda 등)</li><li>유저 단말 (사용자)</li></ul><pre class=mermaid>graph TB
    A[이벤트 트리거/API] --&gt; B[알림 큐]
    B --&gt; C[알림 워커]
    C --&gt; D[사용자 단말]
</pre><p><strong>실행 개요</strong>:</p><ol><li><p>준비</p><ul><li>Redis 서버 (기본: <code>redis://localhost:6379</code>)</li><li>Node 18+ 권장</li></ul></li><li><p>패키지 설치</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1>1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm init -y
</span></span><span class=line><span class=cl>npm i express redis ws uuid yargs
</span></span></code></pre></td></tr></table></div></div></li><li><p>환경 변수 (옵션)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-50-1><a class=lnlinks href=#hl-50-1>1</a>
</span><span class=lnt id=hl-50-2><a class=lnlinks href=#hl-50-2>2</a>
</span><span class=lnt id=hl-50-3><a class=lnlinks href=#hl-50-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REDIS_URL</span><span class=o>=</span>redis://localhost:6379
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>API_PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GATEWAY_PORT</span><span class=o>=</span><span class=m>3001</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>프로세스 실행<br>각 터미널에서 다음을 각각 실행:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-51-1><a class=lnlinks href=#hl-51-1>1</a>
</span><span class=lnt id=hl-51-2><a class=lnlinks href=#hl-51-2>2</a>
</span><span class=lnt id=hl-51-3><a class=lnlinks href=#hl-51-3>3</a>
</span><span class=lnt id=hl-51-4><a class=lnlinks href=#hl-51-4>4</a>
</span><span class=lnt id=hl-51-5><a class=lnlinks href=#hl-51-5>5</a>
</span><span class=lnt id=hl-51-6><a class=lnlinks href=#hl-51-6>6</a>
</span><span class=lnt id=hl-51-7><a class=lnlinks href=#hl-51-7>7</a>
</span><span class=lnt id=hl-51-8><a class=lnlinks href=#hl-51-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 게이트웨이 (사용자 단말과 WebSocket 연결)</span>
</span></span><span class=line><span class=cl>node rt_notify.js gateway
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 워커 (큐에서 꺼내 실제 발송 처리)</span>
</span></span><span class=line><span class=cl>node rt_notify.js worker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># API (알림 생성기)</span>
</span></span><span class=line><span class=cl>node rt_notify.js api
</span></span></code></pre></td></tr></table></div></div></li><li><p>사용자 단말 시뮬레이터 실행<br>새 터미널에서 유저가 푸시를 받을 수 있도록 접속:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-52-1><a class=lnlinks href=#hl-52-1>1</a>
</span><span class=lnt id=hl-52-2><a class=lnlinks href=#hl-52-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># user-123이라는 사용자가 로그인했다고 가정</span>
</span></span><span class=line><span class=cl>node rt_notify.js device --userId user-123
</span></span></code></pre></td></tr></table></div></div></li><li><p>알림 발송 테스트<br>알림 (푸시/SMS/이메일 중 선택) 을 생성해 큐에 넣어보자:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-53-1><a class=lnlinks href=#hl-53-1>1</a>
</span><span class=lnt id=hl-53-2><a class=lnlinks href=#hl-53-2>2</a>
</span><span class=lnt id=hl-53-3><a class=lnlinks href=#hl-53-3>3</a>
</span><span class=lnt id=hl-53-4><a class=lnlinks href=#hl-53-4>4</a>
</span><span class=lnt id=hl-53-5><a class=lnlinks href=#hl-53-5>5</a>
</span><span class=lnt id=hl-53-6><a class=lnlinks href=#hl-53-6>6</a>
</span><span class=lnt id=hl-53-7><a class=lnlinks href=#hl-53-7>7</a>
</span><span class=lnt id=hl-53-8><a class=lnlinks href=#hl-53-8>8</a>
</span><span class=lnt id=hl-53-9><a class=lnlinks href=#hl-53-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 푸시 + SMS 예시</span>
</span></span><span class=line><span class=cl>curl -X POST http://localhost:3000/notify <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -d <span class=s1>&#39;{&#34;userId&#34;:&#34;user-123&#34;,&#34;message&#34;:&#34;주문이 접수되었습니다.&#34;,&#34;channels&#34;:[&#34;push&#34;,&#34;sms&#34;]}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이메일만</span>
</span></span><span class=line><span class=cl>curl -X POST http://localhost:3000/notify <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -d <span class=s1>&#39;{&#34;userId&#34;:&#34;user-123&#34;,&#34;message&#34;:&#34;영수증이 발행되었습니다.&#34;,&#34;channels&#34;:[&#34;email&#34;]}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>콘솔에서 <strong>게이트웨이</strong>는 푸시를 브로드캐스트하고, <strong>단말 시뮬레이터</strong>는 수신 로그를 출력한다.</li><li><strong>워커</strong>는 큐 소비/재시도/DLQ 기록을 처리하며 SMS/이메일은 스텁 함수로 대체 (예: 실제 연동 자리).</li></ul></li></ol><p><strong>구현 예시</strong>: <code>rt_notify.js</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-54-1><a class=lnlinks href=#hl-54-1>  1</a>
</span><span class=lnt id=hl-54-2><a class=lnlinks href=#hl-54-2>  2</a>
</span><span class=lnt id=hl-54-3><a class=lnlinks href=#hl-54-3>  3</a>
</span><span class=lnt id=hl-54-4><a class=lnlinks href=#hl-54-4>  4</a>
</span><span class=lnt id=hl-54-5><a class=lnlinks href=#hl-54-5>  5</a>
</span><span class=lnt id=hl-54-6><a class=lnlinks href=#hl-54-6>  6</a>
</span><span class=lnt id=hl-54-7><a class=lnlinks href=#hl-54-7>  7</a>
</span><span class=lnt id=hl-54-8><a class=lnlinks href=#hl-54-8>  8</a>
</span><span class=lnt id=hl-54-9><a class=lnlinks href=#hl-54-9>  9</a>
</span><span class=lnt id=hl-54-10><a class=lnlinks href=#hl-54-10> 10</a>
</span><span class=lnt id=hl-54-11><a class=lnlinks href=#hl-54-11> 11</a>
</span><span class=lnt id=hl-54-12><a class=lnlinks href=#hl-54-12> 12</a>
</span><span class=lnt id=hl-54-13><a class=lnlinks href=#hl-54-13> 13</a>
</span><span class=lnt id=hl-54-14><a class=lnlinks href=#hl-54-14> 14</a>
</span><span class=lnt id=hl-54-15><a class=lnlinks href=#hl-54-15> 15</a>
</span><span class=lnt id=hl-54-16><a class=lnlinks href=#hl-54-16> 16</a>
</span><span class=lnt id=hl-54-17><a class=lnlinks href=#hl-54-17> 17</a>
</span><span class=lnt id=hl-54-18><a class=lnlinks href=#hl-54-18> 18</a>
</span><span class=lnt id=hl-54-19><a class=lnlinks href=#hl-54-19> 19</a>
</span><span class=lnt id=hl-54-20><a class=lnlinks href=#hl-54-20> 20</a>
</span><span class=lnt id=hl-54-21><a class=lnlinks href=#hl-54-21> 21</a>
</span><span class=lnt id=hl-54-22><a class=lnlinks href=#hl-54-22> 22</a>
</span><span class=lnt id=hl-54-23><a class=lnlinks href=#hl-54-23> 23</a>
</span><span class=lnt id=hl-54-24><a class=lnlinks href=#hl-54-24> 24</a>
</span><span class=lnt id=hl-54-25><a class=lnlinks href=#hl-54-25> 25</a>
</span><span class=lnt id=hl-54-26><a class=lnlinks href=#hl-54-26> 26</a>
</span><span class=lnt id=hl-54-27><a class=lnlinks href=#hl-54-27> 27</a>
</span><span class=lnt id=hl-54-28><a class=lnlinks href=#hl-54-28> 28</a>
</span><span class=lnt id=hl-54-29><a class=lnlinks href=#hl-54-29> 29</a>
</span><span class=lnt id=hl-54-30><a class=lnlinks href=#hl-54-30> 30</a>
</span><span class=lnt id=hl-54-31><a class=lnlinks href=#hl-54-31> 31</a>
</span><span class=lnt id=hl-54-32><a class=lnlinks href=#hl-54-32> 32</a>
</span><span class=lnt id=hl-54-33><a class=lnlinks href=#hl-54-33> 33</a>
</span><span class=lnt id=hl-54-34><a class=lnlinks href=#hl-54-34> 34</a>
</span><span class=lnt id=hl-54-35><a class=lnlinks href=#hl-54-35> 35</a>
</span><span class=lnt id=hl-54-36><a class=lnlinks href=#hl-54-36> 36</a>
</span><span class=lnt id=hl-54-37><a class=lnlinks href=#hl-54-37> 37</a>
</span><span class=lnt id=hl-54-38><a class=lnlinks href=#hl-54-38> 38</a>
</span><span class=lnt id=hl-54-39><a class=lnlinks href=#hl-54-39> 39</a>
</span><span class=lnt id=hl-54-40><a class=lnlinks href=#hl-54-40> 40</a>
</span><span class=lnt id=hl-54-41><a class=lnlinks href=#hl-54-41> 41</a>
</span><span class=lnt id=hl-54-42><a class=lnlinks href=#hl-54-42> 42</a>
</span><span class=lnt id=hl-54-43><a class=lnlinks href=#hl-54-43> 43</a>
</span><span class=lnt id=hl-54-44><a class=lnlinks href=#hl-54-44> 44</a>
</span><span class=lnt id=hl-54-45><a class=lnlinks href=#hl-54-45> 45</a>
</span><span class=lnt id=hl-54-46><a class=lnlinks href=#hl-54-46> 46</a>
</span><span class=lnt id=hl-54-47><a class=lnlinks href=#hl-54-47> 47</a>
</span><span class=lnt id=hl-54-48><a class=lnlinks href=#hl-54-48> 48</a>
</span><span class=lnt id=hl-54-49><a class=lnlinks href=#hl-54-49> 49</a>
</span><span class=lnt id=hl-54-50><a class=lnlinks href=#hl-54-50> 50</a>
</span><span class=lnt id=hl-54-51><a class=lnlinks href=#hl-54-51> 51</a>
</span><span class=lnt id=hl-54-52><a class=lnlinks href=#hl-54-52> 52</a>
</span><span class=lnt id=hl-54-53><a class=lnlinks href=#hl-54-53> 53</a>
</span><span class=lnt id=hl-54-54><a class=lnlinks href=#hl-54-54> 54</a>
</span><span class=lnt id=hl-54-55><a class=lnlinks href=#hl-54-55> 55</a>
</span><span class=lnt id=hl-54-56><a class=lnlinks href=#hl-54-56> 56</a>
</span><span class=lnt id=hl-54-57><a class=lnlinks href=#hl-54-57> 57</a>
</span><span class=lnt id=hl-54-58><a class=lnlinks href=#hl-54-58> 58</a>
</span><span class=lnt id=hl-54-59><a class=lnlinks href=#hl-54-59> 59</a>
</span><span class=lnt id=hl-54-60><a class=lnlinks href=#hl-54-60> 60</a>
</span><span class=lnt id=hl-54-61><a class=lnlinks href=#hl-54-61> 61</a>
</span><span class=lnt id=hl-54-62><a class=lnlinks href=#hl-54-62> 62</a>
</span><span class=lnt id=hl-54-63><a class=lnlinks href=#hl-54-63> 63</a>
</span><span class=lnt id=hl-54-64><a class=lnlinks href=#hl-54-64> 64</a>
</span><span class=lnt id=hl-54-65><a class=lnlinks href=#hl-54-65> 65</a>
</span><span class=lnt id=hl-54-66><a class=lnlinks href=#hl-54-66> 66</a>
</span><span class=lnt id=hl-54-67><a class=lnlinks href=#hl-54-67> 67</a>
</span><span class=lnt id=hl-54-68><a class=lnlinks href=#hl-54-68> 68</a>
</span><span class=lnt id=hl-54-69><a class=lnlinks href=#hl-54-69> 69</a>
</span><span class=lnt id=hl-54-70><a class=lnlinks href=#hl-54-70> 70</a>
</span><span class=lnt id=hl-54-71><a class=lnlinks href=#hl-54-71> 71</a>
</span><span class=lnt id=hl-54-72><a class=lnlinks href=#hl-54-72> 72</a>
</span><span class=lnt id=hl-54-73><a class=lnlinks href=#hl-54-73> 73</a>
</span><span class=lnt id=hl-54-74><a class=lnlinks href=#hl-54-74> 74</a>
</span><span class=lnt id=hl-54-75><a class=lnlinks href=#hl-54-75> 75</a>
</span><span class=lnt id=hl-54-76><a class=lnlinks href=#hl-54-76> 76</a>
</span><span class=lnt id=hl-54-77><a class=lnlinks href=#hl-54-77> 77</a>
</span><span class=lnt id=hl-54-78><a class=lnlinks href=#hl-54-78> 78</a>
</span><span class=lnt id=hl-54-79><a class=lnlinks href=#hl-54-79> 79</a>
</span><span class=lnt id=hl-54-80><a class=lnlinks href=#hl-54-80> 80</a>
</span><span class=lnt id=hl-54-81><a class=lnlinks href=#hl-54-81> 81</a>
</span><span class=lnt id=hl-54-82><a class=lnlinks href=#hl-54-82> 82</a>
</span><span class=lnt id=hl-54-83><a class=lnlinks href=#hl-54-83> 83</a>
</span><span class=lnt id=hl-54-84><a class=lnlinks href=#hl-54-84> 84</a>
</span><span class=lnt id=hl-54-85><a class=lnlinks href=#hl-54-85> 85</a>
</span><span class=lnt id=hl-54-86><a class=lnlinks href=#hl-54-86> 86</a>
</span><span class=lnt id=hl-54-87><a class=lnlinks href=#hl-54-87> 87</a>
</span><span class=lnt id=hl-54-88><a class=lnlinks href=#hl-54-88> 88</a>
</span><span class=lnt id=hl-54-89><a class=lnlinks href=#hl-54-89> 89</a>
</span><span class=lnt id=hl-54-90><a class=lnlinks href=#hl-54-90> 90</a>
</span><span class=lnt id=hl-54-91><a class=lnlinks href=#hl-54-91> 91</a>
</span><span class=lnt id=hl-54-92><a class=lnlinks href=#hl-54-92> 92</a>
</span><span class=lnt id=hl-54-93><a class=lnlinks href=#hl-54-93> 93</a>
</span><span class=lnt id=hl-54-94><a class=lnlinks href=#hl-54-94> 94</a>
</span><span class=lnt id=hl-54-95><a class=lnlinks href=#hl-54-95> 95</a>
</span><span class=lnt id=hl-54-96><a class=lnlinks href=#hl-54-96> 96</a>
</span><span class=lnt id=hl-54-97><a class=lnlinks href=#hl-54-97> 97</a>
</span><span class=lnt id=hl-54-98><a class=lnlinks href=#hl-54-98> 98</a>
</span><span class=lnt id=hl-54-99><a class=lnlinks href=#hl-54-99> 99</a>
</span><span class=lnt id=hl-54-100><a class=lnlinks href=#hl-54-100>100</a>
</span><span class=lnt id=hl-54-101><a class=lnlinks href=#hl-54-101>101</a>
</span><span class=lnt id=hl-54-102><a class=lnlinks href=#hl-54-102>102</a>
</span><span class=lnt id=hl-54-103><a class=lnlinks href=#hl-54-103>103</a>
</span><span class=lnt id=hl-54-104><a class=lnlinks href=#hl-54-104>104</a>
</span><span class=lnt id=hl-54-105><a class=lnlinks href=#hl-54-105>105</a>
</span><span class=lnt id=hl-54-106><a class=lnlinks href=#hl-54-106>106</a>
</span><span class=lnt id=hl-54-107><a class=lnlinks href=#hl-54-107>107</a>
</span><span class=lnt id=hl-54-108><a class=lnlinks href=#hl-54-108>108</a>
</span><span class=lnt id=hl-54-109><a class=lnlinks href=#hl-54-109>109</a>
</span><span class=lnt id=hl-54-110><a class=lnlinks href=#hl-54-110>110</a>
</span><span class=lnt id=hl-54-111><a class=lnlinks href=#hl-54-111>111</a>
</span><span class=lnt id=hl-54-112><a class=lnlinks href=#hl-54-112>112</a>
</span><span class=lnt id=hl-54-113><a class=lnlinks href=#hl-54-113>113</a>
</span><span class=lnt id=hl-54-114><a class=lnlinks href=#hl-54-114>114</a>
</span><span class=lnt id=hl-54-115><a class=lnlinks href=#hl-54-115>115</a>
</span><span class=lnt id=hl-54-116><a class=lnlinks href=#hl-54-116>116</a>
</span><span class=lnt id=hl-54-117><a class=lnlinks href=#hl-54-117>117</a>
</span><span class=lnt id=hl-54-118><a class=lnlinks href=#hl-54-118>118</a>
</span><span class=lnt id=hl-54-119><a class=lnlinks href=#hl-54-119>119</a>
</span><span class=lnt id=hl-54-120><a class=lnlinks href=#hl-54-120>120</a>
</span><span class=lnt id=hl-54-121><a class=lnlinks href=#hl-54-121>121</a>
</span><span class=lnt id=hl-54-122><a class=lnlinks href=#hl-54-122>122</a>
</span><span class=lnt id=hl-54-123><a class=lnlinks href=#hl-54-123>123</a>
</span><span class=lnt id=hl-54-124><a class=lnlinks href=#hl-54-124>124</a>
</span><span class=lnt id=hl-54-125><a class=lnlinks href=#hl-54-125>125</a>
</span><span class=lnt id=hl-54-126><a class=lnlinks href=#hl-54-126>126</a>
</span><span class=lnt id=hl-54-127><a class=lnlinks href=#hl-54-127>127</a>
</span><span class=lnt id=hl-54-128><a class=lnlinks href=#hl-54-128>128</a>
</span><span class=lnt id=hl-54-129><a class=lnlinks href=#hl-54-129>129</a>
</span><span class=lnt id=hl-54-130><a class=lnlinks href=#hl-54-130>130</a>
</span><span class=lnt id=hl-54-131><a class=lnlinks href=#hl-54-131>131</a>
</span><span class=lnt id=hl-54-132><a class=lnlinks href=#hl-54-132>132</a>
</span><span class=lnt id=hl-54-133><a class=lnlinks href=#hl-54-133>133</a>
</span><span class=lnt id=hl-54-134><a class=lnlinks href=#hl-54-134>134</a>
</span><span class=lnt id=hl-54-135><a class=lnlinks href=#hl-54-135>135</a>
</span><span class=lnt id=hl-54-136><a class=lnlinks href=#hl-54-136>136</a>
</span><span class=lnt id=hl-54-137><a class=lnlinks href=#hl-54-137>137</a>
</span><span class=lnt id=hl-54-138><a class=lnlinks href=#hl-54-138>138</a>
</span><span class=lnt id=hl-54-139><a class=lnlinks href=#hl-54-139>139</a>
</span><span class=lnt id=hl-54-140><a class=lnlinks href=#hl-54-140>140</a>
</span><span class=lnt id=hl-54-141><a class=lnlinks href=#hl-54-141>141</a>
</span><span class=lnt id=hl-54-142><a class=lnlinks href=#hl-54-142>142</a>
</span><span class=lnt id=hl-54-143><a class=lnlinks href=#hl-54-143>143</a>
</span><span class=lnt id=hl-54-144><a class=lnlinks href=#hl-54-144>144</a>
</span><span class=lnt id=hl-54-145><a class=lnlinks href=#hl-54-145>145</a>
</span><span class=lnt id=hl-54-146><a class=lnlinks href=#hl-54-146>146</a>
</span><span class=lnt id=hl-54-147><a class=lnlinks href=#hl-54-147>147</a>
</span><span class=lnt id=hl-54-148><a class=lnlinks href=#hl-54-148>148</a>
</span><span class=lnt id=hl-54-149><a class=lnlinks href=#hl-54-149>149</a>
</span><span class=lnt id=hl-54-150><a class=lnlinks href=#hl-54-150>150</a>
</span><span class=lnt id=hl-54-151><a class=lnlinks href=#hl-54-151>151</a>
</span><span class=lnt id=hl-54-152><a class=lnlinks href=#hl-54-152>152</a>
</span><span class=lnt id=hl-54-153><a class=lnlinks href=#hl-54-153>153</a>
</span><span class=lnt id=hl-54-154><a class=lnlinks href=#hl-54-154>154</a>
</span><span class=lnt id=hl-54-155><a class=lnlinks href=#hl-54-155>155</a>
</span><span class=lnt id=hl-54-156><a class=lnlinks href=#hl-54-156>156</a>
</span><span class=lnt id=hl-54-157><a class=lnlinks href=#hl-54-157>157</a>
</span><span class=lnt id=hl-54-158><a class=lnlinks href=#hl-54-158>158</a>
</span><span class=lnt id=hl-54-159><a class=lnlinks href=#hl-54-159>159</a>
</span><span class=lnt id=hl-54-160><a class=lnlinks href=#hl-54-160>160</a>
</span><span class=lnt id=hl-54-161><a class=lnlinks href=#hl-54-161>161</a>
</span><span class=lnt id=hl-54-162><a class=lnlinks href=#hl-54-162>162</a>
</span><span class=lnt id=hl-54-163><a class=lnlinks href=#hl-54-163>163</a>
</span><span class=lnt id=hl-54-164><a class=lnlinks href=#hl-54-164>164</a>
</span><span class=lnt id=hl-54-165><a class=lnlinks href=#hl-54-165>165</a>
</span><span class=lnt id=hl-54-166><a class=lnlinks href=#hl-54-166>166</a>
</span><span class=lnt id=hl-54-167><a class=lnlinks href=#hl-54-167>167</a>
</span><span class=lnt id=hl-54-168><a class=lnlinks href=#hl-54-168>168</a>
</span><span class=lnt id=hl-54-169><a class=lnlinks href=#hl-54-169>169</a>
</span><span class=lnt id=hl-54-170><a class=lnlinks href=#hl-54-170>170</a>
</span><span class=lnt id=hl-54-171><a class=lnlinks href=#hl-54-171>171</a>
</span><span class=lnt id=hl-54-172><a class=lnlinks href=#hl-54-172>172</a>
</span><span class=lnt id=hl-54-173><a class=lnlinks href=#hl-54-173>173</a>
</span><span class=lnt id=hl-54-174><a class=lnlinks href=#hl-54-174>174</a>
</span><span class=lnt id=hl-54-175><a class=lnlinks href=#hl-54-175>175</a>
</span><span class=lnt id=hl-54-176><a class=lnlinks href=#hl-54-176>176</a>
</span><span class=lnt id=hl-54-177><a class=lnlinks href=#hl-54-177>177</a>
</span><span class=lnt id=hl-54-178><a class=lnlinks href=#hl-54-178>178</a>
</span><span class=lnt id=hl-54-179><a class=lnlinks href=#hl-54-179>179</a>
</span><span class=lnt id=hl-54-180><a class=lnlinks href=#hl-54-180>180</a>
</span><span class=lnt id=hl-54-181><a class=lnlinks href=#hl-54-181>181</a>
</span><span class=lnt id=hl-54-182><a class=lnlinks href=#hl-54-182>182</a>
</span><span class=lnt id=hl-54-183><a class=lnlinks href=#hl-54-183>183</a>
</span><span class=lnt id=hl-54-184><a class=lnlinks href=#hl-54-184>184</a>
</span><span class=lnt id=hl-54-185><a class=lnlinks href=#hl-54-185>185</a>
</span><span class=lnt id=hl-54-186><a class=lnlinks href=#hl-54-186>186</a>
</span><span class=lnt id=hl-54-187><a class=lnlinks href=#hl-54-187>187</a>
</span><span class=lnt id=hl-54-188><a class=lnlinks href=#hl-54-188>188</a>
</span><span class=lnt id=hl-54-189><a class=lnlinks href=#hl-54-189>189</a>
</span><span class=lnt id=hl-54-190><a class=lnlinks href=#hl-54-190>190</a>
</span><span class=lnt id=hl-54-191><a class=lnlinks href=#hl-54-191>191</a>
</span><span class=lnt id=hl-54-192><a class=lnlinks href=#hl-54-192>192</a>
</span><span class=lnt id=hl-54-193><a class=lnlinks href=#hl-54-193>193</a>
</span><span class=lnt id=hl-54-194><a class=lnlinks href=#hl-54-194>194</a>
</span><span class=lnt id=hl-54-195><a class=lnlinks href=#hl-54-195>195</a>
</span><span class=lnt id=hl-54-196><a class=lnlinks href=#hl-54-196>196</a>
</span><span class=lnt id=hl-54-197><a class=lnlinks href=#hl-54-197>197</a>
</span><span class=lnt id=hl-54-198><a class=lnlinks href=#hl-54-198>198</a>
</span><span class=lnt id=hl-54-199><a class=lnlinks href=#hl-54-199>199</a>
</span><span class=lnt id=hl-54-200><a class=lnlinks href=#hl-54-200>200</a>
</span><span class=lnt id=hl-54-201><a class=lnlinks href=#hl-54-201>201</a>
</span><span class=lnt id=hl-54-202><a class=lnlinks href=#hl-54-202>202</a>
</span><span class=lnt id=hl-54-203><a class=lnlinks href=#hl-54-203>203</a>
</span><span class=lnt id=hl-54-204><a class=lnlinks href=#hl-54-204>204</a>
</span><span class=lnt id=hl-54-205><a class=lnlinks href=#hl-54-205>205</a>
</span><span class=lnt id=hl-54-206><a class=lnlinks href=#hl-54-206>206</a>
</span><span class=lnt id=hl-54-207><a class=lnlinks href=#hl-54-207>207</a>
</span><span class=lnt id=hl-54-208><a class=lnlinks href=#hl-54-208>208</a>
</span><span class=lnt id=hl-54-209><a class=lnlinks href=#hl-54-209>209</a>
</span><span class=lnt id=hl-54-210><a class=lnlinks href=#hl-54-210>210</a>
</span><span class=lnt id=hl-54-211><a class=lnlinks href=#hl-54-211>211</a>
</span><span class=lnt id=hl-54-212><a class=lnlinks href=#hl-54-212>212</a>
</span><span class=lnt id=hl-54-213><a class=lnlinks href=#hl-54-213>213</a>
</span><span class=lnt id=hl-54-214><a class=lnlinks href=#hl-54-214>214</a>
</span><span class=lnt id=hl-54-215><a class=lnlinks href=#hl-54-215>215</a>
</span><span class=lnt id=hl-54-216><a class=lnlinks href=#hl-54-216>216</a>
</span><span class=lnt id=hl-54-217><a class=lnlinks href=#hl-54-217>217</a>
</span><span class=lnt id=hl-54-218><a class=lnlinks href=#hl-54-218>218</a>
</span><span class=lnt id=hl-54-219><a class=lnlinks href=#hl-54-219>219</a>
</span><span class=lnt id=hl-54-220><a class=lnlinks href=#hl-54-220>220</a>
</span><span class=lnt id=hl-54-221><a class=lnlinks href=#hl-54-221>221</a>
</span><span class=lnt id=hl-54-222><a class=lnlinks href=#hl-54-222>222</a>
</span><span class=lnt id=hl-54-223><a class=lnlinks href=#hl-54-223>223</a>
</span><span class=lnt id=hl-54-224><a class=lnlinks href=#hl-54-224>224</a>
</span><span class=lnt id=hl-54-225><a class=lnlinks href=#hl-54-225>225</a>
</span><span class=lnt id=hl-54-226><a class=lnlinks href=#hl-54-226>226</a>
</span><span class=lnt id=hl-54-227><a class=lnlinks href=#hl-54-227>227</a>
</span><span class=lnt id=hl-54-228><a class=lnlinks href=#hl-54-228>228</a>
</span><span class=lnt id=hl-54-229><a class=lnlinks href=#hl-54-229>229</a>
</span><span class=lnt id=hl-54-230><a class=lnlinks href=#hl-54-230>230</a>
</span><span class=lnt id=hl-54-231><a class=lnlinks href=#hl-54-231>231</a>
</span><span class=lnt id=hl-54-232><a class=lnlinks href=#hl-54-232>232</a>
</span><span class=lnt id=hl-54-233><a class=lnlinks href=#hl-54-233>233</a>
</span><span class=lnt id=hl-54-234><a class=lnlinks href=#hl-54-234>234</a>
</span><span class=lnt id=hl-54-235><a class=lnlinks href=#hl-54-235>235</a>
</span><span class=lnt id=hl-54-236><a class=lnlinks href=#hl-54-236>236</a>
</span><span class=lnt id=hl-54-237><a class=lnlinks href=#hl-54-237>237</a>
</span><span class=lnt id=hl-54-238><a class=lnlinks href=#hl-54-238>238</a>
</span><span class=lnt id=hl-54-239><a class=lnlinks href=#hl-54-239>239</a>
</span><span class=lnt id=hl-54-240><a class=lnlinks href=#hl-54-240>240</a>
</span><span class=lnt id=hl-54-241><a class=lnlinks href=#hl-54-241>241</a>
</span><span class=lnt id=hl-54-242><a class=lnlinks href=#hl-54-242>242</a>
</span><span class=lnt id=hl-54-243><a class=lnlinks href=#hl-54-243>243</a>
</span><span class=lnt id=hl-54-244><a class=lnlinks href=#hl-54-244>244</a>
</span><span class=lnt id=hl-54-245><a class=lnlinks href=#hl-54-245>245</a>
</span><span class=lnt id=hl-54-246><a class=lnlinks href=#hl-54-246>246</a>
</span><span class=lnt id=hl-54-247><a class=lnlinks href=#hl-54-247>247</a>
</span><span class=lnt id=hl-54-248><a class=lnlinks href=#hl-54-248>248</a>
</span><span class=lnt id=hl-54-249><a class=lnlinks href=#hl-54-249>249</a>
</span><span class=lnt id=hl-54-250><a class=lnlinks href=#hl-54-250>250</a>
</span><span class=lnt id=hl-54-251><a class=lnlinks href=#hl-54-251>251</a>
</span><span class=lnt id=hl-54-252><a class=lnlinks href=#hl-54-252>252</a>
</span><span class=lnt id=hl-54-253><a class=lnlinks href=#hl-54-253>253</a>
</span><span class=lnt id=hl-54-254><a class=lnlinks href=#hl-54-254>254</a>
</span><span class=lnt id=hl-54-255><a class=lnlinks href=#hl-54-255>255</a>
</span><span class=lnt id=hl-54-256><a class=lnlinks href=#hl-54-256>256</a>
</span><span class=lnt id=hl-54-257><a class=lnlinks href=#hl-54-257>257</a>
</span><span class=lnt id=hl-54-258><a class=lnlinks href=#hl-54-258>258</a>
</span><span class=lnt id=hl-54-259><a class=lnlinks href=#hl-54-259>259</a>
</span><span class=lnt id=hl-54-260><a class=lnlinks href=#hl-54-260>260</a>
</span><span class=lnt id=hl-54-261><a class=lnlinks href=#hl-54-261>261</a>
</span><span class=lnt id=hl-54-262><a class=lnlinks href=#hl-54-262>262</a>
</span><span class=lnt id=hl-54-263><a class=lnlinks href=#hl-54-263>263</a>
</span><span class=lnt id=hl-54-264><a class=lnlinks href=#hl-54-264>264</a>
</span><span class=lnt id=hl-54-265><a class=lnlinks href=#hl-54-265>265</a>
</span><span class=lnt id=hl-54-266><a class=lnlinks href=#hl-54-266>266</a>
</span><span class=lnt id=hl-54-267><a class=lnlinks href=#hl-54-267>267</a>
</span><span class=lnt id=hl-54-268><a class=lnlinks href=#hl-54-268>268</a>
</span><span class=lnt id=hl-54-269><a class=lnlinks href=#hl-54-269>269</a>
</span><span class=lnt id=hl-54-270><a class=lnlinks href=#hl-54-270>270</a>
</span><span class=lnt id=hl-54-271><a class=lnlinks href=#hl-54-271>271</a>
</span><span class=lnt id=hl-54-272><a class=lnlinks href=#hl-54-272>272</a>
</span><span class=lnt id=hl-54-273><a class=lnlinks href=#hl-54-273>273</a>
</span><span class=lnt id=hl-54-274><a class=lnlinks href=#hl-54-274>274</a>
</span><span class=lnt id=hl-54-275><a class=lnlinks href=#hl-54-275>275</a>
</span><span class=lnt id=hl-54-276><a class=lnlinks href=#hl-54-276>276</a>
</span><span class=lnt id=hl-54-277><a class=lnlinks href=#hl-54-277>277</a>
</span><span class=lnt id=hl-54-278><a class=lnlinks href=#hl-54-278>278</a>
</span><span class=lnt id=hl-54-279><a class=lnlinks href=#hl-54-279>279</a>
</span><span class=lnt id=hl-54-280><a class=lnlinks href=#hl-54-280>280</a>
</span><span class=lnt id=hl-54-281><a class=lnlinks href=#hl-54-281>281</a>
</span><span class=lnt id=hl-54-282><a class=lnlinks href=#hl-54-282>282</a>
</span><span class=lnt id=hl-54-283><a class=lnlinks href=#hl-54-283>283</a>
</span><span class=lnt id=hl-54-284><a class=lnlinks href=#hl-54-284>284</a>
</span><span class=lnt id=hl-54-285><a class=lnlinks href=#hl-54-285>285</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=ch>#!/usr/bin/env node
</span></span></span><span class=line><span class=cl><span class=ch></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 실시간 알림(Real-Time Notification) 시스템 - 엔드투엔드 예시
</span></span></span><span class=line><span class=cl><span class=cm> * 구성:
</span></span></span><span class=line><span class=cl><span class=cm> *   - 알림 이벤트 생성기(API)       : POST /notify → Redis 큐에 작업 enqueue
</span></span></span><span class=line><span class=cl><span class=cm> *   - 알림 큐(Redis List)          : notification:q (DLQ: notification:dlq)
</span></span></span><span class=line><span class=cl><span class=cm> *   - 알림 워커(Worker)            : BRPOP → 채널별 발송(push/sms/email) → 성공/재시도/DLQ
</span></span></span><span class=line><span class=cl><span class=cm> *   - 푸시 게이트웨이(WebSocket)   : 사용자 단말과 WS 연결, Redis Pub/Sub로 발행된 메시지 푸시
</span></span></span><span class=line><span class=cl><span class=cm> *   - 사용자 단말 시뮬레이터       : WebSocket으로 접속해 푸시 알림 수신
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * 실행 모드:
</span></span></span><span class=line><span class=cl><span class=cm> *   node rt_notify.js api
</span></span></span><span class=line><span class=cl><span class=cm> *   node rt_notify.js worker
</span></span></span><span class=line><span class=cl><span class=cm> *   node rt_notify.js gateway
</span></span></span><span class=line><span class=cl><span class=cm> *   node rt_notify.js device --userId user-123
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * 의존:
</span></span></span><span class=line><span class=cl><span class=cm> *   npm i express redis ws uuid yargs
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>yargs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;yargs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>hideBin</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;yargs/helpers&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>v4</span><span class=o>:</span> <span class=nx>uuidv4</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;uuid&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>WebSocketServer</span><span class=p>,</span> <span class=nx>WebSocket</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;ws&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>createClient</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;redis&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ---- 환경설정 ----
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>REDIS_URL</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REDIS_URL</span> <span class=o>||</span> <span class=s1>&#39;redis://localhost:6379&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>API_PORT</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>API_PORT</span> <span class=o>||</span> <span class=s1>&#39;3000&#39;</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>GATEWAY_PORT</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>GATEWAY_PORT</span> <span class=o>||</span> <span class=s1>&#39;3001&#39;</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 큐 키 &amp; Pub/Sub 채널 prefix
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>Q_MAIN</span> <span class=o>=</span> <span class=s1>&#39;notification:q&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Q_DLQ</span> <span class=o>=</span> <span class=s1>&#39;notification:dlq&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>PUSH_CHANNEL_PREFIX</span> <span class=o>=</span> <span class=s1>&#39;push:user:&#39;</span><span class=p>;</span> <span class=c1>// push:user:&lt;userId&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 공용 유틸: Redis 클라이언트 생성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>mkRedis</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=nx>createClient</span><span class=p>({</span> <span class=nx>url</span><span class=o>:</span> <span class=nx>REDIS_URL</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>client</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;[Redis] Error&#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 공용: 안전 로그 유틸
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>log</span><span class=p>(</span><span class=nx>tag</span><span class=p>,</span> <span class=nx>obj</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>ts</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=nx>ts</span><span class=si>}</span><span class=sb>] [</span><span class=si>${</span><span class=nx>tag</span><span class=si>}</span><span class=sb>]`</span><span class=p>,</span> <span class=nx>obj</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>// 1) 알림 이벤트 생성기(API)
</span></span></span><span class=line><span class=cl><span class=c1>// -----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>startApi</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>redis</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>mkRedis</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * POST /notify
</span></span></span><span class=line><span class=cl><span class=cm>   * body: { userId: string, message: string, channels?: [&#34;push&#34;,&#34;sms&#34;,&#34;email&#34;], idempotencyKey?: string }
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/notify&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=p>{</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>channels</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;push&#39;</span><span class=p>],</span> <span class=nx>idempotencyKey</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span> <span class=o>||</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>userId</span> <span class=o>||</span> <span class=o>!</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>ok</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;userId, message는 필수입니다.&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 멱등성 키 처리(옵션)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>idemKey</span> <span class=o>=</span> <span class=nx>idempotencyKey</span> <span class=o>||</span> <span class=sb>`idem:</span><span class=si>${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>message</span><span class=p>).</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;base64&#39;</span><span class=p>).</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>16</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>set</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>redis</span><span class=p>.</span><span class=nx>setNX</span><span class=p>(</span><span class=nx>idemKey</span><span class=p>,</span> <span class=s1>&#39;1&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>set</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 이미 처리된 요청
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>idempotent</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 멱등성 키 만료(예: 10분)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>redis</span><span class=p>.</span><span class=nx>expire</span><span class=p>(</span><span class=nx>idemKey</span><span class=p>,</span> <span class=mi>600</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 작업 엔큐
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>job</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span><span class=o>:</span> <span class=nx>uuidv4</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>userId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>channels</span><span class=p>,</span>     <span class=c1>// [&#34;push&#34;,&#34;sms&#34;,&#34;email&#34;]
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>attempts</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>  <span class=c1>// 재시도 횟수
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>maxAttempts</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;notification&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>redis</span><span class=p>.</span><span class=nx>lPush</span><span class=p>(</span><span class=nx>Q_MAIN</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>job</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;API:ENQUEUE&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>queue</span><span class=o>:</span> <span class=nx>Q_MAIN</span><span class=p>,</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>channels</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>enqueued</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>jobId</span><span class=o>:</span> <span class=nx>job</span><span class=p>.</span><span class=nx>id</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;API:ERROR&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>ok</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>e</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/health&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>_</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>API_PORT</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;API:START&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>port</span><span class=o>:</span> <span class=nx>API_PORT</span><span class=p>,</span> <span class=nx>redis</span><span class=o>:</span> <span class=nx>REDIS_URL</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1>// 2) 알림 워커(큐 소비 → 채널별 발송 → 성공/재시도/DLQ)
</span></span></span><span class=line><span class=cl><span class=c1>// -------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>startWorker</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>redis</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>mkRedis</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>sub</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>mkRedis</span><span class=p>();</span> <span class=c1>// 게이트웨이로 푸시하기 위한 Pub 전용(여기서는 publish만 사용)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>sendPush</span><span class=p>(</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>payload</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 푸시 게이트웨이에 전달: Redis Pub/Sub로 사용자 채널에 발행
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>ch</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>PUSH_CHANNEL_PREFIX</span><span class=si>}${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>sub</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>ch</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>payload</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>sendSMS</span><span class=p>(</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>payload</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 실제 SMS 연동 자리(예: Twilio 등). 여기선 콘솔만.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;SEND:SMS&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>to</span><span class=o>:</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>text</span><span class=o>:</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>sendEmail</span><span class=p>(</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>payload</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 실제 Email 연동 자리(예: SES/SendGrid). 여기선 콘솔만.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;SEND:EMAIL&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>to</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>@example.com`</span><span class=p>,</span> <span class=nx>subject</span><span class=o>:</span> <span class=s1>&#39;알림&#39;</span><span class=p>,</span> <span class=nx>text</span><span class=o>:</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>message</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;WORKER:START&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>queue</span><span class=o>:</span> <span class=nx>Q_MAIN</span><span class=p>,</span> <span class=nx>dlq</span><span class=o>:</span> <span class=nx>Q_DLQ</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 무한 소비 루프(BRPOP: 블로킹 pop)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>while</span> <span class=p>(</span><span class=kc>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>popped</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>redis</span><span class=p>.</span><span class=nx>brPop</span><span class=p>(</span><span class=nx>Q_MAIN</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span> <span class=c1>// {key, element}
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>job</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>popped</span><span class=p>.</span><span class=nx>element</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>job</span><span class=p>.</span><span class=nx>attempts</span> <span class=o>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>attempts</span> <span class=o>||</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;WORKER:DEQUEUE&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=nx>job</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>userId</span><span class=o>:</span> <span class=nx>job</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>channels</span><span class=o>:</span> <span class=nx>job</span><span class=p>.</span><span class=nx>channels</span><span class=p>,</span> <span class=nx>attempts</span><span class=o>:</span> <span class=nx>job</span><span class=p>.</span><span class=nx>attempts</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 각 채널 발송(병렬 실행 가능하지만 여기선 순차 실행)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>payload</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>userId</span><span class=o>:</span> <span class=nx>job</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>message</span><span class=o>:</span> <span class=nx>job</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span> <span class=nx>jobId</span><span class=o>:</span> <span class=nx>job</span><span class=p>.</span><span class=nx>id</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>ch</span> <span class=k>of</span> <span class=nx>job</span><span class=p>.</span><span class=nx>channels</span> <span class=o>||</span> <span class=p>[])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>ch</span> <span class=o>===</span> <span class=s1>&#39;push&#39;</span><span class=p>)</span>       <span class=kr>await</span> <span class=nx>sendPush</span><span class=p>(</span><span class=nx>job</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>ch</span> <span class=o>===</span> <span class=s1>&#39;sms&#39;</span><span class=p>)</span>   <span class=kr>await</span> <span class=nx>sendSMS</span><span class=p>(</span><span class=nx>job</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>ch</span> <span class=o>===</span> <span class=s1>&#39;email&#39;</span><span class=p>)</span> <span class=kr>await</span> <span class=nx>sendEmail</span><span class=p>(</span><span class=nx>job</span><span class=p>.</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;WORKER:WARN&#39;</span><span class=p>,</span> <span class=sb>`알 수 없는 채널: </span><span class=si>${</span><span class=nx>ch</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 성공 시 다음 반복(오프셋 커밋 개념은 Redis List에는 없음)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;WORKER:SUCCESS&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=nx>job</span><span class=p>.</span><span class=nx>id</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 실패 처리: 재시도 → DLQ
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>failed</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>e</span><span class=o>?</span><span class=p>.</span><span class=nx>message</span> <span class=o>||</span> <span class=s1>&#39;{}&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;WORKER:ERROR&#39;</span><span class=p>,</span> <span class=nx>failed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=nx>_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;WORKER:ERROR&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>.</span><span class=nx>message</span> <span class=o>||</span> <span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 간단화: BRPOP에서 에러가 날 일은 드묾. 개별 발송 실패 시 아래 로직을 적용하면 됨.
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// (여기서는 상단 발송 try/catch로 채널별 실패를 잡아 재시도/백오프/멱등 처리 권장)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1>// 3) 푸시 게이트웨이(WebSocket) ← Redis Pub/Sub 구독
</span></span></span><span class=line><span class=cl><span class=c1>// ------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>startGateway</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// WebSocket 서버
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>wss</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WebSocketServer</span><span class=p>({</span> <span class=nx>port</span><span class=o>:</span> <span class=nx>GATEWAY_PORT</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>redisSub</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>mkRedis</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 사용자별 구독 상태: userId → Set&lt;ws&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>userSockets</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 유저 채널 구독/해제 헬퍼
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>subscribeUser</span><span class=p>(</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>ws</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>userSockets</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>userId</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>userSockets</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>userId</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Set</span><span class=p>());</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 처음 구독 시 Redis Pub/Sub 채널 subscribe
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>ch</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>PUSH_CHANNEL_PREFIX</span><span class=si>}${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>redisSub</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>ch</span><span class=p>,</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 해당 유저에 연결된 모든 소켓으로 브로드캐스트
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>packet</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>conns</span> <span class=o>=</span> <span class=nx>userSockets</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>userId</span><span class=p>)</span> <span class=o>||</span> <span class=k>new</span> <span class=nx>Set</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>sock</span> <span class=k>of</span> <span class=nx>conns</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>sock</span><span class=p>.</span><span class=nx>readyState</span> <span class=o>===</span> <span class=nx>WebSocket</span><span class=p>.</span><span class=nx>OPEN</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>sock</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;push&#39;</span><span class=p>,</span> <span class=p>...</span><span class=nx>packet</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;GATEWAY:SUBSCRIBE&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>userId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>userSockets</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>userId</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>ws</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>unsubscribeUser</span><span class=p>(</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>ws</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>set</span> <span class=o>=</span> <span class=nx>userSockets</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>userId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>set</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>set</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>ws</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>set</span><span class=p>.</span><span class=nx>size</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>userSockets</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>userId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Redis unsubscribe는 생략(간단화). 실제 운영에선 리소스 회수 필요.
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;GATEWAY:UNSUB_ALL&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>userId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>wss</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;connection&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>ws</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>currentUser</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>raw</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>msg</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>raw</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;auth&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>currentUser</span> <span class=o>=</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>userId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=kr>await</span> <span class=nx>subscribeUser</span><span class=p>(</span><span class=nx>currentUser</span><span class=p>,</span> <span class=nx>ws</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;welcome&#39;</span><span class=p>,</span> <span class=nx>userId</span><span class=o>:</span> <span class=nx>currentUser</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=o>:</span> <span class=nx>e</span><span class=p>.</span><span class=nx>message</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>currentUser</span><span class=p>)</span> <span class=nx>unsubscribeUser</span><span class=p>(</span><span class=nx>currentUser</span><span class=p>,</span> <span class=nx>ws</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;GATEWAY:START&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>port</span><span class=o>:</span> <span class=nx>GATEWAY_PORT</span><span class=p>,</span> <span class=nx>redis</span><span class=o>:</span> <span class=nx>REDIS_URL</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1>// 4) 사용자 단말 시뮬레이터(웹소켓 클라이언트)
</span></span></span><span class=line><span class=cl><span class=c1>// ------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>startDevice</span><span class=p>({</span> <span class=nx>userId</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;device 모드에는 --userId 가 필요합니다.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=sb>`ws://localhost:</span><span class=si>${</span><span class=nx>GATEWAY_PORT</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>ws</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WebSocket</span><span class=p>(</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;DEVICE:CONNECT&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>url</span><span class=p>,</span> <span class=nx>userId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;auth&#39;</span><span class=p>,</span> <span class=nx>userId</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>raw</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>msg</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>raw</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>msg</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s1>&#39;push&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 실제 앱에서는 알림 배너/소리/뱃지 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;DEVICE:PUSH&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>payload</span><span class=o>:</span> <span class=nx>msg</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;DEVICE:MSG&#39;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;DEVICE:CLOSE&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;DEVICE:ERROR&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>.</span><span class=nx>message</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>// CLI 진입점
</span></span></span><span class=line><span class=cl><span class=c1>// -----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>argv</span> <span class=o>=</span> <span class=nx>yargs</span><span class=p>(</span><span class=nx>hideBin</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>argv</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>command</span><span class=p>(</span><span class=s1>&#39;api&#39;</span><span class=p>,</span> <span class=s1>&#39;알림 생성기 API 실행&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>command</span><span class=p>(</span><span class=s1>&#39;worker&#39;</span><span class=p>,</span> <span class=s1>&#39;알림 워커 실행&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>command</span><span class=p>(</span><span class=s1>&#39;gateway&#39;</span><span class=p>,</span> <span class=s1>&#39;푸시 게이트웨이(WebSocket) 실행&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>command</span><span class=p>(</span><span class=s1>&#39;device&#39;</span><span class=p>,</span> <span class=s1>&#39;사용자 단말 시뮬레이터 실행&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>y</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>y</span><span class=p>.</span><span class=nx>option</span><span class=p>(</span><span class=s1>&#39;userId&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;string&#39;</span><span class=p>,</span> <span class=nx>demandOption</span><span class=o>:</span> <span class=kc>true</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>demandCommand</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>help</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>argv</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>cmd</span> <span class=o>=</span> <span class=nx>argv</span><span class=p>.</span><span class=nx>_</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>cmd</span> <span class=o>===</span> <span class=s1>&#39;api&#39;</span><span class=p>)</span>       <span class=kr>await</span> <span class=nx>startApi</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>cmd</span> <span class=o>===</span> <span class=s1>&#39;worker&#39;</span><span class=p>)</span>  <span class=kr>await</span> <span class=nx>startWorker</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>cmd</span> <span class=o>===</span> <span class=s1>&#39;gateway&#39;</span><span class=p>)</span> <span class=kr>await</span> <span class=nx>startGateway</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>cmd</span> <span class=o>===</span> <span class=s1>&#39;device&#39;</span><span class=p>)</span>  <span class=kr>await</span> <span class=nx>startDevice</span><span class=p>({</span> <span class=nx>userId</span><span class=o>:</span> <span class=nx>argv</span><span class=p>.</span><span class=nx>userId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>})();</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>알림 이벤트 생성기 (API)</strong> → <code>startApi()</code><ul><li><code>POST /notify</code> 요청을 받아 **Redis List(<code>notification:q</code>)**에 작업을 <strong>lPush</strong></li><li>멱등성 키 (옵션) 로 중복 등록 방지</li></ul></li><li><strong>알림 큐 (Queue)</strong> → Redis List(<code>notification:q</code>) + <strong>DLQ(<code>notification:dlq</code>)</strong></li><li><strong>알림 워커 (Worker)</strong> → <code>startWorker()</code><ul><li><strong>BRPOP</strong>으로 큐 소비 → 채널별 발송 (<code>push/sms/email</code>)</li><li><code>push</code> 는 <strong>Redis Pub/Sub</strong>으로 <code>push:user:&lt;userId></code> 채널에 발행</li></ul></li><li><strong>푸시 게이트웨이 (WebSocket)</strong> → <code>startGateway()</code><ul><li>사용자 단말 WebSocket 연결 관리</li><li>사용자별 Redis Pub/Sub 채널 구독 → 소켓으로 즉시 전달</li></ul></li><li><strong>사용자 단말 (시뮬레이터)</strong> → <code>startDevice()</code><ul><li>WebSocket 으로 게이트웨이에 접속 및 인증 (<code>{type:"auth", userId}</code>)</li><li><code>push</code> 메시지를 수신해 콘솔 출력 (실제 앱: 배너/알림 표시)</li></ul></li></ul><h4 id=통합-및-연계-기술>통합 및 연계 기술<a hidden class=anchor aria-hidden=true href=#통합-및-연계-기술>#</a></h4><p>비동기 실행은 다양한 기술 스택과 결합해 <strong>확장성·복원력·관측성</strong>을 높인다.</p><ul><li><strong>데이터 계층</strong>: MongoDB, PostgreSQL, Redis, Memcached, Elasticsearch 등은 비동기 드라이버·클라이언트를 통해 논블로킹 데이터 접근과 고동시성 처리를 지원한다.</li><li><strong>메시징</strong>: Apache Kafka, RabbitMQ, NATS 등은 비동기 Producer/Consumer 구조와 백프레셔로 안정적 스트리밍을 보장한다.</li><li><strong>신뢰성 패턴</strong>: Resilience4j, Envoy, Istio 의 서킷 브레이커·리트라이·한도제한은 장애 전파를 줄이고 서비스 안정성을 높인다.</li><li><strong>계약·스키마</strong>: AsyncAPI, Protobuf, Avro 는 비동기 API 계약과 스키마 호환성을 보장한다.</li><li><strong>워크플로</strong>: Temporal, Apache Airflow, Argo Workflows 는 장기 실행 작업·Saga 패턴 기반 보상 트랜잭션을 관리한다.</li><li><strong>관측·트레이싱</strong>: OpenTelemetry, Jaeger, Zipkin 은 비동기 호출 경로와 지연 병목을 추적한다.</li><li><strong>DevOps 연계</strong>: Docker, Kubernetes, Jenkins, Terraform 은 비동기 방식으로 빌드·배포·스케일링·인프라 생성 속도를 높인다.</li><li><strong>서비스 메시·API Gateway</strong>: Istio, Linkerd, Kong, AWS API Gateway 는 비동기 서비스 간 호출·라우팅·정책 적용을 자동화한다.</li></ul><table><thead><tr><th>카테고리</th><th>대표 기술</th><th>통합 방식</th><th>비동기 이점</th></tr></thead><tbody><tr><td>데이터 계층</td><td>MongoDB, PostgreSQL, Redis, Memcached, Elasticsearch</td><td>비동기 드라이버·클라이언트</td><td>논블로킹 데이터 처리, 대규모 동시성</td></tr><tr><td>메시징/스트리밍</td><td>Kafka, RabbitMQ, NATS</td><td>비동기 Producer/Consumer, 백프레셔</td><td>안정적 이벤트 전달, 부하 제어</td></tr><tr><td>신뢰성 패턴</td><td>Resilience4j, Envoy, Istio</td><td>서킷 브레이커, 리트라이, 한도제한</td><td>장애 격리, 복원력 향상</td></tr><tr><td>계약·스키마</td><td>AsyncAPI, Protobuf, Avro</td><td>API 계약·데이터 직렬화</td><td>버전 호환, 계약 준수</td></tr><tr><td>워크플로·오케스트레이션</td><td>Temporal, Airflow, Argo</td><td>장기 실행·Saga 패턴</td><td>복잡 비동기 흐름 관리</td></tr><tr><td>관측·트레이싱</td><td>OpenTelemetry, Jaeger, Zipkin</td><td>호출 경로·지연 추적</td><td>병목 분석, 성능 최적화</td></tr><tr><td>DevOps/인프라</td><td>Docker, Kubernetes, Jenkins, Terraform</td><td>병렬 빌드·배포·스케일링</td><td>운영 효율·속도 향상</td></tr><tr><td>서비스 메시/API Gateway</td><td>Istio, Linkerd, Kong, AWS API Gateway</td><td>비동기 호출·트래픽 관리</td><td>정책 자동화, 호출 최적화</td></tr></tbody></table><pre class=mermaid>graph TB
  %% ==== 경계 ====
  subgraph Client[&#34;클라이언트&#34;]
    UIB[웹/모바일 UI]
  end

  subgraph Edge[&#34;엣지 &amp; 연결 계층&#34;]
    APIGW[API Gateway/Kong&lt;br/&gt;- 라우팅/스로틀/인증]
    SM[&#34;Service Mesh (Istio/Linkerd)&lt;br/&gt;Envoy 프록시, 트래픽 정책&#34;]
  end

  subgraph App[&#34;마이크로서비스 계층 (비동기 중심)&#34;]
    SVC_A[Service A&lt;br/&gt;Resilience4j/Envoy: CB/Retry/RateLimit]
    SVC_B[Service B&lt;br/&gt;- 비동기 I/O, 백프레셔]
    SVC_C[Service C&lt;br/&gt;Saga/보상 트랜잭션 참여]
  end

  subgraph Msg[&#34;메시징/스트리밍&#34;]
    KAFKA[Kafka/NATS/RabbitMQ&lt;br/&gt;Topic/Queue, Backpressure]
    SR[Schema Registry&lt;br/&gt;AsyncAPI/Protobuf/Avro]
  end

  subgraph WF[&#34;워크플로/오케스트레이션&#34;]
    TEMP[Temporal/Cadence&lt;br/&gt;Saga/장기 실행 관리]
    ARGO[&#34;Argo/Airflow (배치/파이프라인)&#34;]
  end

  subgraph Data[&#34;데이터 계층&#34;]
    DBW[(Write DBs&lt;br/&gt;PostgreSQL/Mongo)]
    DBR[(Read Models/Cache&lt;br/&gt;Redis/Elasticsearch)]
    OUTBOX[(Outbox 테이블)]
    CDC[Debezium CDC/Connect]
  end

  subgraph Obs[&#34;관측/모니터링&#34;]
    OTEL[OpenTelemetry SDK/Collector]
    JAEGER[Jaeger/Zipkin&lt;br/&gt;- 분산 트레이싱]
    PROM[Prometheus&lt;br/&gt;- 메트릭 스크랩]
    GRAF[Grafana&lt;br/&gt;- 대시보드]
  end

  subgraph DevOps[&#34;플랫폼/운영&#34;]
    DOCKER[Docker]
    K8S[&#34;Kubernetes(HPA/롤링업데이트)&#34;]
    CI[&#34;CI/CD (Jenkins/GitHub Actions)&#34;]
    TF[&#34;Terraform (IaC)&#34;]
  end

  %% ==== 플로우 ====
  UIB --&gt; APIGW --&gt; SM
  SM --&gt; SVC_A
  SM --&gt; SVC_B
  SM --&gt; SVC_C

  %% 서비스 ↔ 메시징
  SVC_A -- 이벤트 발행 --&gt; KAFKA
  SVC_B -- 커맨드/이벤트 소비 --&gt; KAFKA
  SVC_C -- 이벤트 발행/소비 --&gt; KAFKA
  SR --- KAFKA

  %% 사가/워크플로
  SVC_A --&gt; TEMP
  TEMP --&gt; SVC_B
  TEMP --&gt; SVC_C
  ARGO --&gt; SVC_B

  %% 데이터 경로 (Outbox/CDC → 브로커)
  SVC_A --&gt; OUTBOX
  OUTBOX --&gt; DBW
  CDC -- outbox 이벤트 추출 --&gt; KAFKA

  %% 읽기 모델/캐시 업데이트
  KAFKA --&gt; SVC_B
  SVC_B --&gt; DBR

  %% 관측
  SVC_A -. trace/metric/log .-&gt; OTEL
  SVC_B -. trace/metric/log .-&gt; OTEL
  SVC_C -. trace/metric/log .-&gt; OTEL
  OTEL --&gt; JAEGER
  OTEL --&gt; PROM
  PROM --&gt; GRAF
  JAEGER --&gt; GRAF

  %% DevOps 연계
  CI --&gt; DOCKER --&gt; K8S
  TF --&gt; K8S
  K8S --&gt;|오토스케일| App
  K8S --&gt;|서비스 메시 주입| SM
</pre><h3 id=운영-및-최적화-operations--optimization>운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#운영-및-최적화-operations--optimization>#</a></h3><h4 id=보안-및-거버넌스>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스>#</a></h4><p>비동기 환경에서는 <strong>지연과 순서 불확실성</strong>이 보안 리스크를 키움.<br>따라서 인증·인가, 데이터 보호, 무결성, 감사 추적, 규정 준수를 통합적으로 적용하고, 거버넌스는 개발·운영·보안 전주기에 걸쳐 자동화해야 함.</p><table><thead><tr><th>카테고리</th><th>위험 요소</th><th>대응 방안</th><th>구현 예시</th></tr></thead><tbody><tr><td><strong>인증/인가</strong></td><td>토큰 만료·동시 요청 권한 오류</td><td>JWT 갱신, 비동기 권한 체크, HMAC 서명</td><td>토큰 자동 갱신 로직, 콜백 서명 검증</td></tr><tr><td><strong>데이터 보호</strong></td><td>메모리 내 민감 정보 노출</td><td>암호화·즉시 삭제</td><td>처리 후 메모리 클리어</td></tr><tr><td><strong>메시징 무결성</strong></td><td>중복/순서 오류, 변조</td><td>멱등 키, At-least-once + 멱등 처리, 브로커 암호화</td><td>Idempotency Key, TLS 브로커 연결</td></tr><tr><td><strong>감사 로깅</strong></td><td>비동기 흐름 추적 어려움</td><td>분산 트레이싱, Correlation ID</td><td>OpenTelemetry, Jaeger</td></tr><tr><td><strong>규정 준수</strong></td><td>법적 요구 미준수</td><td>GDPR, PCI-DSS, HIPAA, ISO 27001</td><td>비동기 데이터 처리 시 동의·암호화</td></tr><tr><td><strong>운영 거버넌스</strong></td><td>SLA 위반, 용량 부족</td><td>모니터링, 자동 스케일링, 사고 대응</td><td>Prometheus + HPA, Incident Playbook</td></tr><tr><td><strong>개발 거버넌스</strong></td><td>코드 품질·보안 결함</td><td>코드 표준, 리뷰, 보안 테스트 자동화</td><td>SonarQube, CI/CD 보안 스캔</td></tr></tbody></table><h4 id=모니터링-및-관측성>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성>#</a></h4><p>비동기 시스템의 관측성은 <strong>지연·적체·실패</strong>를 즉시 파악하고 <strong>원인 추적</strong>까지 이어지도록 설계해야 한다.</p><ul><li><strong>메트릭 계층</strong>:<ul><li>Event loop lag 로 런타임 지연을 감시 (예: Node <code>perf_hooks</code>), <em>queue depth</em>와 <em>in-flight</em>로 처리 중/대기 중 작업량을 계측, <em>success/fail/retry</em>로 안정성을 수치화, 스트리밍 환경에선 <em>consumer lag</em>로 적체를 직접 측정한다.</li></ul></li><li><strong>트레이싱 계층</strong>:<ul><li>비동기 경계 (예: enqueue→dequeue, submit→complete) 를 <strong>스팬</strong>으로 연결하고, <strong>W3C Trace Context</strong>(<code>traceparent</code>) 를 모든 호출·메시지에 전파해 E2E 경로를 복원한다 (OTel 권장).</li></ul></li><li><strong>로깅 계층</strong>:<ul><li><strong>상관 ID</strong>를 로그에 주입해 트레이스·메트릭과 상호조회가 가능하도록 하고, <strong>샘플링</strong>으로 비용을 제어한다.</li></ul></li><li><strong>플랫폼 구성</strong>:<ul><li>Exporter/Collector(OTel) → <strong>Prometheus/Jaeger/ELK</strong>로 흡수·조회·알림. 대시보드는 <strong>p95/p99 지연</strong>, <strong>큐 적재율 대비 처리율</strong>, <strong>리트라이율</strong>, <strong>consumer lag</strong> 추이를 기본 패널로 둔다.</li></ul></li></ul><table><thead><tr><th>카테고리</th><th>핵심 메트릭/요소</th><th>측정/실행 방법</th><th>임계값 예시 (가이드)</th><th>대응/튜닝 전략</th></tr></thead><tbody><tr><td>런타임 지연</td><td><strong>Event Loop Lag</strong></td><td>Node <code>perf_hooks.monitorEventLoopDelay()</code>, 런타임 전용 프로브</td><td>p95 > 100ms 지속</td><td>CPU 작업 오프로딩, 워커 확장, 핫패스 최적화</td></tr><tr><td>큐 적체</td><td><strong>Queue Depth</strong>, <strong>Enqueue/Dequeue Rate</strong></td><td>브로커/내부 큐 지표 스크랩</td><td>깊이 증가 추세 + 처리율 역전</td><td>생산 제한 (백프레셔), 소비자 스케일아웃</td></tr><tr><td>동시 작업</td><td><strong>In-flight</strong>(진행 중), <strong>Concurrency</strong></td><td>실행기/스케줄러 계측</td><td>커넥션/태스크 상한 근접</td><td>동시성 세마포어, 풀 크기 조정</td></tr><tr><td>안정성</td><td><strong>Success/Fail/Retry</strong></td><td>미들웨어/핵심 경로 카운터</td><td>에러율 > 1% 또는 리트라이 급증</td><td>서킷 브레이커, 타임아웃/재시도 재튜닝</td></tr><tr><td>스트리밍</td><td><strong>Kafka Consumer Lag</strong></td><td>오프셋 차/지연 시간</td><td>랙이 메시지 유입률 대비 증가</td><td>파티션 리밸런싱, prefetch/병렬 소비 조정</td></tr><tr><td>리소스</td><td>CPU/메모리/FD/GC</td><td>노드/컨테이너/런타임 기본 메트릭</td><td>사용률 > 80% 지속</td><td>HPA/오토스케일, GC/메모리 튜닝</td></tr><tr><td>트레이싱</td><td><strong>비동기 경계 연결</strong>, <strong>스팬/링크</strong></td><td>OTel SDK, 큐 작업을 스팬으로 모델링</td><td>누락된 구간</td><td>enqueue→dequeue 에 스팬/링크 삽입</td></tr><tr><td>컨텍스트</td><td><strong>Trace Context 전파</strong></td><td><code>traceparent</code>/<code>tracestate</code> 헤더</td><td>누락 비율 > 0%</td><td>프록시/게이트웨이 포함 전파 강제</td></tr><tr><td>로깅</td><td><strong>상관 ID</strong>, <strong>샘플링</strong></td><td>구조화 로그 (JSON)</td><td>고비용 경로만 샘플링↑</td><td>샘플링 규칙·레이트리밋 적용</td></tr></tbody></table><p>비동기 시스템은 <strong>지연 (event loop lag)</strong>, <strong>적체 (queue/lag)</strong>, <strong>실패/재시도</strong>를 메트릭으로 추적하고, <strong>비동기 경계</strong>를 트레이싱으로 연결하며, <strong>상관 ID</strong>로 로그를 묶어 <strong>세 신호 (Trace·Metric·Log)</strong> 를 상호 참조 가능하게 만들어야 한다.<br>표준 <strong>W3C Trace Context</strong>와 <strong>OpenTelemetry</strong>를 채택하면 서비스·브로커·게이트웨이를 가로질러 <strong>E2E 원인 추적</strong>이 가능해진다.</p><p><strong>관측성 구현 아키텍처</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;애플리케이션 레이어&#34;
        A[Async Application] --&gt; B[Metrics Collector]
        A --&gt; C[Log Aggregator]
        A --&gt; D[Trace Collector]
    end
    
    subgraph &#34;수집 레이어&#34;
        B --&gt; E[Prometheus]
        C --&gt; F[ELK Stack]
        D --&gt; G[Jaeger/Zipkin]
    end
    
    subgraph &#34;시각화 레이어&#34;
        E --&gt; H[Grafana]
        F --&gt; I[Kibana]
        G --&gt; J[Jaeger UI]
    end
    
    subgraph &#34;알림 레이어&#34;
        H --&gt; K[AlertManager]
        I --&gt; L[ElastAlert]
        J --&gt; M[Custom Alerts]
    end
</pre><h4 id=실무-적용-고려사항-및-주의점>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점>#</a></h4><table><thead><tr><th>카테고리</th><th>고려사항</th><th>주의점 (리스크)</th><th>권장사항</th><th>모니터링 지표</th><th>실무 예시</th></tr></thead><tbody><tr><td>아키텍처/경계</td><td>I/O 비동기·CPU 오프로딩</td><td>모든 것 비동기화로 복잡도↑</td><td>경계 명확화, 동기 계산은 동기</td><td>블로킹 시간, 핫패스 비율</td><td>파일 I/O 는 async, 해싱은 워커 풀</td></tr><tr><td>동시성·흐름 제어</td><td>동시성 상한/백프레셔</td><td>폭풍 리트라이, OOM</td><td>세마포어·토큰버킷·윈도우, 큐 기반 스로틀</td><td>큐 길이/체류시간, 소비율</td><td>API 게이트웨이 throttling, Kafka quota</td></tr><tr><td>에러·탄력성</td><td>타임아웃/재시도/서킷</td><td>테일 지연 폭증, 다운스트림 DoS</td><td>지수 백오프 + 지터, 서킷, 타임 예산 전파</td><td>재시도율, 서킷 상태, P99</td><td>외부 API 호출 타임리미터 + 서킷 브레이커</td></tr><tr><td>데이터 의미론</td><td>멱등/순서/스키마</td><td>중복/유실/순서 왜곡</td><td>Idempotency-Key, Outbox/Saga, 스키마 버전</td><td>중복률, 보정 처리율</td><td>결제 영수증 발행 멱등키, CDC+Outbox</td></tr><tr><td>성능·자원</td><td>루프 블로킹 금지/풀 사이징</td><td>루프 정지, 컨텍스트 스위칭 폭증</td><td>긴 작업은 풀로, 풀은 <code>Ncpu±ε</code>/I/O 별도</td><td>이벤트 루프 지연, CPU/메모리</td><td>이미지 변환은 워커, async 서버 메인은 가볍게</td></tr><tr><td>관측성·디버깅</td><td>Trace/Metric/Log</td><td>비동기 체인 가시성↓</td><td>Trace-Id 전파, 샘플링, 구조화 로그</td><td>P95/99, 에러율, lag, 드롭률</td><td>OpenTelemetry, AsyncLocal/Context 전파</td></tr><tr><td>테스팅·품질</td><td>결정적 테스트</td><td>타이밍 의존·플레이키</td><td>가짜 타이머/클록, 모킹, 계약 테스트</td><td>실패 재현율, flaky 비율</td><td>sinon.useFakeTimers(), 컨슈머 그룹 테스트</td></tr><tr><td>보안·컴플라이언스</td><td>채널 보안/PII/시크릿</td><td>재전송/위조, 데이터 과보존</td><td>TLS, 서명/HMAC, 보존·파기 정책</td><td>인증 실패율, 만료 키 비율</td><td>웹훅 서명 검증, ILM/TTL 적용</td></tr><tr><td>운영·스케일링</td><td>오토스케일/릴리즈 전략</td><td>급격한 스파이크, 롤백 난도</td><td>HPA, Admission Control, 카나리/다크런</td><td>HPA 이벤트, 드롭율, 스로틀 이벤트</td><td>워커 샤딩, 피처 플래그 롤아웃</td></tr></tbody></table><ul><li><strong>경계가 품질을 결정</strong>: &ldquo;I/O 는 비동기, CPU 는 오프로딩 " 원칙이 가장 큰 이득을 준다.</li><li><strong>흐름 제어가 안전장치</strong>: 백프레셔·Admission·재시도 정책 없이는 리트라이 폭풍과 큐 적체가 발생한다.</li><li><strong>시간 예산이 체인을 지배</strong>: 타임아웃·서킷·지수 백오프 (+ 지터) 를 호출 체인 전체로 전파해야 테일 지연을 누른다.</li><li><strong>정확성은 멱등 +Outbox 에서 온다</strong>: 중복·순서 문제는 사전에 의미론을 선택하고 구현해야 한다.</li><li><strong>루프는 절대 막지 말 것</strong>: 긴 동기 작업은 풀로, 이벤트 루프는 얇게 유지한다.</li><li><strong>가시성 없는 비동기는 운영이 불가능</strong>: Trace-Id/메트릭/로그 표준화가 필수.</li><li><strong>테스트는 시간·네트워크를 통제</strong>: 가짜 타이머/모킹/계약 테스트로 결정성을 만든다.</li><li><strong>보안/컴플라이언스는 초반 설계</strong>: 서명 검증·TLS·보존 정책을 초기에 도입한다.</li><li><strong>스케일링은 자동화 + 안전 롤아웃</strong>: HPA/Admission/카나리로 안전하게 확장한다.</li></ul><h4 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h4><p><strong>큐 및 부하 관리</strong></p><ul><li>큐 깊이를 모니터링하고, 과도한 적체 시 백프레셔 적용.</li><li>큐 크기·배치 크기·처리율을 동적으로 조정.</li></ul><p><strong>워커 및 병렬도 최적화</strong></p><ul><li>CPU 코어·I/O 부하에 따라 워커 수 및 병렬도를 조정.</li><li>적응형 스케일링 도입으로 부하 변화에 대응.</li></ul><p><strong>이벤트 루프 및 스케줄링 효율화</strong></p><ul><li>장기 실행 작업은 스레드풀로 위임.</li><li>우선순위 큐, 라운드 로빈, 공정 스케줄링 활용.</li></ul><p><strong>네트워크/DB 자원 활용 최적화</strong></p><ul><li>Keep-Alive, 연결 풀링, HTTP/2 활용.</li><li>풀 크기 관리와 풀 고갈 모니터링 필수.</li></ul><p><strong>메모리 관리 및 객체 재사용</strong></p><ul><li>객체 풀링 (Object Pooling) 으로 GC 부하 감소.</li><li>이벤트 리스너·타이머 해제, WeakMap 으로 메모리 누수 방지.</li></ul><p><strong>데이터 일관성 및 신뢰성 보장</strong></p><ul><li>멱등성 키로 중복 처리 방지.</li><li>재시도·백오프 알고리즘으로 장애 복구.</li></ul><p><strong>모니터링 및 자동화</strong></p><ul><li>CPU, 메모리, 큐 길이, 지연 시간 실시간 수집.</li><li>APM, 경고 시스템, 자동 조정 로직 통합.</li></ul><p><strong>성능 벤치마킹 및 피드백 루프</strong></p><ul><li>최적화 후 벤치마크 측정.</li><li>결과를 기반으로 튜닝 반복.</li></ul><table><thead><tr><th>카테고리</th><th>최적화 포인트</th><th>구현/권장사항</th><th>주의점</th></tr></thead><tbody><tr><td>큐 및 부하 관리</td><td>큐 깊이·적체 관리</td><td>백프레셔, 동적 배치 크기 조정</td><td>과도한 배치로 지연 증가 가능</td></tr><tr><td>워커 및 병렬도 최적화</td><td>CPU/I/O 기반 워커 수 조정</td><td>적응형 스케일링</td><td>과다 병렬은 경합 유발</td></tr><tr><td>이벤트 루프 및 스케줄링</td><td>장기 작업 위임, 우선순위 처리</td><td>스레드풀 위임, 우선순위 큐</td><td>복잡성 증가</td></tr><tr><td>네트워크/DB 자원 활용</td><td>연결 재사용, 풀링</td><td>Keep-Alive, HTTP/2, 풀 모니터링</td><td>풀 고갈 시 성능 저하</td></tr><tr><td>메모리 관리 및 객체 재사용</td><td>GC 부하 감소</td><td>객체 풀링, 리스너 정리</td><td>풀 크기 초과 시 메모리 낭비</td></tr><tr><td>데이터 일관성·신뢰성</td><td>멱등성·재시도</td><td>Idempotency Key, 백오프</td><td>재시도 폭주 주의</td></tr><tr><td>모니터링 및 자동화</td><td>실시간 지표, 알림</td><td>APM, 경고 시스템</td><td>경고 남발로 노이즈 증가</td></tr><tr><td>성능 벤치마킹·피드백</td><td>지속적 튜닝</td><td>주기적 벤치마크, 자동 피드백</td><td>측정 환경 일관성 유지</td></tr></tbody></table><h3 id=고급-주제-advanced-topics>고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#고급-주제-advanced-topics>#</a></h3><h4 id=현재-도전-과제>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제>#</a></h4><ul><li><p><strong>코드·설계 복잡성</strong>:<br>콜백 지옥과 파편화된 에러 흐름이 가독성을 해치고, 팀 규모가 커질수록 일관된 패턴 유지가 어렵다. <em>async/await</em>, <strong>구조적 동시성</strong>, 표준 에러 규약으로 흐름을 단순화한다.</p></li><li><p><strong>동시성·정합성 보장</strong>:<br>공유 상태 접근과 순서·정합성은 비동기에서 가장 까다롭다. <strong>뮤텍스/세마포어</strong>, <strong>불변 데이터</strong>, <strong>파티션 키 기반 순서 보장</strong>, <strong>멱등성 키</strong>로 안전망을 구축한다.</p></li><li><p><strong>자원·성능·스케줄링</strong>:<br>백프레셔 실패, 루프 블로킹, 우선순위 역전은 적체와 테일 레이턴시를 유발한다. <strong>동시성 상한</strong>, <strong>prefetch/윈도 제한</strong>, <strong>워커 오프로딩</strong>, <strong>우선순위 큐/공정성 정책</strong>을 도입한다.</p></li><li><p><strong>신뢰성·복구·트랜잭션</strong>:<br>장기 실행·부분 실패·재시도 폭주는 연쇄 장애로 번진다. <strong>Saga/보상 트랜잭션</strong>, <strong>서킷브레이커 + 타임아웃 + 재시도 (지수 백오프)</strong>, <strong>격벽</strong>으로 파급을 차단한다.</p></li><li><p><strong>운영·관측·보안·비용</strong>:<br><code>traceparent</code> 전파, <strong>상관 ID</strong> 로깅, <strong>consumer lag/loop lag</strong> 모니터링으로 원인 추적 경로를 확보한다. Abuse 방지를 위해 <strong>레이트리밋/쿼터/Idempotency-Key</strong>와 <strong>비용 SLO</strong>를 같이 운영한다.</p></li></ul><table><thead><tr><th>카테고리</th><th>도전 과제</th><th>원인</th><th>영향</th><th>탐지/지표</th><th>해결방안</th><th>구현 단서</th></tr></thead><tbody><tr><td>코드·설계</td><td>콜백 지옥/에러 전파</td><td>중첩 콜백, 비선형 흐름</td><td>가독성↓, 버그↑</td><td>예외 미처리율, 코드 스멜</td><td>async/await, 구조적 동시성, 에러 규약</td><td><code>TaskGroup/supervisor</code>, 공통 에러 타입</td></tr><tr><td>코드·설계</td><td>멱등성 부재</td><td>중복 전달/재시도</td><td>데이터 중복/부정합</td><td>중복률, 재시도율</td><td>Idempotency-Key, 멱등 API</td><td>키 해시·버전 필드, 사가 보상</td></tr><tr><td>동시성·정합성</td><td>레이스 컨디션</td><td>공유 자원 동시 접근</td><td>데이터 불일치</td><td>실패 케이스 리플레이</td><td>뮤텍스/세마포어, 불변구조</td><td>&ldquo;withLock&rdquo; 래퍼, 원자 연산</td></tr><tr><td>동시성·정합성</td><td>순서 보장 붕괴</td><td>재균형, 멀티컨슈머</td><td>비즈니스 오류</td><td>out-of-order 비율</td><td>파티션·키 설계, 재정렬</td><td>파티션당 단일 소비, 타임스탬프 정렬</td></tr><tr><td>자원·성능</td><td>백프레셔 실패</td><td>무제한 생산, 느린 소비</td><td>OOM, 타임아웃</td><td>큐 깊이, 드롭률</td><td>토큰/리키 버킷, prefetch 제한</td><td><code>semaphore</code>, <code>prefetch(1..N)</code></td></tr><tr><td>자원·성능</td><td>루프 블로킹</td><td>CPU-heavy 작업</td><td>지연 증가 (p99↑)</td><td>event loop lag</td><td>워커/프로세스 오프로딩</td><td><code>run_in_executor</code>, 워커 스레드</td></tr><tr><td>자원·성능</td><td>우선순위 역전</td><td>단일 큐·공정성 결여</td><td>기아 (Starvation)</td><td>대기시간 편차</td><td>우선순위 큐, 멀티큐</td><td>MLFQ, 클래스별 레이트</td></tr><tr><td>신뢰성·복구</td><td>재시도 폭주</td><td>타임아웃 미설계</td><td>장애 증폭</td><td>재시도율 스파이크</td><td>지수 백오프 + 지터, 서킷브레이커</td><td><code>Retry-After</code>, 실패 임계치</td></tr><tr><td>신뢰성·복구</td><td>장기 실행/사가</td><td>분산 트랜잭션 부재</td><td>보정 어려움</td><td>보상 실패율</td><td>Saga 패턴, 오케스트레이션</td><td>Temporal/Cadence, 보상 단계</td></tr><tr><td>운영·관측·보안</td><td>관측성 결핍</td><td>컨텍스트 미전파</td><td>MTTR↑</td><td>trace 연계율, 누락율</td><td>W3C Trace Context, OTel</td><td><code>traceparent</code> 주입/추출</td></tr><tr><td>운영·관측·보안</td><td>Abuse/비용 폭발</td><td>봇/재시도 남용</td><td>비용/장애↑</td><td>429 비율, 코스트</td><td>레이트리밋·쿼터·서명</td><td>게이트웨이·WAF, 정책 헤더</td></tr><tr><td>운영·관측·보안</td><td>서버리스 제약</td><td>콜드 스타트, 동시성 한계</td><td>지연·비용↑</td><td>콜드 스타트 비율</td><td>프리워밍·동시성 제어</td><td>예약 호출·큐 방어선</td></tr></tbody></table><h4 id=생태계-및-관련-기술>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술>#</a></h4><table><thead><tr><th>카테고리</th><th>대표 기술</th><th>핵심 역할</th><th>강점</th><th>주의/한계</th><th>주 사용처</th></tr></thead><tbody><tr><td>커널/OS I/O</td><td>io_uring, IOCP, epoll/kqueue</td><td>저수준 비동기 I/O/이벤트 통지</td><td>낮은 오버헤드/고성능</td><td>OS 별 특성/이식성</td><td>고성능 서버, 런타임 기반</td></tr><tr><td>런타임/스케줄러</td><td>Node.js, asyncio, <strong>Tokio</strong>, <strong>가상 스레드</strong></td><td>태스크·코루틴 스케줄링</td><td>개발 생산성↑, 확장성↑</td><td>블로킹 콜 경계 관리</td><td>API 서버, 프록시, 마이크로서비스</td></tr><tr><td>리액티브/액터</td><td>Reactive Streams, Reactor, Akka, Orleans</td><td>백프레셔/비동기 모델링, 상태 격리</td><td>조합성/탄력성</td><td>학습곡선</td><td>복합 워크플로, 분산 상태 서비스</td></tr><tr><td>표준/프로토콜</td><td><strong>HTTP/3(QUIC)</strong>, WebTransport, gRPC 스트리밍, WebSocket, MQTT, SSE</td><td>저지연·다중스트림·퍼브섭</td><td>다양한 실시간 패턴</td><td>호환성/배포 난이도</td><td>실시간 게이트웨이/IoT/스트리밍</td></tr><tr><td>메시징/브로커</td><td>Kafka, RabbitMQ(참고)</td><td>버퍼링/리플레이/파티셔닝</td><td>내고장성/확장</td><td>스키마/순서 관리</td><td>이벤트 드리븐, 데이터 파이프라인</td></tr><tr><td>플랫폼/네트워킹</td><td>Kubernetes, Service Mesh/게이트웨이</td><td>배포/트래픽/회복력</td><td>운영 자동화</td><td>복잡도↑</td><td>대규모 운영/제로다운타임</td></tr><tr><td>관측성/운영</td><td><strong>OpenTelemetry</strong>, APM/트레이싱</td><td>표준 계측/가시성</td><td>도구 생태계 활발</td><td>표준화 작업 필요</td><td>SLO/장애분석/튜닝</td></tr></tbody></table><ul><li><strong>OS 프리미티브 → 런타임/프레임워크 → 프로토콜/브로커 → 플랫폼/관측성</strong>으로 <strong>수직 스택</strong>이 맞물린다.</li><li><strong>HTTP/3/QUIC·WebTransport·gRPC 스트리밍</strong>은 저지연/다중 스트림 실시간 전송의 현대 표준축.</li><li><strong>Reactive Streams(백프레셔)</strong> 와 <strong>Kafka</strong>는 생산/소비 속도 정합의 핵심 조합.</li><li><strong>Tokio/가상 스레드</strong> 같은 현대 런타임은 코드 복잡도를 낮추며 확장성·관측성 품질을 끌어올린다.</li></ul><h5 id=간단-연결도-메모용>간단 연결도 (메모용)<a hidden class=anchor aria-hidden=true href=#간단-연결도-메모용>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-57-1><a class=lnlinks href=#hl-57-1> 1</a>
</span><span class=lnt id=hl-57-2><a class=lnlinks href=#hl-57-2> 2</a>
</span><span class=lnt id=hl-57-3><a class=lnlinks href=#hl-57-3> 3</a>
</span><span class=lnt id=hl-57-4><a class=lnlinks href=#hl-57-4> 4</a>
</span><span class=lnt id=hl-57-5><a class=lnlinks href=#hl-57-5> 5</a>
</span><span class=lnt id=hl-57-6><a class=lnlinks href=#hl-57-6> 6</a>
</span><span class=lnt id=hl-57-7><a class=lnlinks href=#hl-57-7> 7</a>
</span><span class=lnt id=hl-57-8><a class=lnlinks href=#hl-57-8> 8</a>
</span><span class=lnt id=hl-57-9><a class=lnlinks href=#hl-57-9> 9</a>
</span><span class=lnt id=hl-57-10><a class=lnlinks href=#hl-57-10>10</a>
</span><span class=lnt id=hl-57-11><a class=lnlinks href=#hl-57-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[OS I/O] io_uring/epoll/IOCP/kqueue
</span></span><span class=line><span class=cl>   ↓
</span></span><span class=line><span class=cl>[런타임] Node/asyncio/Tokio/가상스레드
</span></span><span class=line><span class=cl>   ↓
</span></span><span class=line><span class=cl>[모델] Reactive Streams / Actor(Orleans/Akka)
</span></span><span class=line><span class=cl>   ↓
</span></span><span class=line><span class=cl>[프로토콜] HTTP/3(QUIC)/WebTransport/gRPC/WebSocket/MQTT/SSE
</span></span><span class=line><span class=cl>   ↓
</span></span><span class=line><span class=cl>[브로커/데이터] Kafka 등
</span></span><span class=line><span class=cl>   ↓
</span></span><span class=line><span class=cl>[플랫폼/운영] K8s/Service Mesh/GW + OpenTelemetry
</span></span></code></pre></td></tr></table></div></div><h4 id=최신-기술-트렌드와-미래-방향>최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드와-미래-방향>#</a></h4><p>비동기 실행의 최신 트렌드는 언어·런타임 차원에서의 경량 스레드 (Virtual Threads) 와 구조적 동시성 확산, 플랫폼 측면에서는 WASM/WASI 비동기 지원과 엣지 컴퓨팅 기반 초저지연 환경 구축이 핵심이다.<br>AI/ML 과 GPU 기반 비동기 처리의 결합은 실시간 분석·추론을 가능하게 하고, 클라우드 네이티브 환경에서는 AsyncAPI 표준, Pub/Sub, Serverless 장기 실행 워크플로가 산업 전반에서 채택되고 있다.<br>프로그래밍 패턴은 Promise Chaining 에서 async/await 와 병렬 처리 API 로 진화하고 있다.</p><table><thead><tr><th>카테고리</th><th>기술/트렌드</th><th>설명</th><th>예상 영향</th></tr></thead><tbody><tr><td>언어·런타임</td><td>Virtual Threads</td><td>Java 21 경량 스레드, 대규모 동시성 처리</td><td>고성능, 저메모리</td></tr><tr><td>언어·런타임</td><td>Structured Concurrency</td><td>에러·취소 전파 구조화</td><td>안정성, 유지보수성</td></tr><tr><td>플랫폼·인프라</td><td>WASM/WASI 비동기</td><td>브라우저·서버 고성능 비동기 실행</td><td>언어 통합, 속도</td></tr><tr><td>플랫폼·인프라</td><td>Edge Computing</td><td>MEC 기반 초저지연 비동기 처리</td><td>실시간성 향상</td></tr><tr><td>AI·데이터</td><td>비동기 AI 추론</td><td>AI 모델 비동기 로딩·처리</td><td>실시간 AI 응답</td></tr><tr><td>AI·데이터</td><td>GPU 비동기 스케줄링</td><td>CUDA Streams, Triton 활용</td><td>고속 대규모 추론</td></tr><tr><td>클라우드·분산</td><td>AsyncAPI</td><td>이벤트 기반 API 표준화</td><td>상호운용성</td></tr><tr><td>클라우드·분산</td><td>Serverless 장기 실행</td><td>Step Functions, Temporal</td><td>복잡 워크플로 지원</td></tr><tr><td>패턴·기법</td><td>Promise Chaining → async/await</td><td>가독성·에러 처리 개선</td><td>개발 효율성</td></tr></tbody></table><hr><h2 id=정리-및-학습-가이드>정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#정리-및-학습-가이드>#</a></h2><h3 id=내용-정리>내용 정리<a hidden class=anchor aria-hidden=true href=#내용-정리>#</a></h3><p>비동기 실행은 대기 시간이 큰 I/O 를 비차단으로 처리해 <strong>응답성·처리량·자원 효율</strong>을 동시에 끌어올리는 현대적 실행 모델이다.</p><p>구현은 콜백·Promise/Future·async/await·코루틴 같은 <strong>언어 패턴</strong>, 이벤트 루프와 워커 풀을 결합한 <strong>런타임 모델</strong>, 스트림·배압을 포함하는 <strong>리액티브/메시징 아키텍처</strong>로 전개된다.<br>핵심 구성 요소는 이벤트 루프, 작업/마이크로태스크 큐, 워커, 커널 이벤트 인터페이스이며, 네트워크·파일 I/O·UI·스트리밍에서 큰 효과를 보인다.</p><p>동시에 <strong>상태 일관성·순서 보장·에러 전파·디버깅</strong>은 난제로 남는다. 이를 완화하려면 구조적 동시성과 취소·타임아웃 전파를 표준화하고, 멱등성·사가·서킷브레이커·레이트리밋·백프레셔로 실패·폭주를 고립시켜야 한다.</p><p>운영 측면에서는 event loop lag, queue depth, in-flight, 성공/실패/재시도, 스트리밍 lag 등을 지속 계측하고, W3C Trace Context 와 OpenTelemetry 로 <strong>비동기 경계까지 연결된 트레이싱</strong>을 구축하는 것이 중요하다.</p><p>클라우드 네이티브 전환과 함께 서버리스·마이크로서비스·엣지 실행 환경이 확산되며, io_uring·가상 스레드 같은 런타임/커널 혁신이 더해져 선택지는 넓어졌다.</p><p>궁극적으로는 <strong>업무 요구·지연 예산·비용 제약</strong>을 기준으로 적합한 비동기 스타일을 선택하고, <strong>SLO 기반 모니터링과 회복 탄력성 패턴</strong>을 결합해 전체 수명주기 (설계–구현–배포–운영) 를 관통하는 체계를 갖추는 것이 핵심이다.</p><table><thead><tr><th>축 (관점)</th><th>핵심 내용</th><th>대표 기법/예시</th><th>주요 리스크</th><th>운영 지표/가드레일</th></tr></thead><tbody><tr><td>실행 모델</td><td>I/O 비차단으로 응답성·처리량 증대</td><td>이벤트 루프 + 워크풀, 코루틴</td><td>CPU 바운드 블로킹</td><td>event loop lag, CPU 오프로딩 비율</td></tr><tr><td>언어 패턴</td><td>콜백→Promise/Future→async/await</td><td>Python asyncio, JS async/await</td><td>에러 전파·중첩 흐름</td><td>일관 에러 규약, await 누락 린팅</td></tr><tr><td>데이터플로우</td><td>스트림·배압으로 폭주 제어</td><td>Reactive Streams, backpressure</td><td>큐 적체·메모리 압박</td><td>queue depth, drop/timeout 율</td></tr><tr><td>동시성 모델</td><td>상태 격리/메시지 기반</td><td>액터, CSP(채널)</td><td>순서·정합성, 팬아웃 폭주</td><td>파티션 키, 동시성 상한·세마포어</td></tr><tr><td>아키텍처</td><td>비동기 메시징·오케스트레이션</td><td>Kafka/RabbitMQ, Saga/Temporal</td><td>정확히 한 번 환상</td><td>멱등 키, 보상 트랜잭션</td></tr><tr><td>관측/운영</td><td>3 신호 (Trace/Metric/Log) 통합</td><td>OTel + W3C Trace Context</td><td>비동기 경계 단절</td><td>traceparent 전파율, 스팬 누락 제로화</td></tr><tr><td>신뢰성/보안</td><td>실패 격리·비용/남용 방지</td><td>서킷브레이커, 레이트리밋, 격벽</td><td>재시도 폭주·Abuse</td><td>429 비율, 재시도 지터·쿼터</td></tr></tbody></table><h3 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h3><table><thead><tr><th>단계</th><th>기간</th><th>학습 목표</th><th>핵심 토픽</th><th>실습 미션</th><th>산출물/평가 지표</th></tr></thead><tbody><tr><td>1. 기초</td><td>1–2 주</td><td>비동기 문법·루프 이해</td><td>동기/비동기, Promise, async/await, 이벤트 루프</td><td>순차/병렬/조건부 실행 미니앱</td><td>코드 스니펫, 단위테스트, RPS 측정</td></tr><tr><td>2. 핵심</td><td>2–3 주</td><td>운영 품질 제어</td><td>에러, 타임아웃/취소, 재시도 + 지터, 서킷, 백프레셔</td><td>외부 API 타임 예산·동시성 제한 구현</td><td>p95↓, 오류율/리트라이율, 폭주 미발생</td></tr><tr><td>3. 응용</td><td>3–4 주</td><td>아키텍처 적용</td><td>브로커 (큐/스트림), gRPC/SSE/WS, 워커 풀, 멱등/Outbox</td><td>알림/로그 파이프라인 구축</td><td>큐 지연, DLQ 률, 장애주입 내성</td></tr><tr><td>4. 고급/전문가</td><td>지속</td><td>분산·대규모 운영</td><td>구조적 동시성, io_uring/IOCP, HTTP/3/QUIC, CQRS/ES/Saga</td><td>OTel 기반 E2E 관측·카나리/다크런</td><td>배포 안정성, 비용/성능 지표, SLO 충족</td></tr></tbody></table><h3 id=학습-항목-매트릭스>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스>#</a></h3><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>학습 목표</th><th>실무 연관성</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>동기 vs 비동기, 이벤트 루프</td><td>필수</td><td>실행 모델 차이와 스케줄링 원리 이해</td><td>높음</td><td>블로킹/논블로킹, 이벤트 큐 구조</td></tr><tr><td>기초</td><td>1</td><td>콜백, Promise</td><td>필수</td><td>비동기 처리의 기본 패턴 이해</td><td>높음</td><td>레거시·현대 코드 모두 이해</td></tr><tr><td>핵심</td><td>2</td><td>async/await, Future</td><td>필수</td><td>가독성 높은 비동기 제어 흐름 구현</td><td>높음</td><td>JS, Python, Java 전반 적용</td></tr><tr><td>핵심</td><td>2</td><td>에러 핸들링</td><td>필수</td><td>안정적 예외 처리와 취소 전파</td><td>높음</td><td>try/catch, Promise.catch</td></tr><tr><td>핵심</td><td>3</td><td>병렬 실행 & 백프레셔</td><td>필수</td><td>과도한 동시성 억제 및 성능 최적화</td><td>높음</td><td>Promise.all, 세마포어, 큐</td></tr><tr><td>응용</td><td>5</td><td>메시지 브로커 연계</td><td>권장</td><td>서비스 간 비동기 통신 설계</td><td>중간</td><td>Kafka, RabbitMQ, SQS</td></tr><tr><td>응용</td><td>5</td><td>비동기 DB/외부 API 연동</td><td>필수</td><td>데이터 I/O 병목 최소화</td><td>높음</td><td>Async DB Driver, HTTP 클라이언트</td></tr><tr><td>응용</td><td>6</td><td>관측성/모니터링</td><td>필수</td><td>성능·장애 추적 체계 구축</td><td>높음</td><td>OpenTelemetry, Trace ID</td></tr><tr><td>응용</td><td>6</td><td>테스트 전략</td><td>권장</td><td>안정적 배포 전 품질 확보</td><td>중간</td><td>pytest-asyncio, Jest, race test</td></tr><tr><td>고급</td><td>7</td><td>구조적 동시성</td><td>선택</td><td>취소/에러 전파 용이성 확보</td><td>중간</td><td>Java Loom, Kotlin Coroutine</td></tr><tr><td>고급</td><td>7</td><td>Virtual Threads/io_uring</td><td>선택</td><td>차세대 비동기 최적화 이해</td><td>낮음</td><td>경량 스레드, 커널 레벨 I/O</td></tr><tr><td>고급</td><td>7</td><td>AI/ML 비동기 파이프라인</td><td>선택</td><td>AI 추론과 실시간 처리 결합</td><td>낮음</td><td>스트리밍 AI 분석, 모델 서빙</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>실행 모델/원리</td><td>비동기 실행</td><td>완료 대기 없이 제어권을 즉시 반환하는 실행 모델</td><td>논블로킹 I/O, 동시성</td><td>고동시성 API/실시간 처리</td></tr><tr><td>실행 모델/원리</td><td>동시성 vs 병렬성</td><td>교대로 진행 (동시성) 과 물리적 동시 실행 (병렬성) 의 구분</td><td>스레드, 이벤트 루프</td><td>설계 의사결정 기준 수립</td></tr><tr><td>실행 모델/원리</td><td>이벤트 루프</td><td>준비된 이벤트/태스크를 디스패치하는 루프</td><td>태스크/마이크로태스크 큐</td><td>Node.js, 브라우저, asyncio</td></tr><tr><td>언어/패턴</td><td>콜백</td><td>완료 시 호출되는 함수로 결과 전달</td><td>에러 - 우선 콜백</td><td>경량 작업, 레거시 연동</td></tr><tr><td>언어/패턴</td><td>Promise/Future</td><td>미래 값/에러를 캡슐화하는 핸들</td><td>then/catch, 상태 (P/F/R)</td><td>체이닝, 병렬 조합</td></tr><tr><td>언어/패턴</td><td>async/await·코루틴</td><td>비동기를 동기처럼 표현 (일시중단/재개)</td><td>구조적 동시성, 취소</td><td>복잡 플로우 가독성·테스트성 ↑</td></tr><tr><td>런타임/OS</td><td>Reactor/Proactor</td><td>준비 통지 vs 완료 통지 기반 I/O 모델</td><td>epoll/kqueue, IOCP</td><td>서버 런타임 설계 핵심</td></tr><tr><td>런타임/OS</td><td>epoll/kqueue/IOCP/io_uring</td><td>OS 수준 I/O 다중화/완료 통지</td><td>libuv, Netty, Tokio</td><td>고성능 서버·프레임워크 기반</td></tr><tr><td>프로토콜/메시징</td><td>메시지 큐</td><td>생산자 - 소비자 비동기 전달 중개</td><td>AMQP, Kafka</td><td>버퍼링·재시도·스파이크 흡수</td></tr><tr><td>프로토콜/메시징</td><td>gRPC/HTTP2/HTTP3</td><td>스트리밍·멀티플렉싱 기반 RPC/HTTP</td><td>플로우 컨트롤, 멀티스트림</td><td>마이크로서비스 통신</td></tr><tr><td>프로토콜/메시징</td><td>WebSocket/SSE</td><td>양방향/단방향 실시간 전송</td><td>핑 - 퐁, 재연결</td><td>실시간 알림·콜라보</td></tr><tr><td>아키텍처/설계</td><td>백프레셔</td><td>생산·소비 속도 차를 제어</td><td>버퍼/드롭/블록</td><td>큐 적체·OOM 방지</td></tr><tr><td>아키텍처/설계</td><td>멱등성 (Idempotency)</td><td>동일 요청 반복 시 동일 결과 보장</td><td>Idempotency-Key</td><td>재시도 안정화, 중복 방지</td></tr><tr><td>아키텍처/설계</td><td>오케스트레이션/코레오그래피</td><td>중앙 제어 vs 이벤트 자율 반응 흐름</td><td>Saga, 워크플로 엔진</td><td>분산 업무 플로우 설계</td></tr><tr><td>운영/관측/신뢰성</td><td>분산 트레이싱</td><td>분산 호출의 경로 추적</td><td>스팬/트레이스</td><td>원인 분석, MTTR 단축</td></tr><tr><td>운영/관측/신뢰성</td><td>W3C Trace Context/OTel</td><td>traceparent 전파·3 신호 수집 표준</td><td>Jaeger/Tempo, 메트릭/로그</td><td>E2E 관측 파이프라인</td></tr><tr><td>운영/관측/신뢰성</td><td>서킷 브레이커/레이트 리밋</td><td>실패 격리·남용 방지 제어</td><td>재시도, 타임아웃</td><td>연쇄 장애/비용 폭주 차단</td></tr><tr><td>성능/제어</td><td>loop lag/consumer lag</td><td>루프 지연/스트림 소비 지연 지표</td><td>queue depth, in-flight</td><td>SLO·알람 기준</td></tr><tr><td>성능/제어</td><td>동시성 상한/우선순위/격벽</td><td>세마포어·우선순위 큐·리소스 격리</td><td>Bulkhead, prefetch</td><td>테일 레이턴시 관리</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://martinfowler.com/articles/patterns-of-distributed-systems/asynchronous-request-reply.html>Martin Fowler — Asynchronous Request-Reply</a></li><li><a href=https://martinfowler.com/articles/async.html>Martin Fowler — Asynchronous Programming</a></li><li><a href=https://tc39.es/ecma262/#sec-async-function-definitions>ECMAScript — async/await 사양(Async Function Definitions)</a></li><li><a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function>MDN — <code>async function</code> 레퍼런스</a></li><li><a href=https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous>MDN — Asynchronous JavaScript 학습용 가이드</a></li><li><a href=https://blog.cloudflare.com/what-is-the-event-loop-in-javascript/>Cloudflare — 자바스크립트 이벤트 루프 설명</a></li><li><a href=https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/>Node.js — The Node.js Event Loop 가이드</a></li><li><a href=https://docs.python.org/3/library/asyncio.html>Python — <code>asyncio</code> 공식 문서</a></li><li><a href=https://docs.python.org/3/library/asyncio-eventloop.html>Python — Event Loop API 문서</a></li><li><a href=https://docs.python.org/3/library/concurrent.futures.html>Python — <code>concurrent.futures</code> 공식 문서</a></li><li><a href=https://realpython.com/async-io-python/>Real Python — Python의 Async IO 실습 가이드</a></li><li><a href=https://kotlinlang.org/docs/async-programming.html>Kotlin — 비동기 프로그래밍 기법</a></li><li><a href=https://learn.microsoft.com/en-us/dotnet/csharp/asynchronous-programming/>C# — 비동기 프로그래밍(Microsoft Learn)</a></li><li><a href=https://learn.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/async-vs-multithreaded>C# — Async vs Multithreaded(Microsoft Learn)</a></li><li><a href=https://learn.microsoft.com/en-us/archive/msdn-magazine/2013/march/async-await-best-practices-in-asynchronous-programming>MSDN Magazine(아카이브) — Async/Await 베스트 프랙티스</a></li><li><a href=https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/CompletableFuture.html>Java — <code>CompletableFuture</code> 공식 문서(JDK 21)</a></li><li><a href=https://openjdk.org/jeps/444>OpenJDK JEP 444 — Virtual Threads</a></li><li><a href=https://en.wikipedia.org/wiki/Asynchrony_%28computer_programming%29>Wikipedia — Asynchrony (computer programming)</a></li><li><a href=https://en.wikipedia.org/wiki/Async/await>Wikipedia — Async/await</a></li><li><a href=https://en.wikipedia.org/wiki/Actor_model>Wikipedia — Actor Model</a></li><li><a href=https://en.wikipedia.org/wiki/Proactor_pattern>Wikipedia — Proactor Pattern</a></li><li><a href=https://www.dre.vanderbilt.edu/~schmidt/PDF/reactor-siemens.pdf>Douglas C. Schmidt — Reactor Pattern (PDF)</a></li><li><a href=https://www2.eecs.berkeley.edu/Pubs/TechRpts/2006/EECS-2006-1.pdf>Edward A. Lee — The Problem with Threads (PDF)</a></li><li><a href=https://www.reactive-streams.org/>Reactive Streams — 공식 사양</a></li><li><a href=http://reactivex.io/>ReactiveX — 공식 사이트</a></li><li><a href=https://rxjs.dev/guide/overview>RxJS — 개요 가이드</a></li><li><a href=https://github.com/ReactiveX/RxJava>RxJava — GitHub 리포지토리</a></li><li><a href=https://github.com/aio-libs/aiohttp>aiohttp — Python asyncio용 비동기 HTTP 프레임워크(GitHub)</a></li><li><a href=https://github.com/tokio-rs/tokio>Tokio — Rust 비동기 런타임(GitHub)</a></li><li><a href=https://akka.io/>Akka — 액터/스트림 기반 분산 시스템 플랫폼</a></li><li><a href=https://learn.microsoft.com/en-us/dotnet/orleans/>Microsoft Orleans — 가상 액터 프레임워크(문서)</a></li><li><a href=https://www.asyncapi.com/>AsyncAPI — 이벤트 드리븐 API 사양</a></li><li><a href=https://www.rabbitmq.com/tutorials/tutorial-two-python.html>RabbitMQ — Work Queues 튜토리얼</a></li><li><a href=https://aws.amazon.com/event-driven-architecture/>AWS — Event-driven architecture</a></li><li><a href=https://aws.amazon.com/ko/lambda/>AWS — Lambda(서버리스 컴퓨팅)</a></li><li><a href=https://serverlessland.com/patterns/lambda-circuit-breaker>Serverless Land — Lambda Circuit Breaker 패턴</a></li><li><a href=https://socket.io/docs/>Socket.IO — 공식 문서</a></li><li><a href=https://www.jaegertracing.io/docs/1.21/>Jaeger Tracing — 문서 1.21</a></li><li><a href=https://opentelemetry.io/>OpenTelemetry — 공식 사이트</a></li><li><a href=https://developer.ibm.com/articles/ba-bluemix-cqrs-event-sourcing-microservices-cloudant-trs/>IBM Developer — CQRS와 Event Sourcing 개요</a></li><li><a href=https://netflixtechblog.com/reactive-programming-in-the-netflix-api-with-rxjava-7811c3a1496a>Netflix Tech Blog — RxJava로 구현한 넷플릭스 API 리액티브 프로그래밍</a></li><li><a href=https://discord.com/blog/how-discord-stores-billions-of-messages>Discord Engineering — How Discord Stores Billions of Messages</a></li><li><a href=https://eng.uber.com/reliable-reprocessing/>Uber Engineering — 신뢰할 수 있는 재처리와 DLQ 구축</a></li><li><a href=https://aws.amazon.com/ko/blogs/architecture/backpressure-using-amazon-sqs/>AWS 아키텍처 블로그 — Amazon SQS로 백프레셔 구현</a></li><li><a href=https://libuv.org/>libuv — 크로스플랫폼 비동기 I/O 라이브러리</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>