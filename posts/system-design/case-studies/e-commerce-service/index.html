<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>E-Commerce Service | hyunyoun's Blog</title>
<meta name=keywords content="System-Design,E-Commerce-Service"><meta name=description content="물품 구매 서비스를 구현하기 위해 필요한 사항들을 정리한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/system-design/case-studies/e-commerce-service/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/system-design/case-studies/e-commerce-service/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/system-design/case-studies/e-commerce-service/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="E-Commerce Service"><meta property="og:description" content="물품 구매 서비스를 구현하기 위해 필요한 사항들을 정리한다."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-03T12:54:00+00:00"><meta property="article:modified_time" content="2024-12-03T12:54:00+00:00"><meta property="article:tag" content="System-Design"><meta property="article:tag" content="E-Commerce-Service"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="E-Commerce Service"><meta name=twitter:description content="물품 구매 서비스를 구현하기 위해 필요한 사항들을 정리한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"E-Commerce Service","item":"https://buenhyden.github.io/posts/system-design/case-studies/e-commerce-service/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"E-Commerce Service","name":"E-Commerce Service","description":"물품 구매 서비스를 구현하기 위해 필요한 사항들을 정리한다.","keywords":["System-Design","E-Commerce-Service"],"articleBody":"E-Commerce Service 여러 사용자가 동시에 하나의 물품을 구매하려고 할 때 발생할 수 있는 문제를 해결하기 위해 다음과 같은 요소들을 고려해야 한다.\n고려해야 할 요소 동시성 제어: 여러 사용자가 동시에 같은 물품을 구매하려 할 때 발생할 수 있는 충돌을 관리해야 한다. 재고 관리: 실시간으로 정확한 재고 수량을 유지하고 업데이트해야 한다. 트랜잭션 일관성: 결제 과정과 재고 감소가 일관성 있게 처리되어야 한다. 사용자 경험: 구매 과정에서 사용자에게 명확한 피드백을 제공해야 한다. 핵심 영역 상품 관리 시스템 상품 정보 관리 (이름, 가격, 재고, 카테고리, 상품 상태 등) 재고 관리 시스템 (동시성 제어가 매우 중요) 상품 검색 및 필터링 기능 이미지 처리 및 저장 주문 처리 시스템 (매우 중요) 주문 상태 관리 (결제대기, 결제완료, 배송준비, 배송중, 배송완료 등) 장바구니 기능 동시 주문 처리를 위한 동시성 제어 재고 차감 로직 주문 취소/환불 처리 결제 시스템 결제 게이트웨이 연동 결제 상태 관리 결제 실패 처리 환불 처리 결제 보안 (매우 중요) 사용자 관리 회원가입/로그인 권한 관리 개인정보 보호 주소록 관리 구매 이력 관리 구현 방법 데이터베이스 수준의 잠금 (Database-Level Locking) 낙관적 잠금 (Optimistic Locking) 낙관적 잠금은 대부분의 트랜잭션이 충돌하지 않는다는 가정하에 작동한다.\n구현 예시:\n1 2 3 UPDATE items SET stock = stock - 1 WHERE item_id = ? AND stock = ?; 이 SQL 문은 재고 값이 변경되지 않은 경우에만 항목을 업데이트한다.\n비관적 잠금 (Pessimistic Locking) 비관적 잠금은 트랜잭션 기간 동안 항목을 잠그어 다른 트랜잭션이 업데이트하지 못하게 한다.\n구현 예시:\n1 2 3 4 5 6 7 8 9 10 BEGIN; SELECT stock FROM items WHERE item_id = ? FOR UPDATE; -- 재고 확인 및 가능한 경우 업데이트 UPDATE items SET stock = stock - 1 WHERE item_id = ?; COMMIT; 애플리케이션 수준의 처리 분산 잠금 (Distributed Locking) 분산 잠금을 사용하면 여러 서버에서 동시에 접근하는 경우에도 일관성을 유지할 수 있다.\n구현 방법:\n사용자가 구매를 시도할 때 해당 항목에 대한 분산 잠금을 획득한다. 잠금을 유지한 상태에서 구매 작업을 수행한다. 작업 완료 후 잠금을 해제한다. 상태 관리 물품의 상태를 세 가지로 관리할 수 있다: 사용 가능, 보류 중, 판매됨.\n사용자가 결제 페이지로 이동할 때 물품 상태를 “보류 중\"으로 변경. 일정 시간(예: 10분) 후에 결제가 완료되지 않으면 상태를 다시 “사용 가능\"으로 변경. 실시간 재고 동기화 여러 판매 채널을 사용하는 경우, 중앙 집중식 재고 관리 시스템을 구축하여 실시간으로 재고를 동기화해야 한다.\n실시간 인벤토리 동기화를 구현하는 방법 데이터 통합 및 실시간 업데이트 중앙 집중식 인벤토리 관리\n모든 판매 채널의 재고를 단일 플랫폼에서 관리한다.\n이를 통해 여러 채널에서의 재고 수준을 실시간으로 추적하고 동기화할 수 있다. 자동화된 동기화\n판매, 반품, 재입고 등 재고 변동이 발생할 때마다 자동으로 모든 연결된 채널에서 업데이트가 이루어진다.\n이는 과잉 판매와 재고 부족을 방지하는 데 도움이 된다. 기술적 구현 방법 웹훅 (Webhooks)\n재고 변경 시 즉각적인 알림을 통해 시스템 전체에 즉시 업데이트를 트리거한다. API 통합\n다양한 소프트웨어 구성 요소 간의 원활한 통신을 가능하게 하여 모든 접점에서 재고 데이터의 일관성을 보장한다. 데이터베이스 복제\n재고 데이터베이스의 여러 복사본을 생성하여 다양한 위치에서 빠른 액세스와 업데이트를 가능하게 한다. 고급 기능 맞춤형 알림 설정\n재고가 낮아질 때 알림을 받아 적시에 공급업체에 주문을 할 수 있도록 한다. 멀티팩 및 번들 추적\n키트를 구성하는 개별 아이템 수준에서 멀티팩과 번들을 추적한다. 다중 창고 관리\n여러 창고의 재고를 추적하고, 채널별로 창고 우선순위를 설정할 수 있다. 구현 시 고려사항 데이터 일관성: 모든 채널에서 재고 정보가 일치하도록 유지해야 한다. 네트워크 지연: 실시간 업데이트 시 발생할 수 있는 지연을 최소화해야 한다. 확장성: 비즈니스 성장에 따라 시스템이 확장될 수 있어야 한다. 오류 처리: 동기화 과정에서 발생할 수 있는 오류를 효과적으로 관리해야 한다. 트랜잭션 관리\n데이터베이스의 ACID 속성을 활용하여 트랜잭션의 일관성을 유지한다.\n이를 통해 하나의 트랜잭션만 성공하고 나머지는 중단되도록 할 수 있다. 구현예제 사용된 주요 기술과 패턴들:\n분산 락(Distributed Lock):\nRedis를 사용하여 분산 락을 구현.\n이는 여러 서버에서 동시에 같은 상품에 대한 구매 요청이 들어올 때도 안전하게 처리할 수 있게 해준다.\nRedis의 SETNX 명령어를 활용하여 락의 획득과 해제를 관리한다. 데이터베이스 트랜잭션:\n데이터베이스 수준에서 트랜잭션을 사용하여 재고 확인, 결제 처리, 주문 정보 저장이 모두 하나의 원자적 단위로 처리되도록 보장한다.\n만약 중간에 실패가 발생하면 모든 변경사항이 롤백된다. SELECT FOR UPDATE 재고를 확인하고 수정할 때 데이터베이스의 row-level 락을 사용.\n이를 통해 다른 트랜잭션이 동시에 같은 재고 정보를 수정하는 것을 방지한다. 멱등성 처리\n각 주문 요청에 고유한 idempotency_key를 할당하고, Redis를 사용하여 이를 관리한다.\n같은 키로 중복 요청이 들어와도 한 번만 처리되도록 보장한다. 예외 처리\n모든 주요 작업에 대해 적절한 예외 처리를 구현하여, 시스템이 안정적으로 동작하도록 보장한다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 from datetime import datetime, timedelta import threading from typing import Optional from dataclasses import dataclass import uuid from enum import Enum import redis from sqlalchemy import create_engine, select from sqlalchemy.orm import Session from sqlalchemy.exc import IntegrityError # 상품 상태를 나타내는 열거형 class OrderStatus(Enum): PENDING = \"pending\" PAYMENT_PROCESSING = \"payment_processing\" COMPLETED = \"completed\" FAILED = \"failed\" @dataclass class OrderRequest: product_id: int user_id: int quantity: int total_amount: float idempotency_key: str = str(uuid.uuid4()) class PurchaseSystem: def __init__(self): # Redis 연결 설정 (동시성 제어를 위한 분산 락 구현에 사용) self.redis_client = redis.Redis(host='localhost', port=6379, db=0) # 데이터베이스 연결 설정 self.engine = create_engine('postgresql://user:password@localhost/dbname') # 결제 시도 횟수 제한 설정 self.max_retries = 3 def acquire_lock(self, product_id: int, timeout: int = 10) -\u003e bool: \"\"\"분산 락 획득을 시도합니다.\"\"\" lock_key = f\"product_lock:{product_id}\" return self.redis_client.set( lock_key, str(uuid.uuid4()), ex=timeout, nx=True ) def release_lock(self, product_id: int) -\u003e None: \"\"\"분산 락을 해제합니다.\"\"\" lock_key = f\"product_lock:{product_id}\" self.redis_client.delete(lock_key) def check_idempotency(self, idempotency_key: str) -\u003e Optional[dict]: \"\"\"요청의 멱등성을 확인합니다.\"\"\" result = self.redis_client.get(f\"idempotency:{idempotency_key}\") return result.decode() if result else None def save_idempotency_result(self, idempotency_key: str, result: dict) -\u003e None: \"\"\"멱등성 결과를 저장합니다.\"\"\" self.redis_client.setex( f\"idempotency:{idempotency_key}\", timedelta(hours=24), str(result) ) def check_and_reserve_inventory(self, session: Session, product_id: int, quantity: int) -\u003e bool: \"\"\"재고를 확인하고 예약합니다.\"\"\" # SELECT FOR UPDATE를 사용하여 재고 데이터 락 stmt = select(Product).where(Product.id == product_id).with_for_update() product = session.execute(stmt).scalar_one() if product.inventory \u003e= quantity: product.inventory -= quantity return True return False def process_payment(self, order_request: OrderRequest) -\u003e bool: \"\"\"결제를 처리합니다.\"\"\" # 실제 결제 처리 로직을 구현합니다 # 외부 결제 시스템과의 연동이 필요합니다 return True def purchase(self, order_request: OrderRequest) -\u003e dict: \"\"\"상품 구매를 처리합니다.\"\"\" # 멱등성 체크 idempotency_result = self.check_idempotency(order_request.idempotency_key) if idempotency_result: return idempotency_result # 분산 락 획득 시도 if not self.acquire_lock(order_request.product_id): return {\"status\": \"error\", \"message\": \"다른 거래가 진행 중입니다\"} try: with Session(self.engine) as session: # 트랜잭션 시작 with session.begin(): # 재고 확인 및 예약 if not self.check_and_reserve_inventory( session, order_request.product_id, order_request.quantity ): return {\"status\": \"error\", \"message\": \"재고가 부족합니다\"} # 결제 처리 if not self.process_payment(order_request): # 결제 실패 시 롤백은 자동으로 수행됨 return {\"status\": \"error\", \"message\": \"결제 처리에 실패했습니다\"} # 주문 정보 저장 order = Order( user_id=order_request.user_id, product_id=order_request.product_id, quantity=order_request.quantity, total_amount=order_request.total_amount, status=OrderStatus.COMPLETED ) session.add(order) result = { \"status\": \"success\", \"order_id\": order.id, \"message\": \"구매가 완료되었습니다\" } # 멱등성 결과 저장 self.save_idempotency_result(order_request.idempotency_key, result) return result except Exception as e: return {\"status\": \"error\", \"message\": str(e)} finally: # 락 해제 self.release_lock(order_request.product_id) 시스템을 실제로 운영할 때 고려해야 할 추가 사항들 모니터링과 로깅 모든 주문 처리 과정을 로깅하여 문제 발생 시 추적할 수 있어야 합니다. 시스템의 성능과 안정성을 모니터링해야 합니다. 성능 최적화 캐시를 활용하여 자주 조회되는 상품 정보의 접근 속도를 개선할 수 있습니다. 데이터베이스 인덱스를 적절히 설정하여 조회 성능을 향상시킬 수 있습니다. 확장성 시스템이 성장함에 따라 수평적 확장이 가능하도록 설계해야 합니다. 마이크로서비스 아키텍처의 도입을 고려할 수 있습니다. 참고 및 출처 ","wordCount":"1261","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-12-03T12:54:00Z","dateModified":"2024-12-03T12:54:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/system-design/case-studies/e-commerce-service/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1 class="post-title entry-hint-parent">E-Commerce Service</h1><div class=post-description>물품 구매 서비스를 구현하기 위해 필요한 사항들을 정리한다.</div><div class=post-meta><span title='2024-12-03 12:54:00 +0000 UTC'>December 3, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/System%20Design/Case%20Studies/E-Commerce-Service.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#e-commerce-service>E-Commerce Service</a><ul><li><a href=#고려해야-할-요소>고려해야 할 요소</a></li><li><a href=#핵심-영역>핵심 영역</a></li><li><a href=#구현-방법>구현 방법</a></li><li><a href=#구현예제>구현예제</a></li><li><a href=#시스템을-실제로-운영할-때-고려해야-할-추가-사항들>시스템을 실제로 운영할 때 고려해야 할 추가 사항들</a></li></ul></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=e-commerce-service>E-Commerce Service<a hidden class=anchor aria-hidden=true href=#e-commerce-service>#</a></h2><p>여러 사용자가 동시에 하나의 물품을 구매하려고 할 때 발생할 수 있는 문제를 해결하기 위해 다음과 같은 요소들을 고려해야 한다.</p><h3 id=고려해야-할-요소>고려해야 할 요소<a hidden class=anchor aria-hidden=true href=#고려해야-할-요소>#</a></h3><ol><li><strong>동시성 제어</strong>: 여러 사용자가 동시에 같은 물품을 구매하려 할 때 발생할 수 있는 충돌을 관리해야 한다.</li><li><strong>재고 관리</strong>: 실시간으로 정확한 재고 수량을 유지하고 업데이트해야 한다.</li><li><strong>트랜잭션 일관성</strong>: 결제 과정과 재고 감소가 일관성 있게 처리되어야 한다.</li><li><strong>사용자 경험</strong>: 구매 과정에서 사용자에게 명확한 피드백을 제공해야 한다.</li></ol><h3 id=핵심-영역>핵심 영역<a hidden class=anchor aria-hidden=true href=#핵심-영역>#</a></h3><ol><li>상품 관리 시스템</li></ol><ul><li>상품 정보 관리 (이름, 가격, 재고, 카테고리, 상품 상태 등)</li><li>재고 관리 시스템 (동시성 제어가 매우 중요)</li><li>상품 검색 및 필터링 기능</li><li>이미지 처리 및 저장</li></ul><ol start=2><li>주문 처리 시스템 (매우 중요)</li></ol><ul><li>주문 상태 관리 (결제대기, 결제완료, 배송준비, 배송중, 배송완료 등)</li><li>장바구니 기능</li><li>동시 주문 처리를 위한 동시성 제어</li><li>재고 차감 로직</li><li>주문 취소/환불 처리</li></ul><ol start=3><li>결제 시스템</li></ol><ul><li>결제 게이트웨이 연동</li><li>결제 상태 관리</li><li>결제 실패 처리</li><li>환불 처리</li><li>결제 보안 (매우 중요)</li></ul><ol start=4><li>사용자 관리</li></ol><ul><li>회원가입/로그인</li><li>권한 관리</li><li>개인정보 보호</li><li>주소록 관리</li><li>구매 이력 관리</li></ul><h3 id=구현-방법>구현 방법<a hidden class=anchor aria-hidden=true href=#구현-방법>#</a></h3><h4 id=데이터베이스-수준의-잠금-database-level-locking>데이터베이스 수준의 잠금 (Database-Level Locking)<a hidden class=anchor aria-hidden=true href=#데이터베이스-수준의-잠금-database-level-locking>#</a></h4><h5 id=낙관적-잠금-optimistic-locking>낙관적 잠금 (Optimistic Locking)<a hidden class=anchor aria-hidden=true href=#낙관적-잠금-optimistic-locking>#</a></h5><p>낙관적 잠금은 대부분의 트랜잭션이 충돌하지 않는다는 가정하에 작동한다.</p><p>구현 예시:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UPDATE</span><span class=w> </span><span class=n>items</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>item_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>이 SQL 문은 재고 값이 변경되지 않은 경우에만 항목을 업데이트한다.</p><h5 id=비관적-잠금-pessimistic-locking>비관적 잠금 (Pessimistic Locking)<a hidden class=anchor aria-hidden=true href=#비관적-잠금-pessimistic-locking>#</a></h5><p>비관적 잠금은 트랜잭션 기간 동안 항목을 잠그어 다른 트랜잭션이 업데이트하지 못하게 한다.</p><p>구현 예시:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>stock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>items</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>item_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 재고 확인 및 가능한 경우 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>items</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>item_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=애플리케이션-수준의-처리>애플리케이션 수준의 처리<a hidden class=anchor aria-hidden=true href=#애플리케이션-수준의-처리>#</a></h4><h5 id=분산-잠금-distributed-locking>분산 잠금 (Distributed Locking)<a hidden class=anchor aria-hidden=true href=#분산-잠금-distributed-locking>#</a></h5><p>분산 잠금을 사용하면 여러 서버에서 동시에 접근하는 경우에도 일관성을 유지할 수 있다.</p><p>구현 방법:</p><ol><li>사용자가 구매를 시도할 때 해당 항목에 대한 분산 잠금을 획득한다.</li><li>잠금을 유지한 상태에서 구매 작업을 수행한다.</li><li>작업 완료 후 잠금을 해제한다.</li></ol><h4 id=상태-관리>상태 관리<a hidden class=anchor aria-hidden=true href=#상태-관리>#</a></h4><p>물품의 상태를 세 가지로 관리할 수 있다: 사용 가능, 보류 중, 판매됨.</p><ul><li>사용자가 결제 페이지로 이동할 때 물품 상태를 &ldquo;보류 중"으로 변경.</li><li>일정 시간(예: 10분) 후에 결제가 완료되지 않으면 상태를 다시 &ldquo;사용 가능"으로 변경.</li></ul><h4 id=실시간-재고-동기화>실시간 재고 동기화<a hidden class=anchor aria-hidden=true href=#실시간-재고-동기화>#</a></h4><p>여러 판매 채널을 사용하는 경우, 중앙 집중식 재고 관리 시스템을 구축하여 실시간으로 재고를 동기화해야 한다.</p><h5 id=실시간-인벤토리-동기화를-구현하는-방법>실시간 인벤토리 동기화를 구현하는 방법<a hidden class=anchor aria-hidden=true href=#실시간-인벤토리-동기화를-구현하는-방법>#</a></h5><h6 id=데이터-통합-및-실시간-업데이트>데이터 통합 및 실시간 업데이트<a hidden class=anchor aria-hidden=true href=#데이터-통합-및-실시간-업데이트>#</a></h6><ol><li>중앙 집중식 인벤토리 관리<br>모든 판매 채널의 재고를 단일 플랫폼에서 관리한다.<br>이를 통해 여러 채널에서의 재고 수준을 실시간으로 추적하고 동기화할 수 있다.</li><li>자동화된 동기화<br>판매, 반품, 재입고 등 재고 변동이 발생할 때마다 자동으로 모든 연결된 채널에서 업데이트가 이루어진다.<br>이는 과잉 판매와 재고 부족을 방지하는 데 도움이 된다.</li></ol><h6 id=기술적-구현-방법>기술적 구현 방법<a hidden class=anchor aria-hidden=true href=#기술적-구현-방법>#</a></h6><ol><li>웹훅 (Webhooks)<br>재고 변경 시 즉각적인 알림을 통해 시스템 전체에 즉시 업데이트를 트리거한다.</li><li>API 통합<br>다양한 소프트웨어 구성 요소 간의 원활한 통신을 가능하게 하여 모든 접점에서 재고 데이터의 일관성을 보장한다.</li><li>데이터베이스 복제<br>재고 데이터베이스의 여러 복사본을 생성하여 다양한 위치에서 빠른 액세스와 업데이트를 가능하게 한다.</li></ol><h6 id=고급-기능>고급 기능<a hidden class=anchor aria-hidden=true href=#고급-기능>#</a></h6><ol><li>맞춤형 알림 설정<br>재고가 낮아질 때 알림을 받아 적시에 공급업체에 주문을 할 수 있도록 한다.</li><li>멀티팩 및 번들 추적<br>키트를 구성하는 개별 아이템 수준에서 멀티팩과 번들을 추적한다.</li><li>다중 창고 관리<br>여러 창고의 재고를 추적하고, 채널별로 창고 우선순위를 설정할 수 있다.</li></ol><h6 id=구현-시-고려사항>구현 시 고려사항<a hidden class=anchor aria-hidden=true href=#구현-시-고려사항>#</a></h6><ol><li><strong>데이터 일관성</strong>: 모든 채널에서 재고 정보가 일치하도록 유지해야 한다.</li><li><strong>네트워크 지연</strong>: 실시간 업데이트 시 발생할 수 있는 지연을 최소화해야 한다.</li><li><strong>확장성</strong>: 비즈니스 성장에 따라 시스템이 확장될 수 있어야 한다.</li><li><strong>오류 처리</strong>: 동기화 과정에서 발생할 수 있는 오류를 효과적으로 관리해야 한다.</li></ol><ul><li>트랜잭션 관리<br>데이터베이스의 ACID 속성을 활용하여 트랜잭션의 일관성을 유지한다.<br>이를 통해 하나의 트랜잭션만 성공하고 나머지는 중단되도록 할 수 있다.</li></ul><h3 id=구현예제>구현예제<a hidden class=anchor aria-hidden=true href=#구현예제>#</a></h3><p>사용된 주요 기술과 패턴들:</p><ol><li>분산 락(Distributed Lock):<br>Redis를 사용하여 분산 락을 구현.<br>이는 여러 서버에서 동시에 같은 상품에 대한 구매 요청이 들어올 때도 안전하게 처리할 수 있게 해준다.<br>Redis의 SETNX 명령어를 활용하여 락의 획득과 해제를 관리한다.</li><li>데이터베이스 트랜잭션:<br>데이터베이스 수준에서 트랜잭션을 사용하여 재고 확인, 결제 처리, 주문 정보 저장이 모두 하나의 원자적 단위로 처리되도록 보장한다.<br>만약 중간에 실패가 발생하면 모든 변경사항이 롤백된다.</li><li>SELECT FOR UPDATE 재고를 확인하고 수정할 때 데이터베이스의 row-level 락을 사용.<br>이를 통해 다른 트랜잭션이 동시에 같은 재고 정보를 수정하는 것을 방지한다.</li><li>멱등성 처리<br>각 주문 요청에 고유한 idempotency_key를 할당하고, Redis를 사용하여 이를 관리한다.<br>같은 키로 중복 요청이 들어와도 한 번만 처리되도록 보장한다.</li><li>예외 처리<br>모든 주요 작업에 대해 적절한 예외 처리를 구현하여, 시스템이 안정적으로 동작하도록 보장한다.</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>  1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2>  2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3>  3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4>  4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5>  5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6>  6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7>  7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8>  8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9>  9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10> 10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11> 11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12> 12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13> 13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14> 14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15> 15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16> 16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17> 17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18> 18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19> 19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20> 20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21> 21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22> 22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23> 23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24> 24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25> 25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26> 26</a>
</span><span class=lnt id=hl-2-27><a class=lnlinks href=#hl-2-27> 27</a>
</span><span class=lnt id=hl-2-28><a class=lnlinks href=#hl-2-28> 28</a>
</span><span class=lnt id=hl-2-29><a class=lnlinks href=#hl-2-29> 29</a>
</span><span class=lnt id=hl-2-30><a class=lnlinks href=#hl-2-30> 30</a>
</span><span class=lnt id=hl-2-31><a class=lnlinks href=#hl-2-31> 31</a>
</span><span class=lnt id=hl-2-32><a class=lnlinks href=#hl-2-32> 32</a>
</span><span class=lnt id=hl-2-33><a class=lnlinks href=#hl-2-33> 33</a>
</span><span class=lnt id=hl-2-34><a class=lnlinks href=#hl-2-34> 34</a>
</span><span class=lnt id=hl-2-35><a class=lnlinks href=#hl-2-35> 35</a>
</span><span class=lnt id=hl-2-36><a class=lnlinks href=#hl-2-36> 36</a>
</span><span class=lnt id=hl-2-37><a class=lnlinks href=#hl-2-37> 37</a>
</span><span class=lnt id=hl-2-38><a class=lnlinks href=#hl-2-38> 38</a>
</span><span class=lnt id=hl-2-39><a class=lnlinks href=#hl-2-39> 39</a>
</span><span class=lnt id=hl-2-40><a class=lnlinks href=#hl-2-40> 40</a>
</span><span class=lnt id=hl-2-41><a class=lnlinks href=#hl-2-41> 41</a>
</span><span class=lnt id=hl-2-42><a class=lnlinks href=#hl-2-42> 42</a>
</span><span class=lnt id=hl-2-43><a class=lnlinks href=#hl-2-43> 43</a>
</span><span class=lnt id=hl-2-44><a class=lnlinks href=#hl-2-44> 44</a>
</span><span class=lnt id=hl-2-45><a class=lnlinks href=#hl-2-45> 45</a>
</span><span class=lnt id=hl-2-46><a class=lnlinks href=#hl-2-46> 46</a>
</span><span class=lnt id=hl-2-47><a class=lnlinks href=#hl-2-47> 47</a>
</span><span class=lnt id=hl-2-48><a class=lnlinks href=#hl-2-48> 48</a>
</span><span class=lnt id=hl-2-49><a class=lnlinks href=#hl-2-49> 49</a>
</span><span class=lnt id=hl-2-50><a class=lnlinks href=#hl-2-50> 50</a>
</span><span class=lnt id=hl-2-51><a class=lnlinks href=#hl-2-51> 51</a>
</span><span class=lnt id=hl-2-52><a class=lnlinks href=#hl-2-52> 52</a>
</span><span class=lnt id=hl-2-53><a class=lnlinks href=#hl-2-53> 53</a>
</span><span class=lnt id=hl-2-54><a class=lnlinks href=#hl-2-54> 54</a>
</span><span class=lnt id=hl-2-55><a class=lnlinks href=#hl-2-55> 55</a>
</span><span class=lnt id=hl-2-56><a class=lnlinks href=#hl-2-56> 56</a>
</span><span class=lnt id=hl-2-57><a class=lnlinks href=#hl-2-57> 57</a>
</span><span class=lnt id=hl-2-58><a class=lnlinks href=#hl-2-58> 58</a>
</span><span class=lnt id=hl-2-59><a class=lnlinks href=#hl-2-59> 59</a>
</span><span class=lnt id=hl-2-60><a class=lnlinks href=#hl-2-60> 60</a>
</span><span class=lnt id=hl-2-61><a class=lnlinks href=#hl-2-61> 61</a>
</span><span class=lnt id=hl-2-62><a class=lnlinks href=#hl-2-62> 62</a>
</span><span class=lnt id=hl-2-63><a class=lnlinks href=#hl-2-63> 63</a>
</span><span class=lnt id=hl-2-64><a class=lnlinks href=#hl-2-64> 64</a>
</span><span class=lnt id=hl-2-65><a class=lnlinks href=#hl-2-65> 65</a>
</span><span class=lnt id=hl-2-66><a class=lnlinks href=#hl-2-66> 66</a>
</span><span class=lnt id=hl-2-67><a class=lnlinks href=#hl-2-67> 67</a>
</span><span class=lnt id=hl-2-68><a class=lnlinks href=#hl-2-68> 68</a>
</span><span class=lnt id=hl-2-69><a class=lnlinks href=#hl-2-69> 69</a>
</span><span class=lnt id=hl-2-70><a class=lnlinks href=#hl-2-70> 70</a>
</span><span class=lnt id=hl-2-71><a class=lnlinks href=#hl-2-71> 71</a>
</span><span class=lnt id=hl-2-72><a class=lnlinks href=#hl-2-72> 72</a>
</span><span class=lnt id=hl-2-73><a class=lnlinks href=#hl-2-73> 73</a>
</span><span class=lnt id=hl-2-74><a class=lnlinks href=#hl-2-74> 74</a>
</span><span class=lnt id=hl-2-75><a class=lnlinks href=#hl-2-75> 75</a>
</span><span class=lnt id=hl-2-76><a class=lnlinks href=#hl-2-76> 76</a>
</span><span class=lnt id=hl-2-77><a class=lnlinks href=#hl-2-77> 77</a>
</span><span class=lnt id=hl-2-78><a class=lnlinks href=#hl-2-78> 78</a>
</span><span class=lnt id=hl-2-79><a class=lnlinks href=#hl-2-79> 79</a>
</span><span class=lnt id=hl-2-80><a class=lnlinks href=#hl-2-80> 80</a>
</span><span class=lnt id=hl-2-81><a class=lnlinks href=#hl-2-81> 81</a>
</span><span class=lnt id=hl-2-82><a class=lnlinks href=#hl-2-82> 82</a>
</span><span class=lnt id=hl-2-83><a class=lnlinks href=#hl-2-83> 83</a>
</span><span class=lnt id=hl-2-84><a class=lnlinks href=#hl-2-84> 84</a>
</span><span class=lnt id=hl-2-85><a class=lnlinks href=#hl-2-85> 85</a>
</span><span class=lnt id=hl-2-86><a class=lnlinks href=#hl-2-86> 86</a>
</span><span class=lnt id=hl-2-87><a class=lnlinks href=#hl-2-87> 87</a>
</span><span class=lnt id=hl-2-88><a class=lnlinks href=#hl-2-88> 88</a>
</span><span class=lnt id=hl-2-89><a class=lnlinks href=#hl-2-89> 89</a>
</span><span class=lnt id=hl-2-90><a class=lnlinks href=#hl-2-90> 90</a>
</span><span class=lnt id=hl-2-91><a class=lnlinks href=#hl-2-91> 91</a>
</span><span class=lnt id=hl-2-92><a class=lnlinks href=#hl-2-92> 92</a>
</span><span class=lnt id=hl-2-93><a class=lnlinks href=#hl-2-93> 93</a>
</span><span class=lnt id=hl-2-94><a class=lnlinks href=#hl-2-94> 94</a>
</span><span class=lnt id=hl-2-95><a class=lnlinks href=#hl-2-95> 95</a>
</span><span class=lnt id=hl-2-96><a class=lnlinks href=#hl-2-96> 96</a>
</span><span class=lnt id=hl-2-97><a class=lnlinks href=#hl-2-97> 97</a>
</span><span class=lnt id=hl-2-98><a class=lnlinks href=#hl-2-98> 98</a>
</span><span class=lnt id=hl-2-99><a class=lnlinks href=#hl-2-99> 99</a>
</span><span class=lnt id=hl-2-100><a class=lnlinks href=#hl-2-100>100</a>
</span><span class=lnt id=hl-2-101><a class=lnlinks href=#hl-2-101>101</a>
</span><span class=lnt id=hl-2-102><a class=lnlinks href=#hl-2-102>102</a>
</span><span class=lnt id=hl-2-103><a class=lnlinks href=#hl-2-103>103</a>
</span><span class=lnt id=hl-2-104><a class=lnlinks href=#hl-2-104>104</a>
</span><span class=lnt id=hl-2-105><a class=lnlinks href=#hl-2-105>105</a>
</span><span class=lnt id=hl-2-106><a class=lnlinks href=#hl-2-106>106</a>
</span><span class=lnt id=hl-2-107><a class=lnlinks href=#hl-2-107>107</a>
</span><span class=lnt id=hl-2-108><a class=lnlinks href=#hl-2-108>108</a>
</span><span class=lnt id=hl-2-109><a class=lnlinks href=#hl-2-109>109</a>
</span><span class=lnt id=hl-2-110><a class=lnlinks href=#hl-2-110>110</a>
</span><span class=lnt id=hl-2-111><a class=lnlinks href=#hl-2-111>111</a>
</span><span class=lnt id=hl-2-112><a class=lnlinks href=#hl-2-112>112</a>
</span><span class=lnt id=hl-2-113><a class=lnlinks href=#hl-2-113>113</a>
</span><span class=lnt id=hl-2-114><a class=lnlinks href=#hl-2-114>114</a>
</span><span class=lnt id=hl-2-115><a class=lnlinks href=#hl-2-115>115</a>
</span><span class=lnt id=hl-2-116><a class=lnlinks href=#hl-2-116>116</a>
</span><span class=lnt id=hl-2-117><a class=lnlinks href=#hl-2-117>117</a>
</span><span class=lnt id=hl-2-118><a class=lnlinks href=#hl-2-118>118</a>
</span><span class=lnt id=hl-2-119><a class=lnlinks href=#hl-2-119>119</a>
</span><span class=lnt id=hl-2-120><a class=lnlinks href=#hl-2-120>120</a>
</span><span class=lnt id=hl-2-121><a class=lnlinks href=#hl-2-121>121</a>
</span><span class=lnt id=hl-2-122><a class=lnlinks href=#hl-2-122>122</a>
</span><span class=lnt id=hl-2-123><a class=lnlinks href=#hl-2-123>123</a>
</span><span class=lnt id=hl-2-124><a class=lnlinks href=#hl-2-124>124</a>
</span><span class=lnt id=hl-2-125><a class=lnlinks href=#hl-2-125>125</a>
</span><span class=lnt id=hl-2-126><a class=lnlinks href=#hl-2-126>126</a>
</span><span class=lnt id=hl-2-127><a class=lnlinks href=#hl-2-127>127</a>
</span><span class=lnt id=hl-2-128><a class=lnlinks href=#hl-2-128>128</a>
</span><span class=lnt id=hl-2-129><a class=lnlinks href=#hl-2-129>129</a>
</span><span class=lnt id=hl-2-130><a class=lnlinks href=#hl-2-130>130</a>
</span><span class=lnt id=hl-2-131><a class=lnlinks href=#hl-2-131>131</a>
</span><span class=lnt id=hl-2-132><a class=lnlinks href=#hl-2-132>132</a>
</span><span class=lnt id=hl-2-133><a class=lnlinks href=#hl-2-133>133</a>
</span><span class=lnt id=hl-2-134><a class=lnlinks href=#hl-2-134>134</a>
</span><span class=lnt id=hl-2-135><a class=lnlinks href=#hl-2-135>135</a>
</span><span class=lnt id=hl-2-136><a class=lnlinks href=#hl-2-136>136</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span><span class=p>,</span> <span class=n>select</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>Session</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.exc</span> <span class=kn>import</span> <span class=n>IntegrityError</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 상품 상태를 나타내는 열거형</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderStatus</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>PENDING</span> <span class=o>=</span> <span class=s2>&#34;pending&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>PAYMENT_PROCESSING</span> <span class=o>=</span> <span class=s2>&#34;payment_processing&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>COMPLETED</span> <span class=o>=</span> <span class=s2>&#34;completed&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>FAILED</span> <span class=o>=</span> <span class=s2>&#34;failed&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderRequest</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>total_amount</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>idempotency_key</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PurchaseSystem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Redis 연결 설정 (동시성 제어를 위한 분산 락 구현에 사용)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 데이터베이스 연결 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span><span class=s1>&#39;postgresql://user:password@localhost/dbname&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 결제 시도 횟수 제한 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>max_retries</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire_lock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;분산 락 획득을 시도합니다.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>lock_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;product_lock:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>lock_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=n>ex</span><span class=o>=</span><span class=n>timeout</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>nx</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release_lock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;분산 락을 해제합니다.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>lock_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;product_lock:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>check_idempotency</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>idempotency_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;요청의 멱등성을 확인합니다.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;idempotency:</span><span class=si>{</span><span class=n>idempotency_key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span> <span class=k>if</span> <span class=n>result</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>save_idempotency_result</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>idempotency_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>result</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;멱등성 결과를 저장합니다.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;idempotency:</span><span class=si>{</span><span class=n>idempotency_key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timedelta</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=mi>24</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nb>str</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>check_and_reserve_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=n>Session</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고를 확인하고 예약합니다.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># SELECT FOR UPDATE를 사용하여 재고 데이터 락</span>
</span></span><span class=line><span class=cl>        <span class=n>stmt</span> <span class=o>=</span> <span class=n>select</span><span class=p>(</span><span class=n>Product</span><span class=p>)</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>Product</span><span class=o>.</span><span class=n>id</span> <span class=o>==</span> <span class=n>product_id</span><span class=p>)</span><span class=o>.</span><span class=n>with_for_update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>product</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>stmt</span><span class=p>)</span><span class=o>.</span><span class=n>scalar_one</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>product</span><span class=o>.</span><span class=n>inventory</span> <span class=o>&gt;=</span> <span class=n>quantity</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>product</span><span class=o>.</span><span class=n>inventory</span> <span class=o>-=</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_request</span><span class=p>:</span> <span class=n>OrderRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결제를 처리합니다.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 결제 처리 로직을 구현합니다</span>
</span></span><span class=line><span class=cl>        <span class=c1># 외부 결제 시스템과의 연동이 필요합니다</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>purchase</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_request</span><span class=p>:</span> <span class=n>OrderRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;상품 구매를 처리합니다.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 멱등성 체크</span>
</span></span><span class=line><span class=cl>        <span class=n>idempotency_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_idempotency</span><span class=p>(</span><span class=n>order_request</span><span class=o>.</span><span class=n>idempotency_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>idempotency_result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>idempotency_result</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 분산 락 획득 시도</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>acquire_lock</span><span class=p>(</span><span class=n>order_request</span><span class=o>.</span><span class=n>product_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;error&#34;</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;다른 거래가 진행 중입니다&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>Session</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>engine</span><span class=p>)</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 트랜잭션 시작</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>begin</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 재고 확인 및 예약</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_and_reserve_inventory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>session</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>order_request</span><span class=o>.</span><span class=n>product_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>order_request</span><span class=o>.</span><span class=n>quantity</span>
</span></span><span class=line><span class=cl>                    <span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;error&#34;</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;재고가 부족합니다&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 결제 처리</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>process_payment</span><span class=p>(</span><span class=n>order_request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 결제 실패 시 롤백은 자동으로 수행됨</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;error&#34;</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;결제 처리에 실패했습니다&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 주문 정보 저장</span>
</span></span><span class=line><span class=cl>                    <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>user_id</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>product_id</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>product_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>quantity</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>total_amount</span><span class=o>=</span><span class=n>order_request</span><span class=o>.</span><span class=n>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>status</span><span class=o>=</span><span class=n>OrderStatus</span><span class=o>.</span><span class=n>COMPLETED</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>session</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=n>result</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;구매가 완료되었습니다&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 멱등성 결과 저장</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>save_idempotency_result</span><span class=p>(</span><span class=n>order_request</span><span class=o>.</span><span class=n>idempotency_key</span><span class=p>,</span> <span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;error&#34;</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 락 해제</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>release_lock</span><span class=p>(</span><span class=n>order_request</span><span class=o>.</span><span class=n>product_id</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=시스템을-실제로-운영할-때-고려해야-할-추가-사항들>시스템을 실제로 운영할 때 고려해야 할 추가 사항들<a hidden class=anchor aria-hidden=true href=#시스템을-실제로-운영할-때-고려해야-할-추가-사항들>#</a></h3><ol><li>모니터링과 로깅</li></ol><ul><li>모든 주문 처리 과정을 로깅하여 문제 발생 시 추적할 수 있어야 합니다.</li><li>시스템의 성능과 안정성을 모니터링해야 합니다.</li></ul><ol start=2><li>성능 최적화</li></ol><ul><li>캐시를 활용하여 자주 조회되는 상품 정보의 접근 속도를 개선할 수 있습니다.</li><li>데이터베이스 인덱스를 적절히 설정하여 조회 성능을 향상시킬 수 있습니다.</li></ul><ol start=3><li>확장성</li></ol><ul><li>시스템이 성장함에 따라 수평적 확장이 가능하도록 설계해야 합니다.</li><li>마이크로서비스 아키텍처의 도입을 고려할 수 있습니다.</li></ul><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/system-design/>System-Design</a></li><li><a href=https://buenhyden.github.io/tags/e-commerce-service/>E-Commerce-Service</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/backend-development/api-design-and-development/api-styles/event-based-style/server-sent-events/server-sent-events-vs-webhook/><span class=title>« Prev</span><br><span>Server-Sent Events vs. Webhook</span>
</a><a class=next href=https://buenhyden.github.io/posts/system-design/case-studies/%EC%84%A0%EC%82%AC%EC%9A%A9-it-%EC%86%94%EB%A3%A8%EC%85%98/><span class=title>Next »</span><br><span>선사용 IT 솔루션</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>