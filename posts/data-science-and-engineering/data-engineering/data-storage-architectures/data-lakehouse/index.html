<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Data Lakehouse | hyunyoun's Blog</title><meta name=keywords content="Data-Science-and-Engineering,Data-Engineering,Data-Storage-Architectures,Lakehouse-Architecture"><meta name=description content="Lakehouse Architecture는 데이터 레이크의 유연성과 비용 효율성을 데이터 웨어하우스의 성능 및 거버넌스 기능과 결합한 차세대 데이터 관리 아키텍처이다. 오픈 포맷 (Parquet, Delta Lake) 을 기반으로 구조화 및 비구조화 데이터를 단일 플랫폼에서 통합 관리하며, ACID 트랜잭션과 스키마 진화를 지원하여 실시간 분석과 머신러닝을 가능하게 한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/data-science-and-engineering/data-engineering/data-storage-architectures/data-lakehouse/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/data-science-and-engineering/data-engineering/data-storage-architectures/data-lakehouse/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/data-science-and-engineering/data-engineering/data-storage-architectures/data-lakehouse/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/data-science-and-engineering/data-engineering/data-storage-architectures/data-lakehouse/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Data Lakehouse"><meta property="og:description" content="Lakehouse Architecture는 데이터 레이크의 유연성과 비용 효율성을 데이터 웨어하우스의 성능 및 거버넌스 기능과 결합한 차세대 데이터 관리 아키텍처이다. 오픈 포맷 (Parquet, Delta Lake) 을 기반으로 구조화 및 비구조화 데이터를 단일 플랫폼에서 통합 관리하며, ACID 트랜잭션과 스키마 진화를 지원하여 실시간 분석과 머신러닝을 가능하게 한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Data Lakehouse"><meta name=twitter:description content="Lakehouse Architecture는 데이터 레이크의 유연성과 비용 효율성을 데이터 웨어하우스의 성능 및 거버넌스 기능과 결합한 차세대 데이터 관리 아키텍처이다. 오픈 포맷 (Parquet, Delta Lake) 을 기반으로 구조화 및 비구조화 데이터를 단일 플랫폼에서 통합 관리하며, ACID 트랜잭션과 스키마 진화를 지원하여 실시간 분석과 머신러닝을 가능하게 한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Data Lakehouse","item":"https://buenhyden.github.io/posts/data-science-and-engineering/data-engineering/data-storage-architectures/data-lakehouse/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>Data Lakehouse</h1><div class=post-description>Lakehouse Architecture는 데이터 레이크의 유연성과 비용 효율성을 데이터 웨어하우스의 성능 및 거버넌스 기능과 결합한 차세대 데이터 관리 아키텍처이다. 오픈 포맷 (Parquet, Delta Lake) 을 기반으로 구조화 및 비구조화 데이터를 단일 플랫폼에서 통합 관리하며, ACID 트랜잭션과 스키마 진화를 지원하여 실시간 분석과 머신러닝을 가능하게 한다.</div></header><div class=post-content><h2 id=data-lakehouse>Data Lakehouse<a hidden class=anchor aria-hidden=true href=#data-lakehouse>#</a></h2><p>Data Lakehouse 는 대규모 비정형 데이터를 저장하는 데이터 레이크와, 고성능 분석을 위한 데이터 웨어하우스의 특성을 결합한 하이브리드 데이터 아키텍처이다. 단일 스토리지 계층에서 대용량 원시 데이터 저장과 정형 데이터 관리, 데이터 엔지니어링, BI (Business Intelligence), 실시간 분석, 머신러닝 워크로드까지 하나의 통합 플랫폼에서 지원하는 현대적 데이터 아키텍처이다. Databricks, AWS, Google Cloud 등 다양한 클라우드 벤더들이 Lakehouse 기반 서비스를 제공하고 있다.</p><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><h4 id=전통적인-데이터-아키텍처의-한계>전통적인 데이터 아키텍처의 한계<a hidden class=anchor aria-hidden=true href=#전통적인-데이터-아키텍처의-한계>#</a></h4><p><strong>데이터 웨어하우스의 문제점</strong>:</p><ul><li>높은 스토리지 비용과 제한적인 확장성</li><li>정형 데이터에만 특화된 구조</li><li>스키마 변경의 어려움</li><li>실시간 처리 제약</li></ul><p><strong>데이터 레이크의 문제점</strong>:</p><ul><li>데이터 품질 관리 부족 (데이터 스움프 문제)</li><li>ACID 트랜잭션 미지원으로 인한 일관성 문제</li><li>복잡한 거버넌스와 보안 관리</li><li>느린 쿼리 성능</li></ul><table><thead><tr><th>문제점</th><th>Data Lake 한계</th><th>결과</th></tr></thead><tbody><tr><td>데이터 일관성 없음</td><td>Schema-on-read → 데이터 오류, 품질 저하</td><td>BI/분석 부적합</td></tr><tr><td>트랜잭션 부재</td><td>ACID 미지원, 동시성 문제</td><td>데이터 손상 위험</td></tr><tr><td>느린 쿼리 성능</td><td>포맷/인덱싱 최적화 부족</td><td>대규모 분석 비효율</td></tr><tr><td>메타데이터 부재</td><td>데이터 카탈로그 미통합</td><td>데이터 계보, 거버넌스 미흡</td></tr></tbody></table><h4 id=레이크하우스-등장-배경>레이크하우스 등장 배경<a hidden class=anchor aria-hidden=true href=#레이크하우스-등장-배경>#</a></h4><p>2017 년경부터 Netflix(Iceberg), Uber(Hudi), Databricks(Delta Lake) 에서 각각 독립적으로 개발이 시작되었으며, 다음과 같은 공통된 필요성에서 출발했다:</p><ul><li><strong>데이터 통합</strong>: 분산된 시스템으로 인한 데이터 사일로 문제 해결</li><li><strong>비용 최적화</strong>: 클라우드 오브젝트 스토리지의 경제성 활용</li><li><strong>성능 향상</strong>: 메타데이터 관리를 통한 쿼리 최적화</li><li><strong>거버넌스 강화</strong>: 엔터프라이즈급 데이터 관리 기능 제공</li></ul><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><ol><li><p><strong>통합된 데이터 플랫폼 구축</strong></p><ul><li>다양한 데이터 소스와 워크로드를 단일 플랫폼에서 처리</li><li>데이터 중복과 ETL 오버헤드 제거</li><li>일관된 데이터 거버넌스 정책 적용</li></ul></li><li><p><strong>실시간 의사결정 지원</strong></p><ul><li>배치와 스트리밍 처리의 통합</li><li>최신 데이터에 기반한 실시간 분석</li><li>머신러닝 모델의 실시간 피처 제공</li></ul></li><li><p><strong>비용 효율성 달성</strong></p><ul><li>클라우드 오브젝트 스토리지의 경제성 활용</li><li>컴퓨트 리소스의 탄력적 확장</li><li>중복 시스템 운영 비용 절감</li></ul></li></ol><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p><strong>Lakehouse Architecture</strong>는 데이터 레이크 (Data Lake) 의 <strong>확장성·유연성</strong>과 데이터 웨어하우스 (Data Warehouse) 의 <strong>신뢰성·거버넌스</strong>를 결합한 <strong>통합형 데이터 아키텍처</strong>이다. 이는 단일 스토리지 계층에서 <strong>정형·비정형 데이터를 함께 저장 및 처리</strong>하며, 고속 분석과 머신러닝까지 지원하는 아키텍처이다.</p><h4 id=기본-개념>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념>#</a></h4><ol><li><p><strong>하이브리드 데이터 관리 (Hybrid Data Management)</strong></p><ul><li><strong>데이터 레이크의 장점</strong>: 저비용 스토리지, 유연성, 확장성, 모든 데이터 타입 지원</li><li><strong>데이터 웨어하우스의 장점</strong>: ACID 트랜잭션, 스키마 관리, 성능 최적화, 거버넌스</li><li><strong>통합 접근법</strong>: 두 시스템의 장점을 결합하여 단일 플랫폼 제공</li></ul></li><li><p><strong>메타데이터 레이어 (Metadata Layer)</strong></p><ul><li><strong>Delta Lake</strong>: 오픈소스 스토리지 레이어로 ACID 트랜잭션 지원</li><li><strong>Apache Iceberg</strong>: 대규모 테이블 포맷으로 스키마 진화와 시간 여행 기능 제공</li><li><strong>Apache Hudi</strong>: 증분 처리와 실시간 업데이트에 최적화된 테이블 포맷</li></ul></li><li><p><strong>오픈 포맷과 표준 (Open Formats and Standards)</strong></p><ul><li><strong>Parquet</strong>: 컬럼형 스토리지 포맷으로 압축률과 쿼리 성능 최적화</li><li><strong>ORC</strong>: 하이브 생태계에서 최적화된 로우 컬럼형 포맷</li><li><strong>JSON/AVRO</strong>: 스키마 진화를 지원하는 유연한 데이터 포맷</li></ul></li><li><p><strong>컴퓨트 - 스토리지 분리 (Decoupled Compute and Storage)</strong></p><ul><li>독립적인 확장성 제공</li><li>다중 처리 엔진 지원 (Spark, Trino, Flink, Presto)</li><li>비용 최적화 및 성능 튜닝 가능</li></ul></li></ol><h4 id=핵심-개념의-실무-연관성>핵심 개념의 실무 연관성<a hidden class=anchor aria-hidden=true href=#핵심-개념의-실무-연관성>#</a></h4><p><strong>데이터 엔지니어링 관점</strong></p><ul><li><strong>ETL/ELT 파이프라인</strong>: 메달리온 아키텍처를 통한 단계적 데이터 처리</li><li><strong>스트리밍 처리</strong>: Apache Kafka 와 연동한 실시간 데이터 수집</li><li><strong>데이터 거버넌스</strong>: Unity Catalog 를 통한 중앙화된 메타데이터 관리</li></ul><p><strong>데이터 분석가 관점</strong></p><ul><li><strong>셀프 서비스 분석</strong>: SQL 인터페이스를 통한 직접적인 데이터 접근</li><li><strong>BI 도구 연동</strong>: Tableau, Power BI 와의 네이티브 연결</li><li><strong>실시간 대시보드</strong>: 최신 데이터를 활용한 의사결정 지원</li></ul><p><strong>데이터 사이언티스트 관점</strong></p><ul><li><strong>머신러닝 파이프라인</strong>: MLflow 를 활용한 모델 라이프사이클 관리</li><li><strong>피처 스토어</strong>: 일관된 피처 제공을 위한 중앙화된 관리</li><li><strong>실험 추적</strong>: 버전 관리와 재현 가능한 분석 환경</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><ol><li><p><strong>데이터 수집 및 저장</strong></p><ul><li>다양한 소스로부터 실시간/배치 데이터 수집</li><li>스키마 온 리드 (Schema-on-Read) 방식 지원</li><li>자동 압축 및 최적화</li></ul></li><li><p><strong>데이터 처리 및 변환</strong></p><ul><li>Apache Spark 기반 분산 처리</li><li>SQL 및 DataFrame API 지원</li><li>자동 스키마 진화</li></ul></li><li><p><strong>데이터 거버넌스</strong></p><ul><li>중앙화된 메타데이터 카탈로그</li><li>세밀한 접근 제어 (RBAC/ABAC)</li><li>데이터 계보 추적</li></ul></li><li><p><strong>분석 및 머신러닝</strong></p><ul><li>BI 도구와의 네이티브 연동</li><li>분산 머신러닝 플랫폼 제공</li><li>실시간 피처 서빙</li></ul></li></ol><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><ol><li><p><strong>개방성 (Openness)</strong></p><ul><li>오픈 소스 기반 아키텍처</li><li>표준 데이터 포맷 사용</li><li>멀티 벤더 지원</li></ul></li><li><p><strong>확장성 (Scalability)</strong></p><ul><li>페타바이트급 데이터 처리</li><li>수천 개의 동시 사용자 지원</li><li>클라우드 네이티브 설계</li></ul></li><li><p><strong>성능 (Performance)</strong></p><ul><li>메타데이터 기반 쿼리 최적화</li><li>인덱싱과 파티셔닝 지원</li><li>캐싱 및 압축 최적화</li></ul></li><li><p><strong>일관성 (Consistency)</strong></p><ul><li>ACID 트랜잭션 보장</li><li>동시성 제어</li><li>데이터 버전 관리</li></ul></li></ol><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><ol><li><p><strong>단일 진실 소스 (Single Source of Truth)</strong><br>모든 데이터를 하나의 일관된 플랫폼에서 관리하여 중복과 불일치를 제거한다.</p></li><li><p><strong>스키마 진화 (Schema Evolution)</strong><br>비즈니스 요구사항 변화에 따라 스키마를 안전하게 변경할 수 있다.</p></li><li><p><strong>점진적 품질 향상 (Incremental Quality Improvement)</strong><br>메달리온 아키텍처를 통해 데이터 품질을 단계적으로 개선한다.</p></li><li><p><strong>개방형 표준 준수 (Open Standards Compliance)</strong><br>벤더 종속성을 피하고 상호 운용성을 보장한다.</p></li></ol><h3 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h3><ul><li>데이터는 오픈 포맷으로 저장되며, ACID 트랜잭션 레이어를 통해 신뢰성 있는 데이터 처리 및 관리가 가능</li><li>메타데이터와 카탈로그 시스템을 통해 데이터 탐색, 관리, 거버넌스가 용이</li></ul><pre class=mermaid>flowchart TD
    A[원시 데이터 소스] --&gt; B[데이터 레이크 스토리지]
    B --&gt; C[ACID 트랜잭션 레이어]
    C --&gt; D[메타데이터/카탈로그]
    D --&gt; E[쿼리/분석 엔진]
    E --&gt; F[BI/ML/분석 시스템]
</pre><p>원시 데이터가 데이터 레이크 스토리지에 저장되고, ACID 트랜잭션 레이어를 통해 신뢰성 있게 관리된다. 메타데이터/카탈로그 시스템이 데이터 탐색과 관리를 지원하며, 쿼리/분석 엔진이 BI, 머신러닝 등 다양한 시스템에 데이터를 제공한다.</p><h4 id=메타데이터-중심-설계-metadata-driven-design>메타데이터 중심 설계 (Metadata-Driven Design)<a hidden class=anchor aria-hidden=true href=#메타데이터-중심-설계-metadata-driven-design>#</a></h4><p><strong>메타데이터 중심 설계</strong>는 데이터 처리 파이프라인과 분석 시스템의 핵심 요소를 <strong>명시적 코드가 아닌 메타데이터에 기반하여 동적으로 정의하고 제어</strong>하는 설계 방식이다.<br>Lakehouse Architecture 에서는 <strong>스키마, 변환 규칙, 파티셔닝, 보안 정책 등 대부분의 동작이 메타데이터로 정의되고 관리</strong>되기 때문에 이 설계 철학이 핵심이다.</p><pre class=mermaid>flowchart TD
    A[데이터 수집] --&gt; B[메타데이터 추출]
    B --&gt; C[&#34;메타데이터 저장 (Catalog 등록)&#34;]

    C --&gt; D[&#34;스키마 정의 (컬럼, 타입, 제약 조건)&#34;]
    C --&gt; E[&#34;처리 로직 정의 (변환 룰, 파티션 키, 조인 전략)&#34;]
    C --&gt; F[&#34;보안 정책 정의 (Row-Level, Tag-Based)&#34;]

    D --&gt; G[ETL 파이프라인 자동 생성]
    E --&gt; G
    F --&gt; H[정책 기반 권한 제어 적용]

    G --&gt; I[품질 검증 자동화]
    I --&gt; J[&#34;처리 결과 테이블 등록 (Bronze/Silver/Gold)&#34;]

    J --&gt; K[BI/ML/Streaming 분석 시스템 연계]
    H --&gt; K

    style A fill:#f9f,stroke:#333,stroke-width:1px
    style C fill:#cfc,stroke:#333,stroke-width:1px
    style G fill:#cff,stroke:#333,stroke-width:1px
    style J fill:#ffc,stroke:#333,stroke-width:1px
    style K fill:#ccf,stroke:#333,stroke-width:1px
</pre><table><thead><tr><th>단계</th><th>설명</th><th>대표 도구/구현 예시</th></tr></thead><tbody><tr><td><strong>1. 데이터 수집</strong></td><td>다양한 소스 (Kafka, RDBMS, API 등) 로부터 원시 데이터 수집</td><td>Flink, Kafka Connect, Airbyte</td></tr><tr><td><strong>2. 메타데이터 추출</strong></td><td>스키마, 컬럼 정보, 유형 등 자동 추출 또는 수동 정의</td><td>Spark Inference, dbt profile</td></tr><tr><td><strong>3. 메타데이터 저장</strong></td><td>카탈로그에 등록 (테이블 스키마, 정책 등)</td><td>Unity Catalog, Hive Metastore</td></tr><tr><td><strong>4. 정의</strong></td><td>스키마/처리로직/보안 정책 등 YAML 혹은 UI 기반 정의</td><td>dbt, Delta Sharing, Tag policy</td></tr><tr><td><strong>5. 자동 파이프라인 생성</strong></td><td>정의된 메타정보 기반으로 ETL/ELT 자동 실행</td><td>dbt run, Airflow DAG 생성</td></tr><tr><td><strong>6. 품질 검증</strong></td><td>정의된 품질 기준 기반 자동 검사</td><td>Great Expectations, Soda SQL</td></tr><tr><td><strong>7. 결과 등록 및 소비</strong></td><td>처리된 결과 테이블 등록 및 BI/ML/Streaming 소비</td><td>Power BI, Looker, MLflow</td></tr></tbody></table><h3 id=작동-원리-및-방식>작동 원리 및 방식<a hidden class=anchor aria-hidden=true href=#작동-원리-및-방식>#</a></h3><pre class=mermaid>flowchart TD
  A[Raw Data Ingestion] --&gt; B[&#34;Unified Storage (Parquet/Delta)&#34;]
  B --&gt; C[Transaction Log]
  B --&gt; D[&#34;Query Engine (Spark/Trino/Presto)&#34;]
  C --&gt; D
  D --&gt; E[&#34;Data Consumers (BI, ML, Streaming)&#34;]
</pre><ul><li>데이터는 S3, HDFS 등에 저장되며, 메타데이터와 트랜잭션 로그가 별도로 관리됨.</li><li>사용자 쿼리는 Delta/Apache Iceberg 등을 통해 트랜잭션 로그를 읽어 정확한 결과를 반환.</li><li>Time Travel, Schema Evolution, ACID 처리 등이 Query Engine 레벨에서 지원됨.</li></ul><h4 id=트랜잭션-로그-transaction-log>트랜잭션 로그 (Transaction Log)<a hidden class=anchor aria-hidden=true href=#트랜잭션-로그-transaction-log>#</a></h4><table><thead><tr><th>구분</th><th>내용</th></tr></thead><tbody><tr><td><strong>정의</strong></td><td>테이블의 <strong>모든 데이터 변경 이력</strong>(삽입, 수정, 삭제, 병합 등) 을 <strong>순차적 로그</strong> 형태로 기록하는 구조로, 데이터 정합성과 트랜잭션 일관성을 보장하는 핵심 구성 요소</td></tr><tr><td><strong>역할</strong></td><td>- <strong>ACID 트랜잭션</strong> 보장<br>- <strong>버저닝 및 롤백 지원</strong><br>- <strong>동시성 제어 (OCC)</strong><br>- <strong>스냅샷 쿼리</strong> 및 <strong>타임 트래블 (Time Travel)</strong> 지원</td></tr><tr><td><strong>구성 요소</strong></td><td>로그 파일 (파일 단위의 JSON 또는 Avro 기록), 체크포인트 파일, 메타데이터 정보 포함</td></tr><tr><td><strong>필요성</strong></td><td>데이터 웨어하우스 수준의 신뢰성과 데이터 레이크의 확장성을 모두 확보하기 위한 핵심 메커니즘</td></tr></tbody></table><ul><li><strong>트랜잭션 로그는 Lakehouse 의 신뢰성과 확장성을 연결하는 핵심 연결 고리</strong>이다.</li><li><strong>데이터 레이크</strong>의 유연성과 <strong>데이터 웨어하우스</strong>의 안정성을 융합하는 데 반드시 필요한 설계 요소로,선택한 포맷별로 트랜잭션 로그의 구현 방식과 활용 전략이 다르기 때문에, <strong>업무 요구사항에 따라 포맷 선정과 로그 관리 전략 수립이 필수</strong>다.</li></ul><h5 id=시스템별-트랜잭션-로그-설계>시스템별 트랜잭션 로그 설계<a hidden class=anchor aria-hidden=true href=#시스템별-트랜잭션-로그-설계>#</a></h5><table><thead><tr><th>시스템</th><th>트랜잭션 로그 경로/형식</th><th>특징 및 구현 방식</th></tr></thead><tbody><tr><td><strong>Delta Lake</strong></td><td><code>_delta_log/</code> 폴더 내 JSON 로그 + Parquet 체크포인트</td><td>- JSON 파일에 트랜잭션 단위로 기록<br>- 주기적으로 Parquet 형태로 체크포인트 생성<br>- <strong>Optimistic Concurrency Control</strong> 사용</td></tr><tr><td><strong>Apache Iceberg</strong></td><td>메타데이터 디렉토리 (manifest, metadata.json)</td><td>- 스냅샷/매니페스트 파일 기반 로그 구조<br>- <strong>Append-Only</strong> 방식의 Snapshot Log 관리<br>- <strong>Snapshot ID 기반</strong> 타임 트래블</td></tr><tr><td><strong>Apache Hudi</strong></td><td><code>.hoodie/</code> 디렉토리 내 Timeline 및 Commits</td><td>- commit, delta_commit, clean 등의 이벤트 단위 관리<br>- <strong>Timeline Server</strong> 통한 로그 재구성<br>- Upsert/CDC 기반 처리 최적화</td></tr></tbody></table><h5 id=트랜잭션-로그의-핵심-기능>트랜잭션 로그의 핵심 기능<a hidden class=anchor aria-hidden=true href=#트랜잭션-로그의-핵심-기능>#</a></h5><table><thead><tr><th>기능 구분</th><th>설명</th><th>주요 활용 사례</th></tr></thead><tbody><tr><td><strong>ACID 트랜잭션 보장</strong></td><td>로그 기반으로 멀티 사용자 동시 작업에서 충돌 없이 안정적 처리</td><td>병렬 Write, 분석 중 변경 안정성 확보</td></tr><tr><td><strong>Time Travel</strong></td><td>특정 시점 또는 버전의 상태로 쿼리 가능</td><td>실수 복구, 감사 추적, 모델 재학습용 샘플링</td></tr><tr><td><strong>Schema Evolution</strong></td><td>로그 기반으로 스키마 변경 이력 추적 및 점진적 반영</td><td>컬럼 추가/삭제 시 스키마 충돌 방지</td></tr><tr><td><strong>데이터 일관성 보장</strong></td><td>Checkpoint + 로그 조합으로 모든 상태를 정합하게 복원 가능</td><td>장애 복구, 트랜잭션 롤백</td></tr><tr><td><strong>CDC/Incremental 처리</strong></td><td>로그를 활용해 변경된 데이터만 추출 가능 (Change Data Capture)</td><td>실시간 데이터 파이프라인 구성, ML 재학습</td></tr></tbody></table><h4 id=쿼리-실행-query-execution>쿼리 실행 (Query Execution)<a hidden class=anchor aria-hidden=true href=#쿼리-실행-query-execution>#</a></h4><ol><li><strong>쿼리 계획</strong>: 메타데이터를 기반으로 최적화된 실행 계획 생성</li><li><strong>파티션 프루닝</strong>: 불필요한 파티션 제외로 성능 향상</li><li><strong>프레디케이트 푸시다운</strong>: 필터 조건을 스토리지 레벨로 이동</li><li><strong>결과 반환</strong>: 최적화된 방식으로 결과 제공</li></ol><h3 id=lakehouse-환경에서의-오픈-테이블-포맷-비교>Lakehouse 환경에서의 오픈 테이블 포맷 비교<a hidden class=anchor aria-hidden=true href=#lakehouse-환경에서의-오픈-테이블-포맷-비교>#</a></h3><p>오픈 테이블 포맷은 <strong>데이터 레이크에 저장된 파일 (PARQUET 등) 에 ACID 트랜잭션, 스키마 진화, 시간여행 (Time Travel)</strong> 등의 기능을 부여하여, <strong>데이터 웨어하우스 수준의 신뢰성과 성능</strong>을 제공하는 계층형 메타데이터 구조다.</p><p><strong>도입 배경</strong>:</p><ul><li>기존의 단순한 파일 기반 저장 (PARQUET, CSV 등) 은 다음과 같은 문제점을 가짐:<ul><li>트랜잭션 없음 → 동시 쓰기/읽기 충돌</li><li>스키마 변경 어려움 → 데이터 품질 저하</li><li>파일 조각화, 메타데이터 누락 → 성능 저하</li></ul></li></ul><blockquote><p>이 문제를 해결하기 위해 오픈 테이블 포맷이 등장했고, 특히 <strong>Delta Lake, Iceberg, Hudi</strong>는 각기 다른 강점을 지닌 <strong>주요 표준</strong>으로 자리 잡았다.</p></blockquote><table><thead><tr><th><strong>항목</strong></th><th><strong>Delta Lake</strong></th><th><strong>Apache Iceberg</strong></th><th><strong>Apache Hudi</strong></th></tr></thead><tbody><tr><td><strong>출시/개발사</strong></td><td>Databricks (2019)</td><td>Netflix (2018), Apache Top-Level Project</td><td>Uber (2017), Apache Top-Level Project</td></tr><tr><td><strong>기본 저장 포맷</strong></td><td>Parquet</td><td>Parquet, Avro (유연한 포맷 선택)</td><td>Parquet (기본)</td></tr><tr><td><strong>트랜잭션 지원 (ACID)</strong></td><td>✅ 강력한 ACID 지원 (Optimistic Concurrency Control)</td><td>✅ Snapshot Isolation 기반 트랜잭션</td><td>✅ MVCC 기반 트랜잭션 관리 (모드 선택 가능: COW/MOR)</td></tr><tr><td><strong>시간여행 (Time Travel)</strong></td><td>✅ <code>versionAsOf</code>, <code>timestampAsOf</code> 지원</td><td>✅ <code>snapshot-id</code>, <code>timestamp</code> 기반</td><td>⚠ 직접 지원은 없고 타임라인 기반 Query 로 유사 기능 구현 가능</td></tr><tr><td><strong>스키마 진화</strong></td><td>✅ 자동 병합 가능, 충돌 검출 지원</td><td>✅ 추가/삭제/변경 지원, 타입 변경 제한 있음</td><td>✅ 컬럼 추가/삭제/변경 지원, 충돌 제어 가능</td></tr><tr><td><strong>증분 처리 (CDC)</strong></td><td>⚠ 제한적 (Delta Change Feed 필요, Preview 중)</td><td>⚠ 외부 CDC 도구 필요 (Flink + Debezium 등)</td><td>✅ 기본 내장 (<code>incremental query</code>, <code>delta stream query</code>)</td></tr><tr><td><strong>제약 조건 (Constraints)</strong></td><td>✅ NOT NULL, CHECK 등 일부 제약 조건 지원</td><td>✅ NOT NULL, UNIQUE 지원 (LIMITED)</td><td>⚠ 기본 제약 조건 미약 (검증은 애플리케이션에서 처리)</td></tr><tr><td><strong>Partition 지원</strong></td><td>✅ Range, Hash, Z-ordering 지원</td><td>✅ Hidden Partitioning, Expression Partitioning 가능</td><td>✅ 파티션 병합 및 동적 파티셔닝 지원</td></tr><tr><td><strong>카탈로그 통합성</strong></td><td>Unity Catalog, Hive Metastore 연동</td><td>Hive, AWS Glue, REST Catalog 등 다양한 외부 카탈로그와 기본 통합</td><td>Hive, AWS Glue, Hudi 자체 카탈로그 연동 가능</td></tr><tr><td><strong>쿼리 엔진 호환성</strong></td><td>Spark, Presto, Trino, Flink, SQL-based BI (Databricks 중심)</td><td>Spark, Trino, Flink, Presto, Snowflake, BigQuery 등 다양한 엔진과 강한 호환성</td><td>Spark, Flink (주력), Hive, Presto 등 일부 제한 있음</td></tr><tr><td><strong>데이터 계보/Lineage</strong></td><td>Unity Catalog 기반 Lineage 시각화 가능 (Databricks Pro 환경)</td><td>OpenLineage 등 외부 연동으로 지원 가능</td><td>Timeline 기반 의사 계보 추적 가능</td></tr><tr><td><strong>성능 최적화 기능</strong></td><td>OPTIMIZE (Compaction), Z-Ordering, Data Skipping, Delta Cache</td><td>Metadata Pruning, Hidden Partitioning, File Elimination</td><td>Async Compaction, Index 지원, Clustering (Hudi v0.11+)</td></tr><tr><td><strong>사용 시나리오</strong></td><td>ETL, ML 데이터 저장, BI 분석 테이블, 정형 데이터 분석 중심</td><td>대규모 웨어하우스 대체, 멀티엔진 통합 분석, 오픈 표준 환경</td><td>IoT, 로그 분석, 실시간 CDC, 모바일 백엔드 로그</td></tr><tr><td><strong>커뮤니티/생태계</strong></td><td>Databricks 주도, 기여 제한적</td><td>Apache 중심, AWS/Snowflake/Netflix/Apple 등 광범위한 기여</td><td>Apache 중심, LinkedIn/Uber 등 실시간 처리 기업 중심</td></tr><tr><td><strong>상용 제품 통합</strong></td><td>✅ Databricks 에 완전 통합, Unity Catalog/Photon 엔진 활용 가능</td><td>✅ Snowflake, AWS Athena, Dremio 등 통합 가능</td><td>✅ AWS EMR, Onehouse, Cloudera 등에서 활용 중</td></tr><tr><td><strong>장점 요약</strong></td><td>✅ 강력한 ACID + Time Travel + Databricks 최적화</td><td>✅ 포맷 표준화 + 호환성 + 멀티엔진 분석 가능</td><td>✅ CDC + 증분 처리 + 실시간 Upsert 최적화</td></tr><tr><td><strong>단점 요약</strong></td><td>Databricks 의존도 높음, 개방형 표준 부족</td><td>구현 복잡도 높음 (메타데이터 레이어), 설정 요구사항 많음</td><td>메타데이터 동기화 이슈, BI 분석 쿼리에 비해 성능 약함</td></tr></tbody></table><h4 id=delta-lake-기반-구현>Delta Lake 기반 구현<a hidden class=anchor aria-hidden=true href=#delta-lake-기반-구현>#</a></h4><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td><strong>개발 주체</strong></td><td>Databricks (2019), 이후 Linux Foundation 기여 (Delta 2.0 이후 오픈)</td></tr><tr><td><strong>저장 포맷</strong></td><td>Parquet</td></tr><tr><td><strong>트랜잭션 방식</strong></td><td>ACID 지원 (Optimistic Concurrency Control)</td></tr><tr><td><strong>핵심 구성 요소</strong></td><td><code>_delta_log/</code> 디렉토리 내 JSON 로그 + Checkpoint</td></tr><tr><td><strong>강점</strong></td><td>Time Travel, Z-ordering, Auto Compaction, Unity Catalog 연계</td></tr><tr><td><strong>약점</strong></td><td>Databricks 환경에서 가장 강력함 (OSS 환경에서 성능, 통합성 낮음)</td></tr><tr><td><strong>주요 활용 사례</strong></td><td>정형 데이터 중심의 ML 파이프라인, 정제된 BI 데이터마트, 데이터 계보/통제 기반 관리</td></tr></tbody></table><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Delta Lake 테이블 생성</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>delta.tables</span> <span class=kn>import</span> <span class=n>DeltaTable</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>spark</span> <span class=o>=</span> <span class=n>SparkSession</span><span class=o>.</span><span class=n>builder</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>appName</span><span class=p>(</span><span class=s2>&#34;LakehouseExample&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.sql.extensions&#34;</span><span class=p>,</span> <span class=s2>&#34;io.delta.sql.DeltaSparkSessionExtension&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.sql.catalog.spark_catalog&#34;</span><span class=p>,</span> <span class=s2>&#34;org.apache.spark.sql.delta.catalog.DeltaCatalog&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>getOrCreate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Bronze Layer - 원시 데이터 수집</span>
</span></span><span class=line><span class=cl><span class=n>bronze_df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>json</span><span class=p>(</span><span class=s2>&#34;s3://data-lake/raw/transactions/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>bronze_df</span><span class=o>.</span><span class=n>write</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>mode</span><span class=p>(</span><span class=s2>&#34;append&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s2>&#34;s3://lakehouse/bronze/transactions&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Silver Layer - 데이터 정제</span>
</span></span><span class=line><span class=cl><span class=n>silver_df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;s3://lakehouse/bronze/transactions&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=s2>&#34;amount &gt; 0&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>dropDuplicates</span><span class=p>([</span><span class=s2>&#34;transaction_id&#34;</span><span class=p>])</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>withColumn</span><span class=p>(</span><span class=s2>&#34;processed_date&#34;</span><span class=p>,</span> <span class=n>current_timestamp</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>silver_df</span><span class=o>.</span><span class=n>write</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>mode</span><span class=p>(</span><span class=s2>&#34;append&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s2>&#34;s3://lakehouse/silver/transactions&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=apache-iceberg-기반-구현>Apache Iceberg 기반 구현<a hidden class=anchor aria-hidden=true href=#apache-iceberg-기반-구현>#</a></h4><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td><strong>개발 주체</strong></td><td>Netflix 주도, Apache TLP (2020), Apple, AWS, Snowflake 참여</td></tr><tr><td><strong>저장 포맷</strong></td><td>Parquet, Avro, ORC (유연한 선택 가능)</td></tr><tr><td><strong>트랜잭션 방식</strong></td><td>Snapshot Isolation 기반 트랜잭션</td></tr><tr><td><strong>핵심 구성 요소</strong></td><td>Metadata JSON 파일, Manifest List, Manifest File</td></tr><tr><td><strong>강점</strong></td><td>Hidden Partitioning, Multi-engine Compatibility, REST Catalog, ANSI SQL 지원</td></tr><tr><td><strong>약점</strong></td><td>구조가 복잡함, 동기화 오류 발생 시 복구 복잡도 있음</td></tr><tr><td><strong>주요 활용 사례</strong></td><td>Snowflake, AWS Glue, Trino, Dremio 기반의 멀티 클라우드 웨어하우스 환경</td></tr></tbody></table><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Iceberg 테이블 생성</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pyiceberg</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyiceberg.catalog</span> <span class=kn>import</span> <span class=n>load_catalog</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>catalog</span> <span class=o>=</span> <span class=n>load_catalog</span><span class=p>(</span><span class=s2>&#34;default&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 테이블 스키마 정의</span>
</span></span><span class=line><span class=cl><span class=n>schema</span> <span class=o>=</span> <span class=n>Schema</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=n>NestedField</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;transaction_id&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>NestedField</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;customer_id&#34;</span><span class=p>,</span> <span class=n>LongType</span><span class=p>(),</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>NestedField</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>,</span> <span class=n>DecimalType</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>NestedField</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=s2>&#34;transaction_date&#34;</span><span class=p>,</span> <span class=n>TimestampType</span><span class=p>(),</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 파티션 스펙 정의</span>
</span></span><span class=line><span class=cl><span class=n>partition_spec</span> <span class=o>=</span> <span class=n>PartitionSpec</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=n>PartitionField</span><span class=p>(</span><span class=n>source_id</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>field_id</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>transform</span><span class=o>=</span><span class=n>DayTransform</span><span class=p>(),</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;day&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 테이블 생성</span>
</span></span><span class=line><span class=cl><span class=n>table</span> <span class=o>=</span> <span class=n>catalog</span><span class=o>.</span><span class=n>create_table</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>identifier</span><span class=o>=</span><span class=s2>&#34;warehouse.transactions&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schema</span><span class=o>=</span><span class=n>schema</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>partition_spec</span><span class=o>=</span><span class=n>partition_spec</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=apache-hudi-기반-구현>Apache Hudi 기반 구현<a hidden class=anchor aria-hidden=true href=#apache-hudi-기반-구현>#</a></h4><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td><strong>개발 주체</strong></td><td>Uber (2017), Apache TLP (2020)</td></tr><tr><td><strong>저장 포맷</strong></td><td>Parquet</td></tr><tr><td><strong>트랜잭션 방식</strong></td><td>MVCC 기반 (Copy-On-Write, Merge-On-Read 모드 선택)</td></tr><tr><td><strong>핵심 구성 요소</strong></td><td><code>.hoodie/</code> 메타디렉토리, Timeline, Commit, Delta Log</td></tr><tr><td><strong>강점</strong></td><td>실시간 ingest, Upsert/Delete 지원, CDC, Incremental Query, Stream Write</td></tr><tr><td><strong>약점</strong></td><td>쿼리 최적화, 복잡한 데이터 모델에선 성능 저하 가능</td></tr><tr><td><strong>주요 활용 사례</strong></td><td>IoT/이벤트 기반 로그 처리, 실시간 분석, S3 기반 CDC 파이프라인 (Amazon EMR, Onehouse 등)</td></tr></tbody></table><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Hudi 테이블 생성</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>spark</span> <span class=o>=</span> <span class=n>SparkSession</span><span class=o>.</span><span class=n>builder</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>appName</span><span class=p>(</span><span class=s2>&#34;HudiLakehouse&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.serializer&#34;</span><span class=p>,</span> <span class=s2>&#34;org.apache.spark.serializer.KryoSerializer&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>getOrCreate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Hudi 옵션 설정</span>
</span></span><span class=line><span class=cl><span class=n>hudi_options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;hoodie.table.name&#39;</span><span class=p>:</span> <span class=s1>&#39;customer_orders&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;hoodie.datasource.write.recordkey.field&#39;</span><span class=p>:</span> <span class=s1>&#39;order_id&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;hoodie.datasource.write.partitionpath.field&#39;</span><span class=p>:</span> <span class=s1>&#39;partition_date&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;hoodie.datasource.write.table.name&#39;</span><span class=p>:</span> <span class=s1>&#39;customer_orders&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;hoodie.datasource.write.operation&#39;</span><span class=p>:</span> <span class=s1>&#39;upsert&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;hoodie.datasource.write.precombine.field&#39;</span><span class=p>:</span> <span class=s1>&#39;ts&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;hoodie.upsert.shuffle.parallelism&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;hoodie.insert.shuffle.parallelism&#39;</span><span class=p>:</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 데이터 업서트</span>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=o>.</span><span class=n>write</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;hudi&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=o>**</span><span class=n>hudi_options</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>mode</span><span class=p>(</span><span class=s2>&#34;append&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s2>&#34;s3://lakehouse/hudi/customer_orders&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=도입-목적별-오픈-테이블-포맷-선택-가이드>도입 목적별 오픈 테이블 포맷 선택 가이드<a hidden class=anchor aria-hidden=true href=#도입-목적별-오픈-테이블-포맷-선택-가이드>#</a></h4><p>목적 중심 선택 기준 매트릭스</p><table><thead><tr><th><strong>도입 목적</strong></th><th><strong>권장 포맷</strong></th><th><strong>선택 이유</strong></th></tr></thead><tbody><tr><td><strong>정형 데이터 기반 BI 분석</strong></td><td><strong>Delta Lake</strong></td><td>ACID, Time Travel, 쿼리 최적화 (Optimize, Z-order) 로 신뢰성 있는 BI 리포팅 가능</td></tr><tr><td><strong>멀티 엔진 + 멀티 클라우드 분석 환경 구축</strong></td><td><strong>Apache Iceberg</strong></td><td>엔진 독립적 포맷. Trino, Flink, Spark, Snowflake 등 다양한 쿼리 엔진과의 호환성 우수</td></tr><tr><td><strong>실시간 로그 수집 및 CDC 파이프라인 구성</strong></td><td><strong>Apache Hudi</strong></td><td>Upsert, CDC, Incremental Query, MOR 지원으로 실시간 처리에 적합</td></tr><tr><td><strong>스키마가 자주 변경되는 데이터 환경</strong></td><td><strong>Iceberg / Hudi</strong></td><td>스키마 진화에 유연. Iceberg 는 구조 안정성, Hudi 는 실시간 유연성에 강점</td></tr><tr><td><strong>시간 기반 분석 (버전/리플레이 요구)</strong></td><td><strong>Delta Lake / Iceberg</strong></td><td>Time Travel 기능 내장. 버전 기반의 분석 및 복구 가능</td></tr><tr><td><strong>대용량 정형 테이블 운영 및 저장 비용 절감</strong></td><td><strong>Apache Iceberg</strong></td><td>Metadata Pruning, Hidden Partition 등 성능 최적화 + Z-Ordering 없이도 효율적인 데이터 스캔 가능</td></tr><tr><td><strong>ML 파이프라인 및 Feature Store 구성</strong></td><td><strong>Delta Lake</strong></td><td>MLflow, Feature Store 와의 통합성이 뛰어나며 신뢰성 높은 정제 테이블 구성 가능</td></tr><tr><td><strong>복잡한 트랜잭션 처리 (Upsert, Delete 등)</strong></td><td><strong>Delta Lake / Hudi</strong></td><td>Delta 는 강력한 Concurrency Control, Hudi 는 실시간 Upsert 에 유리</td></tr><tr><td><strong>오픈소스 기반의 완전한 벤더 중립 환경 구축</strong></td><td><strong>Apache Iceberg</strong></td><td>표준화된 API + 오픈 커뮤니티 기반 생태계</td></tr></tbody></table><h5 id=어떤-포맷을-언제-쓰는가>어떤 포맷을 언제 쓰는가?<a hidden class=anchor aria-hidden=true href=#어떤-포맷을-언제-쓰는가>#</a></h5><table><thead><tr><th><strong>사용 목적/환경</strong></th><th><strong>추천 포맷</strong></th></tr></thead><tbody><tr><td>✅ BI + ML 파이프라인 신뢰성, 일관성 필요</td><td>Delta Lake</td></tr><tr><td>✅ 다양한 엔진/도구와 통합하여 대규모 분석 수행</td><td>Apache Iceberg</td></tr><tr><td>✅ 실시간 ingest, CDC, Upsert 중심 환경 구축</td><td>Apache Hudi</td></tr></tbody></table><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><pre class=mermaid>graph TB
    subgraph &#34;데이터 소스&#34;
    DS1[트랜잭션 DB]
    DS2[파일 시스템]
    DS3[스트리밍]
    DS4[API]
    end
    
    subgraph &#34;수집 레이어&#34;
    ING1[Apache Kafka]
    ING2[Apache Airflow]
    ING3[Delta Live Tables]
    end
    
    subgraph &#34;스토리지 레이어&#34;
    STG1[클라우드 오브젝트 스토리지]
    STG2[Delta Lake/Iceberg]
    end
    
    subgraph &#34;메타데이터 레이어&#34;
    META1[Unity Catalog]
    META2[Hive Metastore]
    META3[AWS Glue Catalog]
    end
    
    subgraph &#34;컴퓨트 레이어&#34;
    COMP1[Apache Spark]
    COMP2[Trino/Presto]
    COMP3[Apache Flink]
    end
    
    subgraph &#34;서빙 레이어&#34;
    SERV1[Databricks SQL]
    SERV2[BI 도구]
    SERV3[ML 플랫폼]
    SERV4[애플리케이션]
    end
    
    DS1 --&gt; ING1
    DS2 --&gt; ING2
    DS3 --&gt; ING1
    DS4 --&gt; ING3
    
    ING1 --&gt; STG1
    ING2 --&gt; STG1
    ING3 --&gt; STG2
    
    STG1 --&gt; META1
    STG2 --&gt; META2
    
    META1 --&gt; COMP1
    META2 --&gt; COMP2
    META3 --&gt; COMP3
    
    COMP1 --&gt; SERV1
    COMP2 --&gt; SERV2
    COMP3 --&gt; SERV3
    COMP1 --&gt; SERV4
</pre><h4 id=구성요소>구성요소<a hidden class=anchor aria-hidden=true href=#구성요소>#</a></h4><table><thead><tr><th>구분</th><th>구성요소</th><th>기능</th><th>역할</th><th>주요 특징</th></tr></thead><tbody><tr><td>필수</td><td>메타데이터 레이어</td><td>테이블 및 파티션 메타데이터 관리</td><td>스키마, 파티션, 통계 정보 유지</td><td>ACID 트랜잭션, 타임 트래블, 버전 관리 지원</td></tr><tr><td></td><td>스토리지 레이어</td><td>데이터 파일 저장</td><td>오브젝트 스토리지 기반 데이터 저장</td><td>확장성, 내구성, 비용 효율성</td></tr><tr><td></td><td>컴퓨트 엔진</td><td>쿼리 실행 및 데이터 처리</td><td>분산 SQL 처리, ETL/ELT 작업 수행</td><td>대규모 분산 처리, 성능 최적화</td></tr><tr><td></td><td>카탈로그 서비스</td><td>메타데이터 카탈로그 및 통합 관리</td><td>테이블 정의, 탐색, 정책 연동</td><td>중앙화된 거버넌스, 데이터 검색성 향상</td></tr><tr><td>선택</td><td>스트리밍 엔진</td><td>실시간 데이터 수집 및 처리</td><td>이벤트 기반 데이터 처리</td><td>저지연 처리, 실시간 분석 지원</td></tr><tr><td></td><td>ML 플랫폼</td><td>머신러닝 파이프라인 통합 및 운영</td><td>모델 훈련, 피처 관리, 배포</td><td>AutoML, Feature Store, MLOps 연계</td></tr><tr><td></td><td>데이터 거버넌스 시스템</td><td>보안 및 정책 관리</td><td>접근 제어, 감사 추적, 정책 일관성 유지</td><td>규정 준수, 데이터 품질 보장</td></tr><tr><td></td><td>BI 커넥터</td><td>시각화 도구 연동</td><td>BI 도구에서의 분석 및 리포팅</td><td>셀프 서비스 분석, Tableau/PowerBI 등 연동 지원</td></tr></tbody></table><ul><li><strong>필수 구성요소</strong>는 Lakehouse 의 <strong>기반 인프라</strong>를 구성하며, 데이터 저장부터 처리, 관리까지 모든 파이프라인의 핵심 역할을 담당.</li><li><strong>선택 구성요소</strong>는 <strong>확장성과 고도화</strong>를 위한 요소로, 실시간 처리, ML 통합, 거버넌스, 시각화 등 비즈니스 연계 기능을 강화하는 목적.</li><li><strong>카탈로그 서비스</strong>와 <strong>메타데이터 레이어</strong>는 명확히 구분되며, 전자는 <strong>발견 및 정책 중심</strong>, 후자는 <strong>저장 및 트랜잭션 중심</strong>으로 설계됨.</li></ul><h3 id=메달리온-아키텍처-medallion-architecture>메달리온 아키텍처 (Medallion Architecture)<a hidden class=anchor aria-hidden=true href=#메달리온-아키텍처-medallion-architecture>#</a></h3><p>데이터 레이크 혹은 레이크하우스에서 **데이터를 품질과 정제 수준에 따라 여러 계층 (Bronze, Silver, Gold)**으로 나누어 구성하는 <strong>계층적 처리 아키텍처 패턴</strong>이다. Lakehouse 구조에서 <strong>데이터 품질 향상과 단계적 정제</strong>를 위해 가장 널리 사용되는 <strong>정형화된 데이터 계층화 전략</strong>이다.</p><pre class=mermaid>graph LR
    subgraph &#34;Bronze Layer&#34;
    B1[원시 로그 데이터]
    B2[센서 데이터]
    B3[트랜잭션 데이터]
    B4[소셜 미디어 데이터]
    end
    
    subgraph &#34;Silver Layer&#34;
    S1[정제된 고객 데이터]
    S2[표준화된 제품 데이터]
    S3[통합된 주문 데이터]
    S4[검증된 이벤트 데이터]
    end
    
    subgraph &#34;Gold Layer&#34;
    G1[고객 360도 뷰]
    G2[실시간 대시보드]
    G3[예측 모델 피처]
    G4[비즈니스 KPI]
    end
    
    B1 --&gt; S1
    B2 --&gt; S2
    B3 --&gt; S3
    B4 --&gt; S4
    
    S1 --&gt; G1
    S2 --&gt; G1
    S3 --&gt; G2
    S4 --&gt; G3
    
    G1 --&gt; G4
    G2 --&gt; G4
    G3 --&gt; G4
</pre><table><thead><tr><th><strong>계층</strong></th><th><strong>설명</strong></th><th><strong>데이터 상태</strong></th><th><strong>주요 작업</strong></th></tr></thead><tbody><tr><td><strong>Bronze (원시 계층)</strong></td><td>데이터 소스에서 <strong>Raw 형태로 수집</strong>한 원본 데이터</td><td>미정제, 불완전, 로그 기반</td><td>수집, 적재, 스키마 적용, CDC 수신 등</td></tr><tr><td><strong>Silver (정제 계층)</strong></td><td>Bronze 데이터를 <strong>클렌징 및 변환</strong>하여 신뢰 가능한 형태로 구성</td><td>필터링됨, 정제됨, 일부 결측 보완</td><td>Null 처리, 정규화, 조인, 형식 표준화</td></tr><tr><td><strong>Gold (집계 계층)</strong></td><td>비즈니스 목적에 맞게 <strong>집계, 요약, 분석 최적화</strong>된 데이터</td><td>집계 완료, 분석/리포팅 최적화</td><td>집계, KPI 계산, 피봇, 시계열 요약</td></tr></tbody></table><h4 id=레이어드-아키텍처-layered-architecture>레이어드 아키텍처 (Layered Architecture)<a hidden class=anchor aria-hidden=true href=#레이어드-아키텍처-layered-architecture>#</a></h4><pre class=mermaid>graph LR
    A[Bronze Layer&lt;br/&gt;원시 데이터] --&gt; B[Silver Layer&lt;br/&gt;정제 데이터]
    B --&gt; C[Gold Layer&lt;br/&gt;비즈니스 데이터]
    
    subgraph &#34;데이터 품질 향상&#34;
    A
    B  
    C
    end
</pre><p>각 레이어는 명확한 목적과 책임을 가지며, 점진적으로 데이터 품질을 향상시킨다.</p><h4 id=데이터-수집-data-ingestion>데이터 수집 (Data Ingestion)<a hidden class=anchor aria-hidden=true href=#데이터-수집-data-ingestion>#</a></h4><pre class=mermaid>sequenceDiagram
    participant S as 데이터 소스
    participant I as 수집 도구
    participant B as Bronze Layer
    participant M as 메타데이터
    
    S-&gt;&gt;I: 원시 데이터 전송
    I-&gt;&gt;B: 데이터 저장 (Parquet/Delta)
    I-&gt;&gt;M: 메타데이터 등록
    M-&gt;&gt;B: 스키마 정보 연결
</pre><h4 id=데이터-처리-data-processing>데이터 처리 (Data Processing)<a hidden class=anchor aria-hidden=true href=#데이터-처리-data-processing>#</a></h4><pre class=mermaid>graph TD
    A[Bronze] --&gt;|ETL/ELT| B[Silver]
    B --&gt;|Aggregation| C[Gold]
    
    subgraph &#34;처리 엔진&#34;
    D[Apache Spark]
    E[Apache Flink] 
    F[Trino/Presto]
    end
    
    D --&gt; A
    D --&gt; B
    D --&gt; C
    E --&gt; A
    F --&gt; C
</pre><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>구현 기법</strong></th><th><strong>정의 및 구성</strong></th><th><strong>주요 목적 / 역할</strong></th><th><strong>대표 기술 및 예시</strong></th></tr></thead><tbody><tr><td><strong>스토리지 및 포맷 계층</strong></td><td>오픈 포맷 저장</td><td>Parquet, ORC, Avro 등 표준화된 포맷 기반으로 저장</td><td>벤더 종속성 제거, 도구 간 호환성 확보</td><td>Delta Lake, Iceberg, Hudi, S3/Blob/GCS 기반 객체 스토리지</td></tr><tr><td></td><td>테이블 포맷</td><td>메타데이터와 데이터 파일 분리, 계층적 메타 구성</td><td>쿼리 최적화, 트랜잭션 관리, 버저닝 지원</td><td>Delta Lake (_delta_log), Iceberg (manifest), Hudi (.hoodie)</td></tr><tr><td><strong>트랜잭션 및 처리 방식</strong></td><td>ACID 트랜잭션 레이어</td><td>MVCC, OCC 기반 로그 관리와 체크포인트 적용</td><td>데이터 일관성, 롤백, 병합 지원</td><td>Delta: Optimistic CC, Iceberg: Snapshot, Hudi: Timeline</td></tr><tr><td></td><td>Incremental ETL</td><td>CDC 기반 변경 데이터만 처리</td><td>리소스 절감, 빠른 배치/업서트 처리</td><td>Hudi Incremental Query, Merge-On-Read</td></tr><tr><td></td><td>Streaming + Batch 통합 처리</td><td>스트리밍 처리와 배치 처리의 동일한 데이터 경로 통합</td><td>실시간 분석, 지연 최소화</td><td>Spark Structured Streaming + Delta Sink, Flink + Hudi</td></tr><tr><td><strong>스키마 및 버저닝 계층</strong></td><td>Schema Evolution</td><td>컬럼 추가/삭제/변형을 자동으로 반영</td><td>유연한 데이터 적응력</td><td>Delta: Auto Merge Schema, Iceberg: Schema V2, Hudi: Evolvable</td></tr><tr><td></td><td>Time Travel / Snapshot Query</td><td>특정 시간 또는 버전 기반으로 데이터 재현</td><td>감사 추적, 오류 복구, 재현성 보장</td><td>Delta: versionAsOf, Iceberg: snapshot_id, Hudi: commit timestamp</td></tr><tr><td><strong>메타데이터 및 거버넌스</strong></td><td>Metadata Catalog 연동</td><td>테이블 정의, 스키마, 권한 등의 중앙 집중 메타 관리</td><td>데이터 탐색, 거버넌스, 계보 추적</td><td>AWS Glue, Unity Catalog, Apache Hive Metastore</td></tr><tr><td></td><td>Audit & Lineage</td><td>쿼리 로그, 변경 이력, 접근 기록 관리</td><td>규제 준수, 거버넌스 강화</td><td>Unity Catalog, DataHub, Amundsen</td></tr><tr><td><strong>처리 및 분석 계층</strong></td><td>쿼리 및 분석 엔진</td><td>SQL 및 Spark, Trino, Presto, Flink 등의 다중 엔진</td><td>실시간/배치 분석, BI/ML 통합</td><td>Databricks, AWS Athena, Snowflake, Trino</td></tr><tr><td></td><td>자동 최적화 및 컴팩션</td><td>파일 조각 자동 병합, Z-ordering 등으로 성능 개선</td><td>쿼리 속도 향상, 리소스 절감</td><td>Delta: Optimize, Iceberg: RewriteManifests, Hudi: Async Compaction</td></tr></tbody></table><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>핵심 장점</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>1. 저장소 통합 및 유연성</strong></td><td><strong>단일 데이터 저장소</strong></td><td>정형, 반정형, 비정형 데이터를 하나의 플랫폼에서 통합 관리함으로써 데이터 사일로를 제거하고 유연한 워크로드 대응 가능</td></tr><tr><td></td><td><strong>유연한 데이터 처리 모델</strong></td><td>배치와 스트리밍 처리 통합을 통해 다양한 데이터 흐름 (예: 실시간 분석, 이벤트 기반 ML) 에 적합</td></tr><tr><td><strong>2. 확장성 및 성능</strong></td><td><strong>수평 확장 구조</strong></td><td>클라우드 오브젝트 스토리지 기반으로 수십~수백 페타바이트 이상까지 무중단 확장 가능</td></tr><tr><td></td><td><strong>고성능 쿼리 처리</strong></td><td>Z-ordering, 인덱싱, 파티셔닝, 캐시 등을 통해 웨어하우스 수준의 쿼리 성능 확보</td></tr><tr><td><strong>3. 경제성</strong></td><td><strong>비용 효율성</strong></td><td>컴퓨트 - 스토리지 분리 및 오브젝트 스토리지 활용으로 전통적 DW 대비 TCO 절감 (최대 70~90%)</td></tr><tr><td></td><td><strong>리소스 최적화 가능성</strong></td><td>필요 시점에만 컴퓨팅을 사용하는 구조로 과금 효율성 및 예측 가능성 향상</td></tr><tr><td><strong>4. 데이터 품질 및 신뢰성</strong></td><td><strong>트랜잭션 및 일관성 보장</strong></td><td>ACID 지원 포맷 (Delta, Iceberg, Hudi) 을 통해 트랜잭션 무결성과 분석 결과의 일관성 확보</td></tr><tr><td></td><td><strong>데이터 계보 및 감시 가능성</strong></td><td>시간 여행 (Time Travel), 계보 추적 (Lineage) 등 데이터 신뢰성을 위한 기능 내장</td></tr><tr><td><strong>5. 분석 통합성</strong></td><td><strong>다양한 워크로드 통합 분석</strong></td><td>BI, AI/ML, 실시간 분석, 대화형 쿼리 등 다양한 분석을 단일 플랫폼 내에서 지원</td></tr><tr><td></td><td><strong>ML/AI 플랫폼 연계성</strong></td><td>MLflow, Feature Store, AutoML 도구와의 자연스러운 통합</td></tr><tr><td><strong>6. 개방성 및 호환성</strong></td><td><strong>오픈 포맷 기반</strong></td><td>Delta, Iceberg, Hudi 등 오픈 테이블 포맷 및 Parquet/ORC 등 표준 포맷 사용으로 벤더 종속성 최소화</td></tr><tr><td></td><td><strong>API 및 도구 상호운용성</strong></td><td>표준 SQL, REST API, Spark/Trino/Presto 등 분석 엔진과의 호환</td></tr><tr><td><strong>7. 거버넌스 및 컴플라이언스</strong></td><td><strong>중앙 집중적 거버넌스 모델</strong></td><td>Unity Catalog, Ranger, Atlas 등을 통한 권한 관리, 보안 정책, 감사 로그 등 통합 관리</td></tr><tr><td></td><td><strong>정책 기반 데이터 운영 가능</strong></td><td>Row/Column-level Security, Tag-based Policy 등으로 민감 데이터 보호 및 규정 준수</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th><strong>구분</strong></th><th><strong>항목</strong></th><th><strong>설명</strong></th><th><strong>해결 방안</strong></th></tr></thead><tbody><tr><td>기술적 단점</td><td><strong>설정 복잡도</strong></td><td>스토리지, 카탈로그, 권한 관리 등 아키텍처 초기 설계 및 설정이 복잡함</td><td>관리형 플랫폼 (Databricks, AWS Lake Formation), IaC 도구 사용</td></tr><tr><td>기술적 단점</td><td><strong>학습 곡선/기술 장벽</strong></td><td>Delta/Iceberg 등 새로운 오픈 포맷 및 스트리밍 기술에 대한 학습 필요</td><td>체계적인 교육, 샌드박스 학습 환경, PoC 기반 도입</td></tr><tr><td>기술적 단점</td><td><strong>성능 튜닝 필요성</strong></td><td>기본 설정 상태에서는 쿼리 성능이 최적이 아니며, 적절한 파티셔닝/인덱싱 없이는 병목 발생 가능</td><td>Z-ordering, 파티션 설계, Auto Compaction 도입</td></tr><tr><td>운영적 단점</td><td><strong>운영 복잡성 증가</strong></td><td>다양한 컴포넌트 간 모니터링, 배포, 버전 관리 등 운영 부담이 큼</td><td>DataOps 파이프라인, 자동화 툴, 통합 모니터링 도구 활용</td></tr><tr><td>운영적 단점</td><td><strong>데이터 품질 관리 어려움</strong></td><td>스키마 유연성으로 인해 품질 불일치, 이상치 탐지 어려움</td><td>데이터 계약, Great Expectations 등의 품질 관리 도구 도입</td></tr><tr><td>조직적 단점</td><td><strong>기술 역량 부족</strong></td><td>전통적인 DW 중심 인력이 새로운 아키텍처에 적응하는 데 시간이 소요됨</td><td>외부 전문가 협업, 기술 교육 내재화 전략 수립</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th><strong>카테고리</strong></th><th><strong>문제 항목</strong></th><th><strong>원인</strong></th><th><strong>영향</strong></th><th><strong>탐지 및 진단</strong></th><th><strong>예방/해결 방안</strong></th></tr></thead><tbody><tr><td>데이터 무결성</td><td><strong>데이터 일관성 오류</strong></td><td>병렬 쓰기, 트랜잭션 실패</td><td>분석 오류, 사용자 신뢰 하락</td><td>버전 충돌 감지, 쿼리 검증</td><td>Optimistic Concurrency Control, 롤백/재처리 기능</td></tr><tr><td>데이터 품질</td><td><strong>스키마 불일치</strong></td><td>다양한 소스의 스키마 진화</td><td>쿼리 오류, 분석 실패</td><td>스키마 비교 도구, 실패 알림</td><td>자동 변환, 스키마 버저닝, 계약 기반 스키마 관리</td></tr><tr><td>성능</td><td><strong>파일 조각화 문제</strong></td><td>자주 발생하는 소형 파일 생성</td><td>쿼리 성능 저하, 스토리지 낭비</td><td>파일 수 및 사이즈 모니터링</td><td>Auto Compaction, 주기적 Optimize 실행</td></tr><tr><td>메타데이터 관리</td><td><strong>동기화 실패/손상</strong></td><td>메타스토어 불일치, 캐시 문제</td><td>테이블 탐색 불가, 쿼리 오류</td><td>메타데이터 로그 확인, 테이블 Refresh</td><td>Unity Catalog, 자동 메타데이터 Refresh 설정</td></tr><tr><td>보안 및 규정</td><td><strong>권한/거버넌스 미흡</strong></td><td>분산된 권한 정책, 감사 추적 부재</td><td>데이터 유출, 컴플라이언스 위반</td><td>권한 로그, 보안 정책 점검</td><td>RBAC/ABAC 정책, Tag 기반 접근 제어, 감사 로그</td></tr><tr><td>비용/리소스</td><td><strong>비용 증가</strong></td><td>불필요한 데이터 유지, 비효율 쿼리</td><td>운영비 증가</td><td>리소스 사용량 분석, 스캔 비용 분석</td><td>라이프사이클 관리, 쿼리 리팩토링, 스토리지 계층화</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>도전 과제</strong></th><th><strong>주요 원인</strong></th><th><strong>영향/리스크</strong></th><th><strong>해결 전략 / 대응 방안</strong></th></tr></thead><tbody><tr><td><strong>1. 기술적 과제</strong></td><td><strong>멀티 테이블 포맷 호환성 부족</strong></td><td>Delta/Iceberg/Hudi 간 사양 차이</td><td>멀티 클라우드 간 데이터 이전 어려움, 분석 엔진 종속성</td><td>Universal Format 표준화, 변환 도구 활용 (e.g. UniForm by Databricks)</td></tr><tr><td></td><td><strong>쿼리 성능 최적화 한계</strong></td><td>파일 조각화, 대용량 조인, 통계 미비</td><td>쿼리 지연, 사용자 경험 저하</td><td>Z-ordering, Adaptive Query, Auto Stats 수집</td></tr><tr><td></td><td><strong>Streaming 처리 지연</strong></td><td>Merge 병목, 상태 저장 I/O</td><td>실시간 처리 불안정, SLA 미준수</td><td>Incremental Processing, Watermark 튜닝, 병렬 파티셔닝</td></tr><tr><td></td><td><strong>메타데이터/카탈로그 일관성 문제</strong></td><td>캐시 유실, 동기화 실패</td><td>분석 오류, 테이블 불일치</td><td>Unity Catalog, 메타데이터 Refresh 자동화, 외부 메타스토어 연동</td></tr><tr><td><strong>2. 운영적 과제</strong></td><td><strong>데이터 거버넌스 자동화 부족</strong></td><td>이기종 데이터 소스 증가</td><td>수작업 관리 비용, 권한 통제 실패</td><td>정책 기반 자동화, DataOps 파이프라인, 통합 거버넌스 도구 (예: Unity Catalog, Atlas)</td></tr><tr><td></td><td><strong>보안/권한 모델 부족</strong></td><td>세분화된 ACL 미흡</td><td>민감 데이터 노출, 컴플라이언스 위반</td><td>Row/Column-level security, 감사 로그 (Audit Trail), 접근 정책 관리 도구 활용</td></tr><tr><td></td><td><strong>멀티 클라우드/하이브리드 복잡성</strong></td><td>네트워크 레이턴시, 서비스 불일치</td><td>성능 저하, 운영 복잡도 증가</td><td>클라우드 추상화 계층, 통합 모니터링 도구 (e.g. Datadog, OpenTelemetry)</td></tr><tr><td><strong>3. 조직적 과제</strong></td><td><strong>기술 역량 부족</strong></td><td>새로운 오픈 포맷/스트리밍 기술 미숙</td><td>운영 실수, 마이그레이션 지연</td><td>체계적 사내 교육, 샌드박스 환경 제공, 외부 파트너 협업</td></tr><tr><td></td><td><strong>조직 변화 저항</strong></td><td>레거시 시스템 관성, 신규 도구 불신</td><td>도입 실패, 생산성 저하</td><td>단계적 도입, 사내 전파 캠페인, 성공 사례 공유</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th><strong>분류 기준</strong></th><th><strong>유형/구분</strong></th><th><strong>설명</strong></th><th><strong>대표 기술/예시</strong></th></tr></thead><tbody><tr><td><strong>테이블 포맷</strong></td><td><strong>Delta Lake</strong></td><td>로그 기반 트랜잭션 처리, ACID, Databricks 생태계에 최적화</td><td>Delta Lake + Databricks</td></tr><tr><td></td><td><strong>Apache Iceberg</strong></td><td>스냅샷 기반 메타데이터 관리, 스키마 진화/타임 트래블 지원</td><td>Iceberg + Trino/Dremio</td></tr><tr><td></td><td><strong>Apache Hudi</strong></td><td>증분 처리 (Upsert/Insert) 에 특화, 실시간 스트리밍 적합</td><td>Hudi + Spark/Flink</td></tr><tr><td><strong>트랜잭션 특성</strong></td><td><strong>ACID 지원</strong></td><td>원자성, 일관성, 격리성, 지속성을 지원하는 트랜잭션 처리</td><td>Delta Lake, Hudi, Iceberg</td></tr><tr><td></td><td><strong>Append-only (비 ACID)</strong></td><td>순차적 기록 위주로 트랜잭션 미보장</td><td>Parquet, ORC (단독 사용 시)</td></tr><tr><td>** 처리 방식**</td><td><strong>배치 중심</strong></td><td>정기적 대용량 처리에 최적화된 아키텍처</td><td>Spark, Presto</td></tr><tr><td></td><td><strong>스트리밍 중심</strong></td><td>실시간 데이터 수집 및 처리에 적합한 구조</td><td>Flink, Kafka Streams</td></tr><tr><td></td><td><strong>하이브리드 (Lambda 대체)</strong></td><td>배치 + 스트리밍 통합 모델</td><td>Spark Structured Streaming, Flink</td></tr><tr><td><strong>배포 환경</strong></td><td><strong>클라우드 네이티브</strong></td><td>퍼블릭 클라우드 기반 완전 관리형 환경</td><td>Databricks, Snowflake, BigQuery</td></tr><tr><td></td><td><strong>하이브리드 클라우드</strong></td><td>온프레미스와 클라우드 자원의 혼합 구성</td><td>Cloudera, Google BigLake</td></tr><tr><td></td><td><strong>온프레미스 전용</strong></td><td>자체 인프라를 활용한 구축 및 운영</td><td>Apache Spark, Hive, Presto</td></tr><tr><td>** 아키텍처 패턴**</td><td><strong>메달리온 아키텍처</strong></td><td>Bronze → Silver → Gold 계층화로 점진적 데이터 정제</td><td>Databricks 기반 표준 패턴</td></tr><tr><td></td><td><strong>데이터 메시</strong></td><td>도메인 중심의 분산된 데이터 소유 및 거버넌스</td><td>Dremio, Starburst</td></tr><tr><td></td><td><strong>페더레이션 아키텍처</strong></td><td>다양한 소스에 대한 가상 쿼리와 통합</td><td>Denodo, Data Virtuality</td></tr><tr><td><strong>저장소 유형</strong></td><td><strong>오브젝트 스토리지 기반</strong></td><td>S3, GCS, Azure Blob 등 클라우드 스토리지 위에 구축</td><td>Lakehouse 표준 환경 (모든 테이블 포맷이 사용)</td></tr><tr><td></td><td><strong>HDFS/온프레미스 파일시스템</strong></td><td>로컬 또는 사설 클라우드 인프라 기반 스토리지</td><td>Hadoop 기반 시스템</td></tr><tr><td>** 분석 엔진**</td><td><strong>통합 분석 엔진</strong></td><td>ETL, ML, BI 지원을 하나의 엔진에서 처리</td><td>Apache Spark, Trino</td></tr><tr><td></td><td><strong>쿼리 페더레이션 엔진</strong></td><td>다양한 데이터 소스를 가상으로 통합 분석</td><td>Presto, Starburst, Trino</td></tr><tr><td>** 서비스 모델**</td><td><strong>매니지드 서비스</strong></td><td>인프라 관리 없이 데이터 처리 및 분석 기능 제공</td><td>Databricks, AWS Glue, BigQuery</td></tr><tr><td></td><td><strong>셀프 호스팅</strong></td><td>직접 설치 및 운영 관리 필요</td><td>OSS 기반 Spark, Hudi, Flink 등</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th><strong>도메인</strong></th><th><strong>기술 조합</strong></th><th><strong>사용 목적</strong></th><th><strong>기대 효과</strong></th></tr></thead><tbody><tr><td><strong>금융</strong></td><td>Delta Lake + Apache Spark + Power BI</td><td>거래 로그 실시간 처리 및 리스크 분석</td><td>사기 탐지 속도 향상, 분석 자동화</td></tr><tr><td></td><td>Hudi + Flink + Superset</td><td>금융 거래 데이터의 실시간 CDC 및 시각화</td><td>리스크 조기 감지, 의사결정 가속화</td></tr><tr><td><strong>헬스케어</strong></td><td>Iceberg + Presto + ML 플랫폼</td><td>의료 로그, 이미지 기반 예측 모델 학습</td><td>대규모 비정형 데이터 기반 진단 정확도 향상</td></tr><tr><td><strong>이커머스/리테일</strong></td><td>Delta Lake + dbt + Spark ML + Power BI</td><td>고객 행동 데이터 분석 및 마케팅 자동화</td><td>고객 세분화, 전환율 증가, 실시간 캠페인 최적화</td></tr><tr><td></td><td>Kafka + Flink + Delta Lake + MLflow</td><td>행동 기반 추천 시스템 (Streaming 기반)</td><td>실시간 개인화 추천, 구매율 개선</td></tr><tr><td><strong>광고 플랫폼</strong></td><td>Hudi + Flink + Kafka</td><td>클릭/전환 로그의 실시간 집계 및 분석</td><td>실시간 광고 성과 피드백 및 예산 최적화</td></tr><tr><td><strong>IoT/제조</strong></td><td>Azure IoT Hub + Delta Lake + Azure ML</td><td>센서 기반 실시간 이벤트 수집 및 예측 분석</td><td>장비 이상 탐지 정확도 향상, 예지 정비 가능</td></tr><tr><td></td><td>Lakehouse + Spark Streaming</td><td>스트리밍 데이터 기반 공장 생산 라인 모니터링</td><td>생산 중단 최소화, 장애 사전 방지</td></tr><tr><td><strong>AI/ML 파이프라인</strong></td><td>Lakehouse + MLflow + Feature Store</td><td>ML 학습 데이터 통합 관리 및 재현성 확보</td><td>모델 품질 향상, 재현 가능한 학습 파이프라인 구축</td></tr><tr><td><strong>BI/분석 플랫폼</strong></td><td>Lakehouse + Power BI / Tableau / Looker</td><td>배치 + 실시간 기반 리포팅 및 대시보드 구축</td><td>실시간 인사이트 제공, 경영 지표 개선</td></tr><tr><td><strong>공급망/물류</strong></td><td>Snowflake + dbt + Looker</td><td>물류/재고 데이터의 통합 및 분석</td><td>운영 비용 절감, 수요 예측 정확도 향상</td></tr><tr><td><strong>고객 분석/360 View</strong></td><td>CDC + Iceberg + Trino + BI 도구</td><td>고객 접점 통합 및 세분화 분석</td><td>ROI 증가, 고객 맞춤 마케팅 실행</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-전자상거래-실시간-추천-시스템>사례 1: 전자상거래 실시간 추천 시스템<a hidden class=anchor aria-hidden=true href=#사례-1-전자상거래-실시간-추천-시스템>#</a></h4><p>대형 전자상거래 기업에서 고객의 실시간 행동 데이터를 기반으로 개인화된 상품 추천 시스템을 구축한 사례.</p><p><strong>시스템 구성</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;데이터 소스&#34;
    A1[웹/모바일 클릭스트림]
    A2[구매 트랜잭션]
    A3[상품 카탈로그]
    A4[고객 프로필]
    end
    
    subgraph &#34;실시간 수집&#34;
    B1[Apache Kafka]
    B2[Kafka Connect]
    end
    
    subgraph &#34;Lakehouse (Bronze)&#34;
    C1[원시 이벤트 데이터]
    C2[트랜잭션 로그]
    end
    
    subgraph &#34;Lakehouse (Silver)&#34;
    D1[정제된 사용자 행동]
    D2[상품 인터랙션]
    D3[구매 패턴]
    end
    
    subgraph &#34;Lakehouse (Gold)&#34;
    E1[사용자 프로필]
    E2[상품 특성]
    E3[추천 피처]
    end
    
    subgraph &#34;ML 파이프라인&#34;
    F1[피처 엔지니어링]
    F2[모델 훈련]
    F3[모델 서빙]
    end
    
    subgraph &#34;서빙 레이어&#34;
    G1[실시간 추천 API]
    G2[A/B 테스트]
    G3[성과 모니터링]
    end
    
    A1 --&gt; B1
    A2 --&gt; B2
    A3 --&gt; B2
    A4 --&gt; B2
    
    B1 --&gt; C1
    B2 --&gt; C2
    
    C1 --&gt; D1
    C2 --&gt; D2
    D1 --&gt; D3
    
    D1 --&gt; E1
    D2 --&gt; E2
    D3 --&gt; E3
    
    E1 --&gt; F1
    E2 --&gt; F1
    E3 --&gt; F2
    F2 --&gt; F3
    
    F3 --&gt; G1
    G1 --&gt; G2
    G2 --&gt; G3
</pre><p><strong>워크플로우</strong>:</p><ol><li><strong>데이터 수집</strong>: 실시간 클릭스트림과 구매 데이터를 Kafka 로 수집</li><li><strong>Bronze 적재</strong>: 원시 데이터를 Delta Lake 에 저장</li><li><strong>Silver 처리</strong>: Spark Structured Streaming 으로 실시간 정제</li><li><strong>Gold 집계</strong>: 사용자별, 상품별 특성 데이터 생성</li><li><strong>ML 처리</strong>: MLflow 로 추천 모델 훈련 및 배포</li><li><strong>실시간 서빙</strong>: REST API 를 통한 실시간 추천 제공</li></ol><p><strong>레이크하우스의 역할</strong>:</p><ul><li><strong>통합 데이터 플랫폼</strong>: 배치와 스트리밍 데이터를 단일 플랫폼에서 처리</li><li><strong>실시간 피처 제공</strong>: 최신 사용자 행동을 즉시 추천에 반영</li><li><strong>스키마 진화</strong>: 새로운 이벤트 타입 추가 시 스키마 자동 적응</li><li><strong>데이터 품질 보장</strong>: 중복 제거와 검증을 통한 신뢰할 수 있는 데이터</li></ul><p><strong>레이크하우스 유무에 따른 차이점</strong></p><ul><li><strong>레이크하우스 도입 전</strong>:<ul><li>데이터 웨어하우스와 데이터 레이크 분리 운영</li><li>배치 처리 중심으로 실시간성 부족</li><li>데이터 동기화 지연으로 추천 정확도 저하</li><li>복잡한 ETL 파이프라인 유지 비용 증가</li></ul></li><li><strong>레이크하우스 도입 후</strong>:<ul><li>단일 플랫폼에서 모든 데이터 처리</li><li>실시간 추천으로 클릭률 30% 향상</li><li>데이터 일관성 보장으로 신뢰도 증가</li><li>운영 복잡성 50% 감소</li></ul></li></ul><h4 id=사례-2-databricks-기반의-전자상거래-분석-플랫폼>사례 2: Databricks 기반의 전자상거래 분석 플랫폼<a hidden class=anchor aria-hidden=true href=#사례-2-databricks-기반의-전자상거래-분석-플랫폼>#</a></h4><p><strong>시스템 구성</strong>:</p><ul><li><strong>Ingestion</strong>: Kafka (로그), S3 (주문서)</li><li><strong>Storage</strong>: Delta Lake (S3 기반)</li><li><strong>Processing</strong>: Apache Spark + Structured Streaming</li><li><strong>Serving</strong>: Databricks SQL + Power BI</li><li><strong>Orchestration</strong>: dbt + Airflow</li></ul><p><strong>Workflow</strong>:</p><pre class=mermaid>sequenceDiagram
    participant App as E-Commerce App
    participant Kafka as Kafka (Clickstream)
    participant Spark as Stream Processor
    participant S3 as Storage (Delta Lake)
    participant DBSQL as Databricks SQL
    participant BI as Power BI

    App-&gt;&gt;Kafka: Send Clickstream Events
    Kafka-&gt;&gt;Spark: Read in Real-time
    Spark-&gt;&gt;S3: Write Delta Format
    DBSQL-&gt;&gt;S3: Read Latest Data
    BI--&gt;&gt;DBSQL: Query Dashboard
</pre><p><strong>역할 분석</strong>:</p><table><thead><tr><th>구성 요소</th><th>역할</th></tr></thead><tbody><tr><td>Delta Lake</td><td>중복 제거 및 실시간/배치 통합 저장</td></tr><tr><td>Structured Streaming</td><td>실시간 데이터 수집 및 병합</td></tr><tr><td>Power BI</td><td>통합 데이터 기반 시각화 및 분석</td></tr></tbody></table><p><strong>유무 비교</strong>:</p><table><thead><tr><th>항목</th><th>Lakehouse 사용</th><th>미사용</th></tr></thead><tbody><tr><td>데이터 정합성</td><td>고도화된 ACID 보장</td><td>느슨하거나 없음</td></tr><tr><td>실시간 처리</td><td>가능 (Streaming + Batch)</td><td>별도 시스템 필요</td></tr><tr><td>데이터 중복</td><td>없음 (단일 저장소)</td><td>중복 가능성 존재</td></tr></tbody></table><h4 id=사례-3-실시간-iot-데이터-분석-시스템>사례 3: 실시간 IoT 데이터 분석 시스템<a hidden class=anchor aria-hidden=true href=#사례-3-실시간-iot-데이터-분석-시스템>#</a></h4><p><strong>시스템 구성:</strong><br>IoT 센서 데이터 → 데이터 레이크 스토리지 (Parquet) → Delta Lake(ACID) → Databricks Spark(분석) → Power BI(시각화)</p><p><strong>Workflow:</strong></p><ol><li>IoT 센서에서 원시 데이터가 실시간으로 유입</li><li>데이터 레이크 스토리지에 오픈 포맷으로 저장</li><li>Delta Lake 가 트랜잭션 및 메타데이터 관리</li><li>Spark 로 실시간/배치 분석</li><li>Power BI 로 실시간 대시보드 제공</li></ol><p><strong>Lakehouse Architecture 의 역할:</strong></p><ul><li>데이터 중복 없이 신뢰성 있는 데이터 관리, 실시간 분석과 대시보드 제공, 데이터 품질 및 거버넌스 강화</li></ul><p><strong>Lakehouse Architecture 유무에 따른 차이:</strong></p><ul><li><strong>도입 전:</strong><br>데이터 사일로, 중복, 실시간 분석 한계, 데이터 품질 이슈</li><li><strong>도입 후:</strong><br>데이터 통합, 실시간 분석, 신뢰성 및 일관성 강화, 운영 효율성 증대</li></ul><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><h4 id=python-실시간-클릭-로그>Python: 실시간 클릭 로그<a hidden class=anchor aria-hidden=true href=#python-실시간-클릭-로그>#</a></h4><p>Python + PySpark 기반 Delta Lake 활용</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27>27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28>28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29>29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30>30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31>31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32>32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33>33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34>34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35>35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36>36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37>37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Delta Lake를 사용하여 실시간 클릭 로그를 저장하고 쿼리하는 예제</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql.functions</span> <span class=kn>import</span> <span class=n>from_json</span><span class=p>,</span> <span class=n>col</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql.types</span> <span class=kn>import</span> <span class=n>StructType</span><span class=p>,</span> <span class=n>StringType</span><span class=p>,</span> <span class=n>TimestampType</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Spark 세션 생성</span>
</span></span><span class=line><span class=cl><span class=n>spark</span> <span class=o>=</span> <span class=n>SparkSession</span><span class=o>.</span><span class=n>builder</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>appName</span><span class=p>(</span><span class=s2>&#34;Lakehouse Architecture Example&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.sql.extensions&#34;</span><span class=p>,</span> <span class=s2>&#34;io.delta.sql.DeltaSparkSessionExtension&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.sql.catalog.spark_catalog&#34;</span><span class=p>,</span> <span class=s2>&#34;org.apache.spark.sql.delta.catalog.DeltaCatalog&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>getOrCreate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka에서 수신한 JSON 데이터 스키마 정의</span>
</span></span><span class=line><span class=cl><span class=n>schema</span> <span class=o>=</span> <span class=n>StructType</span><span class=p>()</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>())</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>())</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span> <span class=n>TimestampType</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka에서 스트리밍 데이터 수신</span>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>readStream</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;kafka&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;kafka.bootstrap.servers&#34;</span><span class=p>,</span> <span class=s2>&#34;localhost:9092&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;subscribe&#34;</span><span class=p>,</span> <span class=s2>&#34;clickstream&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>load</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># JSON 파싱 및 필드 추출</span>
</span></span><span class=line><span class=cl><span class=n>json_df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>selectExpr</span><span class=p>(</span><span class=s2>&#34;CAST(value AS STRING) as json&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=n>from_json</span><span class=p>(</span><span class=s2>&#34;json&#34;</span><span class=p>,</span> <span class=n>schema</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>))</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;data.*&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Delta Lake에 저장</span>
</span></span><span class=line><span class=cl><span class=n>query</span> <span class=o>=</span> <span class=n>json_df</span><span class=o>.</span><span class=n>writeStream</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;checkpointLocation&#34;</span><span class=p>,</span> <span class=s2>&#34;/tmp/delta-checkpoints/&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>outputMode</span><span class=p>(</span><span class=s2>&#34;append&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>start</span><span class=p>(</span><span class=s2>&#34;/data/lakehouse/clickstream&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>query</span><span class=o>.</span><span class=n>awaitTermination</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>이 코드는 Speed Layer 와 Storage Layer 를 통합한 형태로, 실시간 이벤트를 Delta 포맷으로 저장하여 Lakehouse 기능을 구현한다.</p></blockquote><h4 id=python-iot-센서-데이터>Python: IoT 센서 데이터<a hidden class=anchor aria-hidden=true href=#python-iot-센서-데이터>#</a></h4><p>Delta Lake + PySpark 기반</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Delta Lake를 활용한 데이터 적재 및 분석 예시 (PySpark)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Spark 세션 생성 및 Delta Lake 활성화</span>
</span></span><span class=line><span class=cl><span class=n>spark</span> <span class=o>=</span> <span class=n>SparkSession</span><span class=o>.</span><span class=n>builder</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>appName</span><span class=p>(</span><span class=s2>&#34;LakehouseExample&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.sql.extensions&#34;</span><span class=p>,</span> <span class=s2>&#34;io.delta.sql.DeltaSparkSessionExtension&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.sql.catalog.spark_catalog&#34;</span><span class=p>,</span> <span class=s2>&#34;org.apache.spark.sql.delta.catalog.DeltaCatalog&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>getOrCreate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># IoT 센서 데이터 적재 (예시)</span>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>json</span><span class=p>(</span><span class=s2>&#34;s3://my-iot-data/raw/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Delta Lake에 데이터 저장 (ACID 트랜잭션 지원)</span>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=o>.</span><span class=n>write</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>mode</span><span class=p>(</span><span class=s2>&#34;append&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s2>&#34;s3://my-lakehouse/delta/iot/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실시간 분석 쿼리 (예: 온도 이상치 탐지)</span>
</span></span><span class=line><span class=cl><span class=n>df_delta</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;s3://my-lakehouse/delta/iot/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>anomaly_df</span> <span class=o>=</span> <span class=n>df_delta</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>df_delta</span><span class=o>.</span><span class=n>temperature</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>anomaly_df</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>설명:</strong><br>IoT 센서 데이터를 Delta Lake 에 적재하고, PySpark 를 통해 실시간으로 이상치 (온도 100 도 초과) 데이터를 탐지하는 예시이다.</li></ul><h4 id=python-전자상거래-추천-시스템>Python: 전자상거래 추천 시스템<a hidden class=anchor aria-hidden=true href=#python-전자상거래-추천-시스템>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>  1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>  2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>  3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>  4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>  5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>  6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>  7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8>  8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9>  9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10> 10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11> 11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12> 12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13> 13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14> 14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15> 15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16> 16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17> 17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18> 18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19> 19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20> 20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21> 21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22> 22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23> 23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24> 24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25> 25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26> 26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27> 27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28> 28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29> 29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30> 30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31> 31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32> 32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33> 33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34> 34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35> 35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36> 36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37> 37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38> 38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39> 39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40> 40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41> 41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42> 42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43> 43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44> 44</a>
</span><span class=lnt id=hl-15-45><a class=lnlinks href=#hl-15-45> 45</a>
</span><span class=lnt id=hl-15-46><a class=lnlinks href=#hl-15-46> 46</a>
</span><span class=lnt id=hl-15-47><a class=lnlinks href=#hl-15-47> 47</a>
</span><span class=lnt id=hl-15-48><a class=lnlinks href=#hl-15-48> 48</a>
</span><span class=lnt id=hl-15-49><a class=lnlinks href=#hl-15-49> 49</a>
</span><span class=lnt id=hl-15-50><a class=lnlinks href=#hl-15-50> 50</a>
</span><span class=lnt id=hl-15-51><a class=lnlinks href=#hl-15-51> 51</a>
</span><span class=lnt id=hl-15-52><a class=lnlinks href=#hl-15-52> 52</a>
</span><span class=lnt id=hl-15-53><a class=lnlinks href=#hl-15-53> 53</a>
</span><span class=lnt id=hl-15-54><a class=lnlinks href=#hl-15-54> 54</a>
</span><span class=lnt id=hl-15-55><a class=lnlinks href=#hl-15-55> 55</a>
</span><span class=lnt id=hl-15-56><a class=lnlinks href=#hl-15-56> 56</a>
</span><span class=lnt id=hl-15-57><a class=lnlinks href=#hl-15-57> 57</a>
</span><span class=lnt id=hl-15-58><a class=lnlinks href=#hl-15-58> 58</a>
</span><span class=lnt id=hl-15-59><a class=lnlinks href=#hl-15-59> 59</a>
</span><span class=lnt id=hl-15-60><a class=lnlinks href=#hl-15-60> 60</a>
</span><span class=lnt id=hl-15-61><a class=lnlinks href=#hl-15-61> 61</a>
</span><span class=lnt id=hl-15-62><a class=lnlinks href=#hl-15-62> 62</a>
</span><span class=lnt id=hl-15-63><a class=lnlinks href=#hl-15-63> 63</a>
</span><span class=lnt id=hl-15-64><a class=lnlinks href=#hl-15-64> 64</a>
</span><span class=lnt id=hl-15-65><a class=lnlinks href=#hl-15-65> 65</a>
</span><span class=lnt id=hl-15-66><a class=lnlinks href=#hl-15-66> 66</a>
</span><span class=lnt id=hl-15-67><a class=lnlinks href=#hl-15-67> 67</a>
</span><span class=lnt id=hl-15-68><a class=lnlinks href=#hl-15-68> 68</a>
</span><span class=lnt id=hl-15-69><a class=lnlinks href=#hl-15-69> 69</a>
</span><span class=lnt id=hl-15-70><a class=lnlinks href=#hl-15-70> 70</a>
</span><span class=lnt id=hl-15-71><a class=lnlinks href=#hl-15-71> 71</a>
</span><span class=lnt id=hl-15-72><a class=lnlinks href=#hl-15-72> 72</a>
</span><span class=lnt id=hl-15-73><a class=lnlinks href=#hl-15-73> 73</a>
</span><span class=lnt id=hl-15-74><a class=lnlinks href=#hl-15-74> 74</a>
</span><span class=lnt id=hl-15-75><a class=lnlinks href=#hl-15-75> 75</a>
</span><span class=lnt id=hl-15-76><a class=lnlinks href=#hl-15-76> 76</a>
</span><span class=lnt id=hl-15-77><a class=lnlinks href=#hl-15-77> 77</a>
</span><span class=lnt id=hl-15-78><a class=lnlinks href=#hl-15-78> 78</a>
</span><span class=lnt id=hl-15-79><a class=lnlinks href=#hl-15-79> 79</a>
</span><span class=lnt id=hl-15-80><a class=lnlinks href=#hl-15-80> 80</a>
</span><span class=lnt id=hl-15-81><a class=lnlinks href=#hl-15-81> 81</a>
</span><span class=lnt id=hl-15-82><a class=lnlinks href=#hl-15-82> 82</a>
</span><span class=lnt id=hl-15-83><a class=lnlinks href=#hl-15-83> 83</a>
</span><span class=lnt id=hl-15-84><a class=lnlinks href=#hl-15-84> 84</a>
</span><span class=lnt id=hl-15-85><a class=lnlinks href=#hl-15-85> 85</a>
</span><span class=lnt id=hl-15-86><a class=lnlinks href=#hl-15-86> 86</a>
</span><span class=lnt id=hl-15-87><a class=lnlinks href=#hl-15-87> 87</a>
</span><span class=lnt id=hl-15-88><a class=lnlinks href=#hl-15-88> 88</a>
</span><span class=lnt id=hl-15-89><a class=lnlinks href=#hl-15-89> 89</a>
</span><span class=lnt id=hl-15-90><a class=lnlinks href=#hl-15-90> 90</a>
</span><span class=lnt id=hl-15-91><a class=lnlinks href=#hl-15-91> 91</a>
</span><span class=lnt id=hl-15-92><a class=lnlinks href=#hl-15-92> 92</a>
</span><span class=lnt id=hl-15-93><a class=lnlinks href=#hl-15-93> 93</a>
</span><span class=lnt id=hl-15-94><a class=lnlinks href=#hl-15-94> 94</a>
</span><span class=lnt id=hl-15-95><a class=lnlinks href=#hl-15-95> 95</a>
</span><span class=lnt id=hl-15-96><a class=lnlinks href=#hl-15-96> 96</a>
</span><span class=lnt id=hl-15-97><a class=lnlinks href=#hl-15-97> 97</a>
</span><span class=lnt id=hl-15-98><a class=lnlinks href=#hl-15-98> 98</a>
</span><span class=lnt id=hl-15-99><a class=lnlinks href=#hl-15-99> 99</a>
</span><span class=lnt id=hl-15-100><a class=lnlinks href=#hl-15-100>100</a>
</span><span class=lnt id=hl-15-101><a class=lnlinks href=#hl-15-101>101</a>
</span><span class=lnt id=hl-15-102><a class=lnlinks href=#hl-15-102>102</a>
</span><span class=lnt id=hl-15-103><a class=lnlinks href=#hl-15-103>103</a>
</span><span class=lnt id=hl-15-104><a class=lnlinks href=#hl-15-104>104</a>
</span><span class=lnt id=hl-15-105><a class=lnlinks href=#hl-15-105>105</a>
</span><span class=lnt id=hl-15-106><a class=lnlinks href=#hl-15-106>106</a>
</span><span class=lnt id=hl-15-107><a class=lnlinks href=#hl-15-107>107</a>
</span><span class=lnt id=hl-15-108><a class=lnlinks href=#hl-15-108>108</a>
</span><span class=lnt id=hl-15-109><a class=lnlinks href=#hl-15-109>109</a>
</span><span class=lnt id=hl-15-110><a class=lnlinks href=#hl-15-110>110</a>
</span><span class=lnt id=hl-15-111><a class=lnlinks href=#hl-15-111>111</a>
</span><span class=lnt id=hl-15-112><a class=lnlinks href=#hl-15-112>112</a>
</span><span class=lnt id=hl-15-113><a class=lnlinks href=#hl-15-113>113</a>
</span><span class=lnt id=hl-15-114><a class=lnlinks href=#hl-15-114>114</a>
</span><span class=lnt id=hl-15-115><a class=lnlinks href=#hl-15-115>115</a>
</span><span class=lnt id=hl-15-116><a class=lnlinks href=#hl-15-116>116</a>
</span><span class=lnt id=hl-15-117><a class=lnlinks href=#hl-15-117>117</a>
</span><span class=lnt id=hl-15-118><a class=lnlinks href=#hl-15-118>118</a>
</span><span class=lnt id=hl-15-119><a class=lnlinks href=#hl-15-119>119</a>
</span><span class=lnt id=hl-15-120><a class=lnlinks href=#hl-15-120>120</a>
</span><span class=lnt id=hl-15-121><a class=lnlinks href=#hl-15-121>121</a>
</span><span class=lnt id=hl-15-122><a class=lnlinks href=#hl-15-122>122</a>
</span><span class=lnt id=hl-15-123><a class=lnlinks href=#hl-15-123>123</a>
</span><span class=lnt id=hl-15-124><a class=lnlinks href=#hl-15-124>124</a>
</span><span class=lnt id=hl-15-125><a class=lnlinks href=#hl-15-125>125</a>
</span><span class=lnt id=hl-15-126><a class=lnlinks href=#hl-15-126>126</a>
</span><span class=lnt id=hl-15-127><a class=lnlinks href=#hl-15-127>127</a>
</span><span class=lnt id=hl-15-128><a class=lnlinks href=#hl-15-128>128</a>
</span><span class=lnt id=hl-15-129><a class=lnlinks href=#hl-15-129>129</a>
</span><span class=lnt id=hl-15-130><a class=lnlinks href=#hl-15-130>130</a>
</span><span class=lnt id=hl-15-131><a class=lnlinks href=#hl-15-131>131</a>
</span><span class=lnt id=hl-15-132><a class=lnlinks href=#hl-15-132>132</a>
</span><span class=lnt id=hl-15-133><a class=lnlinks href=#hl-15-133>133</a>
</span><span class=lnt id=hl-15-134><a class=lnlinks href=#hl-15-134>134</a>
</span><span class=lnt id=hl-15-135><a class=lnlinks href=#hl-15-135>135</a>
</span><span class=lnt id=hl-15-136><a class=lnlinks href=#hl-15-136>136</a>
</span><span class=lnt id=hl-15-137><a class=lnlinks href=#hl-15-137>137</a>
</span><span class=lnt id=hl-15-138><a class=lnlinks href=#hl-15-138>138</a>
</span><span class=lnt id=hl-15-139><a class=lnlinks href=#hl-15-139>139</a>
</span><span class=lnt id=hl-15-140><a class=lnlinks href=#hl-15-140>140</a>
</span><span class=lnt id=hl-15-141><a class=lnlinks href=#hl-15-141>141</a>
</span><span class=lnt id=hl-15-142><a class=lnlinks href=#hl-15-142>142</a>
</span><span class=lnt id=hl-15-143><a class=lnlinks href=#hl-15-143>143</a>
</span><span class=lnt id=hl-15-144><a class=lnlinks href=#hl-15-144>144</a>
</span><span class=lnt id=hl-15-145><a class=lnlinks href=#hl-15-145>145</a>
</span><span class=lnt id=hl-15-146><a class=lnlinks href=#hl-15-146>146</a>
</span><span class=lnt id=hl-15-147><a class=lnlinks href=#hl-15-147>147</a>
</span><span class=lnt id=hl-15-148><a class=lnlinks href=#hl-15-148>148</a>
</span><span class=lnt id=hl-15-149><a class=lnlinks href=#hl-15-149>149</a>
</span><span class=lnt id=hl-15-150><a class=lnlinks href=#hl-15-150>150</a>
</span><span class=lnt id=hl-15-151><a class=lnlinks href=#hl-15-151>151</a>
</span><span class=lnt id=hl-15-152><a class=lnlinks href=#hl-15-152>152</a>
</span><span class=lnt id=hl-15-153><a class=lnlinks href=#hl-15-153>153</a>
</span><span class=lnt id=hl-15-154><a class=lnlinks href=#hl-15-154>154</a>
</span><span class=lnt id=hl-15-155><a class=lnlinks href=#hl-15-155>155</a>
</span><span class=lnt id=hl-15-156><a class=lnlinks href=#hl-15-156>156</a>
</span><span class=lnt id=hl-15-157><a class=lnlinks href=#hl-15-157>157</a>
</span><span class=lnt id=hl-15-158><a class=lnlinks href=#hl-15-158>158</a>
</span><span class=lnt id=hl-15-159><a class=lnlinks href=#hl-15-159>159</a>
</span><span class=lnt id=hl-15-160><a class=lnlinks href=#hl-15-160>160</a>
</span><span class=lnt id=hl-15-161><a class=lnlinks href=#hl-15-161>161</a>
</span><span class=lnt id=hl-15-162><a class=lnlinks href=#hl-15-162>162</a>
</span><span class=lnt id=hl-15-163><a class=lnlinks href=#hl-15-163>163</a>
</span><span class=lnt id=hl-15-164><a class=lnlinks href=#hl-15-164>164</a>
</span><span class=lnt id=hl-15-165><a class=lnlinks href=#hl-15-165>165</a>
</span><span class=lnt id=hl-15-166><a class=lnlinks href=#hl-15-166>166</a>
</span><span class=lnt id=hl-15-167><a class=lnlinks href=#hl-15-167>167</a>
</span><span class=lnt id=hl-15-168><a class=lnlinks href=#hl-15-168>168</a>
</span><span class=lnt id=hl-15-169><a class=lnlinks href=#hl-15-169>169</a>
</span><span class=lnt id=hl-15-170><a class=lnlinks href=#hl-15-170>170</a>
</span><span class=lnt id=hl-15-171><a class=lnlinks href=#hl-15-171>171</a>
</span><span class=lnt id=hl-15-172><a class=lnlinks href=#hl-15-172>172</a>
</span><span class=lnt id=hl-15-173><a class=lnlinks href=#hl-15-173>173</a>
</span><span class=lnt id=hl-15-174><a class=lnlinks href=#hl-15-174>174</a>
</span><span class=lnt id=hl-15-175><a class=lnlinks href=#hl-15-175>175</a>
</span><span class=lnt id=hl-15-176><a class=lnlinks href=#hl-15-176>176</a>
</span><span class=lnt id=hl-15-177><a class=lnlinks href=#hl-15-177>177</a>
</span><span class=lnt id=hl-15-178><a class=lnlinks href=#hl-15-178>178</a>
</span><span class=lnt id=hl-15-179><a class=lnlinks href=#hl-15-179>179</a>
</span><span class=lnt id=hl-15-180><a class=lnlinks href=#hl-15-180>180</a>
</span><span class=lnt id=hl-15-181><a class=lnlinks href=#hl-15-181>181</a>
</span><span class=lnt id=hl-15-182><a class=lnlinks href=#hl-15-182>182</a>
</span><span class=lnt id=hl-15-183><a class=lnlinks href=#hl-15-183>183</a>
</span><span class=lnt id=hl-15-184><a class=lnlinks href=#hl-15-184>184</a>
</span><span class=lnt id=hl-15-185><a class=lnlinks href=#hl-15-185>185</a>
</span><span class=lnt id=hl-15-186><a class=lnlinks href=#hl-15-186>186</a>
</span><span class=lnt id=hl-15-187><a class=lnlinks href=#hl-15-187>187</a>
</span><span class=lnt id=hl-15-188><a class=lnlinks href=#hl-15-188>188</a>
</span><span class=lnt id=hl-15-189><a class=lnlinks href=#hl-15-189>189</a>
</span><span class=lnt id=hl-15-190><a class=lnlinks href=#hl-15-190>190</a>
</span><span class=lnt id=hl-15-191><a class=lnlinks href=#hl-15-191>191</a>
</span><span class=lnt id=hl-15-192><a class=lnlinks href=#hl-15-192>192</a>
</span><span class=lnt id=hl-15-193><a class=lnlinks href=#hl-15-193>193</a>
</span><span class=lnt id=hl-15-194><a class=lnlinks href=#hl-15-194>194</a>
</span><span class=lnt id=hl-15-195><a class=lnlinks href=#hl-15-195>195</a>
</span><span class=lnt id=hl-15-196><a class=lnlinks href=#hl-15-196>196</a>
</span><span class=lnt id=hl-15-197><a class=lnlinks href=#hl-15-197>197</a>
</span><span class=lnt id=hl-15-198><a class=lnlinks href=#hl-15-198>198</a>
</span><span class=lnt id=hl-15-199><a class=lnlinks href=#hl-15-199>199</a>
</span><span class=lnt id=hl-15-200><a class=lnlinks href=#hl-15-200>200</a>
</span><span class=lnt id=hl-15-201><a class=lnlinks href=#hl-15-201>201</a>
</span><span class=lnt id=hl-15-202><a class=lnlinks href=#hl-15-202>202</a>
</span><span class=lnt id=hl-15-203><a class=lnlinks href=#hl-15-203>203</a>
</span><span class=lnt id=hl-15-204><a class=lnlinks href=#hl-15-204>204</a>
</span><span class=lnt id=hl-15-205><a class=lnlinks href=#hl-15-205>205</a>
</span><span class=lnt id=hl-15-206><a class=lnlinks href=#hl-15-206>206</a>
</span><span class=lnt id=hl-15-207><a class=lnlinks href=#hl-15-207>207</a>
</span><span class=lnt id=hl-15-208><a class=lnlinks href=#hl-15-208>208</a>
</span><span class=lnt id=hl-15-209><a class=lnlinks href=#hl-15-209>209</a>
</span><span class=lnt id=hl-15-210><a class=lnlinks href=#hl-15-210>210</a>
</span><span class=lnt id=hl-15-211><a class=lnlinks href=#hl-15-211>211</a>
</span><span class=lnt id=hl-15-212><a class=lnlinks href=#hl-15-212>212</a>
</span><span class=lnt id=hl-15-213><a class=lnlinks href=#hl-15-213>213</a>
</span><span class=lnt id=hl-15-214><a class=lnlinks href=#hl-15-214>214</a>
</span><span class=lnt id=hl-15-215><a class=lnlinks href=#hl-15-215>215</a>
</span><span class=lnt id=hl-15-216><a class=lnlinks href=#hl-15-216>216</a>
</span><span class=lnt id=hl-15-217><a class=lnlinks href=#hl-15-217>217</a>
</span><span class=lnt id=hl-15-218><a class=lnlinks href=#hl-15-218>218</a>
</span><span class=lnt id=hl-15-219><a class=lnlinks href=#hl-15-219>219</a>
</span><span class=lnt id=hl-15-220><a class=lnlinks href=#hl-15-220>220</a>
</span><span class=lnt id=hl-15-221><a class=lnlinks href=#hl-15-221>221</a>
</span><span class=lnt id=hl-15-222><a class=lnlinks href=#hl-15-222>222</a>
</span><span class=lnt id=hl-15-223><a class=lnlinks href=#hl-15-223>223</a>
</span><span class=lnt id=hl-15-224><a class=lnlinks href=#hl-15-224>224</a>
</span><span class=lnt id=hl-15-225><a class=lnlinks href=#hl-15-225>225</a>
</span><span class=lnt id=hl-15-226><a class=lnlinks href=#hl-15-226>226</a>
</span><span class=lnt id=hl-15-227><a class=lnlinks href=#hl-15-227>227</a>
</span><span class=lnt id=hl-15-228><a class=lnlinks href=#hl-15-228>228</a>
</span><span class=lnt id=hl-15-229><a class=lnlinks href=#hl-15-229>229</a>
</span><span class=lnt id=hl-15-230><a class=lnlinks href=#hl-15-230>230</a>
</span><span class=lnt id=hl-15-231><a class=lnlinks href=#hl-15-231>231</a>
</span><span class=lnt id=hl-15-232><a class=lnlinks href=#hl-15-232>232</a>
</span><span class=lnt id=hl-15-233><a class=lnlinks href=#hl-15-233>233</a>
</span><span class=lnt id=hl-15-234><a class=lnlinks href=#hl-15-234>234</a>
</span><span class=lnt id=hl-15-235><a class=lnlinks href=#hl-15-235>235</a>
</span><span class=lnt id=hl-15-236><a class=lnlinks href=#hl-15-236>236</a>
</span><span class=lnt id=hl-15-237><a class=lnlinks href=#hl-15-237>237</a>
</span><span class=lnt id=hl-15-238><a class=lnlinks href=#hl-15-238>238</a>
</span><span class=lnt id=hl-15-239><a class=lnlinks href=#hl-15-239>239</a>
</span><span class=lnt id=hl-15-240><a class=lnlinks href=#hl-15-240>240</a>
</span><span class=lnt id=hl-15-241><a class=lnlinks href=#hl-15-241>241</a>
</span><span class=lnt id=hl-15-242><a class=lnlinks href=#hl-15-242>242</a>
</span><span class=lnt id=hl-15-243><a class=lnlinks href=#hl-15-243>243</a>
</span><span class=lnt id=hl-15-244><a class=lnlinks href=#hl-15-244>244</a>
</span><span class=lnt id=hl-15-245><a class=lnlinks href=#hl-15-245>245</a>
</span><span class=lnt id=hl-15-246><a class=lnlinks href=#hl-15-246>246</a>
</span><span class=lnt id=hl-15-247><a class=lnlinks href=#hl-15-247>247</a>
</span><span class=lnt id=hl-15-248><a class=lnlinks href=#hl-15-248>248</a>
</span><span class=lnt id=hl-15-249><a class=lnlinks href=#hl-15-249>249</a>
</span><span class=lnt id=hl-15-250><a class=lnlinks href=#hl-15-250>250</a>
</span><span class=lnt id=hl-15-251><a class=lnlinks href=#hl-15-251>251</a>
</span><span class=lnt id=hl-15-252><a class=lnlinks href=#hl-15-252>252</a>
</span><span class=lnt id=hl-15-253><a class=lnlinks href=#hl-15-253>253</a>
</span><span class=lnt id=hl-15-254><a class=lnlinks href=#hl-15-254>254</a>
</span><span class=lnt id=hl-15-255><a class=lnlinks href=#hl-15-255>255</a>
</span><span class=lnt id=hl-15-256><a class=lnlinks href=#hl-15-256>256</a>
</span><span class=lnt id=hl-15-257><a class=lnlinks href=#hl-15-257>257</a>
</span><span class=lnt id=hl-15-258><a class=lnlinks href=#hl-15-258>258</a>
</span><span class=lnt id=hl-15-259><a class=lnlinks href=#hl-15-259>259</a>
</span><span class=lnt id=hl-15-260><a class=lnlinks href=#hl-15-260>260</a>
</span><span class=lnt id=hl-15-261><a class=lnlinks href=#hl-15-261>261</a>
</span><span class=lnt id=hl-15-262><a class=lnlinks href=#hl-15-262>262</a>
</span><span class=lnt id=hl-15-263><a class=lnlinks href=#hl-15-263>263</a>
</span><span class=lnt id=hl-15-264><a class=lnlinks href=#hl-15-264>264</a>
</span><span class=lnt id=hl-15-265><a class=lnlinks href=#hl-15-265>265</a>
</span><span class=lnt id=hl-15-266><a class=lnlinks href=#hl-15-266>266</a>
</span><span class=lnt id=hl-15-267><a class=lnlinks href=#hl-15-267>267</a>
</span><span class=lnt id=hl-15-268><a class=lnlinks href=#hl-15-268>268</a>
</span><span class=lnt id=hl-15-269><a class=lnlinks href=#hl-15-269>269</a>
</span><span class=lnt id=hl-15-270><a class=lnlinks href=#hl-15-270>270</a>
</span><span class=lnt id=hl-15-271><a class=lnlinks href=#hl-15-271>271</a>
</span><span class=lnt id=hl-15-272><a class=lnlinks href=#hl-15-272>272</a>
</span><span class=lnt id=hl-15-273><a class=lnlinks href=#hl-15-273>273</a>
</span><span class=lnt id=hl-15-274><a class=lnlinks href=#hl-15-274>274</a>
</span><span class=lnt id=hl-15-275><a class=lnlinks href=#hl-15-275>275</a>
</span><span class=lnt id=hl-15-276><a class=lnlinks href=#hl-15-276>276</a>
</span><span class=lnt id=hl-15-277><a class=lnlinks href=#hl-15-277>277</a>
</span><span class=lnt id=hl-15-278><a class=lnlinks href=#hl-15-278>278</a>
</span><span class=lnt id=hl-15-279><a class=lnlinks href=#hl-15-279>279</a>
</span><span class=lnt id=hl-15-280><a class=lnlinks href=#hl-15-280>280</a>
</span><span class=lnt id=hl-15-281><a class=lnlinks href=#hl-15-281>281</a>
</span><span class=lnt id=hl-15-282><a class=lnlinks href=#hl-15-282>282</a>
</span><span class=lnt id=hl-15-283><a class=lnlinks href=#hl-15-283>283</a>
</span><span class=lnt id=hl-15-284><a class=lnlinks href=#hl-15-284>284</a>
</span><span class=lnt id=hl-15-285><a class=lnlinks href=#hl-15-285>285</a>
</span><span class=lnt id=hl-15-286><a class=lnlinks href=#hl-15-286>286</a>
</span><span class=lnt id=hl-15-287><a class=lnlinks href=#hl-15-287>287</a>
</span><span class=lnt id=hl-15-288><a class=lnlinks href=#hl-15-288>288</a>
</span><span class=lnt id=hl-15-289><a class=lnlinks href=#hl-15-289>289</a>
</span><span class=lnt id=hl-15-290><a class=lnlinks href=#hl-15-290>290</a>
</span><span class=lnt id=hl-15-291><a class=lnlinks href=#hl-15-291>291</a>
</span><span class=lnt id=hl-15-292><a class=lnlinks href=#hl-15-292>292</a>
</span><span class=lnt id=hl-15-293><a class=lnlinks href=#hl-15-293>293</a>
</span><span class=lnt id=hl-15-294><a class=lnlinks href=#hl-15-294>294</a>
</span><span class=lnt id=hl-15-295><a class=lnlinks href=#hl-15-295>295</a>
</span><span class=lnt id=hl-15-296><a class=lnlinks href=#hl-15-296>296</a>
</span><span class=lnt id=hl-15-297><a class=lnlinks href=#hl-15-297>297</a>
</span><span class=lnt id=hl-15-298><a class=lnlinks href=#hl-15-298>298</a>
</span><span class=lnt id=hl-15-299><a class=lnlinks href=#hl-15-299>299</a>
</span><span class=lnt id=hl-15-300><a class=lnlinks href=#hl-15-300>300</a>
</span><span class=lnt id=hl-15-301><a class=lnlinks href=#hl-15-301>301</a>
</span><span class=lnt id=hl-15-302><a class=lnlinks href=#hl-15-302>302</a>
</span><span class=lnt id=hl-15-303><a class=lnlinks href=#hl-15-303>303</a>
</span><span class=lnt id=hl-15-304><a class=lnlinks href=#hl-15-304>304</a>
</span><span class=lnt id=hl-15-305><a class=lnlinks href=#hl-15-305>305</a>
</span><span class=lnt id=hl-15-306><a class=lnlinks href=#hl-15-306>306</a>
</span><span class=lnt id=hl-15-307><a class=lnlinks href=#hl-15-307>307</a>
</span><span class=lnt id=hl-15-308><a class=lnlinks href=#hl-15-308>308</a>
</span><span class=lnt id=hl-15-309><a class=lnlinks href=#hl-15-309>309</a>
</span><span class=lnt id=hl-15-310><a class=lnlinks href=#hl-15-310>310</a>
</span><span class=lnt id=hl-15-311><a class=lnlinks href=#hl-15-311>311</a>
</span><span class=lnt id=hl-15-312><a class=lnlinks href=#hl-15-312>312</a>
</span><span class=lnt id=hl-15-313><a class=lnlinks href=#hl-15-313>313</a>
</span><span class=lnt id=hl-15-314><a class=lnlinks href=#hl-15-314>314</a>
</span><span class=lnt id=hl-15-315><a class=lnlinks href=#hl-15-315>315</a>
</span><span class=lnt id=hl-15-316><a class=lnlinks href=#hl-15-316>316</a>
</span><span class=lnt id=hl-15-317><a class=lnlinks href=#hl-15-317>317</a>
</span><span class=lnt id=hl-15-318><a class=lnlinks href=#hl-15-318>318</a>
</span><span class=lnt id=hl-15-319><a class=lnlinks href=#hl-15-319>319</a>
</span><span class=lnt id=hl-15-320><a class=lnlinks href=#hl-15-320>320</a>
</span><span class=lnt id=hl-15-321><a class=lnlinks href=#hl-15-321>321</a>
</span><span class=lnt id=hl-15-322><a class=lnlinks href=#hl-15-322>322</a>
</span><span class=lnt id=hl-15-323><a class=lnlinks href=#hl-15-323>323</a>
</span><span class=lnt id=hl-15-324><a class=lnlinks href=#hl-15-324>324</a>
</span><span class=lnt id=hl-15-325><a class=lnlinks href=#hl-15-325>325</a>
</span><span class=lnt id=hl-15-326><a class=lnlinks href=#hl-15-326>326</a>
</span><span class=lnt id=hl-15-327><a class=lnlinks href=#hl-15-327>327</a>
</span><span class=lnt id=hl-15-328><a class=lnlinks href=#hl-15-328>328</a>
</span><span class=lnt id=hl-15-329><a class=lnlinks href=#hl-15-329>329</a>
</span><span class=lnt id=hl-15-330><a class=lnlinks href=#hl-15-330>330</a>
</span><span class=lnt id=hl-15-331><a class=lnlinks href=#hl-15-331>331</a>
</span><span class=lnt id=hl-15-332><a class=lnlinks href=#hl-15-332>332</a>
</span><span class=lnt id=hl-15-333><a class=lnlinks href=#hl-15-333>333</a>
</span><span class=lnt id=hl-15-334><a class=lnlinks href=#hl-15-334>334</a>
</span><span class=lnt id=hl-15-335><a class=lnlinks href=#hl-15-335>335</a>
</span><span class=lnt id=hl-15-336><a class=lnlinks href=#hl-15-336>336</a>
</span><span class=lnt id=hl-15-337><a class=lnlinks href=#hl-15-337>337</a>
</span><span class=lnt id=hl-15-338><a class=lnlinks href=#hl-15-338>338</a>
</span><span class=lnt id=hl-15-339><a class=lnlinks href=#hl-15-339>339</a>
</span><span class=lnt id=hl-15-340><a class=lnlinks href=#hl-15-340>340</a>
</span><span class=lnt id=hl-15-341><a class=lnlinks href=#hl-15-341>341</a>
</span><span class=lnt id=hl-15-342><a class=lnlinks href=#hl-15-342>342</a>
</span><span class=lnt id=hl-15-343><a class=lnlinks href=#hl-15-343>343</a>
</span><span class=lnt id=hl-15-344><a class=lnlinks href=#hl-15-344>344</a>
</span><span class=lnt id=hl-15-345><a class=lnlinks href=#hl-15-345>345</a>
</span><span class=lnt id=hl-15-346><a class=lnlinks href=#hl-15-346>346</a>
</span><span class=lnt id=hl-15-347><a class=lnlinks href=#hl-15-347>347</a>
</span><span class=lnt id=hl-15-348><a class=lnlinks href=#hl-15-348>348</a>
</span><span class=lnt id=hl-15-349><a class=lnlinks href=#hl-15-349>349</a>
</span><span class=lnt id=hl-15-350><a class=lnlinks href=#hl-15-350>350</a>
</span><span class=lnt id=hl-15-351><a class=lnlinks href=#hl-15-351>351</a>
</span><span class=lnt id=hl-15-352><a class=lnlinks href=#hl-15-352>352</a>
</span><span class=lnt id=hl-15-353><a class=lnlinks href=#hl-15-353>353</a>
</span><span class=lnt id=hl-15-354><a class=lnlinks href=#hl-15-354>354</a>
</span><span class=lnt id=hl-15-355><a class=lnlinks href=#hl-15-355>355</a>
</span><span class=lnt id=hl-15-356><a class=lnlinks href=#hl-15-356>356</a>
</span><span class=lnt id=hl-15-357><a class=lnlinks href=#hl-15-357>357</a>
</span><span class=lnt id=hl-15-358><a class=lnlinks href=#hl-15-358>358</a>
</span><span class=lnt id=hl-15-359><a class=lnlinks href=#hl-15-359>359</a>
</span><span class=lnt id=hl-15-360><a class=lnlinks href=#hl-15-360>360</a>
</span><span class=lnt id=hl-15-361><a class=lnlinks href=#hl-15-361>361</a>
</span><span class=lnt id=hl-15-362><a class=lnlinks href=#hl-15-362>362</a>
</span><span class=lnt id=hl-15-363><a class=lnlinks href=#hl-15-363>363</a>
</span><span class=lnt id=hl-15-364><a class=lnlinks href=#hl-15-364>364</a>
</span><span class=lnt id=hl-15-365><a class=lnlinks href=#hl-15-365>365</a>
</span><span class=lnt id=hl-15-366><a class=lnlinks href=#hl-15-366>366</a>
</span><span class=lnt id=hl-15-367><a class=lnlinks href=#hl-15-367>367</a>
</span><span class=lnt id=hl-15-368><a class=lnlinks href=#hl-15-368>368</a>
</span><span class=lnt id=hl-15-369><a class=lnlinks href=#hl-15-369>369</a>
</span><span class=lnt id=hl-15-370><a class=lnlinks href=#hl-15-370>370</a>
</span><span class=lnt id=hl-15-371><a class=lnlinks href=#hl-15-371>371</a>
</span><span class=lnt id=hl-15-372><a class=lnlinks href=#hl-15-372>372</a>
</span><span class=lnt id=hl-15-373><a class=lnlinks href=#hl-15-373>373</a>
</span><span class=lnt id=hl-15-374><a class=lnlinks href=#hl-15-374>374</a>
</span><span class=lnt id=hl-15-375><a class=lnlinks href=#hl-15-375>375</a>
</span><span class=lnt id=hl-15-376><a class=lnlinks href=#hl-15-376>376</a>
</span><span class=lnt id=hl-15-377><a class=lnlinks href=#hl-15-377>377</a>
</span><span class=lnt id=hl-15-378><a class=lnlinks href=#hl-15-378>378</a>
</span><span class=lnt id=hl-15-379><a class=lnlinks href=#hl-15-379>379</a>
</span><span class=lnt id=hl-15-380><a class=lnlinks href=#hl-15-380>380</a>
</span><span class=lnt id=hl-15-381><a class=lnlinks href=#hl-15-381>381</a>
</span><span class=lnt id=hl-15-382><a class=lnlinks href=#hl-15-382>382</a>
</span><span class=lnt id=hl-15-383><a class=lnlinks href=#hl-15-383>383</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 전자상거래 추천 시스템 레이크하우스 구현 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql.functions</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql.types</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>delta.tables</span> <span class=kn>import</span> <span class=n>DeltaTable</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>mlflow</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>mlflow.spark</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Spark 세션 초기화</span>
</span></span><span class=line><span class=cl><span class=n>spark</span> <span class=o>=</span> <span class=n>SparkSession</span><span class=o>.</span><span class=n>builder</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>appName</span><span class=p>(</span><span class=s2>&#34;EcommerceRecommendationLakehouse&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.sql.extensions&#34;</span><span class=p>,</span> <span class=s2>&#34;io.delta.sql.DeltaSparkSessionExtension&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s2>&#34;spark.sql.catalog.spark_catalog&#34;</span><span class=p>,</span> <span class=s2>&#34;org.apache.spark.sql.delta.catalog.DeltaCatalog&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>getOrCreate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Bronze Layer - 원시 클릭스트림 데이터 수집</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_bronze_layer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Bronze Layer: 원시 데이터를 그대로 저장
</span></span></span><span class=line><span class=cl><span class=s2>    - 스키마 검증 최소화
</span></span></span><span class=line><span class=cl><span class=s2>    - 메타데이터 추가 (수집 시간, 소스 등)
</span></span></span><span class=line><span class=cl><span class=s2>    - 파티션 구조로 효율적 저장
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Kafka에서 실시간 클릭스트림 읽기</span>
</span></span><span class=line><span class=cl>    <span class=n>clickstream_df</span> <span class=o>=</span> <span class=n>spark</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>readStream</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;kafka&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;kafka.bootstrap.servers&#34;</span><span class=p>,</span> <span class=s2>&#34;localhost:9092&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;subscribe&#34;</span><span class=p>,</span> <span class=s2>&#34;clickstream&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>load</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># JSON 파싱 및 메타데이터 추가</span>
</span></span><span class=line><span class=cl>    <span class=n>parsed_df</span> <span class=o>=</span> <span class=n>clickstream_df</span><span class=o>.</span><span class=n>select</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>from_json</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;value&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>cast</span><span class=p>(</span><span class=s2>&#34;string&#34;</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>                 <span class=n>StructType</span><span class=p>([</span>
</span></span><span class=line><span class=cl>                     <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                     <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;product_id&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                     <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                     <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span> <span class=n>TimestampType</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                     <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;session_id&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                 <span class=p>]))</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>col</span><span class=p>(</span><span class=s2>&#34;timestamp&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;kafka_timestamp&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span><span class=o>.</span><span class=n>select</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>col</span><span class=p>(</span><span class=s2>&#34;data.*&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>col</span><span class=p>(</span><span class=s2>&#34;kafka_timestamp&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>lit</span><span class=p>(</span><span class=s2>&#34;kafka&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;source_system&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>current_timestamp</span><span class=p>()</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;ingestion_time&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Bronze 테이블로 스트리밍 저장</span>
</span></span><span class=line><span class=cl>    <span class=n>bronze_query</span> <span class=o>=</span> <span class=n>parsed_df</span><span class=o>.</span><span class=n>writeStream</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>outputMode</span><span class=p>(</span><span class=s2>&#34;append&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;checkpointLocation&#34;</span><span class=p>,</span> <span class=s2>&#34;/delta/checkpoints/bronze_clickstream&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>trigger</span><span class=p>(</span><span class=n>processingTime</span><span class=o>=</span><span class=s2>&#34;30 seconds&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>partitionBy</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>start</span><span class=p>(</span><span class=s2>&#34;/delta/bronze/clickstream&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>bronze_query</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Silver Layer - 데이터 정제 및 검증</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_silver_layer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Silver Layer: 데이터 정제 및 표준화
</span></span></span><span class=line><span class=cl><span class=s2>    - 중복 제거
</span></span></span><span class=line><span class=cl><span class=s2>    - 데이터 검증
</span></span></span><span class=line><span class=cl><span class=s2>    - 스키마 표준화
</span></span></span><span class=line><span class=cl><span class=s2>    - 비즈니스 로직 적용
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Bronze에서 데이터 읽기</span>
</span></span><span class=line><span class=cl>    <span class=n>bronze_df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>readStream</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/bronze/clickstream&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 데이터 정제 및 검증</span>
</span></span><span class=line><span class=cl>    <span class=n>silver_df</span> <span class=o>=</span> <span class=n>bronze_df</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>isNotNull</span><span class=p>())</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;product_id&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>isNotNull</span><span class=p>())</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>isin</span><span class=p>([</span><span class=s2>&#34;view&#34;</span><span class=p>,</span> <span class=s2>&#34;cart&#34;</span><span class=p>,</span> <span class=s2>&#34;purchase&#34;</span><span class=p>]))</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>dropDuplicates</span><span class=p>([</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=s2>&#34;product_id&#34;</span><span class=p>,</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>,</span> <span class=s2>&#34;session_id&#34;</span><span class=p>])</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>withColumn</span><span class=p>(</span><span class=s2>&#34;hour&#34;</span><span class=p>,</span> <span class=n>hour</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;timestamp&#34;</span><span class=p>)))</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>withColumn</span><span class=p>(</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=n>to_date</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;timestamp&#34;</span><span class=p>)))</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>withColumn</span><span class=p>(</span><span class=s2>&#34;is_weekend&#34;</span><span class=p>,</span> <span class=n>when</span><span class=p>(</span><span class=n>dayofweek</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;timestamp&#34;</span><span class=p>))</span><span class=o>.</span><span class=n>isin</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>7</span><span class=p>]),</span> <span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>otherwise</span><span class=p>(</span><span class=kc>False</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 사용자 세션 집계</span>
</span></span><span class=line><span class=cl>    <span class=n>session_aggregated</span> <span class=o>=</span> <span class=n>silver_df</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>groupBy</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=s2>&#34;session_id&#34;</span><span class=p>,</span> <span class=s2>&#34;date&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>agg</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>count</span><span class=p>(</span><span class=s2>&#34;*&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;total_events&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>countDistinct</span><span class=p>(</span><span class=s2>&#34;product_id&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;unique_products_viewed&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nb>max</span><span class=p>(</span><span class=s2>&#34;timestamp&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;last_activity&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>collect_list</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;action_sequence&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Silver 테이블로 저장</span>
</span></span><span class=line><span class=cl>    <span class=n>silver_query</span> <span class=o>=</span> <span class=n>session_aggregated</span><span class=o>.</span><span class=n>writeStream</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>outputMode</span><span class=p>(</span><span class=s2>&#34;append&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;checkpointLocation&#34;</span><span class=p>,</span> <span class=s2>&#34;/delta/checkpoints/silver_sessions&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>trigger</span><span class=p>(</span><span class=n>processingTime</span><span class=o>=</span><span class=s2>&#34;1 minute&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>foreachBatch</span><span class=p>(</span><span class=n>upsert_to_silver</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>silver_query</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>upsert_to_silver</span><span class=p>(</span><span class=n>batch_df</span><span class=p>,</span> <span class=n>batch_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Silver 테이블에 UPSERT 연산 수행
</span></span></span><span class=line><span class=cl><span class=s2>    기존 세션 데이터가 있으면 업데이트, 없으면 삽입
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Delta 테이블 로드</span>
</span></span><span class=line><span class=cl>    <span class=n>silver_table</span> <span class=o>=</span> <span class=n>DeltaTable</span><span class=o>.</span><span class=n>forPath</span><span class=p>(</span><span class=n>spark</span><span class=p>,</span> <span class=s2>&#34;/delta/silver/user_sessions&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># MERGE 연산으로 UPSERT 수행</span>
</span></span><span class=line><span class=cl>    <span class=n>silver_table</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;target&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>batch_df</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;source&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;target.user_id = source.user_id AND target.session_id = source.session_id&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span><span class=o>.</span><span class=n>whenMatchedUpdateAll</span><span class=p>()</span> \
</span></span><span class=line><span class=cl>     <span class=o>.</span><span class=n>whenNotMatchedInsertAll</span><span class=p>()</span> \
</span></span><span class=line><span class=cl>     <span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Gold Layer - 비즈니스 집계 및 ML 피처 생성</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_gold_layer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Gold Layer: 비즈니스 요구사항에 맞는 데이터 모델링
</span></span></span><span class=line><span class=cl><span class=s2>    - 사용자 프로필 생성
</span></span></span><span class=line><span class=cl><span class=s2>    - 상품 인기도 계산
</span></span></span><span class=line><span class=cl><span class=s2>    - 추천 시스템용 피처 생성
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Silver에서 세션 데이터 읽기</span>
</span></span><span class=line><span class=cl>    <span class=n>sessions_df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/silver/user_sessions&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 사용자 프로필 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>user_profile_df</span> <span class=o>=</span> <span class=n>sessions_df</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>groupBy</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>agg</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>count</span><span class=p>(</span><span class=s2>&#34;session_id&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;total_sessions&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>avg</span><span class=p>(</span><span class=s2>&#34;total_events&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;avg_events_per_session&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>avg</span><span class=p>(</span><span class=s2>&#34;unique_products_viewed&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;avg_products_per_session&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nb>max</span><span class=p>(</span><span class=s2>&#34;last_activity&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;last_seen&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nb>sum</span><span class=p>(</span><span class=n>when</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;is_weekend&#34;</span><span class=p>),</span> <span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>otherwise</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;weekend_sessions&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>withColumn</span><span class=p>(</span><span class=s2>&#34;user_engagement_score&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                   <span class=n>col</span><span class=p>(</span><span class=s2>&#34;total_sessions&#34;</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.3</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl>                   <span class=n>col</span><span class=p>(</span><span class=s2>&#34;avg_events_per_session&#34;</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.4</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl>                   <span class=n>col</span><span class=p>(</span><span class=s2>&#34;avg_products_per_session&#34;</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 상품 인기도 계산</span>
</span></span><span class=line><span class=cl>    <span class=n>product_popularity_df</span> <span class=o>=</span> <span class=n>sessions_df</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/bronze/clickstream&#34;</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>              <span class=p>[</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=s2>&#34;session_id&#34;</span><span class=p>])</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>groupBy</span><span class=p>(</span><span class=s2>&#34;product_id&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>agg</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>countDistinct</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;unique_viewers&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>count</span><span class=p>(</span><span class=s2>&#34;*&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;total_views&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nb>sum</span><span class=p>(</span><span class=n>when</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;purchase&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>otherwise</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;purchases&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>withColumn</span><span class=p>(</span><span class=s2>&#34;conversion_rate&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                   <span class=n>col</span><span class=p>(</span><span class=s2>&#34;purchases&#34;</span><span class=p>)</span> <span class=o>/</span> <span class=n>col</span><span class=p>(</span><span class=s2>&#34;total_views&#34;</span><span class=p>))</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>withColumn</span><span class=p>(</span><span class=s2>&#34;popularity_score&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>col</span><span class=p>(</span><span class=s2>&#34;unique_viewers&#34;</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.4</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl>                   <span class=n>col</span><span class=p>(</span><span class=s2>&#34;total_views&#34;</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.3</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl>                   <span class=n>col</span><span class=p>(</span><span class=s2>&#34;conversion_rate&#34;</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Gold 테이블들에 저장</span>
</span></span><span class=line><span class=cl>    <span class=n>user_profile_df</span><span class=o>.</span><span class=n>write</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>mode</span><span class=p>(</span><span class=s2>&#34;overwrite&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s2>&#34;/delta/gold/user_profiles&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>product_popularity_df</span><span class=o>.</span><span class=n>write</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>mode</span><span class=p>(</span><span class=s2>&#34;overwrite&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s2>&#34;/delta/gold/product_popularity&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ML 파이프라인 - 추천 모델 훈련</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>train_recommendation_model</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    MLflow를 활용한 추천 모델 훈련
</span></span></span><span class=line><span class=cl><span class=s2>    - 피처 엔지니어링
</span></span></span><span class=line><span class=cl><span class=s2>    - 협업 필터링 모델 훈련
</span></span></span><span class=line><span class=cl><span class=s2>    - 모델 등록 및 배포
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>mlflow</span><span class=o>.</span><span class=n>start_run</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=c1># Gold 레이어에서 피처 로드</span>
</span></span><span class=line><span class=cl>        <span class=n>user_profiles</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/gold/user_profiles&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>product_popularity</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/gold/product_popularity&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 사용자-상품 상호작용 매트릭스 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>interactions_df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/silver/user_sessions&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/bronze/clickstream&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                  <span class=p>[</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=s2>&#34;session_id&#34;</span><span class=p>])</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>isin</span><span class=p>([</span><span class=s2>&#34;view&#34;</span><span class=p>,</span> <span class=s2>&#34;cart&#34;</span><span class=p>,</span> <span class=s2>&#34;purchase&#34;</span><span class=p>]))</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>withColumn</span><span class=p>(</span><span class=s2>&#34;rating&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                       <span class=n>when</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;purchase&#34;</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                       <span class=o>.</span><span class=n>when</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;cart&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                       <span class=o>.</span><span class=n>otherwise</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>groupBy</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=s2>&#34;product_id&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>agg</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=s2>&#34;rating&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>&#34;rating&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ALS (Alternating Least Squares) 모델 훈련</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>pyspark.ml.recommendation</span> <span class=kn>import</span> <span class=n>ALS</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>pyspark.ml.evaluation</span> <span class=kn>import</span> <span class=n>RegressionEvaluator</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 사용자와 상품 ID를 숫자로 변환</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>pyspark.ml.feature</span> <span class=kn>import</span> <span class=n>StringIndexer</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>user_indexer</span> <span class=o>=</span> <span class=n>StringIndexer</span><span class=p>(</span><span class=n>inputCol</span><span class=o>=</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=n>outputCol</span><span class=o>=</span><span class=s2>&#34;user_index&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>product_indexer</span> <span class=o>=</span> <span class=n>StringIndexer</span><span class=p>(</span><span class=n>inputCol</span><span class=o>=</span><span class=s2>&#34;product_id&#34;</span><span class=p>,</span> <span class=n>outputCol</span><span class=o>=</span><span class=s2>&#34;product_index&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>indexed_interactions</span> <span class=o>=</span> <span class=n>user_indexer</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>interactions_df</span><span class=p>)</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>interactions_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>indexed_interactions</span> <span class=o>=</span> <span class=n>product_indexer</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>indexed_interactions</span><span class=p>)</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>indexed_interactions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 훈련/테스트 데이터 분할</span>
</span></span><span class=line><span class=cl>        <span class=n>train_data</span><span class=p>,</span> <span class=n>test_data</span> <span class=o>=</span> <span class=n>indexed_interactions</span><span class=o>.</span><span class=n>randomSplit</span><span class=p>([</span><span class=mf>0.8</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>],</span> <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ALS 모델 설정 및 훈련</span>
</span></span><span class=line><span class=cl>        <span class=n>als</span> <span class=o>=</span> <span class=n>ALS</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>userCol</span><span class=o>=</span><span class=s2>&#34;user_index&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>itemCol</span><span class=o>=</span><span class=s2>&#34;product_index&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>ratingCol</span><span class=o>=</span><span class=s2>&#34;rating&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>rank</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>maxIter</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>regParam</span><span class=o>=</span><span class=mf>0.01</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>coldStartStrategy</span><span class=o>=</span><span class=s2>&#34;drop&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>model</span> <span class=o>=</span> <span class=n>als</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>train_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모델 평가</span>
</span></span><span class=line><span class=cl>        <span class=n>predictions</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>test_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>evaluator</span> <span class=o>=</span> <span class=n>RegressionEvaluator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>metricName</span><span class=o>=</span><span class=s2>&#34;rmse&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>labelCol</span><span class=o>=</span><span class=s2>&#34;rating&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>predictionCol</span><span class=o>=</span><span class=s2>&#34;prediction&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>rmse</span> <span class=o>=</span> <span class=n>evaluator</span><span class=o>.</span><span class=n>evaluate</span><span class=p>(</span><span class=n>predictions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># MLflow에 메트릭 및 모델 로깅</span>
</span></span><span class=line><span class=cl>        <span class=n>mlflow</span><span class=o>.</span><span class=n>log_metric</span><span class=p>(</span><span class=s2>&#34;rmse&#34;</span><span class=p>,</span> <span class=n>rmse</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mlflow</span><span class=o>.</span><span class=n>log_param</span><span class=p>(</span><span class=s2>&#34;rank&#34;</span><span class=p>,</span> <span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mlflow</span><span class=o>.</span><span class=n>log_param</span><span class=p>(</span><span class=s2>&#34;maxIter&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mlflow</span><span class=o>.</span><span class=n>spark</span><span class=o>.</span><span class=n>log_model</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=s2>&#34;recommendation_model&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Model RMSE: </span><span class=si>{</span><span class=n>rmse</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실시간 추천 서빙</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>serve_recommendations</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    실시간 추천 API 서빙
</span></span></span><span class=line><span class=cl><span class=s2>    - 사용자별 개인화 추천
</span></span></span><span class=line><span class=cl><span class=s2>    - 실시간 피처 조합
</span></span></span><span class=line><span class=cl><span class=s2>    - A/B 테스트 지원
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 훈련된 모델 로드</span>
</span></span><span class=line><span class=cl>    <span class=n>model_uri</span> <span class=o>=</span> <span class=s2>&#34;models:/recommendation_model/latest&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span> <span class=o>=</span> <span class=n>mlflow</span><span class=o>.</span><span class=n>spark</span><span class=o>.</span><span class=n>load_model</span><span class=p>(</span><span class=n>model_uri</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 실시간 사용자 정보 기반 추천 생성</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_user_recommendations</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>num_recommendations</span><span class=o>=</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 사용자 최근 활동 조회</span>
</span></span><span class=line><span class=cl>        <span class=n>recent_activity</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/silver/user_sessions&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=n>user_id</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>orderBy</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;last_activity&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>desc</span><span class=p>())</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>recent_activity</span><span class=o>.</span><span class=n>count</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 신규 사용자의 경우 인기 상품 추천</span>
</span></span><span class=line><span class=cl>            <span class=n>popular_products</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/gold/product_popularity&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=n>orderBy</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;popularity_score&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>desc</span><span class=p>())</span> \
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=n>num_recommendations</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;product_id&#34;</span><span class=p>,</span> <span class=s2>&#34;popularity_score&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>popular_products</span><span class=o>.</span><span class=n>collect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 기존 사용자의 경우 개인화 추천</span>
</span></span><span class=line><span class=cl>        <span class=n>user_products</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>createDataFrame</span><span class=p>([(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>)],</span> 
</span></span><span class=line><span class=cl>                                             <span class=p>[</span><span class=s2>&#34;user_id&#34;</span><span class=p>,</span> <span class=s2>&#34;product_id&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>recommendations</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>user_products</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>orderBy</span><span class=p>(</span><span class=n>col</span><span class=p>(</span><span class=s2>&#34;prediction&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>desc</span><span class=p>())</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=n>num_recommendations</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;product_id&#34;</span><span class=p>,</span> <span class=s2>&#34;prediction&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>recommendations</span><span class=o>.</span><span class=n>collect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>get_user_recommendations</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 모니터링 및 성능 측정</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>setup_monitoring</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    레이크하우스 성능 모니터링 설정
</span></span></span><span class=line><span class=cl><span class=s2>    - 데이터 품질 메트릭
</span></span></span><span class=line><span class=cl><span class=s2>    - 쿼리 성능 추적
</span></span></span><span class=line><span class=cl><span class=s2>    - 추천 시스템 성과 모니터링
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 데이터 품질 체크</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>check_data_quality</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>bronze_count</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/bronze/clickstream&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>silver_count</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/silver/user_sessions&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>gold_count</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/delta/gold/user_profiles&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>quality_metrics</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;bronze_records&#34;</span><span class=p>:</span> <span class=n>bronze_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;silver_records&#34;</span><span class=p>:</span> <span class=n>silver_count</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;gold_records&#34;</span><span class=p>:</span> <span class=n>gold_count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;data_pipeline_health&#34;</span><span class=p>:</span> <span class=s2>&#34;healthy&#34;</span> <span class=k>if</span> <span class=n>bronze_count</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=s2>&#34;warning&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>quality_metrics</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 추천 성과 측정</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>measure_recommendation_performance</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=c1># CTR (Click-Through Rate) 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendations_served</span> <span class=o>=</span> <span class=mi>1000</span>  <span class=c1># API 호출 수</span>
</span></span><span class=line><span class=cl>        <span class=n>clicks_received</span> <span class=o>=</span> <span class=mi>150</span>         <span class=c1># 실제 클릭 수</span>
</span></span><span class=line><span class=cl>        <span class=n>ctr</span> <span class=o>=</span> <span class=n>clicks_received</span> <span class=o>/</span> <span class=n>recommendations_served</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 다양성 측정 (추천된 상품 카테고리 분포)</span>
</span></span><span class=line><span class=cl>        <span class=n>diversity_score</span> <span class=o>=</span> <span class=mf>0.8</span>  <span class=c1># 계산된 다양성 점수</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>performance_metrics</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ctr&#34;</span><span class=p>:</span> <span class=n>ctr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;diversity_score&#34;</span><span class=p>:</span> <span class=n>diversity_score</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;recommendations_served&#34;</span><span class=p>:</span> <span class=n>recommendations_served</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>performance_metrics</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>check_data_quality</span><span class=p>,</span> <span class=n>measure_recommendation_performance</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 메인 실행 함수</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    레이크하우스 기반 추천 시스템 전체 파이프라인 실행
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 레이크하우스 기반 추천 시스템 시작 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 1. Bronze Layer 처리 시작</span>
</span></span><span class=line><span class=cl>    <span class=n>bronze_query</span> <span class=o>=</span> <span class=n>process_bronze_layer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Bronze Layer 스트리밍 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 2. Silver Layer 처리 시작  </span>
</span></span><span class=line><span class=cl>    <span class=n>silver_query</span> <span class=o>=</span> <span class=n>process_silver_layer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Silver Layer 처리 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 3. Gold Layer 배치 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>process_gold_layer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Gold Layer 배치 처리 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 4. ML 모델 훈련</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span> <span class=o>=</span> <span class=n>train_recommendation_model</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;추천 모델 훈련 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 5. 추천 서빙 함수 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>recommend_func</span> <span class=o>=</span> <span class=n>serve_recommendations</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;추천 서빙 준비 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 6. 모니터링 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>quality_check</span><span class=p>,</span> <span class=n>performance_check</span> <span class=o>=</span> <span class=n>setup_monitoring</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 7. 샘플 추천 실행</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_recommendations</span> <span class=o>=</span> <span class=n>recommend_func</span><span class=p>(</span><span class=s2>&#34;user_12345&#34;</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;샘플 추천 결과: </span><span class=si>{</span><span class=n>sample_recommendations</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 8. 품질 및 성능 체크</span>
</span></span><span class=line><span class=cl>    <span class=n>quality_metrics</span> <span class=o>=</span> <span class=n>quality_check</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>performance_metrics</span> <span class=o>=</span> <span class=n>performance_check</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;데이터 품질 메트릭: </span><span class=si>{</span><span class=n>quality_metrics</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;추천 성과 메트릭: </span><span class=si>{</span><span class=n>performance_metrics</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 레이크하우스 기반 추천 시스템 실행 완료 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 스트리밍 쿼리 대기</span>
</span></span><span class=line><span class=cl>    <span class=n>bronze_query</span><span class=o>.</span><span class=n>awaitTermination</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>silver_query</span><span class=o>.</span><span class=n>awaitTermination</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>고려 요소</th><th>설명</th><th>권장 사항 및 도구/전략</th></tr></thead><tbody><tr><td><strong>데이터 거버넌스</strong></td><td>메타데이터 및 카탈로그 관리</td><td>중앙 집중식 데이터 계보 및 정책 관리를 위한 메타데이터 통합 필요</td><td>Unity Catalog, AWS Glue, Data Catalog 등 도입데이터 라인에이지 추적 도구 활용</td></tr><tr><td></td><td>접근 제어 및 권한 체계</td><td>사용자/역할 기반 세분화된 권한 제어와 감사 로그 필수</td><td>RBAC/ABAC 기반 정책 설계정책 위반 탐지 로깅/모니터링 구성</td></tr><tr><td></td><td>데이터 품질 및 정책 관리</td><td>데이터 정확도·완전성 검증 자동화 및 규제 대응</td><td>Great Expectations, Monte Carlo, SodaSQL 등 활용</td></tr><tr><td><strong>스토리지 및 트랜잭션</strong></td><td>객체 스토리지 선택</td><td>대규모 데이터 저장을 위한 성능/비용/통합성 고려</td><td>AWS S3, Azure Data Lake, GCS 등 선택멀티클라우드 전략 고려</td></tr><tr><td></td><td>트랜잭션 로그 및 버전 관리</td><td>ACID 보장, 스냅샷 기반 시간 여행, 데이터 정합성 유지</td><td>DeltaLog, Hudi Timeline, Iceberg Snapshot 보존 주기 정책 설정</td></tr><tr><td><strong>쿼리 및 성능 최적화</strong></td><td>파티셔닝 전략</td><td>쿼리 성능 향상을 위한 논리 기반 파티션 분할 설계</td><td>날짜, 지역, 제품군 등 도메인 특성 기반 파티셔닝</td></tr><tr><td></td><td>파일 레이아웃 및 인덱싱 최적화</td><td>파일 크기/구조 정규화, 정렬 및 압축 등을 통한 쿼리 효율화</td><td>Z-ordering, Compaction, OPTIMIZE 명령 등 적용</td></tr><tr><td><strong>운영 및 자동화</strong></td><td>데이터 파이프라인 오케스트레이션</td><td>추출 - 변환 - 적재 및 품질 검증 파이프라인의 자동화와 재처리 전략</td><td>Apache Airflow, Prefect, dbt 등 활용 Failover 설계 포함</td></tr><tr><td></td><td>모니터링 및 알림 시스템</td><td>실시간 상태 모니터링 및 장애 대응을 위한 통합 대시보드 필요</td><td>Prometheus, Grafana, OpenLineage, Datadog 등 연동</td></tr><tr><td></td><td>리소스 및 비용 최적화</td><td>스토리지/컴퓨팅 사용량 모니터링 및 정책 기반 비용 절감 전략 필요</td><td>Auto-scaling, Spot Instance 활용사용량 기반 리포팅 및 경고 알림</td></tr><tr><td><strong>팀과 조직</strong></td><td>기술 내재화 및 교육 체계</td><td>빠르게 발전하는 생태계에 대한 팀 역량 강화 필요</td><td>핸즈온 워크샵, 기술 블로그 운영, 인증 프로그램, 멘토링 프로그램 운영</td></tr><tr><td><strong>마이그레이션 전략</strong></td><td>점진적 전환 및 리스크 분산</td><td>기존 시스템에서 Lakehouse 로의 전환 시 안정성과 실험 기반 전환 전략 필요</td><td>PoC → Pilot → 점진적 마이그레이션 단계 구성모듈별 분리 전환 전략 수립</td></tr><tr><td><strong>ML 통합 고려</strong></td><td>ML 파이프라인 연계 및 모델 서빙</td><td>Feature Store 와 모델 추론을 레이크하우스와 통합 운영</td><td>MLflow, SageMaker, Feast, Tecton 등 활용모델 버전 관리 및 배포 자동화 포함</td></tr></tbody></table><h4 id=전환-전략>전환 전략<a hidden class=anchor aria-hidden=true href=#전환-전략>#</a></h4><table><thead><tr><th>단계</th><th>설명</th><th>도구 및 기술 예시</th></tr></thead><tbody><tr><td>1. 기존 Data Lake 평가</td><td>포맷, 구조, 품질 확인</td><td>S3 + Athena + Glue 기준 점검</td></tr><tr><td>2. 포맷 업그레이드</td><td>Parquet → Delta/Iceberg 변환</td><td>Delta Table Migration Tool, Iceberg Spark Sink</td></tr><tr><td>3. 트랜잭션 처리 도입</td><td>Delta Log, Iceberg Manifest 관리</td><td>Delta Lake APIs, Iceberg Spark Write</td></tr><tr><td>4. 카탈로그 통합</td><td>기존 Glue → Unity Catalog 등 전환</td><td>Apache Hive, Unity Catalog 통합</td></tr><tr><td>5. CDC 및 버전 관리 추가</td><td>실시간 변경 적용 및 버전 관리</td><td>Delta Time Travel, Hudi Incremental Queries</td></tr><tr><td>6. 거버넌스 강화</td><td>권한, Lineage, Policy 적용</td><td>Unity Catalog, Lake Formation, Atlas 연계</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>최적화 영역</strong></th><th><strong>설명</strong></th><th><strong>권장 전략 / 기술</strong></th></tr></thead><tbody><tr><td><strong>1. 저장소 최적화</strong></td><td>파일 조각화 방지</td><td>작은 파일이 많을수록 메타데이터 부하 증가 및 I/O 비효율 발생</td><td>Auto Compaction, <code>OPTIMIZE</code> 명령 주기적 실행</td></tr><tr><td></td><td>파일 포맷 및 압축 전략</td><td>I/O 및 스토리지 비용 효율화</td><td>Parquet + Snappy/LZ4, Z-Ordering 적용</td></tr><tr><td></td><td>스토리지 계층화</td><td>데이터 생명주기에 따라 비용 최적화</td><td>Hot/Warm/Cold Storage + Auto Tiering</td></tr><tr><td><strong>2. 쿼리 성능 최적화</strong></td><td>파티셔닝 전략</td><td>데이터 범위 축소로 쿼리 시간 단축</td><td>주요 필터 컬럼 기준 파티셔닝</td></tr><tr><td></td><td>인덱싱 및 통계 기반 최적화</td><td>쿼리 엔진의 효율적인 스캔 및 조인 수행</td><td>Bloom Filter, Min/Max Index, Stats 활용</td></tr><tr><td></td><td>프레디케이트 푸시다운</td><td>불필요한 데이터 스캔 최소화</td><td>스토리지 레벨 필터링 유도</td></tr><tr><td></td><td>캐싱 전략</td><td>자주 조회되는 데이터의 처리 속도 개선</td><td>Delta Cache, 메모리 기반 캐시, Adaptive Query 실행</td></tr><tr><td><strong>3. 트랜잭션 및 동시성</strong></td><td>병렬 쓰기 제어</td><td>트랜잭션 충돌 방지 및 쓰기 안정성 확보</td><td>Optimistic Concurrency Control 설정</td></tr><tr><td></td><td>격리 수준 조정</td><td>일관성과 성능 간 트레이드오프 조율</td><td>읽기 일관성 + Snapshot 격리 수준 적용</td></tr><tr><td><strong>4. 메타데이터 관리</strong></td><td>카탈로그 캐싱 및 갱신</td><td>메타데이터 조회 병목 제거</td><td>Unity Catalog + Refresh 정책 설정</td></tr><tr><td></td><td>스키마 진화 관리</td><td>스키마 변경으로 인한 파이프라인 오류 방지</td><td>Schema Evolution, 버저닝 및 스키마 검증 도구 활용</td></tr><tr><td><strong>5. 스트리밍 및 배치 최적화</strong></td><td>트리거 및 배치 전략</td><td>적절한 주기와 처리량 설정으로 자원 낭비 최소화</td><td>Trigger Once, Continuous 모드 선택, 동적 배치 크기</td></tr><tr><td></td><td>백프레셔 및 처리 조절</td><td>스트리밍 처리 안정성 확보</td><td>Watermark, Buffer 조정, Auto Tuning</td></tr><tr><td><strong>6. 리소스/비용 최적화</strong></td><td>자동 스케일링 및 리소스 제어</td><td>컴퓨팅 자원 과다 사용 방지, 비용 효율적 운영</td><td>Auto-scaling 클러스터, 비용 알림/모니터링</td></tr><tr><td></td><td>네트워크 데이터 지역성 최적화</td><td>데이터 전송 비용 및 대기 시간 최소화</td><td>동일 리전 배치, CDN, 압축 전송 적용</td></tr><tr><td><strong>7. 운영 자동화 및 품질 관리</strong></td><td>품질 검증 및 이상 탐지</td><td>데이터 정합성과 오류 탐지를 통한 신뢰성 확보</td><td>데이터 유효성 검사, 데이터 품질 플랫폼 연동 (예: Great Expectations)</td></tr><tr><td></td><td>자동화 및 자가 회복</td><td>운영 효율성 및 장애 복구 자동화</td><td>AutoML, Auto Tuning, Self-Healing System</td></tr></tbody></table><h3 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>핵심 주제</strong></th><th><strong>대표 기술/패턴/항목</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>1. 저장 및 아키텍처</strong></td><td>Lakehouse Core</td><td>통합 스토리지 계층 (Data Lake + Warehouse)</td><td>정형/비정형 데이터를 하나의 계층에서 저장 및 처리하는 구조</td></tr><tr><td></td><td>메달리온 아키텍처</td><td>Bronze → Silver → Gold</td><td>데이터 품질을 단계적으로 향상시키는 계층적 처리 전략</td></tr><tr><td></td><td>컴퓨트 - 스토리지 분리</td><td>Decoupled Compute and Storage</td><td>확장성, 비용 최적화를 위한 핵심 설계 원칙</td></tr><tr><td><strong>2. 테이블 포맷</strong></td><td>오픈 테이블 포맷</td><td>Delta Lake, Apache Iceberg, Apache Hudi</td><td>ACID 보장, Time Travel, 증분 처리 등 지원</td></tr><tr><td></td><td>기술 비교 포인트</td><td>ACID, Schema Evolution, Time Travel, Upsert</td><td>각각의 포맷이 지원하는 기능 특성을 기준으로 비교 가능</td></tr><tr><td></td><td>Lakehouse v2 트렌드</td><td>Catalog/Storage Layer 분리</td><td>Iceberg 중심의 표준화 아키텍처 추세 반영</td></tr><tr><td><strong>3. 데이터 처리</strong></td><td>통합 워크로드</td><td>Batch + Streaming 처리 통합</td><td>Lambda 아키텍처의 대안, 단일 파이프라인 처리</td></tr><tr><td></td><td>주요 처리 엔진</td><td>Apache Spark, Apache Flink, Trino (Presto)</td><td>범용, 실시간, 대화형 분석을 아우르는 엔진들</td></tr><tr><td><strong>4. 분석 활용</strong></td><td>워크로드 통합</td><td>BI, AI/ML, 실시간 대시보드</td><td>동일한 데이터 계층에서 다양한 분석 워크로드 실행 가능</td></tr><tr><td></td><td>쿼리 페더레이션</td><td>Redshift Spectrum, Starburst 등</td><td>S3 등 외부 저장소에 직접 쿼리 수행</td></tr><tr><td><strong>5. 거버넌스 및 카탈로그</strong></td><td>통합 거버넌스</td><td>Unity Catalog, Apache Atlas, Apache Ranger</td><td>메타데이터 관리, 데이터 계보, 접근 제어 지원 도구</td></tr><tr><td></td><td>핵심 기능</td><td>메타데이터 통합, 접근 제어, 감사 추적, 계보 추적</td><td>보안, 규정 준수, 신뢰성 있는 데이터 운영을 위한 필수 요소</td></tr><tr><td><strong>6. 클라우드 및 플랫폼</strong></td><td>상용 플랫폼</td><td>Databricks, Snowflake, Amazon Redshift Spectrum</td><td>Lakehouse 아키텍처를 상용화 및 최적화한 클라우드 기반 서비스</td></tr><tr><td></td><td>차별화 포인트</td><td>Databricks (ML+ 통합 플랫폼), Snowflake (쿼리 최적화)</td><td>각 플랫폼의 아키텍처 구성 및 기능 특성에서 차별성 확보</td></tr><tr><td><strong>7. 기술 진화 및 전략</strong></td><td>데이터 메시 기반 확장</td><td>도메인 중심 설계, 자율성 확보</td><td>대규모 분산 조직에 맞는 데이터 소유 구조로 확장 가능</td></tr><tr><td></td><td>표준화 방향</td><td>Iceberg 중심의 포맷 분리 + 오픈 카탈로그 구조</td><td>다양한 도구 간 호환성을 높이기 위한 산업계 표준화 흐름</td></tr></tbody></table><h3 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>주요 항목 및 도구</th><th>설명 및 학습 포인트</th></tr></thead><tbody><tr><td><strong>핵심 개념</strong></td><td>데이터 아키텍처 비교</td><td>데이터 레이크 vs 웨어하우스 vs 레이크하우스</td><td>구조적 차이, 진화 과정, 통합 방식 이해</td></tr><tr><td></td><td>CAP 이론 및 일관성 모델</td><td>CAP 정리, eventual/strong consistency</td><td>분산 환경 트레이드오프 분석</td></tr><tr><td></td><td>트랜잭션 레이어</td><td>Delta Lake, Apache Iceberg, Apache Hudi</td><td>ACID 지원, 버저닝, Time Travel 등</td></tr><tr><td></td><td>메타데이터 관리</td><td>Hive Metastore, AWS Glue, Unity Catalog</td><td>데이터 탐색, 권한 및 구조 관리</td></tr><tr><td></td><td>데이터 모델링</td><td>정규화, 스키마 설계</td><td>쿼리 성능과 확장성 고려한 모델링 전략</td></tr><tr><td><strong>저장 포맷 및 처리</strong></td><td>오픈 테이블 포맷</td><td>Parquet, ORC, Delta, Iceberg, Hudi</td><td>열지향 포맷의 성능 특성, 호환성 비교</td></tr><tr><td></td><td>오브젝트 스토리지</td><td>S3, ADLS, GCS</td><td>클라우드 기반 스토리지 특성 이해</td></tr><tr><td></td><td>쿼리/분석 엔진</td><td>Apache Spark, Presto, Trino, Athena</td><td>배치/인터랙티브 쿼리, 성능 비교</td></tr><tr><td><strong>데이터 파이프라인</strong></td><td>배치 처리 vs 스트리밍</td><td>ETL/ELT, Kafka, Spark Structured Streaming</td><td>실시간 데이터 수집, 집계, 파이프라인 구조</td></tr><tr><td></td><td>오케스트레이션</td><td>Airflow, Prefect</td><td>데이터 플로우 스케줄링 및 의존성 관리</td></tr><tr><td></td><td>서버리스 컴퓨팅</td><td>AWS Lambda, Azure Functions</td><td>이벤트 기반 파이프라인 트리거 구현</td></tr><tr><td><strong>운영 및 거버넌스</strong></td><td>데이터 품질 관리</td><td>Great Expectations</td><td>데이터 유효성 검사 자동화 및 테스트 전략</td></tr><tr><td></td><td>접근 제어 및 보안</td><td>RBAC, ABAC, 데이터 프라이버시 규정 (GDPR 등)</td><td>데이터 접근 정책 정의 및 컴플라이언스</td></tr><tr><td></td><td>감사 추적 및 모니터링</td><td>로깅, 메트릭 수집 도구 (예: Datadog, Prometheus)</td><td>정책 위반 탐지, 거버넌스 강화</td></tr><tr><td><strong>머신러닝 통합</strong></td><td>MLOps 및 피처 관리</td><td>MLflow, Kubeflow, Feast, Tecton</td><td>Lakehouse 기반 ML 파이프라인 통합</td></tr><tr><td></td><td>모델 서빙</td><td>실시간 추론, 배치 추론</td><td>피처 스토어와 연결된 서빙 전략 학습</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>1. 저장 아키텍처</strong></td><td>데이터 레이크 (Data Lake)</td><td>정형/비정형 원시 데이터를 대용량으로 저장하는 시스템. 스키마 온 리드 기반.</td></tr><tr><td></td><td>데이터 웨어하우스 (Data Warehouse)</td><td>정형화된 데이터를 대상으로 빠른 분석을 위한 관계형 저장소. 스키마 온 라이트 기반.</td></tr><tr><td></td><td>레이크하우스 (Lakehouse)</td><td>데이터 레이크의 유연성과 웨어하우스의 성능을 결합한 하이브리드 아키텍처.</td></tr><tr><td></td><td>메달리온 아키텍처 (Medallion Architecture)</td><td>Bronze, Silver, Gold 단계로 데이터 정제를 계층화하여 품질 향상 및 목적별 활용 가능하게 함.</td></tr><tr><td></td><td>컴퓨트 - 스토리지 분리 (Decoupled Compute-Storage)</td><td>저장소와 처리 엔진을 분리하여 독립적으로 확장 가능한 구조.</td></tr><tr><td><strong>2. 테이블 포맷</strong></td><td>Delta Lake</td><td>ACID 트랜잭션, Time Travel, 스키마 진화 등을 지원하는 테이블 포맷. Databricks 주도.</td></tr><tr><td></td><td>Apache Iceberg</td><td>대규모 분석에 적합한 스냅샷 기반 테이블 포맷. 표준화와 성능 최적화에 중점.</td></tr><tr><td></td><td>Apache Hudi</td><td>실시간 데이터 수집과 증분 처리를 지원하는 테이블 포맷. Uber 주도.</td></tr><tr><td><strong>3. 데이터 포맷</strong></td><td>Parquet</td><td>컬럼 기반의 고압축, 고성능 읽기 지원 포맷.</td></tr><tr><td></td><td>ORC</td><td>Hive 기반에서 최적화된 컬럼형 포맷.</td></tr><tr><td></td><td>Avro</td><td>로우 기반 포맷으로 스키마 진화와 직렬화에 강점.</td></tr><tr><td><strong>4. 처리 기술</strong></td><td>ACID 트랜잭션</td><td>원자성, 일관성, 격리성, 지속성을 보장하는 데이터 무결성 보장 메커니즘.</td></tr><tr><td></td><td>스키마 진화 (Schema Evolution)</td><td>기존 데이터를 유지하면서 스키마를 유연하게 변경 가능.</td></tr><tr><td></td><td>시간 여행 (Time Travel)</td><td>특정 시점의 데이터 상태를 조회하거나 복구할 수 있는 기능.</td></tr><tr><td></td><td>Z-Ordering</td><td>다차원 쿼리에서 지역성 (locality) 을 높여 I/O 최적화를 위한 정렬 방식.</td></tr><tr><td><strong>5. 메타데이터</strong></td><td>메타스토어 (Metastore)</td><td>테이블 스키마, 위치 등 메타데이터를 중앙에서 관리하는 시스템 (예: Hive Metastore).</td></tr><tr><td></td><td>데이터 카탈로그 (Data Catalog)</td><td>조직 내 전체 데이터 자산을 탐색/관리 가능한 카탈로그 시스템.</td></tr><tr><td></td><td>데이터 계보 (Data Lineage)</td><td>데이터가 생성, 가공, 소비되는 흐름과 출처를 추적하는 정보 체계.</td></tr><tr><td><strong>6. 거버넌스</strong></td><td>데이터 거버넌스 (Data Governance)</td><td>데이터 품질, 보안, 규정 준수를 위한 정책 및 관리 체계.</td></tr><tr><td></td><td>접근 제어 (Access Control)</td><td>데이터 접근 권한을 사용자별로 통제하고 관리하는 메커니즘.</td></tr><tr><td></td><td>감사 추적 (Audit Trail)</td><td>데이터 접근 및 변경 이력을 로깅하여 보안과 추적성을 확보.</td></tr><tr><td><strong>7. 분석 도구/활용</strong></td><td>BI (Business Intelligence)</td><td>비즈니스 인사이트 도출을 위한 시각화 및 분석 도구 (예: Tableau, Power BI).</td></tr><tr><td></td><td>ML (Machine Learning)</td><td>데이터 기반 학습 및 예측을 수행하는 모델링 및 분석 기법.</td></tr><tr><td><strong>8. 성능 최적화</strong></td><td>파티셔닝 (Partitioning)</td><td>데이터를 논리적으로 분할하여 쿼리 범위를 줄이고 성능 향상.</td></tr><tr><td></td><td>인덱싱 (Indexing)</td><td>조회 성능 향상을 위한 보조 데이터 구조 생성.</td></tr><tr><td></td><td>프레디케이트 푸시다운</td><td>쿼리 조건을 스토리지 레이어에서 먼저 필터링하여 읽기 I/O 최소화.</td></tr><tr><td></td><td>벡터화 실행 (Vectorized Execution)</td><td>CPU 명령어를 활용한 배치 처리로 쿼리 실행 속도 향상.</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://www.databricks.com/product/data-lakehouse>Databricks 레이크하우스 아키텍처 공식 문서</a></li><li><a href=https://learn.microsoft.com/en-us/azure/databricks/lakehouse/>Microsoft Azure 레이크하우스 가이드</a></li><li><a href=https://delta.io/>Apache Delta Lake 공식 문서</a></li><li><a href=https://iceberg.apache.org/>Apache Iceberg 공식 문서</a></li><li><a href=https://hudi.apache.org/>Apache Hudi 공식 문서</a></li><li><a href=https://www.databricks.com/glossary/medallion-architecture>Databricks 메달리온 아키텍처 가이드</a></li><li><a href=https://www.onehouse.ai/blog/apache-hudi-vs-delta-lake-vs-apache-iceberg-lakehouse-feature-comparison>Onehouse 레이크하우스 포맷 비교 분석</a></li><li><a href=https://www.dremio.com/blog/exploring-the-architecture-of-apache-iceberg-delta-lake-and-apache-hudi/>Dremio 테이블 포맷 아키텍처 분석</a></li><li><a href=https://www.analytics8.com/blog/data-lakehouse-explained-building-a-modern-and-scalable-data-architecture/>Analytics8 레이크하우스 구축 가이드</a></li><li><a href=https://www.starburst.io/data-glossary/data-lakehouse/>Starburst 레이크하우스 솔루션 비교</a></li><li><a href=https://aws.amazon.com/big-data/datalakes-and-analytics/lakehouse/>AWS Lakehouse Architecture 소개</a></li><li><a href=https://databricks.com/solutions/data-lakehouse>Databricks Lakehouse Architecture 개념</a></li><li><a href=https://docs.delta.io/latest/delta-intro.html>Delta Lake 공식 문서 (docs.delta.io)</a></li><li><a href=https://iceberg.apache.org/>Apache Iceberg 공식 문서 (iceberg.apache.org)</a></li><li><a href=https://www.oreilly.com/radar/what-is-a-data-lakehouse/>Lakehouse 아키텍처와 데이터 웨어하우스/레이크 비교 (O’Reilly Radar)</a></li><li><a href=https://aws.amazon.com/ko/lake-formation/>AWS Lake Formation 소개</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>