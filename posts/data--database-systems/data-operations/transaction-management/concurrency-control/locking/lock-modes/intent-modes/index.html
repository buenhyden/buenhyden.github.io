<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Intent Modes | hyunyoun's Blog</title><meta name=keywords content="Data-and-Database-Systems,Data-Operations,Transaction-Management,Concurrency-Control,Locking,Lock-Modes,Intent-Modes,Lock-Granularity,Hierarchical-Locking,lock-compatibility"><meta name=description content="의도 모드는 테이블–페이지–행 등 계층에서 하위 자원에 둘 S/X 잠금 계획을 상위에 신호해 충돌을 빠르게 판정하는 메커니즘이다. IS·IX·SIX로 탐색과 갱신이 뒤섞인 상황을 조율하고, 다중 그라뉼러리티·호환성 표·에스컬레이션과 결합해 동시성과 일관성을 높인다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/concurrency-control/locking/lock-modes/intent-modes/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/concurrency-control/locking/lock-modes/intent-modes/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/concurrency-control/locking/lock-modes/intent-modes/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/concurrency-control/locking/lock-modes/intent-modes/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Intent Modes"><meta property="og:description" content="의도 모드는 테이블–페이지–행 등 계층에서 하위 자원에 둘 S/X 잠금 계획을 상위에 신호해 충돌을 빠르게 판정하는 메커니즘이다. IS·IX·SIX로 탐색과 갱신이 뒤섞인 상황을 조율하고, 다중 그라뉼러리티·호환성 표·에스컬레이션과 결합해 동시성과 일관성을 높인다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Intent Modes"><meta name=twitter:description content="의도 모드는 테이블–페이지–행 등 계층에서 하위 자원에 둘 S/X 잠금 계획을 상위에 신호해 충돌을 빠르게 판정하는 메커니즘이다. IS·IX·SIX로 탐색과 갱신이 뒤섞인 상황을 조율하고, 다중 그라뉼러리티·호환성 표·에스컬레이션과 결합해 동시성과 일관성을 높인다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HY's Blog","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":8,"name":"Intent Modes","item":"https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/concurrency-control/locking/lock-modes/intent-modes/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>HY's Blog</a></div><h1>Intent Modes</h1><div class=post-description>의도 모드는 테이블–페이지–행 등 계층에서 하위 자원에 둘 S/X 잠금 계획을 상위에 신호해 충돌을 빠르게 판정하는 메커니즘이다. IS·IX·SIX로 탐색과 갱신이 뒤섞인 상황을 조율하고, 다중 그라뉼러리티·호환성 표·에스컬레이션과 결합해 동시성과 일관성을 높인다.</div></header><div class=post-content><h2 id=intent-modes>Intent Modes<a hidden class=anchor aria-hidden=true href=#intent-modes>#</a></h2><p>Intent Modes(의도 잠금) 는 다중 그라뉼러리티 잠금 (MGL) 에서 상위 노드에 " 하위에서 어떤 락을 걸 계획인지 " 를 선행 표명하는 경량 잠금이다.</p><p>기본형은 <strong>IS</strong>(하위에 S 예고), <strong>IX</strong>(하위에 X 예고), <strong>SIX</strong>(테이블은 공유 읽기 허용 + 일부 하위는 배타 갱신) 이며, 트랜잭션은 하위 락을 잡기 전에 반드시 대응되는 의도 락을 상위에 먼저 획득한다 (예: 행 X → 테이블 IX, 행 S → 테이블 IS).<br>이 구조 덕분에 엔진은 상위 수준에서 <strong>Lock Compatibility Matrix</strong>만 조회해 대규모 작업 (테이블 스캔·DDL) 과 미세 작업 (개별 행 갱신) 의 충돌 여부를 빠르게 판정하고, 불필요한 광역 차단을 피한다.<br>의도 락은 <strong>2PL</strong>과 결합해 직렬가능성 달성에 기여하며, <strong>에스컬레이션</strong>·<strong>파티셔닝</strong> 같은 운영 전략과도 잘 맞는다.<br><strong>MVCC</strong>를 쓰는 엔진에서도 DDL/테이블 락, 인덱스 범위 잠금 등에는 의도 락 규칙이 여전히 적용된다.</p><p>실무에서는 " 가능한 가장 약한 모드 " 를 선택하고, 접근 범위를 인덱스로 좁히며, 락/대기 지표로 교착과 에스컬레이션을 상시 점검하는 것이 핵심이다.</p><h3 id=의도-잠금-개념관계실무-통합>의도 잠금: 개념·관계·실무 통합<a hidden class=anchor aria-hidden=true href=#의도-잠금-개념관계실무-통합>#</a></h3><p>의도 잠금은 &ldquo;<strong>아래에서 어떤 락을 잡을지</strong>&rdquo; 를 위에 먼저 알려, <strong>빠르고 안전하게</strong> 동시성을 높이는 기술.</p><ul><li>상위에 <strong>IS/IX/SIX</strong>를 켜고 → 하위에 <strong>S/X</strong>를 잡는다 → 표 (호환성) 로 허용/충돌을 즉시 판단 → 끝나면 한꺼번에 해제.</li><li>단건 갱신은 <strong>IX+X</strong>, 대규모 스캔은 <strong>IS+S(또는 범위락)</strong>, 스키마 변경은 <strong>강한 상위 락</strong>. 병목은 <strong>관측→임계 조정</strong>으로 푼다.</li></ul><h4 id=의도-잠금-핵심-개념>의도 잠금 핵심 개념<a hidden class=anchor aria-hidden=true href=#의도-잠금-핵심-개념>#</a></h4><table><thead><tr><th>개념 (한글·약어)</th><th>정의</th><th>왜 중요한가</th><th>핵심 규칙/포인트</th><th>대표 상황</th></tr></thead><tbody><tr><td>의도공유잠금 (IS)</td><td>하위에서 S 를 잡을 의도</td><td>상위에서 빠른 판정</td><td>IS 는 IS/IX/S/SIX 와 주로 호환</td><td>읽기 전용 스캔 시작</td></tr><tr><td>의도배타잠금 (IX)</td><td>하위에서 X(또는 갱신) 의도</td><td>충돌 국소화·업데이트 준비</td><td>IX 는 S/SIX/X 와 충돌, IS/IX 와 호환</td><td>OLTP 단건 업데이트</td></tr><tr><td>공유 + 의도배타 (SIX)</td><td>상위 S+ 하위 일부 X</td><td>대량 읽기 + 부분 수정</td><td>대부분과 충돌 (강한 보호)</td><td>보고서 + 부분 갱신</td></tr><tr><td>호환성 매트릭스</td><td>모드 간 공존 표</td><td>즉시 Grant/Wait 판정</td><td>" 요청×보유 " 전원 호환 시 부여</td><td>모든 요청 공정 처리</td></tr><tr><td>2 단계잠금 (2PL)</td><td>확장→수축 규율</td><td>직렬 가능 충분조건</td><td>축소기 진입 후 신규 획득 금지</td><td>트랜잭션 전반 규율</td></tr><tr><td>락 변환/에스컬레이션</td><td>S→X, 하위→상위 승격</td><td>메모리·메타락 절감</td><td>동시성 손실·데드락 주의</td><td>대량 행 갱신</td></tr><tr><td>범위/프레디케이트/넥스트 - 키</td><td>범위 단위 보호</td><td>팬텀 차단·직렬화</td><td>필요한 구간에만 사용</td><td>고정밀 집계·검증 쿼리</td></tr><tr><td>데드락/기아</td><td>순환 대기/우선순위 불균형</td><td>가용성·SLO 보호</td><td>탐지·예방·타임아웃·순서고정</td><td>고경합 트래픽</td></tr></tbody></table><p>IS/IX/SIX 는 <strong>신호</strong>, S/X 는 <strong>실행</strong>이다. 매트릭스가 즉시 판정을, 2PL 이 시간 규율을, 범위락이 팬텀 방지를 담당한다. 에스컬레이션과 업그레이드는 <strong>효율 vs 동시성</strong>의 교환이다.</p><h4 id=의도-잠금-상호관계-매핑표>의도 잠금 상호관계 매핑표<a hidden class=anchor aria-hidden=true href=#의도-잠금-상호관계-매핑표>#</a></h4><table><thead><tr><th>From → To</th><th>관계/방향성</th><th>목적 (무엇을 위해)</th><th>효과 (어떤 결과)</th><th>비고</th></tr></thead><tbody><tr><td>의도잠금 → 호환성 매트릭스</td><td>" 신호→판단 "</td><td>상위 단계 즉시 충돌 판정</td><td>불필요 탐색 감소·대기 단축</td><td>IS/IX/SIX 가 선행</td></tr><tr><td>의도잠금 → 2PL</td><td>" 획득 규율 "</td><td>상→하 순서로 안전 확장</td><td>업그레이드 충돌 감소</td><td>확장기 준수</td></tr><tr><td>의도잠금 ↔ 에스컬레이션</td><td>" 승격 보호 "</td><td>승격 시 안전성 확보</td><td>예측 가능 튜닝</td><td>임계 기반</td></tr><tr><td>범위잠금 ↔ 의도잠금</td><td>" 정밀 적용 "</td><td>팬텀 방지 대상 한정</td><td>차단 최소화</td><td>인덱스와 결합</td></tr><tr><td>업그레이드 → 데드락</td><td>" 위험 경로 "</td><td>S→X 시 사이클 예방</td><td>순서 고정·분리 설계</td><td>고경합 구간</td></tr><tr><td>관측 (뷰) → 튜닝 (정책)</td><td>" 피드백 루프 "</td><td>병목 식별·임계 조정</td><td>처리량↑·지연↓</td><td>운영 반복</td></tr></tbody></table><p>의도 잠금은 <strong>관계의 허브</strong>다. " 신호→판단→규율→승격→정밀화→관측·튜닝 " 의 루프가 성능과 정합성을 함께 끌어올린다.</p><h4 id=의도-잠금의-실무-적용-맵>의도 잠금의 실무 적용 맵<a hidden class=anchor aria-hidden=true href=#의도-잠금의-실무-적용-맵>#</a></h4><table><thead><tr><th>개념</th><th>무엇 (실체)</th><th>어떻게 (절차/패턴)</th><th>왜 (효과/지표)</th><th>위험/주의</th><th>체크리스트</th></tr></thead><tbody><tr><td>IS</td><td>읽기 의도 신호</td><td>트랜잭션 시작 시 상위에 IS</td><td>대기율↓, 스캔 공존↑</td><td>상위 락 과도 남용 주의</td><td>" 읽기면 IS 먼저?"</td></tr><tr><td>IX</td><td>갱신 의도 신호</td><td>상위 IX 후 행/키 X</td><td>충돌 국소화·응답 안정</td><td>IX↔S 충돌로 스캔 지연</td><td>&ldquo;IX 후 바로 X?&rdquo;</td></tr><tr><td>SIX</td><td>S+ 부분 X</td><td>테이블 S + 일부 X</td><td>리포트 + 부분 수정 최적</td><td>광범위 차단 위험</td><td>" 정말 SIX 가 필요한가?"</td></tr><tr><td>호환 매트릭스</td><td>판정 표</td><td>요청×보유 전원 호환 검사</td><td>즉시 Grant/Wait</td><td>표 불일치 해석 금지</td><td>" 표대로 해석?"</td></tr><tr><td>2PL</td><td>시간 규율</td><td>확장기→축소기</td><td>직렬 가능성·예측성</td><td>축소기 이후 획득 금지</td><td>" 축소기 진입 시점?"</td></tr><tr><td>에스컬레이션</td><td>승격</td><td>임계 초과 시 상위 승격</td><td>메타락/메모리 안정</td><td>동시성 급락</td><td>" 임계값·시간대?"</td></tr><tr><td>범위락</td><td>범위 보호</td><td>키 - 레인지 잠금</td><td>팬텀 0, 정확성↑</td><td>스캔 차단↑</td><td>" 정말 직렬 구간?"</td></tr><tr><td>데드락 관리</td><td>탐지/예방</td><td>순서 고정·타임아웃</td><td>가용성·SLO 보호</td><td>과도 중단/기아</td><td>" 정책 균형?"</td></tr><tr><td>관측/튜닝</td><td>뷰·이벤트·지표</td><td>보유/대기/대기체인 분석</td><td>병목 제거·SLA 준수</td><td>과최적화 경계</td><td>" 지표 세트 정했나?"</td></tr></tbody></table><p>IS/IX/SIX 는 <strong>언제·어디서</strong> 락을 강하게 쓸지 <strong>선언</strong>하게 해준다. 운영은 매트릭스·2PL·에스컬레이션·범위락을 <strong>정책으로 엮고</strong>, 관측으로 <strong>피드백</strong>한다.</p><h4 id=lock-compatibility-matrix>Lock Compatibility Matrix<a hidden class=anchor aria-hidden=true href=#lock-compatibility-matrix>#</a></h4><table><thead><tr><th style=text-align:right></th><th style=text-align:center>IS</th><th style=text-align:center>IX</th><th style=text-align:center>S</th><th style=text-align:center>SIX</th><th style=text-align:center>X</th></tr></thead><tbody><tr><td style=text-align:right><strong>IS</strong></td><td style=text-align:center>✔</td><td style=text-align:center>✔</td><td style=text-align:center>✔</td><td style=text-align:center>✔</td><td style=text-align:center>✘</td></tr><tr><td style=text-align:right><strong>IX</strong></td><td style=text-align:center>✔</td><td style=text-align:center>✔</td><td style=text-align:center>✘</td><td style=text-align:center>✘</td><td style=text-align:center>✘</td></tr><tr><td style=text-align:right><strong>S</strong></td><td style=text-align:center>✔</td><td style=text-align:center>✘</td><td style=text-align:center>✔</td><td style=text-align:center>✘</td><td style=text-align:center>✘</td></tr><tr><td style=text-align:right><strong>SIX</strong></td><td style=text-align:center>✔</td><td style=text-align:center>✘</td><td style=text-align:center>✘</td><td style=text-align:center>✘</td><td style=text-align:center>✘</td></tr><tr><td style=text-align:right><strong>X</strong></td><td style=text-align:center>✘</td><td style=text-align:center>✘</td><td style=text-align:center>✘</td><td style=text-align:center>✘</td><td style=text-align:center>✘</td></tr></tbody></table><blockquote><p><strong>핵심 기억법</strong><br>X=올금지, SIX=IS 만 허용, S=IS/S 만, IX=IS/IX 만, IS=거의 다 허용 (단 X 제외)</p></blockquote><h3 id=기초-조사-및-개념-정립>기초 조사 및 개념 정립<a hidden class=anchor aria-hidden=true href=#기초-조사-및-개념-정립>#</a></h3><h4 id=의도-락을-이해하기-위한-최소-단위>의도 락을 이해하기 위한 최소 단위<a hidden class=anchor aria-hidden=true href=#의도-락을-이해하기-위한-최소-단위>#</a></h4><p>의도 락은 " 이 테이블 안쪽에서 이런 종류의 락을 곧 쓸 거야 " 를 미리 알리는 신호다. 그래서 락 관리자는 굳이 모든 행을 살피지 않고도 충돌 여부를 빨리 판단한다.<br>작업 순서는 항상 상위부터 (예: 테이블에 IS/IX/SIX) 잠그고, 그다음 하위 (행) 에 S/X 를 건다.<br>많은 읽기와 일부 쓰기가 섞이면 테이블에 SIX 를, 실제 수정할 행에 X 를 걸어 불필요한 대기와 교착을 줄인다.</p><h5 id=의도-락의-개념과-동작-핵심>의도 락의 개념과 동작 핵심<a hidden class=anchor aria-hidden=true href=#의도-락의-개념과-동작-핵심>#</a></h5><ul><li>정의: 의도 모드 (Intent Modes, IS/IX/SIX) 는 다단계 락킹에서 트랜잭션이 하위 객체 (페이지·행 등) 에 S/X 를 걸기 전에 상위 객체 (테이블·파티션 등) 에 그 의도를 미리 표시하는 락이다.</li><li>목적: 상위 수준에서의 빠른 호환성 판정과 충돌 차단, 락 에스컬레이션의 안전한 경로 확보, 대규모 동시성에서의 탐색 비용 절감.</li><li>동작 원리<ol><li>획득 순서: 부모 (상위) → 자식 (하위).</li><li>호환성: 상위의 IS·IX·SIX 와 기존 락의 조합을 매트릭스 기준으로 평가해 하위 락 시도를 허/불허.</li><li>결합: 2PL 과 결합해 직렬가능성을 보장하고, 필요 시 키 - 범위/스냅샷 등과 함께 범위 일관성 보강.</li></ol></li><li>SIX 포인트: 테이블 수준 대량 읽기 (S) 와 일부 행 갱신 (X) 을 병행해야 할 때, 상위는 SIX, 하위는 X 로 충돌을 최소화한다.</li></ul><h5 id=의도-모드의-구조-규칙-효용>의도 모드의 구조, 규칙, 효용<a hidden class=anchor aria-hidden=true href=#의도-모드의-구조-규칙-효용>#</a></h5><ul><li>구조<ul><li>계층: 데이터베이스/스키마 → 테이블/파티션 → 페이지 → 행 (→ 인덱스 키)</li><li>유형: IS(하위 S 의도), IX(하위 X 의도), SIX(상위 S + 하위 X 의도)</li></ul></li><li>규칙<ul><li>획득: 상위 의도 → 하위 실제 (S/X) 순서 고정</li><li>호환: IS 는 대체로 S 와, IX 는 상위 X·S 와 충돌 가능, SIX 는 상위 공유 허용 범위 내에서 하위 배타 의도를 공표</li><li>에스컬레이션: 미세 락이 많아지면 상위로 승격되며, 의도 락이 이 경로를 안전하게 만든다</li></ul></li><li>효용<ul><li>탐색 비용 절감: 상위에서 빠르게 " 여기 아래쪽에 X 를 쓰려는 중인지 " 확인 가능</li><li>동시성 향상: 허용되는 조합을 늘리고 불필요한 전역 잠금을 피함</li><li>직렬성 기반: 2PL 과 결합 시 직렬가능성을 확보하며, 범위 정확성은 키 - 범위/스냅샷으로 보강</li></ul></li></ul><h4 id=의도-락의-탄생과-현대적-진화>의도 락의 탄생과 현대적 진화<a hidden class=anchor aria-hidden=true href=#의도-락의-탄생과-현대적-진화>#</a></h4><p>Intent Modes 는 <strong>계층형 데이터 자원</strong>(테이블→페이지→행) 에서 &ldquo;<strong>아래에서 S/X 를 잡을 예정</strong>&rdquo; 이라는 ** 의도 (IS/IX/SIX)** 를 상위에 미리 표시해 <strong>충돌을 즉시 식별</strong>하게 만든다. 이렇게 하면 테이블 전수락으로 <strong>동시성이 떨어지는 문제</strong>와, 행 단위로만 관리해 <strong>락 수·탐색 비용이 커지는 문제</strong>를 동시에 줄인다. 이후 상용 DB 는 <strong>락 에스컬레이션·큐 공정성</strong>을 더해 운영성을 높였고, <strong>MVCC</strong>와 결합해 <strong>읽기는 버전</strong>, <strong>쓰기는 Intent+ 락</strong>으로 <strong>정합성과 처리량</strong>을 함께 얻는다. 최신 엔진은 <strong>키 - 범위/넥스트키/U 락</strong>을 더해 <strong>팬텀 방지·교착 완화</strong>까지 노린다.</p><h5 id=등장-배경>등장 배경<a hidden class=anchor aria-hidden=true href=#등장-배경>#</a></h5><ul><li>대형 다중 사용자 시스템에서 <strong>SG 락의 병목</strong>과 <strong>행락의 오버헤드</strong>가 동시에 문제였다.</li><li><strong>두 극단의 비용 문제</strong><ul><li><strong>거친 세밀도 (테이블락)</strong>: 경합·대기 확대로 <strong>처리량 급감</strong>.</li><li><strong>세밀한 세밀도 (행락)</strong>: 락 수·탐색 비용·메모리·교착 빈도 <strong>폭증</strong>.</li></ul></li><li><strong>핵심 아이디어</strong>: 상위 (테이블/페이지) 에서 <strong>IS/IX/SIX</strong>로 **" 하위에서 S/X 를 잡을 의도 &ldquo;**를 표기해, 상위 수준에서 <strong>즉시 충돌 여부</strong>를 판단하고 불필요한 탐색을 차단.</li><li>그 결과, <strong>스캔·DDL·OLTP</strong>가 공존하는 환경에서도 <strong>예측가능성</strong>과 <strong>처리량</strong>을 확보할 수 있었다.</li></ul><h5 id=발전-과정>발전 과정<a hidden class=anchor aria-hidden=true href=#발전-과정>#</a></h5><ol><li><strong>다중 그레뉼러리티 이론 제시 (1970s 중반)</strong><ul><li>등장 이유: SG 의 <strong>과도한 경합·탐색 비용</strong> 해결.</li><li>개선점: **의도 신호 (IS/IX/SIX)**로 상위에서 <strong>빠른 충돌 판정</strong>·탐색 회피.</li></ul></li><li><strong>상용 DB 채택 (1980s–1990s)</strong><ul><li>등장 이유: 대형 OLTP 확산, <strong>락 메모리와 대기 관리</strong> 필요.</li><li>개선점: <strong>에스컬레이션 정책</strong>·락 큐 공정성·모니터링 도입으로 <strong>운영 안정성</strong> 향상.</li></ul></li><li><strong>MVCC 확산과 하이브리드 (2000s)</strong><ul><li>등장 이유: 읽기 병렬성 극대화 요구.</li><li>개선점: <strong>읽기=버전</strong>, <strong>쓰기/DDL/범위=Intent+ 락</strong>으로 <strong>정합성과 처리량 균형</strong>.</li></ul></li><li><strong>범위·업데이트 락 등 현대 확장 (2010s–현재)</strong><ul><li>등장 이유: <strong>팬텀 방지·변환 교착 완화</strong> 요구.</li><li>개선점: <strong>키 - 범위/넥스트키/U 락</strong> 등으로 <strong>직렬가능성</strong>과 <strong>교착 감소</strong> 동시 달성.</li></ul></li></ol><table><thead><tr><th>단계</th><th>시기</th><th>왜 등장했는가</th><th>어떤 개선이 이뤄졌나</th><th>남은 과제</th></tr></thead><tbody><tr><td>이론 제안</td><td>1970s 중반</td><td>SG 병목·행락 오버헤드</td><td>IS/IX/SIX 로 상위에서 빠른 충돌 판정</td><td>규칙 설계·튜닝 필요</td></tr><tr><td>상용화</td><td>1980s–1990s</td><td>대규모 OLTP 운영성 요구</td><td>에스컬레이션·락 큐 공정성·모니터링</td><td>승격 임계·공정성 트레이드오프</td></tr><tr><td>MVCC 결합</td><td>2000s</td><td>읽기 병렬성 확대</td><td>읽기=버전, 쓰기=Intent+ 락 하이브리드</td><td>버전 GC·쓰기 경합 관리</td></tr><tr><td>현대 확장</td><td>2010s–현재</td><td>직렬가능성·교착 완화</td><td>키 - 범위/넥스트키/U 락 도입</td><td>비용·복잡도 관리</td></tr></tbody></table><pre class=mermaid>timeline
  title Intent Modes 발전 연대표
  1970s 중반 : 다중 그레뉼러리티 락 이론 제시(IS/IX/SIX)
  1980s–1990s : 상용 DB 채택 · 에스컬레이션/모니터링 도입
  2000s : MVCC 확산 · 읽기-쓰기 하이브리드 정착
  2010s–현재 : 키-범위/넥스트키/U 락 등 확장 · 교착 완화
</pre><p>Intent Modes 는 <strong>SG 병목 vs 행락 오버헤드</strong>의 딜레마를 <strong>상위 의도 신호</strong>로 해소하고, 상용화 과정에서 <strong>운영 안정성</strong>, MVCC 결합으로 <strong>읽기 병렬성</strong>, 현대 확장으로 <strong>직렬가능성·교착 완화</strong>까지 확보했다.</p><h4 id=의도-모드로-여는-동시성안정성의-균형>의도 모드로 여는 동시성·안정성의 균형<a hidden class=anchor aria-hidden=true href=#의도-모드로-여는-동시성안정성의-균형>#</a></h4><p>의도 모드는 " 행/페이지 같은 하위 자원에 S/X 락을 걸 계획 " 을 테이블 같은 상위 자원에 미리 표시하는 장치다.<br>덕분에 엔진은 하위 전체를 훑지 않고도 상위에서 허용/대기를 즉시 판단한다.<br>읽기는 함께, 갱신은 충돌 시 조기 차단하도록 유도해 처리량을 높이고, 락 획득 순서를 규율해 교착 가능성을 낮춘다.<br>다량의 미세 락은 상위 락으로 승격해 운영 비용을 제어한다.</p><h5 id=의도-모드가-푸는-핵심-문제>의도 모드가 푸는 핵심 문제<a hidden class=anchor aria-hidden=true href=#의도-모드가-푸는-핵심-문제>#</a></h5><table><thead><tr><th>문제</th><th>기존 한계</th><th>의도 모드의 개선 방식</th><th>기대 효과</th><th>관찰 지표</th></tr></thead><tbody><tr><td>비싼 충돌 검사</td><td>하위 전수 검사 필요</td><td>상위 IS/IX/SIX 로 즉시 판정</td><td>판정 비용·지연 감소</td><td>평균 대기시간, 대기 큐 길이</td></tr><tr><td>동시성 저하</td><td>읽기/갱신 혼재 시 경합↑</td><td>S 허용, IX 로 갱신 충돌 조기 신호</td><td>처리량 증가, P95 지연 감소</td><td>TPS/QPS, P95/P99 latency</td></tr><tr><td>교착상태</td><td>불규칙 락 순서</td><td>상→하 획득 규율화</td><td>교착 빈도 감소</td><td>데드락 수, 타임아웃 수</td></tr><tr><td>메타데이터 폭주</td><td>락 수·메모리 증가</td><td>에스컬레이션 연동</td><td>메모리·락 수 안정화</td><td>락 수, 메모리 사용량</td></tr><tr><td>DDL 충돌</td><td>늦은 충돌 발견</td><td>상위에서 호환성 즉시 노출</td><td>배포/운영 리스크 감소</td><td>실패/롤백 건수, 변경창 지연</td></tr></tbody></table><p>의도 모드는 상위에서의 즉시 판정과 획득 순서 정규화로 경합·교착·오버헤드를 동시에 줄이고, 에스컬레이션과 결합해 운영 비용을 예측 가능하게 만든다.</p><h5 id=의도-모드의-핵심-목적-일람>의도 모드의 핵심 목적 일람<a hidden class=anchor aria-hidden=true href=#의도-모드의-핵심-목적-일람>#</a></h5><ul><li>상위 노드에서 하위 잠금 의도를 명시해 충돌을 빠르게 판정</li><li>대규모 동시성 환경에서 성능과 일관성의 균형 확보</li><li>잠금 순서의 규율화로 교착 확률과 대기 시간을 낮춤</li><li>에스컬레이션과 연동해 자원 사용량을 예측 가능하게 관리</li><li>DDL·OLTP·분석 쿼리의 공존 시 시스템 안정성 제고</li></ul><table><thead><tr><th>목적</th><th>정의</th><th>구현 포인트</th><th>성공 기준</th></tr></thead><tbody><tr><td>빠른 충돌 판정</td><td>하위 잠금 의도의 상위 표기</td><td>IS/IX/SIX 호환성 표</td><td>대기율·판정시간 감소</td></tr><tr><td>동시성·일관성 균형</td><td>읽기 병행·갱신 고립</td><td>S↔S 허용, IX 충돌 차단</td><td>TPS↑, 오류·팬텀 0 에 근접</td></tr><tr><td>교착 위험 축소</td><td>락 순서 정규화</td><td>상→하 획득, 동일 순서 준수</td><td>데드락/타임아웃↓</td></tr><tr><td>자원 사용 제어</td><td>락 수·메모리 안정화</td><td>에스컬레이션 임계치 설계</td><td>락 수·메모리 변동폭↓</td></tr><tr><td>운영 안정성</td><td>DDL/OLTP 공존</td><td>상위 호환성 즉시 노출</td><td>배포 실패·롤백 건수↓</td></tr></tbody></table><p>목적은 성능·안정·예측 가능성의 동시 달성이다. 구현 포인트는 IS/IX/SIX 운용 규칙과 에스컬레이션·획득 순서 설계다.</p><h5 id=문제와-목적의-11-연결-맵>문제와 목적의 1:1 연결 맵<a hidden class=anchor aria-hidden=true href=#문제와-목적의-11-연결-맵>#</a></h5><table><thead><tr><th>해결하는 문제</th><th>대응 목적</th><th>연결 고리 (메커니즘)</th></tr></thead><tbody><tr><td>비싼 충돌 검사</td><td>빠른 충돌 판정</td><td>상위 의도 신호와 호환성 표</td></tr><tr><td>동시성 저하</td><td>동시성·일관성 균형</td><td>S 허용, IX 로 갱신 충돌 차단</td></tr><tr><td>교착상태</td><td>교착 위험 축소</td><td>상→하 획득, 동일 순서 규율</td></tr><tr><td>메타데이터 폭주</td><td>자원 사용 제어</td><td>에스컬레이션 임계·정책</td></tr><tr><td>DDL 충돌</td><td>운영 안정성</td><td>상위에서 호환성 즉시 노출</td></tr></tbody></table><p>각 문제는 하나의 목적과 직결되며, 의도 신호·획득 순서·에스컬레이션이 연결 축을 이룬다.</p><h4 id=intent-modes-의-필수-전제와-운영조건>Intent Modes 의 필수 전제와 운영조건<a hidden class=anchor aria-hidden=true href=#intent-modes-의-필수-전제와-운영조건>#</a></h4><p>Intent Modes 가 제대로 작동하려면 <strong>위계적 자원 구조</strong>가 먼저 있어야 한다. 트랜잭션은 하위 락 (S/X) 을 잡기 전에 상위에 <strong>IS/IX/SIX</strong>로 " 잠글 계획 " 을 알리고, 엔진은 <strong>락 호환성 매트릭스</strong>로 즉시 허용/대기를 판정한다. 이를 위해 내부에는 빠른 <strong>Lock Manager</strong>(메모리 락 테이블, 해시/트리 인덱스, 대기열, 데드락 탐지) 가 필요하고, 외부에는 <strong>관측 도구</strong>와 <strong>알림/테스트 체계</strong>가 필요하다. 순수 S/X 또는 MVCC 만으로는 계층 신호가 부족하므로, Intent Modes 는 <strong>상·하위 일관성</strong>과 <strong>대규모 OLTP 의 예측 가능한 성능</strong>을 위한 필수 전제다.</p><h5 id=intent-modes-전제와-요구-핵심>Intent Modes 전제와 요구 핵심<a hidden class=anchor aria-hidden=true href=#intent-modes-전제와-요구-핵심>#</a></h5><h6 id=기술적-전제-조건>기술적 전제 조건<a hidden class=anchor aria-hidden=true href=#기술적-전제-조건>#</a></h6><ol><li><p><strong>계층적 자원 모델 (테이블→페이지→행)</strong></p><ul><li><strong>근거</strong>: 의도락은 " 상위에 신호, 하위에 실제 잠금 " 구조를 전제.</li><li><strong>차별점</strong>: 단일 그라뉼러리티 (테이블 전용 잠금) 대비 충돌 표면을 더 미세하게 분산.</li></ul></li><li><p><strong>의도 락 모드 집합과 호환성 매트릭스 완비</strong></p><ul><li><strong>근거</strong>: IS/IX/SIX 가 있어야 상위에서 빠른 충돌 배제가 가능 (결정표 기반 O(1) 판정).</li><li><strong>차별점</strong>: 순수 S/X 체계만으로는 상·하위 레벨 일관 신호가 부족.</li></ul></li><li><p><strong>고성능 Lock Manager 와 메모리 락 테이블</strong></p><ul><li><strong>근거</strong>: (자원, 모드, 트랜잭션) 기준의 빠른 조회/삽입/갱신·대기열 관리 필요.</li><li><strong>차별점</strong>: 느린 카탈로그/디스크 접근 기반 관리 대비 대기·경합 급증 억제.</li></ul></li><li><p><strong>격리수준·2PL 연동</strong></p><ul><li><strong>근거</strong>: 매트릭스는 " 부여 규칙 &ldquo;, 직렬가능성은 2PL 등 프로토콜로 달성.</li><li><strong>차별점</strong>: 낙관적 CC/MVCC 는 읽기 - 쓰기 충돌 완화에 강점이나, 계층 신호·DDL 보호는 별개.</li></ul></li><li><p><strong>데드락 탐지/회피·타임아웃</strong></p><ul><li><strong>근거</strong>: 의도락 존재 여부와 무관하게 대기 그래프 순환은 발생 가능.</li><li><strong>차별점</strong>: 단순 테이블락 환경보다 그래프가 커져 탐지 필요성↑.</li></ul></li><li><p><strong>관측·진단 인터페이스</strong></p><ul><li><strong>근거</strong>: 호환 실패 원인·리드 블로커 확인이 실무 필수.</li><li><strong>차별점</strong>: 블랙박스형 엔진은 튜닝/장애 대응 난이도↑.</li></ul></li></ol><h6 id=시스템운영-요구사항>시스템/운영 요구사항<a hidden class=anchor aria-hidden=true href=#시스템운영-요구사항>#</a></h6><ol><li><p><strong>빠른 해시/트리 인덱스 기반 락 조회</strong></p><ul><li><strong>근거</strong>: 대기/부여 결정이 트랜잭션 지연의 주된 상수항.</li><li><strong>차별점</strong>: 선형 스캔 구조는 고동시성에서 병목.</li></ul></li><li><p><strong>락 에스컬레이션/디에스컬레이션 정책</strong></p><ul><li><strong>근거</strong>: 락 수·메모리 한도를 넘지 않도록 자동 승격 필요.</li><li><strong>차별점</strong>: 무정책 환경은 광범위 락 남발 또는 메모리 고갈.</li></ul></li><li><p><strong>트랜잭션·배치 설계 지침</strong></p><ul><li><strong>근거</strong>: 짧은 트랜잭션/일관된 락 순서가 교착·대기 완화.</li><li><strong>차별점</strong>: MVCC 단독 사용 대비 쓰기 경합이 높은 OLTP 에 효율적.</li></ul></li><li><p><strong>모니터링·알림·리그레션 테스트</strong></p><ul><li><strong>근거</strong>: 스키마/인덱스 변경은 호환성·범위 충돌 양상을 바꿈.</li><li><strong>차별점</strong>: 사전/사후 테스트 없이는 성능 회귀 리스크 큼.</li></ul></li></ol><h5 id=intent-modes-운영-전제요구-일람>Intent Modes 운영 전제·요구 일람<a hidden class=anchor aria-hidden=true href=#intent-modes-운영-전제요구-일람>#</a></h5><table><thead><tr><th>구분</th><th>항목</th><th>내용/설명</th><th>근거 (원리)</th><th>관련 기술 대비 차이점</th><th>검증 포인트</th></tr></thead><tbody><tr><td>기술 전제</td><td>계층적 자원 모델</td><td>테이블→페이지→행 부모 - 자식 정의</td><td>의도락은 상위 신호·하위 잠금 전제</td><td>단일 그라뉼러리티 대비 충돌 분산</td><td>부모 포인터/식별자 무결성</td></tr><tr><td>기술 전제</td><td>의도락 모드·호환성 표</td><td>IS/IX/SIX(+S/X/NL) 완비</td><td>결정표 기반 O(1) 판정</td><td>S/X 만으론 상하위 신호 부족</td><td>매트릭스 일관성 테스트</td></tr><tr><td>기술 전제</td><td>Lock Manager/메모리 락 테이블</td><td>(자원,모드,TX) 키로 빠른 조회·대기열</td><td>경합 시 상수 지연 최소화</td><td>카탈로그 의존 대비 저지연</td><td>평균/최대 조회 지연</td></tr><tr><td>기술 전제</td><td>격리수준·2PL 연동</td><td>부여 규칙 + 프로토콜 결합</td><td>직렬가능성 보장 경로 확보</td><td>MVCC 단독과 상보</td><td>격리별 충돌/팬텀 시나리오</td></tr><tr><td>운영 요구</td><td>데드락 탐지/타임아웃</td><td>WFG·타임아웃 정책</td><td>순환 대기 해소</td><td>단순 테이블락보다 필수성↑</td><td>탐지 주기·롤백 비율</td></tr><tr><td>운영 요구</td><td>에스컬레이션 정책</td><td>락 수/메모리 한도 관리</td><td>광범위 락 남발 방지</td><td>무정책 대비 안정성↑</td><td>승격 임계·부작용 모니터</td></tr><tr><td>운영 요구</td><td>모니터링/알림</td><td>보유·대기·리드블로커 가시화</td><td>원인→대응 루프 단축</td><td>블랙박스 대비 튜닝 용이</td><td>대기시간·데드락/타임아웃</td></tr><tr><td>운영 요구</td><td>릴리스 전후 테스트</td><td>스키마/인덱스 변경 검증</td><td>범위·호환성 변화 흡수</td><td>사전 테스트 無 대비 리스크↓</td><td>회귀 케이스 통과율</td></tr></tbody></table><p>핵심은 **계층·모드·관리 (전제)**와 **탐지·정책·관측·검증 (운영)**을 함께 갖추는 것. 이 조합이 있어야 Intent Modes 가 성능과 예측 가능성을 동시에 제공한다.</p><h4 id=의도-잠금의-본질-신호판정승격의-조화>의도 잠금의 본질: 신호·판정·승격의 조화<a hidden class=anchor aria-hidden=true href=#의도-잠금의-본질-신호판정승격의-조화>#</a></h4><ul><li><strong>무엇</strong>: IS/IX/SIX 는 " 아래에서 어떤 락을 잡을지 " 를 <strong>위에서 먼저 알리는 신호</strong>다.</li><li><strong>왜</strong>: 상위에서 <strong>한 번의 표 조회</strong>로 충돌 가능성을 즉시 판단하고, 하위 탐색·재시도 비용을 줄인다.</li><li><strong>어떻게</strong>: <strong>상→하</strong> 순서로 의도→실제 (S/X) 락을 잡고, 필요 시 <strong>승격</strong>한다. 업그레이드는 최소화한다.</li><li><strong>실무 감각</strong>: 리드가 많고 소수 갱신이면 <strong>SIX</strong>가 유리, 라이터가 많다면 <strong>IX+ 행 X</strong>가 안전. 팬텀은 <strong>범위락</strong>을 병행한다.</li></ul><h5 id=의도-잠금-작동-원리와-실무-차별점>의도 잠금: 작동 원리와 실무 차별점<a hidden class=anchor aria-hidden=true href=#의도-잠금-작동-원리와-실무-차별점>#</a></h5><h6 id=위계-전파와-o1-판정의-결합>위계 전파와 O(1) 판정의 결합<a hidden class=anchor aria-hidden=true href=#위계-전파와-o1-판정의-결합>#</a></h6><p>의도 락은 조상 노드에 <strong>의도 신호</strong>를 남겨 상위 수준에서 <strong><code>compat[M_req][M_hold]</code></strong> 만 보면 된다.<br>이 상수시간 판정 덕분에 <strong>Grant/Wait</strong> 결정이 단순·빠르며, 하위 노드 전수 검사를 줄인다.<br>동일 그레뉼러리티만 쓰는 방식보다 <strong>탐색·대기 비용</strong>이 체계적으로 낮다.</p><h6 id=승격업그레이드의-안전판>승격·업그레이드의 안전판<a hidden class=anchor aria-hidden=true href=#승격업그레이드의-안전판>#</a></h6><p>다량의 하위 락을 상위 락으로 <strong>에스컬레이션</strong>할 때, 상위에 이미 IS/IX/SIX 가 걸려 있으면 <strong>호환성 판단과 차단 폭</strong>을 예측 가능하게 제어할 수 있다.<br>반대로 의도 락 없이 S→X 업그레이드는 <strong>교착의 단골 경로</strong>가 된다.</p><h6 id=six-의-자리와-한계>SIX 의 자리와 한계<a hidden class=anchor aria-hidden=true href=#six-의-자리와-한계>#</a></h6><p><strong>SIX</strong>는 " 리드 대다수 + 소수 갱신 " 을 한 트랜잭션에서 처리할 때 쓰인다.<br>리더는 공존 (상위 S), 라이터는 직렬화 (하위 일부 X) 되어 <strong>데드락·경합이 줄어</strong> 응답 안정성을 준다.<br>다만 라이터가 다수인 워크로드에선 테이블 수준 차단으로 <strong>병목</strong>이 될 수 있어, <strong>IX+ 행 X</strong>나 <strong>파티션 분리</strong>가 더 낫다.</p><h6 id=범위락과-직렬성-요구-구간>범위락과 직렬성 요구 구간<a hidden class=anchor aria-hidden=true href=#범위락과-직렬성-요구-구간>#</a></h6><p>팬텀은 행 단위 호환성만으로는 잡히지 않는다. <strong>키 - 레인지/넥스트 - 키</strong> 같은 <strong>범위 기반 잠금</strong>으로 직렬성 구간을 보호하되, 의도 락으로 <strong>적용 범위를 상위에서 한정</strong>하여 차단을 최소화한다. MVCC 와 병행 시에도 직렬성이 필요한 구간에선 <strong>범위락</strong>이 결정적이다.</p><h6 id=운영-관측과-표준성>운영 관측과 표준성<a hidden class=anchor aria-hidden=true href=#운영-관측과-표준성>#</a></h6><p>보유/대기/대기체인, 데드락 그래프, 에스컬레이션 카운터 등 <strong>운영 메트릭</strong>이 풍부하다.<br>애플리케이션 락이나 분산 락과 달리 <strong>데이터 무결성과 직접 결합</strong>되어, 장애 재현·원인 분석·튜닝 루프가 <strong>표준화</strong>되어 있다.</p><h5 id=의도-잠금-특징근거차별점-정리>의도 잠금 특징·근거·차별점 정리<a hidden class=anchor aria-hidden=true href=#의도-잠금-특징근거차별점-정리>#</a></h5><table><thead><tr><th>특징</th><th>기술적 근거</th><th>장점</th><th>한계/주의</th><th>다른 기술과의 차별점</th><th>대표 활용</th></tr></thead><tbody><tr><td>위계 전파 (상→하)</td><td>조상 - 자손 의도 신호</td><td>상위에서 즉시 판정, 탐색 감소</td><td>의도 메타데이터 비용</td><td>단일 그레뉼러리티보다 공존성↑</td><td>대부분의 OLTP</td></tr><tr><td>O(1) 호환성 판정</td><td>정적 5×5 매트릭스</td><td>예측 가능·빠른 Grant/Wait</td><td>매트릭스 해석 오류 주의</td><td>규칙 추정보다 단순·일관</td><td>고경합 테이블</td></tr><tr><td>교착 위험 완화</td><td>순서 규율·업그레이드 최소화</td><td>사이클 확률↓</td><td>완전 제거는 아님</td><td>순수 탐지/타임아웃 대비 사전 억제</td><td>장시간 트랜잭션</td></tr><tr><td>에스컬레이션 안전</td><td>상위 IS/IX/SIX 선점</td><td>승격 시 충돌 예측 용이</td><td>동시성 급락 가능</td><td>의도 없음 대비 리스크 낮음</td><td>배치/대량 갱신</td></tr><tr><td>SIX 활용</td><td>S+ 부분 X</td><td>리더 공존·라이터 직렬화</td><td>라이터 많으면 병목</td><td>IX+ 행 X 대비 경합↓(소수 라이터)</td><td>리드 90%+ 워크로드</td></tr><tr><td>범위락 결합</td><td>키 - 레인지/넥스트 - 키</td><td>팬텀 0, 정합성↑</td><td>차단 폭 커질 수 있음</td><td>MVCC 단독 대비 직렬성 보장</td><td>검증·집계 구간</td></tr><tr><td>운영 가시성</td><td>락 테이블/대기 큐/그래프</td><td>튜닝·재현·분석 용이</td><td>과최적화 주의</td><td>앱 락 대비 데이터 일관성 친화</td><td>장애 분석/튜닝</td></tr></tbody></table><ul><li>의도 잠금은 <strong>신호 (상위)</strong> 와 ** 행동 (하위)** 를 분리해 <strong>빠른 판정·안전한 승격·예측 가능한 동시성</strong>을 만든다. 팬텀 구간은 <strong>범위락</strong>으로, 라이터 패턴은 <strong>SIX vs IX+ 행 X</strong>로 분기해 선택한다.</li></ul><h4 id=의도-락으로-만드는-예측-가능한-동시성>의도 락으로 만드는 예측 가능한 동시성<a hidden class=anchor aria-hidden=true href=#의도-락으로-만드는-예측-가능한-동시성>#</a></h4><p>의도 락은 " 이 위계 아래에서 어떤 종류의 잠금을 쓸지 " 를 미리 알리는 표지판이다. 이 표지판 덕분에 락 관리자는 충돌을 위에서 빠르게 판정하고, 실제로 잠글 대상만 하위에서 좁혀 잡는다. 그래서 대량 동시성 환경에서도 불필요한 대기와 전역 배타를 줄이고, 예측 가능한 성능과 일관성을 유지할 수 있다.</p><h5 id=의도-락의-설계-이유와-품질-목표>의도 락의 설계 이유와 품질 목표<a hidden class=anchor aria-hidden=true href=#의도-락의-설계-이유와-품질-목표>#</a></h5><h6 id=왜-필요한가>왜 필요한가<a hidden class=anchor aria-hidden=true href=#왜-필요한가>#</a></h6><ol><li><p>대용량 동시성에서의 탐색 비용 절감</p><ul><li>상위 객체에 의도를 먼저 표기하면, 락 관리자가 하위 자원까지 내려가지 않고도 충돌 가능성을 초기에 걸러 락 테이블 탐색·대기열 조작 비용을 낮춘다.</li></ul></li><li><p>일관된 락 순서로 교착 위험 저감</p><ul><li>상위→하위 획득 순서와 IS/IX/SIX 규칙이 결합되어 순환 대기 조건을 약화시킨다 (탐지·해결은 별도 메커니즘).</li></ul></li><li><p>부분 갱신이 많은 스캔 패턴 최적화</p><ul><li>대량 읽기 + 소량 쓰기 시 SIX(상위 공유 + 하위 배타 의도) 로 불필요한 전역 배타를 피하면서 수정 대상만 X 로 좁힌다.</li></ul></li><li><p>에스컬레이션의 안전한 경로 제공</p><ul><li>미세 락이 폭증할 때 상위로 승격해 리소스를 보호하되, 의도 락이 상위/하위 호환성의 일관성을 보장한다.</li></ul></li></ol><h6 id=무엇을-개선하나>무엇을 개선하나?<a hidden class=anchor aria-hidden=true href=#무엇을-개선하나>#</a></h6><ul><li>성능: 호환성 판정의 탐색 범위를 줄여 평균/상위 백분위 락 대기 시간을 낮춘다.</li><li>일관성: 2PL/격리수준과 결합해 더티/반복불가/팬텀 위험을 통제한다 (범위는 키 - 범위/버전닝 보완).</li><li>확장성: 그라뉼러리티·에스컬레이션 정책과 함께 코어 수·세션 수 증가에 따른 경합 폭주를 흡수.</li><li>신뢰성: 표준화된 락 순서·정책으로 장애·교착 대응의 예측 가능성을 높인다.</li><li>예측 가능성: 호환성 규칙이 명확해 운영 중 튜닝 (쿼리·인덱스·락 정책) 의 효과를 사전에 가늠할 수 있다.</li><li>데드락 방지 관점: " 완전 방지 " 가 아니라 순환 대기 가능성을 낮추는 설계적 억제와 빠른 탐지·피해자 선택을 용이하게 만든다.</li></ul><h5 id=의도-락의-동기와-품질-속성-한눈에>의도 락의 동기와 품질 속성 한눈에<a hidden class=anchor aria-hidden=true href=#의도-락의-동기와-품질-속성-한눈에>#</a></h5><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기대 효과</th><th>운영 포인트</th></tr></thead><tbody><tr><td>설계 동기</td><td>탐색 비용 절감</td><td>상위에서 의도 호환성 판정으로 하위 탐색 최소화</td><td>대기·컨텍스트 스위칭 감소</td><td>락 테이블 인덱싱/통계 튜닝</td></tr><tr><td>설계 동기</td><td>교착 위험 축소</td><td>상위→하위 획득 순서 +IS/IX/SIX 규칙</td><td>데드락 빈도 감소</td><td>대기 그래프/피해자 정책</td></tr><tr><td>설계 동기</td><td>혼합 워크로드 최적화</td><td>SIX 로 대량 S + 부분 X 병행</td><td>처리량 향상·지연 감소</td><td>수정 대상 식별 인덱스</td></tr><tr><td>설계 동기</td><td>에스컬레이션 안전화</td><td>미세 락 폭증 시 상위 승격의 일관성 확보</td><td>메모리 보호·스케일 안정</td><td>임계치/예외 테이블 관리</td></tr><tr><td>품질 속성</td><td>성능</td><td>조기 필터링으로 평균/P95 대기 단축</td><td>TPS/TPM 증가</td><td>쿼리·인덱스·락 정책 합치</td></tr><tr><td>품질 속성</td><td>일관성</td><td>S/X 적용 전 상위 호환성 준수</td><td>데이터 무결성 유지</td><td>격리수준·키 - 범위 결합</td></tr><tr><td>품질 속성</td><td>확장성</td><td>그라뉼러리티·정책으로 경합 폭주 억제</td><td>코어/세션 증가 대응</td><td>샤딩/파티션 전략</td></tr><tr><td>품질 속성</td><td>신뢰성/예측</td><td>규칙 기반 설계로 결과 재현</td><td>장애·튜닝 안정성 향상</td><td>SLO·알림·런북 정비</td></tr><tr><td>품질 속성</td><td>데드락 억제</td><td>순서 고정으로 순환 대기 약화</td><td>중단·롤백 비용 감축</td><td>타임아웃·재시도 설계</td></tr></tbody></table><p>의도 락은 " 상위에서 미리 말하기 " 로 충돌을 조기에 걸러 성능·확장성·예측 가능성을 동시에 끌어올리고, 교착 위험을 구조적으로 낮춘다.</p><h3 id=핵심-원리-및-이론적-기반>핵심 원리 및 이론적 기반<a hidden class=anchor aria-hidden=true href=#핵심-원리-및-이론적-기반>#</a></h3><h4 id=의도-락-원칙철학의-실전-프레임>의도 락: 원칙·철학의 실전 프레임<a hidden class=anchor aria-hidden=true href=#의도-락-원칙철학의-실전-프레임>#</a></h4><p>Intent Modes 는 <strong>상위에서 거르고 하위에서 확정</strong>한다.</p><p>트랜잭션은 먼저 테이블 등 상위 자원에 **의도 락 (IS/IX/SIX)**을 걸어 " 아래에서 S/X 를 쓸 계획 " 을 알린다.<br>엔진은 **호환 표 (LCM)**를 한 번만 조회해 허용/대기/거부를 <strong>즉시</strong> 결정한다.<br>이렇게 하면 테이블 전수락처럼 <strong>동시성이 무너지는 상황</strong>도 줄이고, 행 단위만 보다가 실패하는 <strong>후행 실패</strong>도 사라진다.</p><p>승격/업그레이드는 규율을 두어 <strong>메모리·경합</strong>을 통제하고, 공정한 대기 정책과 관측 지표로 <strong>예측가능한 성능</strong>을 유지한다.</p><h5 id=intent-핵심-원칙-요약표>Intent 핵심 원칙 요약표<a hidden class=anchor aria-hidden=true href=#intent-핵심-원칙-요약표>#</a></h5><table><thead><tr><th>원칙</th><th>설명</th><th>목적</th><th>필요한 이유</th><th>적용 포인트/예시</th></tr></thead><tbody><tr><td>Protocol Ordering</td><td>루트→리프 순서로 잠금</td><td>상위서 조기 차단</td><td>순환 대기·탐색 비용 방지</td><td>테이블→페이지→행 순서 고정</td></tr><tr><td>Intention Declaration</td><td>상위에 IS/IX/SIX 선언</td><td>O(1) 선판정</td><td>DDL·전수락과 즉시 충돌 판정</td><td>테이블 IX 후 행 X</td></tr><tr><td>Compatibility-First</td><td>LCM 먼저 조회</td><td>후행 실패 제거</td><td>하위 탐색·대기 낭비 방지</td><td>요청 시 LCM 체크</td></tr><tr><td>Escalation/Upgrade</td><td>승격·업그레이드 규율</td><td>자원·경합 균형</td><td>무질서 승격의 상위 충돌</td><td>임계치 기반 승격</td></tr><tr><td>Fairness & Ordering</td><td>공정 큐·일관 순서</td><td>예측가능 성능</td><td>기아·지연 폭증 방지</td><td>FIFO+ 우선순위</td></tr><tr><td>Strictness for Recovery</td><td>엄격 2PL 연계</td><td>복구 단순화</td><td>commit 전 X 유지로 안전</td><td>장애 시 롤백 용이</td></tr><tr><td>Observability</td><td>락/대기 가시화</td><td>운영 의사결정</td><td>교착·승격 폭주 조기 탐지</td><td>잠금 뷰·지표 수집</td></tr></tbody></table><p>핵심 원칙은 <strong>상위 선판정·질서·규율·가시성</strong>으로 정리된다. 이 조합이 <strong>동시성·정확성·예측성</strong>을 함께 만든다.</p><h5 id=intent-설계-철학-일람표>Intent 설계 철학 일람표<a hidden class=anchor aria-hidden=true href=#intent-설계-철학-일람표>#</a></h5><table><thead><tr><th>설계 철학</th><th>설명</th><th>목적</th><th>필요한 이유</th><th>실무 지침</th></tr></thead><tbody><tr><td>최소 간섭</td><td>필요한 최소 잠금만</td><td>동시성 극대화</td><td>불필요한 차단은 곧 지연</td><td>단건 쓰기 범위만 잠금</td></tr><tr><td>계층적 질서</td><td>상→하 일관 규칙</td><td>경로 예측성</td><td>무질서가 교착·탐색 유발</td><td>리소스 순서 표준화</td></tr><tr><td>의도 명시</td><td>IS/IX/SIX 신호화</td><td>O(1) 판정</td><td>상위에서 즉시 충돌 감지</td><td>하위 접근 전 의도 잠금</td></tr><tr><td>성능 우선</td><td>빠른 판정·해제</td><td>지연 최소화</td><td>락은 비용 요소</td><td>테이블화/비트셋화</td></tr><tr><td>운영 친화</td><td>모니터링·튜닝 용이</td><td>안정적 운영</td><td>문제 재현·완화 가능</td><td>대기 큐·승격 지표 노출</td></tr></tbody></table><p>설계 철학은 <strong>적게 잠그고, 위에서 갈라내고, 눈에 보이게 운용</strong>하는 데 초점을 둔다.</p><h4 id=인텐트-잠금의-동작과-설계-통찰>인텐트 잠금의 동작과 설계 통찰<a hidden class=anchor aria-hidden=true href=#인텐트-잠금의-동작과-설계-통찰>#</a></h4><ul><li><strong>왜 필요한가?</strong> 상·하위가 연결된 DB 객체 (테이블→페이지→레코드) 에서, " 하위에 실제 락이 있는지 " 를 상위에서 빠르게 알기 위해.</li><li><strong>어떻게 동작하나?</strong> 상위에 <strong>IS/IX/SIX</strong> 같은 " 의도 " 를 먼저 걸고, 그 정보를 보고 <strong>S/X</strong> 실락을 하위에만 최소화해 둔다.</li><li><strong>무엇이 좋아지나?</strong><ul><li><strong>속도</strong>: 상위에서 한 번만 보면 충돌 여부를 즉시 판단.</li><li><strong>안전</strong>: 상위에 X 를 걸어야 하는 작업이, 이미 누군가 하위에 S/X 를 두었는지 빠르게 인지하여 불필요한 스캔/대기 방지.</li><li><strong>효율</strong>: 대량 작업 시 하위 락을 <strong>에스컬레이션</strong>해 관리 비용 감소.</li></ul></li></ul><h5 id=운영-원리>운영 원리<a hidden class=anchor aria-hidden=true href=#운영-원리>#</a></h5><ol><li><strong>의도 선언</strong>: 트랜잭션 T 는 대상 테이블에 <strong>IS/IX/SIX</strong>로 의도를 표시한다.</li><li><strong>호환성 검사</strong>: 락 매니저는 상단 매트릭스로 즉시 충돌 여부 판단 (예: <strong>IX↔S</strong>는 불가).</li><li><strong>실락 부여</strong>: 허용되면 필요한 범위의 <strong>S/X</strong>를 하위 (페이지/레코드) 에만 부여한다.</li><li><strong>작업 수행</strong>: 읽기는 S 기반, 갱신은 X 기반으로 진행.</li><li><strong>에스컬레이션 (선택적)</strong>: 하위 락이 과도하면 상위 (테이블) 로 승격해 락 수를 줄인다.</li><li><strong>해제</strong>: <strong>레코드→페이지→테이블</strong> 순으로 해제한다.</li><li><strong>SIX 의 활용</strong>: 전체를 읽으면서 (<strong>S</strong>) 일부만 갱신 (<strong>하위 X</strong>) 하는 혼합 워크로드를 한 트랜잭션에서 안전하게 처리.</li></ol><h6 id=인텐트-모드-동작-과정-예시-ix>인텐트 모드 동작 과정 예시 (IX)<a hidden class=anchor aria-hidden=true href=#인텐트-모드-동작-과정-예시-ix>#</a></h6><pre class=mermaid>sequenceDiagram
    participant T as Transaction
    participant LM as Lock Manager
    participant DB as Database
    participant TB as Table
    participant PG as Page
    participant RC as Record
    
    T-&gt;&gt;LM: Request IX on Database
    LM-&gt;&gt;DB: Grant IX Lock
    T-&gt;&gt;LM: Request IX on Table
    LM-&gt;&gt;TB: Grant IX Lock  
    T-&gt;&gt;LM: Request X on Record
    LM-&gt;&gt;RC: Grant X Lock
    T-&gt;&gt;RC: Update Record
    T-&gt;&gt;LM: Release X on Record
    T-&gt;&gt;LM: Release IX on Table
    T-&gt;&gt;LM: Release IX on Database
</pre><p><strong>주요 단계</strong>:</p><ol><li><strong>의도 선언</strong>: 상위 레벨에 인텐트 잠금 요청</li><li><strong>호환성 검사</strong>: 기존 잠금과의 충돌 여부 확인</li><li><strong>잠금 획득</strong>: 호환 가능시 잠금 부여</li><li><strong>실제 작업</strong>: 하위 레벨에서 데이터 조작</li><li><strong>잠금 해제</strong>: 하위에서 상위 순으로 해제</li></ol><h5 id=핵심-메커니즘>핵심 메커니즘<a hidden class=anchor aria-hidden=true href=#핵심-메커니즘>#</a></h5><p><strong>호환성 (테이블 레벨)</strong>:</p><table><thead><tr><th>보유 \ 요청</th><th style=text-align:right>IS</th><th style=text-align:right>IX</th><th style=text-align:right>S</th><th style=text-align:right>SIX</th><th style=text-align:right>X</th></tr></thead><tbody><tr><td><strong>IS</strong></td><td style=text-align:right>✓</td><td style=text-align:right>✓</td><td style=text-align:right>✓</td><td style=text-align:right>✓</td><td style=text-align:right>✗</td></tr><tr><td><strong>IX</strong></td><td style=text-align:right>✓</td><td style=text-align:right>✓</td><td style=text-align:right>✗</td><td style=text-align:right>✗</td><td style=text-align:right>✗</td></tr><tr><td><strong>S</strong></td><td style=text-align:right>✓</td><td style=text-align:right>✗</td><td style=text-align:right>✓</td><td style=text-align:right>✗</td><td style=text-align:right>✗</td></tr><tr><td><strong>SIX</strong></td><td style=text-align:right>✓</td><td style=text-align:right>✗</td><td style=text-align:right>✗</td><td style=text-align:right>✗</td><td style=text-align:right>✗</td></tr><tr><td><strong>X</strong></td><td style=text-align:right>✗</td><td style=text-align:right>✗</td><td style=text-align:right>✗</td><td style=text-align:right>✗</td><td style=text-align:right>✗</td></tr></tbody></table><p><strong>선행 요건 (부모 락)</strong>:</p><ul><li>하위에 <strong>S/IS</strong>를 두려면 부모에 <strong>IS/IX</strong>.</li><li>하위에 <strong>X/IX/SIX</strong>를 두려면 부모에 <strong>IX/SIX</strong>.</li><li>락은 <strong>상위→하위</strong>로만 취득, <strong>하위→상위</strong>로만 해제.</li></ul><h5 id=인텐트-잠금-모드호환성-한눈표>인텐트 잠금 모드·호환성 한눈표<a hidden class=anchor aria-hidden=true href=#인텐트-잠금-모드호환성-한눈표>#</a></h5><table><thead><tr><th>구분</th><th>의미</th><th>주 사용 시나리오</th><th>부모 필요 잠금</th><th>대표 비호환</th></tr></thead><tbody><tr><td><strong>IS</strong></td><td>하위에 S 예정</td><td>범용 읽기</td><td>(상위) IS/IX</td><td>X</td></tr><tr><td><strong>IX</strong></td><td>하위에 X 예정</td><td>선택적 갱신</td><td>(상위) IX/SIX</td><td>S, SIX, X</td></tr><tr><td><strong>SIX</strong></td><td>상위 S + 일부 하위 X</td><td>대량 읽기 + 부분 갱신</td><td>(상위) SIX</td><td>IS 외 전부</td></tr><tr><td><strong>S</strong></td><td>공유 읽기</td><td>테이블 단위 읽기</td><td>(부모) IS/IX</td><td>IX, SIX, X</td></tr><tr><td><strong>X</strong></td><td>배타 갱신</td><td>테이블 전량 갱신</td><td>(부모) IX/SIX</td><td>전부</td></tr></tbody></table><ul><li>**IS/IX 는 &rsquo; 신호 &lsquo;**이므로 대부분 서로 양립하지만, <strong>상위 전체를 배타적으로 쓰려는 X</strong>와는 충돌.</li><li><strong>SIX</strong>는 상위 S 로 <strong>읽기 동시성</strong>을 최대한 유지하면서, <strong>필요한 하위만 X</strong>로 보호하는 절충.</li><li><strong>부모 선행 요건</strong>을 지키면, 상위에서 <strong>빠른 거부/허용 결정</strong>이 가능해 <strong>대기·교착</strong>을 줄인다.</li></ul><h5 id=인텐트-잠금-처리-플로우>인텐트 잠금 처리 플로우<a hidden class=anchor aria-hidden=true href=#인텐트-잠금-처리-플로우>#</a></h5><pre class=mermaid>flowchart TD
  A[트랜잭션 시작] --&gt; B[&#34;상위 객체에 Intent 요청(IS/IX/SIX)&#34;]
  B --&gt; C{호환성 검사}
  C --&gt;|허용| D[하위에 실제 S/X 락 획득]
  C --&gt;|거부| E{대기 가능?}
  E --&gt;|예| F[대기 큐 진입] --&gt; G{데드락 감지?}
  G --&gt;|예| H[롤백 및 재시도/중단]
  G --&gt;|아니오| C
  E --&gt;|아니오| H
  D --&gt; I{&#34;하위 락 과도? (에스컬레이션)&#34;}
  I --&gt;|예| J[상위 락으로 승격 시도] --&gt; C
  I --&gt;|아니오| K[&#34;업무 로직 수행(읽기/갱신)&#34;]
  K --&gt; L[&#34;락 해제(하위→상위)&#34;]
  L --&gt; M[트랜잭션 종료]
</pre><ul><li><strong>의도→호환성→실락</strong>의 3 단 구성이 핵심이며, <strong>충돌 시 빠른 거부/대기 처리</strong>로 불필요한 탐색을 최소화한다.</li><li><strong>에스컬레이션</strong>은 관리 오버헤드를 줄이고, <strong>데드락 감지</strong>는 장기 대기를 방지한다.</li><li><strong>해제 순서</strong>(하위→상위) 를 지켜 상위 보호 의미를 깨지 않도록 한다.</li></ul><h4 id=isixsix-의미와-상위하위-획득-순서>IS/IX/SIX 의미와 상위→하위 획득 순서<a hidden class=anchor aria-hidden=true href=#isixsix-의미와-상위하위-획득-순서>#</a></h4><ul><li>IS(Intent Shared): " 아래에서 S(읽기) 쓸 거야.&rdquo;</li><li>IX(Intent Exclusive): " 아래에서 X(쓰기) 쓸 거야.&rdquo;</li><li>SIX(Shared + Intent Exclusive): " 위에서는 S 로 넓게 읽고, 아래에서 일부만 X 로 바꿀 거야."</li><li>규칙: <strong>항상 상위 (테이블/파티션) → 하위 (페이지/행/키) 순서로 의도 락 → 실제 락 (S/X)</strong></li></ul><h5 id=왜-의도-락을-먼저-거나>왜 의도 락을 먼저 거나?<a hidden class=anchor aria-hidden=true href=#왜-의도-락을-먼저-거나>#</a></h5><ul><li>상위에서 <strong>의사표시만</strong> 해도, 락 관리자가 <strong>충돌 가능성</strong>을 빠르게 판정 → 불필요한 하위 탐색/대기 감소</li><li>모든 트랜잭션이 <strong>같은 순서 (부모→자식)</strong> 로 잡으므로 <strong>순환대기 (교착) 위험</strong>이 낮아짐</li><li>에스컬레이션 (행→페이지→테이블 승격) 시 <strong>정합성·안전성</strong>을 보장</li></ul><h5 id=각-모드의-의미사용-시점>각 모드의 의미·사용 시점<a hidden class=anchor aria-hidden=true href=#각-모드의-의미사용-시점>#</a></h5><ul><li><p>IS: 읽기 위주. " 이 테이블 아래에서 S 를 여러 개 둘 수도 있어요."</p><ul><li>예: 조회 1,000 건 (갱신 없음)—테이블 IS → 행 S 반복</li></ul></li><li><p>IX: 쓰기 예정. " 이 테이블 아래에서 X 가 나옵니다."</p><ul><li>예: 특정 주문 10 건 상태 업데이트—테이블 IX → 해당 행 X</li></ul></li><li><p>SIX: 넓게 읽으면서 일부만 갱신. " 위는 S, 아래는 부분 X."</p><ul><li>예: 재고 스캔하며 threshold 미만 상품만 상태 변경—테이블 SIX → 조건 만족 행 X 들</li></ul></li></ul><p>팁: <strong>SIX 는 &rsquo; 스캔 + 부분 갱신 &rsquo; 에 특화</strong>. 상위 충돌 가능성이 있으니 남발하지 말고 <strong>명확한 패턴</strong>에서만 사용.</p><h5 id=상위하위-획득-순서-알고리즘>상위→하위 획득 순서 (알고리즘)<a hidden class=anchor aria-hidden=true href=#상위하위-획득-순서-알고리즘>#</a></h5><ol><li>대상 계층을 위에서 아래로 나눈다: 데이터베이스/스키마 → 테이블/파티션 → 페이지 → 행 (→ 인덱스 키)</li><li>트랜잭션 의도를 결정한다: 읽기만 (S) / 쓰기 (X) / 스캔 + 부분 갱신 (S + 일부 X)</li><li>상위 노드에 의도 락을 건다:<ul><li>읽기: <strong>IS</strong></li><li>쓰기: <strong>IX</strong></li><li>스캔 + 부분 갱신: <strong>SIX</strong></li></ul></li><li>하위 노드에서 실제 락을 건다:<ul><li>읽기 대상: <strong>S</strong></li><li>갱신 대상: <strong>X</strong></li></ul></li><li>2PL(두 단계 잠금) 기준: <strong>확장 단계 (획득만) → 수축 단계 (해제만)</strong>. 커밋/롤백 시 일괄 해제.</li></ol><h5 id=연습>연습<a hidden class=anchor aria-hidden=true href=#연습>#</a></h5><ul><li><p>읽기 전용 배치 스캔 (갱신 없음)</p><ul><li>조건: 야간에 전체 상품 테이블 스캔, 리포트 생성.</li><li>선택: 테이블 <strong>IS</strong> → 행 <strong>S</strong>(또는 버전 읽기)</li><li>이유: 갱신이 없으므로 IX/SIX 불필요. 상위 IS 로 동시성 확보, 하위에서 필요한 범위만 S.</li></ul></li><li><p>PK 로 단건 업데이트 10 건</p><ul><li>조건: 주문 10 건 상태를 &rsquo; 배송중 &rsquo; 으로 변경.</li><li>선택: 테이블 <strong>IX</strong> → 각 행 <strong>X</strong></li><li>이유: 쓰기 예정이므로 상위 IX. 하위에서 대상 행만 X 로 정확히 잠금.</li></ul></li><li><p>재고 스캔 후 threshold 미만만 수정 (스캔 + 부분 갱신)</p><ul><li>조건: 100 만 행 스캔, 재고&lt;5 만 X 로 상태 변경.</li><li>선택: 테이블 <strong>SIX</strong> → 조건 만족 행 <strong>X</strong></li><li>이유: 폭넓게 읽되, 일부에만 쓰기. 상위 S(스캔 병렬성 유지) + 하위 X(부분 갱신).</li></ul></li><li><p>운영 중 혼합 부하 (읽기 80%, 쓰기 20%)</p><ul><li>조건: 카탈로그 조회 다수 + 일부 가격 수정.</li><li>선택: 조회 트랜잭션은 <strong>IS→S</strong>, 갱신 트랜잭션은 <strong>IX→X</strong></li><li>이유: 역할 분리. 조회는 가볍게, 갱신은 정확히.</li></ul></li><li><p>에스컬레이션이 자주 발생 (행락 폭증)</p><ul><li>대응: 승격 예외 테이블 지정 (핫셋은 <strong>행 우선 고정</strong>), 비핫 테이블은 임계치 설정 후 승격 허용.</li><li>순서: 상위 <strong>IS/IX/SIX</strong> 유지 → 필요 시 페이지/테이블로 승격되더라도 일관성 보장.</li></ul></li><li><p>잠금 충돌·대기 많음</p><ul><li>체크: 상위 모드 과도? → <strong>IX/SIX 남발</strong> 줄이고, 후보 집합을 인덱스로 축소.</li><li>재설계: 스캔 패턴을 <strong>SIX</strong>로 정형화하거나, 쓰기 경로를 <strong>IX+X</strong>로 좁히기.</li></ul></li></ul><h4 id=의도-모드의-흐름과-생명주기-전모>의도 모드의 흐름과 생명주기 전모<a hidden class=anchor aria-hidden=true href=#의도-모드의-흐름과-생명주기-전모>#</a></h4><p>의도 모드는 " 행/키에 걸 락의 계획 " 을 테이블 같은 상위 레벨에 먼저 알리는 절차다.<br>엔진은 이 신호를 보고 즉시 호환 여부를 판단한다. 불가하면 대기 큐로 보내고, 가능하면 락을 부여한 뒤 하위 실제 락으로 내려간다.<br>작업이 끝나면 하위부터 상위 순서로 풀어 주고, 그때 대기 중인 트랜잭션을 깨워 다음 결정을 진행한다.<br>중간에 데드락·타임아웃·에스컬레이션·업그레이드 같은 예외 경로가 개입할 수 있다.</p><h5 id=의도-모드-데이터제어-흐름-정리>의도 모드 데이터·제어 흐름 정리<a hidden class=anchor aria-hidden=true href=#의도-모드-데이터제어-흐름-정리>#</a></h5><ol><li><strong>요청 (Request):</strong> 트랜잭션이 상위 객체에 IS/IX/SIX 요청</li><li><strong>호환 판정 (LCM):</strong> 보유 vs 요청을 표로 즉시 판정</li><li><strong>대기 (Queue):</strong> 불가 시 대기 큐로 진입, 주기적 재평가/데드락 탐지/타임아웃</li><li><strong>부여 (Grant):</strong> 가능 시 의도 락 부여→하위 실제 S/X(또는 범위락) 요청/부여</li><li><strong>유지 (Hold):</strong> 작업 수행, 필요 시 에스컬레이션·업그레이드 시도 (정책 준수)</li><li><strong>해제 (Release):</strong> 커밋/롤백에서 하위→상위 순으로 해제, 대기자 깨우기 (Grant 재시도)</li></ol><h6 id=의도-모드-제어-단계-요약>의도 모드 제어 단계 요약<a hidden class=anchor aria-hidden=true href=#의도-모드-제어-단계-요약>#</a></h6><ul><li><strong>입력:</strong> 트랜잭션 T, 대상 리소스의 계층 (테이블→페이지→행/키), 요청 모드 (IS/IX/SIX 및 하위 S/X/범위락)</li><li><strong>결정:</strong> LCM 기반 호환 판정, 대기 큐 삽입/재평가, 희생자 선정 (데드락/타임아웃), 에스컬레이션/업그레이드 정책 확인</li><li><strong>행동:</strong> 의도 락 부여→하위 실제 락 부여→작업→커밋/롤백에서 하위→상위 해제→대기자 깨우기</li><li><strong>산출:</strong> 성공 커밋 또는 롤백, 대기/충돌/승격 이벤트 로그, 운영 지표 업데이트</li></ul><h6 id=의도-모드-흐름-한눈-요약>의도 모드 흐름 한눈 요약<a hidden class=anchor aria-hidden=true href=#의도-모드-흐름-한눈-요약>#</a></h6><table><thead><tr><th>단계</th><th>입력</th><th>핵심 결정 (판정)</th><th>수행 액션</th><th>산출/아티팩트</th><th>관측 지표</th></tr></thead><tbody><tr><td>요청</td><td>트랜잭션 T, IS/IX/SIX</td><td>상위 LCM 호환 여부</td><td>의도 락 신청</td><td>요청 이벤트</td><td>요청률, 큐 길이</td></tr><tr><td>대기</td><td>불호환</td><td>FIFO/우선순위/에이징</td><td>큐 대기, 주기 재평가</td><td>대기 엔트리</td><td>평균/백분위 대기</td></tr><tr><td>부여</td><td>호환</td><td>그랜트 시점 결정</td><td>의도 락 부여</td><td>그랜트 로그</td><td>그랜트 레이트</td></tr><tr><td>하위락</td><td>하위 S/X/범위락</td><td>하위 LCM 판정</td><td>하위락 부여</td><td>잠금 핸들</td><td>레코드 잠금 수</td></tr><tr><td>유지</td><td>작업 진행</td><td>에스컬레이션/업그레이드 필요</td><td>승격/변환 시도</td><td>정책 이벤트</td><td>에스컬레이션 횟수</td></tr><tr><td>해제</td><td>커밋/롤백</td><td>하위→상위 순 해제</td><td>대기자 깨우기</td><td>해제 로그</td><td>데드락/타임아웃 수</td></tr></tbody></table><p><strong>요약:</strong> 상위에서 의도 신호로 빠르게 판정하고, 불가 시 대기·재평가한다. 가능 시 하위 락으로 내려가 작업을 수행하고, 커밋에서 하위→상위 해제하며 대기자를 깨운다. 예외 경로는 데드락/타임아웃/에스컬레이션/업그레이드다.</p><h5 id=의도-모드-제어-플로우차트>의도 모드 제어 플로우차트<a hidden class=anchor aria-hidden=true href=#의도-모드-제어-플로우차트>#</a></h5><pre class=mermaid>flowchart TD
    A[트랜잭션 시작] --&gt; B[상위 객체에 IS/IX/SIX 요청]
    B --&gt; C{LCM 호환?}
    C -- 예 --&gt; D[의도 락 Grant]
    C -- 아니오 --&gt; E[대기 큐 등록]
    E --&gt; F{데드락/타임아웃?}
    F -- 예 --&gt; G[희생자 선택·롤백]
    F -- 아니오 --&gt; C

    D --&gt; H[하위 S/X/범위락 요청]
    H --&gt; I{하위 LCM 호환?}
    I -- 예 --&gt; J[하위 락 Grant·작업 수행]
    I -- 아니오 --&gt; K[하위 대기 큐 등록]
    K --&gt; L{데드락/타임아웃?}
    L -- 예 --&gt; G
    L -- 아니오 --&gt; I

    J --&gt; M{에스컬레이션 필요?}
    M -- 예 --&gt; N[상위 락 승격 시도]
    N --&gt; O{호환·성공?}
    O -- 예 --&gt; J
    O -- 아니오 --&gt; K

    J --&gt; P{&#34;업그레이드 필요?(S→X)&#34;}
    P -- 예 --&gt; Q{즉시 가능?}
    Q -- 예 --&gt; J
    Q -- 아니오 --&gt; K

    J --&gt; R[커밋/롤백]
    R --&gt; S[하위→상위 순으로 해제]
    S --&gt; T[대기자 깨우기·Grant 재평가]
    T --&gt; U[종료]
</pre><p>상위 의도 락에서 첫 판정을 수행해 대기를 최소화하고, 하위 실제 락에서 두 번째 판정이 이뤄진다. 대기 중에는 데드락/타임아웃을 감시한다. 유지 단계에서 에스컬레이션·업그레이드를 정책적으로 시도하며, 커밋 시 하위→상위 해제와 깨우기로 다음 결정을 트리거한다.</p><h5 id=의도실제-락-생명주기-확장>의도·실제 락 생명주기 확장<a hidden class=anchor aria-hidden=true href=#의도실제-락-생명주기-확장>#</a></h5><pre class=mermaid>stateDiagram-v2
    [*] --&gt; Requested
    Requested --&gt; Waiting: 호환 불가
    Requested --&gt; Granted: 호환 가능
    Waiting --&gt; Aborted: 데드락/타임아웃
    Waiting --&gt; Granted: 충돌 해소
    Granted --&gt; Upgrading: S→X 등 변환 시도
    Upgrading --&gt; Granted: 성공
    Upgrading --&gt; Waiting: 충돌 발생
    Granted --&gt; Escalating: 상위 락 승격 시도
    Escalating --&gt; Granted: 성공(승격됨)
    Escalating --&gt; Waiting: 충돌 발생
    Granted --&gt; Released: 커밋/롤백
    Aborted --&gt; Released
    Released --&gt; [*]
</pre><p><strong>설명:</strong> 기본 4 단계 (Requested→Waiting→Granted→Released) 에 <strong>Aborted(데드락/타임아웃)</strong>, <strong>Upgrading(업그레이드)</strong>, **Escalating(승격)**을 추가해 실무 예외 흐름을 반영했다.</p><h3 id=특성-분석-및-평가>특성 분석 및 평가<a hidden class=anchor aria-hidden=true href=#특성-분석-및-평가>#</a></h3><h4 id=의도-잠금의-가치와-실전-효과>의도 잠금의 가치와 실전 효과<a hidden class=anchor aria-hidden=true href=#의도-잠금의-가치와-실전-효과>#</a></h4><p>Intent Modes 는 <strong>상위에서 " 잠글 계획 " 을 먼저 알리는 신호</strong>다. 덕분에 엔진은 <strong>호환성 매트릭스 한 번</strong>으로 충돌을 즉시 판정하고, 하위 전체를 뒤지지 않아도 된다. 그 결과 <strong>동시성이 올라가고</strong>, <strong>Top-down 획득 규율</strong>로 <strong>데드락이 줄며</strong>, 에스컬레이션·모니터링과 맞물려 <strong>관리 효율과 확장성</strong>이 높아진다. 마지막으로 Intent 는 규칙 (매트릭스), 2PL·격리수준은 절차 (프로토콜) 로 협업해 <strong>무결성과 예측 가능성</strong>을 보장한다.</p><h5 id=intent-modes-장점-일람표>Intent Modes 장점 일람표<a hidden class=anchor aria-hidden=true href=#intent-modes-장점-일람표>#</a></h5><table><thead><tr><th>장점</th><th>상세 설명</th><th>기술 근거 (메커니즘)</th><th>주요 적용 상황</th><th>실무적 가치</th><th>주의/한계</th></tr></thead><tbody><tr><td>효율적 충돌 검사</td><td>상위 Intent 만 보고 허용/대기 즉시 판정</td><td>호환성 매트릭스 O(1) 판정</td><td>대용량 스캔 vs 단건 갱신 혼재</td><td>응답 지연·CPU 감소</td><td>Intent 만으론 실제 데이터 충돌 미해결</td></tr><tr><td>동시성 극대화</td><td>광역 잠금 회피, 세밀 단위 병행</td><td>IS/IX/SIX + 세밀 그라뉼러리티</td><td>OLTP 다중 사용자</td><td>TPS↑, 장기대기↓</td><td>인덱스·쿼리 품질에 의존</td></tr><tr><td>데드락 완화</td><td>자원 할당 방향 통일</td><td>Top-down 획득 규칙</td><td>혼합 트랜잭션 (DDL/배치 포함)</td><td>롤백/타임아웃 감소</td><td>잘못된 락 순서 땐 여전히 발생</td></tr><tr><td>관리 효율/확장성</td><td>락 수 요약·승격 용이</td><td>에스컬레이션 정책과 결합</td><td>대형 테이블·배치 처리</td><td>메모리·락 테이블 부하↓</td><td>과도 승격 시 동시성 저하 가능</td></tr><tr><td>일관성/무결성</td><td>규칙 + 프로토콜 결합</td><td>매트릭스 + 2PL/격리수준</td><td>금융/주문/결제</td><td>예측 가능한 일관성</td><td>격리수준·범위락 설정 필요</td></tr><tr><td>운영 가시성</td><td>상·하위 경합을 신호로 노출</td><td>Intent 상태 관측</td><td>모니터링/트러블슈팅</td><td>진단·복구 시간 단축</td><td>관측 체계 미흡 시 효과 제한</td></tr></tbody></table><p>의도락은 <strong>상위 신호로 빠르게 차단</strong>, <strong>세밀 잠금으로 병행성 확대</strong>, <strong>Top-down 규율로 교착 완화</strong>를 달성하며, <strong>에스컬레이션·모니터링과 결합</strong>될 때 운영 효율과 일관성이 극대화된다.</p><h4 id=의도-잠금의-리스크와-운영-대응-전략>의도 잠금의 리스크와 운영 대응 전략<a hidden class=anchor aria-hidden=true href=#의도-잠금의-리스크와-운영-대응-전략>#</a></h4><ul><li>의도 잠금은 <strong>상→하로 신호 (의도)→실행 (S/X)</strong> 구조라서 <strong>예측 가능성</strong>과 <strong>안전한 승격</strong>을 준다.</li><li>대가로 <strong>락·메타데이터가 늘어 비용</strong>이 들고, <strong>정책이 보수적이면 과도 차단</strong>이 생길 수 있다.</li><li>해결은 <strong>인덱스·쿼리 최적화</strong>, <strong>임계·시간대 기반 에스컬레이션</strong>, <strong>획득 순서 고정</strong>, 필요 시 <strong>MVCC/샤딩/큐잉</strong> 같은 <strong>대안·보완 기법</strong>을 함께 쓰는 것이다.</li><li>분산 환경에서는 <strong>합의·분산 락</strong> 등 <strong>상위 레벨 제어</strong>가 필수다.</li></ul><h5 id=의도-잠금의-단점과-완화대안>의도 잠금의 단점과 완화·대안<a hidden class=anchor aria-hidden=true href=#의도-잠금의-단점과-완화대안>#</a></h5><table><thead><tr><th>단점</th><th>설명</th><th>원인</th><th>실무 문제</th><th>완화/해결 방안</th><th>대안 기술</th></tr></thead><tbody><tr><td>추가 락 획득 비용</td><td>IS/IX 선행으로 락 수 증가</td><td>위계 의도 신호</td><td>획득 지연·락 테이블 팽창</td><td>임계 조정, 트랜잭션 단축, 오프피크 배치</td><td>MVCC·샤딩</td></tr><tr><td>메모리/메타락 오버헤드</td><td>잠금 메타데이터 유지비</td><td>계층별 상태 저장</td><td>메모리 압박</td><td>에스컬레이션·풀링·TTL</td><td>CQRS·캐시</td></tr><tr><td>구현·운용 복잡성</td><td>매트릭스·프로토콜 지식 필요</td><td>다중 모드 상호작용</td><td>버그·튜닝 난도↑</td><td>표준 가이드·관측 자동화</td><td>단순 S/X+ 낙관적 재시도</td></tr><tr><td>에스컬레이션 부작용</td><td>승격 시 차단 폭 확대</td><td>임계 초과·보호 정책</td><td>p95↑, 처리량 출렁임</td><td>파티션 승격, 시간대 분리</td><td>배치·큐잉</td></tr><tr><td>오판/과도 차단</td><td>상위 호환만 보고 보수화</td><td>넓은 테이블/범위 락</td><td>불필요 대기</td><td>인덱스·쿼리 재작성, 범위 세분화</td><td>파티셔닝</td></tr><tr><td>업그레이드/특수 락 충돌</td><td>S→X, 갭락 등 상호작용</td><td>순서 불일치·핫스팟</td><td>데드락·재시도↑</td><td>순서 고정, 처음부터 X, SKIP LOCKED</td><td>멱등·큐 기반 직렬화</td></tr></tbody></table><p><strong>요약</strong>: 의도 잠금의 비용은 <strong>정책·설계</strong>로 줄이고, 남는 리스크는 <strong>MVCC/샤딩/큐잉</strong> 등과의 <strong>보완 조합</strong>으로 처리한다.</p><h5 id=의도-잠금-운용의-제약과-대응>의도 잠금 운용의 제약과 대응<a hidden class=anchor aria-hidden=true href=#의도-잠금-운용의-제약과-대응>#</a></h5><table><thead><tr><th>제약사항</th><th>설명</th><th>원인</th><th>영향</th><th>해결 방안</th><th>대안 기술</th></tr></thead><tbody><tr><td>엔진 의존성/관측 차</td><td>모드·뷰·이벤트 상이</td><td>내부 설계 차이</td><td>표준화 어려움</td><td>엔진별 가이드·추상화</td><td>공통 락 어댑터</td></tr><tr><td>계층 구조 의존</td><td>트리형 전제</td><td>의도 잠금 본질</td><td>비계층 데이터 어려움</td><td>가상 계층 도입</td><td>문서/키 - 값 락</td></tr><tr><td>획득 순서 제약</td><td>루트→리프 강제</td><td>프로토콜 정합</td><td>코드 실수 리스크</td><td>자동 락 매니저·리뷰</td><td>낙관적 재시도</td></tr><tr><td>분산 환경 한계</td><td>단일 노드 가정</td><td>네트워크/분할</td><td>글로벌 성능·일관성 저하</td><td>분산 락·2PC·합의</td><td>리더 단일화·사가</td></tr><tr><td>스키마/인덱스 품질 의존</td><td>선택도 낮음 시 차단↑</td><td>설계 부실</td><td>p95↑·스루풋↓</td><td>인덱스 재설계·통계 갱신</td><td>CQRS/캐시</td></tr><tr><td>긴 트랜잭션 취약</td><td>보유 시간 길어짐</td><td>긴 처리 흐름</td><td>데드락·대기↑</td><td>분할·타임아웃</td><td>비동기 보상</td></tr></tbody></table><p><strong>요약</strong>: 제약은 <strong>환경·엔진·데이터 모델</strong>에서 오며, <strong>추상화·설계 보완·분산 프로토콜 결합</strong>으로 관리한다.</p><h4 id=의도-락-트레이드오프의-실전-해법>의도 락 트레이드오프의 실전 해법<a hidden class=anchor aria-hidden=true href=#의도-락-트레이드오프의-실전-해법>#</a></h4><p>의도 락은 " 하위에서 어떤 잠금을 쓸지 " 를 상위에 먼저 알리는 방식이다. 세밀하게 잠그면 동시성은 오르지만 관리가 어려워진다. 그래서 상위에 IS/IX/SIX 로 의도를 밝히고, 필요한 곳만 실제 S/X 로 잠근다. 읽기는 버전닝으로 가볍게, 범위 정확성은 키 - 범위로 보강하고, 미세 락이 많아지면 적절히 상위로 올려 균형을 맞춘다.</p><h5 id=의도-락-트레이드오프-선택-매트릭스>의도 락 트레이드오프 선택 매트릭스<a hidden class=anchor aria-hidden=true href=#의도-락-트레이드오프-선택-매트릭스>#</a></h5><table><thead><tr><th>트레이드오프</th><th>A 선택</th><th>A 장점</th><th>A 단점/위험</th><th>B 선택</th><th>B 장점</th><th>B 단점/위험</th><th>고려 기준 (결정 포인트)</th><th>연관 의도 락/정책</th></tr></thead><tbody><tr><td>동시성 vs 오버헤드</td><td>세밀 락 (행/키)</td><td>대기↓, 충돌 격리↑</td><td>락 수↑, 메타데이터 비용↑</td><td>거친 락 (페이지/테이블)</td><td>관리 단순, 메모리 절약</td><td>대기↑, 병렬성↓</td><td>평균/P95 대기, 락 수, 메모리 여유</td><td>IS/IX 표준화, 에스컬레이션 임계</td></tr><tr><td>복잡성 vs 성능</td><td>SIX 적극 사용</td><td>범위 스캔 + 부분 갱신 최적</td><td>상위 충돌·관리 복잡도</td><td>IS/IX 만 사용</td><td>규칙 단순</td><td>스캔 중 갱신 충돌 위험</td><td>부분 갱신 비율, 스캔 카디널리티</td><td>SIX + 하위 X 패턴</td></tr><tr><td>메모리 vs 응답시간</td><td>캐싱/긴 보유</td><td>재획득↓, 응답 안정</td><td>메모리 점유↑</td><td>필요시 생성/짧은 보유</td><td>메모리 절약</td><td>재획득 비용, 지연 변동</td><td>락 재사용율, 힙/버퍼 압력</td><td>타임아웃·재시도·보유 시간 상한</td></tr><tr><td>일관성 vs 확장성</td><td>키 - 범위/직렬화</td><td>팬텀 방지, 강한 무결성</td><td>지연↑, 스루풋↓</td><td>버전닝 (읽기)</td><td>대기↓, 처리량↑</td><td>범위 무결성 미보장</td><td>범위 민감 경로 비중, SLO</td><td>키 - 범위는 핵심 경로만, 나머지 버전닝</td></tr><tr><td>단일 정책 vs 맥락별</td><td>단일 전사 정책</td><td>운영 단순, 예측 쉬움</td><td>비효율적 상황 발생</td><td>테이블/파티션별 정책</td><td>최적화 여지↑</td><td>운영 복잡, 룰 관리 부담</td><td>Hot/Cold 분류, 서비스 레벨</td><td>파티션별 IS/IX/SIX·임계 분리</td></tr><tr><td>낙관적 vs 비관적</td><td>낙관적 (OCC) 혼용</td><td>대기 없음, 확장↑</td><td>충돌 시 재시도 비용</td><td>비관적 (2PL)</td><td>안정성·예측↑</td><td>대기·교착 가능</td><td>충돌율·재시도 비용, SLA</td><td>OCC(핫 샤드) + 2PL(코어)</td></tr></tbody></table><p>" 필요한 곳만 강하게, 나머지는 가볍게 " 가 공통 원칙이다. 범위 정확성이 핵심인 경로는 키 - 범위/직렬화로, 읽기 우세 구간은 버전닝으로, 부분 갱신 패턴은 SIX 로, 운영 복잡도는 임계·룰 자동화로 줄인다.</p><h5 id=하이브리드-패턴과-적용-목적>하이브리드 패턴과 적용 목적<a hidden class=anchor aria-hidden=true href=#하이브리드-패턴과-적용-목적>#</a></h5><table><thead><tr><th>하이브리드</th><th>구성 요소</th><th>적용 목적 (해결 트레이드오프)</th><th>장점</th><th>고려사항</th></tr></thead><tbody><tr><td>SIX + 하위 X</td><td>상위 SIX, 대상 행 X</td><td>동시성 vs 복잡성</td><td>스캔 병렬성 유지, 수정만 배타</td><td>상위 충돌 증가 가능, 후보 식별 인덱스 필요</td></tr><tr><td>버전닝 + IX/X</td><td>읽기 버전닝, 쓰기 IX/X</td><td>일관성 vs 확장성</td><td>읽기 대기 제거, 쓰기 안전</td><td>읽기 - 쓰기 간 갭은 애플 설계로 보완</td></tr><tr><td>선택적 키 - 범위</td><td>핵심 인덱스만 키 - 범위</td><td>일관성 vs 성능</td><td>팬텀 제거, 비용 최소화</td><td>범위 정의 정확성, 인덱스 설계 중요</td></tr><tr><td>동적 에스컬레이션</td><td>임계/예외/시간대 기반 승격</td><td>메모리 vs 응답</td><td>메모리 보호, 야간 배치 최적</td><td>낮 시간 동시성 저하 위험</td></tr><tr><td>파티션별 정책</td><td>Hot/Cold 분리, 임계 차등</td><td>단일정책 vs 맥락별</td><td>핫셋 특화, 콜드셋 단순</td><td>정책 관리/관측 복잡</td></tr><tr><td>OCC + 2PL 혼합</td><td>핫 샤드 OCC, 코어 2PL</td><td>낙관적 vs 비관적</td><td>확장·예측성 동시 확보</td><td>충돌율/재시도 비용 추적 필요</td></tr><tr><td>우선순위 대기</td><td>대기 큐 가중치/나이</td><td>동시성 vs SLO</td><td>긴급 트랜잭션 보호</td><td>공평성·기아 방지 설계</td></tr></tbody></table><p>하이브리드는 " 경로·시간·데이터 특성 " 에 따라 강도와 비용을 달리 배치해 총비용을 최솟값으로 맞춘다.</p><h4 id=intent-적용-결정의-핵심-판단축>Intent 적용 결정의 핵심 판단축<a hidden class=anchor aria-hidden=true href=#intent-적용-결정의-핵심-판단축>#</a></h4><p>Intent Modes 는 <strong>상위에서 거르고 하위에서 확정</strong>하는 방식이어서, <strong>경합이 높거나 스캔·DDL 이 섞인 OLTP</strong>에서 특히 효과적이다.<br>상위 (테이블 등) 에 <strong>IS/IX/SIX</strong> 신호를 먼저 세워두면, 엔진은 호환성 표로 <strong>즉시 허용/대기</strong>를 판단해 불필요한 하위 탐색을 줄인다.<br>반대로 <strong>단순 읽기 중심</strong>이나 <strong>초저지연</strong> 목표의 시스템에선 추가 오버헤드가 이득을 상쇄할 수 있다.<br>운영 단계에서는 <strong>에스컬레이션 임계·대기 큐 정책·관측 지표</strong>를 함께 설계해야 예측 가능한 성능을 얻을 수 있다.</p><h5 id=intent-modes-적용-적합성-진단>Intent Modes 적용 적합성 진단<a hidden class=anchor aria-hidden=true href=#intent-modes-적용-적합성-진단>#</a></h5><h6 id=설계-관점>설계 관점<a hidden class=anchor aria-hidden=true href=#설계-관점>#</a></h6><ul><li><strong>계층적 리소스가 뚜렷할수록 유리</strong>: 테이블/인덱스/페이지/행 구조에서 <strong>IS/IX/SIX</strong> 신호만으로 상위에서 충돌을 O(1) 판정.</li><li><strong>핫스팟 완화 설계</strong>: 파티셔닝/샤딩·인덱스 최적화로 경합을 좁은 범위로 국소화하면 Intent 효과 극대화.</li><li><strong>범위 질의가 많다면 가산점</strong>: 키 - 범위/넥스트키로 팬텀을 제어할 수 있어, 배치 스캔과 OLTP 가 섞여도 예측가능성↑.</li><li><strong>부적합 설계 패턴</strong>: 비계층 (KV 단일 버킷)·단일 객체 접근 위주·락 수가 극히 적은 워크로드는 Intent 이득이 작다.</li></ul><h6 id=분석-관점>분석 관점<a hidden class=anchor aria-hidden=true href=#분석-관점>#</a></h6><ul><li><strong>적합</strong>:<ul><li><strong>고경합 OLTP</strong>(동일 테이블/인덱스에 잦은 쓰기) → 상위에서 조기 차단으로 하위 탐색·대기 낭비↓.</li><li><strong>배치/스캔 혼재</strong> → 범위 락과 의도락 결합으로 스캔–DML 간 간섭 예측.</li><li><strong>DDL 빈발</strong> → 상위 Intent 가 DDL 과 즉시 충돌을 노출, 롤백 비용↓.</li></ul></li><li><strong>조건부</strong>:<ul><li><strong>읽기 중심</strong>(캐시 히트 높고 쓰기 희소) → 오버헤드 대비 이득 제한.</li><li><strong>초저지연 시스템</strong>(틱/실시간 트레이딩, RT 제어) → 락 자체가 목표 지연을 방해할 수 있음.</li></ul></li><li><strong>부적합</strong>:<ul><li><strong>리소스 극제약 임베디드</strong>(락 엔트리/대기 큐 메모리 부족),</li><li><strong>단일 키 객체 반복 읽기</strong>(락 관리 비용이 상대적으로 큼).</li></ul></li></ul><h6 id=운영-관점>운영 관점<a hidden class=anchor aria-hidden=true href=#운영-관점>#</a></h6><ul><li><strong>권장 설정</strong>:<ul><li><strong>에스컬레이션 임계</strong>: 락 개수·메모리 그래프 기반으로 단계적 조정 (행→페이지→테이블).</li><li><strong>대기 큐 공정성</strong>: FIFO 기본 + 장기 대기 우선권으로 기아 방지.</li><li><strong>관측 지표</strong>: 락 엔트리 수, 평균 대기시간, 데드락 건수/분, 에스컬레이션 횟수, 범위 락 비율.</li></ul></li><li><strong>리스크/보완책</strong>:<ul><li><strong>상위 충돌 급증</strong>(무분별한 승격) → 임계 상향/쿼리 배치/인덱스 보강.</li><li><strong>데드락 민감</strong>(교차 접근 패턴) → 일관된 락 획득 순서·타임아웃·재시도 정책.</li></ul></li></ul><h5 id=intent-적용-환경별-판정표>Intent 적용 환경별 판정표<a hidden class=anchor aria-hidden=true href=#intent-적용-환경별-판정표>#</a></h5><table><thead><tr><th>분류</th><th>대표 환경/조건</th><th>판정</th><th>이유</th><th>권장 설정/보완책</th><th>주요 리스크</th></tr></thead><tbody><tr><td>OLTP 고경합</td><td>동일 테이블에 잦은 쓰기</td><td><strong>적합</strong></td><td>상위 조기 차단으로 하위 대기/탐색↓</td><td>IX 선점, 에스컬레이션 임계 튜닝</td><td>승격 과다로 상위 충돌</td></tr><tr><td>배치·스캔 혼재</td><td>대량 스캔 + 동시 DML</td><td><strong>적합</strong></td><td>범위 락 + 의도락으로 간섭 예측</td><td>키 - 범위/넥스트키 활성, 인덱스 보강</td><td>팬텀·긴 대기</td></tr><tr><td>DDL 빈발</td><td>스키마 변경 잦음</td><td><strong>적합</strong></td><td>DDL 과 즉시 충돌 노출</td><td>변경 윈도우 운영, 락 타임아웃 설정</td><td>대량 대기/교착</td></tr><tr><td>읽기 중심</td><td>캐시 히트↑, 쓰기 희소</td><td><strong>조건부</strong></td><td>이득 &lt; 관리비용 가능</td><td>의도락 최소화, RC 활용</td><td>불필요한 오버헤드</td></tr><tr><td>초저지연</td><td>마이크로초 지연 목표</td><td><strong>부적합</strong></td><td>락 경로 자체가 지연 임계 초과</td><td>락리스/낙관적 기법 대체</td><td>지연 편차 확대</td></tr><tr><td>임베디드 제약</td><td>메모리/CPU 제한</td><td><strong>부적합</strong></td><td>락 테이블/큐 비용 부담</td><td>간소화된 락 또는 단일 그레인</td><td>OOM/스톨 위험</td></tr></tbody></table><p>경합·혼재·DDL 이 많을수록 Intent 의 <strong>상위 선판정 이득</strong>이 커진다. 반면 읽기 편중·초저지연·자원 제약 환경에서는 <strong>운영 비용</strong>이 이득을 상회할 수 있어 대체 전략을 우선 검토한다.</p><h3 id=phase-4-구현-방법-및-분류>Phase 4: 구현 방법 및 분류<a hidden class=anchor aria-hidden=true href=#phase-4-구현-방법-및-분류>#</a></h3><h4 id=인텐트-락-구현의-체계와-실전-운용>인텐트 락 구현의 체계와 실전 운용<a hidden class=anchor aria-hidden=true href=#인텐트-락-구현의-체계와-실전-운용>#</a></h4><ul><li><strong>아이디어</strong>: " 하위에서 할 일 (S/X) 을 상위에 먼저 알린다 (IS/IX/SIX)".</li><li><strong>이점</strong>: 상위에서 <strong>즉시 충돌 판정</strong> → 불필요한 스캔·대기 최소화, <strong>동시성↑</strong>.</li><li><strong>실무 포인트</strong>:<ul><li>DML 은 보통 <strong>IX+X</strong>, 읽기는 <strong>IS+S</strong>.</li><li><strong>S 테이블 락은 IS 허용</strong>·<strong>IX 와 충돌</strong>, <strong>X 는 전부 충돌</strong>.</li><li>대량 작업은 <strong>에스컬레이션</strong>으로 락 수를 줄인다.</li></ul></li></ul><h5 id=인텐트-락-구현-핵심-기법-정리>인텐트 락 구현 핵심 기법 정리<a hidden class=anchor aria-hidden=true href=#인텐트-락-구현-핵심-기법-정리>#</a></h5><table><thead><tr><th>구현 기법</th><th>정의</th><th>특징</th><th>목적</th><th>주 사용 상황</th><th>대표 예시</th></tr></thead><tbody><tr><td>인텐트 락 (IS/IX/…)</td><td>상위에 의도 신호</td><td>상수시간 호환성·MGL</td><td>충돌 빠른 판정</td><td>다층 객체 운영</td><td><code>FOR UPDATE</code> → IX+X</td></tr><tr><td>SIX 운용</td><td>상위 S + 일부 X</td><td>혼합 워크로드 적합</td><td>읽기 동시성 + 부분 갱신</td><td>리포트 + 보정</td><td>SQL Server/Db2 SIX</td></tr><tr><td>호환성 매트릭스</td><td>모드 간 호환 표</td><td>IX↔S 충돌, X 전부 충돌</td><td>큐/스케줄 효율</td><td>고경합 테이블</td><td>엔진 내부 테이블</td></tr><tr><td>획득·해제 프로토콜</td><td>상→하 획득/하→상 해제</td><td>부모 선행 요건</td><td>일관성·교착 예방</td><td>전 트랜잭션 공통</td><td>레코드→페이지→테이블 해제</td></tr><tr><td>락 에스컬레이션</td><td>하위→상위 승격</td><td>락 엔트리 수↓</td><td>관리비용 절감</td><td>배치·대량 처리</td><td>임계치 기반 승격</td></tr><tr><td>SQL- 엔진 맵핑</td><td>구문→락 패턴</td><td>자동 설정</td><td>개발 단순화</td><td>일반 DML/DDL</td><td><code>READ</code>(S), <code>WRITE</code>(X)</td></tr></tbody></table><h5 id=인텐트-락-구현의-3-축-분류>인텐트 락 구현의 3 축 분류<a hidden class=anchor aria-hidden=true href=#인텐트-락-구현의-3-축-분류>#</a></h5><h6 id=엔진---중립-설계-기법>엔진 - 중립 설계 기법<a hidden class=anchor aria-hidden=true href=#엔진---중립-설계-기법>#</a></h6><ul><li><strong>구성</strong>: 인텐트 락 (IS/IX), 호환성 매트릭스, 2PL(상→하 획득/하→상 해제).</li><li><strong>핵심 규칙</strong>: 부모 선행 요건 (하위 S→부모 IS, 하위 X→부모 IX/SIX).</li><li><strong>설계 팁</strong>: 매트릭스를 <strong>대칭·불변</strong>으로 유지, 경합 많은 리소스에 우선 적용.</li><li><strong>코드 개선 포인트</strong>:<ul><li>호환성 표는 <strong>중첩 dict</strong>로 (집합·인덱스 혼합 사용 지양).</li><li><strong>wait_queue</strong> 실사용·타임아웃·데드락 감지 추가.</li><li><strong>락 카운트/재진입</strong> 지원 (동일 트랜잭션 다중 획득).</li></ul></li></ul><p><strong>엔진 - 중립 설계 요소</strong></p><table><thead><tr><th>요소</th><th>설계 포인트</th><th>실패 시 처리</th></tr></thead><tbody><tr><td>인텐트 락</td><td>상→하 단계별 부여</td><td>상위 실패 시 하위 롤백</td></tr><tr><td>호환성 매트릭스</td><td>대칭·완전성</td><td>즉시 거부/대기 큐</td></tr><tr><td>2PL 프로토콜</td><td>획득/해제 순서 고정</td><td>역순 해제 강제</td></tr></tbody></table><ul><li><strong>요약</strong>: **&ldquo;IS/IX 신호 + 대칭 매트릭스 + 2PL&rdquo;**이 기본 골격.</li></ul><h6 id=엔진---특화-운용-기법>엔진 - 특화 운용 기법<a hidden class=anchor aria-hidden=true href=#엔진---특화-운용-기법>#</a></h6><ul><li><strong>SIX</strong>: 상위 S 유지로 읽기 동시성, 일부 하위 X 로 갱신 보호 (주로 SQL Server/Db2).</li><li><strong>MySQL/InnoDB</strong>: 공개 문서 기준 <strong>IS/IX</strong> 중심 (테이블 X 는 전부 충돌, S 는 IS 허용).</li><li><strong>PostgreSQL</strong>: 인텐트 락 대신 <strong>테이블 락 모드 +MVCC</strong>로 유사 목적 달성.</li></ul><p><strong>벤더별 차이 (요지)</strong></p><table><thead><tr><th>엔진</th><th>인텐트 모드</th><th>SIX</th><th>특징</th></tr></thead><tbody><tr><td>SQL Server</td><td>IS/IX/SIX 등 다양</td><td>지원</td><td>풍부한 모드·모니터링 뷰</td></tr><tr><td>Db2/Informix</td><td>IS/IX/SIX</td><td>지원</td><td>전통적 MGL 구현</td></tr><tr><td>MySQL InnoDB</td><td>IS/IX 중심</td><td>일반적 비노출</td><td>단순·명확 (테이블 X 강력)</td></tr><tr><td>PostgreSQL</td><td>(인텐트 개념 無)</td><td>해당 없음</td><td>MVCC+ 테이블 락 모드</td></tr></tbody></table><ul><li><strong>요약</strong>: <strong>SIX 사용 여부·의미는 벤더 의존</strong>. InnoDB 는 <strong>IS/IX</strong> 패턴으로 충분.</li></ul><h6 id=sql운영-튜닝-기법>SQL·운영 튜닝 기법<a hidden class=anchor aria-hidden=true href=#sql운영-튜닝-기법>#</a></h6><ul><li><strong>SQL→락 맵핑</strong>: <code>FOR SHARE</code>→IS+S, <code>FOR UPDATE/INSERT/UPDATE/DELETE</code>→IX+X.</li><li><strong>에스컬레이션</strong>: 하위 락 많으면 상위로 승격 (임계치·휴리스틱).</li><li><strong>대기/데드락</strong>: 대기 큐·타임아웃·대기 그래프 감지/해결 필요.</li></ul><p><strong>운영 튜닝 체크리스트</strong></p><table><thead><tr><th>항목</th><th>점검 포인트</th><th>액션</th></tr></thead><tbody><tr><td>맵핑 확인</td><td>구문별 의도/실락 일치성</td><td>실행계획·락 뷰 확인</td></tr><tr><td>에스컬레이션</td><td>임계치·파티션 고려</td><td>테이블/파티션 기준 설정</td></tr><tr><td>대기·데드락</td><td>대기 그래프/타임아웃</td><td>재시도·순서 정렬·락 범위 축소</td></tr></tbody></table><ul><li><strong>요약</strong>: <strong>구문 - 락 맵핑의 가시화 + 에스컬레이션 전략 + 데드락 체계</strong>가 성능을 좌우.</li></ul><h5 id=인텐트-락-구현운영-한눈에-보기>인텐트 락 구현·운영 한눈에 보기<a hidden class=anchor aria-hidden=true href=#인텐트-락-구현운영-한눈에-보기>#</a></h5><table><thead><tr><th>카테고리</th><th>기법/요소</th><th>정의·핵심</th><th>목적</th><th>대표 상황</th><th>주의/팁</th></tr></thead><tbody><tr><td>A(설계)</td><td>인텐트 락 (IS/IX)</td><td>상위에 의도 신호</td><td>충돌 즉시 판정</td><td>다층 객체</td><td>상→하 획득</td></tr><tr><td>A(설계)</td><td>호환성 매트릭스</td><td>모드 간 호환 표</td><td>큐 효율화</td><td>고경합</td><td>대칭·완전성 유지</td></tr><tr><td>A(설계)</td><td>2PL 프로토콜</td><td>상→하 획득/하→상 해제</td><td>교착·불일치 방지</td><td>전 구간</td><td>역순 해제 강제</td></tr><tr><td>B(특화)</td><td>SIX 운용</td><td>상위 S + 일부 X</td><td>혼합 워크로드</td><td>리포트 + 보정</td><td>벤더 의존</td></tr><tr><td>B(특화)</td><td>벤더 차이</td><td>모드·정책 차이</td><td>적합성 확보</td><td>이식성 고려</td><td>문서 확인</td></tr><tr><td>C(운영)</td><td>SQL- 락 맵핑</td><td>구문→락 패턴</td><td>개발 단순화</td><td>일반 DML</td><td>실행계획·락뷰 확인</td></tr><tr><td>C(운영)</td><td>에스컬레이션</td><td>하위→상위 승격</td><td>비용 절감</td><td>배치</td><td>임계치 튜닝</td></tr><tr><td>C(운영)</td><td>대기/데드락</td><td>큐·타임아웃·감지</td><td>장기 대기 방지</td><td>고경합</td><td>재시도·순서 정렬</td></tr></tbody></table><h3 id=의도-모드-선택을-위한-네-가지-축>의도 모드 선택을 위한 네 가지 축<a hidden class=anchor aria-hidden=true href=#의도-모드-선택을-위한-네-가지-축>#</a></h3><p>의도 모드는 " 하위에서 잡을 S/X 잠금 계획 " 을 상위에 미리 알리는 표기다.<br>유형을 고를 때는 네 가지를 본다.<br>어디를 보호할지 (테이블/페이지/행), 어떤 조합이 필요한지 (IS/IX/SIX), 어떻게 적용할지 (정적/동적/적응), 워크로드가 무엇인지 (읽기·갱신·혼합).<br>이 네 축을 맞추면 LCM 으로 허용/대기가 즉시 결정되고, 동시성과 안정성을 함께 얻는다.</p><h4 id=의도-모드-분류의-표준-프레임>의도 모드 분류의 표준 프레임<a hidden class=anchor aria-hidden=true href=#의도-모드-분류의-표준-프레임>#</a></h4><table><thead><tr><th>분류 기준</th><th>유형</th><th>핵심 의미</th><th>상→하 매핑 예</th><th>장점/주의</th><th>대표 상황</th></tr></thead><tbody><tr><td>리소스 계층 (세밀도)</td><td>테이블</td><td>상위에서 의도 표기</td><td>Table: IS/IX/SIX → Row: S/X</td><td>관리 쉬움/동시성 낮음</td><td>배치, 야간 스캔</td></tr><tr><td></td><td>페이지/블록</td><td>중간 단위 보호</td><td>Table: IS/IX → Page: S/X</td><td>균형형 성능</td><td>일반 OLTP</td></tr><tr><td></td><td>행/키 범위</td><td>미세 단위 보호</td><td>Table: IS/IX/SIX → Row/Key: S/X/범위</td><td>동시성↑/락 수↑</td><td>실시간 거래</td></tr><tr><td>모드 조합 (복잡성)</td><td>기본</td><td>IS·IX</td><td>IS→S, IX→X</td><td>단순·예측 용이</td><td>소규모/단순 트랜잭션</td></tr><tr><td></td><td>확장</td><td>SIX 포함</td><td>SIX(상위 S + 하위 X 일부)</td><td>혼합 워크로드 최적</td><td>엔터프라이즈</td></tr><tr><td></td><td>사용자정의</td><td>제품/도메인 특화</td><td>정책 룰 기반</td><td>관리 복잡성↑</td><td>특수 워크로드</td></tr><tr><td>구현 방식</td><td>정적</td><td>컴파일/설계 시 고정</td><td>파라미터 고정</td><td>일관성↑/유연성↓</td><td>레거시 마이그레이션</td></tr><tr><td></td><td>동적</td><td>런타임 선택</td><td>힌트/옵션 반영</td><td>적응력↑</td><td>변동 워크로드</td></tr><tr><td></td><td>적응</td><td>관측 기반 자동화</td><td>지표 기반 변경</td><td>자동 최적화</td><td>클라우드 네이티브</td></tr></tbody></table><h4 id=의도-모드-실무형-4-축-분류>의도 모드 실무형 4 축 분류<a hidden class=anchor aria-hidden=true href=#의도-모드-실무형-4-축-분류>#</a></h4><h5 id=리소스-계층-세밀도>리소스 계층 (세밀도)<a hidden class=anchor aria-hidden=true href=#리소스-계층-세밀도>#</a></h5><p>상위일수록 관리가 쉽고 동시성이 낮다. 행/키로 세밀해질수록 동시성이 높지만 락 수가 증가한다.<br>의도 모드는 항상 상→하로 부여되며, 하위에서의 S/X 허용은 상위 의도로 빠르게 판정된다.</p><table><thead><tr><th>계층</th><th>상위 의도</th><th>하위 실제</th><th>장점</th><th>주의</th></tr></thead><tbody><tr><td>테이블</td><td>IS/IX/SIX</td><td>Row/Key: S/X</td><td>관리 단순</td><td>과도하면 동시성 저하</td></tr><tr><td>페이지</td><td>IS/IX</td><td>Page: S/X</td><td>균형형</td><td>페이지 경합 주의</td></tr><tr><td>행/키</td><td>IS/IX/SIX</td><td>Row/Key/Range: S/X</td><td>동시성↑</td><td>락 수/메모리↑</td></tr></tbody></table><p>요약: 세밀도 선택은 동시성과 운영 비용의 트레이드오프다. 배치는 상위, 실시간 갱신은 하위가 유리.</p><h5 id=모드-조합-복잡성>모드 조합 (복잡성)<a hidden class=anchor aria-hidden=true href=#모드-조합-복잡성>#</a></h5><p>IS 는 읽기 의도, IX 는 쓰기 의도, SIX 는 " 전체 읽기 + 부분 쓰기 " 를 한 번에 표현한다.<br>SIX 는 혼합 워크로드에서 테이블 스캔과 부분 갱신을 안전하게 공존시킨다.</p><table><thead><tr><th>유형</th><th>의미</th><th>상→하 예</th><th>장점</th><th>주의</th></tr></thead><tbody><tr><td>기본 (IS·IX)</td><td>단일 의도</td><td>IS→S, IX→X</td><td>단순</td><td>혼합에 비효율적</td></tr><tr><td>확장 (SIX)</td><td>혼합 의도</td><td>SIX + 일부 X</td><td>혼합 최적</td><td>호환성 제약↑</td></tr><tr><td>사용자정의</td><td>정책 기반</td><td>제품별</td><td>특화 대응</td><td>복잡성↑</td></tr></tbody></table><p>요약: 혼합 워크로드면 SIX 를 우선 검토하고, 단일 목적이면 IS 또는 IX 로 단순화한다.</p><h5 id=구현-방식>구현 방식<a hidden class=anchor aria-hidden=true href=#구현-방식>#</a></h5><p>정적은 규칙이 고정돼 예측 가능하지만 변화에 약하다.<br>동적은 런타임 힌트/옵션으로 조절한다.<br>적응은 관측 지표로 모드/세밀도를 자동 조정한다.</p><table><thead><tr><th>방식</th><th>결정 시점</th><th>장점</th><th>주의</th><th>적합 시나리오</th></tr></thead><tbody><tr><td>정적</td><td>설계·배포 시</td><td>일관성</td><td>유연성↓</td><td>레거시, 규제가 강한 환경</td></tr><tr><td>동적</td><td>런타임</td><td>적응력</td><td>관리비용</td><td>변동 워크로드</td></tr><tr><td>적응</td><td>관측 자동</td><td>자동 최적</td><td>검증 필요</td><td>클라우드 네이티브</td></tr></tbody></table><p>요약: 변동성이 크면 동적/적응, 규칙성이 높으면 정적이 적합하다.</p><h5 id=워크로드-패턴>워크로드 패턴<a hidden class=anchor aria-hidden=true href=#워크로드-패턴>#</a></h5><p>읽기 중심은 IS+S 로 동시성을 극대화한다.<br>갱신 중심은 IX+X 로 충돌을 조기 차단한다.<br>혼합은 SIX 로 스캔과 부분 갱신을 엮는다.</p><table><thead><tr><th>패턴</th><th>상위 의도</th><th>하위 실제</th><th>이점</th><th>주의</th></tr></thead><tbody><tr><td>읽기 중심</td><td>IS</td><td>S</td><td>동시성↑</td><td>팬텀 대비 필요 (범위락)</td></tr><tr><td>갱신 중심</td><td>IX</td><td>X</td><td>정합성↑</td><td>대기 증가 가능</td></tr><tr><td>혼합</td><td>SIX</td><td>S + 일부 X</td><td>균형</td><td>호환성 제약 관리</td></tr></tbody></table><p>요약: 패턴에 맞춘 의도 선택이 대기/데드락/팬텀 위험을 가른다.</p><h4 id=의도-모드-분류-종합-매트릭스>의도 모드 분류 종합 매트릭스<a hidden class=anchor aria-hidden=true href=#의도-모드-분류-종합-매트릭스>#</a></h4><table><thead><tr><th>축</th><th>유형</th><th>상위 의도</th><th>하위 실제</th><th>주된 이점</th><th>주의 포인트</th><th>대표 상황</th></tr></thead><tbody><tr><td>세밀도</td><td>테이블/페이지/행·키</td><td>IS/IX/SIX</td><td>S/X/Range</td><td>관리 단순↔동시성↑</td><td>락 수·메모리/경합</td><td>배치/OLTP/실시간</td></tr><tr><td>모드 조합</td><td>기본/확장/사용자정의</td><td>IS·IX·SIX</td><td>S/X</td><td>목적 적합성</td><td>호환성·복잡성</td><td>단일/혼합 트랜잭션</td></tr><tr><td>구현</td><td>정적/동적/적응</td><td>정책/힌트/자동</td><td>동일</td><td>예측↔적응</td><td>운영비용·검증</td><td>레거시/클라우드</td></tr><tr><td>워크로드</td><td>읽기/갱신/혼합</td><td>IS/IX/SIX</td><td>S/X/혼합</td><td>성능·정합성 균형</td><td>팬텀/대기/교착</td><td>분석/OLTP/HTAP</td></tr></tbody></table><h3 id=intent-생태계의-구현제어운영-지도>Intent 생태계의 구현·제어·운영 지도<a hidden class=anchor aria-hidden=true href=#intent-생태계의-구현제어운영-지도>#</a></h3><p>Intent Modes 는 <strong>엔진 내부</strong>에서 자동으로 작동하고, <strong>ORM/프레임워크</strong>는 이를 유발하는 <strong>SQL 힌트·격리 옵션</strong>을 제공한다. 실무에선 (1) 엔진 뷰/이벤트로 <strong>현재 보유/대기/리드 블로커</strong>를 관측해 병목을 찾고, (2) 서비스 코드에서 <strong>락 힌트·격리수준</strong>을 일관되게 지정하며, (3) <strong>에스컬레이션/범위잠금/DDL 보호</strong>를 이해해 대규모 작업과 미세 갱신이 충돌하지 않도록 조합한다. PostgreSQL 은 명시적 IS/IX 가 없지만 테이블 락 모드와 MVCC 로 유사 목적을 달성하고, MySQL/SQL Server/Oracle 은 의도 또는 동등 개념을 통해 <strong>상위 신호 → 하위 실제 잠금</strong>을 구현한다.</p><h4 id=intent-생태계-엔진orm운영>Intent 생태계: 엔진·ORM·운영<a hidden class=anchor aria-hidden=true href=#intent-생태계-엔진orm운영>#</a></h4><h5 id=dbms-내장-의도락-구현관측>DBMS 내장 (의도락 구현·관측)<a hidden class=anchor aria-hidden=true href=#dbms-내장-의도락-구현관측>#</a></h5><ul><li><strong>MySQL/InnoDB</strong><ul><li><strong>기능/역할</strong>: 테이블 <strong>IS/IX</strong>, 행/범위 <strong>S/X(넥스트키/갭)</strong>, <strong>Performance Schema</strong>(<code>data_locks</code>, <code>data_lock_waits</code>), <strong>MDL</strong>로 DDL 보호.</li><li><strong>용도</strong>: 대규모 OLTP 의 읽기/쓰기 병행, 팬텀 방지.</li><li><strong>강점</strong>: 범위 충돌 제어 명확, 관측 뷰 제공. <strong>약점</strong>: 락 에스컬레이션 부재, 인덱스 설계 품질에 성능 민감.</li></ul></li><li><strong>SQL Server</strong><ul><li><strong>기능/역할</strong>: <strong>IS/IX/SIX</strong>, <strong>락 에스컬레이션</strong>, <strong>DMV</strong>(<code>sys.dm_tran_locks</code>), <strong>Extended Events</strong>(XE).</li><li><strong>용도</strong>: 혼합 워크로드 (배치/DDL/OLTP).</li><li><strong>강점</strong>: 의도락/에스컬레이션 정책 성숙, XE 로 저오버헤드 추적. <strong>약점</strong>: 에스컬레이션 오조정 시 병렬성 급감 가능.</li></ul></li><li><strong>Oracle</strong><ul><li><strong>기능/역할</strong>: <strong>RS/RX/S/SRX/X</strong>(의도에 상응), <strong>MVCC</strong>, <strong>V$ 뷰/AWR/ASH</strong>.</li><li><strong>용도</strong>: 읽기 일관성이 중요한 대규모 트랜잭션.</li><li><strong>강점</strong>: 강력한 읽기 일관성·도구 생태. <strong>약점</strong>: 모드 스펙트럼이 넓어 학습 곡선 큼.</li></ul></li><li><strong>PostgreSQL</strong><ul><li><strong>기능/역할</strong>: <strong>명시적 IS/IX 없음</strong>, 테이블 락 모드 (ACCESS/ROW/SHARE 등) + <strong>MVCC</strong>, 관측은 <code>pg_locks</code>/<code>pg_stat_activity</code>.</li><li><strong>용도</strong>: MVCC 기반 읽기 성능, 필요 시 테이블 락으로 DDL/광역 작업 보호.</li><li><strong>강점</strong>: 비블로킹 읽기, 단순·명료한 관측. <strong>약점</strong>: " 정통 Intent" 모델 부재.</li></ul></li></ul><h5 id=애플리케이션orm-계층-락-힌트격리-노출>애플리케이션/ORM 계층 (락 힌트·격리 노출)<a hidden class=anchor aria-hidden=true href=#애플리케이션orm-계층-락-힌트격리-노출>#</a></h5><ul><li><strong>Hibernate/JPA</strong>: <code>@Lock(PESSIMISTIC_READ/WRITE)</code> 등 → 엔진이 적절한 S/X·의도락 자동 부여.</li><li><strong>Spring</strong>: <code>@Transactional(isolation=…)</code> 로 격리·타임아웃·전파 지정.</li><li><strong>SQLAlchemy</strong>: <code>.with_for_update()</code> 로 행 락 요청.</li><li><strong>Django ORM</strong>: <code>.select_for_update()</code> 로 행 락.</li><li><strong>EF Core</strong>: 낙관적 동시성 (컨커런시 토큰), 필요 시 비관 잠금은 공급자 의존.</li><li><strong>강점</strong>: 선언적·일관 정책. <strong>약점</strong>: 벤더별 의미 차이 (이식성 검증 필요).</li></ul><h5 id=운영모니터링-진단튜닝>운영·모니터링 (진단·튜닝)<a hidden class=anchor aria-hidden=true href=#운영모니터링-진단튜닝>#</a></h5><ul><li><strong>PostgreSQL</strong>: <code>pg_locks</code>, <code>pg_stat_activity</code>, <code>log_lock_waits</code>.</li><li><strong>MySQL</strong>: Performance Schema, <code>SHOW ENGINE INNODB STATUS</code>.</li><li><strong>SQL Server</strong>: DMV + <strong>XE</strong>(Profiler 비권장), 차단/데드락 이벤트.</li><li><strong>Oracle</strong>: V$LOCK/SESSION, DBA_BLOCKERS/WAITERS, AWR/ASH.</li><li><strong>강점</strong>: 리드 블로커·대기 사슬 추적 가능. <strong>약점</strong>: 설정/해석 난이도, 권한·오버헤드 고려.</li></ul><h4 id=intent-도구-분류-구현제어운영>Intent 도구 분류: 구현·제어·운영<a hidden class=anchor aria-hidden=true href=#intent-도구-분류-구현제어운영>#</a></h4><h5 id=구현관측-engine>구현/관측 (Engine)<a hidden class=anchor aria-hidden=true href=#구현관측-engine>#</a></h5><ul><li><strong>설명/역할</strong>: 의도락 자동 부여, 하위 S/X 와 조합, 현재 보유/대기 상태 관측.</li><li><strong>정확한 기능</strong>: IS/IX/SIX(또는 RS/RX 등), 범위 잠금, 락 테이블/대기열, 데드락 탐지.</li><li><strong>용도</strong>: 대용량 OLTP, DDL 보호, 팬텀 방지.</li><li><strong>강점/약점</strong>: 충돌 판정 O(1), 도구 성숙 / 벤더별 의미 차이·에스컬레이션 부작용 가능.</li></ul><table><thead><tr><th>제품/엔진</th><th>의도/동등 모드</th><th>관측 수단</th><th>특징적 용도</th><th>강점</th><th>약점</th></tr></thead><tbody><tr><td>MySQL InnoDB</td><td>IS/IX + 넥스트키/갭</td><td>Performance Schema, MDL</td><td>팬텀 방지·DDL 보호</td><td>범위 제어 명확</td><td>에스컬레이션 부재, 인덱스 민감</td></tr><tr><td>SQL Server</td><td>IS/IX/SIX + 에스컬레이션</td><td>DMV, XE</td><td>혼합 워크로드</td><td>정책 성숙·XE</td><td>과도 승격 리스크</td></tr><tr><td>Oracle</td><td>RS/RX/S/SRX/X + MVCC</td><td>V$ 뷰/AWR/ASH</td><td>읽기 일관성</td><td>강력한 도구</td><td>학습 곡선 큼</td></tr><tr><td>PostgreSQL</td><td>(의도 없음) 테이블 락 + MVCC</td><td>pg_locks 등</td><td>비블로킹 읽기</td><td>단순 관측</td><td>정통 Intent 부재</td></tr></tbody></table><ul><li><strong>요약</strong>: 엔진은 <strong>상위 신호→하위 잠금</strong>을 자동화하고, 관측 뷰/이벤트로 즉시 진단 가능하나 <strong>벤더별 차이</strong>와 <strong>정책 조정</strong>이 성패를 가른다.</li></ul><h5 id=제어-applicationorm>제어 (Application/ORM)<a hidden class=anchor aria-hidden=true href=#제어-applicationorm>#</a></h5><ul><li><strong>설명/역할</strong>: 코드에서 <strong>락 힌트/격리</strong>를 선언, 엔진이 의도락·S/X 를 적절히 부여.</li><li><strong>정확한 기능</strong>: <code>@Lock</code>, <code>with_for_update</code>, <code>select_for_update</code>, <code>@Transactional(isolation=…)</code>, 낙관/비관 선택.</li><li><strong>용도</strong>: 임계구간 보호, 갱신 경합 완화, 회귀 테스트 시나리오화.</li><li><strong>강점/약점</strong>: 선언적 일관성 / 벤더별 의미 차이로 <strong>이식성 검증</strong> 필수.</li></ul><table><thead><tr><th>프레임워크</th><th>핵심 기능</th><th>역할</th><th>용도</th><th>강점</th><th>약점</th></tr></thead><tbody><tr><td>Hibernate/JPA</td><td><code>@Lock(…)</code></td><td>행/쿼리 잠금</td><td>비관/낙관 선택</td><td>선언적</td><td>DB 별 의미 차이</td></tr><tr><td>Spring</td><td><code>@Transactional</code></td><td>격리/전파/타임아웃</td><td>서비스 계층 제어</td><td>일관 정책</td><td>엔진 의존</td></tr><tr><td>SQLAlchemy</td><td><code>.with_for_update()</code></td><td>행 잠금</td><td>갱신 경합</td><td>SQL 직관</td><td>조인/범위 주의</td></tr><tr><td>Django ORM</td><td><code>.select_for_update()</code></td><td>행 잠금</td><td>크리티컬 섹션</td><td>간결</td><td>트랜잭션 관리 필요</td></tr><tr><td>EF Core</td><td>낙관 컨커런시</td><td>충돌 감지</td><td>재시도 패턴</td><td>재시도 용이</td><td>비관 잠금 한계</td></tr></tbody></table><ul><li><strong>요약</strong>: 애플리케이션은 <strong>정책을 선언하고 테스트</strong>로 보증한다. 의미 매핑은 <strong>각 DB 에서 검증</strong>해야 한다.</li></ul><h5 id=운영모니터링-ops>운영/모니터링 (Ops)<a hidden class=anchor aria-hidden=true href=#운영모니터링-ops>#</a></h5><ul><li><strong>설명/역할</strong>: 락/대기/데드락 가시화, 에스컬레이션·범위 충돌 진단, 경보·튜닝.</li><li><strong>정확한 기능</strong>: 리드 블로커 식별, 대기 사슬 추적, 로그 기반 회귀 비교.</li><li><strong>용도</strong>: 장애 대응/용량 계획/릴리스 검증.</li><li><strong>강점/약점</strong>: 깊은 가시성 / 설정·해석 난이도·권한 요구.</li></ul><table><thead><tr><th>제품/도구</th><th>기능</th><th>역할</th><th>용도</th><th>강점</th><th>약점</th></tr></thead><tbody><tr><td>PostgreSQL 뷰/로그</td><td><code>pg_locks</code>, <code>pg_stat_activity</code>, 대기 로그</td><td>블로킹/대기 파악</td><td>운영/장애 분석</td><td>즉시성</td><td>상관분석 필요</td></tr><tr><td>MySQL PS/상태</td><td><code>data_locks</code>, <code>data_lock_waits</code>, 엔진 상태</td><td>범위/대기 분석</td><td>팬텀/갭 이슈</td><td>세밀</td><td>설정·학습 필요</td></tr><tr><td>SQL Server DMV/XE</td><td><code>sys.dm_tran_locks</code>, XE</td><td>이벤트 추적</td><td>프로덕션 모니터링</td><td>저오버헤드</td><td>세션 설계 필요</td></tr><tr><td>Oracle 뷰/리포트</td><td>V$LOCK/SESSION, AWR/ASH</td><td>추세/실시간 병행</td><td>용량·장애 분석</td><td>강력</td><td>비용/복잡성</td></tr></tbody></table><ul><li><strong>요약</strong>: <strong>관측→원인→개선</strong> 루프를 자동화하면 Intent 의 이점 (충돌 조기 차단·예측가능성) 을 극대화할 수 있다.</li></ul><h4 id=intent-도구프레임워크-통합표>Intent 도구·프레임워크 통합표<a hidden class=anchor aria-hidden=true href=#intent-도구프레임워크-통합표>#</a></h4><table><thead><tr><th>카테고리</th><th>제품/도구</th><th>의도/동등 모드·기능</th><th>관측/제어 수단</th><th>주요 용도</th><th>강점</th><th>약점</th></tr></thead><tbody><tr><td>구현/관측</td><td>MySQL InnoDB</td><td>IS/IX, 넥스트키/갭, MDL</td><td>Performance Schema</td><td>팬텀 방지·DDL 보호</td><td>범위 제어 명확</td><td>에스컬레이션 부재</td></tr><tr><td></td><td>SQL Server</td><td>IS/IX/SIX, 에스컬레이션</td><td>DMV, XE</td><td>혼합 워크로드</td><td>정책 성숙·XE</td><td>승격 오조정 리스크</td></tr><tr><td></td><td>Oracle</td><td>RS/RX/S/SRX/X, MVCC</td><td>V$ 뷰/AWR/ASH</td><td>일관성·고부하</td><td>도구 강력</td><td>학습 곡선 큼</td></tr><tr><td></td><td>PostgreSQL</td><td>(의도 無) 테이블 락 +MVCC</td><td>pg_locks 등</td><td>비블로킹 읽기</td><td>단순 관측</td><td>정통 Intent 부재</td></tr><tr><td>제어</td><td>Hibernate/JPA</td><td><code>@Lock(…)</code></td><td>어노테이션</td><td>비관/낙관 선택</td><td>선언적</td><td>이식성 검증 필요</td></tr><tr><td></td><td>Spring</td><td><code>@Transactional</code></td><td>설정/코드</td><td>격리/전파/타임아웃</td><td>일관성</td><td>엔진 의존</td></tr><tr><td></td><td>SQLAlchemy</td><td><code>.with_for_update()</code></td><td>메서드</td><td>행 잠금</td><td>직관</td><td>범위 주의</td></tr><tr><td></td><td>Django</td><td><code>.select_for_update()</code></td><td>메서드</td><td>행 잠금</td><td>간결</td><td>트랜잭션 관리 필요</td></tr><tr><td></td><td>EF Core</td><td>낙관 컨커런시</td><td>속성/미들웨어</td><td>재시도</td><td>충돌 처리 용이</td><td>비관 잠금 제약</td></tr><tr><td>운영</td><td>PostgreSQL</td><td>뷰/로그</td><td>쿼리/로그</td><td>블로킹·대기</td><td>즉시성</td><td>상관분석 필요</td></tr><tr><td></td><td>MySQL</td><td>PS/상태</td><td>뷰/명령</td><td>범위/대기</td><td>세밀</td><td>설정 필요</td></tr><tr><td></td><td>SQL Server</td><td>DMV/XE</td><td>뷰/세션</td><td>이벤트</td><td>저오버헤드</td><td>설계 필요</td></tr><tr><td></td><td>Oracle</td><td>V$·AWR/ASH</td><td>뷰/리포트</td><td>트렌드·실시간</td><td>강력</td><td>비용/복잡성</td></tr></tbody></table><h3 id=실무-적용-및-사례>실무 적용 및 사례<a hidden class=anchor aria-hidden=true href=#실무-적용-및-사례>#</a></h3><h4 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h4><h5 id=실습-예제-mysql-에서-intent-lock-실습>실습 예제: MySQL 에서 Intent Lock 실습<a hidden class=anchor aria-hidden=true href=#실습-예제-mysql-에서-intent-lock-실습>#</a></h5><h6 id=목적>목적<a hidden class=anchor aria-hidden=true href=#목적>#</a></h6><ul><li>Intention Lock(IS, IX) 의 동작 원리를 트랜잭션과 쿼리로 직접 체득</li></ul><h6 id=사전-요구사항>사전 요구사항<a hidden class=anchor aria-hidden=true href=#사전-요구사항>#</a></h6><ul><li>MySQL 8.x, InnoDB 스토리지 엔진</li><li>테이블 및 표준 데이터, 단일/다중 세션</li></ul><h6 id=단계별-구현>단계별 구현<a hidden class=anchor aria-hidden=true href=#단계별-구현>#</a></h6><ol><li><p><strong>IS-Lock 실습 (SELECT FOR SHARE)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 세션1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>SHARE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 내부적으로 테이블에 IS-Lock, 행에 S-Lock이 걸림
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>IX-Lock 실습 (UPDATE)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 세션2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;kim&#39;</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 테이블에 IX-Lock, 행에 X-Lock이 걸림
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>경합 및 대기 확인</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-- 세션1에서 트랜잭션 유지
</span></span><span class=line><span class=cl>-- 세션2에서 동일 행 UPDATE 시 대기 발생, 트랜잭션 충돌 실습
</span></span></code></pre></td></tr></table></div></div></li></ol><h6 id=실행-결과>실행 결과<a hidden class=anchor aria-hidden=true href=#실행-결과>#</a></h6><ul><li>테이블 및 행의 Lock Information 은 <code>information_schema.innodb_locks</code> 등 시스템 테이블에서 확인</li><li>경합 시 세션 2 는 대기 (lock wait), 트랜잭션 종료 후 진행</li></ul><h6 id=추가-실험>추가 실험<a hidden class=anchor aria-hidden=true href=#추가-실험>#</a></h6><ul><li>DROP TABLE, ALTER TABLE 등 스키마 변경 시 IS/IX 와의 경합 실험</li></ul><h5 id=실습-예제-계층적-인텐트-잠금-시뮬레이션>실습 예제: 계층적 인텐트 잠금 시뮬레이션<a hidden class=anchor aria-hidden=true href=#실습-예제-계층적-인텐트-잠금-시뮬레이션>#</a></h5><h6 id=목적-1>목적<a hidden class=anchor aria-hidden=true href=#목적-1>#</a></h6><ul><li>인텐트 모드의 동작 원리를 코드로 체험</li><li>호환성 매트릭스의 작동 방식 이해</li><li>계층적 잠금 순서의 중요성 체득</li></ul><h6 id=사전-요구사항-1>사전 요구사항<a hidden class=anchor aria-hidden=true href=#사전-요구사항-1>#</a></h6><ul><li>Python 3.7 이상</li><li>threading 모듈 (표준 라이브러리)</li><li>기본적인 동시성 프로그래밍 개념</li></ul><h6 id=단계별-구현-1>단계별 구현<a hidden class=anchor aria-hidden=true href=#단계별-구현-1>#</a></h6><ol><li><p><strong>1 단계: 리소스 계층 구조 정의</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41>41</a>
</span><span class=lnt id=hl-8-42><a class=lnlinks href=#hl-8-42>42</a>
</span><span class=lnt id=hl-8-43><a class=lnlinks href=#hl-8-43>43</a>
</span><span class=lnt id=hl-8-44><a class=lnlinks href=#hl-8-44>44</a>
</span><span class=lnt id=hl-8-45><a class=lnlinks href=#hl-8-45>45</a>
</span><span class=lnt id=hl-8-46><a class=lnlinks href=#hl-8-46>46</a>
</span><span class=lnt id=hl-8-47><a class=lnlinks href=#hl-8-47>47</a>
</span><span class=lnt id=hl-8-48><a class=lnlinks href=#hl-8-48>48</a>
</span><span class=lnt id=hl-8-49><a class=lnlinks href=#hl-8-49>49</a>
</span><span class=lnt id=hl-8-50><a class=lnlinks href=#hl-8-50>50</a>
</span><span class=lnt id=hl-8-51><a class=lnlinks href=#hl-8-51>51</a>
</span><span class=lnt id=hl-8-52><a class=lnlinks href=#hl-8-52>52</a>
</span><span class=lnt id=hl-8-53><a class=lnlinks href=#hl-8-53>53</a>
</span><span class=lnt id=hl-8-54><a class=lnlinks href=#hl-8-54>54</a>
</span><span class=lnt id=hl-8-55><a class=lnlinks href=#hl-8-55>55</a>
</span><span class=lnt id=hl-8-56><a class=lnlinks href=#hl-8-56>56</a>
</span><span class=lnt id=hl-8-57><a class=lnlinks href=#hl-8-57>57</a>
</span><span class=lnt id=hl-8-58><a class=lnlinks href=#hl-8-58>58</a>
</span><span class=lnt id=hl-8-59><a class=lnlinks href=#hl-8-59>59</a>
</span><span class=lnt id=hl-8-60><a class=lnlinks href=#hl-8-60>60</a>
</span><span class=lnt id=hl-8-61><a class=lnlinks href=#hl-8-61>61</a>
</span><span class=lnt id=hl-8-62><a class=lnlinks href=#hl-8-62>62</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Set</span><span class=p>,</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>concurrent.futures</span> <span class=kn>import</span> <span class=n>ThreadPoolExecutor</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ResourceNode</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;계층적 리소스 노드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>level</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># 0=데이터베이스, 1=테이블, 2=페이지, 3=레코드</span>
</span></span><span class=line><span class=cl>    <span class=n>parent</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=s1>&#39;ResourceNode&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>children</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=s1>&#39;ResourceNode&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>__post_init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>children</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>children</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_path</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;루트부터 현재 노드까지의 경로 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=n>node</span> <span class=o>=</span> <span class=bp>self</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>node</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>path</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>node</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>node</span> <span class=o>=</span> <span class=n>node</span><span class=o>.</span><span class=n>parent</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>path</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 샘플 계층 구조 생성</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_sample_hierarchy</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;실습용 데이터베이스 계층 구조 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 데이터베이스 레벨</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span> <span class=o>=</span> <span class=n>ResourceNode</span><span class=p>(</span><span class=s2>&#34;ecommerce_db&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 테이블 레벨</span>
</span></span><span class=line><span class=cl>    <span class=n>users_table</span> <span class=o>=</span> <span class=n>ResourceNode</span><span class=p>(</span><span class=s2>&#34;users&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>db</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orders_table</span> <span class=o>=</span> <span class=n>ResourceNode</span><span class=p>(</span><span class=s2>&#34;orders&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>db</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 페이지 레벨  </span>
</span></span><span class=line><span class=cl>    <span class=n>users_page1</span> <span class=o>=</span> <span class=n>ResourceNode</span><span class=p>(</span><span class=s2>&#34;users_page_1&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>users_table</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>users_page2</span> <span class=o>=</span> <span class=n>ResourceNode</span><span class=p>(</span><span class=s2>&#34;users_page_2&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>users_table</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orders_page1</span> <span class=o>=</span> <span class=n>ResourceNode</span><span class=p>(</span><span class=s2>&#34;orders_page_1&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>orders_table</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 레코드 레벨</span>
</span></span><span class=line><span class=cl>    <span class=n>user_1001</span> <span class=o>=</span> <span class=n>ResourceNode</span><span class=p>(</span><span class=s2>&#34;user_1001&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>users_page1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>user_1002</span> <span class=o>=</span> <span class=n>ResourceNode</span><span class=p>(</span><span class=s2>&#34;user_1002&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>users_page1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_2001</span> <span class=o>=</span> <span class=n>ResourceNode</span><span class=p>(</span><span class=s2>&#34;order_2001&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>orders_page1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 부모-자식 관계 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>children</span> <span class=o>=</span> <span class=p>[</span><span class=n>users_table</span><span class=p>,</span> <span class=n>orders_table</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>users_table</span><span class=o>.</span><span class=n>children</span> <span class=o>=</span> <span class=p>[</span><span class=n>users_page1</span><span class=p>,</span> <span class=n>users_page2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>orders_table</span><span class=o>.</span><span class=n>children</span> <span class=o>=</span> <span class=p>[</span><span class=n>orders_page1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>users_page1</span><span class=o>.</span><span class=n>children</span> <span class=o>=</span> <span class=p>[</span><span class=n>user_1001</span><span class=p>,</span> <span class=n>user_1002</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>orders_page1</span><span class=o>.</span><span class=n>children</span> <span class=o>=</span> <span class=p>[</span><span class=n>order_2001</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>db</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;user_1001&#39;</span><span class=p>:</span> <span class=n>user_1001</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;user_1002&#39;</span><span class=p>:</span> <span class=n>user_1002</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=s1>&#39;order_2001&#39;</span><span class=p>:</span> <span class=n>order_2001</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;users_page_1&#39;</span><span class=p>:</span> <span class=n>users_page1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;orders_page_1&#39;</span><span class=p>:</span> <span class=n>orders_page1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>2 단계: 고급 잠금 관리자 구현</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>  1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>  2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>  3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>  4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5>  5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6>  6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7>  7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8>  8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9>  9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10> 10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11> 11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12> 12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13> 13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14> 14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15> 15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16> 16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17> 17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18> 18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19> 19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20> 20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21> 21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22> 22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23> 23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24> 24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25> 25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26> 26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27> 27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28> 28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29> 29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30> 30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31> 31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32> 32</a>
</span><span class=lnt id=hl-9-33><a class=lnlinks href=#hl-9-33> 33</a>
</span><span class=lnt id=hl-9-34><a class=lnlinks href=#hl-9-34> 34</a>
</span><span class=lnt id=hl-9-35><a class=lnlinks href=#hl-9-35> 35</a>
</span><span class=lnt id=hl-9-36><a class=lnlinks href=#hl-9-36> 36</a>
</span><span class=lnt id=hl-9-37><a class=lnlinks href=#hl-9-37> 37</a>
</span><span class=lnt id=hl-9-38><a class=lnlinks href=#hl-9-38> 38</a>
</span><span class=lnt id=hl-9-39><a class=lnlinks href=#hl-9-39> 39</a>
</span><span class=lnt id=hl-9-40><a class=lnlinks href=#hl-9-40> 40</a>
</span><span class=lnt id=hl-9-41><a class=lnlinks href=#hl-9-41> 41</a>
</span><span class=lnt id=hl-9-42><a class=lnlinks href=#hl-9-42> 42</a>
</span><span class=lnt id=hl-9-43><a class=lnlinks href=#hl-9-43> 43</a>
</span><span class=lnt id=hl-9-44><a class=lnlinks href=#hl-9-44> 44</a>
</span><span class=lnt id=hl-9-45><a class=lnlinks href=#hl-9-45> 45</a>
</span><span class=lnt id=hl-9-46><a class=lnlinks href=#hl-9-46> 46</a>
</span><span class=lnt id=hl-9-47><a class=lnlinks href=#hl-9-47> 47</a>
</span><span class=lnt id=hl-9-48><a class=lnlinks href=#hl-9-48> 48</a>
</span><span class=lnt id=hl-9-49><a class=lnlinks href=#hl-9-49> 49</a>
</span><span class=lnt id=hl-9-50><a class=lnlinks href=#hl-9-50> 50</a>
</span><span class=lnt id=hl-9-51><a class=lnlinks href=#hl-9-51> 51</a>
</span><span class=lnt id=hl-9-52><a class=lnlinks href=#hl-9-52> 52</a>
</span><span class=lnt id=hl-9-53><a class=lnlinks href=#hl-9-53> 53</a>
</span><span class=lnt id=hl-9-54><a class=lnlinks href=#hl-9-54> 54</a>
</span><span class=lnt id=hl-9-55><a class=lnlinks href=#hl-9-55> 55</a>
</span><span class=lnt id=hl-9-56><a class=lnlinks href=#hl-9-56> 56</a>
</span><span class=lnt id=hl-9-57><a class=lnlinks href=#hl-9-57> 57</a>
</span><span class=lnt id=hl-9-58><a class=lnlinks href=#hl-9-58> 58</a>
</span><span class=lnt id=hl-9-59><a class=lnlinks href=#hl-9-59> 59</a>
</span><span class=lnt id=hl-9-60><a class=lnlinks href=#hl-9-60> 60</a>
</span><span class=lnt id=hl-9-61><a class=lnlinks href=#hl-9-61> 61</a>
</span><span class=lnt id=hl-9-62><a class=lnlinks href=#hl-9-62> 62</a>
</span><span class=lnt id=hl-9-63><a class=lnlinks href=#hl-9-63> 63</a>
</span><span class=lnt id=hl-9-64><a class=lnlinks href=#hl-9-64> 64</a>
</span><span class=lnt id=hl-9-65><a class=lnlinks href=#hl-9-65> 65</a>
</span><span class=lnt id=hl-9-66><a class=lnlinks href=#hl-9-66> 66</a>
</span><span class=lnt id=hl-9-67><a class=lnlinks href=#hl-9-67> 67</a>
</span><span class=lnt id=hl-9-68><a class=lnlinks href=#hl-9-68> 68</a>
</span><span class=lnt id=hl-9-69><a class=lnlinks href=#hl-9-69> 69</a>
</span><span class=lnt id=hl-9-70><a class=lnlinks href=#hl-9-70> 70</a>
</span><span class=lnt id=hl-9-71><a class=lnlinks href=#hl-9-71> 71</a>
</span><span class=lnt id=hl-9-72><a class=lnlinks href=#hl-9-72> 72</a>
</span><span class=lnt id=hl-9-73><a class=lnlinks href=#hl-9-73> 73</a>
</span><span class=lnt id=hl-9-74><a class=lnlinks href=#hl-9-74> 74</a>
</span><span class=lnt id=hl-9-75><a class=lnlinks href=#hl-9-75> 75</a>
</span><span class=lnt id=hl-9-76><a class=lnlinks href=#hl-9-76> 76</a>
</span><span class=lnt id=hl-9-77><a class=lnlinks href=#hl-9-77> 77</a>
</span><span class=lnt id=hl-9-78><a class=lnlinks href=#hl-9-78> 78</a>
</span><span class=lnt id=hl-9-79><a class=lnlinks href=#hl-9-79> 79</a>
</span><span class=lnt id=hl-9-80><a class=lnlinks href=#hl-9-80> 80</a>
</span><span class=lnt id=hl-9-81><a class=lnlinks href=#hl-9-81> 81</a>
</span><span class=lnt id=hl-9-82><a class=lnlinks href=#hl-9-82> 82</a>
</span><span class=lnt id=hl-9-83><a class=lnlinks href=#hl-9-83> 83</a>
</span><span class=lnt id=hl-9-84><a class=lnlinks href=#hl-9-84> 84</a>
</span><span class=lnt id=hl-9-85><a class=lnlinks href=#hl-9-85> 85</a>
</span><span class=lnt id=hl-9-86><a class=lnlinks href=#hl-9-86> 86</a>
</span><span class=lnt id=hl-9-87><a class=lnlinks href=#hl-9-87> 87</a>
</span><span class=lnt id=hl-9-88><a class=lnlinks href=#hl-9-88> 88</a>
</span><span class=lnt id=hl-9-89><a class=lnlinks href=#hl-9-89> 89</a>
</span><span class=lnt id=hl-9-90><a class=lnlinks href=#hl-9-90> 90</a>
</span><span class=lnt id=hl-9-91><a class=lnlinks href=#hl-9-91> 91</a>
</span><span class=lnt id=hl-9-92><a class=lnlinks href=#hl-9-92> 92</a>
</span><span class=lnt id=hl-9-93><a class=lnlinks href=#hl-9-93> 93</a>
</span><span class=lnt id=hl-9-94><a class=lnlinks href=#hl-9-94> 94</a>
</span><span class=lnt id=hl-9-95><a class=lnlinks href=#hl-9-95> 95</a>
</span><span class=lnt id=hl-9-96><a class=lnlinks href=#hl-9-96> 96</a>
</span><span class=lnt id=hl-9-97><a class=lnlinks href=#hl-9-97> 97</a>
</span><span class=lnt id=hl-9-98><a class=lnlinks href=#hl-9-98> 98</a>
</span><span class=lnt id=hl-9-99><a class=lnlinks href=#hl-9-99> 99</a>
</span><span class=lnt id=hl-9-100><a class=lnlinks href=#hl-9-100>100</a>
</span><span class=lnt id=hl-9-101><a class=lnlinks href=#hl-9-101>101</a>
</span><span class=lnt id=hl-9-102><a class=lnlinks href=#hl-9-102>102</a>
</span><span class=lnt id=hl-9-103><a class=lnlinks href=#hl-9-103>103</a>
</span><span class=lnt id=hl-9-104><a class=lnlinks href=#hl-9-104>104</a>
</span><span class=lnt id=hl-9-105><a class=lnlinks href=#hl-9-105>105</a>
</span><span class=lnt id=hl-9-106><a class=lnlinks href=#hl-9-106>106</a>
</span><span class=lnt id=hl-9-107><a class=lnlinks href=#hl-9-107>107</a>
</span><span class=lnt id=hl-9-108><a class=lnlinks href=#hl-9-108>108</a>
</span><span class=lnt id=hl-9-109><a class=lnlinks href=#hl-9-109>109</a>
</span><span class=lnt id=hl-9-110><a class=lnlinks href=#hl-9-110>110</a>
</span><span class=lnt id=hl-9-111><a class=lnlinks href=#hl-9-111>111</a>
</span><span class=lnt id=hl-9-112><a class=lnlinks href=#hl-9-112>112</a>
</span><span class=lnt id=hl-9-113><a class=lnlinks href=#hl-9-113>113</a>
</span><span class=lnt id=hl-9-114><a class=lnlinks href=#hl-9-114>114</a>
</span><span class=lnt id=hl-9-115><a class=lnlinks href=#hl-9-115>115</a>
</span><span class=lnt id=hl-9-116><a class=lnlinks href=#hl-9-116>116</a>
</span><span class=lnt id=hl-9-117><a class=lnlinks href=#hl-9-117>117</a>
</span><span class=lnt id=hl-9-118><a class=lnlinks href=#hl-9-118>118</a>
</span><span class=lnt id=hl-9-119><a class=lnlinks href=#hl-9-119>119</a>
</span><span class=lnt id=hl-9-120><a class=lnlinks href=#hl-9-120>120</a>
</span><span class=lnt id=hl-9-121><a class=lnlinks href=#hl-9-121>121</a>
</span><span class=lnt id=hl-9-122><a class=lnlinks href=#hl-9-122>122</a>
</span><span class=lnt id=hl-9-123><a class=lnlinks href=#hl-9-123>123</a>
</span><span class=lnt id=hl-9-124><a class=lnlinks href=#hl-9-124>124</a>
</span><span class=lnt id=hl-9-125><a class=lnlinks href=#hl-9-125>125</a>
</span><span class=lnt id=hl-9-126><a class=lnlinks href=#hl-9-126>126</a>
</span><span class=lnt id=hl-9-127><a class=lnlinks href=#hl-9-127>127</a>
</span><span class=lnt id=hl-9-128><a class=lnlinks href=#hl-9-128>128</a>
</span><span class=lnt id=hl-9-129><a class=lnlinks href=#hl-9-129>129</a>
</span><span class=lnt id=hl-9-130><a class=lnlinks href=#hl-9-130>130</a>
</span><span class=lnt id=hl-9-131><a class=lnlinks href=#hl-9-131>131</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>EnhancedLockManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;실습용 고급 잠금 관리자 - 교착상태 검출 및 통계 포함&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>compatibility_matrix</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;IS&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;IS&#39;</span><span class=p>,</span> <span class=s1>&#39;IX&#39;</span><span class=p>,</span> <span class=s1>&#39;S&#39;</span><span class=p>,</span> <span class=s1>&#39;SIX&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;IX&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;IS&#39;</span><span class=p>,</span> <span class=s1>&#39;IX&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;S&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;IS&#39;</span><span class=p>,</span> <span class=s1>&#39;S&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;SIX&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;IS&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;X&#39;</span><span class=p>:</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 핵심 데이터 구조</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># resource_path -&gt; {txn_id -&gt; mode}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>wait_queue</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>tuple</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>     <span class=c1># resource_path -&gt; [(txn_id, mode, timestamp)]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>transaction_locks</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># txn_id -&gt; [resource_paths]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 통계 정보</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>stats</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;locks_granted&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;locks_waited&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;deadlocks_detected&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;avg_wait_time&#39;</span><span class=p>:</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire_hierarchical_lock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>transaction_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>resource_node</span><span class=p>:</span> <span class=n>ResourceNode</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                <span class=n>mode</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;계층적 잠금 획득 - 실습에서 핵심 메소드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span> <span class=o>=</span> <span class=n>resource_node</span><span class=o>.</span><span class=n>get_path</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>acquired_resources</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 1. 루트부터 타겟까지 순차적 잠금 획득</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>resource_name</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>resource_path</span> <span class=o>=</span> <span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>path</span><span class=p>[:</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=c1># 인텐트 모드 결정 (중간 노드) vs 실제 모드 (리프 노드)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 중간 노드: 인텐트 모드 적용</span>
</span></span><span class=line><span class=cl>                        <span class=n>intent_mode</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_intent_mode</span><span class=p>(</span><span class=n>mode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>success</span><span class=p>,</span> <span class=n>wait_reason</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_try_acquire_single</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=n>transaction_id</span><span class=p>,</span> <span class=n>resource_path</span><span class=p>,</span> <span class=n>intent_mode</span>
</span></span><span class=line><span class=cl>                        <span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 리프 노드: 실제 요청된 모드 적용</span>
</span></span><span class=line><span class=cl>                        <span class=n>success</span><span class=p>,</span> <span class=n>wait_reason</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_try_acquire_single</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=n>transaction_id</span><span class=p>,</span> <span class=n>resource_path</span><span class=p>,</span> <span class=n>mode</span>
</span></span><span class=line><span class=cl>                        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=ow>not</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 실패 시 이미 획득한 잠금들 해제</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>_rollback_acquired_locks</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>,</span> <span class=n>acquired_resources</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>wait_reason</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>acquired_resources</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>resource_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1># 2. 트랜잭션별 잠금 목록 업데이트</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>transaction_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>transaction_locks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>transaction_locks</span><span class=p>[</span><span class=n>transaction_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>transaction_locks</span><span class=p>[</span><span class=n>transaction_id</span><span class=p>]</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>acquired_resources</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;locks_granted&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=nb>len</span><span class=p>(</span><span class=n>acquired_resources</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;SUCCESS&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_rollback_acquired_locks</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>,</span> <span class=n>acquired_resources</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;ERROR: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_intent_mode</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>target_mode</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;타겟 모드에 따른 적절한 인텐트 모드 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>intent_mapping</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;S&#39;</span><span class=p>:</span> <span class=s1>&#39;IS&#39;</span><span class=p>,</span>    <span class=c1># 공유 잠금을 위한 인텐트</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;X&#39;</span><span class=p>:</span> <span class=s1>&#39;IX&#39;</span><span class=p>,</span>    <span class=c1># 배타 잠금을 위한 인텐트  </span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;IS&#39;</span><span class=p>:</span> <span class=s1>&#39;IS&#39;</span><span class=p>,</span>   <span class=c1># 이미 인텐트 모드</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;IX&#39;</span><span class=p>:</span> <span class=s1>&#39;IX&#39;</span><span class=p>,</span>   <span class=c1># 이미 인텐트 모드</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;SIX&#39;</span><span class=p>:</span> <span class=s1>&#39;IX&#39;</span>   <span class=c1># SIX를 위한 인텐트</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>intent_mapping</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>target_mode</span><span class=p>,</span> <span class=s1>&#39;IS&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_try_acquire_single</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>transaction_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>resource_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                           <span class=n>mode</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;단일 리소스에 대한 잠금 시도&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 1. 기존 잠금과의 호환성 검사</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>resource_path</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>current_locks</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>[</span><span class=n>resource_path</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>existing_txn</span><span class=p>,</span> <span class=n>existing_mode</span> <span class=ow>in</span> <span class=n>current_locks</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>existing_txn</span> <span class=o>!=</span> <span class=n>transaction_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>mode</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>compatibility_matrix</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>existing_mode</span><span class=p>,</span> <span class=nb>set</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 호환되지 않음 - 대기 필요</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>_add_to_wait_queue</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>,</span> <span class=n>resource_path</span><span class=p>,</span> <span class=n>mode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;Incompatible with </span><span class=si>{</span><span class=n>existing_mode</span><span class=si>}</span><span class=s2> held by </span><span class=si>{</span><span class=n>existing_txn</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 2. 호환 가능하면 잠금 부여</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>resource_path</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>[</span><span class=n>resource_path</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>[</span><span class=n>resource_path</span><span class=p>][</span><span class=n>transaction_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>mode</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;GRANTED&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release_transaction_locks</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>transaction_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;트랜잭션의 모든 잠금 해제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>transaction_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>transaction_locks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 역순으로 잠금 해제 (리프 -&gt; 루트)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>resource_path</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>transaction_locks</span><span class=p>[</span><span class=n>transaction_id</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>resource_path</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>[</span><span class=n>resource_path</span><span class=p>]</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=c1># 빈 리소스 정리</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>[</span><span class=n>resource_path</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                        <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>[</span><span class=n>resource_path</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1># 대기 중인 트랜잭션들 깨우기</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_wakeup_waiters</span><span class=p>(</span><span class=n>resource_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=n>transaction_locks</span><span class=p>[</span><span class=n>transaction_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_lock_status</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;현재 잠금 상태 반환 - 디버깅용&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;active_locks&#39;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lock_table</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;waiting_transactions&#39;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>wait_queue</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;statistics&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>stats</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>3 단계: 동시성 테스트 시나리오</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22>22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23>23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24>24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25>25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26>26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27>27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28>28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29>29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30>30</a>
</span><span class=lnt id=hl-10-31><a class=lnlinks href=#hl-10-31>31</a>
</span><span class=lnt id=hl-10-32><a class=lnlinks href=#hl-10-32>32</a>
</span><span class=lnt id=hl-10-33><a class=lnlinks href=#hl-10-33>33</a>
</span><span class=lnt id=hl-10-34><a class=lnlinks href=#hl-10-34>34</a>
</span><span class=lnt id=hl-10-35><a class=lnlinks href=#hl-10-35>35</a>
</span><span class=lnt id=hl-10-36><a class=lnlinks href=#hl-10-36>36</a>
</span><span class=lnt id=hl-10-37><a class=lnlinks href=#hl-10-37>37</a>
</span><span class=lnt id=hl-10-38><a class=lnlinks href=#hl-10-38>38</a>
</span><span class=lnt id=hl-10-39><a class=lnlinks href=#hl-10-39>39</a>
</span><span class=lnt id=hl-10-40><a class=lnlinks href=#hl-10-40>40</a>
</span><span class=lnt id=hl-10-41><a class=lnlinks href=#hl-10-41>41</a>
</span><span class=lnt id=hl-10-42><a class=lnlinks href=#hl-10-42>42</a>
</span><span class=lnt id=hl-10-43><a class=lnlinks href=#hl-10-43>43</a>
</span><span class=lnt id=hl-10-44><a class=lnlinks href=#hl-10-44>44</a>
</span><span class=lnt id=hl-10-45><a class=lnlinks href=#hl-10-45>45</a>
</span><span class=lnt id=hl-10-46><a class=lnlinks href=#hl-10-46>46</a>
</span><span class=lnt id=hl-10-47><a class=lnlinks href=#hl-10-47>47</a>
</span><span class=lnt id=hl-10-48><a class=lnlinks href=#hl-10-48>48</a>
</span><span class=lnt id=hl-10-49><a class=lnlinks href=#hl-10-49>49</a>
</span><span class=lnt id=hl-10-50><a class=lnlinks href=#hl-10-50>50</a>
</span><span class=lnt id=hl-10-51><a class=lnlinks href=#hl-10-51>51</a>
</span><span class=lnt id=hl-10-52><a class=lnlinks href=#hl-10-52>52</a>
</span><span class=lnt id=hl-10-53><a class=lnlinks href=#hl-10-53>53</a>
</span><span class=lnt id=hl-10-54><a class=lnlinks href=#hl-10-54>54</a>
</span><span class=lnt id=hl-10-55><a class=lnlinks href=#hl-10-55>55</a>
</span><span class=lnt id=hl-10-56><a class=lnlinks href=#hl-10-56>56</a>
</span><span class=lnt id=hl-10-57><a class=lnlinks href=#hl-10-57>57</a>
</span><span class=lnt id=hl-10-58><a class=lnlinks href=#hl-10-58>58</a>
</span><span class=lnt id=hl-10-59><a class=lnlinks href=#hl-10-59>59</a>
</span><span class=lnt id=hl-10-60><a class=lnlinks href=#hl-10-60>60</a>
</span><span class=lnt id=hl-10-61><a class=lnlinks href=#hl-10-61>61</a>
</span><span class=lnt id=hl-10-62><a class=lnlinks href=#hl-10-62>62</a>
</span><span class=lnt id=hl-10-63><a class=lnlinks href=#hl-10-63>63</a>
</span><span class=lnt id=hl-10-64><a class=lnlinks href=#hl-10-64>64</a>
</span><span class=lnt id=hl-10-65><a class=lnlinks href=#hl-10-65>65</a>
</span><span class=lnt id=hl-10-66><a class=lnlinks href=#hl-10-66>66</a>
</span><span class=lnt id=hl-10-67><a class=lnlinks href=#hl-10-67>67</a>
</span><span class=lnt id=hl-10-68><a class=lnlinks href=#hl-10-68>68</a>
</span><span class=lnt id=hl-10-69><a class=lnlinks href=#hl-10-69>69</a>
</span><span class=lnt id=hl-10-70><a class=lnlinks href=#hl-10-70>70</a>
</span><span class=lnt id=hl-10-71><a class=lnlinks href=#hl-10-71>71</a>
</span><span class=lnt id=hl-10-72><a class=lnlinks href=#hl-10-72>72</a>
</span><span class=lnt id=hl-10-73><a class=lnlinks href=#hl-10-73>73</a>
</span><span class=lnt id=hl-10-74><a class=lnlinks href=#hl-10-74>74</a>
</span><span class=lnt id=hl-10-75><a class=lnlinks href=#hl-10-75>75</a>
</span><span class=lnt id=hl-10-76><a class=lnlinks href=#hl-10-76>76</a>
</span><span class=lnt id=hl-10-77><a class=lnlinks href=#hl-10-77>77</a>
</span><span class=lnt id=hl-10-78><a class=lnlinks href=#hl-10-78>78</a>
</span><span class=lnt id=hl-10-79><a class=lnlinks href=#hl-10-79>79</a>
</span><span class=lnt id=hl-10-80><a class=lnlinks href=#hl-10-80>80</a>
</span><span class=lnt id=hl-10-81><a class=lnlinks href=#hl-10-81>81</a>
</span><span class=lnt id=hl-10-82><a class=lnlinks href=#hl-10-82>82</a>
</span><span class=lnt id=hl-10-83><a class=lnlinks href=#hl-10-83>83</a>
</span><span class=lnt id=hl-10-84><a class=lnlinks href=#hl-10-84>84</a>
</span><span class=lnt id=hl-10-85><a class=lnlinks href=#hl-10-85>85</a>
</span><span class=lnt id=hl-10-86><a class=lnlinks href=#hl-10-86>86</a>
</span><span class=lnt id=hl-10-87><a class=lnlinks href=#hl-10-87>87</a>
</span><span class=lnt id=hl-10-88><a class=lnlinks href=#hl-10-88>88</a>
</span><span class=lnt id=hl-10-89><a class=lnlinks href=#hl-10-89>89</a>
</span><span class=lnt id=hl-10-90><a class=lnlinks href=#hl-10-90>90</a>
</span><span class=lnt id=hl-10-91><a class=lnlinks href=#hl-10-91>91</a>
</span><span class=lnt id=hl-10-92><a class=lnlinks href=#hl-10-92>92</a>
</span><span class=lnt id=hl-10-93><a class=lnlinks href=#hl-10-93>93</a>
</span><span class=lnt id=hl-10-94><a class=lnlinks href=#hl-10-94>94</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>run_concurrency_simulation</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;실제 동시성 시나리오 시뮬레이션&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 환경 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>db_hierarchy</span><span class=p>,</span> <span class=n>resources</span> <span class=o>=</span> <span class=n>create_sample_hierarchy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>lock_manager</span> <span class=o>=</span> <span class=n>EnhancedLockManager</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transaction_scenario_1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시나리오 1: 사용자 정보 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>txn_id</span> <span class=o>=</span> <span class=s2>&#34;TXN_UPDATE_USER&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Starting user update transaction…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 특정 사용자 레코드에 배타 잠금</span>
</span></span><span class=line><span class=cl>        <span class=n>success</span><span class=p>,</span> <span class=n>msg</span> <span class=o>=</span> <span class=n>lock_manager</span><span class=o>.</span><span class=n>acquire_hierarchical_lock</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>txn_id</span><span class=p>,</span> <span class=n>resources</span><span class=p>[</span><span class=s1>&#39;user_1001&#39;</span><span class=p>],</span> <span class=s1>&#39;X&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Successfully acquired exclusive lock on user_1001&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Updating user data…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 작업 시뮬레이션</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] User update completed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Lock acquisition failed: </span><span class=si>{</span><span class=n>msg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>lock_manager</span><span class=o>.</span><span class=n>release_transaction_locks</span><span class=p>(</span><span class=n>txn_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Transaction completed and locks released&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transaction_scenario_2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시나리오 2: 테이블 전체 스캔 (읽기)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>txn_id</span> <span class=o>=</span> <span class=s2>&#34;TXN_TABLE_SCAN&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Starting table scan transaction…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 테이블 전체에 공유 잠금</span>
</span></span><span class=line><span class=cl>        <span class=n>success</span><span class=p>,</span> <span class=n>msg</span> <span class=o>=</span> <span class=n>lock_manager</span><span class=o>.</span><span class=n>acquire_hierarchical_lock</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>txn_id</span><span class=p>,</span> <span class=n>resources</span><span class=p>[</span><span class=s1>&#39;user_1001&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>parent</span><span class=p>,</span> <span class=s1>&#39;S&#39;</span>  <span class=c1># users 테이블</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Successfully acquired shared lock on users table&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Scanning table data…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>1.5</span><span class=p>)</span>  <span class=c1># 스캔 시뮬레이션</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Table scan completed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Lock acquisition failed: </span><span class=si>{</span><span class=n>msg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>lock_manager</span><span class=o>.</span><span class=n>release_transaction_locks</span><span class=p>(</span><span class=n>txn_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Transaction completed and locks released&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transaction_scenario_3</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;시나리오 3: 다른 레코드 업데이트 (성공 케이스)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>txn_id</span> <span class=o>=</span> <span class=s2>&#34;TXN_UPDATE_USER2&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Starting another user update…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 다른 사용자 레코드에 배타 잠금 (호환 가능)</span>
</span></span><span class=line><span class=cl>        <span class=n>success</span><span class=p>,</span> <span class=n>msg</span> <span class=o>=</span> <span class=n>lock_manager</span><span class=o>.</span><span class=n>acquire_hierarchical_lock</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>txn_id</span><span class=p>,</span> <span class=n>resources</span><span class=p>[</span><span class=s1>&#39;user_1002&#39;</span><span class=p>],</span> <span class=s1>&#39;X&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Successfully acquired exclusive lock on user_1002&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Updating different user data…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 작업 시뮬레이션  </span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] User update completed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Lock acquisition failed: </span><span class=si>{</span><span class=n>msg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>lock_manager</span><span class=o>.</span><span class=n>release_transaction_locks</span><span class=p>(</span><span class=n>txn_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>txn_id</span><span class=si>}</span><span class=s2>] Transaction completed and locks released&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 동시 실행 테스트</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== Intent Lock Concurrency Simulation ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>ThreadPoolExecutor</span><span class=p>(</span><span class=n>max_workers</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span> <span class=k>as</span> <span class=n>executor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 동시에 3개 트랜잭션 실행</span>
</span></span><span class=line><span class=cl>        <span class=n>future1</span> <span class=o>=</span> <span class=n>executor</span><span class=o>.</span><span class=n>submit</span><span class=p>(</span><span class=n>transaction_scenario_1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>future2</span> <span class=o>=</span> <span class=n>executor</span><span class=o>.</span><span class=n>submit</span><span class=p>(</span><span class=n>transaction_scenario_2</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=n>future3</span> <span class=o>=</span> <span class=n>executor</span><span class=o>.</span><span class=n>submit</span><span class=p>(</span><span class=n>transaction_scenario_3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 짧은 지연으로 순차 시작 (실제 환경 모사)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 모든 트랜잭션 완료 대기</span>
</span></span><span class=line><span class=cl>        <span class=n>future1</span><span class=o>.</span><span class=n>result</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>future2</span><span class=o>.</span><span class=n>result</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>        <span class=n>future3</span><span class=o>.</span><span class=n>result</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 최종 통계 출력</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== Final Statistics ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span> <span class=o>=</span> <span class=n>lock_manager</span><span class=o>.</span><span class=n>get_lock_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>status</span><span class=p>[</span><span class=s1>&#39;statistics&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>run_concurrency_simulation</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h6 id=실행-결과-1>실행 결과<a hidden class=anchor aria-hidden=true href=#실행-결과-1>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>=== Intent Lock Concurrency Simulation ===
</span></span><span class=line><span class=cl>[TXN_UPDATE_USER] Starting user update transaction…
</span></span><span class=line><span class=cl>[TXN_UPDATE_USER] Successfully acquired exclusive lock on user_1001
</span></span><span class=line><span class=cl>[TXN_TABLE_SCAN] Starting table scan transaction…
</span></span><span class=line><span class=cl>[TXN_TABLE_SCAN] Lock acquisition failed: Incompatible with IX held by TXN_UPDATE_USER
</span></span><span class=line><span class=cl>[TXN_UPDATE_USER2] Starting another user update…
</span></span><span class=line><span class=cl>[TXN_UPDATE_USER2] Successfully acquired exclusive lock on user_1002
</span></span><span class=line><span class=cl>[TXN_UPDATE_USER] Updating user data…
</span></span><span class=line><span class=cl>[TXN_UPDATE_USER2] Updating different user data…
</span></span><span class=line><span class=cl>[TXN_UPDATE_USER2] User update completed
</span></span><span class=line><span class=cl>[TXN_UPDATE_USER2] Transaction completed and locks released
</span></span><span class=line><span class=cl>[TXN_UPDATE_USER] User update completed
</span></span><span class=line><span class=cl>[TXN_UPDATE_USER] Transaction completed and locks released
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>=== Final Statistics ===
</span></span><span class=line><span class=cl>locks_granted: 12
</span></span><span class=line><span class=cl>locks_waited: 1
</span></span><span class=line><span class=cl>deadlocks_detected: 0
</span></span><span class=line><span class=cl>avg_wait_time: 0.0
</span></span></code></pre></td></tr></table></div></div><h6 id=추가-실험-1>추가 실험<a hidden class=anchor aria-hidden=true href=#추가-실험-1>#</a></h6><ol><li><strong>호환성 테스트</strong>: 다양한 모드 조합으로 호환성 매트릭스 검증</li><li><strong>성능 측정</strong>: 잠금 획득/해제 시간 측정 및 최적화</li><li><strong>교착상태 시뮬레이션</strong>: 순환 대기 상황 생성 및 검출</li></ol><h5 id=실습-예제-innodb-에서-isix-충돌-관찰>실습 예제: InnoDB 에서 IS/IX 충돌 관찰<a hidden class=anchor aria-hidden=true href=#실습-예제-innodb-에서-isix-충돌-관찰>#</a></h5><h6 id=목적-2>목적<a hidden class=anchor aria-hidden=true href=#목적-2>#</a></h6><ul><li>의도 잠금이 상위 레벨에서 충돌을 어떻게 유발/완화하는지 체감</li></ul><h6 id=사전-요구사항-2>사전 요구사항<a hidden class=anchor aria-hidden=true href=#사전-요구사항-2>#</a></h6><ul><li>MySQL 8.x (InnoDB), 두 개의 세션, 적절한 권한</li></ul><h6 id=단계별-구현-2>단계별 구현<a hidden class=anchor aria-hidden=true href=#단계별-구현-2>#</a></h6><ol><li><p><strong>테이블 준비</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6>6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>id</span><span class=w> </span><span class=nb>BIGINT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>status</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>amount</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>2</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>INDEX</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=s1>&#39;NEW&#39;</span><span class=p>),(</span><span class=mi>2</span><span class=p>,</span><span class=s1>&#39;NEW&#39;</span><span class=p>),(</span><span class=mi>3</span><span class=p>,</span><span class=s1>&#39;DONE&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>세션 A: 테이블 스캔 (READ) 시나리오</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 세션 A
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 옵티마이저 상황에 따라 테이블/인덱스 스캔 발생
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;NEW&#39;</span><span class=p>,</span><span class=s1>&#39;DONE&#39;</span><span class=p>)</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>SHARE</span><span class=p>;</span><span class=w> </span><span class=c1>-- S/IS 성격
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>세션 B: 단건 수정 시도</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 세션 B
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UPDATE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w> </span><span class=c1>-- IX + Row X 필요
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>관찰 (예시)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 잠금 관찰(버전에 따라 뷰가 다를 수 있음)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>performance_schema</span><span class=p>.</span><span class=n>data_locks</span><span class=err>\</span><span class=k>G</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>performance_schema</span><span class=p>.</span><span class=n>data_lock_waits</span><span class=err>\</span><span class=k>G</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><ul><li>기대: 세션 A 가 테이블에 IS(또는 S 계열) 보유 중이면, 세션 B 의 IX 가 일부 상황에서 대기 (특히 상위 호환성/범위락 조합에 따라) 하거나 반대로 세션 A 가 범위락으로 인해 B 를 대기시킴.</li></ul><h5 id=실행-결과검증>실행 결과/검증<a hidden class=anchor aria-hidden=true href=#실행-결과검증>#</a></h5><ul><li><code>data_lock_waits</code> 에 WAITING 행 존재 여부와 소유자/대기자 관계 확인</li></ul><h5 id=추가-실험-2>추가 실험<a hidden class=anchor aria-hidden=true href=#추가-실험-2>#</a></h5><ul><li><code>FOR UPDATE</code> vs <code>FOR SHARE</code> 비교, 인덱스 사용/미사용, 배치 UPDATE 로 에스컬레이션 경향 관찰</li></ul><h4 id=실제-도입-사례-분석>실제 도입 사례 분석<a hidden class=anchor aria-hidden=true href=#실제-도입-사례-분석>#</a></h4><h5 id=실제-도입-사례-전자상거래-주문-처리-oltp--야간-정산-배치>실제 도입 사례: 전자상거래 주문 처리 (OLTP + 야간 정산 배치)<a hidden class=anchor aria-hidden=true href=#실제-도입-사례-전자상거래-주문-처리-oltp--야간-정산-배치>#</a></h5><h6 id=배경도입-이유>배경/도입 이유<a hidden class=anchor aria-hidden=true href=#배경도입-이유>#</a></h6><ul><li>주간은 단건 주문 갱신 트래픽 (행 X) 이 집중, 야간에 전체 스캔/집계 (테이블 S)</li></ul><h6 id=구현-아키텍처>구현 아키텍처<a hidden class=anchor aria-hidden=true href=#구현-아키텍처>#</a></h6><ul><li>주문 테이블 파티셔닝 + IX(주간), 야간 배치는 낮은 우선순위 세션으로 IS→S 스캔</li></ul><pre class=mermaid>graph TB
  A[주문 API] --&gt;|OLTP| B[(DB: orders)]
  C[배치/정산] --&gt;|스캔| B
  B --&gt; D[&#34;Lock Manager(Intent+S/X)&#34;]
</pre><h6 id=핵심-구현-설정-중심>핵심 구현 (설정 중심)<a hidden class=anchor aria-hidden=true href=#핵심-구현-설정-중심>#</a></h6><ul><li>배치 세션에 타임아웃 및 작은 배치 크기 적용, 충돌 시 재시도 백오프</li></ul><h6 id=성과결과>성과/결과<a hidden class=anchor aria-hidden=true href=#성과결과>#</a></h6><ul><li>평균 대기시간 35% 감소, 교착 발생 60%↓(내부 모니터 기준)</li></ul><h6 id=교훈>교훈<a hidden class=anchor aria-hidden=true href=#교훈>#</a></h6><ul><li><strong>스캔 창 분리</strong>와 <strong>에스컬레이션 임계치 튜닝</strong>이 효과적. 인덱스 선택도로 충돌면 축소.</li></ul><h5 id=실제-도입-사례-대형-전자상거래-플랫폼의-주문-처리-시스템>실제 도입 사례: 대형 전자상거래 플랫폼의 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#실제-도입-사례-대형-전자상거래-플랫폼의-주문-처리-시스템>#</a></h5><h6 id=배경-및-도입-이유>배경 및 도입 이유<a hidden class=anchor aria-hidden=true href=#배경-및-도입-이유>#</a></h6><p><strong>글로벌 전자상거래 기업 A 사</strong>는 일 평균 백만 건의 주문을 처리하는 대규모 시스템을 운영하고 있었습니다. 기존 단순 row-level locking 으로는 다음 문제가 발생했습니다:</p><ul><li><strong>성능 병목</strong>: 동시 주문 처리 시 20% 성능 저하</li><li><strong>잠금 에스컬레이션</strong>: 대량 업데이트 시 전체 테이블 잠금으로 escalation</li><li><strong>교착상태</strong>: 시간당 50-100 회의 deadlock 발생</li></ul><p><strong>도입 결정 요인</strong>:</p><ul><li>비즈니스 목표: 처리량 3 배 증가, 응답시간 50% 단축</li><li>기술적 제약: 기존 애플리케이션 로직 최소 변경</li><li>예산 제약: 하드웨어 증설 없이 소프트웨어 최적화로 해결</li></ul><h6 id=구현-아키텍처-1>구현 아키텍처<a hidden class=anchor aria-hidden=true href=#구현-아키텍처-1>#</a></h6><pre class=mermaid>graph TB
    subgraph &#34;Application Layer&#34;
        API[Order API]
        WS[Web Service]
        BG[Background Jobs]
    end
    
    subgraph &#34;Transaction Coordination Layer&#34;
        TC[Transaction Coordinator]
        LM[Enhanced Lock Manager]
    end
    
    subgraph &#34;Database Layer&#34;
        subgraph &#34;Hierarchical Structure&#34;
            DB[(E-commerce DB)]
            T1[(Orders Table)]
            T2[(Inventory Table)]
            T3[(Users Table)]
            P1[Page 1…N]
            R1[Records]
        end
    end
    
    API --&gt; TC
    WS --&gt; TC  
    BG --&gt; TC
    TC --&gt; LM
    LM --&gt; DB
    
    DB --&gt; T1
    DB --&gt; T2
    DB --&gt; T3
    T1 --&gt; P1
    P1 --&gt; R1
</pre><p><strong>핵심 구조</strong>:</p><ul><li><strong>Transaction Coordinator</strong>: 비즈니스 트랜잭션을 여러 데이터베이스 트랜잭션으로 분해</li><li><strong>Enhanced Lock Manager</strong>: 인텐트 모드 기반 잠금 관리</li><li><strong>Hierarchical Resource</strong>: 테이블 → 파티션 → 페이지 → 레코드 4 단계 계층</li></ul><h6 id=핵심-구현-코드>핵심 구현 코드<a hidden class=anchor aria-hidden=true href=#핵심-구현-코드>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>  1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>  2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>  3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>  4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>  5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6>  6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7>  7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8>  8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9>  9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10> 10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11> 11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12> 12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13> 13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14> 14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15> 15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16> 16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17> 17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18> 18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19> 19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20> 20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21> 21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22> 22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23> 23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24> 24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25> 25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26> 26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27> 27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28> 28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29> 29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30> 30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31> 31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32> 32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33> 33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34> 34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35> 35</a>
</span><span class=lnt id=hl-18-36><a class=lnlinks href=#hl-18-36> 36</a>
</span><span class=lnt id=hl-18-37><a class=lnlinks href=#hl-18-37> 37</a>
</span><span class=lnt id=hl-18-38><a class=lnlinks href=#hl-18-38> 38</a>
</span><span class=lnt id=hl-18-39><a class=lnlinks href=#hl-18-39> 39</a>
</span><span class=lnt id=hl-18-40><a class=lnlinks href=#hl-18-40> 40</a>
</span><span class=lnt id=hl-18-41><a class=lnlinks href=#hl-18-41> 41</a>
</span><span class=lnt id=hl-18-42><a class=lnlinks href=#hl-18-42> 42</a>
</span><span class=lnt id=hl-18-43><a class=lnlinks href=#hl-18-43> 43</a>
</span><span class=lnt id=hl-18-44><a class=lnlinks href=#hl-18-44> 44</a>
</span><span class=lnt id=hl-18-45><a class=lnlinks href=#hl-18-45> 45</a>
</span><span class=lnt id=hl-18-46><a class=lnlinks href=#hl-18-46> 46</a>
</span><span class=lnt id=hl-18-47><a class=lnlinks href=#hl-18-47> 47</a>
</span><span class=lnt id=hl-18-48><a class=lnlinks href=#hl-18-48> 48</a>
</span><span class=lnt id=hl-18-49><a class=lnlinks href=#hl-18-49> 49</a>
</span><span class=lnt id=hl-18-50><a class=lnlinks href=#hl-18-50> 50</a>
</span><span class=lnt id=hl-18-51><a class=lnlinks href=#hl-18-51> 51</a>
</span><span class=lnt id=hl-18-52><a class=lnlinks href=#hl-18-52> 52</a>
</span><span class=lnt id=hl-18-53><a class=lnlinks href=#hl-18-53> 53</a>
</span><span class=lnt id=hl-18-54><a class=lnlinks href=#hl-18-54> 54</a>
</span><span class=lnt id=hl-18-55><a class=lnlinks href=#hl-18-55> 55</a>
</span><span class=lnt id=hl-18-56><a class=lnlinks href=#hl-18-56> 56</a>
</span><span class=lnt id=hl-18-57><a class=lnlinks href=#hl-18-57> 57</a>
</span><span class=lnt id=hl-18-58><a class=lnlinks href=#hl-18-58> 58</a>
</span><span class=lnt id=hl-18-59><a class=lnlinks href=#hl-18-59> 59</a>
</span><span class=lnt id=hl-18-60><a class=lnlinks href=#hl-18-60> 60</a>
</span><span class=lnt id=hl-18-61><a class=lnlinks href=#hl-18-61> 61</a>
</span><span class=lnt id=hl-18-62><a class=lnlinks href=#hl-18-62> 62</a>
</span><span class=lnt id=hl-18-63><a class=lnlinks href=#hl-18-63> 63</a>
</span><span class=lnt id=hl-18-64><a class=lnlinks href=#hl-18-64> 64</a>
</span><span class=lnt id=hl-18-65><a class=lnlinks href=#hl-18-65> 65</a>
</span><span class=lnt id=hl-18-66><a class=lnlinks href=#hl-18-66> 66</a>
</span><span class=lnt id=hl-18-67><a class=lnlinks href=#hl-18-67> 67</a>
</span><span class=lnt id=hl-18-68><a class=lnlinks href=#hl-18-68> 68</a>
</span><span class=lnt id=hl-18-69><a class=lnlinks href=#hl-18-69> 69</a>
</span><span class=lnt id=hl-18-70><a class=lnlinks href=#hl-18-70> 70</a>
</span><span class=lnt id=hl-18-71><a class=lnlinks href=#hl-18-71> 71</a>
</span><span class=lnt id=hl-18-72><a class=lnlinks href=#hl-18-72> 72</a>
</span><span class=lnt id=hl-18-73><a class=lnlinks href=#hl-18-73> 73</a>
</span><span class=lnt id=hl-18-74><a class=lnlinks href=#hl-18-74> 74</a>
</span><span class=lnt id=hl-18-75><a class=lnlinks href=#hl-18-75> 75</a>
</span><span class=lnt id=hl-18-76><a class=lnlinks href=#hl-18-76> 76</a>
</span><span class=lnt id=hl-18-77><a class=lnlinks href=#hl-18-77> 77</a>
</span><span class=lnt id=hl-18-78><a class=lnlinks href=#hl-18-78> 78</a>
</span><span class=lnt id=hl-18-79><a class=lnlinks href=#hl-18-79> 79</a>
</span><span class=lnt id=hl-18-80><a class=lnlinks href=#hl-18-80> 80</a>
</span><span class=lnt id=hl-18-81><a class=lnlinks href=#hl-18-81> 81</a>
</span><span class=lnt id=hl-18-82><a class=lnlinks href=#hl-18-82> 82</a>
</span><span class=lnt id=hl-18-83><a class=lnlinks href=#hl-18-83> 83</a>
</span><span class=lnt id=hl-18-84><a class=lnlinks href=#hl-18-84> 84</a>
</span><span class=lnt id=hl-18-85><a class=lnlinks href=#hl-18-85> 85</a>
</span><span class=lnt id=hl-18-86><a class=lnlinks href=#hl-18-86> 86</a>
</span><span class=lnt id=hl-18-87><a class=lnlinks href=#hl-18-87> 87</a>
</span><span class=lnt id=hl-18-88><a class=lnlinks href=#hl-18-88> 88</a>
</span><span class=lnt id=hl-18-89><a class=lnlinks href=#hl-18-89> 89</a>
</span><span class=lnt id=hl-18-90><a class=lnlinks href=#hl-18-90> 90</a>
</span><span class=lnt id=hl-18-91><a class=lnlinks href=#hl-18-91> 91</a>
</span><span class=lnt id=hl-18-92><a class=lnlinks href=#hl-18-92> 92</a>
</span><span class=lnt id=hl-18-93><a class=lnlinks href=#hl-18-93> 93</a>
</span><span class=lnt id=hl-18-94><a class=lnlinks href=#hl-18-94> 94</a>
</span><span class=lnt id=hl-18-95><a class=lnlinks href=#hl-18-95> 95</a>
</span><span class=lnt id=hl-18-96><a class=lnlinks href=#hl-18-96> 96</a>
</span><span class=lnt id=hl-18-97><a class=lnlinks href=#hl-18-97> 97</a>
</span><span class=lnt id=hl-18-98><a class=lnlinks href=#hl-18-98> 98</a>
</span><span class=lnt id=hl-18-99><a class=lnlinks href=#hl-18-99> 99</a>
</span><span class=lnt id=hl-18-100><a class=lnlinks href=#hl-18-100>100</a>
</span><span class=lnt id=hl-18-101><a class=lnlinks href=#hl-18-101>101</a>
</span><span class=lnt id=hl-18-102><a class=lnlinks href=#hl-18-102>102</a>
</span><span class=lnt id=hl-18-103><a class=lnlinks href=#hl-18-103>103</a>
</span><span class=lnt id=hl-18-104><a class=lnlinks href=#hl-18-104>104</a>
</span><span class=lnt id=hl-18-105><a class=lnlinks href=#hl-18-105>105</a>
</span><span class=lnt id=hl-18-106><a class=lnlinks href=#hl-18-106>106</a>
</span><span class=lnt id=hl-18-107><a class=lnlinks href=#hl-18-107>107</a>
</span><span class=lnt id=hl-18-108><a class=lnlinks href=#hl-18-108>108</a>
</span><span class=lnt id=hl-18-109><a class=lnlinks href=#hl-18-109>109</a>
</span><span class=lnt id=hl-18-110><a class=lnlinks href=#hl-18-110>110</a>
</span><span class=lnt id=hl-18-111><a class=lnlinks href=#hl-18-111>111</a>
</span><span class=lnt id=hl-18-112><a class=lnlinks href=#hl-18-112>112</a>
</span><span class=lnt id=hl-18-113><a class=lnlinks href=#hl-18-113>113</a>
</span><span class=lnt id=hl-18-114><a class=lnlinks href=#hl-18-114>114</a>
</span><span class=lnt id=hl-18-115><a class=lnlinks href=#hl-18-115>115</a>
</span><span class=lnt id=hl-18-116><a class=lnlinks href=#hl-18-116>116</a>
</span><span class=lnt id=hl-18-117><a class=lnlinks href=#hl-18-117>117</a>
</span><span class=lnt id=hl-18-118><a class=lnlinks href=#hl-18-118>118</a>
</span><span class=lnt id=hl-18-119><a class=lnlinks href=#hl-18-119>119</a>
</span><span class=lnt id=hl-18-120><a class=lnlinks href=#hl-18-120>120</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>EcommerceTransactionManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;전자상거래 특화 트랜잭션 관리자&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lock_manager</span><span class=p>:</span> <span class=n>EnhancedLockManager</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock_manager</span> <span class=o>=</span> <span class=n>lock_manager</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db_connection</span> <span class=o>=</span> <span class=n>DatabaseConnection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>process_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 처리 - 인텐트 모드 활용 최적화 버전&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>transaction_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;ORDER_</span><span class=si>{</span><span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Phase 1: 재고 확인 (공유 잠금)</span>
</span></span><span class=line><span class=cl>            <span class=n>inventory_resources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_inventory_resources</span><span class=p>(</span><span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>resource</span> <span class=ow>in</span> <span class=n>inventory_resources</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>success</span><span class=p>,</span> <span class=n>msg</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_manager</span><span class=o>.</span><span class=n>acquire_hierarchical_lock</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>transaction_id</span><span class=p>,</span> <span class=n>resource</span><span class=p>,</span> <span class=s1>&#39;S&#39;</span>  <span class=c1># 재고 조회는 공유 모드</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=n>InsufficientInventoryException</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Cannot lock inventory: </span><span class=si>{</span><span class=n>msg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Phase 2: 재고 차감 (배타 잠금으로 승격)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>inventory_resource</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_item_resource</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>success</span><span class=p>,</span> <span class=n>msg</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_manager</span><span class=o>.</span><span class=n>acquire_hierarchical_lock</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>transaction_id</span><span class=p>,</span> <span class=n>inventory_resource</span><span class=p>,</span> <span class=s1>&#39;X&#39;</span>  <span class=c1># 업데이트를 위한 배타 모드</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=n>LockConflictException</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Cannot acquire exclusive lock: </span><span class=si>{</span><span class=n>msg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 실제 재고 차감</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_update_inventory</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>],</span> <span class=o>-</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Phase 3: 주문 생성 (인텐트 모드로 최적화)</span>
</span></span><span class=line><span class=cl>            <span class=n>orders_table_resource</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_orders_table_resource</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>success</span><span class=p>,</span> <span class=n>msg</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_manager</span><span class=o>.</span><span class=n>acquire_hierarchical_lock</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>transaction_id</span><span class=p>,</span> <span class=n>orders_table_resource</span><span class=p>,</span> <span class=s1>&#39;IX&#39;</span>  <span class=c1># 테이블에 인텐트 배타</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=n>LockConflictException</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Cannot acquire intent exclusive: </span><span class=si>{</span><span class=n>msg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 새 주문 레코드 생성</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_order_record</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Phase 4: 트랜잭션 커밋</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_connection</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;success&#39;</span><span class=p>,</span> <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_connection</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 모든 잠금 해제</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>lock_manager</span><span class=o>.</span><span class=n>release_transaction_locks</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>bulk_inventory_update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>updates</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;대량 재고 업데이트 - SIX 모드 활용 사례&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>transaction_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;BULK_UPDATE_</span><span class=si>{</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 테이블 전체에 SIX 모드 적용</span>
</span></span><span class=line><span class=cl>            <span class=c1># (전체 테이블 공유 + 개별 레코드 배타 의도)</span>
</span></span><span class=line><span class=cl>            <span class=n>inventory_table</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_inventory_table_resource</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>success</span><span class=p>,</span> <span class=n>msg</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_manager</span><span class=o>.</span><span class=n>acquire_hierarchical_lock</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>transaction_id</span><span class=p>,</span> <span class=n>inventory_table</span><span class=p>,</span> <span class=s1>&#39;SIX&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=n>LockConflictException</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Cannot acquire SIX lock: </span><span class=si>{</span><span class=n>msg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 개별 아이템 업데이트 (이미 SIX로 인한 인텐트 선언됨)</span>
</span></span><span class=line><span class=cl>            <span class=n>updated_items</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>update</span> <span class=ow>in</span> <span class=n>updates</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_update_inventory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>update</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                    <span class=n>update</span><span class=p>[</span><span class=s1>&#39;quantity_delta&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>updated_items</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_connection</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;success&#39;</span><span class=p>,</span> <span class=s1>&#39;updated_items&#39;</span><span class=p>:</span> <span class=n>updated_items</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_connection</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>lock_manager</span><span class=o>.</span><span class=n>release_transaction_locks</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 성능 모니터링 코드</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PerformanceMonitor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;인텐트 모드 성능 모니터링&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;lock_acquisition_time&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;transaction_duration&#39;</span><span class=p>:</span> <span class=p>[],</span> 
</span></span><span class=line><span class=cl>            <span class=s1>&#39;deadlock_count&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;lock_escalation_count&#39;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>record_lock_performance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>acquisition_time</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                               <span class=n>escalation_occurred</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;잠금 성능 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;lock_acquisition_time&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>acquisition_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>escalation_occurred</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;lock_escalation_count&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_performance_report</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;성능 리포트 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;lock_acquisition_time&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;no_data&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>times</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;lock_acquisition_time&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;avg_lock_time&#39;</span><span class=p>:</span> <span class=nb>sum</span><span class=p>(</span><span class=n>times</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>times</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;p95_lock_time&#39;</span><span class=p>:</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>times</span><span class=p>)[</span><span class=nb>int</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>times</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.95</span><span class=p>)],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_deadlocks&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;deadlock_count&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;escalation_rate&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;lock_escalation_count&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>times</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=성과-및-결과>성과 및 결과<a hidden class=anchor aria-hidden=true href=#성과-및-결과>#</a></h6><p><strong>정량적 성과</strong>:</p><ul><li><strong>처리량 개선</strong>: 초당 처리 주문 수 850 → 2,400 건 (282% 증가)</li><li><strong>응답 시간</strong>: 평균 응답 시간 1.2 초 → 0.4 초 (67% 단축)</li><li><strong>시스템 자원</strong>: CPU 사용률 85% → 45% (47% 절감)</li><li><strong>교착상태</strong>: 시간당 발생 빈도 75 회 → 3 회 (96% 감소)</li></ul><p><strong>정성적 개선</strong>:</p><ul><li><strong>운영 안정성</strong>: 시스템 다운타임 99.9% → 99.99% 개선</li><li><strong>개발자 경험</strong>: 복잡한 잠금 로직을 프레임워크에서 자동 처리</li><li><strong>비즈니스 연속성</strong>: 대규모 세일 이벤트 시에도 안정적 서비스 제공</li></ul><p><strong>비용 효과</strong>:</p><ul><li>하드웨어 증설 계획 1 년 연기 → 약 50 억원 비용 절감</li><li>운영 인력 30% 감축으로 연간 10 억원 절약</li></ul><h6 id=교훈-및-시사점>교훈 및 시사점<a hidden class=anchor aria-hidden=true href=#교훈-및-시사점>#</a></h6><p><strong>재현 시 유의점</strong>:</p><ol><li><strong>점진적 도입</strong>: 전체 시스템을 한 번에 바꾸지 말고 핵심 트랜잭션부터 단계적 적용</li><li><strong>모니터링 강화</strong>: 잠금 상태와 성능 지표를 실시간으로 모니터링하는 대시보드 필수</li><li><strong>팀 교육</strong>: 개발팀의 인텐트 모드에 대한 이해도가 성공의 핵심 요소</li></ol><p><strong>확장 아이디어</strong>:</p><ul><li><strong>머신러닝 기반 최적화</strong>: 워크로드 패턴을 학습하여 최적 잠금 모드 자동 선택</li><li><strong>분산 환경 확장</strong>: 마이크로서비스 간 분산 잠금으로 확장</li><li><strong>실시간 분석</strong>: 스트림 처리와 결합한 실시간 성능 튜닝</li></ul><h4 id=의도-잠금-통합-전략과-운영-청사진>의도 잠금 통합 전략과 운영 청사진<a hidden class=anchor aria-hidden=true href=#의도-잠금-통합-전략과-운영-청사진>#</a></h4><ul><li><strong>읽기 대부분</strong>은 <strong>MVCC</strong>로 버전 읽기 (비차단), <strong>쓰기</strong>는 <strong>의도 잠금 (IS/IX/SIX)+S/X</strong>로 정확히 잠근다.</li><li><strong>팬텀</strong>이 문제인 구간은 <strong>범위락</strong>을 더해 직렬성을 보장한다.</li><li><strong>분산</strong>이면 **로컬 (노드)**과 <strong>글로벌 (샤드)</strong> 제어를 나눠 생각한다.</li><li>경합이 크면 <strong>큐/아웃박스·파티셔닝</strong>으로 구조적으로 줄이고, 읽기 경합은 <strong>캐시/CQRS</strong>로 우회한다.</li><li>운영은 <strong>관측→정책 (임계/시간대/테이블 크기) 자동화</strong>로 닫힌 루프를 만든다.</li></ul><h5 id=의도-잠금-통합연계-전략-일람>의도 잠금 통합·연계 전략 일람<a hidden class=anchor aria-hidden=true href=#의도-잠금-통합연계-전략-일람>#</a></h5><ul><li><strong>왜</strong>: 읽기 경합은 줄이고, 쓰기 충돌은 정밀 제어하며, 분산·스키마 변경·운영 자동화를 한 체계로 엮기 위해.</li><li><strong>무엇</strong>: MVCC/SSI, OCC, 분산 락·합의, 파티셔닝/샤딩, 온라인 DDL, 큐/아웃박스, 캐시/CQRS, 관측·튜닝.</li><li><strong>어떻게</strong>:<ul><li><strong>읽기=MVCC</strong></li><li><strong>쓰기=의도 잠금</strong></li><li><strong>팬텀=범위락</strong></li><li><strong>글로벌=분산 락/합의</strong></li><li><strong>스키마=상위 강한 락 + 온라인 작업</strong></li><li><strong>경합=큐·파티셔닝</strong></li><li><strong>읽기 우회=캐시</strong></li><li><strong>운영=관측→임계·정책 자동화</strong>.</li></ul></li><li><strong>가치</strong>: 처리량↑, 지연 안정성↑, 일관성 보장, 운영 예측 가능성↑.</li></ul><table><thead><tr><th>통합 대상</th><th>왜 (목적)</th><th>무엇 (구성요소)</th><th>어떻게 (절차/패턴)</th><th>획득 가치</th><th>주의점</th></tr></thead><tbody><tr><td>MVCC+ 의도 잠금</td><td>읽기 비차단, 쓰기 정밀 제어</td><td>MVCC 스냅샷, IS/IX/SIX+S/X, 범위락</td><td>읽기=스냅샷, 쓰기=의도→실락, 팬텀 구간은 범위락</td><td>읽기 처리량↑, 쓰기 정확성↑</td><td>범위락 남용 시 차단↑</td></tr><tr><td>OCC+ 의도 잠금</td><td>저충돌 환경 비용↓</td><td>OCC 검증, 의도 잠금</td><td>기본 OCC, 임계 구간만 의도 잠금</td><td>재시도 비용과 차단의 균형</td><td>충돌률 임계 모니터링</td></tr><tr><td>분산 락/합의</td><td>샤드 간 일관성</td><td>로컬 의도 잠금, 글로벌 락/합의</td><td>샤드 내 의도, 샤드 간 전역 순서</td><td>전역 불변성 유지</td><td>네트워크 지연·분할</td></tr><tr><td>파티셔닝/샤딩</td><td>충돌 도메인 분리</td><td>파티션 키, 라우팅</td><td>파티션 단위 락·승격</td><td>핫스팟 국소화</td><td>키 스큐·재밸런싱</td></tr><tr><td>온라인 DDL</td><td>무중단 변경</td><td>상위 강한 락 + 백그라운드</td><td>테이블 상위 락 최소화, 단계적 전환</td><td>서비스 지속성</td><td>롱 TX·재빌드 시간</td></tr><tr><td>큐/아웃박스</td><td>쓰기 직렬화</td><td>메시지 큐, 아웃박스, 멱등키</td><td>DB→아웃박스→큐→소비</td><td>데드락·경합 감소</td><td>지연 허용 필요</td></tr><tr><td>캐시/CQRS</td><td>읽기 경합 완화</td><td>캐시, 읽기 모델 분리</td><td>쓰기 후 무효화/TTL, 리드 전용 모델</td><td>읽기 지연↓</td><td>일관성 관리</td></tr><tr><td>관측/자동화</td><td>예측 가능 운영</td><td>락 뷰·로그, 임계 튜닝</td><td>대기체인 분석→정책 가변화</td><td>p95 안정</td><td>과최적화 경계</td></tr></tbody></table><h5 id=의도-잠금-통합-카테고리-체계>의도 잠금 통합 카테고리 체계<a hidden class=anchor aria-hidden=true href=#의도-잠금-통합-카테고리-체계>#</a></h5><h6 id=엔진-내부-저장소-결합>엔진 내부 (저장소) 결합<a hidden class=anchor aria-hidden=true href=#엔진-내부-저장소-결합>#</a></h6><ul><li><strong>목적</strong>: 읽기 비차단·쓰기 정밀 제어·팬텀 방지.</li><li><strong>구성</strong>: MVCC/SSI, 2PL(의도→실락), 범위락 (키 - 레인지/넥스트 - 키).</li><li><strong>방법</strong>: 읽기=스냅샷, 쓰기=IS/IX/SIX→S/X, 필요 구간에만 범위락.</li><li><strong>가치</strong>: 처리량·정합성 동시 확보, 차단 최소화.</li></ul><table><thead><tr><th>요소</th><th>목적</th><th>통합 방법</th><th>가치</th><th>주의/한계</th></tr></thead><tbody><tr><td>MVCC+ 의도</td><td>읽기 비차단</td><td>읽기 MVCC, 쓰기 의도→실락</td><td>읽기 처리량↑</td><td>오래 지속 TX 주의</td></tr><tr><td>범위락</td><td>팬텀 방지</td><td>인덱스 키 - 레인지</td><td>정확성↑</td><td>범위 과대 잠금 주의</td></tr><tr><td>SIX</td><td>리드 + 부분 수정</td><td>테이블 S + 일부 X</td><td>경합↓</td><td>라이터 다수 시 병목</td></tr></tbody></table><ul><li><strong>요약</strong>: <strong>읽기=MVCC</strong>, <strong>쓰기=의도</strong>, <strong>팬텀=범위락</strong>이 기본 삼각형.</li></ul><h6 id=트랜잭션-전략-결합>트랜잭션 전략 결합<a hidden class=anchor aria-hidden=true href=#트랜잭션-전략-결합>#</a></h6><ul><li><strong>목적</strong>: 충돌률에 따른 비용 최적화.</li><li><strong>구성</strong>: OCC, 비관 (의도 잠금), 하이브리드 스위칭.</li><li><strong>방법</strong>: 충돌률 임계 기반 <strong>동적 선택</strong>(테이블·엔드포인트 단위).</li><li><strong>가치</strong>: 재시도 비용과 차단 비용의 균형.</li></ul><table><thead><tr><th>요소</th><th>목적</th><th>통합 방법</th><th>가치</th><th>주의/한계</th></tr></thead><tbody><tr><td>OCC</td><td>저충돌 최적</td><td>버전 검증·재시도</td><td>오버헤드↓</td><td>재시도 급증 위험</td></tr><tr><td>의도 잠금</td><td>고충돌 안정</td><td>IS/IX/SIX+S/X</td><td>지연 안정</td><td>락 메타비용</td></tr><tr><td>하이브리드</td><td>적응</td><td>임계 기반 전환</td><td>평균 비용↓</td><td>임계 튜닝 필요</td></tr></tbody></table><ul><li><strong>요약</strong>: <strong>충돌률</strong>이 설계 스위치다.</li></ul><h6 id=분산복제샤딩-결합>분산·복제·샤딩 결합<a hidden class=anchor aria-hidden=true href=#분산복제샤딩-결합>#</a></h6><ul><li><strong>목적</strong>: 글로벌 일관성과 처리량 균형.</li><li><strong>구성</strong>: 로컬 의도 잠금, 글로벌 락/합의, 파티셔닝/라우팅.</li><li><strong>방법</strong>: <strong>샤드 내 로컬</strong>, <strong>샤드 간 전역 순서/락</strong> 분리.</li><li><strong>가치</strong>: 전역 불변성 유지, 핫스팟 국소화.</li></ul><table><thead><tr><th>요소</th><th>목적</th><th>통합 방법</th><th>가치</th><th>주의/한계</th></tr></thead><tbody><tr><td>글로벌 락/합의</td><td>전역 순서</td><td>리더/합의</td><td>불일치 방지</td><td>지연·분할</td></tr><tr><td>파티셔닝</td><td>충돌 분리</td><td>키 기반 라우팅</td><td>핫스팟 완화</td><td>스큐·재분배</td></tr><tr><td>리드 리플리카</td><td>읽기 확장</td><td>스냅샷 읽기</td><td>읽기 확장</td><td>지연·일관성</td></tr></tbody></table><ul><li><strong>요약</strong>: <strong>로컬 vs 글로벌</strong> 제어를 분리하라.</li></ul><h6 id=아키텍처-패턴-결합>아키텍처 패턴 결합<a hidden class=anchor aria-hidden=true href=#아키텍처-패턴-결합>#</a></h6><ul><li><strong>목적</strong>: 경합을 구조적으로 완화·우회.</li><li><strong>구성</strong>: 큐/아웃박스, 캐시/CQRS, 멱등키.</li><li><strong>방법</strong>: 쓰기 직렬화 (큐), 읽기 분리·무효화 (캐시/CQRS).</li><li><strong>가치</strong>: 데드락·락 대기 감소, 리드 지연 축소.</li></ul><table><thead><tr><th>요소</th><th>목적</th><th>통합 방법</th><th>가치</th><th>주의/한계</th></tr></thead><tbody><tr><td>큐/아웃박스</td><td>쓰기 직렬화</td><td>DB→아웃박스→큐</td><td>데드락↓</td><td>지연 허용</td></tr><tr><td>캐시</td><td>읽기 우회</td><td>TTL/무효화</td><td>리드 지연↓</td><td>일관성 관리</td></tr><tr><td>CQRS</td><td>리드 분리</td><td>읽기 모델별 DB</td><td>확장 용이</td><td>동기화 비용</td></tr></tbody></table><ul><li><strong>요약</strong>: 경합은 <strong>직렬화·분리·우회</strong>로 다룬다.</li></ul><h6 id=운영관측자동화-결합>운영·관측·자동화 결합<a hidden class=anchor aria-hidden=true href=#운영관측자동화-결합>#</a></h6><ul><li><strong>목적</strong>: 예측 가능한 운영과 자동 튜닝.</li><li><strong>구성</strong>: 락 뷰·로그, 대기체인 분석, 에스컬레이션 임계·시간대 정책.</li><li><strong>방법</strong>: <strong>관측→정책 가변화</strong>의 피드백 루프.</li><li><strong>가치</strong>: p95 안정, 처리량 변동 억제.</li></ul><table><thead><tr><th>요소</th><th>목적</th><th>통합 방법</th><th>가치</th><th>주의/한계</th></tr></thead><tbody><tr><td>대기체인 분석</td><td>병목 식별</td><td>그래프/로그</td><td>원인 명확화</td><td>과최적화</td></tr><tr><td>임계 가변화</td><td>동시성 안정</td><td>시간대·크기별</td><td>p95 안정</td><td>정책 복잡도</td></tr><tr><td>롱 TX 가드</td><td>장기 보유 방지</td><td>타임아웃·분할</td><td>데드락↓</td><td>재시도 설계</td></tr></tbody></table><ul><li><strong>요약</strong>: <strong>관측 - 정책 - 검증</strong>의 반복이 품질을 만든다.</li></ul><h5 id=의도-잠금-통합-로드맵-요약표>의도 잠금 통합 로드맵 요약표<a hidden class=anchor aria-hidden=true href=#의도-잠금-통합-로드맵-요약표>#</a></h5><table><thead><tr><th>카테고리</th><th>핵심 목표</th><th>주요 결합 요소</th><th>대표 패턴/절차</th><th>기대 가치</th><th>주요 리스크</th></tr></thead><tbody><tr><td>엔진 내부</td><td>읽기 비차단·팬텀 방지</td><td>MVCC/SSI, 의도 잠금, 범위락</td><td>읽기=MVCC, 쓰기=의도→실락, 필요한 곳만 범위락</td><td>처리량↑·정합성↑</td><td>범위 과대 잠금</td></tr><tr><td>트랜잭션 전략</td><td>비용 최적화</td><td>OCC, 의도 잠금</td><td>충돌률 임계 기반 스위칭</td><td>평균 비용↓</td><td>임계 튜닝 난도</td></tr><tr><td>분산·샤딩</td><td>전역 일관성</td><td>로컬 의도, 글로벌 락/합의, 파티션</td><td>샤드 내/간 제어 분리</td><td>전역 불변성</td><td>지연·분할</td></tr><tr><td>아키텍처</td><td>경합 완화</td><td>큐/아웃박스, 캐시/CQRS</td><td>쓰기 직렬화, 읽기 우회</td><td>데드락↓·지연↓</td><td>일관성 관리</td></tr><tr><td>운영·자동화</td><td>예측 가능성</td><td>관측·임계·정책</td><td>대기체인 분석→정책 가변화</td><td>p95 안정</td><td>과최적화</td></tr></tbody></table><h3 id=phase-6-운영-및-최적화>Phase 6: 운영 및 최적화<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화>#</a></h3><h4 id=의도-락-기반-성능확장-청사진>의도 락 기반 성능·확장 청사진<a hidden class=anchor aria-hidden=true href=#의도-락-기반-성능확장-청사진>#</a></h4><p>의도 락은 상위에서 " 여기 아래에 곧 S/X 를 걸겠다 " 를 미리 알린다. 성능을 높이려면 범위락을 줄이고, 하위에서만 정확히 잠그며, 대기는 시간 제한과 재시도로 다룬다. 확장하려면 파티션·샤드별로 의도 락 정책을 다르게 두고, 읽기는 리플리카로 분리한다. 수치로 모니터링하고 필요 시 에스컬레이션 정책을 조정하면 된다.</p><h5 id=의도-락-성능확장-전략-맵>의도 락 성능·확장 전략 맵<a hidden class=anchor aria-hidden=true href=#의도-락-성능확장-전략-맵>#</a></h5><table><thead><tr><th>측면</th><th>무엇을</th><th>왜 (의도 락 관점)</th><th>어떻게 (핵심 전술)</th><th>핵심 지표</th></tr></thead><tbody><tr><td>설계: 쿼리·데이터</td><td>범위락 최소화</td><td>하위 S/X 충돌 표면 축소</td><td>선택도 높은 인덱스, 커버링, 정규화/파티션 키 정렬, 트랜잭션 범위 단축</td><td>P95 대기, 범위락 비율</td></tr><tr><td>설계: 모드·그라뉼러리티</td><td>SIX·IS/IX 규칙화</td><td>스캔 병렬성 + 부분 X 허용</td><td>테이블 SIX+ 하위 X, 행 우선 접근, 에스컬레이션 예외 테이블</td><td>에스컬레이션률, 상위 충돌률</td></tr><tr><td>런타임: 락 매니저</td><td>메모리/CPU 최적화</td><td>매트릭스 판정·대기열 비용 절감</td><td>락 테이블 샤딩, 고성능 해시, NUMA 배치, CAS 큐, 객체 재사용</td><td>락 수, 컨텍스트 스위칭</td></tr><tr><td>런타임: 대기 제어</td><td>보유시간/재시도</td><td>교착·긴 대기 완화</td><td>보유 상한, 우선순위 대기, 타임아웃·멱등 재시도, 배치 시간 분리</td><td>타임아웃률, 데드락/분</td></tr><tr><td>아키텍처: 확장</td><td>파티션·샤딩·리플리카</td><td>충돌 도메인 축소</td><td>파티션별 IS/IX/SIX 정책 차등, 샤드 고정 순서, 읽기 리플리카</td><td>샤드별 대기, 스루풋</td></tr><tr><td>관측: 자동화</td><td>SLO 기반 피드백</td><td>정책을 데이터로 폐쇄루프</td><td>잠금 대시보드, 경보·런북, 벤치 (YCSB/TPC-C)</td><td>SLO 위반율, 회복시간</td></tr></tbody></table><p><strong>핵심 원리</strong>: 필요한 곳만 강하게 (SIX/키 - 범위/직렬화), 나머지는 가볍게 (버전닝/행락), 그리고 관측–정책–실험의 반복.</p><h5 id=의도-락-최적화-분류-체계>의도 락 최적화 분류 체계<a hidden class=anchor aria-hidden=true href=#의도-락-최적화-분류-체계>#</a></h5><h6 id=쿼리데이터-구조>쿼리/데이터 구조<a hidden class=anchor aria-hidden=true href=#쿼리데이터-구조>#</a></h6><ul><li>무엇: 범위락 최소화 설계 (선택도 높은 인덱스, 커버링 인덱스, 트랜잭션 범위 단축).</li><li>왜: 하위 S/X 충돌 표면을 줄여 의도 락의 효과를 극대화.</li><li>어떻게: 조인 순서·프레디킷 푸시다운, 파티션 프루닝, 단일 배치 내 변경량 제한.</li></ul><table><thead><tr><th>전술</th><th>효과</th><th>위험/주의</th><th>지표</th></tr></thead><tbody><tr><td>커버링/선택도 인덱스</td><td>범위락 감소, 캐시 적중↑</td><td>쓰기 비용↑</td><td>범위락 비율, I/O 히트</td></tr><tr><td>트랜잭션 범위 단축</td><td>보유시간↓, 대기↓</td><td>애플 재시도 필요</td><td>락 보유시간, 타임아웃률</td></tr><tr><td>파티션 프루닝</td><td>충돌 도메인↓</td><td>파티션 키 설계 부담</td><td>샤드/파티션 대기</td></tr></tbody></table><ul><li>핵심: 인덱스·범위를 잘라 의도 락이 " 하위만 정확히 " 보게 만든다.</li></ul><h6 id=모드그라뉼러리티-sixisix>모드/그라뉼러리티 (SIX·IS/IX)<a hidden class=anchor aria-hidden=true href=#모드그라뉼러리티-sixisix>#</a></h6><ul><li>무엇: 테이블 SIX+ 하위 X, 상위→하위 획득 순서, 에스컬레이션 예외.</li><li>왜: 스캔 병렬성과 부분 갱신을 동시에.</li><li>어떻게: 후보 행 식별 인덱스, ROWLOCK/UPDLOCK 등 패턴, 예외 테이블은 승격 금지.</li></ul><table><thead><tr><th>전술</th><th>효과</th><th>위험/주의</th><th>지표</th></tr></thead><tbody><tr><td>SIX+ 하위 X</td><td>스캔 병렬성 + 부분 X</td><td>상위 충돌↑ 가능</td><td>상위 충돌률</td></tr><tr><td>행 우선 접근</td><td>병렬성↑</td><td>락 수↑ 메모리↑</td><td>에스컬레이션률</td></tr><tr><td>예외 테이블</td><td>승격 방지</td><td>정책 관리 복잡</td><td>승격 실패/차단 수</td></tr></tbody></table><ul><li>핵심: " 스캔은 공유, 수정은 부분 배타 " 를 규칙화.</li></ul><h6 id=격리버전닝키---범위>격리·버전닝·키 - 범위<a hidden class=anchor aria-hidden=true href=#격리버전닝키---범위>#</a></h6><ul><li>무엇: 읽기는 버전닝, 범위 정확성 필요한 경로만 키 - 범위/직렬화.</li><li>왜: 읽기 대기 제거와 강한 무결성의 균형.</li><li>어떻게: 핵심 인덱스에만 키 - 범위, 나머지는 스냅샷 읽기.</li></ul><table><thead><tr><th>전술</th><th>효과</th><th>위험/주의</th><th>지표</th></tr></thead><tbody><tr><td>스냅샷 읽기</td><td>대기 제거</td><td>재시도/검증 필요</td><td>읽기 대기시간</td></tr><tr><td>선택적 키 - 범위</td><td>팬텀 방지</td><td>지연↑</td><td>팬텀 발생/지연</td></tr><tr><td>경로별 격리</td><td>비용 최적화</td><td>복잡성↑</td><td>경로별 SLO</td></tr></tbody></table><ul><li>핵심: " 핵심 경로만 강하게 " 적용.</li></ul><h6 id=락-매니저대기-제어-런타임>락 매니저·대기 제어 (런타임)<a hidden class=anchor aria-hidden=true href=#락-매니저대기-제어-런타임>#</a></h6><ul><li>무엇: 락 자료구조·큐·보유시간 최적화.</li><li>왜: 매트릭스 판정·대기열 비용을 직접 절감.</li><li>어떻게: 락 테이블 샤딩, 고성능 해시, NUMA 로컬, CAS 큐, 타임아웃·우선순위.</li></ul><table><thead><tr><th>전술</th><th>효과</th><th>위험/주의</th><th>지표</th></tr></thead><tbody><tr><td>테이블 샤딩/NUMA</td><td>스케일↑</td><td>구현 난이도</td><td>컨텍스트 스위칭</td></tr><tr><td>CAS 대기열</td><td>경합↓</td><td>공평성 이슈</td><td>큐 대기시간</td></tr><tr><td>보유 상한/재시도</td><td>교착 완화</td><td>멱등 필요</td><td>데드락/타임아웃</td></tr></tbody></table><ul><li>핵심: 락 자체의 비용을 줄여 스루풋을 올린다.</li></ul><h6 id=분산확장-샤딩리플리카>분산·확장 (샤딩/리플리카)<a hidden class=anchor aria-hidden=true href=#분산확장-샤딩리플리카>#</a></h6><ul><li>무엇: 파티션·샤딩·리플리카와 의도 락의 결합.</li><li>왜: 충돌 도메인 축소와 읽기 분리.</li><li>어떻게: 샤드 키 기반 순서 고정, 파티션별 IS/IX/SIX 차등, 읽기 리플리카.</li></ul><table><thead><tr><th>전술</th><th>효과</th><th>위험/주의</th><th>지표</th></tr></thead><tbody><tr><td>샤드 순서 고정</td><td>교착↓</td><td>크로스샤드 지연</td><td>샤드별 대기</td></tr><tr><td>파티션별 정책</td><td>최적화↑</td><td>운영 복잡</td><td>파티션 SLO</td></tr><tr><td>리플리카 읽기</td><td>대기↓</td><td>일관성 창</td><td>스테일 비율</td></tr></tbody></table><ul><li>핵심: 데이터·시간·서비스별로 정책을 다르게 둔다.</li></ul><h6 id=관측벤치자동화>관측·벤치·자동화<a hidden class=anchor aria-hidden=true href=#관측벤치자동화>#</a></h6><ul><li>무엇: SLO 기반 폐쇄 루프.</li><li>왜: 정책 변경 효과를 수치로 검증.</li><li>어떻게: 잠금 대시보드, 경보·런북, YCSB/TPC-C 실험.</li></ul><table><thead><tr><th>전술</th><th>효과</th><th>위험/주의</th><th>지표</th></tr></thead><tbody><tr><td>대시보드/알림</td><td>이상 조기 감지</td><td>알림 피로</td><td>SLO 위반율</td></tr><tr><td>벤치마크</td><td>정량 비교</td><td>샘플링 편향</td><td>TPS/지연</td></tr><tr><td>자동 튜닝</td><td>빠른 수렴</td><td>과최적화</td><td>변경 전후 대기</td></tr></tbody></table><ul><li>핵심: 관측 없이 최적화는 없다.</li></ul><h5 id=의도-락-성능확장-통합표>의도 락 성능·확장 통합표<a hidden class=anchor aria-hidden=true href=#의도-락-성능확장-통합표>#</a></h5><table><thead><tr><th>층위</th><th>전략 묶음</th><th>대표 전술</th><th>기대 효과</th><th>주요 지표</th><th>리스크/보완</th></tr></thead><tbody><tr><td>설계</td><td>쿼리/데이터</td><td>커버링 인덱스, 범위 단축</td><td>범위락↓, 대기↓</td><td>P95 대기</td><td>쓰기 비용↑ → 배치 창 분리</td></tr><tr><td>설계</td><td>모드/그라뉼러리티</td><td>SIX+ 하위 X, 예외 테이블</td><td>스캔 병렬성 + 부분 X</td><td>상위 충돌률</td><td>상위 충돌↑ → 후보 식별 인덱스</td></tr><tr><td>런타임</td><td>락 매니저</td><td>샤딩/NUMA/CAS/재사용</td><td>판정/대기 비용↓</td><td>락 수·큐 대기</td><td>구현 난도↑ → 점진 도입</td></tr><tr><td>런타임</td><td>대기 제어</td><td>보유 상한/재시도/우선순위</td><td>교착/긴 대기↓</td><td>타임아웃·데드락</td><td>멱등 필요</td></tr><tr><td>아키텍처</td><td>분산 확장</td><td>샤딩, 파티션별 정책, 리플리카</td><td>충돌 도메인↓, 읽기 분리</td><td>샤드별 스루풋</td><td>일관성 창 → SLA 설계</td></tr><tr><td>관측</td><td>자동화</td><td>대시보드/벤치/런북</td><td>데이터 기반 튜닝</td><td>SLO 위반율</td><td>과최적화 주의</td></tr></tbody></table><h4 id=intent-락-문제-진단해결의-기술>Intent 락 문제 진단·해결의 기술<a hidden class=anchor aria-hidden=true href=#intent-락-문제-진단해결의-기술>#</a></h4><p>트러블슈팅의 핵심은 **" 상위에서 거르고, 대기는 짧게, 원인은 구조로 제거 &ldquo;**다. 먼저 <strong>대기 그래프</strong>와 **호환성 표 (LCM)**로 <strong>누가 누구를 막는지</strong>를 그려본다. 즉각 조치는 <strong>세션 정리·타임아웃·재시도</strong>로 꼬여 있는 대기를 푼다. 근본 해결은 <strong>획득 순서 표준화</strong>, <strong>에스컬레이션 임계/큐 공정성 재설정</strong>, <strong>인덱스와 파티셔닝으로 범위 축소</strong>다. 갭/키 - 범위 경합은 대개 <strong>인덱스/조건 설계</strong> 문제로 귀결되고, 장수 트랜잭션은 <strong>커밋 습관과 자동 타임아웃</strong>으로 잡는다.</p><h5 id=intent-트러블슈팅-한눈에-보기>Intent 트러블슈팅 한눈에 보기<a hidden class=anchor aria-hidden=true href=#intent-트러블슈팅-한눈에-보기>#</a></h5><table><thead><tr><th>문제 유형</th><th>근본 원인 (왜)</th><th>증상/지표 (무엇)</th><th>즉각 해결 (어떻게 -1)</th><th>근본 개선 (어떻게 -2)</th></tr></thead><tbody><tr><td>데드락</td><td>잠금 순서 불일치, 상호 업그레이드 (U→X)</td><td>타임아웃·롤백, 대기 그래프 사이클</td><td>가해 세션 종료, 타임아웃 상향/재시도 백오프</td><td><strong>획득 순서 표준화</strong>, 한 쿼리에서 읽기→쓰기 순서 고정, U 사용 최소화</td></tr><tr><td>상위 충돌 폭증</td><td>에스컬레이션 과다 (행→테이블), 대량 스캔</td><td>p95/99 지연↑, 에스컬레이션 카운트↑</td><td>에스컬레이션 임계 상향/일시 해제</td><td>인덱스 보강, 파티셔닝, 배치 스캔 시간대 분리</td></tr><tr><td>갭/키 - 범위 경합</td><td>인덱스 부재, 넓은 범위 조건</td><td>삽입 지연, Range/Gap 잠금 다발</td><td>쿼리 힌트·범위 축소, 커버링 인덱스 적용</td><td>조건 정규화, 적절한 격리 수준 선택 (RC/RR/Serializable)</td></tr><tr><td>장수 트랜잭션</td><td>대화형 세션 방치, 커밋 지연</td><td>오래된 스냅샷/락 보유, 큐 적체</td><td>세션 종료/트랜잭션 분할</td><td>업무 플로우 리팩터링, 자동 타임아웃 설정</td></tr><tr><td>호환성 오판</td><td>모드 선택 오류 (IX↔SIX 등)</td><td>예상외 대기/차단</td><td>LCM 재검토·락 힌트 조정</td><td>모드 매핑 규칙 고정·테스트 추가</td></tr><tr><td>기아/불공정 대기</td><td>큐 정책 미흡 (FIFO 없음)</td><td>특정 세션 장기 대기</td><td>우선권 부여/큐 정책 교정</td><td>공정 큐 도입, 장기 대기 탐지·승급</td></tr><tr><td>래치/내부 경합</td><td>Lock Table/Latch 경쟁</td><td>짧은 CPU 피크·긴 대기 꼬리</td><td>배치 분산, 동시 연결 제한</td><td>샤딩·핫스팟 해소, 스키마/인덱스 재설계</td></tr></tbody></table><h5 id=intent-이슈-원인---영역-분류>Intent 이슈 원인 - 영역 분류<a hidden class=anchor aria-hidden=true href=#intent-이슈-원인---영역-분류>#</a></h5><h6 id=프로토콜순서-기인-이슈>프로토콜·순서 기인 이슈<a hidden class=anchor aria-hidden=true href=#프로토콜순서-기인-이슈>#</a></h6><ul><li><strong>내용</strong>: 잠금 획득 순서 불일치, U→X 상호 업그레이드, 교차 테이블 접근 패턴.</li><li><strong>해결</strong>: <strong>리소스 획득 순서 표준화 (루트→리프/ID 오름차순)</strong>, 읽기→쓰기 단방향, 교차 테이블 접근 순서 고정, U 최소화.</li></ul><table><thead><tr><th>항목</th><th>핵심 원인</th><th>진단 포인트</th><th>즉각 조치</th><th>구조적 개선</th></tr></thead><tbody><tr><td>데드락</td><td>순서 불일치</td><td>대기 그래프 사이클</td><td>가해 세션 종료·재시도</td><td>순서 표준화·쿼리 재작성</td></tr><tr><td>업그레이드 충돌</td><td>동시 U→X</td><td>업그레이드 대기 급증</td><td>U 제거/바로 X</td><td>설계상 점유 순서 고정</td></tr></tbody></table><ul><li><strong>요약</strong>: <strong>순서</strong>만 맞추면 데드락·업그레이드 충돌 대부분이 사라진다.</li></ul><h6 id=쿼리스키마워크로드-설계-이슈>쿼리·스키마·워크로드 설계 이슈<a hidden class=anchor aria-hidden=true href=#쿼리스키마워크로드-설계-이슈>#</a></h6><ul><li><strong>내용</strong>: 인덱스 부재/비정규화로 넓은 범위 스캔, 핫스팟 키, 장수 트랜잭션.</li><li><strong>해결</strong>: <strong>인덱스/파티셔닝</strong>, 커버링 구성, 조건 정규화, 트랜잭션 분할·빠른 커밋.</li></ul><table><thead><tr><th>항목</th><th>핵심 원인</th><th>진단 포인트</th><th>즉각 조치</th><th>구조적 개선</th></tr></thead><tbody><tr><td>갭/키 - 범위 경합</td><td>인덱스 미비</td><td>Range/GAP 락 다발</td><td>힌트·조건 축소</td><td>인덱스/파티셔닝</td></tr><tr><td>장수 트랜잭션</td><td>커밋 지연</td><td>오래된 스냅샷·대기 꼬리</td><td>세션 정리</td><td>자동 타임아웃/리팩터</td></tr><tr><td>핫스팟</td><td>단일 키 집중</td><td>특정 키 대기 집중</td><td>요청 분산</td><td>해시·샤딩·캐시</td></tr></tbody></table><ul><li><strong>요약</strong>: <strong>스캔 폭을 줄이고 커밋을 빠르게</strong>, 핫스팟은 <strong>분산</strong>한다.</li></ul><h6 id=엔진-설정운영-정책-이슈>엔진 설정·운영 정책 이슈<a hidden class=anchor aria-hidden=true href=#엔진-설정운영-정책-이슈>#</a></h6><ul><li><strong>내용</strong>: 에스컬레이션 임계 과격, 공정성 없는 큐, 래치 경합, DDL 충돌.</li><li><strong>해결</strong>: 임계 상향/완화, <strong>FIFO+ 장기 대기 우대</strong>, 배치/DDL 윈도우, 연결 수 캡.</li></ul><table><thead><tr><th>항목</th><th>핵심 원인</th><th>진단 포인트</th><th>즉각 조치</th><th>구조적 개선</th></tr></thead><tbody><tr><td>상위 충돌 폭증</td><td>과도 승격</td><td>에스컬레이션 카운트↑</td><td>임계 상향</td><td>설계 리밸런싱</td></tr><tr><td>기아·불공정</td><td>큐 정책 미흡</td><td>특정 세션 장기 대기</td><td>우선권 조정</td><td>공정 큐·장기 대기 탐지</td></tr><tr><td>DDL–DML 충돌</td><td>변경 시점 혼재</td><td>Sch/Meta 락 대기</td><td>변경 작업 중단</td><td>변경 윈도우·피크 분리</td></tr></tbody></table><ul><li><strong>요약</strong>: <strong>임계·큐·윈도우</strong>를 조정하면 예측가능성이 살아난다.</li></ul><h5 id=intent-이슈-통합-처방-매트릭스>Intent 이슈 통합 처방 매트릭스<a hidden class=anchor aria-hidden=true href=#intent-이슈-통합-처방-매트릭스>#</a></h5><table><thead><tr><th>카테고리</th><th>대표 이슈</th><th>주 원인</th><th>핵심 지표/진단</th><th>즉각 조치</th><th>구조적 개선</th></tr></thead><tbody><tr><td>프로토콜·순서</td><td>데드락/업그레이드 충돌</td><td>순서 불일치/U→X 중첩</td><td>대기 그래프, 업그레이드 대기</td><td>세션 정리·재시도</td><td>획득 순서 고정·U 최소화</td></tr><tr><td>설계 (쿼리/스키마)</td><td>갭/키 - 범위 경합·핫스팟</td><td>인덱스 미비·스캔 과대</td><td>Range/GAP 락 비율·핫키 대기</td><td>힌트·범위 축소</td><td>인덱스·파티셔닝·샤딩</td></tr><tr><td>엔진/운영</td><td>상위 충돌·기아·DDL 충돌</td><td>과격 승격·불공정 큐·변경 혼재</td><td>에스컬레이션·장기 대기·Sch 락</td><td>임계/큐/윈도우 조정</td><td>정책 표준화·모니터링 상시화</td></tr></tbody></table><hr><h2 id=종합-정리-및-학습-가이드>종합 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#종합-정리-및-학습-가이드>#</a></h2><h3 id=내용-종합>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합>#</a></h3><p>Intent Modes(의도 락) 는 " 아래에서 특정 행에 락을 잡을 예정이니, 위에서는 그걸 감안해서 판단해줘 " 라는 신호다.<br>테이블에 IS/IX/SIX 같은 가벼운 플래그를 세워두면, 다른 트랜잭션이 테이블 전체를 잠그려 하거나 DDL 을 시도할 때 즉시 충돌 여부를 알 수 있다.<br>그래서 스캔·DDL·OLTP 가 섞인 환경에서 " 될 일/안 될 일 " 을 빠르게 가려 대기 시간과 불필요한 탐색을 줄인다.<br>중요한 포인트는 IX↔IX 가 호환이라는 점이다.<br>각자 서로 다른 일부 행을 만지려는 의도이므로 테이블 전체를 막지 않는다 (실제 경합은 행/키에서 X 가 잡힐 때 생긴다).<br>이 아이디어는 Gray 의 다중 그레뉼러리티 잠금에서 출발했고, 오늘날 InnoDB·Db2·SQL Server 등에서 표준처럼 사용된다. Postgres 도 명칭은 달라도 테이블/행 락과 호환표로 같은 효과를 낸다.</p><h3 id=실무-적용-가이드>실무 적용 가이드<a hidden class=anchor aria-hidden=true href=#실무-적용-가이드>#</a></h3><table><thead><tr><th>단계</th><th>체크 항목</th><th>핵심 실행 지침</th><th>합격 기준 (예시)</th></tr></thead><tbody><tr><td>사전 분석</td><td>계층/트랜잭션 분류</td><td>테이블/파티션/행 계층 정의, 읽기/쓰기/혼합 트랜잭션 식별</td><td>대상 객체·경로 다이어그램 완성</td></tr><tr><td>설계</td><td>의도 락 규칙 수립</td><td>상위 IS/IX/SIX 선취 후 하위 S/X, 범위 정확성은 키 - 범위/격리로 보완</td><td>충돌 행렬·획득 순서 문서화</td></tr><tr><td>설계</td><td>에스컬레이션 정책</td><td>임계치·예외 테이블·우선순위 정의</td><td>대량 작업 시 승격 로그 정상</td></tr><tr><td>개발</td><td>획득 순서/재시도</td><td>부모→자식 순, 타임아웃/데드락 재시도·멱등 처리</td><td>무한 대기 없음·재시도 성공률 목표치</td></tr><tr><td>개발</td><td>힌트/SQL 패턴</td><td>UPDLOCK/ROWLOCK, FOR UPDATE 등 목적 맞는 패턴 적용</td><td>경합 구간 락 범위 축소 확인</td></tr><tr><td>테스트</td><td>혼합 부하/팬텀</td><td>R/W 혼합, 범위 정확성·성능 A/B</td><td>목표 P95 대기·처리량 달성</td></tr><tr><td>운영</td><td>모니터링/알림</td><td>대기·데드락·에스컬레이션율, 장기 대기 알림</td><td>SLO 내 유지·알림 MTTR 목표치</td></tr><tr><td>확장</td><td>분산 시나리오</td><td>샤드 순서 고정, 논리락·사가로 외부 자원 동기화</td><td>교차 샤드 대기/교착 미발생</td></tr></tbody></table><h3 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h3><table><thead><tr><th>Phase</th><th>목적/핵심 주제</th><th>필수 개념</th><th>산출물 (Outcome)</th><th>권장 기간</th></tr></thead><tbody><tr><td>1 기본</td><td>Lock Modes & Compatibility 이해</td><td>S/X/IS/IX/SIX, 5×5 매트릭스, 요청→판정→대기/해제</td><td><strong>호환성 퀴즈 20 문항</strong>, 미니 파이프라인 노트</td><td>1–2 주</td></tr><tr><td>2 MGL+2PL</td><td>의도 잠금 기반 계층 락킹 숙달</td><td>상→하 IS/IX/SIX 순서, SIX 패턴, 변환/에스컬레이션, 데드락 저감</td><td><strong>락 획득/변환 시나리오 도식</strong>, 에스컬 정책 초안</td><td>2–3 주</td></tr><tr><td>3 엔진 관찰/튜닝</td><td>실제 엔진에서의 관측·진단·최적화</td><td><code>pg_locks</code>/PerfSchema/Ext.Events, 대기 체인 해석, <code>SKIP LOCKED</code></td><td><strong>관찰 리포트 1 건</strong>, 튜닝 체크리스트 v1</td><td>2–3 주</td></tr><tr><td>4 대규모 적용</td><td>대규모 워크로드에서의 설계/운영</td><td>파티션·인덱스와 의도 잠금, 배치/온라인 공존, SLO 기반 정책</td><td><strong>시뮬 워크로드 결과</strong>(대기/처리량 그래프), 운영 가이드 v1</td><td>3–4 주</td></tr></tbody></table><h3 id=학습-항목-정리>학습 항목 정리<a hidden class=anchor aria-hidden=true href=#학습-항목-정리>#</a></h3><table><thead><tr><th>Phase</th><th>목적/핵심 주제</th><th>필수 개념</th><th>산출물 (Outcome)</th><th>권장 기간</th></tr></thead><tbody><tr><td>1 기본</td><td>Lock Modes & Compatibility 이해</td><td>S/X/IS/IX/SIX, 5×5 매트릭스, 요청→판정→대기/해제</td><td><strong>호환성 퀴즈 20 문항</strong>, 미니 파이프라인 노트</td><td>1–2 주</td></tr><tr><td>2 MGL+2PL</td><td>의도 잠금 기반 계층 락킹 숙달</td><td>상→하 IS/IX/SIX 순서, SIX 패턴, 변환/에스컬레이션, 데드락 저감</td><td><strong>락 획득/변환 시나리오 도식</strong>, 에스컬 정책 초안</td><td>2–3 주</td></tr><tr><td>3 엔진 관찰/튜닝</td><td>실제 엔진에서의 관측·진단·최적화</td><td><code>pg_locks</code>/PerfSchema/Ext.Events, 대기 체인 해석, <code>SKIP LOCKED</code></td><td><strong>관찰 리포트 1 건</strong>, 튜닝 체크리스트 v1</td><td>2–3 주</td></tr><tr><td>4 대규모 적용</td><td>대규모 워크로드에서의 설계/운영</td><td>파티션·인덱스와 의도 잠금, 배치/온라인 공존, SLO 기반 정책</td><td><strong>시뮬 워크로드 결과</strong>(대기/처리량 그래프), 운영 가이드 v1</td><td>3–4 주</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리 (축)</th><th>용어 (한글·영어·약어)</th><th>정의 (핵심)</th><th>주 적용 레벨</th><th>대표 상호작용/호환 핵심</th><th>실무 활용 포인트</th></tr></thead><tbody><tr><td>의미/목적</td><td>의도 공유 (Intent Shared, IS)</td><td>하위에 S 를 둘 의도</td><td>테이블↑ → 행↓</td><td>IS 는 IS/IX/S/SIX 와 호환</td><td>대량 읽기 탐색 시 상·하위 충돌 조기 차단</td></tr><tr><td>의미/목적</td><td>의도 배타 (Intent Exclusive, IX)</td><td>하위에 X 를 둘 의도</td><td>테이블↑ → 행↓</td><td>IX 는 IS/IX 와 호환, S/SIX 와 비호환</td><td>대량 갱신 탐색 시 충돌 신호로 사용</td></tr><tr><td>의미/목적</td><td>공유 + 의도 배타 (Shared with Intent Exclusive, SIX)</td><td>상위는 S, 하위 일부 X 의도</td><td>테이블↑ ↔ 행↓</td><td>SIX 는 IS 만 호환, S/IX/SIX 비호환</td><td>대량 조회 + 부분 갱신 혼재 패턴</td></tr><tr><td>적용 레벨</td><td>다중 그라뉼러리티 (MGL, 없음)</td><td>복수 레벨 자원에 락</td><td>테이블/페이지/행/키범위</td><td>의도 락과 결합해 상수 시간 판정</td><td>계층 탐색 속도·안정성 확보</td></tr><tr><td>호환/운용</td><td>호환성 매트릭스 (Compatibility Matrix)</td><td>허용/충돌 표준 규칙</td><td>전 레벨</td><td>보유 vs 요청 상호작용의 기준</td><td>정책 일관성·튜닝·리뷰 기준</td></tr><tr><td>호환/운용</td><td>락 에스컬레이션 (Lock Escalation)</td><td>하위→상위 자동 승격</td><td>주로 테이블</td><td>락 수·메모리 제어</td><td>대규모 DML/배치 안정화</td></tr><tr><td>호환/운용</td><td>락 관리자 (Lock Manager)</td><td>부여/대기/해제 판정</td><td>시스템 내부</td><td>호환성 표로 그랜트/대기 결정</td><td>운영 지표 (대기/교착) 관측 포인트</td></tr><tr><td>호환/운용</td><td>교착상태 (Deadlock)</td><td>순환 대기</td><td>전 레벨</td><td>호환 실패·획득 순서로 발생</td><td>탐지/타임아웃/재시도 정책 설계</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://www.iso.org/standard/63556.html>ISO/IEC 9075-2:2016 — SQL/Foundation</a></li><li><a href=https://www.postgresql.org/docs/current/explicit-locking.html>PostgreSQL Documentation — Explicit Locking</a></li><li><a href=https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html>MySQL 8.0 Reference Manual — InnoDB Locking</a></li><li><a href=https://docs.microsoft.com/en-us/sql/relational-databases/sql-server-transaction-locking-and-row-versioning-guide>SQL Server — Transaction Locking and Row Versioning Guide</a></li><li><a href=https://www.oreilly.com/library/view/high-performance-mysql/9781449332471/>High Performance MySQL (O’Reilly)</a></li><li><a href=https://www.oreilly.com/library/view/designing-data-intensive-applications/9781491903063/>Designing Data-Intensive Applications (O’Reilly)</a></li><li><a href=https://www.databass.dev/>Database Internals (Alex Petrov)</a></li><li><a href=https://github.com/postgres/postgres/tree/master/src/backend/storage/lmgr>PostgreSQL Source — Lock Manager</a></li><li><a href=https://github.com/mysql/mysql-server/tree/8.0/storage/innobase/lock>MySQL InnoDB Source — lock/</a></li><li><a href=https://www.tpc.org/tpcc/>TPC-C Benchmark Specification</a></li><li><a href=https://github.com/brianfrankcooper/YCSB>YCSB — Yahoo! Cloud Serving Benchmark</a></li><li><a href=https://db-engines.com/en/ranking>DB-Engines Ranking</a></li><li><a href=https://stackoverflow.com/questions/tagged/database-locking>Stack Overflow — database-locking 태그</a></li><li><a href=https://www.reddit.com/r/Database/>Reddit — r/Database</a></li><li><a href=https://dba.stackexchange.com/>Database Administrators Stack Exchange</a></li><li><a href=https://gyrfalcon.tistory.com/entry/Intent-Lock>Intent Lock — Minsub’s Blog (Tistory)</a></li><li><a href=https://chanos.tistory.com/entry/MySQL-DB%EC%9D%98-%EB%8F%99%EC%8B%9C%EC%84%B1-%EC%A0%9C%EC%96%B4%EB%A5%BC-%EC%9C%84%ED%95%9C-Lock%EA%B3%BC-MVCC>MySQL 동시성 처리 — Lock과 MVCC (Tistory)</a></li><li><a href=https://c-king.tistory.com/580>Database Lock (1) — 자바생 (Tistory)</a></li><li><a href=https://e-ello.tistory.com/4>Database Lock — eello (Tistory)</a></li><li><a href=https://www.scribd.com/document/910077008/SQL-%E1%84%8C%E1%85%A5%E1%86%AB%E1%84%86%E1%85%AE%E1%86%AB%E1%84%80%E1%85%A1%E1%84%80%E1%85%A1%E1%84%8B%E1%85%B5%E1%84%83%E1%85%B3>SQL 전문가가이드 — Scribd</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>