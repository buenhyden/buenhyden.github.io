<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Transaction Isolation | hyunyoun's Blog</title><meta name=keywords content="Data-and-Database-Systems,Data-Operations,Transaction-Management,Transaction,Transaction-Isolation,Concurrency-Control,Data-Consistency"><meta name=description content="트랜잭션 격리(Transaction Isolation)는 ACID 속성 중 하나로, 동시에 실행되는 트랜잭션 간 간섭을 제어해 데이터 일관성을 보장한다. SQL 표준 격리 수준은 Read Uncommitted, Read Committed, Repeatable Read, Serializable로, 각 수준에 따라 Dirty/Non-Repeatable/Phantom Read 허용 여부와 성능이 달라진다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Transaction Isolation"><meta property="og:description" content="트랜잭션 격리(Transaction Isolation)는 ACID 속성 중 하나로, 동시에 실행되는 트랜잭션 간 간섭을 제어해 데이터 일관성을 보장한다. SQL 표준 격리 수준은 Read Uncommitted, Read Committed, Repeatable Read, Serializable로, 각 수준에 따라 Dirty/Non-Repeatable/Phantom Read 허용 여부와 성능이 달라진다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Transaction Isolation"><meta name=twitter:description content="트랜잭션 격리(Transaction Isolation)는 ACID 속성 중 하나로, 동시에 실행되는 트랜잭션 간 간섭을 제어해 데이터 일관성을 보장한다. SQL 표준 격리 수준은 Read Uncommitted, Read Committed, Repeatable Read, Serializable로, 각 수준에 따라 Dirty/Non-Repeatable/Phantom Read 허용 여부와 성능이 달라진다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HY's Blog","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":6,"name":"Transaction Isolation","item":"https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>HY's Blog</a></div><h1>Transaction Isolation</h1><div class=post-description>트랜잭션 격리(Transaction Isolation)는 ACID 속성 중 하나로, 동시에 실행되는 트랜잭션 간 간섭을 제어해 데이터 일관성을 보장한다. SQL 표준 격리 수준은 Read Uncommitted, Read Committed, Repeatable Read, Serializable로, 각 수준에 따라 Dirty/Non-Repeatable/Phantom Read 허용 여부와 성능이 달라진다.</div></header><div class=post-content><h2 id=transaction-isolation>Transaction Isolation<a hidden class=anchor aria-hidden=true href=#transaction-isolation>#</a></h2><p>트랜잭션 격리 (Transaction Isolation) 는 ACID 속성 중 &lsquo;I&rsquo; 에 해당하며, 다중 사용자 환경에서 데이터 무결성과 일관성을 유지하기 위해 트랜잭션 간 상호작용을 제어한다.</p><p>ANSI/ISO SQL 표준은</p><ul><li>Read Uncommitted</li><li>Read Committed</li><li>Repeatable Read</li><li>Serializable<br>네 수준을 정의하며, 각 수준은 Dirty Read, Non-repeatable Read, Phantom Read 와 같은 이상 현상 발생 가능성을 다르게 제한한다.</li></ul><p>구현 방식에는 MVCC, 2PL, Snapshot Isolation 등이 있으며, 낮은 수준은 성능을 높이지만 일관성을 약화시키고, 높은 수준은 그 반대다.</p><p>현대 분산 트랜잭션 환경에서는 SAGA, 2PC, Eventual Consistency 등과 결합해 요구사항에 맞춘 성능·정합성 균형을 설계하며, NoSQL·클라우드 환경에서도 필수 고려 요소로 작용한다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><ul><li><strong>ACID</strong>: Atomicity(원자성), Consistency(일관성), Isolation(격리성), Durability(지속성)</li><li><strong>Isolation</strong>: 병행 실행되는 트랜잭션 간 간섭을 방지하고, 데이터의 **가시성 (Visibility)**과 **순서 (Ordering)**를 제어</li></ul><ul><li><strong>직렬화 가능성 (Serializability)</strong>: 모든 트랜잭션의 실행 결과가 직렬로 실행한 결과와 동일하게 보장되는 성질</li></ul><h4 id=동시성-이상-현상-concurrency-anomalies>동시성 이상 현상 (Concurrency Anomalies)<a hidden class=anchor aria-hidden=true href=#동시성-이상-현상-concurrency-anomalies>#</a></h4><ul><li><strong>표준 (ANSI/ISO)</strong> 가 정의하는 이상 현상은 주로 <strong>Dirty / Non-repeatable / Phantom</strong> 이며, 실무에선 <strong>Lost Update</strong>와 <strong>Write Skew</strong>도 반드시 관리 대상이다.</li><li><strong>방지 기준은 " 표준 격리 수준 " + " 엔진 구현 " 의 조합</strong>으로 결정된다.<br>예: InnoDB 의 <strong>Repeatable Read</strong>는 <strong>Next-Key/GAP 잠금</strong>으로 팬텀을 실질적으로 막지만, PostgreSQL 은 **Serializable(SSI)**에서야 완전 차단.</li><li>**Snapshot 계열 (RCSI/SI)**은 읽기 성능이 뛰어나고 <strong>Lost Update</strong>는 보통 막지만 (<strong>first-committer-wins</strong>), <strong>Write Skew</strong>는 남는다 → <strong>Serializable/SSI</strong> 또는 <strong>범위잠금/검증 제약</strong>으로 보완해야 한다.</li></ul><table><thead><tr><th>이상 현상</th><th>정의/발생 조건</th><th>대표 예시</th><th>발생 가능 격리 수준 (일반론)</th><th>표준 차단 레벨 (ANSI 관점)</th><th>주요 방지 전략 (실무)</th><th>엔진별 주의 (요약)</th></tr></thead><tbody><tr><td><strong>Dirty Read</strong></td><td>타 트랜잭션의 <strong>미커밋</strong> 변경을 읽음</td><td>취소될 금액을 읽어 잔액/보고 반영</td><td><strong>RU</strong></td><td><strong>RC 이상</strong></td><td>최소 <strong>Read Committed</strong> 사용</td><td>대부분 엔진이 RC 기본 (PSQL/SQL Server), MySQL 은 RR 기본</td></tr><tr><td><strong>Non-repeatable Read</strong></td><td>같은 트랜잭션 내 <strong>동일 행 재조회</strong> 시 값 변동</td><td>재조회한 상품 가격/재고가 바뀜</td><td><strong>RU, RC</strong></td><td><strong>RR 이상</strong></td><td>RR/트랜잭션 스냅샷, 필요 시 행 잠금 (<code>FOR UPDATE</code>)</td><td>PG 의 REPEATABLE READ=스냅샷 읽기 (행 값 재조회 일관)</td></tr><tr><td><strong>Phantom Read</strong></td><td>같은 조건 재조회 시 <strong>새/사라진 행</strong>으로 집합 변동</td><td>범위 집계에 중간 삽입 행이 끼어듦</td><td><strong>RU, RC, RR(표준)</strong></td><td><strong>Serializable</strong></td><td><strong>범위/프리디킷 잠금</strong>(InnoDB <strong>Next-Key/GAP</strong>), <strong>Serializable/SSI</strong>, 인덱스 설계</td><td><strong>InnoDB RR</strong>은 Next-Key 로 <strong>사실상 차단</strong>. <strong>PG</strong>는 **Serializable(SSI)** 에서 차단</td></tr><tr><td><strong>Lost Update</strong></td><td>동시 갱신이 충돌하며 <strong>한쪽 변경 소실</strong></td><td>동시 재고 차감 중 하나가 덮여씀</td><td><strong>RU, RC, (RR 에서도 가능)</strong></td><td>표준 현상 목록 밖 (설계 이슈)</td><td><strong>X- 락/행 잠금</strong>, <strong>조건부 갱신 (버전 필드/WHERE … AND version=…)</strong>, <strong>first-committer-wins(SI)</strong></td><td>다수 엔진의 <strong>SI/RCSI</strong>는 write-write 충돌 시 한쪽 <strong>커밋 실패</strong> 처리 (소실 방지)</td></tr><tr><td><strong>Write Skew</strong></td><td>서로 <strong>다른 행</strong>을 스냅샷 기반으로 검증→각자 갱신하여 <strong>글로벌 제약 위반</strong></td><td>" 최소 1 명 on-call" 규칙이 동시 퇴근 처리로 깨짐</td><td><strong>Snapshot 계열 (SI/RCSI, PG 의 RR)</strong></td><td><strong>Serializable</strong></td><td><strong>Serializable/SSI</strong>, <strong>SELECT … FOR UPDATE</strong>로 관련 행 묶기, <strong>제약/트리거</strong>(검증)</td><td>PG: <strong>RR 에서 발생 가능</strong>, **Serializable(SSI)** 로 차단. InnoDB: 상황 따라 <strong>프리디킷/범위락</strong>으로 완화 가능</td></tr></tbody></table><blockquote><p>해석 팁</p><ul><li><strong>발생 가능 격리 수준</strong>은 일반 경향이며, **" 엔진 구현 &ldquo;** 에 따라 달라질 수 있다 (특히 Phantom/Write Skew).</li><li><strong>SI/RCSI</strong>: 읽기 성능 우수, <strong>Lost Update</strong>는 보통 막지만 <strong>Write Skew</strong>는 남는다 → <strong>핵심 규칙 구간만</strong> Serializable/락 강화.</li></ul></blockquote><ul><li><strong>Dirty/Non-repeatable</strong>: RC→RR 로 대부분 해결.</li><li><strong>Phantom</strong>: 표준 해법은 <strong>Serializable</strong>; <strong>InnoDB RR</strong>은 구현상 <strong>거의 해결</strong>.</li><li><strong>Lost Update</strong>: <strong>락/조건부 갱신/SI</strong>로 방지.</li><li><strong>Write Skew</strong>: <strong>SI 의 고질적 취약점</strong> → <strong>Serializable/SSI</strong> 또는 <strong>관련 행을 한데 잠그는 모델링</strong>이 필요.</li><li>실제 적용은 <strong>격리 수준 + 엔진 특성 + 쿼리/인덱스/제약 설계</strong>를 <strong>함께</strong> 봐야 정확히 맞는다.</li></ul><h4 id=ansi-표준-격리-수준과-현상-허용차단>ANSI 표준 격리 수준과 현상 허용/차단<a hidden class=anchor aria-hidden=true href=#ansi-표준-격리-수준과-현상-허용차단>#</a></h4><ul><li>**표준 관점:<br>**ANSI/ISO SQL-92 는 4 개 격리 수준 (RU/RC/RR/Serializable) 과 3 가지 현상 (Dirty, Non-repeatable, Phantom) 으로 격리를 규정한다. Serializable 만이 직렬 실행과 동일한 효과를 보장한다.</li><li><strong>엔진 차이의 핵심:</strong><ul><li><strong>MySQL InnoDB</strong>는 RR 에서도 <strong>Next-Key/GAP 잠금</strong>으로 삽입을 막아 팬텀을 실질적으로 차단한다.</li><li><strong>PostgreSQL</strong>은 <strong>Serializable=SSI</strong>로 팬텀/Write Skew 를 커밋 시 검출·차단하며, RR 은 스냅샷 일관이지만 팬텀/Write Skew 가 가능하다.</li><li><strong>SQL Server</strong>의 <strong>RCSI</strong>는 RC 를 <em>문장 단위 스냅샷</em>로 구현 (Dirty 차단·읽기 비차단) 하지만 트랜잭션 재조회 간 값 변동 (Non-repeatable/팬텀) 가능; <strong>SNAPSHOT</strong>은 <em>트랜잭션 단위 스냅샷</em>로 Non-repeatable/팬텀을 피하되 Write Skew 가능.</li></ul></li></ul><table><thead><tr><th>격리 수준</th><th>Dirty Read</th><th>Non-repeatable Read</th><th>Phantom Read</th><th>표준 설명</th><th>구현·주의 (대표 DBMS)</th></tr></thead><tbody><tr><td><strong>Read Uncommitted (RU)</strong></td><td><strong>허용</strong></td><td>허용</td><td>허용</td><td>미커밋 데이터도 읽을 수 있는 최저 격리. ([위키백과][2])</td><td>PostgreSQL 은 RU 를 RC 로 매핑 (사실상 RC). ([PostgreSQL][1])</td></tr><tr><td><strong>Read Committed (RC)</strong></td><td><strong>차단</strong></td><td><strong>허용</strong></td><td><strong>허용</strong></td><td>읽을 때마다 " 그 순간 커밋된 " 데이터만 보장. 재조회 시 값/집합 변동 가능. ([위키백과][2])</td><td><strong>SQL Server(RCSI ON)</strong>: RC 를 <em>문장 스냅샷</em>로 구현 (Dirty 차단, 읽기 - 쓰기 비차단) 이나 트랜잭션 재조회 시 변동 가능. ([Microsoft Learn][6], [SQLPerformance.com][7])</td></tr><tr><td><strong>Repeatable Read (RR)</strong></td><td><strong>차단</strong></td><td><strong>차단</strong></td><td><strong>허용 (표준)</strong></td><td>같은 행 재조회 일관성은 보장되나 범위 삽입/삭제는 막지 못함 (표준 정의). ([위키백과][2])</td><td><strong>InnoDB RR</strong>: <strong>Next-Key/GAP 잠금</strong>으로 팬텀까지 사실상 차단. <strong>PG RR</strong>: 스냅샷 일관 (팬텀/Write Skew 가능). ([MySQL Developer Zone][3], [PostgreSQL 위키][4])</td></tr><tr><td><strong>Serializable</strong></td><td><strong>차단</strong></td><td><strong>차단</strong></td><td><strong>차단</strong></td><td>동시 실행 결과가 어떤 직렬 순서와 동일. 표준 상 최상위 격리. ([PostgreSQL][1])</td><td><strong>PostgreSQL</strong>: <strong>SSI</strong>로 충돌 그래프 기반 차단 (Write Skew/팬텀 포함). <strong>SQL Server</strong>: 전통적 직렬화 (HOLDLOCK 등). ([PostgreSQL][1], [Microsoft Learn][5])</td></tr></tbody></table><blockquote><p>보충 메모</p><ul><li><strong>InnoDB 의 팬텀 차단</strong>: 인덱스 범위에 대해 <strong>Next-Key(=레코드 잠금 + 갭 잠금)</strong> 을 부여하여 범위 내 삽입을 봉쇄.</li><li><strong>SQL Server 스냅샷 계열</strong>: <strong>RCSI</strong>(문장 스냅샷, 기본 RC 의 구현 변화) vs <strong>SNAPSHOT</strong>(트랜잭션 스냅샷). 전자는 재조회 시 값/집합 변동 가능, 후자는 트랜잭션 동안 고정된 스냅샷을 읽음. 둘 다 버전 스토어 비용이 따른다.</li></ul></blockquote><h4 id=동시성-제어-기법>동시성 제어 기법<a hidden class=anchor aria-hidden=true href=#동시성-제어-기법>#</a></h4><ul><li><strong>Lock-based</strong><ul><li>Shared Lock, Exclusive Lock, Gap Lock</li><li>Two-Phase Locking(2PL)</li><li><strong>MVCC (Multi-Version Concurrency Control)</strong></li></ul></li><li>읽기 - 쓰기 충돌 완화, 스냅샷 읽기 제공<ul><li>Snapshot Isolation 지원</li></ul></li><li><strong>Snapshot Isolation 한계</strong><ul><li>Write Skew 가능</li></ul></li><li><strong>Serializable Snapshot Isolation (SSI)</strong><ul><li>충돌 그래프 분석으로 직렬 가능성 보장</li></ul></li><li><strong>Deadlock Detection</strong><ul><li>Wait-for Graph, Timeout 기반 탐지</li></ul></li><li><strong>Transaction Log</strong><ul><li>롤백/복구용 기록 저장</li></ul></li></ul><h4 id=write-skew>Write Skew<a hidden class=anchor aria-hidden=true href=#write-skew>#</a></h4><ul><li><strong>정의</strong>: 두 개 이상의 트랜잭션이 동시에 <strong>같은 조건을 기반으로 읽기</strong>를 하고, 이후 <strong>서로 다른 행을 수정</strong>하여 <strong>조건이 더 이상 성립하지 않는 상태</strong>를 만드는 현상.</li><li><strong>중요 포인트</strong>:<ol><li><strong>읽기 (Read)</strong> 시점에는 조건이 참 (true)</li><li><strong>동시에 실행</strong>되는 다른 트랜잭션들도 같은 조건이 참이라고 판단</li><li>서로 다른 데이터를 변경하므로 <strong>락 충돌이 없고</strong> 커밋 가능</li><li>최종적으로 조건 위반 상태가 발생</li></ol></li></ul><blockquote><p><strong>&rdquo; 회의실 예약 " 비유</strong></p><ul><li>규칙: 항상 한 개 이상의 회의실은 비워둬야 함</li><li>두 사람이 동시에 예약 페이지를 열었더니, 두 개의 회의실이 비어 있음</li><li>둘 다 " 괜찮네 " 하고 각자 다른 회의실을 예약</li><li>예약을 동시에 완료 → 결과적으로 회의실이 하나도 안 남음</li></ul></blockquote><h5 id=왜-snapshot-isolation-에서-발생하나>왜 Snapshot Isolation 에서 발생하나?<a hidden class=anchor aria-hidden=true href=#왜-snapshot-isolation-에서-발생하나>#</a></h5><ul><li>Snapshot Isolation(MVCC) 은 <strong>트랜잭션 시작 시점의 데이터 스냅샷</strong>을 기반으로 읽기 작업을 수행한다.</li><li>따라서 <strong>다른 트랜잭션이 중간에 어떤 데이터를 변경해도</strong> 내 스냅샷에는 반영되지 않는다.</li><li>이게 장점이지만, <strong>조건 검증 로직이 오래된 스냅샷에 의존</strong>하게 되어 문제 발생 가능성이 있다.</li></ul><h5 id=병원-예시-시각화-버전>병원 예시 (시각화 버전)<a hidden class=anchor aria-hidden=true href=#병원-예시-시각화-버전>#</a></h5><p><strong>규칙</strong>: 최소 한 명 이상 당직 상태여야 함 (<code>on_call = TRUE</code> 가 최소 한 명)</p><table><thead><tr><th>doctor_id</th><th>on_call</th></tr></thead><tbody><tr><td>1</td><td>TRUE</td></tr><tr><td>2</td><td>TRUE</td></tr></tbody></table><h6 id=트랜잭션-흐름>트랜잭션 흐름<a hidden class=anchor aria-hidden=true href=#트랜잭션-흐름>#</a></h6><p><strong>T1 (의사 1 퇴근 요청)</strong>:</p><ol><li>스냅샷 읽기 → 당직자 2 명 있음 → 규칙 통과</li><li><code>UPDATE doctors SET on_call = FALSE WHERE doctor_id = 1</code></li><li>커밋 준비</li></ol><p><strong>T2 (의사 2 퇴근 요청)</strong>:</p><ol><li>스냅샷 읽기 → 당직자 2 명 있음 → 규칙 통과</li><li><code>UPDATE doctors SET on_call = FALSE WHERE doctor_id = 2</code></li><li>커밋 준비</li></ol><pre class=mermaid>%% Write Skew 타임라인 (Snapshot Isolation, MVCC)
sequenceDiagram
    autonumber
    participant T1 as 트랜잭션 T1&lt;br/&gt;(의사1 퇴근)
    participant T2 as 트랜잭션 T2&lt;br/&gt;(의사2 퇴근)
    participant DB as DB&lt;br/&gt;(MVCC / Snapshot Isolation)

    Note over DB: 초기 상태 (t0):&lt;br/&gt;doctor(1)=TRUE, doctor(2)=TRUE

    rect rgba(240,240,255,0.6)
    Note over T1,T2: 동시 실행 구간 (서로 다른 행을 수정 → 직접 충돌 無)

    T1-&gt;&gt;DB: BEGIN (스냅샷 시점 = t0)
    T2-&gt;&gt;DB: BEGIN (스냅샷 시점 = t0)

    T1-&gt;&gt;DB: SELECT COUNT(*) WHERE on_call=TRUE
    DB--&gt;&gt;T1: 2  ▶ 규칙 충족(최소 1명 on_call)
    T2-&gt;&gt;DB: SELECT COUNT(*) WHERE on_call=TRUE
    DB--&gt;&gt;T2: 2  ▶ 규칙 충족(최소 1명 on_call)

    %% 서로 다른 행을 수정하므로 락 경합이 발생하지 않음
    T1-&gt;&gt;DB: UPDATE doctors SET on_call=FALSE&lt;br/&gt;WHERE doctor_id=1
    T2-&gt;&gt;DB: UPDATE doctors SET on_call=FALSE&lt;br/&gt;WHERE doctor_id=2

    T1-&gt;&gt;DB: COMMIT
    DB--&gt;&gt;T1: OK
    T2-&gt;&gt;DB: COMMIT
    DB--&gt;&gt;T2: OK
    end

    Note over DB: 최종 상태:&lt;br/&gt;doctor(1)=FALSE, doctor(2)=FALSE&lt;br/&gt;&lt;b&gt;→ 규칙 위반 (on_call 최소 1명 보장 실패)&lt;/b&gt;&lt;br/&gt;(동일 스냅샷 기반 검증으로 인한 &lt;b&gt;Write Skew&lt;/b&gt;)
</pre><h6 id=최종-결과>최종 결과<a hidden class=anchor aria-hidden=true href=#최종-결과>#</a></h6><ul><li>둘 다 커밋</li></ul><table><thead><tr><th>doctor_id</th><th>on_call</th></tr></thead><tbody><tr><td>1</td><td>FALSE</td></tr><tr><td>2</td><td>FALSE</td></tr></tbody></table><p><strong>규칙 위반</strong>: 당직자가 0 명</p><h5 id=발생-조건>발생 조건<a hidden class=anchor aria-hidden=true href=#발생-조건>#</a></h5><ul><li>Snapshot Isolation (또는 유사 MVCC)</li><li>조건 검증 후 수정하는 로직</li><li>서로 다른 행 수정 (직접적인 쓰기 충돌 없음)</li></ul><h5 id=해결-방법>해결 방법<a hidden class=anchor aria-hidden=true href=#해결-방법>#</a></h5><ol><li><strong>Serializable Isolation</strong> → 읽기 - 쓰기 충돌 감지 후 하나 롤백</li><li><strong>SELECT … FOR UPDATE</strong> → 읽기 시점에 잠금 걸어 다른 트랜잭션의 변경 차단</li><li><strong>DB 제약조건 추가</strong> → CHECK, 트리거 등으로 강제 검증</li></ol><h6 id=serializablessi>Serializable(SSI)<a hidden class=anchor aria-hidden=true href=#serializablessi>#</a></h6><ul><li>커밋 시 충돌 그래프로 감지 → 하나 롤백</li></ul><pre class=mermaid>%% Write Skew 방지: Serializable Snapshot Isolation(SSI)
sequenceDiagram
    autonumber
    participant T1 as 트랜잭션 T1&lt;br/&gt;(의사1 퇴근)
    participant T2 as 트랜잭션 T2&lt;br/&gt;(의사2 퇴근)
    participant DB as DB(SSI)&lt;br/&gt;(충돌 그래프 감지)

    Note over DB: 초기(t0): doctor(1)=TRUE, doctor(2)=TRUE

    rect rgba(240,240,255,0.6)
    Note over T1,T2: 동시 실행 (스냅샷은 동일, 서로 다른 행 수정)
    T1-&gt;&gt;DB: BEGIN (스냅샷=t0)
    T2-&gt;&gt;DB: BEGIN (스냅샷=t0)

    T1-&gt;&gt;DB: SELECT COUNT(*) WHERE on_call=TRUE
    DB--&gt;&gt;T1: 2 (규칙 통과)
    T2-&gt;&gt;DB: SELECT COUNT(*) WHERE on_call=TRUE
    DB--&gt;&gt;T2: 2 (규칙 통과)

    T1-&gt;&gt;DB: UPDATE doctors SET on_call=FALSE WHERE doctor_id=1
    T2-&gt;&gt;DB: UPDATE doctors SET on_call=FALSE WHERE doctor_id=2

    %% 커밋 시점 충돌 탐지
    T1-&gt;&gt;DB: COMMIT
    DB--&gt;&gt;T1: 준비됨(확정 대기)
    T2-&gt;&gt;DB: COMMIT
    DB--&gt;&gt;T2: 충돌 그래프 사이클 감지 ▶ 롤백(Serialization failure)
    end

    Note over DB: 최종 상태: doctor(1)=FALSE, doctor(2)=TRUE&lt;br/&gt;→ 규칙 유지(최소 1명 on_call)
</pre><p>둘 다 업데이트를 했더라도 <strong>커밋 시점</strong>에 SSI 가 읽기 - 쓰기 의존성 그래프에서 <strong>사이클</strong>을 감지해 한쪽을 실패시키므로 규칙 위반이 발생하지 않는다.</p><h6 id=select--for-update>SELECT … FOR UPDATE<a hidden class=anchor aria-hidden=true href=#select--for-update>#</a></h6><ul><li>읽기 시점에 잠금으로 동시 갱신 차단</li></ul><pre class=mermaid>%% Write Skew 방지: SELECT ... FOR UPDATE (잠금 기반)
sequenceDiagram
    autonumber
    participant T1 as 트랜잭션 T1&lt;br/&gt;(의사1 퇴근)
    participant T2 as 트랜잭션 T2&lt;br/&gt;(의사2 퇴근)
    participant DB as DB(Locking)&lt;br/&gt;(2PL/Gap Lock 등)

    Note over DB: 초기(t0): doctor(1)=TRUE, doctor(2)=TRUE

    T1-&gt;&gt;DB: BEGIN
    T1-&gt;&gt;DB: SELECT * FROM doctors WHERE on_call=TRUE FOR UPDATE
    DB--&gt;&gt;T1: 행(doctor 1,2) 잠금 획득

    T2-&gt;&gt;DB: BEGIN
    T2-&gt;&gt;DB: SELECT * FROM doctors WHERE on_call=TRUE FOR UPDATE
    DB--&gt;&gt;T2: 잠금 대기(블로킹)

    T1-&gt;&gt;DB: UPDATE doctors SET on_call=FALSE WHERE doctor_id=1
    T1-&gt;&gt;DB: COMMIT
    DB--&gt;&gt;T1: OK (잠금 해제)

    DB--&gt;&gt;T2: 잠금 획득 재개 후 재평가
    T2-&gt;&gt;DB: SELECT COUNT(*) WHERE on_call=TRUE
    DB--&gt;&gt;T2: 1 (규칙 임계치) 
    T2-&gt;&gt;DB: UPDATE doctors SET on_call=FALSE WHERE doctor_id=2
    DB--&gt;&gt;T2: 제약/비즈니스 로직 실패 ▶ 중단 또는 애플리케이션에서 취소
    T2-&gt;&gt;DB: ROLLBACK
</pre><ul><li><strong>FOR UPDATE</strong>로 " 조건을 만족하는 집합 " 을 읽는 순간 해당 행들 (또는 갭) 이 잠겨서, 다른 트랜잭션이 같은 조건으로 들어오면 <strong>대기</strong>하게 된다. T1 커밋 후 T2 가 깨어나 재평가하면 더 이상 안전하지 않으므로 애플리케이션 로직/제약조건이 변경을 막는다.</li></ul><h4 id=dbms-별-기본-격리-수준-및-특징>DBMS 별 기본 격리 수준 및 특징<a hidden class=anchor aria-hidden=true href=#dbms-별-기본-격리-수준-및-특징>#</a></h4><table><thead><tr><th>DBMS</th><th>기본 격리 수준</th><th>특징</th></tr></thead><tbody><tr><td>PostgreSQL</td><td>Read Committed</td><td>Serializable=SSI 구현</td></tr><tr><td>MySQL(InnoDB)</td><td>Repeatable Read</td><td>Gap Lock 으로 Phantom Read 차단</td></tr><tr><td>SQL Server</td><td>Read Committed</td><td>SNAPSHOT / RCSI 옵션 지원</td></tr><tr><td>Spanner</td><td>Serializable</td><td>TrueTime 기반 글로벌 직렬화</td></tr></tbody></table><h4 id=실무-적용-전략>실무 적용 전략<a hidden class=anchor aria-hidden=true href=#실무-적용-전략>#</a></h4><table><thead><tr><th>환경</th><th>권장 격리 수준</th><th>비고</th></tr></thead><tbody><tr><td>OLTP(일반 거래 시스템)</td><td>Read Committed / RCSI</td><td>성능 중심, Dirty Read 방지</td></tr><tr><td>금융/재고 관리</td><td>Serializable / SSI</td><td>데이터 무결성 최우선</td></tr><tr><td>분석/리포팅</td><td>Snapshot Isolation</td><td>락 경합 완화, 보고 일관성</td></tr><tr><td>마이크로서비스</td><td>SAGA 패턴</td><td>분산 트랜잭션 성능·복원력 균형</td></tr></tbody></table><h4 id=이론실무기본심화>이론/실무/기본/심화<a hidden class=anchor aria-hidden=true href=#이론실무기본심화>#</a></h4><table><thead><tr><th>구분</th><th>핵심 개념</th><th>설명</th></tr></thead><tbody><tr><td><strong>기본</strong></td><td>ACID 와 Isolation</td><td>트랜잭션의 4 대 특성 중 Isolation 은 간섭 방지 역할</td></tr><tr><td></td><td>격리 수준</td><td>Read Uncommitted~Serializable, 현상 차단 범위 정의</td></tr><tr><td></td><td>동시성 현상</td><td>Dirty Read, Non-repeatable Read, Phantom Read</td></tr><tr><td><strong>이론</strong></td><td>동시성 제어 기법</td><td>Lock-based, MVCC, SSI</td></tr><tr><td></td><td>직렬화 가능성</td><td>직렬 실행과 동일한 결과 보장</td></tr><tr><td><strong>실무</strong></td><td>DBMS 별 구현</td><td>엔진별 기본값과 특성 이해</td></tr><tr><td></td><td>격리 수준 선택</td><td>업무 요구에 맞춘 성능·정합성 트레이드오프</td></tr><tr><td><strong>심화</strong></td><td>분산 트랜잭션</td><td>2PC, SAGA, TrueTime</td></tr><tr><td></td><td>Snapshot Isolation 한계</td><td>Write Skew 발생 가능, SSI 로 보완</td></tr></tbody></table><p>트랜잭션 격리 수준은 <strong>데이터 정합성</strong>과 <strong>시스템 성능</strong> 간의 균형을 결정하는 핵심 요소다.<br>ANSI 표준 격리 수준은 각기 다른 동시성 현상을 허용/차단하며, 실무에서는 Lock 기반 제어나 MVCC 를 활용해 동시성과 성능을 조율한다.<br>DBMS 별 구현 차이를 이해하고, 업무 특성에 맞는 격리 수준을 선택해야 하며, 분산 환경에서는 SAGA, 2PC, TrueTime 같은 기법을 고려해야 한다. Snapshot Isolation 은 성능이 뛰어나지만 Write Skew 를 막기 위해 SSI 또는 추가 제약이 필요하다.</p><h3 id=기초-개념-foundation-understanding>기초 개념 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#기초-개념-foundation-understanding>#</a></h3><h4 id=개념-정의-및-본질적-이해>개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질적-이해>#</a></h4><p>트랜잭션 격리는 동시에 실행되는 트랜잭션의 <strong>가시성 규칙</strong>을 정해 간섭을 통제하고, 결과를 <strong>어떤 직렬 순서와 동치</strong>가 되도록 (최대 보장은 직렬화) 만드는 동시성 제어의 핵심이다.<br>SQL 표준은 더티/비반복/팬텀 읽기를 기준으로 <strong>4 수준 격리</strong>를 정의하지만, 실제 DBMS 는 <strong>MVCC·잠금·SSI</strong> 등으로 구현이 달라 동작 차이가 난다 (예: PostgreSQL 은 기본 Read Committed, Uncommitted 은 동일 취급). 결국 격리는 <strong>일관성 강화 ↔ 동시성 저하</strong>의 균형을 설계하는 문제다.</p><h4 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h4><h5 id=등장-배경>등장 배경<a hidden class=anchor aria-hidden=true href=#등장-배경>#</a></h5><p>다중 사용자 환경에서 <strong>동시성으로 인한 이상 현상</strong>(Dirty Read, Lost Update, Phantom 등) 이 빈발하자, 연구자들은 트랜잭션과 락 기반 통제를 정립했다.<br>1970 년 Codd 의 관계형 모델이 데이터 일관성·독립성을 이론적으로 제시했고, 1976 년 IBM 연구진은 <strong>2PL·프레디킷 락</strong>으로 직렬가능성 조건을 체계화했다.<br>1983 년 Härder & Reuter 는 <strong>ACID</strong>로 신뢰성 요구를 정리했고, 1992 년 <strong>SQL-92</strong>는 격리수준을 표준화했다. 이후 2PL 의 읽기 스케일 한계를 개선하려 <strong>MVCC·SI</strong>가 확산되었고, SI 의 한계는 <strong>SSI</strong>로 보완되었다.<br>상용 DB 는 <strong>RCSI</strong> 등으로 읽기/쓰기 경합을 줄이며 현대 워크로드에 맞는 격리 구현을 제공한다.</p><h5 id=발전-과정>발전 과정<a hidden class=anchor aria-hidden=true href=#발전-과정>#</a></h5><table><thead><tr><th>시기</th><th>핵심 진전</th><th>주요 인물/시스템</th><th>근거</th></tr></thead><tbody><tr><td>1970</td><td>관계형 모델 제안 → 데이터 일관성 이론 토대</td><td>E. F. Codd</td><td>([Penn Engineering][15], [ACM Digital Library][17])</td></tr><tr><td>1976</td><td>2PL·프레디킷 락으로 직렬가능성 조건 정립</td><td>Eswaran, Gray 등</td><td>([csd.uoc.gr][1], [ACM Digital Library][2])</td></tr><tr><td>1983</td><td>ACID 정식화, 복구/트랜잭션 체계</td><td>Härder, Reuter</td><td>([cs-people.bu.edu][3], [cs.cmu.edu][5])</td></tr><tr><td>1992</td><td>ANSI SQL-92 격리수준 표준화</td><td>ANSI/ISO</td><td>([Microsoft][6])</td></tr><tr><td>1990s</td><td>MVCC·SI 상용/오픈소스 확산 (Oracle/PG 등)</td><td>Oracle, PostgreSQL</td><td>([Oracle Docs][9], [PostgreSQL][8])</td></tr><tr><td>1995</td><td>ANSI 격리수준 한계·SI 정의 보완 제기</td><td>Berenson·Bernstein·Gray 등</td><td>([Microsoft][6], [arXiv][7])</td></tr><tr><td>2008</td><td>SSI 제안 (직렬가능 SI)</td><td>Cahill·Röhm·Fekete</td><td>([courses.cs.washington.edu][10], [ACM Digital Library][11])</td></tr><tr><td>2010s~</td><td>PostgreSQL SSI 구현·벤더별 RCSI 도입/권장</td><td>PostgreSQL, SQL Server</td><td>([arXiv][12], [Microsoft Learn][13])</td></tr></tbody></table><pre class=mermaid>timeline
  title Transaction Isolation 발전 타임라인
  1970 : Codd 관계형 모델 제안
  1976 : Eswaran 등 2PL·프레디킷 락
  1983 : Härder &amp; Reuter ACID 체계화
  1992 : ANSI SQL-92 격리수준 채택
  1990s : MVCC·Snapshot Isolation 확산(Oracle/PG)
  1995 : Critique of ANSI SQL, SI 명확화
  2008 : Serializable Snapshot Isolation(SSI) 제안
  2010s~ : PostgreSQL SSI 구현, SQL Server RCSI 보편화
</pre><h4 id=핵심-목적-및-필요성-문제-해결-관점>핵심 목적 및 필요성 (문제 해결 관점)<a hidden class=anchor aria-hidden=true href=#핵심-목적-및-필요성-문제-해결-관점>#</a></h4><table><thead><tr><th>카테고리</th><th>목적 (동기)</th><th>필요성 (해결 문제)</th><th>주요 수단/설계 옵션</th><th>기대 효과</th><th>측정/운영 지표</th></tr></thead><tbody><tr><td>데이터 정합성</td><td>무결성·일관성 보장</td><td>Dirty/Non-repeatable/Phantom/Lost Update/Write Skew</td><td>격리 수준 선택 (READ COMMITTED~SERIALIZABLE), MVCC/SSI, 제약·트리거, SELECT…FOR UPDATE</td><td>규칙 위반/정합성 결함 감소</td><td>정합성 결함률, 롤백률, 재시도율</td></tr><tr><td>성능/확장성</td><td>처리량·지연 균형</td><td>락 경합·교착·긴 트랜잭션로 인한 지연</td><td>MVCC/RCSI, 락 그라뉴러리티, 인덱스/쿼리튜닝, 배치/파티셔닝</td><td>TPS↑, p95/p99 지연 안정화</td><td>TPS, 대기시간, 교착 비율, 버전 GC 비용</td></tr><tr><td>예측가능성/품질</td><td>재현 가능한 결과</td><td>스냅샷/가시성 혼란, 테스트 난이도</td><td>표준 격리 계약 준수, 테스트 격리 고정, 리드/라이트 경로 분리</td><td>디버깅·테스트 단순화</td><td>테스트 실패 재현률, 회귀 버그 비율</td></tr><tr><td>운영/컴플라이언스</td><td>감사·복구 용이</td><td>변경 추적/감사, 재해복구</td><td>트랜잭션 로그, CDC, PITR/백업, 감사 테이블</td><td>사고 대응·감사 대응 강화</td><td>RTO/RPO, 감사 쿼리 시간</td></tr><tr><td>아키텍처 유연성</td><td>요구 맞춤 구성</td><td>단일/분산 트랜잭션 요구</td><td>2PC/XA, SAGA(보상), 아웃박스/이벤트 소싱</td><td>서비스 경계별 최적 격리</td><td>보상 트랜잭션 성공률, 중복 처리율</td></tr></tbody></table><ul><li><strong>데이터 정합성</strong>: 격리 수준과 MVCC/SSI, 잠금·제약을 조합해 핵심 현상 (Dirty/Phantom/Lost/Write Skew) 을 차단한다. 규칙 위반률을 지표화해 관리한다.</li><li><strong>성능/확장성</strong>: 높은 격리는 안전하지만 비용이 크다. MVCC/RCSI 로 읽기 경합을 줄이고, 인덱스/파티셔닝/튜닝으로 대기시간을 통제한다.</li><li><strong>예측가능성/품질</strong>: 표준 격리 계약을 테스트 환경에 명시적으로 반영해 " 같은 입력→같은 결과 " 를 재현 가능하게 만든다.</li><li><strong>운영/컴플라이언스</strong>: 로그·CDC·백업 체계를 격리 전략과 함께 설계하면 감사 대응과 장애 복구가 빨라진다.</li><li><strong>아키텍처 유연성</strong>: 단일 DB 는 격리로 해결, 분산 환경은 SAGA/2PC·아웃박스로 보상/정합성을 달성한다. 서비스 경계마다 다른 선택이 합리적이다.</li></ul><h4 id=주요-특징-및-차별점>주요 특징 및 차별점<a hidden class=anchor aria-hidden=true href=#주요-특징-및-차별점>#</a></h4><table><thead><tr><th>카테고리</th><th>기술적 특징</th><th>대표 DBMS 예시</th></tr></thead><tbody><tr><td>표준 격리 수준</td><td>ANSI SQL 4 단계 (RU/RC/RR/SR); 현상 (Dirty/Non-repeatable/Phantom) 으로 정의</td><td>–</td></tr><tr><td>구현 메커니즘</td><td>2PL(공유/배타 락), 타임스탬프, <strong>MVCC</strong>, <strong>SSI</strong> 등 혼용 가능</td><td>InnoDB: MVCC+ 락</td></tr><tr><td>PostgreSQL 동작</td><td>기본 <strong>READ COMMITTED</strong>; <strong>SERIALIZABLE=SSI</strong>로 직렬화 위반 감지/차단</td><td>PostgreSQL</td></tr><tr><td>MySQL(InnoDB) 동작</td><td>기본 <strong>REPEATABLE READ</strong>; 일관 읽기 (Snapshot)·락 읽기 지원</td><td>MySQL</td></tr><tr><td>SQL Server 동작</td><td>기본 <strong>READ COMMITTED</strong>; <strong>SNAPSHOT/RC_SNAPSHOT</strong> 선택 시 버전 저장소 사용</td><td>SQL Server</td></tr><tr><td>운영 트레이드오프</td><td>격리 ↑ → 직렬화에 근접, 그러나 동시성·지연·저장소 비용 ↑</td><td>모든 DBMS</td></tr></tbody></table><ul><li><strong>표준 격리 수준</strong>: ANSI 는 4 단계로 정의하지만, 실제 이상은 더 다양해 구현 보완이 필요하다.</li><li><strong>구현 메커니즘</strong>: MVCC·락·SSI 등 조합으로 동일 명칭이라도 체감 격리/성능이 달라진다.</li><li><strong>PostgreSQL</strong>: RC 기본, SR 은 SSI 기반이라 직렬화 위반을 런타임 탐지한다.</li><li><strong>MySQL(InnoDB)</strong>: RR 기본과 MVCC 로 읽기 일관성을 확보하되, 락 읽기 옵션에 따라 동작이 달라진다.</li><li><strong>SQL Server</strong>: RC 기본의 비관적 잠금을 쓰되, Snapshot 계열로 전환 시 버전 저장소 비용을 감안해야 한다.</li></ul><h3 id=핵심-원리-core-theory>핵심 원리 (Core Theory)<a hidden class=anchor aria-hidden=true href=#핵심-원리-core-theory>#</a></h3><h4 id=핵심-설계-원칙>핵심 설계 원칙<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙>#</a></h4><table><thead><tr><th>카테고리</th><th>원칙명</th><th>설명</th></tr></thead><tbody><tr><td>정확성</td><td>직렬화 가능성 원칙</td><td>모든 동시 실행 결과가 특정 순차 실행과 동일하도록 보장</td></tr><tr><td>무결성</td><td>커밋 전 비공개 원칙</td><td>트랜잭션 변경은 커밋 시점 전까지 외부에 노출 금지</td></tr><tr><td>안정성</td><td>현상 기반 정의 원칙</td><td>Dirty/Non-repeatable/Phantom Read 방지 목표로 설계</td></tr><tr><td>효율성</td><td>성능 - 일관성 균형 원칙</td><td>최소 필요 격리 수준으로 성능과 일관성 조율</td></tr><tr><td>사용성</td><td>투명성 원칙</td><td>격리 메커니즘이 애플리케이션에 투명하게 동작</td></tr><tr><td>아키텍처</td><td>확장성·모듈성 원칙</td><td>새로운 격리 수준 추가·변경이 독립적으로 가능</td></tr><tr><td>표준성</td><td>표준 호환성 원칙</td><td>ANSI SQL 및 주요 DBMS 와의 호환성 유지</td></tr><tr><td>안전성</td><td>Fail-safe 원칙</td><td>이상 탐지 시 무결성을 우선하는 보수적 처리</td></tr></tbody></table><ul><li><strong>정확성</strong>: 직렬성 확보가 핵심 목표이며, 실행 결과는 순차 실행과 동일해야 함.</li><li><strong>무결성</strong>: 커밋 이전에는 변경 내용을 절대 공개하지 않아야 함.</li><li><strong>안정성</strong>: 이상 현상 방지가 격리 수준 설계의 출발점.</li><li><strong>효율성</strong>: 과도한 격리로 인한 성능 저하를 피하고, 워크로드 특성에 맞게 최소 수준 적용.</li><li><strong>사용성</strong>: 격리 제어가 내부적으로 처리되어 개발자가 의식하지 않아도 동작.</li><li><strong>아키텍처</strong>: 모듈형 구조로 향후 확장이 용이하도록 설계.</li><li><strong>표준성</strong>: 표준 준수로 이식성과 호환성을 보장.</li><li><strong>안전성</strong>: 문제 발생 시 성능보다 무결성을 우선.</li></ul><h4 id=기본-원리-및-동작-메커니즘>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘>#</a></h4><h5 id=기본-원리>기본 원리<a hidden class=anchor aria-hidden=true href=#기본-원리>#</a></h5><table><thead><tr><th>영역</th><th>기본 원리</th><th>핵심 구성요소</th><th>차단/허용 현상 (대표)</th><th>트레이드오프</th></tr></thead><tbody><tr><td>Lock 기반 2PL</td><td><strong>획득→해제</strong> 두 단계로 잠금 관리해 직렬성 근사</td><td>S/X/의도 잠금, 락 테이블, 호환성 매트릭스</td><td>Dirty/Non-repeatable 차단, 팬텀은 <strong>범위락</strong> 필요</td><td>경합·대기·데드락↑, 처리량↓</td></tr><tr><td>범위/프리디킷 잠금</td><td>조건 (범위) 을 잠금해 <strong>팬텀 삽입/삭제</strong> 차단</td><td>인덱스 레인지 락, 갭 락, 프리디킷 락</td><td>팬텀 차단, Lost Update 차단</td><td>인덱스 의존성↑, 동시성↓</td></tr><tr><td>MVCC/Snapshot</td><td>읽기는 과거 <strong>일관 스냅샷</strong>을, 쓰기는 <strong>새 버전</strong>을 생성</td><td>버전 체인 (xmin/xmax/CSN), 가시성 규칙</td><td>Dirty/Non-repeatable 차단, <strong>Write Skew 가능</strong>(SI)</td><td>저장공간↑, 긴 Tx 가 GC 지연</td></tr><tr><td>Lost Update 방지</td><td>동시 쓰기 충돌을 <strong>잠금 또는 검증</strong>으로 방지</td><td>X- 락, 첫 커미터 우선, 비교 - 갱신 (조건부)</td><td>Lost Update 차단</td><td>재시도 필요, 충돌 시 지연</td></tr><tr><td>SSI(직렬성 검증)</td><td>MVCC 위에서 <strong>충돌 그래프</strong>로 위반 검출</td><td>읽기 - 쓰기 의존 그래프, 위험 구조 감지</td><td>Write Skew/팬텀 유발 패턴 차단</td><td>커밋 시 중단·재시도 비용</td></tr><tr><td>데드락 처리</td><td><strong>대기 그래프</strong>로 사이클 탐지 후 희생자 중단</td><td>Wait-for graph/타임아웃</td><td>교착 상태 해소</td><td>롤백 비용·스루풋 변동</td></tr><tr><td>WAL/복구</td><td>변경을 <strong>로그 선기록</strong>해 커밋 원자성·지속성 보장</td><td>WAL, Checkpoint, Redo/Undo</td><td>격리 결과 영속화</td><td>fsync 비용, 지연 관리 필요</td></tr></tbody></table><blockquote><p>현상 정리:</p><ul><li><strong>Dirty Read</strong>: RC 이상에서 차단.</li><li><strong>Non-repeatable Read</strong>: RR/Serializable, SI(트랜잭션 스냅샷) 에서 차단.</li><li><strong>Phantom</strong>: <strong>범위/프리디킷 락</strong> 또는 <strong>SSI/직렬성</strong>으로 차단.</li><li><strong>Lost Update</strong>: X- 락/첫 커미터 우선/조건부 업데이트로 차단.</li><li><strong>Write Skew</strong>: <strong>Serializable/SSI</strong> 또는 <strong>FOR UPDATE+ 제약</strong>으로 차단.</li></ul></blockquote><ul><li><strong>잠금은 강하게 막고 느려지고</strong>, <strong>MVCC 는 부드럽게 읽고 충돌 시점에 조정</strong>한다.</li><li>팬텀·Write Skew 같은 <strong>범위·검증 문제</strong>는 <strong>범위잠금/SSI/제약</strong>으로 푼다.</li><li><strong>지속성 (WAL)</strong>, <strong>데드락 처리</strong>, <strong>버전 GC</strong>는 격리의 실제 동작을 지탱하는 보조축이다.</li></ul><h5 id=동작-메커니즘>동작 메커니즘<a hidden class=anchor aria-hidden=true href=#동작-메커니즘>#</a></h5><pre class=mermaid>flowchart TB
  %% App 계층
  A[BEGIN + 격리 수준 설정] --&gt; B{요청 유형}
  B --&gt;|읽기| R1[&#34;스냅샷 확보(MVCC)\n또는 S-Lock/프리디킷 락&#34;]
  B --&gt;|쓰기| W1[쓰기 의도: 새 버전 생성 + X-Lock]

  %% 읽기 경로
  R1 --&gt; R2{범위 스캔?}
  R2 --&gt;|예| R3[갭/레인지/프리디킷 락 부여]
  R2 --&gt;|아니오| R4[&#34;가시성 판정(xmin/xmax/CSN)&#34;]
  R3 --&gt; J
  R4 --&gt; J

  %% 쓰기 경로
  W1 --&gt; W2[인덱스 갱신 + WAL 기록]

  %% 엔진 내부 공통 처리
  subgraph Engine
    J{충돌/대기 처리}
    D1[&#34;데드락 탐지\n(wait-for graph/timeout)&#34;]
    S1[&#34;SSI 검증(Serializable)\n위험 구조 감지&#34;]
  end

  W2 --&gt; J
  J --&gt;|대기| J
  J --&gt; D1
  J --&gt; S1
  D1 --&gt;|사이클| ABORT1[[&#34;트랜잭션 중단(희생자)&#34;]]
  S1 --&gt;|위반| ABORT2[[&#34;트랜잭션 중단(재시도)&#34;]]

  %% 커밋 단계
  J --&gt; C[COMMIT]
  C --&gt; L1[WAL fsync/Commit Record]
  C --&gt; L2[락/스냅샷 해제]
  C --&gt; V1[오래된 버전 GC/VACUUM]
  L1 --&gt; END[(완료)]
  L2 --&gt; END
  V1 --&gt; END
</pre><ul><li><strong>읽기</strong>는 스냅샷 또는 S/프리디킷 락으로 일관 보장, <strong>쓰기</strong>는 새 버전 +X- 락으로 충돌을 표면화한다.</li><li>충돌은 <strong>대기/데드락/SSI 검증</strong>에서 해결되고, <strong>커밋 시 WAL</strong>로 영속화·순서가 확정된다.</li><li><strong>범위 스캔은 범위잠금으로 팬텀을 예방</strong>, <strong>SSI 는 Write Skew 등 미세 위반을 커밋 직전에 차단</strong>한다.</li><li><strong>긴 트랜잭션</strong>은 버전 수명과 GC 에 영향을 주므로 운영 정책 (타임아웃/재시도/배치 분리) 이 필요하다.</li></ul><h4 id=아키텍처-및-구성-요소>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소>#</a></h4><pre class=mermaid>graph TB
    subgraph Application Layer
        APP[Application/Client]
    end

    subgraph Database Engine
        TM[Transaction Manager]
        CC[Concurrency Control Module]
        LM[Lock Manager]
        MVCC[MVCC Engine &amp; Version Store]
        VR[Visibility Rules Engine]
        LG[Log Manager]
    end

    subgraph Storage Engine
        BM[Buffer Manager]
        DM[Data Manager]
        IM[Index Manager]
        DS[Disk Storage]
    end

    subgraph Optional Distributed Layer
        DC[Distributed Commit Coordinator]
    end

    APP --&gt; TM
    TM --&gt; CC
    CC --&gt; LM
    CC --&gt; MVCC
    MVCC --&gt; VR
    LM --&gt; BM
    VR --&gt; BM
    TM --&gt; LG
    BM --&gt; DM
    DM --&gt; IM
    IM --&gt; DS
    TM --&gt; DC
</pre><h5 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h5><table><thead><tr><th>구성 요소</th><th>필수/선택</th><th>설명</th><th>역할</th><th>기능</th><th>특징</th></tr></thead><tbody><tr><td>트랜잭션 관리자 (Transaction Manager)</td><td>필수</td><td>트랜잭션 생명주기 제어</td><td>시작·커밋·롤백·격리 수준 설정</td><td>트랜잭션 ID 부여, 상태 관리</td><td>모든 트랜잭션 처리 흐름의 중심</td></tr><tr><td>동시성 제어 모듈 (Concurrency Control Module)</td><td>필수</td><td>동시성 보장·간섭 방지</td><td>Lock·MVCC·충돌 해결</td><td>2PL·타임스탬프·MVCC 적용</td><td>DBMS 별 전략 상이</td></tr><tr><td>로그 관리자 (Log Manager)</td><td>필수</td><td>Undo/Redo 로그 유지</td><td>장애 복구·데이터 무결성 보장</td><td>변경 사항 기록·재실행</td><td>Write-Ahead Logging 기반</td></tr><tr><td>저장 엔진 (Storage Engine)</td><td>필수</td><td>데이터 저장·검색</td><td>Buffer·Data·Index 관리</td><td>메모리 - 디스크 데이터 이동</td><td>성능·IO 효율 좌우</td></tr><tr><td>Lock Manager</td><td>선택</td><td>잠금 제어 전담</td><td>공유/배타/의도락·Deadlock 탐지</td><td>락 요청·해제·대기열 관리</td><td>2PL 구현 필수 요소</td></tr><tr><td>MVCC 엔진 & 버전 저장소</td><td>선택</td><td>다중 버전 데이터 관리</td><td>읽기 일관성 제공</td><td>스냅샷 제공·버전 GC</td><td>PostgreSQL·InnoDB 핵심</td></tr><tr><td>가시성 규칙 엔진 (Visibility Rules Engine)</td><td>선택</td><td>MVCC 읽기 범위 결정</td><td>트랜잭션별 읽기 허용 데이터 판별</td><td>스냅샷 시점 결정</td><td>MVCC 필수 보조 모듈</td></tr><tr><td>분산 커밋 코디네이터</td><td>선택</td><td>분산 환경 트랜잭션 일관성</td><td>2PC·병렬 커밋</td><td>글로벌 락·Write Intent 관리</td><td>분산 DB 핵심</td></tr><tr><td>Snapshot Manager</td><td>선택</td><td>스냅샷 격리 관리</td><td>스냅샷 생성·만료</td><td>고정 시점 읽기</td><td>일부 DBMS 한정</td></tr><tr><td>Optimistic Concurrency Controller</td><td>선택</td><td>낙관적 동시성 제어</td><td>충돌 적은 환경 성능 향상</td><td>사후 충돌 검증·롤백</td><td>고성능/저충돌 시 유리</td></tr></tbody></table><h5 id=lock-기반-vs-mvcc-기반-트랜잭션-처리-흐름-비교>Lock 기반 vs. MVCC 기반 트랜잭션 처리 흐름 비교<a hidden class=anchor aria-hidden=true href=#lock-기반-vs-mvcc-기반-트랜잭션-처리-흐름-비교>#</a></h5><table><thead><tr><th>구분</th><th>Lock 기반 (2PL, Strict 2PL)</th><th>MVCC 기반 (Snapshot Isolation)</th></tr></thead><tbody><tr><td><strong>읽기 요청</strong></td><td>공유 락 (S Lock) 획득 후 읽기</td><td>트랜잭션 시작 시점의 스냅샷에서 버전 읽기 (락 불필요)</td></tr><tr><td><strong>쓰기 요청</strong></td><td>배타 락 (X Lock) 획득 후 수정</td><td>새 버전 생성, 기존 버전 유지</td></tr><tr><td><strong>동시성 제어 방식</strong></td><td>락 충돌 시 대기 → 교착 상태 감지·해결 필요</td><td>읽기 - 쓰기 간 충돌 최소화, 쓰기 - 쓰기 충돌 시만 롤백</td></tr><tr><td><strong>격리 수준 보장</strong></td><td>Strict 2PL → 직렬화 보장, 하지만 동시성 저하</td><td>기본은 Snapshot Isolation(Repeatable Read 수준), 직렬화는 SSI 필요</td></tr><tr><td><strong>성능 특징</strong></td><td>읽기·쓰기 모두 락 경합 발생, 고경합 환경에서 지연 증가</td><td>읽기 병행성 높음, 버전 저장소 부담 및 GC 필요</td></tr><tr><td><strong>교착상태 (Deadlock)</strong></td><td>가능 → Deadlock Detector 필수</td><td>거의 없음 (쓰기 충돌 시 abort 처리)</td></tr><tr><td><strong>대표 DBMS</strong></td><td>전통적 SQL Server 기본 모드, 일부 OLTP 전용 DB</td><td>PostgreSQL, MySQL(InnoDB), Oracle</td></tr></tbody></table><h6 id=lock-기반-strict-2pl-vs-mvcc-기반-snapshot-isolation-트랜잭션-처리-플로우-비교>Lock 기반 (Strict 2PL) Vs MVCC 기반 (Snapshot Isolation) 트랜잭션 처리 플로우 비교<a hidden class=anchor aria-hidden=true href=#lock-기반-strict-2pl-vs-mvcc-기반-snapshot-isolation-트랜잭션-처리-플로우-비교>#</a></h6><table><thead><tr><th>구분</th><th>단계별 처리 플로우</th><th>장점</th><th>단점</th></tr></thead><tbody><tr><td><strong>Lock 기반 (Strict 2PL)</strong></td><td>1. 트랜잭션 시작<br>2. 읽기 시 <strong>공유 락</strong> 획득 → 데이터 읽기<br>3. 쓰기 시 <strong>배타 락</strong> 획득 → 데이터 변경<br>4. 모든 변경 완료 시 커밋 직전까지 락 유지<br>5. 커밋 후 락 해제<br>6. 로그 (Undo/Redo) 기록 및 트랜잭션 종료</td><td>직렬화 수준의 강력한 일관성 보장</td><td>대기·교착상태 가능성 높음, 병행성 낮음</td></tr><tr><td><strong>MVCC 기반 (Snapshot Isolation)</strong></td><td>1. 트랜잭션 시작 시 <strong>스냅샷 시점</strong> 기록<br>2. 읽기 시 해당 시점의 데이터 버전 반환 (락 불필요)<br>3. 쓰기 시 새로운 버전 생성, 기존 버전 유지<br>4. 동일 행 변경 시 커밋 시점 충돌 검사<br>5. 충돌 시 롤백, 아니면 커밋 반영<br>6. 불필요한 버전은 가비지 컬렉션 처리</td><td>읽기 병행성 우수, 대기 최소화</td><td>버전 저장소 관리 비용, Write Skew 등 추가 이상 가능</td></tr></tbody></table><h6 id=lock-기반-vs-mvcc-기반-비교-시퀀스-다이어그램>Lock 기반 vs. MVCC 기반 비교 시퀀스 다이어그램<a hidden class=anchor aria-hidden=true href=#lock-기반-vs-mvcc-기반-비교-시퀀스-다이어그램>#</a></h6><pre class=mermaid>sequenceDiagram
    participant App as Application
    participant TM as Transaction Manager
    participant LM as Lock Manager
    participant MV as MVCC Engine
    participant DB as Database Storage

    rect rgb(230,230,250)
    Note over App,DB: Lock 기반 (2PL)
    App-&gt;&gt;TM: 트랜잭션 시작
    TM-&gt;&gt;LM: 공유/배타 락 요청
    LM--&gt;&gt;TM: 락 획득(대기 가능)
    TM-&gt;&gt;DB: 읽기/쓰기 수행
    TM-&gt;&gt;LM: 커밋 시 락 해제
    TM-&gt;&gt;DB: 로그 기록
    TM--&gt;&gt;App: 커밋 완료
    end

    rect rgb(240,255,240)
    Note over App,DB: MVCC 기반 (Snapshot Isolation)
    App-&gt;&gt;TM: 트랜잭션 시작(스냅샷 생성)
    TM-&gt;&gt;MV: 읽기 요청 → 스냅샷 버전 반환
    MV-&gt;&gt;DB: 읽기 시 디스크/메모리에서 해당 버전 로드
    TM-&gt;&gt;MV: 쓰기 요청 → 새 버전 생성
    TM-&gt;&gt;MV: 커밋 시 충돌 검사
    alt 충돌 발생
        TM--&gt;&gt;App: 롤백
    else 충돌 없음
        TM-&gt;&gt;DB: 새 버전 반영
        TM--&gt;&gt;App: 커밋 완료
    end
    end
</pre><h4 id=주요-기능과-역할>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할>#</a></h4><table><thead><tr><th>기능</th><th>설명</th></tr></thead><tbody><tr><td>이상 현상 방지</td><td>Dirty Read, Non-repeatable Read, Phantom Read 방지 및 제어</td></tr><tr><td>격리 수준 관리</td><td>트랜잭션 특성에 맞는 격리 수준 (Read Uncommitted~Serializable) 설정</td></tr><tr><td>데이터 무결성 유지</td><td>동시 실행에도 데이터 일관성·정합성 보장</td></tr><tr><td>성능 - 일관성 균형 조정</td><td>격리 수준 조정을 통한 성능 최적화</td></tr><tr><td>동시성 제어</td><td>트랜잭션 간 실행 순서 및 충돌 관리</td></tr><tr><td>락 관리</td><td>2PL·Gap Lock·Predicate Lock 등을 통한 데이터 접근 제어</td></tr><tr><td>버전 관리</td><td>MVCC·Snapshot Isolation 을 통한 읽기 - 쓰기 분리</td></tr><tr><td>읽기 일관성 제공</td><td>커밋된 데이터만 읽게 하여 데이터 정확성 확보</td></tr><tr><td>분산 환경 적용</td><td>2PC, SAGA, Eventual Consistency 에서 데이터 일관성 유지</td></tr></tbody></table><h5 id=기능--역할-관계>기능 ↔ 역할 관계<a hidden class=anchor aria-hidden=true href=#기능--역할-관계>#</a></h5><table><thead><tr><th>기능</th><th>역할</th></tr></thead><tbody><tr><td>이상 현상 방지</td><td>비즈니스 로직 오동작 방지, 신뢰성 확보</td></tr><tr><td>격리 수준 관리</td><td>워크로드·비즈니스 요구에 맞춘 동시성·일관성 조정</td></tr><tr><td>데이터 무결성 유지</td><td>트랜잭션 전후 데이터 상태의 정합성 보장</td></tr><tr><td>성능 - 일관성 균형 조정</td><td>처리량·응답속도와 데이터 품질 간 최적 지점 설정</td></tr><tr><td>동시성 제어</td><td>트랜잭션 충돌 회피 및 스케줄링 안정성 보장</td></tr><tr><td>락 관리</td><td>읽기·쓰기 경합 방지 및 직렬화 가능성 확보</td></tr><tr><td>버전 관리</td><td>읽기 성능 향상 및 쓰기 지연 최소화</td></tr><tr><td>읽기 일관성 제공</td><td>사용자 쿼리 결과의 예측 가능성 보장</td></tr><tr><td>분산 환경 적용</td><td>노드 간 데이터 불일치 최소화 및 글로벌 정합성 유지</td></tr></tbody></table><p>트랜잭션 격리의 주요 기능은 <strong>이상 현상 방지</strong>와 <strong>격리 수준 관리</strong>를 중심으로 <strong>데이터 무결성과 성능 간 균형</strong>을 맞추는 데 있다. 이를 위해 **락 기반 (2PL)**과 <strong>버전 기반 (MVCC)</strong> 접근 방식을 사용하며, <strong>동시성 제어·읽기 일관성·분산 환경 적용</strong>까지 포괄한다. 기능과 역할은 서로 맞물려, 하나의 기능이 여러 역할을 동시에 수행하며 비즈니스 로직 안정성과 시스템 효율성을 동시에 추구한다.</p><h5 id=ansi-sql-격리-수준별-기능역할>ANSI SQL 격리 수준별 기능/역할<a hidden class=anchor aria-hidden=true href=#ansi-sql-격리-수준별-기능역할>#</a></h5><table><thead><tr><th>격리 수준</th><th>방지 가능한 이상 현상</th><th>주요 기능</th><th>주요 역할</th></tr></thead><tbody><tr><td><strong>Read Uncommitted</strong></td><td>없음 (Dirty Read, Non-repeatable Read, Phantom Read 모두 발생 가능)</td><td>커밋 여부와 무관하게 읽기 허용 → 최고 성능 제공</td><td>읽기 지연 최소화, 분석·모니터링 등 비중요 읽기 작업에 활용</td></tr><tr><td><strong>Read Committed</strong></td><td>Dirty Read 방지</td><td>커밋된 데이터만 읽기, 각 쿼리마다 최신 커밋 데이터 조회</td><td>운영 데이터 읽기 일관성 확보, 대부분의 OLTP 기본값 (Oracle, SQL Server RCSI)</td></tr><tr><td><strong>Repeatable Read</strong></td><td>Dirty Read, Non-repeatable Read 방지 (Phantom Read 허용)</td><td>트랜잭션 내 동일 조건 조회 시 결과 동일 보장</td><td>재조회 안정성 확보, 금융·재고 처리 등 중간 변경이 치명적인 업무</td></tr><tr><td><strong>Serializable</strong></td><td>Dirty Read, Non-repeatable Read, Phantom Read 모두 방지</td><td>완전 직렬 가능 스케줄 보장 (2PL·SSI·Predicate Lock)</td><td>데이터 무결성 절대 보장, 비즈니스 규칙·트랜잭션 충돌 위험이 큰 핵심 업무</td></tr></tbody></table><ul><li><p><strong>방지 가능한 이상 현상</strong>:</p><ul><li>Dirty Read: 다른 트랜잭션의 미커밋 데이터를 읽는 문제</li><li>Non-repeatable Read: 동일 조건의 조회 결과가 트랜잭션 중간에 바뀌는 문제</li><li>Phantom Read: 동일 조건 조회 시 새로운 행이 나타나거나 사라지는 문제</li></ul></li><li><p><strong>실무 구현 차이</strong>:</p><ul><li><strong>Read Committed</strong>: 대부분의 DBMS 기본값, Oracle/SQL Server(RCSI) 는 MVCC 로 구현 → 읽기 락 없이 Dirty Read 방지만 수행</li><li><strong>Repeatable Read</strong>: MySQL(InnoDB) 은 MVCC 기반, PostgreSQL 은 Snapshot Isolation 동작과 유사</li><li><strong>Serializable</strong>: 전통 2PL, MVCC 기반 SSI(PostgreSQL), Predicate Lock 등 다양한 구현</li></ul></li></ul><h3 id=특성-분석-characteristics-analysis>특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#특성-분석-characteristics-analysis>#</a></h3><h4 id=장점-및-이점-분석표>장점 및 이점 분석표<a hidden class=anchor aria-hidden=true href=#장점-및-이점-분석표>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거 (메커니즘)</th><th>실무 효과 (측정 지표 예시)</th></tr></thead><tbody><tr><td>정합성</td><td>데이터 무결성·일관성 보장</td><td>동시 실행 중 오염/충돌 차단</td><td>RC/RR/SI/Serializable, 2PL, 범위/프리디킷 잠금, MVCC, SSI</td><td>오류·사고 감소 (정합성 결함률↓), 재처리 비용↓</td></tr><tr><td>동시성/성능</td><td>처리량·지연 균형</td><td>읽기 비차단·충돌 최소화</td><td>MVCC/RCSI 로 읽기 비차단, X- 락/첫 커미터/조건부 업데이트, 인덱스/튜닝</td><td>TPS↑, p95/p99 지연 안정, 재시도율·교착 비율 관리</td></tr><tr><td>유연성</td><td>업무별 격리 선택</td><td>리스크/성능 목표에 따른 레벨 선택</td><td>RC/RR/SI/Serializable 조합, Gap/Next-Key/Predicate Lock 옵션</td><td>금융/재고=Serializable, OLTP=RC/RCSI, 리포팅=SI</td></tr><tr><td>개발/운영</td><td>생산성·안정성</td><td>동시성·복구를 엔진이 담당</td><td>잠금 관리자·데드락 탐지·WAL/Checkpoint·PITR/CDC</td><td>MTTR↓, 감사 대응 속도↑, 배포 리스크↓</td></tr><tr><td>표준성</td><td>이식·예측 가능</td><td>표준 격리 계약 준수</td><td>ANSI SQL Isolation Levels</td><td>벤더 독립 설계, 테스트 결정론↑</td></tr><tr><td>확장/분산</td><td>확장성·가용성</td><td>분산/리전 간 일관성 유지</td><td>Snapshot/RCSI, SAGA/2PC, 아웃박스·이벤트소싱</td><td>글로벌 트랜잭션 일관성, 보상 성공률↑</td></tr></tbody></table><ul><li>트랜잭션 격리는 <strong>정합성·성능·운영 안정성</strong>을 동시에 달성하는 핵심 장치다.</li><li><strong>Lock/MVCC/범위잠금/SSI</strong> 등 메커니즘을 업무 리스크와 성능 목표에 맞춰 조합하면, <strong>오류·사고 비용을 낮추고</strong> 처리량과 지연을 관리할 수 있다.</li><li><strong>RC/RCSI/SI/Serializable</strong>을 유즈케이스별로 선택하고, **운영 지표 (정합성 결함률, 재시도/롤백률, 교착 비율, p95/p99 지연)**로 효과를 추적하면 실제 비즈니스 가치가 극대화된다.</li></ul><h5 id=참고-격리-수준별-대표-이점>(참고) 격리 수준별 대표 이점<a hidden class=anchor aria-hidden=true href=#참고-격리-수준별-대표-이점>#</a></h5><table><thead><tr><th>레벨</th><th>대표 이점</th><th>적합 워크로드</th></tr></thead><tbody><tr><td><strong>RC</strong></td><td>커밋 데이터만 읽어 Dirty Read 차단, 경합 낮음</td><td>일반 OLTP</td></tr><tr><td><strong>RCSI/Snapshot</strong></td><td>비차단 읽기·일관 스냅샷</td><td>리포팅/읽기 많은 서비스</td></tr><tr><td><strong>RR</strong></td><td>동일 행 재조회 일관성 확보</td><td>주문·승인 플로우</td></tr><tr><td><strong>Serializable/SSI</strong></td><td>규칙 위반·Write Skew·팬텀까지 차단</td><td>금융/재고 등 강한 정합성</td></tr></tbody></table><h4 id=단점-및-제약사항과-해결방안>단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#단점-및-제약사항과-해결방안>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th><th>대안 기술</th></tr></thead><tbody><tr><td>단점</td><td>RC 의 Non-repeatable Read/Lost Update</td><td>같은 데이터 재조회 시 값 변동 또는 갱신 유실</td><td>낮은 격리 수준</td><td>데이터 불일치</td><td>쿼리 결과 비교</td><td>중요 구간만 RR/Serializable</td><td>앱 레벨 캐시·검증</td><td>MVCC</td></tr><tr><td>단점</td><td>SI 의 Write Skew</td><td>제약 우회 가능</td><td>병렬 업데이트</td><td>정책 위반</td><td>트랜잭션 로그</td><td>체크 제약, 순차 처리</td><td>SSI, 직렬화 블록</td><td>검증 트리거</td></tr><tr><td>단점</td><td>Serializable 성능 저하</td><td>충돌로 인한 Abort·지연 증가</td><td>Lock 범위 확대</td><td>처리율 감소</td><td>락 대기 모니터링</td><td>트랜잭션 소형화, 인덱스 최적화</td><td>파티셔닝, 샤딩</td><td>Snapshot Isolation</td></tr><tr><td>단점</td><td>Gap Lock 경합</td><td>범위 락으로 쓰기 대기 증가</td><td>팬텀 방지 메커니즘</td><td>처리 지연</td><td>실행계획·락 분석</td><td>커버링 인덱스, 범위 축소</td><td>SSI 기반 엔진</td><td>MySQL InnoDB 튜닝</td></tr><tr><td>단점</td><td>버전 저장소 부하</td><td>MVCC 버전 관리로 리소스 압박</td><td>장수 트랜잭션</td><td>디스크·메모리↑</td><td>버전스토어 모니터링</td><td>단위작업 분할</td><td>타임아웃, 분할 커밋</td><td>읽기 복제, ETL 분리</td></tr><tr><td>문제점</td><td>Deadlock</td><td>교착 상태</td><td>락 경쟁</td><td>트랜잭션 실패</td><td>Deadlock 그래프 분석</td><td>락 순서 표준화</td><td>피해자 롤백</td><td>Optimistic Lock</td></tr><tr><td>문제점</td><td>Livelock</td><td>반복 재시도</td><td>충돌 빈번</td><td>CPU 낭비</td><td>재시도 횟수 모니터링</td><td>백오프 전략</td><td>적응형 재시도</td><td>우선순위 스케줄링</td></tr><tr><td>문제점</td><td>오래된 스냅샷</td><td>장수 트랜잭션</td><td>버전 폭증</td><td>저장소 압박</td><td>버전스토어 모니터링</td><td>작업 분할</td><td>강제 종료</td><td>TTL 기반 정리</td></tr><tr><td>제약</td><td>분산 환경 지연·장애</td><td>네트워크·노드 장애</td><td>지연·Fail</td><td>복잡한 합의 절차</td><td>지표 모니터링</td><td>멱등성 설계</td><td>지수 백오프, 재시도</td><td>Eventual Consistency</td></tr></tbody></table><p>트랜잭션 격리의 주요 단점은 <strong>낮은 수준에서의 데이터 불일치</strong>와 <strong>높은 수준에서의 성능 저하</strong>로 양극단의 트레이드오프가 존재한다.<br>MVCC·Locking·Gap Lock·Serializable 등의 기법은 각기 다른 부작용을 유발하며, 이를 완화하기 위해 <strong>격리 수준 선택, 인덱스 최적화, 트랜잭션 소형화, 체크 제약</strong> 등 다양한 조합의 대응이 필요하다.<br>운영 환경에서는 Deadlock, Livelock, 장수 트랜잭션, 버전 저장소 부하를 지속 모니터링해야 하며, 분산 환경에서는 네트워크 지연·장애에 대비한 멱등성·재시도 전략이 필수적이다.</p><h4 id=트레이드오프-관계-분석>트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석>#</a></h4><table><thead><tr><th>비교 항목</th><th>선택지</th><th>장점</th><th>단점</th><th>적용 기준</th></tr></thead><tbody><tr><td>격리 수준</td><td>높은 격리 수준</td><td>데이터 일관성 극대화, 이상 차단</td><td>처리량·동시성 저하, 잠금 경합↑</td><td>금융·미션 크리티컬, 정확성 우선</td></tr><tr><td></td><td>낮은 격리 수준</td><td>처리량·응답속도·동시성 ↑</td><td>데이터 무결성 위험, 이상 가능성</td><td>분석·읽기 중심, 로직 보완 가능</td></tr><tr><td>동시성 제어 방식</td><td>락 기반 (2PL)</td><td>예측 가능 직렬화, 구현 단순</td><td>읽기 - 쓰기 경합 대기, 데드락 위험</td><td>경합 낮고 직렬화 필수</td></tr><tr><td></td><td>MVCC</td><td>읽기 동시성 우수, 읽기 블로킹 無</td><td>버전 저장소·GC 비용, Write Skew 가능</td><td>읽기 많고 쓰기 충돌 적음</td></tr><tr><td>성능 지표 최적화</td><td>응답 시간 최적화</td><td>개별 요청 지연 최소</td><td>전체 처리량 저하 가능</td><td>실시간 응답 요구 서비스</td></tr><tr><td></td><td>처리량 최적화</td><td>전체 효율성 극대화</td><td>개별 요청 지연 가능</td><td>대규모 배치·비동기 처리</td></tr></tbody></table><p>격리 수준, 동시성 제어 방식, 성능 지표 최적화는 서로 상충하는 목표를 가진다. 높은 격리는 안정성을, 낮은 격리는 성능을 준다. 락 기반은 예측 가능한 직렬화를, MVCC 는 읽기 성능을 준다. 응답 시간과 처리량 최적화는 환경 요구에 따라 선택해야 한다. 실무에서는 업무 특성·SLO·리스크 허용 범위를 종합적으로 고려해 최적 조합을 선택하는 것이 핵심이다.</p><h5 id=높은-격리-수준-vs-낮은-격리-수준>높은 격리 수준 vs. 낮은 격리 수준<a hidden class=anchor aria-hidden=true href=#높은-격리-수준-vs-낮은-격리-수준>#</a></h5><ul><li><strong>높은 격리 수준</strong><ul><li><strong>장점</strong>: 데이터 일관성 극대화, 이상 현상 차단</li><li><strong>단점</strong>: 처리량·동시성 저하, 잠금 경합/대기 증가</li><li><strong>적용 기준</strong>: 금융, 미션 크리티컬, 정확성이 최우선인 업무</li></ul></li><li><strong>낮은 격리 수준</strong><ul><li><strong>장점</strong>: 처리량·응답속도·동시성 극대화</li><li><strong>단점</strong>: 데이터 무결성 위험, 이상 현상 가능성</li><li><strong>적용 기준</strong>: 분석·비즈니스 로직 보완 가능 업무, 읽기 비중이 큰 워크로드</li></ul></li></ul><h5 id=락-기반-2pl-vs-버전-기반-mvcc>락 기반 (2PL) Vs 버전 기반 (MVCC)<a hidden class=anchor aria-hidden=true href=#락-기반-2pl-vs-버전-기반-mvcc>#</a></h5><ul><li><strong>락 기반</strong><ul><li><strong>장점</strong>: 예측 가능한 직렬화, 구현 단순</li><li><strong>단점</strong>: 읽기 - 쓰기 경합 시 대기, 데드락 위험</li><li><strong>적용 기준</strong>: 경합 낮고, 직렬화 필요성이 높은 환경</li></ul></li><li><strong>MVCC</strong><ul><li><strong>장점</strong>: 읽기 동시성 우수, 읽기 블로킹 없음</li><li><strong>단점</strong>: 버전 저장소·GC 비용, Write Skew 가능</li><li><strong>적용 기준</strong>: 읽기 많고, 쓰기 충돌 빈도 낮은 환경</li></ul></li></ul><h5 id=응답-시간-최적화-vs-처리량-최적화>응답 시간 최적화 Vs 처리량 최적화<a hidden class=anchor aria-hidden=true href=#응답-시간-최적화-vs-처리량-최적화>#</a></h5><ul><li><strong>응답 시간 최적화</strong><ul><li><strong>장점</strong>: 개별 트랜잭션 지연 최소화</li><li><strong>단점</strong>: 전체 처리량 감소 가능</li><li><strong>적용 기준</strong>: 실시간 응답 요구 서비스</li></ul></li><li><strong>처리량 최적화</strong><ul><li><strong>장점</strong>: 시스템 전체 효율성 극대화</li><li><strong>단점</strong>: 개별 요청 지연 가능성</li><li><strong>적용 기준</strong>: 대규모 배치, 비동기 처리 환경</li></ul></li></ul><pre class=mermaid>graph LR
    subgraph &#34;격리 수준&#34;
        RU[Read Uncommitted]
        RC[Read Committed]
        RR[Repeatable Read]
        S[Serializable]
    end
    
    subgraph &#34;성능&#34;
        HP[높은 성능]
        MP[중간 성능]
        LP[낮은 성능]
    end
    
    subgraph &#34;일관성&#34;
        LC[낮은 일관성]
        MC[중간 일관성]
        HC[높은 일관성]
    end
    
    RU --&gt; HP
    RU --&gt; LC
    RC --&gt; MP
    RC --&gt; MC
    RR --&gt; MP
    RR --&gt; MC
    S --&gt; LP
    S --&gt; HC
</pre><h4 id=성능-특성-및-확장성-분석>성능 특성 및 확장성 분석<a hidden class=anchor aria-hidden=true href=#성능-특성-및-확장성-분석>#</a></h4><p><strong>읽기는 RCSI/SI 로 비차단화, 쓰기는 충돌을 국소화 (락/조건부 갱신/SSI)</strong>, <strong>강한 정합성 구간은 Serializable/SSI 로 한정 적용</strong>, <strong>스케일 전략은 복제·샤딩·시간 동기화/합의의 조합</strong>으로 선택한다.</p><table><thead><tr><th>분류</th><th>항목</th><th>핵심 특성</th><th>기술적 근거/메커니즘</th><th>비용/리스크</th><th>적합/적용 가이드</th></tr></thead><tbody><tr><td>격리 수준</td><td>Read Uncommitted (RU)</td><td>최소 제약, 최고 처리량, 정합성 낮음</td><td>표준 정의</td><td>Dirty/Non-repeatable/Phantom 허용</td><td>내부 비핵심 캐시·ETL 등 특수 목적</td></tr><tr><td></td><td>Read Committed (RC)</td><td>커밋 데이터만 읽기, 경합 낮음</td><td>표준/PG 기본, RC=최소 표준 운영 레벨</td><td>Non-repeatable/Phantom 가능</td><td>일반 OLTP 기본값</td></tr><tr><td></td><td>RC + RCSI(SI)</td><td><strong>비차단 읽기</strong>, 일관 스냅샷</td><td>SQL Server RCSI/ALLOW_SNAPSHOT_ISOLATION</td><td>버전 스토어 용량·정리 지연 (긴 Tx)</td><td>읽기 많은 OLTP/리포팅</td></tr><tr><td></td><td>Repeatable Read (RR)</td><td>동일 행 재조회 일관</td><td>RR(+InnoDB Next-Key 로 팬텀 차단)</td><td>레인지 잠금으로 동시성 저하</td><td>주문/승인 등 재조회 일관 필요한 흐름</td></tr><tr><td></td><td>Serializable / SSI</td><td><strong>가장 강한 정합성</strong>, Write Skew/팬텀 차단</td><td>2PL 또는 <strong>SSI 충돌 그래프</strong></td><td>커밋 시 중단·재시도, 처리량↓</td><td>금융/재고 핵심 규칙 구간화 적용</td></tr><tr><td>워크로드</td><td>읽기 위주</td><td>대량 조회, 리포팅</td><td>MVCC/RCSI 스냅샷 읽기</td><td>버전 저장·GC 비용</td><td>보조 인덱스/커버링, 복제본 활용</td></tr><tr><td></td><td>쓰기/경합</td><td>단일 키 핫스팟, 재고/카운터</td><td>X- 락/첫 커미터/조건부 UPDATE</td><td>대기·교착, 재시도 루프</td><td>파티션/샤딩, 키 해싱, 배치/큐</td></tr><tr><td></td><td>혼합</td><td>읽기/쓰기 공존</td><td>읽기=RCSI, 쓰기=락/조건부/구간별 Serializable</td><td>운영 복잡도</td><td>트랜잭션 경량화, 짧은 Tx 유지</td></tr><tr><td>확장</td><td>Scale-up</td><td>코어/메모리 증설</td><td>MVCC 는 메모리↑ 효과, 락 경합은 병목</td><td>높은 코어에서 공유 구조 경합</td><td>락 경합 모니터링, 인덱스/쿼리 튜닝</td></tr><tr><td></td><td>읽기 복제본</td><td>읽기 분산</td><td>RC/RCSI 와 궁합 우수</td><td>복제 지연/정합성 경계</td><td>읽기 전용/약한 일관 허용 구간에 사용</td></tr><tr><td></td><td>샤딩</td><td>쓰기 분산, 핫스팟 완화</td><td>파티션 키 설계</td><td>교차 샤드 트랜잭션 복잡</td><td>로컬 트랜잭션 지향, 사가로 보상</td></tr><tr><td>분산 트랜잭션</td><td>2PC/XA</td><td>원자 커밋</td><td>Prepare/Commit 2 라운드</td><td><strong>지연↑·블로킹 위험</strong></td><td>소수 리소스·근거리에서 제한 사용</td></tr><tr><td>글로벌 일관성</td><td>TrueTime/외부 일관성</td><td>전 지구적 직렬화/강한 일관</td><td>Spanner OSDI'12, TT API</td><td>하드웨어/운영 비용, 지연</td><td>미션 크리티컬 글로벌 DB</td></tr></tbody></table><ul><li><strong>읽기 많은 서비스</strong>는 <strong>RCSI/SI</strong>로 비차단 일관 읽기를 확보하고, 버전 스토어 모니터링으로 부작용을 통제한다.</li><li><strong>쓰기·핵심 규칙 구간</strong>은 범위를 잠그거나 <strong>Serializable/SSI</strong>로 국소 적용해 정합성을 끝까지 지킨다.</li><li><strong>팬텀/범위 문제</strong>는 <strong>InnoDB Next-Key/GAP Lock</strong>(RR) 또는 <strong>SSI</strong>로 제어한다.</li><li><strong>확장성</strong>은 읽기 복제/샤딩/분산 트랜잭션의 조합으로 달성하되, 2PC 는 <strong>지연·블로킹</strong> 비용을 인지하고 필요 최소로만 사용한다.</li><li><strong>글로벌 트랜잭션</strong>은 <strong>TrueTime + 동기 복제</strong> 같은 특수 인프라로 외부 일관성을 실현할 수 있다. 비즈니스 임계 구간에만 적용하는 게 현실적이다.</li></ul><h3 id=구현-및-분류-implementation--classification>구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#구현-및-분류-implementation--classification>#</a></h3><h4 id=구현-기법방법>구현 기법/방법<a hidden class=anchor aria-hidden=true href=#구현-기법방법>#</a></h4><ul><li><strong>제어 축</strong>: 잠금 기반 vs 버전 기반 vs 검증 기반 (낙관/타임스탬프).</li><li><strong>목표 축</strong>: 직렬화 달성 (정확도) vs 읽기 동시성 (성능) vs 혼합.</li><li><strong>운영 축</strong>: 경합/대기 (락) vs 저장소/GC(MVCC) vs abort 재시도 (SSI/OCC/TO).</li></ul><table><thead><tr><th>분류</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td>2PL (Strict/SS2PL)</td><td>두 단계 (확장/수축) 로 락을 획득·해제</td><td>S/X/의도락, 락 테이블, 데드락 검출</td><td>커밋까지 (Strict) X 락 유지 → 직렬화</td><td>강한 일관성</td><td>쓰기 경합 높고 정확성 최우선</td><td>대기·교착 위험, 예측 가능성 높음</td></tr><tr><td>MVCC + SI</td><td>다중 버전 유지, 스냅샷 기반 읽기</td><td>버전 체인, 가시성 규칙, GC</td><td>시작 시점 스냅샷 읽기, 커밋 시 충돌 검사</td><td>읽기 동시성 극대화</td><td>읽기 다수/리포팅/HTAP</td><td>버전 저장/GC 비용, write-skew 가능</td></tr><tr><td>SSI (Serializable SI)</td><td>SI 위반 (의존성 사이클) 탐지·중단</td><td>RW- 의존성 추적, 히스토리 그래프</td><td>위험 트랜잭션 abort 로 직렬화 보장</td><td>SI 성능 + 직렬화 정확도</td><td>정확성 + 동시성 절충</td><td>abort 증가 가능, 구현 복잡</td></tr><tr><td>범위/갭/넥스트키 락</td><td>키 범위 자체를 잠금</td><td>인덱스 범위락, 갭락</td><td>삽입/범위 읽기 충돌 차단</td><td>팬텀 방지</td><td>InnoDB RR/SR</td><td>인덱스 품질 의존, 경합 증가 가능</td></tr><tr><td>Row Versioning (RCSI/SI)</td><td>읽기는 버전, 쓰기는 락</td><td>tempdb/버전저장소, Row ID</td><td>읽기 블로킹 최소화</td><td>읽기 성능</td><td>SQL Server OLTP</td><td>저장소/정리 비용, 설정 의존</td></tr><tr><td>Timestamp Ordering (TO)</td><td>타임스탬프 순서 강제</td><td>타임스탬프, read/write set</td><td>순서 위반 시 늦은 트랜잭션 abort</td><td>직관적 직렬화</td><td>충돌 드문 환경</td><td>abort 빈도↑ 가능</td></tr><tr><td>Optimistic CC (OCC)</td><td>락 없이 진행, 커밋 시 검증</td><td>read/write set, validator</td><td>검증 단계에서 충돌 시 롤백</td><td>지연 최소화</td><td>읽기많고 충돌희박</td><td>롤백 비용, 멱등 설계 필요</td></tr></tbody></table><h5 id=2pl-strict-2pl미니멀-락-매니저>2PL (Strict 2PL)—미니멀 락 매니저<a hidden class=anchor aria-hidden=true href=#2pl-strict-2pl미니멀-락-매니저>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>defaultdict</span><span class=p>,</span> <span class=n>deque</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TwoPL</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>locks</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;mode&#34;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;holders&#34;</span><span class=p>:</span> <span class=nb>set</span><span class=p>(),</span> <span class=s2>&#34;wait&#34;</span><span class=p>:</span> <span class=n>deque</span><span class=p>()})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>compatible</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>res</span><span class=p>,</span> <span class=n>req_mode</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>mode</span><span class=p>,</span> <span class=n>holders</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>locks</span><span class=p>[</span><span class=n>res</span><span class=p>][</span><span class=s2>&#34;mode&#34;</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>locks</span><span class=p>[</span><span class=n>res</span><span class=p>][</span><span class=s2>&#34;holders&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>mode</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span> <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>req_mode</span> <span class=o>==</span> <span class=s2>&#34;S&#34;</span> <span class=ow>and</span> <span class=n>mode</span> <span class=o>==</span> <span class=s2>&#34;S&#34;</span><span class=p>:</span> <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>holders</span> <span class=o>==</span> <span class=nb>set</span><span class=p>()</span> <span class=ow>and</span> <span class=n>req_mode</span> <span class=o>==</span> <span class=s2>&#34;X&#34;</span> <span class=ow>and</span> <span class=n>mode</span> <span class=ow>is</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx</span><span class=p>,</span> <span class=n>res</span><span class=p>,</span> <span class=n>mode</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>L</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>locks</span><span class=p>[</span><span class=n>res</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>L</span><span class=p>[</span><span class=s2>&#34;mode&#34;</span><span class=p>]</span> <span class=ow>in</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;S&#34;</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>mode</span> <span class=o>==</span> <span class=s2>&#34;S&#34;</span> <span class=ow>or</span> <span class=p>(</span><span class=n>mode</span> <span class=o>==</span> <span class=s2>&#34;X&#34;</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>L</span><span class=p>[</span><span class=s2>&#34;holders&#34;</span><span class=p>])):</span>
</span></span><span class=line><span class=cl>            <span class=n>L</span><span class=p>[</span><span class=s2>&#34;mode&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;X&#34;</span> <span class=k>if</span> <span class=n>mode</span> <span class=o>==</span> <span class=s2>&#34;X&#34;</span> <span class=k>else</span> <span class=n>L</span><span class=p>[</span><span class=s2>&#34;mode&#34;</span><span class=p>]</span> <span class=ow>or</span> <span class=s2>&#34;S&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>L</span><span class=p>[</span><span class=s2>&#34;holders&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>tx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>L</span><span class=p>[</span><span class=s2>&#34;wait&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>tx</span><span class=p>,</span> <span class=n>mode</span><span class=p>));</span> <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release_all</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>res</span><span class=p>,</span> <span class=n>L</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>locks</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>tx</span> <span class=ow>in</span> <span class=n>L</span><span class=p>[</span><span class=s2>&#34;holders&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>L</span><span class=p>[</span><span class=s2>&#34;holders&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>tx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>L</span><span class=p>[</span><span class=s2>&#34;holders&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=n>L</span><span class=p>[</span><span class=s2>&#34;mode&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 깨운다</span>
</span></span><span class=line><span class=cl>                    <span class=k>while</span> <span class=n>L</span><span class=p>[</span><span class=s2>&#34;wait&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                        <span class=n>n_tx</span><span class=p>,</span> <span class=n>n_mode</span> <span class=o>=</span> <span class=n>L</span><span class=p>[</span><span class=s2>&#34;wait&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>n_tx</span><span class=p>,</span> <span class=n>res</span><span class=p>,</span> <span class=n>n_mode</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                            <span class=n>L</span><span class=p>[</span><span class=s2>&#34;wait&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=mvcc--si스냅샷-읽기버전-쓰기>MVCC + SI—스냅샷 읽기/버전 쓰기<a hidden class=anchor aria-hidden=true href=#mvcc--si스냅샷-읽기버전-쓰기>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22>22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23>23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24>24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25>25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26>26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27>27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28>28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29>29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30>30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31>31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32>32</a>
</span><span class=lnt id=hl-9-33><a class=lnlinks href=#hl-9-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>bisect</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>defaultdict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MVCC</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>list</span><span class=p>)</span>  <span class=c1># key -&gt; [(ts, value, committed, tx)]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>now</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>monotonic</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>begin</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;start&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span> <span class=s2>&#34;writes&#34;</span><span class=p>:</span> <span class=p>[]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>read</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>chain</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=c1># 시작 시점 이하의 최신 커밋 버전</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>ts</span><span class=p>,</span> <span class=n>val</span><span class=p>,</span> <span class=n>committed</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=n>chain</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>ts</span> <span class=o>&lt;=</span> <span class=n>tx</span><span class=p>[</span><span class=s2>&#34;start&#34;</span><span class=p>]</span> <span class=ow>and</span> <span class=n>committed</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>val</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>write</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ts</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>tx</span><span class=p>[</span><span class=s2>&#34;writes&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>key</span><span class=p>,</span> <span class=n>ts</span><span class=p>,</span> <span class=n>value</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>commit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 간단 충돌 검사: 동일 key에 나보다 늦은 커밋이 있으면 실패</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>tsw</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>tx</span><span class=p>[</span><span class=s2>&#34;writes&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>ts</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>committed</span><span class=p>,</span> <span class=n>owner</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>key</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>committed</span> <span class=ow>and</span> <span class=n>ts</span> <span class=o>&gt;</span> <span class=n>tx</span><span class=p>[</span><span class=s2>&#34;start&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>False</span>  <span class=c1># 충돌 -&gt; abort</span>
</span></span><span class=line><span class=cl>        <span class=c1># 커밋 반영</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>tsw</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>tx</span><span class=p>[</span><span class=s2>&#34;writes&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>key</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>tsw</span><span class=p>,</span> <span class=n>val</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=n>tx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=ssirw-의존성-위험-삼각-감지의-뼈대>SSI—RW 의존성 (위험 삼각) 감지의 뼈대<a hidden class=anchor aria-hidden=true href=#ssirw-의존성-위험-삼각-감지의-뼈대>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22>22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23>23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24>24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25>25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26>26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>defaultdict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SSI</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>reads</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>set</span><span class=p>)</span>   <span class=c1># key -&gt; set(tx)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>writes</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>set</span><span class=p>)</span>  <span class=c1># key -&gt; set(tx)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>active</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>begin</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>txid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>active</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>txid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>read</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>txid</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>reads</span><span class=p>[</span><span class=n>key</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>txid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>write</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>txid</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 나보다 먼저 읽은 Tx가 있고, 그들이 또 다른 write와 교차하면 위험</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>rtx</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>reads</span><span class=p>[</span><span class=n>key</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>rtx</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>active</span> <span class=ow>and</span> <span class=n>rtx</span> <span class=o>!=</span> <span class=n>txid</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 간단한 휴리스틱: 후발 write Tx abort</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>writes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>txid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>commit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>txid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>active</span><span class=o>.</span><span class=n>discard</span><span class=p>(</span><span class=n>txid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 구현은 RW-의존 그래프 사이클 탐지까지 수행</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=범위갭넥스트키-락간단-범위-잠금-모델>범위/갭/넥스트키 락—간단 범위 잠금 모델<a hidden class=anchor aria-hidden=true href=#범위갭넥스트키-락간단-범위-잠금-모델>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>RangeLock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ranges</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># [(start,end,tx)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>collide</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>s1</span><span class=p>,</span><span class=n>e1</span><span class=p>),(</span><span class=n>s2</span><span class=p>,</span><span class=n>e2</span><span class=p>)</span> <span class=o>=</span> <span class=n>a</span><span class=p>,</span><span class=n>b</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=ow>not</span> <span class=p>(</span><span class=n>e1</span> <span class=o>&lt;=</span> <span class=n>s2</span> <span class=ow>or</span> <span class=n>e2</span> <span class=o>&lt;=</span> <span class=n>s1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>end</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=n>e</span><span class=p>,</span><span class=n>t</span><span class=p>)</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>ranges</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>collide</span><span class=p>((</span><span class=n>start</span><span class=p>,</span><span class=n>end</span><span class=p>),(</span><span class=n>s</span><span class=p>,</span><span class=n>e</span><span class=p>))</span> <span class=ow>and</span> <span class=n>t</span> <span class=o>!=</span> <span class=n>tx</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ranges</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>start</span><span class=p>,</span><span class=n>end</span><span class=p>,</span><span class=n>tx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ranges</span> <span class=o>=</span> <span class=p>[(</span><span class=n>s</span><span class=p>,</span><span class=n>e</span><span class=p>,</span><span class=n>t</span><span class=p>)</span> <span class=k>for</span> <span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=n>e</span><span class=p>,</span><span class=n>t</span><span class=p>)</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>ranges</span> <span class=k>if</span> <span class=n>t</span> <span class=o>!=</span> <span class=n>tx</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=row-versioning-rcsisi읽기-전용-버전-스토어>Row Versioning (RCSI/SI)—읽기 전용 버전 스토어<a hidden class=anchor aria-hidden=true href=#row-versioning-rcsisi읽기-전용-버전-스토어>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>defaultdict</span><span class=p>,</span> <span class=n>deque</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RowVersioning</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>store</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=n>deque</span><span class=p>)</span>  <span class=c1># key -&gt; deque of (commit_ts, value)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>write_commit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>ts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>store</span><span class=p>[</span><span class=n>key</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>ts</span><span class=p>,</span> <span class=n>value</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>read_rcsi</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>read_ts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># read_ts 이전의 최신 커밋 버전 반환 (읽기 블로킹 없음)</span>
</span></span><span class=line><span class=cl>        <span class=n>best</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>ts</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>store</span><span class=p>[</span><span class=n>key</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>ts</span> <span class=o>&lt;=</span> <span class=n>read_ts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>best</span> <span class=o>=</span> <span class=n>val</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>best</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=timestamp-ordering-to순서-위반-시-늦은-tx-중단>Timestamp Ordering (TO)—순서 위반 시 늦은 Tx 중단<a hidden class=anchor aria-hidden=true href=#timestamp-ordering-to순서-위반-시-늦은-tx-중단>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>TO</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>r_ts</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>w_ts</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>int</span><span class=p>),</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>  <span class=c1># key-&gt;ts</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>read</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx_ts</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tx_ts</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>w_ts</span><span class=p>[</span><span class=n>key</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>  <span class=c1># 너무 늦게 읽음 → abort</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>r_ts</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>r_ts</span><span class=p>[</span><span class=n>key</span><span class=p>],</span> <span class=n>tx_ts</span><span class=p>);</span> <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>write</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx_ts</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tx_ts</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>r_ts</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=ow>or</span> <span class=n>tx_ts</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>w_ts</span><span class=p>[</span><span class=n>key</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>  <span class=c1># 순서 위반 → abort</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>w_ts</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>tx_ts</span><span class=p>;</span> <span class=k>return</span> <span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=optimistic-concurrency-control-occ커밋-시-검증>Optimistic Concurrency Control (OCC)—커밋 시 검증<a hidden class=anchor aria-hidden=true href=#optimistic-concurrency-control-occ커밋-시-검증>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>OCC</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>committed</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># key -&gt; (ts, value)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>clock</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>begin</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;start&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>clock</span><span class=p>,</span> <span class=s2>&#34;readset&#34;</span><span class=p>:</span> <span class=nb>set</span><span class=p>(),</span> <span class=s2>&#34;writes&#34;</span><span class=p>:</span> <span class=p>{}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>read</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>tx</span><span class=p>[</span><span class=s2>&#34;readset&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>committed</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=kc>None</span><span class=p>))[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>write</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>tx</span><span class=p>[</span><span class=s2>&#34;writes&#34;</span><span class=p>][</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>commit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>end_ts</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>clock</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=c1># 검증: 시작 이후 해당 key가 갱신되었는지 체크</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=n>tx</span><span class=p>[</span><span class=s2>&#34;readset&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>committed</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=kc>None</span><span class=p>))[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>tx</span><span class=p>[</span><span class=s2>&#34;start&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=c1># 커밋</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>tx</span><span class=p>[</span><span class=s2>&#34;writes&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>committed</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>end_ts</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>clock</span> <span class=o>=</span> <span class=n>end_ts</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=분류-기준에-따른-유형-구분>분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분>#</a></h4><table><thead><tr><th>분류 기준</th><th>유형</th><th>방지 문제</th><th>허용 문제</th><th>특징</th><th>대표 구현/엔진</th></tr></thead><tbody><tr><td>격리 수준 (ANSI)</td><td>Read Uncommitted (RU)</td><td>없음</td><td>DR, NRR, PR, LU</td><td>보호 최소, 성능 최상</td><td>특수 분석·모니터링</td></tr><tr><td>격리 수준 (ANSI)</td><td>Read Committed (RC)</td><td>DR</td><td>NRR, PR, LU</td><td>가장 일반적, Dirty Read 방지</td><td>Oracle 기본, SQL Server 기본</td></tr><tr><td>격리 수준 (ANSI)</td><td>Repeatable Read (RR)</td><td>DR, NRR</td><td>PR</td><td>반복 읽기 일관성, 일부 팬텀 허용</td><td>PostgreSQL=SI, MySQL=팬텀 방지</td></tr><tr><td>격리 수준 (ANSI)</td><td>Serializable (SE)</td><td>DR, NRR, PR, LU</td><td>없음</td><td>완전 직렬화 가능, 성능 저하</td><td>금융·재고 트랜잭션</td></tr><tr><td>메커니즘</td><td>2PL</td><td>모든 이상 현상 방지</td><td>-</td><td>잠금 기반 직렬화, 데드락 가능</td><td>MySQL 일부, 오래된 엔진</td></tr><tr><td>메커니즘</td><td>MVCC+SI</td><td>DR, NRR 방지</td><td>PR, LU(조건부)</td><td>읽기 블로킹 없음, Write Skew 가능</td><td>PostgreSQL, Oracle</td></tr><tr><td>메커니즘</td><td>SSI</td><td>DR, NRR, PR 방지</td><td>LU(조건부)</td><td>SI 에 충돌감지 추가</td><td>PostgreSQL 9.1+</td></tr><tr><td>메커니즘</td><td>Gap/Next-Key Lock</td><td>PR 방지</td><td>-</td><td>범위 보호로 팬텀 차단</td><td>MySQL InnoDB</td></tr><tr><td>메커니즘</td><td>Optimistic Concurrency</td><td>DR, NRR 방지</td><td>PR(조건부)</td><td>충돌 시 롤백, 높은 동시성</td><td>NoSQL, 일부 ORM</td></tr></tbody></table><p>격리 수준은 ANSI SQL 표준에 따라 RU→RC→RR→SE 순으로 강해지며, 방지 가능한 이상 현상 범위가 넓어지고 성능은 떨어진다. 하지만 실제 DBMS 구현은 표준 정의와 다를 수 있어, PostgreSQL 의 RR 이 SI 로 동작하거나 MySQL InnoDB 의 RR 이 Gap Lock 으로 팬텀을 차단하는 등 차이가 있다.<br>구현 메커니즘은 2PL, MVCC, SSI, Gap Lock 등으로 다양하며, 각 메커니즘은 성능·일관성·충돌 가능성 측면에서 트레이드오프를 가진다. 따라서 이론적 표준과 실무 구현의 차이를 모두 이해하고 선택하는 것이 중요하다.</p><h5 id=ansi-표준-vs-실제-엔진별-구현-차이-비교>ANSI 표준 Vs 실제 엔진별 구현 차이 비교<a hidden class=anchor aria-hidden=true href=#ansi-표준-vs-실제-엔진별-구현-차이-비교>#</a></h5><table><thead><tr><th>격리 수준</th><th>ANSI SQL 표준 정의</th><th>PostgreSQL</th><th>MySQL InnoDB</th><th>Oracle</th><th>SQL Server</th></tr></thead><tbody><tr><td><strong>Read Uncommitted (RU)</strong></td><td>Dirty Read 허용, NRR·PR 허용</td><td>RC 와 동일 동작 (Dirty Read 미허용)</td><td>Dirty Read 허용</td><td>Dirty Read 미허용 (RC 와 동일)</td><td>Dirty Read 허용</td></tr><tr><td><strong>Read Committed (RC)</strong></td><td>Dirty Read 방지, NRR·PR 허용</td><td>MVCC 기반, 각 쿼리마다 새 스냅샷 → NRR·PR 가능</td><td>Lock 기반, 쿼리 단위 Shared Lock</td><td>기본 모드, 커밋된 데이터만 읽음</td><td>기본 모드, Lock 기반 또는 RCSI 옵션</td></tr><tr><td><strong>Repeatable Read (RR)</strong></td><td>Dirty Read·NRR 방지, PR 허용</td><td>MVCC 기반 Snapshot Isolation → Write Skew·PR 가능</td><td>Gap Lock 사용 → Phantom Read 방지 (실제로 SE 에 가까움)</td><td>제공 안 함 (기본 RC 와 SE 사이 튜닝)</td><td>Lock 기반, PR 가능 (RCSI 사용 시 MVCC 동작)</td></tr><tr><td><strong>Serializable (SE)</strong></td><td>모든 이상 현상 방지, 완전 직렬화</td><td>SSI(Serializable Snapshot Isolation) 로 MVCC+ 충돌 감지</td><td>Gap Lock·Next-Key Lock 으로 직렬화</td><td>Serializable 힌트 또는 트랜잭션 옵션 사용</td><td>Lock 기반 직렬화 또는 SNAPSHOT+SERIALIZABLE 옵션</td></tr><tr><td><strong>특이 사항</strong></td><td>이론상 이상 현상 허용/방지 범위 명확</td><td>RR=SI 라 ANSI 정의와 다름</td><td>RR 이 팬텀까지 방지 → ANSI 정의와 다름</td><td>ANSI 레벨 대신 Lock/버전 기반 최적화</td><td>RCSI(Read Committed Snapshot Isolation) 로 RC 에서도 MVCC 동작 가능</td></tr></tbody></table><ul><li><strong>PostgreSQL</strong><ul><li>RR 이 사실상 <strong>Snapshot Isolation</strong>으로 동작 → Phantom Read 와 Write Skew 가능</li><li>Serializable 은 SSI 로 구현해 MVCC 기반 직렬성 보장</li></ul></li><li><strong>MySQL InnoDB</strong><ul><li>RR 에서 <strong>Gap Lock</strong>과 <strong>Next-Key Lock</strong>을 사용해 팬텀까지 방지 → 표준 RR 보다 강함</li></ul></li><li><strong>Oracle</strong><ul><li>ANSI RR 을 별도로 제공하지 않고, RC 를 MVCC 로 구현</li><li>Serializable 은 버전 기반 직렬화</li></ul></li><li><strong>SQL Server</strong><ul><li>기본 RC 는 Lock 기반</li><li><strong>RCSI(Read Committed Snapshot Isolation)</strong> 옵션으로 RC 도 MVCC 로 동작</li><li>SNAPSHOT 격리 수준 존재, Serializable 은 Lock 기반</li></ul></li></ul><h4 id=도구-및-프레임워크-생태계>도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#도구-및-프레임워크-생태계>#</a></h4><table><thead><tr><th>카테고리</th><th>도구/시스템</th><th>정의</th><th>특징</th><th>사용 목적</th></tr></thead><tbody><tr><td>상용/오픈소스 DBMS</td><td>Oracle Database</td><td>MVCC 기반, 스냅샷 격리, AWR/ASH</td><td>안정성·성능 우수, 엔터프라이즈 표준</td><td>대규모 트랜잭션 환경</td></tr><tr><td></td><td>MySQL(InnoDB)</td><td>MVCC+ 락 하이브리드, Gap Lock</td><td>팬텀 방지, 웹서비스 다수</td><td>OLTP/웹 서비스</td></tr><tr><td></td><td>PostgreSQL</td><td>MVCC+SSI, 세밀한 잠금</td><td>높은 동시성, 직렬화 정확도</td><td>금융, 미션크리티컬</td></tr><tr><td></td><td>SQL Server</td><td>RCSI/SI, Row Versioning</td><td>읽기 블로킹 최소, tempdb 기반</td><td>ERP, 윈도우 기반</td></tr><tr><td></td><td>CockroachDB</td><td>분산 MVCC, 직렬화 보장</td><td>노드 장애 내성</td><td>클라우드 네이티브</td></tr><tr><td>테스트/검증 도구</td><td>Jepsen/Elle</td><td>동시성·격리 위반 검출</td><td>실전 분산 테스트</td><td>격리 수준 검증</td></tr><tr><td></td><td>FoundationDB Fault Injection</td><td>장애 시나리오 주입</td><td>안정성 시험</td><td>DBMS 회복력 테스트</td></tr><tr><td></td><td>TLA+</td><td>수학적 모델링</td><td>격리 속성 증명</td><td>아키텍처 설계 검증</td></tr><tr><td>프레임워크/ORM</td><td>Hibernate/JPA</td><td>Java ORM</td><td>격리 수준 지정 API</td><td>비즈니스 로직 -DB 매핑</td></tr><tr><td></td><td>Spring Transaction</td><td>트랜잭션 관리 추상화</td><td>선언형 트랜잭션</td><td>엔터프라이즈 앱</td></tr><tr><td></td><td>Sequelize/TypeORM</td><td>JS/TS ORM</td><td>SQL 추상화·격리 설정</td><td>Node.js 백엔드</td></tr><tr><td>모니터링/분석 도구</td><td>AWR/ASH (Oracle)</td><td>성능 리포트</td><td>병목·이상 분석</td><td>DBA 운영</td></tr><tr><td></td><td>Performance Schema (MySQL)</td><td>쿼리/락 추적</td><td>실시간 성능 모니터</td><td>운영 최적화</td></tr><tr><td></td><td>pg_stat_activity (PostgreSQL)</td><td>세션 상태 조회</td><td>쿼리·락 모니터</td><td>성능 튜닝</td></tr><tr><td></td><td>Datadog/New Relic</td><td>SaaS 모니터링</td><td>멀티 DB 지원</td><td>통합 관제</td></tr><tr><td></td><td>Percona PMM</td><td>오픈소스 모니터링</td><td>시각화·알람</td><td>MySQL/PostgreSQL 운영</td></tr></tbody></table><p>트랜잭션 격리 생태계는 단일 DB 엔진의 기능만으로 완성되지 않는다.</p><ul><li><strong>DBMS 계층</strong>이 기본 격리 구현과 성능을 책임지고,</li><li><strong>테스트·검증 도구</strong>가 이론적 보장을 실환경에서 확인하며,</li><li><strong>프레임워크/ORM</strong>이 애플리케이션에서 격리 수준을 제어하고,</li><li><strong>모니터링·분석 도구</strong>가 운영 중 문제를 조기에 발견·해결한다.<br>이 네 축을 균형 있게 활용해야 안정성과 성능을 모두 확보할 수 있다.</li></ul><h4 id=표준-및-규격-준수사항>표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#표준-및-규격-준수사항>#</a></h4><p>트랜잭션 격리 수준은 ANSI/ISO SQL 표준에 정의되어 있으며, 각 DBMS 는 이를 기반으로 자체 확장을 제공한다.</p><ul><li><strong>SQL-92</strong>: 4 가지 격리 수준 (READ UNCOMMITTED, READ COMMITTED, REPEATABLE READ, SERIALIZABLE) 과 각 수준에서 차단하는 현상 정의.</li><li><strong>SQL:1999</strong>: 스냅샷 격리 (Snapshot Isolation) 개념 도입, 객체·트리거 기능 확장.</li><li><strong>SQL:2003</strong>: 윈도우 함수, XML 지원 등 부가 기능 표준화.</li><li><strong>SQL:2011</strong>: Temporal Table 표준화로 시계열 데이터 접근 가능.</li><li><strong>벤더별 확장</strong>: Oracle 의 Flashback Query, PostgreSQL 의 DEFERRABLE 트랜잭션, MySQL 의 Gap Lock 등.</li><li><strong>준수 여부</strong>: 대부분 표준 격리 수준을 지원하나, 내부 구현 방식은 상이 (MVCC vs 2PL).</li></ul><table><thead><tr><th>구분</th><th>표준/규격</th><th>주요 내용</th><th>현상 정의</th><th>문법 예시</th><th>벤더별 확장</th></tr></thead><tbody><tr><td>SQL-92 (ANSI/ISO)</td><td>4 가지 격리 수준 정의</td><td>RU, RC, RR, Serializable</td><td>Dirty, Non-repeatable, Phantom Read 차단 여부 기준</td><td><code>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;</code></td><td>-</td></tr><tr><td>SQL:1999</td><td>스냅샷 격리 개념 도입</td><td>MVCC 기반 읽기 일관성 반영</td><td>Write Skew 가능성 포함</td><td>-</td><td>-</td></tr><tr><td>SQL:2003</td><td>기능 확장</td><td>윈도우 함수, XML 타입</td><td>-</td><td>-</td><td>-</td></tr><tr><td>SQL:2011</td><td>시계열 데이터 표준화</td><td>Temporal Table</td><td>-</td><td>-</td><td>-</td></tr><tr><td>Oracle</td><td>표준 + 확장</td><td>READ ONLY 트랜잭션, Flashback Query</td><td>-</td><td><code>SET TRANSACTION READ ONLY;</code></td><td>Flashback Query</td></tr><tr><td>PostgreSQL</td><td>표준 +SSI</td><td>DEFERRABLE 트랜잭션, SSI</td><td>-</td><td><code>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE READ ONLY DEFERRABLE;</code></td><td>SSI, MVCC</td></tr><tr><td>MySQL (InnoDB)</td><td>표준 + 락 확장</td><td>Gap Lock</td><td>-</td><td><code>SELECT * FROM table_name LOCK IN SHARE MODE;</code></td><td>Gap Lock</td></tr></tbody></table><p>SQL 표준은 격리 수준과 동시성 제어의 기반을 제공하지만, 각 DBMS 는 표준을 구현하는 방식에서 차이를 두고 있다.</p><ul><li><strong>SQL-92</strong>가 격리 수준 정의의 핵심 뼈대이며,</li><li>이후 표준들은 스냅샷 격리, 시간 기반 데이터 접근, 부가 기능을 추가했다.</li><li>실무에서는 표준을 참고하되, <strong>DBMS 별 구현 차이와 확장 기능</strong>을 반드시 이해해야 격리 수준을 올바르게 설정하고 성능·일관성을 균형 있게 유지할 수 있다.</li></ul><h3 id=실무-적용-practical-application>실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#실무-적용-practical-application>#</a></h3><h4 id=실제-도입-사례>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례>#</a></h4><table><thead><tr><th>도메인/문제</th><th>채택 격리/메커니즘</th><th>이유 (핵심 리스크)</th><th>운영 팁</th><th>근거</th></tr></thead><tbody><tr><td>전자상거래 재고/주문</td><td>카탈로그: RC/RCSI, 결제/재고: RR+Next-Key 또는 구간별 Serializable/SSI</td><td>오버셀링/팬텀 방지, 읽기 경합 최소화</td><td>짧은 Tx, 재시도, 파티셔닝</td><td>InnoDB Next-Key/GAP, RCSI 가이드, Serializable 재시도</td></tr><tr><td>금융 이체/원장</td><td>Serializable(2PL/SSI) + 외부 시스템 2PC/XA</td><td>금액 보전·이중지불 방지·원자 커밋</td><td>직렬화 실패 재시도, 이드엠포턴시, 감사 로그</td><td>PostgreSQL Serializable, IBM/Oracle XA 개요</td></tr><tr><td>의료 처방/검사</td><td>Serializable/SSI 또는 SELECT … FOR UPDATE</td><td>Write Skew/동시 검증 실패 방지</td><td>제약/트리거 병행, 긴 Tx 회피</td><td>Serializable 설계 원칙</td></tr><tr><td>회계 마감/정산</td><td>OLTP: RC/RCSI, 리포팅/마감: Snapshot + 국소 Serializable</td><td>보고 일관성 vs 온라인 경합 완화</td><td>배치 창 분리, I/O 분리</td><td>SQL Server Snapshot/RCSI</td></tr><tr><td>글로벌 주문/다중 리전</td><td>TrueTime 기반 DB 또는 RDB+ 사가 (최종 직렬화)</td><td>전 지구적 일관/유니크, 네트워크 지연</td><td>리전 경계 모델링, 보상 플로우</td><td>Spanner OSDI'12 / Brewer 논문</td></tr></tbody></table><h4 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h4><h5 id=실습-예제-postgresql-python>실습 예제: PostgreSQL, Python<a hidden class=anchor aria-hidden=true href=#실습-예제-postgresql-python>#</a></h5><p><strong>학습 목표</strong>: RC/RR/Serializable 에서 <strong>Non-repeatable/Phantom/Write Skew</strong> 차이를 실습<br><strong>시나리오</strong>: 재고 감소와 조회가 경합<br><strong>시스템 구성</strong>:</p><ul><li>PostgreSQL 15+, psycopg</li><li>애플리케이션 2 개 워커 (Reader/Writer)</li></ul><pre class=mermaid>graph TB
  App1[Reader Tx] --&gt;|RC or SI| PG[(PostgreSQL)]
  App2[Writer Tx] --&gt; PG
  PG --&gt; VS[MVCC/SSI]
</pre><p><strong>Workflow</strong></p><ol><li>Tx A 가 재고 읽기</li><li>Tx B 가 재고 갱신 후 커밋</li><li>Tx A 가 재조회 (RC vs RR 비교)</li></ol><p><strong>유무 차이</strong></p><ul><li>도입 전 (RC): 재조회 값 변동 가능</li><li>도입 후 (RR/Serializable): 재조회 일관/팬텀 차단</li></ul><p><strong>구현 예시</strong>: Python/psycopg</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33>33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34>34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35>35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36>36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37>37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38>38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39>39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40>40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41>41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42>42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43>43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44>44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45>45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46>46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47>47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48>48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49>49</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>txn</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=n>iso</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Isolation 수준 설정</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cur</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;BEGIN TRANSACTION ISOLATION LEVEL </span><span class=si>{</span><span class=n>iso</span><span class=si>}</span><span class=s2>;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>yield</span> <span class=n>conn</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cur</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;drop table if exists stock; create table stock(id int primary key, qty int);&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;insert into stock values (1, 10);&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Non-repeatable Read 관찰 (READ COMMITTED)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>non_repeatable_demo</span><span class=p>(</span><span class=n>conn_a</span><span class=p>,</span> <span class=n>conn_b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>setup</span><span class=p>(</span><span class=n>conn_a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>txn</span><span class=p>(</span><span class=n>conn_a</span><span class=p>,</span> <span class=s2>&#34;READ COMMITTED&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>conn_a</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>ca</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ca</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;select qty from stock where id=1;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;A first read:&#34;</span><span class=p>,</span> <span class=n>ca</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>  <span class=c1># RC: 10</span>
</span></span><span class=line><span class=cl>            <span class=c1># B가 업데이트</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>txn</span><span class=p>(</span><span class=n>conn_b</span><span class=p>,</span> <span class=s2>&#34;READ COMMITTED&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=n>conn_b</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cb</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>cb</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;update stock set qty=qty-5 where id=1;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>ca</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;select qty from stock where id=1;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;A second read:&#34;</span><span class=p>,</span> <span class=n>ca</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>  <span class=c1># RC: 5 (비반복 읽기 발생)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Phantom 방지 (SERIALIZABLE에서 범위 조건)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>phantom_block_demo</span><span class=p>(</span><span class=n>conn_a</span><span class=p>,</span> <span class=n>conn_b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>setup</span><span class=p>(</span><span class=n>conn_a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>txn</span><span class=p>(</span><span class=n>conn_a</span><span class=p>,</span> <span class=s2>&#34;SERIALIZABLE&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>conn_a</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>ca</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ca</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;select count(*) from stock where qty &gt;= 10;&#34;</span><span class=p>)</span>  <span class=c1># 범위 쿼리</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;A count:&#34;</span><span class=p>,</span> <span class=n>ca</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=c1># B가 조건을 만족하는 행을 추가하려 시도</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=n>txn</span><span class=p>(</span><span class=n>conn_b</span><span class=p>,</span> <span class=s2>&#34;SERIALIZABLE&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=k>with</span> <span class=n>conn_b</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cb</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>cb</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;insert into stock values (2, 20);&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;B aborted due to serialization:&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>  <span class=c1># SSI가 충돌 감지 가능</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>첫 함수는 <strong>RC 에서 Non-repeatable Read</strong>를 보여준다 (재조회 값 변동).</li><li>두 번째는 <strong>Serializable/SSI 에서 팬텀 방지/충돌 중단</strong>을 시연한다.</li></ul><h5 id=실습-예제-격리-수준별-동작-방식과-동시성-문제-해결-과정-이해>실습 예제: 격리 수준별 동작 방식과 동시성 문제 해결 과정 이해<a hidden class=anchor aria-hidden=true href=#실습-예제-격리-수준별-동작-방식과-동시성-문제-해결-과정-이해>#</a></h5><p><strong>학습 목표</strong>: Transaction Isolation 의 각 격리 수준별 동작 방식과 동시성 문제 해결 과정 이해</p><p><strong>시나리오</strong>: 온라인 도서 대여 시스템에서 동시에 여러 사용자가 같은 책을 대여하려고 할 때의 처리</p><p><strong>시스템 구성</strong>:</p><ul><li>웹 애플리케이션 서버 (Python Flask)</li><li>데이터베이스 (PostgreSQL)</li><li>연결 풀 (psycopg2)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Client Layer&#34;
        U1[User 1]
        U2[User 2]
        U3[User 3]
    end
    
    subgraph &#34;Application Layer&#34;
        APP[Flask Application]
        CP[Connection Pool]
    end
    
    subgraph &#34;Database Layer&#34;
        PG[PostgreSQL]
        TM[Transaction Manager]
        LM[Lock Manager]
    end
    
    U1 --&gt; APP
    U2 --&gt; APP
    U3 --&gt; APP
    APP --&gt; CP
    CP --&gt; PG
    PG --&gt; TM
    TM --&gt; LM
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 도서 대여 요청</li><li>애플리케이션이 재고 확인</li><li>재고가 있으면 대여 기록 생성</li><li>재고 수량 감소</li><li>트랜잭션 커밋</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Transaction Isolation 이 동시 대여 요청 시 재고 일관성을 보장하고 오버대여를 방지</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 동시 요청 시 재고보다 많은 대여 발생 가능</li><li>도입 후: 정확한 재고 관리와 선착순 대여 처리</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>  1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>  2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>  3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>  4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>  5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6>  6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7>  7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8>  8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9>  9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10> 10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11> 11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12> 12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13> 13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14> 14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15> 15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16> 16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17> 17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18> 18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19> 19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20> 20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21> 21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22> 22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23> 23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24> 24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25> 25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26> 26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27> 27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28> 28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29> 29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30> 30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31> 31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32> 32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33> 33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34> 34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35> 35</a>
</span><span class=lnt id=hl-18-36><a class=lnlinks href=#hl-18-36> 36</a>
</span><span class=lnt id=hl-18-37><a class=lnlinks href=#hl-18-37> 37</a>
</span><span class=lnt id=hl-18-38><a class=lnlinks href=#hl-18-38> 38</a>
</span><span class=lnt id=hl-18-39><a class=lnlinks href=#hl-18-39> 39</a>
</span><span class=lnt id=hl-18-40><a class=lnlinks href=#hl-18-40> 40</a>
</span><span class=lnt id=hl-18-41><a class=lnlinks href=#hl-18-41> 41</a>
</span><span class=lnt id=hl-18-42><a class=lnlinks href=#hl-18-42> 42</a>
</span><span class=lnt id=hl-18-43><a class=lnlinks href=#hl-18-43> 43</a>
</span><span class=lnt id=hl-18-44><a class=lnlinks href=#hl-18-44> 44</a>
</span><span class=lnt id=hl-18-45><a class=lnlinks href=#hl-18-45> 45</a>
</span><span class=lnt id=hl-18-46><a class=lnlinks href=#hl-18-46> 46</a>
</span><span class=lnt id=hl-18-47><a class=lnlinks href=#hl-18-47> 47</a>
</span><span class=lnt id=hl-18-48><a class=lnlinks href=#hl-18-48> 48</a>
</span><span class=lnt id=hl-18-49><a class=lnlinks href=#hl-18-49> 49</a>
</span><span class=lnt id=hl-18-50><a class=lnlinks href=#hl-18-50> 50</a>
</span><span class=lnt id=hl-18-51><a class=lnlinks href=#hl-18-51> 51</a>
</span><span class=lnt id=hl-18-52><a class=lnlinks href=#hl-18-52> 52</a>
</span><span class=lnt id=hl-18-53><a class=lnlinks href=#hl-18-53> 53</a>
</span><span class=lnt id=hl-18-54><a class=lnlinks href=#hl-18-54> 54</a>
</span><span class=lnt id=hl-18-55><a class=lnlinks href=#hl-18-55> 55</a>
</span><span class=lnt id=hl-18-56><a class=lnlinks href=#hl-18-56> 56</a>
</span><span class=lnt id=hl-18-57><a class=lnlinks href=#hl-18-57> 57</a>
</span><span class=lnt id=hl-18-58><a class=lnlinks href=#hl-18-58> 58</a>
</span><span class=lnt id=hl-18-59><a class=lnlinks href=#hl-18-59> 59</a>
</span><span class=lnt id=hl-18-60><a class=lnlinks href=#hl-18-60> 60</a>
</span><span class=lnt id=hl-18-61><a class=lnlinks href=#hl-18-61> 61</a>
</span><span class=lnt id=hl-18-62><a class=lnlinks href=#hl-18-62> 62</a>
</span><span class=lnt id=hl-18-63><a class=lnlinks href=#hl-18-63> 63</a>
</span><span class=lnt id=hl-18-64><a class=lnlinks href=#hl-18-64> 64</a>
</span><span class=lnt id=hl-18-65><a class=lnlinks href=#hl-18-65> 65</a>
</span><span class=lnt id=hl-18-66><a class=lnlinks href=#hl-18-66> 66</a>
</span><span class=lnt id=hl-18-67><a class=lnlinks href=#hl-18-67> 67</a>
</span><span class=lnt id=hl-18-68><a class=lnlinks href=#hl-18-68> 68</a>
</span><span class=lnt id=hl-18-69><a class=lnlinks href=#hl-18-69> 69</a>
</span><span class=lnt id=hl-18-70><a class=lnlinks href=#hl-18-70> 70</a>
</span><span class=lnt id=hl-18-71><a class=lnlinks href=#hl-18-71> 71</a>
</span><span class=lnt id=hl-18-72><a class=lnlinks href=#hl-18-72> 72</a>
</span><span class=lnt id=hl-18-73><a class=lnlinks href=#hl-18-73> 73</a>
</span><span class=lnt id=hl-18-74><a class=lnlinks href=#hl-18-74> 74</a>
</span><span class=lnt id=hl-18-75><a class=lnlinks href=#hl-18-75> 75</a>
</span><span class=lnt id=hl-18-76><a class=lnlinks href=#hl-18-76> 76</a>
</span><span class=lnt id=hl-18-77><a class=lnlinks href=#hl-18-77> 77</a>
</span><span class=lnt id=hl-18-78><a class=lnlinks href=#hl-18-78> 78</a>
</span><span class=lnt id=hl-18-79><a class=lnlinks href=#hl-18-79> 79</a>
</span><span class=lnt id=hl-18-80><a class=lnlinks href=#hl-18-80> 80</a>
</span><span class=lnt id=hl-18-81><a class=lnlinks href=#hl-18-81> 81</a>
</span><span class=lnt id=hl-18-82><a class=lnlinks href=#hl-18-82> 82</a>
</span><span class=lnt id=hl-18-83><a class=lnlinks href=#hl-18-83> 83</a>
</span><span class=lnt id=hl-18-84><a class=lnlinks href=#hl-18-84> 84</a>
</span><span class=lnt id=hl-18-85><a class=lnlinks href=#hl-18-85> 85</a>
</span><span class=lnt id=hl-18-86><a class=lnlinks href=#hl-18-86> 86</a>
</span><span class=lnt id=hl-18-87><a class=lnlinks href=#hl-18-87> 87</a>
</span><span class=lnt id=hl-18-88><a class=lnlinks href=#hl-18-88> 88</a>
</span><span class=lnt id=hl-18-89><a class=lnlinks href=#hl-18-89> 89</a>
</span><span class=lnt id=hl-18-90><a class=lnlinks href=#hl-18-90> 90</a>
</span><span class=lnt id=hl-18-91><a class=lnlinks href=#hl-18-91> 91</a>
</span><span class=lnt id=hl-18-92><a class=lnlinks href=#hl-18-92> 92</a>
</span><span class=lnt id=hl-18-93><a class=lnlinks href=#hl-18-93> 93</a>
</span><span class=lnt id=hl-18-94><a class=lnlinks href=#hl-18-94> 94</a>
</span><span class=lnt id=hl-18-95><a class=lnlinks href=#hl-18-95> 95</a>
</span><span class=lnt id=hl-18-96><a class=lnlinks href=#hl-18-96> 96</a>
</span><span class=lnt id=hl-18-97><a class=lnlinks href=#hl-18-97> 97</a>
</span><span class=lnt id=hl-18-98><a class=lnlinks href=#hl-18-98> 98</a>
</span><span class=lnt id=hl-18-99><a class=lnlinks href=#hl-18-99> 99</a>
</span><span class=lnt id=hl-18-100><a class=lnlinks href=#hl-18-100>100</a>
</span><span class=lnt id=hl-18-101><a class=lnlinks href=#hl-18-101>101</a>
</span><span class=lnt id=hl-18-102><a class=lnlinks href=#hl-18-102>102</a>
</span><span class=lnt id=hl-18-103><a class=lnlinks href=#hl-18-103>103</a>
</span><span class=lnt id=hl-18-104><a class=lnlinks href=#hl-18-104>104</a>
</span><span class=lnt id=hl-18-105><a class=lnlinks href=#hl-18-105>105</a>
</span><span class=lnt id=hl-18-106><a class=lnlinks href=#hl-18-106>106</a>
</span><span class=lnt id=hl-18-107><a class=lnlinks href=#hl-18-107>107</a>
</span><span class=lnt id=hl-18-108><a class=lnlinks href=#hl-18-108>108</a>
</span><span class=lnt id=hl-18-109><a class=lnlinks href=#hl-18-109>109</a>
</span><span class=lnt id=hl-18-110><a class=lnlinks href=#hl-18-110>110</a>
</span><span class=lnt id=hl-18-111><a class=lnlinks href=#hl-18-111>111</a>
</span><span class=lnt id=hl-18-112><a class=lnlinks href=#hl-18-112>112</a>
</span><span class=lnt id=hl-18-113><a class=lnlinks href=#hl-18-113>113</a>
</span><span class=lnt id=hl-18-114><a class=lnlinks href=#hl-18-114>114</a>
</span><span class=lnt id=hl-18-115><a class=lnlinks href=#hl-18-115>115</a>
</span><span class=lnt id=hl-18-116><a class=lnlinks href=#hl-18-116>116</a>
</span><span class=lnt id=hl-18-117><a class=lnlinks href=#hl-18-117>117</a>
</span><span class=lnt id=hl-18-118><a class=lnlinks href=#hl-18-118>118</a>
</span><span class=lnt id=hl-18-119><a class=lnlinks href=#hl-18-119>119</a>
</span><span class=lnt id=hl-18-120><a class=lnlinks href=#hl-18-120>120</a>
</span><span class=lnt id=hl-18-121><a class=lnlinks href=#hl-18-121>121</a>
</span><span class=lnt id=hl-18-122><a class=lnlinks href=#hl-18-122>122</a>
</span><span class=lnt id=hl-18-123><a class=lnlinks href=#hl-18-123>123</a>
</span><span class=lnt id=hl-18-124><a class=lnlinks href=#hl-18-124>124</a>
</span><span class=lnt id=hl-18-125><a class=lnlinks href=#hl-18-125>125</a>
</span><span class=lnt id=hl-18-126><a class=lnlinks href=#hl-18-126>126</a>
</span><span class=lnt id=hl-18-127><a class=lnlinks href=#hl-18-127>127</a>
</span><span class=lnt id=hl-18-128><a class=lnlinks href=#hl-18-128>128</a>
</span><span class=lnt id=hl-18-129><a class=lnlinks href=#hl-18-129>129</a>
</span><span class=lnt id=hl-18-130><a class=lnlinks href=#hl-18-130>130</a>
</span><span class=lnt id=hl-18-131><a class=lnlinks href=#hl-18-131>131</a>
</span><span class=lnt id=hl-18-132><a class=lnlinks href=#hl-18-132>132</a>
</span><span class=lnt id=hl-18-133><a class=lnlinks href=#hl-18-133>133</a>
</span><span class=lnt id=hl-18-134><a class=lnlinks href=#hl-18-134>134</a>
</span><span class=lnt id=hl-18-135><a class=lnlinks href=#hl-18-135>135</a>
</span><span class=lnt id=hl-18-136><a class=lnlinks href=#hl-18-136>136</a>
</span><span class=lnt id=hl-18-137><a class=lnlinks href=#hl-18-137>137</a>
</span><span class=lnt id=hl-18-138><a class=lnlinks href=#hl-18-138>138</a>
</span><span class=lnt id=hl-18-139><a class=lnlinks href=#hl-18-139>139</a>
</span><span class=lnt id=hl-18-140><a class=lnlinks href=#hl-18-140>140</a>
</span><span class=lnt id=hl-18-141><a class=lnlinks href=#hl-18-141>141</a>
</span><span class=lnt id=hl-18-142><a class=lnlinks href=#hl-18-142>142</a>
</span><span class=lnt id=hl-18-143><a class=lnlinks href=#hl-18-143>143</a>
</span><span class=lnt id=hl-18-144><a class=lnlinks href=#hl-18-144>144</a>
</span><span class=lnt id=hl-18-145><a class=lnlinks href=#hl-18-145>145</a>
</span><span class=lnt id=hl-18-146><a class=lnlinks href=#hl-18-146>146</a>
</span><span class=lnt id=hl-18-147><a class=lnlinks href=#hl-18-147>147</a>
</span><span class=lnt id=hl-18-148><a class=lnlinks href=#hl-18-148>148</a>
</span><span class=lnt id=hl-18-149><a class=lnlinks href=#hl-18-149>149</a>
</span><span class=lnt id=hl-18-150><a class=lnlinks href=#hl-18-150>150</a>
</span><span class=lnt id=hl-18-151><a class=lnlinks href=#hl-18-151>151</a>
</span><span class=lnt id=hl-18-152><a class=lnlinks href=#hl-18-152>152</a>
</span><span class=lnt id=hl-18-153><a class=lnlinks href=#hl-18-153>153</a>
</span><span class=lnt id=hl-18-154><a class=lnlinks href=#hl-18-154>154</a>
</span><span class=lnt id=hl-18-155><a class=lnlinks href=#hl-18-155>155</a>
</span><span class=lnt id=hl-18-156><a class=lnlinks href=#hl-18-156>156</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>psycopg2.extras</span> <span class=kn>import</span> <span class=n>RealDictCursor</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BookRentalSystem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection_string</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection_string</span> <span class=o>=</span> <span class=n>connection_string</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_db_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>isolation_level</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        데이터베이스 연결 및 격리 수준 설정
</span></span></span><span class=line><span class=cl><span class=s2>        - Transaction Isolation의 핵심: 격리 수준별 동작 제어
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>connection_string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 격리 수준 설정 - Transaction Isolation의 실제 적용</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>set_isolation_level</span><span class=p>(</span><span class=n>isolation_level</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>conn</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>rent_book_read_uncommitted</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>book_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Read Uncommitted 격리 수준에서의 도서 대여
</span></span></span><span class=line><span class=cl><span class=s2>        - 커밋되지 않은 데이터도 읽어서 Dirty Read 문제 발생 가능
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_db_connection</span><span class=p>(</span><span class=n>psycopg2</span><span class=o>.</span><span class=n>extensions</span><span class=o>.</span><span class=n>ISOLATION_LEVEL_READ_UNCOMMITTED</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>(</span><span class=n>cursor_factory</span><span class=o>=</span><span class=n>RealDictCursor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 재고 확인 (Dirty Read 가능)</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT stock FROM books WHERE book_id = </span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>book_id</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: 현재 재고 </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;stock&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;stock&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 의도적 지연으로 동시성 문제 시뮬레이션</span>
</span></span><span class=line><span class=cl>                    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 재고 감소</span>
</span></span><span class=line><span class=cl>                    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;UPDATE books SET stock = stock - 1 WHERE book_id = </span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=n>book_id</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 대여 기록 생성</span>
</span></span><span class=line><span class=cl>                    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;INSERT INTO rentals (user_id, book_id, rental_date) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, NOW())&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>book_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: 대여 성공!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: 재고 부족으로 대여 실패&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: 오류 발생 - </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>rent_book_serializable</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>book_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Serializable 격리 수준에서의 도서 대여
</span></span></span><span class=line><span class=cl><span class=s2>        - Transaction Isolation의 최고 수준: 모든 동시성 문제 방지
</span></span></span><span class=line><span class=cl><span class=s2>        - 직렬화 가능한 스케줄로 실행되어 데이터 일관성 완벽 보장
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_db_connection</span><span class=p>(</span><span class=n>psycopg2</span><span class=o>.</span><span class=n>extensions</span><span class=o>.</span><span class=n>ISOLATION_LEVEL_SERIALIZABLE</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>(</span><span class=n>cursor_factory</span><span class=o>=</span><span class=n>RealDictCursor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 재고 확인 및 잠금 (SELECT FOR UPDATE)</span>
</span></span><span class=line><span class=cl>                <span class=c1># Transaction Isolation의 핵심: 읽기와 동시에 배타적 잠금 획득</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;SELECT stock FROM books WHERE book_id = </span><span class=si>%s</span><span class=s2> FOR UPDATE&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                    <span class=p>(</span><span class=n>book_id</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: 현재 재고 </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;stock&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (잠금 획득)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;stock&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 재고 감소</span>
</span></span><span class=line><span class=cl>                    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;UPDATE books SET stock = stock - 1 WHERE book_id = </span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=n>book_id</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 대여 기록 생성</span>
</span></span><span class=line><span class=cl>                    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;INSERT INTO rentals (user_id, book_id, rental_date) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, NOW())&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>book_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 트랜잭션 커밋 - Transaction Isolation의 원자성 보장</span>
</span></span><span class=line><span class=cl>                    <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: 대여 성공! (일관성 보장)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: 재고 부족으로 대여 실패&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>extensions</span><span class=o>.</span><span class=n>TransactionRollbackError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 직렬화 실패 시 재시도 (Transaction Isolation의 충돌 해결)</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: 직렬화 충돌로 재시도 필요&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>  <span class=c1># 짧은 대기 후 재시도</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>rent_book_serializable</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>book_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;User </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: 오류 발생 - </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>simulate_concurrent_rentals</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    동시 대여 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=s2>    - Transaction Isolation 유무에 따른 차이점 실증
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>rental_system</span> <span class=o>=</span> <span class=n>BookRentalSystem</span><span class=p>(</span><span class=s2>&#34;postgresql://user:password@localhost/bookstore&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== Read Uncommitted 테스트 (문제 상황) ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>threads</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>target</span><span class=o>=</span><span class=n>rental_system</span><span class=o>.</span><span class=n>rent_book_read_uncommitted</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;user_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>thread</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>thread</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== Serializable 테스트 (해결 상황) ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>threads</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>target</span><span class=o>=</span><span class=n>rental_system</span><span class=o>.</span><span class=n>rent_book_serializable</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;user_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>thread</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>thread</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 테스트 실행</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>simulate_concurrent_rentals</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=실습-예제-격리-수준별-데이터-정합성-변화-실습>실습 예제: 격리 수준별 데이터 정합성 변화 실습<a hidden class=anchor aria-hidden=true href=#실습-예제-격리-수준별-데이터-정합성-변화-실습>#</a></h5><p><strong>학습 목표</strong>: 트랜잭션 격리 수준별 데이터 정합성 변화 실습<br><strong>시나리오</strong>: 두 개 트랜잭션 (트랜잭션 A, B) 이 동일한 데이터를 동시에 조회/수정<br><strong>시스템 구성</strong>:</p><ul><li>DBMS (예: MySQL)</li><li>트랜잭션 처리 어플리케이션</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[트랜잭션 A] --&gt; D[(데이터베이스)]
    B[트랜잭션 B] --&gt; D
    D --&gt; E[Isolation Level 컨트롤]
</pre><p><strong>Workflow</strong>:</p><ol><li>트랜잭션 A 가 데이터 조회</li><li>트랜잭션 B 가 동일 데이터 수정 및 커밋</li><li>트랜잭션 A 가 재조회 → 격리 수준에 따라 결과 다름</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>격리 수준이 데이터 정합성에 어떻게 관여하는지 실습</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 데이터 무결성 침해 빈번</li><li>도입 후: 동시성 문제 예방, 데이터 보호</li></ul><p><strong>구현 예시 (Python, pymysql + SQL):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Transaction Isolation Level 실습 예제</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pymysql</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># DB 연결 및 트랜잭션 시작 시 격리 수준 설정</span>
</span></span><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>pymysql</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>user</span><span class=o>=</span><span class=s1>&#39;root&#39;</span><span class=p>,</span> <span class=n>password</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=s1>&#39;test&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cursor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>&#39;SET TRANSACTION ISOLATION LEVEL READ COMMITTED;&#39;</span><span class=p>)</span> <span class=c1># 격리 수준 설정</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>begin</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>&#39;SELECT balance FROM account WHERE id=1;&#39;</span><span class=p>)</span>  <span class=c1># 데이터 조회</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주석: 동시간대에 다른 트랜잭션에서 데이터롤 변경했을 경우, Read Committed는 변경된 값만 조회 가능</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=실습-예제-주문--결제--재고--정산-흐름에-따른-구간별-권장-격리락-전략>실습 예제: 주문 → 결제 → 재고 → 정산 흐름에 따른 구간별 권장 격리/락 전략<a hidden class=anchor aria-hidden=true href=#실습-예제-주문--결제--재고--정산-흐름에-따른-구간별-권장-격리락-전략>#</a></h5><table><thead><tr><th>단계</th><th>주요 작업</th><th>권장 격리/락</th><th>핵심 불변 (비즈 규칙)</th><th>실패·재시도 전략</th><th>모니터링 포인트</th></tr></thead><tbody><tr><td><strong>주문 (Order)</strong></td><td>장바구니→주문 생성, 가격/쿠폰 확정</td><td><strong>RC/RCSI</strong>로 읽기 비차단, 주문 생성 Tx 는 <strong>RC</strong>(짧게)</td><td>주문번호 유니크, 금액·할인 재계산 일관성</td><td><strong>멱등키</strong>(idempotency_key) 로 중복 생성 방지</td><td>주문 생성 실패율, p95 응답, 멱등 충돌률</td></tr><tr><td><strong>결제 (Payment)</strong></td><td>결제 승인/캡처, 원장 (ledger) 기록</td><td>PSP 연동은 외부, 내부 원장 기록은 <strong>Serializable/SSI</strong>(짧은 Tx)</td><td>이중 결제 방지, 잔액/채권·채무 보존</td><td><strong>멱등키 + 유니크 제약</strong>(payment_key), <strong>재시도 허용</strong></td><td>결제 재시도율, 직렬화 실패율, 보상 (취소) 율</td></tr><tr><td><strong>재고 (Inventory)</strong></td><td>재고 <strong>예약→차감</strong></td><td>단일 SKU 는 <code>SELECT … **FOR UPDATE**</code>(<strong>RR/기본 InnoDB</strong>) 또는 <strong>조건부 업데이트 (Optimistic)</strong>. 다중 로트/범위는 <strong>Next-Key/갭락</strong>(InnoDB) or <strong>Serializable/SSI</strong></td><td>음수 재고 금지, 오버셀링 금지, 예약 만료</td><td><strong>짧은 Tx + 재시도</strong>, <strong>SKIP LOCKED</strong>로 작업 분산, 예약 TTL/정리</td><td>재고 경합률, 잠금 대기, 예약 만료/정리 지연</td></tr><tr><td><strong>정산 (Settlement)</strong></td><td>정산 배치, 회계 분개</td><td><strong>Snapshot/RCSI</strong>로 리포팅 일관 스냅샷, 분개 생성 구간만 <strong>Serializable</strong></td><td>복식부기 불변 (차변=대변), 기간별 총계 일치</td><td>배치 - 온라인 분리, 실패 시 <strong>부분 롤백 + 재실행</strong></td><td>배치 시간, p99 I/O, 재처리 건수</td></tr></tbody></table><ul><li>핵심 원칙: <strong>읽기는 RC/RCSI(Snapshot) 로 비차단</strong>, <strong>규칙 핵심 구간은 짧게 Serializable/SSI 또는 범위 락</strong>, <strong>트랜잭션은 짧고 멱등적</strong>으로.</li></ul><h6 id=흐름--격리-레이어>흐름 & 격리 레이어<a hidden class=anchor aria-hidden=true href=#흐름--격리-레이어>#</a></h6><pre class=mermaid>flowchart LR
  subgraph Client
    U[사용자]
  end
  subgraph Services
    O[Order Svc\nRC/RCSI]
    P[Payment Svc\nPSP연동 + 내부 Ledger=Serializable/SSI]
    I[&#34;Inventory Svc\nFOR UPDATE / RR(+Next-Key)&#34;]
    S[Settlement Svc\nSnapshot + 구간별 Serializable]
  end
  subgraph Infra
    MQ[(Kafka/Rabbit Outbox)]
    CACHE[(Redis)]
    SEARCH[(Elasticsearch)]
  end

  U --&gt; O --&gt; P --&gt; I --&gt; S
  O -- Outbox 이벤트 --&gt; MQ
  P -- Outbox 이벤트 --&gt; MQ
  I -- Outbox 이벤트 --&gt; MQ
  O --- CACHE
  O --- SEARCH
</pre><h6 id=엔진별-치트시트>엔진별 치트시트<a hidden class=anchor aria-hidden=true href=#엔진별-치트시트>#</a></h6><table><thead><tr><th>주제</th><th>PostgreSQL</th><th>MySQL InnoDB</th><th>SQL Server</th></tr></thead><tbody><tr><td>기본 격리</td><td>Read Committed</td><td>Repeatable Read(기본)</td><td>Read Committed + <strong>RCSI</strong>(권장)</td></tr><tr><td>강한 정합성</td><td><strong>Serializable=SSI</strong>(충돌 그래프)</td><td>2PL 기반 + RR 에서도 <strong>Next-Key/GAP</strong>로 팬텀 방지</td><td><code>SERIALIZABLE</code> 또는 힌트로 근사 (<code>HOLDLOCK</code>)</td></tr><tr><td>행 잠금</td><td><code>SELECT … FOR UPDATE/SHARE</code></td><td><code>… FOR UPDATE/LOCK IN SHARE MODE</code>(버전별), RR 에서 범위 잠금</td><td><code>WITH (UPDLOCK, ROWLOCK)</code></td></tr><tr><td>범위/팬텀</td><td><strong>Serializable</strong>로 감지/차단</td><td><strong>Next-Key/GAP</strong>(인덱스 필요)</td><td><code>HOLDLOCK</code>(Serializable 동작)</td></tr><tr><td>읽기 비차단</td><td>기본 MVCC(문/Tx 스냅샷)</td><td>세컨더리 읽기엔 주의, 기본은 쓰기 차단 가능</td><td><strong>RCSI/ALLOW_SNAPSHOT_ISOLATION</strong></td></tr></tbody></table><h6 id=실전-sql-패턴-모음>실전 SQL 패턴 모음<a hidden class=anchor aria-hidden=true href=#실전-sql-패턴-모음>#</a></h6><ol><li><p>주문 생성—멱등키로 중복 방지</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 공통(모든 엔진): 멱등키 유니크 인덱스
</span></span></span><span class=line><span class=cl><span class=c1>-- CREATE UNIQUE INDEX ux_order_idem ON orders(idempotency_key);
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>-- 주문 생성: RC/RCSI에서 짧게 수행
</span></span></span><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 이미 처리된 요청이면 바로 반환
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- SELECT id FROM orders WHERE idempotency_key = :k FOR UPDATE;
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>orders</span><span class=p>(</span><span class=n>idempotency_key</span><span class=p>,</span><span class=w> </span><span class=n>user_id</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>VALUES</span><span class=p>(:</span><span class=n>k</span><span class=p>,</span><span class=w> </span><span class=p>:</span><span class=n>user_id</span><span class=p>,</span><span class=w> </span><span class=p>:</span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;PENDING&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>결제 원장—Serializable/SSI 구간 (짧게)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- Postgres 예시: 직렬화 보장(SSI)
</span></span></span><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=k>SERIALIZABLE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 멱등키로 이중 결제 방지
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- CREATE UNIQUE INDEX ux_pay_key ON payments(pay_key);
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>payments</span><span class=p>(</span><span class=n>pay_key</span><span class=p>,</span><span class=w> </span><span class=n>order_id</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=k>state</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(:</span><span class=n>k</span><span class=p>,</span><span class=w> </span><span class=p>:</span><span class=n>oid</span><span class=p>,</span><span class=w> </span><span class=p>:</span><span class=n>amt</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;CAPTURED&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 복식부기 원장: 차변/대변 동시 기록 (합계 일치 제약은 트리거/제약으로 보강)
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>ledger_entries</span><span class=w> </span><span class=p>(</span><span class=n>entry_id</span><span class=p>,</span><span class=w> </span><span class=n>account</span><span class=p>,</span><span class=w> </span><span class=n>debit</span><span class=p>,</span><span class=w> </span><span class=n>credit</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>gen_random_uuid</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;Cash&#39;</span><span class=p>,</span><span class=w> </span><span class=p>:</span><span class=n>amt</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>(</span><span class=n>gen_random_uuid</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;AR&#39;</span><span class=p>,</span><span class=w>   </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=p>:</span><span class=n>amt</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>-- 직렬화 충돌 시 애플리케이션에서 재시도
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>재고 차감—비관적 (행 잠금) 패턴</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 단일 SKU: 재고 음수 방지 (Postgres/MySQL 유사)
</span></span></span><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 선택 행 잠금으로 동시 차감 직격
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>qty</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>sku</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>sku</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 수량 충분할 때만 차감
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>UPDATE</span><span class=w> </span><span class=n>stock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>SET</span><span class=w> </span><span class=n>qty</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>qty</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=p>:</span><span class=n>n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>WHERE</span><span class=w> </span><span class=n>sku</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>sku</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>qty</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=p>:</span><span class=n>n</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 적용 여부 확인 (0행이면 부족/다른 Tx가 선점)
</span></span></span><span class=line><span class=cl><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>재고 차감—낙관적 (조건부 갱신) 패턴</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 스키마: stock(sku PK, qty, version)
</span></span></span><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 현재 버전 조회 (스냅샷/RC)
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>qty</span><span class=p>,</span><span class=w> </span><span class=k>version</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>sku</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>sku</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 조건부 업데이트로 충돌 검출
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>UPDATE</span><span class=w> </span><span class=n>stock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>SET</span><span class=w> </span><span class=n>qty</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>qty</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=p>:</span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=k>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>version</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>WHERE</span><span class=w> </span><span class=n>sku</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>sku</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>qty</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=p>:</span><span class=n>n</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>ver</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>-- 영향 행 수=0이면 재시도(버전 충돌 or 수량 부족)
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>범위 (로트/유통기한 우선) 차감—팬텀 방지</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- InnoDB: 인덱스( (sku, expire_at) ) 위에서 RR + Next-Key 락 활용
</span></span></span><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=k>REPEATABLE</span><span class=w> </span><span class=k>READ</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 가장 빠른 만기 로트부터 집계 &amp; 잠금
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>lot_id</span><span class=p>,</span><span class=w> </span><span class=n>available</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>FROM</span><span class=w> </span><span class=n>lots</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>WHERE</span><span class=w> </span><span class=n>sku</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>sku</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>available</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>expire_at</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=p>;</span><span class=w>  </span><span class=c1>-- 인덱스 범위에 Next-Key/GAP 잠금 부여
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 선택 로트들에서 차감 처리...
</span></span></span><span class=line><span class=cl><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>워커 병렬화—SKIP LOCKED 로 핫큐 처리</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1>1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2>2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3>3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4>4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5>5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6>6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7>7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8>8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 대량 주문 재고예약 워커
</span></span></span><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 이미 잠긴 행은 건너뛰고 다른 워커가 병렬 처리
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>reservations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>WHERE</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;READY&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=n>SKIP</span><span class=w> </span><span class=n>LOCKED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>100</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 처리 후 상태 전이...
</span></span></span><span class=line><span class=cl><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Outbox—이벤트 정확 1 회 전달</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1>1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2>2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3>3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4>4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5>5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6>6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>-- 비즈니스 변경 + 아웃박스 레코드를 동일 Tx에 기록
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>UPDATE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>status</span><span class=o>=</span><span class=s1>&#39;PAID&#39;</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=p>:</span><span class=n>oid</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>outbox</span><span class=p>(</span><span class=n>event_type</span><span class=p>,</span><span class=w> </span><span class=n>aggregate_id</span><span class=p>,</span><span class=w> </span><span class=n>payload</span><span class=p>,</span><span class=w> </span><span class=n>published</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;OrderPaid&#39;</span><span class=p>,</span><span class=w> </span><span class=p>:</span><span class=n>oid</span><span class=p>,</span><span class=w> </span><span class=p>:</span><span class=n>json</span><span class=p>,</span><span class=w> </span><span class=k>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>-- 별도 퍼블리셔가 outbox(published=false)만 읽어 MQ에 퍼블리시 후 true로 마크
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h6 id=운영-팁>운영 팁<a hidden class=anchor aria-hidden=true href=#운영-팁>#</a></h6><ul><li><strong>트랜잭션은 짧게</strong>: 읽기/검증 → 쓰기/커밋까지 한 번에, 네트워크 왕복 최소화.</li><li><strong>재시도는 기본값</strong>: Serializable/SSI 충돌, 낙관적 잠금 실패는 <strong>멱등키</strong>와 함께 안전 재시도.</li><li><strong>지표로 관리</strong>: 직렬화 실패율, 교착 비율, 잠금 대기, 버전 스토어/테이블 bloat, p95/99 지연.</li><li><strong>엔진별 동작 차 검증</strong>: InnoDB 의 Next-Key, PostgreSQL 의 SSI, SQL Server 의 RCSI/힌트는 <strong>동일하지 않다</strong>—통합테스트 필수.</li><li><strong>분리와 구간화</strong>: 전체를 Serializable 로 두지 말고, <strong>핵심 구간만 강화</strong>해 처리량을 지킨다.</li></ul><h4 id=실제-도입-사례의-코드-구현>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현>#</a></h4><h5 id=사례-금융거래-시스템>사례: 금융거래 시스템<a hidden class=anchor aria-hidden=true href=#사례-금융거래-시스템>#</a></h5><p><strong>사례 선정</strong>: 금융거래 시스템<br><strong>비즈니스 배경</strong>: 동시 거래 환경에서 부정 거래와 데이터 오염 예방<br><strong>기술적 요구사항</strong>: 모든 트랜잭션이 독립적으로 처리되어 동시에 일어나는 거래 데이터가 서로 영향을 받지 않아야 함</p><p><strong>시스템 구성</strong>:</p><ul><li>Application Server</li><li>Database Cluster (트랜잭션 관리 포함)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;금융 서비스 시스템&#34;
        A[Application 서버] --&gt; B[DB 트랜잭션 관리자]
        B --&gt; C[DB 클러스터]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>서버가 트랜잭션 요청</li><li>트랜잭션 관리자 격리 수준 적용</li><li>트랜잭션 처리 및 결과 반환</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>데이터 불일치와 부정거래 실시간 예방</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 동시 거래 오류, 부정거래 증가</li><li>도입 후: 동시 거래 데이터 오류 미발생, 신뢰 보장</li></ul><p><strong>구현 예시 (Spring Transaction 설정, YAML):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1>1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2>2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3>3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4>4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5>5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6>6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7>7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8>8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Spring 환경에서 Serializable 격리 수준 적용 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spring</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>datasource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>jdbc:mysql://localhost:3306/finance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>pass</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jpa</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hibernate.connection.isolation</span><span class=p>:</span><span class=w> </span><span class=m>8</span><span class=w>  </span><span class=c># 8(SERIALIZABLE)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li>성능 개선: Dirty read 등 동시성 오류 &lsquo;0 건 '</li><li>운영 효율성: 예외·오류 자동 탐지율 99% 로 향상</li><li>비용 절감: 부정거래 탐지로 연간 손실 50% 감소</li></ul><h5 id=사례-전자상거래-플랫폼의-재고-관리-시스템>사례: 전자상거래 플랫폼의 재고 관리 시스템<a hidden class=anchor aria-hidden=true href=#사례-전자상거래-플랫폼의-재고-관리-시스템>#</a></h5><p><strong>사례 선정</strong>: 대규모 전자상거래 플랫폼의 재고 관리 시스템</p><p><strong>비즈니스 배경</strong>:</p><ul><li>일일 주문량 100 만건 이상 처리</li><li>동시 접속자 50 만명 이상</li><li>재고 오버셀링으로 인한 고객 불만과 손실 문제</li></ul><p><strong>기술적 요구사항</strong>:</p><ul><li>재고 정확성 100% 보장</li><li>주문 응답 시간 500ms 이내</li><li>높은 동시성 처리 능력</li><li>시스템 장애 시 데이터 일관성 유지</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>애플리케이션 서버: Node.js (Express.js)</li><li>데이터베이스: MySQL 8.0 (InnoDB)</li><li>캐시: Redis Cluster</li><li>메시지 큐: Apache Kafka</li><li>로드 밸런서: NGINX</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Frontend&#34;
        WEB[Web Interface]
        MOBILE[Mobile App]
    end
    
    subgraph &#34;Load Balancer&#34;
        LB[NGINX Load Balancer]
    end
    
    subgraph &#34;Application Cluster&#34;
        APP1[Node.js Server 1]
        APP2[Node.js Server 2]
        APP3[Node.js Server 3]
    end
    
    subgraph &#34;Data Layer&#34;
        MYSQL[(MySQL Master)]
        REDIS[(Redis Cluster)]
        KAFKA[Kafka Cluster]
    end
    
    subgraph &#34;Monitoring&#34;
        METRICS[Prometheus]
        LOGS[ELK Stack]
    end
    
    WEB --&gt; LB
    MOBILE --&gt; LB
    LB --&gt; APP1
    LB --&gt; APP2
    LB --&gt; APP3
    APP1 --&gt; MYSQL
    APP1 --&gt; REDIS
    APP1 --&gt; KAFKA
    APP2 --&gt; MYSQL
    APP2 --&gt; REDIS
    APP2 --&gt; KAFKA
    APP3 --&gt; MYSQL
    APP3 --&gt; REDIS
    APP3 --&gt; KAFKA
    APP1 --&gt; METRICS
    APP2 --&gt; LOGS
</pre><p><strong>Workflow</strong>:</p><ol><li>고객이 상품 주문 요청</li><li>로드 밸런서가 애플리케이션 서버로 분산</li><li>Redis 에서 재고 캐시 확인</li><li>MySQL 에서 트랜잭션 시작 (Repeatable Read)</li><li>재고 차감 및 주문 생성</li><li>Kafka 로 이벤트 발행</li><li>트랜잭션 커밋 및 응답</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Transaction Isolation 이 동시 주문 처리 시 재고 데이터의 일관성 보장</li><li>Repeatable Read 격리 수준으로 주문 프로세스 중 재고 정보 일관성 유지</li><li>잠금 최소화로 높은 동시성과 성능 확보</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 재고 오버셀링으로 일일 평균 1000 건의 주문 취소 발생</li><li>도입 후: 재고 정확성 99.99% 달성, 고객 만족도 15% 향상</li></ul><p><strong>구현 예시</strong> (Node.js):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1>  1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2>  2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3>  3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4>  4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5>  5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6>  6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7>  7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8>  8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9>  9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10> 10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11> 11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12> 12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13> 13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14> 14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15> 15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16> 16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17> 17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18> 18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19> 19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20> 20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21> 21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22> 22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23> 23</a>
</span><span class=lnt id=hl-32-24><a class=lnlinks href=#hl-32-24> 24</a>
</span><span class=lnt id=hl-32-25><a class=lnlinks href=#hl-32-25> 25</a>
</span><span class=lnt id=hl-32-26><a class=lnlinks href=#hl-32-26> 26</a>
</span><span class=lnt id=hl-32-27><a class=lnlinks href=#hl-32-27> 27</a>
</span><span class=lnt id=hl-32-28><a class=lnlinks href=#hl-32-28> 28</a>
</span><span class=lnt id=hl-32-29><a class=lnlinks href=#hl-32-29> 29</a>
</span><span class=lnt id=hl-32-30><a class=lnlinks href=#hl-32-30> 30</a>
</span><span class=lnt id=hl-32-31><a class=lnlinks href=#hl-32-31> 31</a>
</span><span class=lnt id=hl-32-32><a class=lnlinks href=#hl-32-32> 32</a>
</span><span class=lnt id=hl-32-33><a class=lnlinks href=#hl-32-33> 33</a>
</span><span class=lnt id=hl-32-34><a class=lnlinks href=#hl-32-34> 34</a>
</span><span class=lnt id=hl-32-35><a class=lnlinks href=#hl-32-35> 35</a>
</span><span class=lnt id=hl-32-36><a class=lnlinks href=#hl-32-36> 36</a>
</span><span class=lnt id=hl-32-37><a class=lnlinks href=#hl-32-37> 37</a>
</span><span class=lnt id=hl-32-38><a class=lnlinks href=#hl-32-38> 38</a>
</span><span class=lnt id=hl-32-39><a class=lnlinks href=#hl-32-39> 39</a>
</span><span class=lnt id=hl-32-40><a class=lnlinks href=#hl-32-40> 40</a>
</span><span class=lnt id=hl-32-41><a class=lnlinks href=#hl-32-41> 41</a>
</span><span class=lnt id=hl-32-42><a class=lnlinks href=#hl-32-42> 42</a>
</span><span class=lnt id=hl-32-43><a class=lnlinks href=#hl-32-43> 43</a>
</span><span class=lnt id=hl-32-44><a class=lnlinks href=#hl-32-44> 44</a>
</span><span class=lnt id=hl-32-45><a class=lnlinks href=#hl-32-45> 45</a>
</span><span class=lnt id=hl-32-46><a class=lnlinks href=#hl-32-46> 46</a>
</span><span class=lnt id=hl-32-47><a class=lnlinks href=#hl-32-47> 47</a>
</span><span class=lnt id=hl-32-48><a class=lnlinks href=#hl-32-48> 48</a>
</span><span class=lnt id=hl-32-49><a class=lnlinks href=#hl-32-49> 49</a>
</span><span class=lnt id=hl-32-50><a class=lnlinks href=#hl-32-50> 50</a>
</span><span class=lnt id=hl-32-51><a class=lnlinks href=#hl-32-51> 51</a>
</span><span class=lnt id=hl-32-52><a class=lnlinks href=#hl-32-52> 52</a>
</span><span class=lnt id=hl-32-53><a class=lnlinks href=#hl-32-53> 53</a>
</span><span class=lnt id=hl-32-54><a class=lnlinks href=#hl-32-54> 54</a>
</span><span class=lnt id=hl-32-55><a class=lnlinks href=#hl-32-55> 55</a>
</span><span class=lnt id=hl-32-56><a class=lnlinks href=#hl-32-56> 56</a>
</span><span class=lnt id=hl-32-57><a class=lnlinks href=#hl-32-57> 57</a>
</span><span class=lnt id=hl-32-58><a class=lnlinks href=#hl-32-58> 58</a>
</span><span class=lnt id=hl-32-59><a class=lnlinks href=#hl-32-59> 59</a>
</span><span class=lnt id=hl-32-60><a class=lnlinks href=#hl-32-60> 60</a>
</span><span class=lnt id=hl-32-61><a class=lnlinks href=#hl-32-61> 61</a>
</span><span class=lnt id=hl-32-62><a class=lnlinks href=#hl-32-62> 62</a>
</span><span class=lnt id=hl-32-63><a class=lnlinks href=#hl-32-63> 63</a>
</span><span class=lnt id=hl-32-64><a class=lnlinks href=#hl-32-64> 64</a>
</span><span class=lnt id=hl-32-65><a class=lnlinks href=#hl-32-65> 65</a>
</span><span class=lnt id=hl-32-66><a class=lnlinks href=#hl-32-66> 66</a>
</span><span class=lnt id=hl-32-67><a class=lnlinks href=#hl-32-67> 67</a>
</span><span class=lnt id=hl-32-68><a class=lnlinks href=#hl-32-68> 68</a>
</span><span class=lnt id=hl-32-69><a class=lnlinks href=#hl-32-69> 69</a>
</span><span class=lnt id=hl-32-70><a class=lnlinks href=#hl-32-70> 70</a>
</span><span class=lnt id=hl-32-71><a class=lnlinks href=#hl-32-71> 71</a>
</span><span class=lnt id=hl-32-72><a class=lnlinks href=#hl-32-72> 72</a>
</span><span class=lnt id=hl-32-73><a class=lnlinks href=#hl-32-73> 73</a>
</span><span class=lnt id=hl-32-74><a class=lnlinks href=#hl-32-74> 74</a>
</span><span class=lnt id=hl-32-75><a class=lnlinks href=#hl-32-75> 75</a>
</span><span class=lnt id=hl-32-76><a class=lnlinks href=#hl-32-76> 76</a>
</span><span class=lnt id=hl-32-77><a class=lnlinks href=#hl-32-77> 77</a>
</span><span class=lnt id=hl-32-78><a class=lnlinks href=#hl-32-78> 78</a>
</span><span class=lnt id=hl-32-79><a class=lnlinks href=#hl-32-79> 79</a>
</span><span class=lnt id=hl-32-80><a class=lnlinks href=#hl-32-80> 80</a>
</span><span class=lnt id=hl-32-81><a class=lnlinks href=#hl-32-81> 81</a>
</span><span class=lnt id=hl-32-82><a class=lnlinks href=#hl-32-82> 82</a>
</span><span class=lnt id=hl-32-83><a class=lnlinks href=#hl-32-83> 83</a>
</span><span class=lnt id=hl-32-84><a class=lnlinks href=#hl-32-84> 84</a>
</span><span class=lnt id=hl-32-85><a class=lnlinks href=#hl-32-85> 85</a>
</span><span class=lnt id=hl-32-86><a class=lnlinks href=#hl-32-86> 86</a>
</span><span class=lnt id=hl-32-87><a class=lnlinks href=#hl-32-87> 87</a>
</span><span class=lnt id=hl-32-88><a class=lnlinks href=#hl-32-88> 88</a>
</span><span class=lnt id=hl-32-89><a class=lnlinks href=#hl-32-89> 89</a>
</span><span class=lnt id=hl-32-90><a class=lnlinks href=#hl-32-90> 90</a>
</span><span class=lnt id=hl-32-91><a class=lnlinks href=#hl-32-91> 91</a>
</span><span class=lnt id=hl-32-92><a class=lnlinks href=#hl-32-92> 92</a>
</span><span class=lnt id=hl-32-93><a class=lnlinks href=#hl-32-93> 93</a>
</span><span class=lnt id=hl-32-94><a class=lnlinks href=#hl-32-94> 94</a>
</span><span class=lnt id=hl-32-95><a class=lnlinks href=#hl-32-95> 95</a>
</span><span class=lnt id=hl-32-96><a class=lnlinks href=#hl-32-96> 96</a>
</span><span class=lnt id=hl-32-97><a class=lnlinks href=#hl-32-97> 97</a>
</span><span class=lnt id=hl-32-98><a class=lnlinks href=#hl-32-98> 98</a>
</span><span class=lnt id=hl-32-99><a class=lnlinks href=#hl-32-99> 99</a>
</span><span class=lnt id=hl-32-100><a class=lnlinks href=#hl-32-100>100</a>
</span><span class=lnt id=hl-32-101><a class=lnlinks href=#hl-32-101>101</a>
</span><span class=lnt id=hl-32-102><a class=lnlinks href=#hl-32-102>102</a>
</span><span class=lnt id=hl-32-103><a class=lnlinks href=#hl-32-103>103</a>
</span><span class=lnt id=hl-32-104><a class=lnlinks href=#hl-32-104>104</a>
</span><span class=lnt id=hl-32-105><a class=lnlinks href=#hl-32-105>105</a>
</span><span class=lnt id=hl-32-106><a class=lnlinks href=#hl-32-106>106</a>
</span><span class=lnt id=hl-32-107><a class=lnlinks href=#hl-32-107>107</a>
</span><span class=lnt id=hl-32-108><a class=lnlinks href=#hl-32-108>108</a>
</span><span class=lnt id=hl-32-109><a class=lnlinks href=#hl-32-109>109</a>
</span><span class=lnt id=hl-32-110><a class=lnlinks href=#hl-32-110>110</a>
</span><span class=lnt id=hl-32-111><a class=lnlinks href=#hl-32-111>111</a>
</span><span class=lnt id=hl-32-112><a class=lnlinks href=#hl-32-112>112</a>
</span><span class=lnt id=hl-32-113><a class=lnlinks href=#hl-32-113>113</a>
</span><span class=lnt id=hl-32-114><a class=lnlinks href=#hl-32-114>114</a>
</span><span class=lnt id=hl-32-115><a class=lnlinks href=#hl-32-115>115</a>
</span><span class=lnt id=hl-32-116><a class=lnlinks href=#hl-32-116>116</a>
</span><span class=lnt id=hl-32-117><a class=lnlinks href=#hl-32-117>117</a>
</span><span class=lnt id=hl-32-118><a class=lnlinks href=#hl-32-118>118</a>
</span><span class=lnt id=hl-32-119><a class=lnlinks href=#hl-32-119>119</a>
</span><span class=lnt id=hl-32-120><a class=lnlinks href=#hl-32-120>120</a>
</span><span class=lnt id=hl-32-121><a class=lnlinks href=#hl-32-121>121</a>
</span><span class=lnt id=hl-32-122><a class=lnlinks href=#hl-32-122>122</a>
</span><span class=lnt id=hl-32-123><a class=lnlinks href=#hl-32-123>123</a>
</span><span class=lnt id=hl-32-124><a class=lnlinks href=#hl-32-124>124</a>
</span><span class=lnt id=hl-32-125><a class=lnlinks href=#hl-32-125>125</a>
</span><span class=lnt id=hl-32-126><a class=lnlinks href=#hl-32-126>126</a>
</span><span class=lnt id=hl-32-127><a class=lnlinks href=#hl-32-127>127</a>
</span><span class=lnt id=hl-32-128><a class=lnlinks href=#hl-32-128>128</a>
</span><span class=lnt id=hl-32-129><a class=lnlinks href=#hl-32-129>129</a>
</span><span class=lnt id=hl-32-130><a class=lnlinks href=#hl-32-130>130</a>
</span><span class=lnt id=hl-32-131><a class=lnlinks href=#hl-32-131>131</a>
</span><span class=lnt id=hl-32-132><a class=lnlinks href=#hl-32-132>132</a>
</span><span class=lnt id=hl-32-133><a class=lnlinks href=#hl-32-133>133</a>
</span><span class=lnt id=hl-32-134><a class=lnlinks href=#hl-32-134>134</a>
</span><span class=lnt id=hl-32-135><a class=lnlinks href=#hl-32-135>135</a>
</span><span class=lnt id=hl-32-136><a class=lnlinks href=#hl-32-136>136</a>
</span><span class=lnt id=hl-32-137><a class=lnlinks href=#hl-32-137>137</a>
</span><span class=lnt id=hl-32-138><a class=lnlinks href=#hl-32-138>138</a>
</span><span class=lnt id=hl-32-139><a class=lnlinks href=#hl-32-139>139</a>
</span><span class=lnt id=hl-32-140><a class=lnlinks href=#hl-32-140>140</a>
</span><span class=lnt id=hl-32-141><a class=lnlinks href=#hl-32-141>141</a>
</span><span class=lnt id=hl-32-142><a class=lnlinks href=#hl-32-142>142</a>
</span><span class=lnt id=hl-32-143><a class=lnlinks href=#hl-32-143>143</a>
</span><span class=lnt id=hl-32-144><a class=lnlinks href=#hl-32-144>144</a>
</span><span class=lnt id=hl-32-145><a class=lnlinks href=#hl-32-145>145</a>
</span><span class=lnt id=hl-32-146><a class=lnlinks href=#hl-32-146>146</a>
</span><span class=lnt id=hl-32-147><a class=lnlinks href=#hl-32-147>147</a>
</span><span class=lnt id=hl-32-148><a class=lnlinks href=#hl-32-148>148</a>
</span><span class=lnt id=hl-32-149><a class=lnlinks href=#hl-32-149>149</a>
</span><span class=lnt id=hl-32-150><a class=lnlinks href=#hl-32-150>150</a>
</span><span class=lnt id=hl-32-151><a class=lnlinks href=#hl-32-151>151</a>
</span><span class=lnt id=hl-32-152><a class=lnlinks href=#hl-32-152>152</a>
</span><span class=lnt id=hl-32-153><a class=lnlinks href=#hl-32-153>153</a>
</span><span class=lnt id=hl-32-154><a class=lnlinks href=#hl-32-154>154</a>
</span><span class=lnt id=hl-32-155><a class=lnlinks href=#hl-32-155>155</a>
</span><span class=lnt id=hl-32-156><a class=lnlinks href=#hl-32-156>156</a>
</span><span class=lnt id=hl-32-157><a class=lnlinks href=#hl-32-157>157</a>
</span><span class=lnt id=hl-32-158><a class=lnlinks href=#hl-32-158>158</a>
</span><span class=lnt id=hl-32-159><a class=lnlinks href=#hl-32-159>159</a>
</span><span class=lnt id=hl-32-160><a class=lnlinks href=#hl-32-160>160</a>
</span><span class=lnt id=hl-32-161><a class=lnlinks href=#hl-32-161>161</a>
</span><span class=lnt id=hl-32-162><a class=lnlinks href=#hl-32-162>162</a>
</span><span class=lnt id=hl-32-163><a class=lnlinks href=#hl-32-163>163</a>
</span><span class=lnt id=hl-32-164><a class=lnlinks href=#hl-32-164>164</a>
</span><span class=lnt id=hl-32-165><a class=lnlinks href=#hl-32-165>165</a>
</span><span class=lnt id=hl-32-166><a class=lnlinks href=#hl-32-166>166</a>
</span><span class=lnt id=hl-32-167><a class=lnlinks href=#hl-32-167>167</a>
</span><span class=lnt id=hl-32-168><a class=lnlinks href=#hl-32-168>168</a>
</span><span class=lnt id=hl-32-169><a class=lnlinks href=#hl-32-169>169</a>
</span><span class=lnt id=hl-32-170><a class=lnlinks href=#hl-32-170>170</a>
</span><span class=lnt id=hl-32-171><a class=lnlinks href=#hl-32-171>171</a>
</span><span class=lnt id=hl-32-172><a class=lnlinks href=#hl-32-172>172</a>
</span><span class=lnt id=hl-32-173><a class=lnlinks href=#hl-32-173>173</a>
</span><span class=lnt id=hl-32-174><a class=lnlinks href=#hl-32-174>174</a>
</span><span class=lnt id=hl-32-175><a class=lnlinks href=#hl-32-175>175</a>
</span><span class=lnt id=hl-32-176><a class=lnlinks href=#hl-32-176>176</a>
</span><span class=lnt id=hl-32-177><a class=lnlinks href=#hl-32-177>177</a>
</span><span class=lnt id=hl-32-178><a class=lnlinks href=#hl-32-178>178</a>
</span><span class=lnt id=hl-32-179><a class=lnlinks href=#hl-32-179>179</a>
</span><span class=lnt id=hl-32-180><a class=lnlinks href=#hl-32-180>180</a>
</span><span class=lnt id=hl-32-181><a class=lnlinks href=#hl-32-181>181</a>
</span><span class=lnt id=hl-32-182><a class=lnlinks href=#hl-32-182>182</a>
</span><span class=lnt id=hl-32-183><a class=lnlinks href=#hl-32-183>183</a>
</span><span class=lnt id=hl-32-184><a class=lnlinks href=#hl-32-184>184</a>
</span><span class=lnt id=hl-32-185><a class=lnlinks href=#hl-32-185>185</a>
</span><span class=lnt id=hl-32-186><a class=lnlinks href=#hl-32-186>186</a>
</span><span class=lnt id=hl-32-187><a class=lnlinks href=#hl-32-187>187</a>
</span><span class=lnt id=hl-32-188><a class=lnlinks href=#hl-32-188>188</a>
</span><span class=lnt id=hl-32-189><a class=lnlinks href=#hl-32-189>189</a>
</span><span class=lnt id=hl-32-190><a class=lnlinks href=#hl-32-190>190</a>
</span><span class=lnt id=hl-32-191><a class=lnlinks href=#hl-32-191>191</a>
</span><span class=lnt id=hl-32-192><a class=lnlinks href=#hl-32-192>192</a>
</span><span class=lnt id=hl-32-193><a class=lnlinks href=#hl-32-193>193</a>
</span><span class=lnt id=hl-32-194><a class=lnlinks href=#hl-32-194>194</a>
</span><span class=lnt id=hl-32-195><a class=lnlinks href=#hl-32-195>195</a>
</span><span class=lnt id=hl-32-196><a class=lnlinks href=#hl-32-196>196</a>
</span><span class=lnt id=hl-32-197><a class=lnlinks href=#hl-32-197>197</a>
</span><span class=lnt id=hl-32-198><a class=lnlinks href=#hl-32-198>198</a>
</span><span class=lnt id=hl-32-199><a class=lnlinks href=#hl-32-199>199</a>
</span><span class=lnt id=hl-32-200><a class=lnlinks href=#hl-32-200>200</a>
</span><span class=lnt id=hl-32-201><a class=lnlinks href=#hl-32-201>201</a>
</span><span class=lnt id=hl-32-202><a class=lnlinks href=#hl-32-202>202</a>
</span><span class=lnt id=hl-32-203><a class=lnlinks href=#hl-32-203>203</a>
</span><span class=lnt id=hl-32-204><a class=lnlinks href=#hl-32-204>204</a>
</span><span class=lnt id=hl-32-205><a class=lnlinks href=#hl-32-205>205</a>
</span><span class=lnt id=hl-32-206><a class=lnlinks href=#hl-32-206>206</a>
</span><span class=lnt id=hl-32-207><a class=lnlinks href=#hl-32-207>207</a>
</span><span class=lnt id=hl-32-208><a class=lnlinks href=#hl-32-208>208</a>
</span><span class=lnt id=hl-32-209><a class=lnlinks href=#hl-32-209>209</a>
</span><span class=lnt id=hl-32-210><a class=lnlinks href=#hl-32-210>210</a>
</span><span class=lnt id=hl-32-211><a class=lnlinks href=#hl-32-211>211</a>
</span><span class=lnt id=hl-32-212><a class=lnlinks href=#hl-32-212>212</a>
</span><span class=lnt id=hl-32-213><a class=lnlinks href=#hl-32-213>213</a>
</span><span class=lnt id=hl-32-214><a class=lnlinks href=#hl-32-214>214</a>
</span><span class=lnt id=hl-32-215><a class=lnlinks href=#hl-32-215>215</a>
</span><span class=lnt id=hl-32-216><a class=lnlinks href=#hl-32-216>216</a>
</span><span class=lnt id=hl-32-217><a class=lnlinks href=#hl-32-217>217</a>
</span><span class=lnt id=hl-32-218><a class=lnlinks href=#hl-32-218>218</a>
</span><span class=lnt id=hl-32-219><a class=lnlinks href=#hl-32-219>219</a>
</span><span class=lnt id=hl-32-220><a class=lnlinks href=#hl-32-220>220</a>
</span><span class=lnt id=hl-32-221><a class=lnlinks href=#hl-32-221>221</a>
</span><span class=lnt id=hl-32-222><a class=lnlinks href=#hl-32-222>222</a>
</span><span class=lnt id=hl-32-223><a class=lnlinks href=#hl-32-223>223</a>
</span><span class=lnt id=hl-32-224><a class=lnlinks href=#hl-32-224>224</a>
</span><span class=lnt id=hl-32-225><a class=lnlinks href=#hl-32-225>225</a>
</span><span class=lnt id=hl-32-226><a class=lnlinks href=#hl-32-226>226</a>
</span><span class=lnt id=hl-32-227><a class=lnlinks href=#hl-32-227>227</a>
</span><span class=lnt id=hl-32-228><a class=lnlinks href=#hl-32-228>228</a>
</span><span class=lnt id=hl-32-229><a class=lnlinks href=#hl-32-229>229</a>
</span><span class=lnt id=hl-32-230><a class=lnlinks href=#hl-32-230>230</a>
</span><span class=lnt id=hl-32-231><a class=lnlinks href=#hl-32-231>231</a>
</span><span class=lnt id=hl-32-232><a class=lnlinks href=#hl-32-232>232</a>
</span><span class=lnt id=hl-32-233><a class=lnlinks href=#hl-32-233>233</a>
</span><span class=lnt id=hl-32-234><a class=lnlinks href=#hl-32-234>234</a>
</span><span class=lnt id=hl-32-235><a class=lnlinks href=#hl-32-235>235</a>
</span><span class=lnt id=hl-32-236><a class=lnlinks href=#hl-32-236>236</a>
</span><span class=lnt id=hl-32-237><a class=lnlinks href=#hl-32-237>237</a>
</span><span class=lnt id=hl-32-238><a class=lnlinks href=#hl-32-238>238</a>
</span><span class=lnt id=hl-32-239><a class=lnlinks href=#hl-32-239>239</a>
</span><span class=lnt id=hl-32-240><a class=lnlinks href=#hl-32-240>240</a>
</span><span class=lnt id=hl-32-241><a class=lnlinks href=#hl-32-241>241</a>
</span><span class=lnt id=hl-32-242><a class=lnlinks href=#hl-32-242>242</a>
</span><span class=lnt id=hl-32-243><a class=lnlinks href=#hl-32-243>243</a>
</span><span class=lnt id=hl-32-244><a class=lnlinks href=#hl-32-244>244</a>
</span><span class=lnt id=hl-32-245><a class=lnlinks href=#hl-32-245>245</a>
</span><span class=lnt id=hl-32-246><a class=lnlinks href=#hl-32-246>246</a>
</span><span class=lnt id=hl-32-247><a class=lnlinks href=#hl-32-247>247</a>
</span><span class=lnt id=hl-32-248><a class=lnlinks href=#hl-32-248>248</a>
</span><span class=lnt id=hl-32-249><a class=lnlinks href=#hl-32-249>249</a>
</span><span class=lnt id=hl-32-250><a class=lnlinks href=#hl-32-250>250</a>
</span><span class=lnt id=hl-32-251><a class=lnlinks href=#hl-32-251>251</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mysql</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;mysql2/promise&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Redis</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;ioredis&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>Kafka</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;kafkajs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ECommerceInventorySystem</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 데이터베이스 연결 풀 설정
</span></span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>dbPool</span> <span class=o>=</span> <span class=nx>mysql</span><span class=p>.</span><span class=nx>createPool</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;mysql-master&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>user</span><span class=o>:</span> <span class=s1>&#39;ecommerce_user&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>password</span><span class=o>:</span> <span class=s1>&#39;secure_password&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>database</span><span class=o>:</span> <span class=s1>&#39;ecommerce&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>waitForConnections</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>connectionLimit</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>queueLimit</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Transaction Isolation 설정: Repeatable Read
</span></span></span><span class=line><span class=cl>            <span class=c1>// 주문 프로세스 중 재고 일관성 보장을 위한 격리 수준
</span></span></span><span class=line><span class=cl>            <span class=nx>isolationLevel</span><span class=o>:</span> <span class=s1>&#39;REPEATABLE READ&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Redis 클러스터 연결
</span></span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>redis</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Redis</span><span class=p>.</span><span class=nx>Cluster</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;redis-1&#39;</span><span class=p>,</span> <span class=nx>port</span><span class=o>:</span> <span class=mi>6379</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;redis-2&#39;</span><span class=p>,</span> <span class=nx>port</span><span class=o>:</span> <span class=mi>6379</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;redis-3&#39;</span><span class=p>,</span> <span class=nx>port</span><span class=o>:</span> <span class=mi>6379</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Kafka producer 설정
</span></span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>kafka</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Kafka</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>clientId</span><span class=o>:</span> <span class=s1>&#39;inventory-service&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>brokers</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;kafka-1:9092&#39;</span><span class=p>,</span> <span class=s1>&#39;kafka-2:9092&#39;</span><span class=p>,</span> <span class=s1>&#39;kafka-3:9092&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>producer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>kafka</span><span class=p>.</span><span class=nx>producer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>processOrder</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * 주문 처리 메인 로직
</span></span></span><span class=line><span class=cl><span class=cm>         * - Transaction Isolation의 핵심 적용 부분
</span></span></span><span class=line><span class=cl><span class=cm>         * - Repeatable Read 격리 수준으로 재고 일관성 보장
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>connection</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>dbPool</span><span class=p>.</span><span class=nx>getConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 트랜잭션 시작 - Transaction Isolation 적용 시점
</span></span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>beginTransaction</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`주문 처리 시작: Customer </span><span class=si>${</span><span class=nx>customerId</span><span class=si>}</span><span class=sb>, Product </span><span class=si>${</span><span class=nx>productId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 1. 캐시에서 빠른 재고 확인 (성능 최적화)
</span></span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>cachedStock</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`stock:</span><span class=si>${</span><span class=nx>productId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>cachedStock</span> <span class=o>&amp;&amp;</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>cachedStock</span><span class=p>)</span> <span class=o>&lt;</span> <span class=nx>quantity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;재고 부족 (캐시 기준)&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 2. 데이터베이스에서 정확한 재고 확인 및 잠금
</span></span></span><span class=line><span class=cl>            <span class=c1>// Transaction Isolation의 핵심: FOR UPDATE로 배타적 잠금 획득
</span></span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=p>[</span><span class=nx>stockRows</span><span class=p>]</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sb>`SELECT stock_quantity, reserved_quantity 
</span></span></span><span class=line><span class=cl><span class=sb>                 FROM product_inventory 
</span></span></span><span class=line><span class=cl><span class=sb>                 WHERE product_id = ? FOR UPDATE`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=nx>productId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>stockRows</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;상품을 찾을 수 없습니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>availableStock</span> <span class=o>=</span> <span class=nx>stockRows</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>stock_quantity</span> <span class=o>-</span> <span class=nx>stockRows</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>reserved_quantity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`현재 가용 재고: </span><span class=si>${</span><span class=nx>availableStock</span><span class=si>}</span><span class=sb> (잠금 획득됨)`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>availableStock</span> <span class=o>&lt;</span> <span class=nx>quantity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`재고 부족: 요청 </span><span class=si>${</span><span class=nx>quantity</span><span class=si>}</span><span class=sb>, 가용 </span><span class=si>${</span><span class=nx>availableStock</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 3. 재고 예약 (실제 차감 전 단계)
</span></span></span><span class=line><span class=cl>            <span class=c1>// Transaction Isolation 보장 하에 안전한 재고 업데이트
</span></span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sb>`UPDATE product_inventory 
</span></span></span><span class=line><span class=cl><span class=sb>                 SET reserved_quantity = reserved_quantity + ? 
</span></span></span><span class=line><span class=cl><span class=sb>                 WHERE product_id = ?`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=nx>quantity</span><span class=p>,</span> <span class=nx>productId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 4. 주문 생성
</span></span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>orderId</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>createOrder</span><span class=p>(</span><span class=nx>connection</span><span class=p>,</span> <span class=nx>customerId</span><span class=p>,</span> <span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 5. 재고 실제 차감 및 예약 해제
</span></span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sb>`UPDATE product_inventory 
</span></span></span><span class=line><span class=cl><span class=sb>                 SET stock_quantity = stock_quantity - ?,
</span></span></span><span class=line><span class=cl><span class=sb>                     reserved_quantity = reserved_quantity - ?
</span></span></span><span class=line><span class=cl><span class=sb>                 WHERE product_id = ?`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=nx>quantity</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>,</span> <span class=nx>productId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 6. 트랜잭션 커밋 - Transaction Isolation의 원자성 완성
</span></span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>commit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 7. 캐시 업데이트 (일관성 유지)
</span></span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>newStock</span> <span class=o>=</span> <span class=nx>stockRows</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>stock_quantity</span> <span class=o>-</span> <span class=nx>quantity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=sb>`stock:</span><span class=si>${</span><span class=nx>productId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>newStock</span><span class=p>,</span> <span class=s1>&#39;EX&#39;</span><span class=p>,</span> <span class=mi>300</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 8. 이벤트 발행 (비동기 처리)
</span></span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishInventoryEvent</span><span class=p>(</span><span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>,</span> <span class=s1>&#39;STOCK_DECREASED&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`주문 처리 완료: Order </span><span class=si>${</span><span class=nx>orderId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span> <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>orderId</span><span class=p>,</span> <span class=nx>remainingStock</span><span class=o>:</span> <span class=nx>newStock</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 트랜잭션 롤백 - Transaction Isolation의 원자성 보장
</span></span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>rollback</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`주문 처리 실패: </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 캐시 무효화 (데이터 일관성)
</span></span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>del</span><span class=p>(</span><span class=sb>`stock:</span><span class=si>${</span><span class=nx>productId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span> <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 연결 해제
</span></span></span><span class=line><span class=cl>            <span class=nx>connection</span><span class=p>.</span><span class=nx>release</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>connection</span><span class=p>,</span> <span class=nx>customerId</span><span class=p>,</span> <span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * 주문 레코드 생성
</span></span></span><span class=line><span class=cl><span class=cm>         * - 동일한 트랜잭션 내에서 실행되어 Transaction Isolation 보장
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>[</span><span class=nx>result</span><span class=p>]</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sb>`INSERT INTO orders (customer_id, product_id, quantity, order_status, created_at)
</span></span></span><span class=line><span class=cl><span class=sb>             VALUES (?, ?, ?, &#39;PENDING&#39;, NOW())`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>orderId</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>insertId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 상세 정보 추가
</span></span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>connection</span><span class=p>.</span><span class=nx>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sb>`INSERT INTO order_items (order_id, product_id, quantity, unit_price)
</span></span></span><span class=line><span class=cl><span class=sb>             SELECT ?, product_id, ?, price 
</span></span></span><span class=line><span class=cl><span class=sb>             FROM products WHERE product_id = ?`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=nx>orderId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>,</span> <span class=nx>productId</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>orderId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>publishInventoryEvent</span><span class=p>(</span><span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>,</span> <span class=nx>eventType</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * 재고 변경 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=cm>         * - Transaction Isolation 외부에서 실행되는 비동기 처리
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>topic</span><span class=o>:</span> <span class=s1>&#39;inventory-events&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>messages</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>key</span><span class=o>:</span> <span class=nx>productId</span><span class=p>.</span><span class=nx>toString</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                    <span class=nx>value</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=nx>productId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>eventType</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=p>})</span>
</span></span><span class=line><span class=cl>                <span class=p>}]</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`이벤트 발행 실패: </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 별도 재시도 로직 필요
</span></span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleConcurrentOrders</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * 동시 주문 처리 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=cm>         * - Transaction Isolation의 효과 검증
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>productId</span> <span class=o>=</span> <span class=mi>12345</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>orderPromises</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 10개의 동시 주문 시뮬레이션
</span></span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;=</span> <span class=mi>10</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>promise</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>processOrder</span><span class=p>(</span><span class=sb>`customer_</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>productId</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>orderPromises</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>promise</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 모든 주문 처리 완료 대기
</span></span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>results</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span><span class=nx>orderPromises</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 결과 분석
</span></span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>successCount</span> <span class=o>=</span> <span class=nx>results</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>r</span> <span class=p>=&gt;</span> <span class=nx>r</span><span class=p>.</span><span class=nx>success</span><span class=p>).</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>failureCount</span> <span class=o>=</span> <span class=nx>results</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>r</span> <span class=p>=&gt;</span> <span class=o>!</span><span class=nx>r</span><span class=p>.</span><span class=nx>success</span><span class=p>).</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`동시 주문 처리 결과:`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`- 성공: </span><span class=si>${</span><span class=nx>successCount</span><span class=si>}</span><span class=sb>건`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`- 실패: </span><span class=si>${</span><span class=nx>failureCount</span><span class=si>}</span><span class=sb>건`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Transaction Isolation로 재고 일관성 보장됨`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Express.js 라우터 설정
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>inventorySystem</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ECommerceInventorySystem</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/orders&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 주문 API 엔드포인트
</span></span></span><span class=line><span class=cl><span class=cm>     * - Transaction Isolation이 적용된 주문 처리 호출
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>customerId</span><span class=p>,</span> <span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 입력 검증
</span></span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>customerId</span> <span class=o>||</span> <span class=o>!</span><span class=nx>productId</span> <span class=o>||</span> <span class=o>!</span><span class=nx>quantity</span> <span class=o>||</span> <span class=nx>quantity</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;잘못된 요청 데이터&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 주문 처리 (Transaction Isolation 적용)
</span></span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>inventorySystem</span><span class=p>.</span><span class=nx>processOrder</span><span class=p>(</span><span class=nx>customerId</span><span class=p>,</span> <span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>201</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;주문이 성공적으로 처리되었습니다&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>orderId</span><span class=o>:</span> <span class=nx>result</span><span class=p>.</span><span class=nx>orderId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>remainingStock</span><span class=o>:</span> <span class=nx>result</span><span class=p>.</span><span class=nx>remainingStock</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>409</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>error</span><span class=o>:</span> <span class=nx>result</span><span class=p>.</span><span class=nx>error</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;주문 처리 중 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;서버 내부 오류가 발생했습니다&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 서버 시작
</span></span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mi>3000</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;E-commerce 재고 관리 시스템이 포트 3000에서 실행 중입니다&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Transaction Isolation (Repeatable Read) 적용됨&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li><strong>성능 개선</strong>: 주문 처리 응답 시간 평균 320ms (목표 500ms 대비 36% 개선)</li><li><strong>운영 효율성</strong>: 재고 오버셀링 99.9% 감소 (월 1000 건 → 1 건)</li><li><strong>비용 절감</strong>: 주문 취소로 인한 손실 월 5 억원 → 500 만원 (99% 절감)</li><li><strong>고객 만족도</strong>: 재고 관련 불만 90% 감소, 고객 만족도 15% 향상</li><li><strong>시스템 안정성</strong>: 데이터 일관성 관련 장애 0 건, 시스템 가용성 99.95% 달성</li></ul><h5 id=사례-리포팅-트래픽이-많은-주문-시스템>사례: 리포팅 트래픽이 많은 주문 시스템<a hidden class=anchor aria-hidden=true href=#사례-리포팅-트래픽이-많은-주문-시스템>#</a></h5><p><strong>사례 선정</strong>: 리포팅 트래픽이 많은 주문 시스템<br><strong>비즈니스 배경</strong>: 리포팅 SELECT 가 OLTP 쓰기를 자주 블로킹<br><strong>기술적 요구사항</strong>: 읽기 비차단, 데이터 읽기 일관성 유지</p><p><strong>시스템 구성</strong></p><ul><li>SQL Server 2019+, 애플리케이션.NET API</li><li>데이터베이스: RCSI 활성화</li></ul><p><strong>다이어그램</strong></p><pre class=mermaid>graph TB
  API --&gt; SQL[(SQL Server)]
  SQL --&gt; RV[tempdb Row Version Store]
</pre><p><strong>Workflow</strong></p><ol><li>DBA 가 DB 단위로 RCSI 활성화</li><li>애플리케이션은 기존 RC 그대로 사용 (설정만으로 효과)</li><li>읽기는 버전 읽기, 쓰기는 최신 행 갱신</li></ol><p><strong>구현 예시 (T-SQL: 운영 설정)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1>1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2>2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3>3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 이 설정은 &#39;읽기 비차단(READ COMMITTED SNAPSHOT)&#39;을 위한 것
</span></span></span><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>SalesDB</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>READ_COMMITTED_SNAPSHOT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=k>ROLLBACK</span><span class=w> </span><span class=k>IMMEDIATE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>-- 일부 트랜잭션에서 강한 격리가 필요하면 명시적으로 요청
</span></span></span><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=k>SERIALIZABLE</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>근거: RCSI/스냅샷 격리는 <strong>tempdb 에 버전을 저장</strong>하여 읽기 - 쓰기 경합을 줄인다.</p></blockquote><p><strong>성과 분석</strong></p><ul><li>성능 개선: 블로킹 대기시간 60%↓, 보고 질의 지연 P95 40%↓(내부 측정 가정)</li><li>운영 효율성: 배치/리포트 시간 안정화</li><li>비용 절감: 리포팅 복제본 규모 축소</li></ul><h5 id=사례-마이크로서비스-기반-주문-처리>사례: 마이크로서비스 기반 주문 처리<a hidden class=anchor aria-hidden=true href=#사례-마이크로서비스-기반-주문-처리>#</a></h5><p><strong>아키텍처 구성 및 흐름</strong>:</p><pre class=mermaid>graph LR
    A[Order Service] --&gt;|Create Order| B[Payment Service]
    B --&gt;|Charge Card| C[Inventory Service]
    C --&gt;|Reserve Items| D[Shipping Service]
    D --&gt;|Schedule Shipment| A
</pre><ol><li><strong>Order Service</strong> 트랜잭션 시작</li><li>각 서비스는 <strong>로컬 트랜잭션</strong> 실행</li><li>실패 시 <strong>보상 트랜잭션</strong> 실행 (예: 주문 취소, 결제 취소, 재고 복원)</li><li>전체 흐름은 <strong>Eventually Consistent</strong> 보장</li></ol><ul><li><strong>Transaction Isolation 역할</strong>:<ul><li>로컬 DB 내 Snapshot Isolation 으로 트랜잭션 격리를 보장</li><li>Saga 보상 트랜잭션으로 글로벌 일관성 확보</li></ul></li></ul><p><strong>구현 코드 예시</strong>: Python Flask + SQLAlchemy</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13>13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14>14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15>15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16>16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17>17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18>18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19>19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20>20</a>
</span><span class=lnt id=hl-36-21><a class=lnlinks href=#hl-36-21>21</a>
</span><span class=lnt id=hl-36-22><a class=lnlinks href=#hl-36-22>22</a>
</span><span class=lnt id=hl-36-23><a class=lnlinks href=#hl-36-23>23</a>
</span><span class=lnt id=hl-36-24><a class=lnlinks href=#hl-36-24>24</a>
</span><span class=lnt id=hl-36-25><a class=lnlinks href=#hl-36-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>sessionmaker</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span><span class=s1>&#39;postgresql://user:pass@localhost/orderdb&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Session</span> <span class=o>=</span> <span class=n>sessionmaker</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/order&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_order</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span> <span class=o>=</span> <span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>&#39;SET TRANSACTION ISOLATION LEVEL REPEATABLE READ&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Create order record</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;INSERT INTO orders …&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Simulate call to payment service</span>
</span></span><span class=line><span class=cl>        <span class=n>process_payment</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>compensate_order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;OK&#34;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>REPEATABLE READ</code> 로 Snapshot Isolation 수준 확보</li><li>실패 시 <code>compensate_order()</code> 로 보상 트랜잭션 호출</li></ul><h5 id=사례-인터넷-뱅킹--계좌-이체--시스템>사례: 인터넷 뱅킹 " 계좌 이체 " 시스템<a hidden class=anchor aria-hidden=true href=#사례-인터넷-뱅킹--계좌-이체--시스템>#</a></h5><p><strong>사례:</strong> 인터넷 뱅킹 " 계좌 이체 " 시스템</p><ul><li>구성: 사용자, 프론트엔드 (Front-end) 서버, 트랜잭션 관리자 (Backend), DBMS, Logging</li><li>Workflow<ol><li>사용자 A 가 계좌 이체 요청</li><li>트랜잭션 시작 후 A 계좌 차감, B 계좌 증가</li><li>모든 작업 완료 후 COMMIT</li><li>도중 장애 발생시 전체 롤백, 데이터 무결성 보장</li></ol></li></ul><p><strong>시스템 다이어그램 (Mermaid)</strong></p><pre class=mermaid>graph LR
  UA[User A] --&gt; FE[Front-end Server]
  FE --&gt; TM[Transaction Manager]
  TM --&gt; DB[Database]
  TM --&gt; LOG[Logging System]
</pre><ul><li><strong>트랜잭션 격리성의 유무 차이</strong><ul><li>격리성 미적용 시: 동시 이체 중 한쪽 결과만 반영, 잔액 오류, 데이터 불일치</li><li>격리성 적용 시: 완전 일관성 보장, 교착상태만 적절히 관리 시 오류 없음</li></ul></li></ul><p><strong>구현 예시</strong>: Python, MVCC 스타일</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1> 1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2> 2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3> 3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4> 4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5> 5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6> 6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7> 7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8> 8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9> 9</a>
</span><span class=lnt id=hl-38-10><a class=lnlinks href=#hl-38-10>10</a>
</span><span class=lnt id=hl-38-11><a class=lnlinks href=#hl-38-11>11</a>
</span><span class=lnt id=hl-38-12><a class=lnlinks href=#hl-38-12>12</a>
</span><span class=lnt id=hl-38-13><a class=lnlinks href=#hl-38-13>13</a>
</span><span class=lnt id=hl-38-14><a class=lnlinks href=#hl-38-14>14</a>
</span><span class=lnt id=hl-38-15><a class=lnlinks href=#hl-38-15>15</a>
</span><span class=lnt id=hl-38-16><a class=lnlinks href=#hl-38-16>16</a>
</span><span class=lnt id=hl-38-17><a class=lnlinks href=#hl-38-17>17</a>
</span><span class=lnt id=hl-38-18><a class=lnlinks href=#hl-38-18>18</a>
</span><span class=lnt id=hl-38-19><a class=lnlinks href=#hl-38-19>19</a>
</span><span class=lnt id=hl-38-20><a class=lnlinks href=#hl-38-20>20</a>
</span><span class=lnt id=hl-38-21><a class=lnlinks href=#hl-38-21>21</a>
</span><span class=lnt id=hl-38-22><a class=lnlinks href=#hl-38-22>22</a>
</span><span class=lnt id=hl-38-23><a class=lnlinks href=#hl-38-23>23</a>
</span><span class=lnt id=hl-38-24><a class=lnlinks href=#hl-38-24>24</a>
</span><span class=lnt id=hl-38-25><a class=lnlinks href=#hl-38-25>25</a>
</span><span class=lnt id=hl-38-26><a class=lnlinks href=#hl-38-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 단순한 MVCC 기반 격리성 동작 예시</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>VersionedValue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>tid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tid</span> <span class=o>=</span> <span class=n>tid</span>  <span class=c1># transaction id(트랜잭션 id)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SimpleMVCCDB</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># col_name: [VersionedValue, …]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>read</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>tid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># tid 이전에 커밋된 최신값만 노출(격리성 관리)</span>
</span></span><span class=line><span class=cl>        <span class=n>versions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>col</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>ver</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=n>versions</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>ver</span><span class=o>.</span><span class=n>tid</span> <span class=o>&lt;=</span> <span class=n>tid</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>ver</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>write</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>tid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>col</span><span class=p>,</span> <span class=p>[])</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>VersionedValue</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>tid</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>db</span> <span class=o>=</span> <span class=n>SimpleMVCCDB</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;balance&#34;</span><span class=p>,</span> <span class=mi>10000</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>  <span class=c1># 트랜잭션1: 초기값 설정</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s2>&#34;balance&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>   <span class=c1># 트랜잭션2: 10000 출력</span>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;balance&#34;</span><span class=p>,</span> <span class=mi>9000</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>   <span class=c1># 트랜잭션2: 9000으로 변경</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s2>&#34;balance&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span>   <span class=c1># 트랜잭션1은 10000만 읽음(격리)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>각 트랜잭션은 자신의 TID 이하의 값만 읽음으로써 격리성이 적용된다.</li></ul><h3 id=부록-4-고급-응용-시나리오-예제>부록 4: 고급 응용 시나리오 예제<a hidden class=anchor aria-hidden=true href=#부록-4-고급-응용-시나리오-예제>#</a></h3><p><strong>시나리오</strong>:<br>멀티테넌시 (Multi-Tenancy) SaaS 환경에서 각 테넌트 (Tenant) 데이터가 철저히 격리되어야 하고, 동시에 수천 건의 요청이 실시간으로 처리돼야 하는 상황.</p><p><strong>구현 방안</strong>:</p><ol><li><strong>기본 격리 수준</strong>: Read Committed</li><li><strong>특정 고위험 API(결제/정산)</strong>: Serializable 격리 수준 적용</li><li><strong>DB 연결 풀 (Connection Pool)</strong> 내 격리 수준 설정 분리</li><li>**MVCC(Snapshot Isolation)**를 기본 구현으로 활용</li><li><strong>Observability(관측성)</strong> 연계로 격리 수준별 성능 차이 측정</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1> 1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2> 2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3> 3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4> 4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5> 5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6> 6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7> 7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8> 8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9> 9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10>10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11>11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12>12</a>
</span><span class=lnt id=hl-39-13><a class=lnlinks href=#hl-39-13>13</a>
</span><span class=lnt id=hl-39-14><a class=lnlinks href=#hl-39-14>14</a>
</span><span class=lnt id=hl-39-15><a class=lnlinks href=#hl-39-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Python 예제 - SQLAlchemy 기반 Isolation Level 설정</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 연결 엔진 생성 - 기본 Read Committed</span>
</span></span><span class=line><span class=cl><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;postgresql+psycopg2://user:pass@localhost/dbname&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>isolation_level</span><span class=o>=</span><span class=s2>&#34;READ COMMITTED&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 특정 트랜잭션 블록에서 Serializable 적용</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>engine</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>execution_options</span><span class=p>(</span><span class=n>isolation_level</span><span class=o>=</span><span class=s2>&#34;SERIALIZABLE&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;BEGIN;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE orders SET status=&#39;paid&#39; WHERE id=123;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;COMMIT;&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>위 예시에서, 결제 처리 로직에서만 <strong>Serializable</strong> 수준을 적용하여 결제 데이터의 일관성을 극대화하면서, 전체 시스템 성능은 기본 <strong>Read Committed</strong>로 유지.</p></blockquote><h4 id=통합-및-연계-기술>통합 및 연계 기술<a hidden class=anchor aria-hidden=true href=#통합-및-연계-기술>#</a></h4><p>트랜잭션 격리 수준은 단일 DB 엔진 내부뿐 아니라 외부 시스템·패턴과의 통합에서 동작 방식이 크게 달라진다.</p><ul><li><strong>DBMS 연계</strong>에서는 엔진별 구현 차이 (MVCC, SSI, Gap Lock 등) 로 인해 동일 격리 수준이라도 동작이 상이하다.</li><li><strong>캐싱 연계</strong>에서는 커밋 시점 동기화와 TTL, Write-through/Write-behind 전략이 중요하다.</li><li><strong>메시지 브로커 연계</strong>는 Outbox 패턴과 Exactly-once 의미론이 핵심이며, 보상 트랜잭션으로 일관성 회복 가능.</li><li><strong>모니터링 연계</strong>는 OpenTelemetry, Prometheus, ELK 로 트랜잭션 상태·격리 영향 추적.</li><li><strong>분산 아키텍처 연계</strong>는 CQRS, 읽기 전용 복제본, SAGA 를 통해 동시성과 일관성을 균형 있게 조정한다.</li></ul><table><thead><tr><th>카테고리</th><th>기술/패턴</th><th>주요 기능</th><th>트랜잭션 격리 연계 포인트</th><th>사용 사례</th></tr></thead><tbody><tr><td>DBMS 연계</td><td>MySQL InnoDB</td><td>MVCC+ 락 하이브리드, Gap Lock</td><td>Phantom Read 방지, RC/RR 최적화</td><td>금융 DB</td></tr><tr><td></td><td>PostgreSQL</td><td>MVCC+SSI</td><td>Write Skew 방지</td><td>결제 시스템</td></tr><tr><td></td><td>Oracle</td><td>Read Consistency, Flashback</td><td>과거 시점 조회와 격리 결합</td><td>데이터 감사</td></tr><tr><td>캐싱 연계</td><td>Redis</td><td>커밋 후 캐시 무효화, 분산락</td><td>Dirty Read 방지</td><td>세션 관리</td></tr><tr><td></td><td>Memcached</td><td>TTL 기반 캐싱</td><td>RC 환경에서 캐시 stale 방지</td><td>API 응답 캐싱</td></tr><tr><td>메시지 브로커 연계</td><td>Kafka</td><td>Outbox 패턴, Exactly-once</td><td>커밋 후 이벤트 발행 보장</td><td>마이크로서비스 이벤트 전달</td></tr><tr><td></td><td>RabbitMQ</td><td>보상 트랜잭션, 트랜잭션 메시지</td><td>격리 수준 유지한 비동기 처리</td><td>주문 처리</td></tr><tr><td>모니터링 연계</td><td>Prometheus+Grafana</td><td>성능 메트릭, 데드락 모니터링</td><td>격리 수준별 성능 영향 시각화</td><td>실시간 모니터링</td></tr><tr><td></td><td>ELK Stack</td><td>로그 분석, 오류 추적</td><td>격리 위반 패턴 식별</td><td>장애 분석</td></tr><tr><td>분산 아키텍처 연계</td><td>CQRS+ 읽기 전용 복제본</td><td>읽기/쓰기 분리, SI 활용</td><td>OLTP 부하 분산</td><td>전자상거래</td></tr><tr><td></td><td>SAGA/워크플로우</td><td>단계별 보상 트랜잭션</td><td>글로벌 일관성 보장</td><td>여행 예약 시스템</td></tr></tbody></table><p>트랜잭션 격리 수준은 단순한 DB 내부 설정이 아니라, <strong>DBMS·캐시·메시지 브로커·모니터링·분산 패턴과의 조합</strong>에서 실질적인 성능과 일관성을 결정한다.</p><ul><li>DBMS 별 MVCC·락 동작 차이를 이해해야 하고,</li><li>캐싱·브로커에서는 커밋 타이밍과 동기화 전략이 핵심이며,</li><li>모니터링/분산 패턴은 장기 운영에서 안정성을 확보하는 열쇠다.</li></ul><h3 id=운영-및-최적화-operations--optimization>운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#운영-및-최적화-operations--optimization>#</a></h3><h4 id=보안-및-거버넌스>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스>#</a></h4><p>트랜잭션 격리 보안·거버넌스는 <strong>변경 관리</strong>, <strong>권한 제어</strong>, <strong>감사 로깅</strong>, <strong>접근 패턴 모니터링</strong>, <strong>규제 준수</strong>를 중심으로 한다.<br>격리 수준 변경은 Change Management 절차에 따라 승인·검증·롤백 계획과 함께 수행되어야 하며, 사용자·역할별 권한에 따라 격리 수준을 제한해야 한다.<br>모든 변경과 트랜잭션 충돌 (SSI 포함) 은 감사 로그로 추적하며, 장기 실행 트랜잭션 방지를 위해 타임아웃 정책을 적용한다.<br>또한 비정상적인 접근 패턴을 탐지·차단하는 모니터링을 구축하고, GDPR·SOX·PCI DSS 등 규제에 따라 민감 데이터 처리 시 높은 격리 수준과 암호화를 병행해야 한다.<br>운영 표준화와 장애 시 롤백 전략 수립은 필수이며, 분산·멀티 리전 환경에서는 글로벌 거버넌스 정책이 일관되게 적용되어야 한다.</p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>구현/운영 방법</th><th>적용 규제/표준</th></tr></thead><tbody><tr><td>변경 관리</td><td>Change Management</td><td>격리 수준 변경 승인·롤백 계획 필수</td><td>운영 절차서, 변경 승인 워크플로우</td><td>ISO 27001</td></tr><tr><td>권한 제어</td><td>Role-based Isolation Control</td><td>사용자·역할별 격리 수준 제한, 민감 데이터에 높은 수준 강제</td><td>DB 권한 매핑, 정책 스크립트</td><td>GDPR, PCI DSS</td></tr><tr><td>감사 로깅</td><td>Audit Logging</td><td>변경·충돌·실패 이벤트 추적</td><td>SI/SSI 충돌 이벤트 로깅, 변경 로그 저장</td><td>SOX, GDPR</td></tr><tr><td>타임아웃 보안</td><td>Transaction Timeout</td><td>장기 실행 트랜잭션 DoS 방지</td><td>자동 타임아웃 설정, 알림</td><td>OWASP ASVS</td></tr><tr><td>접근 패턴 모니터링</td><td>Pattern Monitoring</td><td>비정상적 읽기·쓰기·격리 우회 탐지</td><td>실시간 모니터링, 경고 시스템</td><td>GDPR</td></tr><tr><td>규제 준수</td><td>Compliance Enforcement</td><td>규제별 보안·일관성 요구 충족</td><td>정책 템플릿, 감사 리포트</td><td>GDPR, SOX, PCI DSS</td></tr><tr><td>운영 거버넌스</td><td>Operational Governance</td><td>표준화·장애시 롤백 전략</td><td>표준 운영 매뉴얼, DR 계획</td><td>ITIL, COBIT</td></tr></tbody></table><p>트랜잭션 격리의 보안·거버넌스는 <strong>변경 시 승인·롤백 계획, 권한 기반 제어, 감사 로깅, 타임아웃 보안, 접근 패턴 모니터링, 규제 준수, 표준 운영 절차</strong>가 핵심이다. 이는 단일 DBMS 뿐 아니라 분산·멀티 리전 환경에도 동일하게 적용되어야 하며, GDPR·SOX·PCI DSS 와 같은 국제 규정을 준수해야 한다. 특히 실시간 모니터링과 자동 정책 적용을 통한 사전 대응 체계가 중요하다.</p><h4 id=모니터링-및-관측성>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성>#</a></h4><table><thead><tr><th>레이어</th><th>무엇을 본다</th><th>대표 지표</th><th>수집 지점/도구</th><th>알림 가이드</th><th>비고 (격리 연관)</th></tr></thead><tbody><tr><td>성능</td><td>처리량/지연</td><td>TPS, p50/p95/p99</td><td>DB Exporter, APM</td><td>p95 +30%/10m</td><td>격리 상향 시 지연↑ 경향</td></tr><tr><td>충돌</td><td>직렬화·데드락</td><td>serialization_fail_rate, deadlock_count/rate, rollback_rate</td><td>엔진 DMVs/뷰, 에러 로그</td><td>실패율 >2%, 데드락 >0.5%</td><td>Serializable/SSI·범위락 영향 큼</td></tr><tr><td>락/대기</td><td>락 대기/이벤트</td><td>lock_wait_ms, top waits</td><td><code>pg_locks</code>, Performance Schema, DMVs</td><td>대기 급증 시 알림</td><td>RR/범위락, Hot Key 에 민감</td></tr><tr><td>MVCC/버전</td><td>버전 압력/청소</td><td>version_store_usage, long_running_tx, vacuum_lag</td><td>RCSI/Version Store 통계, Vacuum 통계</td><td>사용률 80%↑, 오래된 Tx 경보</td><td>RCSI/SI 사용 시 필수</td></tr><tr><td>자원/용량</td><td>CPU/IO/메모리/저장소</td><td>cpu%, io_latency, tempdb%/bloat, 연결수, 복제 지연</td><td>OS/스토리지/DB 통계, Replication</td><td>tempdb 80%↑, lag>10s</td><td>읽기 복제·스냅샷과 연동</td></tr><tr><td>로그/이벤트</td><td>구조화 로그/계획/데드락</td><td>tx begin/commit, lock list, plan hash</td><td>앱/DB 로그, 슬로우쿼리/Deadlock graph</td><td>데드락 발생 즉시 페이지</td><td>RCA·재현에 필수</td></tr></tbody></table><ul><li><strong>지표는 6 축 (성능/충돌/락/MVCC/자원/로그) 으로 단순화</strong>하고, 격리 수준 라벨을 모든 지표에 달아 <strong>상관관계 분석</strong>이 가능하게 만들자.</li><li><strong>경보는 적게, 정확하게</strong>: 데드락/직렬화 실패/버전 스토어/지연 상승에 집중하고, 나머지는 대시보드 모니터링으로 운영 피로를 줄인다.</li><li><strong>문제 - 대응 매핑</strong>(지연↑→락/계획, 실패↑→트랜잭션 길이/재시도, 버전↑→긴 Tx/청소 지연) 을 플레이북으로 표준화하면 복구 속도가 빨라진다.</li><li><strong>긴 트랜잭션과 핫키가 격리 성능의 최대 적</strong>이다. 트랜잭션을 짧게, 키/파티션을 고르게, 재시도는 멱등하게.</li></ul><h5 id=수집대시보드>수집·대시보드<a hidden class=anchor aria-hidden=true href=#수집대시보드>#</a></h5><ul><li><strong>성능</strong>: TPS, p50/p95/p99 트랜잭션 지연 (격리 수준 라벨 포함)</li><li><strong>격리·충돌</strong>: 격리 수준별 트랜잭션 수, <strong>직렬화 실패율</strong>, <strong>데드락 수/비율</strong>, 롤백률</li><li><strong>락/대기</strong>: 락 대기 시간 합/평균/분포, wait 이벤트 Top-N, 큐/워커 대기</li><li><strong>MVCC/버전</strong>: 버전 스토어 사용량/청소률, 오래 지속된 Tx 목록, Vacuum/GC 지연</li><li><strong>자원/용량</strong>: CPU/IO/메모리, tempdb/스토리지 사용률, 테이블/인덱스 bloat, 복제 지연</li><li><strong>로그/트레이스</strong>: 구조화 트랜잭션 로그 (트랜잭션 ID, 격리 수준, 시작/종료, 잠금 목록), 데드락 그래프, 슬로우 쿼리/계획 변화</li></ul><h5 id=알림-규칙-초안>알림 규칙 (초안)<a hidden class=anchor aria-hidden=true href=#알림-규칙-초안>#</a></h5><ul><li><strong>데드락 비율</strong> > 0.5% (5 분 이동 평균)</li><li><strong>직렬화 실패율</strong> > 2% 또는 평시 대비 +1.5σ</li><li><strong>p95 지연</strong> > 평시 대비 +30% 10 분 지속</li><li><strong>버전 스토어/Temp 사용률</strong> > 80% 5 분 지속</li><li><strong>장기 트랜잭션</strong> > 60s N 개 이상 (서비스별 임계치)</li><li><strong>복제 지연</strong> > 10s(읽기 복제 사용 시)</li></ul><h5 id=원인대응-플레이북-요지>원인–대응 플레이북 (요지)<a hidden class=anchor aria-hidden=true href=#원인대응-플레이북-요지>#</a></h5><ul><li>p95 지연↑ & 락 대기↑ → <strong>인덱스 누락/계획변경</strong> 또는 <strong>범위락 증가</strong>. 실행계획/통계 점검, 커버링 인덱스, 배치 분리.</li><li>직렬화 실패↑ → 트랜잭션 <strong>짧게</strong>, <strong>재시도 로직</strong> 검증, 충돌 Hot Key 파티셔닝.</li><li>버전 스토어↑ & 오래된 Tx↑ → <strong>긴 Tx 종료</strong> 유도, 쿼리 쪼개기, RCSI 범위 축소.</li><li>데드락↑ → 잠금 순서 통일, <strong>SELECT … FOR UPDATE</strong> 범위 제한, 배치 동시성 낮추기.</li></ul><h5 id=구현-스니펫-예시>구현 스니펫 (예시)<a hidden class=anchor aria-hidden=true href=#구현-스니펫-예시>#</a></h5><p><strong>구조화 로그 예시 (JSON)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1> 1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2> 2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3> 3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4> 4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5> 5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6> 6</a>
</span><span class=lnt id=hl-40-7><a class=lnlinks href=#hl-40-7> 7</a>
</span><span class=lnt id=hl-40-8><a class=lnlinks href=#hl-40-8> 8</a>
</span><span class=lnt id=hl-40-9><a class=lnlinks href=#hl-40-9> 9</a>
</span><span class=lnt id=hl-40-10><a class=lnlinks href=#hl-40-10>10</a>
</span><span class=lnt id=hl-40-11><a class=lnlinks href=#hl-40-11>11</a>
</span><span class=lnt id=hl-40-12><a class=lnlinks href=#hl-40-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ts&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-08-12T10:30:00+09:00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;tx_id&#34;</span><span class=p>:</span> <span class=s2>&#34;tx_12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;isolation&#34;</span><span class=p>:</span> <span class=s2>&#34;SERIALIZABLE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event&#34;</span><span class=p>:</span> <span class=s2>&#34;COMMIT&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;duration_ms&#34;</span><span class=p>:</span> <span class=mi>182</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;locks&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;orders:ROW_X(42)&#34;</span><span class=p>,</span><span class=s2>&#34;inventory:IDX_RANGE(sku=ABC*)&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=s2>&#34;ok&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;svc&#34;</span><span class=p>:</span> <span class=s2>&#34;order&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;user&#34;</span><span class=p>:</span> <span class=s2>&#34;u_789&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;trace_id&#34;</span><span class=p>:</span> <span class=s2>&#34;4f3b...&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Prometheus 규칙 초안 (개념 예시)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1> 1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2> 2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3> 3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4> 4</a>
</span><span class=lnt id=hl-41-5><a class=lnlinks href=#hl-41-5> 5</a>
</span><span class=lnt id=hl-41-6><a class=lnlinks href=#hl-41-6> 6</a>
</span><span class=lnt id=hl-41-7><a class=lnlinks href=#hl-41-7> 7</a>
</span><span class=lnt id=hl-41-8><a class=lnlinks href=#hl-41-8> 8</a>
</span><span class=lnt id=hl-41-9><a class=lnlinks href=#hl-41-9> 9</a>
</span><span class=lnt id=hl-41-10><a class=lnlinks href=#hl-41-10>10</a>
</span><span class=lnt id=hl-41-11><a class=lnlinks href=#hl-41-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>isolation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class=l>HighDeadlockRate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class=l>sum(rate(db_deadlocks_total[5m])) / sum(rate(db_tx_total[5m])) &gt; 0.005</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class=l>5m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w> </span>{<span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>page}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>annotations</span><span class=p>:</span><span class=w> </span>{<span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;데드락 비율 급증&#34;</span><span class=nt>, description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;5분 이동 평균 0.5% 초과&#34;</span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class=l>HighSerializationFailures</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class=l>sum(rate(db_serialize_fail_total[5m])) / sum(rate(db_tx_total[5m])) &gt; 0.02</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=실무-고려사항-및-주의점>실무 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-고려사항-및-주의점>#</a></h4><ul><li>운영 환경에서는 격리 수준의 선택이 <strong>성능·일관성 트레이드오프</strong>의 핵심.</li><li>트랜잭션 범위를 줄이고, 긴 쿼리·대량 작업은 비혼잡 시간에 배치.</li><li>교착상태는 예방·탐지·자동 복구 세 단계 접근.</li><li>모니터링은 단발성 점검이 아니라 <strong>상시 관측 체계</strong>로 구축.</li><li>예외와 충돌은 재시도 로직, 보상 트랜잭션, Idempotency 를 통해 완화.</li></ul><table><thead><tr><th>카테고리</th><th>고려사항</th><th>위험</th><th>권장 대응책</th><th>검증 방법</th></tr></thead><tbody><tr><td>성능·동시성 관리</td><td>장수 트랜잭션으로 인한 버전 폭증·락 장기 보유</td><td>높음</td><td>트랜잭션 범위 최소화, API Idempotency</td><td>tx 평균/최대 시간 모니터링</td></tr><tr><td></td><td>대량 배치 시 락·IO 경합</td><td>중간</td><td>배치 -OLTP 시간 분리, 쿼리 최적화</td><td>실행 계획 분석, 락 대기 시간 측정</td></tr><tr><td></td><td>인덱스 부족으로 갭락 범위 과대</td><td>중간</td><td>커버링 인덱스 설계, 필터 선택도 최적화</td><td>실행 계획·인덱스 사용률 점검</td></tr><tr><td>동시성 충돌·데드락 방지</td><td>데드락 스파이럴</td><td>높음</td><td>일관된 Lock Ordering, Timeout 설정</td><td>Deadlock 로그 분석</td></tr><tr><td></td><td>동시성 충돌로 인한 SSI Abort</td><td>중간</td><td>Idempotent 재시도 (지수 백오프 +Jitter)</td><td>충돌률 모니터링</td></tr><tr><td>격리 수준·설계 최적화</td><td>과도한 격리 수준으로 인한 성능 저하</td><td>높음</td><td>워크로드별 차등 격리 수준 적용</td><td>부하·성능 벤치마크</td></tr><tr><td>모니터링·운영 관리</td><td>점진적 성능 저하 미인지</td><td>중간</td><td>OpenTelemetry, 성능 대시보드</td><td>장기 모니터링 데이터 비교</td></tr><tr><td>예외 처리·복구</td><td>캐스케이딩 롤백</td><td>중간</td><td>트랜잭션 분리, 보상 트랜잭션 적용</td><td>롤백 로그 분석</td></tr><tr><td></td><td>팬텀 리드 오인</td><td>낮음</td><td>Serializable 또는 명시적 잠금</td><td>쿼리 범위 테스트</td></tr></tbody></table><h4 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h4><p>트랜잭션 격리 최적화는 <strong>성능과 정합성의 균형</strong>을 잡는 것이 핵심이다.<br>격리 수준은 워크로드 특성과 데이터 민감도에 맞게 선택하며, 트랜잭션은 가능한 짧게 유지해 락 경합을 줄인다.<br>인덱스 설계·파티셔닝·캐싱·읽기 복제본을 통해 읽기/쓰기 부하를 분산시키고, MVCC 환경에서는 오래된 버전 제거 및 버퍼 관리가 중요하다.<br>또한 SSD·로그 분리 등 하드웨어 최적화로 I/O 병목을 줄이고, 락·데드락·리소스 사용률 모니터링을 통해 실시간 튜닝·자동화를 적용해야 한다.</p><table><thead><tr><th>카테고리</th><th>고려사항</th><th>권장사항</th></tr></thead><tbody><tr><td>격리 수준 및 트랜잭션 관리</td><td>워크로드별 격리 수준 선택, 긴 트랜잭션 분할</td><td>OLTP 는 RC/RR, OLAP 는 RC/RU, 핵심 업무는 Serializable</td></tr><tr><td>인덱스·데이터 구조 최적화</td><td>적절한 인덱스 설계, 파티셔닝</td><td>복합·부분 인덱스, 파티션 키 기반 락 분리</td></tr><tr><td>동시성·락 충돌 관리</td><td>Deadlock, Hotspot 데이터 처리</td><td>낙관적 락, 백오프 재시도, 파티셔닝</td></tr><tr><td>리소스·하드웨어 최적화</td><td>MVCC 버전 저장소 관리, I/O 최적화</td><td>버전 정리 주기 단축, SSD·로그/데이터 분리</td></tr><tr><td>캐싱·복제 활용</td><td>읽기 캐시, 읽기 복제본 활용</td><td>Redis/Memcached, Replica 부하 분산</td></tr><tr><td>모니터링·자동화</td><td>락·충돌·리소스 사용량 추적, 실시간 튜닝</td><td>대시보드·알림 설정, 자동 격리 수준 조정</td></tr></tbody></table><p>트랜잭션 격리 최적화는 단순히 격리 수준을 조정하는 것을 넘어, <strong>인덱스·데이터 구조 설계</strong>, <strong>락 경합 감소 전략</strong>, <strong>리소스·하드웨어 최적화</strong>, <strong>캐싱·복제 활용</strong>, 그리고 <strong>실시간 모니터링 및 자동화</strong>까지 포함해야 한다. 특히 OLTP/OLAP 워크로드에 맞춘 격리 수준 차등 적용과 트랜잭션 단위 최소화는 성능 향상의 핵심이며, MVCC 환경에서는 버전 저장소 관리가 안정성 유지의 핵심 포인트이다.</p><p><strong>격리 수준별 성능 비교</strong>:</p><pre class=mermaid>graph LR
    subgraph &#34;성능 지표&#34;
        TPS[처리량&lt;br/&gt;TPS]
        RT[응답시간&lt;br/&gt;ms]
        CPU[CPU 사용률&lt;br/&gt;%]
        MEM[메모리 사용률&lt;br/&gt;%]
    end
    
    subgraph &#34;격리 수준&#34;
        RU[Read Uncommitted&lt;br/&gt;최고 성능]
        RC[Read Committed&lt;br/&gt;균형점]
        RR[Repeatable Read&lt;br/&gt;안정성 우선]
        S[Serializable&lt;br/&gt;최고 일관성]
    end
    
    RU -.-&gt; TPS
    RC -.-&gt; RT
    RR -.-&gt; CPU
    S -.-&gt; MEM
</pre><h3 id=고급-주제-advanced-topics>고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#고급-주제-advanced-topics>#</a></h3><h4 id=현재-도전-과제>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제>#</a></h4><table><thead><tr><th>카테고리</th><th>도전 과제</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방/완화</th><th>권장 해결 기법</th></tr></thead><tbody><tr><td>A. 분산/글로벌</td><td>전 지구적 직렬화 비용·불확실성</td><td>네트워크 지연/분할, 클럭 오차, 2PC 오버헤드</td><td>지연↑, 처리량↓, 실패/스플릿브레인 리스크</td><td>분산 추적, 리전별 지연·분할 이벤트, 세션 보장 테스트</td><td>도메인 경계 재설계 (지역 자율), 세션 보장/쿼럼 선택</td><td>TrueTime/외부 일관성, 사가 + 검증 서비스 (최종 직렬화)</td></tr><tr><td>B. 락×MVCC</td><td>팬텀 방지·버전 유지 동시 비용</td><td>범위락 (Next-Key/Predicate), 버전 스토어/GC</td><td>경합↑, 메모리/IO 압박, 긴 Tx 로 청소 지연</td><td>락 대기/대기 이벤트, 버전 스토어 사용률, 오래된 Tx</td><td>쿼리/인덱스 최적화, 긴 Tx 금지, 핵심 구간만 강화</td><td>RR+Next-Key(InnoDB), SSI/Serializable(PG), FOR UPDATE 구간화</td></tr><tr><td>C. 클라우드 네이티브</td><td>오토스케일·재시작과 트랜잭션 경계 불일치</td><td>무상태 워커·함수, 노드 종료</td><td>중복/유실, 정확 1 회 실패</td><td>함수 추적, 아웃박스 지연, 중복 이벤트 비율</td><td>Outbox+ 멱등키, 상태 저장소 분리, 종료 훅/드레인</td><td>Transactional Outbox, 로그 테일링, 워크플로우 엔진</td></tr><tr><td>D. 마이크로서비스/이벤트</td><td>서비스 경계≠트랜잭션 경계</td><td>동기 Tx vs 비동기 이벤트</td><td>일관성 달성 복잡, 보상 난이도</td><td>이벤트 라인리지·순서 모니터링</td><td>설계 초기에 사가/보상 정의, 중복·순서 표준화</td><td>사가, 이벤트 소싱, 분산 상태 머신</td></tr><tr><td>E. 성능/확장성</td><td>재시도·교착·핫스팟</td><td>SSI 재시도, 잠금 순서 불일치, 키 편중</td><td>TPS↓, p95/99↑</td><td>직렬화 실패율, 데드락 그래프, 핫키 Top-N</td><td>짧은 Tx, 파티션/샤딩, backoff+jitter</td><td>조건부 업데이트·FOR UPDATE, 키 해싱, 배치 분리</td></tr><tr><td>F. 관측·검증</td><td>격리 위반·성능 열화의 조기 감지</td><td>불충분한 지표/로그/테스트</td><td>장애 장기화, 원인 미상</td><td>직렬화 실패/데드락/버전 압력 대시보드, Jepsen</td><td>SLO/알림 기준 수립, 격리 라벨링</td><td>Jepsen/카나리, 카오스·페일오버 리허설</td></tr></tbody></table><ul><li><strong>A(분산/글로벌)</strong>: 모든 것을 전 지구적 직렬화로 밀어붙이지 말고, <strong>지역 강한 일관성 + 글로벌 최종 직렬화</strong>로 분해한다. TrueTime 같은 인프라는 " 정말 필요한 구간 " 에만.</li><li><strong>B(락×MVCC)</strong>: 팬텀을 막는 범위락과 MVCC 버전 비용은 함께 온다. <strong>핵심 구간만 강하게, 트랜잭션은 짧게</strong>가 정답.</li><li><strong>C(클라우드 네이티브)</strong>: 재시작/스케일 변화는 트랜잭션의 적. <strong>Outbox+ 멱등</strong>으로 정확 1 회 효과를 보장하고, 상태는 DB/큐에 고정하라.</li><li><strong>D(마이크로서비스/이벤트)</strong>: 서비스 경계 설계가 반이다. <strong>사가/보상</strong>을 먼저 정의하고, 순서·중복 규칙을 표준화하라.</li><li><strong>E(성능/확장성)</strong>: 재시도와 교착은 피할 수 없다. <strong>짧은 Tx, 파티셔닝, backoff/jitter</strong>로 체감 성능을 지켜라.</li><li><strong>F(관측·검증)</strong>: <strong>직렬화 실패·데드락·버전 압력</strong>을 1 급 지표로 모니터링하고 주기적으로 <strong>Jepsen/카오스</strong>로 검증하라.</li></ul><h4 id=생태계-및-관련-기술>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술>#</a></h4><p><strong>생태계 및 관련 기술</strong>은 트랜잭션 격리의 운영·확장성을 위해 다양한 도구, 표준, 프레임워크와 연계되는 요소들을 포함한다.</p><ul><li><strong>분산·확장 연계 기술</strong>: 마이크로서비스 환경에서 트랜잭션 일관성 확보를 위해 SAGA, Outbox, CDC 패턴을 사용하고, 서비스 메쉬 및 블록체인 기반 합의 메커니즘과 결합 가능하다.</li><li><strong>품질·격리 검증 도구</strong>: Jepsen/Elle 과 같은 테스트 프레임워크로 격리 위반을 탐지하고, DBMS 내장 성능·락 모니터링 기능으로 상시 점검.</li><li><strong>표준 및 프로토콜</strong>: XA, WS-AT, REST-AT 같은 분산 트랜잭션 표준과 OpenTelemetry 같은 분산 추적 표준으로 시스템 간 연계 품질을 보장.</li><li><strong>지능형 최적화 기술</strong>: AI/ML 기반 워크로드 분석을 통해 격리 수준, 타임아웃, 재시도 정책을 동적으로 조정하여 성능과 일관성 균형을 확보.</li></ul><table><thead><tr><th>분류</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td>분산·확장 연계 기술</td><td>여러 서비스/시스템 간 트랜잭션 일관성을 유지하는 기술</td><td>SAGA, Outbox, CDC, Service Mesh, Blockchain</td><td>이벤트 기반 보상 트랜잭션, 합의 알고리즘, MVCC</td><td>마이크로서비스·분산 환경에서 일관성 확보</td><td>금융·주문 처리, 크로스 서비스 트랜잭션</td><td>비동기 직렬화, 유연한 복구 가능</td></tr><tr><td>품질·격리 검증 도구</td><td>격리 수준 위반 및 동시성 문제 탐지 도구</td><td>Jepsen, Elle, DB 모니터링 뷰</td><td>워크로드 재현·검증</td><td>트랜잭션 품질 보증</td><td>신규 DB 엔진 검증, 장애 재현</td><td>자동화 테스트, 위반 패턴 보고</td></tr><tr><td>표준 및 프로토콜</td><td>분산 트랜잭션과 모니터링 표준 규격</td><td>XA, WS-AT, REST-AT, OpenTelemetry, W3C Trace Context</td><td>표준화된 트랜잭션 API, 추적 컨텍스트 전파</td><td>상호운용성·가시성 확보</td><td>이기종 시스템 연계</td><td>표준 준수로 호환성 보장</td></tr><tr><td>지능형 최적화 기술</td><td>AI/ML 기반 트랜잭션 파라미터 자동 조정</td><td>강화학습, 워크로드 예측 모델</td><td>성능 - 일관성 균형 탐색</td><td>동적 최적화</td><td>클라우드 네이티브 DB, 변동성 높은 워크로드</td><td>자율 조정, 예측 기반</td></tr></tbody></table><h5 id=분산확장-연계-기술>분산·확장 연계 기술<a hidden class=anchor aria-hidden=true href=#분산확장-연계-기술>#</a></h5><h6 id=실무-적용-예제>실무 적용 예제<a hidden class=anchor aria-hidden=true href=#실무-적용-예제>#</a></h6><ul><li><strong>SAGA 패턴</strong>:<br>전자상거래 시스템에서 <code>주문 생성 → 결제 승인 → 재고 감소</code> 를 마이크로서비스로 분리.<br>결제 승인 실패 시, 주문 생성 취소 이벤트 발행으로 롤백 대체.</li><li><strong>Outbox 패턴 + Kafka</strong>:<br>주문 서비스 DB Outbox 테이블에 이벤트를 기록하고, CDC 를 통해 Kafka 로 발행.<br>메시지 유실 없이 다른 서비스가 이벤트 소비 가능.</li><li><strong>Blockchain 연계</strong>:<br>금융기관 간 송금 시 Hyperledger Fabric 기반 네트워크에서 MVCC + 합의 알고리즘으로 이중 지불 방지.</li></ul><h6 id=아키텍처-다이어그램>아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#아키텍처-다이어그램>#</a></h6><pre class=mermaid>flowchart LR
    subgraph Service_A[주문 서비스]
        DB1[(Order DB)]
        OutboxTable[Outbox Table]
    end
    subgraph CDC[CDC Connector]
    end
    subgraph KafkaCluster[Kafka Cluster]
        Topic[Order Events]
    end
    subgraph Service_B[결제 서비스]
        DB2[(Payment DB)]
    end
    Service_A --&gt; OutboxTable --&gt; CDC --&gt; KafkaCluster
    KafkaCluster --&gt; Service_B
</pre><h5 id=품질격리-검증-도구>품질·격리 검증 도구<a hidden class=anchor aria-hidden=true href=#품질격리-검증-도구>#</a></h5><h6 id=실무-적용-예제-1>실무 적용 예제<a hidden class=anchor aria-hidden=true href=#실무-적용-예제-1>#</a></h6><ul><li><strong>Jepsen 테스트</strong>:<br>신규 도입하려는 PostgreSQL SSI 모드가 실제로 Serializable 을 보장하는지 검증.<br>특정 시나리오 (Write Skew) 재현 후, 로그 기반으로 격리 위반 여부 확인.</li><li><strong>DB 내장 모니터링</strong>:<br>MySQL Performance Schema 로 특정 시간대 Lock Wait 증가 추적 후, 격리 수준 조정.</li></ul><h6 id=아키텍처-다이어그램-1>아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#아키텍처-다이어그램-1>#</a></h6><pre class=mermaid>flowchart TB
    Jepsen[Jepsen Test Runner]
    Workload[동시성 테스트 시나리오]
    DB[(DB Instance)]
    Monitor[DB Monitoring Tool]
    Jepsen --&gt; Workload --&gt; DB
    DB --&gt; Monitor
</pre><h5 id=표준-및-프로토콜>표준 및 프로토콜<a hidden class=anchor aria-hidden=true href=#표준-및-프로토콜>#</a></h5><h6 id=실무-적용-예제-2>실무 적용 예제<a hidden class=anchor aria-hidden=true href=#실무-적용-예제-2>#</a></h6><ul><li><strong>XA 트랜잭션</strong>:<br>은행 내부 시스템과 외부 결제 게이트웨이 간 송금 처리 시, XA 표준을 준수하는 트랜잭션 매니저로 두 DB 의 Commit/Abort 를 원자적으로 처리.</li><li><strong>OpenTelemetry 기반 추적</strong>:<br>결제 API 호출 시 Trace ID 를 생성하여, PostgreSQL 쿼리 실행부터 메시지 큐 이벤트 발행까지 전 구간 추적.</li></ul><h6 id=아키텍처-다이어그램-2>아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#아키텍처-다이어그램-2>#</a></h6><pre class=mermaid>flowchart LR
    Client[Client Request]
    API[API Gateway]
    Service1[주문 서비스]
    Service2[결제 서비스]
    DB1[(Order DB)]
    DB2[(Payment DB)]
    OTEL[OpenTelemetry Collector]

    Client --&gt; API --&gt; Service1 --&gt; DB1
    Service1 --&gt; Service2 --&gt; DB2
    Service1 --&gt; OTEL
    Service2 --&gt; OTEL
</pre><h5 id=지능형-최적화-기술>지능형 최적화 기술<a hidden class=anchor aria-hidden=true href=#지능형-최적화-기술>#</a></h5><h6 id=실무-적용-예제-3>실무 적용 예제<a hidden class=anchor aria-hidden=true href=#실무-적용-예제-3>#</a></h6><ul><li><strong>AI 기반 Isolation Level 자동화</strong>:<br>AI 모델이 DB CPU 사용량, Lock Wait Time, 트랜잭션 실패율 데이터를 분석하여,<br>낮은 부하 시 Serializable 로, 높은 부하 시 Read Committed 로 자동 조정.</li><li><strong>강화학습 기반 튜닝</strong>:<br>Kubernetes HPA(Horizontal Pod Autoscaler) 와 연동, 워크로드 패턴에 따라 트랜잭션 타임아웃, 재시도 정책, 격리 수준을 자동 변경.</li></ul><h6 id=아키텍처-다이어그램-3>아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#아키텍처-다이어그램-3>#</a></h6><pre class=mermaid>flowchart TB
    Metrics[DB Metrics: CPU, Lock Wait, TPS]
    ML[AI Model/Policy Engine]
    DBConfig[DB Config Manager]
    DB[(Database)]
    Metrics --&gt; ML --&gt; DBConfig --&gt; DB
</pre><h4 id=최신-기술-트렌드와-미래-방향>최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드와-미래-방향>#</a></h4><table><thead><tr><th>카테고리</th><th>기술/도구</th><th>목적 및 특징</th></tr></thead><tbody><tr><td>서버리스 Isolation</td><td>tasc</td><td>서버리스 환경에서 Snapshot Isolation 지원 Shim (<a href="https://www2.eecs.berkeley.edu/Pubs/TechRpts/2021/EECS-2021-141.pdf?utm_source=chatgpt.com" title="Towards Achieving Stronger Isolation in Serverless Computing">EECS at UC Berkeley</a>)</td></tr><tr><td>온라인 검증</td><td>CHRONOS / AION</td><td>실시간 시리얼리제빌리티 및 SI 상태 확인 (<a href="https://arxiv.org/abs/2504.01477?utm_source=chatgpt.com" title="Online Timestamp-based Transactional Isolation Checking of Database Systems (Extended Version)">arXiv</a>)</td></tr><tr><td>AI 기반 튜닝</td><td>TxnSails</td><td>ML 기반 실시간 격리 수준 최적화, 성능 증가 (최대 26.7×) (<a href="https://arxiv.org/abs/2502.00991?utm_source=chatgpt.com" title="TxnSails: Achieving Serializable Transaction Scheduling with Self-Adaptive Isolation Level Selection">arXiv</a>)</td></tr><tr><td>AI 기반 제어</td><td>CCaaLF</td><td>워크로드 변화에 적응하는 학습형 동시성 제어 (<a href="https://arxiv.org/abs/2503.10036?utm_source=chatgpt.com" title="CCaaLF: Concurrency Control as a Learnable Function">arXiv</a>)</td></tr><tr><td>검증 도구</td><td>MTC (Mini-Transactions)</td><td>작은 트랜잭션으로 빠른 격리 검증 수행 (<a href="https://arxiv.org/abs/2504.02344?utm_source=chatgpt.com" title="Boosting End-to-End Database Isolation Checking via Mini-Transactions (Extended Version)">arXiv</a>)</td></tr><tr><td>분산 합의 기반</td><td>Hybrid Consensus (EPaxos 등)</td><td>지역/글로벌 일관성을 위해 합의 기반 격리 모델 적용</td></tr></tbody></table><p>2025 년 기준 트랜잭션 격리의 미래는 <strong>서버리스 통합</strong>, <strong>실시간 검증</strong>, <strong>AI 기반 자동 조정</strong>, <strong>검증 효율화</strong>, 그리고 <strong>분산 합의 기반 격리 모델 확립</strong> 방향으로 펼쳐지고 있다. 기능적으로, 각각의 기술은 기존 방식의 한계를 뛰어넘어 <strong>유연성·성능·정확성</strong>을 동시에 추구하도록 진화하고 있다.</p><h4 id=dbms-별-격리-수준-기본값-및-특징>DBMS 별 격리 수준 기본값 및 특징<a hidden class=anchor aria-hidden=true href=#dbms-별-격리-수준-기본값-및-특징>#</a></h4><table><thead><tr><th>DBMS</th><th>기본 격리 수준</th><th>MVCC 지원 여부</th><th>특징</th></tr></thead><tbody><tr><td>MySQL (InnoDB)</td><td>Repeatable Read</td><td>지원</td><td>Phantom Read 방지 위해 Next-Key Lock 사용</td></tr><tr><td>PostgreSQL</td><td>Read Committed</td><td>지원</td><td>Serializable 구현 시 Snapshot Isolation 확장 사용</td></tr><tr><td>Oracle Database</td><td>Read Committed</td><td>지원</td><td>Serializable 구현 시 Optimistic 방식</td></tr><tr><td>SQL Server</td><td>Read Committed</td><td>일부 (스냅샷 모드 필요)</td><td>READ_COMMITTED_SNAPSHOT 옵션으로 MVCC 활성화</td></tr></tbody></table><h4 id=멀티-리전-multiregion-환경에서의-isolation-level-설계-전략>멀티 리전 (Multi‑Region) 환경에서의 Isolation Level 설계 전략<a hidden class=anchor aria-hidden=true href=#멀티-리전-multiregion-환경에서의-isolation-level-설계-전략>#</a></h4><p><strong>멀티 리전 환경 특성</strong>:</p><ul><li><strong>네트워크 지연 (Latency)</strong>: 지리적 거리로 인한 트랜잭션 처리 시간 증가</li><li><strong>분할 내성 (Partition Tolerance)</strong>: 네트워크 단절 상황에서 각 리전이 독립 동작해야 함</li><li><strong>일관성 모델 (Consistency Model) 다양성</strong>: 일부 리전은 Eventual Consistency 허용, 일부는 Strong Consistency 요구</li></ul><p><strong>리전별 Isolation Level 전략</strong>:</p><table><thead><tr><th>리전 유형</th><th>네트워크 특성</th><th>권장 Isolation Level</th><th>이유</th><th>비고</th></tr></thead><tbody><tr><td>Primary Region (주 리전)</td><td>낮은 지연, 핵심 데이터 관리</td><td>Serializable</td><td>금융·결제 등 강한 정합성 요구</td><td>메인 DB 쓰기 작업 집중</td></tr><tr><td>Secondary Region (보조 리전)</td><td>복제 지연 발생</td><td>Read Committed</td><td>보고·조회 위주, 일부 최신성 허용</td><td>복제 지연 모니터링 필수</td></tr><tr><td>Edge Region (에지 리전)</td><td>높은 지연, 간헐적 연결</td><td>Read Uncommitted / Snapshot Isolation</td><td>빠른 응답, eventual consistency 허용</td><td>캐시 + 동기화 프로세스 필요</td></tr></tbody></table><p><strong>아키텍처 예시</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Global Service&#34;
        PR[&#34;Primary Region (Serializable)&#34;] --&gt; SR[&#34;Secondary Region (Read Committed)&#34;]
        SR --&gt; ER[&#34;Edge Region (Snapshot Isolation)&#34;]
        ER --&gt; PR
    end
</pre><blockquote><p>주 리전은 강한 정합성, 보조·에지 리전은 성능과 지연 해소 중심 설계</p></blockquote><p><strong>구현 고려사항</strong>:</p><ul><li>다중 리전 간 <strong>이중 커밋 (Two‑phase commit, 2PC)</strong> 은 지연 비용이 높으므로 제한적으로 사용</li><li><strong>SAGA 패턴</strong>(장기 실행 트랜잭션 보상 로직) 을 결합해 분산 환경에서 무결성 유지</li><li>**CDC (Change Data Capture)**와 메시지 큐 (Kafka, RabbitMQ) 기반으로 트랜잭션 이벤트를 비동기 전파</li></ul><h4 id=운영-로그-기반-문제-탐지>운영 로그 기반 문제 탐지<a hidden class=anchor aria-hidden=true href=#운영-로그-기반-문제-탐지>#</a></h4><h5 id=deadlock-탐지-로그-패턴-mysql-예시>Deadlock 탐지 로그 패턴 (MySQL 예시)<a hidden class=anchor aria-hidden=true href=#deadlock-탐지-로그-패턴-mysql-예시>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-48-1><a class=lnlinks href=#hl-48-1>1</a>
</span><span class=lnt id=hl-48-2><a class=lnlinks href=#hl-48-2>2</a>
</span><span class=lnt id=hl-48-3><a class=lnlinks href=#hl-48-3>3</a>
</span><span class=lnt id=hl-48-4><a class=lnlinks href=#hl-48-4>4</a>
</span><span class=lnt id=hl-48-5><a class=lnlinks href=#hl-48-5>5</a>
</span><span class=lnt id=hl-48-6><a class=lnlinks href=#hl-48-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>*** (1) TRANSACTION:
</span></span><span class=line><span class=cl>TRANSACTION 12345, ACTIVE 5 sec, OS thread id 13992
</span></span><span class=line><span class=cl>*** (1) WAITING FOR THIS LOCK TO BE GRANTED:
</span></span><span class=line><span class=cl>RECORD LOCKS space id 123 page no 456 n bits 72 index PRIMARY of table `orders`
</span></span><span class=line><span class=cl>*** (2) TRANSACTION:
</span></span><span class=line><span class=cl>TRANSACTION 12346, ACTIVE 4 sec
</span></span></code></pre></td></tr></table></div></div><p><strong>해석</strong>: 두 트랜잭션이 서로 잠금 자원을 대기하는 교착 상태 → 자동 롤백이나 재시도 로직 필요</p><h5 id=phantom-read-탐지-쿼리-예시-postgresql>Phantom Read 탐지 쿼리 예시 (PostgreSQL)<a hidden class=anchor aria-hidden=true href=#phantom-read-탐지-쿼리-예시-postgresql>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1>1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2>2</a>
</span><span class=lnt id=hl-49-3><a class=lnlinks href=#hl-49-3>3</a>
</span><span class=lnt id=hl-49-4><a class=lnlinks href=#hl-49-4>4</a>
</span><span class=lnt id=hl-49-5><a class=lnlinks href=#hl-49-5>5</a>
</span><span class=lnt id=hl-49-6><a class=lnlinks href=#hl-49-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=k>REPEATABLE</span><span class=w> </span><span class=k>READ</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;PENDING&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>-- 다른 트랜잭션에서 상태 &#39;PENDING&#39;으로 신규 삽입
</span></span></span><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;PENDING&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>특징</strong>: 두 COUNT 값이 다르면 Phantom Read 발생 → Serializable 필요</p><hr><h2 id=최종-정리-및-학습-가이드>최종 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#최종-정리-및-학습-가이드>#</a></h2><h3 id=내용-종합>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합>#</a></h3><p>Transaction Isolation 은 데이터베이스 시스템의 핵심 구성 요소로서, 동시 실행되는 트랜잭션들 간의 간섭을 방지하여 데이터 일관성을 보장하는 메커니즘이다.<br>ACID 속성 중 Isolation 을 구현하며, 4 가지 표준 격리 수준 (Read Uncommitted, Read Committed, Repeatable Read, Serializable) 을 통해 성능과 일관성 간의 균형을 제공한다.</p><p>현대적 관점에서 Transaction Isolation 은 단순한 데이터베이스 기능을 넘어서 분산 시스템, 클라우드 네이티브 아키텍처, 서버리스 컴퓨팅 환경에서 핵심적인 역할을 담당하고 있다. 특히 Amazon Aurora DSQL 과 같은 서버리스 데이터베이스에서는 자동 확장과 함께 트랜잭션 격리를 제공하여 새로운 패러다임을 제시하고 있다.</p><h3 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h3><table><thead><tr><th>단계</th><th>학습 주제</th><th>주요 목표</th><th>실무 연관성</th><th>예시·실습</th></tr></thead><tbody><tr><td>1</td><td>트랜잭션 기초 & ACID</td><td>기본 개념·격리 수준 이해</td><td>★★★★★</td><td>계좌이체, ANSI 수준별 현상 실험</td></tr><tr><td>2</td><td>핵심 메커니즘</td><td>MVCC·2PL·SSI 동작 이해, 엔진별 비교</td><td>★★★★☆</td><td>PostgreSQL MVCC 동작 로그 분석</td></tr><tr><td>3</td><td>트레이드오프 분석</td><td>성능·일관성 균형 전략 수립</td><td>★★★★☆</td><td>OLTP/OLAP 격리 수준 비교 테스트</td></tr><tr><td>4</td><td>분산 트랜잭션</td><td>다중 노드 일관성 확보</td><td>★★★★☆</td><td>SAGA 시나리오, 2PC 프로토콜 실습</td></tr><tr><td>5</td><td>운영·모니터링</td><td>문제 탐지·해결 및 튜닝</td><td>★★★★★</td><td>Deadlock Log 분석, WAL 복구 실험</td></tr><tr><td>6</td><td>고급 주제</td><td>글로벌 직렬화·클라우드 설계</td><td>★★★★☆</td><td>멀티 리전 DB 구성, Paxos 합의 실습</td></tr></tbody></table><h3 id=학습-항목-정리>학습 항목 정리<a hidden class=anchor aria-hidden=true href=#학습-항목-정리>#</a></h3><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>학습 목표</th><th>실무 연관성</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>ACID/트랜잭션 기본</td><td>필수</td><td>트랜잭션/일관성 개념 정립</td><td>높음</td><td>모든 결정의 전제 지식</td></tr><tr><td>기초</td><td>1</td><td>ANSI 4 대 격리수준</td><td>필수</td><td>RU/RC/RR/SR 의미·차단 현상</td><td>높음</td><td>기본 선택 기준 마련</td></tr><tr><td>기초</td><td>1</td><td>이상 (Anomalies) 체계</td><td>필수</td><td>Dirty/NR/Phantom/Write Skew 등 매핑</td><td>높음</td><td>버그 원인 식별 능력</td></tr><tr><td>핵심</td><td>2</td><td>MVCC 메커니즘</td><td>필수</td><td>버전 체인·가시성 규칙·GC</td><td>높음</td><td>현대 DB 의 표준 구현 이해</td></tr><tr><td>핵심</td><td>2</td><td>2PL/Strict 2PL</td><td>필수</td><td>락 규칙·데드락 모델</td><td>높음</td><td>직렬화 달성 원리 이해</td></tr><tr><td>핵심</td><td>3</td><td>Snapshot Isolation/SSI</td><td>필수</td><td>SI 동작·SSI 충돌 감지</td><td>높음</td><td>고격리 - 고성능 설계</td></tr><tr><td>핵심</td><td>3</td><td>트레이드오프 분석</td><td>필수</td><td>격리↔지연/스루풋 그래프화</td><td>높음</td><td>SLO 기반 의사결정</td></tr><tr><td>구현</td><td>4</td><td>엔진별 설정 (PSQL/InnoDB/SQL Server)</td><td>필수</td><td>SSI/갭락/RCSI 등 설정</td><td>높음</td><td>즉시 적용/튜닝 포인트</td></tr><tr><td>구현</td><td>4</td><td>타임아웃/락 에스컬레이션</td><td>권장</td><td>경합 완화·안정화 파라미터</td><td>중간</td><td>장애 예방</td></tr><tr><td>응용</td><td>5</td><td>워크로드 매핑 (OLTP/OLAP/HTAP)</td><td>권장</td><td>격리수준·인덱스·배치 전략</td><td>중간</td><td>비용 대비 효과 극대화</td></tr><tr><td>응용</td><td>5</td><td>재시도/멱등성/백오프</td><td>권장</td><td>Abort 내성 패턴 설계</td><td>중간</td><td>운영 안정성 핵심</td></tr><tr><td>운영</td><td>6</td><td>관측성 (락/대기/Abort 지표)</td><td>권장</td><td>대시보드/알람 기준</td><td>중간</td><td>병목 탐지·SRE 협업</td></tr><tr><td>운영</td><td>6</td><td>테스트/검증 (회귀·카나리)</td><td>권장</td><td>격리 회귀 시나리오</td><td>중간</td><td>변경 안전성 확보</td></tr><tr><td>고급</td><td>7</td><td>글로벌 직렬화/TrueTime</td><td>선택</td><td>분산 직렬화 모델 이해</td><td>낮음</td><td>대규모 시스템 설계</td></tr><tr><td>고급</td><td>7</td><td>분산 합의/검증 (Jepsen/Elle)</td><td>선택</td><td>모델·검증 도구 사용</td><td>낮음</td><td>미션 크리티컬 검증</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>핵심 개념</td><td>트랜잭션 (Transaction)</td><td>데이터베이스의 논리적 작업 단위, ACID 특성 보유</td><td>ACID</td><td>데이터 무결성 기본 단위</td></tr><tr><td>핵심 개념</td><td>ACID</td><td>Atomicity, Consistency, Isolation, Durability</td><td>트랜잭션</td><td>DB 신뢰성 확보</td></tr><tr><td>핵심 개념</td><td>Isolation Level</td><td>트랜잭션 간 간섭 정도를 정의하는 설정</td><td>ANSI SQL</td><td>성능·일관성 균형 조정</td></tr><tr><td>격리 이상 현상</td><td>Dirty Read</td><td>커밋되지 않은 데이터를 읽는 현상</td><td>Read Uncommitted</td><td>비중요 분석 쿼리</td></tr><tr><td>격리 이상 현상</td><td>Non-repeatable Read</td><td>같은 데이터 재조회 시 값 변경</td><td>Read Committed</td><td>OLTP 읽기 일관성</td></tr><tr><td>격리 이상 현상</td><td>Phantom Read</td><td>반복 쿼리 시 새 행이 나타남</td><td>Repeatable Read</td><td>집계 연산</td></tr><tr><td>격리 이상 현상</td><td>Lost Update</td><td>동시에 수정 시 일부 변경 유실</td><td>모든 수준</td><td>동시 쓰기 제어 필요</td></tr><tr><td>동시성 제어 기법</td><td>2PL</td><td>확장 - 축소 단계로 나뉜 잠금 프로토콜</td><td>직렬화 가능성</td><td>MySQL InnoDB</td></tr><tr><td>동시성 제어 기법</td><td>MVCC</td><td>다중 버전 기반 동시성 제어</td><td>Snapshot Isolation</td><td>PostgreSQL, Oracle</td></tr><tr><td>동시성 제어 기법</td><td>Snapshot Isolation</td><td>시작 시점 스냅샷 기반 읽기 일관성</td><td>MVCC</td><td>OLTP 읽기/쓰기 분리</td></tr><tr><td>동시성 제어 기법</td><td>SSI</td><td>SI 에서 write-skew 방지</td><td>직렬성 보장</td><td>PostgreSQL</td></tr><tr><td>동시성 제어 기법</td><td>Gap Lock</td><td>범위 보호 락</td><td>Next-Key Lock</td><td>MySQL 팬텀 방지</td></tr><tr><td>동시성 제어 기법</td><td>Predicate Lock</td><td>조건 기반 락</td><td>Serializable</td><td>팬텀 방지</td></tr><tr><td>동시성 제어 기법</td><td>RCSI</td><td>Read Committed 의 버전 기반 구현</td><td>tempdb</td><td>SQL Server 성능 최적화</td></tr><tr><td>락 메커니즘</td><td>Shared Lock</td><td>읽기 전용 락</td><td>2PL</td><td>동시 읽기 허용</td></tr><tr><td>락 메커니즘</td><td>Exclusive Lock</td><td>쓰기 전용 락</td><td>2PL</td><td>모든 작업 차단</td></tr><tr><td>락 메커니즘</td><td>Deadlock</td><td>교착 상태</td><td>Lock 순서</td><td>자동 탐지·해결 필요</td></tr><tr><td>락 메커니즘</td><td>Lock Escalation</td><td>세밀 락을 대규모 락으로 변경</td><td>메모리 효율성</td><td>SQL Server 자동화</td></tr><tr><td>락 메커니즘</td><td>Lock Manager</td><td>잠금·해제·데드락 관리</td><td>Concurrency Control</td><td>DBMS 핵심 컴포넌트</td></tr><tr><td>분산 트랜잭션 기법</td><td>2PC</td><td>분산 트랜잭션 전역 커밋 프로토콜</td><td>Prepare/Commit 단계</td><td>글로벌 일관성</td></tr><tr><td>분산 트랜잭션 기법</td><td>SAGA</td><td>보상 트랜잭션 기반 분산 제어 패턴</td><td>마이크로서비스</td><td>장기 실행 트랜잭션</td></tr><tr><td>분산 트랜잭션 기법</td><td>Eventual Consistency</td><td>최종적 데이터 일관성</td><td>CAP 이론</td><td>NoSQL, 분산 DB</td></tr><tr><td>복구·로그 시스템</td><td>Transaction Log</td><td>모든 변경 이력 기록</td><td>WAL</td><td>장애 복구</td></tr><tr><td>복구·로그 시스템</td><td>WAL</td><td>변경 내용을 로그에 먼저 기록</td><td>ARIES</td><td>PostgreSQL, MySQL</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://postgresql.kr/docs/9.6/transaction-iso.html>PostgreSQL transaction isolation 공식 문서</a></li><li><a href=https://dev.mysql.com/doc/refman/8.1/en/innodb-transaction-isolation-levels.html>MySQL InnoDB Isolation Level 공식 문서</a></li><li><a href="https://learn.microsoft.com/en-us/sql/odbc/reference/develop-app/transaction-isolation-levels?view=sql-server-ver17">Microsoft Learn: Transaction Isolation Level</a></li><li><a href=https://arxiv.org/>Serializable Snapshot Isolation (Ports & Grittner) 논문 (arXiv/ACM)</a></li><li><a href=https://begriffs.com/posts/2017-08-01-practical-guide-sql-isolation.html>Write Skew 설명 (David Gomes)</a></li><li><a href=https://research.google.com/>Spanner 및 TrueTime (Google Research)</a></li><li><a href=https://dl.acm.org/>Jepsen/Elle 격리 검증 사례 (ACM Digital Library)</a></li><li><a href=https://awsfundamentals.com/blog/aurora-dsql-introduction>Amazon Aurora DSQL Documentation</a></li><li><a href=https://www.geeksforgeeks.org/blogs/top-serverless-databases/>Serverless Database Technologies 2025 (GeeksforGeeks)</a></li><li><a href=https://github.com/heidihoward/distributed-consensus-reading-list>Distributed Consensus Algorithms reading list (GitHub)</a></li><li><a href=https://www.pingcap.com/article/understanding-ai-in-database-management-transforming-dbms/>AI in Database Management (PingCAP article)</a></li><li><a href=https://endgrate.com/blog/transaction-isolation-levels-in-distributed-dbs>Transaction Isolation in Distributed Systems (Endgrate blog)</a></li><li><a href=https://builtin.com/articles/generative-ai-database-management>Machine Learning for Database Optimization (Built In article)</a></li></ul><hr></div><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Concurrency Anomalies</h2></header><div class=entry-content><p></p></div><footer class=entry-footer><span title='2025-09-12 03:49:00 +0000 UTC'>September 12, 2025</span>&nbsp;·&nbsp;0 min&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Concurrency Anomalies" href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/concurrency-anomalies/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Transaction Isolation Levels</h2></header><div class=entry-content><p>Transaction Isolation Levels 트랜잭션 격리 수준 (Transaction Isolation Level) 은 ACID 특성 중 Isolation 을 구현하는 핵심 메커니즘으로, 다중 트랜잭션 환경에서 발생할 수 있는 Dirty Read, Non-repeatable Read, Phantom Read 와 같은 동시성 문제를 제어한다.
ANSI SQL 표준은 Read Uncommitted, Read Committed, Repeatable Read, Serializable 네 단계를 정의하며, 각 수준은 성능과 데이터 일관성 간의 상충 관계를 고려해 선택된다.
실제 DBMS 는 Locking, MVCC, SSI 등의 방식으로 이를 구현하며, PostgreSQL·MySQL·Oracle·SQL Server 등에서 동작 방식이 상이하다.
...</p></div><footer class=entry-footer><span title='2025-02-06 04:52:00 +0000 UTC'>February 6, 2025</span>&nbsp;·&nbsp;64 min&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Transaction Isolation Levels" href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/transaction-isolation-levels/></a></article></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2026 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>