<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Transaction Isolation Levels | hyunyoun's Blog</title><meta name=keywords content="System-Design,Database-Systems,Transactions,Transaction-Isolation,Transaction-Isolation-Levels,ACID-Properties,ACID-Compliance,Concurrency-Control,Data-Consistency"><meta name=description content="트랜잭션 격리 수준(Transaction Isolation Level)은 DBMS가 동시에 실행되는 트랜잭션 간 데이터 접근·갱신 방식을 제어해 Dirty Read, Non-repeatable Read, Phantom Read 등을 방지하는 메커니즘이다. SQL-92 표준의 4단계(Read Uncommitted~Serializable)와 Lock·MVCC 기반 구현을 통해 성능과 일관성 간 균형을 조정한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/transaction-isolation-levels/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/transaction-isolation-levels/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/transaction-isolation-levels/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/transaction-isolation-levels/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Transaction Isolation Levels"><meta property="og:description" content="트랜잭션 격리 수준(Transaction Isolation Level)은 DBMS가 동시에 실행되는 트랜잭션 간 데이터 접근·갱신 방식을 제어해 Dirty Read, Non-repeatable Read, Phantom Read 등을 방지하는 메커니즘이다. SQL-92 표준의 4단계(Read Uncommitted~Serializable)와 Lock·MVCC 기반 구현을 통해 성능과 일관성 간 균형을 조정한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Transaction Isolation Levels"><meta name=twitter:description content="트랜잭션 격리 수준(Transaction Isolation Level)은 DBMS가 동시에 실행되는 트랜잭션 간 데이터 접근·갱신 방식을 제어해 Dirty Read, Non-repeatable Read, Phantom Read 등을 방지하는 메커니즘이다. SQL-92 표준의 4단계(Read Uncommitted~Serializable)와 Lock·MVCC 기반 구현을 통해 성능과 일관성 간 균형을 조정한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HY's Blog","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":7,"name":"Transaction Isolation Levels","item":"https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/transaction/transaction-isolation/transaction-isolation-levels/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>HY's Blog</a></div><h1>Transaction Isolation Levels</h1><div class=post-description>트랜잭션 격리 수준(Transaction Isolation Level)은 DBMS가 동시에 실행되는 트랜잭션 간 데이터 접근·갱신 방식을 제어해 Dirty Read, Non-repeatable Read, Phantom Read 등을 방지하는 메커니즘이다. SQL-92 표준의 4단계(Read Uncommitted~Serializable)와 Lock·MVCC 기반 구현을 통해 성능과 일관성 간 균형을 조정한다.</div></header><div class=post-content><h2 id=transaction-isolation-levels>Transaction Isolation Levels<a hidden class=anchor aria-hidden=true href=#transaction-isolation-levels>#</a></h2><p>트랜잭션 격리 수준 (Transaction Isolation Level) 은 ACID 특성 중 Isolation 을 구현하는 핵심 메커니즘으로, 다중 트랜잭션 환경에서 발생할 수 있는 Dirty Read, Non-repeatable Read, Phantom Read 와 같은 동시성 문제를 제어한다.</p><p>ANSI SQL 표준은 Read Uncommitted, Read Committed, Repeatable Read, Serializable 네 단계를 정의하며, 각 수준은 성능과 데이터 일관성 간의 상충 관계를 고려해 선택된다.</p><p>실제 DBMS 는 Locking, MVCC, SSI 등의 방식으로 이를 구현하며, PostgreSQL·MySQL·Oracle·SQL Server 등에서 동작 방식이 상이하다.</p><p>최신 분산·클라우드·NoSQL 환경에서는 글로벌 트랜잭션과 동적 격리 수준 조정이 확산되고 있어, 도메인 요구사항과 인프라 특성을 반영한 설계가 필수적이다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><ul><li>기본은 " 무엇/왜 &ldquo;, 이론은 " 어떻게 보장 &ldquo;, 실무는 " 어떻게 적용·운영 &ldquo;, 심화는 " 복잡 환경/엔진 특이점 대응 &ldquo;.</li></ul><table><thead><tr><th>관점</th><th>필수 개념</th><th>핵심 요지</th><th>상호 관계</th></tr></thead><tbody><tr><td>기본</td><td>격리 레벨/현상</td><td>RU~Serializable, Dirty/NR/Phantom</td><td>레벨↑ ⇒ 현상 차단↑, 성능↓</td></tr><tr><td>기본</td><td>ACID–I</td><td>Isolation 이 Consistency 달성에 기여</td><td>I 구현은 2PL/MVCC/SSI 에 의존</td></tr><tr><td>이론</td><td>직렬화/2PL</td><td>S/X/의도/범위락으로 직렬성 근사</td><td>범위락이 팬텀 차단</td></tr><tr><td>이론</td><td>MVCC/SI</td><td>스냅샷 읽기, write-write 충돌 검출</td><td>SI 는 Write Skew 취약</td></tr><tr><td>이론</td><td>SSI</td><td>충돌 그래프로 직렬화 위반 감지</td><td>SI 취약점 보완</td></tr><tr><td>실무</td><td>격리 선택</td><td>RC/RCSI 기본, 핵심구간 Serializable</td><td>구간화·짧은 Tx·재시도</td></tr><tr><td>실무</td><td>재시도/멱등</td><td>직렬화 실패 대비, Outbox</td><td>정확 1 회 효과</td></tr><tr><td>실무</td><td>모니터링</td><td>직렬화 실패·데드락·버전 압력</td><td>조기 경보/튜닝 지표</td></tr><tr><td>심화</td><td>엔진별 차이</td><td>InnoDB Next-Key, PG SSI, MSSQL RCSI</td><td>설계·테스트 시 반영</td></tr><tr><td>심화</td><td>분산 일관성</td><td>2PC/사가/읽기 복제/스냅샷</td><td>비용·일관성 균형</td></tr></tbody></table><h4 id=실무-구현-연관성-및-적용-방식>실무 구현 연관성 및 적용 방식<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성-및-적용-방식>#</a></h4><ul><li>원칙: <strong>읽기는 비차단 (RC/RCSI/Snapshot), 핵심 규칙 구간은 짧게 Serializable/범위잠금</strong>, 모든 변경 경로는 <strong>멱등 + 재시도</strong>로 감싼다. 모니터링으로 " 위험 시그널 (직렬화 실패/데드락/버전 압력)&rdquo; 을 빠르게 포착한다.</li></ul><table><thead><tr><th>도메인/시나리오</th><th>권장 격리/메커니즘</th><th>핵심 SQL/패턴</th><th>방지 대상</th><th>운영 포인트</th></tr></thead><tbody><tr><td>일반 OLTP 조회</td><td>RC 또는 <strong>RCSI/Snapshot</strong></td><td>문장/트랜잭션 스냅샷 읽기</td><td>Dirty/경합</td><td>버전 스토어/복제 지연 모니터</td></tr><tr><td>주문 생성</td><td>RC(짧게)+ 유니크/멱등키</td><td><code>INSERT …</code> + <code>ux(idem_key)</code></td><td>중복/오염</td><td>멱등 충돌률, p95</td></tr><tr><td>결제 원장</td><td><strong>Serializable/SSI</strong>(짧게)</td><td>멱등키 + 복식부기 트랜잭션</td><td>Write Skew/이중지불</td><td>직렬화 실패율, 재시도</td></tr><tr><td>재고 차감 (단일 키)</td><td>RR/RC + <code>FOR UPDATE</code></td><td>행 잠금 후 조건부 UPDATE</td><td>Lost Update/음수 재고</td><td>잠금 대기, 핫키 회피</td></tr><tr><td>재고 차감 (범위)</td><td>InnoDB RR+<strong>Next-Key</strong> or Serializable</td><td>인덱스 범위 <code>FOR UPDATE</code></td><td>Phantom/Write Skew</td><td>인덱스 필수, 범위 경합</td></tr><tr><td>리포팅/ETL</td><td>Snapshot/읽기 복제본</td><td>일관 스냅샷 + 로우벨/CDC</td><td>Non-repeatable/팬텀 영향</td><td>RU 지양, 스냅샷 주기</td></tr><tr><td>마이크로서비스</td><td>로컬 Tx + <strong>Outbox/사가</strong></td><td>Outbox 테이블, 보상 플로우</td><td>분산 불일치</td><td>정확 1 회/재처리율</td></tr><tr><td>고경합 핫스팟</td><td>낙관적 버전/샤딩/큐잉</td><td><code>WHERE version=…</code></td><td>교착/대기</td><td>backoff+jitter</td></tr></tbody></table><ul><li><strong>핵심</strong>: 격리는 " 표준 레벨 " 과 " 엔진 구현 " 이 만나 실효성을 결정한다. <strong>SI 의 장점</strong>(읽기 성능) 과 <strong>취약점</strong>(Write Skew) 을 이해하고, <strong>핵심 구간만 강하게</strong> 보호하는 구간화 전략이 현실적이다.</li><li><strong>적용</strong>: RC/RCSI 로 읽기 경합을 낮추고, 결제/원장/재고 등 불변 규칙 구간은 Serializable/범위잠금으로 짧게 보호한다. 모든 변경 경로는 <strong>멱등 + 재시도</strong>로 감싸고, <strong>직렬화 실패·데드락·버전 압력</strong>을 지표로 상시 관측한다.</li><li><strong>결론</strong>: 트랜잭션 격리는 기능이 아니라 <strong>설계 원칙</strong>이다. 도메인 규칙·엔진 특성·운영 지표를 함께 보며, <strong>정합성·성능·운영성</strong>의 균형점을 구간별로 찾아가는 것이 최적해다.</li></ul><h3 id=기초-개념-foundation-understanding>기초 개념 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#기초-개념-foundation-understanding>#</a></h3><h4 id=개념-정의-및-본질적-이해>개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질적-이해>#</a></h4><p><strong>트랜잭션 격리 수준 (Transaction Isolation Levels)</strong> 은 DBMS 가 동시에 실행되는 트랜잭션 간 <strong>데이터 접근·가시성 규칙</strong>을 정의해, <strong>동시성 이상 현상</strong>(Dirty Read, Non-repeatable Read, Phantom Read 등) 을 허용 또는 차단하는 정도를 결정하는 메커니즘이다.</p><p>ANSI SQL-92 표준은 Read Uncommitted, Read Committed, Repeatable Read, Serializable 의 네 가지 수준을 정의하며, 각 수준은 <strong>성능과 데이터 일관성 간의 절충</strong>을 제공한다.<br>구현은 <strong>Lock 기반</strong>(2PL 등) 또는 <strong>MVCC 기반</strong>으로 나뉘며, Isolation 은 ACID 속성 중 하나로서 데이터 무결성 보장의 핵심 역할을 수행한다.<br>실무에서는 비즈니스 요구, 동시성 수준, 성능 목표에 따라 적절한 격리 수준과 구현 방식을 선택한다.</p><h5 id=ansi-표준-vs-확장-구현-비교표>ANSI 표준 vs. 확장 구현 비교표<a hidden class=anchor aria-hidden=true href=#ansi-표준-vs-확장-구현-비교표>#</a></h5><table><thead><tr><th>구분</th><th>ANSI SQL-92 표준 격리 수준</th><th>차단되는 이상 현상</th><th>주요 DBMS 확장 구현</th><th>특징</th></tr></thead><tbody><tr><td><strong>Level 0</strong></td><td><strong>Read Uncommitted</strong></td><td>-</td><td>거의 사용 안 함 (테스트나 분석 용도)</td><td>가장 낮은 격리, 높은 동시성, 데이터 무결성 취약</td></tr><tr><td><strong>Level 1</strong></td><td><strong>Read Committed</strong></td><td>Dirty Read</td><td><strong>Oracle</strong>(기본, Statement-level Read Consistency)<br><strong>PostgreSQL</strong>(MVCC 기반)<br><strong>SQL Server</strong>(Read Committed Snapshot 옵션)</td><td>가장 많이 사용, 읽기 시점마다 최신 커밋 데이터 조회</td></tr><tr><td><strong>Level 2</strong></td><td><strong>Repeatable Read</strong></td><td>Dirty Read,<br>Non-repeatable Read</td><td><strong>MySQL InnoDB</strong>(MVCC + Gap Lock 으로 Phantom Read 방지)<br><strong>DB2</strong></td><td>같은 트랜잭션 내 동일 쿼리 결과 동일성 보장, 팬텀 읽기 가능성</td></tr><tr><td><strong>Level 3</strong></td><td><strong>Serializable</strong></td><td>Dirty Read,<br>Non-repeatable Read,<br>Phantom Read</td><td><strong>PostgreSQL</strong>(Serializable Snapshot Isolation, SSI)<br><strong>Oracle</strong>(Serializable 모드)<br><strong>SQL Server</strong>(Serializable Isolation)</td><td>가장 높은 일관성, 직렬 실행과 동일한 결과, 성능 저하 가능</td></tr><tr><td><strong>확장</strong></td><td><strong>Snapshot Isolation (SI)</strong></td><td>Dirty Read,<br>Non-repeatable Read,<br>Phantom Read (Write Skew 가능)</td><td><strong>Oracle</strong>(Read Consistency)<br><strong>PostgreSQL</strong>(MVCC 기반)<br><strong>SQL Server</strong>(Read Committed Snapshot, Snapshot Isolation)</td><td>트랜잭션 시작 시점의 스냅샷을 기반으로 읽기, 읽기 병행성 뛰어남</td></tr><tr><td><strong>확장</strong></td><td><strong>Read Committed Snapshot (RCSI)</strong></td><td>Dirty Read,<br>Non-repeatable Read, (커밋 시점 기준)</td><td><strong>SQL Server</strong></td><td>Read Committed 을 MVCC 방식으로 구현, 락 경합 최소화</td></tr></tbody></table><ul><li>ANSI SQL 표준은 <strong>격리 수준 이름과 의미만 정의</strong>하며, DBMS 마다 내부 구현 (MVCC, Lock 등) 차이가 큼</li><li>확장 구현 (SI, RCSI) 은 성능과 동시성을 위해 표준을 변형한 형태</li></ul><h4 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h4><p>트랜잭션 격리 수준은 1970 년대 관계형 데이터베이스 이론과 IBM System R 의 실험에서 시작되었다.<br>ACID 개념 정립과 함께 다중 사용자 환경에서 데이터 무결성을 보장하기 위한 동시성 제어가 필수 과제로 부상했다. 초기에는 단순 로킹과 2 단계 로킹 (2PL) 방식이 주류였으나, 성능 저하와 데드락 문제로 인해 새로운 접근법이 요구되었다. 이에 1992 년 ANSI/ISO SQL 표준이 네 가지 격리 수준을 정의하며, 성능과 일관성의 균형을 설계자가 선택할 수 있는 기반을 마련했다.</p><h5 id=발전-과정>발전 과정<a hidden class=anchor aria-hidden=true href=#발전-과정>#</a></h5><table><thead><tr><th>시기</th><th>주요 사건 및 변화</th><th>핵심 기술/표준</th></tr></thead><tbody><tr><td>1970s</td><td>관계형 DB 이론 등장, IBM System R 실험</td><td>ACID 개념, 2PL(Two-Phase Locking)</td></tr><tr><td>1980s</td><td>상용 RDBMS 확산, 동시성 문제 대두</td><td>Lock 기반 동시성 제어</td></tr><tr><td>1992</td><td>ANSI/ISO SQL 표준에서 4 단계 격리 수준 정의</td><td>Read Uncommitted~Serializable</td></tr><tr><td>2000s</td><td>MVCC 상용화, Lock-Free 설계 확산</td><td>PostgreSQL, Oracle, SQL Server MVCC</td></tr><tr><td>2010s</td><td>NoSQL·NewSQL 확산, 분산 환경의 Eventual Consistency</td><td>Snapshot Isolation, 분산 합의 알고리즘</td></tr><tr><td>2020s</td><td>클라우드 네이티브·멀티리전 DB, AI 기반 격리 수준 조정</td><td>동적 격리 수준, 글로벌 트랜잭션 최적화</td></tr></tbody></table><pre class=mermaid>timeline
    title 트랜잭션 격리 수준 발전사
    1970s : 관계형 데이터베이스 이론 정립
         : IBM System R, ACID 개념 등장
         : 2PL(2단계 로킹) 도입
    1980s : 상용 RDBMS 확산
         : 동시성 제어의 성능·일관성 균형 필요
    1992  : ANSI/ISO SQL 표준
         : 4가지 격리 수준 공식화
    2000s : MVCC 상용화
         : PostgreSQL·Oracle·SQL Server 적용
    2010s : NoSQL·NewSQL 확산
         : Snapshot Isolation, 분산 합의
    2020s : 클라우드 네이티브·멀티리전 DB
         : AI 기반 동적 격리 수준 조정
</pre><h4 id=핵심-목적-및-필요성-문제-해결-관점>핵심 목적 및 필요성 (문제 해결 관점)<a hidden class=anchor aria-hidden=true href=#핵심-목적-및-필요성-문제-해결-관점>#</a></h4><ul><li><strong>무결성 보장</strong>: 비즈니스 규칙 (금액 보전, 음수 재고 금지 등) 을 격리·락·검증 제약으로 시스템 차원에서 보장해 <strong>오류·사고 비용을 최소화</strong>한다.</li><li><strong>성능 균형</strong>: 읽기는 스냅샷/버전 읽기로 <strong>비차단화</strong>, 충돌 가능성이 높은 구간만 잠금/직렬화로 <strong>국소 강화</strong>해 <strong>처리량과 지연을 균형화</strong>한다.</li><li><strong>예측가능성/개발 생산성</strong>: 표준 격리 계약 하에 결과가 재현 가능하므로 <strong>디버깅·테스트 용이</strong>하고, 동시성 문제를 엔진 레벨에서 흡수해 <strong>개발 부담 감소</strong>.</li><li><strong>운영·탄력성</strong>: 재시도·멱등·모니터링 체계를 갖춰 <strong>데드락/직렬화 실패</strong>에도 안정적으로 <strong>자가 복구</strong>.</li><li><strong>아키텍처 유연성</strong>: 단일 DB 부터 멀티리전·마이크로서비스까지 <strong>사가/아웃박스/스냅샷 리포팅</strong>으로 <strong>도메인별 최적격리</strong>를 선택 가능.</li></ul><table><thead><tr><th>카테고리</th><th>해결하려는 문제 (니즈)</th><th>목적 (가치 제안)</th><th>핵심 수단 (메커니즘)</th><th>대표 적용 구간</th><th>실패 시 리스크 / 모니터 지표</th></tr></thead><tbody><tr><td>무결성</td><td>Dirty/Non-repeatable/Phantom, Lost Update, Write Skew</td><td>규칙 위반 0 에 근접</td><td>RC/RCSI·RR·Serializable/SSI, 범위락, <code>FOR UPDATE</code>, 제약/트리거, 조건부 업데이트</td><td>결제·원장·재고 차감·중복 방지</td><td>오류율·정합성 결함률, 직렬화 실패율</td></tr><tr><td>성능</td><td>강한 일관성 요구로 처리량·지연 악화</td><td>최소 격리로 성능 확보</td><td>스냅샷 읽기, 읽기 복제, 인덱스/쿼리 튜닝, 핫키 분산</td><td>대량 조회/검색/대시보드</td><td>p95/p99 지연, TPS, 락 대기</td></tr><tr><td>예측가능성</td><td>재현 어려움, 버그 탐지 난이도</td><td>결정론적 결과·계약된 동작</td><td>표준 격리 준수, 테스트 고정 스냅샷</td><td>리그레션/리포팅</td><td>테스트 실패 재현률</td></tr><tr><td>운영/탄력성</td><td>데드락·재시도·장기 Tx</td><td>자가 복구·신속 대응</td><td>재시도·멱등키, 타임아웃, 슬로우/락/버전 스토어 모니터링</td><td>모든 쓰기 경로</td><td>데드락 비율, 장기 Tx 수, 버전 스토어 사용률</td></tr><tr><td>유연성/확장</td><td>분산/멀티리전·서비스 경계</td><td>도메인별 최적 격리</td><td>사가/아웃박스, 2PC 제한적 사용, 스냅샷 리포팅</td><td>글로벌 주문·정산·이벤트 구도</td><td>보상 성공률, 복제 지연</td></tr></tbody></table><ul><li><strong>무결성</strong>: 격리·락·검증 제약으로 핵심 규칙을 시스템적으로 보장한다.</li><li><strong>성능</strong>: 읽기는 스냅샷, 쓰기는 충돌 국소화로 처리량과 지연을 함께 관리한다.</li><li><strong>예측가능성</strong>: 표준 격리 계약과 고정 스냅샷으로 테스트·디버깅을 단순화한다.</li><li><strong>운영/탄력성</strong>: 재시도·멱등·모니터링으로 데드락/직렬화 실패에도 안정성을 유지한다.</li><li><strong>유연성/확장</strong>: 단일 DB~멀티리전까지 도메인에 맞는 격리 전략을 조합한다.</li></ul><h4 id=주요-특징-및-차별점-기술적-근거-포함>주요 특징 및 차별점 (기술적 근거 포함)<a hidden class=anchor aria-hidden=true href=#주요-특징-및-차별점-기술적-근거-포함>#</a></h4><p>트랜잭션 격리 수준은 <strong>ANSI SQL-92 표준</strong>에 기반해 정의되며, Dirty Read, Non-repeatable Read, Phantom Read 와 같은 동시성 문제 허용 여부를 단계적으로 제어한다.<br>수준이 높아질수록 <strong>데이터 일관성은 강화</strong>되지만, <strong>동시성과 성능은 감소</strong>하는 트레이드오프가 발생한다.<br>각 DBMS 는 내부적으로 <strong>MVCC, Lock 기반 2PL, Optimistic</strong> 등 다양한 구현 방식을 적용하며, 같은 이름이라도 동작이 다를 수 있다.<br>이러한 차이는 <strong>성능 조율, 예측 가능성, 이식성</strong> 등에서 중요한 영향을 미치며, 상황에 따라 적절한 수준을 선택해야 한다.</p><table><thead><tr><th>특징</th><th>설명</th><th>기술적 근거</th><th>DBMS 구현 차별점</th></tr></thead><tbody><tr><td><strong>표준 기반</strong></td><td>ANSI SQL-92 표준에 따라 4 단계 격리 수준 제공</td><td>ISO/IEC 9075:1992</td><td>모든 주요 DBMS 지원, 이름 동일</td></tr><tr><td><strong>트레이드오프</strong></td><td>일관성↑ → 동시성·성능↓</td><td>로킹 범위와 지속 시간 차이</td><td>성능·일관성 간 선택 필요</td></tr><tr><td><strong>구현 다양성</strong></td><td>MVCC, 2PL, Optimistic 등 다양한 방식</td><td>PostgreSQL(SSI), MySQL(Gap Lock), SQL Server(Snapshot)</td><td>같은 수준이라도 동작 차이 존재</td></tr><tr><td><strong>성능 조율 가능</strong></td><td>트랜잭션/세션 단위로 수준 조절</td><td>SQL <code>SET TRANSACTION ISOLATION LEVEL</code></td><td>워크로드 특성에 맞게 실시간 조정</td></tr><tr><td><strong>예측 가능성</strong></td><td>표준화된 정의로 동작 예측 용이</td><td>표준 명세서, 테스트 케이스 기반</td><td>멀티 DB 환경에서 호환성 확보</td></tr></tbody></table><p>트랜잭션 격리 수준은 <strong>ANSI SQL-92 표준</strong>에 기반해 Dirty/Non-repeatable/Phantom Read 방지 여부를 제어하는 핵심 메커니즘이다.<br>수준이 높아질수록 <strong>일관성은 향상</strong>되지만 <strong>동시성과 성능이 저하</strong>되는 특성이 있으며, 각 DBMS 는 내부 구현 방식이 달라 실제 동작이 다를 수 있다.<br>따라서 환경별 워크로드와 요구사항에 맞춘 <strong>격리 수준 선택과 실시간 조율</strong>이 필수이다.</p><h3 id=핵심-원리-core-theory>핵심 원리 (Core Theory)<a hidden class=anchor aria-hidden=true href=#핵심-원리-core-theory>#</a></h3><h4 id=설계-원칙-및-철학>설계 원칙 및 철학<a hidden class=anchor aria-hidden=true href=#설계-원칙-및-철학>#</a></h4><p>트랜잭션 격리 수준은 <strong>ACID 원칙</strong>에 기반하며, 직렬화 가능성 (Serializability) 을 이상적인 목표로 설정한다. 그러나 운영 환경에서는 성능 비용을 고려하여 <strong>Isolation Spectrum</strong>을 활용, 비즈니스 요구에 맞춰 격리 수준을 조정한다.<br>각 구현은 DBMS 독립성을 보장하는 표준 인터페이스를 따르면서도, 내부적으로 <strong>Lock, MVCC, Optimistic Concurrency</strong> 등 다양한 동시성 제어 기법을 적용한다. 이러한 설계 철학은 일관성과 성능 간 최적 균형을 유지하면서도, 다양한 환경에 대응할 수 있게 한다.</p><table><thead><tr><th>설계 원칙</th><th>설명</th><th>기술적 근거</th><th>적용 예시</th></tr></thead><tbody><tr><td><strong>ACID 기반</strong></td><td>원자성, 일관성, 격리성, 지속성을 보장하는 기본 규칙</td><td>ANSI SQL-92, ISO/IEC 9075</td><td>모든 관계형 DBMS</td></tr><tr><td><strong>Serializability 목표</strong></td><td>직렬 실행과 동일한 결과 보장</td><td>트랜잭션 직렬 스케줄링 이론</td><td>PostgreSQL SSI, Google Spanner</td></tr><tr><td><strong>Isolation Spectrum</strong></td><td>격리 수준에 따른 성능↔일관성 트레이드오프</td><td>Read Uncommitted → Serializable</td><td>OLTP=Read Committed, 분석=Serializable</td></tr><tr><td><strong>비즈니스 중심 조정</strong></td><td>도메인 요구사항에 따라 격리 수준 선택</td><td>서비스 SLA, 데이터 중요도</td><td>금융=높은 격리, 로그 수집=낮은 격리</td></tr><tr><td><strong>구현 독립성</strong></td><td>표준 API 로 제어, 내부 엔진 최적화 허용</td><td>JDBC, ODBC / MVCC, 2PL</td><td>MySQL=Gap Lock, Oracle=Read Consistency</td></tr><tr><td><strong>다양한 제어 기법</strong></td><td>Lock, MVCC, Optimistic CC 등 혼합 사용</td><td>동시성 제어 알고리즘</td><td>PostgreSQL MVCC, SQL Server RCSI</td></tr></tbody></table><p>트랜잭션 격리 수준 설계의 핵심은 <strong>ACID 준수</strong>를 바탕으로 <strong>Serializability</strong>를 목표로 하되, 성능 비용을 고려해 <strong>Isolation Spectrum</strong>을 적용하는 것이다.<br>각 DBMS 는 표준 인터페이스를 통해 구현 독립성을 유지하면서 내부적으로 Lock, MVCC, Optimistic CC 등의 기법을 활용해 최적화한다.<br>결국 운영 환경에서는 <strong>비즈니스 요구에 맞춘 격리 수준 조정</strong>이 가장 중요한 원칙이 된다.</p><h4 id=기본-원리-및-동작-메커니즘>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘>#</a></h4><h5 id=기본-원리>기본 원리<a hidden class=anchor aria-hidden=true href=#기본-원리>#</a></h5><table><thead><tr><th>구분</th><th>설명</th><th>구현 기술 예시</th></tr></thead><tbody><tr><td><strong>격리 (Isolation)</strong></td><td>동시 실행 트랜잭션의 상호 영향 제한</td><td>ANSI SQL 표준 4 단계 (Levels)</td></tr><tr><td><strong>Lock 기반 제어</strong></td><td>Shared/Exclusive/Intent Lock 으로 읽기·쓰기 충돌 방지, 2PL 사용</td><td>MySQL InnoDB Next-Key Lock, SQL Server Range Lock</td></tr><tr><td><strong>MVCC 기반 제어</strong></td><td>각 트랜잭션에 스냅샷 버전 제공, 읽기 - 쓰기 충돌 최소화</td><td>PostgreSQL MVCC, Oracle Read Consistency</td></tr><tr><td><strong>팬텀 방지 기법</strong></td><td>Range Lock, Gap Lock, SSI(충돌 감지)</td><td>MySQL Gap Lock, PostgreSQL SSI</td></tr><tr><td><strong>성능 - 일관성 트레이드오프</strong></td><td>격리 수준이 높을수록 일관성↑, 동시성↓</td><td>OLTP=RC, 분석=Serializable</td></tr></tbody></table><p>트랜잭션 격리의 기본 원리는 <strong>Lock</strong>과 <strong>MVCC</strong>라는 두 축으로 구현되며, 격리 수준에 따라 일관성과 성능이 상반 관계를 가진다. 각 DBMS 는 팬텀 방지와 성능 최적화를 위해 Lock 범위 제어 또는 MVCC 기반 충돌 감지를 사용한다.</p><h5 id=동작-메커니즘>동작 메커니즘<a hidden class=anchor aria-hidden=true href=#동작-메커니즘>#</a></h5><pre class=mermaid>flowchart TB
    subgraph APP[Application Layer]
        T1[Transaction 1]
        T2[Transaction 2]
    end

    subgraph DBMS[DBMS Concurrency Control]
        IL[Isolation Level Checker]
        LM[&#34;Lock Manager\n(S/X, Intent, Range/Gap)&#34;]
        VM[&#34;Version Manager\n(MVCC Snapshot)&#34;]
        CD[&#34;Conflict Detector\n(SSI/Deadlock Detector)&#34;]
        SE[Storage Engine]
    end

    T1 --&gt;|Read/Write| IL
    T2 --&gt;|Read/Write| IL
    IL --&gt;|Lock Based| LM
    IL --&gt;|MVCC Based| VM
    LM --&gt; CD
    VM --&gt; CD
    CD --&gt; SE
    SE --&gt;|Data / Snapshot| T1
    SE --&gt;|Data / Snapshot| T2
</pre><p>트랜잭션은 Application Layer 에서 DBMS 의 <strong>Isolation Level Checker</strong>를 거쳐 Lock 또는 MVCC 경로로 진입한다.<br>Lock Manager 는 전통적인 S/X/Intent/Rage Lock 을 적용하고, MVCC 는 트랜잭션별 스냅샷을 제공한다. Conflict Detector 는 데드락이나 SSI 충돌을 감지하며, 최종적으로 Storage Engine 이 실제 데이터 또는 버전을 반환한다.</p><h5 id=lock-기반-vs-mvcc-기반-트랜잭션-처리-흐름-비교>Lock 기반 vs. MVCC 기반 트랜잭션 처리 흐름 비교<a hidden class=anchor aria-hidden=true href=#lock-기반-vs-mvcc-기반-트랜잭션-처리-흐름-비교>#</a></h5><pre class=mermaid>sequenceDiagram
    autonumber
    participant T1 as Transaction 1
    participant T2 as Transaction 2
    participant CC as Concurrency Control
    participant DB as Database
    
    Note over T1,T2: **Lock 기반(Strict 2PL)**
    
    T1-&gt;&gt;CC: BEGIN
    T1-&gt;&gt;CC: Read(Data X) → Shared Lock 요청
    CC--&gt;&gt;T1: Grant Shared Lock
    T2-&gt;&gt;CC: Write(Data X) → Exclusive Lock 요청
    CC--&gt;&gt;T2: Wait (Shared Lock 보유중)
    T1-&gt;&gt;CC: Write(Data X) → Upgrade to Exclusive Lock
    CC--&gt;&gt;T1: Granted (다른 락 해제 후)
    T1-&gt;&gt;DB: Update X
    T1-&gt;&gt;CC: COMMIT → 락 해제
    CC--&gt;&gt;T2: Exclusive Lock Granted
    T2-&gt;&gt;DB: Update X
    T2-&gt;&gt;CC: COMMIT → 락 해제

    Note over T1,T2: **MVCC 기반(Snapshot Isolation)**
    
    T1-&gt;&gt;CC: BEGIN (Snapshot TS=100)
    T1-&gt;&gt;DB: Read(Data X, version ≤ 100)
    T2-&gt;&gt;CC: BEGIN (Snapshot TS=105)
    T2-&gt;&gt;DB: Update Data X → New Version (TS=105)
    T1-&gt;&gt;DB: Read(Data X, version ≤ 100) → 기존 버전 반환
    T1-&gt;&gt;CC: Update Data X → 충돌 검사
    CC--&gt;&gt;T1: Conflict Detected? Rollback or Commit
    T2-&gt;&gt;CC: COMMIT → 최신 버전 확정
</pre><hr><ul><li><p><strong>Lock 기반</strong></p><ul><li>읽기/쓰기 시 Lock 을 점유하고 해제 전까지 다른 트랜잭션 대기</li><li>교착 상태 (Deadlock) 가능</li><li>팬텀 방지를 위해 Range/GAP Lock 필요</li><li>동시성 낮지만 일관성 강력</li></ul></li><li><p><strong>MVCC 기반</strong></p><ul><li>읽기는 항상 스냅샷 버전 제공 → 대기 없이 진행</li><li>쓰기 충돌은 <strong>커밋 시점</strong>에 감지</li><li>Deadlock 가능성 낮음, 대신 버전 관리 비용 존재</li><li>동시성 높지만 Write Skew 발생 가능</li></ul></li></ul><h5 id=lock-기반-vs-mvcc-기반-실무-적용-장단점-비교>Lock 기반 Vs MVCC 기반 실무 적용 장단점 비교<a hidden class=anchor aria-hidden=true href=#lock-기반-vs-mvcc-기반-실무-적용-장단점-비교>#</a></h5><table><thead><tr><th>구분</th><th>Lock 기반 (Strict 2PL 등)</th><th>MVCC 기반 (Snapshot Isolation 등)</th></tr></thead><tbody><tr><td><strong>동작 방식</strong></td><td>Shared/Exclusive/Range Lock 을 사용해 트랜잭션 간 동시 접근 제어</td><td>각 트랜잭션 시작 시점의 스냅샷 버전을 읽고, 쓰기는 새로운 버전 생성</td></tr><tr><td><strong>읽기 처리</strong></td><td>읽기 시에도 Shared Lock 필요 → 쓰기와 경합 발생</td><td>읽기는 스냅샷에서 수행 → 쓰기와 독립</td></tr><tr><td><strong>쓰기 처리</strong></td><td>쓰기 시 Exclusive Lock 필요 → 대기 또는 교착 가능</td><td>쓰기는 최신 버전 생성 후 Commit 시점 충돌 검사</td></tr><tr><td><strong>일관성 보장</strong></td><td>직렬화 보장 쉬움, 팬텀 방지 가능</td><td>높은 동시성 제공, 단 Write Skew 가능</td></tr><tr><td><strong>동시성</strong></td><td>낮음 (Lock 경합 증가 시 급격히 하락)</td><td>높음 (대부분 읽기 작업은 락 없이 진행)</td></tr><tr><td><strong>성능 특성</strong></td><td>고빈도 쓰기·짧은 트랜잭션에 유리</td><td>읽기 비중이 높고 장기 트랜잭션에도 안정적</td></tr><tr><td><strong>리스크</strong></td><td>Deadlock, 장기 대기, 락 경합</td><td>버전 폭증, GC 지연, Commit 시 충돌로 인한 롤백</td></tr><tr><td><strong>리소스 사용량</strong></td><td>Lock Table 메모리 사용</td><td>Undo/Version Store, 추가 스토리지 사용</td></tr><tr><td><strong>운영 관리</strong></td><td>락 모니터링 필수, 데드락 탐지 필요</td><td>Vacuum/GC, 버전 관리 정책 필요</td></tr><tr><td><strong>대표 DBMS 사례</strong></td><td>MySQL InnoDB (Next-Key Lock), SQL Server (2PL)</td><td>PostgreSQL, Oracle, SQL Server (RCSI)</td></tr></tbody></table><ul><li><strong>Lock 기반</strong>: 높은 일관성 보장, 하지만 경합이 심하면 성능 급락. 쓰기 중심 OLTP 에 적합하나 Deadlock 회피 전략 필수.</li><li><strong>MVCC 기반</strong>: 읽기 중심 워크로드와 장기 트랜잭션에 유리. 동시성 높지만, 버전 관리와 Commit 시 충돌 처리가 관건.</li></ul><h4 id=아키텍처-및-구성-요소>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소>#</a></h4><pre class=mermaid>graph TB
    subgraph &#34;Application Tier&#34;
        APP1[Web Application]
        APP2[API Server]
        APP3[Batch Process]
    end
    
    subgraph &#34;Database Management System&#34;
        TM[Transaction Manager]
        LM[Lock Manager]
        VM[Version Manager / Store]
        DD[Deadlock &amp; Conflict Detector]
        BM[Buffer Manager]
        RM[Recovery Manager]
        QE[Query Executor]
        TC[Transaction Coordinator]
        REP[Replication Manager]
    end
    
    subgraph &#34;Storage Layer&#34;
        DF[Data Files]
        IF[Index Files]
        TL[Transaction Log]
        VF[Version Files/Undo Segments]
    end
    
    APP1 --&gt; TM
    APP2 --&gt; TM
    APP3 --&gt; TM
    
    TM --&gt; LM
    TM --&gt; VM
    TM --&gt; DD
    TM --&gt; QE
    TM --&gt; TC
    TM --&gt; RM
    
    LM --&gt; DF
    VM --&gt; VF
    BM --&gt; DF
    BM --&gt; IF
    QE --&gt; BM
    RM --&gt; TL
    TC --&gt; REP
    REP --&gt; DF
</pre><h5 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h5><table><thead><tr><th>구성 요소</th><th>필수/선택</th><th>설명</th><th>주요 기능</th><th>특징</th></tr></thead><tbody><tr><td><strong>Transaction Manager</strong></td><td>필수</td><td>트랜잭션 시작·커밋·롤백 제어, 격리 수준 설정</td><td>트랜잭션 상태 추적, 일관성 보장, ACID 관리</td><td>모든 DBMS 공통, Isolation Level 제어의 핵심</td></tr><tr><td><strong>Lock Manager</strong></td><td>필수</td><td>공유락 (S), 배타락 (X), 의도락 등 관리</td><td>동시성 제어, 락 호환성 검사, 데드락 감지 연계</td><td>2PL 기반 엔진에서 필수, 고격리수준에서 활용 극대화</td></tr><tr><td><strong>Version Manager / Version Store</strong></td><td>선택</td><td>MVCC 구현을 위한 버전 관리</td><td>행 버전 저장, 스냅샷 제공, 오래된 버전 정리</td><td>PostgreSQL, Oracle, SQL Server 에서 구현</td></tr><tr><td><strong>Deadlock / Conflict Detector</strong></td><td>권장</td><td>교착상태 및 SSI 충돌 탐지</td><td>Wait-for Graph 분석, 충돌 트랜잭션 중단</td><td>고격리수준 및 분산 트랜잭션 환경에서 중요</td></tr><tr><td><strong>Buffer Manager</strong></td><td>필수</td><td>디스크 블록 캐싱 및 메모리 관리</td><td>버퍼 풀 운영, 캐시 교체 정책 적용</td><td>성능에 직접적 영향, OLTP·OLAP 모두 중요</td></tr><tr><td><strong>Recovery Manager</strong></td><td>필수</td><td>장애 발생 시 복구 기능 제공</td><td>로그 기반 복구, 체크포인트 관리</td><td>WAL, REDO/UNDO 메커니즘 포함</td></tr><tr><td><strong>Query Executor</strong></td><td>필수</td><td>실행 계획에 따른 쿼리 수행</td><td>옵티마이저 결과 실행, I/O 요청 전달</td><td>Isolation Level 에 따라 접근 경로 변화 가능</td></tr><tr><td><strong>Transaction Coordinator</strong></td><td>선택</td><td>분산 환경에서 트랜잭션 조정</td><td>2PC/3PC, SAGA 관리</td><td>멀티노드·멀티리전 DB 에서 필요</td></tr><tr><td><strong>Replication Manager</strong></td><td>선택</td><td>복제 및 데이터 동기화 관리</td><td>리더 - 팔로워 복제, 최종 일관성 보장</td><td>글로벌 DB 및 고가용성 환경에서 필수</td></tr></tbody></table><h5 id=ansi-격리-수준별-구성-요소-집중도>ANSI 격리 수준별 구성 요소 집중도<a hidden class=anchor aria-hidden=true href=#ansi-격리-수준별-구성-요소-집중도>#</a></h5><blockquote><p><strong>집중도</strong>:<br>🔴 매우 집중 (핵심 동작)<br>🟠 보통 활용<br>🟢 상대적으로 영향 적음</p></blockquote><table><thead><tr><th>구성 요소</th><th>Read Uncommitted</th><th>Read Committed</th><th>Repeatable Read</th><th>Serializable</th></tr></thead><tbody><tr><td><strong>Transaction Manager</strong></td><td>🔴</td><td>🔴</td><td>🔴</td><td>🔴</td></tr><tr><td><strong>Lock Manager</strong></td><td>🟠</td><td>🟠</td><td>🔴</td><td>🔴</td></tr><tr><td><strong>Version Manager / Store (MVCC)</strong></td><td>🟠</td><td>🔴</td><td>🔴</td><td>🔴</td></tr><tr><td><strong>Deadlock / Conflict Detector</strong></td><td>🟢</td><td>🟠</td><td>🔴</td><td>🔴</td></tr><tr><td><strong>Buffer Manager</strong></td><td>🔴</td><td>🔴</td><td>🔴</td><td>🔴</td></tr><tr><td><strong>Recovery Manager</strong></td><td>🔴</td><td>🔴</td><td>🔴</td><td>🔴</td></tr><tr><td><strong>Query Executor</strong></td><td>🔴</td><td>🔴</td><td>🔴</td><td>🔴</td></tr><tr><td><strong>Transaction Coordinator (분산)</strong></td><td>🟢</td><td>🟠</td><td>🟠</td><td>🔴</td></tr><tr><td><strong>Replication Manager</strong></td><td>🟠</td><td>🟠</td><td>🟠</td><td>🟠</td></tr></tbody></table><h5 id=격리-수준별-주요-특징-반영-아키텍처>격리 수준별 주요 특징 반영 아키텍처<a hidden class=anchor aria-hidden=true href=#격리-수준별-주요-특징-반영-아키텍처>#</a></h5><pre class=mermaid>graph TB
    subgraph &#34;Application Tier&#34;
        APP1[Web Application]
        APP2[API Server]
        APP3[Batch Process]
    end
    
    subgraph &#34;Database Management System&#34;
        TM[Transaction Manager 🔴]
        LM[Lock Manager 🟠/🔴]
        VM[&#34;Version Manager / Store (MVCC) 🔴&#34;]
        DD[Deadlock &amp; Conflict Detector 🔴 in RR/S]
        BM[Buffer Manager 🔴]
        RM[Recovery Manager 🔴]
        QE[Query Executor 🔴]
        TC[Transaction Coordinator 🔴 in Serializable]
        REP[Replication Manager 🟠]
    end
    
    subgraph &#34;Storage Layer&#34;
        DF[Data Files]
        IF[Index Files]
        TL[Transaction Log]
        VF[Version Files/Undo Segments]
    end
    
    APP1 --&gt; TM
    APP2 --&gt; TM
    APP3 --&gt; TM
    
    TM --&gt; LM
    TM --&gt; VM
    TM --&gt; DD
    TM --&gt; QE
    TM --&gt; TC
    TM --&gt; RM
    
    LM --&gt; DF
    VM --&gt; VF
    BM --&gt; DF
    BM --&gt; IF
    QE --&gt; BM
    RM --&gt; TL
    TC --&gt; REP
    REP --&gt; DF
</pre><hr><ul><li><strong>Read Uncommitted</strong>: 락 매니저 활용이 최소, 버전 매니저·락 충돌 탐지 영향도 낮음.</li><li><strong>Read Committed</strong>: MVCC 또는 짧은 공유락 중심으로 버전 매니저 사용 비중 증가.</li><li><strong>Repeatable Read</strong>: 범위락 또는 MVCC 스냅샷 고정으로 락 매니저·버전 매니저 모두 집중 동작, 데드락 탐지 빈도 증가.</li><li><strong>Serializable</strong>: 모든 구성 요소가 최대로 동작, 특히 Lock Manager, Conflict Detector, Transaction Coordinator 의 부하 집중.</li></ul><h4 id=주요-기능과-역할>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할>#</a></h4><table><thead><tr><th>기능</th><th>설명</th><th>핵심 메커니즘/구현</th><th>격리 수준과의 관계</th><th>대표 효과</th><th>운영 포인트</th></tr></thead><tbody><tr><td>격리 수준 제어</td><td>트랜잭션 간 가시성 규칙 설정</td><td>RU/RC/RR/Serializable, RCSI/Snapshot</td><td>레벨↑ ⇒ 현상 차단↑/동시성↓</td><td>도메인별 최적 균형 선택</td><td>구간별 상이한 레벨 적용 권장</td></tr><tr><td>동시성 문제 방지</td><td>Dirty/NR/Phantom/Lost/WS 방지</td><td>범위락, <code>FOR UPDATE</code>, 조건부 UPDATE, SSI</td><td>RC: Dirty 차단 / RR: NR 차단 / Serializable: Phantom·WS 차단</td><td>규칙 위반·오염 최소화</td><td>쿼리/인덱스로 범위락 최소화</td></tr><tr><td>락 관리</td><td>읽기/쓰기·범위 잠금, 데드락 처리</td><td>S/X/의도/Next-Key, 데드락 탐지</td><td>RR/Serializable 에서 중요</td><td>충돌 국소화, 무결성 보장</td><td>잠금 순서 규약, 대기/타임아웃</td></tr><tr><td>MVCC(버전)</td><td>비차단 읽기·스냅샷</td><td>버전 체인, 가시성 규칙</td><td>RCSI/Snapshot=읽기 유리</td><td>읽기 처리량↑, 경합↓</td><td>버전 스토어/긴 Tx 관리</td></tr><tr><td>스케줄링/충돌 해결</td><td>직렬성 보장/충돌 시 중단·재시도</td><td>2PL, SSI, first-committer-wins</td><td>Serializable(SSI) 핵심</td><td>결정론적 결과</td><td>재시도·멱등 필수</td></tr><tr><td>오류 복구 연계</td><td>격리 위반 시 안전 롤백</td><td>트랜잭션 로그, 롤백/재시도</td><td>모든 레벨 공통</td><td>장애 국소화·회복성↑</td><td>재시도 정책·멱등키</td></tr></tbody></table><h5 id=기능역할-관계>기능↔역할 관계<a hidden class=anchor aria-hidden=true href=#기능역할-관계>#</a></h5><table><thead><tr><th>기능 → 역할</th><th>데이터 일관성 보장</th><th>성능·동시성 관리</th><th>예측 가능한 동작</th><th>오류 복구/안정성</th></tr></thead><tbody><tr><td>격리 수준 제어</td><td>●●●</td><td>●●</td><td>●●●</td><td>●</td></tr><tr><td>동시성 문제 방지 (범위락/제약/SSI)</td><td>●●●</td><td>●</td><td>●●●</td><td>●●</td></tr><tr><td>락 관리 (범위·데드락)</td><td>●●●</td><td>●</td><td>●</td><td>●●</td></tr><tr><td>MVCC(스냅샷)</td><td>●</td><td>●●●</td><td>●●</td><td>●</td></tr><tr><td>스케줄링/충돌해결 (2PL/SSI/조건부)</td><td>●●●</td><td>●</td><td>●●●</td><td>●●</td></tr><tr><td>오류 복구 연계 (로그/재시도)</td><td>●●</td><td>●</td><td>●</td><td>●●●</td></tr></tbody></table><blockquote><p>점 (●) 개수는 기여 강도 (상대적) 표기.</p></blockquote><ul><li><strong>기능은 " 레벨·락·버전·검증 (SSI/조건부)&rdquo; 의 조합</strong>, **역할은 " 무결성·성능·예측가능성·복구 &ldquo;**로 귀결된다.</li><li>읽기는 <strong>스냅샷</strong>으로 비차단화, 핵심 규칙 구간은 <strong>직렬화/범위잠금</strong>으로 짧게 보호, <strong>재시도·멱등</strong>으로 운영을 닫는다.</li><li>엔진 차이 (InnoDB Next-Key, PG-SSI, MSSQL-RCSI) 를 설계와 테스트에 반영하면 안전성과 성능을 동시에 확보할 수 있다.</li></ul><h3 id=특성-분석-characteristics-analysis>특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#특성-분석-characteristics-analysis>#</a></h3><h4 id=장점-및-이점>장점 및 이점<a hidden class=anchor aria-hidden=true href=#장점-및-이점>#</a></h4><table><thead><tr><th>항목</th><th>설명</th><th>기술적 근거</th><th>실무 효과</th></tr></thead><tbody><tr><td>데이터 일관성 보장</td><td>Dirty/Non-repeatable/Phantom Read 방지</td><td>Locking 또는 MVCC 기반 동시성 제어</td><td>데이터 무결성·신뢰성 확보</td></tr><tr><td>성능·일관성 선택권</td><td>ANSI 4 단계 + SI/RCSI 등 확장 격리 지원</td><td>표준·벤더 확장 격리 수준</td><td>워크로드 맞춤 최적화</td></tr><tr><td>유연한 적용</td><td>업무·시스템 요구에 맞는 수준별 설정 가능</td><td>런타임 격리 수준 변경 API 지원</td><td>상황별 성능/정합성 조율</td></tr><tr><td>비차단 읽기</td><td>MVCC/RCSI 로 읽기 - 쓰기 충돌 완화</td><td>PostgreSQL, SQL Server 등 MVCC 구현</td><td>읽기 대기 최소화, TPS 향상</td></tr><tr><td>표준화·이식성</td><td>ANSI SQL-92 표준 준수</td><td>주요 RDBMS 공통 지원</td><td>벤더 종속 최소화</td></tr><tr><td>개발/운영 편의성</td><td>예측 가능한 동작, 디버깅 용이</td><td>표준 명세서 기반 설계</td><td>개발 생산성·품질 향상</td></tr><tr><td>장애 복구 용이</td><td>트랜잭션 실패 시 자동 롤백</td><td>로그·Undo·Redo 관리</td><td>서비스 안정성 유지</td></tr></tbody></table><p>트랜잭션 격리 수준의 가장 큰 강점은 <strong>데이터 무결성과 성능 간의 균형</strong>을 선택적으로 조절할 수 있다는 점이다. MVCC·RCSI 등 최신 구현은 <strong>비차단 읽기</strong>와 <strong>동시성 향상</strong>을 제공하며, 표준화 덕분에 다양한 DBMS 에서 <strong>이식성과 운영 편의성</strong>이 보장된다. 또한 로그 기반 복구 메커니즘은 장애 대응력을 높여 실무 환경에서 안정적인 서비스 운영을 가능하게 한다.</p><h4 id=단점-및-제약사항과-해결방안>단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#단점-및-제약사항과-해결방안>#</a></h4><p><strong>읽기는 스냅샷로 비차단화, 쓰기는 충돌을 국소화 (락/조건부 갱신)</strong>, <strong>핵심 구간만 직렬화/범위잠금으로 강화</strong>, <strong>재시도·멱등·모니터링</strong>으로 운영 리스크를 닫는다.</p><table><thead><tr><th>범주</th><th>항목 (문제)</th><th>원인/조건</th><th>증상/영향</th><th>탐지/진단 포인트</th><th>예방 전략</th><th>해결/대안 기술</th><th>비고 (격리/엔진 팁)</th></tr></thead><tbody><tr><td>성능</td><td><strong>직렬화 비용</strong>(재시도·Abort)</td><td>SSI/2PL·충돌 도메인 큼</td><td>TPS↓, p95/99 지연↑</td><td>직렬화 실패율, 핫키 Top-N</td><td>핵심 경로만 Serializable, 짧은 Tx</td><td>구간화, 파티셔닝, 백오프/지터</td><td>PG=SSI, MSSQL=HOLDLOCK 근사</td></tr><tr><td>성능</td><td><strong>갭락/범위락 경합</strong></td><td>RR+Next-Key/프리디킷</td><td>삽입 지연, 대기 체인</td><td>InnoDB STATUS, <code>pg_locks</code></td><td>인덱스/쿼리로 범위 축소</td><td>커버링 인덱스, 배치·큐</td><td>InnoDB 는 인덱스 필수</td></tr><tr><td>성능</td><td><strong>버전 스토어 압박</strong></td><td>RCSI/SI 긴 Tx·폭주</td><td>temp/Undo·IO 급증</td><td>버전 사용률, 오래된 Tx</td><td>긴 Tx 금지, 스냅샷 주기 관리</td><td>자동 정리 윈도우, Tx 타임아웃</td><td>Azure/MSSQL 특히 중요</td></tr><tr><td>안정성</td><td><strong>데드락/라이브락/기아</strong></td><td>잠금 순서 상충·우선순위 역전</td><td>롤백/지연 급증</td><td>데드락 그래프, 대기 이벤트</td><td>잠금 순서 규약, 공정 스케줄링</td><td>자동 롤백 + 재시도, backoff</td><td><code>SKIP LOCKED</code> 로 워커 분산</td></tr><tr><td>정합성</td><td><strong>Dirty/Non-repeatable/Phantom</strong></td><td>낮은 격리 (RU/RC/RR)</td><td>잘못된 읽기·집계</td><td>에러 로그·테스트</td><td>최소 RC, 범위는 RR/Serializable</td><td>Next-Key/프리디킷/SSI</td><td>InnoDB RR 은 팬텀 억제</td></tr><tr><td>정합성</td><td><strong>Lost Update</strong></td><td>동시 쓰기 덮어씀</td><td>값 소실, 음수 재고</td><td>영향 행수 모니터</td><td>X- 락 또는 낙관적 버전</td><td><code>WHERE version=…</code> 조건부 UPDATE</td><td>SI 는 보통 커밋 충돌로 방지</td></tr><tr><td>정합성</td><td><strong>Write Skew</strong></td><td>SI(스냅샷) 하 전역 제약</td><td>규칙 위반 (예: on-call ≥1)</td><td>비즈 규칙 알람</td><td>관련 행 묶기 (<code>FOR UPDATE</code>), 제약</td><td>Serializable/SSI, 검증 트리거</td><td>PG RR 에서 발생 가능</td></tr><tr><td>운영</td><td><strong>격리 운영 복잡성</strong></td><td>워크로드별 최적점 상이</td><td>설정 난이도, 회귀</td><td>실험/카나리</td><td>SLO 기반 레벨 선택</td><td>자동화 (쿼리 플랜/락 튜너)</td><td>" 전역 최상 " 대신 <strong>구간별 최적</strong></td></tr><tr><td>분산</td><td><strong>2PC/멀티리전 지연</strong></td><td>네트워크·합의 비용</td><td>10–100× 지연</td><td>분산 추적, 리전 지연</td><td>로컬 Tx + 사가 보상</td><td>Outbox/사가, 읽기 복제</td><td>글로벌 직렬화는 최소화</td></tr></tbody></table><ul><li><strong>직렬화/범위잠금은 비싸다</strong>. <strong>핵심 규칙 구간만</strong> 짧게 적용하고, 나머지는 <strong>RC/RCSI/Snapshot</strong>로 읽기 비차단·처리량을 확보하라.</li><li><strong>스냅샷 계열은 Write Skew</strong>가 남는다. <strong>SSI/제약/범위잠금/검증 단계</strong>로 보완하라.</li><li><strong>운영의 핵심</strong>은 <strong>재시도·멱등·잠금 순서 규약</strong>과 **지표 모니터링 (직렬화 실패·데드락·버전 압력)**이다.</li><li><strong>분산 시나리오</strong>는 로컬 트랜잭션 + 사가/아웃박스로 분해해, 2PC/글로벌 직렬화 구간을 최소화하라.</li></ul><h4 id=트레이드오프-관계-분석>트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석>#</a></h4><table><thead><tr><th>축 (의사결정)</th><th>선택지</th><th>장점</th><th>단점</th><th>적합한 상황</th><th>주의/운영 포인트</th></tr></thead><tbody><tr><td>격리 수준</td><td>높은 격리 (SR/RR)</td><td>정합성↑, 예측가능성↑</td><td>처리량↓, 지연↑</td><td>금융/재무, 멀티라이팅</td><td>핫스팟 분리, 배치 분산, 인덱스 정밀화</td></tr><tr><td></td><td>낮은 격리 (RC/RU)</td><td>처리량↑, 지연↓</td><td>이상현상 위험</td><td>읽기 중심, 후처리 가능 업무</td><td>데이터 품질 검증·보정 로직</td></tr><tr><td>제어 방식</td><td>Lock(2PL)</td><td>직렬성 달성 용이</td><td>데드락/대기</td><td>짧은 트랜잭션, 쓰기 충돌 많음</td><td>락 순서 규칙, 타임아웃/해제 전략</td></tr><tr><td></td><td>MVCC(SI/RCSI)</td><td>읽기 동시성↑</td><td>버전/GC 비용, 커밋 충돌</td><td>장수 Tx, 읽기 다수</td><td>버전 저장소 모니터링, 재시도·멱등성</td></tr><tr><td>성능 목표</td><td>응답시간 최적화</td><td>P95/99 지연↓</td><td>TPS↓ 가능</td><td>실시간 API</td><td>짧은 Tx, 인덱스·커버링 쿼리</td></tr><tr><td></td><td>처리량 최적화</td><td>TPS↑, 코스트↓</td><td>일부 지연↑</td><td>배치/스트림</td><td>큐·백프레셔, 스로틀링</td></tr><tr><td>일관성 방식</td><td>최신성 우선 (최신 커밋)</td><td>최신 상태 보장</td><td>경합↑</td><td>재고/좌석/거래</td><td>락 범위/기간 최소화</td></tr><tr><td></td><td>스냅샷 (시점 일관성)</td><td>안정적 읽기</td><td>시점 지연</td><td>리포트/검색/피드</td><td>리프레시 주기·TTL 관리</td></tr></tbody></table><p>결국 선택의 핵심은 <strong>업무 위험 허용치와 SLO</strong>다.<br>정확성이 최우선이면 <strong>높은 격리 + 필요 시 Lock</strong>, 체감 성능·확장이 중요하면 <strong>MVCC/SI + 재시도·멱등성</strong>이 유리하다.<br>응답시간을 좇으면 TPS 를 일부 포기하고, 처리량을 좇으면 P99 지연을 감내한다.<br>현실적인 최적점은 <strong>핫스팟 분리, 읽기 전용 복제본, Outbox/재시도 패턴</strong>을 조합해 찾는 것이다.</p><h4 id=성능-특성-및-확장성>성능 특성 및 확장성<a hidden class=anchor aria-hidden=true href=#성능-특성-및-확장성>#</a></h4><ul><li><strong>RU</strong>: 최저 일관성/최고 처리량. 비핵심 분석용·임시 조회 외에는 권장하지 않음.</li><li><strong>RC / RCSI(SI)</strong>: OLTP 기본값. 읽기 대기 최소화로 <strong>균형 점</strong>. 버전 저장소 비용과 재시도 정책 고려.</li><li><strong>RR</strong>: 동일 트랜잭션 내 반복 조회 안정. InnoDB 는 범위락으로 팬텀 방지, PG 는 스냅샷 기반으로 write-skew 가능.</li><li><strong>SR(Serializable)</strong>: 예측 가능성·정확성 최상. 처리량/확장성 비용이 크며, SSI 기반인 경우 <strong>abort 증가</strong> 가능.</li></ul><table><thead><tr><th>격리 수준</th><th>핵심 동작 (요지)</th><th>처리량</th><th>지연</th><th>동시성</th><th>확장성 (단일 노드)</th><th>확장성 (Scale-out)</th><th>주요 리스크/비용</th><th>권장 시나리오</th><th>운영 팁</th></tr></thead><tbody><tr><td>Read Uncommitted (RU)</td><td>커밋 전 데이터 읽기 허용</td><td>매우 높음</td><td>매우 낮음</td><td>매우 높음</td><td>우수</td><td>우수</td><td>Dirty Read 로 데이터 품질 저하</td><td>로그 탐색, 비핵심 분석</td><td>핵심 트랜잭션에는 금지</td></tr><tr><td>Read Committed (RC)</td><td>커밋된 데이터만 읽기</td><td>높음</td><td>낮음</td><td>높음</td><td>양호</td><td>양호~우수</td><td>잠금 경합 (엔진별), 최신성 유지 비용</td><td>일반 OLTP, API 백엔드</td><td>짧은 Tx·커버링 인덱스</td></tr><tr><td>RC with RCSI/SI</td><td>RC 를 MVCC 로 구현 (읽기 비블로킹)</td><td>높음~매우 높음</td><td>낮음</td><td>높음~매우 높음</td><td>양호</td><td>우수</td><td>버전 저장소/GC 비용, 커밋 충돌 재시도</td><td>읽기 많은 OLTP/HTAP</td><td>버전 모니터링·재시도/멱등성</td></tr><tr><td>Repeatable Read (RR)</td><td>트랜잭션 내 재조회 일관</td><td>중간~높음</td><td>중간</td><td>중간</td><td>보통</td><td>보통</td><td>(PG) write-skew 가능, (InnoDB) 범위락 경합</td><td>리포팅, 중간 수준 정합성</td><td>범위쿼리 인덱스·락 범위 최소화</td></tr><tr><td>Serializable (SR)</td><td>직렬 실행과 동일한 결과</td><td>낮음</td><td>높음</td><td>낮음</td><td>제한적</td><td>제한적</td><td>데드락/대기↑ 또는 (SSI) abort↑</td><td>회계/재고/거래의 강한 정합성</td><td>핵심 경로만 SR, 비핵심 RC/SI</td></tr></tbody></table><ul><li><strong>OLTP 기본값은 RC(가능하면 RCSI/SI)</strong>: 읽기 블로킹을 줄여 P99 지연과 처리량 균형 확보.</li><li><strong>범위 일관성이 핵심이면 RR+ 범위락 또는 SR</strong>: 단, 경합·지연 비용이 크므로 <strong>핵심 경로에 한정</strong>.</li><li><strong>확장 전략과 함께 본다</strong>: 읽기 복제본·샤딩·CQRS 조합 시 RC/RCSI/SI 가 확장성에서 유리, SR 은 멀티리전/크로스 - 파티션에서 비용 급증.</li><li><strong>운영 핵심</strong>: Lock 은 <strong>데드락·락 홀딩 관리</strong>, MVCC 는 <strong>버전 저장소·GC·재시도/멱등성</strong>이 관건.</li><li>현실적인 최적점은 <strong>핫스팟 제거, 짧은 트랜잭션, 인덱스 품질, 재시도 전략</strong>을 통해 만든다.</li></ul><h3 id=구현-및-분류-implementation--classification>구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#구현-및-분류-implementation--classification>#</a></h3><h4 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h4><h5 id=메커니즘-기반>메커니즘 기반<a hidden class=anchor aria-hidden=true href=#메커니즘-기반>#</a></h5><ul><li>Locking(2PL)</li><li>MVCC/Snapshot Isolation</li><li>SSI(Serializable Snapshot Isolation)</li><li>OCC(낙관적 동시성)</li></ul><table><thead><tr><th>분류</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td>Locking(2PL)</td><td>잠금으로 충돌을 직렬화</td><td>S/X/의도락, 범위락, Deadlock 탐지</td><td><strong>확장→축소</strong> 단계로 락 획득/해제</td><td>직렬가능성/팬텀 억제</td><td>높은 정합성 요구, 갱신 비중 높음</td><td>데드락/경합 가능, 계획 예측성 높음</td></tr><tr><td>MVCC/SI</td><td>다중 버전으로 읽기 - 쓰기 분리</td><td>버전체인/Undo/Version Store</td><td>트랜잭션 시작 시점 <strong>스냅샷</strong> 읽기</td><td>비차단 읽기 + 일관성</td><td>읽기 비중 높은 OLTP/리포팅</td><td>Dirty/NR 방지, Write-Skew 가능</td></tr><tr><td>SSI</td><td>MVCC 위 충돌감지로 직렬성 보장</td><td>MVCC + 충돌 그래프</td><td>위험한 의존성 감지 시 <strong>Abort</strong></td><td>팬텀/Write-Skew 제거</td><td>강한 정합성 + 동시성</td><td>성능 양호하나 재시도 필요</td></tr><tr><td>OCC</td><td>커밋 시점에만 충돌 검사</td><td>버전번호/타임스탬프</td><td>갱신 시 <strong>조건부 업데이트</strong></td><td>잠금 최소화</td><td>충돌 드문 읽기 위주</td><td>실패 시 재시도, 앱 레벨 구현 용이</td></tr></tbody></table><h6 id=locking2plansi-sql>Locking(2PL)—ANSI SQL<a hidden class=anchor aria-hidden=true href=#locking2plansi-sql>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 트랜잭션 내 갱신 대상 행을 명시적으로 잠금(팬텀 방지엔 범위조건 + 적절한 인덱스 필요)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=p>;</span><span class=w>  </span><span class=c1>-- X락
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>50</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h6 id=mvccsnapshot-isolationpostgresql-sql>MVCC/Snapshot Isolation—PostgreSQL SQL<a hidden class=anchor aria-hidden=true href=#mvccsnapshot-isolationpostgresql-sql>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 스냅샷 격리로 같은 트랜잭션 내 읽기 일관성 확보(비차단 읽기)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=k>REPEATABLE</span><span class=w> </span><span class=k>READ</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>sum</span><span class=p>(</span><span class=n>amount</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;PAID&#39;</span><span class=p>;</span><span class=w> </span><span class=c1>-- 스냅샷 기준
</span></span></span><span class=line><span class=cl><span class=c1>-- 다른 세션 갱신과 무관하게 트랜잭션 종료 전까지 조회 결과 일관
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h6 id=ssipython-psycopg2-직렬화-실패-재시도>SSI—Python (psycopg2, 직렬화 실패 재시도)<a hidden class=anchor aria-hidden=true href=#ssipython-psycopg2-직렬화-실패-재시도>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>psycopg2</span> <span class=kn>import</span> <span class=n>extensions</span><span class=p>,</span> <span class=n>errors</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run_serializable</span><span class=p>(</span><span class=n>txn_fn</span><span class=p>,</span> <span class=n>max_retry</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_retry</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=app user=app&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>set_isolation_level</span><span class=p>(</span><span class=n>extensions</span><span class=o>.</span><span class=n>ISOLATION_LEVEL_SERIALIZABLE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cur</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>txn_fn</span><span class=p>(</span><span class=n>cur</span><span class=p>)</span>  <span class=c1># 비즈니스 로직 수행</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>errors</span><span class=o>.</span><span class=n>SerializationFailure</span><span class=p>:</span>  <span class=c1># SSI 충돌</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.05</span> <span class=o>*</span> <span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>i</span><span class=p>))</span>     <span class=c1># 지수 백오프 후 재시도</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=occ낙관적nodejs-postgresql-or-mysql-공통-패턴>OCC(낙관적)—Node.js (PostgreSQL Or MySQL 공통 패턴)<a hidden class=anchor aria-hidden=true href=#occ낙관적nodejs-postgresql-or-mysql-공통-패턴>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 버전 컬럼(version)으로 조건부 업데이트: 동시 갱신 충돌 시 0행 갱신 → 재시도
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>optimisticUpdate</span><span class=p>(</span><span class=nx>client</span><span class=p>,</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>newData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>attempt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>attempt</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=nx>attempt</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>rows</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;SELECT payload, version FROM items WHERE id=$1&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>rows</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;UPDATE items SET payload=$1, version=$2 WHERE id=$3 AND version=$4&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=nx>newData</span><span class=p>,</span> <span class=nx>version</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>version</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>rowCount</span> <span class=o>===</span> <span class=mi>1</span><span class=p>)</span> <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>r</span> <span class=p>=&gt;</span> <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=mi>50</span> <span class=o>*</span> <span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=nx>attempt</span><span class=p>)));</span> <span class=c1>// 백오프
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Concurrency conflict&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=엔진옵션-기반>엔진/옵션 기반<a hidden class=anchor aria-hidden=true href=#엔진옵션-기반>#</a></h5><ul><li>MySQL InnoDB</li><li>PostgreSQL</li><li>SQL Server(RCSI/SNAPSHOT)</li><li>Oracle</li></ul><table><thead><tr><th>분류</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td>MySQL InnoDB</td><td>기본 RR + Next-Key/GAP</td><td>InnoDB Lock, Undo</td><td>Range 잠금으로 팬텀 억제</td><td>팬텀/유실갱신 방지</td><td>카운팅/범위 갱신</td><td>RR 이 표준보다 강함 (사실상 SE 에 근접)</td></tr><tr><td>PostgreSQL</td><td>기본 RC, SE=SSI</td><td>MVCC(Heap), SSI</td><td>RC/RR=SI 성격, SE=SSI</td><td>비차단 읽기 + 강 정합성 (선택)</td><td>혼합 워크로드</td><td>직렬화 실패 재시도 패턴 권장</td></tr><tr><td>SQL Server</td><td>RC 기본, <strong>RCSI/SNAPSHOT</strong></td><td>Lock Manager, TempDB VS</td><td>RCSI=RC 의 MVCC 판, SNAPSHOT=세션 격리</td><td>대기 감소/읽기 가속</td><td>OLTP + 리포팅 병행</td><td>RCSI 전역 옵션, SNAPSHOT 세션 선택</td></tr><tr><td>Oracle</td><td>RC 일관성 읽기 (Dirty 불가)</td><td>Undo, SCN 스냅샷</td><td>쿼리 시점 일관성, FOR UPDATE 로 잠금</td><td>일관성 + 성능 균형</td><td>엔터프라이즈 OLTP</td><td>전통적으로 강한 쿼리 일관성</td></tr></tbody></table><h6 id=mysql-innodbnext-keygap-lockmysql-sql>MySQL InnoDB(Next-Key/GAP Lock)—MySQL SQL<a hidden class=anchor aria-hidden=true href=#mysql-innodbnext-keygap-lockmysql-sql>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5>5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 세션 격리 수준 설정(세션/글로벌): RR에서 Next-Key가 범위 잠금으로 팬텀 억제
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SET</span><span class=w> </span><span class=k>SESSION</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=k>REPEATABLE</span><span class=w> </span><span class=k>READ</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>START</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=mi>200</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=p>;</span><span class=w> </span><span class=c1>-- 범위 잠금
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>flag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=mi>120</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=mi>180</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h6 id=sql-serverrcsisnapshott-sql>SQL Server(RCSI/SNAPSHOT)—T-SQL<a hidden class=anchor aria-hidden=true href=#sql-serverrcsisnapshott-sql>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6>6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 1) DB 레벨로 RCSI 활성(전역 읽기 스냅샷, RC에서도 비차단 읽기)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>MyDb</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>READ_COMMITTED_SNAPSHOT</span><span class=w> </span><span class=k>ON</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 2) SNAPSHOT 격리: DB 옵션 ON + 세션에서 선택적으로 사용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>MyDb</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>ALLOW_SNAPSHOT_ISOLATION</span><span class=w> </span><span class=k>ON</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=n>SNAPSHOT</span><span class=p>;</span><span class=w>  </span><span class=c1>-- 세션에서 선택
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>BEGIN</span><span class=w> </span><span class=n>TRAN</span><span class=p>;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Sales</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=p>...;</span><span class=w> </span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h6 id=oracle일관성-읽기oracle-sql>Oracle(일관성 읽기)—Oracle SQL<a hidden class=anchor aria-hidden=true href=#oracle일관성-읽기oracle-sql>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3>3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4>4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5>5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6>6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7>7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- Oracle은 기본 RC 일관성: 각 쿼리는 SCN 시점의 커밋 데이터만 읽음(Dirty 불가)
</span></span></span><span class=line><span class=cl><span class=c1>-- 갱신 충돌이 우려되는 행은 FOR UPDATE로 명시 잠금
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=p>:</span><span class=n>b</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>id</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>UPDATE</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=p>:</span><span class=n>amt</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>/</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=분류-기준에-따른-유형-구분표>분류 기준에 따른 유형 구분표<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분표>#</a></h4><ul><li><strong>표준 레벨 분류</strong>는 시작점이고, 실제 적용은 <strong>엔진 구현 차</strong>와 <strong>업무 요구</strong>를 함께 본다.</li><li><strong>읽기 많은 구간</strong>은 스냅샷 기반으로 비차단화, <strong>규칙 핵심 구간</strong>은 RR+ 범위락 또는 Serializable/SSI 로 국소 강화.</li><li><strong>DBMS 별 동작 차이</strong>(InnoDB Next-Key, PG-SSI, MSSQL RCSI/SNAPSHOT, Oracle Consistent Read) 를 설계·테스트에 반영한다.</li></ul><h5 id=ansiiso-표준-현상-허용차단>ANSI/ISO 표준 (현상 허용/차단)<a hidden class=anchor aria-hidden=true href=#ansiiso-표준-현상-허용차단>#</a></h5><table><thead><tr><th>격리 수준</th><th>Dirty Read</th><th>Non-repeatable Read</th><th>Phantom Read</th><th>개요</th></tr></thead><tbody><tr><td>Read Uncommitted (RU)</td><td>발생</td><td>발생</td><td>발생</td><td>최저 격리, 성능 최상이나 오염 위험 큼</td></tr><tr><td>Read Committed (RC)</td><td>없음</td><td>발생</td><td>발생</td><td>커밋된 것만 읽음, OLTP 기본값 다수</td></tr><tr><td>Repeatable Read (RR)</td><td>없음</td><td>없음</td><td><strong>표준상 발생</strong></td><td>동일 행 재조회 일관, 팬텀은 표준상 미보장</td></tr><tr><td>Serializable</td><td>없음</td><td>없음</td><td>없음</td><td>직렬 실행과 동등, 가장 엄격 (비용↑)</td></tr></tbody></table><h5 id=dbms-구현-차이-표준-대비-주의점>DBMS 구현 차이 (표준 대비 주의점)<a hidden class=anchor aria-hidden=true href=#dbms-구현-차이-표준-대비-주의점>#</a></h5><table><thead><tr><th>DBMS</th><th>기본 격리</th><th>스냅샷 계열</th><th>팬텀 처리/특징</th><th>메모</th></tr></thead><tbody><tr><td><strong>MySQL InnoDB</strong></td><td>RR</td><td>(엔진 자체 MVCC)</td><td><strong>RR 에서도 Next-Key/GAP</strong>로 범위 삽입 차단 (팬텀 억제)</td><td>인덱스 기반 범위가 핵심</td></tr><tr><td><strong>PostgreSQL</strong></td><td>RC</td><td>RR(트랜잭션 스냅샷), <strong>Serializable=SSI</strong></td><td>팬텀/Write Skew 는 **Serializable(SSI)** 에서 감지·차단</td><td>RR 에서는 Write Skew 가능</td></tr><tr><td><strong>SQL Server</strong></td><td>RC</td><td><strong>RCSI(문장 스냅샷)</strong>, <strong>SNAPSHOT(트랜잭션 스냅샷)</strong></td><td>RCSI 는 재조회 변동 가능, SNAPSHOT 은 트랜잭션 동안 고정 스냅샷</td><td>버전 스토어 관리 필요</td></tr><tr><td><strong>Oracle</strong></td><td>RC</td><td>Consistent Read(MVCC)</td><td>Dirty Read 없음, 일관성 읽기 강함</td><td>Undo/Read Consistency 기반</td></tr></tbody></table><h5 id=구현-방식별-분류>구현 방식별 분류<a hidden class=anchor aria-hidden=true href=#구현-방식별-분류>#</a></h5><table><thead><tr><th>구현 방식</th><th>장점</th><th>단점</th><th>비고 (적합 맥락)</th></tr></thead><tbody><tr><td><strong>2PL(락 기반)</strong></td><td>직관적·강한 일관성, 직렬화 근사</td><td>데드락/대기 증가</td><td>범위락·프리디킷 락으로 팬텀 제어</td></tr><tr><td><strong>MVCC(Snapshot)</strong></td><td>읽기 비차단, 처리량↑</td><td>버전 저장·청소 비용, Write Skew</td><td>RCSI/SNAPSHOT/PG-RR 등</td></tr><tr><td><strong>하이브리드</strong></td><td>상황별 최적 조합</td><td>복잡성↑</td><td>대부분의 상용 엔진이 채택</td></tr></tbody></table><h5 id=비즈니스-요구별-권장-격리>비즈니스 요구별 권장 격리<a hidden class=anchor aria-hidden=true href=#비즈니스-요구별-권장-격리>#</a></h5><table><thead><tr><th>도메인/요구</th><th>권장 격리/전략</th><th>이유</th><th>주의점</th></tr></thead><tbody><tr><td><strong>금융/결제</strong></td><td>Serializable/SSI(핵심 구간 짧게)</td><td>금액/원장 불변 보장</td><td>재시도 전제, 짧은 Tx 유지</td></tr><tr><td><strong>전자상거래 (재고)</strong></td><td>RR+ 범위락 또는 구간별 Serializable</td><td>오버셀/팬텀 방지</td><td>인덱스·범위 잠금 범위 관리</td></tr><tr><td><strong>일반 OLTP</strong></td><td>RC 또는 RCSI</td><td>지연·경합 완화</td><td>버전 스토어/긴 Tx 모니터</td></tr><tr><td><strong>리포팅/분석</strong></td><td>Snapshot/읽기 복제본</td><td>일관 스냅샷, 대량 읽기</td><td>RU 지양, 스냅샷 주기 관리</td></tr></tbody></table><ul><li>분류의 축은 <strong>표준 레벨</strong>, <strong>구현 방식</strong>, <strong>DBMS 차이</strong>, <strong>비즈니스 요구</strong> 네 가지다.</li><li>표준 표는 출발점일 뿐이고, 실제 결과는 <strong>엔진 고유의 팬텀 처리·스냅샷 범위</strong>에 좌우된다.</li><li>실무에선 <strong>읽기 구간=스냅샷</strong>, <strong>핵심 규칙 구간=RR+ 범위락 또는 Serializable/SSI</strong>로 <strong>구간화</strong>하는 전략이 성능·정합성을 함께 만족시킨다.</li></ul><h5 id=isolation-level-별-최적-사용-시나리오>Isolation Level 별 최적 사용 시나리오<a hidden class=anchor aria-hidden=true href=#isolation-level-별-최적-사용-시나리오>#</a></h5><table><thead><tr><th>Isolation Level (격리 수준)</th><th>특징</th><th>방지 가능한 현상</th><th>성능</th><th>대표 적용 분야 예시</th><th>트레이드오프</th></tr></thead><tbody><tr><td><strong>Read Uncommitted (미커밋 읽기)</strong></td><td>가장 낮은 격리, 커밋되지 않은 데이터도 읽을 수 있음</td><td>없음</td><td>매우 빠름</td><td>로그 분석, 실시간 모니터링, 대시보드</td><td>Dirty Read 발생 가능, 데이터 무결성 낮음</td></tr><tr><td><strong>Read Committed (커밋 읽기)</strong></td><td>커밋된 데이터만 읽음, 대부분 상용 DBMS 의 기본</td><td>Dirty Read</td><td>보통</td><td>쇼핑몰 주문, 재고조회, 실시간 API</td><td>Non-repeatable Read, Phantom Read 발생 가능</td></tr><tr><td><strong>Repeatable Read (반복 가능 읽기)</strong></td><td>트랜잭션 중 읽은 행은 동일하게 유지</td><td>Dirty Read, Non-repeatable Read</td><td>중간~낮음</td><td>금융 결제, 재고 차감, 예약 시스템</td><td>Phantom Read 발생 가능</td></tr><tr><td><strong>Serializable (직렬화)</strong></td><td>가장 높은 격리, 순차 실행과 동일한 결과 보장</td><td>Dirty Read, Non-repeatable Read, Phantom Read</td><td>가장 낮음</td><td>은행 계좌이체, 결제 승인, 세금 계산</td><td>성능 저하, 데드락 가능성 증가</td></tr></tbody></table><h4 id=도구-및-프레임워크-생태계>도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#도구-및-프레임워크-생태계>#</a></h4><p>실무에서 트랜잭션 격리는 <strong>엔진 설정 (RDBMS)</strong>, <strong>코드 계층 (ORM/프레임워크)</strong>, <strong>관측·검증 도구 (APM/벤치마크)</strong>, <strong>분산·확장 컴포넌트</strong>가 함께 움직여야 원하는 일관성과 성능을 얻을 수 있다.</p><ul><li>코어 엔진은 **격리 수준 의미와 구현 차이 (MVCC/락/SSI/RCSI)**를 결정하고,</li><li>ORM/프레임워크는 <strong>트랜잭션 경계/격리·락 힌트</strong>를 코드에서 선언적으로 제어하며,</li><li>모니터링/벤치마크는 <strong>락 대기·Abort·버전 저장소 사용량</strong>을 수치로 보여준다.</li><li>분산·확장/NoSQL 계층은 <strong>스냅샷 기반 읽기·샤딩/복제·CDC</strong> 등과 결합해 전체 아키텍처의 일관성 전략을 완성한다.</li></ul><table><thead><tr><th>카테고리</th><th>도구/제품</th><th>역할</th><th>격리 관련 핵심</th><th>대표 명령/API 예시</th><th>비고</th></tr></thead><tbody><tr><td>RDBMS 코어</td><td>PostgreSQL</td><td>MVCC, SSI(Serializable)</td><td>RC/RR/SR 지원 (※ RU 미지원), RR=스냅샷 기반</td><td>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;</td><td>pg_locks, pg_stat_activity, pg_stat_statements 활용</td></tr><tr><td></td><td>MySQL(InnoDB/MariaDB)</td><td>MVCC+ 락 하이브리드</td><td>RU/RC/RR/SR, Next-Key/GAP Lock 으로 팬텀 방지</td><td>SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</td><td>Performance Schema/sys, Percona Toolkit</td></tr><tr><td></td><td>SQL Server</td><td>RCSI/Snapshot + 2PL</td><td>RU/RC/RR/SR + RCSI/SI(행 버전)</td><td>ALTER DB SET READ_COMMITTED_SNAPSHOT ON;</td><td>DMVs(sys.dm_tran_locks…), Extended Events</td></tr><tr><td></td><td>Oracle</td><td>Read Consistency, Flashback</td><td>RC/SR/Read Only(비표준 RR·RU), 강한 일관성</td><td>SET TRANSACTION READ ONLY;</td><td>AWR/ASH, Flashback Query</td></tr><tr><td>ORM/프레임워크</td><td>Spring Tx</td><td>선언적 트랜잭션 경계</td><td>@Transactional(isolation=…)</td><td>@Transactional(isolation=Isolation.SERIALIZABLE)</td><td>전역/메서드 단위 정책화</td></tr><tr><td></td><td>Hibernate/JPA</td><td>잠금/버전 제어</td><td>낙관/비관적 락, LockMode</td><td>query.setLockMode(PESSIMISTIC_WRITE)</td><td>@Version 필드로 OCC</td></tr><tr><td></td><td>Sequelize/TypeORM</td><td>Node.js ORM</td><td>트랜잭션/격리 수준 옵션</td><td>sequelize.transaction({ isolationLevel: … })</td><td>TypeORM: manager.transaction(…, { isolation: … })</td></tr><tr><td></td><td>Django ORM</td><td>Python ORM</td><td>DB 의존적 격리 설정</td><td>with transaction.atomic(): (사전 SET 필요)</td><td>DB 별 SET…로 조합</td></tr><tr><td>모니터링·APM</td><td>PostgreSQL 내장</td><td>세션/락/쿼리 관측</td><td>pg_stat_activity/pg_locks</td><td>EXPLAIN(ANALYZE, BUFFERS)</td><td>병목 원인 추적</td></tr><tr><td></td><td>MySQL 내장</td><td>락/대기/쿼리 관측</td><td>Performance Schema/sys</td><td>sys.schema_lock_waits</td><td>Percona PMM 연동 용이</td></tr><tr><td></td><td>SQL Server 내장</td><td>락/대기/Wait Stats</td><td>DMVs/Extended Events</td><td>sys.dm_os_wait_stats</td><td>SSMS/Profiler</td></tr><tr><td></td><td>Oracle 내장</td><td>성능 리포팅</td><td>AWR/ASH</td><td>awrrpt.sql</td><td>EM(Enterprise Manager)</td></tr><tr><td></td><td>OpenTelemetry</td><td>분산 추적</td><td>Trace/Span 으로 Tx 흐름 추적</td><td>OTEL SDK/Collectors</td><td>멀티서비스 상관관계</td></tr><tr><td>테스트·검증</td><td>pgbench</td><td>PG 부하/Tx 벤치</td><td>격리 변경별 TPS/지연 측정</td><td>pgbench -M prepared …</td><td>표준 TPC-B 유사</td></tr><tr><td></td><td>sysbench</td><td>MySQL/PG/Rocks 등</td><td>읽기/쓰기 혼합/IO 부하</td><td>sysbench oltp_read_write …</td><td>스크립트 확장</td></tr><tr><td></td><td>HammerDB</td><td>멀티 DB 벤치</td><td>TPC-C/H 시나리오</td><td>GUI/CLI 혼합</td><td>대규모 시뮬</td></tr><tr><td></td><td>Jepsen/Elle</td><td>격리 위반 검증</td><td>Write-skew/팬텀 탐지</td><td>시나리오 기반 테스트</td><td>분산/일관성 검증</td></tr><tr><td>확장/분산/NoSQL</td><td>Citus/TimescaleDB</td><td>확장/시계열</td><td>파티셔닝·리밸런싱</td><td>CREATE DISTRIBUTED TABLE …</td><td>PG 확장</td></tr><tr><td></td><td>Percona Toolkit</td><td>진단/튜닝</td><td>락 경합·쿼리 분석</td><td>pt-deadlock-logger 등</td><td>MySQL 중심</td></tr><tr><td></td><td>MongoDB</td><td>트랜잭션 + snapshot</td><td>readConcern:&ldquo;snapshot&rdquo;</td><td>session.withTransaction(…, { readConcern… })</td><td>majority writeConcern</td></tr></tbody></table><ul><li><strong>핵심 축은 4 개</strong>: 코어 엔진 (격리 구현) ↔ ORM/프레임워크 (선언적 제어) ↔ 모니터링/벤치 (관측·검증) ↔ 확장/NoSQL(분산·스냅샷).</li><li><strong>DBMS 별 격리 지원이 다르다</strong>: PostgreSQL(RU 미지원/SSI), MySQL(InnoDB Next-Key), SQL Server(RCSI/Snapshot), Oracle(RC/SR/Read Only).</li><li><strong>실무 포인트</strong>: 코드에서 격리·락을 명시하고, 관측 (락 대기·Abort·버전 저장소) 을 상시 확인하며, 확장 계층 (Citus·복제·샤딩·readConcern) 과 함께 전반적인 일관성 전략을 완성하는 게 핵심이다.</li></ul><h4 id=표준-및-규격-준수사항>표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#표준-및-규격-준수사항>#</a></h4><p>트랜잭션 격리는 <strong>ANSI/ISO SQL-92</strong>의 4 단계 격리 수준과 세 가지 동시성 현상 (Dirty/Non-repeatable/Phantom) 금지 여부로 정의된다.<br>표준은 <strong>문법 (SET/START/COMMIT/ROLLBACK)</strong> 을 제시하며, 각 DBMS 는 <strong>MVCC·2PL·SSI·RCSI</strong> 등 내부 구현과 <strong>Snapshot Isolation</strong> 같은 확장을 통해 표준 이상을 제공할 수 있다.</p><p>엔터프라이즈 환경에서는 <strong>ACID 준수</strong>, <strong>감사/보안 규격 (PCI DSS, SOX, GDPR)</strong>, <strong>SLA·RTO/RPO</strong>와의 정합을 함께 점검해야 한다.</p><table><thead><tr><th>구분</th><th>표준/규격</th><th>핵심 요구 사항</th><th>최소 준수 (필수)</th><th>권장 확장/주의</th><th>검증 방법/체크리스트</th></tr></thead><tbody><tr><td>격리 수준 정의</td><td>ANSI/ISO SQL-92 (ISO/IEC 9075:1992)</td><td>RU/RC/RR/Serializable 4 단계, 현상 (P1/P2/P3) 기반 정의</td><td>서비스별 기본 격리 수준 명시</td><td>Snapshot Isolation/RCSI 등 확장 사용 시 문서화</td><td>격리 수준 매핑표, 회귀/동시성 테스트</td></tr><tr><td>동시성 현상</td><td>Dirty/Non-repeatable/Phantom</td><td>각 수준에서 허용/금지되는 현상 준수</td><td>표준 최소 보장 준수</td><td>Dirty Write 금지 관례 반영, Write-skew 테스트</td><td>Jepsen/Elle/벤치 스크립트</td></tr><tr><td>트랜잭션 문법</td><td>SET/START/COMMIT/ROLLBACK</td><td>표준 문법 사용</td><td><code>SET TRANSACTION</code>/<code>START TRANSACTION</code>/<code>COMMIT</code>/<code>ROLLBACK</code></td><td><code>BEGIN</code> 등 벤더 확장 사용 시 가이드화</td><td>코드 스캐닝, SQL 린트</td></tr><tr><td>구현 독립성</td><td>JDBC/ODBC 등</td><td>API 레벨 일관된 동작</td><td>드라이버별 기본 격리 확인</td><td>세션/트랜잭션 스코프 정책 문서화</td><td>통합 테스트 (드라이버 매트릭스)</td></tr><tr><td>확장 구현</td><td>MVCC/2PL/SSI/RCSI</td><td>표준 이상 보장 허용</td><td>표준 의미 위배 금지</td><td>SI/RCSI 도입 시 재시도·멱등성 설계</td><td>장애주입·Abort 율 모니터링</td></tr><tr><td>ACID 준수</td><td>Atomicity/Consistency/Isolation/Durability</td><td>4 요소 충족</td><td>COMMIT/ROLLBACK, 제약조건, WAL/REDO</td><td>대규모 배치/장수 Tx 가이드</td><td>롤백·복구·무결성 테스트</td></tr><tr><td>보안·컴플라이언스</td><td>PCI DSS/SOX/GDPR</td><td>감사·접근통제·데이터 보호</td><td>최소 격리·감사 추적</td><td>마스킹/암호화, 최소권한</td><td>감사지표, 로그 유지정책</td></tr><tr><td>운영 SLO</td><td>SLA/RTO/RPO/가용성</td><td>성능·복구 목표 충족</td><td>격리 수준과 SLO 정합성</td><td>멀티 AZ/복제·백업 전략</td><td>성능 벤치/복구 드릴</td></tr></tbody></table><p>핵심은 <strong>표준의 최소 보장</strong>을 준수하면서, 워크로드와 규제 요구에 맞춰 ** 확장 구현 (SI/RCSI 등)** 을 선택·문서화하는 것이다. 표준 문법을 기본으로 하고 벤더 확장은 가이드로 관리하라. 운영에서는 <strong>동시성 테스트·감사 추적·SLO 검증</strong>을 정례화해 표준 준수와 실무 안정성을 동시에 확보해야 한다.</p><h3 id=실무-적용-practical-application>실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#실무-적용-practical-application>#</a></h3><h4 id=실제-도입-사례>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례>#</a></h4><table><thead><tr><th>도메인</th><th>주 저장소/구성</th><th>주 격리 전략</th><th>선택 이유</th><th>보완 기술</th><th>참고</th></tr></thead><tbody><tr><td>전자상거래</td><td>MySQL(InnoDB), PostgreSQL, 캐시/리플리카</td><td>RC/RCSI(조회), RR(+ 범위락), SR/SSI(결제·재고)</td><td>조회 성능과 핵심 경로 정합성의 분리</td><td>읽기 복제본, Outbox+CDC</td><td>MySQL RR+Next-Key, SQL Server RCSI, PG SSI</td></tr><tr><td>모빌리티</td><td>Cassandra(위치/피드), MySQL(OLTP)</td><td>RC/RCSI/SI(실시간 조회), SR(정산)</td><td>지연 최소화 + 금전 정합성</td><td>멱등키·재시도, 샤딩</td><td>Uber 스택/실시간 분석</td></tr><tr><td>결제/정산</td><td>PostgreSQL/SQL Server, DynamoDB(부가)</td><td>SR/SSI 또는 RR+ 범위락, DynamoDB Tx(SR)</td><td>원장·계좌 일관성</td><td>리포팅 리플리카, 배치 윈도 동결</td><td>DynamoDB Tx SR, PG SSI</td></tr></tbody></table><h4 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h4><h5 id=실습-예제-격리-수준별-이상-현상-관찰-및-완화>실습 예제: 격리 수준별 이상 현상 관찰 및 완화<a hidden class=anchor aria-hidden=true href=#실습-예제-격리-수준별-이상-현상-관찰-및-완화>#</a></h5><p><strong>시나리오</strong>: 두 세션이 같은 조건을 읽고, 한 세션이 삽입/갱신하여 <strong>Non‑repeatable/Phantom</strong>을 유발</p><p><strong>시스템 구성</strong>:</p><ul><li>PostgreSQL 16 / MySQL 8.0 / SQL Server 중 택 1</li><li>Python(psycopg2/pymysql/pyodbc) 또는 Node.js(knex)</li></ul><p><strong>시스템 구성 다이어그램</strong></p><pre class=mermaid>graph TB
  A[Client Session T1] --&gt; D[(DB)]
  B[Client Session T2] --&gt; D
  D --&gt; M[Metrics: locks/version store]
</pre><p><strong>Workflow</strong></p><ol><li>T1: 트랜잭션 시작·읽기</li><li>T2: 삽입/갱신·커밋</li><li>T1: 동일 쿼리 재실행 → 차이 관찰 (RC/RR/Serializable 비교)</li></ol><p><strong>핵심 역할</strong></p><ul><li>격리 수준이 <strong>읽기 일관성</strong>과 <strong>동시성</strong>에 미치는 영향 실증</li></ul><p><strong>유무 차이</strong></p><ul><li>도입 전 (RC): 팬텀/Non‑repeatable 발생 가능</li><li>도입 후 (Serializable 또는 RR+ 범위락/RCSI): 현상 억제</li></ul><p><strong>구현 예시–PostgreSQL (Python)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27>27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28>28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29>29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30>30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31>31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32>32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33>33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34>34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35>35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># pip install psycopg2-binary</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span><span class=o>,</span> <span class=nn>threading</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DDL</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>create table if not exists items(id serial primary key, price int, cat int);
</span></span></span><span class=line><span class=cl><span class=s2>truncate items;
</span></span></span><span class=line><span class=cl><span class=s2>insert into items(price, cat) values (100, 1), (150, 1), (200, 2);
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>session_read</span><span class=p>(</span><span class=n>level</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    격리 수준 효과 관찰: 같은 WHERE 조건을 두 번 읽어 행 수/합계가 변하는지 확인
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=demo user=postgres password=postgres host=127.0.0.1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>DDL</span><span class=p>);</span> <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;begin isolation level </span><span class=si>{</span><span class=n>level</span><span class=si>}</span><span class=s2>;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;select count(*), sum(price) from items where cat=1;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>before</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># T2 작업 대기</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;select count(*), sum(price) from items where cat=1;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>after</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;commit;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>level</span><span class=p>,</span> <span class=s2>&#34;before/after:&#34;</span><span class=p>,</span> <span class=n>before</span><span class=p>,</span> <span class=n>after</span><span class=p>)</span>  <span class=c1># Non-repeatable/Phantom 여부 확인</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>session_write</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=demo user=postgres password=postgres host=127.0.0.1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;begin; insert into items(price, cat) values(120, 1); commit;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행: Read Committed vs Repeatable Read vs Serializable</span>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>session_read</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=s2>&#34;read committed&#34;</span><span class=p>,))</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>session_write</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>관련성 주석</strong>: <code>isolation level …</code> 이 바로 주제 핵심 (레벨별 결과 차이 관찰). PG 기본 RC, RR/Serializable 은 MVCC/SSI 기반. ([PostgreSQL][1])</li></ul><p><strong>구현 예시–MySQL (Python, 갭락 관찰)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26>26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27>27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28>28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29>29</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># pip install pymysql</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pymysql</span><span class=o>,</span> <span class=nn>threading</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>reader</span><span class=p>(</span><span class=n>level</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>pymysql</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span> <span class=n>user</span><span class=o>=</span><span class=s2>&#34;root&#34;</span><span class=p>,</span> <span class=n>password</span><span class=o>=</span><span class=s2>&#34;root&#34;</span><span class=p>,</span> <span class=n>database</span><span class=o>=</span><span class=s2>&#34;demo&#34;</span><span class=p>,</span> <span class=n>autocommit</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;create table if not exists items(id int primary key auto_increment, price int, cat int, key(cat));&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;truncate items;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;insert into items(price, cat) values (100,1),(150,1),(200,2);&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;set session transaction isolation level </span><span class=si>{</span><span class=n>level</span><span class=si>}</span><span class=s2>; start transaction;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;select count(*) from items where cat between 1 and 1;&#34;</span><span class=p>)</span>  <span class=c1># 인덱스 범위 스캔</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;reader first:&#34;</span><span class=p>,</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;select count(*) from items where cat between 1 and 1;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;reader second:&#34;</span><span class=p>,</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>();</span> <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>writer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>pymysql</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span> <span class=n>user</span><span class=o>=</span><span class=s2>&#34;root&#34;</span><span class=p>,</span> <span class=n>password</span><span class=o>=</span><span class=s2>&#34;root&#34;</span><span class=p>,</span> <span class=n>database</span><span class=o>=</span><span class=s2>&#34;demo&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;insert into items(price, cat) values (120,1);&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>();</span> <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RR에서 next-key/gap lock으로 삽입 대기/차단 → 팬텀 방지</span>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>reader</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=s2>&#34;repeatable read&#34;</span><span class=p>,))</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>writer</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>관련성 주석</strong>: InnoDB RR 은 <strong>Next‑Key/GAP Lock</strong>으로 팬텀 방지. ([dev.mysql.com][2])</li></ul><h5 id=실습-예제-각-격리-수준의-적용-방식과-현상-체험>실습 예제: 각 격리 수준의 적용 방식과 현상 체험<a hidden class=anchor aria-hidden=true href=#실습-예제-각-격리-수준의-적용-방식과-현상-체험>#</a></h5><p><strong>시나리오</strong>: 두 개 트랜잭션이 같은 데이터를 동시 읽기/쓰기<br><strong>시스템 구성</strong>:</p><ul><li>Application Layer</li><li>Database</li><li>Lock 관리</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    User1[트랜잭션 A] --&gt; DB[(Database)]
    User2[트랜잭션 B] --&gt; DB
    DB --&gt; LockManager[Lock Manager]
</pre><p><strong>Workflow</strong>:</p><ol><li>트랜잭션 A: 데이터 읽기</li><li>트랜잭션 B: 데이터 갱신 (commit 전 상태)</li><li>트랜잭션 A: 재조회하여 값 비교</li></ol><p><strong>핵심 역할</strong>: 트랜잭션 간 데이터 불일치 체험</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 데이터 손상, Dirty Read</li><li>도입 후: 원하는 현상 관리 가능</li></ul><p><strong>구현 예시 (Python, 주석 포함):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sqlite3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># DB 연결 및 격리 수준 지정</span>
</span></span><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;:memory:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>isolation_level</span> <span class=o>=</span> <span class=s2>&#34;DEFERRED&#34;</span>  <span class=c1># 실제 DB 엔진별 격리 수준 매핑 필요</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_isolation</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    격리 수준에 따른 트랜잭션 동작 예시
</span></span></span><span class=line><span class=cl><span class=s2>    - Dirty Read 발생 여부 체크
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># 트랜잭션A: 데이터 읽기</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT balance FROM accounts WHERE account_id = 1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=c1># 트랜잭션B: 데이터 변경 후 미커밋</span>
</span></span><span class=line><span class=cl>    <span class=c1># … (다른 커넥션에서 실행)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=실습-예제-isolation-level-에-따른-동시성-문제-관찰>실습 예제: Isolation Level 에 따른 동시성 문제 관찰<a hidden class=anchor aria-hidden=true href=#실습-예제-isolation-level-에-따른-동시성-문제-관찰>#</a></h5><p><strong>시나리오</strong>: 두 트랜잭션이 동일 데이터를 동시에 갱신/조회<br><strong>시스템 구성</strong>:</p><ul><li>PostgreSQL DB</li><li>Python psycopg2 클라이언트</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run_transaction</span><span class=p>(</span><span class=n>level</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=test user=postgres&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>set_session</span><span class=p>(</span><span class=n>isolation_level</span><span class=o>=</span><span class=n>level</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT balance FROM accounts WHERE id=1;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행 예: run_transaction(&#39;SERIALIZABLE&#39;)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=실제-도입-사례의-코드-구현>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현>#</a></h4><h5 id=사례-네이버페이-간편결제-서비스의-포인트-적립차감-시스템>사례: 네이버페이 간편결제 서비스의 포인트 적립/차감 시스템<a hidden class=anchor aria-hidden=true href=#사례-네이버페이-간편결제-서비스의-포인트-적립차감-시스템>#</a></h5><p><strong>사례 선정</strong>: 네이버페이 간편결제 서비스의 포인트 적립/차감 시스템</p><p><strong>비즈니스 배경</strong>:</p><ul><li>초당 수만 건의 동시 결제 요청 처리</li><li>포인트 잔액의 완벽한 일관성 보장 필요</li><li>99.99% 가용성과 100ms 이하 응답 시간 요구</li></ul><p><strong>기술적 요구사항</strong>:</p><ul><li>동시성 제어를 통한 포인트 중복 사용 방지</li><li>결제 실패 시 자동 포인트 복구</li><li>실시간 포인트 잔액 조회 성능 최적화</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>애플리케이션 서버: Spring Boot + JPA</li><li>주 데이터베이스: MySQL 8.0 (InnoDB)</li><li>캐시: Redis Cluster</li><li>메시징: Apache Kafka</li><li>모니터링: Prometheus + Grafana</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Frontend Layer&#34;
        A1[모바일 앱]
        A2[웹 브라우저]
        A3[파트너 API]
    end
    
    subgraph &#34;API Gateway&#34;
        B1[Load Balancer]
        B2[Rate Limiter]
        B3[Authentication]
    end
    
    subgraph &#34;Application Layer&#34;
        C1[Payment Service]
        C2[Point Service]
        C3[Notification Service]
    end
    
    subgraph &#34;Data Layer&#34;
        D1[MySQL Primary]
        D2[MySQL Replica]
        D3[Redis Cluster]
    end
    
    subgraph &#34;Message Queue&#34;
        E1[Kafka Cluster]
        E2[Point Event Topic]
        E3[Payment Event Topic]
    end
    
    A1 --&gt; B1
    A2 --&gt; B1
    A3 --&gt; B1
    
    B1 --&gt; B2
    B2 --&gt; B3
    B3 --&gt; C1
    
    C1 --&gt; C2
    C1 --&gt; D1
    C2 --&gt; D1
    C2 --&gt; D3
    
    C1 --&gt; E1
    C2 --&gt; E1
    E1 --&gt; C3
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자 결제 요청 수신</li><li>포인트 잔액 확인 (Read Committed + Redis 캐시)</li><li>결제 승인 처리 (Repeatable Read)</li><li>포인트 차감 실행 (Serializable)</li><li>결제 완료 처리</li><li>이벤트 발행 및 알림 발송</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Redis 캐시: 빠른 포인트 잔액 조회</li><li>Read Committed: 일반적인 데이터 읽기</li><li>Repeatable Read: 결제 승인 과정의 일관성</li><li>Serializable: 포인트 차감의 원자성 보장</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 동시 결제 시 포인트 중복 사용 발생, 고객 불만과 수동 정정 작업 증가, 운영 비용 상승</li><li><strong>도입 후</strong>: 포인트 일관성 100% 보장, 고객 신뢰도 증가, 자동화된 오류 처리로 운영 효율성 대폭 향상</li></ul><p><strong>구현 예시</strong> (Java + Spring Boot):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>  1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>  2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>  3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>  4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>  5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>  6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>  7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8>  8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9>  9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10> 10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11> 11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12> 12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13> 13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14> 14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15> 15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16> 16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17> 17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18> 18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19> 19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20> 20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21> 21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22> 22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23> 23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24> 24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25> 25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26> 26</a>
</span><span class=lnt id=hl-19-27><a class=lnlinks href=#hl-19-27> 27</a>
</span><span class=lnt id=hl-19-28><a class=lnlinks href=#hl-19-28> 28</a>
</span><span class=lnt id=hl-19-29><a class=lnlinks href=#hl-19-29> 29</a>
</span><span class=lnt id=hl-19-30><a class=lnlinks href=#hl-19-30> 30</a>
</span><span class=lnt id=hl-19-31><a class=lnlinks href=#hl-19-31> 31</a>
</span><span class=lnt id=hl-19-32><a class=lnlinks href=#hl-19-32> 32</a>
</span><span class=lnt id=hl-19-33><a class=lnlinks href=#hl-19-33> 33</a>
</span><span class=lnt id=hl-19-34><a class=lnlinks href=#hl-19-34> 34</a>
</span><span class=lnt id=hl-19-35><a class=lnlinks href=#hl-19-35> 35</a>
</span><span class=lnt id=hl-19-36><a class=lnlinks href=#hl-19-36> 36</a>
</span><span class=lnt id=hl-19-37><a class=lnlinks href=#hl-19-37> 37</a>
</span><span class=lnt id=hl-19-38><a class=lnlinks href=#hl-19-38> 38</a>
</span><span class=lnt id=hl-19-39><a class=lnlinks href=#hl-19-39> 39</a>
</span><span class=lnt id=hl-19-40><a class=lnlinks href=#hl-19-40> 40</a>
</span><span class=lnt id=hl-19-41><a class=lnlinks href=#hl-19-41> 41</a>
</span><span class=lnt id=hl-19-42><a class=lnlinks href=#hl-19-42> 42</a>
</span><span class=lnt id=hl-19-43><a class=lnlinks href=#hl-19-43> 43</a>
</span><span class=lnt id=hl-19-44><a class=lnlinks href=#hl-19-44> 44</a>
</span><span class=lnt id=hl-19-45><a class=lnlinks href=#hl-19-45> 45</a>
</span><span class=lnt id=hl-19-46><a class=lnlinks href=#hl-19-46> 46</a>
</span><span class=lnt id=hl-19-47><a class=lnlinks href=#hl-19-47> 47</a>
</span><span class=lnt id=hl-19-48><a class=lnlinks href=#hl-19-48> 48</a>
</span><span class=lnt id=hl-19-49><a class=lnlinks href=#hl-19-49> 49</a>
</span><span class=lnt id=hl-19-50><a class=lnlinks href=#hl-19-50> 50</a>
</span><span class=lnt id=hl-19-51><a class=lnlinks href=#hl-19-51> 51</a>
</span><span class=lnt id=hl-19-52><a class=lnlinks href=#hl-19-52> 52</a>
</span><span class=lnt id=hl-19-53><a class=lnlinks href=#hl-19-53> 53</a>
</span><span class=lnt id=hl-19-54><a class=lnlinks href=#hl-19-54> 54</a>
</span><span class=lnt id=hl-19-55><a class=lnlinks href=#hl-19-55> 55</a>
</span><span class=lnt id=hl-19-56><a class=lnlinks href=#hl-19-56> 56</a>
</span><span class=lnt id=hl-19-57><a class=lnlinks href=#hl-19-57> 57</a>
</span><span class=lnt id=hl-19-58><a class=lnlinks href=#hl-19-58> 58</a>
</span><span class=lnt id=hl-19-59><a class=lnlinks href=#hl-19-59> 59</a>
</span><span class=lnt id=hl-19-60><a class=lnlinks href=#hl-19-60> 60</a>
</span><span class=lnt id=hl-19-61><a class=lnlinks href=#hl-19-61> 61</a>
</span><span class=lnt id=hl-19-62><a class=lnlinks href=#hl-19-62> 62</a>
</span><span class=lnt id=hl-19-63><a class=lnlinks href=#hl-19-63> 63</a>
</span><span class=lnt id=hl-19-64><a class=lnlinks href=#hl-19-64> 64</a>
</span><span class=lnt id=hl-19-65><a class=lnlinks href=#hl-19-65> 65</a>
</span><span class=lnt id=hl-19-66><a class=lnlinks href=#hl-19-66> 66</a>
</span><span class=lnt id=hl-19-67><a class=lnlinks href=#hl-19-67> 67</a>
</span><span class=lnt id=hl-19-68><a class=lnlinks href=#hl-19-68> 68</a>
</span><span class=lnt id=hl-19-69><a class=lnlinks href=#hl-19-69> 69</a>
</span><span class=lnt id=hl-19-70><a class=lnlinks href=#hl-19-70> 70</a>
</span><span class=lnt id=hl-19-71><a class=lnlinks href=#hl-19-71> 71</a>
</span><span class=lnt id=hl-19-72><a class=lnlinks href=#hl-19-72> 72</a>
</span><span class=lnt id=hl-19-73><a class=lnlinks href=#hl-19-73> 73</a>
</span><span class=lnt id=hl-19-74><a class=lnlinks href=#hl-19-74> 74</a>
</span><span class=lnt id=hl-19-75><a class=lnlinks href=#hl-19-75> 75</a>
</span><span class=lnt id=hl-19-76><a class=lnlinks href=#hl-19-76> 76</a>
</span><span class=lnt id=hl-19-77><a class=lnlinks href=#hl-19-77> 77</a>
</span><span class=lnt id=hl-19-78><a class=lnlinks href=#hl-19-78> 78</a>
</span><span class=lnt id=hl-19-79><a class=lnlinks href=#hl-19-79> 79</a>
</span><span class=lnt id=hl-19-80><a class=lnlinks href=#hl-19-80> 80</a>
</span><span class=lnt id=hl-19-81><a class=lnlinks href=#hl-19-81> 81</a>
</span><span class=lnt id=hl-19-82><a class=lnlinks href=#hl-19-82> 82</a>
</span><span class=lnt id=hl-19-83><a class=lnlinks href=#hl-19-83> 83</a>
</span><span class=lnt id=hl-19-84><a class=lnlinks href=#hl-19-84> 84</a>
</span><span class=lnt id=hl-19-85><a class=lnlinks href=#hl-19-85> 85</a>
</span><span class=lnt id=hl-19-86><a class=lnlinks href=#hl-19-86> 86</a>
</span><span class=lnt id=hl-19-87><a class=lnlinks href=#hl-19-87> 87</a>
</span><span class=lnt id=hl-19-88><a class=lnlinks href=#hl-19-88> 88</a>
</span><span class=lnt id=hl-19-89><a class=lnlinks href=#hl-19-89> 89</a>
</span><span class=lnt id=hl-19-90><a class=lnlinks href=#hl-19-90> 90</a>
</span><span class=lnt id=hl-19-91><a class=lnlinks href=#hl-19-91> 91</a>
</span><span class=lnt id=hl-19-92><a class=lnlinks href=#hl-19-92> 92</a>
</span><span class=lnt id=hl-19-93><a class=lnlinks href=#hl-19-93> 93</a>
</span><span class=lnt id=hl-19-94><a class=lnlinks href=#hl-19-94> 94</a>
</span><span class=lnt id=hl-19-95><a class=lnlinks href=#hl-19-95> 95</a>
</span><span class=lnt id=hl-19-96><a class=lnlinks href=#hl-19-96> 96</a>
</span><span class=lnt id=hl-19-97><a class=lnlinks href=#hl-19-97> 97</a>
</span><span class=lnt id=hl-19-98><a class=lnlinks href=#hl-19-98> 98</a>
</span><span class=lnt id=hl-19-99><a class=lnlinks href=#hl-19-99> 99</a>
</span><span class=lnt id=hl-19-100><a class=lnlinks href=#hl-19-100>100</a>
</span><span class=lnt id=hl-19-101><a class=lnlinks href=#hl-19-101>101</a>
</span><span class=lnt id=hl-19-102><a class=lnlinks href=#hl-19-102>102</a>
</span><span class=lnt id=hl-19-103><a class=lnlinks href=#hl-19-103>103</a>
</span><span class=lnt id=hl-19-104><a class=lnlinks href=#hl-19-104>104</a>
</span><span class=lnt id=hl-19-105><a class=lnlinks href=#hl-19-105>105</a>
</span><span class=lnt id=hl-19-106><a class=lnlinks href=#hl-19-106>106</a>
</span><span class=lnt id=hl-19-107><a class=lnlinks href=#hl-19-107>107</a>
</span><span class=lnt id=hl-19-108><a class=lnlinks href=#hl-19-108>108</a>
</span><span class=lnt id=hl-19-109><a class=lnlinks href=#hl-19-109>109</a>
</span><span class=lnt id=hl-19-110><a class=lnlinks href=#hl-19-110>110</a>
</span><span class=lnt id=hl-19-111><a class=lnlinks href=#hl-19-111>111</a>
</span><span class=lnt id=hl-19-112><a class=lnlinks href=#hl-19-112>112</a>
</span><span class=lnt id=hl-19-113><a class=lnlinks href=#hl-19-113>113</a>
</span><span class=lnt id=hl-19-114><a class=lnlinks href=#hl-19-114>114</a>
</span><span class=lnt id=hl-19-115><a class=lnlinks href=#hl-19-115>115</a>
</span><span class=lnt id=hl-19-116><a class=lnlinks href=#hl-19-116>116</a>
</span><span class=lnt id=hl-19-117><a class=lnlinks href=#hl-19-117>117</a>
</span><span class=lnt id=hl-19-118><a class=lnlinks href=#hl-19-118>118</a>
</span><span class=lnt id=hl-19-119><a class=lnlinks href=#hl-19-119>119</a>
</span><span class=lnt id=hl-19-120><a class=lnlinks href=#hl-19-120>120</a>
</span><span class=lnt id=hl-19-121><a class=lnlinks href=#hl-19-121>121</a>
</span><span class=lnt id=hl-19-122><a class=lnlinks href=#hl-19-122>122</a>
</span><span class=lnt id=hl-19-123><a class=lnlinks href=#hl-19-123>123</a>
</span><span class=lnt id=hl-19-124><a class=lnlinks href=#hl-19-124>124</a>
</span><span class=lnt id=hl-19-125><a class=lnlinks href=#hl-19-125>125</a>
</span><span class=lnt id=hl-19-126><a class=lnlinks href=#hl-19-126>126</a>
</span><span class=lnt id=hl-19-127><a class=lnlinks href=#hl-19-127>127</a>
</span><span class=lnt id=hl-19-128><a class=lnlinks href=#hl-19-128>128</a>
</span><span class=lnt id=hl-19-129><a class=lnlinks href=#hl-19-129>129</a>
</span><span class=lnt id=hl-19-130><a class=lnlinks href=#hl-19-130>130</a>
</span><span class=lnt id=hl-19-131><a class=lnlinks href=#hl-19-131>131</a>
</span><span class=lnt id=hl-19-132><a class=lnlinks href=#hl-19-132>132</a>
</span><span class=lnt id=hl-19-133><a class=lnlinks href=#hl-19-133>133</a>
</span><span class=lnt id=hl-19-134><a class=lnlinks href=#hl-19-134>134</a>
</span><span class=lnt id=hl-19-135><a class=lnlinks href=#hl-19-135>135</a>
</span><span class=lnt id=hl-19-136><a class=lnlinks href=#hl-19-136>136</a>
</span><span class=lnt id=hl-19-137><a class=lnlinks href=#hl-19-137>137</a>
</span><span class=lnt id=hl-19-138><a class=lnlinks href=#hl-19-138>138</a>
</span><span class=lnt id=hl-19-139><a class=lnlinks href=#hl-19-139>139</a>
</span><span class=lnt id=hl-19-140><a class=lnlinks href=#hl-19-140>140</a>
</span><span class=lnt id=hl-19-141><a class=lnlinks href=#hl-19-141>141</a>
</span><span class=lnt id=hl-19-142><a class=lnlinks href=#hl-19-142>142</a>
</span><span class=lnt id=hl-19-143><a class=lnlinks href=#hl-19-143>143</a>
</span><span class=lnt id=hl-19-144><a class=lnlinks href=#hl-19-144>144</a>
</span><span class=lnt id=hl-19-145><a class=lnlinks href=#hl-19-145>145</a>
</span><span class=lnt id=hl-19-146><a class=lnlinks href=#hl-19-146>146</a>
</span><span class=lnt id=hl-19-147><a class=lnlinks href=#hl-19-147>147</a>
</span><span class=lnt id=hl-19-148><a class=lnlinks href=#hl-19-148>148</a>
</span><span class=lnt id=hl-19-149><a class=lnlinks href=#hl-19-149>149</a>
</span><span class=lnt id=hl-19-150><a class=lnlinks href=#hl-19-150>150</a>
</span><span class=lnt id=hl-19-151><a class=lnlinks href=#hl-19-151>151</a>
</span><span class=lnt id=hl-19-152><a class=lnlinks href=#hl-19-152>152</a>
</span><span class=lnt id=hl-19-153><a class=lnlinks href=#hl-19-153>153</a>
</span><span class=lnt id=hl-19-154><a class=lnlinks href=#hl-19-154>154</a>
</span><span class=lnt id=hl-19-155><a class=lnlinks href=#hl-19-155>155</a>
</span><span class=lnt id=hl-19-156><a class=lnlinks href=#hl-19-156>156</a>
</span><span class=lnt id=hl-19-157><a class=lnlinks href=#hl-19-157>157</a>
</span><span class=lnt id=hl-19-158><a class=lnlinks href=#hl-19-158>158</a>
</span><span class=lnt id=hl-19-159><a class=lnlinks href=#hl-19-159>159</a>
</span><span class=lnt id=hl-19-160><a class=lnlinks href=#hl-19-160>160</a>
</span><span class=lnt id=hl-19-161><a class=lnlinks href=#hl-19-161>161</a>
</span><span class=lnt id=hl-19-162><a class=lnlinks href=#hl-19-162>162</a>
</span><span class=lnt id=hl-19-163><a class=lnlinks href=#hl-19-163>163</a>
</span><span class=lnt id=hl-19-164><a class=lnlinks href=#hl-19-164>164</a>
</span><span class=lnt id=hl-19-165><a class=lnlinks href=#hl-19-165>165</a>
</span><span class=lnt id=hl-19-166><a class=lnlinks href=#hl-19-166>166</a>
</span><span class=lnt id=hl-19-167><a class=lnlinks href=#hl-19-167>167</a>
</span><span class=lnt id=hl-19-168><a class=lnlinks href=#hl-19-168>168</a>
</span><span class=lnt id=hl-19-169><a class=lnlinks href=#hl-19-169>169</a>
</span><span class=lnt id=hl-19-170><a class=lnlinks href=#hl-19-170>170</a>
</span><span class=lnt id=hl-19-171><a class=lnlinks href=#hl-19-171>171</a>
</span><span class=lnt id=hl-19-172><a class=lnlinks href=#hl-19-172>172</a>
</span><span class=lnt id=hl-19-173><a class=lnlinks href=#hl-19-173>173</a>
</span><span class=lnt id=hl-19-174><a class=lnlinks href=#hl-19-174>174</a>
</span><span class=lnt id=hl-19-175><a class=lnlinks href=#hl-19-175>175</a>
</span><span class=lnt id=hl-19-176><a class=lnlinks href=#hl-19-176>176</a>
</span><span class=lnt id=hl-19-177><a class=lnlinks href=#hl-19-177>177</a>
</span><span class=lnt id=hl-19-178><a class=lnlinks href=#hl-19-178>178</a>
</span><span class=lnt id=hl-19-179><a class=lnlinks href=#hl-19-179>179</a>
</span><span class=lnt id=hl-19-180><a class=lnlinks href=#hl-19-180>180</a>
</span><span class=lnt id=hl-19-181><a class=lnlinks href=#hl-19-181>181</a>
</span><span class=lnt id=hl-19-182><a class=lnlinks href=#hl-19-182>182</a>
</span><span class=lnt id=hl-19-183><a class=lnlinks href=#hl-19-183>183</a>
</span><span class=lnt id=hl-19-184><a class=lnlinks href=#hl-19-184>184</a>
</span><span class=lnt id=hl-19-185><a class=lnlinks href=#hl-19-185>185</a>
</span><span class=lnt id=hl-19-186><a class=lnlinks href=#hl-19-186>186</a>
</span><span class=lnt id=hl-19-187><a class=lnlinks href=#hl-19-187>187</a>
</span><span class=lnt id=hl-19-188><a class=lnlinks href=#hl-19-188>188</a>
</span><span class=lnt id=hl-19-189><a class=lnlinks href=#hl-19-189>189</a>
</span><span class=lnt id=hl-19-190><a class=lnlinks href=#hl-19-190>190</a>
</span><span class=lnt id=hl-19-191><a class=lnlinks href=#hl-19-191>191</a>
</span><span class=lnt id=hl-19-192><a class=lnlinks href=#hl-19-192>192</a>
</span><span class=lnt id=hl-19-193><a class=lnlinks href=#hl-19-193>193</a>
</span><span class=lnt id=hl-19-194><a class=lnlinks href=#hl-19-194>194</a>
</span><span class=lnt id=hl-19-195><a class=lnlinks href=#hl-19-195>195</a>
</span><span class=lnt id=hl-19-196><a class=lnlinks href=#hl-19-196>196</a>
</span><span class=lnt id=hl-19-197><a class=lnlinks href=#hl-19-197>197</a>
</span><span class=lnt id=hl-19-198><a class=lnlinks href=#hl-19-198>198</a>
</span><span class=lnt id=hl-19-199><a class=lnlinks href=#hl-19-199>199</a>
</span><span class=lnt id=hl-19-200><a class=lnlinks href=#hl-19-200>200</a>
</span><span class=lnt id=hl-19-201><a class=lnlinks href=#hl-19-201>201</a>
</span><span class=lnt id=hl-19-202><a class=lnlinks href=#hl-19-202>202</a>
</span><span class=lnt id=hl-19-203><a class=lnlinks href=#hl-19-203>203</a>
</span><span class=lnt id=hl-19-204><a class=lnlinks href=#hl-19-204>204</a>
</span><span class=lnt id=hl-19-205><a class=lnlinks href=#hl-19-205>205</a>
</span><span class=lnt id=hl-19-206><a class=lnlinks href=#hl-19-206>206</a>
</span><span class=lnt id=hl-19-207><a class=lnlinks href=#hl-19-207>207</a>
</span><span class=lnt id=hl-19-208><a class=lnlinks href=#hl-19-208>208</a>
</span><span class=lnt id=hl-19-209><a class=lnlinks href=#hl-19-209>209</a>
</span><span class=lnt id=hl-19-210><a class=lnlinks href=#hl-19-210>210</a>
</span><span class=lnt id=hl-19-211><a class=lnlinks href=#hl-19-211>211</a>
</span><span class=lnt id=hl-19-212><a class=lnlinks href=#hl-19-212>212</a>
</span><span class=lnt id=hl-19-213><a class=lnlinks href=#hl-19-213>213</a>
</span><span class=lnt id=hl-19-214><a class=lnlinks href=#hl-19-214>214</a>
</span><span class=lnt id=hl-19-215><a class=lnlinks href=#hl-19-215>215</a>
</span><span class=lnt id=hl-19-216><a class=lnlinks href=#hl-19-216>216</a>
</span><span class=lnt id=hl-19-217><a class=lnlinks href=#hl-19-217>217</a>
</span><span class=lnt id=hl-19-218><a class=lnlinks href=#hl-19-218>218</a>
</span><span class=lnt id=hl-19-219><a class=lnlinks href=#hl-19-219>219</a>
</span><span class=lnt id=hl-19-220><a class=lnlinks href=#hl-19-220>220</a>
</span><span class=lnt id=hl-19-221><a class=lnlinks href=#hl-19-221>221</a>
</span><span class=lnt id=hl-19-222><a class=lnlinks href=#hl-19-222>222</a>
</span><span class=lnt id=hl-19-223><a class=lnlinks href=#hl-19-223>223</a>
</span><span class=lnt id=hl-19-224><a class=lnlinks href=#hl-19-224>224</a>
</span><span class=lnt id=hl-19-225><a class=lnlinks href=#hl-19-225>225</a>
</span><span class=lnt id=hl-19-226><a class=lnlinks href=#hl-19-226>226</a>
</span><span class=lnt id=hl-19-227><a class=lnlinks href=#hl-19-227>227</a>
</span><span class=lnt id=hl-19-228><a class=lnlinks href=#hl-19-228>228</a>
</span><span class=lnt id=hl-19-229><a class=lnlinks href=#hl-19-229>229</a>
</span><span class=lnt id=hl-19-230><a class=lnlinks href=#hl-19-230>230</a>
</span><span class=lnt id=hl-19-231><a class=lnlinks href=#hl-19-231>231</a>
</span><span class=lnt id=hl-19-232><a class=lnlinks href=#hl-19-232>232</a>
</span><span class=lnt id=hl-19-233><a class=lnlinks href=#hl-19-233>233</a>
</span><span class=lnt id=hl-19-234><a class=lnlinks href=#hl-19-234>234</a>
</span><span class=lnt id=hl-19-235><a class=lnlinks href=#hl-19-235>235</a>
</span><span class=lnt id=hl-19-236><a class=lnlinks href=#hl-19-236>236</a>
</span><span class=lnt id=hl-19-237><a class=lnlinks href=#hl-19-237>237</a>
</span><span class=lnt id=hl-19-238><a class=lnlinks href=#hl-19-238>238</a>
</span><span class=lnt id=hl-19-239><a class=lnlinks href=#hl-19-239>239</a>
</span><span class=lnt id=hl-19-240><a class=lnlinks href=#hl-19-240>240</a>
</span><span class=lnt id=hl-19-241><a class=lnlinks href=#hl-19-241>241</a>
</span><span class=lnt id=hl-19-242><a class=lnlinks href=#hl-19-242>242</a>
</span><span class=lnt id=hl-19-243><a class=lnlinks href=#hl-19-243>243</a>
</span><span class=lnt id=hl-19-244><a class=lnlinks href=#hl-19-244>244</a>
</span><span class=lnt id=hl-19-245><a class=lnlinks href=#hl-19-245>245</a>
</span><span class=lnt id=hl-19-246><a class=lnlinks href=#hl-19-246>246</a>
</span><span class=lnt id=hl-19-247><a class=lnlinks href=#hl-19-247>247</a>
</span><span class=lnt id=hl-19-248><a class=lnlinks href=#hl-19-248>248</a>
</span><span class=lnt id=hl-19-249><a class=lnlinks href=#hl-19-249>249</a>
</span><span class=lnt id=hl-19-250><a class=lnlinks href=#hl-19-250>250</a>
</span><span class=lnt id=hl-19-251><a class=lnlinks href=#hl-19-251>251</a>
</span><span class=lnt id=hl-19-252><a class=lnlinks href=#hl-19-252>252</a>
</span><span class=lnt id=hl-19-253><a class=lnlinks href=#hl-19-253>253</a>
</span><span class=lnt id=hl-19-254><a class=lnlinks href=#hl-19-254>254</a>
</span><span class=lnt id=hl-19-255><a class=lnlinks href=#hl-19-255>255</a>
</span><span class=lnt id=hl-19-256><a class=lnlinks href=#hl-19-256>256</a>
</span><span class=lnt id=hl-19-257><a class=lnlinks href=#hl-19-257>257</a>
</span><span class=lnt id=hl-19-258><a class=lnlinks href=#hl-19-258>258</a>
</span><span class=lnt id=hl-19-259><a class=lnlinks href=#hl-19-259>259</a>
</span><span class=lnt id=hl-19-260><a class=lnlinks href=#hl-19-260>260</a>
</span><span class=lnt id=hl-19-261><a class=lnlinks href=#hl-19-261>261</a>
</span><span class=lnt id=hl-19-262><a class=lnlinks href=#hl-19-262>262</a>
</span><span class=lnt id=hl-19-263><a class=lnlinks href=#hl-19-263>263</a>
</span><span class=lnt id=hl-19-264><a class=lnlinks href=#hl-19-264>264</a>
</span><span class=lnt id=hl-19-265><a class=lnlinks href=#hl-19-265>265</a>
</span><span class=lnt id=hl-19-266><a class=lnlinks href=#hl-19-266>266</a>
</span><span class=lnt id=hl-19-267><a class=lnlinks href=#hl-19-267>267</a>
</span><span class=lnt id=hl-19-268><a class=lnlinks href=#hl-19-268>268</a>
</span><span class=lnt id=hl-19-269><a class=lnlinks href=#hl-19-269>269</a>
</span><span class=lnt id=hl-19-270><a class=lnlinks href=#hl-19-270>270</a>
</span><span class=lnt id=hl-19-271><a class=lnlinks href=#hl-19-271>271</a>
</span><span class=lnt id=hl-19-272><a class=lnlinks href=#hl-19-272>272</a>
</span><span class=lnt id=hl-19-273><a class=lnlinks href=#hl-19-273>273</a>
</span><span class=lnt id=hl-19-274><a class=lnlinks href=#hl-19-274>274</a>
</span><span class=lnt id=hl-19-275><a class=lnlinks href=#hl-19-275>275</a>
</span><span class=lnt id=hl-19-276><a class=lnlinks href=#hl-19-276>276</a>
</span><span class=lnt id=hl-19-277><a class=lnlinks href=#hl-19-277>277</a>
</span><span class=lnt id=hl-19-278><a class=lnlinks href=#hl-19-278>278</a>
</span><span class=lnt id=hl-19-279><a class=lnlinks href=#hl-19-279>279</a>
</span><span class=lnt id=hl-19-280><a class=lnlinks href=#hl-19-280>280</a>
</span><span class=lnt id=hl-19-281><a class=lnlinks href=#hl-19-281>281</a>
</span><span class=lnt id=hl-19-282><a class=lnlinks href=#hl-19-282>282</a>
</span><span class=lnt id=hl-19-283><a class=lnlinks href=#hl-19-283>283</a>
</span><span class=lnt id=hl-19-284><a class=lnlinks href=#hl-19-284>284</a>
</span><span class=lnt id=hl-19-285><a class=lnlinks href=#hl-19-285>285</a>
</span><span class=lnt id=hl-19-286><a class=lnlinks href=#hl-19-286>286</a>
</span><span class=lnt id=hl-19-287><a class=lnlinks href=#hl-19-287>287</a>
</span><span class=lnt id=hl-19-288><a class=lnlinks href=#hl-19-288>288</a>
</span><span class=lnt id=hl-19-289><a class=lnlinks href=#hl-19-289>289</a>
</span><span class=lnt id=hl-19-290><a class=lnlinks href=#hl-19-290>290</a>
</span><span class=lnt id=hl-19-291><a class=lnlinks href=#hl-19-291>291</a>
</span><span class=lnt id=hl-19-292><a class=lnlinks href=#hl-19-292>292</a>
</span><span class=lnt id=hl-19-293><a class=lnlinks href=#hl-19-293>293</a>
</span><span class=lnt id=hl-19-294><a class=lnlinks href=#hl-19-294>294</a>
</span><span class=lnt id=hl-19-295><a class=lnlinks href=#hl-19-295>295</a>
</span><span class=lnt id=hl-19-296><a class=lnlinks href=#hl-19-296>296</a>
</span><span class=lnt id=hl-19-297><a class=lnlinks href=#hl-19-297>297</a>
</span><span class=lnt id=hl-19-298><a class=lnlinks href=#hl-19-298>298</a>
</span><span class=lnt id=hl-19-299><a class=lnlinks href=#hl-19-299>299</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Slf4j</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>NaverPayPointService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>PointRepository</span><span class=w> </span><span class=n>pointRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>RedisTemplate</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>redisTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>KafkaTemplate</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>kafkaTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 네이버페이 스타일 포인트 결제 처리
</span></span></span><span class=line><span class=cl><span class=cm>     * - 이 메서드는 대규모 동시 결제 처리를 담당
</span></span></span><span class=line><span class=cl><span class=cm>     * - 여기서 Transaction Isolation의 실제 상용 서비스 적용 확인 가능
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PaymentResult</span><span class=w> </span><span class=nf>processPointPayment</span><span class=p>(</span><span class=n>PointPaymentRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getUserId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 1단계: 캐시에서 빠른 잔액 확인 (Read Committed 수준)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>cachedBalance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getCachedPointBalance</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cachedBalance</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>cachedBalance</span><span class=p>.</span><span class=na>compareTo</span><span class=p>(</span><span class=n>amount</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InsufficientPointsException</span><span class=p>(</span><span class=s>&#34;포인트 잔액 부족 (캐시)&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 2단계: 결제 승인 처리 (Repeatable Read)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PaymentApproval</span><span class=w> </span><span class=n>approval</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>approvePaymentWithConsistency</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>orderId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 3단계: 실제 포인트 차감 (Serializable)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PointTransaction</span><span class=w> </span><span class=n>transaction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>deductPointsWithIsolation</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>orderId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 4단계: 캐시 업데이트 및 이벤트 발행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>updateCacheAndPublishEvent</span><span class=p>(</span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>PaymentResult</span><span class=p>.</span><span class=na>success</span><span class=p>(</span><span class=n>approval</span><span class=p>,</span><span class=w> </span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;포인트 결제 처리 실패: userId={}, amount={}, orderId={}&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 보상 트랜잭션 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>executeCompensationTransaction</span><span class=p>(</span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>orderId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PaymentProcessingException</span><span class=p>(</span><span class=s>&#34;결제 처리 실패&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Redis 캐시를 활용한 빠른 잔액 확인
</span></span></span><span class=line><span class=cl><span class=cm>     * - 이 부분은 높은 성능의 읽기 작업을 담당
</span></span></span><span class=line><span class=cl><span class=cm>     * - 여기서 Transaction Isolation의 캐시 활용 패턴 확인 가능
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>BigDecimal</span><span class=w> </span><span class=nf>getCachedPointBalance</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>cacheKey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;point:balance:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>userId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Object</span><span class=w> </span><span class=n>cached</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForValue</span><span class=p>().</span><span class=na>get</span><span class=p>(</span><span class=n>cacheKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cached</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BigDecimal</span><span class=p>(</span><span class=n>cached</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 캐시 미스 시 DB에서 조회 후 캐시 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>dbBalance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pointRepository</span><span class=p>.</span><span class=na>getPointBalance</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForValue</span><span class=p>().</span><span class=na>set</span><span class=p>(</span><span class=n>cacheKey</span><span class=p>,</span><span class=w> </span><span class=n>dbBalance</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Duration</span><span class=p>.</span><span class=na>ofMinutes</span><span class=p>(</span><span class=n>5</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>dbBalance</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;캐시 조회 실패, DB에서 직접 조회: userId={}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>  </span><span class=c1>// 캐시 실패 시 DB 조회로 폴백</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 결제 승인 처리 - Repeatable Read 적용
</span></span></span><span class=line><span class=cl><span class=cm>     * - 이 부분은 승인 과정의 데이터 일관성을 담당
</span></span></span><span class=line><span class=cl><span class=cm>     * - 여기서 Transaction Isolation의 반복 읽기 보장 확인 가능
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=p>(</span><span class=n>isolation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Isolation</span><span class=p>.</span><span class=na>REPEATABLE_READ</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PaymentApproval</span><span class=w> </span><span class=nf>approvePaymentWithConsistency</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 사용자 정보 및 제한 사항 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserPointInfo</span><span class=w> </span><span class=n>userInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pointRepository</span><span class=p>.</span><span class=na>getUserPointInfo</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>validateUserEligibility</span><span class=p>(</span><span class=n>userInfo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 일일 사용 한도 확인 (첫 번째 읽기)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>dailyUsed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pointRepository</span><span class=p>.</span><span class=na>getDailyPointUsage</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dailyUsed</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>amount</span><span class=p>).</span><span class=na>compareTo</span><span class=p>(</span><span class=n>userInfo</span><span class=p>.</span><span class=na>getDailyLimit</span><span class=p>())</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DailyLimitExceededException</span><span class=p>(</span><span class=s>&#34;일일 포인트 사용 한도 초과&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비즈니스 규칙 검증 (시간이 걸리는 작업)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>validateMerchantEligibility</span><span class=p>(</span><span class=n>orderId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>applySpecialPromotions</span><span class=p>(</span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 일일 사용량 재확인 (두 번째 읽기 - 같은 값이어야 함)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>recheckedDailyUsed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pointRepository</span><span class=p>.</span><span class=na>getDailyPointUsage</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>dailyUsed</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>recheckedDailyUsed</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ConcurrencyException</span><span class=p>(</span><span class=s>&#34;동시성 문제로 승인 실패&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 승인 기록 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PaymentApproval</span><span class=w> </span><span class=n>approval</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PaymentApproval</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>userId</span><span class=p>(</span><span class=n>userId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orderId</span><span class=p>(</span><span class=n>orderId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>amount</span><span class=p>(</span><span class=n>amount</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>approvedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>ApprovalStatus</span><span class=p>.</span><span class=na>APPROVED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>paymentApprovalRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>approval</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 포인트 차감 처리 - Serializable 적용
</span></span></span><span class=line><span class=cl><span class=cm>     * - 이 부분은 포인트 잔액의 완전한 격리를 담당
</span></span></span><span class=line><span class=cl><span class=cm>     * - 여기서 Transaction Isolation의 최고 수준 격리 확인 가능
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=p>(</span><span class=n>isolation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Isolation</span><span class=p>.</span><span class=na>SERIALIZABLE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PointTransaction</span><span class=w> </span><span class=nf>deductPointsWithIsolation</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 포인트 계좌 잠금 및 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PointAccount</span><span class=w> </span><span class=n>account</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pointRepository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>findByUserIdForUpdate</span><span class=p>(</span><span class=n>userId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PointAccountNotFoundException</span><span class=p>(</span><span class=n>userId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 정확한 잔액 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>account</span><span class=p>.</span><span class=na>getBalance</span><span class=p>().</span><span class=na>compareTo</span><span class=p>(</span><span class=n>amount</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InsufficientPointsException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;포인트 부족: 잔액=%s, 요청=%s&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>account</span><span class=p>.</span><span class=na>getBalance</span><span class=p>(),</span><span class=w> </span><span class=n>amount</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 포인트 차감 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>account</span><span class=p>.</span><span class=na>deductPoints</span><span class=p>(</span><span class=n>amount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>pointRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>account</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 거래 기록 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PointTransaction</span><span class=w> </span><span class=n>transaction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PointTransaction</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>userId</span><span class=p>(</span><span class=n>userId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orderId</span><span class=p>(</span><span class=n>orderId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>amount</span><span class=p>(</span><span class=n>amount</span><span class=p>.</span><span class=na>negate</span><span class=p>())</span><span class=w>  </span><span class=c1>// 차감은 음수로 기록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>balanceAfter</span><span class=p>(</span><span class=n>account</span><span class=p>.</span><span class=na>getBalance</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>transactionType</span><span class=p>(</span><span class=n>TransactionType</span><span class=p>.</span><span class=na>PAYMENT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>createdAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>pointTransactionRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 캐시 업데이트 및 이벤트 발행
</span></span></span><span class=line><span class=cl><span class=cm>     * - 이 부분은 실시간 데이터 동기화를 담당
</span></span></span><span class=line><span class=cl><span class=cm>     * - 여기서 Transaction Isolation의 이벤트 기반 아키텍처 적용 확인 가능
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>updateCacheAndPublishEvent</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>PointTransaction</span><span class=w> </span><span class=n>transaction</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Redis 캐시 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>cacheKey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;point:balance:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>userId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForValue</span><span class=p>().</span><span class=na>set</span><span class=p>(</span><span class=n>cacheKey</span><span class=p>,</span><span class=w> </span><span class=n>transaction</span><span class=p>.</span><span class=na>getBalanceAfter</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Duration</span><span class=p>.</span><span class=na>ofMinutes</span><span class=p>(</span><span class=n>5</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 포인트 사용 이벤트 발행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PointUsedEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PointUsedEvent</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>userId</span><span class=p>(</span><span class=n>userId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orderId</span><span class=p>(</span><span class=n>transaction</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>amount</span><span class=p>(</span><span class=n>transaction</span><span class=p>.</span><span class=na>getAmount</span><span class=p>().</span><span class=na>abs</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>balanceAfter</span><span class=p>(</span><span class=n>transaction</span><span class=p>.</span><span class=na>getBalanceAfter</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>timestamp</span><span class=p>(</span><span class=n>transaction</span><span class=p>.</span><span class=na>getCreatedAt</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>kafkaTemplate</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=s>&#34;point-events&#34;</span><span class=p>,</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 실시간 알림 발송 (WebSocket)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sendRealtimeNotification</span><span class=p>(</span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 보상 트랜잭션 (실패 시 복구)
</span></span></span><span class=line><span class=cl><span class=cm>     * - 이 부분은 오류 상황에서의 데이터 복구를 담당
</span></span></span><span class=line><span class=cl><span class=cm>     * - 여기서 Transaction Isolation의 오류 처리 및 복구 확인 가능
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=p>(</span><span class=n>isolation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Isolation</span><span class=p>.</span><span class=na>SERIALIZABLE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>executeCompensationTransaction</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 포인트 복구 (차감된 포인트가 있다면)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>PointTransaction</span><span class=o>&gt;</span><span class=w> </span><span class=n>deductedTransaction</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>pointTransactionRepository</span><span class=p>.</span><span class=na>findByOrderIdAndType</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>TransactionType</span><span class=p>.</span><span class=na>PAYMENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>deductedTransaction</span><span class=p>.</span><span class=na>isPresent</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>PointAccount</span><span class=w> </span><span class=n>account</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pointRepository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>findByUserIdForUpdate</span><span class=p>(</span><span class=n>userId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PointAccountNotFoundException</span><span class=p>(</span><span class=n>userId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>account</span><span class=p>.</span><span class=na>addPoints</span><span class=p>(</span><span class=n>amount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>pointRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>account</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 보상 거래 기록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>PointTransaction</span><span class=w> </span><span class=n>compensation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PointTransaction</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>userId</span><span class=p>(</span><span class=n>userId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>orderId</span><span class=p>(</span><span class=n>orderId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>amount</span><span class=p>(</span><span class=n>amount</span><span class=p>)</span><span class=w>  </span><span class=c1>// 복구는 양수로 기록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>balanceAfter</span><span class=p>(</span><span class=n>account</span><span class=p>.</span><span class=na>getBalance</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>transactionType</span><span class=p>(</span><span class=n>TransactionType</span><span class=p>.</span><span class=na>COMPENSATION</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>relatedTransactionId</span><span class=p>(</span><span class=n>deductedTransaction</span><span class=p>.</span><span class=na>get</span><span class=p>().</span><span class=na>getId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>createdAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>pointTransactionRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>compensation</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 캐시 및 이벤트 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>updateCacheAndPublishEvent</span><span class=p>(</span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>compensation</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;보상 트랜잭션 실행 실패: userId={}, orderId={}&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 수동 처리를 위한 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>alertService</span><span class=p>.</span><span class=na>sendCriticalAlert</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;포인트 보상 트랜잭션 실패&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;수동 처리 필요: userId=%s, orderId=%s&#34;</span><span class=p>,</span><span class=w> </span><span class=n>userId</span><span class=p>,</span><span class=w> </span><span class=n>orderId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 성능 모니터링 및 지표 수집
</span></span></span><span class=line><span class=cl><span class=cm> * - 이 부분은 실시간 성능 지표 수집을 담당
</span></span></span><span class=line><span class=cl><span class=cm> * - 여기서 Transaction Isolation의 성능 모니터링 확인 가능
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Slf4j</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PointServiceMonitor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>MeterRegistry</span><span class=w> </span><span class=n>meterRegistry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@EventListener</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handlePointTransactionEvent</span><span class=p>(</span><span class=n>PointTransactionEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 격리 수준별 성능 지표 수집</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>isolationLevel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getIsolationLevel</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getDuration</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Timer</span><span class=p>.</span><span class=na>Sample</span><span class=w> </span><span class=n>sample</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Timer</span><span class=p>.</span><span class=na>start</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sample</span><span class=p>.</span><span class=na>stop</span><span class=p>(</span><span class=n>Timer</span><span class=p>.</span><span class=na>builder</span><span class=p>(</span><span class=s>&#34;point.transaction.duration&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;isolation&#34;</span><span class=p>,</span><span class=w> </span><span class=n>isolationLevel</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getTransactionType</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 처리량 카운터</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>meterRegistry</span><span class=p>.</span><span class=na>counter</span><span class=p>(</span><span class=s>&#34;point.transaction.count&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;isolation&#34;</span><span class=p>,</span><span class=w> </span><span class=n>isolationLevel</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getStatus</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>increment</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 임계값 초과 시 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>duration</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>getPerformanceThreshold</span><span class=p>(</span><span class=n>isolationLevel</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;성능 임계값 초과: isolation={}, duration={}ms&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>isolationLevel</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>meterRegistry</span><span class=p>.</span><span class=na>counter</span><span class=p>(</span><span class=s>&#34;point.transaction.slow&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;isolation&#34;</span><span class=p>,</span><span class=w> </span><span class=n>isolationLevel</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>increment</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=nf>getPerformanceThreshold</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>isolationLevel</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>isolationLevel</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;READ_COMMITTED&#34;</span><span class=p>:</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>50</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;REPEATABLE_READ&#34;</span><span class=p>:</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>200</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;SERIALIZABLE&#34;</span><span class=p>:</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>500</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>default</span><span class=p>:</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>100</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li><strong>성능 개선</strong>: 평균 응답시간 80ms, 99.9% 요청이 100ms 이하 처리</li><li><strong>운영 효율성</strong>: 포인트 관련 수동 처리 업무 95% 감소, 고객 문의 80% 감소</li><li><strong>비용 절감</strong>: 운영 인력 30% 절감, 인프라 비용 20% 최적화</li></ul><h5 id=사례-금융사-계좌-이체-serializable-적용>사례: 금융사 계좌 이체 (Serializable 적용)<a hidden class=anchor aria-hidden=true href=#사례-금융사-계좌-이체-serializable-적용>#</a></h5><p><strong>비즈니스 배경</strong>: 이체 중 오류 발생 방지 및 이중 지불 금지<br><strong>기술적 요구사항</strong>: 모든 거래의 완전한 무결성</p><p><strong>시스템 구성</strong>:</p><ul><li>Account Service</li><li>Transaction Manager</li><li>Lock Manager</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Production Environment&#34;
        LB[Load Balancer] --&gt; AS[Account Servers]
        AS --&gt; DB[Database Cluster]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>이체 요청 접수 → 트랜잭션 시작</li><li>잔액 확인 및 Lock 획득</li><li>적요 및 업데이트</li><li>트랜잭션 커밋</li></ol><p><strong>핵심 역할</strong>: Serializable 수준에서 비동기 처리 불가, 데이터 완전 관리</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 동시 이체시 잔액 손상 발생</li><li>도입 후: 모든 이체 순차 처리, 무결성 보장</li></ul><p><strong>구현 예시 (YAML, 주석 포함):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 격리 수준 설정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>db-isolation-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>isolation_level</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;SERIALIZABLE&#34;</span><span class=w> </span><span class=c># 완전 격리 설정</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li>성능 개선: 충돌 및 오류 감소</li><li>운영 효율성: 재처리율 감소</li><li>비용 절감: 장애 복구 비용↓</li></ul><h5 id=사례-전자상거래-주문재고-시스템>사례: 전자상거래 주문/재고 시스템<a hidden class=anchor aria-hidden=true href=#사례-전자상거래-주문재고-시스템>#</a></h5><p><strong>비즈니스 배경</strong>: 주문 폭주 시 재고 차감 정확성과 응답시간을 둘 다 확보해야 함<br><strong>기술적 요구사항</strong>:</p><ul><li>조회 트래픽은 비차단, <strong>결제·재고 차감 경로는 팬텀/경합 방지</strong></li><li>장애 시 재처리 용이</li></ul><p><strong>시스템 구성</strong></p><ul><li>API(Server) + PostgreSQL(Orders, Inventory), Redis 캐시 (읽기 가속)</li></ul><p><strong>시스템 구성 다이어그램</strong></p><pre class=mermaid>graph TB
  U[User] --&gt; API[Order API]
  API --&gt; PG[(PostgreSQL)]
  API --&gt; R[(Redis Cache)]
  subgraph &#34;DB&#34;
    PG --&gt; Inv[Inventory Table]
    PG --&gt; Ord[Order Table]
  end
</pre><p><strong>Workflow</strong></p><ol><li>상품 목록/가격 조회: <strong>Read Committed</strong>(MVCC) + Redis 캐시</li><li>결제 직전 재고확인 + 차감: <strong>Serializable</strong> 트랜잭션으로 SKU 별 범위 검증</li><li>주문 확정 후 캐시 무효화</li></ol><p><strong>유무 비교</strong></p><ul><li>도입 전: RC 에서 동시 주문 시 <strong>쓰기왜곡/팬텀</strong> 가능</li><li>도입 후: 결제 경로만 Serializable 로 <strong>정확성 보장</strong>, 나머지는 RC 로 <strong>지연 최소화</strong></li></ul><p><strong>구현 예시 (Node.js + pg)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// npm i pg
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>Client</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;pg&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>reserveStock</span><span class=p>(</span><span class=nx>client</span><span class=p>,</span> <span class=nx>sku</span><span class=p>,</span> <span class=nx>qty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 결제 핵심 로직: Serializable로 팬텀/쓰기왜곡 방지
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;BEGIN ISOLATION LEVEL SERIALIZABLE&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>rows</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;SELECT available FROM inventory WHERE sku=$1 FOR UPDATE&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>sku</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>rows</span><span class=p>.</span><span class=nx>length</span> <span class=o>||</span> <span class=nx>rows</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>available</span> <span class=o>&lt;</span> <span class=nx>qty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;ROLLBACK&#39;</span><span class=p>);</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;UPDATE inventory SET available=available-$1 WHERE sku=$2&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>qty</span><span class=p>,</span> <span class=nx>sku</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;COMMIT&#39;</span><span class=p>);</span> <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>관련성 주석</strong>: <code>ISOLATION LEVEL SERIALIZABLE</code> + <code>FOR UPDATE</code> 로 <strong>범위/행 수준 일관성</strong> 확보. PG 기본/고급 동작은 문서 기준. ([PostgreSQL][1])</li></ul><p><strong>성과 분석</strong></p><ul><li>성능: 조회 p95 지연 <strong>20~40%↓</strong>(캐시 +MVCC 비차단), 결제 경로는 약간 증가</li><li>운영: 재시도 정책 (SerializationFailure) 로 안정적인 실패 처리</li><li>비용: 고가용 락 경합 감소로 스케일 축소 가능</li></ul><h5 id=사례-전자상거래-재고-관리-시스템>사례: 전자상거래 재고 관리 시스템<a hidden class=anchor aria-hidden=true href=#사례-전자상거래-재고-관리-시스템>#</a></h5><p>이 사례는 대규모 온라인 쇼핑몰에서 동시에 여러 고객이 같은 상품을 주문할 때 재고 부족 문제를 해결하는 방법을 보여준다.</p><p><strong>시스템 구성:</strong></p><pre class=mermaid>graph TB
    subgraph &#34;사용자 계층&#34;
        U1[고객 A]
        U2[고객 B] 
        U3[고객 C]
    end
    
    subgraph &#34;애플리케이션 계층&#34;
        WEB[웹 서버]
        API[API 게이트웨이]
        ORDER[주문 서비스]
        INVENTORY[재고 서비스]
    end
    
    subgraph &#34;데이터베이스 계층&#34;
        DB[(PostgreSQL)]
        CACHE[(Redis Cache)]
    end
    
    U1 --&gt; WEB
    U2 --&gt; WEB
    U3 --&gt; WEB
    WEB --&gt; API
    API --&gt; ORDER
    ORDER --&gt; INVENTORY
    INVENTORY --&gt; DB
    INVENTORY --&gt; CACHE
</pre><p><strong>Workflow:</strong></p><ol><li><strong>트랜잭션 시작</strong>: 고객이 주문하기 버튼 클릭</li><li><strong>격리 수준 설정</strong>: Repeatable Read 로 설정하여 재고 조회 일관성 보장</li><li><strong>재고 확인</strong>: 현재 재고 수량 조회</li><li><strong>재고 차감</strong>: 주문 수량만큼 재고 감소</li><li><strong>주문 생성</strong>: 주문 정보 데이터베이스에 저장</li><li><strong>트랜잭션 커밋</strong>: 모든 작업 완료 후 확정</li></ol><p><strong>핵심 역할:</strong></p><ul><li>Repeatable Read 격리 수준을 통해 재고 조회부터 차감까지 일관된 데이터 보장</li><li>동시 주문 시 하나의 트랜잭션만 성공하고 나머지는 재시도하도록 제어</li><li>비즈니스 규칙 (재고 >= 주문 수량) 위반 방지</li></ul><p><strong>격리 수준 유무에 따른 차이점:</strong></p><p><strong>격리 수준 적용 시:</strong></p><ul><li>정확한 재고 관리로 오버셀링 방지</li><li>고객 불만 최소화 및 신뢰도 향상</li><li>예측 가능한 비즈니스 로직 수행</li></ul><p><strong>격리 수준 미적용 시:</strong></p><ul><li>재고보다 많은 주문 접수 가능</li><li>고객 취소 및 환불 처리 증가</li><li>공급업체와의 신뢰 관계 악화</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>  1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2>  2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3>  3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4>  4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5>  5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6>  6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7>  7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8>  8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9>  9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10> 10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11> 11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12> 12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13> 13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14> 14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15> 15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16> 16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17> 17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18> 18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19> 19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20> 20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21> 21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22> 22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23> 23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24> 24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25> 25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26> 26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27> 27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28> 28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29> 29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30> 30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31> 31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32> 32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33> 33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34> 34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35> 35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36> 36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37> 37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38> 38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39> 39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40> 40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41> 41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42> 42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43> 43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44> 44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45> 45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46> 46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47> 47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48> 48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49> 49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50> 50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51> 51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52> 52</a>
</span><span class=lnt id=hl-25-53><a class=lnlinks href=#hl-25-53> 53</a>
</span><span class=lnt id=hl-25-54><a class=lnlinks href=#hl-25-54> 54</a>
</span><span class=lnt id=hl-25-55><a class=lnlinks href=#hl-25-55> 55</a>
</span><span class=lnt id=hl-25-56><a class=lnlinks href=#hl-25-56> 56</a>
</span><span class=lnt id=hl-25-57><a class=lnlinks href=#hl-25-57> 57</a>
</span><span class=lnt id=hl-25-58><a class=lnlinks href=#hl-25-58> 58</a>
</span><span class=lnt id=hl-25-59><a class=lnlinks href=#hl-25-59> 59</a>
</span><span class=lnt id=hl-25-60><a class=lnlinks href=#hl-25-60> 60</a>
</span><span class=lnt id=hl-25-61><a class=lnlinks href=#hl-25-61> 61</a>
</span><span class=lnt id=hl-25-62><a class=lnlinks href=#hl-25-62> 62</a>
</span><span class=lnt id=hl-25-63><a class=lnlinks href=#hl-25-63> 63</a>
</span><span class=lnt id=hl-25-64><a class=lnlinks href=#hl-25-64> 64</a>
</span><span class=lnt id=hl-25-65><a class=lnlinks href=#hl-25-65> 65</a>
</span><span class=lnt id=hl-25-66><a class=lnlinks href=#hl-25-66> 66</a>
</span><span class=lnt id=hl-25-67><a class=lnlinks href=#hl-25-67> 67</a>
</span><span class=lnt id=hl-25-68><a class=lnlinks href=#hl-25-68> 68</a>
</span><span class=lnt id=hl-25-69><a class=lnlinks href=#hl-25-69> 69</a>
</span><span class=lnt id=hl-25-70><a class=lnlinks href=#hl-25-70> 70</a>
</span><span class=lnt id=hl-25-71><a class=lnlinks href=#hl-25-71> 71</a>
</span><span class=lnt id=hl-25-72><a class=lnlinks href=#hl-25-72> 72</a>
</span><span class=lnt id=hl-25-73><a class=lnlinks href=#hl-25-73> 73</a>
</span><span class=lnt id=hl-25-74><a class=lnlinks href=#hl-25-74> 74</a>
</span><span class=lnt id=hl-25-75><a class=lnlinks href=#hl-25-75> 75</a>
</span><span class=lnt id=hl-25-76><a class=lnlinks href=#hl-25-76> 76</a>
</span><span class=lnt id=hl-25-77><a class=lnlinks href=#hl-25-77> 77</a>
</span><span class=lnt id=hl-25-78><a class=lnlinks href=#hl-25-78> 78</a>
</span><span class=lnt id=hl-25-79><a class=lnlinks href=#hl-25-79> 79</a>
</span><span class=lnt id=hl-25-80><a class=lnlinks href=#hl-25-80> 80</a>
</span><span class=lnt id=hl-25-81><a class=lnlinks href=#hl-25-81> 81</a>
</span><span class=lnt id=hl-25-82><a class=lnlinks href=#hl-25-82> 82</a>
</span><span class=lnt id=hl-25-83><a class=lnlinks href=#hl-25-83> 83</a>
</span><span class=lnt id=hl-25-84><a class=lnlinks href=#hl-25-84> 84</a>
</span><span class=lnt id=hl-25-85><a class=lnlinks href=#hl-25-85> 85</a>
</span><span class=lnt id=hl-25-86><a class=lnlinks href=#hl-25-86> 86</a>
</span><span class=lnt id=hl-25-87><a class=lnlinks href=#hl-25-87> 87</a>
</span><span class=lnt id=hl-25-88><a class=lnlinks href=#hl-25-88> 88</a>
</span><span class=lnt id=hl-25-89><a class=lnlinks href=#hl-25-89> 89</a>
</span><span class=lnt id=hl-25-90><a class=lnlinks href=#hl-25-90> 90</a>
</span><span class=lnt id=hl-25-91><a class=lnlinks href=#hl-25-91> 91</a>
</span><span class=lnt id=hl-25-92><a class=lnlinks href=#hl-25-92> 92</a>
</span><span class=lnt id=hl-25-93><a class=lnlinks href=#hl-25-93> 93</a>
</span><span class=lnt id=hl-25-94><a class=lnlinks href=#hl-25-94> 94</a>
</span><span class=lnt id=hl-25-95><a class=lnlinks href=#hl-25-95> 95</a>
</span><span class=lnt id=hl-25-96><a class=lnlinks href=#hl-25-96> 96</a>
</span><span class=lnt id=hl-25-97><a class=lnlinks href=#hl-25-97> 97</a>
</span><span class=lnt id=hl-25-98><a class=lnlinks href=#hl-25-98> 98</a>
</span><span class=lnt id=hl-25-99><a class=lnlinks href=#hl-25-99> 99</a>
</span><span class=lnt id=hl-25-100><a class=lnlinks href=#hl-25-100>100</a>
</span><span class=lnt id=hl-25-101><a class=lnlinks href=#hl-25-101>101</a>
</span><span class=lnt id=hl-25-102><a class=lnlinks href=#hl-25-102>102</a>
</span><span class=lnt id=hl-25-103><a class=lnlinks href=#hl-25-103>103</a>
</span><span class=lnt id=hl-25-104><a class=lnlinks href=#hl-25-104>104</a>
</span><span class=lnt id=hl-25-105><a class=lnlinks href=#hl-25-105>105</a>
</span><span class=lnt id=hl-25-106><a class=lnlinks href=#hl-25-106>106</a>
</span><span class=lnt id=hl-25-107><a class=lnlinks href=#hl-25-107>107</a>
</span><span class=lnt id=hl-25-108><a class=lnlinks href=#hl-25-108>108</a>
</span><span class=lnt id=hl-25-109><a class=lnlinks href=#hl-25-109>109</a>
</span><span class=lnt id=hl-25-110><a class=lnlinks href=#hl-25-110>110</a>
</span><span class=lnt id=hl-25-111><a class=lnlinks href=#hl-25-111>111</a>
</span><span class=lnt id=hl-25-112><a class=lnlinks href=#hl-25-112>112</a>
</span><span class=lnt id=hl-25-113><a class=lnlinks href=#hl-25-113>113</a>
</span><span class=lnt id=hl-25-114><a class=lnlinks href=#hl-25-114>114</a>
</span><span class=lnt id=hl-25-115><a class=lnlinks href=#hl-25-115>115</a>
</span><span class=lnt id=hl-25-116><a class=lnlinks href=#hl-25-116>116</a>
</span><span class=lnt id=hl-25-117><a class=lnlinks href=#hl-25-117>117</a>
</span><span class=lnt id=hl-25-118><a class=lnlinks href=#hl-25-118>118</a>
</span><span class=lnt id=hl-25-119><a class=lnlinks href=#hl-25-119>119</a>
</span><span class=lnt id=hl-25-120><a class=lnlinks href=#hl-25-120>120</a>
</span><span class=lnt id=hl-25-121><a class=lnlinks href=#hl-25-121>121</a>
</span><span class=lnt id=hl-25-122><a class=lnlinks href=#hl-25-122>122</a>
</span><span class=lnt id=hl-25-123><a class=lnlinks href=#hl-25-123>123</a>
</span><span class=lnt id=hl-25-124><a class=lnlinks href=#hl-25-124>124</a>
</span><span class=lnt id=hl-25-125><a class=lnlinks href=#hl-25-125>125</a>
</span><span class=lnt id=hl-25-126><a class=lnlinks href=#hl-25-126>126</a>
</span><span class=lnt id=hl-25-127><a class=lnlinks href=#hl-25-127>127</a>
</span><span class=lnt id=hl-25-128><a class=lnlinks href=#hl-25-128>128</a>
</span><span class=lnt id=hl-25-129><a class=lnlinks href=#hl-25-129>129</a>
</span><span class=lnt id=hl-25-130><a class=lnlinks href=#hl-25-130>130</a>
</span><span class=lnt id=hl-25-131><a class=lnlinks href=#hl-25-131>131</a>
</span><span class=lnt id=hl-25-132><a class=lnlinks href=#hl-25-132>132</a>
</span><span class=lnt id=hl-25-133><a class=lnlinks href=#hl-25-133>133</a>
</span><span class=lnt id=hl-25-134><a class=lnlinks href=#hl-25-134>134</a>
</span><span class=lnt id=hl-25-135><a class=lnlinks href=#hl-25-135>135</a>
</span><span class=lnt id=hl-25-136><a class=lnlinks href=#hl-25-136>136</a>
</span><span class=lnt id=hl-25-137><a class=lnlinks href=#hl-25-137>137</a>
</span><span class=lnt id=hl-25-138><a class=lnlinks href=#hl-25-138>138</a>
</span><span class=lnt id=hl-25-139><a class=lnlinks href=#hl-25-139>139</a>
</span><span class=lnt id=hl-25-140><a class=lnlinks href=#hl-25-140>140</a>
</span><span class=lnt id=hl-25-141><a class=lnlinks href=#hl-25-141>141</a>
</span><span class=lnt id=hl-25-142><a class=lnlinks href=#hl-25-142>142</a>
</span><span class=lnt id=hl-25-143><a class=lnlinks href=#hl-25-143>143</a>
</span><span class=lnt id=hl-25-144><a class=lnlinks href=#hl-25-144>144</a>
</span><span class=lnt id=hl-25-145><a class=lnlinks href=#hl-25-145>145</a>
</span><span class=lnt id=hl-25-146><a class=lnlinks href=#hl-25-146>146</a>
</span><span class=lnt id=hl-25-147><a class=lnlinks href=#hl-25-147>147</a>
</span><span class=lnt id=hl-25-148><a class=lnlinks href=#hl-25-148>148</a>
</span><span class=lnt id=hl-25-149><a class=lnlinks href=#hl-25-149>149</a>
</span><span class=lnt id=hl-25-150><a class=lnlinks href=#hl-25-150>150</a>
</span><span class=lnt id=hl-25-151><a class=lnlinks href=#hl-25-151>151</a>
</span><span class=lnt id=hl-25-152><a class=lnlinks href=#hl-25-152>152</a>
</span><span class=lnt id=hl-25-153><a class=lnlinks href=#hl-25-153>153</a>
</span><span class=lnt id=hl-25-154><a class=lnlinks href=#hl-25-154>154</a>
</span><span class=lnt id=hl-25-155><a class=lnlinks href=#hl-25-155>155</a>
</span><span class=lnt id=hl-25-156><a class=lnlinks href=#hl-25-156>156</a>
</span><span class=lnt id=hl-25-157><a class=lnlinks href=#hl-25-157>157</a>
</span><span class=lnt id=hl-25-158><a class=lnlinks href=#hl-25-158>158</a>
</span><span class=lnt id=hl-25-159><a class=lnlinks href=#hl-25-159>159</a>
</span><span class=lnt id=hl-25-160><a class=lnlinks href=#hl-25-160>160</a>
</span><span class=lnt id=hl-25-161><a class=lnlinks href=#hl-25-161>161</a>
</span><span class=lnt id=hl-25-162><a class=lnlinks href=#hl-25-162>162</a>
</span><span class=lnt id=hl-25-163><a class=lnlinks href=#hl-25-163>163</a>
</span><span class=lnt id=hl-25-164><a class=lnlinks href=#hl-25-164>164</a>
</span><span class=lnt id=hl-25-165><a class=lnlinks href=#hl-25-165>165</a>
</span><span class=lnt id=hl-25-166><a class=lnlinks href=#hl-25-166>166</a>
</span><span class=lnt id=hl-25-167><a class=lnlinks href=#hl-25-167>167</a>
</span><span class=lnt id=hl-25-168><a class=lnlinks href=#hl-25-168>168</a>
</span><span class=lnt id=hl-25-169><a class=lnlinks href=#hl-25-169>169</a>
</span><span class=lnt id=hl-25-170><a class=lnlinks href=#hl-25-170>170</a>
</span><span class=lnt id=hl-25-171><a class=lnlinks href=#hl-25-171>171</a>
</span><span class=lnt id=hl-25-172><a class=lnlinks href=#hl-25-172>172</a>
</span><span class=lnt id=hl-25-173><a class=lnlinks href=#hl-25-173>173</a>
</span><span class=lnt id=hl-25-174><a class=lnlinks href=#hl-25-174>174</a>
</span><span class=lnt id=hl-25-175><a class=lnlinks href=#hl-25-175>175</a>
</span><span class=lnt id=hl-25-176><a class=lnlinks href=#hl-25-176>176</a>
</span><span class=lnt id=hl-25-177><a class=lnlinks href=#hl-25-177>177</a>
</span><span class=lnt id=hl-25-178><a class=lnlinks href=#hl-25-178>178</a>
</span><span class=lnt id=hl-25-179><a class=lnlinks href=#hl-25-179>179</a>
</span><span class=lnt id=hl-25-180><a class=lnlinks href=#hl-25-180>180</a>
</span><span class=lnt id=hl-25-181><a class=lnlinks href=#hl-25-181>181</a>
</span><span class=lnt id=hl-25-182><a class=lnlinks href=#hl-25-182>182</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>InventoryManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    재고 관리 클래스
</span></span></span><span class=line><span class=cl><span class=s2>    Repeatable Read 격리 수준을 사용하여 동시성 문제 해결
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection_params</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        데이터베이스 연결 매개변수 초기화
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection_params</span> <span class=o>=</span> <span class=n>connection_params</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_transaction</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>isolation_level</span><span class=o>=</span><span class=s2>&#34;REPEATABLE READ&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        트랜잭션 컨텍스트 매니저
</span></span></span><span class=line><span class=cl><span class=s2>        격리 수준을 설정하고 자동 커밋/롤백 처리
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 데이터베이스 연결 및 격리 수준 설정</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>connection_params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>set_isolation_level</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>psycopg2</span><span class=o>.</span><span class=n>extensions</span><span class=o>.</span><span class=n>ISOLATION_LEVEL_REPEATABLE_READ</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 트랜잭션 시작</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cursor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;BEGIN TRANSACTION ISOLATION LEVEL </span><span class=si>{</span><span class=n>isolation_level</span><span class=si>}</span><span class=s2>;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=n>cursor</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=c1># 성공 시 커밋</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;트랜잭션이 성공적으로 커밋되었습니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>Error</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 오류 발생 시 롤백</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;트랜잭션 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 연결 해제</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>,</span> <span class=n>quantity</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        주문 처리 메인 로직
</span></span></span><span class=line><span class=cl><span class=s2>        격리 수준을 통한 재고 일관성 보장
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_transaction</span><span class=p>()</span> <span class=k>as</span> <span class=n>cursor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 1. 현재 재고 조회 (Repeatable Read로 일관성 보장)</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;SELECT stock_quantity, product_name, price FROM products WHERE id = </span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=p>(</span><span class=n>product_id</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;상품 ID </span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>를 찾을 수 없습니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>current_stock</span><span class=p>,</span> <span class=n>product_name</span><span class=p>,</span> <span class=n>price</span> <span class=o>=</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;상품 &#39;</span><span class=si>{</span><span class=n>product_name</span><span class=si>}</span><span class=s2>&#39; 현재 재고: </span><span class=si>{</span><span class=n>current_stock</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 2. 재고 부족 검증</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>current_stock</span> <span class=o>&lt;</span> <span class=n>quantity</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=sa>f</span><span class=s2>&#34;재고 부족: 요청 수량 </span><span class=si>{</span><span class=n>quantity</span><span class=si>}</span><span class=s2>, 현재 재고 </span><span class=si>{</span><span class=n>current_stock</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 3. 재고 차감 (동시성 제어를 위한 WHERE 조건 추가)</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                    UPDATE products 
</span></span></span><span class=line><span class=cl><span class=s2>                    SET stock_quantity = stock_quantity - </span><span class=si>%s</span><span class=s2>,
</span></span></span><span class=line><span class=cl><span class=s2>                        updated_at = CURRENT_TIMESTAMP
</span></span></span><span class=line><span class=cl><span class=s2>                    WHERE id = </span><span class=si>%s</span><span class=s2> AND stock_quantity &gt;= </span><span class=si>%s</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>                    RETURNING stock_quantity
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>quantity</span><span class=p>,</span> <span class=n>product_id</span><span class=p>,</span> <span class=n>quantity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>updated_result</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>updated_result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;다른 트랜잭션에 의해 재고가 변경되었습니다. 재시도하세요.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>new_stock</span> <span class=o>=</span> <span class=n>updated_result</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 차감 완료: </span><span class=si>{</span><span class=n>current_stock</span><span class=si>}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=n>new_stock</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 4. 주문 정보 저장</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                    INSERT INTO orders (customer_id, product_id, quantity, 
</span></span></span><span class=line><span class=cl><span class=s2>                                      unit_price, total_amount, order_status, created_at)
</span></span></span><span class=line><span class=cl><span class=s2>                    VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, &#39;confirmed&#39;, CURRENT_TIMESTAMP)
</span></span></span><span class=line><span class=cl><span class=s2>                    RETURNING order_id
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>customer_id</span><span class=p>,</span> <span class=n>product_id</span><span class=p>,</span> <span class=n>quantity</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>price</span> <span class=o>*</span> <span class=n>quantity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>order_id</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 생성 완료: Order ID </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 5. 주문 상세 로그 기록</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                    INSERT INTO order_logs (order_id, action, description, created_at)
</span></span></span><span class=line><span class=cl><span class=s2>                    VALUES (</span><span class=si>%s</span><span class=s2>, &#39;order_created&#39;, </span><span class=si>%s</span><span class=s2>, CURRENT_TIMESTAMP)
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;상품 </span><span class=si>{</span><span class=n>product_name</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>quantity</span><span class=si>}</span><span class=s2>개 주문 확정&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;order_id&#39;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;product_name&#39;</span><span class=p>:</span> <span class=n>product_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=n>quantity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;remaining_stock&#39;</span><span class=p>:</span> <span class=n>new_stock</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;total_amount&#39;</span><span class=p>:</span> <span class=n>price</span> <span class=o>*</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 비즈니스 로직 오류</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>Error</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 데이터베이스 오류</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;데이터베이스 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=s1>&#39;시스템 오류가 발생했습니다.&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_inventory_status</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        재고 상태 조회 (Read Committed 사용으로 최신 정보 제공)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_transaction</span><span class=p>(</span><span class=s2>&#34;READ COMMITTED&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>cursor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                    SELECT product_name, stock_quantity, reserved_quantity,
</span></span></span><span class=line><span class=cl><span class=s2>                           (stock_quantity - reserved_quantity) as available_quantity
</span></span></span><span class=line><span class=cl><span class=s2>                    FROM products 
</span></span></span><span class=line><span class=cl><span class=s2>                    WHERE id = </span><span class=si>%s</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>product_id</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;product_name&#39;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;total_stock&#39;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;reserved_stock&#39;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;available_stock&#39;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 조회 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 데이터베이스 연결 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>db_params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;host&#39;</span><span class=p>:</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;database&#39;</span><span class=p>:</span> <span class=s1>&#39;ecommerce&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;user&#39;</span><span class=p>:</span> <span class=s1>&#39;postgres&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;password&#39;</span><span class=p>:</span> <span class=s1>&#39;password&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 재고 관리자 인스턴스 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>inventory_manager</span> <span class=o>=</span> <span class=n>InventoryManager</span><span class=p>(</span><span class=n>db_params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 처리 테스트</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>inventory_manager</span><span class=o>.</span><span class=n>process_order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>product_id</span><span class=o>=</span><span class=mi>101</span><span class=p>,</span>      <span class=c1># 상품 ID</span>
</span></span><span class=line><span class=cl>        <span class=n>quantity</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>          <span class=c1># 주문 수량</span>
</span></span><span class=line><span class=cl>        <span class=n>customer_id</span><span class=o>=</span><span class=mi>12345</span>    <span class=c1># 고객 ID</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 결과 출력</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 성공: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 실패: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>핵심 구현 포인트:</strong></p><ol><li><strong>격리 수준 설정</strong>: Repeatable Read 를 사용하여 재고 조회부터 차감까지 일관성 보장</li><li><strong>조건부 업데이트</strong>: WHERE 절에 재고 조건을 추가하여 동시성 문제 방지</li><li><strong>예외 처리</strong>: 비즈니스 로직 오류와 시스템 오류를 구분하여 처리</li><li><strong>로깅</strong>: 트랜잭션 과정을 상세히 기록하여 디버깅과 감사 지원</li><li><strong>컨텍스트 매니저</strong>: 자동 커밋/롤백 처리로 안전한 트랜잭션 관리</li></ol><h5 id=사례-은행-계좌-이체>사례: 은행 계좌 이체<a hidden class=anchor aria-hidden=true href=#사례-은행-계좌-이체>#</a></h5><p><strong>기본 시스템 구성:</strong> 사용자인터페이스 (앱), 트랜잭션 서비스/매니저, DBMS, 로그 및 동시성 제어 모듈, DB 저장소</p><pre class=mermaid>graph LR
    User --&gt; TM[Transaction Manager]
    TM --&gt; DB[&#34;Database (SERIALIZABLE)&#34;]
    TM --&gt; LOG[Logging System]
    DB -- LOCK/MVCC --&gt; DB
</pre><p><strong>Workflow:</strong></p><ol><li>사용자가 이체 수행 요청</li><li>트랜잭션 매니저가 트랜잭션 시작 (SERIALIZABLE 설정)</li><li>출금 계좌 차감, 입금 계좌 증가 단계별 수행 (둘 다 완료 시까지 데이터변경 미노출→다른 트랜잭션은 대기)</li><li>모든 연산 완료 후 커밋, 데이터 노출</li></ol><p><strong>유/무 차이점</strong></p><ul><li><strong>적용 시</strong>: 한쪽에서 트랜잭션 미완료 상태 데이터 접근 불가→이중지불 등 오류 완전차단</li><li><strong>미적용 시</strong>: 동시 트랜잭션이 서로 다른 데이터 참조→중복, 정합성 오류 가능</li></ul><p><strong>구현 예시</strong>: Python, 트랜잭션 격리수준별 시뮬레이션</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17>17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18>18</a>
</span><span class=lnt id=hl-27-19><a class=lnlinks href=#hl-27-19>19</a>
</span><span class=lnt id=hl-27-20><a class=lnlinks href=#hl-27-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 격리수준에 따른 읽기/쓰기 제한 시뮬레이션(간략화)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DummyDB</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=kc>False</span>  <span class=c1># 단순 잠금 시뮬레이션</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>read</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>isolation</span><span class=p>,</span> <span class=n>committed</span><span class=p>,</span> <span class=n>lock_held</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># isolation: &#39;uncommitted&#39;, &#39;committed&#39;, &#39;repeatable&#39;, &#39;serializable&#39;</span>
</span></span><span class=line><span class=cl>        <span class=c1># committed: 커밋 여부, lock_held: 타 트랜잭션 락 보유 여부</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>isolation</span> <span class=o>==</span> <span class=s2>&#34;uncommitted&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>isolation</span> <span class=o>==</span> <span class=s2>&#34;committed&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=k>if</span> <span class=n>committed</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>isolation</span> <span class=o>==</span> <span class=s2>&#34;repeatable&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span> <span class=k>if</span> <span class=n>committed</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>isolation</span> <span class=o>==</span> <span class=s2>&#34;serializable&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>lock_held</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>balance</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>None</span>  <span class=c1># 대기상태</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>각 격리수준별로 읽기허용 조건이 달라짐을 보여준다.</li></ul><h5 id=사례-금융권-대외-결제-시스템>사례: 금융권 대외 결제 시스템<a hidden class=anchor aria-hidden=true href=#사례-금융권-대외-결제-시스템>#</a></h5><p><strong>시나리오</strong>: <strong>금융권 대외 결제 시스템</strong>에서 격리 수준 변경에 따른 영향 실험</p><p><strong>구성 다이어그램</strong></p><pre class=mermaid>graph TB
    Client[결제 요청 API] --&gt; App[결제 처리 서비스]
    App --&gt; DB[(결제 DB Cluster)]
    DB --&gt; LockManager[분산 Lock Service]
</pre><p><strong>Workflow</strong></p><ol><li>결제 요청 1·2 동시에 유입</li><li>DB Isolation Level: <code>READ COMMITTED</code><br>→ 결제 잔액 확인 후 동시 승인 <strong>문제 발생 가능</strong></li><li>Isolation Level 변경: <code>SERIALIZABLE</code><br>→ 순차 처리, 중복 결제 방지</li></ol><p><strong>Python 예제 (PostgreSQL)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13>13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14>14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15>15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16>16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17>17</a>
</span><span class=lnt id=hl-29-18><a class=lnlinks href=#hl-29-18>18</a>
</span><span class=lnt id=hl-29-19><a class=lnlinks href=#hl-29-19>19</a>
</span><span class=lnt id=hl-29-20><a class=lnlinks href=#hl-29-20>20</a>
</span><span class=lnt id=hl-29-21><a class=lnlinks href=#hl-29-21>21</a>
</span><span class=lnt id=hl-29-22><a class=lnlinks href=#hl-29-22>22</a>
</span><span class=lnt id=hl-29-23><a class=lnlinks href=#hl-29-23>23</a>
</span><span class=lnt id=hl-29-24><a class=lnlinks href=#hl-29-24>24</a>
</span><span class=lnt id=hl-29-25><a class=lnlinks href=#hl-29-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># DB 연결</span>
</span></span><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dbname</span><span class=o>=</span><span class=s2>&#34;payment&#34;</span><span class=p>,</span> <span class=n>user</span><span class=o>=</span><span class=s2>&#34;admin&#34;</span><span class=p>,</span> <span class=n>password</span><span class=o>=</span><span class=s2>&#34;pass&#34;</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>transfer_funds</span><span class=p>(</span><span class=n>from_acc</span><span class=p>,</span> <span class=n>to_acc</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    계좌 이체 함수
</span></span></span><span class=line><span class=cl><span class=s2>    - Serializable 격리 수준에서 중복 결제 방지
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cur</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT balance FROM accounts WHERE id=</span><span class=si>%s</span><span class=s2> FOR UPDATE;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>from_acc</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>            <span class=n>balance</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>balance</span> <span class=o>&gt;=</span> <span class=n>amount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE accounts SET balance = balance - </span><span class=si>%s</span><span class=s2> WHERE id=</span><span class=si>%s</span><span class=s2>;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>amount</span><span class=p>,</span> <span class=n>from_acc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE accounts SET balance = balance + </span><span class=si>%s</span><span class=s2> WHERE id=</span><span class=si>%s</span><span class=s2>;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>amount</span><span class=p>,</span> <span class=n>to_acc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;잔액 부족&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 트랜잭션 시뮬레이션</span>
</span></span><span class=line><span class=cl><span class=n>transfer_funds</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=통합-및-연계-기술>통합 및 연계 기술<a hidden class=anchor aria-hidden=true href=#통합-및-연계-기술>#</a></h4><table><thead><tr><th>카테고리</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td><strong>명령/조회 분리 (CQRS)</strong></td><td>쓰기 모델과 읽기 모델을 분리하여 성능과 일관성을 최적화</td><td>Command 모델, Query 모델, Projection</td><td>읽기 전용 DB 복제, 쓰기/읽기 경로 분리</td><td>읽기 성능 극대화, 확장성 확보</td><td>읽기 트래픽이 많은 시스템, 분석/보고 시스템</td><td>읽기 격리 수준을 낮춰 성능 ↑, 쓰기는 높은 격리 수준 유지</td></tr><tr><td><strong>분산 트랜잭션 관리 (Saga)</strong></td><td>긴 트랜잭션을 서비스 단위로 분리하고 보상 트랜잭션으로 롤백</td><td>Saga Coordinator, Participant Services</td><td>Choreography/Orchestration 방식</td><td>서비스 간 데이터 일관성 유지</td><td>마이크로서비스 기반 주문·결제·재고 처리</td><td>단계별 Isolation Level 설정 가능, 최종 일관성 지향</td></tr><tr><td><strong>이벤트 기반 아키텍처 (Event Sourcing / Outbox / CDC)</strong></td><td>상태 변화를 이벤트로 기록하고 비동기 전파</td><td>Event Store, Outbox Table, Kafka, Debezium</td><td>Append-only 로그, CDC</td><td>데이터 변경의 추적성과 재생성 보장</td><td>데이터 감사, 이력 추적, 비동기 통합</td><td>Isolation Level 을 SERIALIZABLE 로 설정 시 이벤트 순서 보장</td></tr><tr><td><strong>인프라/플랫폼 연계</strong></td><td>DB 격리 수준을 클라우드/분산 환경에서 유지</td><td>클라우드 DB 서비스, DB Proxy</td><td>Multi-Region Replication, Proxy 기반 라우팅</td><td>격리 수준 일관성 보장</td><td>멀티 리전, 하이브리드 클라우드 DB 환경</td><td>DB 설정·Proxy 라우팅·격리 수준 동기화 필요</td></tr></tbody></table><p>통합 및 연계 기술은 <strong>로컬 DB 내의 격리성 보장</strong>을 넘어, <strong>분산 아키텍처 전반의 데이터 일관성</strong>을 달성하는 데 초점이 있다.</p><ul><li><strong>CQRS</strong>는 읽기/쓰기 격리 수준을 다르게 적용해 성능과 일관성의 균형을 맞춘다.</li><li><strong>Saga</strong>는 서비스 간 분산 트랜잭션에서 단계별 Isolation Level 조정으로 유연성을 높인다.</li><li><strong>Event Sourcing / Outbox / CDC</strong>는 이벤트 순서와 무결성을 유지해 비동기 처리에서도 데이터 신뢰성을 확보한다.</li><li><strong>인프라 연계</strong>는 멀티 리전·클라우드 환경에서 격리 수준 설정을 표준화하고 일관성을 유지하는 기술이다.</li></ul><h3 id=운영-및-최적화-operations--optimization>운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#운영-및-최적화-operations--optimization>#</a></h3><h4 id=보안-및-거버넌스>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스>#</a></h4><table><thead><tr><th>영역</th><th>목표</th><th>핵심 통제</th><th>구현 예 (정책/기술)</th><th>모니터링/증빙</th><th>비고</th></tr></thead><tbody><tr><td>정책·권한</td><td>적정 격리·최소권한</td><td>역할/데이터등급 기반 <strong>격리 자동 결정</strong>, SoD</td><td><code>SET TRANSACTION</code> 권한 최소화, 커넥션풀 프로파일, Break-glass</td><td>격리 변경 감사, 권한 변경 이력</td><td>RU 는 운영에서 차단 권장</td></tr><tr><td>데이터 보호</td><td>PII/민감정보 보호</td><td>암호화/마스킹/레드액션/토큰화</td><td>TDE+KMS, 컬럼 암호화, RLS, 동적 마스킹, 백업/스냅샷 암호화</td><td>키 회전 로그, 접근 시도, 백업 복원 테스트</td><td>로그·버전스토어에도 동일 적용</td></tr><tr><td>감사·가시성</td><td>추적성/책임성</td><td>DDL/DML/격리 변경/장기 Tx/에러 전부 로깅</td><td>구조화 감사 로그 + SIEM, 데드락 그래프, 쿼리 지문</td><td>경보: 격리 하향·RU 시도·데드락 급증·직렬화 실패율</td><td>불변 저장 (WORM/서명)</td></tr><tr><td>운영 가드레일</td><td>안정성/무결성</td><td>기본 RC/RCSI, 임계 구간만 Serializable/SSI, 긴 Tx 제한</td><td>정책 엔진으로 자동 적용, Tx 타임아웃, 재시도/멱등, RU 비활성</td><td>p95/99 지연, 락 대기, 버전스토어 사용률, 실패율</td><td>카나리/롤백 플랜 포함</td></tr><tr><td>규정 맵핑</td><td>준거성</td><td>표준 요구 통제 충족</td><td>PCI: 암호화/접근/로깅, GDPR: 최소화/파기, HIPAA: 접근/감사, SOX: 변경통제</td><td>주기적 검증·감사 리포트</td><td>규정이 <strong>격리 레벨 자체를 직접 요구하진 않음</strong></td></tr></tbody></table><h5 id=격리-수준-관련-미세-가드레일>격리 수준 관련 미세 가드레일<a hidden class=anchor aria-hidden=true href=#격리-수준-관련-미세-가드레일>#</a></h5><table><thead><tr><th>상황</th><th>권장</th><th>차단/경보</th></tr></thead><tbody><tr><td>운영 트래픽 기본</td><td>RC 또는 RCSI</td><td>RU 사용</td></tr><tr><td>보고/분석</td><td>스냅샷/읽기 복제</td><td>운영 DB 에서 RU</td></tr><tr><td>핵심 규칙 구간 (결제/원장/재고)</td><td>짧은 <strong>Serializable/SSI</strong></td><td>장기 Serializable</td></tr><tr><td>대량 배치</td><td>오프피크·배치 창 분리</td><td>피크 타임 직렬화 강화</td></tr></tbody></table><ul><li>격리는 <strong>보안의 일부</strong>일 뿐, <strong>접근 통제·암호화·감사·변경관리</strong>와 <strong>세트</strong>로 운영될 때만 거버넌스 요구를 충족한다.</li><li>운영에서는 <strong>RC/RCSI 이상</strong>을 기본으로 하고, <strong>핵심 구간만 Serializable/SSI</strong>로 짧게 보호하라. RU 는 <strong>운영에서 금지</strong>하고 분석은 <strong>스냅샷/복제</strong>로 분리한다.</li><li>PII 는 <strong>로그/버전스토어/백업</strong>까지 흘러들어간다. <strong>키관리·보존/파기·마스킹</strong>을 일관되게 적용하고, <strong>격리 하향/비정상 패턴</strong>을 실시간 경보로 묶어 <strong>추적성과 책임성</strong>을 확보하라.</li></ul><h4 id=모니터링-및-관측성>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성>#</a></h4><table><thead><tr><th>카테고리</th><th>핵심 지표</th><th>수집 원천/방법</th><th>기준·임계 (예시)</th><th>알림/대응 가이드</th></tr></thead><tbody><tr><td>지연/처리량</td><td>P95/P99 트랜잭션 지연 (iso 별), TPS</td><td>APM/Prometheus, pg_stat_statements/DMV</td><td>베이스라인 +30% 이상 10 분 지속</td><td>슬로우 쿼리 캡처, 인덱스/플랜 점검, 격리 하향 검토</td></tr><tr><td>락/대기</td><td>총 락 대기 시간, 대기 비율, 데드락 수, 블로킹 트리</td><td>pg_locks/Performance Schema/DMV, AWR</td><td>데드락/분 > 베이스라인×2</td><td>락 순서 규칙 확인, 트랜잭션 범위 축소, 타임아웃 조정</td></tr><tr><td>MVCC/버전</td><td>버전 스토어 사용량, 스냅샷 age, Vacuum/GC 지연</td><td>PG: xid/age/Vacuum, SS: version store DMV</td><td>사용량 임계 (스토리지 70%)/age 임계</td><td>Vacuum/GC 튜닝, 장수 Tx 탐지·종료, 배치 분리</td></tr><tr><td>정합성/재시도</td><td>직렬화 실패율 (40001), 커밋 충돌률, 재시도 성공률</td><td>앱 로그/메트릭, DB 오류 코드</td><td>실패율 > 5% 또는 급증</td><td>멱등키/재시도 백오프 적용, 핫스팟 파티셔닝</td></tr><tr><td>트랜잭션 수명</td><td>평균/최대 Tx 지속 시간, 장수 Tx 수</td><td>pg_stat_activity, innodb_trx, DMVs</td><td>최대 Tx > N 분</td><td>장수 Tx 원인 추적 (리포트/수정), 쿼리 분할</td></tr><tr><td>복제/스냅샷</td><td>레플리카 지연, CDC 지연, 스냅샷 시각 드리프트</td><td>DB 리플리카 지표/CDC 커넥터</td><td>지연 > SLO</td><td>읽기 라우팅 조정, 리소스 증설, 배치 창 조정</td></tr><tr><td>분산 추적</td><td>Trace/Span 수, 에러율, 태그</td><td>OpenTelemetry, W3C Trace Context</td><td>에러율 급증</td><td>문제 스팬 드릴다운, 서비스 경계 확인</td></tr></tbody></table><p>관측성은 <strong>격리 수준의 선택 효과를 수치로 검증</strong>하는 장치다.<br>락 중심 문제는 <strong>대기·데드락·블로킹 트리</strong>, MVCC 문제는 <strong>버전 스토어·스냅샷 age·재시도율</strong>로 드러난다.<br>모든 신호는 <code>isolation.level</code> 태그로 구분하고, <strong>베이스라인 편차 기반 알림</strong>과 <strong>재시도·멱등성·장수 Tx 억제</strong>를 표준 대응으로 삼아라.<br>이 체계를 대시보드·로그·트레이싱에 일관되게 적용하면, 격리 수준 변화가 <strong>지표와 SLO</strong>에 미치는 영향을 빠르게 파악하고 안정적으로 운영할 수 있다.</p><h4 id=실무-적용-고려사항-및-주의점>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점>#</a></h4><ul><li><strong>Tx 는 짧게, 외부호출은 밖으로</strong>: 트랜잭션 내 네트워크 호출 금지. 비즈니스 단계는 <strong>작은 Tx</strong>로 잘게 쪼개고 배치는 오프피크로.</li><li><strong>락은 국소화·예측가능하게</strong>: 잠금 순서 규약으로 데드락 확률을 낮추고, 범위 잠금이 필요한 경우 <strong>인덱스를 먼저 설계</strong>해 갭락 범위를 최소화. 핫키는 샤딩/큐로 분산.</li><li><strong>실패는 정상 경로</strong>: Serializable/SSI·데드락은 재시도 전제. <strong>지수백오프 + 지터</strong>와 <strong>멱등키/조건부 갱신</strong>으로 안전 재시도.</li><li><strong>읽기는 스냅샷·쓰기 규칙은 강화</strong>: 기본 RC/RCSI 로 읽기 비차단, 결제·원장·재고 같은 핵심 규칙 구간만 RR+ 범위락 또는 Serializable/SSI 로 <strong>짧게</strong> 보호.</li><li><strong>관측가능성을 기본 설계에</strong>: p95/99 지연·락 대기·데드락/직렬화 실패율·버전 스토어 사용률을 1 급 시민 지표로 대시보드화, 격리 수준 라벨을 붙여 상관관계 분석.</li><li><strong>환경 일치와 점진 배포</strong>: Stage 에서 <strong>Prod 동등 격리/데이터 규모</strong>로 테스트, 카나리/롤백 플랜을 기본으로.</li></ul><table><thead><tr><th>카테고리</th><th>고려사항</th><th>위험/증상</th><th>권장 실천 (액션)</th><th>기본값/임계 제안</th><th>관측 시그널</th></tr></thead><tbody><tr><td>A. Tx 경계/길이</td><td>장기 Tx, 외부 호출 포함</td><td>버전 스토어 압박, 락 홀드↑</td><td><strong>장기 Tx 금지</strong>, 배치 분할, 외부 호출은 Tx 밖</td><td>Tx 타임아웃 15–30s, 문 5–10s</td><td>long_tx_count, version_store_usage</td></tr><tr><td>B. 락/경합</td><td>핫키/갭락 경합, 데드락</td><td>p95/99↑, 롤백↑</td><td>잠금 순서 규약, 샤딩/키 해싱, <code>FOR UPDATE</code> 범위 최소화, <code>SKIP LOCKED</code></td><td>핫파티션 ≤ 전체의 1–5%</td><td>lock_wait_ms, deadlock_rate</td></tr><tr><td>C. 재시도·멱등</td><td>직렬화/데드락</td><td>사용자 체감 지연↑</td><td><strong>지수백오프 + 지터</strong>, 최대 재시도 N 회, 멱등키/조건부 갱신</td><td>backoff=2^n±jitter, N=3~5</td><td>serialization_failure_rate</td></tr><tr><td>D. 인덱스/쿼리</td><td>범위 스캔, 계획 변동</td><td>갭락 범위↑, 경합↑</td><td>범위쿼리 인덱스, 커버링, 힌트 최소화, 통계 최신화</td><td>중요 범위쿼리 전용 인덱스 1~2 개</td><td>plan_hash_change, rows_scanned</td></tr><tr><td>E. 격리 전략</td><td>과도한 직렬화</td><td>TPS↓, Abort↑</td><td>기본 RC/RCSI, <strong>핵심 구간만</strong> RR+ 범위락/Serializable(짧게)</td><td>직렬화 구간 100–300ms 내</td><td>serialization_abort_count</td></tr><tr><td>F. 모니터링</td><td>맹점/지연 급등</td><td>장애 파급</td><td>p95/99·락 대기·데드락·버전 스토어 <strong>대시보드 + 알림</strong></td><td>p95 +30%/10m, deadlock >0.5%</td><td>SLO breaches, alerts fired</td></tr><tr><td>G. 환경/배포</td><td>Stage≠Prod, 무리한 일괄 적용</td><td>출시 후 성능 이슈</td><td>동등 격리·데이터 규모로 부하 테스트, 카나리/롤백</td><td>카나리 5–10%, 자동 롤백</td><td>error_budget_burn, canary_diff</td></tr></tbody></table><h4 id=최적화하기-위한-고려사항-및-권장사항>최적화하기 위한 고려사항 및 권장사항<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-권장사항>#</a></h4><table><thead><tr><th>카테고리</th><th>고려 사항</th><th>위험/증상</th><th>권장 조치 (핵심)</th><th>체크리스트/지표</th></tr></thead><tbody><tr><td>설계/스키마</td><td>파티셔닝·샤딩</td><td>핫키 경합, 광범위 락</td><td>해시/범위 파티션, 키 랜덤화</td><td>Top-N 핫키, 파티션 스캔 비율</td></tr><tr><td></td><td>인덱스 전략</td><td>풀스캔→락 범위↑</td><td>커버링/부분 인덱스, 선택도 개선</td><td>계획의 Rows/Filter, 인덱스 히트율</td></tr><tr><td></td><td>제약/유니크</td><td>중복/경합</td><td>UNIQUE/EXCLUDE 제약 활용</td><td>제약 위반률, 실패 로그</td></tr><tr><td>트랜잭션/동시성</td><td>트랜잭션 길이</td><td>장수 Tx, 버전 폭증</td><td>외부 호출 분리, 필요한 쿼리만</td><td>Tx 평균/최대 시간, snapshot age</td></tr><tr><td></td><td>격리 수준</td><td>처리량 저하</td><td>기본 RC/RCSI, 핵심만 RR/SR</td><td>iso 별 P95/99, TPS 변화</td></tr><tr><td></td><td>데드락/충돌</td><td>재시도 폭증</td><td>락 순서 규칙, 타임아웃, 멱등성</td><td>데드락/분, 40001 율, 재시도 성공률</td></tr><tr><td>읽기/쓰기 경로</td><td>읽기 - 쓰기 분리</td><td>마스터 과부하</td><td>리드 레플리카·캐시·서머리</td><td>레플리카 지연, 캐시 히트율</td></tr><tr><td></td><td>신선도 예산</td><td>오래된 읽기</td><td>SLA 로 스냅샷 허용치 명세</td><td>staleness(ms), 불일치 이슈율</td></tr><tr><td>MVCC/GC</td><td>버전 저장소</td><td>GC 지연, 공간 압박</td><td>Vacuum/GC 주기·한계 조정</td><td>버전 사용량, vacuum lag</td></tr><tr><td>배치/분산</td><td>대량 배치</td><td>락 홀딩/스파이크</td><td>청크/스로틀링/윈도우</td><td>배치 TPS/지연, 충돌률</td></tr><tr><td></td><td>글로벌 일관성</td><td>2PC 병목</td><td>Outbox+CDC, Saga</td><td>outbox 적체, 재처리율</td></tr><tr><td>운영/관측성</td><td>SLO/알림</td><td>오탐/미탐</td><td>베이스라인 편차 알림 + 절대 임계</td><td>iso 태그별 메트릭, 경보 피드백</td></tr></tbody></table><p>핵심은 <strong>기본은 RC/RCSI</strong>, <strong>핵심 경로만 부분 직렬화</strong>, 그리고 <strong>구조적 설계 (파티션·인덱스·제약)</strong> 로 경합을 원천 차단.<br>MVCC 를 쓰면 <strong>버전/GC 와 재시도·멱등성</strong>, 락을 쓰면 <strong>락 순서·타임아웃</strong>이 생명줄이 된다.<br>읽기는 <strong>레플리카·캐시</strong>로 떼어내고, 배치는 <strong>윈도우/청크/스로틀링</strong>으로 평탄화.<br>마지막으로, 모든 지표에 <code>isolation.level</code> 태그를 달아 <strong>격리 변경의 효과</strong>를 수치로 확인하는 습관이 최적화의 지름길.</p><h3 id=고급-주제-advanced-topics>고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#고급-주제-advanced-topics>#</a></h3><h4 id=현재-도전-과제>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제>#</a></h4><table><thead><tr><th>카테고리</th><th>원인</th><th>영향</th><th>대표 증상/지표</th><th>권장 해결전략</th><th>적용 팁</th></tr></thead><tbody><tr><td>클라우드 네이티브</td><td>오토스케일·버스트</td><td>커넥션·락 스파이크</td><td>P99 지연↑, 커넥션 소진</td><td>풀 상한/쿼터, 백프레셔, 적응적 격리, 서킷 브레이커</td><td>중요 경로만 SR, 나머지는 RC/RCSI</td></tr><tr><td>멀티리전/분산 Tx</td><td>RTT/분할, CAP</td><td>직렬화 비용/지연↑</td><td>글로벌 Tx 대기↑</td><td>리전 내 직렬화 + 글로벌 EC, Saga/Outbox, 키 라우팅</td><td>리전 스티키 읽기, 재시도·멱등성</td></tr><tr><td>MVCC/SI 이슈</td><td>write-skew, 장수 Tx</td><td>충돌/abort↑, GC 압력</td><td>40001 율↑, snapshot age↑</td><td>SSI/제약, 장수 Tx 억제, 버전스토어 모니터링</td><td>배치 윈도우·청크 처리</td></tr><tr><td>락 이슈</td><td>범위쿼리·핫키</td><td>데드락·경합↑</td><td>데드락/분, 락 대기율↑</td><td>락 순서, 쿼리 재작성, 커버링 인덱스, 타임아웃</td><td>Next-Key 사용 최소화</td></tr><tr><td>이식성</td><td>벤더별 구현차</td><td>동작/성능 변동</td><td>환경 전환 시 장애</td><td>표준 우선, 사전 벤치/합의 테스트, 폴백</td><td>락 힌트/리트라이 전략 준비</td></tr><tr><td>관측성</td><td>단절된 메트릭</td><td>원인 추적 지연</td><td>알림 오탐/미탐</td><td>통합 태깅·대시보드, 편차 기반 알림</td><td><code>isolation.level</code> 전파</td></tr><tr><td>신선도/레플리카</td><td>복제·CDC 지연</td><td>오래된 읽기</td><td>replica lag↑</td><td>신선도 예산·라우팅, CQRS/서머리, 핵심만 SR</td><td>&ldquo;read-your-writes&rdquo; 보장 경로 분리</td></tr></tbody></table><ul><li><strong>핵심 경로만 직렬화</strong>, 나머지는 <strong>RC/RCSI/SI</strong>로 운영하며 <strong>재시도·멱등성·펜싱 토큰</strong>으로 복원력을 확보.</li><li>멀티리전은 <strong>영역 내 강한 일관성 + 글로벌 최종 일관성</strong>을 교차 적용해 <strong>지연/비용</strong>을 통제.</li><li>MVCC 는 <strong>버전/GC/abort 율</strong>, 락은 <strong>대기/데드락/블로킹 트리</strong>로 상태가 드러난다. 이를 <strong>공통 태깅과 베이스라인 편차 알림</strong>으로 지속 관찰.</li><li>오토스케일 환경에서는 <strong>커넥션·락 가드레일</strong>과 <strong>큐/백프레셔</strong>가 성능 스파이크의 안전장치.</li></ul><h4 id=생태계-및-관련-기술>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술>#</a></h4><table><thead><tr><th>카테고리</th><th>정의</th><th>대표 예시</th><th>원리/기술 요소</th><th>목적</th><th>특징</th></tr></thead><tbody><tr><td><strong>DBMS 계열별 격리 수준 구현</strong></td><td>DB 유형별 격리 수준 및 구현 방식</td><td>PostgreSQL, MySQL, CockroachDB, MongoDB, Neo4j, Redis</td><td>MVCC, 2PL, SSI, RCSI, Range Lock</td><td>성능·일관성 균형</td><td>관계형·NewSQL 은 표준 4 단계 지원, NoSQL 은 특화 격리</td></tr><tr><td><strong>격리 관련 핵심 기술</strong></td><td>동시성 제어 및 팬텀 방지 기술</td><td>Predicate Lock, Gap Lock, SSI, MVCC</td><td>Lock 기반/버전 기반 동시성 제어</td><td>팬텀·Dirty Read 방지</td><td>고성능과 강한 일관성 동시 추구</td></tr><tr><td><strong>메시징 및 이벤트 스트리밍</strong></td><td>비동기 데이터 전파 및 최종 일관성 유지</td><td>Kafka, Outbox Pattern, CDC(Debezium)</td><td>트랜잭션 후 이벤트 발행</td><td>분산 환경 데이터 동기화</td><td>Exactly-once 전달, 장애 복구 용이</td></tr><tr><td><strong>컨테이너 및 클라우드 네이티브 환경</strong></td><td>분산·멀티리전 환경 격리 수준 유지</td><td>Kubernetes, DB Operator</td><td>환경변수 기반 격리 수준 설정</td><td>환경별 성능·일관성 튜닝</td><td>CI/CD 파이프라인 통합 용이</td></tr><tr><td><strong>표준 API 및 프로토콜</strong></td><td>DB 와 애플리케이션 간 일관된 격리 수준 설정</td><td>JDBC, ODBC, gRPC, ANSI SQL</td><td>API 호출 시 격리 수준 파라미터 지정</td><td>이식성·호환성 확보</td><td>멀티 벤더 환경 지원</td></tr></tbody></table><p>격리 수준 생태계는 <strong>DB 내부 기술</strong>과 <strong>외부 연계 기술</strong>로 나눌 수 있다.</p><ul><li><strong>DBMS 계열별</strong>로 MVCC·2PL·SSI 등 구현 방식이 다르며, RDB·NewSQL 은 표준 격리 수준을 완전 지원하는 반면, NoSQL 은 특화된 모델을 사용한다.</li><li><strong>핵심 동시성 제어 기술</strong>은 팬텀, Dirty Read 를 방지하며 성능 저하 없이 일관성을 유지하는 데 필수적이다.</li><li><strong>메시징/스트리밍 시스템</strong>은 트랜잭션 격리와 이벤트 전달을 연결해 분산 환경에서도 데이터 일관성을 보장한다.</li><li><strong>컨테이너/클라우드 환경</strong>에서는 환경별 격리 수준 정책을 중앙에서 관리하며 멀티 리전에 걸친 일관성 유지가 중요하다.</li><li><strong>표준 API/프로토콜</strong>은 애플리케이션 이식성과 멀티 DB 지원의 기반을 제공한다.</li></ul><h5 id=현대적-데이터베이스-생태계와의-통합>현대적 데이터베이스 생태계와의 통합<a hidden class=anchor aria-hidden=true href=#현대적-데이터베이스-생태계와의-통합>#</a></h5><table><thead><tr><th>데이터베이스 유형</th><th>대표 제품</th><th>격리 수준 지원</th><th>연계 기술</th><th>특별한 특징</th></tr></thead><tbody><tr><td><strong>관계형 DB</strong></td><td>PostgreSQL, MySQL</td><td>표준 4 단계 완전 지원</td><td>JDBC, JPA, MyBatis</td><td>MVCC, 2PL 하이브리드</td></tr><tr><td><strong>NewSQL</strong></td><td>CockroachDB, TiDB</td><td>표준 + 확장 격리 수준</td><td>분산 SQL 드라이버</td><td>분산 ACID 트랜잭션</td></tr><tr><td><strong>NoSQL 문서형</strong></td><td>MongoDB, CouchDB</td><td>문서 레벨 격리</td><td>ODM, REST API</td><td>Multi-Document 트랜잭션</td></tr><tr><td><strong>NoSQL 그래프</strong></td><td>Neo4j, Amazon Neptune</td><td>그래프 트래버설 격리</td><td>Gremlin, Cypher</td><td>경로 기반 일관성</td></tr><tr><td><strong>시계열 DB</strong></td><td>InfluxDB, TimescaleDB</td><td>시간 기반 격리</td><td>시계열 API</td><td>시간 윈도우 격리</td></tr><tr><td><strong>인메모리 DB</strong></td><td>Redis, Hazelcast</td><td>메모리 레벨 격리</td><td>클러스터링 API</td><td>분산 잠금 메커니즘</td></tr></tbody></table><h4 id=최신-기술-트렌드와-미래-방향>최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드와-미래-방향>#</a></h4><table><thead><tr><th>카테고리</th><th>핵심 아이디어</th><th>성숙도 (2025)</th><th>대표 기술/레퍼런스</th><th>격리에 주는 영향</th></tr></thead><tbody><tr><td>A. WASM·엣지 DB</td><td>브라우저/엣지에서 로컬 또는 근거리 DB 실행 (OPFS·리플리카)</td><td><strong>상용/일반화</strong></td><td>SQLite-WASM(OPFS), DuckDB-Wasm, Cloudflare D1, Turso, Neon Serverless Driver</td><td>읽기 지연↓, 오프라인 스냅샷/RC 실용화, 핵심 구간만 강화하는 하이브리드 설계 촉진</td></tr><tr><td>B. 강한 격리</td><td>분산 환경에서 Serializable/Strict Serializable/External Consistency</td><td><strong>상용/성숙</strong></td><td>FoundationDB, CockroachDB, Google Spanner(TrueTime)</td><td>강한 일관성 확보, <strong>재시도 전제 운영</strong>(Abort→Backoff) 패턴 표준화</td></tr><tr><td>C. 결정적/락프리</td><td>결정적 스케줄링, 래치 - 프리 인덱스 (Bw-Tree)</td><td><strong>연구→부분상용</strong></td><td>Calvin, MS Hekaton(Bw-Tree)</td><td>고경합 시 스루풋↑, 락 대기·컨텍스트 스위치↓</td></tr><tr><td>D. AI/ML 자율 운영</td><td>자동 튜닝·인덱스·플랜 추천/적용</td><td><strong>상용/확산중</strong></td><td>Azure Automatic Tuning, NoisePage(연구)</td><td>격리 자체의 자동 전환은 제한적, 대신 <strong>격리로 인한 비용을 주변에서 최소화</strong></td></tr><tr><td>E. 관측성/도구화</td><td>직렬화 충돌·락 경합 분리 관측, 엣지 최적화 드라이버</td><td><strong>상용/일반화</strong></td><td>Cockroach Contention Insights, Neon Serverless Driver</td><td>격리 이슈의 <strong>근본 원인 탐지/튜닝 사이클 단축</strong></td></tr><tr><td>F. 양자·미래</td><td>얽힘/양자컴퓨팅을 격리에 적용</td><td><strong>연구/비상용</strong></td><td>무통신 정리 (이론)</td><td>FTL 불가 → <strong>직접 격리 개선엔 한계</strong>, 현재는 참고 수준</td></tr></tbody></table><ul><li><strong>WASM·엣지</strong>는 &ldquo;<strong>가까이에 놓고 읽자</strong>&rdquo; 전략으로 지연을 줄이고, 오프라인/리플리카 조합으로 읽기 격리를 안전하게 끌어올린다.</li><li><strong>강한 격리</strong>는 특정 분산 DB 에서 <strong>현실적으로 사용 가능</strong>하며, 재시도·멱등·핫구간 국소화가 운영의 핵심 패턴이다.</li><li><strong>결정적/락프리</strong>는 경합을 구조적으로 줄이는 방향으로 연구가 누적되어 실전에도 영향을 주는 중이다.</li><li><strong>AI/ML</strong>은 격리 그 자체보다 <strong>격리로 인한 비용 (플랜/인덱스/노브) 을 자동으로 줄이는</strong> 역할로 상용화되었다.</li><li><strong>관측성</strong>은 " 락 대기 vs 직렬화 충돌 " 을 분리 관찰해 <strong>정확히 어디서 막히는지</strong>를 보여주는 쪽으로 발전했다.</li><li><strong>양자</strong>는 현재로선 물리 법칙 (무통신 정리) 때문에 <strong>직접적 격리 해법이 되기 어렵다</strong>—장기적 탐색 주제 정도로만 바라보면 된다.</li></ul><h4 id=mvcc-multi-version-concurrency-control-다중-버전-동시성-제어-심화>MVCC (Multi-Version Concurrency Control, 다중 버전 동시성 제어) 심화<a hidden class=anchor aria-hidden=true href=#mvcc-multi-version-concurrency-control-다중-버전-동시성-제어-심화>#</a></h4><ul><li><strong>원리</strong>: 하나의 데이터에 대해 여러 시점의 버전을 저장하여, 읽기 작업이 쓰기 작업을 블로킹 (block) 하지 않도록 함</li><li><strong>장점</strong><ul><li>읽기 성능 극대화 (대부분의 조회 쿼리가 잠금에 걸리지 않음)</li><li>쓰기와 읽기 트랜잭션의 충돌 최소화</li></ul></li><li><strong>대표 적용 DBMS</strong><ul><li>PostgreSQL, MySQL InnoDB, Oracle, TiDB 등</li></ul></li><li><strong>실무 주의사항</strong><ul><li>오래 지속되는 트랜잭션이 많으면 버전 데이터가 쌓여 <strong>VACUUM(정리 작업)</strong> 비용 증가</li><li>PostgreSQL 은 <code>autovacuum</code> 기능, MySQL 은 Undo Log 관리 필요</li></ul></li></ul><h4 id=분산-트랜잭션-환경에서의-격리-수준>분산 트랜잭션 환경에서의 격리 수준<a hidden class=anchor aria-hidden=true href=#분산-트랜잭션-환경에서의-격리-수준>#</a></h4><ul><li><strong>문제점</strong>: Cross-shard / Cross-region 환경에서 Serializable 엄격 격리를 구현하면 지연 (latency)·비용이 급증</li><li><strong>해결책</strong><ol><li><strong>분산 락 서비스</strong> (예: Zookeeper, etcd)</li><li><strong>2 단계 커밋 (Two-Phase Commit, 2PC)</strong></li><li><strong>분산 MVCC</strong></li></ol></li><li><strong>사용 기술 예시</strong><ul><li>Google Spanner: TrueTime API 로 글로벌 일관성 유지</li><li>CockroachDB: Serializable 격리 기본 제공, 분산 MVCC 방식</li></ul></li></ul><h4 id=격리-수준-자동-조정-adaptive-isolation>격리 수준 자동 조정 (Adaptive Isolation)<a hidden class=anchor aria-hidden=true href=#격리-수준-자동-조정-adaptive-isolation>#</a></h4><p><strong>원리</strong>: 쿼리 패턴·트랜잭션 충돌 빈도·성능 지표에 따라 DBMS 가 동적 격리 수준 조정</p><p><strong>예시</strong></p><ul><li>충돌율 낮으면 Read Committed, 높아지면 Repeatable Read 로 승격</li></ul><p><strong>연구 동향</strong></p><ul><li>AI/머신러닝 기반 DB 튜너가 Isolation Level 을 실시간 조절</li></ul><p><strong>Adaptive Isolation(자동 격리 수준 조절) 알고리즘 예시</strong>:</p><p><strong>설계 개념</strong>:</p><ul><li>실서비스에서는 부하 (Load), 오류율, 충돌율에 따라 <strong>동적으로 격리 수준을 변경</strong>할 수 있음</li><li>목적: <strong>성능 (Performance) 과 무결성 (Consistency) 을 모두 만족</strong>하는 최적점 유지</li></ul><p><strong>의사 코드 (Pseudo-Code)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12>12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13>13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14>14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15>15</a>
</span><span class=lnt id=hl-30-16><a class=lnlinks href=#hl-30-16>16</a>
</span><span class=lnt id=hl-30-17><a class=lnlinks href=#hl-30-17>17</a>
</span><span class=lnt id=hl-30-18><a class=lnlinks href=#hl-30-18>18</a>
</span><span class=lnt id=hl-30-19><a class=lnlinks href=#hl-30-19>19</a>
</span><span class=lnt id=hl-30-20><a class=lnlinks href=#hl-30-20>20</a>
</span><span class=lnt id=hl-30-21><a class=lnlinks href=#hl-30-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Adaptive Isolation Controller</span>
</span></span><span class=line><span class=cl><span class=c1># 이 코드는 트랜잭션 충돌률과 응답 시간에 따라 DB 격리 수준을 자동 조정하는 예시입니다.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>adaptive_isolation</span><span class=p>(</span><span class=n>current_conflict_rate</span><span class=p>,</span> <span class=n>avg_response_time</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    current_conflict_rate: 최근 1분간 충돌률(%) 
</span></span></span><span class=line><span class=cl><span class=s2>    avg_response_time: 평균 응답 시간(ms)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>current_conflict_rate</span> <span class=o>&gt;</span> <span class=mi>5</span> <span class=ow>or</span> <span class=n>avg_response_time</span>  <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 일정 수준 충돌 발생 시 재조회 안정성 강화</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;REPEATABLE READ&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>avg_response_time</span> <span class=o>&gt;</span> <span class=mi>50</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 응답 시간이 길면 격리 낮춰 성능 확보</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;READ COMMITTED&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 기본 낮은 부하 환경에서는 성능 최우선</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;READ UNCOMMITTED&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 예시 실행</span>
</span></span><span class=line><span class=cl><span class=n>level</span> <span class=o>=</span> <span class=n>adaptive_isolation</span><span class=p>(</span><span class=n>current_conflict_rate</span><span class=o>=</span><span class=mf>3.4</span><span class=p>,</span> <span class=n>avg_response_time</span><span class=o>=</span><span class=mi>18</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;현재 설정할 Isolation Level: </span><span class=si>{</span><span class=n>level</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>동작 시나리오</strong>:</p><ol><li><strong>모니터링</strong><ul><li>DB 모니터링 시스템에서 1~5 분 단위로 충돌률, 지연시간, Deadlock-Rate 수집</li></ul></li><li><strong>판단 로직 적용</strong><ul><li>충돌률이 높아지면 <strong>무결성 우선</strong></li><li>지연 시간이 길면 <strong>성능 회복 우선</strong></li></ul></li><li><strong>DB 구성 변경</strong><ul><li><p>SQL:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=k>SESSION</span><span class=w> </span><span class=k>CHARACTERISTICS</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=k>SERIALIZABLE</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>또는 Connection Pool 설정 변경</p></li></ul></li></ol><p><strong>Adaptive Isolation 적용 장점</strong>:</p><ul><li>부하 변화에 따라 자동 조정 → 관리 편의성 ↑</li><li>불필요하게 높은 격리 수준 유지 방지 → 성능 손실 최소화</li><li>긴급 상황에서 무결성을 즉시 확보 가능</li></ul><hr><h2 id=정리-및-학습-가이드>정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#정리-및-학습-가이드>#</a></h2><h3 id=내용-정리>내용 정리<a hidden class=anchor aria-hidden=true href=#내용-정리>#</a></h3><p>트랜잭션 격리는 <strong>일관성과 성능의 균형을 설계·운영하는 기술</strong>이다.<br>표준 4 레벨 (RU/RC/RR/Serializable) 은 <strong>어떤 현상을 허용/차단할지</strong>를 계약하며, 실제 체감 결과는 <strong>엔진 구현 (락·MVCC·SSI) 과 쿼리/인덱스/제약 설계</strong>에 달려 있다.<br>실무에서는 <strong>읽기는 스냅샷 (RC/RCSI)</strong> 으로 비차단화하고, <strong>결제·원장·재고</strong> 같은 핵심 규칙 구간만 <strong>짧게 직렬화/범위잠금</strong>으로 강화한다. 이때 <strong>재시도·멱등</strong>은 기본 전제이며, <strong>p95/99·락 대기·데드락/직렬화 실패·버전스토어</strong>를 상시 관측해 조기 대응한다.<br>보안·거버넌스는 격리만으로 달성되지 않는다. <strong>접근 통제·암호화·감사·변경관리</strong>를 함께 설계하고, 로그/버전스토어까지 PII 보호를 확장해야 한다.<br>최신 흐름은 <strong>엣지/WASM</strong> 으로 가까운 곳에서 읽고, <strong>강한 격리</strong>를 일부 분산 DB 에서 실용화하며, <strong>결정적/락프리/자율운영</strong>으로 격리 비용을 주변에서 줄여 가는 방향이다.</p><table><thead><tr><th>범주</th><th>핵심 포인트</th><th>실무 적용</th><th>흔한 함정/리스크</th><th>점검 지표/가드레일</th></tr></thead><tbody><tr><td>표준 격리수준</td><td>RU/RC/RR/Serializable 로 현상 허용/차단 정의</td><td>기본 RC/RCSI, 핵심 구간만 RR+ 범위락/Serializable(짧게)</td><td>과도한 직렬화로 TPS↓, RU 남용</td><td>직렬화 실패율·Abort, RU 차단 정책</td></tr><tr><td>현상/이슈</td><td>Dirty/NR/Phantom + Lost Update/Write Skew</td><td>조건부 갱신·<code>FOR UPDATE</code>·제약/트리거·SSI</td><td>SI 에서 Write Skew 간과</td><td>규칙 위반 알람, 충돌 로그</td></tr><tr><td>메커니즘</td><td>2PL(행/범위/프리디킷), MVCC(SI/RCSI), SSI</td><td>읽기=스냅샷, 쓰기=국소 잠금/직렬화</td><td>범위락 과잉/긴 Tx</td><td>인덱스 설계, Tx 타임아웃</td></tr><tr><td>엔진 차이</td><td>InnoDB Next-Key, PG-SSI, MSSQL RCSI/SNAPSHOT</td><td>엔진별 특성 반영한 쿼리/인덱스/옵션</td><td>RR=팬텀 차단 (엔진별 상이) 오해</td><td>엔진별 가이드 준수 테스트</td></tr><tr><td>운영</td><td>재시도·멱등·장기 Tx 억제·배치 분리</td><td>지수백오프 + 지터, 멱등키, 오프피크 배치</td><td>재시도 무제한·핫키 병목</td><td>재시도 한도, 샤딩/큐잉</td></tr><tr><td>관측성</td><td>p95/99·락 대기·데드락/직렬화 실패·버전스토어</td><td>대시보드/알림·격리 라벨 태깅</td><td>블라인드 스팟</td><td>SLO·카나리·롤백 플랜</td></tr><tr><td>보안/거버넌스</td><td>격리 + 접근통제 + 암호화 + 감사 + 변경관리</td><td>RU 차단, 역할/데이터등급 기반 정책, 로그/버전 PII 보호</td><td>로그/백업 PII 노출</td><td>KMS·마스킹·WORM 로그</td></tr><tr><td>트렌드 (2025)</td><td>엣지/WASM, 강한 격리 실용화, 결정적/락프리, AI 자율운영</td><td>엣지 리드·오프라인 스냅샷, 재시도 전제 직렬화</td><td>" 격리 자동화 만능론 "</td><td>정책/규칙 기반 + 점진적 도입</td></tr></tbody></table><ul><li><strong>설계 원칙</strong>: " 읽기는 스냅샷, 쓰기는 국소 강화, 핵심 구간만 직렬화/범위잠금, 모든 변경은 재시도·멱등 &ldquo;.</li><li><strong>운영 원칙</strong>: 긴 Tx 금지, 핫키 분산, p95/99·락/데드락/직렬화 실패·버전스토어 <strong>상시 관측</strong>.</li><li><strong>거버넌스</strong>: 격리는 보안의 일부. <strong>접근통제·암호화·감사</strong>와 함께, 로그/버전/백업까지 <strong>PII 보호</strong>.</li><li><strong>트렌드 활용</strong>: 엣지/WASM·강한 격리 DB·결정적/락프리·자율운영으로 <strong>격리 비용을 줄이고 응답을 낮춘다</strong>.</li><li><strong>결론</strong>: 격리는 기능이 아니라 <strong>전사 설계·운영 원칙</strong>이다. 도메인 규칙·엔진 특성·운영 지표를 함께 보며 <strong>구간별 최적점</strong>을 찾는 것이 최선이다.</li></ul><h3 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h3><table><thead><tr><th>레벨</th><th>기간</th><th>핵심 목표</th><th>필수 역량/지식</th><th>필수 실습</th><th>산출물</th><th>평가 지표 (예시)</th></tr></thead><tbody><tr><td>초급</td><td>0–6M</td><td>4 레벨/이상현상 이해, 프레임워크 적용</td><td>ACID, RU/RC/RR/SR, Dirty/NR/Phantom</td><td>두 세션 재현 랩, @Transactional 격리 옵션 실습, 락/버전 뷰 확인</td><td>재현 노트북, 권장 격리 1p</td><td>현상 재현 성공률 100%, RC/RR 차이 설명</td></tr><tr><td>중급</td><td>6–24M</td><td>2PL vs MVCC, 최적화·관측, 마이크로서비스 일관성</td><td>인덱스/파티셔닝, 커넥션 풀, 캐시, RCSI/SI, Outbox/Saga, 대시보드</td><td>RC vs RCSI/SI 벤치, 핵심만 SR, 대시보드 구축, 배치 분리</td><td>성능 리포트, 대시보드, 장애 대응 플랜</td><td>P95 지연 30%↓, TPS 20%↑, 40001 재시도 성공률≥99%</td></tr><tr><td>고급</td><td>2Y+</td><td>격리 아키텍처, 멀티리전, 자동화</td><td>SSI/Write-skew, 리전 스코핑, 적응형 격리, 검증 자동화</td><td>리전 내 SR+ 글로벌 EC 설계, 동적 격리 PoC, 일관성 검증 플로우</td><td>정책서/런북, PoC 코드</td><td>멀티리전 시 P99 지연 목표 달성, 장애 복원 TTR↓</td></tr></tbody></table><h3 id=학습-항목-매트릭스>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스>#</a></h3><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>학습 목표</th><th>실무 연관성</th><th>설명</th></tr></thead><tbody><tr><td><strong>기초 이론</strong></td><td>1</td><td>ACID 속성 & Isolation 개념</td><td>★</td><td>트랜잭션 기본 원리 이해</td><td>높음</td><td>모든 트랜잭션 설계의 기초</td></tr><tr><td>기초 이론</td><td>1</td><td>ANSI 4 단계 격리 수준</td><td>★</td><td>각 단계 동작/차이 이해</td><td>높음</td><td>RC/RR/Serializable 등</td></tr><tr><td>기초 이론</td><td>1</td><td>동시성 문제 유형</td><td>★</td><td>Dirty/Non-repeatable/Phantom</td><td>높음</td><td>문제 식별·해결 출발점</td></tr><tr><td><strong>핵심 기술</strong></td><td>2</td><td>Locking(2PL) 메커니즘</td><td>★</td><td>단계별 잠금 동작 이해</td><td>높음</td><td>성능·일관성 균형 핵심</td></tr><tr><td>핵심 기술</td><td>2</td><td>MVCC 원리</td><td>★</td><td>다중 버전 관리 이해</td><td>높음</td><td>대부분 DBMS 의 기본</td></tr><tr><td>핵심 기술</td><td>3</td><td>SSI & Write Skew 처리</td><td>◎</td><td>충돌탐지·재시도 전략</td><td>중간</td><td>고급 일관성 보장 기법</td></tr><tr><td><strong>DBMS 구현</strong></td><td>4</td><td>주요 DBMS 격리 수준 설정</td><td>★</td><td>DB 별 옵션·기본값 숙지</td><td>높음</td><td>PG/MySQL/Oracle/SQL Server</td></tr><tr><td><strong>운영 기술</strong></td><td>5</td><td>데드락 탐지·해결</td><td>◎</td><td>교착상태 예방·복구</td><td>중간</td><td>운영 안정성 필수</td></tr><tr><td>운영 기술</td><td>5</td><td>성능 모니터링·튜닝</td><td>◎</td><td>락 대기/충돌률 분석</td><td>중간</td><td>DMVs, pg_locks 활용</td></tr><tr><td><strong>응용 패턴</strong></td><td>6</td><td>ORM 연계 (JPA/Hibernate)</td><td>◎</td><td>Isolation 설정·테스트</td><td>높음</td><td>실무 코드 통합</td></tr><tr><td>응용 패턴</td><td>6</td><td>트랜잭션 경계 설계</td><td>◎</td><td>성능·일관성 균형 설계</td><td>중간</td><td>업무 단위로 분리·최적화</td></tr><tr><td><strong>분산 환경</strong></td><td>7</td><td>분산 트랜잭션 관리</td><td>○</td><td>Saga/2PC 설계</td><td>낮음</td><td>마이크로서비스 적용</td></tr><tr><td>분산 환경</td><td>7</td><td>Event Sourcing 연계</td><td>○</td><td>이벤트 기반 일관성</td><td>낮음</td><td>CQRS·ES 적용 사례</td></tr><tr><td><strong>미래·트렌드</strong></td><td>8</td><td>AI 기반 격리 수준 최적화</td><td>○</td><td>동적 조정 모델 이해</td><td>낮음</td><td>운영 자동화</td></tr><tr><td>미래·트렌드</td><td>8</td><td>클라우드 네이티브 환경 적용</td><td>○</td><td>K8s·서버리스 격리 설정</td><td>낮음</td><td>분산 환경에서의 일관성</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>기본/표준</td><td>Isolation Level(격리 수준)</td><td>동시 트랜잭션 간 가시성/간섭을 제어하는 규칙</td><td>ACID, Concurrency Control</td><td>시스템 요구에 맞는 레벨 선택</td></tr><tr><td>기본/표준</td><td>ACID</td><td>원자성/일관성/격리성/지속성 특성</td><td>트랜잭션</td><td>DB 설계 기본 원칙</td></tr><tr><td>기본/표준</td><td>Serializability</td><td>동시 실행 결과가 어떤 직렬 순서와 동일</td><td>2PL, SSI</td><td>규칙 핵심 구간 보장</td></tr><tr><td>기본/표준</td><td>External Consistency</td><td>실제 시간 순서까지 보존하는 직렬화</td><td>TrueTime</td><td>글로벌 일관성 (특정 DB)</td></tr><tr><td>이상 현상</td><td>Dirty Read</td><td>미커밋 데이터를 읽는 현상</td><td>Read Uncommitted</td><td>RC 이상으로 차단</td></tr><tr><td>이상 현상</td><td>Non-repeatable Read</td><td>같은 행 재조회 시 값이 달라짐</td><td>RC</td><td>RR 이상으로 차단</td></tr><tr><td>이상 현상</td><td>Phantom Read</td><td>같은 조건 재조회 시 행 집합 변동</td><td>범위 잠금</td><td>Serializable/범위락으로 차단</td></tr><tr><td>이상 현상</td><td>Lost Update</td><td>동시 갱신으로 한쪽 변경이 소실</td><td>조건부 업데이트</td><td>버전 필드·락으로 방지</td></tr><tr><td>이상 현상</td><td>Write Skew</td><td>서로 다른 행을 갱신해 전역 제약 위반</td><td>Snapshot Isolation</td><td>Serializable/범위락/제약으로 방지</td></tr><tr><td>구현 메커니즘</td><td>2PL(두 단계 잠금)</td><td>잠금 획득→해제의 두 단계 프로토콜</td><td>S/X/의도/범위락</td><td>직렬성 근사 구현</td></tr><tr><td>구현 메커니즘</td><td>MVCC</td><td>다중 버전으로 읽기/쓰기 경합 완화</td><td>스냅샷</td><td>읽기 비차단 구현</td></tr><tr><td>구현 메커니즘</td><td>Snapshot Isolation(SI)</td><td>트랜잭션 시작 시점 스냅샷 일관 읽기</td><td>MVCC</td><td>읽기 성능↑, Write Skew 주의</td></tr><tr><td>구현 메커니즘</td><td>SSI</td><td>SI 위반 (충돌 그래프) 을 감지해 Abort</td><td>Serializability</td><td>PG 등에서 직렬화 구현</td></tr><tr><td>구현 메커니즘</td><td>Predicate Lock</td><td>조건 (범위) 에 대한 논리적 잠금</td><td>팬텀 방지</td><td>SSI/범위 보호</td></tr><tr><td>구현 메커니즘</td><td>Range/Next-Key/GAP Lock</td><td>인덱스 레코드 + 간격을 잠그는 범위락</td><td>InnoDB RR</td><td>삽입 팬텀 차단</td></tr><tr><td>엔진/특화</td><td>RCSI</td><td>RC 를 문장 스냅샷 읽기로 구현</td><td>SQL Server</td><td>비차단 읽기, 버전 스토어 비용</td></tr><tr><td>엔진/특화</td><td>SNAPSHOT</td><td>트랜잭션 단위 스냅샷 읽기</td><td>SQL Server</td><td>Non-repeatable/팬텀 회피</td></tr><tr><td>엔진/특화</td><td>Lock Escalation</td><td>행→페이지/테이블로 잠금 단위 확대</td><td>2PL</td><td>대량 작업 시 주의/튜닝</td></tr><tr><td>엔진/특화</td><td>Version Store/Undo</td><td>과거 버전 저장 영역</td><td>MVCC/RCSI</td><td>공간/IO/GC 모니터링</td></tr><tr><td>엔진/특화</td><td>WAL/Redo Log</td><td>변경 로그 (재실행/복구용)</td><td>Durability</td><td>감사·복구·CDC 소스</td></tr><tr><td>분산/아키텍처</td><td>2PC</td><td>분산 커밋 합의 프로토콜</td><td>XA, Coordinator</td><td>글로벌 트랜잭션 (비용↑)</td></tr><tr><td>분산/아키텍처</td><td>Saga</td><td>보상 단계로 분산 일관성 달성</td><td>Outbox, 이벤트</td><td>마이크로서비스 표준 패턴</td></tr><tr><td>분산/아키텍처</td><td>Outbox/CDC</td><td>로컬 커밋 후 이벤트 내보내기</td><td>정확 1 회</td><td>최종 일관성·재처리</td></tr><tr><td>분산/아키텍처</td><td>Eventual Consistency</td><td>시간이 지나며 수렴하는 일관성</td><td>리플리카</td><td>글로벌/엣지 환경</td></tr><tr><td>운영/성능/관측</td><td>Lock Contention</td><td>잠금 경합으로 대기/지연 발생</td><td>핫스팟</td><td>설계/샤딩/인덱싱</td></tr><tr><td>운영/성능/관측</td><td>Deadlock</td><td>상호 대기로 진행 불가</td><td>데드락 그래프</td><td>자동 감지/재시도</td></tr><tr><td>운영/성능/관측</td><td>Livelock/Starvation</td><td>진행 없이 반복/영구 대기</td><td>스케줄링</td><td>백오프·공정성 보장</td></tr><tr><td>운영/성능/관측</td><td>Hotspot</td><td>특정 키/파티션에 집중 경합</td><td>샤딩/큐잉</td><td>스루풋 개선</td></tr><tr><td>운영/성능/관측</td><td>Sharding/Partitioning</td><td>키/범위 기반 데이터 수평 분할</td><td>핫스팟 완화</td><td>확장성/격리 경합 감소</td></tr><tr><td>운영/성능/관측</td><td>Read Replica</td><td>읽기 전용 복제본</td><td>스냅샷/지연</td><td>리포팅/트래픽 분산</td></tr><tr><td>운영/성능/관측</td><td>Covering Index</td><td>질의 컬럼을 모두 포함하는 인덱스</td><td>I/O 감소</td><td>범위락 경합 축소</td></tr><tr><td>운영/성능/관측</td><td>Transaction Timeout</td><td>트랜잭션 최대 실행 시간</td><td>긴 Tx 억제</td><td>버전 스토어 보호</td></tr><tr><td>운영/성능/관측</td><td>SKIP LOCKED</td><td>잠긴 행을 건너뛰는 선택</td><td>워커 분산</td><td>대기/교착 회피</td></tr><tr><td>운영/성능/관측</td><td>Idempotency Key</td><td>중복 요청을 1 회 효과로 수렴</td><td>재시도와 세트</td><td>결제/주문 안전성</td></tr><tr><td>운영/성능/관측</td><td>Exponential Backoff</td><td>재시도 간격을 지수적으로 증가</td><td>데드락/직렬화 실패</td><td>혼잡 제어</td></tr><tr><td>보안/거버넌스</td><td>Row-Level Security</td><td>행 단위 접근 제어</td><td>PII 보호</td><td>다중 임차/권한 분리</td></tr><tr><td>보안/거버넌스</td><td>Data Masking/Tokenization</td><td>민감정보 가림/대체</td><td>로그/복제/백업</td><td>규정 준수</td></tr><tr><td>보안/거버넌스</td><td>Audit Logging</td><td>DDL/DML/격리 변경 추적</td><td>SIEM</td><td>추적성/책임성 확보</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><h3 id=표준연구학술>표준·연구/학술<a hidden class=anchor aria-hidden=true href=#표준연구학술>#</a></h3><ul><li><a href=https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/tr-95-51.pdf>A Critique of ANSI SQL Isolation Levels (Berenson et al., Microsoft Research, PDF)</a></li><li><a href=https://arxiv.org/abs/1107.3925>Serializable Snapshot Isolation (Ports & Grittner, arXiv)</a></li><li><a href=https://15445.courses.cs.cmu.edu/fall2023/notes/18-multiversioning.pdf>CMU 15-445 Lecture Notes: Multi-Version Concurrency Control (PDF)</a></li></ul><h3 id=공식-문서-dbms>공식 문서 (DBMS)<a hidden class=anchor aria-hidden=true href=#공식-문서-dbms>#</a></h3><ul><li><a href=https://www.postgresql.org/docs/current/transaction-iso.html>PostgreSQL: Transaction Isolation</a></li><li><a href=https://www.postgresql.org/docs/current/sql-set-transaction.html>PostgreSQL: SET TRANSACTION</a></li><li><a href=https://dev.mysql.com/doc/refman/8.4/en/innodb-transaction-isolation-levels.html>MySQL 8.4: InnoDB Transaction Isolation Levels</a></li><li><a href=https://dev.mysql.com/doc/en/innodb-locking.html>MySQL 8.4: InnoDB Locking (Next-Key/GAP)</a></li><li><a href=https://dev.mysql.com/doc/en/set-transaction.html>MySQL 8.4: SET TRANSACTION Statement</a></li><li><a href=https://learn.microsoft.com/en-us/sql/t-sql/statements/set-transaction-isolation-level-transact-sql>SQL Server: SET TRANSACTION ISOLATION LEVEL (Transact-SQL)</a></li><li><a href=https://learn.microsoft.com/en-us/sql/t-sql/statements/alter-database-transact-sql-set-options#read_committed_snapshot>SQL Server: ALTER DATABASE … SET READ_COMMITTED_SNAPSHOT</a></li><li><a href=https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/sql/snapshot-isolation-in-sql-server>SQL Server: Snapshot Isolation (ADO.NET 설명서)</a></li><li><a href=https://docs.oracle.com/en/database/oracle/oracle-database/23/cncpt/data-concurrency-and-consistency.html>Oracle Database 23c: Data Concurrency and Consistency</a></li></ul><h3 id=분산글로벌-직렬화--클라우드>분산/글로벌 직렬화 & 클라우드<a hidden class=anchor aria-hidden=true href=#분산글로벌-직렬화--클라우드>#</a></h3><ul><li><a href=https://cloud.google.com/spanner/docs/true-time-external-consistency>Google Cloud Spanner: TrueTime & External Consistency</a></li><li><a href=https://cloud.google.com/spanner/docs/whitepapers/life-of-reads-and-writes>Google Cloud Spanner: Life of Reads and Writes (Whitepaper)</a></li><li><a href=https://research.google.com/pubs/archive/45855.pdf>Spanner, TrueTime and the CAP Theorem (PDF)</a></li></ul><h3 id=nosql기타-시스템의-격리>NoSQL/기타 시스템의 격리<a hidden class=anchor aria-hidden=true href=#nosql기타-시스템의-격리>#</a></h3><ul><li><a href=https://www.mongodb.com/docs/manual/reference/read-concern-snapshot/>MongoDB Docs: Read Concern “snapshot”</a></li><li><a href=https://www.mongodb.com/docs/manual/core/transactions/>MongoDB Docs: Transactions</a></li></ul><h3 id=실무-가이드엔지니어링-블로그>실무 가이드/엔지니어링 블로그<a hidden class=anchor aria-hidden=true href=#실무-가이드엔지니어링-블로그>#</a></h3><ul><li><a href=https://www.cockroachlabs.com/blog/sql-isolation-levels-explained/>Cockroach Labs: No Dirty Reads — SQL Isolation Levels Explained</a></li><li><a href=https://www.cockroachlabs.com/blog/232-read-committed-no-more-anomaly-tables/>Cockroach Labs: Isolation Levels without the Anomaly Table</a></li></ul><h3 id=검증테스트-도구-jepsenelle-등>검증/테스트 도구 (Jepsen/Elle 등)<a hidden class=anchor aria-hidden=true href=#검증테스트-도구-jepsenelle-등>#</a></h3><ul><li><a href=https://www.vldb.org/pvldb/vol14/p268-alvaro.pdf>Elle (VLDB’21, PDF): Inferring Isolation Anomalies from Experimental Observations</a></li><li><a href=https://github.com/jepsen-io/elle>Elle GitHub: Black-box Transactional Safety Checker</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>