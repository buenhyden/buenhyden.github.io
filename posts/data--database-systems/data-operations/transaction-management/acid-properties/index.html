<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ACID Properties | hyunyoun's Blog</title><meta name=keywords content="Data-and-Database-Systems,Data-Operations,Transaction-Management,ACID-Properties,Reliability,Database-Transaction,Database-Consistency,Data-Integrity"><meta name=description content="ACID는 데이터베이스 트랜잭션이 전부 수행 또는 전부 취소(원자성), 일관된 규칙 준수(일관성), 동시 실행 간 간섭 방지(격리성), **결과 영구 저장(지속성)**을 보장하는 원칙이다. 이를 통해 장애나 동시성 경쟁 상황에서도 데이터 무결성과 신뢰성을 유지하며, 현대 DB·분산 환경 설계의 핵심 기반이 된다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/acid-properties/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.d522c866f0cc9c20ae4fa73a0a8c07f0af4c36af75bcbcd3e90558446f681077.css integrity="sha256-1SLIZvDMnCCuT6c6CowH8K9MNq91vLzT6QVYRG9oEHc=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/acid-properties/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/acid-properties/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/acid-properties/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="ACID Properties"><meta property="og:description" content="ACID는 데이터베이스 트랜잭션이 전부 수행 또는 전부 취소(원자성), 일관된 규칙 준수(일관성), 동시 실행 간 간섭 방지(격리성), **결과 영구 저장(지속성)**을 보장하는 원칙이다. 이를 통해 장애나 동시성 경쟁 상황에서도 데이터 무결성과 신뢰성을 유지하며, 현대 DB·분산 환경 설계의 핵심 기반이 된다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="ACID Properties"><meta name=twitter:description content="ACID는 데이터베이스 트랜잭션이 전부 수행 또는 전부 취소(원자성), 일관된 규칙 준수(일관성), 동시 실행 간 간섭 방지(격리성), **결과 영구 저장(지속성)**을 보장하는 원칙이다. 이를 통해 장애나 동시성 경쟁 상황에서도 데이터 무결성과 신뢰성을 유지하며, 현대 DB·분산 환경 설계의 핵심 기반이 된다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ACID Properties","item":"https://buenhyden.github.io/posts/data--database-systems/data-operations/transaction-management/acid-properties/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>ACID Properties</h1><div class=post-description>ACID는 데이터베이스 트랜잭션이 전부 수행 또는 전부 취소(원자성), 일관된 규칙 준수(일관성), 동시 실행 간 간섭 방지(격리성), **결과 영구 저장(지속성)**을 보장하는 원칙이다. 이를 통해 장애나 동시성 경쟁 상황에서도 데이터 무결성과 신뢰성을 유지하며, 현대 DB·분산 환경 설계의 핵심 기반이 된다.</div></header><div class=post-content><h2 id=acid-properties>ACID Properties<a hidden class=anchor aria-hidden=true href=#acid-properties>#</a></h2><p>ACID(Atomicity, Consistency, Isolation, Durability) 는 1983 년 Andreas Reuter 와 Theo Härder 가 정의한 데이터베이스 트랜잭션의 4 대 핵심 특성으로, 데이터 무결성과 신뢰성을 보장한다.</p><ul><li><strong>원자성 (Atomicity)</strong> 은 <strong>트랜잭션이 전부 실행되거나 전혀 실행되지 않음</strong>을,</li><li><strong>일관성 (Consistency)</strong> 은 <strong>데이터 제약과 규칙 준수</strong>를,</li><li><strong>격리성 (Isolation)</strong> 은 <strong>동시 실행 간 간섭 방지</strong>를,</li><li><strong>지속성 (Durability)</strong> 은 <strong>커밋된 결과의 영구 보존</strong>을 의미한다.</li></ul><p>이 원칙은 은행 거래, 재고 관리, 의료 기록 등 오류와 장애에 강한 시스템에서 필수적이다. 현대의 분산·클라우드 환경에서는 CAP 정리와의 균형 속에서 2PC, 합의 알고리즘 (Paxos, Raft) 등으로 ACID 를 구현하며, NewSQL 및 클라우드 네이티브 DBMS 에서도 표준 설계 지침으로 적용된다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><table><thead><tr><th>개념</th><th>설명</th></tr></thead><tbody><tr><td><strong>Atomicity</strong></td><td>트랜잭션 내 모든 작업이 완전 수행되거나 전혀 수행되지 않음. 실패 시 Undo 로그를 통해 롤백.</td></tr><tr><td><strong>Consistency</strong></td><td>트랜잭션 전후 데이터베이스가 항상 유효 상태 유지. 제약조건 및 비즈니스 규칙 만족 필수.</td></tr><tr><td><strong>Isolation</strong></td><td>동시에 실행되는 트랜잭션이 서로 영향을 주지 않도록 격리. 격리 수준에 따라 성능과 일관성 균형 조절.</td></tr><tr><td><strong>Durability</strong></td><td>커밋된 데이터는 장애 이후에도 보존. WAL·Redo 로그·복제를 통한 보장.</td></tr></tbody></table><p>ACID 는 데이터베이스 트랜잭션 신뢰성을 보장하는 핵심 원칙으로, <strong>Atomicity, Consistency, Isolation, Durability</strong> 네 가지 속성을 기반으로 한다.<br>이론적으로는 트랜잭션 처리 모델과 동시성 제어 메커니즘, 장애 복구 구조로 설명되며, 실무에서는 제약조건 설계·트랜잭션 관리·격리 수준 선택·장애 복구 체계로 구현된다.<br>분산 환경과 마이크로서비스 아키텍처에서는 100% ACID 보장보다 성능·가용성과의 균형을 위해 변형된 패턴 (SAGA, Outbox, 2PC 등) 을 채택하는 경우가 많다.</p><h4 id=핵심-개념의-실무-구현-연관성-및-적용-방식>핵심 개념의 실무 구현 연관성 및 적용 방식<a hidden class=anchor aria-hidden=true href=#핵심-개념의-실무-구현-연관성-및-적용-방식>#</a></h4><table><thead><tr><th>개념</th><th>실무 구현 방식</th><th>적용 사례</th></tr></thead><tbody><tr><td><strong>Atomicity</strong></td><td>트랜잭션 로그, ARIES Undo/Redo, Savepoint, Rollback</td><td>계좌 이체, 주문 처리</td></tr><tr><td><strong>Consistency</strong></td><td>DB 스키마 제약 (FK, UNIQUE, CHECK), 트리거, 애플리케이션 검증 로직</td><td>재고 관리, 데이터 검증</td></tr><tr><td><strong>Isolation</strong></td><td>Lock(Latch, Row/Table), MVCC, 격리 수준 설정</td><td>동시 결제 처리, 리포트 생성</td></tr><tr><td><strong>Durability</strong></td><td>WAL, Redo 로그, 체크포인트, 동기 복제</td><td>금융거래 기록, 로그 감사</td></tr></tbody></table><h3 id=기초-이해-foundation-understanding>기초 이해 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#기초-이해-foundation-understanding>#</a></h3><h4 id=개념-정의-및-본질>개념 정의 및 본질<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질>#</a></h4><p>ACID 는 데이터베이스 트랜잭션이 <strong>안전하고 예측 가능하며 신뢰성 있게</strong> 처리되도록 보장하는 네 가지 핵심 속성</p><ul><li><strong>Atomicity(원자성)</strong></li><li><strong>Consistency(일관성)</strong></li><li><strong>Isolation(격리성)</strong></li><li><strong>Durability(지속성)</strong><br>의 약자이다.</li></ul><ul><li><strong>트랜잭션</strong>은 하나의 논리적 작업 단위로, 여러 데이터 조작 연산이 포함될 수 있으며, ACID 속성을 준수할 때만 무결성과 신뢰성을 확보할 수 있다.</li><li><strong>원자성</strong>은 트랜잭션 내 모든 작업이 전부 수행되거나 전혀 수행되지 않음을 의미하며, 실패 시 롤백된다.</li><li><strong>일관성</strong>은 트랜잭션 전후에 데이터베이스가 항상 유효 상태를 유지하도록 보장한다.</li><li><strong>격리성</strong>은 동시에 실행되는 트랜잭션이 서로 간섭하지 않도록 하며, 격리 수준 설정을 통해 성능과 일관성 간 균형을 맞춘다.</li><li><strong>지속성</strong>은 커밋된 결과가 시스템 장애 이후에도 유지되도록 보장한다.</li></ul><p>이 네 속성은 전통적인 단일 DB 환경에서 필수적이며, 분산 시스템에서는 CAP 이론 및 BASE 모델과의 균형 속에서 적용된다.</p><h4 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h4><p>1970~80 년대 다중 사용자 환경에서 데이터 손실·불일치 문제를 해결하고, 시스템 장애 시에도 데이터 무결성을 보장하기 위한 필요성이 커졌다.<br>IBM System R 과 INGRES 프로젝트에서 트랜잭션 개념이 구체화되었고, Jim Gray 가 로그 기반 복구와 동시성 제어 이론을 발전시켰다.</p><p>이러한 흐름 속에서 1983 년 Andreas Reuter 와 Theo Härder 가 <em>ACID</em>라는 용어를 제안하며, 데이터베이스 트랜잭션의 신뢰성과 무결성을 보장하는 표준 원칙으로 자리 잡았다.</p><h5 id=발전-과정>발전 과정<a hidden class=anchor aria-hidden=true href=#발전-과정>#</a></h5><table><thead><tr><th>시기</th><th>주요 사건 및 발전</th><th>영향</th></tr></thead><tbody><tr><td>1970 년대</td><td>IBM System R, INGRES 프로젝트에서 트랜잭션 개념 정립</td><td>동시성 제어와 복구 필요성 부각</td></tr><tr><td>1970~80 년대</td><td>Jim Gray 의 트랜잭션 처리 이론과 로그 기반 복구 메커니즘 연구</td><td>ACID 기반 기술 토대 마련</td></tr><tr><td>1983 년</td><td>Reuter & Härder, ACID 용어 최초 제안</td><td>트랜잭션 신뢰성 표준화</td></tr><tr><td>1990 년대</td><td>분산 DB 확산, 2PC·Paxos·Raft 등 합의 알고리즘 결합</td><td>글로벌 트랜잭션 지원</td></tr><tr><td>2000 년</td><td>Eric Brewer, CAP 정리 발표</td><td>BASE 모델과 ACID 대안 부각</td></tr><tr><td>2010 년대~</td><td>NoSQL·CloudDB 확산, ACID 일부 완화 또는 재도입</td><td>분산·클라우드 환경 적용</td></tr><tr><td>현재</td><td>NewSQL·분산 트랜잭션 프레임워크에서 ACID 유지·최적화</td><td>고성능·고일관성 DB 구현</td></tr></tbody></table><pre class=mermaid>timeline
    title ACID 발전 과정
    1970 : IBM System R, INGRES 프로젝트 → 트랜잭션 개념 정립
    1975 : Jim Gray, 트랜잭션 처리·복구 이론 연구
    1983 : Reuter &amp; Härder, ACID 용어 최초 제안
    1990 : 분산 DB 확산, 2PC·합의 알고리즘 결합
    2000 : Eric Brewer, CAP 정리 발표 → BASE 모델 부각
    2010 : NoSQL·CloudDB 확산, ACID 완화·재도입
    2020 : NewSQL·분산 트랜잭션 프레임워크에서 ACID 최적화
</pre><h4 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h4><p>ACID 의 목적은 장애, 동시성, 오류 상황에서도 <strong>데이터 무결성과 일관성</strong>을 유지하고, 핵심 비즈니스 운영의 <strong>신뢰성</strong>을 보장하는 것이다. 이를 통해 데이터 손상·불일치를 방지하며, 금융·의료 등 법적 규제 준수와 감사 가능성을 확보한다. 또한 트랜잭션 단위로 개발 로직을 단순화하고 예외 처리 복잡성을 줄여 개발 생산성을 높인다. 분산 환경에서도 안정적인 동작을 위한 설계 기반을 제공하여, 확장성과 안정성을 동시에 추구한다.</p><table><thead><tr><th>카테고리</th><th>목적/가치</th><th>설명</th></tr></thead><tbody><tr><td>데이터 무결성 보장</td><td>정확성·일관성 유지</td><td>장애·동시성·오류 상황에서도 데이터 정합성 확보</td></tr><tr><td>비즈니스 신뢰성 확보</td><td>핵심 서비스 안정성</td><td>금융·전자상거래·의료 등 크리티컬 업무의 안정 운영</td></tr><tr><td>시스템 복구 능력</td><td>데이터 손실 방지</td><td>예기치 못한 장애에도 안전한 데이터 복구 가능</td></tr><tr><td>동시성 문제 해결</td><td>다중 사용자 환경 지원</td><td>동시 트랜잭션 처리 시 일관성 유지</td></tr><tr><td>표준화된 트랜잭션 처리</td><td>개발 단순화</td><td>트랜잭션 단위 모델 제공, 예외 처리 복잡성 감소</td></tr><tr><td>규제·감사 대응</td><td>법적 요건 충족</td><td>규제 산업에서 감사 추적성과 정합성 보장</td></tr><tr><td>분산 환경 설계 기반</td><td>확장성·안정성 확보</td><td>CAP 이론 고려한 분산 트랜잭션 설계 지원</td></tr></tbody></table><h4 id=주요-특징>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징>#</a></h4><p>ACID Properties 는 네 가지 속성이 <strong>상호 보완적으로 동작</strong>하여 트랜잭션의 무결성과 신뢰성을 보장한다. 각 속성은 특정 기술을 통해 구현되며, 이로 인한 성능·확장성·복잡성의 트레이드오프가 존재한다.</p><ul><li><strong>원자성</strong>: 모든 연산이 전부 성공하거나 전부 실패하도록 보장. Undo/Redo 로그, ARIES 알고리즘으로 구현.</li><li><strong>일관성</strong>: 트랜잭션 전후에 모든 데이터 제약조건 유지. DB 스키마 제약, 트리거, 애플리케이션 검증 로직 사용.</li><li><strong>격리성</strong>: 동시 실행되는 트랜잭션 간 간섭 방지. ANSI SQL 격리 수준, MVCC, 2PL, SSI 로 구현.</li><li><strong>지속성</strong>: 커밋된 데이터는 장애 후에도 영구 저장. WAL, 체크포인트, 복제·백업으로 구현.</li></ul><p>ACID 의 네 속성은 각각 독립적인 기능이지만, 실제 DBMS 에서는 <strong>로그 기반 복구와 동시성 제어 메커니즘</strong>이 결합되어 동작한다.<br>원자성·지속성은 주로 <strong>저장소와 로그 시스템</strong>에서, 일관성·격리성은 <strong>동시성 제어와 제약 조건 관리</strong>에서 보장된다.<br>분산 환경에서는 네 속성을 모두 만족시키는 것이 어렵기 때문에, 성능·가용성과의 균형을 고려한 설계가 필수이다.</p><h3 id=핵심-이론-core-theory>핵심 이론 (Core Theory)<a hidden class=anchor aria-hidden=true href=#핵심-이론-core-theory>#</a></h3><h4 id=핵심-설계-원칙>핵심 설계 원칙<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙>#</a></h4><p>ACID 를 구현하는 설계 원칙은 다음과 같이 요약할 수 있다.</p><p>트랜잭션은 분할 불가능한 단일 단위로, 항상 유효한 상태 간 전이만 허용하며, 동시 실행 시 간섭이 없어야 하고, 커밋된 결과는 장애에도 유지된다.<br>이를 위해 <strong>WAL 기반 처리, 일관성 검증 경계, 격리 수준 설계, 복구 메커니즘</strong>이 결합된다.</p><table><thead><tr><th>설계 원칙</th><th>설명</th><th>구현/기술 근거</th></tr></thead><tbody><tr><td><strong>Single Unit of Work</strong> (원자성)</td><td>트랜잭션은 분할 불가능한 단일 작업 단위로 처리</td><td>트랜잭션 관리기, Undo 로그</td></tr><tr><td><strong>Valid State Transitions</strong> (일관성)</td><td>유효한 상태에서 다른 유효한 상태로만 전환</td><td>FK, Check, Trigger, App Validation</td></tr><tr><td><strong>Concurrent Independence</strong> (격리성)</td><td>동시 실행 트랜잭션 간 간섭 없이 독립 실행</td><td>Isolation Level, MVCC, 2PL</td></tr><tr><td><strong>Permanent Commitment</strong> (지속성)</td><td>커밋된 변경사항은 장애 후에도 영구 보존</td><td>WAL, Commit Flush, Replication</td></tr><tr><td><strong>WAL 기반 처리</strong></td><td>로그를 먼저 기록하여 원자성·내구성 보장</td><td>Write-Ahead Logging, ARIES</td></tr><tr><td><strong>일관성 경계 관리</strong></td><td>데이터 무결성을 DB 제약과 App 경계에서 보장</td><td>스키마 제약, 비즈니스 규칙</td></tr><tr><td><strong>ACID 내장 로직</strong></td><td>트랜잭션 시스템에 ACID 준수 메커니즘 포함</td><td>DBMS 아키텍처 설계</td></tr></tbody></table><p>ACID 설계 원칙은 <strong>원자성·일관성·격리성·지속성</strong> 네 속성을 구체적인 기술로 구현하는 방법론이다.<br>핵심은 <strong>WAL 기반 복구</strong>, <strong>격리 수준 설계</strong>, <strong>일관성 검증 경계 설정</strong>이며, 장애와 동시성 환경에서도 데이터 무결성과 안정성을 보장하는 구조를 만드는 것이다.<br>분산 환경에서는 성능·가용성과의 균형을 고려해 설계 원칙을 일부 조정할 수 있다.</p><h5 id=단일-db--분산-db-환경-acid-설계-원칙-비교>단일 DB ↔ 분산 DB 환경 ACID 설계 원칙 비교<a hidden class=anchor aria-hidden=true href=#단일-db--분산-db-환경-acid-설계-원칙-비교>#</a></h5><table><thead><tr><th>속성</th><th>단일 DB 설계 원칙</th><th>분산 DB 설계 원칙</th><th>전환 시 고려해야 할 변화</th><th>대안 패턴 / 기술</th></tr></thead><tbody><tr><td><strong>원자성 (Atomicity)</strong></td><td>WAL 기반 원자성 보장, Undo/Redo 로그 처리</td><td>글로벌 트랜잭션 합의 필요</td><td>네트워크 장애 시 원자성 손실 가능, 다중 노드 간 상태 불일치 위험</td><td><strong>2PC/3PC</strong>, <strong>SAGA 패턴</strong>(보상 트랜잭션), <strong>TCC</strong>(Try-Confirm-Cancel)</td></tr><tr><td><strong>일관성 (Consistency)</strong></td><td>스키마 제약조건, 트리거, FK 등으로 강한 일관성 유지</td><td>글로벌 스키마 제약·검증 부담 큼</td><td>노드·리전 간 데이터 전파 지연으로 일관성 깨짐</td><td><strong>Eventual Consistency</strong>, <strong>Causal Consistency</strong>, 중앙 제약 서비스</td></tr><tr><td><strong>격리성 (Isolation)</strong></td><td>MVCC, 2PL, Serializable 로 트랜잭션 간 독립성 보장</td><td>글로벌 MVCC, 분산 락 필요</td><td>글로벌 락으로 인한 성능 저하, 노드 간 시차 문제</td><td><strong>분산 MVCC</strong>, <strong>Vector Clock</strong>, <strong>CRDT</strong></td></tr><tr><td><strong>지속성 (Durability)</strong></td><td>Commit 시 디스크 flush, 로컬 백업·동기 복제</td><td>다중 리전/노드에 데이터 복제</td><td>비동기 복제 시 장애 발생 시점 데이터 손실 가능성</td><td><strong>Raft/Paxos 합의</strong>, <strong>Quorum Write/Read</strong>, <strong>동기 멀티 리전 복제</strong></td></tr><tr><td><strong>복구 메커니즘</strong></td><td>단일 노드 WAL 복구, 체크포인트 기반</td><td>분산 합의 로그 복구, 리더 재선출</td><td>장애 복구 시 글로벌 상태 일관성 회복 필요</td><td><strong>Consensus 기반 로그</strong>, <strong>Incremental Backup</strong></td></tr><tr><td><strong>동시성 제어</strong></td><td>로컬 락 매니저, 단일 MVCC 로 처리</td><td>분산 락 서비스 필요</td><td>글로벌 락 병목, Latency 증가</td><td><strong>ZooKeeper</strong>, <strong>etcd</strong>, <strong>Optimistic Concurrency Control</strong></td></tr><tr><td><strong>성능 트레이드오프</strong></td><td>ACID 준수 비용 낮고 지연 적음</td><td>네트워크 왕복·합의 비용 증가</td><td>고성능 유지 위해 일부 속성 완화 필요</td><td><strong>CAP 기반 설계</strong>, <strong>Hotspot Sharding</strong>, <strong>CQRS</strong></td></tr><tr><td><strong>설계 초점</strong></td><td>강한 일관성과 무결성 중심</td><td>가용성과 확장성 중심</td><td>속성별 절충 필요</td><td><strong>BASE 모델</strong>, <strong>Event Sourcing</strong></td></tr></tbody></table><ul><li><strong>단일 DB → 분산 DB 전환</strong> 시, 원자성과 일관성 보장 방식이 가장 크게 변한다.</li><li>분산 환경은 **합의 알고리즘 (Consensus)**과 **대체 패턴 (SAGA, TCC, Eventual Consistency)**을 통한 속성 보완이 필수이다.</li><li>동시성·내구성 보장은 <strong>분산 락 서비스</strong>와 <strong>Quorum 기반 복제</strong>로 대체할 수 있다.</li><li>최종 설계는 <strong>CAP 정리</strong>와 비즈니스 요구사항에 맞춘 <strong>속성별 타협안</strong>이 핵심이다.</li></ul><h4 id=기본-원리-및-동작-메커니즘>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘>#</a></h4><h5 id=기본-원리>기본 원리<a hidden class=anchor aria-hidden=true href=#기본-원리>#</a></h5><table><thead><tr><th>속성</th><th>핵심 정의</th><th>주 구현 수단 (예)</th><th>실패/경합 시 보장 방식</th></tr></thead><tbody><tr><td>원자성 (A)</td><td>전부 수행/전무 수행</td><td>Undo 로그, ARIES, 롤백 세그먼트</td><td>오류 시 <strong>Undo</strong>로 직전 일관 상태 복구</td></tr><tr><td>일관성 (C)</td><td>제약 조건 항상 충족</td><td>FK/체크/유니크, 트리거, 애플리케이션 불변식</td><td>위반 시 트랜잭션 실패→롤백</td></tr><tr><td>격리성 (I)</td><td>동시 트랜잭션 간 간섭 차단</td><td><strong>락</strong>(S/X, 범위락) 또는 <strong>MVCC</strong> 스냅샷</td><td>격리 수준에 따라 Dirty/Non-repeatable/Phantom 방지</td></tr><tr><td>지속성 (D)</td><td>커밋 결과 영구 보존</td><td><strong>WAL</strong> 기록 후 <strong>fsync</strong>, 체크포인트, 리플리케이션</td><td>크래시 후 <strong>Redo</strong>로 커밋 내용 복원</td></tr></tbody></table><p>ACID 는 " 무결성 보전 " 목표를 네 축 (A/C/I/D) 으로 분해한다. DBMS 는 <strong>로그 (Undo/Redo)</strong>, <strong>동시성 제어 (락/MVCC)</strong>, <strong>스토리지 보장 (WAL+fsync/복제)</strong> 의 조합으로 이를 실현한다.</p><h5 id=동작-메커니즘>동작 메커니즘<a hidden class=anchor aria-hidden=true href=#동작-메커니즘>#</a></h5><ol><li>트랜잭션 시작 (Transaction Start)<ol><li><strong>애플리케이션</strong>이 DBMS 에 <code>BEGIN</code> 요청을 전송.</li><li>**트랜잭션 매니저 (TM)**가 트랜잭션 ID(TxID) 를 생성하고 세션 컨텍스트에 바인딩.</li><li>트랜잭션 상태를 **활성 (Active)**으로 전환.</li></ol></li><li>DML 실행 & 동시성 제어<ol><li>애플리케이션이 <code>INSERT / UPDATE / DELETE</code> 등 DML 명령 실행.</li><li>**트랜잭션 매니저 (TM)**가 해당 연산을 **동시성 제어 모듈 (CC)**에 전달.</li><li><strong>CC 모듈</strong>이 Isolation Level 에 따라 락 (Lock) 획득 또는 MVCC 스냅샷 생성.</li><li>락 획득 성공 시 **버퍼 매니저 (BM)**가 변경된 페이지를 버퍼 캐시에 로드.</li><li>변경 연산을 수행하고 수정된 데이터는 <strong>Dirty Page</strong>로 마킹.</li></ol></li><li>로그 기록 (Write-Ahead Logging)<ol><li>**트랜잭션 매니저 (TM)**가 변경 사항에 대한 <strong>REDO/UNDO 로그</strong>를 생성.</li><li>로그는 **WAL(Log Manager)**에 기록.</li><li>COMMIT 이전에는 로그가 디스크에 바로 플러시되지 않고 버퍼에 존재할 수 있음.</li></ol></li><li>커밋 처리 (Commit Processing)<ol><li>애플리케이션이 <code>COMMIT</code> 요청.</li><li><strong>TM</strong>이 <strong>커밋 레코드</strong>를 WAL 에 작성.</li><li><strong>Log Manager</strong>가 해당 로그를 디스크에 <strong>fsync</strong> (Group Commit 가능).</li><li>로그 fsync 가 완료되면 <strong>Durability</strong> 보장 상태로 전환.</li></ol></li><li>데이터 플러시 & 복제<ol><li>**버퍼 매니저 (BM)**는 변경된 페이지를 <strong>비동기 플러시</strong>(Checkpoint 시점 등) 로 디스크에 반영.</li><li>**Replication Manager(REP)**가 변경 내용을 리플리카 노드로 전파 (동기/비동기 모드 설정 가능).</li></ol></li><li>커밋 완료 응답<ol><li>로그 fsync 완료 직후 <strong>TM</strong>이 애플리케이션에 <code>COMMIT OK</code> 응답.</li><li>애플리케이션은 후속 트랜잭션을 시작할 수 있음.</li></ol></li><li>장애 발생 시 복구 절차<ol><li>장애 복구 모듈 (<strong>Recovery Manager, RM</strong>) 이 로그를 기반으로 <strong>Analysis → Redo → Undo</strong> 수행.<ul><li><strong>Analysis</strong>: 장애 시점 트랜잭션 상태 식별.</li><li><strong>Redo</strong>: 커밋 완료된 변경 사항을 재적용.</li><li><strong>Undo</strong>: 커밋되지 않은 변경 사항 롤백.</li></ul></li></ol></li></ol><p>이 흐름은 <strong>애플리케이션 요청 → 트랜잭션 매니저 → 동시성 제어 → 버퍼 매니저 → 로그 매니저 → 스토리지 계층</strong> 순서로 동작하며, <strong>Durability 보장 후 응답</strong>을 반환하는 구조이다.</p><pre class=mermaid>sequenceDiagram
  autonumber
  participant App as 애플리케이션
  participant TM as 트랜잭션 매니저(Txn Manager)
  participant CC as 동시성 제어(락/MVCC)
  participant BM as 버퍼 매니저(Buffer Manager)
  participant LOG as 로그 매니저(WAL)
  participant STO as 스토리지(Data Files)
  participant REP as 복제/스토리지 동기화(옵션)
  participant RM as 복구 매니저(Recovery)

  %% 트랜잭션 시작
  App-&gt;&gt;TM: BEGIN
  TM--&gt;&gt;App: Txn ID 부여

  %% DML 실행
  loop DML 연산들(INSERT/UPDATE/DELETE)
    App-&gt;&gt;TM: DML 요청
    TM-&gt;&gt;CC: 격리성 보장 요청(락 획득 또는 스냅샷 확보)
    CC--&gt;&gt;TM: 허용/대기(경합 시 대기 또는 재시도)
    TM-&gt;&gt;BM: 페이지 읽기/변경(Dirty Page 생성)
    TM-&gt;&gt;LOG: REDO/Undo 로그 레코드 생성(LSN 배정)
    LOG--&gt;&gt;TM: 로그 수집 OK(아직 fsync 전)
    TM--&gt;&gt;App: DML 처리 결과
  end

  %% 커밋 경로
  App-&gt;&gt;TM: COMMIT
  TM-&gt;&gt;LOG: 커밋 레코드 기록 및 fsync(Group Commit 가능)
  LOG--&gt;&gt;TM: 영속화 보장(지속성: Durability)
  TM-&gt;&gt;BM: 변경 페이지 플러시 스케줄(체크포인트/백그라운드)
  par 선택: 동기 복제일 때
    TM-&gt;&gt;REP: 커밋 LSN 전파(ACK 대기)
    REP--&gt;&gt;TM: 복제 ACK
  and 비동기 복제일 때
    TM-&gt;&gt;REP: 커밋 LSN 비동기 전파
  end
  TM--&gt;&gt;App: COMMIT OK

  %% 롤백 경로(실패 또는 취소)
  opt 오류/취소 발생 시
    App-&gt;&gt;TM: ROLLBACK
    TM-&gt;&gt;RM: Undo 수행(로그 기반 되돌리기)
    RM-&gt;&gt;BM: 변경 전 이미지로 복원
    TM--&gt;&gt;App: ROLLBACK OK
  end

  %% 크래시 리커버리(시스템 재시작 시)
  opt 재시작 시나리오
    RM-&gt;&gt;LOG: Analysis 단계(활성 Txn/더티 페이지 파악)
    RM-&gt;&gt;BM: Redo 단계(커밋된 변경 재적용)
    RM-&gt;&gt;BM: Undo 단계(미완료 Txn 되돌리기)
    RM--&gt;&gt;TM: 일관 상태 복구 완료
  end
</pre><ul><li><strong>트랜잭션 매니저 (TM)</strong>: 트랜잭션 ID 발급, 수명주기 관리 (BEGIN/COMMIT/ROLLBACK), 각 모듈 오케스트레이션의 허브 역할.</li><li><strong>동시성 제어 (CC)</strong>: 락 또는 <strong>MVCC 스냅샷</strong>으로 <strong>격리성 (Isolation)</strong> 보장. 경합 시 대기·재시도·타임아웃 등 정책 수행.</li><li><strong>버퍼 매니저 (BM)</strong>: 페이지 캐싱/수정 (Dirty Page), 체크포인트·백그라운드 플러시로 I/O 효율화.</li><li><strong>로그 매니저 (WAL)</strong>: 모든 변경의 <strong>Redo/Undo 로그</strong>를 먼저 기록하고, <strong>커밋 시 fsync</strong>로 <strong>지속성 (Durability)</strong> 확보. Group Commit 로 지연·처리량 균형.</li><li><strong>스토리지 (STO)</strong>: 데이터 파일의 최종 영속화. WAL 선기록 규칙 덕분에 데이터 페이지는 <strong>지연 플러시</strong>여도 안전.</li><li><strong>복제/스토리지 동기화 (REP, 옵션)</strong>: 동기 복제 (ACK 후 커밋 보장) 또는 비동기 복제 (지연 전파) 선택으로 RPO/RTO·지연시간 트레이드오프 최적화.</li><li><strong>복구 매니저 (RM)</strong>: 재시작 시 <strong>ARIES</strong> 절차 (Analysis→Redo→Undo) 로 <strong>원자성·일관성</strong> 회복. 미완료 트랜잭션은 Undo, 커밋된 변경은 Redo.</li></ul><p>핵심은 <strong>WAL 선기록 + 동시성 제어 + 지연 플러시/복제</strong>의 조합이다. 커밋 시점에는 <strong>로그 영속화가 최우선</strong>, 데이터 페이지는 이후 배치 플러시로 처리된다. 이렇게 모듈별 책임을 분리해 <strong>ACID 의 A/C/I/D</strong>를 체계적으로 달성한다.</p><h4 id=아키텍처-및-구성-요소>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소>#</a></h4><pre class=mermaid>flowchart TB
  subgraph APP[&#34;애플리케이션 계층&#34;]
    A[애플리케이션]
  end

  subgraph TMX[&#34;트랜잭션 계층&#34;]
    TM[Transaction Manager]
    CC[&#34;Concurrency Manager\n(Lock/MVCC)&#34;]
    RM[Recovery Manager]
    LM[&#34;Log Manager (WAL)&#34;]
  end

  subgraph BUF[&#34;저장소 계층&#34;]
    BM[Buffer Manager]
    DS[(Data/Index Files)]
  end

  subgraph OPT[&#34;선택 컴포넌트&#34;]
    DLD[Deadlock Detector]
    CKP[Checkpoint Manager]
    COOR[&#34;Dist. Txn Coordinator (2PC)&#34;]
    REPL[Replication/Consensus]
  end

  A --&gt;|BEGIN/Query| TM
  TM --&gt;|isolation/plan| CC
  CC --&gt;|latch/lock or snapshot| BM
  TM --&gt;|log write intent| LM
  LM --&gt;|WAL fsync| DS
  BM --&gt;|page read/write| DS
  RM --&gt;|ARIES controls| LM
  CKP --&gt;|flush dirty set| BM
  DLD --&gt;|detect/resolve| CC
  COOR --&gt;|prepare/commit| TM
  REPL --&gt;|sync/commit quorum| DS

  %% 커밋 경로(요약)
  TM -.commit txns.-&gt; LM -.force log.-&gt; DS
  TM -.release/isolation.-&gt; CC -.unfix.-&gt; BM
</pre><ul><li><strong>Commit 경로</strong>: <code>TM → LM(WAL fsync) → DS</code> 순으로 <strong>D(지속성)</strong> 확보 후 <strong>락/스냅샷 해제</strong>로 <strong>I(격리)</strong> 종료.</li></ul><ul><li><strong>Crash 후</strong>: <code>RM</code> 이 WAL 로 <strong>A(원자성)</strong> 및 <strong>C(일관성)</strong> 복구 (Analysis/Redo/Undo).</li><li><strong>분산 커밋</strong>: <code>COOR</code> 가 2PC prepare/commit, <code>REPL</code> 이 동기 복제로 내구성 강화.</li></ul><h5 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h5><table><thead><tr><th>구분</th><th>구성 요소</th><th>설명</th><th>주요 역할·기능</th><th>ACID 기여</th><th>특징</th></tr></thead><tbody><tr><td><strong>필수</strong></td><td>Transaction Manager</td><td>트랜잭션 생명주기 관리</td><td>시작/커밋/롤백, 상태추적, 타임아웃</td><td>A, C</td><td>Savepoint, 자동 재시도 정책 연계</td></tr><tr><td><strong>필수</strong></td><td>Concurrency Manager (Lock/MVCC)</td><td>격리 구현 계층</td><td>2PL 락 (S/X/IS/IX), MVCC 스냅샷/가시성</td><td>I, C</td><td>워크로드별 2PL↔MVCC 선택/혼용</td></tr><tr><td><strong>필수</strong></td><td>Log Manager (WAL)</td><td>변경 이전에 로그 기록</td><td>Redo/Undo 로그, LSN, fsync</td><td>A, D</td><td>Write-ahead, 그룹 커밋</td></tr><tr><td><strong>필수</strong></td><td>Buffer Manager</td><td>버퍼 캐시/페이지 관리</td><td>페이지 fix/unfix, 교체 정책</td><td>A, D, 성능</td><td>LRU/Clock, 핫셋 캐싱</td></tr><tr><td><strong>필수</strong></td><td>Recovery Manager</td><td>장애 후 일관성 회복</td><td>ARIES(Analysis/Redo/Undo)</td><td>A, C, D</td><td>Fuzzy checkpoint, 손상 페이지 격리</td></tr><tr><td><strong>필수</strong></td><td>Storage (Data Files/Index)</td><td>영속 데이터 저장</td><td>페이지/세그먼트 관리, 인덱스 I/O</td><td>D</td><td>WAL 과 순서 보장, CRC 등 무결성</td></tr><tr><td><strong>선택</strong></td><td>Deadlock Detector</td><td>교착 상태 탐지/해결</td><td>Wait-for graph, 희생자 강제 롤백</td><td>I, 가용성</td><td>낮은 오버헤드 주기 검사</td></tr><tr><td><strong>선택</strong></td><td>Checkpoint Manager</td><td>복구 단축/로그 절감</td><td>주기적 체크포인트/더티 페이지 플러시</td><td>D, 성능</td><td>Fuzzy 방식으로 작업 지연 최소화</td></tr><tr><td><strong>선택</strong></td><td>MVCC Engine (전용)</td><td>멀티버전 관리</td><td>버전 체인/가비지 수집/시점 읽기</td><td>I</td><td>고동시성 읽기, GC 튜닝 필요</td></tr><tr><td><strong>선택</strong></td><td>Dist. Txn Coordinator (2PC)</td><td>분산 트랜잭션 조정</td><td>prepare/commit, 참가자 투표</td><td>A, C</td><td>로그 기반 재시도, 장애 시 보상</td></tr><tr><td><strong>선택</strong></td><td>Replication/Consensus</td><td>고가용성·내구성 강화</td><td>동기 복제, 리더 선출 (Raft/Paxos)</td><td>D, C</td><td>RPO/RTO 목표 충족</td></tr><tr><td><strong>선택</strong></td><td>Audit/Capture</td><td>변경 이력/감사</td><td>CDC 스트림, 감사 로그</td><td>C</td><td>규제/컴플라이언스 대응</td></tr></tbody></table><h4 id=주요-기능과-역할>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할>#</a></h4><table><thead><tr><th>ACID 속성</th><th>핵심 기능</th><th>구현 메커니즘</th><th>역할</th></tr></thead><tbody><tr><td><strong>Atomicity</strong> (원자성)</td><td>트랜잭션 전체 성공 또는 전체 실패 보장</td><td>트랜잭션 로그 (WAL), Undo/Redo, Savepoint, Rollback</td><td>부분 완료 방지, 오류 시 복구로 일관성 유지</td></tr><tr><td><strong>Consistency</strong> (일관성)</td><td>데이터 무결성 및 규칙 준수</td><td>스키마 제약조건, 트리거, 참조 무결성 (FK), 비즈니스 로직 검증</td><td>유효한 상태만 데이터베이스에 반영</td></tr><tr><td><strong>Isolation</strong> (격리성)</td><td>트랜잭션 간 상호 간섭 방지</td><td>MVCC, 2PL, Row/Key Lock, Isolation Level 설정</td><td>동시성 제어로 Consistency 유지 및 Dirty/Phantom Read 방지</td></tr><tr><td><strong>Durability</strong> (지속성)</td><td>커밋된 데이터 영구 저장</td><td>WAL, 체크포인트, 동기 복제, 저널링 파일 시스템</td><td>장애 이후에도 데이터 보존 및 복구</td></tr><tr><td><strong>Recovery System</strong> (복구)</td><td>장애 시 데이터 일관성 복구</td><td>ARIES(분석→REDO→UNDO), 백업/복원, 리플리케이션 로그</td><td>Atomicity·Durability 보완, 비정상 종료 후 복원</td></tr><tr><td><strong>Concurrency Control</strong> (동시성 제어)</td><td>Isolation 구현 및 성능 최적화</td><td>Lock Manager, Optimistic CC, Timestamp Ordering</td><td>동시 처리 성능 유지와 무결성 보장</td></tr></tbody></table><h5 id=acid-주요-기능-상호-관계>ACID 주요 기능 상호 관계<a hidden class=anchor aria-hidden=true href=#acid-주요-기능-상호-관계>#</a></h5><table><thead><tr><th>기능 요소</th><th>관련 ACID 속성</th><th>상호 관계</th></tr></thead><tbody><tr><td>트랜잭션 매니저</td><td>Atomicity, Consistency</td><td>트랜잭션 경계 관리 (시작·커밋·롤백), 원자성 보장으로 일관성 검증 기반 마련</td></tr><tr><td>동시성 제어 모듈</td><td>Isolation, Consistency</td><td>MVCC·락으로 트랜잭션 간 간섭 방지, 일관성 유지 지원</td></tr><tr><td>컨시스턴시 엔진</td><td>Consistency</td><td>제약조건·비즈니스 규칙 검증, Atomicity 와 함께 데이터 무결성 보장</td></tr><tr><td>로그/저장소</td><td>Durability, Atomicity</td><td>변경사항 기록 (WAL), 장애 시 복구 가능, 커밋 이후 데이터 영속성 확보</td></tr><tr><td>복구 모듈</td><td>Durability, Atomicity, Consistency</td><td>장애 후 데이터베이스 복원, 트랜잭션 상태 정합성 회복</td></tr></tbody></table><ul><li><strong>Atomicity</strong>는 Rollback 과 트랜잭션 로그로, <strong>Consistency</strong>는 스키마 제약과 비즈니스 규칙으로, <strong>Isolation</strong>은 락·MVCC 로, <strong>Durability</strong>는 WAL 과 복제 기술로 보장한다.</li><li>각 기능은 독립적으로 존재하지만, 예를 들어 <strong>Atomicity 보장이 Consistency 유지의 전제</strong>가 되고, <strong>Isolation 이 없으면 Consistency 가 깨질 수 있으며</strong>, <strong>Durability 는 Atomicity 완료 이후에만 의미</strong>가 있다.</li><li>복구 시스템과 동시성 제어는 모든 ACID 속성을 보완하는 핵심 기반이며, 이들의 조합이 트랜잭션 안정성을 만든다.</li></ul><h5 id=단일-db-vs-분산-db-환경별-acid-기능역할-변화>단일 DB vs. 분산 DB 환경별 ACID 기능·역할 변화<a hidden class=anchor aria-hidden=true href=#단일-db-vs-분산-db-환경별-acid-기능역할-변화>#</a></h5><table><thead><tr><th>ACID 속성 / 기능 요소</th><th>단일 DB 환경</th><th>분산 DB 환경</th><th>설계 변화 포인트</th><th>대안·보완 패턴</th></tr></thead><tbody><tr><td><strong>Atomicity</strong> (원자성)</td><td>로컬 트랜잭션 로그 (WAL), Undo/Redo 기반 원자성 보장</td><td>다중 노드 간 트랜잭션 원자성 확보 필요, 네트워크 지연·부분 실패 가능</td><td>2PC(2-Phase Commit) 또는 3PC, 네트워크 타임아웃 설계</td><td>Saga 패턴, TCC(Try-Confirm/Cancel), Outbox 패턴</td></tr><tr><td><strong>Consistency</strong> (일관성)</td><td>단일 인스턴스에서 스키마·제약조건으로 일관성 보장</td><td>분산 환경에서는 노드별 복제 지연·네트워크 분할로 인한 일관성 깨짐 가능</td><td>최종 일관성 (Eventual Consistency) 허용 여부 결정</td><td>BASE 모델 도입, CRDT(Conflict-free Replicated Data Type), 데이터 검증 파이프라인</td></tr><tr><td><strong>Isolation</strong> (격리성)</td><td>MVCC, 2PL 로 안정적 구현 가능</td><td>분산 트랜잭션에서 락 유지가 장시간 필요 → 성능 저하 위험</td><td>락 범위 최소화, 분산 락 서비스 (Redis/ZooKeeper) 활용</td><td>Snapshot Isolation, Logical Sharding, Read/Write Quorum</td></tr><tr><td><strong>Durability</strong> (지속성)</td><td>WAL·체크포인트·단일 스토리지 복제</td><td>노드 간 동기 복제 또는 비동기 복제 선택 필요</td><td>동기 복제는 낮은 RTO, 높은 지연 / 비동기 복제는 낮은 지연, 높은 데이터 손실 위험</td><td>Raft/Paxos 합의 기반 로그 복제, 멀티 AZ/Region 복제</td></tr><tr><td><strong>Recovery System</strong> (복구)</td><td>단일 노드 장애 시 WAL 기반 복구</td><td>다중 노드 장애·네트워크 분할 복구 복잡</td><td>장애 노드 복구 시 데이터 재동기화 전략 필요</td><td>Anti-entropy Sync, Leader-Follower 재선출, Incremental Snapshot</td></tr><tr><td><strong>Concurrency Control</strong> (동시성 제어)</td><td>단일 Lock Manager, 로컬 MVCC</td><td>분산 락 서비스 필요, 네트워크 지연 시 성능 하락</td><td>글로벌 락 최소화, 노드별 독립 트랜잭션 설계</td><td>Optimistic Concurrency Control, Vector Clock, Versioned Writes</td></tr></tbody></table><ul><li><strong>단일 DB</strong>는 ACID 구현이 단순하며 DBMS 내부 기능으로 대부분 해결 가능하지만, <strong>분산 DB</strong>는 네트워크 지연·노드 장애·복제 지연 등 외부 요인이 복잡하게 얽힘.</li><li><strong>Atomicity</strong>와 <strong>Consistency</strong>는 분산 환경에서 2PC 같은 강한 방법보다 <strong>Saga/TCC 같은 비동기 보상 패턴</strong>으로 대체되는 경우 많음.</li><li><strong>Isolation</strong>은 락 기반보다는 <strong>스냅샷 격리 (SI)·쿼럼 읽기/쓰기</strong> 같은 분산 친화적 방법이 선호됨.</li><li><strong>Durability</strong>는 Raft/Paxos 합의 알고리즘, Cross-Region 복제로 보장하며, 비용과 지연 간 균형 필요.</li><li><strong>복구와 동시성 제어</strong>는 단일 환경보다 복잡도가 크게 증가하므로, 아키텍처 설계 초기부터 장애·성능 시뮬레이션이 필수.</li></ul><h3 id=특성-분석-characteristics-analysis>특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#특성-분석-characteristics-analysis>#</a></h3><h4 id=장점-및-이점>장점 및 이점<a hidden class=anchor aria-hidden=true href=#장점-및-이점>#</a></h4><p>ACID 속성은 데이터베이스 트랜잭션의 안정성, 무결성, 신뢰성을 보장하며, 개발자와 운영자가 데이터 정합성 문제 없이 안정적으로 시스템을 운영할 수 있게 한다.<br>구체적으로는 데이터 무결성과 신뢰성 유지, 장애 시 복구 용이성, 안전한 동시성 제어, 비즈니스 규칙 준수, 개발 복잡성 감소, 규제 준수 지원 등의 이점을 제공한다.<br>또한 트랜잭션 격리수준 조정을 통해 성능과 정합성 간의 균형을 조절할 수 있고, 멀티테넌트 환경에서 데이터 보호가 용이하며, 오류를 트랜잭션 단위로 국소화할 수 있다.</p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td>장점</td><td>데이터 무결성·신뢰성 보장</td><td>실패·경쟁 상황에서도 데이터 정합성 유지</td><td>Atomicity, Consistency, WAL</td></tr><tr><td>장점</td><td>장애 복구 용이성</td><td>장애 후 로그 기반으로 빠른 복구 가능</td><td>WAL, ARIES 알고리즘</td></tr><tr><td>장점</td><td>안전한 동시성 제어</td><td>다중 사용자 환경에서 데이터 충돌 방지</td><td>Isolation, MVCC, Lock</td></tr><tr><td>장점</td><td>비즈니스 규칙 준수</td><td>스키마·제약조건·검증 로직으로 업무 규칙 자동 보장</td><td>Consistency, Constraint, Trigger</td></tr><tr><td>장점</td><td>개발 복잡성 감소</td><td>ACID 가 동시성·장애 처리 추상화하여 비즈니스 로직 집중 가능</td><td>트랜잭션 경계, DB 엔진 보장</td></tr><tr><td>장점</td><td>규제·컴플라이언스 지원</td><td>감사·법적 요구 사항 대응에 필요한 트랜잭션 기록·로그 제공</td><td>트랜잭션 로그, 감사 로그</td></tr><tr><td>장점</td><td>예측 가능한 성능 보장</td><td>격리 수준 조절로 성능과 정합성 간 균형 유지 가능</td><td>ANSI 격리 수준 조정</td></tr><tr><td>장점</td><td>멀티테넌트 환경 지원</td><td>데이터 격리·보호 용이, 테넌트 간 간섭 최소화</td><td>스키마 분리, 접근 제어</td></tr><tr><td>장점</td><td>오류 국소화</td><td>트랜잭션 단위 롤백으로 장애 영향 최소화</td><td>Atomicity, Rollback</td></tr></tbody></table><p>ACID 의 장점은 <strong>데이터 무결성과 신뢰성 확보</strong>, <strong>장애 복구 능력</strong>, <strong>동시성 제어 안정성</strong>이 핵심이며, 이를 통해 금융·공공·대규모 서비스 환경에서도 안전한 데이터 처리가 가능하다.<br>또한 <strong>개발 생산성 향상</strong>, <strong>비즈니스 규칙 강제</strong>, <strong>규제 준수</strong>를 지원하고, <strong>성능 - 정합성 균형 조절</strong>과 <strong>멀티테넌트 지원</strong> 같은 확장성 측면에서도 강점을 가진다.<br>특히 <strong>오류를 트랜잭션 단위로 제한</strong>하여 시스템 전체의 안정성을 높인다.</p><h5 id=단일-db--분산-db-전환-시-acid-속성별-설계-변화-비교>단일 DB → 분산 DB 전환 시 ACID 속성별 설계 변화 비교<a hidden class=anchor aria-hidden=true href=#단일-db--분산-db-전환-시-acid-속성별-설계-변화-비교>#</a></h5><table><thead><tr><th>속성 (ACID)</th><th>단일 DB 에서의 장점</th><th>분산 DB 전환 시 변화/리스크</th><th>보완 설계·대안 패턴</th></tr></thead><tbody><tr><td><strong>Atomicity (원자성)</strong></td><td>단일 트랜잭션 경계에서 All-or-Nothing 보장 용이 (WAL/로그로 롤백 간단)</td><td>노드·파티션 간 부분 실패/부분 커밋 위험, 분산 롤백 복잡</td><td>2PC/3PC(필요 시), <strong>SAGA(보상 트랜잭션)</strong>, Outbox/Inbox, 멱등 처리, 트랜잭션 경계의 도메인 재설계</td></tr><tr><td><strong>Consistency (일관성)</strong></td><td>스키마 제약·트리거로 강한 일관성 즉시 보장</td><td>네트워크 지연/파티션으로 전역 강일 보장 비용↑ → 일시적 불일치 가능</td><td><strong>강일/최종 일관성 선택</strong>(요구별), CQRS, CRDT(충돌 자동해결 도메인), 검증을 앱 레벨로 승격, 리드 리플리카 정합성 정책 (RPO/RTO)</td></tr><tr><td><strong>Isolation (격리성)</strong></td><td>2PL/MVCC 로 ANSI 격리수준 제공, 현상 (Dirty/Phantom) 관리 용이</td><td>글로벌 락/버전 동기화 비용 증가, 지연과 핫샤드로 처리량 저하</td><td><strong>격리수준 완화</strong>(Read Committed/RC+), 파티션 단위 트랜잭션, <strong>분산 락 서비스</strong>(ZooKeeper/etcd), 버전 기반/낙관적 동시성, Hot key 분산 (샤딩·키 리라이트)</td></tr><tr><td><strong>Durability (지속성)</strong></td><td>단일 노드 WAL+ 체크포인트로 커밋 내구성 명확</td><td>다중 노드 복제 지연·스플릿 브레인·영구 손실 위험 (합의 실패 시)</td><td>합의형 복제 (<strong>Raft/Paxos</strong>), <strong>동기/준동기 복제 정책</strong>, 커밋 퀘럼 정의, <strong>글로벌 체크포인트</strong>, 다중 AZ/리전 배치, 백업·Point-in-Time Recovery</td></tr></tbody></table><h4 id=단점-및-제약사항과-해결방안>단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#단점-및-제약사항과-해결방안>#</a></h4><ul><li>ACID 구현은 데이터 무결성과 신뢰성을 보장하지만, 성능·확장성·가용성·운영 복잡성의 대가가 따른다.</li><li>성능 저하는 락 관리, 버전 관리, 로그 기록 등에서 발생하며, 그룹 커밋·낙관적 동시성 제어·격리 수준 완화로 완화 가능하다.</li><li>분산 환경에서는 글로벌 일관성 유지가 확장성을 제한하므로, SAGA·Eventual Consistency 등 대안이 필요하다.</li><li>Deadlock·Lock 경합은 락 순서 규약, 타임아웃, MVCC 등으로 완화한다.</li><li>장기 트랜잭션은 OLTP 부하를 악화시키므로, 트랜잭션 분할·배치화가 필요하다.</li><li>Phantom Read·Lost Update 같은 이상 현상은 Serializable, SSI, 버전 필드 검증으로 방지한다.</li><li>스토리지나 로그 I/O 실패 시 Durability 가 깨질 수 있어, 안정적 하드웨어·WAL 정책 조정·복제 구성이 필요하다.</li></ul><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법 / 대안</th></tr></thead><tbody><tr><td>단점</td><td>성능 오버헤드</td><td>락/버전 관리, 로그 I/O</td><td>처리 지연, TPS 저하</td><td>성능 모니터링</td><td>격리 수준 완화, 배치/그룹 커밋</td><td>MVCC, 낙관적 CC</td></tr><tr><td>단점</td><td>확장성 제약</td><td>글로벌 일관성 유지 비용</td><td>분산 환경 성능 저하</td><td>Throughput 측정</td><td>샤딩 + 로컬 트랜잭션</td><td>SAGA, Eventual Consistency</td></tr><tr><td>단점</td><td>가용성 트레이드오프</td><td>CAP 정리상 Consistency 우선</td><td>Failover 지연, 서비스 중단</td><td>장애 시나리오 테스트</td><td>지역 일관성 적용</td><td>BASE 모델, Regional Consistency</td></tr><tr><td>문제점</td><td>Deadlock / Lock 경합</td><td>순환 대기, 자원 경합</td><td>트랜잭션 중단, 대기 증가</td><td>Deadlock Detector, 대기 큐 모니터</td><td>락 순서 규약, 락 범위 축소</td><td>타임아웃, MVCC</td></tr><tr><td>문제점</td><td>장기 트랜잭션</td><td>장시간 자원 점유</td><td>Blocking, 메모리 점유</td><td>트랜잭션 시간 로깅</td><td>트랜잭션 분리, 배치 처리</td><td>강제 종료, 체크포인트</td></tr><tr><td>문제점</td><td>일관성 이상 현상</td><td>Phantom Read, Lost Update</td><td>잘못된 데이터 반환/갱신</td><td>Isolation Test, Audit Log</td><td>Serializable, 버전 필드 체크</td><td>SSI, OCC</td></tr><tr><td>문제점</td><td>스토리지/로그 실패</td><td>fsync 지연/실패</td><td>Durability 약화</td><td>로그 무결성 검사</td><td>안정적 스토리지, 배터리 캐시</td><td>WAL 정책 조정, 로그 복제</td></tr></tbody></table><p>ACID 는 높은 데이터 신뢰성을 제공하지만, 락·로그·버전 관리로 인한 성능 저하, 글로벌 일관성의 확장성 한계, CAP 에 따른 가용성 손실, Deadlock 과 장기 트랜잭션, 일관성 이상 현상, 그리고 스토리지 I/O 실패 시 Durability 약화 등의 문제가 발생할 수 있다. 이를 해결하려면 격리 수준 조정, MVCC·OCC·SAGA·Eventual Consistency 같은 대안 적용, 락 순서 규약, 배치·그룹 커밋, 안정적 스토리지와 WAL 정책 최적화 등 종합적 접근이 필요하다.</p><h4 id=트레이드오프-관계-분석>트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석>#</a></h4><table><thead><tr><th>비교 항목</th><th>A 선택 시 장점</th><th>A 선택 시 단점</th><th>B 선택 시 장점</th><th>B 선택 시 단점</th><th>고려 기준</th></tr></thead><tbody><tr><td><strong>격리성 vs 동시성</strong></td><td>높은 격리 (Serializable) 로 직관적 일관성, 오류 방지</td><td>락 경합·대기, 처리량 저하</td><td>낮은 격리로 처리량↑, 지연↓</td><td>비일관 상태 가능, 앱 보정 필요</td><td>데이터 무결성 vs 처리 성능 우선순위</td></tr><tr><td><strong>일관성 vs 성능</strong></td><td>강한 일관성으로 트랜잭션 후 데이터 무결성 보장</td><td>제약 조건·검증 오버헤드로 성능 저하</td><td>약한 일관성으로 성능↑</td><td>일시적 불일치 가능</td><td>규제·금융 등 강일관 필요 여부</td></tr><tr><td><strong>지속성 vs 응답성</strong></td><td>동기 WAL/복제로 데이터 안전</td><td>I/O 대기 증가, 응답 지연</td><td>비동기 기록으로 응답 빠름</td><td>장애 시 데이터 유실 위험</td><td>RPO/RTO 목표, 데이터 가치</td></tr><tr><td><strong>ACID vs 확장성</strong></td><td>ACID 유지로 강일관성·신뢰성 확보</td><td>2PC/3PC 지연, 네트워크 부담</td><td>BASE/SAGA 로 확장·가용성↑</td><td>강일관성 손실</td><td>분산 환경, 트랜잭션 범위</td></tr><tr><td><strong>락 vs MVCC</strong></td><td>단순, 메모리 효율↑</td><td>경합 시 대기 발생</td><td>읽기 동시성↑</td><td>버전 관리 비용</td><td>읽기 vs 쓰기 비중</td></tr><tr><td><strong>즉시 커밋 vs Group Commit</strong></td><td>지연 없음</td><td>I/O 빈번, 처리량↓</td><td>배치 처리로 처리량↑</td><td>커밋 지연 발생</td><td>응답 지연 허용 범위</td></tr></tbody></table><p>ACID 속성 간에는 <strong>안전성과 성능·확장성</strong> 사이의 본질적 균형 조정이 필요하다.<br>높은 격리·강한 일관성·동기 지속성은 <strong>데이터 신뢰성</strong>을 보장하지만, <strong>성능 저하와 확장성 한계</strong>를 유발한다.<br>반대로 낮은 격리·약한 일관성·비동기 지속성·BASE 모델은 <strong>처리량과 가용성</strong>을 높이지만, <strong>데이터 무결성 위험</strong>을 감수해야 한다.<br>결국 <strong>업무 특성, 규제 요건, SLA</strong>에 맞춰 설계해야 하며, 2PC/3PC·SAGA·MVCC·Group Commit 등 구현 전략의 장단점을 이해하고 선택하는 것이 핵심이다.</p><h3 id=구현-및-분류-implementation--classification>구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#구현-및-분류-implementation--classification>#</a></h3><h4 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h4><table><thead><tr><th>분류</th><th>기법</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td>동시성 제어</td><td>2PL(보수적/강 2PL)</td><td>락 획득→해제 2 단계로 직렬가능성 보장</td><td>공유/배타 락, 락 매니저</td><td>Growing/ Shrinking, 필요 자원 선점 (보수적)</td><td><strong>Serializable</strong> 보장</td><td>강한 일관성·충돌 빈번</td><td>데드락 가능, 쓰기 - 쓰기 충돌에 강함</td></tr><tr><td>동시성 제어</td><td>MVCC(=Snapshot Isolation)</td><td>버전 체인으로 " 읽기 - 쓰기 " 비차단</td><td>TxID, 가시성 규칙, Undo/버전 저장</td><td>각 트랜잭션에 일관된 스냅샷 제공</td><td>읽기 성능·동시성 향상</td><td>읽기 많은 OLTP</td><td>팬텀/갱신충돌은 엔진별 처리 (SSI 등)</td></tr><tr><td>복구/저장</td><td>WAL(+ARIES)</td><td>" 로그 먼저, 데이터 나중 " 선기록</td><td>WAL 로그, LSN, 체크포인트</td><td>Commit 시 로그 fsync, 복구는 Analysis→Redo→Undo</td><td><strong>Durability</strong>·원자성</td><td>대부분 RDBMS</td><td>그룹 커밋과 궁합, 로그 I/O 민감</td></tr><tr><td>복구/저장</td><td>섀도 페이징</td><td>페이지 사본에 갱신 후 원자적 스위치</td><td>페이지 맵, 섀도/현재 버전</td><td>커밋 시 포인터 전환</td><td>단순 원자성/복구</td><td>임베디드/학습용</td><td>랜덤 쓰기↑, GC 부담</td></tr><tr><td>분산 트랜잭션</td><td>2PC(XA)</td><td>노드 간 원자 커밋</td><td>코디네이터/파티시펀트</td><td>Prepare→Commit/Abort</td><td>분산 <strong>Atomicity</strong></td><td>다중 DB/서비스</td><td>코디네이터 장애 취약, 지연↑</td></tr><tr><td>성능/운영</td><td>그룹 커밋</td><td>여러 커밋을 한 번에 fsync</td><td>로그 버퍼, 플러시 정책</td><td>짧은 기간 커밋 집계→단일 fsync</td><td>TPS 향상</td><td>쓰기 많은 OLTP</td><td>지연↔처리량 트레이드오프</td></tr></tbody></table><ul><li>인덱스 로그 (ARIES/IM): ARIES 의 페이지·인덱스 수준 REDO/UNDO 로깅. 앱 코드 예시보다는 엔진 내부 최적화로, WAL 범주에서 함께 이해 (인덱스 분할/삭제 등도 로그로 복구).</li></ul><h5 id=2pl-postgresql-pythonpsycopg>2PL (PostgreSQL, Python/psycopg)<a hidden class=anchor aria-hidden=true href=#2pl-postgresql-pythonpsycopg>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># pip install psycopg[binary]</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg</span>
</span></span><span class=line><span class=cl><span class=n>conn1</span> <span class=o>=</span> <span class=n>psycopg</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=demo user=postgres&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn2</span> <span class=o>=</span> <span class=n>psycopg</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=demo user=postgres&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c1</span> <span class=o>=</span> <span class=n>conn1</span><span class=o>.</span><span class=n>cursor</span><span class=p>();</span> <span class=n>c2</span> <span class=o>=</span> <span class=n>conn2</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tx1: 특정 행을 배타락으로 고정(UPDATE 의도) → 2PL에서 Growing phase</span>
</span></span><span class=line><span class=cl><span class=n>c1</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;BEGIN&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c1</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM accounts WHERE id=1 FOR UPDATE&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># Tx2: 같은 행을 잠그려 하면 블로킹(직렬가능성에 맞게 직렬화)</span>
</span></span><span class=line><span class=cl><span class=n>c2</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;BEGIN&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>c2</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE accounts SET balance=balance+10 WHERE id=1&#34;</span><span class=p>)</span>  <span class=c1># 여기서 Tx1이 커밋/롤백 전까지 대기</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Tx2 blocked or error:&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tx1 커밋 → Shrinking phase에서 락 해제</span>
</span></span><span class=line><span class=cl><span class=n>conn1</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># 이제 Tx2 진행 가능</span>
</span></span><span class=line><span class=cl><span class=n>conn2</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>핵심: <code>FOR UPDATE</code> 로 <strong>행 락</strong>을 획득 (2PL 의 Growing), 커밋 시 해제 (Shrinking).</li></ul><h5 id=mvcc--snapshot-isolation-postgresql-pythonpsycopg>MVCC / Snapshot Isolation (PostgreSQL, Python/psycopg)<a hidden class=anchor aria-hidden=true href=#mvcc--snapshot-isolation-postgresql-pythonpsycopg>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg</span>
</span></span><span class=line><span class=cl><span class=c1># 두 세션 각각 REPEATABLE READ(스냅샷 고정)</span>
</span></span><span class=line><span class=cl><span class=n>connA</span> <span class=o>=</span> <span class=n>psycopg</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=demo user=postgres&#34;</span><span class=p>,</span> <span class=n>autocommit</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connB</span> <span class=o>=</span> <span class=n>psycopg</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=demo user=postgres&#34;</span><span class=p>,</span> <span class=n>autocommit</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connA</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SET TRANSACTION ISOLATION LEVEL REPEATABLE READ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connB</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SET TRANSACTION ISOLATION LEVEL REPEATABLE READ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TxA: 스냅샷 시점의 합계를 읽는다</span>
</span></span><span class=line><span class=cl><span class=n>curA</span> <span class=o>=</span> <span class=n>connA</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>curA</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT SUM(balance) FROM accounts&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;TxA sum snapshot:&#34;</span><span class=p>,</span> <span class=n>curA</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TxB: 한 행 갱신 후 커밋(새 버전 생성, 기존 버전은 TxA에 계속 보임)</span>
</span></span><span class=line><span class=cl><span class=n>curB</span> <span class=o>=</span> <span class=n>connB</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>curB</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE accounts SET balance=balance+100 WHERE id=2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>connB</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TxA: 같은 쿼리를 다시 실행해도 동일 스냅샷 → 동일 결과</span>
</span></span><span class=line><span class=cl><span class=n>curA</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT SUM(balance) FROM accounts&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;TxA sum still snapshot:&#34;</span><span class=p>,</span> <span class=n>curA</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>connA</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Readers don&rsquo;t block writers</strong> 예시. TxA 는 <strong>스냅샷 일관성</strong> 유지.</li></ul><h5 id=wal-sqlite-python>WAL (SQLite, Python)<a hidden class=anchor aria-hidden=true href=#wal-sqlite-python>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># WAL 모드에서 커밋 = 로그에 선기록 → 장애 시 로그 재생으로 지속성 보강</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sqlite3</span><span class=o>,</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>db</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;demo.db&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;PRAGMA journal_mode=WAL&#34;</span><span class=p>)</span>        <span class=c1># WAL 활성화</span>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;PRAGMA synchronous=FULL&#34;</span><span class=p>)</span>        <span class=c1># fsync 보장(지속성↑)</span>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;BEGIN&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;CREATE TABLE IF NOT EXISTS t(k INTEGER PRIMARY KEY, v TEXT)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;INSERT INTO t(v) VALUES (&#39;wal-durable&#39;)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>                                  <span class=c1># 먼저 WAL에 기록 후 안정화</span>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>WAL 의 <strong>선기록 - 후반영</strong>을 앱 수준에서 체감 가능한 형태로 시연.</li></ul><h5 id=2pc-postgresql-순수-sql-스크립트>2PC (PostgreSQL, 순수 SQL 스크립트)<a hidden class=anchor aria-hidden=true href=#2pc-postgresql-순수-sql-스크립트>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6>6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7>7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 참여자 DB에서
</span></span></span><span class=line><span class=cl><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>UPDATE</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>PREPARE</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=s1>&#39;tx-100&#39;</span><span class=p>;</span><span class=w>  </span><span class=c1>-- prepare(잠정 커밋)
</span></span></span><span class=line><span class=cl><span class=c1>-- 코디네이터가 모든 참여자 성공 확인 후
</span></span></span><span class=line><span class=cl><span class=k>COMMIT</span><span class=w> </span><span class=n>PREPARED</span><span class=w> </span><span class=s1>&#39;tx-100&#39;</span><span class=p>;</span><span class=w>      </span><span class=c1>-- 최종 커밋
</span></span></span><span class=line><span class=cl><span class=c1>-- 실패 시
</span></span></span><span class=line><span class=cl><span class=c1>-- ROLLBACK PREPARED &#39;tx-100&#39;;
</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>Prepare → (All OK?) → Commit Prepared</strong>. 코디네이터 장애 시 준비된 트랜잭션 정리 필요.</li></ul><h5 id=섀도-페이징-개념-데모-python-파일-스왑>섀도 페이징 (개념 데모, Python: 파일 스왑)<a hidden class=anchor aria-hidden=true href=#섀도-페이징-개념-데모-python-파일-스왑>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>shutil</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DATA</span> <span class=o>=</span> <span class=s2>&#34;data.json&#34;</span>
</span></span><span class=line><span class=cl><span class=n>SHADOW</span> <span class=o>=</span> <span class=s2>&#34;data.shadow.json&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>read_state</span><span class=p>(</span><span class=n>path</span><span class=o>=</span><span class=n>DATA</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;counter&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>shadow_commit</span><span class=p>(</span><span class=n>mutator</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 1) 원본 읽기</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>read_state</span><span class=p>(</span><span class=n>DATA</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 2) 섀도 사본에서 변경</span>
</span></span><span class=line><span class=cl>    <span class=n>new_state</span> <span class=o>=</span> <span class=n>mutator</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>new_state</span><span class=p>,</span> <span class=nb>open</span><span class=p>(</span><span class=n>SHADOW</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># 3) 커밋: 포인터(파일) 스위치 = 원자적 rename</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>SHADOW</span><span class=p>,</span> <span class=n>DATA</span><span class=p>)</span>  <span class=c1># 대부분의 OS에서 rename은 원자적</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실패 시 원본(DATA) 그대로 → 롤백 효과</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>shadow_commit</span><span class=p>(</span><span class=k>lambda</span> <span class=n>s</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;counter&#34;</span><span class=p>:</span> <span class=n>s</span><span class=p>[</span><span class=s2>&#34;counter&#34;</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>read_state</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>사본에서 수정→원자적 스위치</strong>: 실패 시 원본 유지 (원자성 확보), 성공 시 새 버전 활성화.</li></ul><h5 id=그룹-커밋-go-배치-커밋-큐>그룹 커밋 (Go, 배치 커밋 큐)<a hidden class=anchor aria-hidden=true href=#그룹-커밋-go-배치-커밋-큐>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41>41</a>
</span><span class=lnt id=hl-8-42><a class=lnlinks href=#hl-8-42>42</a>
</span><span class=lnt id=hl-8-43><a class=lnlinks href=#hl-8-43>43</a>
</span><span class=lnt id=hl-8-44><a class=lnlinks href=#hl-8-44>44</a>
</span><span class=lnt id=hl-8-45><a class=lnlinks href=#hl-8-45>45</a>
</span><span class=lnt id=hl-8-46><a class=lnlinks href=#hl-8-46>46</a>
</span><span class=lnt id=hl-8-47><a class=lnlinks href=#hl-8-47>47</a>
</span><span class=lnt id=hl-8-48><a class=lnlinks href=#hl-8-48>48</a>
</span><span class=lnt id=hl-8-49><a class=lnlinks href=#hl-8-49>49</a>
</span><span class=lnt id=hl-8-50><a class=lnlinks href=#hl-8-50>50</a>
</span><span class=lnt id=hl-8-51><a class=lnlinks href=#hl-8-51>51</a>
</span><span class=lnt id=hl-8-52><a class=lnlinks href=#hl-8-52>52</a>
</span><span class=lnt id=hl-8-53><a class=lnlinks href=#hl-8-53>53</a>
</span><span class=lnt id=hl-8-54><a class=lnlinks href=#hl-8-54>54</a>
</span><span class=lnt id=hl-8-55><a class=lnlinks href=#hl-8-55>55</a>
</span><span class=lnt id=hl-8-56><a class=lnlinks href=#hl-8-56>56</a>
</span><span class=lnt id=hl-8-57><a class=lnlinks href=#hl-8-57>57</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// go run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 의도: 짧은 간격으로 들어오는 커밋들을 모아 한 번의 fsync(=Commit)로 처리 → 처리량↑, 지연은 약간↑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;context&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;fmt&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>commitReq</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>done</span><span class=w> </span><span class=kd>chan</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>commitCh</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>chan</span><span class=w> </span><span class=nx>commitReq</span><span class=p>,</span><span class=w> </span><span class=mi>1024</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 그룹 커밋 루프: 5ms마다 들어온 요청을 모아 한 번에 커밋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>go</span><span class=w> </span><span class=kd>func</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>ticker</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nf>NewTicker</span><span class=p>(</span><span class=mi>5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>defer</span><span class=w> </span><span class=nx>ticker</span><span class=p>.</span><span class=nf>Stop</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=kd>var</span><span class=w> </span><span class=nx>batch</span><span class=w> </span><span class=p>[]</span><span class=nx>commitReq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>doCommit</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>func</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=c1>// 실제 DB 커밋/로그 fsync 호출이 들어갈 자리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>200</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Microsecond</span><span class=p>)</span><span class=w> </span><span class=c1>// fsync 비용 흉내</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>batch</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=nb>close</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>done</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>batch</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>batch</span><span class=p>[:</span><span class=mi>0</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>for</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>select</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>case</span><span class=w> </span><span class=nx>r</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&lt;-</span><span class=nx>commitCh</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=nx>batch</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>batch</span><span class=p>,</span><span class=w> </span><span class=nx>r</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>case</span><span class=w> </span><span class=o>&lt;-</span><span class=nx>ticker</span><span class=p>.</span><span class=nx>C</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>batch</span><span class=p>)</span><span class=w> </span><span class=p>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>					</span><span class=nf>doCommit</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 클라이언트: 커밋 요청</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>cancel</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nf>WithTimeout</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>defer</span><span class=w> </span><span class=nf>cancel</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>req</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>commitReq</span><span class=p>{</span><span class=nx>done</span><span class=p>:</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>chan</span><span class=w> </span><span class=kd>struct</span><span class=p>{})}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>select</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>case</span><span class=w> </span><span class=nx>commitCh</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nx>req</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;commit queue full&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>select</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>case</span><span class=w> </span><span class=o>&lt;-</span><span class=nx>req</span><span class=p>.</span><span class=nx>done</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;group-committed&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>case</span><span class=w> </span><span class=o>&lt;-</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Done</span><span class=p>():</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;commit timeout&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>다수 커밋을 <strong>주기/개수 기준으로 배치</strong>해 한 번의 플러시로 처리.</li></ul><h4 id=분류-기준에-따른-유형-구분>분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분>#</a></h4><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>대표 시스템/기술</th><th>적용 시나리오</th></tr></thead><tbody><tr><td><strong>격리 수준</strong></td><td>Read Uncommitted (RU)</td><td>커밋 전 데이터 읽기 가능, Dirty Read 발생</td><td>일부 NoSQL, 구형 DB 옵션</td><td>성능 우선, 데이터 정확성 낮은 로그 분석</td></tr><tr><td></td><td>Read Committed (RC)</td><td>커밋된 데이터만 읽기, Non-repeatable Read 가능</td><td>PostgreSQL, Oracle 기본</td><td>대부분의 온라인 트랜잭션 처리 (OLTP)</td></tr><tr><td></td><td>Repeatable Read (RR)</td><td>동일 트랜잭션 내 동일 쿼리 결과 보장, Phantom 가능</td><td>MySQL(InnoDB 기본)</td><td>금융·재고 관리 등 정합성 높은 업무</td></tr><tr><td></td><td>Serializable (S)</td><td>완전한 직렬 실행 보장, 성능 저하</td><td>일부 OLTP, 테스트 환경</td><td>강한 일관성 필수 업무</td></tr><tr><td><strong>동시성 제어</strong></td><td>Pessimistic Lock</td><td>잠금 기반, 충돌 방지, 지연 발생 가능</td><td>SQL Server, DB2</td><td>충돌 가능성 높은 환경</td></tr><tr><td></td><td>Optimistic CC</td><td>버전 기반, 충돌 시 롤백, 지연 최소화</td><td>PostgreSQL, Oracle</td><td>충돌 가능성 낮고 읽기 비중 높은 환경</td></tr><tr><td></td><td>2PL</td><td>락 점유 후 해제, 데드락 가능</td><td>일부 상용 RDBMS</td><td>강한 정합성 보장 환경</td></tr><tr><td></td><td>MVCC</td><td>스냅샷 읽기, 높은 읽기 성능, 버전 관리 필요</td><td>PostgreSQL, InnoDB</td><td>읽기·쓰기 혼합 환경</td></tr><tr><td><strong>구조/환경</strong></td><td>단일 DB 트랜잭션</td><td>단일 인스턴스 내 트랜잭션</td><td>MySQL, PostgreSQL</td><td>단일 리전·작은 규모</td></tr><tr><td></td><td>분산 트랜잭션</td><td>여러 노드/DB 跨 ACID 보장</td><td>Spanner, CockroachDB</td><td>글로벌 일관성 필요 환경</td></tr><tr><td><strong>일관성 모델</strong></td><td>강한 일관성</td><td>즉시 일관성, 높은 비용</td><td>전통적 RDBMS</td><td>금융, 주문 처리</td></tr><tr><td></td><td>최종 일관성</td><td>지연된 일관성, 높은 가용성</td><td>DynamoDB, Cassandra</td><td>SNS 피드, 콘텐츠 배포</td></tr><tr><td><strong>복구 기법</strong></td><td>WAL</td><td>로그 선기록, 커밋 안전성 보장</td><td>PostgreSQL, MySQL(InnoDB)</td><td>대부분 RDBMS</td></tr><tr><td></td><td>ARIES</td><td>WAL 기반, 분석→REDO→UNDO 단계 복구</td><td>IBM DB2, SQL Server</td><td>대규모 트랜잭션 복구</td></tr></tbody></table><p>이 분류표는 <strong>ACID 속성 구현 시 선택할 수 있는 격리 수준, 동시성 제어 기법, 구조, 일관성 모델, 복구 기법</strong>을 비교해 각 환경과 요구사항에 맞는 설계를 도출하는 데 도움을 준다.<br>단일 DB 환경에서는 강한 일관성과 높은 격리 수준을 적용하기 쉽지만, 분산 DB 환경에서는 성능과 가용성을 위해 격리 수준 완화, 최종 일관성, 낙관적 동시성 제어를 선택하는 경우가 많다.<br>복구 기법은 WAL 이 기본이며, 대규모·고성능 복구에는 ARIES 가 활용된다.</p><h3 id=실무-적용-practical-application>실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#실무-적용-practical-application>#</a></h3><h4 id=실제-도입-사례>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례>#</a></h4><table><thead><tr><th>도메인</th><th>핵심 트랜잭션/불변식</th><th>대표 조합 기술</th><th>기대 효과 (지표)</th><th>설계 포인트</th></tr></thead><tbody><tr><td><strong>금융 결제/이체</strong></td><td>차감=가산, 이중기입 원장 보존</td><td>2PL 또는 SSI, Sync WAL, 동기 복제, 필요 시 좁은 2PC</td><td>무결성 100%, 이중지급 0, 감사 용이</td><td>트랜잭션 짧게, 데드락 탐지, 멱등성 키</td></tr><tr><td><strong>전자상거래 (주문·재고·결제)</strong></td><td>주문=결제=재고 차감 일관</td><td>단일 DB: ACID 원트랜잭션 / MSA: SAGA+Outbox+ 멱등</td><td>과판매↓, 실패 시 자동 보상</td><td>재고는 수량형 조건 (≥0), 보상 트랜잭션 명세</td></tr><tr><td><strong>의료 (EMR/처방)</strong></td><td>환자기록/처방 원자 갱신</td><td>고격리 (Serializable/RR+ 검증), 감사 로그, 백업/복제</td><td>안전성↑, 규제 준수</td><td>변경 이력 불변 저장, 접근 통제</td></tr><tr><td><strong>핀테크 원장/포인트</strong></td><td>원장 불변식, 중복 차감 방지</td><td>SSI/Serializable, 멱등 API, 리플레이 프로텍션</td><td>정합성↑, 분쟁 처리 용이</td><td>고가용 복제, 정밀 감사</td></tr><tr><td><strong>게임/인앱 구매</strong></td><td>결제 승인↔아이템 지급 일관</td><td>ACID(내부) + 외부영수증 검증, SAGA(환불/회수)</td><td>유실/중복 지급 0</td><td>지급 전 검증, 보상 루틴 확정</td></tr><tr><td><strong>물류/재고 동기화</strong></td><td>창고 간 예약/차감 일관</td><td>낙관적 락킹 + 조건부 업데이트, 또는 락 기반</td><td>과예약 방지, 재고정확도</td><td>재시도/충돌 해결 정책</td></tr><tr><td><strong>분산 DB(글로벌)</strong></td><td>지리 분산 ACID</td><td>분산 시계/합의, 2PC, 동기 복제</td><td>강 일관성</td><td>지연↑ 수용, 파티션 전략</td></tr><tr><td><strong>데이터 레이크하우스</strong></td><td>스트리밍 + 배치 ACID</td><td>Delta/Iceberg(스냅샷), 트랜잭션 로그</td><td>스냅샷 일관, 롤백</td><td>스키마 진화/머지 정책</td></tr><tr><td><strong>IoT 과금/집계</strong></td><td>컷오버 원자 스냅샷</td><td>Exactly-once+ 트랜잭션 메타, 스냅샷 격리</td><td>이중 과금 0</td><td>시간창/윈도 보정, 재처리 안전</td></tr></tbody></table><ul><li><strong>강 ACID vs 확장성</strong>: 돈/의료처럼 <strong>불변식 위반 비용이 큰 도메인</strong>은 지연·처리량을 희생하더라도 강 ACID 가 정답.</li><li><strong>마이크로서비스</strong>: 경계 넘는 작업은 2PC 비용·복잡도가 커지므로 <strong>SAGA/Outbox/멱등</strong>으로 설계하는 편이 운영 난이도·성능 균형이 좋다.</li><li><strong>격리 선택</strong>: 읽기 비중이 높고 리포팅이 많다면 <strong>MVCC + RC/RR</strong>가 효율적. 재고/원장처럼 쓰기 충돌이 핵심이면 <strong>락 기반 + 짧은 트랜잭션</strong>이 유리.</li><li><strong>복구/감사</strong>: 금융·의료·원장은 ** 감사 로그 (불변 이벤트 스트림)** 가 실무 필수. WAL 만으로는 규제 증적에 부족할 수 있어 <strong>CDC/감사 테이블</strong>을 병행한다.</li><li><strong>운영 지표</strong>: p95 커밋 지연, 데드락율, 재시도율, 보상 트랜잭션 비율, 멱등키 충돌률, LSN 라그 등을 상시 모니터링하면 품질이 빠르게 안정된다.</li></ul><h4 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h4><h5 id=사례-전자-상거래-플랫폼-장바구니--주문-확정>사례: 전자 상거래 플랫폼 (장바구니 → 주문 확정)<a hidden class=anchor aria-hidden=true href=#사례-전자-상거래-플랫폼-장바구니--주문-확정>#</a></h5><p><strong>시나리오</strong>: 장바구니 → 주문 확정 (재고 차감 포함) 을 단일 DB 에서 ACID 로 처리</p><p><strong>시스템 구성</strong>:</p><ul><li>API 서버, PostgreSQL, WAL 동기화 스토리지</li></ul><pre class=mermaid>graph TB
  Client --&gt; API[Order API]
  API --&gt; PG[(PostgreSQL)]
  PG --&gt; LOG[WAL/Commit Log]
</pre><p><strong>Workflow</strong>:</p><ol><li>BEGIN</li><li>재고 확인 및 잠금</li><li>주문 레코드 작성</li><li>결제 승인 코드 기록</li><li>커밋 (로그 플러시)</li></ol><p><strong>핵심 역할</strong>: ACID 로 일관성·원자성·지속성 보장, 격리수준은 <code>READ COMMITTED</code> 또는 <code>REPEATABLE READ</code>.</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 동시성 시 재고 음수/이중 주문 위험</li><li>도입 후: 일관성 보장, 실패 시 전부 롤백</li></ul><p><strong>구현 예시 (Python + psycopg2)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22>22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23>23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24>24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25>25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26>26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27>27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28>28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29>29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30>30</a>
</span><span class=lnt id=hl-10-31><a class=lnlinks href=#hl-10-31>31</a>
</span><span class=lnt id=hl-10-32><a class=lnlinks href=#hl-10-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ACID와 Isolation이 반영된 주문 트랜잭션 예시</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>closing</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>place_order</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>sku</span><span class=p>,</span> <span class=n>qty</span><span class=p>,</span> <span class=n>payment_token</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cur</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 1) 재고 행을 잠금하여 Lost Update/Phantom 방지 (Isolation 관련)</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT stock FROM inventory WHERE sku = </span><span class=si>%s</span><span class=s2> FOR UPDATE&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>sku</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>            <span class=n>row</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>row</span> <span class=ow>or</span> <span class=n>row</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>qty</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;재고 부족&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 2) 주문 생성 (Atomicity: 예외 시 전체 롤백)</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                INSERT INTO orders(user_id, status) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>) RETURNING id
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=s2>&#34;PENDING&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 3) 주문항목/재고차감</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                INSERT INTO order_items(order_id, sku, qty) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>)
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>sku</span><span class=p>,</span> <span class=n>qty</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE inventory SET stock = stock - </span><span class=si>%s</span><span class=s2> WHERE sku = </span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>qty</span><span class=p>,</span> <span class=n>sku</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 4) 결제 승인 기록 (Consistency: 도메인 규칙 반영)</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                INSERT INTO payments(order_id, token, status) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>)
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>payment_token</span><span class=p>,</span> <span class=s2>&#34;AUTHORIZED&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># with conn: 블록 종료 시 커밋 -&gt; WAL에 Commit 레코드 플러시(Durability)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>order_id</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>구현 예시 (Node.js + pg)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 격리수준 설정과 트랜잭션 경계
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>Pool</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;pg&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>pool</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Pool</span><span class=p>({</span> <span class=cm>/* conn info */</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>withTx</span><span class=p>(</span><span class=nx>fn</span><span class=p>,</span> <span class=nx>isolation</span> <span class=o>=</span> <span class=s1>&#39;READ COMMITTED&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>pool</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;BEGIN&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`SET TRANSACTION ISOLATION LEVEL </span><span class=si>${</span><span class=nx>isolation</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fn</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;COMMIT&#39;</span><span class=p>);</span> <span class=c1>// WAL 플러시 -&gt; Durability
</span></span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;ROLLBACK&#39;</span><span class=p>);</span> <span class=c1>// Atomicity 보장
</span></span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>e</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>client</span><span class=p>.</span><span class=nx>release</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-온라인-도서-구매-시스템>사례: 온라인 도서 구매 시스템<a hidden class=anchor aria-hidden=true href=#사례-온라인-도서-구매-시스템>#</a></h5><p><strong>시나리오</strong>: 온라인 도서 구매 시스템에서 책 주문 처리</p><p><strong>시스템 구성</strong>:</p><ul><li>고객 관리 서비스</li><li>재고 관리 서비스</li><li>결제 처리 서비스</li><li>주문 관리 서비스</li></ul><pre class=mermaid>graph TB
    A[고객] --&gt; B[주문 서비스]
    B --&gt; C[재고 확인]
    B --&gt; D[결제 처리]
    B --&gt; E[주문 생성]
    C --&gt; F[재고 DB]
    D --&gt; G[결제 DB]
    E --&gt; H[주문 DB]
    
    subgraph &#34;ACID 트랜잭션 경계&#34;
        C
        D  
        E
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>고객이 책 주문 요청</li><li>재고 확인 및 예약</li><li>결제 정보 검증 및 차감</li><li>주문 정보 생성 및 저장</li><li>모든 단계 성공 시 COMMIT, 실패 시 ROLLBACK</li></ol><p><strong>핵심 역할</strong>:</p><ul><li><strong>Atomicity</strong>: 재고 차감, 결제, 주문 생성이 모두 성공하거나 모두 실패</li><li><strong>Consistency</strong>: 재고 수량이 음수가 되지 않고, 결제 금액이 정확함</li><li><strong>Isolation</strong>: 동시 주문 시 재고 중복 할당 방지</li><li><strong>Durability</strong>: 주문 완료 후 시스템 장애에도 주문 정보 보존</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 부분 실패로 인한 재고 불일치, 중복 결제, 데이터 손실</li><li><strong>도입 후</strong>: 완전한 주문 처리 보장, 데이터 일관성 유지, 고객 신뢰도 향상</li></ul><p><strong>구현 예시</strong> (Python/PostgreSQL):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>  1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>  2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>  3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>  4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>  5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6>  6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7>  7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8>  8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9>  9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10> 10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11> 11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12> 12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13> 13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14> 14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15> 15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16> 16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17> 17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18> 18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19> 19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20> 20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21> 21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22> 22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23> 23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24> 24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25> 25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26> 26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27> 27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28> 28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29> 29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30> 30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31> 31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32> 32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33> 33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34> 34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35> 35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36> 36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37> 37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38> 38</a>
</span><span class=lnt id=hl-13-39><a class=lnlinks href=#hl-13-39> 39</a>
</span><span class=lnt id=hl-13-40><a class=lnlinks href=#hl-13-40> 40</a>
</span><span class=lnt id=hl-13-41><a class=lnlinks href=#hl-13-41> 41</a>
</span><span class=lnt id=hl-13-42><a class=lnlinks href=#hl-13-42> 42</a>
</span><span class=lnt id=hl-13-43><a class=lnlinks href=#hl-13-43> 43</a>
</span><span class=lnt id=hl-13-44><a class=lnlinks href=#hl-13-44> 44</a>
</span><span class=lnt id=hl-13-45><a class=lnlinks href=#hl-13-45> 45</a>
</span><span class=lnt id=hl-13-46><a class=lnlinks href=#hl-13-46> 46</a>
</span><span class=lnt id=hl-13-47><a class=lnlinks href=#hl-13-47> 47</a>
</span><span class=lnt id=hl-13-48><a class=lnlinks href=#hl-13-48> 48</a>
</span><span class=lnt id=hl-13-49><a class=lnlinks href=#hl-13-49> 49</a>
</span><span class=lnt id=hl-13-50><a class=lnlinks href=#hl-13-50> 50</a>
</span><span class=lnt id=hl-13-51><a class=lnlinks href=#hl-13-51> 51</a>
</span><span class=lnt id=hl-13-52><a class=lnlinks href=#hl-13-52> 52</a>
</span><span class=lnt id=hl-13-53><a class=lnlinks href=#hl-13-53> 53</a>
</span><span class=lnt id=hl-13-54><a class=lnlinks href=#hl-13-54> 54</a>
</span><span class=lnt id=hl-13-55><a class=lnlinks href=#hl-13-55> 55</a>
</span><span class=lnt id=hl-13-56><a class=lnlinks href=#hl-13-56> 56</a>
</span><span class=lnt id=hl-13-57><a class=lnlinks href=#hl-13-57> 57</a>
</span><span class=lnt id=hl-13-58><a class=lnlinks href=#hl-13-58> 58</a>
</span><span class=lnt id=hl-13-59><a class=lnlinks href=#hl-13-59> 59</a>
</span><span class=lnt id=hl-13-60><a class=lnlinks href=#hl-13-60> 60</a>
</span><span class=lnt id=hl-13-61><a class=lnlinks href=#hl-13-61> 61</a>
</span><span class=lnt id=hl-13-62><a class=lnlinks href=#hl-13-62> 62</a>
</span><span class=lnt id=hl-13-63><a class=lnlinks href=#hl-13-63> 63</a>
</span><span class=lnt id=hl-13-64><a class=lnlinks href=#hl-13-64> 64</a>
</span><span class=lnt id=hl-13-65><a class=lnlinks href=#hl-13-65> 65</a>
</span><span class=lnt id=hl-13-66><a class=lnlinks href=#hl-13-66> 66</a>
</span><span class=lnt id=hl-13-67><a class=lnlinks href=#hl-13-67> 67</a>
</span><span class=lnt id=hl-13-68><a class=lnlinks href=#hl-13-68> 68</a>
</span><span class=lnt id=hl-13-69><a class=lnlinks href=#hl-13-69> 69</a>
</span><span class=lnt id=hl-13-70><a class=lnlinks href=#hl-13-70> 70</a>
</span><span class=lnt id=hl-13-71><a class=lnlinks href=#hl-13-71> 71</a>
</span><span class=lnt id=hl-13-72><a class=lnlinks href=#hl-13-72> 72</a>
</span><span class=lnt id=hl-13-73><a class=lnlinks href=#hl-13-73> 73</a>
</span><span class=lnt id=hl-13-74><a class=lnlinks href=#hl-13-74> 74</a>
</span><span class=lnt id=hl-13-75><a class=lnlinks href=#hl-13-75> 75</a>
</span><span class=lnt id=hl-13-76><a class=lnlinks href=#hl-13-76> 76</a>
</span><span class=lnt id=hl-13-77><a class=lnlinks href=#hl-13-77> 77</a>
</span><span class=lnt id=hl-13-78><a class=lnlinks href=#hl-13-78> 78</a>
</span><span class=lnt id=hl-13-79><a class=lnlinks href=#hl-13-79> 79</a>
</span><span class=lnt id=hl-13-80><a class=lnlinks href=#hl-13-80> 80</a>
</span><span class=lnt id=hl-13-81><a class=lnlinks href=#hl-13-81> 81</a>
</span><span class=lnt id=hl-13-82><a class=lnlinks href=#hl-13-82> 82</a>
</span><span class=lnt id=hl-13-83><a class=lnlinks href=#hl-13-83> 83</a>
</span><span class=lnt id=hl-13-84><a class=lnlinks href=#hl-13-84> 84</a>
</span><span class=lnt id=hl-13-85><a class=lnlinks href=#hl-13-85> 85</a>
</span><span class=lnt id=hl-13-86><a class=lnlinks href=#hl-13-86> 86</a>
</span><span class=lnt id=hl-13-87><a class=lnlinks href=#hl-13-87> 87</a>
</span><span class=lnt id=hl-13-88><a class=lnlinks href=#hl-13-88> 88</a>
</span><span class=lnt id=hl-13-89><a class=lnlinks href=#hl-13-89> 89</a>
</span><span class=lnt id=hl-13-90><a class=lnlinks href=#hl-13-90> 90</a>
</span><span class=lnt id=hl-13-91><a class=lnlinks href=#hl-13-91> 91</a>
</span><span class=lnt id=hl-13-92><a class=lnlinks href=#hl-13-92> 92</a>
</span><span class=lnt id=hl-13-93><a class=lnlinks href=#hl-13-93> 93</a>
</span><span class=lnt id=hl-13-94><a class=lnlinks href=#hl-13-94> 94</a>
</span><span class=lnt id=hl-13-95><a class=lnlinks href=#hl-13-95> 95</a>
</span><span class=lnt id=hl-13-96><a class=lnlinks href=#hl-13-96> 96</a>
</span><span class=lnt id=hl-13-97><a class=lnlinks href=#hl-13-97> 97</a>
</span><span class=lnt id=hl-13-98><a class=lnlinks href=#hl-13-98> 98</a>
</span><span class=lnt id=hl-13-99><a class=lnlinks href=#hl-13-99> 99</a>
</span><span class=lnt id=hl-13-100><a class=lnlinks href=#hl-13-100>100</a>
</span><span class=lnt id=hl-13-101><a class=lnlinks href=#hl-13-101>101</a>
</span><span class=lnt id=hl-13-102><a class=lnlinks href=#hl-13-102>102</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>psycopg2</span> <span class=kn>import</span> <span class=n>sql</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BookOrderService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>db_connection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>conn</span> <span class=o>=</span> <span class=n>db_connection</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>customer_id</span><span class=p>,</span> <span class=n>book_id</span><span class=p>,</span> <span class=n>quantity</span><span class=p>,</span> <span class=n>payment_amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ACID 트랜잭션으로 도서 주문 처리
</span></span></span><span class=line><span class=cl><span class=s2>        - Atomicity: 모든 단계가 성공하거나 모두 롤백
</span></span></span><span class=line><span class=cl><span class=s2>        - Consistency: 비즈니스 규칙 준수 (재고 &gt; 0, 결제 금액 정확)
</span></span></span><span class=line><span class=cl><span class=s2>        - Isolation: 동시 주문 간 간섭 방지
</span></span></span><span class=line><span class=cl><span class=s2>        - Durability: 커밋된 주문 정보 영구 저장
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cursor</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 트랜잭션 시작 - BEGIN 자동 실행</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;BEGIN;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 1. 재고 확인 및 락 (Isolation 보장)</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;SELECT stock_quantity, price FROM books WHERE book_id = </span><span class=si>%s</span><span class=s2> FOR UPDATE;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>book_id</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>book_info</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>book_info</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Book not found&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=n>stock_quantity</span><span class=p>,</span> <span class=n>book_price</span> <span class=o>=</span> <span class=n>book_info</span>
</span></span><span class=line><span class=cl>            <span class=n>total_price</span> <span class=o>=</span> <span class=n>book_price</span> <span class=o>*</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 2. 비즈니스 규칙 검증 (Consistency 보장)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>stock_quantity</span> <span class=o>&lt;</span> <span class=n>quantity</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Insufficient stock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>payment_amount</span> <span class=o>!=</span> <span class=n>total_price</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Payment amount mismatch&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 3. 재고 차감 (Atomicity의 일부)</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;UPDATE books SET stock_quantity = stock_quantity - </span><span class=si>%s</span><span class=s2> WHERE book_id = </span><span class=si>%s</span><span class=s2>;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>quantity</span><span class=p>,</span> <span class=n>book_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 4. 결제 처리 (Atomicity의 일부)</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;INSERT INTO payments (customer_id, amount, payment_date) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, NOW());&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>customer_id</span><span class=p>,</span> <span class=n>payment_amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>payment_id</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>lastrowid</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 5. 주문 생성 (Atomicity의 일부)</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;INSERT INTO orders (customer_id, book_id, quantity, total_price, payment_id, order_date) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, NOW());&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>customer_id</span><span class=p>,</span> <span class=n>book_id</span><span class=p>,</span> <span class=n>quantity</span><span class=p>,</span> <span class=n>total_price</span><span class=p>,</span> <span class=n>payment_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>lastrowid</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 모든 작업 성공 시 커밋 (Durability 보장)</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;COMMIT;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Order </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2> processed successfully&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 오류 발생 시 롤백 (Atomicity 보장)</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;ROLLBACK;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Order processing failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;failed&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 데이터베이스 연결</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>database</span><span class=o>=</span><span class=s2>&#34;bookstore&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>user</span><span class=o>=</span><span class=s2>&#34;postgres&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>password</span><span class=o>=</span><span class=s2>&#34;password&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>order_service</span> <span class=o>=</span> <span class=n>BookOrderService</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ACID 트랜잭션으로 주문 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>order_service</span><span class=o>.</span><span class=n>process_order</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>customer_id</span><span class=o>=</span><span class=mi>123</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>book_id</span><span class=o>=</span><span class=mi>456</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>quantity</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>payment_amount</span><span class=o>=</span><span class=mf>59.98</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Order result: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-은행-계좌-이체>사례: 은행 계좌 이체<a hidden class=anchor aria-hidden=true href=#사례-은행-계좌-이체>#</a></h5><p><strong>시나리오</strong>: 은행 계좌 이체 (보낸 사람/받는 사람 동시 처리)<br><strong>시스템 구성</strong>:</p><ul><li>Application Server(트랜잭션 로직)</li><li>RDBMS(트랜잭션 지원 DB: PostgreSQL)</li></ul><pre class=mermaid>graph TB
    Client --&gt; AppServer
    AppServer --&gt; DB[PostgreSQL DB with ACID]
</pre><p><strong>Workflow</strong>:</p><ol><li>트랜잭션 시작 (BEGIN)</li><li>출금 계좌 차감</li><li>입금 계좌 증액</li><li>정상 처리 시 COMMIT, 오류 발생 시 ROLLBACK</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>트랜잭션의 원자성과 일관성을 보장</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 네트워크 끊김 등 장애 발생 시 일부 데이터만 반영 → 데이터 불일치</li><li>도입 후: 부분 처리 방지, 모든 작업이 완전히 반영/완전 복구</li></ul><p><strong>구현 예시</strong> (Python/SQLAlchemy)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>sessionmaker</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># DB 연결 및 세션 생성</span>
</span></span><span class=line><span class=cl><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span><span class=s1>&#39;postgresql://user:pw@localhost/bankdb&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Session</span> <span class=o>=</span> <span class=n>sessionmaker</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>transfer_money</span><span class=p>(</span><span class=n>sender_id</span><span class=p>,</span> <span class=n>receiver_id</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;은행 이체에서 ACID 트랜잭션 (원자성, 일관성, 격리성, 지속성) 보장 예시&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span> <span class=o>=</span> <span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 출금</span>
</span></span><span class=line><span class=cl>        <span class=n>sender</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>Account</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>sender_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>receiver</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>Account</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>receiver_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>sender</span><span class=o>.</span><span class=n>balance</span> <span class=o>&lt;</span> <span class=n>amount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;잔액 부족&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sender</span><span class=o>.</span><span class=n>balance</span> <span class=o>-=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>        <span class=n>receiver</span><span class=o>.</span><span class=n>balance</span> <span class=o>+=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>  <span class=c1># 모든 로직이 성공하면 커밋(Durability 보장)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>  <span class=c1># 에러 발생 시 전체 원자적 롤백</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;이체 실패:&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-전자상거래에서-주문-처리-시스템>사례: 전자상거래에서 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-전자상거래에서-주문-처리-시스템>#</a></h5><p><strong>시나리오</strong>: 아마존 스타일 전자상거래에서 주문 처리 시스템</p><p><strong>시스템 구성</strong>:</p><ul><li>분산 마이크로서비스 아키텍처</li><li>PostgreSQL (주문/재고), Redis (세션), 메시지 큐</li></ul><pre class=mermaid>graph TB
    A[사용자] --&gt; B[API Gateway]
    B --&gt; C[주문 서비스]
    C --&gt; D[재고 서비스]
    C --&gt; E[결제 서비스]  
    C --&gt; F[배송 서비스]
    
    D --&gt; G[(재고 DB)]
    E --&gt; H[(결제 DB)]
    F --&gt; I[(배송 DB)]
    C --&gt; J[(주문 DB)]
    
    C --&gt; K[메시지 큐]
    K --&gt; L[알림 서비스]
    K --&gt; M[분석 서비스]
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자 주문 요청 접수</li><li>분산 트랜잭션으로 재고 예약</li><li>결제 처리 및 승인</li><li>주문 확정 및 배송 준비</li><li>비동기로 알림 및 분석 데이터 전송</li></ol><p><strong>핵심 역할</strong>:</p><ul><li><strong>분산 ACID</strong>: 마이크로서비스 간 일관성 보장</li><li><strong>Saga 패턴</strong>: 긴 트랜잭션의 분할 및 보상 처리</li><li><strong>최종 일관성</strong>: 실시간이 아닌 데이터의 지연된 동기화</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 서비스 간 데이터 불일치, 부분 실패로 인한 비즈니스 손실</li><li><strong>도입 후</strong>: 마이크로서비스 환경에서도 데이터 일관성 보장, 사용자 경험 향상</li></ul><p><strong>구현 예시</strong> (Python/분산 환경):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>  1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>  2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>  3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>  4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>  5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6>  6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7>  7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8>  8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9>  9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10> 10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11> 11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12> 12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13> 13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14> 14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15> 15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16> 16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17> 17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18> 18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19> 19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20> 20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21> 21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22> 22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23> 23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24> 24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25> 25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26> 26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27> 27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28> 28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29> 29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30> 30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31> 31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32> 32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33> 33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34> 34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35> 35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36> 36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37> 37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38> 38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39> 39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40> 40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41> 41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42> 42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43> 43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44> 44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45> 45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46> 46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47> 47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48> 48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49> 49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50> 50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51> 51</a>
</span><span class=lnt id=hl-17-52><a class=lnlinks href=#hl-17-52> 52</a>
</span><span class=lnt id=hl-17-53><a class=lnlinks href=#hl-17-53> 53</a>
</span><span class=lnt id=hl-17-54><a class=lnlinks href=#hl-17-54> 54</a>
</span><span class=lnt id=hl-17-55><a class=lnlinks href=#hl-17-55> 55</a>
</span><span class=lnt id=hl-17-56><a class=lnlinks href=#hl-17-56> 56</a>
</span><span class=lnt id=hl-17-57><a class=lnlinks href=#hl-17-57> 57</a>
</span><span class=lnt id=hl-17-58><a class=lnlinks href=#hl-17-58> 58</a>
</span><span class=lnt id=hl-17-59><a class=lnlinks href=#hl-17-59> 59</a>
</span><span class=lnt id=hl-17-60><a class=lnlinks href=#hl-17-60> 60</a>
</span><span class=lnt id=hl-17-61><a class=lnlinks href=#hl-17-61> 61</a>
</span><span class=lnt id=hl-17-62><a class=lnlinks href=#hl-17-62> 62</a>
</span><span class=lnt id=hl-17-63><a class=lnlinks href=#hl-17-63> 63</a>
</span><span class=lnt id=hl-17-64><a class=lnlinks href=#hl-17-64> 64</a>
</span><span class=lnt id=hl-17-65><a class=lnlinks href=#hl-17-65> 65</a>
</span><span class=lnt id=hl-17-66><a class=lnlinks href=#hl-17-66> 66</a>
</span><span class=lnt id=hl-17-67><a class=lnlinks href=#hl-17-67> 67</a>
</span><span class=lnt id=hl-17-68><a class=lnlinks href=#hl-17-68> 68</a>
</span><span class=lnt id=hl-17-69><a class=lnlinks href=#hl-17-69> 69</a>
</span><span class=lnt id=hl-17-70><a class=lnlinks href=#hl-17-70> 70</a>
</span><span class=lnt id=hl-17-71><a class=lnlinks href=#hl-17-71> 71</a>
</span><span class=lnt id=hl-17-72><a class=lnlinks href=#hl-17-72> 72</a>
</span><span class=lnt id=hl-17-73><a class=lnlinks href=#hl-17-73> 73</a>
</span><span class=lnt id=hl-17-74><a class=lnlinks href=#hl-17-74> 74</a>
</span><span class=lnt id=hl-17-75><a class=lnlinks href=#hl-17-75> 75</a>
</span><span class=lnt id=hl-17-76><a class=lnlinks href=#hl-17-76> 76</a>
</span><span class=lnt id=hl-17-77><a class=lnlinks href=#hl-17-77> 77</a>
</span><span class=lnt id=hl-17-78><a class=lnlinks href=#hl-17-78> 78</a>
</span><span class=lnt id=hl-17-79><a class=lnlinks href=#hl-17-79> 79</a>
</span><span class=lnt id=hl-17-80><a class=lnlinks href=#hl-17-80> 80</a>
</span><span class=lnt id=hl-17-81><a class=lnlinks href=#hl-17-81> 81</a>
</span><span class=lnt id=hl-17-82><a class=lnlinks href=#hl-17-82> 82</a>
</span><span class=lnt id=hl-17-83><a class=lnlinks href=#hl-17-83> 83</a>
</span><span class=lnt id=hl-17-84><a class=lnlinks href=#hl-17-84> 84</a>
</span><span class=lnt id=hl-17-85><a class=lnlinks href=#hl-17-85> 85</a>
</span><span class=lnt id=hl-17-86><a class=lnlinks href=#hl-17-86> 86</a>
</span><span class=lnt id=hl-17-87><a class=lnlinks href=#hl-17-87> 87</a>
</span><span class=lnt id=hl-17-88><a class=lnlinks href=#hl-17-88> 88</a>
</span><span class=lnt id=hl-17-89><a class=lnlinks href=#hl-17-89> 89</a>
</span><span class=lnt id=hl-17-90><a class=lnlinks href=#hl-17-90> 90</a>
</span><span class=lnt id=hl-17-91><a class=lnlinks href=#hl-17-91> 91</a>
</span><span class=lnt id=hl-17-92><a class=lnlinks href=#hl-17-92> 92</a>
</span><span class=lnt id=hl-17-93><a class=lnlinks href=#hl-17-93> 93</a>
</span><span class=lnt id=hl-17-94><a class=lnlinks href=#hl-17-94> 94</a>
</span><span class=lnt id=hl-17-95><a class=lnlinks href=#hl-17-95> 95</a>
</span><span class=lnt id=hl-17-96><a class=lnlinks href=#hl-17-96> 96</a>
</span><span class=lnt id=hl-17-97><a class=lnlinks href=#hl-17-97> 97</a>
</span><span class=lnt id=hl-17-98><a class=lnlinks href=#hl-17-98> 98</a>
</span><span class=lnt id=hl-17-99><a class=lnlinks href=#hl-17-99> 99</a>
</span><span class=lnt id=hl-17-100><a class=lnlinks href=#hl-17-100>100</a>
</span><span class=lnt id=hl-17-101><a class=lnlinks href=#hl-17-101>101</a>
</span><span class=lnt id=hl-17-102><a class=lnlinks href=#hl-17-102>102</a>
</span><span class=lnt id=hl-17-103><a class=lnlinks href=#hl-17-103>103</a>
</span><span class=lnt id=hl-17-104><a class=lnlinks href=#hl-17-104>104</a>
</span><span class=lnt id=hl-17-105><a class=lnlinks href=#hl-17-105>105</a>
</span><span class=lnt id=hl-17-106><a class=lnlinks href=#hl-17-106>106</a>
</span><span class=lnt id=hl-17-107><a class=lnlinks href=#hl-17-107>107</a>
</span><span class=lnt id=hl-17-108><a class=lnlinks href=#hl-17-108>108</a>
</span><span class=lnt id=hl-17-109><a class=lnlinks href=#hl-17-109>109</a>
</span><span class=lnt id=hl-17-110><a class=lnlinks href=#hl-17-110>110</a>
</span><span class=lnt id=hl-17-111><a class=lnlinks href=#hl-17-111>111</a>
</span><span class=lnt id=hl-17-112><a class=lnlinks href=#hl-17-112>112</a>
</span><span class=lnt id=hl-17-113><a class=lnlinks href=#hl-17-113>113</a>
</span><span class=lnt id=hl-17-114><a class=lnlinks href=#hl-17-114>114</a>
</span><span class=lnt id=hl-17-115><a class=lnlinks href=#hl-17-115>115</a>
</span><span class=lnt id=hl-17-116><a class=lnlinks href=#hl-17-116>116</a>
</span><span class=lnt id=hl-17-117><a class=lnlinks href=#hl-17-117>117</a>
</span><span class=lnt id=hl-17-118><a class=lnlinks href=#hl-17-118>118</a>
</span><span class=lnt id=hl-17-119><a class=lnlinks href=#hl-17-119>119</a>
</span><span class=lnt id=hl-17-120><a class=lnlinks href=#hl-17-120>120</a>
</span><span class=lnt id=hl-17-121><a class=lnlinks href=#hl-17-121>121</a>
</span><span class=lnt id=hl-17-122><a class=lnlinks href=#hl-17-122>122</a>
</span><span class=lnt id=hl-17-123><a class=lnlinks href=#hl-17-123>123</a>
</span><span class=lnt id=hl-17-124><a class=lnlinks href=#hl-17-124>124</a>
</span><span class=lnt id=hl-17-125><a class=lnlinks href=#hl-17-125>125</a>
</span><span class=lnt id=hl-17-126><a class=lnlinks href=#hl-17-126>126</a>
</span><span class=lnt id=hl-17-127><a class=lnlinks href=#hl-17-127>127</a>
</span><span class=lnt id=hl-17-128><a class=lnlinks href=#hl-17-128>128</a>
</span><span class=lnt id=hl-17-129><a class=lnlinks href=#hl-17-129>129</a>
</span><span class=lnt id=hl-17-130><a class=lnlinks href=#hl-17-130>130</a>
</span><span class=lnt id=hl-17-131><a class=lnlinks href=#hl-17-131>131</a>
</span><span class=lnt id=hl-17-132><a class=lnlinks href=#hl-17-132>132</a>
</span><span class=lnt id=hl-17-133><a class=lnlinks href=#hl-17-133>133</a>
</span><span class=lnt id=hl-17-134><a class=lnlinks href=#hl-17-134>134</a>
</span><span class=lnt id=hl-17-135><a class=lnlinks href=#hl-17-135>135</a>
</span><span class=lnt id=hl-17-136><a class=lnlinks href=#hl-17-136>136</a>
</span><span class=lnt id=hl-17-137><a class=lnlinks href=#hl-17-137>137</a>
</span><span class=lnt id=hl-17-138><a class=lnlinks href=#hl-17-138>138</a>
</span><span class=lnt id=hl-17-139><a class=lnlinks href=#hl-17-139>139</a>
</span><span class=lnt id=hl-17-140><a class=lnlinks href=#hl-17-140>140</a>
</span><span class=lnt id=hl-17-141><a class=lnlinks href=#hl-17-141>141</a>
</span><span class=lnt id=hl-17-142><a class=lnlinks href=#hl-17-142>142</a>
</span><span class=lnt id=hl-17-143><a class=lnlinks href=#hl-17-143>143</a>
</span><span class=lnt id=hl-17-144><a class=lnlinks href=#hl-17-144>144</a>
</span><span class=lnt id=hl-17-145><a class=lnlinks href=#hl-17-145>145</a>
</span><span class=lnt id=hl-17-146><a class=lnlinks href=#hl-17-146>146</a>
</span><span class=lnt id=hl-17-147><a class=lnlinks href=#hl-17-147>147</a>
</span><span class=lnt id=hl-17-148><a class=lnlinks href=#hl-17-148>148</a>
</span><span class=lnt id=hl-17-149><a class=lnlinks href=#hl-17-149>149</a>
</span><span class=lnt id=hl-17-150><a class=lnlinks href=#hl-17-150>150</a>
</span><span class=lnt id=hl-17-151><a class=lnlinks href=#hl-17-151>151</a>
</span><span class=lnt id=hl-17-152><a class=lnlinks href=#hl-17-152>152</a>
</span><span class=lnt id=hl-17-153><a class=lnlinks href=#hl-17-153>153</a>
</span><span class=lnt id=hl-17-154><a class=lnlinks href=#hl-17-154>154</a>
</span><span class=lnt id=hl-17-155><a class=lnlinks href=#hl-17-155>155</a>
</span><span class=lnt id=hl-17-156><a class=lnlinks href=#hl-17-156>156</a>
</span><span class=lnt id=hl-17-157><a class=lnlinks href=#hl-17-157>157</a>
</span><span class=lnt id=hl-17-158><a class=lnlinks href=#hl-17-158>158</a>
</span><span class=lnt id=hl-17-159><a class=lnlinks href=#hl-17-159>159</a>
</span><span class=lnt id=hl-17-160><a class=lnlinks href=#hl-17-160>160</a>
</span><span class=lnt id=hl-17-161><a class=lnlinks href=#hl-17-161>161</a>
</span><span class=lnt id=hl-17-162><a class=lnlinks href=#hl-17-162>162</a>
</span><span class=lnt id=hl-17-163><a class=lnlinks href=#hl-17-163>163</a>
</span><span class=lnt id=hl-17-164><a class=lnlinks href=#hl-17-164>164</a>
</span><span class=lnt id=hl-17-165><a class=lnlinks href=#hl-17-165>165</a>
</span><span class=lnt id=hl-17-166><a class=lnlinks href=#hl-17-166>166</a>
</span><span class=lnt id=hl-17-167><a class=lnlinks href=#hl-17-167>167</a>
</span><span class=lnt id=hl-17-168><a class=lnlinks href=#hl-17-168>168</a>
</span><span class=lnt id=hl-17-169><a class=lnlinks href=#hl-17-169>169</a>
</span><span class=lnt id=hl-17-170><a class=lnlinks href=#hl-17-170>170</a>
</span><span class=lnt id=hl-17-171><a class=lnlinks href=#hl-17-171>171</a>
</span><span class=lnt id=hl-17-172><a class=lnlinks href=#hl-17-172>172</a>
</span><span class=lnt id=hl-17-173><a class=lnlinks href=#hl-17-173>173</a>
</span><span class=lnt id=hl-17-174><a class=lnlinks href=#hl-17-174>174</a>
</span><span class=lnt id=hl-17-175><a class=lnlinks href=#hl-17-175>175</a>
</span><span class=lnt id=hl-17-176><a class=lnlinks href=#hl-17-176>176</a>
</span><span class=lnt id=hl-17-177><a class=lnlinks href=#hl-17-177>177</a>
</span><span class=lnt id=hl-17-178><a class=lnlinks href=#hl-17-178>178</a>
</span><span class=lnt id=hl-17-179><a class=lnlinks href=#hl-17-179>179</a>
</span><span class=lnt id=hl-17-180><a class=lnlinks href=#hl-17-180>180</a>
</span><span class=lnt id=hl-17-181><a class=lnlinks href=#hl-17-181>181</a>
</span><span class=lnt id=hl-17-182><a class=lnlinks href=#hl-17-182>182</a>
</span><span class=lnt id=hl-17-183><a class=lnlinks href=#hl-17-183>183</a>
</span><span class=lnt id=hl-17-184><a class=lnlinks href=#hl-17-184>184</a>
</span><span class=lnt id=hl-17-185><a class=lnlinks href=#hl-17-185>185</a>
</span><span class=lnt id=hl-17-186><a class=lnlinks href=#hl-17-186>186</a>
</span><span class=lnt id=hl-17-187><a class=lnlinks href=#hl-17-187>187</a>
</span><span class=lnt id=hl-17-188><a class=lnlinks href=#hl-17-188>188</a>
</span><span class=lnt id=hl-17-189><a class=lnlinks href=#hl-17-189>189</a>
</span><span class=lnt id=hl-17-190><a class=lnlinks href=#hl-17-190>190</a>
</span><span class=lnt id=hl-17-191><a class=lnlinks href=#hl-17-191>191</a>
</span><span class=lnt id=hl-17-192><a class=lnlinks href=#hl-17-192>192</a>
</span><span class=lnt id=hl-17-193><a class=lnlinks href=#hl-17-193>193</a>
</span><span class=lnt id=hl-17-194><a class=lnlinks href=#hl-17-194>194</a>
</span><span class=lnt id=hl-17-195><a class=lnlinks href=#hl-17-195>195</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aioredis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncpg</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderRequest</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>customer_id</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=n>items</span><span class=p>:</span> <span class=nb>list</span>
</span></span><span class=line><span class=cl>    <span class=n>payment_info</span><span class=p>:</span> <span class=nb>dict</span>
</span></span><span class=line><span class=cl>    <span class=n>shipping_address</span><span class=p>:</span> <span class=nb>dict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DistributedOrderProcessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    분산 환경에서 ACID 트랜잭션을 구현한 주문 처리 시스템
</span></span></span><span class=line><span class=cl><span class=s2>    - Saga 패턴으로 분산 트랜잭션 관리
</span></span></span><span class=line><span class=cl><span class=s2>    - 각 서비스별로 로컬 ACID 보장
</span></span></span><span class=line><span class=cl><span class=s2>    - 전체적으로 최종 일관성 달성
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>db_pools</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>redis_pool</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db_pools</span> <span class=o>=</span> <span class=n>db_pools</span>  <span class=c1># 서비스별 DB 연결 풀</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_pool</span>   <span class=c1># 분산 세션 저장소</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>process_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_request</span><span class=p>:</span> <span class=n>OrderRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        분산 ACID 트랜잭션으로 주문 처리
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>saga_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;order_saga_</span><span class=si>{</span><span class=n>order_request</span><span class=o>.</span><span class=n>customer_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 1. Saga 시작 - 분산 트랜잭션 상태 관리</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_start_saga</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=n>order_request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 2. 재고 예약 (Inventory Service에서 로컬 ACID)</span>
</span></span><span class=line><span class=cl>            <span class=n>reservation_result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_reserve_inventory</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=n>order_request</span><span class=o>.</span><span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>reservation_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_compensate_saga</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;inventory&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;failed&#34;</span><span class=p>,</span> <span class=s2>&#34;reason&#34;</span><span class=p>:</span> <span class=s2>&#34;inventory_unavailable&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 3. 결제 처리 (Payment Service에서 로컬 ACID)  </span>
</span></span><span class=line><span class=cl>            <span class=n>payment_result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_payment</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=n>order_request</span><span class=o>.</span><span class=n>payment_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_compensate_saga</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;inventory&#39;</span><span class=p>,</span> <span class=s1>&#39;payment&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;failed&#34;</span><span class=p>,</span> <span class=s2>&#34;reason&#34;</span><span class=p>:</span> <span class=s2>&#34;payment_failed&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 4. 주문 생성 (Order Service에서 로컬 ACID)</span>
</span></span><span class=line><span class=cl>            <span class=n>order_result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_order</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=n>order_request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>order_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_compensate_saga</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;inventory&#39;</span><span class=p>,</span> <span class=s1>&#39;payment&#39;</span><span class=p>,</span> <span class=s1>&#39;order&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;failed&#34;</span><span class=p>,</span> <span class=s2>&#34;reason&#34;</span><span class=p>:</span> <span class=s2>&#34;order_creation_failed&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 5. 배송 준비 (Shipping Service에서 로컬 ACID)</span>
</span></span><span class=line><span class=cl>            <span class=n>shipping_result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_shipping</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=n>order_request</span><span class=o>.</span><span class=n>shipping_address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 6. Saga 완료 - 모든 서비스 커밋</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_complete_saga</span><span class=p>(</span><span class=n>saga_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_result</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;saga_id&#34;</span><span class=p>:</span> <span class=n>saga_id</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 전체 보상 트랜잭션 실행</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_compensate_saga</span><span class=p>(</span><span class=n>saga_id</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;inventory&#39;</span><span class=p>,</span> <span class=s1>&#39;payment&#39;</span><span class=p>,</span> <span class=s1>&#39;order&#39;</span><span class=p>,</span> <span class=s1>&#39;shipping&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;error&#34;</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_reserve_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>saga_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=nb>list</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        재고 서비스에서 ACID 트랜잭션으로 재고 예약
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_pools</span><span class=p>[</span><span class=s1>&#39;inventory&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>async</span> <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>transaction</span><span class=p>():</span>  <span class=c1># PostgreSQL 트랜잭ション 시작</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>reserved_items</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 재고 확인 및 락 (Isolation)</span>
</span></span><span class=line><span class=cl>                        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>conn</span><span class=o>.</span><span class=n>fetchrow</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;SELECT stock_quantity FROM inventory WHERE product_id = $1 FOR UPDATE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>item</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                        <span class=p>)</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span> <span class=ow>or</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;stock_quantity&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Insufficient stock for product </span><span class=si>{</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=c1># 재고 예약 (Atomicity)</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;UPDATE inventory SET reserved_quantity = reserved_quantity + $1 WHERE product_id = $2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>],</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                        <span class=p>)</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=n>reserved_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># Saga 상태 저장 (Durability)</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>hset</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;saga:</span><span class=si>{</span><span class=n>saga_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;inventory_reserved&#34;</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>reserved_items</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;reserved_items&#34;</span><span class=p>:</span> <span class=n>reserved_items</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 자동 롤백 (Atomicity)</span>
</span></span><span class=line><span class=cl>                    <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Inventory reservation failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_process_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>saga_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>payment_info</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        결제 서비스에서 ACID 트랜잭션으로 결제 처리
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_pools</span><span class=p>[</span><span class=s1>&#39;payment&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>async</span> <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>transaction</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 결제 정보 검증 (Consistency)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_validate_payment_info</span><span class=p>(</span><span class=n>payment_info</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Invalid payment information&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 결제 처리 (Atomicity)</span>
</span></span><span class=line><span class=cl>                    <span class=n>payment_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>conn</span><span class=o>.</span><span class=n>fetchrow</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;INSERT INTO payments (customer_id, amount, payment_method, status, created_at) VALUES ($1, $2, $3, &#39;completed&#39;, NOW()) RETURNING payment_id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>payment_info</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>],</span> <span class=n>payment_info</span><span class=p>[</span><span class=s1>&#39;amount&#39;</span><span class=p>],</span> <span class=n>payment_info</span><span class=p>[</span><span class=s1>&#39;method&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># Saga 상태 저장 (Durability)</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>hset</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;saga:</span><span class=si>{</span><span class=n>saga_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;payment_id&#34;</span><span class=p>,</span> <span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;payment_id&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;payment_id&#34;</span><span class=p>:</span> <span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;payment_id&#39;</span><span class=p>]}</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Payment processing failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_compensate_saga</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>saga_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>services_to_compensate</span><span class=p>:</span> <span class=nb>list</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Saga 패턴의 보상 트랜잭션 - 실패한 작업들을 되돌림
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>service</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=n>services_to_compensate</span><span class=p>):</span>  <span class=c1># 역순으로 보상</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>service</span> <span class=o>==</span> <span class=s1>&#39;inventory&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_compensate_inventory</span><span class=p>(</span><span class=n>saga_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>service</span> <span class=o>==</span> <span class=s1>&#39;payment&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_compensate_payment</span><span class=p>(</span><span class=n>saga_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>service</span> <span class=o>==</span> <span class=s1>&#39;order&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_compensate_order</span><span class=p>(</span><span class=n>saga_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>service</span> <span class=o>==</span> <span class=s1>&#39;shipping&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_compensate_shipping</span><span class=p>(</span><span class=n>saga_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Compensation failed for </span><span class=si>{</span><span class=n>service</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_compensate_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>saga_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 예약 취소&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>reserved_items</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>hget</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;saga:</span><span class=si>{</span><span class=n>saga_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;inventory_reserved&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=s2>&#34;[]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_pools</span><span class=p>[</span><span class=s1>&#39;inventory&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>async</span> <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>transaction</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>reserved_items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;UPDATE inventory SET reserved_quantity = reserved_quantity - $1 WHERE product_id = $2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>],</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 데이터베이스 연결 풀 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>db_pools</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;inventory&#39;</span><span class=p>:</span> <span class=k>await</span> <span class=n>asyncpg</span><span class=o>.</span><span class=n>create_pool</span><span class=p>(</span><span class=s2>&#34;postgresql://user:pass@inventory-db:5432/inventory&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;payment&#39;</span><span class=p>:</span> <span class=k>await</span> <span class=n>asyncpg</span><span class=o>.</span><span class=n>create_pool</span><span class=p>(</span><span class=s2>&#34;postgresql://user:pass@payment-db:5432/payment&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;order&#39;</span><span class=p>:</span> <span class=k>await</span> <span class=n>asyncpg</span><span class=o>.</span><span class=n>create_pool</span><span class=p>(</span><span class=s2>&#34;postgresql://user:pass@order-db:5432/orders&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;shipping&#39;</span><span class=p>:</span> <span class=k>await</span> <span class=n>asyncpg</span><span class=o>.</span><span class=n>create_pool</span><span class=p>(</span><span class=s2>&#34;postgresql://user:pass@shipping-db:5432/shipping&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Redis 연결</span>
</span></span><span class=line><span class=cl>    <span class=n>redis_pool</span> <span class=o>=</span> <span class=k>await</span> <span class=n>aioredis</span><span class=o>.</span><span class=n>create_redis_pool</span><span class=p>(</span><span class=s2>&#34;redis://redis:6379&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 분산 주문 처리기 초기화</span>
</span></span><span class=line><span class=cl>    <span class=n>processor</span> <span class=o>=</span> <span class=n>DistributedOrderProcessor</span><span class=p>(</span><span class=n>db_pools</span><span class=p>,</span> <span class=n>redis_pool</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 주문 요청</span>
</span></span><span class=line><span class=cl>    <span class=n>order_request</span> <span class=o>=</span> <span class=n>OrderRequest</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>customer_id</span><span class=o>=</span><span class=mi>12345</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span><span class=o>=</span><span class=p>[{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=mi>101</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span> <span class=p>{</span><span class=s2>&#34;product_id&#34;</span><span class=p>:</span> <span class=mi>102</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>        <span class=n>payment_info</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;customer_id&#34;</span><span class=p>:</span> <span class=mi>12345</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>199.99</span><span class=p>,</span> <span class=s2>&#34;method&#34;</span><span class=p>:</span> <span class=s2>&#34;credit_card&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>shipping_address</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;street&#34;</span><span class=p>:</span> <span class=s2>&#34;123 Main St&#34;</span><span class=p>,</span> <span class=s2>&#34;city&#34;</span><span class=p>:</span> <span class=s2>&#34;Seoul&#34;</span><span class=p>,</span> <span class=s2>&#34;country&#34;</span><span class=p>:</span> <span class=s2>&#34;KR&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 분산 ACID 트랜잭션으로 주문 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>processor</span><span class=o>.</span><span class=n>process_order</span><span class=p>(</span><span class=n>order_request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Order processing result: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-은행-계좌-이체-시스템>사례: 은행 계좌 이체 시스템<a hidden class=anchor aria-hidden=true href=#사례-은행-계좌-이체-시스템>#</a></h5><p><strong>시스템 구성</strong></p><ul><li>코어뱅킹 시스템 (Core Banking System)</li><li>계좌 관리 데이터베이스</li><li>거래 로그 시스템</li><li>실시간 모니터링 시스템</li></ul><p><strong>시스템 구성 다이어그램</strong></p><pre class=mermaid>graph TB
    subgraph &#34;프레젠테이션 계층&#34;
        A[모바일 앱]
        B[웹 인터페이스]
        C[ATM]
    end
    
    subgraph &#34;비즈니스 로직 계층&#34;
        D[계좌 이체 서비스]
        E[인증 서비스]
        F[알림 서비스]
    end
    
    subgraph &#34;데이터 계층&#34;
        G[계좌 DB - ACID 보장]
        H[거래 로그 DB]
        I[감사 로그]
    end
    
    A --&gt; D
    B --&gt; D
    C --&gt; D
    D --&gt; E
    D --&gt; F
    D --&gt; G
    G --&gt; H
    G --&gt; I
</pre><p><strong>활용 사례 Workflow</strong></p><pre class=mermaid>sequenceDiagram
    participant U as 사용자
    participant S as 이체 서비스
    participant DB as 계좌 DB
    participant L as 로그 시스템
    
    U-&gt;&gt;S: 이체 요청 (출금계좌, 입금계좌, 금액)
    S-&gt;&gt;DB: BEGIN TRANSACTION
    S-&gt;&gt;DB: 출금계좌 잔액 확인 및 차감
    S-&gt;&gt;DB: 입금계좌 잔액 증가
    S-&gt;&gt;L: 거래 로그 기록
    
    alt 모든 연산 성공
        S-&gt;&gt;DB: COMMIT
        S-&gt;&gt;U: 이체 완료 응답
    else 연산 실패
        S-&gt;&gt;DB: ROLLBACK  
        S-&gt;&gt;U: 이체 실패 응답
    end
</pre><p><strong>ACID Properties 의 역할</strong></p><ul><li><strong>원자성</strong>: 출금과 입금이 모두 성공하거나 모두 실패</li><li><strong>일관성</strong>: 총 자금량 보존, 계좌 잔액 제약조건 유지</li><li><strong>고립성</strong>: 동시 이체 시 계좌 잔액 충돌 방지</li><li><strong>지속성</strong>: 완료된 이체 거래의 영구적 보존</li></ul><p><strong>ACID 유무에 따른 차이점</strong></p><ul><li><strong>ACID 적용 시</strong>: 자금 유실 없음, 정확한 잔액 유지, 감사 가능성</li><li><strong>ACID 미적용 시</strong>: 부분 이체 발생, 잔액 불일치, 거래 추적 불가</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>  1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>  2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>  3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>  4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>  5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>  6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7>  7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8>  8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9>  9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10> 10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11> 11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12> 12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13> 13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14> 14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15> 15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16> 16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17> 17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18> 18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19> 19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20> 20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21> 21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22> 22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23> 23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24> 24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25> 25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26> 26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27> 27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28> 28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29> 29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30> 30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31> 31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32> 32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33> 33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34> 34</a>
</span><span class=lnt id=hl-20-35><a class=lnlinks href=#hl-20-35> 35</a>
</span><span class=lnt id=hl-20-36><a class=lnlinks href=#hl-20-36> 36</a>
</span><span class=lnt id=hl-20-37><a class=lnlinks href=#hl-20-37> 37</a>
</span><span class=lnt id=hl-20-38><a class=lnlinks href=#hl-20-38> 38</a>
</span><span class=lnt id=hl-20-39><a class=lnlinks href=#hl-20-39> 39</a>
</span><span class=lnt id=hl-20-40><a class=lnlinks href=#hl-20-40> 40</a>
</span><span class=lnt id=hl-20-41><a class=lnlinks href=#hl-20-41> 41</a>
</span><span class=lnt id=hl-20-42><a class=lnlinks href=#hl-20-42> 42</a>
</span><span class=lnt id=hl-20-43><a class=lnlinks href=#hl-20-43> 43</a>
</span><span class=lnt id=hl-20-44><a class=lnlinks href=#hl-20-44> 44</a>
</span><span class=lnt id=hl-20-45><a class=lnlinks href=#hl-20-45> 45</a>
</span><span class=lnt id=hl-20-46><a class=lnlinks href=#hl-20-46> 46</a>
</span><span class=lnt id=hl-20-47><a class=lnlinks href=#hl-20-47> 47</a>
</span><span class=lnt id=hl-20-48><a class=lnlinks href=#hl-20-48> 48</a>
</span><span class=lnt id=hl-20-49><a class=lnlinks href=#hl-20-49> 49</a>
</span><span class=lnt id=hl-20-50><a class=lnlinks href=#hl-20-50> 50</a>
</span><span class=lnt id=hl-20-51><a class=lnlinks href=#hl-20-51> 51</a>
</span><span class=lnt id=hl-20-52><a class=lnlinks href=#hl-20-52> 52</a>
</span><span class=lnt id=hl-20-53><a class=lnlinks href=#hl-20-53> 53</a>
</span><span class=lnt id=hl-20-54><a class=lnlinks href=#hl-20-54> 54</a>
</span><span class=lnt id=hl-20-55><a class=lnlinks href=#hl-20-55> 55</a>
</span><span class=lnt id=hl-20-56><a class=lnlinks href=#hl-20-56> 56</a>
</span><span class=lnt id=hl-20-57><a class=lnlinks href=#hl-20-57> 57</a>
</span><span class=lnt id=hl-20-58><a class=lnlinks href=#hl-20-58> 58</a>
</span><span class=lnt id=hl-20-59><a class=lnlinks href=#hl-20-59> 59</a>
</span><span class=lnt id=hl-20-60><a class=lnlinks href=#hl-20-60> 60</a>
</span><span class=lnt id=hl-20-61><a class=lnlinks href=#hl-20-61> 61</a>
</span><span class=lnt id=hl-20-62><a class=lnlinks href=#hl-20-62> 62</a>
</span><span class=lnt id=hl-20-63><a class=lnlinks href=#hl-20-63> 63</a>
</span><span class=lnt id=hl-20-64><a class=lnlinks href=#hl-20-64> 64</a>
</span><span class=lnt id=hl-20-65><a class=lnlinks href=#hl-20-65> 65</a>
</span><span class=lnt id=hl-20-66><a class=lnlinks href=#hl-20-66> 66</a>
</span><span class=lnt id=hl-20-67><a class=lnlinks href=#hl-20-67> 67</a>
</span><span class=lnt id=hl-20-68><a class=lnlinks href=#hl-20-68> 68</a>
</span><span class=lnt id=hl-20-69><a class=lnlinks href=#hl-20-69> 69</a>
</span><span class=lnt id=hl-20-70><a class=lnlinks href=#hl-20-70> 70</a>
</span><span class=lnt id=hl-20-71><a class=lnlinks href=#hl-20-71> 71</a>
</span><span class=lnt id=hl-20-72><a class=lnlinks href=#hl-20-72> 72</a>
</span><span class=lnt id=hl-20-73><a class=lnlinks href=#hl-20-73> 73</a>
</span><span class=lnt id=hl-20-74><a class=lnlinks href=#hl-20-74> 74</a>
</span><span class=lnt id=hl-20-75><a class=lnlinks href=#hl-20-75> 75</a>
</span><span class=lnt id=hl-20-76><a class=lnlinks href=#hl-20-76> 76</a>
</span><span class=lnt id=hl-20-77><a class=lnlinks href=#hl-20-77> 77</a>
</span><span class=lnt id=hl-20-78><a class=lnlinks href=#hl-20-78> 78</a>
</span><span class=lnt id=hl-20-79><a class=lnlinks href=#hl-20-79> 79</a>
</span><span class=lnt id=hl-20-80><a class=lnlinks href=#hl-20-80> 80</a>
</span><span class=lnt id=hl-20-81><a class=lnlinks href=#hl-20-81> 81</a>
</span><span class=lnt id=hl-20-82><a class=lnlinks href=#hl-20-82> 82</a>
</span><span class=lnt id=hl-20-83><a class=lnlinks href=#hl-20-83> 83</a>
</span><span class=lnt id=hl-20-84><a class=lnlinks href=#hl-20-84> 84</a>
</span><span class=lnt id=hl-20-85><a class=lnlinks href=#hl-20-85> 85</a>
</span><span class=lnt id=hl-20-86><a class=lnlinks href=#hl-20-86> 86</a>
</span><span class=lnt id=hl-20-87><a class=lnlinks href=#hl-20-87> 87</a>
</span><span class=lnt id=hl-20-88><a class=lnlinks href=#hl-20-88> 88</a>
</span><span class=lnt id=hl-20-89><a class=lnlinks href=#hl-20-89> 89</a>
</span><span class=lnt id=hl-20-90><a class=lnlinks href=#hl-20-90> 90</a>
</span><span class=lnt id=hl-20-91><a class=lnlinks href=#hl-20-91> 91</a>
</span><span class=lnt id=hl-20-92><a class=lnlinks href=#hl-20-92> 92</a>
</span><span class=lnt id=hl-20-93><a class=lnlinks href=#hl-20-93> 93</a>
</span><span class=lnt id=hl-20-94><a class=lnlinks href=#hl-20-94> 94</a>
</span><span class=lnt id=hl-20-95><a class=lnlinks href=#hl-20-95> 95</a>
</span><span class=lnt id=hl-20-96><a class=lnlinks href=#hl-20-96> 96</a>
</span><span class=lnt id=hl-20-97><a class=lnlinks href=#hl-20-97> 97</a>
</span><span class=lnt id=hl-20-98><a class=lnlinks href=#hl-20-98> 98</a>
</span><span class=lnt id=hl-20-99><a class=lnlinks href=#hl-20-99> 99</a>
</span><span class=lnt id=hl-20-100><a class=lnlinks href=#hl-20-100>100</a>
</span><span class=lnt id=hl-20-101><a class=lnlinks href=#hl-20-101>101</a>
</span><span class=lnt id=hl-20-102><a class=lnlinks href=#hl-20-102>102</a>
</span><span class=lnt id=hl-20-103><a class=lnlinks href=#hl-20-103>103</a>
</span><span class=lnt id=hl-20-104><a class=lnlinks href=#hl-20-104>104</a>
</span><span class=lnt id=hl-20-105><a class=lnlinks href=#hl-20-105>105</a>
</span><span class=lnt id=hl-20-106><a class=lnlinks href=#hl-20-106>106</a>
</span><span class=lnt id=hl-20-107><a class=lnlinks href=#hl-20-107>107</a>
</span><span class=lnt id=hl-20-108><a class=lnlinks href=#hl-20-108>108</a>
</span><span class=lnt id=hl-20-109><a class=lnlinks href=#hl-20-109>109</a>
</span><span class=lnt id=hl-20-110><a class=lnlinks href=#hl-20-110>110</a>
</span><span class=lnt id=hl-20-111><a class=lnlinks href=#hl-20-111>111</a>
</span><span class=lnt id=hl-20-112><a class=lnlinks href=#hl-20-112>112</a>
</span><span class=lnt id=hl-20-113><a class=lnlinks href=#hl-20-113>113</a>
</span><span class=lnt id=hl-20-114><a class=lnlinks href=#hl-20-114>114</a>
</span><span class=lnt id=hl-20-115><a class=lnlinks href=#hl-20-115>115</a>
</span><span class=lnt id=hl-20-116><a class=lnlinks href=#hl-20-116>116</a>
</span><span class=lnt id=hl-20-117><a class=lnlinks href=#hl-20-117>117</a>
</span><span class=lnt id=hl-20-118><a class=lnlinks href=#hl-20-118>118</a>
</span><span class=lnt id=hl-20-119><a class=lnlinks href=#hl-20-119>119</a>
</span><span class=lnt id=hl-20-120><a class=lnlinks href=#hl-20-120>120</a>
</span><span class=lnt id=hl-20-121><a class=lnlinks href=#hl-20-121>121</a>
</span><span class=lnt id=hl-20-122><a class=lnlinks href=#hl-20-122>122</a>
</span><span class=lnt id=hl-20-123><a class=lnlinks href=#hl-20-123>123</a>
</span><span class=lnt id=hl-20-124><a class=lnlinks href=#hl-20-124>124</a>
</span><span class=lnt id=hl-20-125><a class=lnlinks href=#hl-20-125>125</a>
</span><span class=lnt id=hl-20-126><a class=lnlinks href=#hl-20-126>126</a>
</span><span class=lnt id=hl-20-127><a class=lnlinks href=#hl-20-127>127</a>
</span><span class=lnt id=hl-20-128><a class=lnlinks href=#hl-20-128>128</a>
</span><span class=lnt id=hl-20-129><a class=lnlinks href=#hl-20-129>129</a>
</span><span class=lnt id=hl-20-130><a class=lnlinks href=#hl-20-130>130</a>
</span><span class=lnt id=hl-20-131><a class=lnlinks href=#hl-20-131>131</a>
</span><span class=lnt id=hl-20-132><a class=lnlinks href=#hl-20-132>132</a>
</span><span class=lnt id=hl-20-133><a class=lnlinks href=#hl-20-133>133</a>
</span><span class=lnt id=hl-20-134><a class=lnlinks href=#hl-20-134>134</a>
</span><span class=lnt id=hl-20-135><a class=lnlinks href=#hl-20-135>135</a>
</span><span class=lnt id=hl-20-136><a class=lnlinks href=#hl-20-136>136</a>
</span><span class=lnt id=hl-20-137><a class=lnlinks href=#hl-20-137>137</a>
</span><span class=lnt id=hl-20-138><a class=lnlinks href=#hl-20-138>138</a>
</span><span class=lnt id=hl-20-139><a class=lnlinks href=#hl-20-139>139</a>
</span><span class=lnt id=hl-20-140><a class=lnlinks href=#hl-20-140>140</a>
</span><span class=lnt id=hl-20-141><a class=lnlinks href=#hl-20-141>141</a>
</span><span class=lnt id=hl-20-142><a class=lnlinks href=#hl-20-142>142</a>
</span><span class=lnt id=hl-20-143><a class=lnlinks href=#hl-20-143>143</a>
</span><span class=lnt id=hl-20-144><a class=lnlinks href=#hl-20-144>144</a>
</span><span class=lnt id=hl-20-145><a class=lnlinks href=#hl-20-145>145</a>
</span><span class=lnt id=hl-20-146><a class=lnlinks href=#hl-20-146>146</a>
</span><span class=lnt id=hl-20-147><a class=lnlinks href=#hl-20-147>147</a>
</span><span class=lnt id=hl-20-148><a class=lnlinks href=#hl-20-148>148</a>
</span><span class=lnt id=hl-20-149><a class=lnlinks href=#hl-20-149>149</a>
</span><span class=lnt id=hl-20-150><a class=lnlinks href=#hl-20-150>150</a>
</span><span class=lnt id=hl-20-151><a class=lnlinks href=#hl-20-151>151</a>
</span><span class=lnt id=hl-20-152><a class=lnlinks href=#hl-20-152>152</a>
</span><span class=lnt id=hl-20-153><a class=lnlinks href=#hl-20-153>153</a>
</span><span class=lnt id=hl-20-154><a class=lnlinks href=#hl-20-154>154</a>
</span><span class=lnt id=hl-20-155><a class=lnlinks href=#hl-20-155>155</a>
</span><span class=lnt id=hl-20-156><a class=lnlinks href=#hl-20-156>156</a>
</span><span class=lnt id=hl-20-157><a class=lnlinks href=#hl-20-157>157</a>
</span><span class=lnt id=hl-20-158><a class=lnlinks href=#hl-20-158>158</a>
</span><span class=lnt id=hl-20-159><a class=lnlinks href=#hl-20-159>159</a>
</span><span class=lnt id=hl-20-160><a class=lnlinks href=#hl-20-160>160</a>
</span><span class=lnt id=hl-20-161><a class=lnlinks href=#hl-20-161>161</a>
</span><span class=lnt id=hl-20-162><a class=lnlinks href=#hl-20-162>162</a>
</span><span class=lnt id=hl-20-163><a class=lnlinks href=#hl-20-163>163</a>
</span><span class=lnt id=hl-20-164><a class=lnlinks href=#hl-20-164>164</a>
</span><span class=lnt id=hl-20-165><a class=lnlinks href=#hl-20-165>165</a>
</span><span class=lnt id=hl-20-166><a class=lnlinks href=#hl-20-166>166</a>
</span><span class=lnt id=hl-20-167><a class=lnlinks href=#hl-20-167>167</a>
</span><span class=lnt id=hl-20-168><a class=lnlinks href=#hl-20-168>168</a>
</span><span class=lnt id=hl-20-169><a class=lnlinks href=#hl-20-169>169</a>
</span><span class=lnt id=hl-20-170><a class=lnlinks href=#hl-20-170>170</a>
</span><span class=lnt id=hl-20-171><a class=lnlinks href=#hl-20-171>171</a>
</span><span class=lnt id=hl-20-172><a class=lnlinks href=#hl-20-172>172</a>
</span><span class=lnt id=hl-20-173><a class=lnlinks href=#hl-20-173>173</a>
</span><span class=lnt id=hl-20-174><a class=lnlinks href=#hl-20-174>174</a>
</span><span class=lnt id=hl-20-175><a class=lnlinks href=#hl-20-175>175</a>
</span><span class=lnt id=hl-20-176><a class=lnlinks href=#hl-20-176>176</a>
</span><span class=lnt id=hl-20-177><a class=lnlinks href=#hl-20-177>177</a>
</span><span class=lnt id=hl-20-178><a class=lnlinks href=#hl-20-178>178</a>
</span><span class=lnt id=hl-20-179><a class=lnlinks href=#hl-20-179>179</a>
</span><span class=lnt id=hl-20-180><a class=lnlinks href=#hl-20-180>180</a>
</span><span class=lnt id=hl-20-181><a class=lnlinks href=#hl-20-181>181</a>
</span><span class=lnt id=hl-20-182><a class=lnlinks href=#hl-20-182>182</a>
</span><span class=lnt id=hl-20-183><a class=lnlinks href=#hl-20-183>183</a>
</span><span class=lnt id=hl-20-184><a class=lnlinks href=#hl-20-184>184</a>
</span><span class=lnt id=hl-20-185><a class=lnlinks href=#hl-20-185>185</a>
</span><span class=lnt id=hl-20-186><a class=lnlinks href=#hl-20-186>186</a>
</span><span class=lnt id=hl-20-187><a class=lnlinks href=#hl-20-187>187</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BankAccount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;ACID Properties를 보장하는 은행 계좌 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>initial_balance</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>account_id</span> <span class=o>=</span> <span class=n>account_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span> <span class=o>=</span> <span class=n>initial_balance</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>  <span class=c1># 계좌별 락 (고립성 보장)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_transaction_log</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># 거래 로그 (지속성 보장)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@property</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>balance</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;현재 잔액 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_log_transaction</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>operation</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                        <span class=n>timestamp</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>success</span><span class=p>:</span> <span class=nb>bool</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;거래 로그 기록 (지속성 구현)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>log_entry</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;operation&#39;</span><span class=p>:</span> <span class=n>operation</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;amount&#39;</span><span class=p>:</span> <span class=n>amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;balance_after&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=n>success</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_transaction_log</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>log_entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>deposit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;입금 처리 (일관성 보장)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>amount</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>  <span class=c1># 비즈니스 규칙 위반 방지</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>  <span class=c1># 고립성 보장</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 원자성: 모든 연산이 성공해야 함</span>
</span></span><span class=line><span class=cl>                <span class=n>old_balance</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span> <span class=o>+=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 일관성: 잔액이 음수가 될 수 없음 (비즈니스 규칙)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span> <span class=o>=</span> <span class=n>old_balance</span>  <span class=c1># 롤백</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_log_transaction</span><span class=p>(</span><span class=s1>&#39;DEPOSIT&#39;</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 지속성: 성공적인 거래 로그 기록</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_log_transaction</span><span class=p>(</span><span class=s1>&#39;DEPOSIT&#39;</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 원자성: 오류 시 롤백</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span> <span class=o>=</span> <span class=n>old_balance</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_log_transaction</span><span class=p>(</span><span class=s1>&#39;DEPOSIT&#39;</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>withdraw</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;출금 처리 (모든 ACID 특성 적용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>amount</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>  <span class=c1># 고립성 보장</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 일관성: 잔액 부족 확인</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span> <span class=o>&lt;</span> <span class=n>amount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_log_transaction</span><span class=p>(</span><span class=s1>&#39;WITHDRAW&#39;</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 원자성: 출금 실행</span>
</span></span><span class=line><span class=cl>                <span class=n>old_balance</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span> <span class=o>-=</span> <span class=n>amount</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 지속성: 성공적인 거래 로그 기록</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_log_transaction</span><span class=p>(</span><span class=s1>&#39;WITHDRAW&#39;</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 원자성: 오류 시 롤백</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_balance</span> <span class=o>=</span> <span class=n>old_balance</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_log_transaction</span><span class=p>(</span><span class=s1>&#39;WITHDRAW&#39;</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TransactionManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;트랜잭션 매니저 (원자성 구현)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_active_transactions</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_global_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transaction</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>transaction_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;트랜잭션 컨텍스트 매니저&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_begin_transaction</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=bp>self</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_commit_transaction</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_rollback_transaction</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>e</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_begin_transaction</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>transaction_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;트랜잭션 시작&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_global_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_active_transactions</span><span class=p>[</span><span class=n>transaction_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;start_time&#39;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;operations&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;locks_held&#39;</span><span class=p>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_commit_transaction</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>transaction_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;트랜잭션 커밋 (지속성 보장)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_global_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>transaction_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_active_transactions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 모든 변경사항을 영구적으로 적용</span>
</span></span><span class=line><span class=cl>                <span class=n>transaction</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_active_transactions</span><span class=p>[</span><span class=n>transaction_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=c1># 로그에 커밋 기록</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Transaction </span><span class=si>{</span><span class=n>transaction_id</span><span class=si>}</span><span class=s2> committed successfully&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=n>_active_transactions</span><span class=p>[</span><span class=n>transaction_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_rollback_transaction</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>transaction_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;트랜잭션 롤백 (원자성 보장)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_global_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>transaction_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_active_transactions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 모든 변경사항을 원래 상태로 복구</span>
</span></span><span class=line><span class=cl>                <span class=n>transaction</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_active_transactions</span><span class=p>[</span><span class=n>transaction_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Transaction </span><span class=si>{</span><span class=n>transaction_id</span><span class=si>}</span><span class=s2> rolled back&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=n>_active_transactions</span><span class=p>[</span><span class=n>transaction_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transfer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>from_account</span><span class=p>:</span> <span class=n>BankAccount</span><span class=p>,</span> <span class=n>to_account</span><span class=p>:</span> <span class=n>BankAccount</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>amount</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;계좌 이체 (모든 ACID 특성 적용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>transaction_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;transfer_</span><span class=si>{</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>transaction</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=c1># 원자성: 출금과 입금이 모두 성공해야 함</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>from_account</span><span class=o>.</span><span class=n>withdraw</span><span class=p>(</span><span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;출금 실패&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>to_account</span><span class=o>.</span><span class=n>deposit</span><span class=p>(</span><span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 롤백: 출금을 취소해야 함</span>
</span></span><span class=line><span class=cl>                    <span class=n>from_account</span><span class=o>.</span><span class=n>deposit</span><span class=p>(</span><span class=n>amount</span><span class=p>)</span>  <span class=c1># 보상 트랜잭션</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;입금 실패&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;이체 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>demonstrate_acid_properties</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;ACID Properties 데모&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 계좌 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>account_a</span> <span class=o>=</span> <span class=n>BankAccount</span><span class=p>(</span><span class=s2>&#34;ACC_001&#34;</span><span class=p>,</span> <span class=mf>1000.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>account_b</span> <span class=o>=</span> <span class=n>BankAccount</span><span class=p>(</span><span class=s2>&#34;ACC_002&#34;</span><span class=p>,</span> <span class=mf>500.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 트랜잭션 매니저 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>tm</span> <span class=o>=</span> <span class=n>TransactionManager</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=== 초기 상태 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;계좌 A 잔액: </span><span class=si>{</span><span class=n>account_a</span><span class=o>.</span><span class=n>balance</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;계좌 B 잔액: </span><span class=si>{</span><span class=n>account_b</span><span class=o>.</span><span class=n>balance</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;총 잔액: </span><span class=si>{</span><span class=n>account_a</span><span class=o>.</span><span class=n>balance</span> <span class=o>+</span> <span class=n>account_b</span><span class=o>.</span><span class=n>balance</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 정상 이체 (300원) ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>success</span> <span class=o>=</span> <span class=n>tm</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>account_a</span><span class=p>,</span> <span class=n>account_b</span><span class=p>,</span> <span class=mf>300.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;이체 결과: </span><span class=si>{</span><span class=s1>&#39;성공&#39;</span> <span class=k>if</span> <span class=n>success</span> <span class=k>else</span> <span class=s1>&#39;실패&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;계좌 A 잔액: </span><span class=si>{</span><span class=n>account_a</span><span class=o>.</span><span class=n>balance</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;계좌 B 잔액: </span><span class=si>{</span><span class=n>account_b</span><span class=o>.</span><span class=n>balance</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;총 잔액: </span><span class=si>{</span><span class=n>account_a</span><span class=o>.</span><span class=n>balance</span> <span class=o>+</span> <span class=n>account_b</span><span class=o>.</span><span class=n>balance</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 잔액 부족 이체 시도 (2000원) ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>success</span> <span class=o>=</span> <span class=n>tm</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>account_a</span><span class=p>,</span> <span class=n>account_b</span><span class=p>,</span> <span class=mf>2000.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;이체 결과: </span><span class=si>{</span><span class=s1>&#39;성공&#39;</span> <span class=k>if</span> <span class=n>success</span> <span class=k>else</span> <span class=s1>&#39;실패&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;계좌 A 잔액: </span><span class=si>{</span><span class=n>account_a</span><span class=o>.</span><span class=n>balance</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;계좌 B 잔액: </span><span class=si>{</span><span class=n>account_b</span><span class=o>.</span><span class=n>balance</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;총 잔액: </span><span class=si>{</span><span class=n>account_a</span><span class=o>.</span><span class=n>balance</span> <span class=o>+</span> <span class=n>account_b</span><span class=o>.</span><span class=n>balance</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>demonstrate_acid_properties</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=운영-및-최적화-operations--optimization>운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#운영-및-최적화-operations--optimization>#</a></h3><h4 id=보안-및-거버넌스>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스>#</a></h4><table><thead><tr><th>영역</th><th>항목</th><th>목적</th><th>권장 실무</th><th>주의/메모</th></tr></thead><tbody><tr><td>접근통제</td><td>RBAC/ABAC, RLS</td><td>최소권한·행 수준 격리</td><td>업무 역할별 권한, 테넌트 격리, 승격·만료 자동화</td><td>과권한 탐지·리뷰 주기화</td></tr><tr><td>암호화 (전송)</td><td>TLS 1.2+/mTLS</td><td>도청·위변조 방지</td><td>강 암호군/PFS, 인증서 자동 회전</td><td>내부 트래픽도 mTLS</td></tr><tr><td>암호화 (저장)</td><td>TDE/컬럼 암호화</td><td>유출시 노출 최소화</td><td>PII/결제 컬럼 암호화, 로그·백업 암호화</td><td>인덱싱 영향·검색 전략 고려</td></tr><tr><td>키관리</td><td>KMS/HSM</td><td>키 안전·순환</td><td>회전·폐기·접근감사, 키 분리보관</td><td>키 삭제=효과적 삭제 전략</td></tr><tr><td>감사/무결성</td><td>서명/해시체인·WORM</td><td>위·변조 탐지</td><td>변경 이벤트 전부 기록, 시간 동기화</td><td>개인정보 최소화·마스킹</td></tr><tr><td>네트워크</td><td>세분망/DBFW</td><td>공격면 축소</td><td>VPC/SG 분리, 최소 포트</td><td>관리면 분리 (Bastion/VPN)</td></tr><tr><td>애플리케이션</td><td>SQLi/중복방지</td><td>논리 무결성</td><td>파라미터 바인딩, 멱등키, 중복 거부</td><td>재시도 정책과 함께 설계</td></tr><tr><td>운영</td><td>DR/BCP·백업</td><td>가용성/복구</td><td>주기 복구 리허설, RPO/RTO 검증</td><td>암호화 백업·키 보관 분리</td></tr><tr><td>모니터링</td><td>락/데드락/지연</td><td>조기 탐지</td><td>p95 지연·락 대기·데드락율 경보</td><td>SLO 연결, 자동 진단</td></tr><tr><td>규정</td><td>GDPR/PCI/SOX</td><td>규제 대응</td><td>데이터 분류, 보존/삭제, 키관리·감사</td><td>Legal Hold/주권 데이터</td></tr></tbody></table><p>ACID 보증을 안전하게 운영하려면 <strong>권한·암호화·감사 불변성</strong>이 기본이고, 여기에 <strong>키관리·데이터 분류·보존/삭제·DR/BCP</strong>가 더해져야 완성된다. GDPR/PCI/SOX 등 규제는 ACID 자체와 충돌하지 않지만, <strong>삭제권·보존·감사</strong> 요구와의 균형을 정책과 기술 (키 삭제·마스킹·WORM) 로 풀어야 한다. 운영에서는 <strong>락/데드락·지연·복구 가능성</strong>을 지표로 상시 관찰해 품질을 유지하는 게 핵심이다.</p><h4 id=모니터링-및-관측성>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>정의/설명</th><th>활용 목적</th><th>예시</th></tr></thead><tbody><tr><td>메트릭</td><td>TPS</td><td>초당 트랜잭션 처리 수</td><td>처리량 모니터링</td><td><code>pg_stat_database.xact_commit</code></td></tr><tr><td>메트릭</td><td>커밋/롤백 비율</td><td>커밋 대비 롤백 비율</td><td>트랜잭션 안정성 평가</td><td>모니터링 대시보드</td></tr><tr><td>메트릭</td><td>데드락 수</td><td>단위 시간당 데드락 발생 건수</td><td>동시성 병목 탐지</td><td><code>pg_stat_database.deadlocks</code></td></tr><tr><td>메트릭</td><td>락 대기 시간</td><td>트랜잭션 락 획득까지 걸린 평균 시간</td><td>경합도 측정</td><td>Wait Event 분석</td></tr><tr><td>메트릭</td><td>평균 응답 시간</td><td>트랜잭션 완료까지 평균 시간</td><td>SLA 준수 여부 평가</td><td>APM 도구</td></tr><tr><td>메트릭</td><td>체크포인트 시간</td><td>체크포인트 수행에 소요되는 시간</td><td>복구 성능 최적화</td><td>DB 로그</td></tr><tr><td>메트릭</td><td>WAL 쓰기 대기</td><td>WAL flush/fsync 대기 시간</td><td>지속성 병목 확인</td><td>I/O 모니터링</td></tr><tr><td>메트릭</td><td>IOPS</td><td>읽기/쓰기 초당 I/O 횟수</td><td>스토리지 성능 모니터링</td><td>OS/스토리지 모니터</td></tr><tr><td>메트릭</td><td>활성 스냅샷 수</td><td>MVCC 활성 버전 개수</td><td>장기 트랜잭션 감지</td><td>MVCC 통계</td></tr><tr><td>로깅</td><td>슬로우 쿼리</td><td>실행 시간 초과 쿼리 기록</td><td>성능 병목 SQL 식별</td><td>slow query log</td></tr><tr><td>로깅</td><td>데드락 그래프</td><td>데드락 발생 시 자원 대기 그래프</td><td>원인 분석</td><td>DBMS deadlock log</td></tr><tr><td>로깅</td><td>구조화된 로그</td><td>JSON 등 파싱 가능한 로그 포맷</td><td>자동 분석 파이프라인</td><td>ELK, Loki</td></tr><tr><td>로깅</td><td>복구 이벤트</td><td>Crash recovery 시작/종료 기록</td><td>장애 대응 속도 향상</td><td>DB 로그</td></tr><tr><td>추적</td><td>분산 추적</td><td>트랜잭션 흐름 전 서비스 추적</td><td>마이크로서비스 병목 파악</td><td>OpenTelemetry</td></tr><tr><td>경보</td><td>임계치 알림</td><td>메트릭이 기준 초과 시 알림</td><td>실시간 대응</td><td>Slack, PagerDuty</td></tr><tr><td>분석</td><td>Wait Events</td><td>CPU/I/O/Lock 대기 원인 분류</td><td>병목 구체화</td><td>Oracle v$session, pg_stat_activity</td></tr><tr><td>분석</td><td>락 경합률</td><td>락 타입별 경합 비율</td><td>동시성 최적화</td><td>락 모니터링 툴</td></tr></tbody></table><p>모니터링 및 관측성은 단순 성능 측정이 아니라 <strong>장애 예방·원인 분석·실시간 대응</strong>을 가능하게 하는 체계이다.</p><p>핵심 요소는 다음 세 가지이다.</p><ol><li><strong>정량 메트릭</strong> → TPS, 응답 시간, 락 대기, WAL 대기, IOPS 등 처리·지속성·동시성 관련 지표를 수집.</li><li><strong>정성 로깅</strong> → 구조화된 로그, 슬로우 쿼리, 데드락 그래프, 복구 이벤트 등 원인 파악에 필요한 데이터 확보.</li><li><strong>실시간 추적·경보</strong> → 분산 추적, Wait Events 분석, 임계치 알림을 통한 즉각 대응.</li></ol><p>이렇게 구성하면 DBMS 의 ACID 보장 성능을 장기적으로 안정화시키고, 병목과 장애를 신속하게 해결할 수 있다.</p><h4 id=실무-적용-고려사항-및-주의점>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점>#</a></h4><table><thead><tr><th>카테고리</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>성능</td><td>트랜잭션 크기 최적화</td><td>긴 트랜잭션은 락 경합·성능 저하 유발</td><td>1,000 개 이하 연산, 배치 처리, 그룹 커밋 활용</td></tr><tr><td>성능</td><td>적절한 격리 수준</td><td>과도한 격리는 성능 저하</td><td>기본 READ COMMITTED, 필요 시만 상향</td></tr><tr><td>동시성·격리성</td><td>데드락 방지</td><td>순환 대기로 인한 무한 대기</td><td>락 순서 표준화, 타임아웃 설정</td></tr><tr><td>동시성·격리성</td><td>Lock 경합 완화</td><td>락 점유 최소화</td><td>MVCC, Optimistic Lock 사용</td></tr><tr><td>가용성·장애 대응</td><td>장애 복구</td><td>시스템 다운 시 신속 복구</td><td>WAL, 체크포인트, 자동 페일오버</td></tr><tr><td>가용성·장애 대응</td><td>로그 관리</td><td>장애 후 복구 기반</td><td>WAL 동기화, 로그 보존 정책</td></tr><tr><td>확장성</td><td>샤딩 전략</td><td>대용량 데이터 분산 처리</td><td>파티션 키 기반 수평 분할</td></tr><tr><td>확장성</td><td>읽기 부하 분산</td><td>마스터 부하 감소</td><td>Read Replica, 로드 밸런싱</td></tr><tr><td>보안</td><td>접근 제어</td><td>불필요 접근 방지</td><td>RBAC, 최소 권한 원칙</td></tr><tr><td>보안</td><td>감사 로깅</td><td>변경 사항 추적</td><td>Audit Log, 변경 이력 관리</td></tr><tr><td>분산 트랜잭션</td><td>분산 환경 복잡성</td><td>네트워크 지연·부분 실패 가능</td><td>로컬 트랜잭션 우선, SAGA, Outbox 패턴</td></tr></tbody></table><ul><li><strong>성능</strong>: 트랜잭션 범위와 격리 수준 조정이 핵심이며, 배치·그룹 커밋 활용</li><li><strong>동시성</strong>: 데드락 예방과 락 경쟁 완화가 필수</li><li><strong>가용성</strong>: 장애 복구 자동화와 WAL 기반 로그 관리로 신속 복구</li><li><strong>확장성</strong>: 샤딩과 읽기 전용 복제본으로 부하 분산</li><li><strong>보안</strong>: RBAC 와 감사 로깅으로 무결성·컴플라이언스 확보</li><li><strong>분산 트랜잭션</strong>: 로컬 우선, 필요 시 분산 트랜잭션 패턴 활용해 안정성 보장</li></ul><h5 id=단일-db-vs-분산-db-환경에서의-acid-속성별-설계-변화-및-대안-패턴-비교>단일 DB Vs 분산 DB 환경에서의 ACID 속성별 설계 변화 및 대안 패턴 비교<a hidden class=anchor aria-hidden=true href=#단일-db-vs-분산-db-환경에서의-acid-속성별-설계-변화-및-대안-패턴-비교>#</a></h5><table><thead><tr><th>ACID 속성</th><th>단일 DB 환경</th><th>분산 DB 환경 전환 시 변화</th><th>대안 패턴 / 기술</th><th>적용 사례</th></tr></thead><tbody><tr><td><strong>Atomicity (원자성)</strong></td><td>로컬 트랜잭션으로 모든 연산을 단일 인스턴스에서 원자적으로 실행</td><td>다중 노드에서 원자성 보장 어려움 → 네트워크 장애·부분 실패 가능성</td><td>2PC(이단계 커밋), 3PC, SAGA 패턴, Outbox 패턴</td><td>금융 거래, 글로벌 결제</td></tr><tr><td><strong>Consistency (일관성)</strong></td><td>강한 일관성 보장, DB 제약조건·트리거로 즉시 검증</td><td>노드 간 데이터 동기 지연 발생 → 스키마·규칙 적용 지연 가능성</td><td>Eventual Consistency, CRDT, Conflict Resolution, CQRS</td><td>SNS 피드, 분산 캐시</td></tr><tr><td><strong>Isolation (격리성)</strong></td><td>높은 격리 수준 (RR, S) 사용 가능, 락 기반 제어 용이</td><td>글로벌 트랜잭션에서 높은 격리 수준은 성능 저하·락 경합 증가</td><td>Read Committed + Validation, MVCC, 분산락 (ZooKeeper/Etcd)</td><td>재고 관리, 글로벌 주문</td></tr><tr><td><strong>Durability (지속성)</strong></td><td>WAL, 체크포인트로 커밋 후 데이터 영구 저장</td><td>노드 간 복제 지연, 장애 시 일부 노드 미반영 가능</td><td>동기/비동기 복제, Write-Ahead Log, Raft/Paxos 합의</td><td>CockroachDB, Spanner</td></tr></tbody></table><ul><li><strong>원자성</strong>: 단일 DB 에서는 로컬 트랜잭션으로 해결되지만, 분산 DB 는 네트워크·노드 장애에 대응 가능한 <strong>분산 트랜잭션 패턴</strong>이 필수</li><li><strong>일관성</strong>: 분산 환경에서는 강한 일관성 대신 <strong>최종 일관성 모델</strong>이나 <strong>충돌 해결 전략</strong>을 더 자주 채택</li><li><strong>격리성</strong>: Serializable 유지 비용이 크므로 <strong>낮은 격리 수준 + 검증 로직</strong>으로 절충</li><li><strong>지속성</strong>: 분산 환경에서는 <strong>합의 알고리즘</strong>과 <strong>복제 전략</strong>이 핵심 설계 요소</li></ul><h5 id=단일-db-vs-분산-db-환경별-실무-적용-차이>단일 DB Vs 분산 DB 환경별 실무 적용 차이<a hidden class=anchor aria-hidden=true href=#단일-db-vs-분산-db-환경별-실무-적용-차이>#</a></h5><table><thead><tr><th>카테고리</th><th>고려사항</th><th>단일 DB 환경 적용 방식</th><th>분산 DB 환경 전환 시 변화</th><th>권장 대안 패턴/전략</th></tr></thead><tbody><tr><td>성능</td><td>트랜잭션 크기 최적화</td><td>단일 인스턴스 내에서 긴 트랜잭션도 성능 영향이 비교적 예측 가능</td><td>네트워크 지연·복제 지연으로 긴 트랜잭션 성능 저하 심화</td><td>트랜잭션 단위 축소, 배치 처리, 그룹 커밋</td></tr><tr><td>성능</td><td>적절한 격리 수준</td><td>READ COMMITTED 또는 REPEATABLE READ 사용 가능</td><td>글로벌 격리 보장 시 지연·충돌 증가</td><td>지역별 낮은 격리 수준 + 중요 경로만 강한 격리</td></tr><tr><td>동시성·격리성</td><td>데드락 방지</td><td>로컬 락 순서 규약, 타임아웃으로 관리 가능</td><td>분산 락 관리가 복잡, 네트워크 장애로 교착 탐지 지연</td><td>글로벌 락 최소화, 로컬 리소스 우선 접근</td></tr><tr><td>동시성·격리성</td><td>Lock 경합 완화</td><td>MVCC, Optimistic Lock 적용 쉬움</td><td>복제 지연 시 Stale Read 발생 가능</td><td>버전 기반 동시성 제어, Conflict Resolution 로직</td></tr><tr><td>가용성·장애 대응</td><td>장애 복구</td><td>WAL + 체크포인트로 단일 노드 복구</td><td>다중 노드 장애·네트워크 분할 시 일관성 깨질 위험</td><td>멀티리전 복제 + 자동 페일오버, DR(재해 복구) 계획</td></tr><tr><td>가용성·장애 대응</td><td>로그 관리</td><td>단일 로그 스트림 관리 용이</td><td>각 노드 로그 동기화 필요, 복구 시 순서 보장 문제</td><td>글로벌 시퀀스 넘버, 분산 로그 관리 시스템</td></tr><tr><td>확장성</td><td>샤딩 전략</td><td>필요 시 수평 확장, 비교적 단순</td><td>필수적, 키 설계 실패 시 불균형 샤드·Hotspot 발생</td><td>파티션 키 설계, 리밸런싱 자동화</td></tr><tr><td>확장성</td><td>읽기 부하 분산</td><td>Read Replica 로 즉시 부하 감소</td><td>리플리카 지연 (Replication Lag) 으로 최신성 저하</td><td>읽기 - 쓰기 분리 + Cache/TTL 기반 접근</td></tr><tr><td>보안</td><td>접근 제어</td><td>중앙 집중형 RBAC 적용 용이</td><td>다중 노드에서 권한 동기화 필요</td><td>중앙 인증 서비스, JWT/OAuth 기반</td></tr><tr><td>보안</td><td>감사 로깅</td><td>단일 로그로 변경 추적</td><td>분산 로그 취합·정렬 필요</td><td>중앙 로깅/분석 플랫폼 (ELK, OpenSearch)</td></tr><tr><td>분산 트랜잭션</td><td>분산 환경 복잡성</td><td>필요 시 XA/2PC 적용 가능</td><td>네트워크 지연, 부분 실패 시 복잡성 급증</td><td>SAGA 패턴, Outbox/Inbox, 이벤트 소싱</td></tr></tbody></table><ul><li><strong>성능 측면</strong>: 분산 환경에서는 네트워크 지연과 복제 지연이 핵심 병목 → 트랜잭션 단위 최소화 필수</li><li><strong>동시성 측면</strong>: 단일 DB 에서는 비교적 단순하지만, 분산 환경에서는 락/버전 관리가 복잡</li><li><strong>가용성 측면</strong>: 단일 노드 복구보다 분산 환경의 다중 노드 복구·네트워크 분할 대응이 훨씬 어려움</li><li><strong>확장성 측면</strong>: 단일 DB 에서는 옵션이지만, 분산 환경에서는 필수 과제</li><li><strong>보안 측면</strong>: 권한·로그 관리가 단일 DB 보다 훨씬 복잡하며 중앙화된 관리 체계 필요</li><li><strong>분산 트랜잭션</strong>: 2PC/3PC 성능·복잡성 문제로 SAGA, 이벤트 소싱 등 대안 필요</li></ul><h4 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h4><table><thead><tr><th>카테고리</th><th>최적화 방법</th><th>구현 전략</th><th>권장사항</th></tr></thead><tbody><tr><td>락킹·동시성 최적화</td><td>락 범위 최소화</td><td>Row-level Lock, Gap Lock 최적화</td><td>필요한 자원만 잠금, 커버링 인덱스로 범위 축소</td></tr><tr><td></td><td>데드락 방지</td><td>락 순서 표준화, Lock Timeout</td><td>리소스 접근 순서 규약화, 타임아웃 기본값 설정</td></tr><tr><td></td><td>MVCC 활용</td><td>Snapshot Isolation, Versioning</td><td>읽기 집약적 환경에서 활용</td></tr><tr><td>로깅·복구 최적화</td><td>WAL I/O 경감</td><td>비동기/배치 쓰기, 그룹 커밋</td><td>지연 허용 범위 내에서 설정</td></tr><tr><td></td><td>로그 관리 최적화</td><td>로그 압축, 주기적 아카이빙</td><td>장기 보관 로그는 별도 스토리지</td></tr><tr><td>인덱스·쿼리 최적화</td><td>인덱스 설계</td><td>외래키, 조인 컬럼, 복합 인덱스</td><td>커버링 인덱스 적극 활용</td></tr><tr><td>버퍼링·메모리 관리</td><td>버퍼 풀 최적화</td><td>워킹셋 기반 크기 조정</td><td>모니터링 기반 동적 조정</td></tr><tr><td>트랜잭션 구조 최적화</td><td>트랜잭션 분리</td><td>마이크로 트랜잭션 설계</td><td>짧은 트랜잭션 유지, 경합 최소화</td></tr><tr><td>비동기·확장성 전략</td><td>비동기 처리</td><td>메시지 큐, 이벤트 소싱</td><td>실시간성 낮은 작업 위임</td></tr><tr><td></td><td>읽기 - 쓰기 분리</td><td>Read Replica 활용</td><td>최신성 요구에 따라 TTL 설정</td></tr><tr><td>운영·모니터링 관리</td><td>성능·락 모니터링</td><td>데드락 감지, 쿼리 분석</td><td>실시간 대시보드, 알람 연계</td></tr><tr><td></td><td>체크포인트 관리</td><td>주기적 체크포인트</td><td>복구 시간과 성능 균형 유지</td></tr></tbody></table><ul><li><strong>락킹 최적화</strong>: 범위 최소화와 데드락 방지가 성능·안정성 모두에 필수</li><li><strong>로깅 최적화</strong>: WAL I/O 를 줄이는 비동기·배치 전략이 큰 성능 향상</li><li><strong>인덱스 전략</strong>: 커버링 인덱스와 복합 인덱스로 락 경합과 I/O 비용 동시 절감</li><li><strong>메모리 관리</strong>: 워킹셋 기반 버퍼링으로 캐시 히트율 향상</li><li><strong>트랜잭션 구조</strong>: 짧고 단순한 트랜잭션이 동시성 극대화</li><li><strong>비동기 처리</strong>: 실시간성이 낮은 작업은 메시지 큐로 분리</li><li><strong>운영 관리</strong>: 실시간 모니터링·체크포인트 주기로 장애 복구 속도 확보</li></ul><h5 id=acid-속성별-단일-db-vs-분산-db-환경-최적화-포인트>ACID 속성별 단일 DB Vs 분산 DB 환경 최적화 포인트<a hidden class=anchor aria-hidden=true href=#acid-속성별-단일-db-vs-분산-db-환경-최적화-포인트>#</a></h5><table><thead><tr><th>속성</th><th>단일 DB 최적화 포인트</th><th>분산 DB 최적화 포인트</th><th>차이·설계 변화</th></tr></thead><tbody><tr><td><strong>Atomicity (원자성)</strong></td><td>- WAL 그룹 커밋으로 트랜잭션 단위 보장<br>- 짧은 락 유지로 롤백 비용 최소화</td><td>- 글로벌 트랜잭션 최소화, 로컬 트랜잭션 우선<br>- Saga 패턴·보상 트랜잭션 설계</td><td>분산은 2PC/3PC 지연과 실패 가능성이 크므로 <strong>원자성 보장보다 부분적 보상 전략</strong>이 실무적</td></tr><tr><td><strong>Consistency (일관성)</strong></td><td>- 제약조건·트리거 활용<br>- 단일 스키마·단일 타임라인 유지</td><td>- Eventually Consistency 설계<br>- CQRS 로 읽기/쓰기 경로 분리<br>- 글로벌 일관성 필요한 경우 Spanner 등 선택</td><td>분산은 네트워크 파티션 시 강한 일관성 유지 비용이 커서 <strong>최종 일관성 허용</strong>이 유리</td></tr><tr><td><strong>Isolation (고립성)</strong></td><td>- MVCC 활용, 락 범위 최소화<br>- READ COMMITTED/REPEATABLE READ 조정</td><td>- 노드별 격리 수준 유지<br>- 글로벌 락 회피, 로컬 격리 + 보상 처리</td><td>분산에서는 글로벌 격리 유지 비용이 매우 커서 <strong>로컬 수준 격리 + 트랜잭션 설계로 보완</strong></td></tr><tr><td><strong>Durability (지속성)</strong></td><td>- WAL 동기화 튜닝, 체크포인트 주기 최적화<br>- 배터리 백업 캐시 사용</td><td>- 각 노드 로컬 WAL + 비동기 복제<br>- 합의 기반 (Consensus) 로그 복제 최소화</td><td>분산은 지속성 보장이 네트워크 합의에 의존하므로 <strong>복제 지연과 안정성 균형</strong> 필요</td></tr></tbody></table><ul><li><strong>Atomicity</strong>: 단일 DB 는 빠른 커밋/롤백 중심, 분산 DB 는 보상 트랜잭션 중심</li><li><strong>Consistency</strong>: 단일 DB 는 강한 일관성 유지, 분산 DB 는 최종 일관성과 CQRS 활용</li><li><strong>Isolation</strong>: 단일 DB 는 격리 수준 조정, 분산 DB 는 글로벌 락 최소화</li><li><strong>Durability</strong>: 단일 DB 는 로컬 I/O 최적화, 분산 DB 는 복제·합의 비용 최적화</li></ul><h3 id=고급-주제-advanced-topics>고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#고급-주제-advanced-topics>#</a></h3><h4 id=현재-도전-과제>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제>#</a></h4><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>해결방안</th></tr></thead><tbody><tr><td>분산 환경 및 글로벌 확장성</td><td>글로벌 환경에서 ACID 유지</td><td>CAP 정리에 따른 일관성 - 가용성 트레이드오프, 2PC 지연</td><td>글로벌 지연, 가용성 저하, 운영 복잡성 증가</td><td>지역별 ACID + 글로벌 eventual consistency, SAGA/Outbox</td></tr><tr><td>클라우드 네이티브 / 마이크로서비스</td><td>분산 트랜잭션 복잡성</td><td>서비스 간 트랜잭션 경계 복잡, SSI 운영 난이도</td><td>장애 대응 복잡성, 성능 저하</td><td>이벤트 소싱, CQRS, 트랜잭션 경계 최소화</td></tr><tr><td>실시간 및 대용량 데이터 처리</td><td>ACID 보장에 따른 지연</td><td>대용량 데이터 락 경합, 메모리 부담</td><td>실시간 응답 저하, 배치 지연</td><td>읽기 복제본, 파티셔닝/샤딩, 병렬 처리, 비동기 ACID</td></tr><tr><td>스토리지·내구성 및 규제 대응</td><td>내구성과 지연의 균형, 규제 준수</td><td>멀티 AZ/리전 WAL 동기화 지연, 규제 감사 요구</td><td>데이터 복제 비용 증가, 법적 리스크</td><td>지연 허용 기반 스토리지 정책, 안정적 스토리지 계층, 감사 로깅</td></tr></tbody></table><ul><li><strong>분산 환경 및 글로벌 확장성</strong>: CAP 한계를 극복하려면 지역적 강한 일관성과 글로벌 eventual consistency 를 혼합해야 함.</li><li><strong>클라우드 네이티브 / 마이크로서비스</strong>: 트랜잭션 경계를 최소화하고 보상 트랜잭션 패턴을 적극 활용해야 안정성 확보 가능.</li><li><strong>실시간 및 대용량 데이터 처리</strong>: 읽기 복제본·샤딩·비동기화를 통한 지연 완화가 핵심.</li><li><strong>스토리지·내구성 및 규제 대응</strong>: 내구성 보장과 성능 사이의 균형 설계, 규제 준수 로깅 체계 필수.</li></ul><h4 id=생태계-및-관련-기술>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술>#</a></h4><table><thead><tr><th>카테고리</th><th>기술/제품</th><th>ACID 연계 역할</th><th>핵심 포인트</th><th>적용 예</th></tr></thead><tbody><tr><td>표준/프로토콜</td><td>ANSI/ISO SQL 격리, XA/2PC, MVCC</td><td>격리 규격·분산 커밋 규정</td><td>RC/RR/Serializable 의미론, 2PC 준비·커밋</td><td>다중 서비스 커밋, 은행 이체</td></tr><tr><td>엔진/메커니즘</td><td>PostgreSQL(MVCC/SSI), MySQL InnoDB(MVCC+2PL), ARIES/WAL</td><td>동시성·복구의 코어</td><td>스냅샷 읽기, 로그 선기록, Analysis/Redo/Undo</td><td>주문·결제, 원장 시스템</td></tr><tr><td>코디네이션/합의</td><td>ZooKeeper/etcd, Raft/Paxos</td><td>리더·락·메타 일관성</td><td>상태·메타데이터의 강 일관성, 장애 복구</td><td>분산 락, 클러스터 메타</td></tr><tr><td>메시징/이벤트</td><td>Kafka, RabbitMQ, Outbox+CDC</td><td>트랜잭션 이벤트 전달</td><td>정확히 한 번 근사, 멱등키·리트라이</td><td>주문 이벤트, 사가 오케스트레이션</td></tr><tr><td>캐싱/세션</td><td>Redis, Memcached</td><td>읽기 성능·세션 일관</td><td>캐시 무효화/TTL, 토큰화</td><td>재고 조회, 세션 공유</td></tr><tr><td>관측/운영</td><td>Prometheus, Grafana, CDC/Audit</td><td>무결성·성능 가시화</td><td>WAL LSN 라그, 락/데드락율, CDC 감사</td><td>SLA 모니터링, 컴플라이언스</td></tr><tr><td>패턴/아키텍처</td><td>SAGA, TCC, Idempotency Key, Transactional Outbox</td><td>2PC 대안</td><td>보상 플로우/멱등성으로 최종 일관</td><td>마이크로서비스 주문·환불</td></tr><tr><td>이론/모델</td><td>BASE, CAP</td><td>설계 판단 기준</td><td>가용성·지연 vs 일관성 트레이드오프</td><td>글로벌 분산 설계</td></tr><tr><td>Lakehouse ACID</td><td>Delta, Iceberg, Hudi</td><td>테이블 레벨 ACID</td><td>스냅샷/메타 로그, 멀티 라이터 제어</td><td>배치 + 스트리밍 동시 처리</td></tr></tbody></table><p>ACID 를 실무에서 제대로 보장하려면 ** 엔진 내부 (MVCC/WAL/복구)** 에 더해, ** 분산 합의·메시징·패턴 (SAGA/Outbox)** 이 함께 설계되어야 한다. 단일 DB 에선 2PL/MVCC 로 충분하지만, 마이크로서비스·글로벌 분산에선 <strong>2PC 비용</strong>이 커지므로 <strong>보상·멱등</strong>으로 일관성을 달성하는 구성이 현실적이다. 데이터 레이크하우스 환경도 <strong>트랜잭션 테이블 포맷</strong>으로 ACID 를 확장해 배치·스트리밍 동시 운영을 안전하게 만든다.</p><h4 id=최신-기술-트렌드와-미래-방향>최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드와-미래-방향>#</a></h4><table><thead><tr><th>카테고리</th><th>핵심 트렌드</th><th>주요 기술/패턴</th><th>기대 효과</th><th>제약/주의</th><th>대표 적용</th></tr></thead><tbody><tr><td>분산 ACID/글로벌 트랜잭션</td><td>멀티리전 직렬성·하이브리드 일관성</td><td>Raft/Paxos, TrueTime/HLC, 지리적 파티셔닝</td><td>전세계 일관성, RPO/RTO 개선</td><td>레이턴시·비용 증가, 스키마·트래픽 설계 필요</td><td>Spanner/Cockroach/Yugabyte</td></tr><tr><td>서버리스·마이크로서비스</td><td>트랜잭션 오케스트레이션</td><td>SAGA/TCC, Outbox, Idempotency, Step Functions/Workflows</td><td>결합도↓, 실패 격리, 운영 단순화</td><td>보상 로직 복잡, 최종 일관성 수용 필요</td><td>결제·주문·예약</td></tr><tr><td>레이크하우스 ACID</td><td>테이블 포맷 ACID</td><td>Delta/ Iceberg/ Hudi, 옵티미스틱 락, 스냅샷/타임트래블</td><td>배치·스트리밍 일원화, 데이터 품질↑</td><td>메타데이터 스케일·병합 비용</td><td>분석 + 실시간 파이프라인</td></tr><tr><td>AI/자율 최적화</td><td>예측·튜닝 자동화</td><td>락/경합 예측, 자동 인덱싱, 이상 트랜잭션 탐지, AIOps</td><td>SLO 안정, 운영비↓</td><td>오탐·데이터 드리프트</td><td>금융·커머스</td></tr><tr><td>블록체인 연계</td><td>온·오프체인 콤포저블</td><td>온체인 결제/영수증 + 오프체인 OLTP, 크립토 영수증</td><td>불변성·감사 추적, 결제 신뢰</td><td>지연·수수료·브리지 리스크</td><td>정산·디지털 자산</td></tr><tr><td>인프라 가속</td><td>로그·복제 최적화</td><td>그룹 커밋, WAL 압축, 비동기/선택적 동기복제, NVMe/RDMA</td><td>TPS↑, 지연↓</td><td>강한 내구성과의 트레이드오프</td><td>고 TPS OLTP</td></tr><tr><td>보안·거버넌스</td><td>정책·감사 자동화</td><td>데이터 주권, 리전 경계, OTel 트레이싱, KMS/HSM</td><td>규제 준수, 사고 대응력↑</td><td>멀티리전 정책 복잡</td><td>규제 산업</td></tr></tbody></table><ul><li><strong>분산 SQL 과 레이크하우스 ACID 가 주류</strong>로 정착, 트랜잭션은 <strong>오케스트레이션/보상 패턴</strong>과 결합.</li><li><strong>AI 기반 운영 자동화</strong>와 <strong>인프라 가속</strong>이 SLO 를 뒷받침.</li><li><strong>보안·거버넌스</strong>와 <strong>데이터 주권</strong> 요구가 설계 초기에 반영되는 것이 2025 년의 기본값.</li></ul><h4 id=acid-vs-base-비교>ACID vs. BASE 비교<a hidden class=anchor aria-hidden=true href=#acid-vs-base-비교>#</a></h4><table><thead><tr><th>구분</th><th>ACID 모델</th><th>BASE 모델</th></tr></thead><tbody><tr><td>전체 의미</td><td><strong>Atomicity, Consistency, Isolation, Durability</strong>–트랜잭션의 완전성과 무결성을 보장</td><td><strong>Basically Available, Soft State, Eventually Consistent</strong>–가용성과 확장성을 극대화</td></tr><tr><td>목적</td><td>데이터 무결성·신뢰성 유지</td><td>가용성·성능·확장성 최우선</td></tr><tr><td>일관성</td><td><strong>강한 일관성 (Strong Consistency)</strong>–즉각적이고 전역적으로 동일한 데이터 보장</td><td><strong>최종적 일관성 (Eventual Consistency)</strong>–시간 경과 후 일관성 회복</td></tr><tr><td>장애 시 동작</td><td>트랜잭션 단위 전부 롤백 또는 전부 커밋</td><td>일부 데이터 반영 후 나중에 동기화</td></tr><tr><td>주 활용 환경</td><td>금융, 회계, 주문·결제, 재고, 컴플라이언스 필수 업무</td><td>소셜 피드, 로그 수집, 캐시 시스템, 대규모 분산 분석</td></tr><tr><td>대표 기술</td><td>PostgreSQL, Oracle, MySQL InnoDB, Google Spanner</td><td>Cassandra, Amazon DynamoDB, Couchbase, Redis(비동기 복제)</td></tr><tr><td>장점</td><td>데이터 신뢰성, 무결성, 장애 복구 용이</td><td>대규모 트래픽 처리, 가용성 높음, 지연 최소화</td></tr><tr><td>단점</td><td>확장성·성능 저하</td><td>데이터 잠시 불일치 허용, 비즈니스 로직이 복잡</td></tr></tbody></table><h5 id=선택-의사결정-매트릭스-업무-시나리오별-추천>선택 의사결정 매트릭스 (업무 시나리오별 추천)<a hidden class=anchor aria-hidden=true href=#선택-의사결정-매트릭스-업무-시나리오별-추천>#</a></h5><table><thead><tr><th>조건</th><th>데이터 정확성 중요도</th><th>응답 속도 요구</th><th>시스템 규모</th><th>추천 모델</th></tr></thead><tbody><tr><td>결제/이체</td><td>매우 높음</td><td>중간</td><td>중간~대형</td><td><strong>ACID</strong></td></tr><tr><td>재고 관리</td><td>높음</td><td>중간</td><td>대형</td><td><strong>ACID 우선</strong>, 특정 로그·분석은 BASE</td></tr><tr><td>소셜 피드</td><td>낮음</td><td>매우 높음</td><td>초대형</td><td><strong>BASE</strong></td></tr><tr><td>로그 수집</td><td>낮음</td><td>높음</td><td>초대형</td><td><strong>BASE</strong></td></tr><tr><td>글로벌 데이터 분석</td><td>중간</td><td>중간</td><td>초대형</td><td><strong>BASE + 이벤트 정합성 보정</strong></td></tr><tr><td>멀티리전 결제</td><td>매우 높음</td><td>낮음 허용</td><td>초대형 분산</td><td><strong>ACID (글로벌 일관성 보장 시스템)</strong></td></tr></tbody></table><ul><li><strong>업무상 데이터 불일치가 법적·금전적 피해를 초래 → ACID 필수</strong></li><li><strong>일시적 불일치를 허용하고 대규모 분산 처리·가용성이 핵심 → BASE 선택</strong></li><li>하이브리드 전략: 핵심 데이터 경로는 ACID, 비핵심 경로는 BASE 적용</li></ul><h5 id=실제-하이브리드-적용-아키텍처-예시-acid--base-혼합>실제 하이브리드 적용 아키텍처 예시 (ACID + BASE 혼합)<a hidden class=anchor aria-hidden=true href=#실제-하이브리드-적용-아키텍처-예시-acid--base-혼합>#</a></h5><pre class=mermaid>graph LR
    subgraph Critical-Path
    A1[주문·결제 서비스] --&gt; DB_ACID[(PostgreSQL - ACID 작성)]
    end
    
    subgraph NonCritical-Path
    A2[추천·로그 서비스] --&gt; DB_BASE[(Cassandra - BASE 처리)]
    end

    Client --&gt; A1
    Client --&gt; A2
    A1 --&gt; Kafka[이벤트 브로커]
    Kafka --&gt; A2
</pre><ul><li><strong>Critical Path(핵심 경로)</strong>: ACID 기반 시스템 → 데이터 무결성 필수 보장</li><li><strong>Non-Critical Path(비핵심 경로)</strong>: BASE 기반 시스템 → 고성능·고가용성 확보</li><li><strong>이벤트 브로커 (Kafka)</strong>: 두 경로를 분리하되, 데이터 흐름을 느슨하게 연결</li></ul><h4 id=acid-vs-isolation-level-매핑>ACID vs. Isolation Level 매핑<a hidden class=anchor aria-hidden=true href=#acid-vs-isolation-level-매핑>#</a></h4><table><thead><tr><th>Isolation Level</th><th>Atomicity</th><th>Consistency</th><th>Isolation</th><th>Durability</th><th>설명</th></tr></thead><tbody><tr><td>Read Uncommitted</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>Dirty read 허용</td></tr><tr><td>Read Committed</td><td>✅</td><td>✅</td><td>⚠️</td><td>✅</td><td>Non-repeatable read 가능</td></tr><tr><td>Repeatable Read</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>Phantom read 가능</td></tr><tr><td>Serializable</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>완전한 격리 보장</td></tr></tbody></table><blockquote><p>⚠️: 일부 anomaly 허용</p></blockquote><h5 id=isolation-level-별-동시성-오류-실습>Isolation Level 별 동시성 오류 실습<a hidden class=anchor aria-hidden=true href=#isolation-level-별-동시성-오류-실습>#</a></h5><p>이 실습의 목적은 <strong>ACID 중 Isolation</strong> 특성이 충분히 지켜지지 않을 때 발생하는 전형적인 동시성 문제를 직접 재현하는 것.<br>PostgreSQL 같은 ACID 준수 DB 에서 Isolation Level 을 변경하며 테스트하면 체감이 크다.</p><p><strong>실습 시나리오</strong>:</p><ul><li><strong>환경</strong>: PostgreSQL, Python(psycopg2 사용), 두 개의 세션 (트랜잭션) 동시 실행</li><li><strong>목표</strong>: Isolation Level 변경에 따른 Dirty Read, Non-repeatable Read, Phantom Read 체험</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    Client1[세션 1] --&gt; DB[PostgreSQL]
    Client2[세션 2] --&gt; DB
    DB --&gt; Storage[(데이터저장소)]
</pre><p><strong>코드 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17>17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18>18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19>19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20>20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21>21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22>22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23>23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24>24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25>25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26>26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27>27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28>28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29>29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30>30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31>31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32>32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33>33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34>34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35>35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36>36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37>37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38>38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39>39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># DB 연결 함수</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_conn</span><span class=p>(</span><span class=n>isolation_level</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;dbname=test user=postgres password=1234 host=localhost&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>set_session</span><span class=p>(</span><span class=n>isolation_level</span><span class=o>=</span><span class=n>isolation_level</span><span class=p>,</span> <span class=n>autocommit</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>conn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 세션 1: 데이터 읽기(Dirty Read / Non-repeatable Read 확인)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>session1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>get_conn</span><span class=p>(</span><span class=s1>&#39;READ UNCOMMITTED&#39;</span><span class=p>)</span>  <span class=c1># 낮은 격리 수준</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT balance FROM accounts WHERE id = 1;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[세션1] 초기 읽기:&#34;</span><span class=p>,</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT balance FROM accounts WHERE id = 1;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[세션1] 2차 읽기:&#34;</span><span class=p>,</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 세션 2: 데이터 수정 후 롤백</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>session2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>get_conn</span><span class=p>(</span><span class=s1>&#39;READ UNCOMMITTED&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE accounts SET balance = balance + 500 WHERE id = 1;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[세션2] 잔액 변경(아직 COMMIT 안 함)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[세션2] 롤백 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행</span>
</span></span><span class=line><span class=cl><span class=n>t1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>session1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>t2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>session2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>t2</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>t1</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>t2</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Isolation Level 을 <code>READ UNCOMMITTED</code> 로 설정 → Dirty Read 가능</li><li>세션 1 이 첫 번째 읽기 후, 세션 2 에서 값을 변경하고 커밋 전 Dirty Read 발생</li><li>세션 2 가 롤백하면, 세션 1 이 읽었던 값은 실제 DB 에 존재하지 않는 " 더러운 데이터 " 가 됨</li></ul><h4 id=분산-트랜잭션과-cap-이론-연결>분산 트랜잭션과 CAP 이론 연결<a hidden class=anchor aria-hidden=true href=#분산-트랜잭션과-cap-이론-연결>#</a></h4><h5 id=cap-이론이란>CAP 이론이란?<a hidden class=anchor aria-hidden=true href=#cap-이론이란>#</a></h5><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>C (Consistency)</strong></td><td>모든 노드에서 같은 데이터를 반환</td></tr><tr><td><strong>A (Availability)</strong></td><td>클라이언트 요청에 항상 응답 가능</td></tr><tr><td><strong>P (Partition Tolerance)</strong></td><td>네트워크 분할 시에도 일부 시스템이 계속 작동 가능</td></tr></tbody></table><blockquote><p>이 세 가지 중 <strong>분산 시스템은 동시에 두 개만 보장</strong>할 수 있음 (CAP 정리)</p></blockquote><h5 id=acid-트랜잭션과-cap-대응-관계>ACID 트랜잭션과 CAP 대응 관계<a hidden class=anchor aria-hidden=true href=#acid-트랜잭션과-cap-대응-관계>#</a></h5><table><thead><tr><th>ACID 속성</th><th>CAP 대응 항목</th><th>설명</th></tr></thead><tbody><tr><td>Consistency</td><td>C</td><td>모든 트랜잭션 후 DB 가 유효한 상태로 유지됨</td></tr><tr><td>Durability</td><td>A / P</td><td>시스템 장애 후에도 결과 유지</td></tr><tr><td>Isolation</td><td>C / A</td><td>동시 트랜잭션 충돌 방지, 응답 지연 가능성</td></tr><tr><td>Atomicity</td><td>C</td><td>실패 시 전체 작업 취소하여 일관성 유지</td></tr></tbody></table><h5 id=분산-트랜잭션에서의-선택-사례>분산 트랜잭션에서의 선택 사례<a hidden class=anchor aria-hidden=true href=#분산-트랜잭션에서의-선택-사례>#</a></h5><table><thead><tr><th>시스템</th><th>선택한 2 개</th><th>희생한 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>Zookeeper</strong></td><td>CP</td><td>A</td><td>일관성 우선, 응답이 느릴 수 있음</td></tr><tr><td><strong>Cassandra</strong></td><td>AP</td><td>C</td><td>빠른 응답, Eventually Consistent</td></tr><tr><td><strong>Etcd</strong></td><td>CP</td><td>A</td><td>리더 기반 강한 일관성</td></tr><tr><td><strong>DynamoDB</strong></td><td>AP</td><td>C</td><td>빠르고 가용성 높음, 일관성은 조정 가능</td></tr><tr><td><strong>Spanner (Google)</strong></td><td>CAP 극복 시도</td><td>None</td><td>TrueTime 기반 동기화로 강한 일관성과 분산을 동시에 지향</td></tr></tbody></table><h5 id=2pc-와-cap-연계>2PC 와 CAP 연계<a hidden class=anchor aria-hidden=true href=#2pc-와-cap-연계>#</a></h5><ul><li><strong>2PC(2-Phase Commit)</strong>:<ul><li>C 보장을 위해 동기화 과정 필요 → A 저하 위험</li><li>네트워크 분할 시 트랜잭션 중단 → P 불완전</li></ul></li></ul><pre class=mermaid>sequenceDiagram
  participant Client
  participant NodeA
  participant NodeB

  Client-&gt;&gt;NodeA: prepare()
  NodeA-&gt;&gt;Client: ready
  Client-&gt;&gt;NodeB: prepare()
  NodeB-&gt;&gt;Client: ready
  Client-&gt;&gt;NodeA: commit()
  Client-&gt;&gt;NodeB: commit()
</pre><ul><li><strong>Paxos / Raft 기반 DB</strong> (e.g. Etcd, TiDB) 는 Paxos 기반 합의를 통해 <strong>CP 시스템</strong>을 구현하고 있음.</li></ul><hr><h2 id=종합-정리-및-학습-가이드>종합 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#종합-정리-및-학습-가이드>#</a></h2><h3 id=내용-정리>내용 정리<a hidden class=anchor aria-hidden=true href=#내용-정리>#</a></h3><p>ACID 는 트랜잭션의 <strong>원자성·일관성·격리성·지속성</strong>을 보장해 데이터 정합성과 신뢰성을 담보한다.</p><p>구현은 <strong>WAL/ARIES</strong>로 원자성·지속성을, <strong>2PL 또는 MVCC</strong>로 격리성을 달성하고, <strong>제약조건/트리거</strong>로 일관성을 강화한다.<br>실무에서는 <strong>격리수준 선택</strong>과 <strong>트랜잭션 경계 최소화</strong>, <strong>로그/스토리지 튜닝</strong>이 성능 - 정합성 균형의 관건이다.<br>분산·멀티리전 환경에서는 <strong>합의·시간모델</strong> 또는 <strong>SAGA/이벤트</strong>로 확장하며, <strong>레이크하우스 ACID</strong>는 분석·실시간 파이프라인의 정합성을 끌어올린다.<br>최근에는 <strong>관측성·자율 최적화</strong>와 <strong>보안·거버넌스</strong>가 동등한 설계 축으로 부상했다.</p><table><thead><tr><th>범주</th><th>핵심 내용</th><th>대표 기술/기법</th><th>실무 체크포인트</th></tr></thead><tbody><tr><td>Atomicity(원자성)</td><td>전부 성공/전부 실패 보장, 실패 시 롤백</td><td>WAL/ARIES(UNDO/REDO), Savepoint</td><td>트랜잭션 경계 최소화, 예외 시 일관된 롤백 경로</td></tr><tr><td>Consistency(일관성)</td><td>모든 제약·규칙 충족 상태로만 전이</td><td>FK/Unique/Check, 트리거, 앱 레벨 검증</td><td>스키마·도메인 규칙 일치, 데이터 품질 규칙 자동화</td></tr><tr><td>Isolation(격리성)</td><td>동시 트랜잭션 간 간섭 차단</td><td>2PL, MVCC, ANSI 격리수준</td><td>업무별 격리수준 선택 (RC/RR/Serializable), 경합 모니터링</td></tr><tr><td>Durability(지속성)</td><td>커밋 결과 영구 보존</td><td>WAL fsync, 체크포인트, 복제</td><td>그룹 커밋·스토리지 지연 최적화, 백업·복구 RTO/RPO</td></tr><tr><td>분산 적용</td><td>전역 일관성/지연의 절충</td><td>2PC/XA, Raft/Paxos, TrueTime/HLC</td><td>트래픽·리전 토폴로지 설계, 지연·비용 모델링</td></tr><tr><td>대안/보완</td><td>최종 일관·보상 트랜잭션</td><td>SAGA/TCC, Outbox/Inbox, Idempotency</td><td>보상 로직, 중복처리, 재처리 안전성</td></tr><tr><td>데이터레이크</td><td>테이블 포맷 ACID</td><td>Delta/Iceberg/Hudi</td><td>스냅샷/타임트래블, 머지/컴팩션 비용 관리</td></tr><tr><td>관측성/운영</td><td>병목·경합 가시화/자동화</td><td>OpenTelemetry, eBPF, AIOps</td><td>락/IO·로그 지표, 자동 튜닝·알림 기준</td></tr></tbody></table><h4 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h4><table><thead><tr><th>단계</th><th>기간</th><th>학습 내용</th><th>실습/도구</th><th>목표</th></tr></thead><tbody><tr><td>기초</td><td>1~2 주</td><td>ACID 정의, SQL 트랜잭션 기본 문법, 격리 수준 개념</td><td>단일 DB 실습 (PostgreSQL/MySQL)</td><td>ACID 속성 이해 및 기본 조작 숙지</td></tr><tr><td>중급</td><td>2~3 주</td><td>격리 수준 심화, 락킹/MVCC, WAL 기초, 복구 기초</td><td>WAL 로그 관찰, 장애 복구 테스트</td><td>동시성 제어와 복구 메커니즘 이해</td></tr><tr><td>고급</td><td>3~4 주</td><td>WAL·ARIES, 2PL, SSI, 분산 트랜잭션, CAP/BASE, 설계 패턴 (SAGA, CQRS)</td><td>Docker 분산 환경, Outbox 구현</td><td>분산 환경에서 ACID 구현 능력 확보</td></tr><tr><td>전문가</td><td>지속</td><td>성능 최적화, 모니터링·관측성, 도메인별 설계, 최신 트렌드 (NewSQL, HTAP), 보안·규제 준수</td><td>Prometheus, Grafana, 장애 복구 시나리오</td><td>실무 레벨의 안정적 트랜잭션 설계·운영</td></tr></tbody></table><h4 id=학습-항목-매트릭스>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스>#</a></h4><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>ACID 속성 정의</td><td>필수</td><td>원자성, 일관성, 고립성, 지속성의 개념과 목적</td></tr><tr><td>기초</td><td>1</td><td>트랜잭션 기본 개념</td><td>필수</td><td>BEGIN, COMMIT, ROLLBACK 사용법</td></tr><tr><td>이론</td><td>2</td><td>동시성 제어 메커니즘</td><td>필수</td><td>2PL, MVCC 의 원리와 차이</td></tr><tr><td>이론</td><td>2</td><td>격리 수준·현상</td><td>필수</td><td>4 단계 SQL 격리 수준과 Dirty/NR/Phantom</td></tr><tr><td>이론</td><td>2</td><td>WAL/복구 메커니즘</td><td>필수</td><td>WAL, ARIES 구조와 UNDO/REDO 규칙</td></tr><tr><td>구현</td><td>4</td><td>언어별 구현 실습</td><td>권장</td><td>Java, Python, Node.js 트랜잭션 코드 작성</td></tr><tr><td>구현</td><td>5</td><td>DB 설정·최적화</td><td>권장</td><td>Isolation Level, 인덱스, 커넥션 풀, 배치 처리</td></tr><tr><td>운영</td><td>6</td><td>모니터링·관측성</td><td>권장</td><td>락/데드락, LSN lag, 트랜잭션 메트릭 수집</td></tr><tr><td>운영</td><td>6</td><td>장애 대응·튜닝</td><td>권장</td><td>Deadlock 해소, WAL/체크포인트 최적화</td></tr><tr><td>고급/확장</td><td>7</td><td>분산 ACID</td><td>선택</td><td>2PC, 3PC, 글로벌 일관성 구현</td></tr><tr><td>고급/확장</td><td>7</td><td>CAP vs ACID</td><td>선택</td><td>분산 환경에서의 일관성·가용성 트레이드오프</td></tr><tr><td>고급/확장</td><td>7</td><td>분산 대안 패턴</td><td>선택</td><td>Saga, TCC, Outbox+CDC, 멱등 처리</td></tr><tr><td>고급/확장</td><td>7</td><td>최신 기술 동향</td><td>선택</td><td>Spanner, Delta Lake, Kafka Exactly-once</td></tr></tbody></table><p>ACID 학습은 <strong>기초 → 엔진 메커니즘 → 구현/운영 → 분산/확장</strong> 순서로 계단식 접근이 효율적이다.<br>기초와 이론은 모든 환경에서 필수이며, 구현·운영 단계에서 실무 장애와 튜닝 경험이 중요하다.<br>분산·고급 항목은 규모와 환경에 따라 선택적으로 학습하되, SAGA, CAP/BASE, 최신 ACID 확장 기술은 분산 설계 시 필수 참고 대상이다.</p><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th></tr></thead><tbody><tr><td>핵심 개념</td><td>ACID</td><td>트랜잭션의 4 가지 속성 (원자성·일관성·격리성·지속성)</td><td>데이터 무결성, 신뢰성</td></tr><tr><td>핵심 개념</td><td>Transaction</td><td>하나의 논리적 작업 단위</td><td>BEGIN, COMMIT, ROLLBACK</td></tr><tr><td>핵심 개념</td><td>Commit</td><td>트랜잭션 결과를 영구 저장</td><td>Durability, WAL</td></tr><tr><td>핵심 개념</td><td>Rollback</td><td>트랜잭션 작업을 취소하고 이전 상태로 복원</td><td>Atomicity</td></tr><tr><td>핵심 개념</td><td>Atomicity</td><td>전부 실행되거나 전혀 실행되지 않음</td><td>롤백</td></tr><tr><td>핵심 개념</td><td>Consistency</td><td>트랜잭션 전후 유효 상태 유지</td><td>제약조건</td></tr><tr><td>핵심 개념</td><td>Isolation</td><td>트랜잭션 간 간섭 방지</td><td>격리 수준</td></tr><tr><td>핵심 개념</td><td>Durability</td><td>커밋 결과 영구 보존</td><td>WAL, 복구</td></tr><tr><td>동시성 제어</td><td>Isolation Level</td><td>격리 정도 설정 단계</td><td>READ COMMITTED, SERIALIZABLE</td></tr><tr><td>동시성 제어</td><td>Locking</td><td>공유/배타 락으로 동시성 제어</td><td>Deadlock</td></tr><tr><td>동시성 제어</td><td>MVCC</td><td>다중 버전 스냅샷으로 읽기/쓰기 병행</td><td>Snapshot Read</td></tr><tr><td>동시성 제어</td><td>2PL</td><td>락 획득·해제 단계를 구분하는 프로토콜</td><td>교착상태</td></tr><tr><td>동시성 제어</td><td>Snapshot Isolation</td><td>MVCC 기반의 일관성 보장</td><td>Serializable 대안</td></tr><tr><td>동시성 제어</td><td>Deadlock</td><td>자원 순환 대기로 인한 무한 대기</td><td>락 순서 규약</td></tr><tr><td>복구 및 로그</td><td>WAL</td><td>데이터보다 로그를 먼저 기록</td><td>Durability</td></tr><tr><td>복구 및 로그</td><td>ARIES</td><td>WAL 기반 복구 알고리즘</td><td>LSN</td></tr><tr><td>복구 및 로그</td><td>LSN</td><td>WAL 로그 식별자</td><td>복구 범위 추적</td></tr><tr><td>복구 및 로그</td><td>Checkpoint</td><td>복구 시작점을 단축하는 주기적 기록</td><td>REDO, UNDO</td></tr><tr><td>분산 트랜잭션</td><td>2PC</td><td>분산 환경에서 원자적 커밋 보장</td><td>Coordinator, Participant</td></tr><tr><td>분산 트랜잭션</td><td>XA Protocol</td><td>분산 트랜잭션 표준 인터페이스</td><td>2PC</td></tr><tr><td>분산 트랜잭션</td><td>BASE</td><td>Basically Available, Soft State, Eventual Consistency</td><td>CAP 정리</td></tr><tr><td>분산 트랜잭션</td><td>Eventual Consistency</td><td>시간이 지나면 일관성 회복</td><td>BASE</td></tr><tr><td>분산 트랜잭션</td><td>Partition Tolerance</td><td>네트워크 분리에도 일부 동작 가능</td><td>CAP 정리</td></tr><tr><td>패턴</td><td>SAGA Pattern</td><td>분산 트랜잭션을 단계로 나누어 보상 처리</td><td>보상 트랜잭션</td></tr><tr><td>패턴</td><td>Outbox Pattern</td><td>DB 변경과 이벤트 발행을 트랜잭션 내 동기화</td><td>Event Driven</td></tr><tr><td>성능 최적화</td><td>Group Commit</td><td>여러 커밋을 묶어 로그 플러시</td><td>TPS 향상</td></tr><tr><td>성능 최적화</td><td>Sharding</td><td>데이터 수평 분할</td><td>Regional Consistency</td></tr><tr><td>성능 최적화</td><td>Regional Consistency</td><td>특정 지역 단위의 일관성 유지</td><td>지연 최소화</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://en.wikipedia.org/wiki/ACID>Wikipedia – ACID Properties</a></li><li><a href=https://www.yugabyte.com/acid/>Yugabyte – ACID 설명</a></li><li><a href=https://www.postgresql.org/docs/current/transaction-iso.html>PostgreSQL Documentation – Transaction Isolation</a></li><li><a href=https://docs.oracle.com/en/database/oracle/oracle-database/19/cncpt/transactions.html>Oracle Database Transaction Concepts</a></li><li><a href=https://www.mongodb.com/transactions>MongoDB – ACID Transactions Guide</a></li><li><a href=https://docs.pingcap.com/tidb/stable/distributed-transactions-overview>TiDB – Distributed Transactions Overview</a></li><li><a href=https://apple.github.io/foundationdb/>FoundationDB – ACID in Distributed Database</a></li><li><a href=https://developer.ibm.com/articles/acid-vs-base/>IBM Developer – ACID vs BASE</a></li><li><a href="https://queue.acm.org/detail.cfm?id=945450">ACM Queue – CAP Theorem</a></li><li><a href=https://databricks.com/glossary/acid-transactions>Databricks – ACID Transactions Glossary</a></li><li><a href=https://www.geeksforgeeks.org/dbms/acid-properties-in-dbms/>GeeksforGeeks – DBMS ACID Properties</a></li><li><a href=https://www.freertos.org/Embedded-RTOS-Binary-Semaphores.html>FreeRTOS – Embedded RTOS Binary Semaphores (context relevance)</a></li><li><a href=https://dataintensive.net/>Martin Kleppmann – Designing Data-Intensive Applications (ACID/BASE sections)</a></li><li><a href=https://www.sqlite.org/wal.html>SQLite – Write-Ahead Logging (WAL) Concept</a></li><li><a href=https://stormatics.tech/blogs/database-concurrency-two-phase-locking-2pl-to-mvcc-part-2>Stormatics – Database Concurrency: 2PL to MVCC explained</a></li><li><a href=https://vladmihalcea.com/how-does-mvcc-multi-version-concurrency-control-work/>Vlad Mihalcea – How does MVCC work?</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2026 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>