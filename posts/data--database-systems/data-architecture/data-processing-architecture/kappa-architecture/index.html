<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Kappa Architecture | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Styles,Data-Flow,Architectures,Kappa-Architecture,Real-Time-Processing"><meta name=description content='Kappa 아키텍처는 배치와 스트림 분리 없이 "모든 데이터를 스트림으로 처리" 하는 단일 레이어 방식이다. 단순성, 코드 통일성, 실시간 응답성을 확보하고 이벤트 재처리 방식으로 유연하게 대응하지만, 이력 분석 및 리플레이 처리 비용 등의 trade-off 가 존재한다.'><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/data--database-systems/data-architecture/data-processing-architecture/kappa-architecture/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.d522c866f0cc9c20ae4fa73a0a8c07f0af4c36af75bcbcd3e90558446f681077.css integrity="sha256-1SLIZvDMnCCuT6c6CowH8K9MNq91vLzT6QVYRG9oEHc=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/data--database-systems/data-architecture/data-processing-architecture/kappa-architecture/index.xml title=rss><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/data--database-systems/data-architecture/data-processing-architecture/kappa-architecture/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/data--database-systems/data-architecture/data-processing-architecture/kappa-architecture/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Kappa Architecture"><meta property="og:description" content='Kappa 아키텍처는 배치와 스트림 분리 없이 "모든 데이터를 스트림으로 처리" 하는 단일 레이어 방식이다. 단순성, 코드 통일성, 실시간 응답성을 확보하고 이벤트 재처리 방식으로 유연하게 대응하지만, 이력 분석 및 리플레이 처리 비용 등의 trade-off 가 존재한다.'><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Kappa Architecture"><meta name=twitter:description content='Kappa 아키텍처는 배치와 스트림 분리 없이 "모든 데이터를 스트림으로 처리" 하는 단일 레이어 방식이다. 단순성, 코드 통일성, 실시간 응답성을 확보하고 이벤트 재처리 방식으로 유연하게 대응하지만, 이력 분석 및 리플레이 처리 비용 등의 trade-off 가 존재한다.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HY's Blog","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":5,"name":"Kappa Architecture","item":"https://buenhyden.github.io/posts/data--database-systems/data-architecture/data-processing-architecture/kappa-architecture/"}]}</script></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>HY's Blog</a></div><h1>Kappa Architecture</h1><div class=post-description>Kappa 아키텍처는 배치와 스트림 분리 없이 &ldquo;모든 데이터를 스트림으로 처리&rdquo; 하는 단일 레이어 방식이다. 단순성, 코드 통일성, 실시간 응답성을 확보하고 이벤트 재처리 방식으로 유연하게 대응하지만, 이력 분석 및 리플레이 처리 비용 등의 trade-off 가 존재한다.</div></header><div class=post-content><h2 id=kappa-architecture>Kappa Architecture<a hidden class=anchor aria-hidden=true href=#kappa-architecture>#</a></h2><p>Kappa Architecture 는 실시간 데이터 처리에 특화된 현대적 아키텍처 패턴으로, 스트림 우선 (Stream-First) 접근 방식을 채택한다. 단일 기술 스택으로 실시간 및 배치 처리를 통합하여 Lambda Architecture 의 이중 코드베이스 문제를 해결한다. Apache Kafka, Apache Flink 등을 핵심 기술로 활용하며, Netflix, Uber, LinkedIn 등 글로벌 기업들이 대규모 실시간 데이터 처리를 위해 도입하고 있다. 이벤트 소싱과 불변 로그를 기반으로 한 데이터 아키텍처이다.</p><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p><strong>기술적 배경</strong>:</p><ul><li>Lambda Architecture 의 한계점에서 출발했다. Lambda Architecture 는 배치 레이어와 스피드 레이어를 분리하여 운영해야 하는 복잡성과 이중 코드베이스 유지의 어려움이 있었다. 2014 년 LinkedIn 의 Jay Kreps 가 이러한 문제를 해결하기 위해 제안했다.</li></ul><p><strong>산업적 배경</strong>:</p><ul><li>실시간 데이터 처리 요구사항의 급증과 IoT, 모바일 애플리케이션, 소셜 미디어 등에서 발생하는 대용량 스트리밍 데이터의 증가가 배경이 되었다. 특히 디지털 트랜스포메이션 시대에 즉시성이 중요해지면서 실시간 분석과 의사결정의 필요성이 커졌다.</li></ul><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><p><strong>주요 목적</strong>:</p><ol><li><strong>아키텍처 단순화</strong>: Lambda Architecture 의 복잡성 제거</li><li><strong>실시간 처리 우선</strong>: 모든 데이터를 실시간으로 처리하여 즉각적인 인사이트 제공</li><li><strong>운영 비용 절감</strong>: 단일 기술 스택으로 인한 유지보수 비용 감소</li><li><strong>개발 생산성 향상</strong>: 하나의 코드베이스로 실시간 및 배치 처리 구현</li></ol><p><strong>필요성</strong>:</p><ul><li><strong>데이터 볼륨 증가</strong>: 기하급수적으로 증가하는 데이터 처리 요구</li><li><strong>실시간 의사결정</strong>: 비즈니스 환경에서 즉각적인 반응이 경쟁 우위 요소</li><li><strong>시스템 복잡성 관리</strong>: 다중 시스템 관리의 복잡성과 비용 문제 해결</li><li><strong>데이터 일관성</strong>: 배치와 실시간 처리 간 데이터 불일치 문제 해결</li></ul><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p>Kappa Architecture 는 실시간 스트리밍과 배치 데이터 처리를 통합하여 데이터 처리의 복잡성을 줄이고 효율성을 높이는 데이터 중심 아키텍처이다.</p><h4 id=기본-개념>기본 개념<a hidden class=anchor aria-hidden=true href=#기본-개념>#</a></h4><ul><li><strong>스트림 우선 처리 (Stream-First Processing)</strong>: 모든 데이터를 연속적인 스트림으로 취급하여 처리</li><li><strong>단일 기술 스택 (Single Technology Stack)</strong>: 실시간과 배치 처리를 하나의 기술 스택으로 통합</li><li><strong>이벤트 소싱 (Event Sourcing)</strong>: 모든 변경사항을 이벤트로 기록하는 불변 로그 중심 접근법</li><li><strong>메시지 엔진 중심 아키텍처</strong>: Apache Kafka 와 같은 메시지 브로커를 데이터의 중앙 저장소로 활용</li></ul><h4 id=심화-개념>심화 개념<a hidden class=anchor aria-hidden=true href=#심화-개념>#</a></h4><ul><li><strong>재처리 메커니즘 (Reprocessing Mechanism)</strong>: 코드 변경 시 히스토리 데이터를 동일한 스트림 처리 엔진으로 재처리</li><li><strong>계층적 저장소 (Tiered Storage)</strong>: 실시간 처리와 장기 저장의 비용 효율성을 위한 스토리지 계층화</li><li><strong>정확히 한 번 처리 (Exactly-Once Processing)</strong>: 데이터 중복이나 손실 없이 정확한 처리 보장</li><li><strong>상태 관리 (State Management)</strong>: 스트림 처리에서 복잡한 상태를 유지하고 관리하는 메커니즘</li></ul><h4 id=실무-구현-연관성>실무 구현 연관성<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성>#</a></h4><ul><li><strong>Apache Kafka</strong>: 불변 로그 저장소와 메시지 스트리밍의 핵심 플랫폼</li><li><strong>Apache Flink</strong>: 복잡한 상태 기반 스트림 처리와 배치 처리 통합</li><li><strong>Apache Storm</strong>: 실시간 스트림 처리를 위한 분산 처리 프레임워크</li><li><strong>Kafka Streams</strong>: Kafka 네이티브 스트림 처리 라이브러리</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><ul><li>실시간 스트림 처리</li><li>배치 처리</li><li>데이터 저장 및 관리</li><li>데이터 일관성 유지</li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><ul><li>단일 파이프라인 구조</li><li>데이터 중복 최소화</li><li>높은 처리량, 낮은 지연 시간</li></ul><h3 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h3><ol><li><p><strong>모든 것은 스트림 (Everything is a Stream)</strong><br>모든 데이터를 연속적인 이벤트 스트림으로 취급하며, 배치 데이터도 스트림의 특수한 형태로 간주한다.</p></li><li><p><strong>단일 처리 경로 (Single Processing Path)</strong><br>실시간과 배치 처리를 위한 별도의 시스템을 구축하지 않고, 하나의 스트림 처리 시스템을 사용한다.</p></li><li><p><strong>불변 로그 중심 (Immutable Log-Centric)</strong><br>모든 이벤트를 불변 로그에 저장하여 언제든지 재처리가 가능하도록 한다.</p></li><li><p><strong>이벤트 기반 처리 (Event-Driven Processing)</strong><br>이벤트 발생 시점에 즉시 처리하여 실시간 반응성을 보장한다.</p></li></ol><h3 id=작동-원리-및-방식>작동 원리 및 방식<a hidden class=anchor aria-hidden=true href=#작동-원리-및-방식>#</a></h3><p>데이터는 실시간 스트림으로 처리되고, 필요시 동일 데이터 소스에서 배치 처리를 수행한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>graph LR
</span></span><span class=line><span class=cl>    A[Data Sources] --&gt; B[Message Engine&lt;br/&gt;Apache Kafka]
</span></span><span class=line><span class=cl>    B --&gt; C[Stream Processing&lt;br/&gt;Apache Flink/Storm]
</span></span><span class=line><span class=cl>    C --&gt; D[Serving Layer&lt;br/&gt;Database/Analytics]
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    E[Historical Data] --&gt; B
</span></span><span class=line><span class=cl>    B --&gt; F[Event Log Storage]
</span></span><span class=line><span class=cl>    F --&gt; C
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    G[Real-time Queries] --&gt; D
</span></span><span class=line><span class=cl>    H[Batch Reprocessing] --&gt; C
</span></span></code></pre></td></tr></table></div></div><h4 id=데이터-플로우>데이터 플로우<a hidden class=anchor aria-hidden=true href=#데이터-플로우>#</a></h4><ol><li><strong>데이터 수집</strong>: 다양한 소스에서 실시간 데이터 스트림 수집</li><li><strong>메시지 엔진 저장</strong>: Apache Kafka 등에 이벤트 로그로 저장</li><li><strong>스트림 처리</strong>: 실시간으로 데이터 변환, 집계, 분석 수행</li><li><strong>서빙 레이어 저장</strong>: 처리된 결과를 쿼리 가능한 데이터베이스에 저장</li><li><strong>재처리</strong>: 필요 시 동일한 스트림 처리 엔진으로 히스토리 데이터 재처리</li></ol><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><p>Kappa 아키텍처는 <strong>단일 스트림 중심 파이프라인</strong>으로 구성되며, Lambda 의 배치 레이어를 대체한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>graph LR
</span></span><span class=line><span class=cl>  A[데이터 소스] --&gt; B[&#34;Immutable Log (Kafka)&#34;]
</span></span><span class=line><span class=cl>  B --&gt; C[&#34;스트림 처리 엔진 (Flink/Kafka Streams)&#34;]
</span></span><span class=line><span class=cl>  C --&gt; D[Materialized View / Data Store]
</span></span><span class=line><span class=cl>  D --&gt; E[애플리케이션 / 실시간 쿼리]
</span></span><span class=line><span class=cl>  B --&gt;|Replay| C
</span></span></code></pre></td></tr></table></div></div><h4 id=주요-구성-요소>주요 구성 요소<a hidden class=anchor aria-hidden=true href=#주요-구성-요소>#</a></h4><table><thead><tr><th>계층</th><th>주요 역할</th><th>대표 기술 및 설명</th></tr></thead><tbody><tr><td><strong>데이터 소스</strong> (Data Source / Event Log)</td><td>다양한 실시간 이벤트의 유입</td><td>IoT 센서, DB 트랜잭션, 애플리케이션 로그 등. CDC(Change Data Capture) 를 통해 SoR 변경을 이벤트로 전환</td></tr><tr><td><strong>로그 저장소</strong> (Immutable Log)</td><td>변경 불가능한 이벤트 로그의 수집 및 저장</td><td>Apache Kafka 등: append-only, 순서 보장, 압축, tiered storage 지원, exactly-once semantics</td></tr><tr><td><strong>스트림 처리 엔진</strong> (Processing Engine)</td><td>실시간 스트림 연산 및 과거 이벤트 재처리</td><td>Apache Flink, Kafka Streams, Spark Streaming: 필터링, 윈도우, 조인, 집계 등 유니파이된 연산 처리</td></tr><tr><td><strong>데이터 저장 및 제공 계층</strong> (Materialized View / Data Store)</td><td>처리 결과를 저장하고 응용 프로그램이 참조하는 계층</td><td>Cassandra, Elasticsearch, RDS, Data Lake 등: 쿼리, 분석, ML 모델 입력 등 실시간 활용 목적</td></tr><tr><td><strong>애플리케이션 레이어</strong> (Application Layer)</td><td>사용자 -facing 시스템 및 비즈니스 기능 제공</td><td>대시보드, 실시간 API, 추천 시스템, 경고 시스템, ML 모델 등으로 최신 데이터 기반 의사결정 지원</td></tr></tbody></table><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><table><thead><tr><th>카테고리</th><th>구현 기법</th><th>핵심 구성 요소 및 설명</th><th>적용 시나리오 및 효과</th></tr></thead><tbody><tr><td><strong>설계 패턴</strong></td><td>이벤트 소싱 (Event Sourcing)</td><td>이벤트 스토어, Kafka Topic, 상태 재구성 메커니즘 구성모든 상태 변경을 이벤트로 기록</td><td>사용자 행동 기록, 상태 복원, 감사 추적이 필요한 시스템</td></tr><tr><td></td><td>CQRS</td><td>명령 (Command) 과 조회 (Query) 모델 분리이벤트 동기화로 최종 일관성 유지</td><td>주문 처리, 이력 시스템 등 읽기/쓰기 성능을 개별 최적화할 필요가 있는 환경</td></tr><tr><td></td><td>스트림 - 테이블 이중성</td><td>스트림 ↔ 테이블 상호 변환 개념 적용상태 저장소와 실시간 집계 윈도우 활용</td><td>매출 집계, 행동 기반 실시간 대시보드, 상태 기반 트리거</td></tr><tr><td><strong>처리 엔진</strong></td><td>스트림 프로세서 구성</td><td>Apache Flink, Kafka Streams 등윈도우, 집계, 조인, 체크포인트, EOS 세팅 지원</td><td>상태 기반 연산, 실시간 분석, 이상 탐지</td></tr><tr><td><strong>인프라 구성</strong></td><td>메시지 로그 및 브로커 설정</td><td>Kafka 클러스터 구성 (파티션, 레플리카, 압축, tiered storage)append-only 로그 저장 및 replay 처리 가능</td><td>고신뢰 이벤트 저장소, 장애 복구, 데이터 재처리</td></tr><tr><td></td><td>스키마 레지스트리 관리</td><td>Avro/Protobuf 기반 스키마 등록호환성 (Backward/Forward) 정책 설정</td><td>다양한 버전의 데이터 구조 변경 대응, consumer 안전한 스키마 수신</td></tr><tr><td><strong>운영 전략</strong></td><td>백프레셔 제어</td><td>Rate Limiter, Buffer, Flow Control 구성처리 병목 구간에서 유입량 조절</td><td>센서/로그 스트림 처리 시 다운스트림 병목 완화</td></tr><tr><td></td><td>재처리 전략 구성</td><td>Kafka 오프셋 초기화 (earliest)Stream job 재시작 및 Trigger 기반 Replay 구성</td><td>모델 업데이트, 오류 복구, 규칙 변경 시 과거 데이터 재처리 필요</td></tr><tr><td></td><td>상태 저장 최적화</td><td>Flink RocksDB 백엔드 설정, 상태 파티셔닝, TTL/압축 구성</td><td>메모리 사용 최소화, 대규모 상태 집계 작업의 안정적 처리</td></tr></tbody></table><h4 id=이벤트-소싱-event-sourcing>이벤트 소싱 (Event Sourcing)<a hidden class=anchor aria-hidden=true href=#이벤트-소싱-event-sourcing>#</a></h4><p>이벤트를 저장소에 쌓고 이를 재생하여 상태를 재구성한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># event_store.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span><span class=p>,</span> <span class=n>KafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>append_event</span><span class=p>(</span><span class=n>topic</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>topic</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>replay_events</span><span class=p>(</span><span class=n>topic</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>topic</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>auto_offset_reset</span><span class=o>=</span><span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>m</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ev</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>        <span class=c1># 예: entity_id 기준 상태 재구성</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=n>ev</span><span class=p>[</span><span class=s1>&#39;entity_id&#39;</span><span class=p>]]</span> <span class=o>=</span> <span class=n>ev</span><span class=p>[</span><span class=s1>&#39;payload&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>state</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=cqrs-명령조회-분리>CQRS (명령/조회 분리)<a hidden class=anchor aria-hidden=true href=#cqrs-명령조회-분리>#</a></h4><p>쓰기와 읽기 모델을 분리하여 성능을 최적화한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># command_handler.py (쓰기 전용 RDB)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_story_post</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># DB에 저장 (ex: PostgreSQL)</span>
</span></span><span class=line><span class=cl>    <span class=n>insert_story</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;story_id&#39;</span><span class=p>],</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;content&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># query_service.js (읽기 전용 ElasticSearch 기반)</span>
</span></span><span class=line><span class=cl><span class=n>const</span> <span class=p>{</span> <span class=n>Client</span> <span class=p>}</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s1>&#39;@elastic/elasticsearch&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>const</span> <span class=n>es</span> <span class=o>=</span> <span class=n>new</span> <span class=n>Client</span><span class=p>({</span> <span class=n>node</span><span class=p>:</span> <span class=s1>&#39;http://localhost:9200&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=n>function</span> <span class=n>searchStories</span><span class=p>(</span><span class=n>query</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>const</span> <span class=n>resp</span> <span class=o>=</span> <span class=k>await</span> <span class=n>es</span><span class=o>.</span><span class=n>search</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span><span class=p>:</span> <span class=s1>&#39;stories&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>body</span><span class=p>:</span> <span class=p>{</span> <span class=n>query</span><span class=p>:</span> <span class=p>{</span> <span class=k>match</span><span class=p>:</span> <span class=p>{</span> <span class=n>content</span><span class=p>:</span> <span class=n>query</span> <span class=p>}}}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>resp</span><span class=o>.</span><span class=n>hits</span><span class=o>.</span><span class=n>hits</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=스트림---테이블-듀얼리티>스트림 - 테이블 듀얼리티<a hidden class=anchor aria-hidden=true href=#스트림---테이블-듀얼리티>#</a></h4><p>Kafka Streams 또는 Flink 에서 스트림을 테이블 형태로 유지하며 실시간 집계를 구현한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7>7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8>8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Kafka Streams 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>StreamsBuilder</span><span class=w> </span><span class=n>builder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StreamsBuilder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>KStream</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=n>sales</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>builder</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&#34;sales-topic&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Consumed</span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=n>Serdes</span><span class=p>.</span><span class=na>String</span><span class=p>(),</span><span class=w> </span><span class=n>Serdes</span><span class=p>.</span><span class=na>Long</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>KTable</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=n>dailySales</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sales</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>groupBy</span><span class=p>((</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>key</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>reduce</span><span class=p>(</span><span class=n>Long</span><span class=p>::</span><span class=n>sum</span><span class=p>,</span><span class=w> </span><span class=n>Materialized</span><span class=p>.</span><span class=na>as</span><span class=p>(</span><span class=s>&#34;daily-sales-store&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>dailySales</span><span class=p>.</span><span class=na>toStream</span><span class=p>().</span><span class=na>to</span><span class=p>(</span><span class=s>&#34;daily-sales-topic&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Produced</span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=n>Serdes</span><span class=p>.</span><span class=na>String</span><span class=p>(),</span><span class=w> </span><span class=n>Serdes</span><span class=p>.</span><span class=na>Long</span><span class=p>()));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=스트림-프로세서-구성-flink-예시python-pyflink>스트림 프로세서 구성 (Flink 예시–Python PyFlink)<a hidden class=anchor aria-hidden=true href=#스트림-프로세서-구성-flink-예시python-pyflink>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span><span class=lnt id=hl-5-32><a class=lnlinks href=#hl-5-32>32</a>
</span><span class=lnt id=hl-5-33><a class=lnlinks href=#hl-5-33>33</a>
</span><span class=lnt id=hl-5-34><a class=lnlinks href=#hl-5-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyflink.datastream</span> <span class=kn>import</span> <span class=n>StreamExecutionEnvironment</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyflink.table</span> <span class=kn>import</span> <span class=n>StreamTableEnvironment</span><span class=p>,</span> <span class=n>DataTypes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyflink.table.window</span> <span class=kn>import</span> <span class=n>Tumble</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>env</span> <span class=o>=</span> <span class=n>StreamExecutionEnvironment</span><span class=o>.</span><span class=n>get_execution_environment</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>t_env</span> <span class=o>=</span> <span class=n>StreamTableEnvironment</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>env</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t_env</span><span class=o>.</span><span class=n>execute_sql</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>CREATE TABLE clicks (
</span></span></span><span class=line><span class=cl><span class=s2>  user_id STRING,
</span></span></span><span class=line><span class=cl><span class=s2>  ts TIMESTAMP(3),
</span></span></span><span class=line><span class=cl><span class=s2>  WATERMARK FOR ts AS ts - INTERVAL &#39;5&#39; SECOND
</span></span></span><span class=line><span class=cl><span class=s2>) WITH (... Kafka Source 설정 ...)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t_env</span><span class=o>.</span><span class=n>execute_sql</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>CREATE TABLE click_counts (
</span></span></span><span class=line><span class=cl><span class=s2>  user_id STRING,
</span></span></span><span class=line><span class=cl><span class=s2>  cnt BIGINT,
</span></span></span><span class=line><span class=cl><span class=s2>  window_end TIMESTAMP(3)
</span></span></span><span class=line><span class=cl><span class=s2>) WITH (... Kafka Sink 설정 ...)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t_env</span><span class=o>.</span><span class=n>execute_sql</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>INSERT INTO click_counts
</span></span></span><span class=line><span class=cl><span class=s2>SELECT
</span></span></span><span class=line><span class=cl><span class=s2>  user_id,
</span></span></span><span class=line><span class=cl><span class=s2>  COUNT(*) as cnt,
</span></span></span><span class=line><span class=cl><span class=s2>  TUMBLE_END(ts, INTERVAL &#39;1&#39; HOUR) as window_end
</span></span></span><span class=line><span class=cl><span class=s2>FROM clicks
</span></span></span><span class=line><span class=cl><span class=s2>GROUP BY
</span></span></span><span class=line><span class=cl><span class=s2>  user_id,
</span></span></span><span class=line><span class=cl><span class=s2>  TUMBLE(ts, INTERVAL &#39;1&#39; HOUR)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=kafka-브로커-설정-python-예시>Kafka 브로커 설정 (Python 예시)<a hidden class=anchor aria-hidden=true href=#kafka-브로커-설정-python-예시>#</a></h4><p>브로커를 파티션/레플리카 구성과 압축, tiered storage 로 설정한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># server.properties</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>num.partitions=12</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>default.replication.factor=3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>compression.type=producer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>log.retention.hours=168</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>log.segment.bytes=1073741824</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=스키마-레지스트리-사용-avro-기반>스키마 레지스트리 사용 (Avro 기반)<a hidden class=anchor aria-hidden=true href=#스키마-레지스트리-사용-avro-기반>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>confluent_kafka</span> <span class=kn>import</span> <span class=n>avro</span><span class=p>,</span> <span class=n>SerializingProducer</span>
</span></span><span class=line><span class=cl><span class=n>schema_str</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>{
</span></span></span><span class=line><span class=cl><span class=s2> &#34;namespace&#34;: &#34;example&#34;,
</span></span></span><span class=line><span class=cl><span class=s2> &#34;name&#34;: &#34;Purchase&#34;,
</span></span></span><span class=line><span class=cl><span class=s2> &#34;type&#34;: &#34;record&#34;,
</span></span></span><span class=line><span class=cl><span class=s2> &#34;fields&#34;: [
</span></span></span><span class=line><span class=cl><span class=s2>   {&#34;name&#34;: &#34;user_id&#34;, &#34;type&#34;: &#34;string&#34;},
</span></span></span><span class=line><span class=cl><span class=s2>   {&#34;name&#34;: &#34;amount&#34;, &#34;type&#34;: &#34;double&#34;}
</span></span></span><span class=line><span class=cl><span class=s2> ]
</span></span></span><span class=line><span class=cl><span class=s2>}
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>schema</span> <span class=o>=</span> <span class=n>avro</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>schema_str</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>SerializingProducer</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span> <span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key.serializer&#39;</span><span class=p>:</span> <span class=n>avro</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>schema</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;value.serializer&#39;</span><span class=p>:</span> <span class=n>avro</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>schema</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;schema.registry.url&#39;</span><span class=p>:</span> <span class=s1>&#39;http://localhost:8081&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=백프레셔-제어>백프레셔 제어<a hidden class=anchor aria-hidden=true href=#백프레셔-제어>#</a></h4><p>Flink 에서 백프레셔 감지 및 리소스 조정을 수행한다.<br>프로그램 설정 예시는 YAML 구성에서 지정할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>streaming</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>bufferTimeout</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backpressure</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>samplingInterval</span><span class=p>:</span><span class=w> </span><span class=m>20</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=재처리-전략-구성-replay>재처리 전략 구성 (Replay)<a hidden class=anchor aria-hidden=true href=#재처리-전략-구성-replay>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Kafka 오프셋 초기화</span>
</span></span><span class=line><span class=cl>kafka-consumer-groups.sh --bootstrap-server localhost:9092 <span class=se>\
</span></span></span><span class=line><span class=cl>  --group click-processor --topic click-events <span class=se>\
</span></span></span><span class=line><span class=cl>  --reset-offsets --to-earliest --execute
</span></span></code></pre></td></tr></table></div></div><p>Flink job 재시작 후 과거 데이터를 다시 처리한다.</p><h4 id=상태-저장-최적화-flink--rocksdb>상태 저장 최적화 (Flink + RocksDB)<a hidden class=anchor aria-hidden=true href=#상태-저장-최적화-flink--rocksdb>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyflink.datastream</span> <span class=kn>import</span> <span class=n>StreamExecutionEnvironment</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyflink.common.state_backend</span> <span class=kn>import</span> <span class=n>RocksDBStateBackend</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>env</span> <span class=o>=</span> <span class=n>StreamExecutionEnvironment</span><span class=o>.</span><span class=n>get_execution_environment</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>env</span><span class=o>.</span><span class=n>set_state_backend</span><span class=p>(</span><span class=n>RocksDBStateBackend</span><span class=p>(</span><span class=s2>&#34;file:///flink/checkpoints&#34;</span><span class=p>,</span> <span class=n>incremental</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>env</span><span class=o>.</span><span class=n>set_parallelism</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>설계 단순성</strong></td><td>단일 처리 경로</td><td>배치와 스트림 이중 구조 (Lambda) 를 통합하여 설계 및 구현 복잡도 감소</td></tr><tr><td></td><td>코드베이스 통합</td><td>동일 코드 경로에서 모든 처리를 수행하므로 유지보수 효율 및 배포 전략 간소화 가능</td></tr><tr><td></td><td>구조 일관성 유지</td><td>배치와 스트림 간 데이터 정합성 문제를 방지하고 일관된 흐름 유지</td></tr><tr><td><strong>실시간 처리 최적화</strong></td><td>낮은 지연 (Low Latency)</td><td>스트림 기반 구조로 즉시 처리 가능하여 사용자 경험 개선 및 의사결정 반응 속도 향상</td></tr><tr><td></td><td>빠른 피드백 루프</td><td>이벤트 발생 직후 데이터 반영으로 실시간 대시보드, 알림, 추천 시스템 등에 적합</td></tr><tr><td><strong>운영 효율성</strong></td><td>유지보수 용이</td><td>단일 파이프라인, 단일 기술 스택으로 인해 장애 대응, 변경 반영 속도가 빠름</td></tr><tr><td></td><td>비용 절감</td><td>배치 레이어 제거로 인프라/개발/운영 비용 절감 (이중 파이프라인 대비)</td></tr><tr><td><strong>확장성과 복원력</strong></td><td>수평 확장 용이</td><td>Kafka, Flink 등 분산 시스템의 특성을 활용해 노드 추가만으로 확장 가능</td></tr><tr><td></td><td>장애 내성 및 복원력 확보</td><td>체크포인트, 멱등성 처리, 이벤트 소싱 등으로 장애 발생 시 안전한 재처리 및 복구 가능</td></tr><tr><td><strong>데이터 활용성</strong></td><td>유연한 재처리</td><td>Immutable log 기반이므로 과거 이벤트를 기반으로 시점 재처리 또는 모델 재학습 가능</td></tr><tr><td></td><td>데이터 일관성 강화</td><td>단일 처리 흐름이기 때문에 중복 저장, 처리 순서 오류 등의 문제를 최소화</td></tr><tr><td></td><td>스키마 진화 대응</td><td>스키마 레지스트리 기반으로 이벤트 구조 변경 시에도 하위 호환성 유지 가능</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th><strong>카테고리</strong></th><th><strong>항목</strong></th><th><strong>설명</strong></th><th><strong>해결책</strong></th></tr></thead><tbody><tr><td><strong>설계 복잡성</strong></td><td>초기 설정 복잡성</td><td>스트림 처리 시스템 초기 설계 및 설정이 복잡하고 학습 곡선이 큼</td><td>관리형 서비스 도입, 단계적 마이그레이션</td></tr><tr><td></td><td>복잡한 실시간 처리 로직</td><td>다양한 이벤트 흐름과 상태 처리 로직이 얽혀 유지보수가 어려움</td><td>모듈화 및 테스트 자동화</td></tr><tr><td><strong>상태 및 저장소</strong></td><td>상태 관리 복잡성</td><td>Stateful 연산 증가로 인한 복구/관리 비용 증가</td><td>RocksDB 최적화, checkpoint 설계</td></tr><tr><td></td><td>대규모 로그 저장 비용</td><td>Immutable Log 기반 저장 시 장기 보존 비용 증가</td><td>Tiered Storage 및 압축 활용</td></tr><tr><td><strong>기술 종속성</strong></td><td>특정 기술에 대한 의존성</td><td>Kafka/Flink 등 특정 기술에 강하게 종속됨</td><td>표준 API 및 추상화 레이어 구성</td></tr><tr><td></td><td>스키마 변경 관리 부담</td><td>Schema Evolution 이 복잡하고 하위 호환성 보장이 어려움</td><td>Schema Registry 활용 및 호환성 전략 설계</td></tr><tr><td><strong>운영 비용 및 성능</strong></td><td>리소스 소비</td><td>지속 스트림 처리로 인해 CPU/메모리 사용률 지속 상승</td><td>자동 스케일링, 자원 격리</td></tr><tr><td></td><td>과거 데이터 리플레이 비용</td><td>전체 로그 재처리 시 계산량 증가 및 처리 시간 증가</td><td>로그 구간별 처리, 병렬 재처리 샤딩</td></tr><tr><td><strong>일관성 및 분석</strong></td><td>실시간 - 배치 일관성 유지 어려움</td><td>Lambda 구조에서 두 계층 간 결과 차이 발생 가능</td><td>일관성 검증 로직 도입, 병합 알고리즘 개선</td></tr><tr><td></td><td>히스토리 분석 제한</td><td>Kappa 아키텍처는 실시간 처리에 집중되어 복잡한 배치 분석이 어려움</td><td>하이브리드 접근법, OLAP 통합</td></tr><tr><td><strong>운영 안정성</strong></td><td>장애 대응 어려움</td><td>실시간 파이프라인 중단 시 전체 흐름 중단 가능성 존재</td><td>장애 탐지 자동화, Failover 시스템 구축</td></tr><tr><td></td><td>순서 보장 문제</td><td>파티셔닝 변경/리밸런싱 시 메시지 순서 손실 발생</td><td>Key 기반 파티셔닝 유지, 순서 복원 전략 사용</td></tr></tbody></table><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th><strong>카테고리</strong></th><th><strong>항목</strong></th><th><strong>원인</strong></th><th><strong>영향</strong></th><th><strong>탐지 및 진단</strong></th><th><strong>예방 방법</strong></th><th><strong>해결 방법 및 기법</strong></th></tr></thead><tbody><tr><td><strong>데이터 품질</strong></td><td>데이터 유실</td><td>버퍼 초과, 네트워크 장애, retention 설정 누락</td><td>손실, 불완전 분석</td><td>offset 모니터링, 로그 경고</td><td>DLQ 사용, Replica 설정 강화</td><td>재처리 시스템 구축, S3 복구 병행</td></tr><tr><td></td><td>데이터 중복 처리</td><td>재시도, 비정상 재처리, idempotency 누락</td><td>부정확한 집계, 중복 전송</td><td>중복 키 분석, 이벤트 수 집계</td><td>중복 제거 키 설정, 멱등성 설계</td><td>Exactly-Once 의미론 구현, 트랜잭션 적용</td></tr><tr><td><strong>지연 및 성능</strong></td><td>지연 처리</td><td>백프레셔, 리소스 부족</td><td>SLA 미준수, 사용자 불만</td><td>큐 길이, 처리 지연 측정</td><td>부하 테스트, 용량 계획</td><td>우선순위 큐, 자동 스케일링</td></tr><tr><td></td><td>리플레이 병렬성 부족</td><td>파티션 수 적음, Task 병목</td><td>복구 지연, 전체 처리 속도 저하</td><td>리플레이 커버리지 보고서, 시간 분석</td><td>파티션 확장, 샤딩 기반 Task 분산</td><td>CI/CD 연동 오프셋 리셋 자동화</td></tr><tr><td><strong>일관성</strong></td><td>상태 불일치</td><td>메시지 순서 손실, 장애 중 중복 처리</td><td>무결성 저하, 오류 결과</td><td>체크섬 검증, 상태 Snapshot 비교</td><td>파티셔닝 전략 강화, 순서 보장 키 유지</td><td>상태 복구 전략, 보상 트랜잭션</td></tr><tr><td></td><td>스키마 호환성 문제</td><td>메시지 구조 변경, 처리 로직 미반영</td><td>처리 실패, 데이터 파싱 오류</td><td>스키마 버전 로그, 테스트 자동화</td><td>Schema Registry 사용</td><td>하위 호환 설계, 점진적 마이그레이션 적용</td></tr><tr><td><strong>운영 안정성</strong></td><td>상태 스냅샷 손상</td><td>checkpoint 누락/오염</td><td>장애 복구 불가, 전체 장애 발생</td><td>checkpoint 상태 비교</td><td>이중 저장소 구성, 정기 백업</td><td>외부 저장소 백업, 복구 시나리오 설계</td></tr><tr><td></td><td>로직 재처리 누락</td><td>코드 수정 후 Replay 누락</td><td>오래된 로직 결과가 계속 노출됨</td><td>Replay 이력 추적</td><td>오프셋 리셋 자동화, Replay Coverage 테스트 도입</td><td>CI/CD 파이프라인 통합</td></tr><tr><td></td><td>이벤트 순서 오류</td><td>파티션 병합, 키 변경, 병렬 처리 이슈</td><td>집계 오류, 시간순 쿼리 실패</td><td>이벤트 타임 분석, 순서 불일치 패턴 감지</td><td>Key 고정, 순서 복원 로직 내장</td><td>Kafka Ordering, Flink keyBy 정렬 사용</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>도전 과제</th><th>설명</th><th>주요 고려사항 및 대응 방안</th></tr></thead><tbody><tr><td><strong>처리 성능</strong></td><td>실시간 처리 지연 최소화</td><td>고속 데이터 유입 시 처리량과 지연 간의 트레이드오프 문제 발생</td><td>스트림 병렬도 조정, 배치 크기 튜닝, 우선순위 큐 기반 스케줄링</td></tr><tr><td><strong>일관성 관리</strong></td><td>Exactly-once 보장</td><td>장애 발생 시 중복/손실 없이 이벤트를 한 번만 처리해야 하는 요구사항</td><td>체크포인팅, 트랜잭션 로그, 멱등성 설계, 메시지 오프셋 재처리 전략 적용</td></tr><tr><td><strong>상태 관리</strong></td><td>상태 기반 스트림 연산의 메모리 한계</td><td>윈도우, 집계, 조인 등은 상태 유지를 필요로 하며 메모리 자원을 크게 소모함</td><td>RocksDB 외부 상태 저장소 활용, 증분 체크포인트, 상태 압축 및 만료 주기 설정</td></tr><tr><td><strong>인프라 확장성</strong></td><td>시스템 확장성과 복원력 확보</td><td>노드 증가, 리플레이, 장애 복구 시 서비스 중단 없이 확장 가능해야 함</td><td>오토스케일링, Kubernetes 연동, 파티셔닝 전략 및 무중단 배포 설계</td></tr><tr><td><strong>운영 자동화</strong></td><td>모니터링 및 장애 탐지 지연</td><td>분산 파이프라인에서 지연·오류·병목 지점의 추적이 어려움</td><td>Prometheus, Grafana, 분산 트레이싱 (Jaeger, Zipkin), JMX Exporter 적용</td></tr><tr><td><strong>스키마 관리</strong></td><td>스키마 진화 및 하위 호환성 유지</td><td>프로듀서와 컨슈머 간 스키마 버전 차이 발생 시 처리 실패 우려</td><td>Schema Registry 사용, backward/forward compatibility 준수</td></tr><tr><td><strong>보안/규정</strong></td><td>데이터 보존 및 삭제 정책 준수</td><td>GDPR, HIPAA 등의 규제에 따라 실시간 로그의 장기 저장 또는 삭제가 요구됨</td><td>로그 암호화, 저장 기간 제한, 감사 로그 설정, 민감 정보 마스킹</td></tr><tr><td><strong>리플레이 성능</strong></td><td>대규모 이벤트 재처리의 부하</td><td>장애 복구 시 이벤트 리플레이가 시스템 리소스를 소모하고 전체 처리 흐름을 지연시킴</td><td>이벤트 파티션 재조정, 서빙 데이터 분리, 슬로우 재처리 큐 설계</td></tr><tr><td><strong>테스트 전략</strong></td><td>스트림 처리 로직의 통합 테스트 어려움</td><td>순차적/병렬 처리, 상태 기반 흐름 등 단위 테스트보다 시나리오 기반 통합 테스트가 요구됨</td><td>Kafka TestContainers, End-to-End Replay 시뮬레이션 프레임워크 구축</td></tr><tr><td><strong>데이터 정합성</strong></td><td>스트림 - 배치 간 정합성 확보</td><td>Kappa 와 Lambda 혼합 구조 또는 이중 저장 시 데이터 불일치 우려</td><td>동일 키 기반 머지 정책, 타임라인 우선순위 정의, 원자성 보장 연산 구현</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th><th>특징</th><th>대표 사용 사례</th></tr></thead><tbody><tr><td><strong>처리 모델</strong></td><td>Stream-only Architecture</td><td>전체 처리를 스트림 기반으로만 수행 (배치 없음)</td><td>실시간 중심 설계, 단순화된 파이프라인</td><td>실시간 로그 분석, 실시간 이벤트 모니터링</td></tr><tr><td><strong>처리 범위</strong></td><td>Stateless Streams</td><td>개별 이벤트 단위 처리 (이전 상태 참조 없음)</td><td>낮은 메모리 요구, 병렬 처리 용이</td><td>트래픽 라우팅, 실시간 필터링</td></tr><tr><td></td><td>Stateful Streams</td><td>상태를 유지하며 처리 (누적, 집계, 윈도우 연산 등 포함)</td><td>복잡한 처리 가능, 높은 리소스 요구</td><td>실시간 집계, 추천 시스템, IoT 시계열 분석</td></tr><tr><td><strong>데이터 소스 유형</strong></td><td>Event-Driven Kappa</td><td>도메인 이벤트 발생 시 스트림 생성</td><td>마이크로서비스 연계 최적화, 이벤트 소싱 기반</td><td>주문 이벤트 처리, 알림 시스템</td></tr><tr><td></td><td>CDC-Based Kappa</td><td>DB 변경사항을 캡처하여 스트림 처리 (Change Data Capture)</td><td>기존 시스템 연동 쉬움, 테이블 동기화 최적화</td><td>RDBMS → 스트리밍 전환, 실시간 ETL</td></tr><tr><td><strong>재처리 전략</strong></td><td>Replayable Architecture</td><td>Immutable Log 기반으로 이벤트 재처리 가능</td><td>장애 복구, 지연 처리 대응, 이벤트 정정 가능</td><td>데이터 수복, 복기 처리, 보정 로직 재실행</td></tr><tr><td><strong>저장소 구성 방식</strong></td><td>Memory-Optimized</td><td>인메모리 처리 중심 (예: RocksDB, Redis)</td><td>저지연, 짧은 TTL, 빠른 응답</td><td>실시간 게임 처리, 고빈도 거래 시스템</td></tr><tr><td></td><td>Persistent Kappa</td><td>디스크 기반 저장소 사용 (예: Kafka + HDFS, S3 등)</td><td>대용량, 영속성 요구, 이력 관리 가능</td><td>컴플라이언스 로그, 장기 보관 분석 시스템</td></tr><tr><td><strong>처리 복잡도</strong></td><td>Simple Kappa</td><td>필터링, 라우팅, 맵핑 등 단순 변환 처리 중심</td><td>개발과 운영이 쉬움</td><td>실시간 로그 수집, 데이터 전처리</td></tr><tr><td></td><td>Complex Kappa</td><td>윈도우 조인, 패턴 탐지, 머신러닝 예측 등 고난이도 처리 포함</td><td>고급 분석, ML 연동 가능</td><td>실시간 이상 탐지, 행동 분석, 실시간 대시보드</td></tr><tr><td><strong>엔진 구성 방식</strong></td><td>단일 스트림 파이프라인</td><td>스트림 처리만으로 전체 흐름 구성 (단일 처리 모델)</td><td>배치 없음, 단순 아키텍처</td><td>이벤트 스트리밍 분석, 실시간 알림 시스템</td></tr><tr><td></td><td>Hybrid Kappa</td><td>특정 부분에서 배치 처리 보완 (히스토리 복원 등)</td><td>실시간 중심이되 일부 배치 활용 가능</td><td>복합 분석 플랫폼, 실시간 + 통계 분석 병행</td></tr><tr><td><strong>저장 방식</strong></td><td>분산 저장 기반</td><td>데이터 레이크/분산 DB 기반 저장소 사용</td><td>확장성/가용성 높음</td><td>Kafka + S3, Flink + Hudi</td></tr><tr><td><strong>로깅 구조</strong></td><td>Immutable Log 기반</td><td>변경 불가능한 로그를 이벤트 처리의 핵심으로 사용 (Kafka 등)</td><td>이벤트 소싱 기반 설계, 시간순 재현 가능</td><td>감사 로그, 상태 복원 기반 시스템</td></tr></tbody></table><h3 id=lambda-아키텍처-vs-kappa-아키텍처-비교>Lambda 아키텍처 Vs Kappa 아키텍처 비교<a hidden class=anchor aria-hidden=true href=#lambda-아키텍처-vs-kappa-아키텍처-비교>#</a></h3><table><thead><tr><th>구분</th><th>Lambda 아키텍처</th><th>Kappa 아키텍처</th></tr></thead><tbody><tr><td>설계 목적</td><td>정확성과 지연 간의 균형</td><td>스트림 우선 실시간 처리 단순화</td></tr><tr><td>아키텍처 구성</td><td>Batch Layer + Speed Layer + Serving Layer</td><td>Stream Processing + Materialized View</td></tr><tr><td>코드 복잡성</td><td>배치/스트림 두 개의 처리 코드 필요</td><td>단일 코드로 모든 처리 수행</td></tr><tr><td>재처리 방식</td><td>Batch Layer 를 통해 과거 데이터를 재처리</td><td>Kafka 로그 replay 로 전체 재처리</td></tr><tr><td>지연 시간</td><td>상대적으로 높음 (배치 주기 반영)</td><td>낮음 (스트림 기반 실시간 처리)</td></tr><tr><td>배포 및 운영</td><td>중복된 레이어로 인해 운영 복잡</td><td>단일 파이프라인으로 운영 단순</td></tr><tr><td>대표 기술</td><td>Hadoop, Spark, Storm, Hive</td><td>Kafka, Flink, Kafka Streams, Faust</td></tr><tr><td>사용 적합성</td><td>대규모 히스토리 데이터 분석 중심</td><td>실시간 분석, 빠른 응답 필요 환경</td></tr></tbody></table><blockquote><p><strong>분석 요약</strong>:<br>Kappa 는 Lambda 의 운영 복잡성과 유지보수 부담을 줄이기 위해 등장했으며, 특히 배치와 스트림 간 코드 이중화를 제거하는 데 탁월하다. 하지만, 복잡한 상태 기반 연산이 필요한 경우에는 Lambda 구조도 여전히 유효할 수 있다.</p></blockquote><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>사용 분야</th><th>대표 목적</th><th>결합 기술 구성</th><th>기대 효과</th></tr></thead><tbody><tr><td><strong>실시간 로그 분석</strong></td><td>사용자 이벤트 분석 및 대응</td><td>Kafka + Flink + Elasticsearch</td><td>사용자 행동 기반 분석, 개인화 서비스, 실시간 알림 제공</td></tr><tr><td><strong>IoT 센서 데이터 처리</strong></td><td>대규모 센서 데이터의 실시간 수집 및 처리</td><td>Kafka + Spark Streaming + InfluxDB / Cassandra</td><td>이상 감지, 실시간 모니터링, 예지보전</td></tr><tr><td><strong>금융 거래 분석</strong></td><td>실시간 이상 거래 탐지 및 리스크 대응</td><td>Kafka + Kafka Streams + Elasticsearch</td><td>사기 탐지, 자동 알림, 규제 대응</td></tr><tr><td><strong>ETL 파이프라인</strong></td><td>실시간 데이터 정제 및 저장</td><td>Kafka + Flink + Apache Hudi / Delta Lake</td><td>스트리밍 ETL, 데이터 레이크 실시간 동기화, 버전 관리</td></tr><tr><td><strong>실시간 대시보드</strong></td><td>KPI 및 비즈니스 지표 실시간 시각화</td><td>Kafka + Flink + Grafana / Apache Druid</td><td>운영 지표 가시화, 경고 시스템 구축</td></tr><tr><td><strong>추천 시스템</strong></td><td>사용자 행동 기반 콘텐츠/상품 추천</td><td>Kafka + Flink + Redis</td><td>개인화 추천, 클릭율 향상, 실시간 반영</td></tr><tr><td><strong>이벤트 기반 아키텍처</strong></td><td>마이크로서비스 간 이벤트 중심 통신</td><td>Kafka + Schema Registry + KSQL</td><td>비동기 트리거, 마이크로서비스 디커플링, 이벤트 소싱 구현</td></tr><tr><td><strong>소셜 피드 처리</strong></td><td>유저 피드 정렬, 최신 트렌드 반영</td><td>Kafka + Flink + Redis</td><td>실시간 피드 정렬, 실시간 트렌드 분석</td></tr><tr><td><strong>사물인터넷 대시보드</strong></td><td>실시간 IoT 상태 시각화 및 알림</td><td>Kafka + Flink + TimescaleDB + Grafana</td><td>IoT 상태 추적, 실시간 알림, 센서 이상 신속 대응</td></tr><tr><td><strong>사건 대응 자동화</strong></td><td>조건 기반 트리거 및 자동 처리</td><td>Kafka Streams + HBase / Apache NiFi</td><td>이벤트 조건 대응 자동화, Alert → 처리 파이프라인 연계</td></tr><tr><td><strong>스트리밍 분석 플랫폼</strong></td><td>대용량 로그/이벤트 스트리밍 통합 처리</td><td>Kafka + Flink + Apache Pinot / Apache Druid</td><td>다양한 데이터 소스 통합 분석, 쿼리 응답 최적화</td></tr><tr><td><strong>배치 보완용 스트리밍</strong></td><td>배치 지연 보완, 준실시간 분석 제공</td><td>Lambda (Spark + Kafka)</td><td>빠른 피드백 제공, 분석 지연 최소화</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-netflix-의-실시간-추천-시스템>사례 1: Netflix 의 실시간 추천 시스템<a hidden class=anchor aria-hidden=true href=#사례-1-netflix-의-실시간-추천-시스템>#</a></h4><p><strong>시스템 구성</strong>:</p><ul><li><strong>데이터 소스</strong>: 사용자 시청 이벤트, 평점, 검색 로그</li><li><strong>메시지 엔진</strong>: Apache Kafka (수십억 이벤트/일 처리)</li><li><strong>스트림 처리</strong>: Apache Flink 를 활용한 실시간 추천 알고리즘</li><li><strong>서빙 레이어</strong>: Cassandra + Redis 를 통한 고속 추천 결과 제공</li></ul><p><strong>시스템 다이어그램</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>graph TD
</span></span><span class=line><span class=cl>    A[Netflix Apps] --&gt; B[Kafka Event Streams]
</span></span><span class=line><span class=cl>    C[User Viewing Data] --&gt; B
</span></span><span class=line><span class=cl>    D[Content Metadata] --&gt; B
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    B --&gt; E[Flink Stream Processing]
</span></span><span class=line><span class=cl>    E --&gt; F[Real-time ML Models]
</span></span><span class=line><span class=cl>    F --&gt; G[Recommendation Engine]
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    G --&gt; H[Cassandra]
</span></span><span class=line><span class=cl>    G --&gt; I[Redis Cache]
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    H --&gt; J[Recommendation API]
</span></span><span class=line><span class=cl>    I --&gt; J
</span></span><span class=line><span class=cl>    J --&gt; K[Netflix UI]
</span></span></code></pre></td></tr></table></div></div><p><strong>Workflow</strong>:</p><ol><li>사용자가 콘텐츠를 시청하면 실시간 이벤트 생성</li><li>Kafka 가 이벤트를 수집하고 파티션별로 분산 저장</li><li>Flink 가 스트림 데이터를 처리하여 사용자 프로필 업데이트</li><li>실시간 머신러닝 모델이 추천 결과 생성</li><li>추천 결과를 Cassandra 와 Redis 에 저장</li><li>사용자가 Netflix 접속 시 즉시 개인화된 추천 제공</li></ol><p><strong>Kappa Architecture 의 역할</strong>:</p><ul><li>실시간 사용자 행동 분석으로 즉각적인 추천 업데이트</li><li>단일 스트림 처리 파이프라인으로 복잡성 최소화</li><li>이벤트 재생을 통한 추천 모델 재훈련 지원</li></ul><p><strong>Kappa Architecture 적용 전후 차이점</strong>:</p><table><thead><tr><th>구분</th><th>적용 전 (배치 처리)</th><th>적용 후 (Kappa)</th></tr></thead><tbody><tr><td>추천 업데이트 주기</td><td>24 시간</td><td>실시간</td></tr><tr><td>사용자 반응 반영 시간</td><td>하루 지연</td><td>즉시</td></tr><tr><td>시스템 복잡도</td><td>배치 + 실시간 이중 구조</td><td>단일 스트림 처리</td></tr><tr><td>개발 생산성</td><td>이중 코드베이스 유지</td><td>단일 코드베이스</td></tr><tr><td>비즈니스 효과</td><td>정적 추천</td><td>동적 개인화 추천</td></tr></tbody></table><h4 id=사례-2-실시간-금융-거래-모니터링-시스템>사례 2: 실시간 금융 거래 모니터링 시스템<a hidden class=anchor aria-hidden=true href=#사례-2-실시간-금융-거래-모니터링-시스템>#</a></h4><p><strong>시스템 구성:</strong></p><ul><li>거래 데이터 소스 → Kafka (메시지 큐) → Flink (스트림 처리) → HBase (저장소) → 실시간 모니터링 대시보드</li></ul><p><strong>Workflow:</strong></p><ol><li>거래 발생 시 Kafka 로 데이터 유입</li><li>Flink 가 실시간으로 데이터 처리 및 이상 거래 탐지</li><li>HBase 에 저장, 대시보드에 알림 및 시각화</li></ol><p><strong>Kappa Architecture 의 역할:</strong></p><ul><li>실시간 거래 감시, 이상 거래 탐지, 신속한 대응</li></ul><p><strong>Kappa Architecture 유무에 따른 차이:</strong></p><ul><li><strong>도입 전:</strong><br>실시간성과 배치 분석이 분리되어 중복 처리 및 지연 발생</li><li><strong>도입 후:</strong><br>실시간성과 배치 분석이 통합되어 중복 최소화, 신속한 탐지 및 대응 가능</li></ul><h4 id=사례-3-iot-스트림-처리-시스템>사례 3: IoT 스트림 처리 시스템<a hidden class=anchor aria-hidden=true href=#사례-3-iot-스트림-처리-시스템>#</a></h4><p><strong>시스템 구성</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>graph TD
</span></span><span class=line><span class=cl>  A[IoT Devices] --&gt; B[&#34;Kafka Broker (Immutable Log)&#34;]
</span></span><span class=line><span class=cl>  B --&gt; C[&#34;Flink Cluster (Stream Processing)&#34;]
</span></span><span class=line><span class=cl>  C --&gt; D[&#34;Time Series DB (InfluxDB)&#34;]
</span></span><span class=line><span class=cl>  D --&gt; E[Grafana Dashboard]
</span></span></code></pre></td></tr></table></div></div><p><strong>Workflow</strong>:</p><ol><li>IoT 디바이스 → 센서 데이터를 Kafka 토픽에 실시간 publish</li><li>Flink → Kafka 로부터 consume 하여 온도/진동 등 집계</li><li>InfluxDB 에 저장 → Grafana 에서 실시간 시각화</li></ol><p><strong>역할</strong>:</p><ul><li><strong>Kafka</strong>: 신뢰성 있는 이벤트 버퍼링</li><li><strong>Flink</strong>: 이상 징후 집계, 조건 탐지</li><li><strong>InfluxDB</strong>: 시계열 저장소로 빠른 조회 지원</li></ul><p><strong>Kappa 아키텍처 유무 차이</strong>:</p><table><thead><tr><th>항목</th><th>Kappa 적용</th><th>미적용</th></tr></thead><tbody><tr><td>시스템 단순성</td><td>단일 스트림으로 구성</td><td>배치 + 스트림 분리로 이중 관리 필요</td></tr><tr><td>재처리 유연성</td><td>로그 기반 전체 재처리 가능</td><td>배치 파이프라인 재구성 필요</td></tr><tr><td>장애 대응성</td><td>체크포인트 복구 가능</td><td>배치 지연 발생 시 장애 전파</td></tr></tbody></table><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><h4 id=python--kafka--faust>Python + Kafka + Faust<a hidden class=anchor aria-hidden=true href=#python--kafka--faust>#</a></h4><p>IoT 센서 데이터 (온도) 를 Kafka 토픽으로 수집하고, Kappa 아키텍처 기반으로 실시간 이상 온도를 감지하는 시스템을 <strong>Faust (Kafka 기반의 Python 스트림 처리 프레임워크)</strong> 로 구현.</p><p><strong>시스템 구성</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>flowchart TD
</span></span><span class=line><span class=cl>  A[IoT Device] --&gt; B[Kafka Topic: iot-temp]
</span></span><span class=line><span class=cl>  B --&gt; C[&#34;Faust Stream App (Python)&#34;]
</span></span><span class=line><span class=cl>  C --&gt; D[&#34;Alert Service (e.g., Slack, Email)&#34;]
</span></span><span class=line><span class=cl>  C --&gt; E[&#34;Materialized DB (Redis)&#34;]
</span></span></code></pre></td></tr></table></div></div><p><strong>구현 예시 (Python - Faust)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26>26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27>27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28>28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29>29</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># faust_app.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>faust</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka Topic 이름과 메시지 구조 정의</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TemperatureEvent</span><span class=p>(</span><span class=n>faust</span><span class=o>.</span><span class=n>Record</span><span class=p>,</span> <span class=n>serializer</span><span class=o>=</span><span class=s1>&#39;json&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>device_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>temperature</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>faust</span><span class=o>.</span><span class=n>App</span><span class=p>(</span><span class=s1>&#39;kappa-iot-app&#39;</span><span class=p>,</span> <span class=n>broker</span><span class=o>=</span><span class=s1>&#39;kafka://localhost:9092&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 입력 토픽</span>
</span></span><span class=line><span class=cl><span class=n>temp_topic</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>topic</span><span class=p>(</span><span class=s1>&#39;iot-temp&#39;</span><span class=p>,</span> <span class=n>value_type</span><span class=o>=</span><span class=n>TemperatureEvent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 테이블 (materialized view 역할)</span>
</span></span><span class=line><span class=cl><span class=n>alert_store</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>Table</span><span class=p>(</span><span class=s1>&#39;overheat-events&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 스트림 처리 로직</span>
</span></span><span class=line><span class=cl><span class=nd>@app.agent</span><span class=p>(</span><span class=n>temp_topic</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>process_temperature</span><span class=p>(</span><span class=n>stream</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>stream</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>temperature</span> <span class=o>&gt;</span> <span class=mf>75.0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>alert_store</span><span class=p>[</span><span class=n>event</span><span class=o>.</span><span class=n>device_id</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[ALERT] </span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>device_id</span><span class=si>}</span><span class=s2> temperature </span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>temperature</span><span class=si>}</span><span class=s2> exceeds threshold!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>device_id</span><span class=si>}</span><span class=s2>: temperature is normal (</span><span class=si>{</span><span class=n>event</span><span class=o>.</span><span class=n>temperature</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><code>Kafka Topic</code></td><td>IoT 센서에서 실시간 데이터가 발행되는 주제 (iot-temp)</td></tr><tr><td><code>Faust Stream</code></td><td>Kafka 스트림을 수신하여 이벤트를 처리</td></tr><tr><td><code>Materialized Table</code></td><td>장비별 이상 발생 횟수 저장 및 상태 유지</td></tr><tr><td><code>Event Replay</code></td><td>Kafka 오프셋을 처음으로 되돌리면 전체 재처리 가능 (재분석 or 모델 수정 대응)</td></tr></tbody></table><h4 id=python-kafka--flink-기반>Python, Kafka + Flink 기반<a hidden class=anchor aria-hidden=true href=#python-kafka--flink-기반>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25>25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26>26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27>27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28>28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29>29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30>30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31>31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32>32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Kafka에서 거래 데이터 스트림을 수신하고 Flink로 실시간 처리하는 예시</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyflink.datastream</span> <span class=kn>import</span> <span class=n>StreamExecutionEnvironment</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyflink.datastream.connectors</span> <span class=kn>import</span> <span class=n>FlinkKafkaConsumer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyflink.common.serialization</span> <span class=kn>import</span> <span class=n>SimpleStringSchema</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 환경 설정</span>
</span></span><span class=line><span class=cl><span class=n>env</span> <span class=o>=</span> <span class=n>StreamExecutionEnvironment</span><span class=o>.</span><span class=n>get_execution_environment</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka Consumer 생성</span>
</span></span><span class=line><span class=cl><span class=n>kafka_consumer</span> <span class=o>=</span> <span class=n>FlinkKafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>topics</span><span class=o>=</span><span class=s1>&#39;transactions&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>deserialization_schema</span><span class=o>=</span><span class=n>SimpleStringSchema</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=n>properties</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;bootstrap.servers&#39;</span><span class=p>:</span> <span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span> <span class=s1>&#39;group.id&#39;</span><span class=p>:</span> <span class=s1>&#39;monitoring-group&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 데이터 스트림 생성</span>
</span></span><span class=line><span class=cl><span class=n>stream</span> <span class=o>=</span> <span class=n>env</span><span class=o>.</span><span class=n>add_source</span><span class=p>(</span><span class=n>kafka_consumer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실시간 이상 거래 탐지 로직 (예시)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>detect_fraud</span><span class=p>(</span><span class=n>transaction</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 거래 금액이 1000만원 이상이면 이상 거래로 간주</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>transaction</span><span class=o>.</span><span class=n>amount</span> <span class=o>&gt;</span> <span class=mi>10000000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이상 거래 필터링</span>
</span></span><span class=line><span class=cl><span class=n>fraud_stream</span> <span class=o>=</span> <span class=n>stream</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>detect_fraud</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 결과 출력 또는 저장</span>
</span></span><span class=line><span class=cl><span class=n>fraud_stream</span><span class=o>.</span><span class=n>print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>env</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;Real-Time Transaction Monitoring&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>설명:</strong><br>Kafka 에서 거래 데이터를 실시간으로 수신하고, Flink 에서 이상 거래를 탐지하여 실시간으로 결과를 출력한다.</li></ul><h4 id=python-실시간-추천-시스템>Python: 실시간 추천 시스템<a hidden class=anchor aria-hidden=true href=#python-실시간-추천-시스템>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>  1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>  2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>  3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>  4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5>  5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6>  6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7>  7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8>  8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9>  9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10> 10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11> 11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12> 12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13> 13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14> 14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15> 15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16> 16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17> 17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18> 18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19> 19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20> 20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21> 21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22> 22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23> 23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24> 24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25> 25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26> 26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27> 27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28> 28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29> 29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30> 30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31> 31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32> 32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33> 33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34> 34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35> 35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36> 36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37> 37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38> 38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39> 39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40> 40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41> 41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42> 42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43> 43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44> 44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45> 45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46> 46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47> 47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48> 48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49> 49</a>
</span><span class=lnt id=hl-16-50><a class=lnlinks href=#hl-16-50> 50</a>
</span><span class=lnt id=hl-16-51><a class=lnlinks href=#hl-16-51> 51</a>
</span><span class=lnt id=hl-16-52><a class=lnlinks href=#hl-16-52> 52</a>
</span><span class=lnt id=hl-16-53><a class=lnlinks href=#hl-16-53> 53</a>
</span><span class=lnt id=hl-16-54><a class=lnlinks href=#hl-16-54> 54</a>
</span><span class=lnt id=hl-16-55><a class=lnlinks href=#hl-16-55> 55</a>
</span><span class=lnt id=hl-16-56><a class=lnlinks href=#hl-16-56> 56</a>
</span><span class=lnt id=hl-16-57><a class=lnlinks href=#hl-16-57> 57</a>
</span><span class=lnt id=hl-16-58><a class=lnlinks href=#hl-16-58> 58</a>
</span><span class=lnt id=hl-16-59><a class=lnlinks href=#hl-16-59> 59</a>
</span><span class=lnt id=hl-16-60><a class=lnlinks href=#hl-16-60> 60</a>
</span><span class=lnt id=hl-16-61><a class=lnlinks href=#hl-16-61> 61</a>
</span><span class=lnt id=hl-16-62><a class=lnlinks href=#hl-16-62> 62</a>
</span><span class=lnt id=hl-16-63><a class=lnlinks href=#hl-16-63> 63</a>
</span><span class=lnt id=hl-16-64><a class=lnlinks href=#hl-16-64> 64</a>
</span><span class=lnt id=hl-16-65><a class=lnlinks href=#hl-16-65> 65</a>
</span><span class=lnt id=hl-16-66><a class=lnlinks href=#hl-16-66> 66</a>
</span><span class=lnt id=hl-16-67><a class=lnlinks href=#hl-16-67> 67</a>
</span><span class=lnt id=hl-16-68><a class=lnlinks href=#hl-16-68> 68</a>
</span><span class=lnt id=hl-16-69><a class=lnlinks href=#hl-16-69> 69</a>
</span><span class=lnt id=hl-16-70><a class=lnlinks href=#hl-16-70> 70</a>
</span><span class=lnt id=hl-16-71><a class=lnlinks href=#hl-16-71> 71</a>
</span><span class=lnt id=hl-16-72><a class=lnlinks href=#hl-16-72> 72</a>
</span><span class=lnt id=hl-16-73><a class=lnlinks href=#hl-16-73> 73</a>
</span><span class=lnt id=hl-16-74><a class=lnlinks href=#hl-16-74> 74</a>
</span><span class=lnt id=hl-16-75><a class=lnlinks href=#hl-16-75> 75</a>
</span><span class=lnt id=hl-16-76><a class=lnlinks href=#hl-16-76> 76</a>
</span><span class=lnt id=hl-16-77><a class=lnlinks href=#hl-16-77> 77</a>
</span><span class=lnt id=hl-16-78><a class=lnlinks href=#hl-16-78> 78</a>
</span><span class=lnt id=hl-16-79><a class=lnlinks href=#hl-16-79> 79</a>
</span><span class=lnt id=hl-16-80><a class=lnlinks href=#hl-16-80> 80</a>
</span><span class=lnt id=hl-16-81><a class=lnlinks href=#hl-16-81> 81</a>
</span><span class=lnt id=hl-16-82><a class=lnlinks href=#hl-16-82> 82</a>
</span><span class=lnt id=hl-16-83><a class=lnlinks href=#hl-16-83> 83</a>
</span><span class=lnt id=hl-16-84><a class=lnlinks href=#hl-16-84> 84</a>
</span><span class=lnt id=hl-16-85><a class=lnlinks href=#hl-16-85> 85</a>
</span><span class=lnt id=hl-16-86><a class=lnlinks href=#hl-16-86> 86</a>
</span><span class=lnt id=hl-16-87><a class=lnlinks href=#hl-16-87> 87</a>
</span><span class=lnt id=hl-16-88><a class=lnlinks href=#hl-16-88> 88</a>
</span><span class=lnt id=hl-16-89><a class=lnlinks href=#hl-16-89> 89</a>
</span><span class=lnt id=hl-16-90><a class=lnlinks href=#hl-16-90> 90</a>
</span><span class=lnt id=hl-16-91><a class=lnlinks href=#hl-16-91> 91</a>
</span><span class=lnt id=hl-16-92><a class=lnlinks href=#hl-16-92> 92</a>
</span><span class=lnt id=hl-16-93><a class=lnlinks href=#hl-16-93> 93</a>
</span><span class=lnt id=hl-16-94><a class=lnlinks href=#hl-16-94> 94</a>
</span><span class=lnt id=hl-16-95><a class=lnlinks href=#hl-16-95> 95</a>
</span><span class=lnt id=hl-16-96><a class=lnlinks href=#hl-16-96> 96</a>
</span><span class=lnt id=hl-16-97><a class=lnlinks href=#hl-16-97> 97</a>
</span><span class=lnt id=hl-16-98><a class=lnlinks href=#hl-16-98> 98</a>
</span><span class=lnt id=hl-16-99><a class=lnlinks href=#hl-16-99> 99</a>
</span><span class=lnt id=hl-16-100><a class=lnlinks href=#hl-16-100>100</a>
</span><span class=lnt id=hl-16-101><a class=lnlinks href=#hl-16-101>101</a>
</span><span class=lnt id=hl-16-102><a class=lnlinks href=#hl-16-102>102</a>
</span><span class=lnt id=hl-16-103><a class=lnlinks href=#hl-16-103>103</a>
</span><span class=lnt id=hl-16-104><a class=lnlinks href=#hl-16-104>104</a>
</span><span class=lnt id=hl-16-105><a class=lnlinks href=#hl-16-105>105</a>
</span><span class=lnt id=hl-16-106><a class=lnlinks href=#hl-16-106>106</a>
</span><span class=lnt id=hl-16-107><a class=lnlinks href=#hl-16-107>107</a>
</span><span class=lnt id=hl-16-108><a class=lnlinks href=#hl-16-108>108</a>
</span><span class=lnt id=hl-16-109><a class=lnlinks href=#hl-16-109>109</a>
</span><span class=lnt id=hl-16-110><a class=lnlinks href=#hl-16-110>110</a>
</span><span class=lnt id=hl-16-111><a class=lnlinks href=#hl-16-111>111</a>
</span><span class=lnt id=hl-16-112><a class=lnlinks href=#hl-16-112>112</a>
</span><span class=lnt id=hl-16-113><a class=lnlinks href=#hl-16-113>113</a>
</span><span class=lnt id=hl-16-114><a class=lnlinks href=#hl-16-114>114</a>
</span><span class=lnt id=hl-16-115><a class=lnlinks href=#hl-16-115>115</a>
</span><span class=lnt id=hl-16-116><a class=lnlinks href=#hl-16-116>116</a>
</span><span class=lnt id=hl-16-117><a class=lnlinks href=#hl-16-117>117</a>
</span><span class=lnt id=hl-16-118><a class=lnlinks href=#hl-16-118>118</a>
</span><span class=lnt id=hl-16-119><a class=lnlinks href=#hl-16-119>119</a>
</span><span class=lnt id=hl-16-120><a class=lnlinks href=#hl-16-120>120</a>
</span><span class=lnt id=hl-16-121><a class=lnlinks href=#hl-16-121>121</a>
</span><span class=lnt id=hl-16-122><a class=lnlinks href=#hl-16-122>122</a>
</span><span class=lnt id=hl-16-123><a class=lnlinks href=#hl-16-123>123</a>
</span><span class=lnt id=hl-16-124><a class=lnlinks href=#hl-16-124>124</a>
</span><span class=lnt id=hl-16-125><a class=lnlinks href=#hl-16-125>125</a>
</span><span class=lnt id=hl-16-126><a class=lnlinks href=#hl-16-126>126</a>
</span><span class=lnt id=hl-16-127><a class=lnlinks href=#hl-16-127>127</a>
</span><span class=lnt id=hl-16-128><a class=lnlinks href=#hl-16-128>128</a>
</span><span class=lnt id=hl-16-129><a class=lnlinks href=#hl-16-129>129</a>
</span><span class=lnt id=hl-16-130><a class=lnlinks href=#hl-16-130>130</a>
</span><span class=lnt id=hl-16-131><a class=lnlinks href=#hl-16-131>131</a>
</span><span class=lnt id=hl-16-132><a class=lnlinks href=#hl-16-132>132</a>
</span><span class=lnt id=hl-16-133><a class=lnlinks href=#hl-16-133>133</a>
</span><span class=lnt id=hl-16-134><a class=lnlinks href=#hl-16-134>134</a>
</span><span class=lnt id=hl-16-135><a class=lnlinks href=#hl-16-135>135</a>
</span><span class=lnt id=hl-16-136><a class=lnlinks href=#hl-16-136>136</a>
</span><span class=lnt id=hl-16-137><a class=lnlinks href=#hl-16-137>137</a>
</span><span class=lnt id=hl-16-138><a class=lnlinks href=#hl-16-138>138</a>
</span><span class=lnt id=hl-16-139><a class=lnlinks href=#hl-16-139>139</a>
</span><span class=lnt id=hl-16-140><a class=lnlinks href=#hl-16-140>140</a>
</span><span class=lnt id=hl-16-141><a class=lnlinks href=#hl-16-141>141</a>
</span><span class=lnt id=hl-16-142><a class=lnlinks href=#hl-16-142>142</a>
</span><span class=lnt id=hl-16-143><a class=lnlinks href=#hl-16-143>143</a>
</span><span class=lnt id=hl-16-144><a class=lnlinks href=#hl-16-144>144</a>
</span><span class=lnt id=hl-16-145><a class=lnlinks href=#hl-16-145>145</a>
</span><span class=lnt id=hl-16-146><a class=lnlinks href=#hl-16-146>146</a>
</span><span class=lnt id=hl-16-147><a class=lnlinks href=#hl-16-147>147</a>
</span><span class=lnt id=hl-16-148><a class=lnlinks href=#hl-16-148>148</a>
</span><span class=lnt id=hl-16-149><a class=lnlinks href=#hl-16-149>149</a>
</span><span class=lnt id=hl-16-150><a class=lnlinks href=#hl-16-150>150</a>
</span><span class=lnt id=hl-16-151><a class=lnlinks href=#hl-16-151>151</a>
</span><span class=lnt id=hl-16-152><a class=lnlinks href=#hl-16-152>152</a>
</span><span class=lnt id=hl-16-153><a class=lnlinks href=#hl-16-153>153</a>
</span><span class=lnt id=hl-16-154><a class=lnlinks href=#hl-16-154>154</a>
</span><span class=lnt id=hl-16-155><a class=lnlinks href=#hl-16-155>155</a>
</span><span class=lnt id=hl-16-156><a class=lnlinks href=#hl-16-156>156</a>
</span><span class=lnt id=hl-16-157><a class=lnlinks href=#hl-16-157>157</a>
</span><span class=lnt id=hl-16-158><a class=lnlinks href=#hl-16-158>158</a>
</span><span class=lnt id=hl-16-159><a class=lnlinks href=#hl-16-159>159</a>
</span><span class=lnt id=hl-16-160><a class=lnlinks href=#hl-16-160>160</a>
</span><span class=lnt id=hl-16-161><a class=lnlinks href=#hl-16-161>161</a>
</span><span class=lnt id=hl-16-162><a class=lnlinks href=#hl-16-162>162</a>
</span><span class=lnt id=hl-16-163><a class=lnlinks href=#hl-16-163>163</a>
</span><span class=lnt id=hl-16-164><a class=lnlinks href=#hl-16-164>164</a>
</span><span class=lnt id=hl-16-165><a class=lnlinks href=#hl-16-165>165</a>
</span><span class=lnt id=hl-16-166><a class=lnlinks href=#hl-16-166>166</a>
</span><span class=lnt id=hl-16-167><a class=lnlinks href=#hl-16-167>167</a>
</span><span class=lnt id=hl-16-168><a class=lnlinks href=#hl-16-168>168</a>
</span><span class=lnt id=hl-16-169><a class=lnlinks href=#hl-16-169>169</a>
</span><span class=lnt id=hl-16-170><a class=lnlinks href=#hl-16-170>170</a>
</span><span class=lnt id=hl-16-171><a class=lnlinks href=#hl-16-171>171</a>
</span><span class=lnt id=hl-16-172><a class=lnlinks href=#hl-16-172>172</a>
</span><span class=lnt id=hl-16-173><a class=lnlinks href=#hl-16-173>173</a>
</span><span class=lnt id=hl-16-174><a class=lnlinks href=#hl-16-174>174</a>
</span><span class=lnt id=hl-16-175><a class=lnlinks href=#hl-16-175>175</a>
</span><span class=lnt id=hl-16-176><a class=lnlinks href=#hl-16-176>176</a>
</span><span class=lnt id=hl-16-177><a class=lnlinks href=#hl-16-177>177</a>
</span><span class=lnt id=hl-16-178><a class=lnlinks href=#hl-16-178>178</a>
</span><span class=lnt id=hl-16-179><a class=lnlinks href=#hl-16-179>179</a>
</span><span class=lnt id=hl-16-180><a class=lnlinks href=#hl-16-180>180</a>
</span><span class=lnt id=hl-16-181><a class=lnlinks href=#hl-16-181>181</a>
</span><span class=lnt id=hl-16-182><a class=lnlinks href=#hl-16-182>182</a>
</span><span class=lnt id=hl-16-183><a class=lnlinks href=#hl-16-183>183</a>
</span><span class=lnt id=hl-16-184><a class=lnlinks href=#hl-16-184>184</a>
</span><span class=lnt id=hl-16-185><a class=lnlinks href=#hl-16-185>185</a>
</span><span class=lnt id=hl-16-186><a class=lnlinks href=#hl-16-186>186</a>
</span><span class=lnt id=hl-16-187><a class=lnlinks href=#hl-16-187>187</a>
</span><span class=lnt id=hl-16-188><a class=lnlinks href=#hl-16-188>188</a>
</span><span class=lnt id=hl-16-189><a class=lnlinks href=#hl-16-189>189</a>
</span><span class=lnt id=hl-16-190><a class=lnlinks href=#hl-16-190>190</a>
</span><span class=lnt id=hl-16-191><a class=lnlinks href=#hl-16-191>191</a>
</span><span class=lnt id=hl-16-192><a class=lnlinks href=#hl-16-192>192</a>
</span><span class=lnt id=hl-16-193><a class=lnlinks href=#hl-16-193>193</a>
</span><span class=lnt id=hl-16-194><a class=lnlinks href=#hl-16-194>194</a>
</span><span class=lnt id=hl-16-195><a class=lnlinks href=#hl-16-195>195</a>
</span><span class=lnt id=hl-16-196><a class=lnlinks href=#hl-16-196>196</a>
</span><span class=lnt id=hl-16-197><a class=lnlinks href=#hl-16-197>197</a>
</span><span class=lnt id=hl-16-198><a class=lnlinks href=#hl-16-198>198</a>
</span><span class=lnt id=hl-16-199><a class=lnlinks href=#hl-16-199>199</a>
</span><span class=lnt id=hl-16-200><a class=lnlinks href=#hl-16-200>200</a>
</span><span class=lnt id=hl-16-201><a class=lnlinks href=#hl-16-201>201</a>
</span><span class=lnt id=hl-16-202><a class=lnlinks href=#hl-16-202>202</a>
</span><span class=lnt id=hl-16-203><a class=lnlinks href=#hl-16-203>203</a>
</span><span class=lnt id=hl-16-204><a class=lnlinks href=#hl-16-204>204</a>
</span><span class=lnt id=hl-16-205><a class=lnlinks href=#hl-16-205>205</a>
</span><span class=lnt id=hl-16-206><a class=lnlinks href=#hl-16-206>206</a>
</span><span class=lnt id=hl-16-207><a class=lnlinks href=#hl-16-207>207</a>
</span><span class=lnt id=hl-16-208><a class=lnlinks href=#hl-16-208>208</a>
</span><span class=lnt id=hl-16-209><a class=lnlinks href=#hl-16-209>209</a>
</span><span class=lnt id=hl-16-210><a class=lnlinks href=#hl-16-210>210</a>
</span><span class=lnt id=hl-16-211><a class=lnlinks href=#hl-16-211>211</a>
</span><span class=lnt id=hl-16-212><a class=lnlinks href=#hl-16-212>212</a>
</span><span class=lnt id=hl-16-213><a class=lnlinks href=#hl-16-213>213</a>
</span><span class=lnt id=hl-16-214><a class=lnlinks href=#hl-16-214>214</a>
</span><span class=lnt id=hl-16-215><a class=lnlinks href=#hl-16-215>215</a>
</span><span class=lnt id=hl-16-216><a class=lnlinks href=#hl-16-216>216</a>
</span><span class=lnt id=hl-16-217><a class=lnlinks href=#hl-16-217>217</a>
</span><span class=lnt id=hl-16-218><a class=lnlinks href=#hl-16-218>218</a>
</span><span class=lnt id=hl-16-219><a class=lnlinks href=#hl-16-219>219</a>
</span><span class=lnt id=hl-16-220><a class=lnlinks href=#hl-16-220>220</a>
</span><span class=lnt id=hl-16-221><a class=lnlinks href=#hl-16-221>221</a>
</span><span class=lnt id=hl-16-222><a class=lnlinks href=#hl-16-222>222</a>
</span><span class=lnt id=hl-16-223><a class=lnlinks href=#hl-16-223>223</a>
</span><span class=lnt id=hl-16-224><a class=lnlinks href=#hl-16-224>224</a>
</span><span class=lnt id=hl-16-225><a class=lnlinks href=#hl-16-225>225</a>
</span><span class=lnt id=hl-16-226><a class=lnlinks href=#hl-16-226>226</a>
</span><span class=lnt id=hl-16-227><a class=lnlinks href=#hl-16-227>227</a>
</span><span class=lnt id=hl-16-228><a class=lnlinks href=#hl-16-228>228</a>
</span><span class=lnt id=hl-16-229><a class=lnlinks href=#hl-16-229>229</a>
</span><span class=lnt id=hl-16-230><a class=lnlinks href=#hl-16-230>230</a>
</span><span class=lnt id=hl-16-231><a class=lnlinks href=#hl-16-231>231</a>
</span><span class=lnt id=hl-16-232><a class=lnlinks href=#hl-16-232>232</a>
</span><span class=lnt id=hl-16-233><a class=lnlinks href=#hl-16-233>233</a>
</span><span class=lnt id=hl-16-234><a class=lnlinks href=#hl-16-234>234</a>
</span><span class=lnt id=hl-16-235><a class=lnlinks href=#hl-16-235>235</a>
</span><span class=lnt id=hl-16-236><a class=lnlinks href=#hl-16-236>236</a>
</span><span class=lnt id=hl-16-237><a class=lnlinks href=#hl-16-237>237</a>
</span><span class=lnt id=hl-16-238><a class=lnlinks href=#hl-16-238>238</a>
</span><span class=lnt id=hl-16-239><a class=lnlinks href=#hl-16-239>239</a>
</span><span class=lnt id=hl-16-240><a class=lnlinks href=#hl-16-240>240</a>
</span><span class=lnt id=hl-16-241><a class=lnlinks href=#hl-16-241>241</a>
</span><span class=lnt id=hl-16-242><a class=lnlinks href=#hl-16-242>242</a>
</span><span class=lnt id=hl-16-243><a class=lnlinks href=#hl-16-243>243</a>
</span><span class=lnt id=hl-16-244><a class=lnlinks href=#hl-16-244>244</a>
</span><span class=lnt id=hl-16-245><a class=lnlinks href=#hl-16-245>245</a>
</span><span class=lnt id=hl-16-246><a class=lnlinks href=#hl-16-246>246</a>
</span><span class=lnt id=hl-16-247><a class=lnlinks href=#hl-16-247>247</a>
</span><span class=lnt id=hl-16-248><a class=lnlinks href=#hl-16-248>248</a>
</span><span class=lnt id=hl-16-249><a class=lnlinks href=#hl-16-249>249</a>
</span><span class=lnt id=hl-16-250><a class=lnlinks href=#hl-16-250>250</a>
</span><span class=lnt id=hl-16-251><a class=lnlinks href=#hl-16-251>251</a>
</span><span class=lnt id=hl-16-252><a class=lnlinks href=#hl-16-252>252</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Kafka Consumer를 활용한 실시간 이벤트 처리</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span><span class=p>,</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>KappaRecommendationEngine</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Kappa Architecture 기반 실시간 추천 엔진
</span></span></span><span class=line><span class=cl><span class=s2>    단일 스트림 처리로 사용자 행동을 실시간 분석하여 추천 생성
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Kafka Consumer 설정 - 사용자 이벤트 스트림 수신</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user-events&#39;</span><span class=p>,</span>  <span class=c1># 사용자 행동 이벤트 토픽</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>            <span class=n>group_id</span><span class=o>=</span><span class=s1>&#39;recommendation-engine&#39;</span>  <span class=c1># 컨슈머 그룹 설정</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Kafka Producer 설정 - 추천 결과 스트림 전송</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Redis 캐시 설정 - 실시간 추천 결과 저장</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 사용자 프로필 캐시 (메모리 기반 상태 관리)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_event_stream</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        실시간 이벤트 스트림 처리
</span></span></span><span class=line><span class=cl><span class=s2>        Kappa Architecture의 핵심 - 모든 데이터를 스트림으로 처리
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>event</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Processing event: </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 이벤트 타입별 처리 (스트림 처리 로직)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;view&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_handle_view_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;rating&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_handle_rating_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;search&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_handle_search_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 실시간 추천 생성 및 업데이트</span>
</span></span><span class=line><span class=cl>                <span class=n>recommendations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_generate_recommendations</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_update_recommendations</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>],</span> <span class=n>recommendations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error processing event: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_handle_view_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        시청 이벤트 처리 - 사용자 선호도 실시간 업데이트
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>content_id</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;content_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>watch_duration</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;watch_duration&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 사용자 프로필 업데이트 (상태 관리)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>user_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;viewed_content&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;preferences&#39;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;last_activity&#39;</span><span class=p>:</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 시청 기록 추가</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;viewed_content&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;content_id&#39;</span><span class=p>:</span> <span class=n>content_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;watch_duration&#39;</span><span class=p>:</span> <span class=n>watch_duration</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 선호도 점수 계산 (시청 시간 기반)</span>
</span></span><span class=line><span class=cl>        <span class=n>preference_score</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>watch_duration</span> <span class=o>/</span> <span class=mi>3600</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>  <span class=c1># 최대 1시간 기준 정규화</span>
</span></span><span class=line><span class=cl>        <span class=n>genre</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_content_genre</span><span class=p>(</span><span class=n>content_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>genre</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 기존 선호도와 가중 평균</span>
</span></span><span class=line><span class=cl>            <span class=n>current_score</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>][</span><span class=n>genre</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>new_score</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_score</span> <span class=o>*</span> <span class=mf>0.8</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>preference_score</span> <span class=o>*</span> <span class=mf>0.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>][</span><span class=n>genre</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_score</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>][</span><span class=n>genre</span><span class=p>]</span> <span class=o>=</span> <span class=n>preference_score</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_handle_rating_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        평점 이벤트 처리 - 명시적 피드백 반영
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;user_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>content_id</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;content_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>rating</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;rating&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 평점 기반 선호도 조정</span>
</span></span><span class=line><span class=cl>        <span class=n>genre</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_content_genre</span><span class=p>(</span><span class=n>content_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>rating_score</span> <span class=o>=</span> <span class=p>(</span><span class=n>rating</span> <span class=o>-</span> <span class=mf>2.5</span><span class=p>)</span> <span class=o>/</span> <span class=mf>2.5</span>  <span class=c1># -1 ~ 1 범위로 정규화</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>user_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>genre</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_score</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>][</span><span class=n>genre</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=c1># 평점은 더 높은 가중치 적용</span>
</span></span><span class=line><span class=cl>                <span class=n>new_score</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_score</span> <span class=o>*</span> <span class=mf>0.6</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>rating_score</span> <span class=o>*</span> <span class=mf>0.4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>][</span><span class=n>genre</span><span class=p>]</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>new_score</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_generate_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        실시간 추천 생성 - 협업 필터링 + 콘텐츠 기반 필터링
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>user_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_popular_content</span><span class=p>()</span>  <span class=c1># 신규 사용자 대상 인기 콘텐츠</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>user_preferences</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>viewed_content</span> <span class=o>=</span> <span class=p>[</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;content_id&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;viewed_content&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 선호 장르 기반 콘텐츠 추천</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendations</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 상위 선호 장르 선택</span>
</span></span><span class=line><span class=cl>        <span class=n>top_genres</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>user_preferences</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)[:</span><span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>genre</span><span class=p>,</span> <span class=n>preference_score</span> <span class=ow>in</span> <span class=n>top_genres</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>preference_score</span> <span class=o>&gt;</span> <span class=mf>0.3</span><span class=p>:</span>  <span class=c1># 최소 선호도 기준</span>
</span></span><span class=line><span class=cl>                <span class=n>genre_content</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_content_by_genre</span><span class=p>(</span><span class=n>genre</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># 이미 본 콘텐츠 제외</span>
</span></span><span class=line><span class=cl>                <span class=n>new_content</span> <span class=o>=</span> <span class=p>[</span><span class=n>c</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>genre_content</span> <span class=k>if</span> <span class=n>c</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>viewed_content</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>recommendations</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>new_content</span><span class=p>[:</span><span class=mi>5</span><span class=p>])</span>  <span class=c1># 장르별 5개까지</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 유사 사용자 기반 추천 (협업 필터링)</span>
</span></span><span class=line><span class=cl>        <span class=n>similar_users</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_find_similar_users</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>similar_user</span> <span class=ow>in</span> <span class=n>similar_users</span><span class=p>[:</span><span class=mi>3</span><span class=p>]:</span>  <span class=c1># 상위 3명의 유사 사용자</span>
</span></span><span class=line><span class=cl>            <span class=n>similar_content</span> <span class=o>=</span> <span class=p>[</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;content_id&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>similar_user</span><span class=p>][</span><span class=s1>&#39;viewed_content&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>            <span class=n>new_content</span> <span class=o>=</span> <span class=p>[</span><span class=n>c</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>similar_content</span> <span class=k>if</span> <span class=n>c</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>viewed_content</span> <span class=ow>and</span> <span class=n>c</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>recommendations</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>recommendations</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>new_content</span><span class=p>[:</span><span class=mi>3</span><span class=p>])</span>  <span class=c1># 유사 사용자별 3개까지</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>recommendations</span><span class=p>[:</span><span class=mi>10</span><span class=p>]</span>  <span class=c1># 최대 10개 추천</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_update_recommendations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>recommendations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        추천 결과를 Redis에 캐시하고 추천 스트림으로 전송
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Redis에 추천 결과 저장 (TTL 설정)</span>
</span></span><span class=line><span class=cl>        <span class=n>cache_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;recommendations:</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>recommendation_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;recommendations&#39;</span><span class=p>:</span> <span class=n>recommendations</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>cache_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>3600</span><span class=p>,</span>  <span class=c1># 1시간 TTL</span>
</span></span><span class=line><span class=cl>            <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>recommendation_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Kafka로 추천 결과 스트림 전송</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;recommendations&#39;</span><span class=p>,</span> <span class=n>recommendation_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Updated recommendations for user </span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>recommendations</span><span class=p>)</span><span class=si>}</span><span class=s2> items&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_content_genre</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>content_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        콘텐츠 장르 조회 (실제 구현에서는 외부 메타데이터 서비스 호출)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 간단한 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=n>genres</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;action&#39;</span><span class=p>,</span> <span class=s1>&#39;comedy&#39;</span><span class=p>,</span> <span class=s1>&#39;drama&#39;</span><span class=p>,</span> <span class=s1>&#39;thriller&#39;</span><span class=p>,</span> <span class=s1>&#39;documentary&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>genres</span><span class=p>[</span><span class=nb>hash</span><span class=p>(</span><span class=n>content_id</span><span class=p>)</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>genres</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_content_by_genre</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>genre</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        장르별 콘텐츠 조회
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 구현에서는 콘텐츠 카탈로그 서비스 호출</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>genre</span><span class=si>}</span><span class=s2>_content_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>21</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_find_similar_users</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        유사 사용자 찾기 - 코사인 유사도 기반
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>user_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>target_preferences</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=p>[</span><span class=n>user_id</span><span class=p>][</span><span class=s1>&#39;preferences&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>similar_users</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>other_user_id</span><span class=p>,</span> <span class=n>profile</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>user_profiles</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>other_user_id</span> <span class=o>==</span> <span class=n>user_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 코사인 유사도 계산</span>
</span></span><span class=line><span class=cl>            <span class=n>similarity</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calculate_cosine_similarity</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>target_preferences</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>profile</span><span class=p>[</span><span class=s1>&#39;preferences&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>similarity</span> <span class=o>&gt;</span> <span class=mf>0.7</span><span class=p>:</span>  <span class=c1># 유사도 임계값</span>
</span></span><span class=line><span class=cl>                <span class=n>similar_users</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>other_user_id</span><span class=p>,</span> <span class=n>similarity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 유사도 순으로 정렬</span>
</span></span><span class=line><span class=cl>        <span class=n>similar_users</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>user_id</span> <span class=k>for</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>similar_users</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_calculate_cosine_similarity</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>prefs1</span><span class=p>,</span> <span class=n>prefs2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        코사인 유사도 계산
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 공통 장르 찾기</span>
</span></span><span class=line><span class=cl>        <span class=n>common_genres</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>prefs1</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span> <span class=o>&amp;</span> <span class=nb>set</span><span class=p>(</span><span class=n>prefs2</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>common_genres</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 벡터 내적과 크기 계산</span>
</span></span><span class=line><span class=cl>        <span class=n>dot_product</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>prefs1</span><span class=p>[</span><span class=n>genre</span><span class=p>]</span> <span class=o>*</span> <span class=n>prefs2</span><span class=p>[</span><span class=n>genre</span><span class=p>]</span> <span class=k>for</span> <span class=n>genre</span> <span class=ow>in</span> <span class=n>common_genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>norm1</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>prefs1</span><span class=p>[</span><span class=n>genre</span><span class=p>]</span> <span class=o>**</span> <span class=mi>2</span> <span class=k>for</span> <span class=n>genre</span> <span class=ow>in</span> <span class=n>common_genres</span><span class=p>)</span> <span class=o>**</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>        <span class=n>norm2</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>prefs2</span><span class=p>[</span><span class=n>genre</span><span class=p>]</span> <span class=o>**</span> <span class=mi>2</span> <span class=k>for</span> <span class=n>genre</span> <span class=ow>in</span> <span class=n>common_genres</span><span class=p>)</span> <span class=o>**</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>norm1</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>norm2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>dot_product</span> <span class=o>/</span> <span class=p>(</span><span class=n>norm1</span> <span class=o>*</span> <span class=n>norm2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_popular_content</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        인기 콘텐츠 조회 (신규 사용자용)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&#34;popular_content_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>11</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행 예시</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Kappa Architecture 추천 엔진 실행
</span></span></span><span class=line><span class=cl><span class=s2>    모든 사용자 이벤트를 실시간 스트림으로 처리하여 즉시 추천 업데이트
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>engine</span> <span class=o>=</span> <span class=n>KappaRecommendationEngine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 실시간 이벤트 스트림 처리 시작</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Starting Kappa Recommendation Engine…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Processing real-time user events…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>engine</span><span class=o>.</span><span class=n>process_event_stream</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>고려 요소</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td><strong>아키텍처 설계</strong></td><td>데이터 파티셔닝 전략</td><td>파티셔닝 키에 따라 처리 성능, 데이터 균형, 핫스팟 여부가 결정됨</td><td>사용자 ID, 지역 기반 파티셔닝 및 파티션 수 정기 검토</td></tr><tr><td></td><td>확장성 보장</td><td>데이터 증가, 트래픽 폭주 등 유동적 변화 대응을 위한 수평 확장 설계 필요</td><td>분산형 컴포넌트 도입 (Kafka, Flink 등), 무중단 확장 고려</td></tr><tr><td></td><td>일관성 유지</td><td>스트림과 배치 처리 간의 데이터 불일치 방지</td><td>이벤트 타임 병합 전략, timestamp 기준 동기화</td></tr><tr><td><strong>기술 선택</strong></td><td>스트림 처리 엔진 선정</td><td>처리 복잡도와 언어 생태계에 맞는 엔진 선택 필요 (Flink, Faust 등)</td><td>상태 기반은 Flink, Python 은 Faust, 지연 최소화는 Storm</td></tr><tr><td></td><td>데이터 저장소 구성</td><td>상태 저장 및 서빙 데이터베이스의 성능/지속성/쿼리 응답 시간 고려</td><td>RocksDB, HBase, Cassandra 등 역할 기반 분리</td></tr><tr><td><strong>데이터 관리</strong></td><td>스키마 진화 및 호환성 관리</td><td>데이터 구조 변경 시 이전 메시지와의 호환성 문제 발생 가능</td><td>Avro/Protobuf + Schema Registry 활용</td></tr><tr><td></td><td>오프셋 관리 및 재처리 고려</td><td>재처리나 복구 시 잘못된 오프셋 처리로 데이터 손실/중복 발생 가능</td><td>CI/CD 에 오프셋 설정 포함, Replay 전략 문서화</td></tr><tr><td><strong>성능 최적화</strong></td><td>Backpressure 대응</td><td>처리 지연, 큐 포화로 인한 시스템 병목 가능성</td><td>버퍼 조절, 플로우 제어, 비동기 처리</td></tr><tr><td></td><td>마이크로 배치 및 병렬도 조정</td><td>성능과 지연의 균형을 위한 처리 단위와 병렬도 조율 필요</td><td>Flink 의 <code>parallelism</code>, Spark 의 <code>batchInterval</code> 등 튜닝</td></tr><tr><td><strong>운영 관리</strong></td><td>모니터링 지표 설계 및 시각화</td><td>처리 지연, 처리량, 오류율 등 핵심 지표의 실시간 추적 필요</td><td>Prometheus + Grafana, Kafka Exporter, Flink Dashboard</td></tr><tr><td></td><td>장애 대응 전략</td><td>상태 저장/복원, 메시지 유실 방지, 재시작 로직 등 장애 대비 필요</td><td>정기 Checkpoint, Savepoint, 리트라이 및 DLQ 구성</td></tr><tr><td><strong>보안 및 거버넌스</strong></td><td>데이터 보안 및 접근 통제</td><td>실시간 스트림에도 전송 중 암호화 및 권한 제어가 요구됨</td><td>TLS 암호화, RBAC 적용, 민감 정보 필터링</td></tr><tr><td><strong>비용 관리</strong></td><td>인프라 사용 최적화</td><td>스트리밍 환경은 비용이 빠르게 증가하므로 효율적 리소스 관리 필요</td><td>Auto Scaling, 저장소 Tiering, 비용 알림 설정</td></tr></tbody></table><h4 id=실제-도입-시-고려해야-할-전략>실제 도입 시 고려해야 할 전략<a hidden class=anchor aria-hidden=true href=#실제-도입-시-고려해야-할-전략>#</a></h4><ul><li><strong>Migration 전략</strong>: 기존 Lambda 기반 시스템을 Kappa 로 전환할 경우, 기존 Batch Layer 를 Kafka log replay 로 대체해야 하며, 로그 유지 정책을 수정해야 함.</li><li><strong>Streaming 설계 패턴</strong>:<ul><li>CEP (Complex Event Processing),</li><li>Change Data Capture,</li><li>Event Sourcing + Command Query Responsibility Segregation (CQRS)<br>등의 스트림 기반 설계 패턴과 함께 사용 가능.</li></ul></li><li><strong>모니터링 중요성</strong>:<br>실시간 시스템에서는 지연 (Lag), Throughput, Error Rate 모니터링이 필수. Kafka Lag Exporter, Flink Web UI, Prometheus + Grafana 연동 필수적.</li></ul><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>최적화 항목</strong></th><th><strong>설명</strong></th><th><strong>권장사항</strong></th></tr></thead><tbody><tr><td><strong>1. 처리 성능 최적화</strong></td><td>병렬 처리 구조</td><td>데이터 볼륨 증가에 대비한 동시 처리 구조 확보</td><td>파티션 수 확장, 태스크 병렬성 조정, 키 기반 파티셔닝</td></tr><tr><td></td><td>이벤트 크기 제한</td><td>너무 큰 메시지는 처리 병목 유발</td><td>Binary 포맷 활용, 적절한 chunking</td></tr><tr><td></td><td>지연 시간 최소화</td><td>실시간성 보장을 위한 처리 속도 향상</td><td>조기 트리거 설정, 윈도우 최적화, 워터마크 튜닝</td></tr><tr><td><strong>2. 메모리 및 상태 관리</strong></td><td>상태 저장소 비용 최적화</td><td>Stateful 처리에서 메모리·디스크 과다 사용 방지</td><td>RocksDB 튜닝, TTL 설정, 외부 상태 backend 활용</td></tr><tr><td></td><td>윈도우/조인 최적화</td><td>집계·조인 시 과도한 상태 데이터 발생 가능성</td><td>적절한 윈도우 크기, 조기 폐기 정책 설정</td></tr><tr><td><strong>3. 네트워크 및 메시징 최적화</strong></td><td>네트워크 전송 효율화</td><td>메시지량 증가 시 네트워크 병목 발생 가능</td><td>메시지 배칭, 압축, 네트워크 버퍼 조정</td></tr><tr><td></td><td>메시지 순서 보장</td><td>순서가 중요한 이벤트 흐름에서 정확한 처리 필요</td><td>고유 키 기반 파티셔닝 (e.g. user_id, device_id)</td></tr><tr><td><strong>4. 저장소 효율화</strong></td><td>계층형 스토리지 적용</td><td>핫/콜드 데이터에 따라 스토리지 비용과 접근 성능을 조절</td><td>SSD + 객체 스토리지 조합, S3 Tier 활용</td></tr><tr><td></td><td>로그 보존 기간 최적화</td><td>장기 보존 시 스토리지 비용 증가</td><td>정책 기반 보존 기간 설정, Archive Storage 활용</td></tr><tr><td><strong>5. 리소스 및 확장성 관리</strong></td><td>수평 확장 구조 설계</td><td>스케일 아웃 기반 아키텍처 확보</td><td>상태 비공유 설계, 마이크로서비스 구조, Kubernetes 적용</td></tr><tr><td></td><td>리소스 자동화</td><td>과다/과소 할당 방지</td><td>오토스케일링, 우선순위 기반 자원 조정</td></tr><tr><td><strong>6. 장애 복구 및 재처리</strong></td><td>재처리 병렬성</td><td>리플레이 시 느린 병렬성은 복구 지연 유발</td><td>스트림 태스크 병렬 분산, 파티션 수 증가</td></tr><tr><td></td><td>체크포인트 최적화</td><td>상태 저장 비용과 복구 시간 간 균형</td><td>Checkpoint 주기 조정, 디스크/메모리 사용 최적화</td></tr><tr><td><strong>7. 품질 및 신뢰성 보장</strong></td><td>데이터 검증 강화</td><td>이상 데이터는 다운스트림 오류를 유발</td><td>스키마 검증, 이상 탐지, 데이터 프로파일링 도입</td></tr><tr><td></td><td>테스트 및 배포 안정성</td><td>전체 파이프라인의 회귀 및 품질 보장</td><td>자동화 테스트, 블루그린/카나리 배포 적용</td></tr><tr><td><strong>8. 운영 자동화 및 DevOps</strong></td><td>CI/CD 자동화</td><td>코드와 인프라의 안정적 관리</td><td>파이프라인 자동화, GitOps, IaC 도구 사용</td></tr><tr><td></td><td>관측 가능성 확보</td><td>운영 지표 기반 이상 탐지 및 대응</td><td>Prometheus, Grafana, 로그/트레이싱 통합</td></tr></tbody></table><h3 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>주제</strong></th><th><strong>핵심 항목</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>1. 아키텍처 & 구조</strong></td><td>Lambda / Kappa Architecture</td><td>배치 + 실시간 또는 스트림 단일 경로</td><td>데이터 처리 복잡도, 일관성, 확장성 측면에서 아키텍처 선택의 핵심</td></tr><tr><td></td><td>Event Sourcing</td><td>상태를 이벤트로 저장</td><td>변경 이력 추적 가능, 재생 및 감사 용이</td></tr><tr><td></td><td>CQRS</td><td>명령과 조회의 책임 분리</td><td>성능 최적화, 읽기/쓰기 스케일 분리</td></tr><tr><td></td><td>Pipe-and-Filter</td><td>데이터 처리 단계 분리 구조</td><td>구성요소 간 느슨한 결합과 유연성 제공</td></tr><tr><td><strong>2. 메시징 및 로그 시스템</strong></td><td>Kafka, Pulsar</td><td>Immutable Log 기반 메시징 플랫폼</td><td>순차 기록 및 로그 기반 재처리 구조 제공</td></tr><tr><td></td><td>Tiered Storage</td><td>계층적 스토리지 구조</td><td>콜드/핫 스토리지 분리로 비용 최적화</td></tr><tr><td><strong>3. 스트림 처리 엔진</strong></td><td>Apache Flink, Faust</td><td>Stateful Stream Processing</td><td>윈도우 집계, 세션 상태 유지, 정확성 높은 실시간 분석</td></tr><tr><td></td><td>ksqlDB, Flink SQL</td><td>SQL 기반 스트림 처리</td><td>코드 복잡도 감소, 운영 일관성 향상</td></tr><tr><td><strong>4. 운영 및 DevOps</strong></td><td>Replay Mechanism</td><td>CI/CD 와 통합된 재처리 체계</td><td>배포 후 로직 변경 시 오프셋 초기화 등 자동화</td></tr><tr><td></td><td>Schema Registry</td><td>데이터 스키마 버전 관리 및 호환성 보장</td><td>데이터 진화 및 오류 최소화 지원</td></tr><tr><td></td><td>Monitoring & Observability</td><td>계층별 상태 추적, 지표 수집</td><td>Prometheus, Grafana 등 활용</td></tr><tr><td><strong>5. 데이터 일관성 및 보증</strong></td><td>Exactly-Once Semantics</td><td>메시지 중복 없이 한 번만 처리 보장</td><td>재처리 시 데이터 정합성 확보에 필수</td></tr><tr><td></td><td>Checkpointing</td><td>상태 저장 지점</td><td>장애 복구, 스트림 처리 연속성 보장</td></tr><tr><td><strong>6. 성능 최적화 및 확장성</strong></td><td>Partitioning</td><td>파티션 기반 병렬 처리 구조</td><td>처리량 증대, 스케일 아웃 대응</td></tr><tr><td></td><td>Backpressure</td><td>처리율 불균형 제어</td><td>스트림 파이프라인 안정성 유지</td></tr><tr><td><strong>7. 보안 및 인증</strong></td><td>Zero Trust Architecture</td><td>기본 불신 기반의 보안 모델</td><td>모든 접근과 흐름을 검증하며 신뢰 최소화</td></tr></tbody></table><h3 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>기초 개념</strong></td><td>Stream Processing</td><td>연속 스트림 처리 원리</td><td>실시간 데이터 흐름을 처리하기 위한 핵심 개념</td></tr><tr><td></td><td>Event-Driven Architecture</td><td>이벤트 기반 아키텍처 구조</td><td>시스템 간 비동기 이벤트 중심 통신 방식</td></tr><tr><td><strong>핵심 기술</strong></td><td>Apache Kafka</td><td>Topic, Partition, Offset, 로그 리플레이</td><td>메시지 기반 실시간 데이터 처리 플랫폼</td></tr><tr><td></td><td>Apache Flink / Spark</td><td>Window, Checkpoint, 상태 처리</td><td>실시간 처리 엔진의 시간 기반 집계 및 장애 복구</td></tr><tr><td><strong>설계 패턴</strong></td><td>Microservices</td><td>서비스 분해 및 경계 정의</td><td>서비스 단위로 시스템 분할 설계</td></tr><tr><td></td><td>Saga Pattern</td><td>분산 트랜잭션 처리</td><td>분산 환경에서 일관성 있는 트랜잭션 처리 패턴</td></tr><tr><td></td><td>Exactly-Once Semantics</td><td>중복 없이 한 번 처리 보장</td><td>정확한 결과를 보장하는 메시지 처리 방식</td></tr><tr><td><strong>데이터 관리</strong></td><td>Schema Registry</td><td>스키마 저장 및 진화 관리</td><td>메시지 스키마의 호환성 및 변경 관리 전략</td></tr><tr><td></td><td>Data Versioning</td><td>스키마 및 메시지 버전 관리</td><td>데이터 형식 변경 시 호환성 확보</td></tr><tr><td><strong>성능 최적화</strong></td><td>Partitioning Strategy</td><td>파티셔닝 및 병렬 처리 구조 설계</td><td>처리량 향상과 핫스팟 방지</td></tr><tr><td></td><td>Backpressure Handling</td><td>시스템 과부하 제어</td><td>유입량 제어를 통한 안정성 확보</td></tr><tr><td></td><td>Replay Cost Optimization</td><td>재처리 비용 고려</td><td>로그 기반 재처리 시 리소스 소비 최소화</td></tr><tr><td><strong>운영 관리</strong></td><td>Monitoring & Observability</td><td>Lag, Throughput, Consumer Lag</td><td>성능 지표 수집 및 SLA 모니터링</td></tr><tr><td></td><td>DevOps Practices</td><td>배포 자동화, 인프라 관리</td><td>지속적 통합 및 배포 전략 (CI/CD)</td></tr><tr><td><strong>실무 요소</strong></td><td>Fault Tolerance</td><td>Checkpoint / Savepoint</td><td>장애 시 상태 복원 메커니즘</td></tr><tr><td></td><td>Lambda vs Kappa Architecture</td><td>아키텍처 비교 분석</td><td>배치 중심과 스트림 중심의 설계 차이 이해</td></tr><tr><td></td><td>Distributed Storage</td><td>HBase, Cassandra</td><td>고성능 분산형 저장소 설계와 활용</td></tr><tr><td></td><td>Visualization Tools</td><td>Prometheus, Grafana</td><td>실시간 모니터링 및 알림 설정 도구</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th><strong>카테고리</strong></th><th><strong>용어</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>아키텍처 패턴</strong></td><td><strong>Lambda Architecture</strong></td><td>배치 처리와 스트림 처리를 이중 경로로 결합하여 데이터 일관성과 실시간성을 동시에 추구하는 아키텍처</td></tr><tr><td></td><td><strong>Kappa Architecture</strong></td><td>모든 데이터 처리를 스트림 방식으로 통합한 단일 경로 아키텍처, 설계 단순성과 실시간성에 초점</td></tr><tr><td></td><td><strong>Event Sourcing</strong></td><td>시스템의 모든 상태 변화를 이벤트로 기록하여 상태를 재구성하는 저장 방식</td></tr><tr><td><strong>데이터 처리 방식</strong></td><td><strong>Batch Processing</strong></td><td>데이터를 일정 단위로 모아서 일괄 처리하는 방식, 정확성에 유리</td></tr><tr><td></td><td><strong>Stream Processing</strong></td><td>데이터가 발생하는 즉시 처리하는 방식, 실시간성과 지연 최소화에 초점</td></tr><tr><td></td><td><strong>Exactly-Once Semantics</strong></td><td>메시지가 단 한 번만 처리되도록 보장하는 처리 보증 모델</td></tr><tr><td><strong>저장 구조 및 로그</strong></td><td><strong>Append-Only Log (Immutable Log)</strong></td><td>기존 데이터를 수정하지 않고 끝에만 추가하는 불변 데이터 저장 방식 (예: Kafka Log)</td></tr><tr><td></td><td><strong>Event Log</strong></td><td>시간 순서대로 발생한 이벤트를 기록한 로그, 상태 재생에 활용됨</td></tr><tr><td></td><td><strong>Replay</strong></td><td>로그에 기록된 이벤트를 다시 읽어 처리 로직을 재실행하는 기법</td></tr><tr><td><strong>메시징 시스템</strong></td><td><strong>Message Queue</strong></td><td>비동기적으로 메시지를 저장·전달하는 시스템 구조</td></tr><tr><td></td><td><strong>Offset</strong></td><td>Kafka 등에서 소비자가 읽은 메시지의 위치를 추적하는 포인터</td></tr><tr><td><strong>상태 관리 및 복구</strong></td><td><strong>Checkpointing</strong></td><td>스트림 처리 도중 시스템 상태를 주기적으로 저장하여 장애 발생 시 복구에 활용</td></tr><tr><td></td><td><strong>State Management</strong></td><td>스트림 처리 중 발생하는 중간 상태 값을 안정적으로 관리하는 메커니즘</td></tr><tr><td><strong>스키마 및 호환성</strong></td><td><strong>Schema Registry</strong></td><td>메시지 포맷 (스키마) 의 버전 관리 및 호환성 보장을 위한 중앙 서비스</td></tr><tr><td><strong>성능 최적화</strong></td><td><strong>Backpressure</strong></td><td>데이터 소비 속도가 느릴 때 시스템에 과부하가 발생하지 않도록 조절하는 흐름 제어 기법</td></tr><tr><td></td><td><strong>Partitioning</strong></td><td>데이터를 키 또는 범위에 따라 여러 파티션으로 나눠 병렬 처리 성능을 향상시키는 전략</td></tr><tr><td><strong>시간 기반 처리</strong></td><td><strong>Watermark</strong></td><td>스트림 처리에서 지연된 이벤트를 처리할 수 있도록 현재 이벤트 시간의 진행 상태를 나타내는 지표</td></tr><tr><td></td><td><strong>Windowing</strong></td><td>스트림 데이터를 시간이나 수량 단위로 나누어 집계 및 분석을 가능하게 하는 방식</td></tr><tr><td><strong>실행 엔진 및 플랫폼</strong></td><td><strong>Apache Kafka</strong></td><td>고성능 분산 메시징 및 로그 저장 플랫폼으로, 스트림 처리와 이벤트 기반 시스템에서 중심 역할 수행</td></tr><tr><td></td><td><strong>Apache Flink</strong></td><td>이벤트 기반 스트림/배치 통합 처리 엔진, 상태 기반 처리를 강점으로 가짐</td></tr><tr><td></td><td><strong>Apache Storm</strong></td><td>실시간 스트림 처리용 경량 분산 처리 프레임워크</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://medium.com/data-and-beyond/kappa-architecture-stream-processing-in-big-data-analytics-e539f4bf63cd>Kappa Architecture: Stream Processing in Big Data Analytics - Medium</a></li><li><a href=https://hazelcast.com/foundations/software-architecture/kappa-architecture/>Kappa Architecture Overview - Hazelcast</a></li><li><a href=https://www.uber.com/blog/kappa-architecture-data-stream-processing/>Designing a Production-Ready Kappa Architecture for Timely Data Stream Processing - Uber Blog</a></li><li><a href=https://kai-waehner.de/blog/2021/09/23/real-time-kappa-architecture-mainstream-replacing-batch-lambda/>Kappa Architecture is Mainstream Replacing Lambda - Kai Waehner</a></li><li><a href=https://nexocode.com/blog/posts/kappa-architecture/>Kappa Architecture 1:1 - How to Build a Modern Streaming Data Architecture? - Nexocode</a></li><li><a href=https://kai-waehner.de/blog/2025/07/08/the-rise-of-kappa-architecture-in-the-era-of-agentic-ai-and-data-streaming/>The Rise of Kappa Architecture in the Era of Agentic AI and Data Streaming - Kai Waehner (2025)</a></li><li><a href=https://nightlies.apache.org/flink/flink-docs-lts/>Apache Flink Documentation</a></li><li><a href=https://flink.apache.org/documentation/>Apache Flink Documentation (stable)</a></li></ul><hr></div></main><footer class=footer><span>&copy; 2026 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>