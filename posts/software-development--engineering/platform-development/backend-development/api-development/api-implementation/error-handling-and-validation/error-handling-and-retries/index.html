<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Error Handling and Retries | hyunyoun's Blog</title><meta name=keywords content="Backend-Development,API-Design-and-Implementation,API-Performance,Error-Handling-and-Retries"><meta name=description content="효과적인 오류 처리와 재시도 메커니즘은 안정적인 API 설계의 핵심 요소이다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/software-development--engineering/platform-development/backend-development/api-development/api-implementation/error-handling-and-validation/error-handling-and-retries/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.d522c866f0cc9c20ae4fa73a0a8c07f0af4c36af75bcbcd3e90558446f681077.css integrity="sha256-1SLIZvDMnCCuT6c6CowH8K9MNq91vLzT6QVYRG9oEHc=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/software-development--engineering/platform-development/backend-development/api-development/api-implementation/error-handling-and-validation/error-handling-and-retries/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/software-development--engineering/platform-development/backend-development/api-development/api-implementation/error-handling-and-validation/error-handling-and-retries/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Error Handling and Retries"><meta property="og:description" content="효과적인 오류 처리와 재시도 메커니즘은 안정적인 API 설계의 핵심 요소이다."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-13T01:31:00+00:00"><meta property="article:modified_time" content="2025-02-13T01:31:00+00:00"><meta property="article:tag" content="Backend Development"><meta property="article:tag" content="API-Design-and-Implementation"><meta property="article:tag" content="API-Performance"><meta property="article:tag" content="Error-Handling-and-Retries"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Error Handling and Retries"><meta name=twitter:description content="효과적인 오류 처리와 재시도 메커니즘은 안정적인 API 설계의 핵심 요소이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Error Handling and Retries","item":"https://buenhyden.github.io/posts/software-development--engineering/platform-development/backend-development/api-development/api-implementation/error-handling-and-validation/error-handling-and-retries/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Error Handling and Retries","name":"Error Handling and Retries","description":"효과적인 오류 처리와 재시도 메커니즘은 안정적인 API 설계의 핵심 요소이다.","keywords":["Backend-Development","API-Design-and-Implementation","API-Performance","Error-Handling-and-Retries"],"articleBody":"Error Handling and Retries 현대 소프트웨어 아키텍처에서 API는 중추적인 역할을 담당하며, 다양한 시스템 간의 원활한 통신을 가능하게 한다. 그러나 네트워크 불안정성, 서버 과부하, 일시적인 서비스 중단 등 다양한 이유로 API 호출은 항상 성공적으로 완료되지 않을 수 있다. 따라서 효과적인 오류 처리와 재시도 메커니즘은 안정적인 API 설계의 핵심 요소이다.\nAPI 오류 처리의 중요성 오류 처리가 중요한 이유 효과적인 오류 처리는 다음과 같은 여러 이유로 중요하다:\n사용자 경험 향상: 명확한 오류 메시지는 사용자가 문제를 이해하고 해결할 수 있게 도와준다. 디버깅 용이성: 상세한 오류 정보는 개발자가 문제를 신속하게 식별하고 해결하는 데 도움이 된다. 시스템 안정성: 적절한 오류 처리는 예기치 않은 상황에서도 애플리케이션이 계속 작동할 수 있게 한다. 보안 강화: 오류 처리는 민감한 정보 노출을 방지하고 잠재적인 공격 벡터를 감소시킨다. API 사용성: 일관되고 예측 가능한 오류 응답은 API의 사용성을 크게 향상시킨다. 부적절한 오류 처리의 결과 오류 처리가 제대로 구현되지 않으면 다음과 같은 문제가 발생할 수 있다:\n애플리케이션 장애: 처리되지 않은 예외로 인한 전체 시스템 중단 사용자 혼란: 불명확한 오류 메시지로 인한 사용자 좌절감 증가 리소스 낭비: 실패한 요청이 적절히 처리되지 않아 시스템 리소스 소모 데이터 불일치: 부분적으로 완료된 작업으로 인한 데이터 무결성 문제 보안 취약점: 과도한 오류 정보 노출로 인한 잠재적 보안 위험 API 오류 유형 및 분류 API 오류를 효과적으로 처리하기 위해서는 먼저 다양한 유형의 오류를 이해해야 한다.\n오류의 기본 분류 API 오류는 크게 다음 네 가지 범주로 분류할 수 있다:\n클라이언트 오류 (4xx): 잘못된 요청, 인증 실패, 권한 부족 등 클라이언트 측 문제로 인한 오류 서버 오류 (5xx): 서버 내부 오류, 서비스 불가, 게이트웨이 오류 등 서버 측 문제로 인한 오류 네트워크 오류: 연결 시간 초과, 네트워크 단절, DNS 해석 실패 등 비즈니스 로직 오류: 기술적으로는 성공적이지만 비즈니스 규칙 위반으로 인한 오류 일시적 vs. 영구적 오류 오류를 처리하고 재시도 전략을 개발할 때 오류의 지속성 특성을 이해하는 것이 중요하다:\n일시적 오류 (Transient Failures): 잠시 후 자동으로 해결될 수 있는 오류 예: 네트워크 지연, 서버 과부하, 일시적인 서비스 중단 재시도가 효과적인 경우 영구적 오류 (Permanent Failures): 조치 없이는 해결되지 않는 오류 예: 인증 실패, 권한 부족, 리소스 부재, 유효하지 않은 입력 데이터 재시도가 효과가 없거나 부적절한 경우 일반적인 HTTP 상태 코드 REST API에서는 HTTP 상태 코드를 사용하여 오류 상태를 전달한다.\n가장 일반적인 오류 관련 상태 코드는 다음과 같다:\n클라이언트 오류 (4xx)\n400 Bad Request: 유효하지 않은 요청 형식이나 매개변수 401 Unauthorized: 인증 필요 403 Forbidden: 인증되었으나 권한 부족 404 Not Found: 요청된 리소스를 찾을 수 없음 409 Conflict: 현재 상태와 충돌하는 요청 422 Unprocessable Entity: 유효성 검사 실패 429 Too Many Requests: 속도 제한 초과 서버 오류 (5xx)\n500 Internal Server Error: 일반적인 서버 오류 502 Bad Gateway: 게이트웨이 또는 프록시 오류 503 Service Unavailable: 일시적으로 서비스 사용 불가 504 Gateway Timeout: 게이트웨이 시간 초과 효과적인 API 오류 응답 설계 오류 응답 구조 일관성 있고 유용한 API 오류 응답을 설계하기 위한 모범 사례는 다음과 같다:\n표준 오류 응답 형식 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \"error\": { \"code\": \"RESOURCE_NOT_FOUND\", \"message\": \"The requested resource was not found.\", \"details\": \"User with ID 12345 does not exist.\", \"timestamp\": \"2023-06-15T08:42:15Z\", \"requestId\": \"req-123456\", \"path\": \"/api/users/12345\", \"status\": 404, \"fields\": [ { \"name\": \"userId\", \"reason\": \"not_found\" } ] } } 주요 구성 요소 코드 (code): 기계가 읽을 수 있는 고유한 오류 식별자 메시지 (message): 사용자 친화적인 오류 설명 세부 정보 (details): 오류에 대한 추가 컨텍스트 (선택 사항) 타임스탬프 (timestamp): 오류 발생 시간 요청 ID (requestId): 요청 추적을 위한 고유 식별자 경로 (path): 오류가 발생한 API 엔드포인트 상태 (status): HTTP 상태 코드 필드 (fields): 특정 필드와 관련된 오류 (유효성 검사 오류의 경우) 오류 메시지 작성 지침 효과적인 오류 메시지는 다음 특성을 갖추어야 한다:\n명확성: 무슨 일이 일어났는지 분명하게 설명한다. 간결성: 짧고 간결하게 정보를 전달한다. 행동 지향성: 가능한 경우 문제 해결 방법을 제시한다. 기술 용어 지양: 최종 사용자가 이해할 수 있는 언어를 사용한다. 일관성: 전체 API에서 일관된 형식과 용어를 사용한다. 좋은 오류 메시지 예시 “유효하지 않은 이메일 형식입니다. 올바른 이메일 주소를 입력해 주세요.” “결제 금액은 양수여야 합니다.” “요청된 사용자를 찾을 수 없습니다. 사용자 ID를 확인하세요.” 나쁜 오류 메시지 예시 “오류 발생!” “데이터베이스 쿼리 실패: SQL 오류 #5123” “NullPointerException이 발생했습니다.” 다양한 환경에 맞는 오류 정보 수준 오류 응답에 포함되는 정보의 양은 환경에 따라 조정되어야 한다:\n개발 환경: 상세한 디버깅 정보 포함 스택 추적, 예외 유형, 내부 오류 코드 등 포함 가능 세부적인 문맥 정보 제공 프로덕션 환경: 민감한 내부 정보 제외 보안 위험을 야기할 수 있는 세부 정보 생략 사용자 친화적인 메시지에 중점 문제 추적을 위한 요청 ID 항상 포함 서버 측 오류 처리 전략 API 엔드포인트에서의 오류 처리 서버 측 API 구현에서 효과적인 오류 처리를 위한 접근 방식.\n유효성 검사 입력 데이터 유효성 검사는 오류 처리의 첫 번째 방어선:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // Java Spring Boot 예시 @PostMapping(\"/users\") public ResponseEntity\u003cUser\u003e createUser(@Valid @RequestBody UserRequest userRequest) { // @Valid 어노테이션이 유효성 검사를 처리합니다. // 유효하지 않은 경우 MethodArgumentNotValidException이 발생합니다. User user = userService.createUser(userRequest); return ResponseEntity.status(HttpStatus.CREATED).body(user); } // 전역 예외 처리기 @ControllerAdvice public class GlobalExceptionHandler { @ExceptionHandler(MethodArgumentNotValidException.class) public ResponseEntity\u003cErrorResponse\u003e handleValidationExceptions( MethodArgumentNotValidException ex) { List\u003cFieldError\u003e fieldErrors = ex.getBindingResult().getFieldErrors(); List\u003cMap\u003cString, String\u003e\u003e fields = fieldErrors.stream() .map(err -\u003e Map.of( \"name\", err.getField(), \"reason\", err.getDefaultMessage() )) .collect(Collectors.toList()); ErrorResponse errorResponse = new ErrorResponse( \"VALIDATION_ERROR\", \"입력 데이터 유효성 검사에 실패했습니다.\", \"하나 이상의 필드가 유효하지 않습니다.\", ZonedDateTime.now(), UUID.randomUUID().toString(), ex.getRequest().getRequestURI(), HttpStatus.BAD_REQUEST.value(), fields ); return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(errorResponse); } } 예외 처리 및 매핑 비즈니스 로직에서 발생하는 예외를 적절한 HTTP 응답으로 매핑하는 전략:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // 사용자 정의 예외 클래스 public class ResourceNotFoundException extends RuntimeException { private final String resourceType; private final String resourceId; public ResourceNotFoundException(String resourceType, String resourceId) { super(String.format(\"%s with ID %s not found\", resourceType, resourceId)); this.resourceType = resourceType; this.resourceId = resourceId; } // getters… } // 서비스 레이어 @Service public class UserService { public User getUserById(String userId) { return userRepository.findById(userId) .orElseThrow(() -\u003e new ResourceNotFoundException(\"User\", userId)); } } // 전역 예외 처리기에 추가 @ExceptionHandler(ResourceNotFoundException.class) public ResponseEntity\u003cErrorResponse\u003e handleResourceNotFoundException( ResourceNotFoundException ex, HttpServletRequest request) { ErrorResponse errorResponse = new ErrorResponse( \"RESOURCE_NOT_FOUND\", ex.getMessage(), null, ZonedDateTime.now(), UUID.randomUUID().toString(), request.getRequestURI(), HttpStatus.NOT_FOUND.value(), null ); return ResponseEntity.status(HttpStatus.NOT_FOUND).body(errorResponse); } 트랜잭션 관리 API 작업 중 오류가 발생했을 때 데이터 일관성을 유지하기 위한 트랜잭션 관리:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @Service public class OrderService { @Transactional public Order createOrder(OrderRequest orderRequest) { // 전체 작업이 트랜잭션으로 묶여 있어 일부에서 실패하면 모두 롤백됩니다. Customer customer = customerRepository.findById(orderRequest.getCustomerId()) .orElseThrow(() -\u003e new ResourceNotFoundException(\"Customer\", orderRequest.getCustomerId())); // 재고 확인 for (OrderItemRequest item : orderRequest.getItems()) { Product product = productRepository.findById(item.getProductId()) .orElseThrow(() -\u003e new ResourceNotFoundException(\"Product\", item.getProductId())); if (product.getStock() \u003c item.getQuantity()) { throw new InsufficientStockException(product.getId(), product.getStock(), item.getQuantity()); } } // 주문 생성 및 재고 업데이트 Order order = new Order(); // …주문 처리 로직… return orderRepository.save(order); } } 로깅 전략 효과적인 오류 처리를 위해서는 적절한 로깅이 필수적:\n로그 레벨 선택 상황에 맞는 로그 레벨 사용:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @Service public class PaymentService { private static final Logger log = LoggerFactory.getLogger(PaymentService.class); public PaymentResult processPayment(PaymentRequest request) { try { // 결제 처리 로직 log.info(\"Payment processed successfully for order: {}\", request.getOrderId()); return result; } catch (PaymentProviderTemporaryException ex) { // 일시적인 오류 - 재시도 가능 log.warn(\"Temporary payment provider error: {}. Will retry.\", ex.getMessage()); throw ex; } catch (PaymentDeclinedException ex) { // 정상적인 비즈니스 거부 - 심각한 오류 아님 log.info(\"Payment declined: {}\", ex.getMessage()); throw ex; } catch (Exception ex) { // 예상치 못한 오류 - 심각한 문제 log.error(\"Critical payment processing error\", ex); throw new PaymentFailedException(\"Payment processing failed unexpectedly\", ex); } } } 구조화된 로깅 및 컨텍스트 포함 문제 진단에 필요한 충분한 컨텍스트 정보를 로그에 포함:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // MDC(Mapped Diagnostic Context)를 사용한 로깅 @Component public class RequestLoggingFilter extends OncePerRequestFilter { @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException { // 요청 ID 생성 및 MDC에 추가 String requestId = UUID.randomUUID().toString(); MDC.put(\"requestId\", requestId); // 요청 정보 로깅 MDC.put(\"clientIp\", request.getRemoteAddr()); MDC.put(\"userAgent\", request.getHeader(\"User-Agent\")); MDC.put(\"path\", request.getRequestURI()); try { // 응답 헤더에 요청 ID 추가 response.setHeader(\"X-Request-ID\", requestId); filterChain.doFilter(request, response); } finally { // MDC 정리 MDC.clear(); } } } 중앙 집중식 로그 관리 분산 시스템에서의 로그 관리 및 상관관계 분석:\n로그 집계: ELK 스택(Elasticsearch, Logstash, Kibana), Graylog, Splunk 등을 사용하여 모든 서비스의 로그를 중앙에서 수집 및 분석 요청 추적: 마이크로서비스 간 요청 추적을 위해 Spring Cloud Sleuth, Zipkin, Jaeger 등의 분산 추적 시스템 활용 알림 설정: 중요 오류에 대한 실시간 알림 구성 클라이언트 측 오류 처리 전략 API를 소비하는 클라이언트 측에서의 오류 처리 전략.\n오류 감지 및 처리 일반적인 오류 처리 패턴 JavaScript에서의 일반적인 오류 처리 패턴:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 // Fetch API 사용시 오류 처리 async function fetchUser(userId) { try { const response = await fetch(`/api/users/${userId}`); // HTTP 오류 응답 확인 if (!response.ok) { const errorData = await response.json(); throw new APIError( response.status, errorData.error.code, errorData.error.message, errorData.error.requestId ); } return await response.json(); } catch (error) { if (error instanceof APIError) { // API 오류 처리 console.error(`API Error ${error.status}: ${error.code} - ${error.message}`); // 사용자에게 적절한 메시지 표시 displayErrorMessage(error.userFriendlyMessage); } else { // 네트워크 오류 등 다른 예외 처리 console.error('Network or unknown error:', error); displayErrorMessage('네트워크 연결을 확인해 주세요.'); } throw error; // 필요한 경우 상위 레벨로 오류 전파 } } // 사용자 정의 API 오류 클래스 class APIError extends Error { constructor(status, code, message, requestId) { super(message); this.name = 'APIError'; this.status = status; this.code = code; this.requestId = requestId; this.userFriendlyMessage = this.getUserFriendlyMessage(); } getUserFriendlyMessage() { // 오류 코드에 따른 사용자 친화적 메시지 반환 switch (this.code) { case 'RESOURCE_NOT_FOUND': return '요청하신 정보를 찾을 수 없습니다.'; case 'VALIDATION_ERROR': return '입력한 정보가 유효하지 않습니다.'; case 'UNAUTHORIZED': return '이 작업을 수행하기 위한 권한이 없습니다.'; default: return '요청을 처리하는 중 오류가 발생했습니다. 나중에 다시 시도해 주세요.'; } } } 상태 코드 및 응답 구조 분석 다양한 HTTP 상태 코드 및 API 응답 구조를 분석하여 적절한 처리 방법 결정:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 async function handleAPIResponse(response) { // 응답 본문 파싱 let data; let errorData; try { // 응답이 JSON인지 확인 const contentType = response.headers.get('Content-Type'); if (contentType \u0026\u0026 contentType.includes('application/json')) { data = await response.json(); } else { data = await response.text(); } } catch (error) { // 응답 본문 파싱 오류 errorData = { message: 'Invalid response format' }; } // 성공적인 응답 if (response.ok) { return data; } // 오류 응답 처리 switch (response.status) { case 400: // Bad Request return handleValidationErrors(data); case 401: // Unauthorized // 인증 토큰 갱신 또는 로그인 페이지로 리디렉션 authService.refreshToken().catch(() =\u003e { window.location.href = '/login'; }); throw new AuthError('Authentication required'); case 403: // Forbidden throw new AccessDeniedError('You do not have permission to access this resource'); case 404: // Not Found throw new NotFoundError(`The requested resource was not found`); case 422: // Unprocessable Entity return handleValidationErrors(data); case 429: // Too Many Requests // 재시도 지연 설정 const retryAfter = response.headers.get('Retry-After'); throw new RateLimitError('Rate limit exceeded', retryAfter); case 500: // Internal Server Error case 502: // Bad Gateway case 503: // Service Unavailable case 504: // Gateway Timeout throw new ServerError('A server error occurred. Please try again later.'); default: throw new APIError(`Unknown error: ${response.status}`, data); } } // 유효성 검사 오류 처리 function handleValidationErrors(data) { if (data.error \u0026\u0026 data.error.fields) { // 필드별 오류 메시지 추출 const fieldErrors = data.error.fields.reduce((acc, field) =\u003e { acc[field.name] = field.reason; return acc; }, {}); throw new ValidationError(data.error.message, fieldErrors); } throw new BadRequestError(data.error?.message || 'Invalid request'); } 사용자 경험 최적화 오류 발생 시 최종 사용자 경험을 최적화하는 방법:\n오류 UI 패턴 사용자에게 오류를 표시하는 다양한 UI 패턴:\n인라인 오류 메시지: 특정 입력 필드 옆에 오류 메시지 표시 토스트 알림: 일시적인 오류 메시지를 화면 상단/하단에 표시 모달 다이얼로그: 중요한 오류에 대해 사용자의 주의를 끌기 위한 모달 창 오류 페이지: 심각한 오류의 경우 전용 오류 페이지로 이동 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 // React에서의 오류 UI 예시 function UserForm() { const [user, setUser] = useState({ name: '', email: '' }); const [errors, setErrors] = useState({}); const [isSubmitting, setIsSubmitting] = useState(false); const [serverError, setServerError] = useState(null); async function handleSubmit(event) { event.preventDefault(); setErrors({}); setServerError(null); setIsSubmitting(true); try { // 로컬 유효성 검사 const validationErrors = validateUser(user); if (Object.keys(validationErrors).length \u003e 0) { setErrors(validationErrors); return; } // API 호출 const response = await createUser(user); // 성공 처리 toast.success('User created successfully!'); // 리디렉션 또는 다음 단계 처리 } catch (error) { if (error instanceof ValidationError) { // 필드별 오류 표시 setErrors(error.fieldErrors); } else if (error instanceof ServerError) { // 서버 오류 표시 setServerError('The server is currently unavailable. Please try again later.'); } else { // 일반 오류 표시 setServerError(error.userFriendlyMessage || 'An unexpected error occurred.'); } // 오류 로깅 logErrorToMonitoringService(error); } finally { setIsSubmitting(false); } } return ( \u003cform onSubmit={handleSubmit}\u003e {serverError \u0026\u0026 ( \u003cdiv className=\"error-banner\"\u003e \u003cErrorIcon /\u003e {serverError} \u003c/div\u003e )} \u003cdiv className=\"form-field\"\u003e \u003clabel htmlFor=\"name\"\u003eName\u003c/label\u003e \u003cinput id=\"name\" value={user.name} onChange={(e) =\u003e setUser({…user, name: e.target.value})} className={errors.name ? 'input-error' : ''} /\u003e {errors.name \u0026\u0026 \u003cdiv className=\"field-error\"\u003e{errors.name}\u003c/div\u003e} \u003c/div\u003e \u003cdiv className=\"form-field\"\u003e \u003clabel htmlFor=\"email\"\u003eEmail\u003c/label\u003e \u003cinput id=\"email\" type=\"email\" value={user.email} onChange={(e) =\u003e setUser({…user, email: e.target.value})} className={errors.email ? 'input-error' : ''} /\u003e {errors.email \u0026\u0026 \u003cdiv className=\"field-error\"\u003e{errors.email}\u003c/div\u003e} \u003c/div\u003e \u003cbutton type=\"submit\" disabled={isSubmitting}\u003e {isSubmitting ? 'Creating…' : 'Create User'} \u003c/button\u003e \u003c/form\u003e ); } 오류 복구 옵션 사용자가 오류를 복구할 수 있는 방법 제공:\n가이드 제공: 오류 해결을 위한 단계별 지침 제공 자동 수정 제안: 가능한 경우 오류 수정 방법 제안 대체 워크플로우: 현재 경로가 실패한 경우 대체 옵션 제공 수동 재시도: 사용자가 작업을 다시 시도할 수 있는 옵션 제공 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 // 오류 복구 옵션을 제공하는 컴포넌트 예시 function PaymentErrorHandler({ error, onRetry, onAlternativeMethod }) { // 오류 유형에 따른 대응 switch (error.code) { case 'PAYMENT_DECLINED': return ( \u003cErrorCard\u003e \u003ch3\u003e결제가 거부되었습니다\u003c/h3\u003e \u003cp\u003e카드 발급사에서 이 거래를 거부했습니다. 다음 중 하나를 시도해 보세요:\u003c/p\u003e \u003cul\u003e \u003cli\u003e카드 정보가 올바른지 확인하세요\u003c/li\u003e \u003cli\u003e충분한 잔액이 있는지 확인하세요\u003c/li\u003e \u003cli\u003e다른 카드로 시도하세요\u003c/li\u003e \u003c/ul\u003e \u003cButtonGroup\u003e \u003cButton primary onClick={onRetry}\u003e다시 시도\u003c/Button\u003e \u003cButton secondary onClick={onAlternativeMethod}\u003e다른 결제 방법\u003c/Button\u003e \u003c/ButtonGroup\u003e \u003c/ErrorCard\u003e ); case 'NETWORK_ERROR': return ( \u003cErrorCard\u003e \u003ch3\u003e연결 오류\u003c/h3\u003e \u003cp\u003e인터넷 연결에 문제가 있습니다. 네트워크 연결을 확인한 후 다시 시도하세요.\u003c/p\u003e \u003cConnectionStatus /\u003e \u003cButton primary onClick={onRetry}\u003e다시 시도\u003c/Button\u003e \u003c/ErrorCard\u003e ); case 'SERVICE_UNAVAILABLE': return ( \u003cErrorCard\u003e \u003ch3\u003e서비스 일시 중단\u003c/h3\u003e \u003cp\u003e결제 서비스가 현재 일시적으로 사용 불가능합니다. 불편을 드려 죄송합니다.\u003c/p\u003e \u003cp\u003e현재 시스템 상태: \u003cServiceStatusIndicator /\u003e\u003c/p\u003e \u003cp\u003e예상 복구 시간: {formatTime(error.estimatedResolutionTime)}\u003c/p\u003e \u003cButtonGroup\u003e \u003cButton primary onClick={onRetry}\u003e다시 시도\u003c/Button\u003e \u003cButton secondary onClick={() =\u003e saveOrderForLater()}\u003e나중에 완료\u003c/Button\u003e \u003c/ButtonGroup\u003e \u003c/ErrorCard\u003e ); default: return ( \u003cErrorCard\u003e \u003ch3\u003e결제 처리 중 오류가 발생했습니다\u003c/h3\u003e \u003cp\u003e{error.userFriendlyMessage}\u003c/p\u003e \u003cButton primary onClick={onRetry}\u003e다시 시도\u003c/Button\u003e \u003c/ErrorCard\u003e ); } } API 재시도 전략 네트워크 불안정성이나 일시적인 서비스 중단으로 인한 일시적 오류는 재시도를 통해 해결할 수 있다. 효과적인 재시도 전략은 애플리케이션의 복원력을 크게 향상시킨다.\n재시도 가능한 오류 식별 모든 오류가 재시도에 적합한 것은 아니다.\n다음 기준을 사용하여 재시도 가능한 오류를 식별할 수 있다:\n일반적으로 재시도 가능한 오류 네트워크 시간 초과 (Network Timeouts): 일시적인 네트워크 지연으로 인한 시간 초과 서버 과부하 (503 Service Unavailable): 서버가 일시적으로 요청을 처리할 수 없음 연결 오류 (Connection Errors): 네트워크 연결 문제 5xx 서버 오류: 대부분의 서버 측 오류(500, 502, 504 등) 일시적인 데이터베이스 오류: 경쟁 조건, 교착 상태, 연결 풀 고갈 등 속도 제한 (429 Too Many Requests): 요청 속도 제한 초과(적절한 백오프와 함께) 재시도하지 말아야 할 오류 클라이언트 오류 (4xx): 대부분의 400, 401, 403, 404 등은 재시도해도 성공할 가능성이 낮음 유효성 검사 실패: 입력 데이터 문제로 인한 오류 인증/권한 오류: 인증 정보가 잘못되었거나 권한이 부족한 경우 비즈니스 로직 오류: 비즈니스 규칙 위반으로 인한 오류 영구적인 리소스 상태 문제: 리소스가 이미 존재하거나 찾을 수 없는 경우 7.1.3 오류 분류 코드 예시 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // 오류의 재시도 가능성 평가 function isRetryable(error) { // 네트워크 오류는 재시도 가능 if (error.name === 'NetworkError' || error.message.includes('network')) { return true; } // API 오류인 경우 상태 코드 확인 if (error instanceof APIError) { // 서버 오류(5xx)는 일반적으로 재시도 가능 if (error.status \u003e= 500 \u0026\u0026 error.status \u003c 600) { return true; } // 429(Too Many Requests)는 재시도 가능하지만 Retry-After 헤더 준수 필요 if (error.status === 429) { return true; } // 특정 비즈니스 오류 코드가 재시도 가능한지 확인 if (RETRYABLE_ERROR_CODES.includes(error.code)) { return true; } } // 특정 데이터베이스 오류 식별 if (error.code === 'DEADLOCK' || error.code === 'CONNECTION_TIMEOUT') { return true; } // 기본적으로 재시도하지 않음 return false; } // 재시도 가능한 비즈니스 오류 코드 목록 const RETRYABLE_ERROR_CODES = [ 'TEMPORARY_OUTAGE', 'DATABASE_TIMEOUT', 'RESOURCE_EXHAUSTED', 'SERVICE_UNAVAILABLE', 'GATEWAY_TIMEOUT' ]; 백오프 전략 단순히 요청을 즉시 재시도하는 것은 서버에 부담을 줄 수 있다. 효과적인 백오프 전략을 사용하여 재시도 간격을 조정해야 한다.\n주요 백오프 전략 고정 지연 (Fixed Delay): 일정한 시간 간격으로 재시도 간단하지만 대규모 클라이언트의 경우 ‘서지(surge)’ 문제 발생 가능 지수 백오프 (Exponential Backoff): 재시도할 때마다 대기 시간을 지수적으로 증가 가장 널리 사용되는 전략으로 서버 부하를 효과적으로 분산 지수 백오프 + 지터 (Exponential Backoff with Jitter): 지수 백오프에 무작위성 추가 다수의 클라이언트가 동시에 재시도하는 것을 방지해 서버 부하 피크 감소 데코레이터 (Decorator) 헤더 기반 재시도: 서버가 Retry-After 헤더를 통해 권장 재시도 시간 제공 서버 상태에 기반한 지능적인 재시도 가능 지수 백오프 구현 예시 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 /** * 지수 백오프 및 지터를 사용한 재시도 함수 * @param {Function} operation - 실행할 작업 함수 * @param {Object} options - 재시도 옵션 * @returns {Promise} 작업 결과 */ async function retryWithBackoff(operation, options = {}) { const { maxRetries = 5, baseDelay = 300, maxDelay = 30000, factor = 2, jitter = true, retryableErrors = isRetryable } = options; let attempt = 0; while (true) { try { return await operation(); } catch (error) { attempt++; // 최대 재시도 횟수 초과 또는 재시도할 수 없는 오류인 경우 if (attempt \u003e= maxRetries || !retryableErrors(error)) { throw error; } // Retry-After 헤더가 있는 경우 해당 값 사용 if (error.retryAfter) { const retryAfterMs = parseRetryAfter(error.retryAfter); await sleep(retryAfterMs); continue; } // 지수 백오프 계산 let delay = Math.min(maxDelay, baseDelay * Math.pow(factor, attempt - 1)); // 지터 추가 (선택 사항) if (jitter) { // 계산된 지연의 0%~100% 사이의 무작위 값 사이에서 지연 시간 조정 delay = Math.random() * delay; } console.log(`Retrying after ${delay}ms (attempt ${attempt} of ${maxRetries})`); await sleep(delay); } } } // 헬퍼 함수 function sleep(ms) { return new Promise(resolve =\u003e setTimeout(resolve, ms)); } function parseRetryAfter(retryAfter) { // 숫자만 있는 경우 초 단위로 해석 if (/^\\d+$/.test(retryAfter)) { return parseInt(retryAfter, 10) * 1000; } // HTTP 날짜 형식인 경우 밀리초로 변환 const date = new Date(retryAfter); return date.getTime() - Date.now(); } // 사용 예시 async function fetchUserWithRetry(userId) { return retryWithBackoff( () =\u003e fetch(`/api/users/${userId}`).then(res =\u003e { if (!res.ok) { const error = new Error('API request failed'); error.status = res.status; error.retryAfter = res.headers.get('Retry-After'); throw error; } return res.json(); }), { maxRetries: 3, baseDelay: 500, retryableErrors: (error) =\u003e error.status \u003e= 500 || error.status === 429 } ); } 재시도 제한 및 서킷 브레이커 무한정 재시도하는 것은 리소스 낭비와 시스템 과부하를 초래할 수 있다. 적절한 제한을 설정하고 서킷 브레이커 패턴을 구현하는 것이 중요하다.\n재시도 제한 최대 재시도 횟수: 특정 횟수 이후에는 재시도 중단 최대 시간 제한: 지정된 시간 이후에는 재시도 중단 재시도 예산: 일정 시간 동안 허용되는 최대 재시도 횟수 설정 서킷 브레이커 패턴 서킷 브레이커는 반복적인 실패가 감지될 때 추가 호출을 일시적으로 차단하는 패턴이다. 이는 실패한 서비스가 복구될 시간을 제공하고, 시스템의 나머지 부분을 보호한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 /** * 간단한 서킷 브레이커 구현 */ class CircuitBreaker { constructor(options = {}) { this.failureThreshold = options.failureThreshold || 5; this.resetTimeout = options.resetTimeout || 30000; this.monitorInterval = options.monitorInterval || 5000; this.state = 'CLOSED'; this.failureCount = 0; this.lastFailureTime = null; this.monitors = []; // 모니터링 간격 설정 setInterval(() =\u003e this.updateState(), this.monitorInterval); } // 상태 업데이트 updateState() { if (this.state === 'OPEN') { const now = Date.now(); if (now - this.lastFailureTime \u003e= this.resetTimeout) { // 재설정 시간이 지나면 반열림 상태로 전환 this.state = 'HALF_OPEN'; this.notifyMonitors(); } } } // 작업 실행 async execute(operation) { if (this.state === 'OPEN') { throw new Error('Circuit is OPEN - operation rejected'); } try { const result = await operation(); // 성공 시 회로 닫기 if (this.state === 'HALF_OPEN') { this.state = 'CLOSED'; this.failureCount = 0; this.notifyMonitors(); } return result; } catch (error) { // 실패 처리 this.recordFailure(); throw error; } } // 실패 기록 recordFailure() { this.failureCount++; this.lastFailureTime = Date.now(); if (this.state === 'CLOSED' \u0026\u0026 this.failureCount \u003e= this.failureThreshold) { // 실패 임계값 초과 시 회로 열기 this.state = 'OPEN'; this.notifyMonitors(); } else if (this.state === 'HALF_OPEN') { // 반열림 상태에서 실패하면 다시 열림 상태로 this.state = 'OPEN'; this.notifyMonitors(); } } // 상태 변경 시 이벤트 발생 notifyMonitors() { this.monitors.forEach(callback =\u003e { try { callback(this.state); } catch (error) { console.error('Circuit breaker monitor error:', error); } }); } // 상태 변경 이벤트 구독 onStateChange(callback) { this.monitors.push(callback); return () =\u003e { this.monitors = this.monitors.filter(cb =\u003e cb !== callback); }; } } // 서킷 브레이커 사용 예시 const paymentServiceBreaker = new CircuitBreaker({ failureThreshold: 3, resetTimeout: 10000 }); // 로깅 및 메트릭 수집 paymentServiceBreaker.onStateChange(state =\u003e { console.log(`Payment service circuit breaker state changed to: ${state}`); metrics.recordCircuitBreakerState('payment-service', state); }); // API 호출 시 서킷 브레이커 적용 async function processPayment(paymentData) { try { return await paymentServiceBreaker.execute(() =\u003e { return paymentApiClient.processPayment(paymentData); }); } catch (error) { if (error.message.includes('Circuit is OPEN')) { // 대체 결제 처리 또는 사용자에게 알림 return fallbackPaymentProcessing(paymentData); } throw error; } } 재시도와 멱등성 재시도 전략을 안전하게 구현하기 위해서는 API 작업의 멱등성(idempotency)을 고려해야 한다.\n멱등성이란? 멱등성은 동일한 요청을 여러 번 실행해도 시스템 상태가 한 번 실행한 것과 동일한 상태가 되는 속성을 의미한다. 멱등한 작업은 재시도해도 안전하다.\nHTTP 메서드별 멱등성 멱등한 메서드: GET, PUT, DELETE, HEAD, OPTIONS 멱등하지 않은 메서드: POST, PATCH 멱등성 구현 전략 멱등성 키 사용:\n클라이언트가 각 요청에 고유 식별자 제공 서버는 이미 처리된 요청을 감지하고 중복 처리 방지 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 // 클라이언트 측 구현 async function createOrder(orderData) { // 클라이언트 생성 고유 ID const idempotencyKey = generateUUID(); const response = await fetch('/api/orders', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Idempotency-Key': idempotencyKey }, body: JSON.stringify(orderData) }); // 응답 처리… } // 서버 측 구현 (Express.js) // 멱등성 키 처리 미들웨어 function idempotencyMiddleware(req, res, next) { const idempotencyKey = req.headers['idempotency-key']; if (!idempotencyKey \u0026\u0026 req.method === 'POST') { return res.status(400).json({ error: { code: 'MISSING_IDEMPOTENCY_KEY', message: 'Idempotency-Key header is required for POST requests' } }); } if (idempotencyKey) { // 캐시에서 이전 응답 확인 redisClient.get(`idempotency:${idempotencyKey}`, (err, cachedResponse) =\u003e { if (err) { return next(err); } if (cachedResponse) { // 이미 처리된 요청이므로 캐시된 응답 반환 const parsedResponse = JSON.parse(cachedResponse); return res.status(parsedResponse.status) .set(parsedResponse.headers) .send(parsedResponse.body); } // 기존 응답 객체 메서드 저장 const originalSend = res.send; const originalJson = res.json; const originalStatus = res.status; // 응답 데이터 캡처 let responseBody; let responseStatus = 200; const responseHeaders = {}; // 응답 메서드 재정의 res.send = function(body) { responseBody = body; originalSend.apply(res, arguments); return res; }; res.json = function(body) { responseBody = body; originalJson.apply(res, arguments); return res; }; res.status = function(code) { responseStatus = code; originalStatus.apply(res, arguments); return res; }; res.on('finish', () =\u003e { // 성공적인 응답만 캐시 if (responseStatus \u003e= 200 \u0026\u0026 responseStatus \u003c 500) { const cacheEntry = { status: responseStatus, headers: responseHeaders, body: responseBody }; // 응답 캐싱 (24시간 TTL) redisClient.set( `idempotency:${idempotencyKey}`, JSON.stringify(cacheEntry), 'EX', 86400 ); } }); next(); }); } else { next(); } } 조건부 요청:\nHTTP 조건부 요청 헤더(If-Match, If-None-Match 등) 사용 리소스 상태를 기반으로 작업 수행 여부 결정 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // 조건부 업데이트 예시 async function updateUserIfNotChanged(userId, userData, etag) { const response = await fetch(`/api/users/${userId}`, { method: 'PUT', headers: { 'Content-Type': 'application/json', 'If-Match': etag // 리소스가 변경되지 않은 경우에만 업데이트 }, body: JSON.stringify(userData) }); if (response.status === 412) { // Precondition Failed // 리소스가 변경되었으므로 최신 데이터 가져오기 const currentData = await fetch(`/api/users/${userId}`).then(r =\u003e r.json()); // 충돌 해결 로직… return { conflict: true, currentData }; } return response.json(); } 거래 ID 사용:\n전체 거래(여러 API 호출로 구성될 수 있음)에 대한 고유 ID 사용 데이터베이스에 거래 상태 저장하여 중복 처리 방지 프로덕션 환경에서의 오류 모니터링 및 분석 효과적인 오류 처리를 위해서는 프로덕션 환경에서 발생하는 오류를 지속적으로 모니터링하고 분석하는 것이 중요하다.\n모니터링 및 알림 시스템 주요 모니터링 대상 오류 발생률: 전체 요청 대비 오류 비율 오류 유형 분포: 다양한 오류 유형의 발생 빈도 서비스 수준 목표(SLO): 가용성 및 성능 지표 재시도 패턴: 재시도 빈도 및 성공률 서킷 브레이커 상태: 열림/닫힘 상태 및 전환 빈도 모니터링 도구 및 통합 애플리케이션 성능 모니터링(APM): New Relic, Datadog, Dynatrace 등 로그 집계 및 분석: ELK 스택(Elasticsearch, Logstash, Kibana), Graylog 메트릭 시각화: Grafana, Prometheus 오류 추적 서비스: Sentry, Rollbar, Bugsnag 분산 추적: Jaeger, Zipkin 오류 패턴 분석 수집된 오류 데이터를 분석하여 패턴을 식별하고 근본 원인을 파악한다:\n오류 분석 방법 오류 빈도 및 영향 평가: 가장 자주 발생하는 오류와 그 영향 분석 시간적 패턴 분석: 특정 시간이나 이벤트와 관련된 오류 패턴 식별 사용자 영향 분석: 오류가 사용자 경험에 미치는 영향 평가 근본 원인 분석: 오류의 근본 원인 및 해결 방안 식별 오류 분류 및 우선순위 지정 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 // 오류 분류 및 심각도 평가 함수 function categorizeError(error) { // 기본 정보 수집 const errorData = { type: error.name || 'Unknown', message: error.message, stack: error.stack, timestamp: new Date().toISOString(), component: error.component || getCurrentComponent(), requestId: error.requestId || getCurrentRequestId(), userId: getCurrentUserId(), url: error.url || window.location.href }; // 심각도 결정 let severity = 'info'; if (error instanceof NetworkError || error.status \u003e= 500) { severity = 'error'; } else if (error instanceof AuthError) { severity = 'warning'; } else if (error instanceof ValidationError) { severity = 'info'; } // 재시도 가능성 평가 const isRetryable = evaluateRetryability(error); // 사용자 영향 평가 const userImpact = evaluateUserImpact(error); // 비즈니스 영향 평가 const businessImpact = evaluateBusinessImpact(error); // 우선순위 계산 const priority = calculatePriority(severity, userImpact, businessImpact); return { …errorData, severity, isRetryable, userImpact, businessImpact, priority }; } // 오류 보고 및 처리 function reportError(error) { const categorizedError = categorizeError(error); // 심각도에 따른 처리 switch (categorizedError.severity) { case 'error': // 중요 오류는 즉시 알림 notifyOnCall(categorizedError); break; case 'warning': // 경고는 집계 후 알림 addToErrorAggregation(categorizedError); break; // 기타 심각도… } // 모든 오류는 중앙 에러 추적 시스템에 보고 errorTrackingService.captureException(error, { extra: categorizedError }); // 내부 분석을 위한 로깅 logger.log(categorizedError.severity, JSON.stringify(categorizedError)); } 사례 연구 및 실제 예시 다양한 산업 및 애플리케이션 유형에서의 API 오류 처리 및 재시도 전략의 실제 사례\n전자상거래 플랫폼 시나리오 대규모 전자상거래 플랫폼에서 결제 처리 API의 오류 처리 및 재시도 전략\n주요 도전 과제 고객 경험에 직접적인 영향을 미치는 중요한 거래 외부 결제 게이트웨이에 대한 의존성 부분적으로 완료된 거래의 일관성 유지 높은 거래량과 트래픽 스파이크 구현된 솔루션 멱등성 처리: 모든 결제 요청에 클라이언트 생성 멱등성 키 사용 동일한 거래 ID에 대한 중복 처리 방지 계층적 재시도 전략: 클라이언트 측: 사용자에게 영향을 미치지 않는 배경 재시도 서버 측: 결제 게이트웨이 API 호출에 대한 지능적 재시도 비동기 작업 큐: 실패한 작업을 나중에 재시도할 수 있도록 큐에 저장 복원력 패턴: 서킷 브레이커: 외부 결제 프로세서 문제 감지 및 대체 프로세서로 전환 대체 경로: 주요 결제 방법이 실패할 경우 대체 결제 방법 제안 사용자 경험 최적화: 배경 재시도: 사용자에게 보이지 않게 재시도 진행 명확한 오류 메시지: 사용자가 이해하기 쉬운 오류 설명과 해결 방법 제공 진행 상태 추적: 주문 처리 단계를 명확히 표시하여 사용자가 프로세스 상태를 이해할 수 있도록 함 모니터링 및 분석: 실시간 대시보드: 결제 오류율 및 유형 모니터링 자동 알림: 특정 임계값 초과 시 운영팀에 알림 정기적인 리뷰: 결제 오류 패턴 분석 및 개선점 도출 결과 결제 성공률 99.5%로 향상 결제 관련 고객 문의 40% 감소 결제 처리 시스템의 복원력 개선으로 서비스 중단 감소 모바일 애플리케이션 시나리오 불안정한 네트워크 환경에서 작동해야 하는 모바일 애플리케이션의 API 클라이언트\n주요 도전 과제 간헐적인 네트워크 연결 제한된 배터리 및 데이터 사용량 다양한 네트워크 상태(Wi-Fi, 셀룰러, 오프라인) 백그라운드 동기화 요구사항 구현된 솔루션 오프라인 우선 아키텍처: 로컬 데이터 저장소: 모든 사용자 작업을 먼저 로컬에 저장 작업 큐: 오프라인 상태에서 수행된 작업을 서버 동기화를 위한 큐에 저장 네트워크 인식 재시도: 네트워크 상태 모니터링: 연결 유형 및 품질에 따른 재시도 전략 조정 배터리 인식: 배터리 잔량이 적을 때 재시도 빈도 감소 동기화 전략: 우선순위 기반 동기화: 중요한 작업 먼저 동기화 일괄 처리: 여러 작업을 하나의 네트워크 요청으로 묶어 효율성 향상 충돌 해결: 자동 해결: 가능한 경우 충돌 자동 해결 알고리즘 적용 사용자 안내: 복잡한 충돌의 경우 사용자에게 해결 옵션 제공 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 // 모바일 애플리케이션에서의 오프라인 우선 API 클라이언트 구현 class OfflineFirstApiClient { constructor(options = {}) { this.apiBaseUrl = options.apiBaseUrl || 'https://api.example.com'; this.syncManager = new SyncManager(); this.networkMonitor = new NetworkMonitor(); this.localStore = new LocalStore(); // 네트워크 상태 변경 시 동기화 시도 this.networkMonitor.onConnectivityChange((isConnected) =\u003e { if (isConnected) { this.syncManager.attemptSync(); } }); } // 데이터 생성 요청 async create(endpoint, data) { // 고유 ID 생성 const localId = generateUUID(); const timestamp = Date.now(); // 로컬 저장소에 저장 await this.localStore.saveItem(endpoint, { id: localId, data, status: 'pending', operation: 'create', timestamp }); // 네트워크 연결 확인 if (this.networkMonitor.isConnected()) { try { // 서버에 즉시 동기화 시도 const result = await this.syncManager.syncItem(endpoint, localId); return result; } catch (error) { // 오류 발생 시 작업은 여전히 큐에 남아 있음 console.log(`Synchronization failed, will retry later: ${error.message}`); return { id: localId, status: 'pending', data }; } } else { // 오프라인 상태 - 나중에 동기화 console.log('Offline - item queued for later synchronization'); return { id: localId, status: 'pending', data }; } } // 데이터 업데이트 요청 async update(endpoint, id, data) { // 로컬 데이터 업데이트 await this.localStore.updateItem(endpoint, id, { data, status: 'pending', operation: 'update', timestamp: Date.now() }); // 즉시 동기화 시도 if (this.networkMonitor.isConnected()) { return this.syncManager.syncItem(endpoint, id); } return { id, status: 'pending', data }; } // 데이터 조회 요청 async get(endpoint, id) { // 먼저 로컬 데이터 확인 const localData = await this.localStore.getItem(endpoint, id); // 네트워크 연결 확인 if (this.networkMonitor.isConnected()) { try { // 서버에서 최신 데이터 가져오기 const response = await fetch(`${this.apiBaseUrl}/${endpoint}/${id}`); if (!response.ok) { throw new Error(`API error: ${response.status}`); } const serverData = await response.json(); // 로컬 데이터 업데이트 await this.localStore.saveItem(endpoint, { id, data: serverData, status: 'synced', timestamp: Date.now() }); return serverData; } catch (error) { console.log(`Error fetching data: ${error.message}`); // 오류 발생 시 로컬 데이터 반환 return localData ? localData.data : null; } } else { // 오프라인 상태 - 로컬 데이터만 반환 return localData ? localData.data : null; } } } // 동기화 관리자 class SyncManager { constructor() { this.syncQueue = []; this.isSyncing = false; this.retryDelay = 1000; this.maxRetries = 5; // 주기적인 동기화 시도 (5분마다) setInterval(() =\u003e this.attemptSync(), 5 * 60 * 1000); } // 모든 대기 중인 항목 동기화 시도 async attemptSync() { if (this.isSyncing) return; this.isSyncing = true; try { // 동기화 큐 처리 const pendingItems = await localStore.getPendingItems(); // 배터리 및 네트워크 상태에 따라 동기화 전략 조정 const batchSize = this.determineBatchSize(); const prioritizedItems = this.prioritizeItems(pendingItems); for (let i = 0; i \u003c prioritizedItems.length; i += batchSize) { const batch = prioritizedItems.slice(i, i + batchSize); await this.processBatch(batch); } } catch (error) { console.error('Sync error:', error); } finally { this.isSyncing = false; } } // 네트워크 및 배터리 상태에 따른 배치 크기 결정 determineBatchSize() { const networkType = networkMonitor.getConnectionType(); const batteryLevel = batteryMonitor.getBatteryLevel(); // 배터리 부족 또는 셀룰러 네트워크에서는 작은 배치 사용 if (batteryLevel \u003c 0.2 || networkType === 'cellular') { return 5; } // Wi-Fi 및 충분한 배터리에서는 큰 배치 사용 return 20; } // 항목 우선순위 지정 prioritizeItems(items) { return items.sort((a, b) =\u003e { // 1. 작업 유형 (생성 \u003e 업데이트 \u003e 삭제) if (a.operation !== b.operation) { const operationPriority = { 'create': 3, 'update': 2, 'delete': 1 }; return operationPriority[b.operation] - operationPriority[a.operation]; } // 2. 엔드포인트 우선순위 (중요한 데이터 먼저) const endpointPriority = { 'payments': 5, 'orders': 4, 'profiles': 3, 'preferences': 2, 'logs': 1 }; const aPriority = endpointPriority[a.endpoint] || 0; const bPriority = endpointPriority[b.endpoint] || 0; if (aPriority !== bPriority) { return bPriority - aPriority; } // 3. 타임스탬프 (오래된 항목 먼저) return a.timestamp - b.timestamp; }); } } 결과 약한 네트워크 환경에서도 97% 동기화 성공률 달성 오프라인 상태에서도 앱 사용성 유지 네트워크 데이터 사용량 30% 감소 배터리 사용량 최적화 9.3 금융 서비스 API 시나리오 높은 신뢰성과 정확성이 요구되는 금융 거래 API\n주요 도전 과제 0% 오류 허용 정책 엄격한 규정 준수 요구사항 고의적 API 남용 및 공격 대응 감사 및 추적 필요성 구현된 솔루션 심층 방어(Defense in Depth): 다중 검증 계층: 클라이언트 측, API 게이트웨이, 서비스 계층, 데이터베이스 계층의 검증 이중 제출 방지: 멱등성 키와 거래 ID를 통한 중복 거래 방지 정교한 오류 처리: 분류된 오류 코드: 상세한 오류 분류 체계 보안 강화 오류 메시지: 민감한 정보를 노출하지 않는 오류 응답 재시도 관리: 조건부 재시도: 시스템 상태 및 거래 유형에 따른 재시도 결정 재시도 알림: 재시도 시 관리자에게 자동 알림 감사 및 규정 준수: 전체 요청 및 응답 로깅: 감사 목적으로 모든 API 상호작용 기록 결과 증명: 각 거래에 대한 암호학적 증명 생성 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 // 금융 거래 API 오류 처리 예시 @RestController @RequestMapping(\"/api/v1/transactions\") public class TransactionController { private final TransactionService transactionService; private final AuditService auditService; private final IdempotencyService idempotencyService; // 거래 생성 API @PostMapping public ResponseEntity\u003cTransactionResponse\u003e createTransaction( @RequestHeader(\"X-Idempotency-Key\") String idempotencyKey, @Valid @RequestBody TransactionRequest request, Authentication authentication) { // 사용자 인증 및 권한 확인 User user = (User) authentication.getPrincipal(); if (!transactionService.canInitiateTransaction(user, request.getAccountId())) { // 권한 오류 감사 로깅 auditService.logAccessDenied(user.getId(), \"transaction_initiate\", request.getAccountId()); return ResponseEntity.status(HttpStatus.FORBIDDEN) .body(TransactionResponse.error(\"ACCESS_DENIED\", \"You don't have permission to initiate transactions for this account\")); } try { // 멱등성 확인 Optional\u003cTransactionResponse\u003e cachedResponse = idempotencyService.getCachedResponse(idempotencyKey, user.getId()); if (cachedResponse.isPresent()) { // 중복 요청 - 이전 응답 반환 return ResponseEntity.ok(cachedResponse.get()); } // 거래 처리 (여러 검증 단계 포함) TransactionResult result = transactionService.processTransaction(request, user); // 성공한 거래 응답 캐싱 TransactionResponse response = TransactionResponse.success(result); idempotencyService.cacheResponse(idempotencyKey, user.getId(), response); // 감사 로깅 auditService.logSuccessfulTransaction( result.getTransactionId(), user.getId(), request.getAccountId(), request.getAmount(), result.getTimestamp()); return ResponseEntity.status(HttpStatus.CREATED).body(response); } catch (InsufficientFundsException e) { // 비즈니스 규칙 위반 - 자금 부족 auditService.logTransactionFailed(user.getId(), request.getAccountId(), \"INSUFFICIENT_FUNDS\", request.getAmount()); return ResponseEntity.status(HttpStatus.PAYMENT_REQUIRED) .body(TransactionResponse.error(\"INSUFFICIENT_FUNDS\", \"Insufficient funds in the account\")); } catch (AccountLockedException e) { // 계정 잠김 - 재시도 정보 포함 return ResponseEntity.status(HttpStatus.LOCKED) .header(\"Retry-After\", String.valueOf(e.getLockDurationSeconds())) .body(TransactionResponse.error(\"ACCOUNT_LOCKED\", \"Account is temporarily locked. Please try again later.\")); } catch (TransactionLimitExceededException e) { // 거래 한도 초과 return ResponseEntity.status(HttpStatus.FORBIDDEN) .body(TransactionResponse.error(\"LIMIT_EXCEEDED\", \"Transaction exceeds your daily/monthly limit\")); } catch (DuplicateTransactionException e) { // 중복 거래 (멱등성이 아닌 비즈니스 기준) return ResponseEntity.status(HttpStatus.CONFLICT) .body(TransactionResponse.error(\"DUPLICATE_TRANSACTION\", \"A similar transaction was recently processed\")); } catch (Exception e) { // 예상치 못한 오류 String errorId = UUID.randomUUID().toString(); auditService.logSystemError(errorId, user.getId(), e); return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR) .body(TransactionResponse.error(\"SYSTEM_ERROR\", \"An unexpected error occurred. Reference: \" + errorId)); } } } // 트랜잭션 서비스의 재시도 로직 @Service @Transactional public class TransactionServiceImpl implements TransactionService { private final TransactionRepository transactionRepository; private final AccountService accountService; private final NotificationService notificationService; @Override public TransactionResult processTransaction(TransactionRequest request, User user) { // 트랜잭션 생성 및 초기 상태 저장 Transaction transaction = new Transaction(); transaction.setStatus(TransactionStatus.PENDING); transaction.setTransactionId(generateTransactionId()); transaction.setAmount(request.getAmount()); transaction.setSourceAccountId(request.getSourceAccountId()); transaction.setDestinationAccountId(request.getDestinationAccountId()); transaction.setUserId(user.getId()); transaction.setCreatedAt(LocalDateTime.now()); transactionRepository.save(transaction); try { // 외부 결제 게이트웨이 호출 PaymentResult paymentResult = processPayment(transaction); // 결과 업데이트 transaction.setStatus(TransactionStatus.COMPLETED); transaction.setCompletedAt(LocalDateTime.now()); transaction.setExternalReference(paymentResult.getReferenceId()); // 알림 전송 notificationService.sendTransactionConfirmation(transaction); return new TransactionResult( transaction.getTransactionId(), TransactionStatus.COMPLETED, transaction.getCompletedAt() ); } catch (PaymentGatewayTimeoutException e) { // 시간 초과 - 재시도 가능 return handlePaymentTimeout(transaction, e); } catch (PaymentGatewayErrorException e) { // 게이트웨이 오류 - 거래 실패로 표시 transaction.setStatus(TransactionStatus.FAILED); transaction.setErrorCode(e.getErrorCode()); transaction.setErrorMessage(e.getMessage()); transactionRepository.save(transaction); throw new TransactionFailedException(\"Payment gateway error: \" + e.getMessage()); } } private TransactionResult handlePaymentTimeout(Transaction transaction, PaymentGatewayTimeoutException e) { // 게이트웨이 시간 초과 - 거래 상태 확인 필요 transaction.setStatus(TransactionStatus.PENDING_VERIFICATION); transactionRepository.save(transaction); // 비동기 검증 작업 예약 verificationTaskScheduler.scheduleVerification(transaction.getTransactionId()); // 관리자에게 알림 notificationService.alertOperator( \"PAYMENT_TIMEOUT\", \"Transaction \" + transaction.getTransactionId() + \" requires verification\", transaction ); // 클라이언트에게 확인 대기 중 응답 return new TransactionResult( transaction.getTransactionId(), TransactionStatus.PENDING_VERIFICATION, null ); } // 거래 상태 확인 (비동기 검증용) @Transactional public TransactionResult verifyTransactionStatus(String transactionId) { Transaction transaction = transactionRepository.findByTransactionId(transactionId) .orElseThrow(() -\u003e new TransactionNotFoundException(transactionId)); if (transaction.getStatus() != TransactionStatus.PENDING_VERIFICATION) { return new TransactionResult( transaction.getTransactionId(), transaction.getStatus(), transaction.getCompletedAt() ); } try { // 결제 게이트웨이에 상태 확인 PaymentStatusResult statusResult = paymentGateway.checkStatus(transaction.getExternalReference()); switch (statusResult.getStatus()) { case COMPLETED: transaction.setStatus(TransactionStatus.COMPLETED); transaction.setCompletedAt(LocalDateTime.now()); break; case FAILED: transaction.setStatus(TransactionStatus.FAILED); transaction.setErrorCode(statusResult.getErrorCode()); transaction.setErrorMessage(statusResult.getErrorMessage()); break; case PENDING: // 여전히 대기 중 - 나중에 다시 확인 return new TransactionResult( transaction.getTransactionId(), TransactionStatus.PENDING_VERIFICATION, null ); } transactionRepository.save(transaction); // 결과에 따른 알림 if (transaction.getStatus() == TransactionStatus.COMPLETED) { notificationService.sendTransactionConfirmation(transaction); } else if (transaction.getStatus() == TransactionStatus.FAILED) { notificationService.sendTransactionFailure(transaction); } return new TransactionResult( transaction.getTransactionId(), transaction.getStatus(), transaction.getCompletedAt() ); } catch (Exception e) { // 확인 중 오류 - 수동 검토 필요 transaction.setStatus(TransactionStatus.MANUAL_REVIEW_REQUIRED); transaction.setNotes(\"Verification failed: \" + e.getMessage()); transactionRepository.save(transaction); // 수동 검토 알림 notificationService.alertOperator( \"MANUAL_REVIEW_REQUIRED\", \"Transaction \" + transactionId + \" requires manual review\", transaction ); return new TransactionResult( transaction.getTransactionId(), TransactionStatus.MANUAL_REVIEW_REQUIRED, null ); } } } 결과 99.999% 트랜잭션 성공률 달성 엄격한 규제 요구사항 충족 거래 분쟁 50% 감소 신속한 문제 해결을 위한 강력한 감사 추적 구현 용어 정리 용어 설명 백오프(Backoff) 네트워크 통신 또는 시스템에서 충돌이나 오류가 발생했을 때, 재시도 간격을 조정하여 문제를 해결하거나 시스템 자원을 효율적으로 사용하는 데 활용되는 기법\n충돌 감지 및 대기:\n- 두 개 이상의 노드가 동시에 데이터를 전송하려고 할 때 충돌이 발생한다. 백오프는 이러한 충돌을 감지한 후 일정 시간 대기하여 재전송을 시도하는 방식이다. - 대기 시간은 랜덤하게 설정되며, 이를 통해 재충돌 확률을 줄인다. 재시도 간격 조정:\n- 백오프는 재시도 간격을 점진적으로 늘려가며, 네트워크 혼잡이나 서버 과부하를 완화한다. - 이 과정에서 일정한 패턴(예: 지수적 증가)을 따르거나 랜덤 값을 추가하여 효율성을 높인다. 서지(Surge) 문제 시스템이나 네트워크에서 짧은 시간 동안 갑작스럽게 요청이나 트래픽이 급증하는 현상을 의미한다. 이러한 문제는 클라이언트-서버 환경, 분산 시스템, 네트워크 인프라 등 다양한 기술적 환경에서 발생할 수 있으며, 시스템 성능 저하, 과부하, 또는 장애를 초래할 수 있다.\n- 서지(Surge) 문제의 주요 원인\n1. 사용자 요청의 급증: - 특정 시간대에 대규모 사용자들이 동시에 서비스를 이용하려는 경우(예: 쇼핑몰의 할인 행사, 티켓 예매 시작). 2. 시스템 장애로 인한 재시도 요청: - 클라이언트가 실패한 요청을 반복적으로 재시도하면서 트래픽이 폭발적으로 증가. 3. 외부 이벤트: - 자연재해, 데이터 유출 등 예기치 못한 사건으로 인해 고객 지원 요청이 급증. 4. 봇 트래픽 및 DDoS 공격: - 악의적인 봇이나 분산 서비스 거부 공격으로 인해 비정상적인 트래픽이 발생.\n- 서지 문제로 인한 영향\n1. 네트워크 혼잡: - 트래픽이 폭증하면 네트워크 대역폭이 포화 상태에 도달하여 정상적인 데이터 전송이 지연된다. 2. 서버 과부하: - 서버가 처리할 수 있는 최대 연결 수를 초과하면 응답 시간이 길어지거나 요청이 거부된다. 3. 서비스 중단: - 과도한 부하로 인해 시스템이 다운되거나 사용자가 오류 페이지를 보게 되는 상황 발생. 4. 데이터 손실 및 성능 저하: - 처리되지 않은 요청이 큐에 쌓이며 타임아웃 발생 또는 데이터 손실 가능성 증가. 5. 비용 증가: - 클라우드 환경에서는 급격한 트래픽 처리를 위해 추가적인 자원 할당(오토스케일링)이 필요하여 비용 부담 증가.\nJitter 재시도 간격에 랜덤성을 추가하는 기법으로, 네트워크나 시스템의 안정성을 높이고 성능 저하를 방지하기 위해 사용된다. - Jitter의 필요성\n1. 동기화된 재시도의 문제(Thundering Herd Problem): - 여러 클라이언트가 동일한 실패 조건을 감지하고, 고정된 간격으로 재시도를 시도하면 서버에 과도한 부하가 발생할 수 있다. - 예를 들어, 100개의 클라이언트가 5초 후 동시에 재시도하면 서버는 다시 과부하 상태에 빠질 가능성이 높다. 2. 재충돌 방지: - 백오프 간격이 고정되거나 동일한 알고리즘을 따르는 경우, 클라이언트들이 동일한 시간에 다시 요청을 보내 충돌이 반복될 수 있다. 3. 트래픽 스파이크 완화: - Jitter는 요청 시간을 분산시켜 트래픽이 특정 시간대에 몰리는 것을 방지한다. 참고 및 출처 ","wordCount":"7375","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2025-02-13T01:31:00Z","dateModified":"2025-02-13T01:31:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/software-development--engineering/platform-development/backend-development/api-development/api-implementation/error-handling-and-validation/error-handling-and-retries/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1 class="post-title entry-hint-parent">Error Handling and Retries</h1><div class=post-description>효과적인 오류 처리와 재시도 메커니즘은 안정적인 API 설계의 핵심 요소이다.</div><div class=post-meta><span title='2025-02-13 01:31:00 +0000 UTC'>February 13, 2025</span>&nbsp;·&nbsp;<span>35 min</span>&nbsp;·&nbsp;<span>Me</span>&nbsp;|&nbsp;<span>
<a href=https://github.com/buenhyden/blog-data/main/content/posts/Software%20Development%20&%20Engineering/Platform%20Development/Backend%20Development/API%20Development/API%20Implementation/Error%20Handling%20and%20Validation/Error-Handling-and-Retries.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#error-handling-and-retries>Error Handling and Retries</a><ul><li><a href=#api-오류-처리의-중요성>API 오류 처리의 중요성</a></li><li><a href=#api-오류-유형-및-분류>API 오류 유형 및 분류</a></li><li><a href=#효과적인-api-오류-응답-설계>효과적인 API 오류 응답 설계</a></li><li><a href=#서버-측-오류-처리-전략>서버 측 오류 처리 전략</a></li><li><a href=#클라이언트-측-오류-처리-전략>클라이언트 측 오류 처리 전략</a></li><li><a href=#api-재시도-전략>API 재시도 전략</a></li><li><a href=#프로덕션-환경에서의-오류-모니터링-및-분석>프로덕션 환경에서의 오류 모니터링 및 분석</a></li><li><a href=#사례-연구-및-실제-예시>사례 연구 및 실제 예시</a></li></ul></li><li><a href=#용어-정리>용어 정리</a></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=error-handling-and-retries>Error Handling and Retries<a hidden class=anchor aria-hidden=true href=#error-handling-and-retries>#</a></h2><p>현대 소프트웨어 아키텍처에서 API는 중추적인 역할을 담당하며, 다양한 시스템 간의 원활한 통신을 가능하게 한다. 그러나 네트워크 불안정성, 서버 과부하, 일시적인 서비스 중단 등 다양한 이유로 API 호출은 항상 성공적으로 완료되지 않을 수 있다. 따라서 효과적인 오류 처리와 재시도 메커니즘은 안정적인 API 설계의 핵심 요소이다.</p><h3 id=api-오류-처리의-중요성>API 오류 처리의 중요성<a hidden class=anchor aria-hidden=true href=#api-오류-처리의-중요성>#</a></h3><h4 id=오류-처리가-중요한-이유>오류 처리가 중요한 이유<a hidden class=anchor aria-hidden=true href=#오류-처리가-중요한-이유>#</a></h4><p>효과적인 오류 처리는 다음과 같은 여러 이유로 중요하다:</p><ol><li><strong>사용자 경험 향상</strong>: 명확한 오류 메시지는 사용자가 문제를 이해하고 해결할 수 있게 도와준다.</li><li><strong>디버깅 용이성</strong>: 상세한 오류 정보는 개발자가 문제를 신속하게 식별하고 해결하는 데 도움이 된다.</li><li><strong>시스템 안정성</strong>: 적절한 오류 처리는 예기치 않은 상황에서도 애플리케이션이 계속 작동할 수 있게 한다.</li><li><strong>보안 강화</strong>: 오류 처리는 민감한 정보 노출을 방지하고 잠재적인 공격 벡터를 감소시킨다.</li><li><strong>API 사용성</strong>: 일관되고 예측 가능한 오류 응답은 API의 사용성을 크게 향상시킨다.</li></ol><h4 id=부적절한-오류-처리의-결과>부적절한 오류 처리의 결과<a hidden class=anchor aria-hidden=true href=#부적절한-오류-처리의-결과>#</a></h4><p>오류 처리가 제대로 구현되지 않으면 다음과 같은 문제가 발생할 수 있다:</p><ol><li><strong>애플리케이션 장애</strong>: 처리되지 않은 예외로 인한 전체 시스템 중단</li><li><strong>사용자 혼란</strong>: 불명확한 오류 메시지로 인한 사용자 좌절감 증가</li><li><strong>리소스 낭비</strong>: 실패한 요청이 적절히 처리되지 않아 시스템 리소스 소모</li><li><strong>데이터 불일치</strong>: 부분적으로 완료된 작업으로 인한 데이터 무결성 문제</li><li><strong>보안 취약점</strong>: 과도한 오류 정보 노출로 인한 잠재적 보안 위험</li></ol><h3 id=api-오류-유형-및-분류>API 오류 유형 및 분류<a hidden class=anchor aria-hidden=true href=#api-오류-유형-및-분류>#</a></h3><p>API 오류를 효과적으로 처리하기 위해서는 먼저 다양한 유형의 오류를 이해해야 한다.</p><h4 id=오류의-기본-분류>오류의 기본 분류<a hidden class=anchor aria-hidden=true href=#오류의-기본-분류>#</a></h4><p>API 오류는 크게 다음 네 가지 범주로 분류할 수 있다:</p><ol><li><strong>클라이언트 오류 (4xx)</strong>: 잘못된 요청, 인증 실패, 권한 부족 등 클라이언트 측 문제로 인한 오류</li><li><strong>서버 오류 (5xx)</strong>: 서버 내부 오류, 서비스 불가, 게이트웨이 오류 등 서버 측 문제로 인한 오류</li><li><strong>네트워크 오류</strong>: 연결 시간 초과, 네트워크 단절, DNS 해석 실패 등</li><li><strong>비즈니스 로직 오류</strong>: 기술적으로는 성공적이지만 비즈니스 규칙 위반으로 인한 오류</li></ol><h4 id=일시적-vs-영구적-오류>일시적 vs. 영구적 오류<a hidden class=anchor aria-hidden=true href=#일시적-vs-영구적-오류>#</a></h4><p>오류를 처리하고 재시도 전략을 개발할 때 오류의 지속성 특성을 이해하는 것이 중요하다:</p><ol><li><strong>일시적 오류 (Transient Failures)</strong>:<ul><li>잠시 후 자동으로 해결될 수 있는 오류</li><li>예: 네트워크 지연, 서버 과부하, 일시적인 서비스 중단</li><li>재시도가 효과적인 경우</li></ul></li><li><strong>영구적 오류 (Permanent Failures)</strong>:<ul><li>조치 없이는 해결되지 않는 오류</li><li>예: 인증 실패, 권한 부족, 리소스 부재, 유효하지 않은 입력 데이터</li><li>재시도가 효과가 없거나 부적절한 경우</li></ul></li></ol><h4 id=일반적인-http-상태-코드>일반적인 HTTP 상태 코드<a hidden class=anchor aria-hidden=true href=#일반적인-http-상태-코드>#</a></h4><p>REST API에서는 HTTP 상태 코드를 사용하여 오류 상태를 전달한다.</p><p>가장 일반적인 오류 관련 상태 코드는 다음과 같다:</p><ol><li><p>클라이언트 오류 (4xx)</p><ul><li><strong>400 Bad Request</strong>: 유효하지 않은 요청 형식이나 매개변수</li><li><strong>401 Unauthorized</strong>: 인증 필요</li><li><strong>403 Forbidden</strong>: 인증되었으나 권한 부족</li><li><strong>404 Not Found</strong>: 요청된 리소스를 찾을 수 없음</li><li><strong>409 Conflict</strong>: 현재 상태와 충돌하는 요청</li><li><strong>422 Unprocessable Entity</strong>: 유효성 검사 실패</li><li><strong>429 Too Many Requests</strong>: 속도 제한 초과</li></ul></li><li><p>서버 오류 (5xx)</p><ul><li><strong>500 Internal Server Error</strong>: 일반적인 서버 오류</li><li><strong>502 Bad Gateway</strong>: 게이트웨이 또는 프록시 오류</li><li><strong>503 Service Unavailable</strong>: 일시적으로 서비스 사용 불가</li><li><strong>504 Gateway Timeout</strong>: 게이트웨이 시간 초과</li></ul></li></ol><h3 id=효과적인-api-오류-응답-설계>효과적인 API 오류 응답 설계<a hidden class=anchor aria-hidden=true href=#효과적인-api-오류-응답-설계>#</a></h3><h4 id=오류-응답-구조>오류 응답 구조<a hidden class=anchor aria-hidden=true href=#오류-응답-구조>#</a></h4><p>일관성 있고 유용한 API 오류 응답을 설계하기 위한 모범 사례는 다음과 같다:</p><h5 id=표준-오류-응답-형식>표준 오류 응답 형식<a hidden class=anchor aria-hidden=true href=#표준-오류-응답-형식>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=s2>&#34;RESOURCE_NOT_FOUND&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;The requested resource was not found.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;details&#34;</span><span class=p>:</span> <span class=s2>&#34;User with ID 12345 does not exist.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2023-06-15T08:42:15Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;requestId&#34;</span><span class=p>:</span> <span class=s2>&#34;req-123456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/api/users/12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=mi>404</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;userId&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;reason&#34;</span><span class=p>:</span> <span class=s2>&#34;not_found&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=주요-구성-요소>주요 구성 요소<a hidden class=anchor aria-hidden=true href=#주요-구성-요소>#</a></h5><ol><li><strong>코드 (code)</strong>: 기계가 읽을 수 있는 고유한 오류 식별자</li><li><strong>메시지 (message)</strong>: 사용자 친화적인 오류 설명</li><li><strong>세부 정보 (details)</strong>: 오류에 대한 추가 컨텍스트 (선택 사항)</li><li><strong>타임스탬프 (timestamp)</strong>: 오류 발생 시간</li><li><strong>요청 ID (requestId)</strong>: 요청 추적을 위한 고유 식별자</li><li><strong>경로 (path)</strong>: 오류가 발생한 API 엔드포인트</li><li><strong>상태 (status)</strong>: HTTP 상태 코드</li><li><strong>필드 (fields)</strong>: 특정 필드와 관련된 오류 (유효성 검사 오류의 경우)</li></ol><h4 id=오류-메시지-작성-지침>오류 메시지 작성 지침<a hidden class=anchor aria-hidden=true href=#오류-메시지-작성-지침>#</a></h4><p>효과적인 오류 메시지는 다음 특성을 갖추어야 한다:</p><ol><li><strong>명확성</strong>: 무슨 일이 일어났는지 분명하게 설명한다.</li><li><strong>간결성</strong>: 짧고 간결하게 정보를 전달한다.</li><li><strong>행동 지향성</strong>: 가능한 경우 문제 해결 방법을 제시한다.</li><li><strong>기술 용어 지양</strong>: 최종 사용자가 이해할 수 있는 언어를 사용한다.</li><li><strong>일관성</strong>: 전체 API에서 일관된 형식과 용어를 사용한다.</li></ol><h5 id=좋은-오류-메시지-예시>좋은 오류 메시지 예시<a hidden class=anchor aria-hidden=true href=#좋은-오류-메시지-예시>#</a></h5><ul><li>&ldquo;유효하지 않은 이메일 형식입니다. 올바른 이메일 주소를 입력해 주세요.&rdquo;</li><li>&ldquo;결제 금액은 양수여야 합니다.&rdquo;</li><li>&ldquo;요청된 사용자를 찾을 수 없습니다. 사용자 ID를 확인하세요.&rdquo;</li></ul><h5 id=나쁜-오류-메시지-예시>나쁜 오류 메시지 예시<a hidden class=anchor aria-hidden=true href=#나쁜-오류-메시지-예시>#</a></h5><ul><li>&ldquo;오류 발생!&rdquo;</li><li>&ldquo;데이터베이스 쿼리 실패: SQL 오류 #5123&rdquo;</li><li>&ldquo;NullPointerException이 발생했습니다.&rdquo;</li></ul><h4 id=다양한-환경에-맞는-오류-정보-수준>다양한 환경에 맞는 오류 정보 수준<a hidden class=anchor aria-hidden=true href=#다양한-환경에-맞는-오류-정보-수준>#</a></h4><p>오류 응답에 포함되는 정보의 양은 환경에 따라 조정되어야 한다:</p><ol><li><strong>개발 환경</strong>:<ul><li>상세한 디버깅 정보 포함</li><li>스택 추적, 예외 유형, 내부 오류 코드 등 포함 가능</li><li>세부적인 문맥 정보 제공</li></ul></li><li><strong>프로덕션 환경</strong>:<ul><li>민감한 내부 정보 제외</li><li>보안 위험을 야기할 수 있는 세부 정보 생략</li><li>사용자 친화적인 메시지에 중점</li><li>문제 추적을 위한 요청 ID 항상 포함</li></ul></li></ol><h3 id=서버-측-오류-처리-전략>서버 측 오류 처리 전략<a hidden class=anchor aria-hidden=true href=#서버-측-오류-처리-전략>#</a></h3><h4 id=api-엔드포인트에서의-오류-처리>API 엔드포인트에서의 오류 처리<a hidden class=anchor aria-hidden=true href=#api-엔드포인트에서의-오류-처리>#</a></h4><p>서버 측 API 구현에서 효과적인 오류 처리를 위한 접근 방식.</p><h5 id=유효성-검사>유효성 검사<a hidden class=anchor aria-hidden=true href=#유효성-검사>#</a></h5><p>입력 데이터 유효성 검사는 오류 처리의 첫 번째 방어선:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22>22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23>23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24>24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25>25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26>26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27>27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28>28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29>29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30>30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31>31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32>32</a>
</span><span class=lnt id=hl-1-33><a class=lnlinks href=#hl-1-33>33</a>
</span><span class=lnt id=hl-1-34><a class=lnlinks href=#hl-1-34>34</a>
</span><span class=lnt id=hl-1-35><a class=lnlinks href=#hl-1-35>35</a>
</span><span class=lnt id=hl-1-36><a class=lnlinks href=#hl-1-36>36</a>
</span><span class=lnt id=hl-1-37><a class=lnlinks href=#hl-1-37>37</a>
</span><span class=lnt id=hl-1-38><a class=lnlinks href=#hl-1-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java Spring Boot 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/users&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>createUser</span><span class=p>(</span><span class=nd>@Valid</span><span class=w> </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>UserRequest</span><span class=w> </span><span class=n>userRequest</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// @Valid 어노테이션이 유효성 검사를 처리합니다.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 유효하지 않은 경우 MethodArgumentNotValidException이 발생합니다.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userService</span><span class=p>.</span><span class=na>createUser</span><span class=p>(</span><span class=n>userRequest</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CREATED</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 전역 예외 처리기</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@ControllerAdvice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>GlobalExceptionHandler</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>MethodArgumentNotValidException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ErrorResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>handleValidationExceptions</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>MethodArgumentNotValidException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>FieldError</span><span class=o>&gt;</span><span class=w> </span><span class=n>fieldErrors</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ex</span><span class=p>.</span><span class=na>getBindingResult</span><span class=p>().</span><span class=na>getFieldErrors</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>fields</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fieldErrors</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>err</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;name&#34;</span><span class=p>,</span><span class=w> </span><span class=n>err</span><span class=p>.</span><span class=na>getField</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;reason&#34;</span><span class=p>,</span><span class=w> </span><span class=n>err</span><span class=p>.</span><span class=na>getDefaultMessage</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ErrorResponse</span><span class=w> </span><span class=n>errorResponse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;VALIDATION_ERROR&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;입력 데이터 유효성 검사에 실패했습니다.&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;하나 이상의 필드가 유효하지 않습니다.&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ZonedDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ex</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getRequestURI</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>.</span><span class=na>value</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>fields</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>errorResponse</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=예외-처리-및-매핑>예외 처리 및 매핑<a hidden class=anchor aria-hidden=true href=#예외-처리-및-매핑>#</a></h5><p>비즈니스 로직에서 발생하는 예외를 적절한 HTTP 응답으로 매핑하는 전략:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span><span class=lnt id=hl-2-27><a class=lnlinks href=#hl-2-27>27</a>
</span><span class=lnt id=hl-2-28><a class=lnlinks href=#hl-2-28>28</a>
</span><span class=lnt id=hl-2-29><a class=lnlinks href=#hl-2-29>29</a>
</span><span class=lnt id=hl-2-30><a class=lnlinks href=#hl-2-30>30</a>
</span><span class=lnt id=hl-2-31><a class=lnlinks href=#hl-2-31>31</a>
</span><span class=lnt id=hl-2-32><a class=lnlinks href=#hl-2-32>32</a>
</span><span class=lnt id=hl-2-33><a class=lnlinks href=#hl-2-33>33</a>
</span><span class=lnt id=hl-2-34><a class=lnlinks href=#hl-2-34>34</a>
</span><span class=lnt id=hl-2-35><a class=lnlinks href=#hl-2-35>35</a>
</span><span class=lnt id=hl-2-36><a class=lnlinks href=#hl-2-36>36</a>
</span><span class=lnt id=hl-2-37><a class=lnlinks href=#hl-2-37>37</a>
</span><span class=lnt id=hl-2-38><a class=lnlinks href=#hl-2-38>38</a>
</span><span class=lnt id=hl-2-39><a class=lnlinks href=#hl-2-39>39</a>
</span><span class=lnt id=hl-2-40><a class=lnlinks href=#hl-2-40>40</a>
</span><span class=lnt id=hl-2-41><a class=lnlinks href=#hl-2-41>41</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 사용자 정의 예외 클래스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ResourceNotFoundException</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>RuntimeException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>resourceType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>resourceId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ResourceNotFoundException</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>resourceType</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>resourceId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;%s with ID %s not found&#34;</span><span class=p>,</span><span class=w> </span><span class=n>resourceType</span><span class=p>,</span><span class=w> </span><span class=n>resourceId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>resourceType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resourceType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>resourceId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resourceId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// getters…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 서비스 레이어</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>UserService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=nf>getUserById</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>userRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>userId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResourceNotFoundException</span><span class=p>(</span><span class=s>&#34;User&#34;</span><span class=p>,</span><span class=w> </span><span class=n>userId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 전역 예외 처리기에 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>ResourceNotFoundException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ErrorResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>handleResourceNotFoundException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ResourceNotFoundException</span><span class=w> </span><span class=n>ex</span><span class=p>,</span><span class=w> </span><span class=n>HttpServletRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorResponse</span><span class=w> </span><span class=n>errorResponse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;RESOURCE_NOT_FOUND&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kc>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ZonedDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>getRequestURI</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>.</span><span class=na>value</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>errorResponse</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=트랜잭션-관리>트랜잭션 관리<a hidden class=anchor aria-hidden=true href=#트랜잭션-관리>#</a></h5><p>API 작업 중 오류가 발생했을 때 데이터 일관성을 유지하기 위한 트랜잭션 관리:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Order</span><span class=w> </span><span class=nf>createOrder</span><span class=p>(</span><span class=n>OrderRequest</span><span class=w> </span><span class=n>orderRequest</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 전체 작업이 트랜잭션으로 묶여 있어 일부에서 실패하면 모두 롤백됩니다.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Customer</span><span class=w> </span><span class=n>customer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>customerRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>orderRequest</span><span class=p>.</span><span class=na>getCustomerId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResourceNotFoundException</span><span class=p>(</span><span class=s>&#34;Customer&#34;</span><span class=p>,</span><span class=w> </span><span class=n>orderRequest</span><span class=p>.</span><span class=na>getCustomerId</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재고 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>OrderItemRequest</span><span class=w> </span><span class=n>item</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>orderRequest</span><span class=p>.</span><span class=na>getItems</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>productRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>item</span><span class=p>.</span><span class=na>getProductId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResourceNotFoundException</span><span class=p>(</span><span class=s>&#34;Product&#34;</span><span class=p>,</span><span class=w> </span><span class=n>item</span><span class=p>.</span><span class=na>getProductId</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>product</span><span class=p>.</span><span class=na>getStock</span><span class=p>()</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>item</span><span class=p>.</span><span class=na>getQuantity</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InsufficientStockException</span><span class=p>(</span><span class=n>product</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>product</span><span class=p>.</span><span class=na>getStock</span><span class=p>(),</span><span class=w> </span><span class=n>item</span><span class=p>.</span><span class=na>getQuantity</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 주문 생성 및 재고 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Order</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …주문 처리 로직…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=로깅-전략>로깅 전략<a hidden class=anchor aria-hidden=true href=#로깅-전략>#</a></h4><p>효과적인 오류 처리를 위해서는 적절한 로깅이 필수적:</p><h5 id=로그-레벨-선택>로그 레벨 선택<a hidden class=anchor aria-hidden=true href=#로그-레벨-선택>#</a></h5><p>상황에 맞는 로그 레벨 사용:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PaymentService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Logger</span><span class=w> </span><span class=n>log</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LoggerFactory</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>PaymentService</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PaymentResult</span><span class=w> </span><span class=nf>processPayment</span><span class=p>(</span><span class=n>PaymentRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 결제 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Payment processed successfully for order: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PaymentProviderTemporaryException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 일시적인 오류 - 재시도 가능</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;Temporary payment provider error: {}. Will retry.&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>ex</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PaymentDeclinedException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 정상적인 비즈니스 거부 - 심각한 오류 아님</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Payment declined: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>ex</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 예상치 못한 오류 - 심각한 문제</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Critical payment processing error&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ex</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PaymentFailedException</span><span class=p>(</span><span class=s>&#34;Payment processing failed unexpectedly&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ex</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=구조화된-로깅-및-컨텍스트-포함>구조화된 로깅 및 컨텍스트 포함<a hidden class=anchor aria-hidden=true href=#구조화된-로깅-및-컨텍스트-포함>#</a></h5><p>문제 진단에 필요한 충분한 컨텍스트 정보를 로그에 포함:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// MDC(Mapped Diagnostic Context)를 사용한 로깅</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RequestLoggingFilter</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>OncePerRequestFilter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>doFilterInternal</span><span class=p>(</span><span class=n>HttpServletRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>HttpServletResponse</span><span class=w> </span><span class=n>response</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                  </span><span class=n>FilterChain</span><span class=w> </span><span class=n>filterChain</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>ServletException</span><span class=p>,</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 요청 ID 생성 및 MDC에 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>requestId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MDC</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;requestId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>requestId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 요청 정보 로깅</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MDC</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;clientIp&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getRemoteAddr</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MDC</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;userAgent&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getHeader</span><span class=p>(</span><span class=s>&#34;User-Agent&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MDC</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;path&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getRequestURI</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 응답 헤더에 요청 ID 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>response</span><span class=p>.</span><span class=na>setHeader</span><span class=p>(</span><span class=s>&#34;X-Request-ID&#34;</span><span class=p>,</span><span class=w> </span><span class=n>requestId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>filterChain</span><span class=p>.</span><span class=na>doFilter</span><span class=p>(</span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// MDC 정리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>MDC</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=중앙-집중식-로그-관리>중앙 집중식 로그 관리<a hidden class=anchor aria-hidden=true href=#중앙-집중식-로그-관리>#</a></h5><p>분산 시스템에서의 로그 관리 및 상관관계 분석:</p><ol><li><strong>로그 집계</strong>: ELK 스택(Elasticsearch, Logstash, Kibana), Graylog, Splunk 등을 사용하여 모든 서비스의 로그를 중앙에서 수집 및 분석</li><li><strong>요청 추적</strong>: 마이크로서비스 간 요청 추적을 위해 Spring Cloud Sleuth, Zipkin, Jaeger 등의 분산 추적 시스템 활용</li><li><strong>알림 설정</strong>: 중요 오류에 대한 실시간 알림 구성</li></ol><h3 id=클라이언트-측-오류-처리-전략>클라이언트 측 오류 처리 전략<a hidden class=anchor aria-hidden=true href=#클라이언트-측-오류-처리-전략>#</a></h3><p>API를 소비하는 클라이언트 측에서의 오류 처리 전략.</p><h4 id=오류-감지-및-처리>오류 감지 및 처리<a hidden class=anchor aria-hidden=true href=#오류-감지-및-처리>#</a></h4><h5 id=일반적인-오류-처리-패턴>일반적인 오류 처리 패턴<a hidden class=anchor aria-hidden=true href=#일반적인-오류-처리-패턴>#</a></h5><p>JavaScript에서의 일반적인 오류 처리 패턴:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34>34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35>35</a>
</span><span class=lnt id=hl-6-36><a class=lnlinks href=#hl-6-36>36</a>
</span><span class=lnt id=hl-6-37><a class=lnlinks href=#hl-6-37>37</a>
</span><span class=lnt id=hl-6-38><a class=lnlinks href=#hl-6-38>38</a>
</span><span class=lnt id=hl-6-39><a class=lnlinks href=#hl-6-39>39</a>
</span><span class=lnt id=hl-6-40><a class=lnlinks href=#hl-6-40>40</a>
</span><span class=lnt id=hl-6-41><a class=lnlinks href=#hl-6-41>41</a>
</span><span class=lnt id=hl-6-42><a class=lnlinks href=#hl-6-42>42</a>
</span><span class=lnt id=hl-6-43><a class=lnlinks href=#hl-6-43>43</a>
</span><span class=lnt id=hl-6-44><a class=lnlinks href=#hl-6-44>44</a>
</span><span class=lnt id=hl-6-45><a class=lnlinks href=#hl-6-45>45</a>
</span><span class=lnt id=hl-6-46><a class=lnlinks href=#hl-6-46>46</a>
</span><span class=lnt id=hl-6-47><a class=lnlinks href=#hl-6-47>47</a>
</span><span class=lnt id=hl-6-48><a class=lnlinks href=#hl-6-48>48</a>
</span><span class=lnt id=hl-6-49><a class=lnlinks href=#hl-6-49>49</a>
</span><span class=lnt id=hl-6-50><a class=lnlinks href=#hl-6-50>50</a>
</span><span class=lnt id=hl-6-51><a class=lnlinks href=#hl-6-51>51</a>
</span><span class=lnt id=hl-6-52><a class=lnlinks href=#hl-6-52>52</a>
</span><span class=lnt id=hl-6-53><a class=lnlinks href=#hl-6-53>53</a>
</span><span class=lnt id=hl-6-54><a class=lnlinks href=#hl-6-54>54</a>
</span><span class=lnt id=hl-6-55><a class=lnlinks href=#hl-6-55>55</a>
</span><span class=lnt id=hl-6-56><a class=lnlinks href=#hl-6-56>56</a>
</span><span class=lnt id=hl-6-57><a class=lnlinks href=#hl-6-57>57</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Fetch API 사용시 오류 처리
</span></span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>fetchUser</span><span class=p>(</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`/api/users/</span><span class=si>${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// HTTP 오류 응답 확인
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>errorData</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nx>APIError</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>errorData</span><span class=p>.</span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>errorData</span><span class=p>.</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>errorData</span><span class=p>.</span><span class=nx>error</span><span class=p>.</span><span class=nx>requestId</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>error</span> <span class=k>instanceof</span> <span class=nx>APIError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// API 오류 처리
</span></span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`API Error </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>status</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb> - </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 사용자에게 적절한 메시지 표시
</span></span></span><span class=line><span class=cl>      <span class=nx>displayErrorMessage</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>userFriendlyMessage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 네트워크 오류 등 다른 예외 처리
</span></span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Network or unknown error:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>displayErrorMessage</span><span class=p>(</span><span class=s1>&#39;네트워크 연결을 확인해 주세요.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span> <span class=c1>// 필요한 경우 상위 레벨로 오류 전파
</span></span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용자 정의 API 오류 클래스
</span></span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>APIError</span> <span class=kr>extends</span> <span class=nb>Error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>status</span><span class=p>,</span> <span class=nx>code</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>requestId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=s1>&#39;APIError&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=nx>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>code</span> <span class=o>=</span> <span class=nx>code</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>requestId</span> <span class=o>=</span> <span class=nx>requestId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>userFriendlyMessage</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getUserFriendlyMessage</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>getUserFriendlyMessage</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 오류 코드에 따른 사용자 친화적 메시지 반환
</span></span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;RESOURCE_NOT_FOUND&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;요청하신 정보를 찾을 수 없습니다.&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;VALIDATION_ERROR&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;입력한 정보가 유효하지 않습니다.&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;UNAUTHORIZED&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;이 작업을 수행하기 위한 권한이 없습니다.&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;요청을 처리하는 중 오류가 발생했습니다. 나중에 다시 시도해 주세요.&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=상태-코드-및-응답-구조-분석>상태 코드 및 응답 구조 분석<a hidden class=anchor aria-hidden=true href=#상태-코드-및-응답-구조-분석>#</a></h5><p>다양한 HTTP 상태 코드 및 API 응답 구조를 분석하여 적절한 처리 방법 결정:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27>27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28>28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29>29</a>
</span><span class=lnt id=hl-7-30><a class=lnlinks href=#hl-7-30>30</a>
</span><span class=lnt id=hl-7-31><a class=lnlinks href=#hl-7-31>31</a>
</span><span class=lnt id=hl-7-32><a class=lnlinks href=#hl-7-32>32</a>
</span><span class=lnt id=hl-7-33><a class=lnlinks href=#hl-7-33>33</a>
</span><span class=lnt id=hl-7-34><a class=lnlinks href=#hl-7-34>34</a>
</span><span class=lnt id=hl-7-35><a class=lnlinks href=#hl-7-35>35</a>
</span><span class=lnt id=hl-7-36><a class=lnlinks href=#hl-7-36>36</a>
</span><span class=lnt id=hl-7-37><a class=lnlinks href=#hl-7-37>37</a>
</span><span class=lnt id=hl-7-38><a class=lnlinks href=#hl-7-38>38</a>
</span><span class=lnt id=hl-7-39><a class=lnlinks href=#hl-7-39>39</a>
</span><span class=lnt id=hl-7-40><a class=lnlinks href=#hl-7-40>40</a>
</span><span class=lnt id=hl-7-41><a class=lnlinks href=#hl-7-41>41</a>
</span><span class=lnt id=hl-7-42><a class=lnlinks href=#hl-7-42>42</a>
</span><span class=lnt id=hl-7-43><a class=lnlinks href=#hl-7-43>43</a>
</span><span class=lnt id=hl-7-44><a class=lnlinks href=#hl-7-44>44</a>
</span><span class=lnt id=hl-7-45><a class=lnlinks href=#hl-7-45>45</a>
</span><span class=lnt id=hl-7-46><a class=lnlinks href=#hl-7-46>46</a>
</span><span class=lnt id=hl-7-47><a class=lnlinks href=#hl-7-47>47</a>
</span><span class=lnt id=hl-7-48><a class=lnlinks href=#hl-7-48>48</a>
</span><span class=lnt id=hl-7-49><a class=lnlinks href=#hl-7-49>49</a>
</span><span class=lnt id=hl-7-50><a class=lnlinks href=#hl-7-50>50</a>
</span><span class=lnt id=hl-7-51><a class=lnlinks href=#hl-7-51>51</a>
</span><span class=lnt id=hl-7-52><a class=lnlinks href=#hl-7-52>52</a>
</span><span class=lnt id=hl-7-53><a class=lnlinks href=#hl-7-53>53</a>
</span><span class=lnt id=hl-7-54><a class=lnlinks href=#hl-7-54>54</a>
</span><span class=lnt id=hl-7-55><a class=lnlinks href=#hl-7-55>55</a>
</span><span class=lnt id=hl-7-56><a class=lnlinks href=#hl-7-56>56</a>
</span><span class=lnt id=hl-7-57><a class=lnlinks href=#hl-7-57>57</a>
</span><span class=lnt id=hl-7-58><a class=lnlinks href=#hl-7-58>58</a>
</span><span class=lnt id=hl-7-59><a class=lnlinks href=#hl-7-59>59</a>
</span><span class=lnt id=hl-7-60><a class=lnlinks href=#hl-7-60>60</a>
</span><span class=lnt id=hl-7-61><a class=lnlinks href=#hl-7-61>61</a>
</span><span class=lnt id=hl-7-62><a class=lnlinks href=#hl-7-62>62</a>
</span><span class=lnt id=hl-7-63><a class=lnlinks href=#hl-7-63>63</a>
</span><span class=lnt id=hl-7-64><a class=lnlinks href=#hl-7-64>64</a>
</span><span class=lnt id=hl-7-65><a class=lnlinks href=#hl-7-65>65</a>
</span><span class=lnt id=hl-7-66><a class=lnlinks href=#hl-7-66>66</a>
</span><span class=lnt id=hl-7-67><a class=lnlinks href=#hl-7-67>67</a>
</span><span class=lnt id=hl-7-68><a class=lnlinks href=#hl-7-68>68</a>
</span><span class=lnt id=hl-7-69><a class=lnlinks href=#hl-7-69>69</a>
</span><span class=lnt id=hl-7-70><a class=lnlinks href=#hl-7-70>70</a>
</span><span class=lnt id=hl-7-71><a class=lnlinks href=#hl-7-71>71</a>
</span><span class=lnt id=hl-7-72><a class=lnlinks href=#hl-7-72>72</a>
</span><span class=lnt id=hl-7-73><a class=lnlinks href=#hl-7-73>73</a>
</span><span class=lnt id=hl-7-74><a class=lnlinks href=#hl-7-74>74</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>handleAPIResponse</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 응답 본문 파싱
</span></span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>errorData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 응답이 JSON인지 확인
</span></span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>contentType</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>contentType</span> <span class=o>&amp;&amp;</span> <span class=nx>contentType</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;application/json&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>text</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 응답 본문 파싱 오류
</span></span></span><span class=line><span class=cl>    <span class=nx>errorData</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Invalid response format&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 성공적인 응답
</span></span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 오류 응답 처리
</span></span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>400</span><span class=o>:</span> <span class=c1>// Bad Request
</span></span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>handleValidationErrors</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>401</span><span class=o>:</span> <span class=c1>// Unauthorized
</span></span></span><span class=line><span class=cl>      <span class=c1>// 인증 토큰 갱신 또는 로그인 페이지로 리디렉션
</span></span></span><span class=line><span class=cl>      <span class=nx>authService</span><span class=p>.</span><span class=nx>refreshToken</span><span class=p>().</span><span class=k>catch</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>href</span> <span class=o>=</span> <span class=s1>&#39;/login&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nx>AuthError</span><span class=p>(</span><span class=s1>&#39;Authentication required&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>403</span><span class=o>:</span> <span class=c1>// Forbidden
</span></span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nx>AccessDeniedError</span><span class=p>(</span><span class=s1>&#39;You do not have permission to access this resource&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>404</span><span class=o>:</span> <span class=c1>// Not Found
</span></span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nx>NotFoundError</span><span class=p>(</span><span class=sb>`The requested resource was not found`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>422</span><span class=o>:</span> <span class=c1>// Unprocessable Entity
</span></span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>handleValidationErrors</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>429</span><span class=o>:</span> <span class=c1>// Too Many Requests
</span></span></span><span class=line><span class=cl>      <span class=c1>// 재시도 지연 설정
</span></span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>retryAfter</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;Retry-After&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nx>RateLimitError</span><span class=p>(</span><span class=s1>&#39;Rate limit exceeded&#39;</span><span class=p>,</span> <span class=nx>retryAfter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>500</span><span class=o>:</span> <span class=c1>// Internal Server Error
</span></span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>502</span><span class=o>:</span> <span class=c1>// Bad Gateway
</span></span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>503</span><span class=o>:</span> <span class=c1>// Service Unavailable
</span></span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>504</span><span class=o>:</span> <span class=c1>// Gateway Timeout
</span></span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nx>ServerError</span><span class=p>(</span><span class=s1>&#39;A server error occurred. Please try again later.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nx>APIError</span><span class=p>(</span><span class=sb>`Unknown error: </span><span class=si>${</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 유효성 검사 오류 처리
</span></span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>handleValidationErrors</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>error</span> <span class=o>&amp;&amp;</span> <span class=nx>data</span><span class=p>.</span><span class=nx>error</span><span class=p>.</span><span class=nx>fields</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 필드별 오류 메시지 추출
</span></span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fieldErrors</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>error</span><span class=p>.</span><span class=nx>fields</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>acc</span><span class=p>,</span> <span class=nx>field</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>acc</span><span class=p>[</span><span class=nx>field</span><span class=p>.</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>field</span><span class=p>.</span><span class=nx>reason</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>acc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=p>{});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nx>ValidationError</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span> <span class=nx>fieldErrors</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>throw</span> <span class=k>new</span> <span class=nx>BadRequestError</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>error</span><span class=o>?</span><span class=p>.</span><span class=nx>message</span> <span class=o>||</span> <span class=s1>&#39;Invalid request&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사용자-경험-최적화>사용자 경험 최적화<a hidden class=anchor aria-hidden=true href=#사용자-경험-최적화>#</a></h4><p>오류 발생 시 최종 사용자 경험을 최적화하는 방법:</p><h5 id=오류-ui-패턴>오류 UI 패턴<a hidden class=anchor aria-hidden=true href=#오류-ui-패턴>#</a></h5><p>사용자에게 오류를 표시하는 다양한 UI 패턴:</p><ol><li><strong>인라인 오류 메시지</strong>: 특정 입력 필드 옆에 오류 메시지 표시</li><li><strong>토스트 알림</strong>: 일시적인 오류 메시지를 화면 상단/하단에 표시</li><li><strong>모달 다이얼로그</strong>: 중요한 오류에 대해 사용자의 주의를 끌기 위한 모달 창</li><li><strong>오류 페이지</strong>: 심각한 오류의 경우 전용 오류 페이지로 이동</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41>41</a>
</span><span class=lnt id=hl-8-42><a class=lnlinks href=#hl-8-42>42</a>
</span><span class=lnt id=hl-8-43><a class=lnlinks href=#hl-8-43>43</a>
</span><span class=lnt id=hl-8-44><a class=lnlinks href=#hl-8-44>44</a>
</span><span class=lnt id=hl-8-45><a class=lnlinks href=#hl-8-45>45</a>
</span><span class=lnt id=hl-8-46><a class=lnlinks href=#hl-8-46>46</a>
</span><span class=lnt id=hl-8-47><a class=lnlinks href=#hl-8-47>47</a>
</span><span class=lnt id=hl-8-48><a class=lnlinks href=#hl-8-48>48</a>
</span><span class=lnt id=hl-8-49><a class=lnlinks href=#hl-8-49>49</a>
</span><span class=lnt id=hl-8-50><a class=lnlinks href=#hl-8-50>50</a>
</span><span class=lnt id=hl-8-51><a class=lnlinks href=#hl-8-51>51</a>
</span><span class=lnt id=hl-8-52><a class=lnlinks href=#hl-8-52>52</a>
</span><span class=lnt id=hl-8-53><a class=lnlinks href=#hl-8-53>53</a>
</span><span class=lnt id=hl-8-54><a class=lnlinks href=#hl-8-54>54</a>
</span><span class=lnt id=hl-8-55><a class=lnlinks href=#hl-8-55>55</a>
</span><span class=lnt id=hl-8-56><a class=lnlinks href=#hl-8-56>56</a>
</span><span class=lnt id=hl-8-57><a class=lnlinks href=#hl-8-57>57</a>
</span><span class=lnt id=hl-8-58><a class=lnlinks href=#hl-8-58>58</a>
</span><span class=lnt id=hl-8-59><a class=lnlinks href=#hl-8-59>59</a>
</span><span class=lnt id=hl-8-60><a class=lnlinks href=#hl-8-60>60</a>
</span><span class=lnt id=hl-8-61><a class=lnlinks href=#hl-8-61>61</a>
</span><span class=lnt id=hl-8-62><a class=lnlinks href=#hl-8-62>62</a>
</span><span class=lnt id=hl-8-63><a class=lnlinks href=#hl-8-63>63</a>
</span><span class=lnt id=hl-8-64><a class=lnlinks href=#hl-8-64>64</a>
</span><span class=lnt id=hl-8-65><a class=lnlinks href=#hl-8-65>65</a>
</span><span class=lnt id=hl-8-66><a class=lnlinks href=#hl-8-66>66</a>
</span><span class=lnt id=hl-8-67><a class=lnlinks href=#hl-8-67>67</a>
</span><span class=lnt id=hl-8-68><a class=lnlinks href=#hl-8-68>68</a>
</span><span class=lnt id=hl-8-69><a class=lnlinks href=#hl-8-69>69</a>
</span><span class=lnt id=hl-8-70><a class=lnlinks href=#hl-8-70>70</a>
</span><span class=lnt id=hl-8-71><a class=lnlinks href=#hl-8-71>71</a>
</span><span class=lnt id=hl-8-72><a class=lnlinks href=#hl-8-72>72</a>
</span><span class=lnt id=hl-8-73><a class=lnlinks href=#hl-8-73>73</a>
</span><span class=lnt id=hl-8-74><a class=lnlinks href=#hl-8-74>74</a>
</span><span class=lnt id=hl-8-75><a class=lnlinks href=#hl-8-75>75</a>
</span><span class=lnt id=hl-8-76><a class=lnlinks href=#hl-8-76>76</a>
</span><span class=lnt id=hl-8-77><a class=lnlinks href=#hl-8-77>77</a>
</span><span class=lnt id=hl-8-78><a class=lnlinks href=#hl-8-78>78</a>
</span><span class=lnt id=hl-8-79><a class=lnlinks href=#hl-8-79>79</a>
</span><span class=lnt id=hl-8-80><a class=lnlinks href=#hl-8-80>80</a>
</span><span class=lnt id=hl-8-81><a class=lnlinks href=#hl-8-81>81</a>
</span><span class=lnt id=hl-8-82><a class=lnlinks href=#hl-8-82>82</a>
</span><span class=lnt id=hl-8-83><a class=lnlinks href=#hl-8-83>83</a>
</span><span class=lnt id=hl-8-84><a class=lnlinks href=#hl-8-84>84</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// React에서의 오류 UI 예시
</span></span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>UserForm</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>user</span><span class=p>,</span> <span class=nx>setUser</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nx>email</span><span class=o>:</span> <span class=s1>&#39;&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>errors</span><span class=p>,</span> <span class=nx>setErrors</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>({});</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>isSubmitting</span><span class=p>,</span> <span class=nx>setIsSubmitting</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>serverError</span><span class=p>,</span> <span class=nx>setServerError</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>handleSubmit</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>event</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>setErrors</span><span class=p>({});</span>
</span></span><span class=line><span class=cl>    <span class=nx>setServerError</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setIsSubmitting</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 로컬 유효성 검사
</span></span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>validationErrors</span> <span class=o>=</span> <span class=nx>validateUser</span><span class=p>(</span><span class=nx>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>validationErrors</span><span class=p>).</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setErrors</span><span class=p>(</span><span class=nx>validationErrors</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// API 호출
</span></span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>createUser</span><span class=p>(</span><span class=nx>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 성공 처리
</span></span></span><span class=line><span class=cl>      <span class=nx>toast</span><span class=p>.</span><span class=nx>success</span><span class=p>(</span><span class=s1>&#39;User created successfully!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 리디렉션 또는 다음 단계 처리
</span></span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>error</span> <span class=k>instanceof</span> <span class=nx>ValidationError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 필드별 오류 표시
</span></span></span><span class=line><span class=cl>        <span class=nx>setErrors</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>fieldErrors</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>error</span> <span class=k>instanceof</span> <span class=nx>ServerError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 서버 오류 표시
</span></span></span><span class=line><span class=cl>        <span class=nx>setServerError</span><span class=p>(</span><span class=s1>&#39;The server is currently unavailable. Please try again later.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 일반 오류 표시
</span></span></span><span class=line><span class=cl>        <span class=nx>setServerError</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>userFriendlyMessage</span> <span class=o>||</span> <span class=s1>&#39;An unexpected error occurred.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 오류 로깅
</span></span></span><span class=line><span class=cl>      <span class=nx>logErrorToMonitoringService</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>setIsSubmitting</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>form</span> <span class=nx>onSubmit</span><span class=o>=</span><span class=p>{</span><span class=nx>handleSubmit</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nx>serverError</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;error-banner&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>ErrorIcon</span> <span class=o>/&gt;</span> <span class=p>{</span><span class=nx>serverError</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>)}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;form-field&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>label</span> <span class=nx>htmlFor</span><span class=o>=</span><span class=s2>&#34;name&#34;</span><span class=o>&gt;</span><span class=nx>Name</span><span class=o>&lt;</span><span class=err>/label&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>input</span>
</span></span><span class=line><span class=cl>          <span class=nx>id</span><span class=o>=</span><span class=s2>&#34;name&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>user</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>setUser</span><span class=p>({</span><span class=err>…</span><span class=nx>user</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>})}</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>errors</span><span class=p>.</span><span class=nx>name</span> <span class=o>?</span> <span class=s1>&#39;input-error&#39;</span> <span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=nx>errors</span><span class=p>.</span><span class=nx>name</span> <span class=o>&amp;&amp;</span> <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;field-error&#34;</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>errors</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;}</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;form-field&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>label</span> <span class=nx>htmlFor</span><span class=o>=</span><span class=s2>&#34;email&#34;</span><span class=o>&gt;</span><span class=nx>Email</span><span class=o>&lt;</span><span class=err>/label&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>input</span>
</span></span><span class=line><span class=cl>          <span class=nx>id</span><span class=o>=</span><span class=s2>&#34;email&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;email&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>user</span><span class=p>.</span><span class=nx>email</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>setUser</span><span class=p>({</span><span class=err>…</span><span class=nx>user</span><span class=p>,</span> <span class=nx>email</span><span class=o>:</span> <span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>})}</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>errors</span><span class=p>.</span><span class=nx>email</span> <span class=o>?</span> <span class=s1>&#39;input-error&#39;</span> <span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=nx>errors</span><span class=p>.</span><span class=nx>email</span> <span class=o>&amp;&amp;</span> <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;field-error&#34;</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>errors</span><span class=p>.</span><span class=nx>email</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/div&gt;}</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>button</span> <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;submit&#34;</span> <span class=nx>disabled</span><span class=o>=</span><span class=p>{</span><span class=nx>isSubmitting</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=nx>isSubmitting</span> <span class=o>?</span> <span class=s1>&#39;Creating…&#39;</span> <span class=o>:</span> <span class=s1>&#39;Create User&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/form&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=오류-복구-옵션>오류 복구 옵션<a hidden class=anchor aria-hidden=true href=#오류-복구-옵션>#</a></h5><p>사용자가 오류를 복구할 수 있는 방법 제공:</p><ol><li><strong>가이드 제공</strong>: 오류 해결을 위한 단계별 지침 제공</li><li><strong>자동 수정 제안</strong>: 가능한 경우 오류 수정 방법 제안</li><li><strong>대체 워크플로우</strong>: 현재 경로가 실패한 경우 대체 옵션 제공</li><li><strong>수동 재시도</strong>: 사용자가 작업을 다시 시도할 수 있는 옵션 제공</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22>22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23>23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24>24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25>25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26>26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27>27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28>28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29>29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30>30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31>31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32>32</a>
</span><span class=lnt id=hl-9-33><a class=lnlinks href=#hl-9-33>33</a>
</span><span class=lnt id=hl-9-34><a class=lnlinks href=#hl-9-34>34</a>
</span><span class=lnt id=hl-9-35><a class=lnlinks href=#hl-9-35>35</a>
</span><span class=lnt id=hl-9-36><a class=lnlinks href=#hl-9-36>36</a>
</span><span class=lnt id=hl-9-37><a class=lnlinks href=#hl-9-37>37</a>
</span><span class=lnt id=hl-9-38><a class=lnlinks href=#hl-9-38>38</a>
</span><span class=lnt id=hl-9-39><a class=lnlinks href=#hl-9-39>39</a>
</span><span class=lnt id=hl-9-40><a class=lnlinks href=#hl-9-40>40</a>
</span><span class=lnt id=hl-9-41><a class=lnlinks href=#hl-9-41>41</a>
</span><span class=lnt id=hl-9-42><a class=lnlinks href=#hl-9-42>42</a>
</span><span class=lnt id=hl-9-43><a class=lnlinks href=#hl-9-43>43</a>
</span><span class=lnt id=hl-9-44><a class=lnlinks href=#hl-9-44>44</a>
</span><span class=lnt id=hl-9-45><a class=lnlinks href=#hl-9-45>45</a>
</span><span class=lnt id=hl-9-46><a class=lnlinks href=#hl-9-46>46</a>
</span><span class=lnt id=hl-9-47><a class=lnlinks href=#hl-9-47>47</a>
</span><span class=lnt id=hl-9-48><a class=lnlinks href=#hl-9-48>48</a>
</span><span class=lnt id=hl-9-49><a class=lnlinks href=#hl-9-49>49</a>
</span><span class=lnt id=hl-9-50><a class=lnlinks href=#hl-9-50>50</a>
</span><span class=lnt id=hl-9-51><a class=lnlinks href=#hl-9-51>51</a>
</span><span class=lnt id=hl-9-52><a class=lnlinks href=#hl-9-52>52</a>
</span><span class=lnt id=hl-9-53><a class=lnlinks href=#hl-9-53>53</a>
</span><span class=lnt id=hl-9-54><a class=lnlinks href=#hl-9-54>54</a>
</span><span class=lnt id=hl-9-55><a class=lnlinks href=#hl-9-55>55</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 오류 복구 옵션을 제공하는 컴포넌트 예시
</span></span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>PaymentErrorHandler</span><span class=p>({</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>onRetry</span><span class=p>,</span> <span class=nx>onAlternativeMethod</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 오류 유형에 따른 대응
</span></span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;PAYMENT_DECLINED&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>ErrorCard</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>결제가</span> <span class=nx>거부되었습니다</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span><span class=nx>카드</span> <span class=nx>발급사에서</span> <span class=nx>이</span> <span class=nx>거래를</span> <span class=nx>거부했습니다</span><span class=p>.</span> <span class=nx>다음</span> <span class=nx>중</span> <span class=nx>하나를</span> <span class=nx>시도해</span> <span class=nx>보세요</span><span class=o>:&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>ul</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>li</span><span class=o>&gt;</span><span class=nx>카드</span> <span class=nx>정보가</span> <span class=nx>올바른지</span> <span class=nx>확인하세요</span><span class=o>&lt;</span><span class=err>/li&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>li</span><span class=o>&gt;</span><span class=nx>충분한</span> <span class=nx>잔액이</span> <span class=nx>있는지</span> <span class=nx>확인하세요</span><span class=o>&lt;</span><span class=err>/li&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>li</span><span class=o>&gt;</span><span class=nx>다른</span> <span class=nx>카드로</span> <span class=nx>시도하세요</span><span class=o>&lt;</span><span class=err>/li&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=err>/ul&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>ButtonGroup</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>Button</span> <span class=nx>primary</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>onRetry</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>다시</span> <span class=nx>시도</span><span class=o>&lt;</span><span class=err>/Button&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>Button</span> <span class=nx>secondary</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>onAlternativeMethod</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>다른</span> <span class=nx>결제</span> <span class=nx>방법</span><span class=o>&lt;</span><span class=err>/Button&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=err>/ButtonGroup&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/ErrorCard&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;NETWORK_ERROR&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>ErrorCard</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>연결</span> <span class=nx>오류</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span><span class=nx>인터넷</span> <span class=nx>연결에</span> <span class=nx>문제가</span> <span class=nx>있습니다</span><span class=p>.</span> <span class=nx>네트워크</span> <span class=nx>연결을</span> <span class=nx>확인한</span> <span class=nx>후</span> <span class=nx>다시</span> <span class=nx>시도하세요</span><span class=p>.</span><span class=o>&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>ConnectionStatus</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>Button</span> <span class=nx>primary</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>onRetry</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>다시</span> <span class=nx>시도</span><span class=o>&lt;</span><span class=err>/Button&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/ErrorCard&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;SERVICE_UNAVAILABLE&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>ErrorCard</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>서비스</span> <span class=nx>일시</span> <span class=nx>중단</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span><span class=nx>결제</span> <span class=nx>서비스가</span> <span class=nx>현재</span> <span class=nx>일시적으로</span> <span class=nx>사용</span> <span class=nx>불가능합니다</span><span class=p>.</span> <span class=nx>불편을</span> <span class=nx>드려</span> <span class=nx>죄송합니다</span><span class=p>.</span><span class=o>&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span><span class=nx>현재</span> <span class=nx>시스템</span> <span class=nx>상태</span><span class=o>:</span> <span class=o>&lt;</span><span class=nx>ServiceStatusIndicator</span> <span class=o>/&gt;&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span><span class=nx>예상</span> <span class=nx>복구</span> <span class=nx>시간</span><span class=o>:</span> <span class=p>{</span><span class=nx>formatTime</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>estimatedResolutionTime</span><span class=p>)}</span><span class=o>&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>ButtonGroup</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>Button</span> <span class=nx>primary</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>onRetry</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>다시</span> <span class=nx>시도</span><span class=o>&lt;</span><span class=err>/Button&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>Button</span> <span class=nx>secondary</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>saveOrderForLater</span><span class=p>()}</span><span class=o>&gt;</span><span class=nx>나중에</span> <span class=nx>완료</span><span class=o>&lt;</span><span class=err>/Button&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=err>/ButtonGroup&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/ErrorCard&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>ErrorCard</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h3</span><span class=o>&gt;</span><span class=nx>결제</span> <span class=nx>처리</span> <span class=nx>중</span> <span class=nx>오류가</span> <span class=nx>발생했습니다</span><span class=o>&lt;</span><span class=err>/h3&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>error</span><span class=p>.</span><span class=nx>userFriendlyMessage</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>Button</span> <span class=nx>primary</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>onRetry</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>다시</span> <span class=nx>시도</span><span class=o>&lt;</span><span class=err>/Button&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/ErrorCard&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=api-재시도-전략>API 재시도 전략<a hidden class=anchor aria-hidden=true href=#api-재시도-전략>#</a></h3><p>네트워크 불안정성이나 일시적인 서비스 중단으로 인한 일시적 오류는 재시도를 통해 해결할 수 있다. 효과적인 재시도 전략은 애플리케이션의 복원력을 크게 향상시킨다.</p><h4 id=재시도-가능한-오류-식별>재시도 가능한 오류 식별<a hidden class=anchor aria-hidden=true href=#재시도-가능한-오류-식별>#</a></h4><p>모든 오류가 재시도에 적합한 것은 아니다.<br>다음 기준을 사용하여 재시도 가능한 오류를 식별할 수 있다:</p><h5 id=일반적으로-재시도-가능한-오류>일반적으로 재시도 가능한 오류<a hidden class=anchor aria-hidden=true href=#일반적으로-재시도-가능한-오류>#</a></h5><ol><li><strong>네트워크 시간 초과 (Network Timeouts)</strong>: 일시적인 네트워크 지연으로 인한 시간 초과</li><li><strong>서버 과부하 (503 Service Unavailable)</strong>: 서버가 일시적으로 요청을 처리할 수 없음</li><li><strong>연결 오류 (Connection Errors)</strong>: 네트워크 연결 문제</li><li><strong>5xx 서버 오류</strong>: 대부분의 서버 측 오류(500, 502, 504 등)</li><li><strong>일시적인 데이터베이스 오류</strong>: 경쟁 조건, 교착 상태, 연결 풀 고갈 등</li><li><strong>속도 제한 (429 Too Many Requests)</strong>: 요청 속도 제한 초과(적절한 백오프와 함께)</li></ol><h5 id=재시도하지-말아야-할-오류>재시도하지 말아야 할 오류<a hidden class=anchor aria-hidden=true href=#재시도하지-말아야-할-오류>#</a></h5><ol><li><strong>클라이언트 오류 (4xx)</strong>: 대부분의 400, 401, 403, 404 등은 재시도해도 성공할 가능성이 낮음</li><li><strong>유효성 검사 실패</strong>: 입력 데이터 문제로 인한 오류</li><li><strong>인증/권한 오류</strong>: 인증 정보가 잘못되었거나 권한이 부족한 경우</li><li><strong>비즈니스 로직 오류</strong>: 비즈니스 규칙 위반으로 인한 오류</li><li><strong>영구적인 리소스 상태 문제</strong>: 리소스가 이미 존재하거나 찾을 수 없는 경우</li></ol><h5 id=713-오류-분류-코드-예시>7.1.3 오류 분류 코드 예시<a hidden class=anchor aria-hidden=true href=#713-오류-분류-코드-예시>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22>22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23>23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24>24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25>25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26>26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27>27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28>28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29>29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30>30</a>
</span><span class=lnt id=hl-10-31><a class=lnlinks href=#hl-10-31>31</a>
</span><span class=lnt id=hl-10-32><a class=lnlinks href=#hl-10-32>32</a>
</span><span class=lnt id=hl-10-33><a class=lnlinks href=#hl-10-33>33</a>
</span><span class=lnt id=hl-10-34><a class=lnlinks href=#hl-10-34>34</a>
</span><span class=lnt id=hl-10-35><a class=lnlinks href=#hl-10-35>35</a>
</span><span class=lnt id=hl-10-36><a class=lnlinks href=#hl-10-36>36</a>
</span><span class=lnt id=hl-10-37><a class=lnlinks href=#hl-10-37>37</a>
</span><span class=lnt id=hl-10-38><a class=lnlinks href=#hl-10-38>38</a>
</span><span class=lnt id=hl-10-39><a class=lnlinks href=#hl-10-39>39</a>
</span><span class=lnt id=hl-10-40><a class=lnlinks href=#hl-10-40>40</a>
</span><span class=lnt id=hl-10-41><a class=lnlinks href=#hl-10-41>41</a>
</span><span class=lnt id=hl-10-42><a class=lnlinks href=#hl-10-42>42</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 오류의 재시도 가능성 평가
</span></span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>isRetryable</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 네트워크 오류는 재시도 가능
</span></span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=s1>&#39;NetworkError&#39;</span> <span class=o>||</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;network&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// API 오류인 경우 상태 코드 확인
</span></span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>error</span> <span class=k>instanceof</span> <span class=nx>APIError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 서버 오류(5xx)는 일반적으로 재시도 가능
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>status</span> <span class=o>&gt;=</span> <span class=mi>500</span> <span class=o>&amp;&amp;</span> <span class=nx>error</span><span class=p>.</span><span class=nx>status</span> <span class=o>&lt;</span> <span class=mi>600</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 429(Too Many Requests)는 재시도 가능하지만 Retry-After 헤더 준수 필요
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>429</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 특정 비즈니스 오류 코드가 재시도 가능한지 확인
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>RETRYABLE_ERROR_CODES</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 특정 데이터베이스 오류 식별
</span></span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=s1>&#39;DEADLOCK&#39;</span> <span class=o>||</span> <span class=nx>error</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=s1>&#39;CONNECTION_TIMEOUT&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 기본적으로 재시도하지 않음
</span></span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 재시도 가능한 비즈니스 오류 코드 목록
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RETRYABLE_ERROR_CODES</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;TEMPORARY_OUTAGE&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;DATABASE_TIMEOUT&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;RESOURCE_EXHAUSTED&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;SERVICE_UNAVAILABLE&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;GATEWAY_TIMEOUT&#39;</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=백오프-전략>백오프 전략<a hidden class=anchor aria-hidden=true href=#백오프-전략>#</a></h4><p>단순히 요청을 즉시 재시도하는 것은 서버에 부담을 줄 수 있다. 효과적인 백오프 전략을 사용하여 재시도 간격을 조정해야 한다.</p><h5 id=주요-백오프-전략>주요 백오프 전략<a hidden class=anchor aria-hidden=true href=#주요-백오프-전략>#</a></h5><ol><li><strong>고정 지연 (Fixed Delay)</strong>:<ul><li>일정한 시간 간격으로 재시도</li><li>간단하지만 대규모 클라이언트의 경우 &lsquo;서지(surge)&rsquo; 문제 발생 가능</li></ul></li><li><strong>지수 백오프 (Exponential Backoff)</strong>:<ul><li>재시도할 때마다 대기 시간을 지수적으로 증가</li><li>가장 널리 사용되는 전략으로 서버 부하를 효과적으로 분산</li></ul></li><li><strong>지수 백오프 + 지터 (Exponential Backoff with Jitter)</strong>:<ul><li>지수 백오프에 무작위성 추가</li><li>다수의 클라이언트가 동시에 재시도하는 것을 방지해 서버 부하 피크 감소</li></ul></li><li><strong>데코레이터 (Decorator) 헤더 기반 재시도</strong>:<ul><li>서버가 <code>Retry-After</code> 헤더를 통해 권장 재시도 시간 제공</li><li>서버 상태에 기반한 지능적인 재시도 가능</li></ul></li></ol><h5 id=지수-백오프-구현-예시>지수 백오프 구현 예시<a hidden class=anchor aria-hidden=true href=#지수-백오프-구현-예시>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span><span class=lnt id=hl-11-36><a class=lnlinks href=#hl-11-36>36</a>
</span><span class=lnt id=hl-11-37><a class=lnlinks href=#hl-11-37>37</a>
</span><span class=lnt id=hl-11-38><a class=lnlinks href=#hl-11-38>38</a>
</span><span class=lnt id=hl-11-39><a class=lnlinks href=#hl-11-39>39</a>
</span><span class=lnt id=hl-11-40><a class=lnlinks href=#hl-11-40>40</a>
</span><span class=lnt id=hl-11-41><a class=lnlinks href=#hl-11-41>41</a>
</span><span class=lnt id=hl-11-42><a class=lnlinks href=#hl-11-42>42</a>
</span><span class=lnt id=hl-11-43><a class=lnlinks href=#hl-11-43>43</a>
</span><span class=lnt id=hl-11-44><a class=lnlinks href=#hl-11-44>44</a>
</span><span class=lnt id=hl-11-45><a class=lnlinks href=#hl-11-45>45</a>
</span><span class=lnt id=hl-11-46><a class=lnlinks href=#hl-11-46>46</a>
</span><span class=lnt id=hl-11-47><a class=lnlinks href=#hl-11-47>47</a>
</span><span class=lnt id=hl-11-48><a class=lnlinks href=#hl-11-48>48</a>
</span><span class=lnt id=hl-11-49><a class=lnlinks href=#hl-11-49>49</a>
</span><span class=lnt id=hl-11-50><a class=lnlinks href=#hl-11-50>50</a>
</span><span class=lnt id=hl-11-51><a class=lnlinks href=#hl-11-51>51</a>
</span><span class=lnt id=hl-11-52><a class=lnlinks href=#hl-11-52>52</a>
</span><span class=lnt id=hl-11-53><a class=lnlinks href=#hl-11-53>53</a>
</span><span class=lnt id=hl-11-54><a class=lnlinks href=#hl-11-54>54</a>
</span><span class=lnt id=hl-11-55><a class=lnlinks href=#hl-11-55>55</a>
</span><span class=lnt id=hl-11-56><a class=lnlinks href=#hl-11-56>56</a>
</span><span class=lnt id=hl-11-57><a class=lnlinks href=#hl-11-57>57</a>
</span><span class=lnt id=hl-11-58><a class=lnlinks href=#hl-11-58>58</a>
</span><span class=lnt id=hl-11-59><a class=lnlinks href=#hl-11-59>59</a>
</span><span class=lnt id=hl-11-60><a class=lnlinks href=#hl-11-60>60</a>
</span><span class=lnt id=hl-11-61><a class=lnlinks href=#hl-11-61>61</a>
</span><span class=lnt id=hl-11-62><a class=lnlinks href=#hl-11-62>62</a>
</span><span class=lnt id=hl-11-63><a class=lnlinks href=#hl-11-63>63</a>
</span><span class=lnt id=hl-11-64><a class=lnlinks href=#hl-11-64>64</a>
</span><span class=lnt id=hl-11-65><a class=lnlinks href=#hl-11-65>65</a>
</span><span class=lnt id=hl-11-66><a class=lnlinks href=#hl-11-66>66</a>
</span><span class=lnt id=hl-11-67><a class=lnlinks href=#hl-11-67>67</a>
</span><span class=lnt id=hl-11-68><a class=lnlinks href=#hl-11-68>68</a>
</span><span class=lnt id=hl-11-69><a class=lnlinks href=#hl-11-69>69</a>
</span><span class=lnt id=hl-11-70><a class=lnlinks href=#hl-11-70>70</a>
</span><span class=lnt id=hl-11-71><a class=lnlinks href=#hl-11-71>71</a>
</span><span class=lnt id=hl-11-72><a class=lnlinks href=#hl-11-72>72</a>
</span><span class=lnt id=hl-11-73><a class=lnlinks href=#hl-11-73>73</a>
</span><span class=lnt id=hl-11-74><a class=lnlinks href=#hl-11-74>74</a>
</span><span class=lnt id=hl-11-75><a class=lnlinks href=#hl-11-75>75</a>
</span><span class=lnt id=hl-11-76><a class=lnlinks href=#hl-11-76>76</a>
</span><span class=lnt id=hl-11-77><a class=lnlinks href=#hl-11-77>77</a>
</span><span class=lnt id=hl-11-78><a class=lnlinks href=#hl-11-78>78</a>
</span><span class=lnt id=hl-11-79><a class=lnlinks href=#hl-11-79>79</a>
</span><span class=lnt id=hl-11-80><a class=lnlinks href=#hl-11-80>80</a>
</span><span class=lnt id=hl-11-81><a class=lnlinks href=#hl-11-81>81</a>
</span><span class=lnt id=hl-11-82><a class=lnlinks href=#hl-11-82>82</a>
</span><span class=lnt id=hl-11-83><a class=lnlinks href=#hl-11-83>83</a>
</span><span class=lnt id=hl-11-84><a class=lnlinks href=#hl-11-84>84</a>
</span><span class=lnt id=hl-11-85><a class=lnlinks href=#hl-11-85>85</a>
</span><span class=lnt id=hl-11-86><a class=lnlinks href=#hl-11-86>86</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 지수 백오프 및 지터를 사용한 재시도 함수
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Function} operation - 실행할 작업 함수
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Object} options - 재시도 옵션
</span></span></span><span class=line><span class=cl><span class=cm> * @returns {Promise} 작업 결과
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>retryWithBackoff</span><span class=p>(</span><span class=nx>operation</span><span class=p>,</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>maxRetries</span> <span class=o>=</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>baseDelay</span> <span class=o>=</span> <span class=mi>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>maxDelay</span> <span class=o>=</span> <span class=mi>30000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>factor</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>jitter</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>retryableErrors</span> <span class=o>=</span> <span class=nx>isRetryable</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=o>=</span> <span class=nx>options</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>attempt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=kc>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kr>await</span> <span class=nx>operation</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>attempt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 최대 재시도 횟수 초과 또는 재시도할 수 없는 오류인 경우
</span></span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>attempt</span> <span class=o>&gt;=</span> <span class=nx>maxRetries</span> <span class=o>||</span> <span class=o>!</span><span class=nx>retryableErrors</span><span class=p>(</span><span class=nx>error</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// Retry-After 헤더가 있는 경우 해당 값 사용
</span></span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>retryAfter</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>retryAfterMs</span> <span class=o>=</span> <span class=nx>parseRetryAfter</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>retryAfter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=nx>retryAfterMs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 지수 백오프 계산
</span></span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>delay</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>maxDelay</span><span class=p>,</span> <span class=nx>baseDelay</span> <span class=o>*</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>pow</span><span class=p>(</span><span class=nx>factor</span><span class=p>,</span> <span class=nx>attempt</span> <span class=o>-</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 지터 추가 (선택 사항)
</span></span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>jitter</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 계산된 지연의 0%~100% 사이의 무작위 값 사이에서 지연 시간 조정
</span></span></span><span class=line><span class=cl>        <span class=nx>delay</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=nx>delay</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Retrying after </span><span class=si>${</span><span class=nx>delay</span><span class=si>}</span><span class=sb>ms (attempt </span><span class=si>${</span><span class=nx>attempt</span><span class=si>}</span><span class=sb> of </span><span class=si>${</span><span class=nx>maxRetries</span><span class=si>}</span><span class=sb>)`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>sleep</span><span class=p>(</span><span class=nx>delay</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 헬퍼 함수
</span></span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>sleep</span><span class=p>(</span><span class=nx>ms</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span> <span class=p>=&gt;</span> <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>ms</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>parseRetryAfter</span><span class=p>(</span><span class=nx>retryAfter</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 숫자만 있는 경우 초 단위로 해석
</span></span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=sr>/^\d+$/</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>retryAfter</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>retryAfter</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// HTTP 날짜 형식인 경우 밀리초로 변환
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>retryAfter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>date</span><span class=p>.</span><span class=nx>getTime</span><span class=p>()</span> <span class=o>-</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>fetchUserWithRetry</span><span class=p>(</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>retryWithBackoff</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`/api/users/</span><span class=si>${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>`</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>res</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>error</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;API request failed&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>error</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>error</span><span class=p>.</span><span class=nx>retryAfter</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;Retry-After&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}),</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>maxRetries</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>baseDelay</span><span class=o>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>retryableErrors</span><span class=o>:</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>error</span><span class=p>.</span><span class=nx>status</span> <span class=o>&gt;=</span> <span class=mi>500</span> <span class=o>||</span> <span class=nx>error</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>429</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=재시도-제한-및-서킷-브레이커>재시도 제한 및 서킷 브레이커<a hidden class=anchor aria-hidden=true href=#재시도-제한-및-서킷-브레이커>#</a></h4><p>무한정 재시도하는 것은 리소스 낭비와 시스템 과부하를 초래할 수 있다. 적절한 제한을 설정하고 서킷 브레이커 패턴을 구현하는 것이 중요하다.</p><h5 id=재시도-제한>재시도 제한<a hidden class=anchor aria-hidden=true href=#재시도-제한>#</a></h5><ol><li><strong>최대 재시도 횟수</strong>: 특정 횟수 이후에는 재시도 중단</li><li><strong>최대 시간 제한</strong>: 지정된 시간 이후에는 재시도 중단</li><li><strong>재시도 예산</strong>: 일정 시간 동안 허용되는 최대 재시도 횟수 설정</li></ol><h5 id=서킷-브레이커-패턴>서킷 브레이커 패턴<a hidden class=anchor aria-hidden=true href=#서킷-브레이커-패턴>#</a></h5><p>서킷 브레이커는 반복적인 실패가 감지될 때 추가 호출을 일시적으로 차단하는 패턴이다. 이는 실패한 서비스가 복구될 시간을 제공하고, 시스템의 나머지 부분을 보호한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>  1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>  2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>  3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>  4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>  5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6>  6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7>  7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8>  8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9>  9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10> 10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11> 11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12> 12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13> 13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14> 14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15> 15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16> 16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17> 17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18> 18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19> 19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20> 20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21> 21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22> 22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23> 23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24> 24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25> 25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26> 26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27> 27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28> 28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29> 29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30> 30</a>
</span><span class=lnt id=hl-12-31><a class=lnlinks href=#hl-12-31> 31</a>
</span><span class=lnt id=hl-12-32><a class=lnlinks href=#hl-12-32> 32</a>
</span><span class=lnt id=hl-12-33><a class=lnlinks href=#hl-12-33> 33</a>
</span><span class=lnt id=hl-12-34><a class=lnlinks href=#hl-12-34> 34</a>
</span><span class=lnt id=hl-12-35><a class=lnlinks href=#hl-12-35> 35</a>
</span><span class=lnt id=hl-12-36><a class=lnlinks href=#hl-12-36> 36</a>
</span><span class=lnt id=hl-12-37><a class=lnlinks href=#hl-12-37> 37</a>
</span><span class=lnt id=hl-12-38><a class=lnlinks href=#hl-12-38> 38</a>
</span><span class=lnt id=hl-12-39><a class=lnlinks href=#hl-12-39> 39</a>
</span><span class=lnt id=hl-12-40><a class=lnlinks href=#hl-12-40> 40</a>
</span><span class=lnt id=hl-12-41><a class=lnlinks href=#hl-12-41> 41</a>
</span><span class=lnt id=hl-12-42><a class=lnlinks href=#hl-12-42> 42</a>
</span><span class=lnt id=hl-12-43><a class=lnlinks href=#hl-12-43> 43</a>
</span><span class=lnt id=hl-12-44><a class=lnlinks href=#hl-12-44> 44</a>
</span><span class=lnt id=hl-12-45><a class=lnlinks href=#hl-12-45> 45</a>
</span><span class=lnt id=hl-12-46><a class=lnlinks href=#hl-12-46> 46</a>
</span><span class=lnt id=hl-12-47><a class=lnlinks href=#hl-12-47> 47</a>
</span><span class=lnt id=hl-12-48><a class=lnlinks href=#hl-12-48> 48</a>
</span><span class=lnt id=hl-12-49><a class=lnlinks href=#hl-12-49> 49</a>
</span><span class=lnt id=hl-12-50><a class=lnlinks href=#hl-12-50> 50</a>
</span><span class=lnt id=hl-12-51><a class=lnlinks href=#hl-12-51> 51</a>
</span><span class=lnt id=hl-12-52><a class=lnlinks href=#hl-12-52> 52</a>
</span><span class=lnt id=hl-12-53><a class=lnlinks href=#hl-12-53> 53</a>
</span><span class=lnt id=hl-12-54><a class=lnlinks href=#hl-12-54> 54</a>
</span><span class=lnt id=hl-12-55><a class=lnlinks href=#hl-12-55> 55</a>
</span><span class=lnt id=hl-12-56><a class=lnlinks href=#hl-12-56> 56</a>
</span><span class=lnt id=hl-12-57><a class=lnlinks href=#hl-12-57> 57</a>
</span><span class=lnt id=hl-12-58><a class=lnlinks href=#hl-12-58> 58</a>
</span><span class=lnt id=hl-12-59><a class=lnlinks href=#hl-12-59> 59</a>
</span><span class=lnt id=hl-12-60><a class=lnlinks href=#hl-12-60> 60</a>
</span><span class=lnt id=hl-12-61><a class=lnlinks href=#hl-12-61> 61</a>
</span><span class=lnt id=hl-12-62><a class=lnlinks href=#hl-12-62> 62</a>
</span><span class=lnt id=hl-12-63><a class=lnlinks href=#hl-12-63> 63</a>
</span><span class=lnt id=hl-12-64><a class=lnlinks href=#hl-12-64> 64</a>
</span><span class=lnt id=hl-12-65><a class=lnlinks href=#hl-12-65> 65</a>
</span><span class=lnt id=hl-12-66><a class=lnlinks href=#hl-12-66> 66</a>
</span><span class=lnt id=hl-12-67><a class=lnlinks href=#hl-12-67> 67</a>
</span><span class=lnt id=hl-12-68><a class=lnlinks href=#hl-12-68> 68</a>
</span><span class=lnt id=hl-12-69><a class=lnlinks href=#hl-12-69> 69</a>
</span><span class=lnt id=hl-12-70><a class=lnlinks href=#hl-12-70> 70</a>
</span><span class=lnt id=hl-12-71><a class=lnlinks href=#hl-12-71> 71</a>
</span><span class=lnt id=hl-12-72><a class=lnlinks href=#hl-12-72> 72</a>
</span><span class=lnt id=hl-12-73><a class=lnlinks href=#hl-12-73> 73</a>
</span><span class=lnt id=hl-12-74><a class=lnlinks href=#hl-12-74> 74</a>
</span><span class=lnt id=hl-12-75><a class=lnlinks href=#hl-12-75> 75</a>
</span><span class=lnt id=hl-12-76><a class=lnlinks href=#hl-12-76> 76</a>
</span><span class=lnt id=hl-12-77><a class=lnlinks href=#hl-12-77> 77</a>
</span><span class=lnt id=hl-12-78><a class=lnlinks href=#hl-12-78> 78</a>
</span><span class=lnt id=hl-12-79><a class=lnlinks href=#hl-12-79> 79</a>
</span><span class=lnt id=hl-12-80><a class=lnlinks href=#hl-12-80> 80</a>
</span><span class=lnt id=hl-12-81><a class=lnlinks href=#hl-12-81> 81</a>
</span><span class=lnt id=hl-12-82><a class=lnlinks href=#hl-12-82> 82</a>
</span><span class=lnt id=hl-12-83><a class=lnlinks href=#hl-12-83> 83</a>
</span><span class=lnt id=hl-12-84><a class=lnlinks href=#hl-12-84> 84</a>
</span><span class=lnt id=hl-12-85><a class=lnlinks href=#hl-12-85> 85</a>
</span><span class=lnt id=hl-12-86><a class=lnlinks href=#hl-12-86> 86</a>
</span><span class=lnt id=hl-12-87><a class=lnlinks href=#hl-12-87> 87</a>
</span><span class=lnt id=hl-12-88><a class=lnlinks href=#hl-12-88> 88</a>
</span><span class=lnt id=hl-12-89><a class=lnlinks href=#hl-12-89> 89</a>
</span><span class=lnt id=hl-12-90><a class=lnlinks href=#hl-12-90> 90</a>
</span><span class=lnt id=hl-12-91><a class=lnlinks href=#hl-12-91> 91</a>
</span><span class=lnt id=hl-12-92><a class=lnlinks href=#hl-12-92> 92</a>
</span><span class=lnt id=hl-12-93><a class=lnlinks href=#hl-12-93> 93</a>
</span><span class=lnt id=hl-12-94><a class=lnlinks href=#hl-12-94> 94</a>
</span><span class=lnt id=hl-12-95><a class=lnlinks href=#hl-12-95> 95</a>
</span><span class=lnt id=hl-12-96><a class=lnlinks href=#hl-12-96> 96</a>
</span><span class=lnt id=hl-12-97><a class=lnlinks href=#hl-12-97> 97</a>
</span><span class=lnt id=hl-12-98><a class=lnlinks href=#hl-12-98> 98</a>
</span><span class=lnt id=hl-12-99><a class=lnlinks href=#hl-12-99> 99</a>
</span><span class=lnt id=hl-12-100><a class=lnlinks href=#hl-12-100>100</a>
</span><span class=lnt id=hl-12-101><a class=lnlinks href=#hl-12-101>101</a>
</span><span class=lnt id=hl-12-102><a class=lnlinks href=#hl-12-102>102</a>
</span><span class=lnt id=hl-12-103><a class=lnlinks href=#hl-12-103>103</a>
</span><span class=lnt id=hl-12-104><a class=lnlinks href=#hl-12-104>104</a>
</span><span class=lnt id=hl-12-105><a class=lnlinks href=#hl-12-105>105</a>
</span><span class=lnt id=hl-12-106><a class=lnlinks href=#hl-12-106>106</a>
</span><span class=lnt id=hl-12-107><a class=lnlinks href=#hl-12-107>107</a>
</span><span class=lnt id=hl-12-108><a class=lnlinks href=#hl-12-108>108</a>
</span><span class=lnt id=hl-12-109><a class=lnlinks href=#hl-12-109>109</a>
</span><span class=lnt id=hl-12-110><a class=lnlinks href=#hl-12-110>110</a>
</span><span class=lnt id=hl-12-111><a class=lnlinks href=#hl-12-111>111</a>
</span><span class=lnt id=hl-12-112><a class=lnlinks href=#hl-12-112>112</a>
</span><span class=lnt id=hl-12-113><a class=lnlinks href=#hl-12-113>113</a>
</span><span class=lnt id=hl-12-114><a class=lnlinks href=#hl-12-114>114</a>
</span><span class=lnt id=hl-12-115><a class=lnlinks href=#hl-12-115>115</a>
</span><span class=lnt id=hl-12-116><a class=lnlinks href=#hl-12-116>116</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 간단한 서킷 브레이커 구현
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>CircuitBreaker</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>options</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>failureThreshold</span> <span class=o>=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>failureThreshold</span> <span class=o>||</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>resetTimeout</span> <span class=o>=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>resetTimeout</span> <span class=o>||</span> <span class=mi>30000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>monitorInterval</span> <span class=o>=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>monitorInterval</span> <span class=o>||</span> <span class=mi>5000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=s1>&#39;CLOSED&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>failureCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>lastFailureTime</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>monitors</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 모니터링 간격 설정
</span></span></span><span class=line><span class=cl>    <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>updateState</span><span class=p>(),</span> <span class=k>this</span><span class=p>.</span><span class=nx>monitorInterval</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 상태 업데이트
</span></span></span><span class=line><span class=cl>  <span class=nx>updateState</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s1>&#39;OPEN&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>now</span> <span class=o>-</span> <span class=k>this</span><span class=p>.</span><span class=nx>lastFailureTime</span> <span class=o>&gt;=</span> <span class=k>this</span><span class=p>.</span><span class=nx>resetTimeout</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 재설정 시간이 지나면 반열림 상태로 전환
</span></span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=s1>&#39;HALF_OPEN&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>notifyMonitors</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 작업 실행
</span></span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>execute</span><span class=p>(</span><span class=nx>operation</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s1>&#39;OPEN&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Circuit is OPEN - operation rejected&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>operation</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 성공 시 회로 닫기
</span></span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s1>&#39;HALF_OPEN&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=s1>&#39;CLOSED&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>failureCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>notifyMonitors</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 실패 처리
</span></span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>recordFailure</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 실패 기록
</span></span></span><span class=line><span class=cl>  <span class=nx>recordFailure</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>failureCount</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>lastFailureTime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s1>&#39;CLOSED&#39;</span> <span class=o>&amp;&amp;</span> <span class=k>this</span><span class=p>.</span><span class=nx>failureCount</span> <span class=o>&gt;=</span> <span class=k>this</span><span class=p>.</span><span class=nx>failureThreshold</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 실패 임계값 초과 시 회로 열기
</span></span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=s1>&#39;OPEN&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>notifyMonitors</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s1>&#39;HALF_OPEN&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 반열림 상태에서 실패하면 다시 열림 상태로
</span></span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=s1>&#39;OPEN&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>notifyMonitors</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 상태 변경 시 이벤트 발생
</span></span></span><span class=line><span class=cl>  <span class=nx>notifyMonitors</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>monitors</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>callback</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>callback</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Circuit breaker monitor error:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 상태 변경 이벤트 구독
</span></span></span><span class=line><span class=cl>  <span class=nx>onStateChange</span><span class=p>(</span><span class=nx>callback</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>monitors</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>callback</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>monitors</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>monitors</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>cb</span> <span class=p>=&gt;</span> <span class=nx>cb</span> <span class=o>!==</span> <span class=nx>callback</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 서킷 브레이커 사용 예시
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>paymentServiceBreaker</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CircuitBreaker</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>failureThreshold</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>resetTimeout</span><span class=o>:</span> <span class=mi>10000</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 로깅 및 메트릭 수집
</span></span></span><span class=line><span class=cl><span class=nx>paymentServiceBreaker</span><span class=p>.</span><span class=nx>onStateChange</span><span class=p>(</span><span class=nx>state</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Payment service circuit breaker state changed to: </span><span class=si>${</span><span class=nx>state</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>metrics</span><span class=p>.</span><span class=nx>recordCircuitBreakerState</span><span class=p>(</span><span class=s1>&#39;payment-service&#39;</span><span class=p>,</span> <span class=nx>state</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// API 호출 시 서킷 브레이커 적용
</span></span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>processPayment</span><span class=p>(</span><span class=nx>paymentData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kr>await</span> <span class=nx>paymentServiceBreaker</span><span class=p>.</span><span class=nx>execute</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>paymentApiClient</span><span class=p>.</span><span class=nx>processPayment</span><span class=p>(</span><span class=nx>paymentData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;Circuit is OPEN&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 대체 결제 처리 또는 사용자에게 알림
</span></span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>fallbackPaymentProcessing</span><span class=p>(</span><span class=nx>paymentData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=재시도와-멱등성>재시도와 멱등성<a hidden class=anchor aria-hidden=true href=#재시도와-멱등성>#</a></h4><p>재시도 전략을 안전하게 구현하기 위해서는 API 작업의 멱등성(idempotency)을 고려해야 한다.</p><h5 id=멱등성이란>멱등성이란?<a hidden class=anchor aria-hidden=true href=#멱등성이란>#</a></h5><p>멱등성은 동일한 요청을 여러 번 실행해도 시스템 상태가 한 번 실행한 것과 동일한 상태가 되는 속성을 의미한다. 멱등한 작업은 재시도해도 안전하다.</p><h5 id=http-메서드별-멱등성>HTTP 메서드별 멱등성<a hidden class=anchor aria-hidden=true href=#http-메서드별-멱등성>#</a></h5><ul><li><strong>멱등한 메서드</strong>: GET, PUT, DELETE, HEAD, OPTIONS</li><li><strong>멱등하지 않은 메서드</strong>: POST, PATCH</li></ul><h5 id=멱등성-구현-전략>멱등성 구현 전략<a hidden class=anchor aria-hidden=true href=#멱등성-구현-전략>#</a></h5><ol><li><p><strong>멱등성 키 사용</strong>:</p><ul><li>클라이언트가 각 요청에 고유 식별자 제공</li><li>서버는 이미 처리된 요청을 감지하고 중복 처리 방지</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>  1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>  2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>  3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>  4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>  5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6>  6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7>  7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8>  8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9>  9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10> 10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11> 11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12> 12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13> 13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14> 14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15> 15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16> 16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17> 17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18> 18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19> 19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20> 20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21> 21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22> 22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23> 23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24> 24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25> 25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26> 26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27> 27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28> 28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29> 29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30> 30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31> 31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32> 32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33> 33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34> 34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35> 35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36> 36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37> 37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38> 38</a>
</span><span class=lnt id=hl-13-39><a class=lnlinks href=#hl-13-39> 39</a>
</span><span class=lnt id=hl-13-40><a class=lnlinks href=#hl-13-40> 40</a>
</span><span class=lnt id=hl-13-41><a class=lnlinks href=#hl-13-41> 41</a>
</span><span class=lnt id=hl-13-42><a class=lnlinks href=#hl-13-42> 42</a>
</span><span class=lnt id=hl-13-43><a class=lnlinks href=#hl-13-43> 43</a>
</span><span class=lnt id=hl-13-44><a class=lnlinks href=#hl-13-44> 44</a>
</span><span class=lnt id=hl-13-45><a class=lnlinks href=#hl-13-45> 45</a>
</span><span class=lnt id=hl-13-46><a class=lnlinks href=#hl-13-46> 46</a>
</span><span class=lnt id=hl-13-47><a class=lnlinks href=#hl-13-47> 47</a>
</span><span class=lnt id=hl-13-48><a class=lnlinks href=#hl-13-48> 48</a>
</span><span class=lnt id=hl-13-49><a class=lnlinks href=#hl-13-49> 49</a>
</span><span class=lnt id=hl-13-50><a class=lnlinks href=#hl-13-50> 50</a>
</span><span class=lnt id=hl-13-51><a class=lnlinks href=#hl-13-51> 51</a>
</span><span class=lnt id=hl-13-52><a class=lnlinks href=#hl-13-52> 52</a>
</span><span class=lnt id=hl-13-53><a class=lnlinks href=#hl-13-53> 53</a>
</span><span class=lnt id=hl-13-54><a class=lnlinks href=#hl-13-54> 54</a>
</span><span class=lnt id=hl-13-55><a class=lnlinks href=#hl-13-55> 55</a>
</span><span class=lnt id=hl-13-56><a class=lnlinks href=#hl-13-56> 56</a>
</span><span class=lnt id=hl-13-57><a class=lnlinks href=#hl-13-57> 57</a>
</span><span class=lnt id=hl-13-58><a class=lnlinks href=#hl-13-58> 58</a>
</span><span class=lnt id=hl-13-59><a class=lnlinks href=#hl-13-59> 59</a>
</span><span class=lnt id=hl-13-60><a class=lnlinks href=#hl-13-60> 60</a>
</span><span class=lnt id=hl-13-61><a class=lnlinks href=#hl-13-61> 61</a>
</span><span class=lnt id=hl-13-62><a class=lnlinks href=#hl-13-62> 62</a>
</span><span class=lnt id=hl-13-63><a class=lnlinks href=#hl-13-63> 63</a>
</span><span class=lnt id=hl-13-64><a class=lnlinks href=#hl-13-64> 64</a>
</span><span class=lnt id=hl-13-65><a class=lnlinks href=#hl-13-65> 65</a>
</span><span class=lnt id=hl-13-66><a class=lnlinks href=#hl-13-66> 66</a>
</span><span class=lnt id=hl-13-67><a class=lnlinks href=#hl-13-67> 67</a>
</span><span class=lnt id=hl-13-68><a class=lnlinks href=#hl-13-68> 68</a>
</span><span class=lnt id=hl-13-69><a class=lnlinks href=#hl-13-69> 69</a>
</span><span class=lnt id=hl-13-70><a class=lnlinks href=#hl-13-70> 70</a>
</span><span class=lnt id=hl-13-71><a class=lnlinks href=#hl-13-71> 71</a>
</span><span class=lnt id=hl-13-72><a class=lnlinks href=#hl-13-72> 72</a>
</span><span class=lnt id=hl-13-73><a class=lnlinks href=#hl-13-73> 73</a>
</span><span class=lnt id=hl-13-74><a class=lnlinks href=#hl-13-74> 74</a>
</span><span class=lnt id=hl-13-75><a class=lnlinks href=#hl-13-75> 75</a>
</span><span class=lnt id=hl-13-76><a class=lnlinks href=#hl-13-76> 76</a>
</span><span class=lnt id=hl-13-77><a class=lnlinks href=#hl-13-77> 77</a>
</span><span class=lnt id=hl-13-78><a class=lnlinks href=#hl-13-78> 78</a>
</span><span class=lnt id=hl-13-79><a class=lnlinks href=#hl-13-79> 79</a>
</span><span class=lnt id=hl-13-80><a class=lnlinks href=#hl-13-80> 80</a>
</span><span class=lnt id=hl-13-81><a class=lnlinks href=#hl-13-81> 81</a>
</span><span class=lnt id=hl-13-82><a class=lnlinks href=#hl-13-82> 82</a>
</span><span class=lnt id=hl-13-83><a class=lnlinks href=#hl-13-83> 83</a>
</span><span class=lnt id=hl-13-84><a class=lnlinks href=#hl-13-84> 84</a>
</span><span class=lnt id=hl-13-85><a class=lnlinks href=#hl-13-85> 85</a>
</span><span class=lnt id=hl-13-86><a class=lnlinks href=#hl-13-86> 86</a>
</span><span class=lnt id=hl-13-87><a class=lnlinks href=#hl-13-87> 87</a>
</span><span class=lnt id=hl-13-88><a class=lnlinks href=#hl-13-88> 88</a>
</span><span class=lnt id=hl-13-89><a class=lnlinks href=#hl-13-89> 89</a>
</span><span class=lnt id=hl-13-90><a class=lnlinks href=#hl-13-90> 90</a>
</span><span class=lnt id=hl-13-91><a class=lnlinks href=#hl-13-91> 91</a>
</span><span class=lnt id=hl-13-92><a class=lnlinks href=#hl-13-92> 92</a>
</span><span class=lnt id=hl-13-93><a class=lnlinks href=#hl-13-93> 93</a>
</span><span class=lnt id=hl-13-94><a class=lnlinks href=#hl-13-94> 94</a>
</span><span class=lnt id=hl-13-95><a class=lnlinks href=#hl-13-95> 95</a>
</span><span class=lnt id=hl-13-96><a class=lnlinks href=#hl-13-96> 96</a>
</span><span class=lnt id=hl-13-97><a class=lnlinks href=#hl-13-97> 97</a>
</span><span class=lnt id=hl-13-98><a class=lnlinks href=#hl-13-98> 98</a>
</span><span class=lnt id=hl-13-99><a class=lnlinks href=#hl-13-99> 99</a>
</span><span class=lnt id=hl-13-100><a class=lnlinks href=#hl-13-100>100</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 클라이언트 측 구현
</span></span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>createOrder</span><span class=p>(</span><span class=nx>orderData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 클라이언트 생성 고유 ID
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>idempotencyKey</span> <span class=o>=</span> <span class=nx>generateUUID</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;/api/orders&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Idempotency-Key&#39;</span><span class=o>:</span> <span class=nx>idempotencyKey</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>orderData</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 응답 처리…
</span></span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 서버 측 구현 (Express.js)
</span></span></span><span class=line><span class=cl><span class=c1>// 멱등성 키 처리 미들웨어
</span></span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>idempotencyMiddleware</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>idempotencyKey</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>[</span><span class=s1>&#39;idempotency-key&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>idempotencyKey</span> <span class=o>&amp;&amp;</span> <span class=nx>req</span><span class=p>.</span><span class=nx>method</span> <span class=o>===</span> <span class=s1>&#39;POST&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>error</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>code</span><span class=o>:</span> <span class=s1>&#39;MISSING_IDEMPOTENCY_KEY&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Idempotency-Key header is required for POST requests&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>idempotencyKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 캐시에서 이전 응답 확인
</span></span></span><span class=line><span class=cl>    <span class=nx>redisClient</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`idempotency:</span><span class=si>${</span><span class=nx>idempotencyKey</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>cachedResponse</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>next</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>cachedResponse</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 이미 처리된 요청이므로 캐시된 응답 반환
</span></span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>parsedResponse</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>cachedResponse</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=nx>parsedResponse</span><span class=p>.</span><span class=nx>status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>parsedResponse</span><span class=p>.</span><span class=nx>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>parsedResponse</span><span class=p>.</span><span class=nx>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 기존 응답 객체 메서드 저장
</span></span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>originalSend</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>originalJson</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>originalStatus</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 응답 데이터 캡처
</span></span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>responseBody</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>responseStatus</span> <span class=o>=</span> <span class=mi>200</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>responseHeaders</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 응답 메서드 재정의
</span></span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>send</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>body</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>responseBody</span> <span class=o>=</span> <span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>originalSend</span><span class=p>.</span><span class=nx>apply</span><span class=p>(</span><span class=nx>res</span><span class=p>,</span> <span class=nx>arguments</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>json</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>body</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>responseBody</span> <span class=o>=</span> <span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>originalJson</span><span class=p>.</span><span class=nx>apply</span><span class=p>(</span><span class=nx>res</span><span class=p>,</span> <span class=nx>arguments</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>responseStatus</span> <span class=o>=</span> <span class=nx>code</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>originalStatus</span><span class=p>.</span><span class=nx>apply</span><span class=p>(</span><span class=nx>res</span><span class=p>,</span> <span class=nx>arguments</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;finish&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 성공적인 응답만 캐시
</span></span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>responseStatus</span> <span class=o>&gt;=</span> <span class=mi>200</span> <span class=o>&amp;&amp;</span> <span class=nx>responseStatus</span> <span class=o>&lt;</span> <span class=mi>500</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>cacheEntry</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=o>:</span> <span class=nx>responseStatus</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>headers</span><span class=o>:</span> <span class=nx>responseHeaders</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>body</span><span class=o>:</span> <span class=nx>responseBody</span>
</span></span><span class=line><span class=cl>          <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=c1>// 응답 캐싱 (24시간 TTL)
</span></span></span><span class=line><span class=cl>          <span class=nx>redisClient</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sb>`idempotency:</span><span class=si>${</span><span class=nx>idempotencyKey</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>cacheEntry</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;EX&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>86400</span>
</span></span><span class=line><span class=cl>          <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>조건부 요청</strong>:</p><ul><li>HTTP 조건부 요청 헤더(If-Match, If-None-Match 등) 사용</li><li>리소스 상태를 기반으로 작업 수행 여부 결정</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 조건부 업데이트 예시
</span></span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>updateUserIfNotChanged</span><span class=p>(</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>userData</span><span class=p>,</span> <span class=nx>etag</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`/api/users/</span><span class=si>${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;PUT&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;If-Match&#39;</span><span class=o>:</span> <span class=nx>etag</span> <span class=c1>// 리소스가 변경되지 않은 경우에만 업데이트
</span></span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>userData</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>412</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// Precondition Failed
</span></span></span><span class=line><span class=cl>    <span class=c1>// 리소스가 변경되었으므로 최신 데이터 가져오기
</span></span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>currentData</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`/api/users/</span><span class=si>${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>`</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>r</span> <span class=p>=&gt;</span> <span class=nx>r</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 충돌 해결 로직…
</span></span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>conflict</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>currentData</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>거래 ID 사용</strong>:</p><ul><li>전체 거래(여러 API 호출로 구성될 수 있음)에 대한 고유 ID 사용</li><li>데이터베이스에 거래 상태 저장하여 중복 처리 방지</li></ul></li></ol><h3 id=프로덕션-환경에서의-오류-모니터링-및-분석>프로덕션 환경에서의 오류 모니터링 및 분석<a hidden class=anchor aria-hidden=true href=#프로덕션-환경에서의-오류-모니터링-및-분석>#</a></h3><p>효과적인 오류 처리를 위해서는 프로덕션 환경에서 발생하는 오류를 지속적으로 모니터링하고 분석하는 것이 중요하다.</p><h4 id=모니터링-및-알림-시스템>모니터링 및 알림 시스템<a hidden class=anchor aria-hidden=true href=#모니터링-및-알림-시스템>#</a></h4><h5 id=주요-모니터링-대상>주요 모니터링 대상<a hidden class=anchor aria-hidden=true href=#주요-모니터링-대상>#</a></h5><ol><li><strong>오류 발생률</strong>: 전체 요청 대비 오류 비율</li><li><strong>오류 유형 분포</strong>: 다양한 오류 유형의 발생 빈도</li><li><strong>서비스 수준 목표(SLO)</strong>: 가용성 및 성능 지표</li><li><strong>재시도 패턴</strong>: 재시도 빈도 및 성공률</li><li><strong>서킷 브레이커 상태</strong>: 열림/닫힘 상태 및 전환 빈도</li></ol><h5 id=모니터링-도구-및-통합>모니터링 도구 및 통합<a hidden class=anchor aria-hidden=true href=#모니터링-도구-및-통합>#</a></h5><ol><li><strong>애플리케이션 성능 모니터링(APM)</strong>: New Relic, Datadog, Dynatrace 등</li><li><strong>로그 집계 및 분석</strong>: ELK 스택(Elasticsearch, Logstash, Kibana), Graylog</li><li><strong>메트릭 시각화</strong>: Grafana, Prometheus</li><li><strong>오류 추적 서비스</strong>: Sentry, Rollbar, Bugsnag</li><li><strong>분산 추적</strong>: Jaeger, Zipkin</li></ol><h4 id=오류-패턴-분석>오류 패턴 분석<a hidden class=anchor aria-hidden=true href=#오류-패턴-분석>#</a></h4><p>수집된 오류 데이터를 분석하여 패턴을 식별하고 근본 원인을 파악한다:</p><h5 id=오류-분석-방법>오류 분석 방법<a hidden class=anchor aria-hidden=true href=#오류-분석-방법>#</a></h5><ol><li><strong>오류 빈도 및 영향 평가</strong>: 가장 자주 발생하는 오류와 그 영향 분석</li><li><strong>시간적 패턴 분석</strong>: 특정 시간이나 이벤트와 관련된 오류 패턴 식별</li><li><strong>사용자 영향 분석</strong>: 오류가 사용자 경험에 미치는 영향 평가</li><li><strong>근본 원인 분석</strong>: 오류의 근본 원인 및 해결 방안 식별</li></ol><h5 id=오류-분류-및-우선순위-지정>오류 분류 및 우선순위 지정<a hidden class=anchor aria-hidden=true href=#오류-분류-및-우선순위-지정>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25>25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26>26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27>27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28>28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29>29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30>30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31>31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32>32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33>33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34>34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35>35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36>36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37>37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38>38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39>39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40>40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41>41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42>42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43>43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44>44</a>
</span><span class=lnt id=hl-15-45><a class=lnlinks href=#hl-15-45>45</a>
</span><span class=lnt id=hl-15-46><a class=lnlinks href=#hl-15-46>46</a>
</span><span class=lnt id=hl-15-47><a class=lnlinks href=#hl-15-47>47</a>
</span><span class=lnt id=hl-15-48><a class=lnlinks href=#hl-15-48>48</a>
</span><span class=lnt id=hl-15-49><a class=lnlinks href=#hl-15-49>49</a>
</span><span class=lnt id=hl-15-50><a class=lnlinks href=#hl-15-50>50</a>
</span><span class=lnt id=hl-15-51><a class=lnlinks href=#hl-15-51>51</a>
</span><span class=lnt id=hl-15-52><a class=lnlinks href=#hl-15-52>52</a>
</span><span class=lnt id=hl-15-53><a class=lnlinks href=#hl-15-53>53</a>
</span><span class=lnt id=hl-15-54><a class=lnlinks href=#hl-15-54>54</a>
</span><span class=lnt id=hl-15-55><a class=lnlinks href=#hl-15-55>55</a>
</span><span class=lnt id=hl-15-56><a class=lnlinks href=#hl-15-56>56</a>
</span><span class=lnt id=hl-15-57><a class=lnlinks href=#hl-15-57>57</a>
</span><span class=lnt id=hl-15-58><a class=lnlinks href=#hl-15-58>58</a>
</span><span class=lnt id=hl-15-59><a class=lnlinks href=#hl-15-59>59</a>
</span><span class=lnt id=hl-15-60><a class=lnlinks href=#hl-15-60>60</a>
</span><span class=lnt id=hl-15-61><a class=lnlinks href=#hl-15-61>61</a>
</span><span class=lnt id=hl-15-62><a class=lnlinks href=#hl-15-62>62</a>
</span><span class=lnt id=hl-15-63><a class=lnlinks href=#hl-15-63>63</a>
</span><span class=lnt id=hl-15-64><a class=lnlinks href=#hl-15-64>64</a>
</span><span class=lnt id=hl-15-65><a class=lnlinks href=#hl-15-65>65</a>
</span><span class=lnt id=hl-15-66><a class=lnlinks href=#hl-15-66>66</a>
</span><span class=lnt id=hl-15-67><a class=lnlinks href=#hl-15-67>67</a>
</span><span class=lnt id=hl-15-68><a class=lnlinks href=#hl-15-68>68</a>
</span><span class=lnt id=hl-15-69><a class=lnlinks href=#hl-15-69>69</a>
</span><span class=lnt id=hl-15-70><a class=lnlinks href=#hl-15-70>70</a>
</span><span class=lnt id=hl-15-71><a class=lnlinks href=#hl-15-71>71</a>
</span><span class=lnt id=hl-15-72><a class=lnlinks href=#hl-15-72>72</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 오류 분류 및 심각도 평가 함수
</span></span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>categorizeError</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 기본 정보 수집
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>errorData</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>name</span> <span class=o>||</span> <span class=s1>&#39;Unknown&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>message</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>stack</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>stack</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>component</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>component</span> <span class=o>||</span> <span class=nx>getCurrentComponent</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>requestId</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>requestId</span> <span class=o>||</span> <span class=nx>getCurrentRequestId</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>userId</span><span class=o>:</span> <span class=nx>getCurrentUserId</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>url</span> <span class=o>||</span> <span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>href</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 심각도 결정
</span></span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>severity</span> <span class=o>=</span> <span class=s1>&#39;info&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>error</span> <span class=k>instanceof</span> <span class=nx>NetworkError</span> <span class=o>||</span> <span class=nx>error</span><span class=p>.</span><span class=nx>status</span> <span class=o>&gt;=</span> <span class=mi>500</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>severity</span> <span class=o>=</span> <span class=s1>&#39;error&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>error</span> <span class=k>instanceof</span> <span class=nx>AuthError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>severity</span> <span class=o>=</span> <span class=s1>&#39;warning&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>error</span> <span class=k>instanceof</span> <span class=nx>ValidationError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>severity</span> <span class=o>=</span> <span class=s1>&#39;info&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 재시도 가능성 평가
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>isRetryable</span> <span class=o>=</span> <span class=nx>evaluateRetryability</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 사용자 영향 평가
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>userImpact</span> <span class=o>=</span> <span class=nx>evaluateUserImpact</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 비즈니스 영향 평가
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>businessImpact</span> <span class=o>=</span> <span class=nx>evaluateBusinessImpact</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 우선순위 계산
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>priority</span> <span class=o>=</span> <span class=nx>calculatePriority</span><span class=p>(</span><span class=nx>severity</span><span class=p>,</span> <span class=nx>userImpact</span><span class=p>,</span> <span class=nx>businessImpact</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>…</span><span class=nx>errorData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>severity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>isRetryable</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>userImpact</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>businessImpact</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>priority</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 오류 보고 및 처리
</span></span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>reportError</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>categorizedError</span> <span class=o>=</span> <span class=nx>categorizeError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 심각도에 따른 처리
</span></span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nx>categorizedError</span><span class=p>.</span><span class=nx>severity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;error&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 중요 오류는 즉시 알림
</span></span></span><span class=line><span class=cl>      <span class=nx>notifyOnCall</span><span class=p>(</span><span class=nx>categorizedError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;warning&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 경고는 집계 후 알림
</span></span></span><span class=line><span class=cl>      <span class=nx>addToErrorAggregation</span><span class=p>(</span><span class=nx>categorizedError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 기타 심각도…
</span></span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 모든 오류는 중앙 에러 추적 시스템에 보고
</span></span></span><span class=line><span class=cl>  <span class=nx>errorTrackingService</span><span class=p>.</span><span class=nx>captureException</span><span class=p>(</span><span class=nx>error</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>extra</span><span class=o>:</span> <span class=nx>categorizedError</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 내부 분석을 위한 로깅
</span></span></span><span class=line><span class=cl>  <span class=nx>logger</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>categorizedError</span><span class=p>.</span><span class=nx>severity</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>categorizedError</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=사례-연구-및-실제-예시>사례 연구 및 실제 예시<a hidden class=anchor aria-hidden=true href=#사례-연구-및-실제-예시>#</a></h3><p>다양한 산업 및 애플리케이션 유형에서의 API 오류 처리 및 재시도 전략의 실제 사례</p><h4 id=전자상거래-플랫폼>전자상거래 플랫폼<a hidden class=anchor aria-hidden=true href=#전자상거래-플랫폼>#</a></h4><h5 id=시나리오>시나리오<a hidden class=anchor aria-hidden=true href=#시나리오>#</a></h5><p>대규모 전자상거래 플랫폼에서 결제 처리 API의 오류 처리 및 재시도 전략</p><h5 id=주요-도전-과제>주요 도전 과제<a hidden class=anchor aria-hidden=true href=#주요-도전-과제>#</a></h5><ol><li>고객 경험에 직접적인 영향을 미치는 중요한 거래</li><li>외부 결제 게이트웨이에 대한 의존성</li><li>부분적으로 완료된 거래의 일관성 유지</li><li>높은 거래량과 트래픽 스파이크</li></ol><h5 id=구현된-솔루션>구현된 솔루션<a hidden class=anchor aria-hidden=true href=#구현된-솔루션>#</a></h5><ol><li><strong>멱등성 처리</strong>:<ul><li>모든 결제 요청에 클라이언트 생성 멱등성 키 사용</li><li>동일한 거래 ID에 대한 중복 처리 방지</li></ul></li><li><strong>계층적 재시도 전략</strong>:<ul><li>클라이언트 측: 사용자에게 영향을 미치지 않는 배경 재시도</li><li>서버 측: 결제 게이트웨이 API 호출에 대한 지능적 재시도</li><li>비동기 작업 큐: 실패한 작업을 나중에 재시도할 수 있도록 큐에 저장</li></ul></li><li><strong>복원력 패턴</strong>:<ul><li>서킷 브레이커: 외부 결제 프로세서 문제 감지 및 대체 프로세서로 전환</li><li>대체 경로: 주요 결제 방법이 실패할 경우 대체 결제 방법 제안</li></ul></li><li><strong>사용자 경험 최적화</strong>:<ul><li>배경 재시도: 사용자에게 보이지 않게 재시도 진행</li><li>명확한 오류 메시지: 사용자가 이해하기 쉬운 오류 설명과 해결 방법 제공</li><li>진행 상태 추적: 주문 처리 단계를 명확히 표시하여 사용자가 프로세스 상태를 이해할 수 있도록 함</li></ul></li><li><strong>모니터링 및 분석</strong>:<ul><li>실시간 대시보드: 결제 오류율 및 유형 모니터링</li><li>자동 알림: 특정 임계값 초과 시 운영팀에 알림</li><li>정기적인 리뷰: 결제 오류 패턴 분석 및 개선점 도출</li></ul></li></ol><h5 id=결과>결과<a hidden class=anchor aria-hidden=true href=#결과>#</a></h5><ul><li>결제 성공률 99.5%로 향상</li><li>결제 관련 고객 문의 40% 감소</li><li>결제 처리 시스템의 복원력 개선으로 서비스 중단 감소</li></ul><h4 id=모바일-애플리케이션>모바일 애플리케이션<a hidden class=anchor aria-hidden=true href=#모바일-애플리케이션>#</a></h4><h5 id=시나리오-1>시나리오<a hidden class=anchor aria-hidden=true href=#시나리오-1>#</a></h5><p>불안정한 네트워크 환경에서 작동해야 하는 모바일 애플리케이션의 API 클라이언트</p><h5 id=주요-도전-과제-1>주요 도전 과제<a hidden class=anchor aria-hidden=true href=#주요-도전-과제-1>#</a></h5><ol><li>간헐적인 네트워크 연결</li><li>제한된 배터리 및 데이터 사용량</li><li>다양한 네트워크 상태(Wi-Fi, 셀룰러, 오프라인)</li><li>백그라운드 동기화 요구사항</li></ol><h5 id=구현된-솔루션-1>구현된 솔루션<a hidden class=anchor aria-hidden=true href=#구현된-솔루션-1>#</a></h5><ol><li><strong>오프라인 우선 아키텍처</strong>:<ul><li>로컬 데이터 저장소: 모든 사용자 작업을 먼저 로컬에 저장</li><li>작업 큐: 오프라인 상태에서 수행된 작업을 서버 동기화를 위한 큐에 저장</li></ul></li><li><strong>네트워크 인식 재시도</strong>:<ul><li>네트워크 상태 모니터링: 연결 유형 및 품질에 따른 재시도 전략 조정</li><li>배터리 인식: 배터리 잔량이 적을 때 재시도 빈도 감소</li></ul></li><li><strong>동기화 전략</strong>:<ul><li>우선순위 기반 동기화: 중요한 작업 먼저 동기화</li><li>일괄 처리: 여러 작업을 하나의 네트워크 요청으로 묶어 효율성 향상</li></ul></li><li><strong>충돌 해결</strong>:<ul><li>자동 해결: 가능한 경우 충돌 자동 해결 알고리즘 적용</li><li>사용자 안내: 복잡한 충돌의 경우 사용자에게 해결 옵션 제공</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>  1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>  2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>  3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>  4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5>  5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6>  6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7>  7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8>  8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9>  9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10> 10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11> 11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12> 12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13> 13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14> 14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15> 15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16> 16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17> 17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18> 18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19> 19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20> 20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21> 21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22> 22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23> 23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24> 24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25> 25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26> 26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27> 27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28> 28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29> 29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30> 30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31> 31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32> 32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33> 33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34> 34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35> 35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36> 36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37> 37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38> 38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39> 39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40> 40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41> 41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42> 42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43> 43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44> 44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45> 45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46> 46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47> 47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48> 48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49> 49</a>
</span><span class=lnt id=hl-16-50><a class=lnlinks href=#hl-16-50> 50</a>
</span><span class=lnt id=hl-16-51><a class=lnlinks href=#hl-16-51> 51</a>
</span><span class=lnt id=hl-16-52><a class=lnlinks href=#hl-16-52> 52</a>
</span><span class=lnt id=hl-16-53><a class=lnlinks href=#hl-16-53> 53</a>
</span><span class=lnt id=hl-16-54><a class=lnlinks href=#hl-16-54> 54</a>
</span><span class=lnt id=hl-16-55><a class=lnlinks href=#hl-16-55> 55</a>
</span><span class=lnt id=hl-16-56><a class=lnlinks href=#hl-16-56> 56</a>
</span><span class=lnt id=hl-16-57><a class=lnlinks href=#hl-16-57> 57</a>
</span><span class=lnt id=hl-16-58><a class=lnlinks href=#hl-16-58> 58</a>
</span><span class=lnt id=hl-16-59><a class=lnlinks href=#hl-16-59> 59</a>
</span><span class=lnt id=hl-16-60><a class=lnlinks href=#hl-16-60> 60</a>
</span><span class=lnt id=hl-16-61><a class=lnlinks href=#hl-16-61> 61</a>
</span><span class=lnt id=hl-16-62><a class=lnlinks href=#hl-16-62> 62</a>
</span><span class=lnt id=hl-16-63><a class=lnlinks href=#hl-16-63> 63</a>
</span><span class=lnt id=hl-16-64><a class=lnlinks href=#hl-16-64> 64</a>
</span><span class=lnt id=hl-16-65><a class=lnlinks href=#hl-16-65> 65</a>
</span><span class=lnt id=hl-16-66><a class=lnlinks href=#hl-16-66> 66</a>
</span><span class=lnt id=hl-16-67><a class=lnlinks href=#hl-16-67> 67</a>
</span><span class=lnt id=hl-16-68><a class=lnlinks href=#hl-16-68> 68</a>
</span><span class=lnt id=hl-16-69><a class=lnlinks href=#hl-16-69> 69</a>
</span><span class=lnt id=hl-16-70><a class=lnlinks href=#hl-16-70> 70</a>
</span><span class=lnt id=hl-16-71><a class=lnlinks href=#hl-16-71> 71</a>
</span><span class=lnt id=hl-16-72><a class=lnlinks href=#hl-16-72> 72</a>
</span><span class=lnt id=hl-16-73><a class=lnlinks href=#hl-16-73> 73</a>
</span><span class=lnt id=hl-16-74><a class=lnlinks href=#hl-16-74> 74</a>
</span><span class=lnt id=hl-16-75><a class=lnlinks href=#hl-16-75> 75</a>
</span><span class=lnt id=hl-16-76><a class=lnlinks href=#hl-16-76> 76</a>
</span><span class=lnt id=hl-16-77><a class=lnlinks href=#hl-16-77> 77</a>
</span><span class=lnt id=hl-16-78><a class=lnlinks href=#hl-16-78> 78</a>
</span><span class=lnt id=hl-16-79><a class=lnlinks href=#hl-16-79> 79</a>
</span><span class=lnt id=hl-16-80><a class=lnlinks href=#hl-16-80> 80</a>
</span><span class=lnt id=hl-16-81><a class=lnlinks href=#hl-16-81> 81</a>
</span><span class=lnt id=hl-16-82><a class=lnlinks href=#hl-16-82> 82</a>
</span><span class=lnt id=hl-16-83><a class=lnlinks href=#hl-16-83> 83</a>
</span><span class=lnt id=hl-16-84><a class=lnlinks href=#hl-16-84> 84</a>
</span><span class=lnt id=hl-16-85><a class=lnlinks href=#hl-16-85> 85</a>
</span><span class=lnt id=hl-16-86><a class=lnlinks href=#hl-16-86> 86</a>
</span><span class=lnt id=hl-16-87><a class=lnlinks href=#hl-16-87> 87</a>
</span><span class=lnt id=hl-16-88><a class=lnlinks href=#hl-16-88> 88</a>
</span><span class=lnt id=hl-16-89><a class=lnlinks href=#hl-16-89> 89</a>
</span><span class=lnt id=hl-16-90><a class=lnlinks href=#hl-16-90> 90</a>
</span><span class=lnt id=hl-16-91><a class=lnlinks href=#hl-16-91> 91</a>
</span><span class=lnt id=hl-16-92><a class=lnlinks href=#hl-16-92> 92</a>
</span><span class=lnt id=hl-16-93><a class=lnlinks href=#hl-16-93> 93</a>
</span><span class=lnt id=hl-16-94><a class=lnlinks href=#hl-16-94> 94</a>
</span><span class=lnt id=hl-16-95><a class=lnlinks href=#hl-16-95> 95</a>
</span><span class=lnt id=hl-16-96><a class=lnlinks href=#hl-16-96> 96</a>
</span><span class=lnt id=hl-16-97><a class=lnlinks href=#hl-16-97> 97</a>
</span><span class=lnt id=hl-16-98><a class=lnlinks href=#hl-16-98> 98</a>
</span><span class=lnt id=hl-16-99><a class=lnlinks href=#hl-16-99> 99</a>
</span><span class=lnt id=hl-16-100><a class=lnlinks href=#hl-16-100>100</a>
</span><span class=lnt id=hl-16-101><a class=lnlinks href=#hl-16-101>101</a>
</span><span class=lnt id=hl-16-102><a class=lnlinks href=#hl-16-102>102</a>
</span><span class=lnt id=hl-16-103><a class=lnlinks href=#hl-16-103>103</a>
</span><span class=lnt id=hl-16-104><a class=lnlinks href=#hl-16-104>104</a>
</span><span class=lnt id=hl-16-105><a class=lnlinks href=#hl-16-105>105</a>
</span><span class=lnt id=hl-16-106><a class=lnlinks href=#hl-16-106>106</a>
</span><span class=lnt id=hl-16-107><a class=lnlinks href=#hl-16-107>107</a>
</span><span class=lnt id=hl-16-108><a class=lnlinks href=#hl-16-108>108</a>
</span><span class=lnt id=hl-16-109><a class=lnlinks href=#hl-16-109>109</a>
</span><span class=lnt id=hl-16-110><a class=lnlinks href=#hl-16-110>110</a>
</span><span class=lnt id=hl-16-111><a class=lnlinks href=#hl-16-111>111</a>
</span><span class=lnt id=hl-16-112><a class=lnlinks href=#hl-16-112>112</a>
</span><span class=lnt id=hl-16-113><a class=lnlinks href=#hl-16-113>113</a>
</span><span class=lnt id=hl-16-114><a class=lnlinks href=#hl-16-114>114</a>
</span><span class=lnt id=hl-16-115><a class=lnlinks href=#hl-16-115>115</a>
</span><span class=lnt id=hl-16-116><a class=lnlinks href=#hl-16-116>116</a>
</span><span class=lnt id=hl-16-117><a class=lnlinks href=#hl-16-117>117</a>
</span><span class=lnt id=hl-16-118><a class=lnlinks href=#hl-16-118>118</a>
</span><span class=lnt id=hl-16-119><a class=lnlinks href=#hl-16-119>119</a>
</span><span class=lnt id=hl-16-120><a class=lnlinks href=#hl-16-120>120</a>
</span><span class=lnt id=hl-16-121><a class=lnlinks href=#hl-16-121>121</a>
</span><span class=lnt id=hl-16-122><a class=lnlinks href=#hl-16-122>122</a>
</span><span class=lnt id=hl-16-123><a class=lnlinks href=#hl-16-123>123</a>
</span><span class=lnt id=hl-16-124><a class=lnlinks href=#hl-16-124>124</a>
</span><span class=lnt id=hl-16-125><a class=lnlinks href=#hl-16-125>125</a>
</span><span class=lnt id=hl-16-126><a class=lnlinks href=#hl-16-126>126</a>
</span><span class=lnt id=hl-16-127><a class=lnlinks href=#hl-16-127>127</a>
</span><span class=lnt id=hl-16-128><a class=lnlinks href=#hl-16-128>128</a>
</span><span class=lnt id=hl-16-129><a class=lnlinks href=#hl-16-129>129</a>
</span><span class=lnt id=hl-16-130><a class=lnlinks href=#hl-16-130>130</a>
</span><span class=lnt id=hl-16-131><a class=lnlinks href=#hl-16-131>131</a>
</span><span class=lnt id=hl-16-132><a class=lnlinks href=#hl-16-132>132</a>
</span><span class=lnt id=hl-16-133><a class=lnlinks href=#hl-16-133>133</a>
</span><span class=lnt id=hl-16-134><a class=lnlinks href=#hl-16-134>134</a>
</span><span class=lnt id=hl-16-135><a class=lnlinks href=#hl-16-135>135</a>
</span><span class=lnt id=hl-16-136><a class=lnlinks href=#hl-16-136>136</a>
</span><span class=lnt id=hl-16-137><a class=lnlinks href=#hl-16-137>137</a>
</span><span class=lnt id=hl-16-138><a class=lnlinks href=#hl-16-138>138</a>
</span><span class=lnt id=hl-16-139><a class=lnlinks href=#hl-16-139>139</a>
</span><span class=lnt id=hl-16-140><a class=lnlinks href=#hl-16-140>140</a>
</span><span class=lnt id=hl-16-141><a class=lnlinks href=#hl-16-141>141</a>
</span><span class=lnt id=hl-16-142><a class=lnlinks href=#hl-16-142>142</a>
</span><span class=lnt id=hl-16-143><a class=lnlinks href=#hl-16-143>143</a>
</span><span class=lnt id=hl-16-144><a class=lnlinks href=#hl-16-144>144</a>
</span><span class=lnt id=hl-16-145><a class=lnlinks href=#hl-16-145>145</a>
</span><span class=lnt id=hl-16-146><a class=lnlinks href=#hl-16-146>146</a>
</span><span class=lnt id=hl-16-147><a class=lnlinks href=#hl-16-147>147</a>
</span><span class=lnt id=hl-16-148><a class=lnlinks href=#hl-16-148>148</a>
</span><span class=lnt id=hl-16-149><a class=lnlinks href=#hl-16-149>149</a>
</span><span class=lnt id=hl-16-150><a class=lnlinks href=#hl-16-150>150</a>
</span><span class=lnt id=hl-16-151><a class=lnlinks href=#hl-16-151>151</a>
</span><span class=lnt id=hl-16-152><a class=lnlinks href=#hl-16-152>152</a>
</span><span class=lnt id=hl-16-153><a class=lnlinks href=#hl-16-153>153</a>
</span><span class=lnt id=hl-16-154><a class=lnlinks href=#hl-16-154>154</a>
</span><span class=lnt id=hl-16-155><a class=lnlinks href=#hl-16-155>155</a>
</span><span class=lnt id=hl-16-156><a class=lnlinks href=#hl-16-156>156</a>
</span><span class=lnt id=hl-16-157><a class=lnlinks href=#hl-16-157>157</a>
</span><span class=lnt id=hl-16-158><a class=lnlinks href=#hl-16-158>158</a>
</span><span class=lnt id=hl-16-159><a class=lnlinks href=#hl-16-159>159</a>
</span><span class=lnt id=hl-16-160><a class=lnlinks href=#hl-16-160>160</a>
</span><span class=lnt id=hl-16-161><a class=lnlinks href=#hl-16-161>161</a>
</span><span class=lnt id=hl-16-162><a class=lnlinks href=#hl-16-162>162</a>
</span><span class=lnt id=hl-16-163><a class=lnlinks href=#hl-16-163>163</a>
</span><span class=lnt id=hl-16-164><a class=lnlinks href=#hl-16-164>164</a>
</span><span class=lnt id=hl-16-165><a class=lnlinks href=#hl-16-165>165</a>
</span><span class=lnt id=hl-16-166><a class=lnlinks href=#hl-16-166>166</a>
</span><span class=lnt id=hl-16-167><a class=lnlinks href=#hl-16-167>167</a>
</span><span class=lnt id=hl-16-168><a class=lnlinks href=#hl-16-168>168</a>
</span><span class=lnt id=hl-16-169><a class=lnlinks href=#hl-16-169>169</a>
</span><span class=lnt id=hl-16-170><a class=lnlinks href=#hl-16-170>170</a>
</span><span class=lnt id=hl-16-171><a class=lnlinks href=#hl-16-171>171</a>
</span><span class=lnt id=hl-16-172><a class=lnlinks href=#hl-16-172>172</a>
</span><span class=lnt id=hl-16-173><a class=lnlinks href=#hl-16-173>173</a>
</span><span class=lnt id=hl-16-174><a class=lnlinks href=#hl-16-174>174</a>
</span><span class=lnt id=hl-16-175><a class=lnlinks href=#hl-16-175>175</a>
</span><span class=lnt id=hl-16-176><a class=lnlinks href=#hl-16-176>176</a>
</span><span class=lnt id=hl-16-177><a class=lnlinks href=#hl-16-177>177</a>
</span><span class=lnt id=hl-16-178><a class=lnlinks href=#hl-16-178>178</a>
</span><span class=lnt id=hl-16-179><a class=lnlinks href=#hl-16-179>179</a>
</span><span class=lnt id=hl-16-180><a class=lnlinks href=#hl-16-180>180</a>
</span><span class=lnt id=hl-16-181><a class=lnlinks href=#hl-16-181>181</a>
</span><span class=lnt id=hl-16-182><a class=lnlinks href=#hl-16-182>182</a>
</span><span class=lnt id=hl-16-183><a class=lnlinks href=#hl-16-183>183</a>
</span><span class=lnt id=hl-16-184><a class=lnlinks href=#hl-16-184>184</a>
</span><span class=lnt id=hl-16-185><a class=lnlinks href=#hl-16-185>185</a>
</span><span class=lnt id=hl-16-186><a class=lnlinks href=#hl-16-186>186</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 모바일 애플리케이션에서의 오프라인 우선 API 클라이언트 구현
</span></span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>OfflineFirstApiClient</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>options</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>apiBaseUrl</span> <span class=o>=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>apiBaseUrl</span> <span class=o>||</span> <span class=s1>&#39;https://api.example.com&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>syncManager</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>SyncManager</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>networkMonitor</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NetworkMonitor</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>localStore</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>LocalStore</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 네트워크 상태 변경 시 동기화 시도
</span></span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>networkMonitor</span><span class=p>.</span><span class=nx>onConnectivityChange</span><span class=p>((</span><span class=nx>isConnected</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>isConnected</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>syncManager</span><span class=p>.</span><span class=nx>attemptSync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 데이터 생성 요청
</span></span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>create</span><span class=p>(</span><span class=nx>endpoint</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 고유 ID 생성
</span></span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>localId</span> <span class=o>=</span> <span class=nx>generateUUID</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>timestamp</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 로컬 저장소에 저장
</span></span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>localStore</span><span class=p>.</span><span class=nx>saveItem</span><span class=p>(</span><span class=nx>endpoint</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span><span class=o>:</span> <span class=nx>localId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;pending&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>operation</span><span class=o>:</span> <span class=s1>&#39;create&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>timestamp</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 네트워크 연결 확인
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>networkMonitor</span><span class=p>.</span><span class=nx>isConnected</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 서버에 즉시 동기화 시도
</span></span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>syncManager</span><span class=p>.</span><span class=nx>syncItem</span><span class=p>(</span><span class=nx>endpoint</span><span class=p>,</span> <span class=nx>localId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 오류 발생 시 작업은 여전히 큐에 남아 있음
</span></span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Synchronization failed, will retry later: </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=nx>localId</span><span class=p>,</span> <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;pending&#39;</span><span class=p>,</span> <span class=nx>data</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 오프라인 상태 - 나중에 동기화
</span></span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Offline - item queued for later synchronization&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=nx>localId</span><span class=p>,</span> <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;pending&#39;</span><span class=p>,</span> <span class=nx>data</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 데이터 업데이트 요청
</span></span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>update</span><span class=p>(</span><span class=nx>endpoint</span><span class=p>,</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 로컬 데이터 업데이트
</span></span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>localStore</span><span class=p>.</span><span class=nx>updateItem</span><span class=p>(</span><span class=nx>endpoint</span><span class=p>,</span> <span class=nx>id</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;pending&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>operation</span><span class=o>:</span> <span class=s1>&#39;update&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 즉시 동기화 시도
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>networkMonitor</span><span class=p>.</span><span class=nx>isConnected</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>syncManager</span><span class=p>.</span><span class=nx>syncItem</span><span class=p>(</span><span class=nx>endpoint</span><span class=p>,</span> <span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;pending&#39;</span><span class=p>,</span> <span class=nx>data</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 데이터 조회 요청
</span></span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>get</span><span class=p>(</span><span class=nx>endpoint</span><span class=p>,</span> <span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 먼저 로컬 데이터 확인
</span></span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>localData</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>localStore</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=nx>endpoint</span><span class=p>,</span> <span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 네트워크 연결 확인
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>networkMonitor</span><span class=p>.</span><span class=nx>isConnected</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 서버에서 최신 데이터 가져오기
</span></span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>apiBaseUrl</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>endpoint</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`API error: </span><span class=si>${</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>serverData</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 로컬 데이터 업데이트
</span></span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>localStore</span><span class=p>.</span><span class=nx>saveItem</span><span class=p>(</span><span class=nx>endpoint</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>data</span><span class=o>:</span> <span class=nx>serverData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;synced&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>serverData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Error fetching data: </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 오류 발생 시 로컬 데이터 반환
</span></span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>localData</span> <span class=o>?</span> <span class=nx>localData</span><span class=p>.</span><span class=nx>data</span> <span class=o>:</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 오프라인 상태 - 로컬 데이터만 반환
</span></span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>localData</span> <span class=o>?</span> <span class=nx>localData</span><span class=p>.</span><span class=nx>data</span> <span class=o>:</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 동기화 관리자
</span></span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>SyncManager</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>syncQueue</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>isSyncing</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>retryDelay</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>maxRetries</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 주기적인 동기화 시도 (5분마다)
</span></span></span><span class=line><span class=cl>    <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>attemptSync</span><span class=p>(),</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 모든 대기 중인 항목 동기화 시도
</span></span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>attemptSync</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isSyncing</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>isSyncing</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 동기화 큐 처리
</span></span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>pendingItems</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>localStore</span><span class=p>.</span><span class=nx>getPendingItems</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 배터리 및 네트워크 상태에 따라 동기화 전략 조정
</span></span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>batchSize</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>determineBatchSize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>prioritizedItems</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>prioritizeItems</span><span class=p>(</span><span class=nx>pendingItems</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>prioritizedItems</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span> <span class=o>+=</span> <span class=nx>batchSize</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>batch</span> <span class=o>=</span> <span class=nx>prioritizedItems</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=nx>i</span> <span class=o>+</span> <span class=nx>batchSize</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>processBatch</span><span class=p>(</span><span class=nx>batch</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Sync error:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>isSyncing</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 네트워크 및 배터리 상태에 따른 배치 크기 결정
</span></span></span><span class=line><span class=cl>  <span class=nx>determineBatchSize</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>networkType</span> <span class=o>=</span> <span class=nx>networkMonitor</span><span class=p>.</span><span class=nx>getConnectionType</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>batteryLevel</span> <span class=o>=</span> <span class=nx>batteryMonitor</span><span class=p>.</span><span class=nx>getBatteryLevel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 배터리 부족 또는 셀룰러 네트워크에서는 작은 배치 사용
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>batteryLevel</span> <span class=o>&lt;</span> <span class=mf>0.2</span> <span class=o>||</span> <span class=nx>networkType</span> <span class=o>===</span> <span class=s1>&#39;cellular&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Wi-Fi 및 충분한 배터리에서는 큰 배치 사용
</span></span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>20</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 항목 우선순위 지정
</span></span></span><span class=line><span class=cl>  <span class=nx>prioritizeItems</span><span class=p>(</span><span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>items</span><span class=p>.</span><span class=nx>sort</span><span class=p>((</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 1. 작업 유형 (생성 &gt; 업데이트 &gt; 삭제)
</span></span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>a</span><span class=p>.</span><span class=nx>operation</span> <span class=o>!==</span> <span class=nx>b</span><span class=p>.</span><span class=nx>operation</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>operationPriority</span> <span class=o>=</span> <span class=p>{</span> <span class=s1>&#39;create&#39;</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span> <span class=s1>&#39;update&#39;</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;delete&#39;</span><span class=o>:</span> <span class=mi>1</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>operationPriority</span><span class=p>[</span><span class=nx>b</span><span class=p>.</span><span class=nx>operation</span><span class=p>]</span> <span class=o>-</span> <span class=nx>operationPriority</span><span class=p>[</span><span class=nx>a</span><span class=p>.</span><span class=nx>operation</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 2. 엔드포인트 우선순위 (중요한 데이터 먼저)
</span></span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>endpointPriority</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;payments&#39;</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;orders&#39;</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;profiles&#39;</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;preferences&#39;</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;logs&#39;</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>aPriority</span> <span class=o>=</span> <span class=nx>endpointPriority</span><span class=p>[</span><span class=nx>a</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>]</span> <span class=o>||</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>bPriority</span> <span class=o>=</span> <span class=nx>endpointPriority</span><span class=p>[</span><span class=nx>b</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>]</span> <span class=o>||</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>aPriority</span> <span class=o>!==</span> <span class=nx>bPriority</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>bPriority</span> <span class=o>-</span> <span class=nx>aPriority</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 3. 타임스탬프 (오래된 항목 먼저)
</span></span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>a</span><span class=p>.</span><span class=nx>timestamp</span> <span class=o>-</span> <span class=nx>b</span><span class=p>.</span><span class=nx>timestamp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=결과-1>결과<a hidden class=anchor aria-hidden=true href=#결과-1>#</a></h5><ul><li>약한 네트워크 환경에서도 97% 동기화 성공률 달성</li><li>오프라인 상태에서도 앱 사용성 유지</li><li>네트워크 데이터 사용량 30% 감소</li><li>배터리 사용량 최적화</li></ul><h4 id=93-금융-서비스-api>9.3 금융 서비스 API<a hidden class=anchor aria-hidden=true href=#93-금융-서비스-api>#</a></h4><h5 id=시나리오-2>시나리오<a hidden class=anchor aria-hidden=true href=#시나리오-2>#</a></h5><p>높은 신뢰성과 정확성이 요구되는 금융 거래 API</p><h5 id=주요-도전-과제-2>주요 도전 과제<a hidden class=anchor aria-hidden=true href=#주요-도전-과제-2>#</a></h5><ol><li>0% 오류 허용 정책</li><li>엄격한 규정 준수 요구사항</li><li>고의적 API 남용 및 공격 대응</li><li>감사 및 추적 필요성</li></ol><h5 id=구현된-솔루션-2>구현된 솔루션<a hidden class=anchor aria-hidden=true href=#구현된-솔루션-2>#</a></h5><ol><li><strong>심층 방어(Defense in Depth)</strong>:<ul><li>다중 검증 계층: 클라이언트 측, API 게이트웨이, 서비스 계층, 데이터베이스 계층의 검증</li><li>이중 제출 방지: 멱등성 키와 거래 ID를 통한 중복 거래 방지</li></ul></li><li><strong>정교한 오류 처리</strong>:<ul><li>분류된 오류 코드: 상세한 오류 분류 체계</li><li>보안 강화 오류 메시지: 민감한 정보를 노출하지 않는 오류 응답</li></ul></li><li><strong>재시도 관리</strong>:<ul><li>조건부 재시도: 시스템 상태 및 거래 유형에 따른 재시도 결정</li><li>재시도 알림: 재시도 시 관리자에게 자동 알림</li></ul></li><li><strong>감사 및 규정 준수</strong>:<ul><li>전체 요청 및 응답 로깅: 감사 목적으로 모든 API 상호작용 기록</li><li>결과 증명: 각 거래에 대한 암호학적 증명 생성</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>  1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>  2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>  3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>  4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>  5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6>  6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7>  7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8>  8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9>  9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10> 10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11> 11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12> 12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13> 13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14> 14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15> 15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16> 16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17> 17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18> 18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19> 19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20> 20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21> 21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22> 22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23> 23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24> 24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25> 25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26> 26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27> 27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28> 28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29> 29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30> 30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31> 31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32> 32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33> 33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34> 34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35> 35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36> 36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37> 37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38> 38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39> 39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40> 40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41> 41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42> 42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43> 43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44> 44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45> 45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46> 46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47> 47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48> 48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49> 49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50> 50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51> 51</a>
</span><span class=lnt id=hl-17-52><a class=lnlinks href=#hl-17-52> 52</a>
</span><span class=lnt id=hl-17-53><a class=lnlinks href=#hl-17-53> 53</a>
</span><span class=lnt id=hl-17-54><a class=lnlinks href=#hl-17-54> 54</a>
</span><span class=lnt id=hl-17-55><a class=lnlinks href=#hl-17-55> 55</a>
</span><span class=lnt id=hl-17-56><a class=lnlinks href=#hl-17-56> 56</a>
</span><span class=lnt id=hl-17-57><a class=lnlinks href=#hl-17-57> 57</a>
</span><span class=lnt id=hl-17-58><a class=lnlinks href=#hl-17-58> 58</a>
</span><span class=lnt id=hl-17-59><a class=lnlinks href=#hl-17-59> 59</a>
</span><span class=lnt id=hl-17-60><a class=lnlinks href=#hl-17-60> 60</a>
</span><span class=lnt id=hl-17-61><a class=lnlinks href=#hl-17-61> 61</a>
</span><span class=lnt id=hl-17-62><a class=lnlinks href=#hl-17-62> 62</a>
</span><span class=lnt id=hl-17-63><a class=lnlinks href=#hl-17-63> 63</a>
</span><span class=lnt id=hl-17-64><a class=lnlinks href=#hl-17-64> 64</a>
</span><span class=lnt id=hl-17-65><a class=lnlinks href=#hl-17-65> 65</a>
</span><span class=lnt id=hl-17-66><a class=lnlinks href=#hl-17-66> 66</a>
</span><span class=lnt id=hl-17-67><a class=lnlinks href=#hl-17-67> 67</a>
</span><span class=lnt id=hl-17-68><a class=lnlinks href=#hl-17-68> 68</a>
</span><span class=lnt id=hl-17-69><a class=lnlinks href=#hl-17-69> 69</a>
</span><span class=lnt id=hl-17-70><a class=lnlinks href=#hl-17-70> 70</a>
</span><span class=lnt id=hl-17-71><a class=lnlinks href=#hl-17-71> 71</a>
</span><span class=lnt id=hl-17-72><a class=lnlinks href=#hl-17-72> 72</a>
</span><span class=lnt id=hl-17-73><a class=lnlinks href=#hl-17-73> 73</a>
</span><span class=lnt id=hl-17-74><a class=lnlinks href=#hl-17-74> 74</a>
</span><span class=lnt id=hl-17-75><a class=lnlinks href=#hl-17-75> 75</a>
</span><span class=lnt id=hl-17-76><a class=lnlinks href=#hl-17-76> 76</a>
</span><span class=lnt id=hl-17-77><a class=lnlinks href=#hl-17-77> 77</a>
</span><span class=lnt id=hl-17-78><a class=lnlinks href=#hl-17-78> 78</a>
</span><span class=lnt id=hl-17-79><a class=lnlinks href=#hl-17-79> 79</a>
</span><span class=lnt id=hl-17-80><a class=lnlinks href=#hl-17-80> 80</a>
</span><span class=lnt id=hl-17-81><a class=lnlinks href=#hl-17-81> 81</a>
</span><span class=lnt id=hl-17-82><a class=lnlinks href=#hl-17-82> 82</a>
</span><span class=lnt id=hl-17-83><a class=lnlinks href=#hl-17-83> 83</a>
</span><span class=lnt id=hl-17-84><a class=lnlinks href=#hl-17-84> 84</a>
</span><span class=lnt id=hl-17-85><a class=lnlinks href=#hl-17-85> 85</a>
</span><span class=lnt id=hl-17-86><a class=lnlinks href=#hl-17-86> 86</a>
</span><span class=lnt id=hl-17-87><a class=lnlinks href=#hl-17-87> 87</a>
</span><span class=lnt id=hl-17-88><a class=lnlinks href=#hl-17-88> 88</a>
</span><span class=lnt id=hl-17-89><a class=lnlinks href=#hl-17-89> 89</a>
</span><span class=lnt id=hl-17-90><a class=lnlinks href=#hl-17-90> 90</a>
</span><span class=lnt id=hl-17-91><a class=lnlinks href=#hl-17-91> 91</a>
</span><span class=lnt id=hl-17-92><a class=lnlinks href=#hl-17-92> 92</a>
</span><span class=lnt id=hl-17-93><a class=lnlinks href=#hl-17-93> 93</a>
</span><span class=lnt id=hl-17-94><a class=lnlinks href=#hl-17-94> 94</a>
</span><span class=lnt id=hl-17-95><a class=lnlinks href=#hl-17-95> 95</a>
</span><span class=lnt id=hl-17-96><a class=lnlinks href=#hl-17-96> 96</a>
</span><span class=lnt id=hl-17-97><a class=lnlinks href=#hl-17-97> 97</a>
</span><span class=lnt id=hl-17-98><a class=lnlinks href=#hl-17-98> 98</a>
</span><span class=lnt id=hl-17-99><a class=lnlinks href=#hl-17-99> 99</a>
</span><span class=lnt id=hl-17-100><a class=lnlinks href=#hl-17-100>100</a>
</span><span class=lnt id=hl-17-101><a class=lnlinks href=#hl-17-101>101</a>
</span><span class=lnt id=hl-17-102><a class=lnlinks href=#hl-17-102>102</a>
</span><span class=lnt id=hl-17-103><a class=lnlinks href=#hl-17-103>103</a>
</span><span class=lnt id=hl-17-104><a class=lnlinks href=#hl-17-104>104</a>
</span><span class=lnt id=hl-17-105><a class=lnlinks href=#hl-17-105>105</a>
</span><span class=lnt id=hl-17-106><a class=lnlinks href=#hl-17-106>106</a>
</span><span class=lnt id=hl-17-107><a class=lnlinks href=#hl-17-107>107</a>
</span><span class=lnt id=hl-17-108><a class=lnlinks href=#hl-17-108>108</a>
</span><span class=lnt id=hl-17-109><a class=lnlinks href=#hl-17-109>109</a>
</span><span class=lnt id=hl-17-110><a class=lnlinks href=#hl-17-110>110</a>
</span><span class=lnt id=hl-17-111><a class=lnlinks href=#hl-17-111>111</a>
</span><span class=lnt id=hl-17-112><a class=lnlinks href=#hl-17-112>112</a>
</span><span class=lnt id=hl-17-113><a class=lnlinks href=#hl-17-113>113</a>
</span><span class=lnt id=hl-17-114><a class=lnlinks href=#hl-17-114>114</a>
</span><span class=lnt id=hl-17-115><a class=lnlinks href=#hl-17-115>115</a>
</span><span class=lnt id=hl-17-116><a class=lnlinks href=#hl-17-116>116</a>
</span><span class=lnt id=hl-17-117><a class=lnlinks href=#hl-17-117>117</a>
</span><span class=lnt id=hl-17-118><a class=lnlinks href=#hl-17-118>118</a>
</span><span class=lnt id=hl-17-119><a class=lnlinks href=#hl-17-119>119</a>
</span><span class=lnt id=hl-17-120><a class=lnlinks href=#hl-17-120>120</a>
</span><span class=lnt id=hl-17-121><a class=lnlinks href=#hl-17-121>121</a>
</span><span class=lnt id=hl-17-122><a class=lnlinks href=#hl-17-122>122</a>
</span><span class=lnt id=hl-17-123><a class=lnlinks href=#hl-17-123>123</a>
</span><span class=lnt id=hl-17-124><a class=lnlinks href=#hl-17-124>124</a>
</span><span class=lnt id=hl-17-125><a class=lnlinks href=#hl-17-125>125</a>
</span><span class=lnt id=hl-17-126><a class=lnlinks href=#hl-17-126>126</a>
</span><span class=lnt id=hl-17-127><a class=lnlinks href=#hl-17-127>127</a>
</span><span class=lnt id=hl-17-128><a class=lnlinks href=#hl-17-128>128</a>
</span><span class=lnt id=hl-17-129><a class=lnlinks href=#hl-17-129>129</a>
</span><span class=lnt id=hl-17-130><a class=lnlinks href=#hl-17-130>130</a>
</span><span class=lnt id=hl-17-131><a class=lnlinks href=#hl-17-131>131</a>
</span><span class=lnt id=hl-17-132><a class=lnlinks href=#hl-17-132>132</a>
</span><span class=lnt id=hl-17-133><a class=lnlinks href=#hl-17-133>133</a>
</span><span class=lnt id=hl-17-134><a class=lnlinks href=#hl-17-134>134</a>
</span><span class=lnt id=hl-17-135><a class=lnlinks href=#hl-17-135>135</a>
</span><span class=lnt id=hl-17-136><a class=lnlinks href=#hl-17-136>136</a>
</span><span class=lnt id=hl-17-137><a class=lnlinks href=#hl-17-137>137</a>
</span><span class=lnt id=hl-17-138><a class=lnlinks href=#hl-17-138>138</a>
</span><span class=lnt id=hl-17-139><a class=lnlinks href=#hl-17-139>139</a>
</span><span class=lnt id=hl-17-140><a class=lnlinks href=#hl-17-140>140</a>
</span><span class=lnt id=hl-17-141><a class=lnlinks href=#hl-17-141>141</a>
</span><span class=lnt id=hl-17-142><a class=lnlinks href=#hl-17-142>142</a>
</span><span class=lnt id=hl-17-143><a class=lnlinks href=#hl-17-143>143</a>
</span><span class=lnt id=hl-17-144><a class=lnlinks href=#hl-17-144>144</a>
</span><span class=lnt id=hl-17-145><a class=lnlinks href=#hl-17-145>145</a>
</span><span class=lnt id=hl-17-146><a class=lnlinks href=#hl-17-146>146</a>
</span><span class=lnt id=hl-17-147><a class=lnlinks href=#hl-17-147>147</a>
</span><span class=lnt id=hl-17-148><a class=lnlinks href=#hl-17-148>148</a>
</span><span class=lnt id=hl-17-149><a class=lnlinks href=#hl-17-149>149</a>
</span><span class=lnt id=hl-17-150><a class=lnlinks href=#hl-17-150>150</a>
</span><span class=lnt id=hl-17-151><a class=lnlinks href=#hl-17-151>151</a>
</span><span class=lnt id=hl-17-152><a class=lnlinks href=#hl-17-152>152</a>
</span><span class=lnt id=hl-17-153><a class=lnlinks href=#hl-17-153>153</a>
</span><span class=lnt id=hl-17-154><a class=lnlinks href=#hl-17-154>154</a>
</span><span class=lnt id=hl-17-155><a class=lnlinks href=#hl-17-155>155</a>
</span><span class=lnt id=hl-17-156><a class=lnlinks href=#hl-17-156>156</a>
</span><span class=lnt id=hl-17-157><a class=lnlinks href=#hl-17-157>157</a>
</span><span class=lnt id=hl-17-158><a class=lnlinks href=#hl-17-158>158</a>
</span><span class=lnt id=hl-17-159><a class=lnlinks href=#hl-17-159>159</a>
</span><span class=lnt id=hl-17-160><a class=lnlinks href=#hl-17-160>160</a>
</span><span class=lnt id=hl-17-161><a class=lnlinks href=#hl-17-161>161</a>
</span><span class=lnt id=hl-17-162><a class=lnlinks href=#hl-17-162>162</a>
</span><span class=lnt id=hl-17-163><a class=lnlinks href=#hl-17-163>163</a>
</span><span class=lnt id=hl-17-164><a class=lnlinks href=#hl-17-164>164</a>
</span><span class=lnt id=hl-17-165><a class=lnlinks href=#hl-17-165>165</a>
</span><span class=lnt id=hl-17-166><a class=lnlinks href=#hl-17-166>166</a>
</span><span class=lnt id=hl-17-167><a class=lnlinks href=#hl-17-167>167</a>
</span><span class=lnt id=hl-17-168><a class=lnlinks href=#hl-17-168>168</a>
</span><span class=lnt id=hl-17-169><a class=lnlinks href=#hl-17-169>169</a>
</span><span class=lnt id=hl-17-170><a class=lnlinks href=#hl-17-170>170</a>
</span><span class=lnt id=hl-17-171><a class=lnlinks href=#hl-17-171>171</a>
</span><span class=lnt id=hl-17-172><a class=lnlinks href=#hl-17-172>172</a>
</span><span class=lnt id=hl-17-173><a class=lnlinks href=#hl-17-173>173</a>
</span><span class=lnt id=hl-17-174><a class=lnlinks href=#hl-17-174>174</a>
</span><span class=lnt id=hl-17-175><a class=lnlinks href=#hl-17-175>175</a>
</span><span class=lnt id=hl-17-176><a class=lnlinks href=#hl-17-176>176</a>
</span><span class=lnt id=hl-17-177><a class=lnlinks href=#hl-17-177>177</a>
</span><span class=lnt id=hl-17-178><a class=lnlinks href=#hl-17-178>178</a>
</span><span class=lnt id=hl-17-179><a class=lnlinks href=#hl-17-179>179</a>
</span><span class=lnt id=hl-17-180><a class=lnlinks href=#hl-17-180>180</a>
</span><span class=lnt id=hl-17-181><a class=lnlinks href=#hl-17-181>181</a>
</span><span class=lnt id=hl-17-182><a class=lnlinks href=#hl-17-182>182</a>
</span><span class=lnt id=hl-17-183><a class=lnlinks href=#hl-17-183>183</a>
</span><span class=lnt id=hl-17-184><a class=lnlinks href=#hl-17-184>184</a>
</span><span class=lnt id=hl-17-185><a class=lnlinks href=#hl-17-185>185</a>
</span><span class=lnt id=hl-17-186><a class=lnlinks href=#hl-17-186>186</a>
</span><span class=lnt id=hl-17-187><a class=lnlinks href=#hl-17-187>187</a>
</span><span class=lnt id=hl-17-188><a class=lnlinks href=#hl-17-188>188</a>
</span><span class=lnt id=hl-17-189><a class=lnlinks href=#hl-17-189>189</a>
</span><span class=lnt id=hl-17-190><a class=lnlinks href=#hl-17-190>190</a>
</span><span class=lnt id=hl-17-191><a class=lnlinks href=#hl-17-191>191</a>
</span><span class=lnt id=hl-17-192><a class=lnlinks href=#hl-17-192>192</a>
</span><span class=lnt id=hl-17-193><a class=lnlinks href=#hl-17-193>193</a>
</span><span class=lnt id=hl-17-194><a class=lnlinks href=#hl-17-194>194</a>
</span><span class=lnt id=hl-17-195><a class=lnlinks href=#hl-17-195>195</a>
</span><span class=lnt id=hl-17-196><a class=lnlinks href=#hl-17-196>196</a>
</span><span class=lnt id=hl-17-197><a class=lnlinks href=#hl-17-197>197</a>
</span><span class=lnt id=hl-17-198><a class=lnlinks href=#hl-17-198>198</a>
</span><span class=lnt id=hl-17-199><a class=lnlinks href=#hl-17-199>199</a>
</span><span class=lnt id=hl-17-200><a class=lnlinks href=#hl-17-200>200</a>
</span><span class=lnt id=hl-17-201><a class=lnlinks href=#hl-17-201>201</a>
</span><span class=lnt id=hl-17-202><a class=lnlinks href=#hl-17-202>202</a>
</span><span class=lnt id=hl-17-203><a class=lnlinks href=#hl-17-203>203</a>
</span><span class=lnt id=hl-17-204><a class=lnlinks href=#hl-17-204>204</a>
</span><span class=lnt id=hl-17-205><a class=lnlinks href=#hl-17-205>205</a>
</span><span class=lnt id=hl-17-206><a class=lnlinks href=#hl-17-206>206</a>
</span><span class=lnt id=hl-17-207><a class=lnlinks href=#hl-17-207>207</a>
</span><span class=lnt id=hl-17-208><a class=lnlinks href=#hl-17-208>208</a>
</span><span class=lnt id=hl-17-209><a class=lnlinks href=#hl-17-209>209</a>
</span><span class=lnt id=hl-17-210><a class=lnlinks href=#hl-17-210>210</a>
</span><span class=lnt id=hl-17-211><a class=lnlinks href=#hl-17-211>211</a>
</span><span class=lnt id=hl-17-212><a class=lnlinks href=#hl-17-212>212</a>
</span><span class=lnt id=hl-17-213><a class=lnlinks href=#hl-17-213>213</a>
</span><span class=lnt id=hl-17-214><a class=lnlinks href=#hl-17-214>214</a>
</span><span class=lnt id=hl-17-215><a class=lnlinks href=#hl-17-215>215</a>
</span><span class=lnt id=hl-17-216><a class=lnlinks href=#hl-17-216>216</a>
</span><span class=lnt id=hl-17-217><a class=lnlinks href=#hl-17-217>217</a>
</span><span class=lnt id=hl-17-218><a class=lnlinks href=#hl-17-218>218</a>
</span><span class=lnt id=hl-17-219><a class=lnlinks href=#hl-17-219>219</a>
</span><span class=lnt id=hl-17-220><a class=lnlinks href=#hl-17-220>220</a>
</span><span class=lnt id=hl-17-221><a class=lnlinks href=#hl-17-221>221</a>
</span><span class=lnt id=hl-17-222><a class=lnlinks href=#hl-17-222>222</a>
</span><span class=lnt id=hl-17-223><a class=lnlinks href=#hl-17-223>223</a>
</span><span class=lnt id=hl-17-224><a class=lnlinks href=#hl-17-224>224</a>
</span><span class=lnt id=hl-17-225><a class=lnlinks href=#hl-17-225>225</a>
</span><span class=lnt id=hl-17-226><a class=lnlinks href=#hl-17-226>226</a>
</span><span class=lnt id=hl-17-227><a class=lnlinks href=#hl-17-227>227</a>
</span><span class=lnt id=hl-17-228><a class=lnlinks href=#hl-17-228>228</a>
</span><span class=lnt id=hl-17-229><a class=lnlinks href=#hl-17-229>229</a>
</span><span class=lnt id=hl-17-230><a class=lnlinks href=#hl-17-230>230</a>
</span><span class=lnt id=hl-17-231><a class=lnlinks href=#hl-17-231>231</a>
</span><span class=lnt id=hl-17-232><a class=lnlinks href=#hl-17-232>232</a>
</span><span class=lnt id=hl-17-233><a class=lnlinks href=#hl-17-233>233</a>
</span><span class=lnt id=hl-17-234><a class=lnlinks href=#hl-17-234>234</a>
</span><span class=lnt id=hl-17-235><a class=lnlinks href=#hl-17-235>235</a>
</span><span class=lnt id=hl-17-236><a class=lnlinks href=#hl-17-236>236</a>
</span><span class=lnt id=hl-17-237><a class=lnlinks href=#hl-17-237>237</a>
</span><span class=lnt id=hl-17-238><a class=lnlinks href=#hl-17-238>238</a>
</span><span class=lnt id=hl-17-239><a class=lnlinks href=#hl-17-239>239</a>
</span><span class=lnt id=hl-17-240><a class=lnlinks href=#hl-17-240>240</a>
</span><span class=lnt id=hl-17-241><a class=lnlinks href=#hl-17-241>241</a>
</span><span class=lnt id=hl-17-242><a class=lnlinks href=#hl-17-242>242</a>
</span><span class=lnt id=hl-17-243><a class=lnlinks href=#hl-17-243>243</a>
</span><span class=lnt id=hl-17-244><a class=lnlinks href=#hl-17-244>244</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 금융 거래 API 오류 처리 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/v1/transactions&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TransactionController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>TransactionService</span><span class=w> </span><span class=n>transactionService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>AuditService</span><span class=w> </span><span class=n>auditService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>IdempotencyService</span><span class=w> </span><span class=n>idempotencyService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 거래 생성 API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>TransactionResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>createTransaction</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestHeader</span><span class=p>(</span><span class=s>&#34;X-Idempotency-Key&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>idempotencyKey</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Valid</span><span class=w> </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>TransactionRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Authentication</span><span class=w> </span><span class=n>authentication</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 사용자 인증 및 권한 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>User</span><span class=p>)</span><span class=w> </span><span class=n>authentication</span><span class=p>.</span><span class=na>getPrincipal</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>transactionService</span><span class=p>.</span><span class=na>canInitiateTransaction</span><span class=p>(</span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getAccountId</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 권한 오류 감사 로깅</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>auditService</span><span class=p>.</span><span class=na>logAccessDenied</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=s>&#34;transaction_initiate&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getAccountId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>FORBIDDEN</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>TransactionResponse</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;ACCESS_DENIED&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;You don&#39;t have permission to initiate transactions for this account&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 멱등성 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>TransactionResponse</span><span class=o>&gt;</span><span class=w> </span><span class=n>cachedResponse</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>idempotencyService</span><span class=p>.</span><span class=na>getCachedResponse</span><span class=p>(</span><span class=n>idempotencyKey</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cachedResponse</span><span class=p>.</span><span class=na>isPresent</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 중복 요청 - 이전 응답 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>cachedResponse</span><span class=p>.</span><span class=na>get</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 거래 처리 (여러 검증 단계 포함)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>TransactionResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>transactionService</span><span class=p>.</span><span class=na>processTransaction</span><span class=p>(</span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 성공한 거래 응답 캐싱</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>TransactionResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TransactionResponse</span><span class=p>.</span><span class=na>success</span><span class=p>(</span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>idempotencyService</span><span class=p>.</span><span class=na>cacheResponse</span><span class=p>(</span><span class=n>idempotencyKey</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 감사 로깅</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>auditService</span><span class=p>.</span><span class=na>logSuccessfulTransaction</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>result</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>request</span><span class=p>.</span><span class=na>getAccountId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>result</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CREATED</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InsufficientFundsException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 비즈니스 규칙 위반 - 자금 부족</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>auditService</span><span class=p>.</span><span class=na>logTransactionFailed</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getAccountId</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;INSUFFICIENT_FUNDS&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>PAYMENT_REQUIRED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>TransactionResponse</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;INSUFFICIENT_FUNDS&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=s>&#34;Insufficient funds in the account&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>AccountLockedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 계정 잠김 - 재시도 정보 포함</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>LOCKED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>header</span><span class=p>(</span><span class=s>&#34;Retry-After&#34;</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getLockDurationSeconds</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>TransactionResponse</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;ACCOUNT_LOCKED&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=s>&#34;Account is temporarily locked. Please try again later.&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>TransactionLimitExceededException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 거래 한도 초과</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>FORBIDDEN</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>TransactionResponse</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;LIMIT_EXCEEDED&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=s>&#34;Transaction exceeds your daily/monthly limit&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>DuplicateTransactionException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 중복 거래 (멱등성이 아닌 비즈니스 기준)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>TransactionResponse</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;DUPLICATE_TRANSACTION&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=s>&#34;A similar transaction was recently processed&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 예상치 못한 오류</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>errorId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>auditService</span><span class=p>.</span><span class=na>logSystemError</span><span class=p>(</span><span class=n>errorId</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>TransactionResponse</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;SYSTEM_ERROR&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=s>&#34;An unexpected error occurred. Reference: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>errorId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 트랜잭션 서비스의 재시도 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TransactionServiceImpl</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>TransactionService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>TransactionRepository</span><span class=w> </span><span class=n>transactionRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>AccountService</span><span class=w> </span><span class=n>accountService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>NotificationService</span><span class=w> </span><span class=n>notificationService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>TransactionResult</span><span class=w> </span><span class=nf>processTransaction</span><span class=p>(</span><span class=n>TransactionRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 트랜잭션 생성 및 초기 상태 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Transaction</span><span class=w> </span><span class=n>transaction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Transaction</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transaction</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transaction</span><span class=p>.</span><span class=na>setTransactionId</span><span class=p>(</span><span class=n>generateTransactionId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transaction</span><span class=p>.</span><span class=na>setAmount</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transaction</span><span class=p>.</span><span class=na>setSourceAccountId</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getSourceAccountId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transaction</span><span class=p>.</span><span class=na>setDestinationAccountId</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getDestinationAccountId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transaction</span><span class=p>.</span><span class=na>setUserId</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transaction</span><span class=p>.</span><span class=na>setCreatedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transactionRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 외부 결제 게이트웨이 호출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PaymentResult</span><span class=w> </span><span class=n>paymentResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>processPayment</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 결과 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transaction</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transaction</span><span class=p>.</span><span class=na>setCompletedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transaction</span><span class=p>.</span><span class=na>setExternalReference</span><span class=p>(</span><span class=n>paymentResult</span><span class=p>.</span><span class=na>getReferenceId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 알림 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>notificationService</span><span class=p>.</span><span class=na>sendTransactionConfirmation</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransactionResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>getCompletedAt</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PaymentGatewayTimeoutException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 시간 초과 - 재시도 가능</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>handlePaymentTimeout</span><span class=p>(</span><span class=n>transaction</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PaymentGatewayErrorException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 게이트웨이 오류 - 거래 실패로 표시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transaction</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transaction</span><span class=p>.</span><span class=na>setErrorCode</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getErrorCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transaction</span><span class=p>.</span><span class=na>setErrorMessage</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transactionRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransactionFailedException</span><span class=p>(</span><span class=s>&#34;Payment gateway error: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>TransactionResult</span><span class=w> </span><span class=nf>handlePaymentTimeout</span><span class=p>(</span><span class=n>Transaction</span><span class=w> </span><span class=n>transaction</span><span class=p>,</span><span class=w> </span><span class=n>PaymentGatewayTimeoutException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 게이트웨이 시간 초과 - 거래 상태 확인 필요</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transaction</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>PENDING_VERIFICATION</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transactionRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비동기 검증 작업 예약</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verificationTaskScheduler</span><span class=p>.</span><span class=na>scheduleVerification</span><span class=p>(</span><span class=n>transaction</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 관리자에게 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>notificationService</span><span class=p>.</span><span class=na>alertOperator</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;PAYMENT_TIMEOUT&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;Transaction &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>transaction</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; requires verification&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>transaction</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 클라이언트에게 확인 대기 중 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransactionResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>transaction</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>PENDING_VERIFICATION</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 거래 상태 확인 (비동기 검증용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>TransactionResult</span><span class=w> </span><span class=nf>verifyTransactionStatus</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>transactionId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Transaction</span><span class=w> </span><span class=n>transaction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>transactionRepository</span><span class=p>.</span><span class=na>findByTransactionId</span><span class=p>(</span><span class=n>transactionId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransactionNotFoundException</span><span class=p>(</span><span class=n>transactionId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>transaction</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>PENDING_VERIFICATION</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransactionResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>getStatus</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>getCompletedAt</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 결제 게이트웨이에 상태 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PaymentStatusResult</span><span class=w> </span><span class=n>statusResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentGateway</span><span class=p>.</span><span class=na>checkStatus</span><span class=p>(</span><span class=n>transaction</span><span class=p>.</span><span class=na>getExternalReference</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>statusResult</span><span class=p>.</span><span class=na>getStatus</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>case</span><span class=w> </span><span class=n>COMPLETED</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>setCompletedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>case</span><span class=w> </span><span class=n>FAILED</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>setErrorCode</span><span class=p>(</span><span class=n>statusResult</span><span class=p>.</span><span class=na>getErrorCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>setErrorMessage</span><span class=p>(</span><span class=n>statusResult</span><span class=p>.</span><span class=na>getErrorMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>case</span><span class=w> </span><span class=n>PENDING</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 여전히 대기 중 - 나중에 다시 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransactionResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>transaction</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>PENDING_VERIFICATION</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transactionRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 결과에 따른 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>transaction</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>notificationService</span><span class=p>.</span><span class=na>sendTransactionConfirmation</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>transaction</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>notificationService</span><span class=p>.</span><span class=na>sendTransactionFailure</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransactionResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>getStatus</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>getCompletedAt</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 확인 중 오류 - 수동 검토 필요</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transaction</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>MANUAL_REVIEW_REQUIRED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transaction</span><span class=p>.</span><span class=na>setNotes</span><span class=p>(</span><span class=s>&#34;Verification failed: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transactionRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 수동 검토 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>notificationService</span><span class=p>.</span><span class=na>alertOperator</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;MANUAL_REVIEW_REQUIRED&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;Transaction &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>transactionId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; requires manual review&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransactionResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>transaction</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>MANUAL_REVIEW_REQUIRED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=결과-2>결과<a hidden class=anchor aria-hidden=true href=#결과-2>#</a></h5><ul><li>99.999% 트랜잭션 성공률 달성</li><li>엄격한 규제 요구사항 충족</li><li>거래 분쟁 50% 감소</li><li>신속한 문제 해결을 위한 강력한 감사 추적 구현</li></ul><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>백오프(Backoff)</td><td>네트워크 통신 또는 시스템에서 충돌이나 오류가 발생했을 때, 재시도 간격을 조정하여 문제를 해결하거나 시스템 자원을 효율적으로 사용하는 데 활용되는 기법<br><br>충돌 감지 및 대기:<br>- 두 개 이상의 노드가 동시에 데이터를 전송하려고 할 때 충돌이 발생한다. 백오프는 이러한 충돌을 감지한 후 일정 시간 대기하여 재전송을 시도하는 방식이다.<br>- 대기 시간은 랜덤하게 설정되며, 이를 통해 재충돌 확률을 줄인다.<br>재시도 간격 조정:<br>- 백오프는 재시도 간격을 점진적으로 늘려가며, 네트워크 혼잡이나 서버 과부하를 완화한다.<br>- 이 과정에서 일정한 패턴(예: 지수적 증가)을 따르거나 랜덤 값을 추가하여 효율성을 높인다.</td></tr><tr><td>서지(Surge) 문제</td><td>시스템이나 네트워크에서 <strong>짧은 시간 동안 갑작스럽게 요청이나 트래픽이 급증</strong>하는 현상을 의미한다. 이러한 문제는 클라이언트-서버 환경, 분산 시스템, 네트워크 인프라 등 다양한 기술적 환경에서 발생할 수 있으며, 시스템 성능 저하, 과부하, 또는 장애를 초래할 수 있다.<br>- <strong>서지(Surge) 문제의 주요 원인</strong><br>1. <strong>사용자 요청의 급증</strong>:<br>- 특정 시간대에 대규모 사용자들이 동시에 서비스를 이용하려는 경우(예: 쇼핑몰의 할인 행사, 티켓 예매 시작).<br>2. <strong>시스템 장애로 인한 재시도 요청</strong>:<br>- 클라이언트가 실패한 요청을 반복적으로 재시도하면서 트래픽이 폭발적으로 증가.<br>3. <strong>외부 이벤트</strong>:<br>- 자연재해, 데이터 유출 등 예기치 못한 사건으로 인해 고객 지원 요청이 급증.<br>4. <strong>봇 트래픽 및 DDoS 공격</strong>:<br>- 악의적인 봇이나 분산 서비스 거부 공격으로 인해 비정상적인 트래픽이 발생.<br>- <strong>서지 문제로 인한 영향</strong><br>1. <strong>네트워크 혼잡</strong>:<br>- 트래픽이 폭증하면 네트워크 대역폭이 포화 상태에 도달하여 정상적인 데이터 전송이 지연된다.<br>2. <strong>서버 과부하</strong>:<br>- 서버가 처리할 수 있는 최대 연결 수를 초과하면 응답 시간이 길어지거나 요청이 거부된다.<br>3. <strong>서비스 중단</strong>:<br>- 과도한 부하로 인해 시스템이 다운되거나 사용자가 오류 페이지를 보게 되는 상황 발생.<br>4. <strong>데이터 손실 및 성능 저하</strong>:<br>- 처리되지 않은 요청이 큐에 쌓이며 타임아웃 발생 또는 데이터 손실 가능성 증가.<br>5. <strong>비용 증가</strong>:<br>- 클라우드 환경에서는 급격한 트래픽 처리를 위해 추가적인 자원 할당(오토스케일링)이 필요하여 비용 부담 증가.<br></td></tr><tr><td>Jitter</td><td><strong>재시도 간격에 랜덤성을 추가하는 기법</strong>으로, 네트워크나 시스템의 안정성을 높이고 성능 저하를 방지하기 위해 사용된다.<br>- <strong>Jitter의 필요성</strong><br>1. <strong>동기화된 재시도의 문제(Thundering Herd Problem)</strong>:<br>- 여러 클라이언트가 동일한 실패 조건을 감지하고, 고정된 간격으로 재시도를 시도하면 서버에 과도한 부하가 발생할 수 있다.<br>- 예를 들어, 100개의 클라이언트가 5초 후 동시에 재시도하면 서버는 다시 과부하 상태에 빠질 가능성이 높다.<br>2. <strong>재충돌 방지</strong>:<br>- 백오프 간격이 고정되거나 동일한 알고리즘을 따르는 경우, 클라이언트들이 동일한 시간에 다시 요청을 보내 충돌이 반복될 수 있다.<br>3. <strong>트래픽 스파이크 완화</strong>:<br>- Jitter는 요청 시간을 분산시켜 트래픽이 특정 시간대에 몰리는 것을 방지한다.</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/backend-development/>Backend Development</a></li><li><a href=https://buenhyden.github.io/tags/api-design-and-implementation/>API-Design-and-Implementation</a></li><li><a href=https://buenhyden.github.io/tags/api-performance/>API-Performance</a></li><li><a href=https://buenhyden.github.io/tags/error-handling-and-retries/>Error-Handling-and-Retries</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/software-development--engineering/platform-development/backend-development/api-development/api-operations/monitoring-and-analytics/api-profiling/><span class=title>« Prev</span><br><span>Profiling</span>
</a><a class=next href=https://buenhyden.github.io/posts/software-development--engineering/platform-development/backend-development/api-development/api-implementation/request-response-handling/optimize-api-response/><span class=title>Next »</span><br><span>Optimize API Response</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>