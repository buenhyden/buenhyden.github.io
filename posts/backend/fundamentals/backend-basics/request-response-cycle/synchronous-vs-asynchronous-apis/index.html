<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Synchronous vs Asynchronous APIs | hyunyoun's Blog</title>
<meta name=keywords content="Backend,API-Design,API-Integration-Patterns,Synchronous-vs-Asynchronous-APIs,Synchronous,Asynchronous"><meta name=description content="프로그래밍에서 작업을 처리하는 두 가지 주요 방식"><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/backend/fundamentals/backend-basics/request-response-cycle/synchronous-vs-asynchronous-apis/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/backend/fundamentals/backend-basics/request-response-cycle/synchronous-vs-asynchronous-apis/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/backend/fundamentals/backend-basics/request-response-cycle/synchronous-vs-asynchronous-apis/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Synchronous vs Asynchronous APIs"><meta property="og:description" content="프로그래밍에서 작업을 처리하는 두 가지 주요 방식"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-06T00:57:00+00:00"><meta property="article:modified_time" content="2024-10-06T00:57:00+00:00"><meta property="article:tag" content="Backend"><meta property="article:tag" content="API-Design"><meta property="article:tag" content="API-Integration-Patterns"><meta property="article:tag" content="Synchronous-vs-Asynchronous-APIs"><meta property="article:tag" content="Synchronous"><meta property="article:tag" content="Asynchronous"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Synchronous vs Asynchronous APIs"><meta name=twitter:description content="프로그래밍에서 작업을 처리하는 두 가지 주요 방식"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기술 블로그","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Backend","item":"https://buenhyden.github.io/posts/backend/"},{"@type":"ListItem","position":3,"name":"Fundamentals of Backend","item":"https://buenhyden.github.io/posts/backend/fundamentals/"},{"@type":"ListItem","position":4,"name":"Synchronous vs Asynchronous APIs","item":"https://buenhyden.github.io/posts/backend/fundamentals/backend-basics/request-response-cycle/synchronous-vs-asynchronous-apis/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Synchronous vs Asynchronous APIs","name":"Synchronous vs Asynchronous APIs","description":"프로그래밍에서 작업을 처리하는 두 가지 주요 방식","keywords":["Backend","API-Design","API-Integration-Patterns","Synchronous-vs-Asynchronous-APIs","Synchronous","Asynchronous"],"articleBody":"Synchronous vs. Asynchronous APIs API 설계에서 동기식(Synchronous)과 비동기식(Asynchronous) 패턴 중 어떤 것을 선택할지는 시스템 아키텍처와 사용자 경험에 중대한 영향을 미치는 결정이다. 각 패턴은 고유한 장단점을 가지고 있으며, 특정 사용 사례에 더 적합할 수 있다.\n동기식 API(Synchronous API) 동기식 API는 클라이언트가 요청을 보내고 서버의 응답을 받을 때까지 대기하는 방식으로 작동한다. 이는 요청-응답 주기가 완료될 때까지 클라이언트가 다른 작업을 수행하지 않는 “차단(blocking)” 방식을 의미한다.\n동기식 API의 작동 원리 동기식 API의 기본 흐름은 다음과 같다:\n클라이언트가 API 요청을 전송한다. 클라이언트는 서버의 응답을 기다리며 차단된다. 서버는 요청을 처리하고 결과를 생성한다. 서버가 응답을 클라이언트에게 반환한다. 클라이언트는 응답을 받은 후에야 다음 작업을 진행한다. 이 과정은 HTTP 요청과 같은 표준 웹 통신에서 흔히 볼 수 있다. REST API는 대부분 이러한 동기식 패턴을 따른다.\n동기식 API 구현 예시 다음은 Java Spring Boot를 사용한 동기식 API 엔드포인트의 예시이다:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @RestController @RequestMapping(\"/api/users\") public class UserController { private final UserService userService; @Autowired public UserController(UserService userService) { this.userService = userService; } @GetMapping(\"/{id}\") public ResponseEntity\u003cUser\u003e getUserById(@PathVariable Long id) { // 사용자 조회 (이 작업이 완료될 때까지 클라이언트는 대기) User user = userService.findById(id); if (user != null) { return ResponseEntity.ok(user); } else { return ResponseEntity.notFound().build(); } } } 이 예시에서 클라이언트는 사용자 정보를 요청하고, 서버가 데이터베이스에서 정보를 조회하고 반환할 때까지 대기한다.\n동기식 API의 장점 단순성: 구현과 이해가 쉽다. 코드 흐름이 순차적이기 때문에 디버깅과 추론이 직관적이다. 즉각적인 응답: 요청이 성공했는지 실패했는지 즉시 알 수 있다. 일관성: 데이터의 최신 상태를 반환받을 수 있어 데이터 일관성이 중요한 경우에 적합하다. 트랜잭션 보장: 단일 요청-응답 사이클 내에서 트랜잭션 처리가 용이하다. 오류 처리 단순화: 오류가 발생하면 즉시 클라이언트에게 전달되어 처리할 수 있다. 동기식 API의 단점 자원 차단: 클라이언트는 응답을 기다리는 동안 다른 작업을 수행할 수 없어 자원 활용이 비효율적일 수 있다. 확장성 제한: 대량의 동시 요청 처리 시 서버 자원이 빠르게 소진될 수 있다. 장기 실행 작업에 부적합: 완료하는 데 시간이 오래 걸리는 프로세스의 경우 클라이언트 타임아웃이 발생할 수 있다. 시스템 의존성: 서비스 간 동기식 호출은 한 서비스의 장애가 연쇄적으로 다른 서비스에 영향을 미칠 수 있다. 네트워크 지연 영향: 네트워크 지연이 직접적으로 사용자 경험에 영향을 미친다. 동기식 API의 적합한, 부적합한 사용 사례 적합한 사용 사례:\n즉각적인 응답이 필요한 상호작용 (로그인, 검색) 간단하고 빠른 데이터 조회 및 조작 트랜잭션 일관성이 중요한 작업 (결제 처리) 사용자 인터페이스와 직접 상호작용하는 API 부적합한 사용 사례:\n대용량 파일 업로드 또는 다운로드 시간이 많이 소요되는 계산이나 데이터 처리 여러 외부 서비스에 의존하는 복잡한 워크플로우 높은 처리량이 필요한 서비스 비동기식 API(Asynchronous API) 비동기식 API는 클라이언트가 요청을 보낸 후 서버의 응답을 기다리지 않고 다른 작업을 수행할 수 있는 방식이다. 서버는 요청을 받아 처리하고, 처리가 완료되면 다양한 방법으로 결과를 클라이언트에게 전달한다.\n비동기식 API의 작동 원리 비동기식 API의 일반적인 흐름은 다음과 같다:\n클라이언트가 API 요청을 전송한다. 서버는 요청 접수를 확인하는 응답을 즉시 반환한다 (보통 요청 ID 포함). 클라이언트는 다른 작업을 계속 수행한다. 서버는 백그라운드에서 요청을 처리한다. 처리가 완료되면 다음 중 한 가지 방법으로 결과가 전달된다: 클라이언트가 결과를 폴링(polling)하여 확인 서버가 웹훅(webhook)을 통해 클라이언트에게 알림 웹소켓(WebSocket)이나 서버-전송 이벤트(SSE)를 통한 실시간 알림 비동기식 API 구현 패턴 비동기식 API를 구현하는 주요 패턴은 다음과 같다:\n폴링(Polling) 패턴 클라이언트가 주기적으로 서버에 상태 확인 요청을 보내는 방식.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // 작업 제출 엔드포인트 @PostMapping(\"/api/jobs\") public ResponseEntity\u003cJobResponse\u003e submitJob(@RequestBody JobRequest request) { // 작업을 큐에 추가하고 작업 ID 반환 String jobId = jobService.enqueueJob(request); return ResponseEntity .accepted() .body(new JobResponse(jobId, \"PENDING\")); } // 작업 상태 확인 엔드포인트 (폴링용) @GetMapping(\"/api/jobs/{jobId}\") public ResponseEntity\u003cJobResponse\u003e getJobStatus(@PathVariable String jobId) { Job job = jobService.getJob(jobId); if (job == null) { return ResponseEntity.notFound().build(); } JobResponse response = new JobResponse( job.getId(), job.getStatus().toString() ); // 작업이 완료된 경우 결과 포함 if (job.getStatus() == JobStatus.COMPLETED) { response.setResult(job.getResult()); } return ResponseEntity.ok(response); } 콜백(Callback) / 웹훅(Webhook) 패턴 서버가 처리를 완료한 후 클라이언트가 제공한 URL로 결과를 전송하는 방식.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 @PostMapping(\"/api/reports/generate\") public ResponseEntity\u003cReportResponse\u003e generateReport( @RequestBody ReportRequest request, @RequestParam String callbackUrl) { // 보고서 생성 작업 ID 생성 String reportId = UUID.randomUUID().toString(); // 비동기적으로 보고서 생성 작업 시작 (별도 스레드/작업자) reportService.generateReportAsync(reportId, request, callbackUrl); return ResponseEntity .accepted() .body(new ReportResponse(reportId, \"Report generation started\")); } // 서비스 내부에서 콜백 실행 public void notifyReportCompletion(String reportId, String callbackUrl, Report report) { ReportResult result = new ReportResult(reportId, \"COMPLETED\", report.getUrl()); try { // 콜백 URL로 결과 전송 restTemplate.postForEntity(callbackUrl, result, Void.class); } catch (Exception e) { log.error(\"Failed to send callback for report {}: {}\", reportId, e.getMessage()); // 재시도 로직이나 대체 알림 메커니즘 구현 가능 } } 이벤트 스트리밍 패턴 서버-전송 이벤트(SSE)나 웹소켓(WebSocket)을 사용하여 실시간으로 처리 상태를 전달하는 방식.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 // SSE를 사용한 이벤트 스트리밍 예시 @GetMapping(value = \"/api/jobs/{jobId}/events\", produces = MediaType.TEXT_EVENT_STREAM_VALUE) public SseEmitter streamJobEvents(@PathVariable String jobId) { SseEmitter emitter = new SseEmitter(Long.MAX_VALUE); // 이미터를 작업 ID에 연결 jobEventService.addEmitter(jobId, emitter); // 연결 종료 시 정리 emitter.onCompletion(() -\u003e jobEventService.removeEmitter(jobId, emitter)); emitter.onTimeout(() -\u003e jobEventService.removeEmitter(jobId, emitter)); // 초기 연결 확인 이벤트 전송 try { emitter.send(SseEmitter.event() .name(\"CONNECTED\") .data(Map.of(\"jobId\", jobId, \"message\", \"Connected to job events\")) ); } catch (IOException e) { emitter.completeWithError(e); } return emitter; } // 작업 처리 과정에서 이벤트 전송 public void sendJobEvent(String jobId, String eventType, Object data) { List\u003cSseEmitter\u003e emitters = jobEventService.getEmitters(jobId); if (emitters.isEmpty()) { return; } List\u003cSseEmitter\u003e deadEmitters = new ArrayList\u003c\u003e(); for (SseEmitter emitter : emitters) { try { emitter.send(SseEmitter.event() .name(eventType) .data(data) ); } catch (Exception e) { deadEmitters.add(emitter); } } // 실패한 이미터 제거 deadEmitters.forEach(emitter -\u003e jobEventService.removeEmitter(jobId, emitter)); } 메시지 큐 기반 패턴 메시지 큐(예: RabbitMQ, Kafka)를 사용하여 비동기 작업을 처리하는 방식.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 @PostMapping(\"/api/orders\") public ResponseEntity\u003cOrderResponse\u003e createOrder(@RequestBody OrderRequest request) { // 주문 ID 생성 String orderId = UUID.randomUUID().toString(); // 초기 주문 정보 저장 Order order = orderRepository.save(new Order(orderId, request, OrderStatus.PROCESSING)); // 메시지 큐로 주문 처리 작업 전송 orderMessageProducer.sendOrderProcessingMessage(orderId, request); // 즉시 응답 반환 return ResponseEntity .accepted() .body(new OrderResponse(orderId, OrderStatus.PROCESSING)); } // 메시지 소비자 (별도 서비스/컴포넌트) @Component public class OrderProcessingConsumer { @RabbitListener(queues = \"order-processing-queue\") public void processOrder(OrderProcessingMessage message) { try { // 주문 처리 로직 Order order = orderService.processOrder(message.getOrderId(), message.getOrderRequest()); // 주문 상태 업데이트 orderRepository.updateStatus(order.getId(), OrderStatus.COMPLETED); // 완료 메시지 발행 (알림용) orderCompletionProducer.sendOrderCompletedMessage(order); } catch (Exception e) { log.error(\"Order processing failed for order {}: {}\", message.getOrderId(), e.getMessage()); orderRepository.updateStatus(message.getOrderId(), OrderStatus.FAILED); } } } 비동기식 API의 장점 향상된 응답성: 클라이언트는 작업 완료를 기다릴 필요 없이 다른 작업을 수행할 수 있다. 확장성 개선: 서버는 요청을 큐에 넣고 가용 자원에 따라 처리할 수 있어 부하 관리가 용이하다. 장기 실행 작업 지원: 시간이 많이 걸리는 작업도 타임아웃 걱정 없이 처리할 수 있다. 시스템 복원력: 서비스 간 느슨한 결합으로 한 서비스의 장애가 전체 시스템에 미치는 영향이 제한적이다. 효율적인 자원 활용: 서버와 클라이언트 모두 대기 시간 없이 자원을 효율적으로 활용할 수 있다. 비동기식 API의 단점 복잡성 증가: 구현과 테스트가 더 복잡해진다. 오류 처리, 재시도 로직, 작업 상태 추적 등이 필요하다. 즉각적인 응답 부재: 최종 결과를 얻기까지 지연이 발생할 수 있다. 상태 관리 필요: 작업 상태와 결과를 저장하고 추적하는 추가 인프라가 필요하다. 이벤트 순서 보장의 어려움: 메시지 전달 순서가 처리 순서를 보장하지 않을 수 있다. 디버깅 복잡성: 분산된 비동기 처리로 인해 문제 추적이 어려울 수 있다. 비동기식 API의 적합한, 부적합한 사용 사례 적합한 사용 사례:\n대용량 파일 처리 (업로드/다운로드, 변환) 복잡한 계산이나 분석 작업 이메일 전송, 알림 발송과 같은 백그라운드 작업 외부 서비스 통합이 필요한 복잡한 워크플로우 높은 처리량이 필요한 시스템 부적합한 사용 사례:\n즉각적인 사용자 피드백이 필요한 상호작용 단순하고 빠른 데이터 조회 강력한 트랜잭션 일관성이 필요한 작업 실시간 응답이 중요한 사용자 인터페이스 요소 혼합 접근법: 동기식과 비동기식 API의 결합 많은 현대적인 애플리케이션은 동기식과 비동기식 API를 모두 활용하는 혼합 접근법을 채택한다. 이는 각 패턴의 장점을 최대화하고 단점을 최소화하는 데 도움이 된다.\n혼합 접근법 구현 전략 비동기 작업 시작을 위한 동기식 API 작업 제출은 동기식으로 처리하되, 실제 처리는 비동기식으로 진행하는 방식이다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 @PostMapping(\"/api/documents/convert\") public ResponseEntity\u003cConversionResponse\u003e convertDocument( @RequestParam(\"file\") MultipartFile file, @RequestParam(\"targetFormat\") String targetFormat) { // 파일 저장 및 작업 메타데이터 생성 (동기식) String documentId = documentService.saveDocument(file); String conversionId = conversionService.createConversionJob(documentId, targetFormat); // 비동기 변환 작업 시작 conversionService.startAsyncConversion(conversionId); // 작업 상태 확인 URL 및 작업 ID 반환 (동기식 응답) return ResponseEntity .accepted() .body(new ConversionResponse( conversionId, \"/api/documents/conversions/\" + conversionId, \"PROCESSING\" )); } 장기 폴링(Long Polling) 접근법 클라이언트의 요청을 일정 시간 동안 유지하다가 결과가 준비되면 즉시 반환하거나, 타임아웃에 도달하면 현재 상태를 반환하는 방식.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 @GetMapping(\"/api/jobs/{jobId}/longpoll\") public ResponseEntity\u003cJobResult\u003e longPollJobResult( @PathVariable String jobId, @RequestParam(defaultValue = \"30\") int timeoutSeconds) { // 현재 작업 상태 확인 JobStatus currentStatus = jobService.getJobStatus(jobId); // 이미 완료된 경우 즉시 결과 반환 if (currentStatus == JobStatus.COMPLETED || currentStatus == JobStatus.FAILED) { return ResponseEntity.ok(jobService.getJobResult(jobId)); } // 결과를 기다리는 CountDownLatch 생성 CountDownLatch latch = new CountDownLatch(1); JobResultListener listener = new JobResultListener(jobId, latch); // 리스너 등록 jobService.addJobListener(jobId, listener); try { // 결과를 기다리거나 타임아웃까지 대기 boolean completed = latch.await(timeoutSeconds, TimeUnit.SECONDS); // 리스너 제거 jobService.removeJobListener(jobId, listener); if (completed) { // 완료된 경우 결과 반환 return ResponseEntity.ok(jobService.getJobResult(jobId)); } else { // 타임아웃된 경우 현재 상태 반환 return ResponseEntity.ok(new JobResult(jobId, jobService.getJobStatus(jobId), null)); } } catch (InterruptedException e) { Thread.currentThread().interrupt(); jobService.removeJobListener(jobId, listener); return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build(); } } 복합 API 패턴 동일한 리소스에 대해 동기식과 비동기식 엔드포인트를 모두 제공하는 방식이다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // 동기식 처리 (간단한 요청용) @PostMapping(\"/api/payments/sync\") public ResponseEntity\u003cPaymentResult\u003e processPaymentSync(@RequestBody PaymentRequest request) { // 동기적으로 결제 처리 (타임아웃 제한 있음) PaymentResult result = paymentService.processPaymentSync(request); return ResponseEntity.ok(result); } // 비동기식 처리 (복잡한 처리용) @PostMapping(\"/api/payments/async\") public ResponseEntity\u003cPaymentResponse\u003e processPaymentAsync( @RequestBody PaymentRequest request, @RequestParam(required = false) String callbackUrl) { // 결제 작업 생성 String paymentId = paymentService.initiatePayment(request); // 비동기 처리 시작 paymentService.processPaymentAsync(paymentId, callbackUrl); // 즉시 응답 return ResponseEntity .accepted() .body(new PaymentResponse( paymentId, \"PROCESSING\", \"/api/payments/\" + paymentId )); } 혼합 접근법의 장점 유연성: 작업의 특성에 따라 가장 적합한 패턴을 선택할 수 있다. 점진적 도입: 기존 동기식 API를 유지하면서 필요한 부분만 비동기식으로 변환할 수 있다. 사용자 경험 최적화: 즉각적인 피드백과 장기 실행 작업의 효율적인 처리를 모두 제공할 수 있다. 리소스 최적화: 작업의 복잡성에 따라 서버 리소스를 효율적으로 활용할 수 있다. API 패턴 선택 가이드라인 적절한 API 패턴을 선택하기 위한 주요 고려사항:\n동기식 API를 선택해야 하는 경우\n응답 시간이 짧은 경우: 요청을 빠르게 처리할 수 있는 경우 (일반적으로 1초 미만) 즉각적인 응답이 필수적인 경우: 사용자가 즉시 결과를 보고 다음 작업을 결정해야 하는 경우 강력한 일관성이 필요한 경우: 데이터 읽기/쓰기 후 즉시 확인이 필요한 경우 단순한 요청-응답 흐름: 복잡한 워크플로우가 없는 간단한 CRUD 작업 비동기식 API를 선택해야 하는 경우\n장시간 실행 작업: 처리하는 데 수 초 이상 걸리는 작업 대용량 데이터 처리: 대규모 파일 업로드/다운로드나 데이터 처리 외부 시스템 의존성: 여러 외부 서비스와의 통합이 필요한 경우 부하 분산이 중요한 경우: 대량의 요청을 효율적으로 처리해야 하는 경우 클라이언트 연결 제한: 모바일 장치와 같이 연결 유지가 비용이 많이 드는 환경 결정 프레임워크\nAPI 패턴 선택을 위한 단계별 접근법:\n작업 특성 분석: 예상 처리 시간은 얼마인가? 작업의 복잡성은 어느 정도인가? 외부 시스템 의존성이 있는가? 사용자 경험 요구사항 고려: 사용자가 즉각적인 응답을 기대하는가? 진행 상황 알림이 필요한가? 클라이언트의 특성은 어떠한가? (모바일, 웹, 서버-서버 등) 시스템 부하 및 확장성 요구사항 평가: 예상되는 동시 요청 수는 얼마인가? 시스템의 확장 전략은 무엇인가? 자원 제약 사항이 있는가? 오류 처리 및 복원력 요구사항 분석: 오류 발생 시 어떻게 처리해야 하는가? 재시도 메커니즘이 필요한가? 부분 실패는 어떻게 처리해야 하는가? 실제 구현 사례 및 모범 사례 동기식 API 모범 사례 적절한 타임아웃 설정: 클라이언트와 서버 모두에서 적절한 타임아웃을 설정하여 무한 대기를 방지한다. 명확한 오류 처리: 오류가 발생했을 때 클라이언트가 이해하고 대응할 수 있도록 명확한 오류 메시지와 상태 코드를 반환한다. 페이지네이션 적용: 대량의 데이터를 반환할 때는 페이지네이션을 사용하여 응답 시간을 최적화한다. 캐싱 활용: 자주 요청되는 데이터는 캐싱하여 응답 시간을 개선한다. 백그라운드 처리로 전환: 처리 시간이 예상보다 길어질 수 있는 작업은 비동기 처리를 고려한다. 비동기식 API 모범 사례 고유 작업 ID: 각 비동기 작업에 고유 ID를 할당하고 상태 추적에 활용한다. 명확한 상태 모델: 작업의 가능한 상태(대기 중, 처리 중, 완료, 실패 등)를 명확히 정의한다. 적절한 통지 메커니즘: 사용 사례에 맞는 통지 메커니즘(폴링, 웹훅, SSE 등)을 선택한다. 재시도 및 실패 처리: 작업 실패 시 자동 재시도 메커니즘과 최대 재시도 횟수를 구현한다. 멱등성 보장: 동일 작업의 중복 제출이나 재시도 시 일관된 결과를 보장한다. 작업 만료 정책: 오래된 작업과 결과에 대한 명확한 만료 정책을 수립하여 리소스를 효율적으로 관리한다. 예를 들어, 완료된 작업의 결과는 24시간 후 자동 삭제하는 등의 정책을 적용할 수 있다. 진행률 보고: 장시간 실행되는 작업의 경우 진행 상황을 보고하는 메커니즘을 구현하여 사용자 경험을 개선한다. 이는 전체 진행률 백분율이나 단계별 상태 업데이트 형태로 제공될 수 있다. 작업 이력 관리: 과거 작업의 기록을 유지하여 감사(audit) 및 문제 해결에 활용한다. 이는 작업 시작 시간, 완료 시간, 상태 변화, 오류 정보 등을 포함할 수 있다. 작업 취소 메커니즘: 진행 중인 작업을 취소할 수 있는 API를 제공하여 불필요한 리소스 소비를 방지한다. 상태 기반 설계: API 응답은 항상 작업의 현재 상태를 명확하게 반영해야 한다. 이를 통해 클라이언트는 올바른 결정을 내릴 수 있다. 실제 구현 사례 AWS S3 멀티파트 업로드 (비동기식 API 사례) AWS S3 멀티파트 업로드는 대용량 파일을 효율적으로 업로드하기 위한 비동기식 API의 좋은 예이다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 // JavaScript를 사용한 AWS S3 멀티파트 업로드 예제 async function initiateMultipartUpload(s3Client, bucket, key) { const command = new CreateMultipartUploadCommand({ Bucket: bucket, Key: key, }); // 업로드 초기화 (동기식 부분) const { UploadId } = await s3Client.send(command); console.log(`Multipart upload initiated with UploadId: ${UploadId}`); return UploadId; } async function uploadPart(s3Client, bucket, key, uploadId, partNumber, body) { const command = new UploadPartCommand({ Bucket: bucket, Key: key, UploadId: uploadId, PartNumber: partNumber, Body: body, }); // 파트 업로드 (각 파트는 비동기식으로 처리) const { ETag } = await s3Client.send(command); console.log(`Part ${partNumber} uploaded, ETag: ${ETag}`); return { PartNumber: partNumber, ETag }; } async function completeMultipartUpload(s3Client, bucket, key, uploadId, parts) { const command = new CompleteMultipartUploadCommand({ Bucket: bucket, Key: key, UploadId: uploadId, MultipartUpload: { Parts: parts }, }); // 업로드 완료 (동기식 부분) const result = await s3Client.send(command); console.log(`Upload completed, Location: ${result.Location}`); return result; } // 대용량 파일을 청크로 나누어 병렬 업로드 async function uploadLargeFile(s3Client, bucket, key, fileStream, chunkSize) { // 1. 멀티파트 업로드 초기화 const uploadId = await initiateMultipartUpload(s3Client, bucket, key); // 2. 파일을 청크로 분할하고 각 부분 비동기적으로 업로드 const partPromises = []; let partNumber = 1; // 파일 청크 처리 로직 (스트림 처리) for await (const chunk of createChunkStream(fileStream, chunkSize)) { partPromises.push( uploadPart(s3Client, bucket, key, uploadId, partNumber++, chunk) ); } // 모든 파트 업로드 완료 대기 const uploadedParts = await Promise.all(partPromises); // 3. 멀티파트 업로드 완료 return completeMultipartUpload(s3Client, bucket, key, uploadId, uploadedParts); } 이 사례에서 주목할 점:\n초기화와 완료는 동기식으로 처리 파일 청크 업로드는 비동기식으로 병렬 처리 고유 UploadId로 전체 프로세스 추적 부분 업로드에 대한 명확한 상태 추적 결제 처리 API (혼합 접근법 사례) 결제 처리는 즉각적인 응답과 복잡한 백엔드 처리가 모두 필요한 영역으로, 동기식과 비동기식 접근법의 결합이 적합하다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 @RestController @RequestMapping(\"/api/v1/payments\") public class PaymentController { private final PaymentService paymentService; private final PaymentRepository paymentRepository; private final WebhookService webhookService; // 결제 인증 및 초기화 (동기식) @PostMapping(\"/authorize\") public ResponseEntity\u003cPaymentAuthorizationResponse\u003e authorizePayment( @RequestBody PaymentAuthorizationRequest request) { // 기본 유효성 검사 및 결제 인증 (빠르게 처리되어야 함) PaymentAuthorization auth = paymentService.authorizePayment(request); return ResponseEntity.ok(new PaymentAuthorizationResponse( auth.getAuthorizationId(), auth.getStatus(), auth.getRedirectUrl() // 3D Secure 등에 필요할 경우 )); } // 결제 처리 (비동기식) @PostMapping(\"/process\") public ResponseEntity\u003cPaymentResponse\u003e processPayment( @RequestBody PaymentProcessRequest request, @RequestParam(required = false) String webhookUrl) { // 결제 검증 (동기식) if (!paymentService.validatePaymentRequest(request)) { return ResponseEntity.badRequest().body( new PaymentResponse(null, \"INVALID\", \"Invalid payment request\") ); } // 결제 ID 생성 및 초기 상태 저장 String paymentId = UUID.randomUUID().toString(); Payment payment = new Payment( paymentId, request.getAuthorizationId(), request.getAmount(), request.getCurrency(), PaymentStatus.PROCESSING, webhookUrl ); paymentRepository.save(payment); // 비동기 결제 처리 시작 paymentService.processPaymentAsync(paymentId); // 즉시 응답 return ResponseEntity .accepted() .body(new PaymentResponse( paymentId, \"PROCESSING\", \"Payment is being processed\" )); } // 결제 상태 조회 (동기식) @GetMapping(\"/{paymentId}\") public ResponseEntity\u003cPaymentStatusResponse\u003e getPaymentStatus( @PathVariable String paymentId) { Payment payment = paymentRepository.findById(paymentId) .orElseThrow(() -\u003e new ResourceNotFoundException(\"Payment not found\")); return ResponseEntity.ok(new PaymentStatusResponse( payment.getId(), payment.getStatus().toString(), payment.getStatusMessage(), payment.getCompletedAt(), payment.getTransactionReference() )); } } @Service public class PaymentService { private final PaymentRepository paymentRepository; private final PaymentGateway paymentGateway; private final WebhookService webhookService; private final TaskExecutor taskExecutor; // 비동기 결제 처리 public void processPaymentAsync(String paymentId) { taskExecutor.execute(() -\u003e { try { Payment payment = paymentRepository.findById(paymentId).orElse(null); if (payment == null) return; // 결제 게이트웨이 호출 PaymentResult result = paymentGateway.processPayment( payment.getAuthorizationId(), payment.getAmount(), payment.getCurrency() ); // 결과 저장 payment.setStatus(result.isSuccessful() ? PaymentStatus.COMPLETED : PaymentStatus.FAILED); payment.setStatusMessage(result.getMessage()); payment.setTransactionReference(result.getTransactionId()); payment.setCompletedAt(LocalDateTime.now()); paymentRepository.save(payment); // 웹훅 알림 전송 (있는 경우) if (payment.getWebhookUrl() != null) { webhookService.sendPaymentWebhook(payment); } } catch (Exception e) { // 오류 처리 및 저장 Payment payment = paymentRepository.findById(paymentId).orElse(null); if (payment != null) { payment.setStatus(PaymentStatus.ERROR); payment.setStatusMessage(\"Processing error: \" + e.getMessage()); paymentRepository.save(payment); } // 로깅 log.error(\"Payment processing failed: {}\", e.getMessage(), e); } }); } // 다른 메서드들… } 이 사례에서 주목할 점:\n결제 인증은 즉각적인 응답이 필요하므로 동기식으로 처리 실제 결제 처리는 시간이 걸릴 수 있으므로 비동기식으로 처리 결제 상태 조회는 동기식 API로 제공 웹훅을 통한 결제 완료 알림 제공 고급 패턴 및 기술 반응형 프로그래밍(Reactive Programming) 반응형 프로그래밍은 비동기 데이터 스트림을 기반으로 하는 프로그래밍 패러다임으로, 비동기 API 구현에 강력한 접근 방식을 제공한다.\n주요 특징:\n비차단(Non-blocking) I/O 사용 데이터 스트림 기반 처리 백프레셔(Backpressure) 지원으로 부하 관리 선언적인 데이터 흐름 처리 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // Spring WebFlux를 사용한 반응형 API 예시 @RestController @RequestMapping(\"/api/v1/products\") public class ProductController { private final ProductRepository productRepository; @GetMapping public Flux\u003cProduct\u003e getAllProducts() { return productRepository.findAll(); } @GetMapping(\"/{id}\") public Mono\u003cResponseEntity\u003cProduct\u003e\u003e getProductById(@PathVariable String id) { return productRepository.findById(id) .map(product -\u003e ResponseEntity.ok(product)) .defaultIfEmpty(ResponseEntity.notFound().build()); } @PostMapping public Mono\u003cResponseEntity\u003cProduct\u003e\u003e createProduct(@RequestBody Mono\u003cProduct\u003e productMono) { return productMono .flatMap(productRepository::save) .map(savedProduct -\u003e ResponseEntity .created(URI.create(\"/api/v1/products/\" + savedProduct.getId())) .body(savedProduct) ); } @GetMapping(value = \"/stream\", produces = MediaType.TEXT_EVENT_STREAM_VALUE) public Flux\u003cProductEvent\u003e streamProductEvents() { return Flux.interval(Duration.ofSeconds(1)) .map(sequence -\u003e new ProductEvent(sequence, \"Product Event\")); } } GraphQL을 활용한 유연한 API 설계 GraphQL은 클라이언트가 필요한 데이터를 정확히 지정할 수 있게 해주는 쿼리 언어로, 동기식과 비동기식 처리를 모두 지원한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // GraphQL 스키마 정의 예시 type Query { product(id: ID!): Product products(category: String, limit: Int): [Product] } type Mutation { createProduct(input: ProductInput!): Product updateProduct(id: ID!, input: ProductInput!): Product deleteProduct(id: ID!): Boolean } type Subscription { productUpdated: Product newProductInCategory(category: String!): Product } type Product { id: ID! name: String! description: String price: Float! category: String inStock: Boolean } input ProductInput { name: String! description: String price: Float! category: String } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // Spring GraphQL을 사용한 리졸버 구현 예시 @Component public class ProductResolver { private final ProductService productService; private final ReactiveStreamsPublisher\u003cProduct\u003e productPublisher; // 쿼리 리졸버 (동기식) @QueryMapping public Product product(@Argument String id) { return productService.getProductById(id); } @QueryMapping public List\u003cProduct\u003e products( @Argument String category, @Argument Integer limit) { return productService.findProducts(category, limit); } // 뮤테이션 리졸버 (비동기식으로도 구현 가능) @MutationMapping public Mono\u003cProduct\u003e createProduct(@Argument ProductInput input) { return productService.createProductAsync(input); } // 구독 리졸버 (비동기식) @SubscriptionMapping public Publisher\u003cProduct\u003e productUpdated() { return productPublisher; } @SubscriptionMapping public Publisher\u003cProduct\u003e newProductInCategory(@Argument String category) { return productPublisher .filter(product -\u003e category.equals(product.getCategory())); } } 서버리스 아키텍처와 API 통합 서버리스 아키텍처는 비동기 API 패턴과 자연스럽게 어울리며, 확장성과 비용 효율성을 제공한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 // AWS Lambda와 API Gateway를 사용한 서버리스 비동기 API 예시 // Lambda 함수 (API 엔드포인트) exports.initiateProcessing = async (event) =\u003e { const requestBody = JSON.parse(event.body); const jobId = uuidv4(); // DynamoDB에 작업 메타데이터 저장 await dynamoDb.put({ TableName: 'Jobs', Item: { jobId, status: 'PROCESSING', input: requestBody, createdAt: new Date().toISOString() } }).promise(); // SQS에 처리 작업 메시지 전송 await sqs.sendMessage({ QueueUrl: process.env.PROCESSING_QUEUE_URL, MessageBody: JSON.stringify({ jobId, payload: requestBody }) }).promise(); // 즉시 응답 return { statusCode: 202, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ jobId, status: 'PROCESSING', statusUrl: `/jobs/${jobId}` }) }; }; // 작업 처리 Lambda 함수 (SQS 트리거) exports.processJob = async (event) =\u003e { for (const record of event.Records) { const { jobId, payload } = JSON.parse(record.body); try { // 실제 처리 로직 const result = await processData(payload); // 처리 결과 저장 await dynamoDb.update({ TableName: 'Jobs', Key: { jobId }, UpdateExpression: 'SET #status = :status, result = :result, completedAt = :completedAt', ExpressionAttributeNames: { '#status': 'status' }, ExpressionAttributeValues: { ':status': 'COMPLETED', ':result': result, ':completedAt': new Date().toISOString() } }).promise(); // 선택적: SNS 토픽으로 완료 알림 전송 await sns.publish({ TopicArn: process.env.JOB_COMPLETION_TOPIC, Message: JSON.stringify({ jobId, status: 'COMPLETED', completedAt: new Date().toISOString() }) }).promise(); } catch (error) { // 오류 처리 및 저장 await dynamoDb.update({ TableName: 'Jobs', Key: { jobId }, UpdateExpression: 'SET #status = :status, errorMessage = :error, updatedAt = :updatedAt', ExpressionAttributeNames: { '#status': 'status' }, ExpressionAttributeValues: { ':status': 'FAILED', ':error': error.message, ':updatedAt': new Date().toISOString() } }).promise(); } } }; // 작업 상태 확인 Lambda 함수 exports.getJobStatus = async (event) =\u003e { const jobId = event.pathParameters.jobId; const result = await dynamoDb.get({ TableName: 'Jobs', Key: { jobId } }).promise(); if (!result.Item) { return { statusCode: 404, body: JSON.stringify({ error: 'Job not found' }) }; } return { statusCode: 200, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(result.Item) }; }; 이벤트 기반 아키텍처(Event-Driven Architecture) 이벤트 기반 아키텍처는 비동기 API 패턴의 자연스러운 확장으로, 시스템 구성 요소 간의 느슨한 결합을 촉진한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 // Spring Cloud Stream을 사용한 이벤트 기반 마이크로서비스 예시 @RestController @RequestMapping(\"/api/v1/orders\") public class OrderController { private final OrderService orderService; private final StreamBridge streamBridge; @PostMapping public ResponseEntity\u003cOrderResponse\u003e createOrder(@RequestBody OrderRequest request) { // 주문 생성 Order order = orderService.createOrder(request); // 주문 생성 이벤트 발행 OrderCreatedEvent event = new OrderCreatedEvent( order.getId(), order.getCustomerId(), order.getItems(), order.getTotalAmount(), LocalDateTime.now() ); streamBridge.send(\"orderCreatedChannel\", event); // 응답 반환 return ResponseEntity .created(URI.create(\"/api/v1/orders/\" + order.getId())) .body(new OrderResponse(order.getId(), \"CREATED\")); } } // 이벤트 소비자 서비스 @Configuration public class OrderEventConsumer { private final InventoryService inventoryService; @Bean public Consumer\u003cOrderCreatedEvent\u003e processOrderCreated() { return event -\u003e { log.info(\"Received order created event: {}\", event.getOrderId()); // 재고 확인 및 할당 try { inventoryService.allocateInventory(event.getOrderId(), event.getItems()); log.info(\"Inventory allocated for order: {}\", event.getOrderId()); } catch (Exception e) { log.error(\"Failed to allocate inventory for order {}: {}\", event.getOrderId(), e.getMessage()); // 보상 트랜잭션 또는 오류 처리 로직 } }; } } 성능 최적화 및 모니터링 API 패턴 선택과 더불어 성능 최적화와 모니터링은 효과적인 API 구현을 위해 중요하다.\n성능 최적화 전략 커넥션 풀링: 데이터베이스 및 서비스 간 연결 풀을 효율적으로 관리한다. 비동기 I/O: 네트워크 및 디스크 I/O 작업에 비동기 패턴을 적용하여 자원 활용도를 높인다. 캐싱 전략: 적절한 캐싱을 통해 반복적인 계산이나 요청을 줄인다. 배치 처리: 여러 요청을 그룹화하여 처리함으로써 오버헤드를 줄인다. 적절한 타임아웃 설정: 리소스가 불필요하게 점유되는 것을 방지한다. API 모니터링 및 관측성 핵심 지표 추적: 응답 시간 (평균, 95번째 백분위수, 99번째 백분위수) 요청 처리량(throughput) 오류율 활성 요청 수 자원 활용률 (CPU, 메모리, 네트워크) 분산 추적: 마이크로서비스 환경에서 요청 흐름을 추적하여 병목 현상 식별 로깅 전략: 구조화된 로깅으로 문제 해결 및 분석 용이 알림 설정: 성능 문제나 오류 발생 시 신속하게 대응할 수 있도록 알림 설정 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 // Micrometer를 사용한 API 성능 지표 측정 예시 @Component public class ApiMetrics { private final MeterRegistry meterRegistry; public ApiMetrics(MeterRegistry meterRegistry) { this.meterRegistry = meterRegistry; } @Around(\"@annotation(org.springframework.web.bind.annotation.RequestMapping) || \" + \"@annotation(org.springframework.web.bind.annotation.GetMapping) || \" + \"@annotation(org.springframework.web.bind.annotation.PostMapping) || \" + \"@annotation(org.springframework.web.bind.annotation.PutMapping) || \" + \"@annotation(org.springframework.web.bind.annotation.DeleteMapping)\") public Object measureApiPerformance(ProceedingJoinPoint joinPoint) throws Throwable { String methodName = joinPoint.getSignature().getName(); String className = joinPoint.getSignature().getDeclaringTypeName(); String endpointTag = className + \".\" + methodName; Timer.Sample sample = Timer.start(meterRegistry); boolean success = false; try { Object result = joinPoint.proceed(); success = true; return result; } finally { Timer timer = Timer.builder(\"api.request.duration\") .tag(\"endpoint\", endpointTag) .tag(\"success\", String.valueOf(success)) .publishPercentiles(0.5, 0.95, 0.99) .register(meterRegistry); sample.stop(timer); Counter.builder(\"api.request.count\") .tag(\"endpoint\", endpointTag) .tag(\"success\", String.valueOf(success)) .register(meterRegistry) .increment(); } } } Synchronous vs. Asynchronous APIs 비교 동기식 API는 단순성과 즉각적인 응답이 중요한 경우에 적합하지만, 긴 처리 시간과 높은 부하에 취약할 수 있다. 비동기식 API는 장시간 실행 작업과 높은 처리량을 위해 설계되었지만, 구현과 테스트가 더 복잡할 수 있다. 혼합 접근법은 많은 실제 애플리케이션에서 가장 효과적인 솔루션을 제공하며, 각 작업의 특성에 따라 적절한 패턴을 적용할 수 있다. 적절한 API 패턴 선택은 작업 특성, 사용자 경험 요구사항, 시스템 부하 및 확장성 요구사항을 고려해야 한다. 성능 최적화와 지속적인 모니터링은 어떤 패턴을 선택하든 필수적이다. 카테고리 동기(Synchronous) 비동기(Asynchronous) 기본 개념 - 작업이 순차적으로 실행됨 - 작업이 독립적으로 실행됨 - 이전 작업이 완료될 때까지 다음 작업 대기 - 작업의 완료를 기다리지 않고 다음 작업 진행 - 실행 순서가 보장됨 - 실행 순서가 보장되지 않음 처리 방식 - 단일 스레드에서 순차적 처리 - 멀티 스레드 또는 이벤트 루프 기반 처리 - 작업 완료까지 대기 - 작업 완료 시 콜백/Promise/async-await 등으로 처리 - 직관적인 코드 흐름 - 비선형적 코드 흐름 장점 - 코드의 가독성이 좋음 - 시스템 자원의 효율적 사용 - 디버깅이 용이함 - 더 나은 사용자 경험 제공 - 에러 처리가 간단함 - 높은 처리량(Throughput) 단점 - 시스템 자원 비효율적 사용 - 코드의 복잡성 증가 - 응답 시간이 길어질 수 있음 - 디버깅이 어려움 - 사용자 경험 저하 가능성 - 에러 처리가 복잡함 적합한 사용 사례 - 간단한 계산 작업 - 네트워크 요청 - 메모리 내 데이터 처리 - 파일 입출력 - 작은 크기의 데이터 처리 - 대용량 데이터 처리 - 순차적 처리가 필요한 작업 - 독립적으로 실행 가능한 작업 에러 처리 - try-catch 블록으로 직접 처리 - Promise의 catch 또는 try-catch와 async-await 사용 - 즉시 에러 감지 및 처리 - 에러 처리가 비동기적으로 발생 - 스택 트레이스 추적이 용이 - 에러 발생 지점 추적이 복잡할 수 있음 성능 특성 - CPU 집약적 작업에 유리 - I/O 집약적 작업에 유리 - 메모리 사용량이 예측 가능 - 동시 처리로 인한 메모리 사용량 변동 - 단일 작업 처리 시간이 빠름 - 전체 처리량 최적화에 유리 코드 관리 - 코드 구조가 단순함 - 상태 관리가 필요함 - 유지보수가 상대적으로 쉬움 - 비동기 패턴에 대한 이해 필요 - 테스트 작성이 용이함 - 테스트 시나리오가 복잡할 수 있음 리소스 활용 - 단일 리소스 점유 - 리소스의 효율적 분배 - 대기 시간 동안 블로킹 - 대기 시간 동안 다른 작업 수행 - 시스템 부하가 예측 가능 - 동시성으로 인한 부하 변동 가능 참고 및 출처 ","wordCount":"4729","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-10-06T00:57:00Z","dateModified":"2024-10-06T00:57:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/backend/fundamentals/backend-basics/request-response-cycle/synchronous-vs-asynchronous-apis/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>기술 블로그</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend/>Backend</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend/fundamentals/>Fundamentals of Backend</a></div><h1 class="post-title entry-hint-parent">Synchronous vs Asynchronous APIs</h1><div class=post-description>프로그래밍에서 작업을 처리하는 두 가지 주요 방식</div><div class=post-meta><span title='2024-10-06 00:57:00 +0000 UTC'>October 6, 2024</span>&nbsp;·&nbsp;23 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/Backend/Fundamentals/Backend%20Basics/Request%20Response%20Cycle/Synchronous-vs-Asynchronous-APIs.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#synchronous-vs-asynchronous-apis>Synchronous vs. Asynchronous APIs</a><ul><li><a href=#동기식-apisynchronous-api>동기식 API(Synchronous API)</a></li><li><a href=#비동기식-apiasynchronous-api>비동기식 API(Asynchronous API)</a></li><li><a href=#혼합-접근법-동기식과-비동기식-api의-결합>혼합 접근법: 동기식과 비동기식 API의 결합</a></li><li><a href=#api-패턴-선택-가이드라인>API 패턴 선택 가이드라인</a></li><li><a href=#실제-구현-사례-및-모범-사례>실제 구현 사례 및 모범 사례</a></li><li><a href=#고급-패턴-및-기술>고급 패턴 및 기술</a></li><li><a href=#성능-최적화-및-모니터링>성능 최적화 및 모니터링</a></li><li><a href=#synchronous-vs-asynchronous-apis-비교>Synchronous vs. Asynchronous APIs 비교</a></li></ul></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=synchronous-vs-asynchronous-apis>Synchronous vs. Asynchronous APIs<a hidden class=anchor aria-hidden=true href=#synchronous-vs-asynchronous-apis>#</a></h2><p>API 설계에서 동기식(Synchronous)과 비동기식(Asynchronous) 패턴 중 어떤 것을 선택할지는 시스템 아키텍처와 사용자 경험에 중대한 영향을 미치는 결정이다. 각 패턴은 고유한 장단점을 가지고 있으며, 특정 사용 사례에 더 적합할 수 있다.</p><h3 id=동기식-apisynchronous-api>동기식 API(Synchronous API)<a hidden class=anchor aria-hidden=true href=#동기식-apisynchronous-api>#</a></h3><p>동기식 API는 클라이언트가 요청을 보내고 서버의 응답을 받을 때까지 대기하는 방식으로 작동한다. 이는 요청-응답 주기가 완료될 때까지 클라이언트가 다른 작업을 수행하지 않는 &ldquo;차단(blocking)&rdquo; 방식을 의미한다.</p><h4 id=동기식-api의-작동-원리>동기식 API의 작동 원리<a hidden class=anchor aria-hidden=true href=#동기식-api의-작동-원리>#</a></h4><p>동기식 API의 기본 흐름은 다음과 같다:</p><ol><li>클라이언트가 API 요청을 전송한다.</li><li>클라이언트는 서버의 응답을 기다리며 차단된다.</li><li>서버는 요청을 처리하고 결과를 생성한다.</li><li>서버가 응답을 클라이언트에게 반환한다.</li><li>클라이언트는 응답을 받은 후에야 다음 작업을 진행한다.</li></ol><p>이 과정은 HTTP 요청과 같은 표준 웹 통신에서 흔히 볼 수 있다. REST API는 대부분 이러한 동기식 패턴을 따른다.</p><h4 id=동기식-api-구현-예시>동기식 API 구현 예시<a hidden class=anchor aria-hidden=true href=#동기식-api-구현-예시>#</a></h4><p>다음은 Java Spring Boot를 사용한 동기식 API 엔드포인트의 예시이다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/users&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>UserController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>UserService</span><span class=w> </span><span class=n>userService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>UserController</span><span class=p>(</span><span class=n>UserService</span><span class=w> </span><span class=n>userService</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>userService</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getUserById</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 사용자 조회 (이 작업이 완료될 때까지 클라이언트는 대기)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userService</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>user</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>이 예시에서 클라이언트는 사용자 정보를 요청하고, 서버가 데이터베이스에서 정보를 조회하고 반환할 때까지 대기한다.</p><h4 id=동기식-api의-장점>동기식 API의 장점<a hidden class=anchor aria-hidden=true href=#동기식-api의-장점>#</a></h4><ol><li><strong>단순성</strong>: 구현과 이해가 쉽다. 코드 흐름이 순차적이기 때문에 디버깅과 추론이 직관적이다.</li><li><strong>즉각적인 응답</strong>: 요청이 성공했는지 실패했는지 즉시 알 수 있다.</li><li><strong>일관성</strong>: 데이터의 최신 상태를 반환받을 수 있어 데이터 일관성이 중요한 경우에 적합하다.</li><li><strong>트랜잭션 보장</strong>: 단일 요청-응답 사이클 내에서 트랜잭션 처리가 용이하다.</li><li><strong>오류 처리 단순화</strong>: 오류가 발생하면 즉시 클라이언트에게 전달되어 처리할 수 있다.</li></ol><h4 id=동기식-api의-단점>동기식 API의 단점<a hidden class=anchor aria-hidden=true href=#동기식-api의-단점>#</a></h4><ol><li><strong>자원 차단</strong>: 클라이언트는 응답을 기다리는 동안 다른 작업을 수행할 수 없어 자원 활용이 비효율적일 수 있다.</li><li><strong>확장성 제한</strong>: 대량의 동시 요청 처리 시 서버 자원이 빠르게 소진될 수 있다.</li><li><strong>장기 실행 작업에 부적합</strong>: 완료하는 데 시간이 오래 걸리는 프로세스의 경우 클라이언트 타임아웃이 발생할 수 있다.</li><li><strong>시스템 의존성</strong>: 서비스 간 동기식 호출은 한 서비스의 장애가 연쇄적으로 다른 서비스에 영향을 미칠 수 있다.</li><li><strong>네트워크 지연 영향</strong>: 네트워크 지연이 직접적으로 사용자 경험에 영향을 미친다.</li></ol><h4 id=동기식-api의-적합한-부적합한-사용-사례>동기식 API의 적합한, 부적합한 사용 사례<a hidden class=anchor aria-hidden=true href=#동기식-api의-적합한-부적합한-사용-사례>#</a></h4><p><strong>적합한 사용 사례</strong>:</p><ul><li>즉각적인 응답이 필요한 상호작용 (로그인, 검색)</li><li>간단하고 빠른 데이터 조회 및 조작</li><li>트랜잭션 일관성이 중요한 작업 (결제 처리)</li><li>사용자 인터페이스와 직접 상호작용하는 API</li></ul><p><strong>부적합한 사용 사례</strong>:</p><ul><li>대용량 파일 업로드 또는 다운로드</li><li>시간이 많이 소요되는 계산이나 데이터 처리</li><li>여러 외부 서비스에 의존하는 복잡한 워크플로우</li><li>높은 처리량이 필요한 서비스</li></ul><h3 id=비동기식-apiasynchronous-api>비동기식 API(Asynchronous API)<a hidden class=anchor aria-hidden=true href=#비동기식-apiasynchronous-api>#</a></h3><p>비동기식 API는 클라이언트가 요청을 보낸 후 서버의 응답을 기다리지 않고 다른 작업을 수행할 수 있는 방식이다. 서버는 요청을 받아 처리하고, 처리가 완료되면 다양한 방법으로 결과를 클라이언트에게 전달한다.</p><h4 id=비동기식-api의-작동-원리>비동기식 API의 작동 원리<a hidden class=anchor aria-hidden=true href=#비동기식-api의-작동-원리>#</a></h4><p>비동기식 API의 일반적인 흐름은 다음과 같다:</p><ol><li>클라이언트가 API 요청을 전송한다.</li><li>서버는 요청 접수를 확인하는 응답을 즉시 반환한다 (보통 요청 ID 포함).</li><li>클라이언트는 다른 작업을 계속 수행한다.</li><li>서버는 백그라운드에서 요청을 처리한다.</li><li>처리가 완료되면 다음 중 한 가지 방법으로 결과가 전달된다:<ul><li>클라이언트가 결과를 폴링(polling)하여 확인</li><li>서버가 웹훅(webhook)을 통해 클라이언트에게 알림</li><li>웹소켓(WebSocket)이나 서버-전송 이벤트(SSE)를 통한 실시간 알림</li></ul></li></ol><h4 id=비동기식-api-구현-패턴>비동기식 API 구현 패턴<a hidden class=anchor aria-hidden=true href=#비동기식-api-구현-패턴>#</a></h4><p>비동기식 API를 구현하는 주요 패턴은 다음과 같다:</p><h5 id=폴링polling-패턴>폴링(Polling) 패턴<a hidden class=anchor aria-hidden=true href=#폴링polling-패턴>#</a></h5><p>클라이언트가 주기적으로 서버에 상태 확인 요청을 보내는 방식.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22>22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23>23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24>24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25>25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26>26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27>27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28>28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29>29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30>30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31>31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 작업 제출 엔드포인트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/jobs&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>submitJob</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업을 큐에 추가하고 작업 ID 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>enqueueJob</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResponse</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PENDING&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 작업 상태 확인 엔드포인트 (폴링용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/api/jobs/{jobId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getJobStatus</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>getJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>JobResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업이 완료된 경우 결과 포함</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setResult</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getResult</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=콜백callback--웹훅webhook-패턴>콜백(Callback) / 웹훅(Webhook) 패턴<a hidden class=anchor aria-hidden=true href=#콜백callback--웹훅webhook-패턴>#</a></h5><p>서버가 처리를 완료한 후 클라이언트가 제공한 URL로 결과를 전송하는 방식.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span><span class=lnt id=hl-2-27><a class=lnlinks href=#hl-2-27>27</a>
</span><span class=lnt id=hl-2-28><a class=lnlinks href=#hl-2-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/reports/generate&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ReportResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>generateReport</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>ReportRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RequestParam</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>callbackUrl</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 보고서 생성 작업 ID 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>reportId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 비동기적으로 보고서 생성 작업 시작 (별도 스레드/작업자)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>reportService</span><span class=p>.</span><span class=na>generateReportAsync</span><span class=p>(</span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>callbackUrl</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>ReportResponse</span><span class=p>(</span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Report generation started&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 서비스 내부에서 콜백 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>notifyReportCompletion</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>callbackUrl</span><span class=p>,</span><span class=w> </span><span class=n>Report</span><span class=w> </span><span class=n>report</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ReportResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ReportResult</span><span class=p>(</span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;COMPLETED&#34;</span><span class=p>,</span><span class=w> </span><span class=n>report</span><span class=p>.</span><span class=na>getUrl</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 콜백 URL로 결과 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>postForEntity</span><span class=p>(</span><span class=n>callbackUrl</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>,</span><span class=w> </span><span class=n>Void</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Failed to send callback for report {}: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재시도 로직이나 대체 알림 메커니즘 구현 가능</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=이벤트-스트리밍-패턴>이벤트 스트리밍 패턴<a hidden class=anchor aria-hidden=true href=#이벤트-스트리밍-패턴>#</a></h5><p>서버-전송 이벤트(SSE)나 웹소켓(WebSocket)을 사용하여 실시간으로 처리 상태를 전달하는 방식.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29>29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30>30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31>31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32>32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33>33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34>34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35>35</a>
</span><span class=lnt id=hl-3-36><a class=lnlinks href=#hl-3-36>36</a>
</span><span class=lnt id=hl-3-37><a class=lnlinks href=#hl-3-37>37</a>
</span><span class=lnt id=hl-3-38><a class=lnlinks href=#hl-3-38>38</a>
</span><span class=lnt id=hl-3-39><a class=lnlinks href=#hl-3-39>39</a>
</span><span class=lnt id=hl-3-40><a class=lnlinks href=#hl-3-40>40</a>
</span><span class=lnt id=hl-3-41><a class=lnlinks href=#hl-3-41>41</a>
</span><span class=lnt id=hl-3-42><a class=lnlinks href=#hl-3-42>42</a>
</span><span class=lnt id=hl-3-43><a class=lnlinks href=#hl-3-43>43</a>
</span><span class=lnt id=hl-3-44><a class=lnlinks href=#hl-3-44>44</a>
</span><span class=lnt id=hl-3-45><a class=lnlinks href=#hl-3-45>45</a>
</span><span class=lnt id=hl-3-46><a class=lnlinks href=#hl-3-46>46</a>
</span><span class=lnt id=hl-3-47><a class=lnlinks href=#hl-3-47>47</a>
</span><span class=lnt id=hl-3-48><a class=lnlinks href=#hl-3-48>48</a>
</span><span class=lnt id=hl-3-49><a class=lnlinks href=#hl-3-49>49</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// SSE를 사용한 이벤트 스트리밍 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@GetMapping</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;/api/jobs/{jobId}/events&#34;</span><span class=p>,</span><span class=w> </span><span class=n>produces</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MediaType</span><span class=p>.</span><span class=na>TEXT_EVENT_STREAM_VALUE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>SseEmitter</span><span class=w> </span><span class=nf>streamJobEvents</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SseEmitter</span><span class=w> </span><span class=n>emitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SseEmitter</span><span class=p>(</span><span class=n>Long</span><span class=p>.</span><span class=na>MAX_VALUE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 이미터를 작업 ID에 연결</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>jobEventService</span><span class=p>.</span><span class=na>addEmitter</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>emitter</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 연결 종료 시 정리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>emitter</span><span class=p>.</span><span class=na>onCompletion</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>jobEventService</span><span class=p>.</span><span class=na>removeEmitter</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>emitter</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>emitter</span><span class=p>.</span><span class=na>onTimeout</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>jobEventService</span><span class=p>.</span><span class=na>removeEmitter</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>emitter</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 초기 연결 확인 이벤트 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>emitter</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=n>SseEmitter</span><span class=p>.</span><span class=na>event</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>name</span><span class=p>(</span><span class=s>&#34;CONNECTED&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>data</span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;jobId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;message&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Connected to job events&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>emitter</span><span class=p>.</span><span class=na>completeWithError</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>emitter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 작업 처리 과정에서 이벤트 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendJobEvent</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>eventType</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>SseEmitter</span><span class=o>&gt;</span><span class=w> </span><span class=n>emitters</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobEventService</span><span class=p>.</span><span class=na>getEmitters</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>emitters</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>SseEmitter</span><span class=o>&gt;</span><span class=w> </span><span class=n>deadEmitters</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>SseEmitter</span><span class=w> </span><span class=n>emitter</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>emitters</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>emitter</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=n>SseEmitter</span><span class=p>.</span><span class=na>event</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>name</span><span class=p>(</span><span class=n>eventType</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>data</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>deadEmitters</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>emitter</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 실패한 이미터 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>deadEmitters</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>emitter</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>jobEventService</span><span class=p>.</span><span class=na>removeEmitter</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>emitter</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=메시지-큐-기반-패턴>메시지 큐 기반 패턴<a hidden class=anchor aria-hidden=true href=#메시지-큐-기반-패턴>#</a></h5><p>메시지 큐(예: RabbitMQ, Kafka)를 사용하여 비동기 작업을 처리하는 방식.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25>25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26>26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27>27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28>28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29>29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30>30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31>31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32>32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33>33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34>34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35>35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36>36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37>37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/orders&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>OrderResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>createOrder</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>OrderRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 주문 ID 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 초기 주문 정보 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Order</span><span class=p>(</span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 메시지 큐로 주문 처리 작업 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>orderMessageProducer</span><span class=p>.</span><span class=na>sendOrderProcessingMessage</span><span class=p>(</span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 즉시 응답 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>OrderResponse</span><span class=p>(</span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 메시지 소비자 (별도 서비스/컴포넌트)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderProcessingConsumer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RabbitListener</span><span class=p>(</span><span class=n>queues</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;order-processing-queue&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processOrder</span><span class=p>(</span><span class=n>OrderProcessingMessage</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 주문 처리 로직 </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderService</span><span class=p>.</span><span class=na>processOrder</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>(),</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>getOrderRequest</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 주문 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 완료 메시지 발행 (알림용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>orderCompletionProducer</span><span class=p>.</span><span class=na>sendOrderCompletedMessage</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Order processing failed for order {}: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>(),</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>(),</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=비동기식-api의-장점>비동기식 API의 장점<a hidden class=anchor aria-hidden=true href=#비동기식-api의-장점>#</a></h4><ol><li><strong>향상된 응답성</strong>: 클라이언트는 작업 완료를 기다릴 필요 없이 다른 작업을 수행할 수 있다.</li><li><strong>확장성 개선</strong>: 서버는 요청을 큐에 넣고 가용 자원에 따라 처리할 수 있어 부하 관리가 용이하다.</li><li><strong>장기 실행 작업 지원</strong>: 시간이 많이 걸리는 작업도 타임아웃 걱정 없이 처리할 수 있다.</li><li><strong>시스템 복원력</strong>: 서비스 간 느슨한 결합으로 한 서비스의 장애가 전체 시스템에 미치는 영향이 제한적이다.</li><li><strong>효율적인 자원 활용</strong>: 서버와 클라이언트 모두 대기 시간 없이 자원을 효율적으로 활용할 수 있다.</li></ol><h4 id=비동기식-api의-단점>비동기식 API의 단점<a hidden class=anchor aria-hidden=true href=#비동기식-api의-단점>#</a></h4><ol><li><strong>복잡성 증가</strong>: 구현과 테스트가 더 복잡해진다. 오류 처리, 재시도 로직, 작업 상태 추적 등이 필요하다.</li><li><strong>즉각적인 응답 부재</strong>: 최종 결과를 얻기까지 지연이 발생할 수 있다.</li><li><strong>상태 관리 필요</strong>: 작업 상태와 결과를 저장하고 추적하는 추가 인프라가 필요하다.</li><li><strong>이벤트 순서 보장의 어려움</strong>: 메시지 전달 순서가 처리 순서를 보장하지 않을 수 있다.</li><li><strong>디버깅 복잡성</strong>: 분산된 비동기 처리로 인해 문제 추적이 어려울 수 있다.</li></ol><h4 id=비동기식-api의-적합한-부적합한-사용-사례>비동기식 API의 적합한, 부적합한 사용 사례<a hidden class=anchor aria-hidden=true href=#비동기식-api의-적합한-부적합한-사용-사례>#</a></h4><p><strong>적합한 사용 사례</strong>:</p><ul><li>대용량 파일 처리 (업로드/다운로드, 변환)</li><li>복잡한 계산이나 분석 작업</li><li>이메일 전송, 알림 발송과 같은 백그라운드 작업</li><li>외부 서비스 통합이 필요한 복잡한 워크플로우</li><li>높은 처리량이 필요한 시스템</li></ul><p><strong>부적합한 사용 사례</strong>:</p><ul><li>즉각적인 사용자 피드백이 필요한 상호작용</li><li>단순하고 빠른 데이터 조회</li><li>강력한 트랜잭션 일관성이 필요한 작업</li><li>실시간 응답이 중요한 사용자 인터페이스 요소</li></ul><h3 id=혼합-접근법-동기식과-비동기식-api의-결합>혼합 접근법: 동기식과 비동기식 API의 결합<a hidden class=anchor aria-hidden=true href=#혼합-접근법-동기식과-비동기식-api의-결합>#</a></h3><p>많은 현대적인 애플리케이션은 동기식과 비동기식 API를 모두 활용하는 혼합 접근법을 채택한다. 이는 각 패턴의 장점을 최대화하고 단점을 최소화하는 데 도움이 된다.</p><h4 id=혼합-접근법-구현-전략>혼합 접근법 구현 전략<a hidden class=anchor aria-hidden=true href=#혼합-접근법-구현-전략>#</a></h4><h5 id=비동기-작업-시작을-위한-동기식-api>비동기 작업 시작을 위한 동기식 API<a hidden class=anchor aria-hidden=true href=#비동기-작업-시작을-위한-동기식-api>#</a></h5><p>작업 제출은 동기식으로 처리하되, 실제 처리는 비동기식으로 진행하는 방식이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/documents/convert&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ConversionResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>convertDocument</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=s>&#34;file&#34;</span><span class=p>)</span><span class=w> </span><span class=n>MultipartFile</span><span class=w> </span><span class=n>file</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=s>&#34;targetFormat&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>targetFormat</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 파일 저장 및 작업 메타데이터 생성 (동기식)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>documentId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>documentService</span><span class=p>.</span><span class=na>saveDocument</span><span class=p>(</span><span class=n>file</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>conversionId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>conversionService</span><span class=p>.</span><span class=na>createConversionJob</span><span class=p>(</span><span class=n>documentId</span><span class=p>,</span><span class=w> </span><span class=n>targetFormat</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 비동기 변환 작업 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>conversionService</span><span class=p>.</span><span class=na>startAsyncConversion</span><span class=p>(</span><span class=n>conversionId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 상태 확인 URL 및 작업 ID 반환 (동기식 응답)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>ConversionResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>conversionId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;/api/documents/conversions/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>conversionId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;PROCESSING&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=장기-폴링long-polling-접근법>장기 폴링(Long Polling) 접근법<a hidden class=anchor aria-hidden=true href=#장기-폴링long-polling-접근법>#</a></h5><p>클라이언트의 요청을 일정 시간 동안 유지하다가 결과가 준비되면 즉시 반환하거나, 타임아웃에 도달하면 현재 상태를 반환하는 방식.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34>34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35>35</a>
</span><span class=lnt id=hl-6-36><a class=lnlinks href=#hl-6-36>36</a>
</span><span class=lnt id=hl-6-37><a class=lnlinks href=#hl-6-37>37</a>
</span><span class=lnt id=hl-6-38><a class=lnlinks href=#hl-6-38>38</a>
</span><span class=lnt id=hl-6-39><a class=lnlinks href=#hl-6-39>39</a>
</span><span class=lnt id=hl-6-40><a class=lnlinks href=#hl-6-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/api/jobs/{jobId}/longpoll&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResult</span><span class=o>&gt;</span><span class=w> </span><span class=nf>longPollJobResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>defaultValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;30&#34;</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>timeoutSeconds</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 현재 작업 상태 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>JobStatus</span><span class=w> </span><span class=n>currentStatus</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>getJobStatus</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 이미 완료된 경우 즉시 결과 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>currentStatus</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>currentStatus</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>jobService</span><span class=p>.</span><span class=na>getJobResult</span><span class=p>(</span><span class=n>jobId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 결과를 기다리는 CountDownLatch 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CountDownLatch</span><span class=w> </span><span class=n>latch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CountDownLatch</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>JobResultListener</span><span class=w> </span><span class=n>listener</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobResultListener</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>latch</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 리스너 등록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>jobService</span><span class=p>.</span><span class=na>addJobListener</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>listener</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 결과를 기다리거나 타임아웃까지 대기</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>boolean</span><span class=w> </span><span class=n>completed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>latch</span><span class=p>.</span><span class=na>await</span><span class=p>(</span><span class=n>timeoutSeconds</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 리스너 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jobService</span><span class=p>.</span><span class=na>removeJobListener</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>listener</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>completed</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 완료된 경우 결과 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>jobService</span><span class=p>.</span><span class=na>getJobResult</span><span class=p>(</span><span class=n>jobId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 타임아웃된 경우 현재 상태 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResult</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>getJobStatus</span><span class=p>(</span><span class=n>jobId</span><span class=p>),</span><span class=w> </span><span class=kc>null</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>interrupt</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jobService</span><span class=p>.</span><span class=na>removeJobListener</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>listener</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=복합-api-패턴>복합 API 패턴<a hidden class=anchor aria-hidden=true href=#복합-api-패턴>#</a></h5><p>동일한 리소스에 대해 동기식과 비동기식 엔드포인트를 모두 제공하는 방식이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27>27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28>28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29>29</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 동기식 처리 (간단한 요청용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/payments/sync&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>PaymentResult</span><span class=o>&gt;</span><span class=w> </span><span class=nf>processPaymentSync</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>PaymentRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 동기적으로 결제 처리 (타임아웃 제한 있음)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PaymentResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentService</span><span class=p>.</span><span class=na>processPaymentSync</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 비동기식 처리 (복잡한 처리용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/payments/async&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>PaymentResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>processPaymentAsync</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>PaymentRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>callbackUrl</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 결제 작업 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentService</span><span class=p>.</span><span class=na>initiatePayment</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 비동기 처리 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>paymentService</span><span class=p>.</span><span class=na>processPaymentAsync</span><span class=p>(</span><span class=n>paymentId</span><span class=p>,</span><span class=w> </span><span class=n>callbackUrl</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 즉시 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>PaymentResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>paymentId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;PROCESSING&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;/api/payments/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>paymentId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=혼합-접근법의-장점>혼합 접근법의 장점<a hidden class=anchor aria-hidden=true href=#혼합-접근법의-장점>#</a></h4><ol><li><strong>유연성</strong>: 작업의 특성에 따라 가장 적합한 패턴을 선택할 수 있다.</li><li><strong>점진적 도입</strong>: 기존 동기식 API를 유지하면서 필요한 부분만 비동기식으로 변환할 수 있다.</li><li><strong>사용자 경험 최적화</strong>: 즉각적인 피드백과 장기 실행 작업의 효율적인 처리를 모두 제공할 수 있다.</li><li><strong>리소스 최적화</strong>: 작업의 복잡성에 따라 서버 리소스를 효율적으로 활용할 수 있다.</li></ol><h3 id=api-패턴-선택-가이드라인>API 패턴 선택 가이드라인<a hidden class=anchor aria-hidden=true href=#api-패턴-선택-가이드라인>#</a></h3><p>적절한 API 패턴을 선택하기 위한 주요 고려사항:</p><ol><li><p>동기식 API를 선택해야 하는 경우</p><ul><li><strong>응답 시간이 짧은 경우</strong>: 요청을 빠르게 처리할 수 있는 경우 (일반적으로 1초 미만)</li><li><strong>즉각적인 응답이 필수적인 경우</strong>: 사용자가 즉시 결과를 보고 다음 작업을 결정해야 하는 경우</li><li><strong>강력한 일관성이 필요한 경우</strong>: 데이터 읽기/쓰기 후 즉시 확인이 필요한 경우</li><li><strong>단순한 요청-응답 흐름</strong>: 복잡한 워크플로우가 없는 간단한 CRUD 작업</li></ul></li><li><p>비동기식 API를 선택해야 하는 경우</p><ul><li><strong>장시간 실행 작업</strong>: 처리하는 데 수 초 이상 걸리는 작업</li><li><strong>대용량 데이터 처리</strong>: 대규모 파일 업로드/다운로드나 데이터 처리</li><li><strong>외부 시스템 의존성</strong>: 여러 외부 서비스와의 통합이 필요한 경우</li><li><strong>부하 분산이 중요한 경우</strong>: 대량의 요청을 효율적으로 처리해야 하는 경우</li><li><strong>클라이언트 연결 제한</strong>: 모바일 장치와 같이 연결 유지가 비용이 많이 드는 환경</li></ul></li><li><p>결정 프레임워크<br>API 패턴 선택을 위한 단계별 접근법:</p><ol><li><strong>작업 특성 분석</strong>:<ul><li>예상 처리 시간은 얼마인가?</li><li>작업의 복잡성은 어느 정도인가?</li><li>외부 시스템 의존성이 있는가?</li></ul></li><li><strong>사용자 경험 요구사항 고려</strong>:<ul><li>사용자가 즉각적인 응답을 기대하는가?</li><li>진행 상황 알림이 필요한가?</li><li>클라이언트의 특성은 어떠한가? (모바일, 웹, 서버-서버 등)</li></ul></li><li><strong>시스템 부하 및 확장성 요구사항 평가</strong>:<ul><li>예상되는 동시 요청 수는 얼마인가?</li><li>시스템의 확장 전략은 무엇인가?</li><li>자원 제약 사항이 있는가?</li></ul></li><li><strong>오류 처리 및 복원력 요구사항 분석</strong>:<ul><li>오류 발생 시 어떻게 처리해야 하는가?</li><li>재시도 메커니즘이 필요한가?</li><li>부분 실패는 어떻게 처리해야 하는가?</li></ul></li></ol></li></ol><h3 id=실제-구현-사례-및-모범-사례>실제 구현 사례 및 모범 사례<a hidden class=anchor aria-hidden=true href=#실제-구현-사례-및-모범-사례>#</a></h3><h4 id=동기식-api-모범-사례>동기식 API 모범 사례<a hidden class=anchor aria-hidden=true href=#동기식-api-모범-사례>#</a></h4><ol><li><strong>적절한 타임아웃 설정</strong>: 클라이언트와 서버 모두에서 적절한 타임아웃을 설정하여 무한 대기를 방지한다.</li><li><strong>명확한 오류 처리</strong>: 오류가 발생했을 때 클라이언트가 이해하고 대응할 수 있도록 명확한 오류 메시지와 상태 코드를 반환한다.</li><li><strong>페이지네이션 적용</strong>: 대량의 데이터를 반환할 때는 페이지네이션을 사용하여 응답 시간을 최적화한다.</li><li><strong>캐싱 활용</strong>: 자주 요청되는 데이터는 캐싱하여 응답 시간을 개선한다.</li><li><strong>백그라운드 처리로 전환</strong>: 처리 시간이 예상보다 길어질 수 있는 작업은 비동기 처리를 고려한다.</li></ol><h4 id=비동기식-api-모범-사례>비동기식 API 모범 사례<a hidden class=anchor aria-hidden=true href=#비동기식-api-모범-사례>#</a></h4><ol><li><strong>고유 작업 ID</strong>: 각 비동기 작업에 고유 ID를 할당하고 상태 추적에 활용한다.</li><li><strong>명확한 상태 모델</strong>: 작업의 가능한 상태(대기 중, 처리 중, 완료, 실패 등)를 명확히 정의한다.</li><li><strong>적절한 통지 메커니즘</strong>: 사용 사례에 맞는 통지 메커니즘(폴링, 웹훅, SSE 등)을 선택한다.</li><li><strong>재시도 및 실패 처리</strong>: 작업 실패 시 자동 재시도 메커니즘과 최대 재시도 횟수를 구현한다.</li><li><strong>멱등성 보장</strong>: 동일 작업의 중복 제출이나 재시도 시 일관된 결과를 보장한다.</li><li><strong>작업 만료 정책</strong>: 오래된 작업과 결과에 대한 명확한 만료 정책을 수립하여 리소스를 효율적으로 관리한다. 예를 들어, 완료된 작업의 결과는 24시간 후 자동 삭제하는 등의 정책을 적용할 수 있다.</li><li><strong>진행률 보고</strong>: 장시간 실행되는 작업의 경우 진행 상황을 보고하는 메커니즘을 구현하여 사용자 경험을 개선한다. 이는 전체 진행률 백분율이나 단계별 상태 업데이트 형태로 제공될 수 있다.</li><li><strong>작업 이력 관리</strong>: 과거 작업의 기록을 유지하여 감사(audit) 및 문제 해결에 활용한다. 이는 작업 시작 시간, 완료 시간, 상태 변화, 오류 정보 등을 포함할 수 있다.</li><li><strong>작업 취소 메커니즘</strong>: 진행 중인 작업을 취소할 수 있는 API를 제공하여 불필요한 리소스 소비를 방지한다.</li><li><strong>상태 기반 설계</strong>: API 응답은 항상 작업의 현재 상태를 명확하게 반영해야 한다. 이를 통해 클라이언트는 올바른 결정을 내릴 수 있다.</li></ol><h4 id=실제-구현-사례>실제 구현 사례<a hidden class=anchor aria-hidden=true href=#실제-구현-사례>#</a></h4><h5 id=aws-s3-멀티파트-업로드-비동기식-api-사례>AWS S3 멀티파트 업로드 (비동기식 API 사례)<a hidden class=anchor aria-hidden=true href=#aws-s3-멀티파트-업로드-비동기식-api-사례>#</a></h5><p>AWS S3 멀티파트 업로드는 대용량 파일을 효율적으로 업로드하기 위한 비동기식 API의 좋은 예이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41>41</a>
</span><span class=lnt id=hl-8-42><a class=lnlinks href=#hl-8-42>42</a>
</span><span class=lnt id=hl-8-43><a class=lnlinks href=#hl-8-43>43</a>
</span><span class=lnt id=hl-8-44><a class=lnlinks href=#hl-8-44>44</a>
</span><span class=lnt id=hl-8-45><a class=lnlinks href=#hl-8-45>45</a>
</span><span class=lnt id=hl-8-46><a class=lnlinks href=#hl-8-46>46</a>
</span><span class=lnt id=hl-8-47><a class=lnlinks href=#hl-8-47>47</a>
</span><span class=lnt id=hl-8-48><a class=lnlinks href=#hl-8-48>48</a>
</span><span class=lnt id=hl-8-49><a class=lnlinks href=#hl-8-49>49</a>
</span><span class=lnt id=hl-8-50><a class=lnlinks href=#hl-8-50>50</a>
</span><span class=lnt id=hl-8-51><a class=lnlinks href=#hl-8-51>51</a>
</span><span class=lnt id=hl-8-52><a class=lnlinks href=#hl-8-52>52</a>
</span><span class=lnt id=hl-8-53><a class=lnlinks href=#hl-8-53>53</a>
</span><span class=lnt id=hl-8-54><a class=lnlinks href=#hl-8-54>54</a>
</span><span class=lnt id=hl-8-55><a class=lnlinks href=#hl-8-55>55</a>
</span><span class=lnt id=hl-8-56><a class=lnlinks href=#hl-8-56>56</a>
</span><span class=lnt id=hl-8-57><a class=lnlinks href=#hl-8-57>57</a>
</span><span class=lnt id=hl-8-58><a class=lnlinks href=#hl-8-58>58</a>
</span><span class=lnt id=hl-8-59><a class=lnlinks href=#hl-8-59>59</a>
</span><span class=lnt id=hl-8-60><a class=lnlinks href=#hl-8-60>60</a>
</span><span class=lnt id=hl-8-61><a class=lnlinks href=#hl-8-61>61</a>
</span><span class=lnt id=hl-8-62><a class=lnlinks href=#hl-8-62>62</a>
</span><span class=lnt id=hl-8-63><a class=lnlinks href=#hl-8-63>63</a>
</span><span class=lnt id=hl-8-64><a class=lnlinks href=#hl-8-64>64</a>
</span><span class=lnt id=hl-8-65><a class=lnlinks href=#hl-8-65>65</a>
</span><span class=lnt id=hl-8-66><a class=lnlinks href=#hl-8-66>66</a>
</span><span class=lnt id=hl-8-67><a class=lnlinks href=#hl-8-67>67</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// JavaScript를 사용한 AWS S3 멀티파트 업로드 예제
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>initiateMultipartUpload</span><span class=p>(</span><span class=nx>s3Client</span><span class=p>,</span> <span class=nx>bucket</span><span class=p>,</span> <span class=nx>key</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>command</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CreateMultipartUploadCommand</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>Bucket</span><span class=o>:</span> <span class=nx>bucket</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Key</span><span class=o>:</span> <span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 업로드 초기화 (동기식 부분)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>UploadId</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>s3Client</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Multipart upload initiated with UploadId: </span><span class=si>${</span><span class=nx>UploadId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>UploadId</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>uploadPart</span><span class=p>(</span><span class=nx>s3Client</span><span class=p>,</span> <span class=nx>bucket</span><span class=p>,</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>uploadId</span><span class=p>,</span> <span class=nx>partNumber</span><span class=p>,</span> <span class=nx>body</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>command</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>UploadPartCommand</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>Bucket</span><span class=o>:</span> <span class=nx>bucket</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Key</span><span class=o>:</span> <span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>UploadId</span><span class=o>:</span> <span class=nx>uploadId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>PartNumber</span><span class=o>:</span> <span class=nx>partNumber</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Body</span><span class=o>:</span> <span class=nx>body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 파트 업로드 (각 파트는 비동기식으로 처리)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>ETag</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>s3Client</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Part </span><span class=si>${</span><span class=nx>partNumber</span><span class=si>}</span><span class=sb> uploaded, ETag: </span><span class=si>${</span><span class=nx>ETag</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>PartNumber</span><span class=o>:</span> <span class=nx>partNumber</span><span class=p>,</span> <span class=nx>ETag</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>completeMultipartUpload</span><span class=p>(</span><span class=nx>s3Client</span><span class=p>,</span> <span class=nx>bucket</span><span class=p>,</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>uploadId</span><span class=p>,</span> <span class=nx>parts</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>command</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CompleteMultipartUploadCommand</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>Bucket</span><span class=o>:</span> <span class=nx>bucket</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Key</span><span class=o>:</span> <span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>UploadId</span><span class=o>:</span> <span class=nx>uploadId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>MultipartUpload</span><span class=o>:</span> <span class=p>{</span> <span class=nx>Parts</span><span class=o>:</span> <span class=nx>parts</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 업로드 완료 (동기식 부분)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>s3Client</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>command</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Upload completed, Location: </span><span class=si>${</span><span class=nx>result</span><span class=p>.</span><span class=nx>Location</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 대용량 파일을 청크로 나누어 병렬 업로드
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>uploadLargeFile</span><span class=p>(</span><span class=nx>s3Client</span><span class=p>,</span> <span class=nx>bucket</span><span class=p>,</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>fileStream</span><span class=p>,</span> <span class=nx>chunkSize</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 1. 멀티파트 업로드 초기화
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>uploadId</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>initiateMultipartUpload</span><span class=p>(</span><span class=nx>s3Client</span><span class=p>,</span> <span class=nx>bucket</span><span class=p>,</span> <span class=nx>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 2. 파일을 청크로 분할하고 각 부분 비동기적으로 업로드
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>partPromises</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>partNumber</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 파일 청크 처리 로직 (스트림 처리)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>for</span> <span class=kr>await</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>chunk</span> <span class=k>of</span> <span class=nx>createChunkStream</span><span class=p>(</span><span class=nx>fileStream</span><span class=p>,</span> <span class=nx>chunkSize</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>partPromises</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>uploadPart</span><span class=p>(</span><span class=nx>s3Client</span><span class=p>,</span> <span class=nx>bucket</span><span class=p>,</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>uploadId</span><span class=p>,</span> <span class=nx>partNumber</span><span class=o>++</span><span class=p>,</span> <span class=nx>chunk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 모든 파트 업로드 완료 대기
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>uploadedParts</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span><span class=nx>partPromises</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 3. 멀티파트 업로드 완료
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=nx>completeMultipartUpload</span><span class=p>(</span><span class=nx>s3Client</span><span class=p>,</span> <span class=nx>bucket</span><span class=p>,</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>uploadId</span><span class=p>,</span> <span class=nx>uploadedParts</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>이 사례에서 주목할 점:</p><ul><li>초기화와 완료는 동기식으로 처리</li><li>파일 청크 업로드는 비동기식으로 병렬 처리</li><li>고유 UploadId로 전체 프로세스 추적</li><li>부분 업로드에 대한 명확한 상태 추적</li></ul><h5 id=결제-처리-api-혼합-접근법-사례>결제 처리 API (혼합 접근법 사례)<a hidden class=anchor aria-hidden=true href=#결제-처리-api-혼합-접근법-사례>#</a></h5><p>결제 처리는 즉각적인 응답과 복잡한 백엔드 처리가 모두 필요한 영역으로, 동기식과 비동기식 접근법의 결합이 적합하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>  1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>  2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>  3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>  4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5>  5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6>  6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7>  7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8>  8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9>  9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10> 10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11> 11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12> 12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13> 13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14> 14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15> 15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16> 16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17> 17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18> 18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19> 19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20> 20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21> 21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22> 22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23> 23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24> 24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25> 25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26> 26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27> 27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28> 28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29> 29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30> 30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31> 31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32> 32</a>
</span><span class=lnt id=hl-9-33><a class=lnlinks href=#hl-9-33> 33</a>
</span><span class=lnt id=hl-9-34><a class=lnlinks href=#hl-9-34> 34</a>
</span><span class=lnt id=hl-9-35><a class=lnlinks href=#hl-9-35> 35</a>
</span><span class=lnt id=hl-9-36><a class=lnlinks href=#hl-9-36> 36</a>
</span><span class=lnt id=hl-9-37><a class=lnlinks href=#hl-9-37> 37</a>
</span><span class=lnt id=hl-9-38><a class=lnlinks href=#hl-9-38> 38</a>
</span><span class=lnt id=hl-9-39><a class=lnlinks href=#hl-9-39> 39</a>
</span><span class=lnt id=hl-9-40><a class=lnlinks href=#hl-9-40> 40</a>
</span><span class=lnt id=hl-9-41><a class=lnlinks href=#hl-9-41> 41</a>
</span><span class=lnt id=hl-9-42><a class=lnlinks href=#hl-9-42> 42</a>
</span><span class=lnt id=hl-9-43><a class=lnlinks href=#hl-9-43> 43</a>
</span><span class=lnt id=hl-9-44><a class=lnlinks href=#hl-9-44> 44</a>
</span><span class=lnt id=hl-9-45><a class=lnlinks href=#hl-9-45> 45</a>
</span><span class=lnt id=hl-9-46><a class=lnlinks href=#hl-9-46> 46</a>
</span><span class=lnt id=hl-9-47><a class=lnlinks href=#hl-9-47> 47</a>
</span><span class=lnt id=hl-9-48><a class=lnlinks href=#hl-9-48> 48</a>
</span><span class=lnt id=hl-9-49><a class=lnlinks href=#hl-9-49> 49</a>
</span><span class=lnt id=hl-9-50><a class=lnlinks href=#hl-9-50> 50</a>
</span><span class=lnt id=hl-9-51><a class=lnlinks href=#hl-9-51> 51</a>
</span><span class=lnt id=hl-9-52><a class=lnlinks href=#hl-9-52> 52</a>
</span><span class=lnt id=hl-9-53><a class=lnlinks href=#hl-9-53> 53</a>
</span><span class=lnt id=hl-9-54><a class=lnlinks href=#hl-9-54> 54</a>
</span><span class=lnt id=hl-9-55><a class=lnlinks href=#hl-9-55> 55</a>
</span><span class=lnt id=hl-9-56><a class=lnlinks href=#hl-9-56> 56</a>
</span><span class=lnt id=hl-9-57><a class=lnlinks href=#hl-9-57> 57</a>
</span><span class=lnt id=hl-9-58><a class=lnlinks href=#hl-9-58> 58</a>
</span><span class=lnt id=hl-9-59><a class=lnlinks href=#hl-9-59> 59</a>
</span><span class=lnt id=hl-9-60><a class=lnlinks href=#hl-9-60> 60</a>
</span><span class=lnt id=hl-9-61><a class=lnlinks href=#hl-9-61> 61</a>
</span><span class=lnt id=hl-9-62><a class=lnlinks href=#hl-9-62> 62</a>
</span><span class=lnt id=hl-9-63><a class=lnlinks href=#hl-9-63> 63</a>
</span><span class=lnt id=hl-9-64><a class=lnlinks href=#hl-9-64> 64</a>
</span><span class=lnt id=hl-9-65><a class=lnlinks href=#hl-9-65> 65</a>
</span><span class=lnt id=hl-9-66><a class=lnlinks href=#hl-9-66> 66</a>
</span><span class=lnt id=hl-9-67><a class=lnlinks href=#hl-9-67> 67</a>
</span><span class=lnt id=hl-9-68><a class=lnlinks href=#hl-9-68> 68</a>
</span><span class=lnt id=hl-9-69><a class=lnlinks href=#hl-9-69> 69</a>
</span><span class=lnt id=hl-9-70><a class=lnlinks href=#hl-9-70> 70</a>
</span><span class=lnt id=hl-9-71><a class=lnlinks href=#hl-9-71> 71</a>
</span><span class=lnt id=hl-9-72><a class=lnlinks href=#hl-9-72> 72</a>
</span><span class=lnt id=hl-9-73><a class=lnlinks href=#hl-9-73> 73</a>
</span><span class=lnt id=hl-9-74><a class=lnlinks href=#hl-9-74> 74</a>
</span><span class=lnt id=hl-9-75><a class=lnlinks href=#hl-9-75> 75</a>
</span><span class=lnt id=hl-9-76><a class=lnlinks href=#hl-9-76> 76</a>
</span><span class=lnt id=hl-9-77><a class=lnlinks href=#hl-9-77> 77</a>
</span><span class=lnt id=hl-9-78><a class=lnlinks href=#hl-9-78> 78</a>
</span><span class=lnt id=hl-9-79><a class=lnlinks href=#hl-9-79> 79</a>
</span><span class=lnt id=hl-9-80><a class=lnlinks href=#hl-9-80> 80</a>
</span><span class=lnt id=hl-9-81><a class=lnlinks href=#hl-9-81> 81</a>
</span><span class=lnt id=hl-9-82><a class=lnlinks href=#hl-9-82> 82</a>
</span><span class=lnt id=hl-9-83><a class=lnlinks href=#hl-9-83> 83</a>
</span><span class=lnt id=hl-9-84><a class=lnlinks href=#hl-9-84> 84</a>
</span><span class=lnt id=hl-9-85><a class=lnlinks href=#hl-9-85> 85</a>
</span><span class=lnt id=hl-9-86><a class=lnlinks href=#hl-9-86> 86</a>
</span><span class=lnt id=hl-9-87><a class=lnlinks href=#hl-9-87> 87</a>
</span><span class=lnt id=hl-9-88><a class=lnlinks href=#hl-9-88> 88</a>
</span><span class=lnt id=hl-9-89><a class=lnlinks href=#hl-9-89> 89</a>
</span><span class=lnt id=hl-9-90><a class=lnlinks href=#hl-9-90> 90</a>
</span><span class=lnt id=hl-9-91><a class=lnlinks href=#hl-9-91> 91</a>
</span><span class=lnt id=hl-9-92><a class=lnlinks href=#hl-9-92> 92</a>
</span><span class=lnt id=hl-9-93><a class=lnlinks href=#hl-9-93> 93</a>
</span><span class=lnt id=hl-9-94><a class=lnlinks href=#hl-9-94> 94</a>
</span><span class=lnt id=hl-9-95><a class=lnlinks href=#hl-9-95> 95</a>
</span><span class=lnt id=hl-9-96><a class=lnlinks href=#hl-9-96> 96</a>
</span><span class=lnt id=hl-9-97><a class=lnlinks href=#hl-9-97> 97</a>
</span><span class=lnt id=hl-9-98><a class=lnlinks href=#hl-9-98> 98</a>
</span><span class=lnt id=hl-9-99><a class=lnlinks href=#hl-9-99> 99</a>
</span><span class=lnt id=hl-9-100><a class=lnlinks href=#hl-9-100>100</a>
</span><span class=lnt id=hl-9-101><a class=lnlinks href=#hl-9-101>101</a>
</span><span class=lnt id=hl-9-102><a class=lnlinks href=#hl-9-102>102</a>
</span><span class=lnt id=hl-9-103><a class=lnlinks href=#hl-9-103>103</a>
</span><span class=lnt id=hl-9-104><a class=lnlinks href=#hl-9-104>104</a>
</span><span class=lnt id=hl-9-105><a class=lnlinks href=#hl-9-105>105</a>
</span><span class=lnt id=hl-9-106><a class=lnlinks href=#hl-9-106>106</a>
</span><span class=lnt id=hl-9-107><a class=lnlinks href=#hl-9-107>107</a>
</span><span class=lnt id=hl-9-108><a class=lnlinks href=#hl-9-108>108</a>
</span><span class=lnt id=hl-9-109><a class=lnlinks href=#hl-9-109>109</a>
</span><span class=lnt id=hl-9-110><a class=lnlinks href=#hl-9-110>110</a>
</span><span class=lnt id=hl-9-111><a class=lnlinks href=#hl-9-111>111</a>
</span><span class=lnt id=hl-9-112><a class=lnlinks href=#hl-9-112>112</a>
</span><span class=lnt id=hl-9-113><a class=lnlinks href=#hl-9-113>113</a>
</span><span class=lnt id=hl-9-114><a class=lnlinks href=#hl-9-114>114</a>
</span><span class=lnt id=hl-9-115><a class=lnlinks href=#hl-9-115>115</a>
</span><span class=lnt id=hl-9-116><a class=lnlinks href=#hl-9-116>116</a>
</span><span class=lnt id=hl-9-117><a class=lnlinks href=#hl-9-117>117</a>
</span><span class=lnt id=hl-9-118><a class=lnlinks href=#hl-9-118>118</a>
</span><span class=lnt id=hl-9-119><a class=lnlinks href=#hl-9-119>119</a>
</span><span class=lnt id=hl-9-120><a class=lnlinks href=#hl-9-120>120</a>
</span><span class=lnt id=hl-9-121><a class=lnlinks href=#hl-9-121>121</a>
</span><span class=lnt id=hl-9-122><a class=lnlinks href=#hl-9-122>122</a>
</span><span class=lnt id=hl-9-123><a class=lnlinks href=#hl-9-123>123</a>
</span><span class=lnt id=hl-9-124><a class=lnlinks href=#hl-9-124>124</a>
</span><span class=lnt id=hl-9-125><a class=lnlinks href=#hl-9-125>125</a>
</span><span class=lnt id=hl-9-126><a class=lnlinks href=#hl-9-126>126</a>
</span><span class=lnt id=hl-9-127><a class=lnlinks href=#hl-9-127>127</a>
</span><span class=lnt id=hl-9-128><a class=lnlinks href=#hl-9-128>128</a>
</span><span class=lnt id=hl-9-129><a class=lnlinks href=#hl-9-129>129</a>
</span><span class=lnt id=hl-9-130><a class=lnlinks href=#hl-9-130>130</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/v1/payments&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PaymentController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PaymentService</span><span class=w> </span><span class=n>paymentService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PaymentRepository</span><span class=w> </span><span class=n>paymentRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>WebhookService</span><span class=w> </span><span class=n>webhookService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 결제 인증 및 초기화 (동기식)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/authorize&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>PaymentAuthorizationResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>authorizePayment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>PaymentAuthorizationRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 기본 유효성 검사 및 결제 인증 (빠르게 처리되어야 함)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PaymentAuthorization</span><span class=w> </span><span class=n>auth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentService</span><span class=p>.</span><span class=na>authorizePayment</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>PaymentAuthorizationResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>auth</span><span class=p>.</span><span class=na>getAuthorizationId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>auth</span><span class=p>.</span><span class=na>getStatus</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>auth</span><span class=p>.</span><span class=na>getRedirectUrl</span><span class=p>()</span><span class=w>  </span><span class=c1>// 3D Secure 등에 필요할 경우</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 결제 처리 (비동기식)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/process&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>PaymentResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>processPayment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>PaymentProcessRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>webhookUrl</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 결제 검증 (동기식)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>paymentService</span><span class=p>.</span><span class=na>validatePaymentRequest</span><span class=p>(</span><span class=n>request</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>badRequest</span><span class=p>().</span><span class=na>body</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>new</span><span class=w> </span><span class=n>PaymentResponse</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s>&#34;INVALID&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Invalid payment request&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 결제 ID 생성 및 초기 상태 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Payment</span><span class=w> </span><span class=n>payment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Payment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>paymentId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>.</span><span class=na>getAuthorizationId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>.</span><span class=na>getCurrency</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PaymentStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>webhookUrl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>payment</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비동기 결제 처리 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>paymentService</span><span class=p>.</span><span class=na>processPaymentAsync</span><span class=p>(</span><span class=n>paymentId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 즉시 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>PaymentResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>paymentId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;PROCESSING&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;Payment is being processed&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 결제 상태 조회 (동기식)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/{paymentId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>PaymentStatusResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getPaymentStatus</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Payment</span><span class=w> </span><span class=n>payment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>paymentId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResourceNotFoundException</span><span class=p>(</span><span class=s>&#34;Payment not found&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>PaymentStatusResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>payment</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>payment</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>payment</span><span class=p>.</span><span class=na>getStatusMessage</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>payment</span><span class=p>.</span><span class=na>getCompletedAt</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>payment</span><span class=p>.</span><span class=na>getTransactionReference</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PaymentService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PaymentRepository</span><span class=w> </span><span class=n>paymentRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PaymentGateway</span><span class=w> </span><span class=n>paymentGateway</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>WebhookService</span><span class=w> </span><span class=n>webhookService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>TaskExecutor</span><span class=w> </span><span class=n>taskExecutor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 비동기 결제 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processPaymentAsync</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>taskExecutor</span><span class=p>.</span><span class=na>execute</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Payment</span><span class=w> </span><span class=n>payment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>paymentId</span><span class=p>).</span><span class=na>orElse</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>payment</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 결제 게이트웨이 호출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>PaymentResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentGateway</span><span class=p>.</span><span class=na>processPayment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>payment</span><span class=p>.</span><span class=na>getAuthorizationId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>payment</span><span class=p>.</span><span class=na>getAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>payment</span><span class=p>.</span><span class=na>getCurrency</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 결과 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>payment</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>isSuccessful</span><span class=p>()</span><span class=w> </span><span class=o>?</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>PaymentStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>PaymentStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>payment</span><span class=p>.</span><span class=na>setStatusMessage</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>payment</span><span class=p>.</span><span class=na>setTransactionReference</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>payment</span><span class=p>.</span><span class=na>setCompletedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>payment</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 웹훅 알림 전송 (있는 경우)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>payment</span><span class=p>.</span><span class=na>getWebhookUrl</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>webhookService</span><span class=p>.</span><span class=na>sendPaymentWebhook</span><span class=p>(</span><span class=n>payment</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 오류 처리 및 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Payment</span><span class=w> </span><span class=n>payment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>paymentId</span><span class=p>).</span><span class=na>orElse</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>payment</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>payment</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>PaymentStatus</span><span class=p>.</span><span class=na>ERROR</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>payment</span><span class=p>.</span><span class=na>setStatusMessage</span><span class=p>(</span><span class=s>&#34;Processing error: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>payment</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 로깅</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Payment processing failed: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 다른 메서드들…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>이 사례에서 주목할 점:</p><ul><li>결제 인증은 즉각적인 응답이 필요하므로 동기식으로 처리</li><li>실제 결제 처리는 시간이 걸릴 수 있으므로 비동기식으로 처리</li><li>결제 상태 조회는 동기식 API로 제공</li><li>웹훅을 통한 결제 완료 알림 제공</li></ul><h3 id=고급-패턴-및-기술>고급 패턴 및 기술<a hidden class=anchor aria-hidden=true href=#고급-패턴-및-기술>#</a></h3><h4 id=반응형-프로그래밍reactive-programming>반응형 프로그래밍(Reactive Programming)<a hidden class=anchor aria-hidden=true href=#반응형-프로그래밍reactive-programming>#</a></h4><p>반응형 프로그래밍은 비동기 데이터 스트림을 기반으로 하는 프로그래밍 패러다임으로, 비동기 API 구현에 강력한 접근 방식을 제공한다.</p><p><strong>주요 특징:</strong></p><ul><li>비차단(Non-blocking) I/O 사용</li><li>데이터 스트림 기반 처리</li><li>백프레셔(Backpressure) 지원으로 부하 관리</li><li>선언적인 데이터 흐름 처리</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22>22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23>23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24>24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25>25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26>26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27>27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28>28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29>29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30>30</a>
</span><span class=lnt id=hl-10-31><a class=lnlinks href=#hl-10-31>31</a>
</span><span class=lnt id=hl-10-32><a class=lnlinks href=#hl-10-32>32</a>
</span><span class=lnt id=hl-10-33><a class=lnlinks href=#hl-10-33>33</a>
</span><span class=lnt id=hl-10-34><a class=lnlinks href=#hl-10-34>34</a>
</span><span class=lnt id=hl-10-35><a class=lnlinks href=#hl-10-35>35</a>
</span><span class=lnt id=hl-10-36><a class=lnlinks href=#hl-10-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Spring WebFlux를 사용한 반응형 API 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/v1/products&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ProductController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ProductRepository</span><span class=w> </span><span class=n>productRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Flux</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getAllProducts</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productRepository</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Mono</span><span class=o>&lt;</span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=nf>getProductById</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>product</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>product</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>defaultIfEmpty</span><span class=p>(</span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Mono</span><span class=o>&lt;</span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=nf>createProduct</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>Mono</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=n>productMono</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productMono</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>flatMap</span><span class=p>(</span><span class=n>productRepository</span><span class=p>::</span><span class=n>save</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>savedProduct</span><span class=w> </span><span class=o>-&gt;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>created</span><span class=p>(</span><span class=n>URI</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=s>&#34;/api/v1/products/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>savedProduct</span><span class=p>.</span><span class=na>getId</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>savedProduct</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;/stream&#34;</span><span class=p>,</span><span class=w> </span><span class=n>produces</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MediaType</span><span class=p>.</span><span class=na>TEXT_EVENT_STREAM_VALUE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Flux</span><span class=o>&lt;</span><span class=n>ProductEvent</span><span class=o>&gt;</span><span class=w> </span><span class=nf>streamProductEvents</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Flux</span><span class=p>.</span><span class=na>interval</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>1</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>sequence</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ProductEvent</span><span class=p>(</span><span class=n>sequence</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Product Event&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=graphql을-활용한-유연한-api-설계>GraphQL을 활용한 유연한 API 설계<a hidden class=anchor aria-hidden=true href=#graphql을-활용한-유연한-api-설계>#</a></h4><p>GraphQL은 클라이언트가 필요한 데이터를 정확히 지정할 수 있게 해주는 쿼리 언어로, 동기식과 비동기식 처리를 모두 지원한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// GraphQL 스키마 정의 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>type</span><span class=w> </span><span class=n>Query</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>product</span><span class=p>(</span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=n>ID</span><span class=o>!</span><span class=p>):</span><span class=w> </span><span class=n>Product</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nf>products</span><span class=p>(</span><span class=n>category</span><span class=p>:</span><span class=w> </span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>limit</span><span class=p>:</span><span class=w> </span><span class=n>Int</span><span class=p>):</span><span class=w> </span><span class=o>[</span><span class=n>Product</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>type</span><span class=w> </span><span class=n>Mutation</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>createProduct</span><span class=p>(</span><span class=n>input</span><span class=p>:</span><span class=w> </span><span class=n>ProductInput</span><span class=o>!</span><span class=p>):</span><span class=w> </span><span class=n>Product</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nf>updateProduct</span><span class=p>(</span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=n>ID</span><span class=o>!</span><span class=p>,</span><span class=w> </span><span class=n>input</span><span class=p>:</span><span class=w> </span><span class=n>ProductInput</span><span class=o>!</span><span class=p>):</span><span class=w> </span><span class=n>Product</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nf>deleteProduct</span><span class=p>(</span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=n>ID</span><span class=o>!</span><span class=p>):</span><span class=w> </span><span class=n>Boolean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>type</span><span class=w> </span><span class=n>Subscription</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>productUpdated</span><span class=p>:</span><span class=w> </span><span class=n>Product</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nf>newProductInCategory</span><span class=p>(</span><span class=n>category</span><span class=p>:</span><span class=w> </span><span class=n>String</span><span class=o>!</span><span class=p>):</span><span class=w> </span><span class=n>Product</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>type</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=n>ID</span><span class=o>!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>name</span><span class=p>:</span><span class=w> </span><span class=n>String</span><span class=o>!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>description</span><span class=p>:</span><span class=w> </span><span class=n>String</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>price</span><span class=p>:</span><span class=w> </span><span class=n>Float</span><span class=o>!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>category</span><span class=p>:</span><span class=w> </span><span class=n>String</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>inStock</span><span class=p>:</span><span class=w> </span><span class=n>Boolean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>input</span><span class=w> </span><span class=n>ProductInput</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>name</span><span class=p>:</span><span class=w> </span><span class=n>String</span><span class=o>!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>description</span><span class=p>:</span><span class=w> </span><span class=n>String</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>price</span><span class=p>:</span><span class=w> </span><span class=n>Float</span><span class=o>!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>category</span><span class=p>:</span><span class=w> </span><span class=n>String</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a>
</span><span class=lnt id=hl-12-31><a class=lnlinks href=#hl-12-31>31</a>
</span><span class=lnt id=hl-12-32><a class=lnlinks href=#hl-12-32>32</a>
</span><span class=lnt id=hl-12-33><a class=lnlinks href=#hl-12-33>33</a>
</span><span class=lnt id=hl-12-34><a class=lnlinks href=#hl-12-34>34</a>
</span><span class=lnt id=hl-12-35><a class=lnlinks href=#hl-12-35>35</a>
</span><span class=lnt id=hl-12-36><a class=lnlinks href=#hl-12-36>36</a>
</span><span class=lnt id=hl-12-37><a class=lnlinks href=#hl-12-37>37</a>
</span><span class=lnt id=hl-12-38><a class=lnlinks href=#hl-12-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Spring GraphQL을 사용한 리졸버 구현 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ProductResolver</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ProductService</span><span class=w> </span><span class=n>productService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ReactiveStreamsPublisher</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=n>productPublisher</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 쿼리 리졸버 (동기식)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@QueryMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=nf>product</span><span class=p>(</span><span class=nd>@Argument</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productService</span><span class=p>.</span><span class=na>getProductById</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@QueryMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>products</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Argument</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>category</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Argument</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>limit</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productService</span><span class=p>.</span><span class=na>findProducts</span><span class=p>(</span><span class=n>category</span><span class=p>,</span><span class=w> </span><span class=n>limit</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 뮤테이션 리졸버 (비동기식으로도 구현 가능)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@MutationMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Mono</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>createProduct</span><span class=p>(</span><span class=nd>@Argument</span><span class=w> </span><span class=n>ProductInput</span><span class=w> </span><span class=n>input</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productService</span><span class=p>.</span><span class=na>createProductAsync</span><span class=p>(</span><span class=n>input</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 구독 리졸버 (비동기식)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@SubscriptionMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Publisher</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>productUpdated</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productPublisher</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@SubscriptionMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Publisher</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>newProductInCategory</span><span class=p>(</span><span class=nd>@Argument</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>category</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productPublisher</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>product</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>category</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>product</span><span class=p>.</span><span class=na>getCategory</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=서버리스-아키텍처와-api-통합>서버리스 아키텍처와 API 통합<a hidden class=anchor aria-hidden=true href=#서버리스-아키텍처와-api-통합>#</a></h4><p>서버리스 아키텍처는 비동기 API 패턴과 자연스럽게 어울리며, 확장성과 비용 효율성을 제공한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>  1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>  2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>  3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>  4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>  5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6>  6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7>  7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8>  8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9>  9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10> 10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11> 11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12> 12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13> 13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14> 14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15> 15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16> 16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17> 17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18> 18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19> 19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20> 20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21> 21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22> 22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23> 23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24> 24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25> 25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26> 26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27> 27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28> 28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29> 29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30> 30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31> 31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32> 32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33> 33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34> 34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35> 35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36> 36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37> 37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38> 38</a>
</span><span class=lnt id=hl-13-39><a class=lnlinks href=#hl-13-39> 39</a>
</span><span class=lnt id=hl-13-40><a class=lnlinks href=#hl-13-40> 40</a>
</span><span class=lnt id=hl-13-41><a class=lnlinks href=#hl-13-41> 41</a>
</span><span class=lnt id=hl-13-42><a class=lnlinks href=#hl-13-42> 42</a>
</span><span class=lnt id=hl-13-43><a class=lnlinks href=#hl-13-43> 43</a>
</span><span class=lnt id=hl-13-44><a class=lnlinks href=#hl-13-44> 44</a>
</span><span class=lnt id=hl-13-45><a class=lnlinks href=#hl-13-45> 45</a>
</span><span class=lnt id=hl-13-46><a class=lnlinks href=#hl-13-46> 46</a>
</span><span class=lnt id=hl-13-47><a class=lnlinks href=#hl-13-47> 47</a>
</span><span class=lnt id=hl-13-48><a class=lnlinks href=#hl-13-48> 48</a>
</span><span class=lnt id=hl-13-49><a class=lnlinks href=#hl-13-49> 49</a>
</span><span class=lnt id=hl-13-50><a class=lnlinks href=#hl-13-50> 50</a>
</span><span class=lnt id=hl-13-51><a class=lnlinks href=#hl-13-51> 51</a>
</span><span class=lnt id=hl-13-52><a class=lnlinks href=#hl-13-52> 52</a>
</span><span class=lnt id=hl-13-53><a class=lnlinks href=#hl-13-53> 53</a>
</span><span class=lnt id=hl-13-54><a class=lnlinks href=#hl-13-54> 54</a>
</span><span class=lnt id=hl-13-55><a class=lnlinks href=#hl-13-55> 55</a>
</span><span class=lnt id=hl-13-56><a class=lnlinks href=#hl-13-56> 56</a>
</span><span class=lnt id=hl-13-57><a class=lnlinks href=#hl-13-57> 57</a>
</span><span class=lnt id=hl-13-58><a class=lnlinks href=#hl-13-58> 58</a>
</span><span class=lnt id=hl-13-59><a class=lnlinks href=#hl-13-59> 59</a>
</span><span class=lnt id=hl-13-60><a class=lnlinks href=#hl-13-60> 60</a>
</span><span class=lnt id=hl-13-61><a class=lnlinks href=#hl-13-61> 61</a>
</span><span class=lnt id=hl-13-62><a class=lnlinks href=#hl-13-62> 62</a>
</span><span class=lnt id=hl-13-63><a class=lnlinks href=#hl-13-63> 63</a>
</span><span class=lnt id=hl-13-64><a class=lnlinks href=#hl-13-64> 64</a>
</span><span class=lnt id=hl-13-65><a class=lnlinks href=#hl-13-65> 65</a>
</span><span class=lnt id=hl-13-66><a class=lnlinks href=#hl-13-66> 66</a>
</span><span class=lnt id=hl-13-67><a class=lnlinks href=#hl-13-67> 67</a>
</span><span class=lnt id=hl-13-68><a class=lnlinks href=#hl-13-68> 68</a>
</span><span class=lnt id=hl-13-69><a class=lnlinks href=#hl-13-69> 69</a>
</span><span class=lnt id=hl-13-70><a class=lnlinks href=#hl-13-70> 70</a>
</span><span class=lnt id=hl-13-71><a class=lnlinks href=#hl-13-71> 71</a>
</span><span class=lnt id=hl-13-72><a class=lnlinks href=#hl-13-72> 72</a>
</span><span class=lnt id=hl-13-73><a class=lnlinks href=#hl-13-73> 73</a>
</span><span class=lnt id=hl-13-74><a class=lnlinks href=#hl-13-74> 74</a>
</span><span class=lnt id=hl-13-75><a class=lnlinks href=#hl-13-75> 75</a>
</span><span class=lnt id=hl-13-76><a class=lnlinks href=#hl-13-76> 76</a>
</span><span class=lnt id=hl-13-77><a class=lnlinks href=#hl-13-77> 77</a>
</span><span class=lnt id=hl-13-78><a class=lnlinks href=#hl-13-78> 78</a>
</span><span class=lnt id=hl-13-79><a class=lnlinks href=#hl-13-79> 79</a>
</span><span class=lnt id=hl-13-80><a class=lnlinks href=#hl-13-80> 80</a>
</span><span class=lnt id=hl-13-81><a class=lnlinks href=#hl-13-81> 81</a>
</span><span class=lnt id=hl-13-82><a class=lnlinks href=#hl-13-82> 82</a>
</span><span class=lnt id=hl-13-83><a class=lnlinks href=#hl-13-83> 83</a>
</span><span class=lnt id=hl-13-84><a class=lnlinks href=#hl-13-84> 84</a>
</span><span class=lnt id=hl-13-85><a class=lnlinks href=#hl-13-85> 85</a>
</span><span class=lnt id=hl-13-86><a class=lnlinks href=#hl-13-86> 86</a>
</span><span class=lnt id=hl-13-87><a class=lnlinks href=#hl-13-87> 87</a>
</span><span class=lnt id=hl-13-88><a class=lnlinks href=#hl-13-88> 88</a>
</span><span class=lnt id=hl-13-89><a class=lnlinks href=#hl-13-89> 89</a>
</span><span class=lnt id=hl-13-90><a class=lnlinks href=#hl-13-90> 90</a>
</span><span class=lnt id=hl-13-91><a class=lnlinks href=#hl-13-91> 91</a>
</span><span class=lnt id=hl-13-92><a class=lnlinks href=#hl-13-92> 92</a>
</span><span class=lnt id=hl-13-93><a class=lnlinks href=#hl-13-93> 93</a>
</span><span class=lnt id=hl-13-94><a class=lnlinks href=#hl-13-94> 94</a>
</span><span class=lnt id=hl-13-95><a class=lnlinks href=#hl-13-95> 95</a>
</span><span class=lnt id=hl-13-96><a class=lnlinks href=#hl-13-96> 96</a>
</span><span class=lnt id=hl-13-97><a class=lnlinks href=#hl-13-97> 97</a>
</span><span class=lnt id=hl-13-98><a class=lnlinks href=#hl-13-98> 98</a>
</span><span class=lnt id=hl-13-99><a class=lnlinks href=#hl-13-99> 99</a>
</span><span class=lnt id=hl-13-100><a class=lnlinks href=#hl-13-100>100</a>
</span><span class=lnt id=hl-13-101><a class=lnlinks href=#hl-13-101>101</a>
</span><span class=lnt id=hl-13-102><a class=lnlinks href=#hl-13-102>102</a>
</span><span class=lnt id=hl-13-103><a class=lnlinks href=#hl-13-103>103</a>
</span><span class=lnt id=hl-13-104><a class=lnlinks href=#hl-13-104>104</a>
</span><span class=lnt id=hl-13-105><a class=lnlinks href=#hl-13-105>105</a>
</span><span class=lnt id=hl-13-106><a class=lnlinks href=#hl-13-106>106</a>
</span><span class=lnt id=hl-13-107><a class=lnlinks href=#hl-13-107>107</a>
</span><span class=lnt id=hl-13-108><a class=lnlinks href=#hl-13-108>108</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// AWS Lambda와 API Gateway를 사용한 서버리스 비동기 API 예시
</span></span></span><span class=line><span class=cl><span class=c1>// Lambda 함수 (API 엔드포인트)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>exports</span><span class=p>.</span><span class=nx>initiateProcessing</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>requestBody</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>jobId</span> <span class=o>=</span> <span class=nx>uuidv4</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// DynamoDB에 작업 메타데이터 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>dynamoDb</span><span class=p>.</span><span class=nx>put</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>TableName</span><span class=o>:</span> <span class=s1>&#39;Jobs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Item</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>jobId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;PROCESSING&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>input</span><span class=o>:</span> <span class=nx>requestBody</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>createdAt</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// SQS에 처리 작업 메시지 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>sqs</span><span class=p>.</span><span class=nx>sendMessage</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>QueueUrl</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PROCESSING_QUEUE_URL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>MessageBody</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>jobId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>payload</span><span class=o>:</span> <span class=nx>requestBody</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 즉시 응답
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>statusCode</span><span class=o>:</span> <span class=mi>202</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>jobId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;PROCESSING&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusUrl</span><span class=o>:</span> <span class=sb>`/jobs/</span><span class=si>${</span><span class=nx>jobId</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 작업 처리 Lambda 함수 (SQS 트리거)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>exports</span><span class=p>.</span><span class=nx>processJob</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>record</span> <span class=k>of</span> <span class=nx>event</span><span class=p>.</span><span class=nx>Records</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>jobId</span><span class=p>,</span> <span class=nx>payload</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>record</span><span class=p>.</span><span class=nx>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 실제 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>processData</span><span class=p>(</span><span class=nx>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 처리 결과 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>dynamoDb</span><span class=p>.</span><span class=nx>update</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>TableName</span><span class=o>:</span> <span class=s1>&#39;Jobs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Key</span><span class=o>:</span> <span class=p>{</span> <span class=nx>jobId</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>UpdateExpression</span><span class=o>:</span> <span class=s1>&#39;SET #status = :status, result = :result, completedAt = :completedAt&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>ExpressionAttributeNames</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;#status&#39;</span><span class=o>:</span> <span class=s1>&#39;status&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>ExpressionAttributeValues</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;:status&#39;</span><span class=o>:</span> <span class=s1>&#39;COMPLETED&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;:result&#39;</span><span class=o>:</span> <span class=nx>result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;:completedAt&#39;</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}).</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 선택적: SNS 토픽으로 완료 알림 전송
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>sns</span><span class=p>.</span><span class=nx>publish</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>TopicArn</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JOB_COMPLETION_TOPIC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Message</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>jobId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;COMPLETED&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>completedAt</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}).</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 오류 처리 및 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>dynamoDb</span><span class=p>.</span><span class=nx>update</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>TableName</span><span class=o>:</span> <span class=s1>&#39;Jobs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Key</span><span class=o>:</span> <span class=p>{</span> <span class=nx>jobId</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>UpdateExpression</span><span class=o>:</span> <span class=s1>&#39;SET #status = :status, errorMessage = :error, updatedAt = :updatedAt&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>ExpressionAttributeNames</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;#status&#39;</span><span class=o>:</span> <span class=s1>&#39;status&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>ExpressionAttributeValues</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;:status&#39;</span><span class=o>:</span> <span class=s1>&#39;FAILED&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;:error&#39;</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;:updatedAt&#39;</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}).</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 작업 상태 확인 Lambda 함수
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>exports</span><span class=p>.</span><span class=nx>getJobStatus</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>jobId</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>pathParameters</span><span class=p>.</span><span class=nx>jobId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>dynamoDb</span><span class=p>.</span><span class=nx>get</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>TableName</span><span class=o>:</span> <span class=s1>&#39;Jobs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Key</span><span class=o>:</span> <span class=p>{</span> <span class=nx>jobId</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>result</span><span class=p>.</span><span class=nx>Item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusCode</span><span class=o>:</span> <span class=mi>404</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Job not found&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>statusCode</span><span class=o>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>Item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=이벤트-기반-아키텍처event-driven-architecture>이벤트 기반 아키텍처(Event-Driven Architecture)<a hidden class=anchor aria-hidden=true href=#이벤트-기반-아키텍처event-driven-architecture>#</a></h4><p>이벤트 기반 아키텍처는 비동기 API 패턴의 자연스러운 확장으로, 시스템 구성 요소 간의 느슨한 결합을 촉진한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26>26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27>27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28>28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29>29</a>
</span><span class=lnt id=hl-14-30><a class=lnlinks href=#hl-14-30>30</a>
</span><span class=lnt id=hl-14-31><a class=lnlinks href=#hl-14-31>31</a>
</span><span class=lnt id=hl-14-32><a class=lnlinks href=#hl-14-32>32</a>
</span><span class=lnt id=hl-14-33><a class=lnlinks href=#hl-14-33>33</a>
</span><span class=lnt id=hl-14-34><a class=lnlinks href=#hl-14-34>34</a>
</span><span class=lnt id=hl-14-35><a class=lnlinks href=#hl-14-35>35</a>
</span><span class=lnt id=hl-14-36><a class=lnlinks href=#hl-14-36>36</a>
</span><span class=lnt id=hl-14-37><a class=lnlinks href=#hl-14-37>37</a>
</span><span class=lnt id=hl-14-38><a class=lnlinks href=#hl-14-38>38</a>
</span><span class=lnt id=hl-14-39><a class=lnlinks href=#hl-14-39>39</a>
</span><span class=lnt id=hl-14-40><a class=lnlinks href=#hl-14-40>40</a>
</span><span class=lnt id=hl-14-41><a class=lnlinks href=#hl-14-41>41</a>
</span><span class=lnt id=hl-14-42><a class=lnlinks href=#hl-14-42>42</a>
</span><span class=lnt id=hl-14-43><a class=lnlinks href=#hl-14-43>43</a>
</span><span class=lnt id=hl-14-44><a class=lnlinks href=#hl-14-44>44</a>
</span><span class=lnt id=hl-14-45><a class=lnlinks href=#hl-14-45>45</a>
</span><span class=lnt id=hl-14-46><a class=lnlinks href=#hl-14-46>46</a>
</span><span class=lnt id=hl-14-47><a class=lnlinks href=#hl-14-47>47</a>
</span><span class=lnt id=hl-14-48><a class=lnlinks href=#hl-14-48>48</a>
</span><span class=lnt id=hl-14-49><a class=lnlinks href=#hl-14-49>49</a>
</span><span class=lnt id=hl-14-50><a class=lnlinks href=#hl-14-50>50</a>
</span><span class=lnt id=hl-14-51><a class=lnlinks href=#hl-14-51>51</a>
</span><span class=lnt id=hl-14-52><a class=lnlinks href=#hl-14-52>52</a>
</span><span class=lnt id=hl-14-53><a class=lnlinks href=#hl-14-53>53</a>
</span><span class=lnt id=hl-14-54><a class=lnlinks href=#hl-14-54>54</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Spring Cloud Stream을 사용한 이벤트 기반 마이크로서비스 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/v1/orders&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>OrderService</span><span class=w> </span><span class=n>orderService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>StreamBridge</span><span class=w> </span><span class=n>streamBridge</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>OrderResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>createOrder</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>OrderRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 주문 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderService</span><span class=p>.</span><span class=na>createOrder</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 주문 생성 이벤트 발행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OrderCreatedEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>getCustomerId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>getItems</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>getTotalAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>streamBridge</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=s>&#34;orderCreatedChannel&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 응답 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>created</span><span class=p>(</span><span class=n>URI</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=s>&#34;/api/v1/orders/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>OrderResponse</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=s>&#34;CREATED&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 이벤트 소비자 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderEventConsumer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>InventoryService</span><span class=w> </span><span class=n>inventoryService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Consumer</span><span class=o>&lt;</span><span class=n>OrderCreatedEvent</span><span class=o>&gt;</span><span class=w> </span><span class=nf>processOrderCreated</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Received order created event: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 재고 확인 및 할당</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>inventoryService</span><span class=p>.</span><span class=na>allocateInventory</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>(),</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getItems</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Inventory allocated for order: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Failed to allocate inventory for order {}: {}&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>event</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>(),</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 보상 트랜잭션 또는 오류 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=성능-최적화-및-모니터링>성능 최적화 및 모니터링<a hidden class=anchor aria-hidden=true href=#성능-최적화-및-모니터링>#</a></h3><p>API 패턴 선택과 더불어 성능 최적화와 모니터링은 효과적인 API 구현을 위해 중요하다.</p><h4 id=성능-최적화-전략>성능 최적화 전략<a hidden class=anchor aria-hidden=true href=#성능-최적화-전략>#</a></h4><ol><li><strong>커넥션 풀링</strong>: 데이터베이스 및 서비스 간 연결 풀을 효율적으로 관리한다.</li><li><strong>비동기 I/O</strong>: 네트워크 및 디스크 I/O 작업에 비동기 패턴을 적용하여 자원 활용도를 높인다.</li><li><strong>캐싱 전략</strong>: 적절한 캐싱을 통해 반복적인 계산이나 요청을 줄인다.</li><li><strong>배치 처리</strong>: 여러 요청을 그룹화하여 처리함으로써 오버헤드를 줄인다.</li><li><strong>적절한 타임아웃 설정</strong>: 리소스가 불필요하게 점유되는 것을 방지한다.</li></ol><h4 id=api-모니터링-및-관측성>API 모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#api-모니터링-및-관측성>#</a></h4><ol><li><strong>핵심 지표 추적</strong>:<ul><li>응답 시간 (평균, 95번째 백분위수, 99번째 백분위수)</li><li>요청 처리량(throughput)</li><li>오류율</li><li>활성 요청 수</li><li>자원 활용률 (CPU, 메모리, 네트워크)</li></ul></li><li><strong>분산 추적</strong>: 마이크로서비스 환경에서 요청 흐름을 추적하여 병목 현상 식별</li><li><strong>로깅 전략</strong>: 구조화된 로깅으로 문제 해결 및 분석 용이</li><li><strong>알림 설정</strong>: 성능 문제나 오류 발생 시 신속하게 대응할 수 있도록 알림 설정</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25>25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26>26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27>27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28>28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29>29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30>30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31>31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32>32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33>33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34>34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35>35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36>36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37>37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38>38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39>39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40>40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41>41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42>42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43>43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44>44</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Micrometer를 사용한 API 성능 지표 측정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ApiMetrics</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MeterRegistry</span><span class=w> </span><span class=n>meterRegistry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ApiMetrics</span><span class=p>(</span><span class=n>MeterRegistry</span><span class=w> </span><span class=n>meterRegistry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>meterRegistry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>meterRegistry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Around</span><span class=p>(</span><span class=s>&#34;@annotation(org.springframework.web.bind.annotation.RequestMapping) || &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;@annotation(org.springframework.web.bind.annotation.GetMapping) || &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;@annotation(org.springframework.web.bind.annotation.PostMapping) || &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;@annotation(org.springframework.web.bind.annotation.PutMapping) || &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;@annotation(org.springframework.web.bind.annotation.DeleteMapping)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>measureApiPerformance</span><span class=p>(</span><span class=n>ProceedingJoinPoint</span><span class=w> </span><span class=n>joinPoint</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>methodName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getSignature</span><span class=p>().</span><span class=na>getName</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>className</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getSignature</span><span class=p>().</span><span class=na>getDeclaringTypeName</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>endpointTag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>className</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;.&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>methodName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Timer</span><span class=p>.</span><span class=na>Sample</span><span class=w> </span><span class=n>sample</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Timer</span><span class=p>.</span><span class=na>start</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>boolean</span><span class=w> </span><span class=n>success</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Object</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>proceed</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>success</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Timer</span><span class=w> </span><span class=n>timer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Timer</span><span class=p>.</span><span class=na>builder</span><span class=p>(</span><span class=s>&#34;api.request.duration&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;endpoint&#34;</span><span class=p>,</span><span class=w> </span><span class=n>endpointTag</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;success&#34;</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>success</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>publishPercentiles</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>5</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>95</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>99</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>sample</span><span class=p>.</span><span class=na>stop</span><span class=p>(</span><span class=n>timer</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Counter</span><span class=p>.</span><span class=na>builder</span><span class=p>(</span><span class=s>&#34;api.request.count&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;endpoint&#34;</span><span class=p>,</span><span class=w> </span><span class=n>endpointTag</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;success&#34;</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>success</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>increment</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=synchronous-vs-asynchronous-apis-비교>Synchronous vs. Asynchronous APIs 비교<a hidden class=anchor aria-hidden=true href=#synchronous-vs-asynchronous-apis-비교>#</a></h3><ol><li><strong>동기식 API</strong>는 단순성과 즉각적인 응답이 중요한 경우에 적합하지만, 긴 처리 시간과 높은 부하에 취약할 수 있다.</li><li><strong>비동기식 API</strong>는 장시간 실행 작업과 높은 처리량을 위해 설계되었지만, 구현과 테스트가 더 복잡할 수 있다.</li><li><strong>혼합 접근법</strong>은 많은 실제 애플리케이션에서 가장 효과적인 솔루션을 제공하며, 각 작업의 특성에 따라 적절한 패턴을 적용할 수 있다.</li><li>적절한 API 패턴 선택은 작업 특성, 사용자 경험 요구사항, 시스템 부하 및 확장성 요구사항을 고려해야 한다.</li><li>성능 최적화와 지속적인 모니터링은 어떤 패턴을 선택하든 필수적이다.</li></ol><table><thead><tr><th>카테고리</th><th>동기(Synchronous)</th><th>비동기(Asynchronous)</th></tr></thead><tbody><tr><td><strong>기본 개념</strong></td><td>- 작업이 순차적으로 실행됨</td><td>- 작업이 독립적으로 실행됨</td></tr><tr><td></td><td>- 이전 작업이 완료될 때까지 다음 작업 대기</td><td>- 작업의 완료를 기다리지 않고 다음 작업 진행</td></tr><tr><td></td><td>- 실행 순서가 보장됨</td><td>- 실행 순서가 보장되지 않음</td></tr><tr><td><strong>처리 방식</strong></td><td>- 단일 스레드에서 순차적 처리</td><td>- 멀티 스레드 또는 이벤트 루프 기반 처리</td></tr><tr><td></td><td>- 작업 완료까지 대기</td><td>- 작업 완료 시 콜백/Promise/async-await 등으로 처리</td></tr><tr><td></td><td>- 직관적인 코드 흐름</td><td>- 비선형적 코드 흐름</td></tr><tr><td><strong>장점</strong></td><td>- 코드의 가독성이 좋음</td><td>- 시스템 자원의 효율적 사용</td></tr><tr><td></td><td>- 디버깅이 용이함</td><td>- 더 나은 사용자 경험 제공</td></tr><tr><td></td><td>- 에러 처리가 간단함</td><td>- 높은 처리량(Throughput)</td></tr><tr><td><strong>단점</strong></td><td>- 시스템 자원 비효율적 사용</td><td>- 코드의 복잡성 증가</td></tr><tr><td></td><td>- 응답 시간이 길어질 수 있음</td><td>- 디버깅이 어려움</td></tr><tr><td></td><td>- 사용자 경험 저하 가능성</td><td>- 에러 처리가 복잡함</td></tr><tr><td><strong>적합한 사용 사례</strong></td><td>- 간단한 계산 작업</td><td>- 네트워크 요청</td></tr><tr><td></td><td>- 메모리 내 데이터 처리</td><td>- 파일 입출력</td></tr><tr><td></td><td>- 작은 크기의 데이터 처리</td><td>- 대용량 데이터 처리</td></tr><tr><td></td><td>- 순차적 처리가 필요한 작업</td><td>- 독립적으로 실행 가능한 작업</td></tr><tr><td><strong>에러 처리</strong></td><td>- try-catch 블록으로 직접 처리</td><td>- Promise의 catch 또는 try-catch와 async-await 사용</td></tr><tr><td></td><td>- 즉시 에러 감지 및 처리</td><td>- 에러 처리가 비동기적으로 발생</td></tr><tr><td></td><td>- 스택 트레이스 추적이 용이</td><td>- 에러 발생 지점 추적이 복잡할 수 있음</td></tr><tr><td><strong>성능 특성</strong></td><td>- CPU 집약적 작업에 유리</td><td>- I/O 집약적 작업에 유리</td></tr><tr><td></td><td>- 메모리 사용량이 예측 가능</td><td>- 동시 처리로 인한 메모리 사용량 변동</td></tr><tr><td></td><td>- 단일 작업 처리 시간이 빠름</td><td>- 전체 처리량 최적화에 유리</td></tr><tr><td><strong>코드 관리</strong></td><td>- 코드 구조가 단순함</td><td>- 상태 관리가 필요함</td></tr><tr><td></td><td>- 유지보수가 상대적으로 쉬움</td><td>- 비동기 패턴에 대한 이해 필요</td></tr><tr><td></td><td>- 테스트 작성이 용이함</td><td>- 테스트 시나리오가 복잡할 수 있음</td></tr><tr><td><strong>리소스 활용</strong></td><td>- 단일 리소스 점유</td><td>- 리소스의 효율적 분배</td></tr><tr><td></td><td>- 대기 시간 동안 블로킹</td><td>- 대기 시간 동안 다른 작업 수행</td></tr><tr><td></td><td>- 시스템 부하가 예측 가능</td><td>- 동시성으로 인한 부하 변동 가능</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/backend/>Backend</a></li><li><a href=https://buenhyden.github.io/tags/api-design/>API-Design</a></li><li><a href=https://buenhyden.github.io/tags/api-integration-patterns/>API-Integration-Patterns</a></li><li><a href=https://buenhyden.github.io/tags/synchronous-vs-asynchronous-apis/>Synchronous-vs-Asynchronous-APIs</a></li><li><a href=https://buenhyden.github.io/tags/synchronous/>Synchronous</a></li><li><a href=https://buenhyden.github.io/tags/asynchronous/>Asynchronous</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/computer-science/fundamentals/blocking-vs-non-blocking/><span class=title>« Prev</span><br><span>Blocking vs Non-Blocking</span>
</a><a class=next href=https://buenhyden.github.io/posts/computer-science/fundamentals/programming-paradigms/imperative-programming/oop/paradigm-features/interface-vs-abstract-class/><span class=title>Next »</span><br><span>Interface vs Abstract class</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>