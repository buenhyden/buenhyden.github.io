<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>N+1 | hyunyoun's Blog</title>
<meta name=keywords content="Backend,Database-Systems,ORM"><meta name=description content="N+1 문제는 하나의 쿼리로 N개의 엔티티를 조회한 후, 각 엔티티와 연관된 데이터를 조회하기 위해 N번의 추가 쿼리가 발생하는 현상을 말한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/backend/database-systems/orm/n+1/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.9a2bbe2d8b5afa9d4df22976abb7b72f1f7f1c467d2b30f03090108f9496ae6c.css integrity="sha256-miu+LYta+p1N8il2q7e3Lx9/HEZ9KzDwMJAQj5SWrmw=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/backend/database-systems/orm/n+1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/backend/database-systems/orm/n+1/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="N+1"><meta property="og:description" content="N+1 문제는 하나의 쿼리로 N개의 엔티티를 조회한 후, 각 엔티티와 연관된 데이터를 조회하기 위해 N번의 추가 쿼리가 발생하는 현상을 말한다."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-25T11:21:00+00:00"><meta property="article:modified_time" content="2024-11-25T11:21:00+00:00"><meta property="article:tag" content="Backend"><meta property="article:tag" content="Database-Systems"><meta property="article:tag" content="ORM"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="N+1"><meta name=twitter:description content="N+1 문제는 하나의 쿼리로 N개의 엔티티를 조회한 후, 각 엔티티와 연관된 데이터를 조회하기 위해 N번의 추가 쿼리가 발생하는 현상을 말한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Backend","item":"https://buenhyden.github.io/posts/backend/"},{"@type":"ListItem","position":3,"name":"데이터베이스 (Database)","item":"https://buenhyden.github.io/posts/backend/database-systems/"},{"@type":"ListItem","position":4,"name":"ORM(Object-Relational Mapping)","item":"https://buenhyden.github.io/posts/backend/database-systems/orm/"},{"@type":"ListItem","position":5,"name":"N+1","item":"https://buenhyden.github.io/posts/backend/database-systems/orm/n+1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"N+1","name":"N\u002b1","description":"N+1 문제는 하나의 쿼리로 N개의 엔티티를 조회한 후, 각 엔티티와 연관된 데이터를 조회하기 위해 N번의 추가 쿼리가 발생하는 현상을 말한다.","keywords":["Backend","Database-Systems","ORM"],"articleBody":"N+1 N+1 문제는 하나의 쿼리로 N개의 엔티티를 조회한 후, 각 엔티티와 연관된 데이터를 조회하기 위해 N번의 추가 쿼리가 발생하는 현상을 말한다.\n주로 ORM(Object-Relational Mapping) 기술을 사용할 때 발생하는 성능 관련 이슈로 데이터베이스에 불필요하게 많은 쿼리를 실행하게 되는 상황을 말한다.\n발생 원인 연관 관계 매핑: 주로 1:N 또는 N:1 관계를 가진 엔티티를 조회할 때 발생한다. 지연 로딩(Lazy Loading): 연관된 엔티티를 실제로 사용할 때 추가적인 쿼리가 발생한다. 즉시 로딩(Eager Loading): 연관된 엔티티를 함께 조회하려 할 때 추가 쿼리가 발생할 수 있다. 문제점 성능 저하: 불필요한 데이터베이스 쿼리로 인해 애플리케이션의 성능이 크게 저하된다. 네트워크 부하: 데이터베이스와의 통신이 증가하여 네트워크 부하가 증가한다. 데이터베이스 부하: 과도한 쿼리 실행으로 데이터베이스 서버에 부담을 준다. 이러한 N+1 문제는 데이터베이스 성능에 큰 영향을 미칠 수 있으므로, 개발 초기 단계부터 인지하고 적절한 해결 방법을 적용하는 것이 중요하다.\n특히 대규모 애플리케이션에서는 이 문제를 해결하지 않으면 심각한 성능 저하를 경험할 수 있다.\nN+1 문제가 어떻게 발생하는지에 대한 간단한 예시:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 블로그 게시물과 댓글의 관계를 나타내는 모델 class Post(models.Model): title = models.CharField(max_length=200) content = models.TextField() class Comment(models.Model): post = models.ForeignKey(Post, related_name='comments') content = models.TextField() # N+1 문제가 발생하는 코드 def get_posts_with_comments(): # 첫 번째 쿼리: 모든 게시물을 가져옴 posts = Post.objects.all() # 1번의 쿼리 # 각 게시물마다 댓글을 가져오는 추가 쿼리가 발생 for post in posts: comments = post.comments.all() # N번의 추가 쿼리 print(f\"Post: {post.title}, Comments: {len(comments)}\") 1 2 3 4 5 6 7 8 9 -- 첫 번째 쿼리 (1번) SELECT * FROM posts LIMIT 5; -- 이후 각 게시물마다 실행되는 쿼리 (N번) SELECT * FROM comments WHERE post_id = 1; SELECT * FROM comments WHERE post_id = 2; SELECT * FROM comments WHERE post_id = 3; SELECT * FROM comments WHERE post_id = 4; SELECT * FROM comments WHERE post_id = 5; 위 코드에서 발생하는 문제를 단계별로 설명하면,\n첫 번째 쿼리에서 모든 게시물을 가져온다 (1번의 쿼리) 각 게시물에 대해 댓글을 가져오는 별도의 쿼리가 실행된다 (N번의 쿼리) 결과적으로 총 N+1번의 데이터베이스 쿼리가 실행된다 N+1 문제를 해결하기 위한 일반적인 접근 방법 Eager Loading (즉시 로딩): 연관된 엔티티를 함께 로드하여 추가 쿼리를 방지한다. Fetch Join: 쿼리 작성 시 연관된 엔티티를 명시적으로 함께 조회하도록 지정한다. Batch Size 조정: 연관된 엔티티를 일괄적으로 조회하여 쿼리 수를 줄인다. 쿼리 최적화: 필요한 데이터만 선택적으로 조회하여 불필요한 쿼리를 줄인다. 캐싱: 자주 사용되는 데이터를 캐시하여 반복적인 쿼리를 줄인다. 모범 사례와 주의사항 적절한 패치 전략 선택\n필요한 데이터만 조회 페이징이 필요한 경우 고려 메모리 사용량 고려 캐싱 전략 활용\n성능 테스트 수행\n대용량 데이터에서의 동작 확인 메모리 사용량 모니터링 응답 시간 측정 N+1 문제를 방지하기 위한 설계 원칙 데이터 접근 패턴 분석\n애플리케이션에서 실제로 필요한 데이터가 무엇인지 파악 불필요한 데이터 조회 최소화 적절한 쿼리 최적화 전략 선택\nJOIN 사용이 적절한 경우 일괄 조회가 더 효율적인 경우 지연 로딩이 필요한 경우 성능 모니터링\n실행되는 쿼리의 수 추적 쿼리 실행 시간 모니터링 병목 지점 식별 참고 및 출처 ","wordCount":"472","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-11-25T11:21:00Z","dateModified":"2024-11-25T11:21:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/backend/database-systems/orm/n+1/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>posts</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend/>Backend</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend/database-systems/>데이터베이스 (Database)</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend/database-systems/orm/>ORM(Object-Relational Mapping)</a></div><h1 class="post-title entry-hint-parent">N+1</h1><div class=post-description>N+1 문제는 하나의 쿼리로 N개의 엔티티를 조회한 후, 각 엔티티와 연관된 데이터를 조회하기 위해 N번의 추가 쿼리가 발생하는 현상을 말한다.</div><div class=post-meta><span title='2024-11-25 11:21:00 +0000 UTC'>November 25, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;472 words&nbsp;·&nbsp;Me</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#n1>N+1</a><ul><li><a href=#발생-원인>발생 원인</a></li><li><a href=#문제점>문제점</a></li><li><a href=#n1-문제를-해결하기-위한-일반적인-접근-방법>N+1 문제를 해결하기 위한 일반적인 접근 방법</a></li><li><a href=#모범-사례와-주의사항>모범 사례와 주의사항</a></li><li><a href=#n1-문제를-방지하기-위한-설계-원칙>N+1 문제를 방지하기 위한 설계 원칙</a></li></ul></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=n1>N+1<a hidden class=anchor aria-hidden=true href=#n1>#</a></h2><p>N+1 문제는 하나의 쿼리로 N개의 엔티티를 조회한 후, 각 엔티티와 연관된 데이터를 조회하기 위해 N번의 추가 쿼리가 발생하는 현상을 말한다.<br>주로 ORM(Object-Relational Mapping) 기술을 사용할 때 발생하는 성능 관련 이슈로 데이터베이스에 불필요하게 많은 쿼리를 실행하게 되는 상황을 말한다.</p><h3 id=발생-원인>발생 원인<a hidden class=anchor aria-hidden=true href=#발생-원인>#</a></h3><ol><li>연관 관계 매핑: 주로 1:N 또는 N:1 관계를 가진 엔티티를 조회할 때 발생한다.</li><li>지연 로딩(Lazy Loading): 연관된 엔티티를 실제로 사용할 때 추가적인 쿼리가 발생한다.</li><li>즉시 로딩(Eager Loading): 연관된 엔티티를 함께 조회하려 할 때 추가 쿼리가 발생할 수 있다.</li></ol><h3 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h3><ol><li>성능 저하: 불필요한 데이터베이스 쿼리로 인해 애플리케이션의 성능이 크게 저하된다.</li><li>네트워크 부하: 데이터베이스와의 통신이 증가하여 네트워크 부하가 증가한다.</li><li>데이터베이스 부하: 과도한 쿼리 실행으로 데이터베이스 서버에 부담을 준다.</li></ol><p>이러한 N+1 문제는 데이터베이스 성능에 큰 영향을 미칠 수 있으므로, 개발 초기 단계부터 인지하고 적절한 해결 방법을 적용하는 것이 중요하다.<br>특히 대규모 애플리케이션에서는 이 문제를 해결하지 않으면 심각한 성능 저하를 경험할 수 있다.</p><p>N+1 문제가 어떻게 발생하는지에 대한 간단한 예시:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 블로그 게시물과 댓글의 관계를 나타내는 모델</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Post</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Comment</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>post</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=n>Post</span><span class=p>,</span> <span class=n>related_name</span><span class=o>=</span><span class=s1>&#39;comments&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># N+1 문제가 발생하는 코드</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_posts_with_comments</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 첫 번째 쿼리: 모든 게시물을 가져옴</span>
</span></span><span class=line><span class=cl>    <span class=n>posts</span> <span class=o>=</span> <span class=n>Post</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>  <span class=c1># 1번의 쿼리</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 각 게시물마다 댓글을 가져오는 추가 쿼리가 발생</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>post</span> <span class=ow>in</span> <span class=n>posts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>comments</span> <span class=o>=</span> <span class=n>post</span><span class=o>.</span><span class=n>comments</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>  <span class=c1># N번의 추가 쿼리</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Post: </span><span class=si>{</span><span class=n>post</span><span class=o>.</span><span class=n>title</span><span class=si>}</span><span class=s2>, Comments: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>comments</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 첫 번째 쿼리 (1번)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>posts</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 이후 각 게시물마다 실행되는 쿼리 (N번)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>comments</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>post_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>comments</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>post_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>comments</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>post_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>comments</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>post_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>comments</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>post_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>위 코드에서 발생하는 문제를 단계별로 설명하면,</p><ol><li>첫 번째 쿼리에서 모든 게시물을 가져온다 (1번의 쿼리)</li><li>각 게시물에 대해 댓글을 가져오는 별도의 쿼리가 실행된다 (N번의 쿼리)</li><li>결과적으로 총 N+1번의 데이터베이스 쿼리가 실행된다</li></ol><h3 id=n1-문제를-해결하기-위한-일반적인-접근-방법>N+1 문제를 해결하기 위한 일반적인 접근 방법<a hidden class=anchor aria-hidden=true href=#n1-문제를-해결하기-위한-일반적인-접근-방법>#</a></h3><ol><li>Eager Loading (즉시 로딩): 연관된 엔티티를 함께 로드하여 추가 쿼리를 방지한다.</li><li>Fetch Join: 쿼리 작성 시 연관된 엔티티를 명시적으로 함께 조회하도록 지정한다.</li><li>Batch Size 조정: 연관된 엔티티를 일괄적으로 조회하여 쿼리 수를 줄인다.</li><li>쿼리 최적화: 필요한 데이터만 선택적으로 조회하여 불필요한 쿼리를 줄인다.</li><li>캐싱: 자주 사용되는 데이터를 캐시하여 반복적인 쿼리를 줄인다.</li></ol><h3 id=모범-사례와-주의사항>모범 사례와 주의사항<a hidden class=anchor aria-hidden=true href=#모범-사례와-주의사항>#</a></h3><ol><li><p>적절한 패치 전략 선택</p><ul><li>필요한 데이터만 조회</li><li>페이징이 필요한 경우 고려</li><li>메모리 사용량 고려</li></ul></li><li><p>캐싱 전략 활용</p></li><li><p>성능 테스트 수행</p><ul><li>대용량 데이터에서의 동작 확인</li><li>메모리 사용량 모니터링</li><li>응답 시간 측정</li></ul></li></ol><h3 id=n1-문제를-방지하기-위한-설계-원칙>N+1 문제를 방지하기 위한 설계 원칙<a hidden class=anchor aria-hidden=true href=#n1-문제를-방지하기-위한-설계-원칙>#</a></h3><ol><li><p>데이터 접근 패턴 분석</p><ul><li>애플리케이션에서 실제로 필요한 데이터가 무엇인지 파악</li><li>불필요한 데이터 조회 최소화</li></ul></li><li><p>적절한 쿼리 최적화 전략 선택</p><ul><li>JOIN 사용이 적절한 경우</li><li>일괄 조회가 더 효율적인 경우</li><li>지연 로딩이 필요한 경우</li></ul></li><li><p>성능 모니터링</p><ul><li>실행되는 쿼리의 수 추적</li><li>쿼리 실행 시간 모니터링</li><li>병목 지점 식별</li></ul></li></ol><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/backend/>Backend</a></li><li><a href=https://buenhyden.github.io/tags/database-systems/>Database-Systems</a></li><li><a href=https://buenhyden.github.io/tags/orm/>ORM</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/software-design-and-architecture/programming-paradigms/concurrency-programming/><span class=title>« Prev</span><br><span>동시성 프로그래밍 (Concurrency Programming)</span>
</a><a class=next href=https://buenhyden.github.io/posts/data-structure-and-algorithm/computational-complexity/non-determinism/><span class=title>Next »</span><br><span>비결정성 (Non-determinism)</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>