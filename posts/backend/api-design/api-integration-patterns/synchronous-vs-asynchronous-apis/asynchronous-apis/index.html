<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Asynchronous APIs | hyunyoun's Blog</title>
<meta name=keywords content="Backend,API-Design,API-Integration-Patterns,Synchronous-vs-Asynchronous-APIs,Asynchronous-APIs"><meta name=description content="비동기식 API의 핵심은 요청과 응답 사이의 시간적 분리이다. 이 패턴에서는 클라이언트가 요청을 보낸 후 즉각적인 응답을 기다리지 않고, 다른 작업을 계속 진행할 수 있다. 서버는 요청을 처리한 후, 다양한 메커니즘을 통해 결과를 클라이언트에게 전달한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/backend/api-design/api-integration-patterns/synchronous-vs-asynchronous-apis/asynchronous-apis/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/backend/api-design/api-integration-patterns/synchronous-vs-asynchronous-apis/asynchronous-apis/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/backend/api-design/api-integration-patterns/synchronous-vs-asynchronous-apis/asynchronous-apis/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/backend/api-design/api-integration-patterns/synchronous-vs-asynchronous-apis/asynchronous-apis/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Asynchronous APIs"><meta property="og:description" content="비동기식 API의 핵심은 요청과 응답 사이의 시간적 분리이다. 이 패턴에서는 클라이언트가 요청을 보낸 후 즉각적인 응답을 기다리지 않고, 다른 작업을 계속 진행할 수 있다. 서버는 요청을 처리한 후, 다양한 메커니즘을 통해 결과를 클라이언트에게 전달한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Asynchronous APIs"><meta name=twitter:description content="비동기식 API의 핵심은 요청과 응답 사이의 시간적 분리이다. 이 패턴에서는 클라이언트가 요청을 보낸 후 즉각적인 응답을 기다리지 않고, 다른 작업을 계속 진행할 수 있다. 서버는 요청을 처리한 후, 다양한 메커니즘을 통해 결과를 클라이언트에게 전달한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기술 블로그","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Backend","item":"https://buenhyden.github.io/posts/backend/"},{"@type":"ListItem","position":3,"name":"APIs","item":"https://buenhyden.github.io/posts/backend/api-design/"},{"@type":"ListItem","position":4,"name":"API Integration Patterns","item":"https://buenhyden.github.io/posts/backend/api-design/api-integration-patterns/"},{"@type":"ListItem","position":5,"name":"Synchronous vs Asynchronous APIs","item":"https://buenhyden.github.io/posts/backend/api-design/api-integration-patterns/synchronous-vs-asynchronous-apis/"},{"@type":"ListItem","position":6,"name":"Asynchronous APIs","item":"https://buenhyden.github.io/posts/backend/api-design/api-integration-patterns/synchronous-vs-asynchronous-apis/asynchronous-apis/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>기술 블로그</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend/>Backend</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend/api-design/>APIs</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend/api-design/api-integration-patterns/>API Integration Patterns</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend/api-design/api-integration-patterns/synchronous-vs-asynchronous-apis/>Synchronous vs Asynchronous APIs</a></div><h1>Asynchronous APIs</h1><div class=post-description>비동기식 API의 핵심은 요청과 응답 사이의 시간적 분리이다. 이 패턴에서는 클라이언트가 요청을 보낸 후 즉각적인 응답을 기다리지 않고, 다른 작업을 계속 진행할 수 있다. 서버는 요청을 처리한 후, 다양한 메커니즘을 통해 결과를 클라이언트에게 전달한다.</div></header><div class=post-content><h2 id=asynchronous-apis>Asynchronous APIs<a hidden class=anchor aria-hidden=true href=#asynchronous-apis>#</a></h2><p>비동기식 API는 현대 소프트웨어 아키텍처에서 중요한 통신 패턴으로, 특히 확장성, 성능, 그리고 복원력이 중요한 시스템에서 핵심적인 역할을 한다.</p><h3 id=비동기식-api의-기본-원리>비동기식 API의 기본 원리<a hidden class=anchor aria-hidden=true href=#비동기식-api의-기본-원리>#</a></h3><p>비동기식 API의 핵심은 요청과 응답 사이의 시간적 분리이다. 이 패턴에서는 클라이언트가 요청을 보낸 후 즉각적인 응답을 기다리지 않고, 다른 작업을 계속 진행할 수 있다. 서버는 요청을 처리한 후, 다양한 메커니즘을 통해 결과를 클라이언트에게 전달한다.</p><h4 id=동기식-vs-비동기식-통신-모델>동기식 vs. 비동기식 통신 모델<a hidden class=anchor aria-hidden=true href=#동기식-vs-비동기식-통신-모델>#</a></h4><p>동기식 API에서는 클라이언트가 요청을 보내고 서버의 처리가 완료될 때까지 차단(blocking)되는 반면, 비동기식 API에서는 클라이언트가 요청 후 즉시 제어권을 돌려받아 다른 작업을 수행할 수 있다. 서버는 백그라운드에서 요청을 처리하고, 처리가 완료되면 결과를 알린다.</p><pre class=mermaid>동기식 통신 흐름:
클라이언트 → 요청 → 서버
클라이언트 (대기…) 서버 (처리 중…)
클라이언트 ← 응답 ← 서버

비동기식 통신 흐름:
클라이언트 → 요청 → 서버
클라이언트 ← 확인 응답 ← 서버
클라이언트 (다른 작업 수행) 서버 (백그라운드 처리…)
클라이언트 ← 결과 알림 ← 서버 (처리 완료)
</pre><h4 id=비동기식-api의-주요-개념>비동기식 API의 주요 개념<a hidden class=anchor aria-hidden=true href=#비동기식-api의-주요-개념>#</a></h4><ol><li><p>비차단(Non-blocking) 작업<br>비동기식 API의 핵심은 비차단 동작이다. 클라이언트는 서버의 응답을 기다리는 동안 차단되지 않으므로, 시스템 리소스를 효율적으로 사용할 수 있다.</p></li><li><p>이벤트 기반 아키텍처<br>비동기식 API는 종종 이벤트 기반 아키텍처와 연결된다. 시스템 구성 요소는 이벤트를 생성하고 소비하며, 이벤트 스트림을 통해 통신한다.</p></li><li><p>메시지 큐<br>메시지 큐는 비동기 통신을 구현하는 핵심 컴포넌트이다. 생산자는 메시지를 큐에 추가하고, 소비자는 자신의 속도에 맞게 메시지를 처리한다.</p></li><li><p>콜백 및 프로미스<br>프로그래밍 측면에서 비동기 작업은 종종 콜백 함수, 프로미스(Promise), 또는 더 최근에는 async/await 패턴을 통해 처리된다.</p></li></ol><h3 id=비동기식-api의-주요-이점-정리>비동기식 API의 주요 이점 정리<a hidden class=anchor aria-hidden=true href=#비동기식-api의-주요-이점-정리>#</a></h3><ol><li><strong>확장성 향상</strong>: 비동기 처리를 통해 시스템 자원을 효율적으로 사용하고 더 많은 동시 요청을 처리할 수 있다.</li><li><strong>장기 실행 작업 지원</strong>: 완료하는 데 시간이 오래 걸리는 작업을 클라이언트 타임아웃 없이 처리할 수 있다.</li><li><strong>시스템 복원력 향상</strong>: 서비스 간 느슨한 결합을 통해 일부 시스템 장애가 전체 시스템에 미치는 영향을 최소화한다.</li><li><strong>리소스 활용도 최적화</strong>: 클라이언트와 서버 모두에서 리소스를 효율적으로 활용할 수 있다.</li><li><strong>사용자 경험 개선</strong>: 사용자가 긴 작업이 완료되기를 기다리지 않고도 다른 작업을 계속할 수 있다.</li></ol><h3 id=도전과제-및-고려사항>도전과제 및 고려사항<a hidden class=anchor aria-hidden=true href=#도전과제-및-고려사항>#</a></h3><ol><li><strong>복잡성 증가</strong>: 비동기 API는 상태 추적, 오류 처리, 재시도 로직 등으로 인해 구현이 더 복잡할 수 있다.</li><li><strong>작업 상태 관리</strong>: 장기 실행 작업의 상태를 추적하고 저장하기 위한 추가 인프라가 필요하다.</li><li><strong>모니터링 및 디버깅 어려움</strong>: 비동기 작업의 추적과 문제 해결이 더 복잡해질 수 있다.</li><li><strong>클라이언트 복잡성</strong>: 클라이언트는 비동기 응답을 처리하기 위한 추가 로직이 필요하다.</li><li><strong>일관성 관리</strong>: 분산 시스템에서 데이터 일관성을 유지하는 것이 더 어려워질 수 있다.</li></ol><h3 id=비동기식-api-통합-패턴>비동기식 API 통합 패턴<a hidden class=anchor aria-hidden=true href=#비동기식-api-통합-패턴>#</a></h3><p>비동기식 API를 구현하기 위한 다양한 패턴과 접근 방식이 있다. 각 패턴은 특정 사용 사례와 요구사항에 맞게 설계되었다.</p><h4 id=폴링polling-패턴>폴링(Polling) 패턴<a hidden class=anchor aria-hidden=true href=#폴링polling-패턴>#</a></h4><p>폴링은 가장 단순한 비동기 패턴으로, 클라이언트가 주기적으로 서버에 요청을 보내 처리 상태를 확인한다.</p><h5 id=작동-방식>작동 방식<a hidden class=anchor aria-hidden=true href=#작동-방식>#</a></h5><ol><li>클라이언트가 작업 요청을 서버에 전송한다.</li><li>서버는 작업 ID와 함께 즉시 응답한다.</li><li>클라이언트는 주기적으로 작업 상태 확인 요청을 보낸다.</li><li>작업이 완료되면 서버는 결과를 포함한 응답을 반환한다.</li></ol><h5 id=구현-예시-spring-boot>구현 예시 (Spring Boot)<a hidden class=anchor aria-hidden=true href=#구현-예시-spring-boot>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22>22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23>23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24>24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25>25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26>26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27>27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28>28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29>29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30>30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31>31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32>32</a>
</span><span class=lnt id=hl-1-33><a class=lnlinks href=#hl-1-33>33</a>
</span><span class=lnt id=hl-1-34><a class=lnlinks href=#hl-1-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 작업 제출 엔드포인트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/jobs&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>submitJob</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 ID 생성 및 백그라운드 작업 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>createJob</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 즉시 응답 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResponse</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PENDING&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/api/jobs/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>jobId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 작업 상태 확인 엔드포인트 (폴링용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/api/jobs/{jobId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getJobStatus</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>getJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>JobResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;/api/jobs/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>jobId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업이 완료된 경우 결과 포함</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setResult</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getResult</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=장단점>장단점<a hidden class=anchor aria-hidden=true href=#장단점>#</a></h5><p><strong>장점:</strong></p><ul><li>구현이 단순하고 이해하기 쉽다.</li><li>추가 인프라 없이 구현 가능.</li><li>모든 HTTP 클라이언트와 호환된다.</li></ul><p><strong>단점:</strong></p><ul><li>불필요한 네트워크 트래픽을 생성.</li><li>폴링 빈도 설정이 어려울 수 있다 (너무 자주 → 불필요한 부하, 너무 드물게 → 지연 발생).</li><li>서버 리소스를 비효율적으로 사용한다.</li></ul><h4 id=웹훅webhook-패턴>웹훅(Webhook) 패턴<a hidden class=anchor aria-hidden=true href=#웹훅webhook-패턴>#</a></h4><p>웹훅 패턴은 &ldquo;역방향 API&rdquo; 또는 &ldquo;콜백"이라고도 불리며, 작업이 완료되면 서버가 클라이언트에게 능동적으로 알린다.</p><h5 id=작동-방식-1>작동 방식<a hidden class=anchor aria-hidden=true href=#작동-방식-1>#</a></h5><ol><li>클라이언트가 작업 요청과 함께 콜백 URL을 서버에 제공한다.</li><li>서버는 작업 ID와 함께 즉시 응답한다.</li><li>서버가 백그라운드에서 작업을 처리한다.</li><li>작업이 완료되면 서버는 결과를 포함한 HTTP 요청을 클라이언트의 콜백 URL로 전송한다.</li></ol><h5 id=구현-예시-spring-boot-1>구현 예시 (Spring Boot)<a hidden class=anchor aria-hidden=true href=#구현-예시-spring-boot-1>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span><span class=lnt id=hl-2-27><a class=lnlinks href=#hl-2-27>27</a>
</span><span class=lnt id=hl-2-28><a class=lnlinks href=#hl-2-28>28</a>
</span><span class=lnt id=hl-2-29><a class=lnlinks href=#hl-2-29>29</a>
</span><span class=lnt id=hl-2-30><a class=lnlinks href=#hl-2-30>30</a>
</span><span class=lnt id=hl-2-31><a class=lnlinks href=#hl-2-31>31</a>
</span><span class=lnt id=hl-2-32><a class=lnlinks href=#hl-2-32>32</a>
</span><span class=lnt id=hl-2-33><a class=lnlinks href=#hl-2-33>33</a>
</span><span class=lnt id=hl-2-34><a class=lnlinks href=#hl-2-34>34</a>
</span><span class=lnt id=hl-2-35><a class=lnlinks href=#hl-2-35>35</a>
</span><span class=lnt id=hl-2-36><a class=lnlinks href=#hl-2-36>36</a>
</span><span class=lnt id=hl-2-37><a class=lnlinks href=#hl-2-37>37</a>
</span><span class=lnt id=hl-2-38><a class=lnlinks href=#hl-2-38>38</a>
</span><span class=lnt id=hl-2-39><a class=lnlinks href=#hl-2-39>39</a>
</span><span class=lnt id=hl-2-40><a class=lnlinks href=#hl-2-40>40</a>
</span><span class=lnt id=hl-2-41><a class=lnlinks href=#hl-2-41>41</a>
</span><span class=lnt id=hl-2-42><a class=lnlinks href=#hl-2-42>42</a>
</span><span class=lnt id=hl-2-43><a class=lnlinks href=#hl-2-43>43</a>
</span><span class=lnt id=hl-2-44><a class=lnlinks href=#hl-2-44>44</a>
</span><span class=lnt id=hl-2-45><a class=lnlinks href=#hl-2-45>45</a>
</span><span class=lnt id=hl-2-46><a class=lnlinks href=#hl-2-46>46</a>
</span><span class=lnt id=hl-2-47><a class=lnlinks href=#hl-2-47>47</a>
</span><span class=lnt id=hl-2-48><a class=lnlinks href=#hl-2-48>48</a>
</span><span class=lnt id=hl-2-49><a class=lnlinks href=#hl-2-49>49</a>
</span><span class=lnt id=hl-2-50><a class=lnlinks href=#hl-2-50>50</a>
</span><span class=lnt id=hl-2-51><a class=lnlinks href=#hl-2-51>51</a>
</span><span class=lnt id=hl-2-52><a class=lnlinks href=#hl-2-52>52</a>
</span><span class=lnt id=hl-2-53><a class=lnlinks href=#hl-2-53>53</a>
</span><span class=lnt id=hl-2-54><a class=lnlinks href=#hl-2-54>54</a>
</span><span class=lnt id=hl-2-55><a class=lnlinks href=#hl-2-55>55</a>
</span><span class=lnt id=hl-2-56><a class=lnlinks href=#hl-2-56>56</a>
</span><span class=lnt id=hl-2-57><a class=lnlinks href=#hl-2-57>57</a>
</span><span class=lnt id=hl-2-58><a class=lnlinks href=#hl-2-58>58</a>
</span><span class=lnt id=hl-2-59><a class=lnlinks href=#hl-2-59>59</a>
</span><span class=lnt id=hl-2-60><a class=lnlinks href=#hl-2-60>60</a>
</span><span class=lnt id=hl-2-61><a class=lnlinks href=#hl-2-61>61</a>
</span><span class=lnt id=hl-2-62><a class=lnlinks href=#hl-2-62>62</a>
</span><span class=lnt id=hl-2-63><a class=lnlinks href=#hl-2-63>63</a>
</span><span class=lnt id=hl-2-64><a class=lnlinks href=#hl-2-64>64</a>
</span><span class=lnt id=hl-2-65><a class=lnlinks href=#hl-2-65>65</a>
</span><span class=lnt id=hl-2-66><a class=lnlinks href=#hl-2-66>66</a>
</span><span class=lnt id=hl-2-67><a class=lnlinks href=#hl-2-67>67</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 작업 제출 엔드포인트 (웹훅 URL 포함)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/async-tasks&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>TaskResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>submitTask</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>TaskRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestParam</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>webhookUrl</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 ID 생성 및 요청 정보 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>taskId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>asyncTaskService</span><span class=p>.</span><span class=na>saveTask</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>webhookUrl</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 비동기 작업 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CompletableFuture</span><span class=p>.</span><span class=na>runAsync</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>TaskResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>asyncTaskService</span><span class=p>.</span><span class=na>executeTask</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 웹훅 호출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>webhookService</span><span class=p>.</span><span class=na>sendWebhook</span><span class=p>(</span><span class=n>webhookUrl</span><span class=p>,</span><span class=w> </span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 오류 처리 및 웹훅으로 오류 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>webhookService</span><span class=p>.</span><span class=na>sendErrorWebhook</span><span class=p>(</span><span class=n>webhookUrl</span><span class=p>,</span><span class=w> </span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 즉시 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>TaskResponse</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PROCESSING&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/api/async-tasks/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>taskId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 웹훅 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebhookService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendWebhook</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>webhookUrl</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>TaskResult</span><span class=w> </span><span class=n>result</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>WebhookPayload</span><span class=w> </span><span class=n>payload</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>WebhookPayload</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>taskId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;COMPLETED&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>result</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>postForEntity</span><span class=p>(</span><span class=n>webhookUrl</span><span class=p>,</span><span class=w> </span><span class=n>payload</span><span class=p>,</span><span class=w> </span><span class=n>Void</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Webhook sent for task: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>taskId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Failed to send webhook for task {}: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 재시도 로직 구현 가능</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendErrorWebhook</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>webhookUrl</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>errorMessage</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>WebhookPayload</span><span class=w> </span><span class=n>payload</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>WebhookPayload</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>taskId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;FAILED&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;error&#34;</span><span class=p>,</span><span class=w> </span><span class=n>errorMessage</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>postForEntity</span><span class=p>(</span><span class=n>webhookUrl</span><span class=p>,</span><span class=w> </span><span class=n>payload</span><span class=p>,</span><span class=w> </span><span class=n>Void</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Error webhook sent for task: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>taskId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Failed to send error webhook for task {}: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=장단점-1>장단점<a hidden class=anchor aria-hidden=true href=#장단점-1>#</a></h5><p><strong>장점:</strong></p><ul><li>불필요한 폴링을 제거하여 네트워크 트래픽을 줄인다.</li><li>실시간에 가까운 알림을 제공한다.</li><li>서버 리소스를 효율적으로 사용한다.</li></ul><p><strong>단점:</strong></p><ul><li>클라이언트가 공개적으로 접근 가능한 엔드포인트를 가져야 한다.</li><li>보안 고려사항(웹훅 인증, 서명 검증 등)이 중요하다.</li><li>네트워크 장애나 일시적인 연결 문제로 인한 전달 실패 가능성이 있다.</li><li>웹훅 전달 상태를 추적하고 필요시 재시도하는 메커니즘이 필요하다.</li></ul><h4 id=롱-폴링long-polling-패턴>롱 폴링(Long Polling) 패턴<a hidden class=anchor aria-hidden=true href=#롱-폴링long-polling-패턴>#</a></h4><p>롱 폴링은 일반 폴링과 웹훅의 중간 지점으로, 클라이언트의 요청을 즉시 응답하지 않고 유지하다가 작업이 완료되면 응답하는 방식이다.</p><h5 id=작동-방식-2>작동 방식<a hidden class=anchor aria-hidden=true href=#작동-방식-2>#</a></h5><ol><li>클라이언트가 작업 요청을 서버에 전송한다.</li><li>서버는 작업 ID와 함께 즉시 응답한다.</li><li>클라이언트는 작업 상태 확인 요청을 보낸다.</li><li>서버는 작업이 완료될 때까지 요청을 열어둔다 (타임아웃 한도 내에서).</li><li>작업이 완료되면 서버는 결과와 함께 응답한다. 타임아웃이 발생하면 클라이언트는 새 요청을 보낸다.</li></ol><h5 id=구현-예시-spring-boot--deferredresult>구현 예시 (Spring Boot + DeferredResult)<a hidden class=anchor aria-hidden=true href=#구현-예시-spring-boot--deferredresult>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29>29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30>30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31>31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32>32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33>33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34>34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35>35</a>
</span><span class=lnt id=hl-3-36><a class=lnlinks href=#hl-3-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/api/jobs/{jobId}/longpoll&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>DeferredResult</span><span class=o>&lt;</span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResult</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=nf>longPollJobResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>defaultValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;30000&#34;</span><span class=p>)</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>timeout</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// DeferredResult 생성 (타임아웃 설정)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DeferredResult</span><span class=o>&lt;</span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResult</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>deferredResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DeferredResult</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>timeout</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 타임아웃 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>deferredResult</span><span class=p>.</span><span class=na>onTimeout</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>deferredResult</span><span class=p>.</span><span class=na>setResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResult</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PROCESSING&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 현재 작업 상태 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>getJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>deferredResult</span><span class=p>.</span><span class=na>setResult</span><span class=p>(</span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>isCompleted</span><span class=p>()</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>isFailed</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 이미 완료된 경우 즉시 결과 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>deferredResult</span><span class=p>.</span><span class=na>setResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResult</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getResult</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업이 아직 진행 중이면 완료 리스너 등록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jobCompletionService</span><span class=p>.</span><span class=na>addCompletionListener</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>deferredResult</span><span class=p>.</span><span class=na>setResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResult</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getResult</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>deferredResult</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=장단점-2>장단점<a hidden class=anchor aria-hidden=true href=#장단점-2>#</a></h5><p><strong>장점:</strong></p><ul><li>폴링에 비해 네트워크 트래픽이 줄어든다.</li><li>웹훅에 비해 구현이 단순하다 (클라이언트가 공개 엔드포인트를 가질 필요 없음).</li><li>실시간에 가까운 알림을 제공한다.</li></ul><p><strong>단점:</strong></p><ul><li>서버에서 열린 연결을 유지해야 하므로 리소스를 많이 소비할 수 있다.</li><li>연결이 끊어지면 클라이언트가 새로운 요청을 시작해야 한다.</li><li>많은 동시 연결 시 서버 부하가 크게 증가할 수 있다.</li></ul><h4 id=서버-전송-이벤트server-sent-events-sse-패턴>서버-전송 이벤트(Server-Sent Events, SSE) 패턴<a hidden class=anchor aria-hidden=true href=#서버-전송-이벤트server-sent-events-sse-패턴>#</a></h4><p>SSE는 서버가 클라이언트에게 단방향으로 이벤트 스트림을 보낼 수 있게 하는 HTML5 표준이다.</p><h5 id=작동-방식-3>작동 방식<a hidden class=anchor aria-hidden=true href=#작동-방식-3>#</a></h5><ol><li>클라이언트가 SSE 연결을 설정한다.</li><li>서버는 HTTP 연결을 유지하면서 이벤트 스트림을 클라이언트에게 전송한다.</li><li>클라이언트는 이벤트를 수신하여 처리한다.</li><li>연결이 끊어지면 클라이언트가 자동으로 재연결을 시도한다.</li></ol><h5 id=구현-예시-spring-boot--sse>구현 예시 (Spring Boot + SSE)<a hidden class=anchor aria-hidden=true href=#구현-예시-spring-boot--sse>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25>25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26>26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27>27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28>28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29>29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30>30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31>31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32>32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33>33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34>34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35>35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36>36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37>37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38>38</a>
</span><span class=lnt id=hl-4-39><a class=lnlinks href=#hl-4-39>39</a>
</span><span class=lnt id=hl-4-40><a class=lnlinks href=#hl-4-40>40</a>
</span><span class=lnt id=hl-4-41><a class=lnlinks href=#hl-4-41>41</a>
</span><span class=lnt id=hl-4-42><a class=lnlinks href=#hl-4-42>42</a>
</span><span class=lnt id=hl-4-43><a class=lnlinks href=#hl-4-43>43</a>
</span><span class=lnt id=hl-4-44><a class=lnlinks href=#hl-4-44>44</a>
</span><span class=lnt id=hl-4-45><a class=lnlinks href=#hl-4-45>45</a>
</span><span class=lnt id=hl-4-46><a class=lnlinks href=#hl-4-46>46</a>
</span><span class=lnt id=hl-4-47><a class=lnlinks href=#hl-4-47>47</a>
</span><span class=lnt id=hl-4-48><a class=lnlinks href=#hl-4-48>48</a>
</span><span class=lnt id=hl-4-49><a class=lnlinks href=#hl-4-49>49</a>
</span><span class=lnt id=hl-4-50><a class=lnlinks href=#hl-4-50>50</a>
</span><span class=lnt id=hl-4-51><a class=lnlinks href=#hl-4-51>51</a>
</span><span class=lnt id=hl-4-52><a class=lnlinks href=#hl-4-52>52</a>
</span><span class=lnt id=hl-4-53><a class=lnlinks href=#hl-4-53>53</a>
</span><span class=lnt id=hl-4-54><a class=lnlinks href=#hl-4-54>54</a>
</span><span class=lnt id=hl-4-55><a class=lnlinks href=#hl-4-55>55</a>
</span><span class=lnt id=hl-4-56><a class=lnlinks href=#hl-4-56>56</a>
</span><span class=lnt id=hl-4-57><a class=lnlinks href=#hl-4-57>57</a>
</span><span class=lnt id=hl-4-58><a class=lnlinks href=#hl-4-58>58</a>
</span><span class=lnt id=hl-4-59><a class=lnlinks href=#hl-4-59>59</a>
</span><span class=lnt id=hl-4-60><a class=lnlinks href=#hl-4-60>60</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@GetMapping</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;/api/events&#34;</span><span class=p>,</span><span class=w> </span><span class=n>produces</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MediaType</span><span class=p>.</span><span class=na>TEXT_EVENT_STREAM_VALUE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>SseEmitter</span><span class=w> </span><span class=nf>subscribeToEvents</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// SSE 이미터 생성 (타임아웃 설정)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SseEmitter</span><span class=w> </span><span class=n>emitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SseEmitter</span><span class=p>(</span><span class=n>Long</span><span class=p>.</span><span class=na>MAX_VALUE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 클라이언트 등록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>eventService</span><span class=p>.</span><span class=na>addClient</span><span class=p>(</span><span class=n>emitter</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 연결 종료 시 정리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>emitter</span><span class=p>.</span><span class=na>onCompletion</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>eventService</span><span class=p>.</span><span class=na>removeClient</span><span class=p>(</span><span class=n>emitter</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>emitter</span><span class=p>.</span><span class=na>onTimeout</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>eventService</span><span class=p>.</span><span class=na>removeClient</span><span class=p>(</span><span class=n>emitter</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>emitter</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=n>e</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>eventService</span><span class=p>.</span><span class=na>removeClient</span><span class=p>(</span><span class=n>emitter</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 초기 연결 확인 이벤트 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>emitter</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=n>SseEmitter</span><span class=p>.</span><span class=na>event</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>name</span><span class=p>(</span><span class=s>&#34;CONNECTED&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>data</span><span class=p>(</span><span class=s>&#34;Connection established&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>id</span><span class=p>(</span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>emitter</span><span class=p>.</span><span class=na>completeWithError</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>emitter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 이벤트 발생 시 모든 클라이언트에게 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>EventService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>SseEmitter</span><span class=o>&gt;</span><span class=w> </span><span class=n>clients</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CopyOnWriteArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>addClient</span><span class=p>(</span><span class=n>SseEmitter</span><span class=w> </span><span class=n>emitter</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>clients</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>emitter</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>removeClient</span><span class=p>(</span><span class=n>SseEmitter</span><span class=w> </span><span class=n>emitter</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>clients</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>emitter</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>broadcastEvent</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>eventName</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>SseEmitter</span><span class=o>&gt;</span><span class=w> </span><span class=n>deadEmitters</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>clients</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>emitter</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>emitter</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=n>SseEmitter</span><span class=p>.</span><span class=na>event</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>name</span><span class=p>(</span><span class=n>eventName</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>data</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>id</span><span class=p>(</span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>deadEmitters</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>emitter</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 실패한 이미터 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>clients</span><span class=p>.</span><span class=na>removeAll</span><span class=p>(</span><span class=n>deadEmitters</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=장단점-3>장단점<a hidden class=anchor aria-hidden=true href=#장단점-3>#</a></h5><p><strong>장점:</strong></p><ul><li>HTML5 표준을 기반으로 하며 대부분의 현대 브라우저에서 지원된다.</li><li>클라이언트는 단일 HTTP 연결로 여러 이벤트를 수신할 수 있다.</li><li>자동 재연결 메커니즘이 내장되어 있다.</li><li>단방향 통신에 최적화되어 있다.</li></ul><p><strong>단점:</strong></p><ul><li>서버가 많은 동시 연결을 유지해야 하므로 리소스를 많이 소비할 수 있다.</li><li>방화벽이나 프록시에 의해 차단될 수 있다.</li><li>Internet Explorer에서는 지원되지 않는다 (polyfill 필요).</li><li>양방향 통신이 필요한 경우에는 적합하지 않다.</li></ul><h4 id=웹소켓websocket-패턴>웹소켓(WebSocket) 패턴<a hidden class=anchor aria-hidden=true href=#웹소켓websocket-패턴>#</a></h4><p>웹소켓은 클라이언트와 서버 간의 양방향 실시간 통신을 위한 프로토콜이다.</p><h5 id=작동-방식-4>작동 방식<a hidden class=anchor aria-hidden=true href=#작동-방식-4>#</a></h5><ol><li>클라이언트가 HTTP 핸드셰이크를 통해 웹소켓 연결을 설정한다.</li><li>연결이 설정되면 프로토콜이 웹소켓으로 업그레이드된다.</li><li>클라이언트와 서버는 양방향으로 메시지를 주고받을 수 있다.</li><li>연결은 명시적으로 닫힐 때까지 유지된다.</li></ol><h5 id=구현-예시-spring-boot--websocket>구현 예시 (Spring Boot + WebSocket)<a hidden class=anchor aria-hidden=true href=#구현-예시-spring-boot--websocket>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span><span class=lnt id=hl-5-32><a class=lnlinks href=#hl-5-32>32</a>
</span><span class=lnt id=hl-5-33><a class=lnlinks href=#hl-5-33>33</a>
</span><span class=lnt id=hl-5-34><a class=lnlinks href=#hl-5-34>34</a>
</span><span class=lnt id=hl-5-35><a class=lnlinks href=#hl-5-35>35</a>
</span><span class=lnt id=hl-5-36><a class=lnlinks href=#hl-5-36>36</a>
</span><span class=lnt id=hl-5-37><a class=lnlinks href=#hl-5-37>37</a>
</span><span class=lnt id=hl-5-38><a class=lnlinks href=#hl-5-38>38</a>
</span><span class=lnt id=hl-5-39><a class=lnlinks href=#hl-5-39>39</a>
</span><span class=lnt id=hl-5-40><a class=lnlinks href=#hl-5-40>40</a>
</span><span class=lnt id=hl-5-41><a class=lnlinks href=#hl-5-41>41</a>
</span><span class=lnt id=hl-5-42><a class=lnlinks href=#hl-5-42>42</a>
</span><span class=lnt id=hl-5-43><a class=lnlinks href=#hl-5-43>43</a>
</span><span class=lnt id=hl-5-44><a class=lnlinks href=#hl-5-44>44</a>
</span><span class=lnt id=hl-5-45><a class=lnlinks href=#hl-5-45>45</a>
</span><span class=lnt id=hl-5-46><a class=lnlinks href=#hl-5-46>46</a>
</span><span class=lnt id=hl-5-47><a class=lnlinks href=#hl-5-47>47</a>
</span><span class=lnt id=hl-5-48><a class=lnlinks href=#hl-5-48>48</a>
</span><span class=lnt id=hl-5-49><a class=lnlinks href=#hl-5-49>49</a>
</span><span class=lnt id=hl-5-50><a class=lnlinks href=#hl-5-50>50</a>
</span><span class=lnt id=hl-5-51><a class=lnlinks href=#hl-5-51>51</a>
</span><span class=lnt id=hl-5-52><a class=lnlinks href=#hl-5-52>52</a>
</span><span class=lnt id=hl-5-53><a class=lnlinks href=#hl-5-53>53</a>
</span><span class=lnt id=hl-5-54><a class=lnlinks href=#hl-5-54>54</a>
</span><span class=lnt id=hl-5-55><a class=lnlinks href=#hl-5-55>55</a>
</span><span class=lnt id=hl-5-56><a class=lnlinks href=#hl-5-56>56</a>
</span><span class=lnt id=hl-5-57><a class=lnlinks href=#hl-5-57>57</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSocketMessageBroker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebSocketConfig</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>WebSocketMessageBrokerConfigurer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configureMessageBroker</span><span class=p>(</span><span class=n>MessageBrokerRegistry</span><span class=w> </span><span class=n>config</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>enableSimpleBroker</span><span class=p>(</span><span class=s>&#34;/topic&#34;</span><span class=p>);</span><span class=w>  </span><span class=c1>// 구독 경로</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setApplicationDestinationPrefixes</span><span class=p>(</span><span class=s>&#34;/app&#34;</span><span class=p>);</span><span class=w>  </span><span class=c1>// 메시지 전송 경로</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>registerStompEndpoints</span><span class=p>(</span><span class=n>StompEndpointRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>registry</span><span class=p>.</span><span class=na>addEndpoint</span><span class=p>(</span><span class=s>&#34;/websocket&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setAllowedOrigins</span><span class=p>(</span><span class=s>&#34;*&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withSockJS</span><span class=p>();</span><span class=w>  </span><span class=c1>// 폴백 옵션</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TaskWebSocketController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@MessageMapping</span><span class=p>(</span><span class=s>&#34;/tasks/submit&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@SendTo</span><span class=p>(</span><span class=s>&#34;/topic/task-updates&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>TaskResponse</span><span class=w> </span><span class=nf>submitTask</span><span class=p>(</span><span class=n>TaskRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 ID 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>taskId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 백그라운드 작업 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CompletableFuture</span><span class=p>.</span><span class=na>runAsync</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 작업 실행 중 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>simpMessagingTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;/topic/task-updates/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>taskId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>new</span><span class=w> </span><span class=n>TaskUpdate</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PROCESSING&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Task in progress…&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 작업 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>TaskResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>taskService</span><span class=p>.</span><span class=na>executeTask</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 완료 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>simpMessagingTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;/topic/task-updates/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>taskId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>new</span><span class=w> </span><span class=n>TaskUpdate</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;COMPLETED&#34;</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 오류 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>simpMessagingTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;/topic/task-updates/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>taskId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>new</span><span class=w> </span><span class=n>TaskUpdate</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;FAILED&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 초기 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TaskResponse</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;SUBMITTED&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/topic/task-updates/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>taskId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=장단점-4>장단점<a hidden class=anchor aria-hidden=true href=#장단점-4>#</a></h5><p><strong>장점:</strong></p><ul><li>진정한 양방향 실시간 통신을 제공한다.</li><li>헤더 오버헤드가 적어 효율적인 통신이 가능하다.</li><li>대부분의 현대 브라우저에서 지원된다.</li><li>장기 실행 작업의 진행 상황을 실시간으로 제공할 수 있다.</li></ul><p><strong>단점:</strong></p><ul><li>구현이 상대적으로 복잡하다.</li><li>방화벽이나 프록시에 의해 차단될 수 있다.</li><li>서버가 많은 동시 연결을 유지해야 한다.</li><li>상태 유지가 필요하므로 서버 확장에 도전이 될 수 있다.</li></ul><h4 id=메시지-큐-기반-패턴>메시지 큐 기반 패턴<a hidden class=anchor aria-hidden=true href=#메시지-큐-기반-패턴>#</a></h4><p>메시지 큐를 사용한 비동기 통신은 확장 가능하고 복원력이 있는 시스템을 구축하는 데 중요한 패턴이다.</p><h5 id=작동-방식-5>작동 방식<a hidden class=anchor aria-hidden=true href=#작동-방식-5>#</a></h5><ol><li>클라이언트가 API 요청을 서버에 전송한다.</li><li>서버는 작업 ID와 함께 즉시 응답한다.</li><li>서버는 작업을 메시지 큐에 게시한다.</li><li>작업자(worker)가 큐에서 메시지를 소비하여 처리한다.</li><li>작업이 완료되면 결과가 데이터베이스에 저장되거나 다른 큐에 발행된다.</li><li>클라이언트는 폴링, 웹훅 또는 다른 메커니즘을 통해 결과를 검색한다.</li></ol><h5 id=구현-예시-spring-boot--rabbitmq>구현 예시 (Spring Boot + RabbitMQ)<a hidden class=anchor aria-hidden=true href=#구현-예시-spring-boot--rabbitmq>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34>34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35>35</a>
</span><span class=lnt id=hl-6-36><a class=lnlinks href=#hl-6-36>36</a>
</span><span class=lnt id=hl-6-37><a class=lnlinks href=#hl-6-37>37</a>
</span><span class=lnt id=hl-6-38><a class=lnlinks href=#hl-6-38>38</a>
</span><span class=lnt id=hl-6-39><a class=lnlinks href=#hl-6-39>39</a>
</span><span class=lnt id=hl-6-40><a class=lnlinks href=#hl-6-40>40</a>
</span><span class=lnt id=hl-6-41><a class=lnlinks href=#hl-6-41>41</a>
</span><span class=lnt id=hl-6-42><a class=lnlinks href=#hl-6-42>42</a>
</span><span class=lnt id=hl-6-43><a class=lnlinks href=#hl-6-43>43</a>
</span><span class=lnt id=hl-6-44><a class=lnlinks href=#hl-6-44>44</a>
</span><span class=lnt id=hl-6-45><a class=lnlinks href=#hl-6-45>45</a>
</span><span class=lnt id=hl-6-46><a class=lnlinks href=#hl-6-46>46</a>
</span><span class=lnt id=hl-6-47><a class=lnlinks href=#hl-6-47>47</a>
</span><span class=lnt id=hl-6-48><a class=lnlinks href=#hl-6-48>48</a>
</span><span class=lnt id=hl-6-49><a class=lnlinks href=#hl-6-49>49</a>
</span><span class=lnt id=hl-6-50><a class=lnlinks href=#hl-6-50>50</a>
</span><span class=lnt id=hl-6-51><a class=lnlinks href=#hl-6-51>51</a>
</span><span class=lnt id=hl-6-52><a class=lnlinks href=#hl-6-52>52</a>
</span><span class=lnt id=hl-6-53><a class=lnlinks href=#hl-6-53>53</a>
</span><span class=lnt id=hl-6-54><a class=lnlinks href=#hl-6-54>54</a>
</span><span class=lnt id=hl-6-55><a class=lnlinks href=#hl-6-55>55</a>
</span><span class=lnt id=hl-6-56><a class=lnlinks href=#hl-6-56>56</a>
</span><span class=lnt id=hl-6-57><a class=lnlinks href=#hl-6-57>57</a>
</span><span class=lnt id=hl-6-58><a class=lnlinks href=#hl-6-58>58</a>
</span><span class=lnt id=hl-6-59><a class=lnlinks href=#hl-6-59>59</a>
</span><span class=lnt id=hl-6-60><a class=lnlinks href=#hl-6-60>60</a>
</span><span class=lnt id=hl-6-61><a class=lnlinks href=#hl-6-61>61</a>
</span><span class=lnt id=hl-6-62><a class=lnlinks href=#hl-6-62>62</a>
</span><span class=lnt id=hl-6-63><a class=lnlinks href=#hl-6-63>63</a>
</span><span class=lnt id=hl-6-64><a class=lnlinks href=#hl-6-64>64</a>
</span><span class=lnt id=hl-6-65><a class=lnlinks href=#hl-6-65>65</a>
</span><span class=lnt id=hl-6-66><a class=lnlinks href=#hl-6-66>66</a>
</span><span class=lnt id=hl-6-67><a class=lnlinks href=#hl-6-67>67</a>
</span><span class=lnt id=hl-6-68><a class=lnlinks href=#hl-6-68>68</a>
</span><span class=lnt id=hl-6-69><a class=lnlinks href=#hl-6-69>69</a>
</span><span class=lnt id=hl-6-70><a class=lnlinks href=#hl-6-70>70</a>
</span><span class=lnt id=hl-6-71><a class=lnlinks href=#hl-6-71>71</a>
</span><span class=lnt id=hl-6-72><a class=lnlinks href=#hl-6-72>72</a>
</span><span class=lnt id=hl-6-73><a class=lnlinks href=#hl-6-73>73</a>
</span><span class=lnt id=hl-6-74><a class=lnlinks href=#hl-6-74>74</a>
</span><span class=lnt id=hl-6-75><a class=lnlinks href=#hl-6-75>75</a>
</span><span class=lnt id=hl-6-76><a class=lnlinks href=#hl-6-76>76</a>
</span><span class=lnt id=hl-6-77><a class=lnlinks href=#hl-6-77>77</a>
</span><span class=lnt id=hl-6-78><a class=lnlinks href=#hl-6-78>78</a>
</span><span class=lnt id=hl-6-79><a class=lnlinks href=#hl-6-79>79</a>
</span><span class=lnt id=hl-6-80><a class=lnlinks href=#hl-6-80>80</a>
</span><span class=lnt id=hl-6-81><a class=lnlinks href=#hl-6-81>81</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// API 컨트롤러</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/jobs&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobService</span><span class=w> </span><span class=n>jobService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RabbitTemplate</span><span class=w> </span><span class=n>rabbitTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>submitJob</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 생성 및 초기 상태 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jobService</span><span class=p>.</span><span class=na>saveJob</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Job</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 메시지 큐로 작업 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rabbitTemplate</span><span class=p>.</span><span class=na>convertAndSend</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;job-exchange&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;job.submit&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>JobMessage</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 즉시 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResponse</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PENDING&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/api/jobs/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>jobId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/{jobId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getJobStatus</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>getJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JobResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;/api/jobs/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>jobId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>response</span><span class=p>.</span><span class=na>setResult</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getResult</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 메시지 소비자</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobService</span><span class=w> </span><span class=n>jobService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RabbitListener</span><span class=p>(</span><span class=n>queues</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;job-queue&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processJob</span><span class=p>(</span><span class=n>JobMessage</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>getJobId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>getRequest</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobService</span><span class=p>.</span><span class=na>updateJobStatus</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>JobResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>executeJob</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 성공 결과 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobService</span><span class=p>.</span><span class=na>completeJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 실패 결과 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobService</span><span class=p>.</span><span class=na>failJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>JobResult</span><span class=w> </span><span class=nf>executeJob</span><span class=p>(</span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 실제 작업 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobResult</span><span class=p>(</span><span class=s>&#34;Some result data&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=장단점-5>장단점<a hidden class=anchor aria-hidden=true href=#장단점-5>#</a></h5><p><strong>장점:</strong></p><ul><li>고부하 상황에서 시스템 안정성과 확장성이 향상된다.</li><li>시스템 구성 요소 간의 느슨한 결합이 가능하다.</li><li>일시적인 장애에도 복원력이 있다.</li><li>작업 부하를 여러 작업자 간에 분산할 수 있다.</li></ul><p><strong>단점:</strong></p><ul><li>추가 인프라(메시지 브로커)가 필요하다.</li><li>시스템 복잡성이 증가한다.</li><li>즉시 응답이 필요한 경우에는 적합하지 않다.</li><li>추가적인 모니터링과 오류 처리가 필요하다.</li></ul><h4 id=grpc-스트리밍-패턴>gRPC 스트리밍 패턴<a hidden class=anchor aria-hidden=true href=#grpc-스트리밍-패턴>#</a></h4><p>gRPC는, Google에서 개발한 고성능 RPC(Remote Procedure Call) 프레임워크로, HTTP/2를 기반으로 하며 서버 스트리밍, 클라이언트 스트리밍, 양방향 스트리밍을 지원한다.</p><h5 id=작동-방식-6>작동 방식<a hidden class=anchor aria-hidden=true href=#작동-방식-6>#</a></h5><ol><li>gRPC 서비스 정의 파일(.proto)에서 스트리밍 메서드를 정의한다.</li><li>클라이언트가 서버에 요청을 보낸다.</li><li>서버는 스트림을 통해 여러 응답을 클라이언트에게 보낸다.</li><li>스트림이 완료되면 서버가 스트림을 닫는다.</li></ol><h5 id=구현-예시-grpc-서버-스트리밍>구현 예시 (gRPC 서버 스트리밍)<a hidden class=anchor aria-hidden=true href=#구현-예시-grpc-서버-스트리밍>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-proto data-lang=proto><span class=line><span class=cl><span class=c1>// task_service.proto
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>syntax</span> <span class=o>=</span> <span class=s>&#34;proto3&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kn>package</span> <span class=nn>task</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>service</span> <span class=n>TaskService</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// 서버 스트리밍 RPC
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>rpc</span> <span class=n>SubmitTask</span><span class=p>(</span><span class=n>TaskRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>stream</span> <span class=n>TaskUpdate</span><span class=p>);</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>TaskRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=n>map</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=kt>string</span><span class=p>&gt;</span> <span class=n>parameters</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>TaskUpdate</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>task_id</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>status</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>float</span> <span class=n>progress</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=kd>message</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>bytes</span> <span class=n>result</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26>26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27>27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28>28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29>29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30>30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31>31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32>32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33>33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34>34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35>35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36>36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37>37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38>38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39>39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40>40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41>41</a>
</span><span class=lnt id=hl-8-42><a class=lnlinks href=#hl-8-42>42</a>
</span><span class=lnt id=hl-8-43><a class=lnlinks href=#hl-8-43>43</a>
</span><span class=lnt id=hl-8-44><a class=lnlinks href=#hl-8-44>44</a>
</span><span class=lnt id=hl-8-45><a class=lnlinks href=#hl-8-45>45</a>
</span><span class=lnt id=hl-8-46><a class=lnlinks href=#hl-8-46>46</a>
</span><span class=lnt id=hl-8-47><a class=lnlinks href=#hl-8-47>47</a>
</span><span class=lnt id=hl-8-48><a class=lnlinks href=#hl-8-48>48</a>
</span><span class=lnt id=hl-8-49><a class=lnlinks href=#hl-8-49>49</a>
</span><span class=lnt id=hl-8-50><a class=lnlinks href=#hl-8-50>50</a>
</span><span class=lnt id=hl-8-51><a class=lnlinks href=#hl-8-51>51</a>
</span><span class=lnt id=hl-8-52><a class=lnlinks href=#hl-8-52>52</a>
</span><span class=lnt id=hl-8-53><a class=lnlinks href=#hl-8-53>53</a>
</span><span class=lnt id=hl-8-54><a class=lnlinks href=#hl-8-54>54</a>
</span><span class=lnt id=hl-8-55><a class=lnlinks href=#hl-8-55>55</a>
</span><span class=lnt id=hl-8-56><a class=lnlinks href=#hl-8-56>56</a>
</span><span class=lnt id=hl-8-57><a class=lnlinks href=#hl-8-57>57</a>
</span><span class=lnt id=hl-8-58><a class=lnlinks href=#hl-8-58>58</a>
</span><span class=lnt id=hl-8-59><a class=lnlinks href=#hl-8-59>59</a>
</span><span class=lnt id=hl-8-60><a class=lnlinks href=#hl-8-60>60</a>
</span><span class=lnt id=hl-8-61><a class=lnlinks href=#hl-8-61>61</a>
</span><span class=lnt id=hl-8-62><a class=lnlinks href=#hl-8-62>62</a>
</span><span class=lnt id=hl-8-63><a class=lnlinks href=#hl-8-63>63</a>
</span><span class=lnt id=hl-8-64><a class=lnlinks href=#hl-8-64>64</a>
</span><span class=lnt id=hl-8-65><a class=lnlinks href=#hl-8-65>65</a>
</span><span class=lnt id=hl-8-66><a class=lnlinks href=#hl-8-66>66</a>
</span><span class=lnt id=hl-8-67><a class=lnlinks href=#hl-8-67>67</a>
</span><span class=lnt id=hl-8-68><a class=lnlinks href=#hl-8-68>68</a>
</span><span class=lnt id=hl-8-69><a class=lnlinks href=#hl-8-69>69</a>
</span><span class=lnt id=hl-8-70><a class=lnlinks href=#hl-8-70>70</a>
</span><span class=lnt id=hl-8-71><a class=lnlinks href=#hl-8-71>71</a>
</span><span class=lnt id=hl-8-72><a class=lnlinks href=#hl-8-72>72</a>
</span><span class=lnt id=hl-8-73><a class=lnlinks href=#hl-8-73>73</a>
</span><span class=lnt id=hl-8-74><a class=lnlinks href=#hl-8-74>74</a>
</span><span class=lnt id=hl-8-75><a class=lnlinks href=#hl-8-75>75</a>
</span><span class=lnt id=hl-8-76><a class=lnlinks href=#hl-8-76>76</a>
</span><span class=lnt id=hl-8-77><a class=lnlinks href=#hl-8-77>77</a>
</span><span class=lnt id=hl-8-78><a class=lnlinks href=#hl-8-78>78</a>
</span><span class=lnt id=hl-8-79><a class=lnlinks href=#hl-8-79>79</a>
</span><span class=lnt id=hl-8-80><a class=lnlinks href=#hl-8-80>80</a>
</span><span class=lnt id=hl-8-81><a class=lnlinks href=#hl-8-81>81</a>
</span><span class=lnt id=hl-8-82><a class=lnlinks href=#hl-8-82>82</a>
</span><span class=lnt id=hl-8-83><a class=lnlinks href=#hl-8-83>83</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// gRPC 서비스 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TaskServiceImpl</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>TaskServiceGrpc</span><span class=p>.</span><span class=na>TaskServiceImplBase</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>submitTask</span><span class=p>(</span><span class=n>TaskRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>TaskUpdate</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 ID 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>taskId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 초기 업데이트 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>TaskUpdate</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setTaskId</span><span class=p>(</span><span class=n>taskId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=s>&#34;STARTED&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setProgress</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>0f</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setMessage</span><span class=p>(</span><span class=s>&#34;Task started&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 백그라운드에서 작업 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executorService</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 25% 진행 상황 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>TaskUpdate</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setTaskId</span><span class=p>(</span><span class=n>taskId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=s>&#34;PROCESSING&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setProgress</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>25f</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setMessage</span><span class=p>(</span><span class=s>&#34;Processing started&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>1000</span><span class=p>);</span><span class=w> </span><span class=c1>// 작업 시뮬레이션</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 50% 진행 상황 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>TaskUpdate</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setTaskId</span><span class=p>(</span><span class=n>taskId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=s>&#34;PROCESSING&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setProgress</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>5f</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setMessage</span><span class=p>(</span><span class=s>&#34;Processing halfway done&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>1000</span><span class=p>);</span><span class=w> </span><span class=c1>// 작업 시뮬레이션</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 75% 진행 상황 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>TaskUpdate</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setTaskId</span><span class=p>(</span><span class=n>taskId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=s>&#34;PROCESSING&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setProgress</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>75f</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setMessage</span><span class=p>(</span><span class=s>&#34;Processing almost complete&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>1000</span><span class=p>);</span><span class=w> </span><span class=c1>// 작업 시뮬레이션</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 작업 결과 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ByteString</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>processTask</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 완료 업데이트 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>TaskUpdate</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setTaskId</span><span class=p>(</span><span class=n>taskId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=s>&#34;COMPLETED&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setProgress</span><span class=p>(</span><span class=n>1</span><span class=p>.</span><span class=na>0f</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setMessage</span><span class=p>(</span><span class=s>&#34;Task completed successfully&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setResult</span><span class=p>(</span><span class=n>result</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 스트림 완료</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 오류 업데이트 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>TaskUpdate</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setTaskId</span><span class=p>(</span><span class=n>taskId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=s>&#34;FAILED&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setMessage</span><span class=p>(</span><span class=s>&#34;Error: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 스트림 완료</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>ByteString</span><span class=w> </span><span class=nf>processTask</span><span class=p>(</span><span class=n>TaskRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 실제 작업 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ByteString</span><span class=p>.</span><span class=na>copyFromUtf8</span><span class=p>(</span><span class=s>&#34;Task result data&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=장단점-6>장단점<a hidden class=anchor aria-hidden=true href=#장단점-6>#</a></h5><p><strong>장점:</strong></p><ul><li>HTTP/2 기반으로 효율적인 통신을 제공한다.</li><li>Protobuf를 사용하여 메시지 크기가 작고 직렬화/역직렬화가 빠르다.</li><li>양방향 스트리밍을 포함한 다양한 통신 패턴을 지원한다.</li><li>강력한 타입 검사와 코드 생성 기능이 있다.</li></ul><p><strong>단점:</strong></p><ul><li>REST API에 비해 학습 곡선이 가파르다.</li><li>브라우저 지원이 제한적이다(웹 클라이언트의 경우 gRPC-Web 필요).</li><li>인프라(로드 밸런서, 프록시)가 HTTP/2 및 스트리밍을 지원해야 한다.</li><li>서비스 정의 변경 시 버전 관리가 필요하다.</li></ul><h3 id=비동기식-api-설계-원칙>비동기식 API 설계 원칙<a hidden class=anchor aria-hidden=true href=#비동기식-api-설계-원칙>#</a></h3><p>효과적인 비동기식 API를 설계하기 위한 핵심 원칙:</p><h4 id=작업-식별자와-상태-추적>작업 식별자와 상태 추적<a hidden class=anchor aria-hidden=true href=#작업-식별자와-상태-추적>#</a></h4><p>비동기 작업을 고유하게 식별하고 상태를 추적하는 메커니즘이 필수적이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 작업 모델 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AsyncJob</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>JobStatus</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>createdAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>updatedAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>completedAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>errorMessage</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 상태 열거형</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>JobStatus</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PENDING</span><span class=p>,</span><span class=w>      </span><span class=c1>// 대기 중</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PROCESSING</span><span class=p>,</span><span class=w>   </span><span class=c1>// 처리 중</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>COMPLETED</span><span class=p>,</span><span class=w>    </span><span class=c1>// 완료됨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>FAILED</span><span class=p>,</span><span class=w>       </span><span class=c1>// 실패함</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CANCELLED</span><span class=w>     </span><span class=c1>// 취소됨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자, 게터, 세터 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=명확한-진행-상황-보고>명확한 진행 상황 보고<a hidden class=anchor aria-hidden=true href=#명확한-진행-상황-보고>#</a></h4><p>장기 실행 작업의 경우 클라이언트에게 진행 상황을 제공하는 것이 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 진행 상황 업데이트 엔드포인트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/api/jobs/{jobId}/progress&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobProgress</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getJobProgress</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>getJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>JobProgress</span><span class=w> </span><span class=n>progress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobProgress</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getProgressPercentage</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getCurrentStep</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getTotalSteps</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getEstimatedTimeRemaining</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>progress</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=멱등성idempotency-보장>멱등성(Idempotency) 보장<a hidden class=anchor aria-hidden=true href=#멱등성idempotency-보장>#</a></h4><p>비동기 작업에서는 중복 요청이나 재시도의 경우를 처리하기 위해 멱등성을 보장하는 것이 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 멱등성 키를 사용한 요청 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/payments&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>PaymentResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>processPayment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>PaymentRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestHeader</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Idempotency-Key&#34;</span><span class=p>,</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>idempotencyKey</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 멱등성 키로 기존 요청 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Payment</span><span class=w> </span><span class=n>existingPayment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentService</span><span class=p>.</span><span class=na>findByIdempotencyKey</span><span class=p>(</span><span class=n>idempotencyKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>existingPayment</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 기존 응답 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>existingPayment</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>PaymentStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=w> </span><span class=o>?</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>OK</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>ACCEPTED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>mapToResponse</span><span class=p>(</span><span class=n>existingPayment</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 새 요청 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Payment</span><span class=w> </span><span class=n>payment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Payment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>paymentId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PaymentStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>idempotencyKey</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>paymentService</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>payment</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 비동기 처리 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>paymentProcessor</span><span class=p>.</span><span class=na>processAsync</span><span class=p>(</span><span class=n>paymentId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>PaymentResponse</span><span class=p>(</span><span class=n>paymentId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PENDING&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/api/payments/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>paymentId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=타임아웃-및-만료-정책>타임아웃 및 만료 정책<a hidden class=anchor aria-hidden=true href=#타임아웃-및-만료-정책>#</a></h4><p>비동기 작업에는 명확한 타임아웃과 만료 정책이 필요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 작업 제한 시간 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/data-processing&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>startDataProcessing</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>ProcessingRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>defaultValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;3600&#34;</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>timeoutSeconds</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>expiresAt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>().</span><span class=na>plusSeconds</span><span class=p>(</span><span class=n>timeoutSeconds</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Job</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>,</span><span class=w> </span><span class=n>expiresAt</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>job</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 비동기 처리 시작 (타임아웃 포함)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>scheduledExecutorService</span><span class=p>.</span><span class=na>schedule</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Job</span><span class=w> </span><span class=n>currentJob</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>jobId</span><span class=p>).</span><span class=na>orElse</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>currentJob</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>(</span><span class=n>currentJob</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=w> </span><span class=o>||</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>             </span><span class=n>currentJob</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Operation timed out&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=n>timeoutSeconds</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dataProcessingService</span><span class=p>.</span><span class=na>processAsync</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResponse</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PENDING&#34;</span><span class=p>,</span><span class=w> </span><span class=n>expiresAt</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=오류-처리-및-재시도-메커니즘>오류 처리 및 재시도 메커니즘<a hidden class=anchor aria-hidden=true href=#오류-처리-및-재시도-메커니즘>#</a></h4><p>비동기 작업은 다양한 오류 상황을 처리할 수 있는 강력한 메커니즘이 필요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27>27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28>28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29>29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30>30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31>31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32>32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33>33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34>34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35>35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36>36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37>37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38>38</a>
</span><span class=lnt id=hl-13-39><a class=lnlinks href=#hl-13-39>39</a>
</span><span class=lnt id=hl-13-40><a class=lnlinks href=#hl-13-40>40</a>
</span><span class=lnt id=hl-13-41><a class=lnlinks href=#hl-13-41>41</a>
</span><span class=lnt id=hl-13-42><a class=lnlinks href=#hl-13-42>42</a>
</span><span class=lnt id=hl-13-43><a class=lnlinks href=#hl-13-43>43</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 재시도 정책이 있는 메시지 소비자</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobConsumer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobService</span><span class=w> </span><span class=n>jobService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RabbitListener</span><span class=p>(</span><span class=n>queues</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;job-queue&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Retryable</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>TemporaryFailureException</span><span class=p>.</span><span class=na>class</span><span class=w> </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>maxAttempts</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>3</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>backoff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nd>@Backoff</span><span class=p>(</span><span class=n>delay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1000</span><span class=p>,</span><span class=w> </span><span class=n>multiplier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processJob</span><span class=p>(</span><span class=n>JobMessage</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>getJobId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobService</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>JobResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>executeJob</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=na>getRequest</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 성공 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobService</span><span class=p>.</span><span class=na>completeJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>TemporaryFailureException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 일시적 실패 - 재시도됨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;Temporary failure processing job {}, will retry: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>  </span><span class=c1>// 재시도를 위해 예외 다시 throw</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 영구적 실패</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Permanent failure processing job {}: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobService</span><span class=p>.</span><span class=na>failJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Recover</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>recover</span><span class=p>(</span><span class=n>TemporaryFailureException</span><span class=w> </span><span class=n>e</span><span class=p>,</span><span class=w> </span><span class=n>JobMessage</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 최대 재시도 후에도 실패한 경우 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>getJobId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;All retries failed for job {}: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jobService</span><span class=p>.</span><span class=na>failJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Failed after multiple retries: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=작업-취소-기능>작업 취소 기능<a hidden class=anchor aria-hidden=true href=#작업-취소-기능>#</a></h4><p>장기 실행 작업의 경우 클라이언트가 작업을 취소할 수 있는 메커니즘이 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26>26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27>27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 작업 취소 엔드포인트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DeleteMapping</span><span class=p>(</span><span class=s>&#34;/api/jobs/{jobId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>cancelJob</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>getJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 이미 완료되거나 실패한 작업은 취소할 수 없음</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=w> </span><span class=o>||</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=w> </span><span class=o>||</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>CANCELLED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>badRequest</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;Cannot cancel job with status: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 취소 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>jobService</span><span class=p>.</span><span class=na>cancelJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResponse</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;CANCELLED&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=비동기식-api-구현-전략>비동기식 API 구현 전략<a hidden class=anchor aria-hidden=true href=#비동기식-api-구현-전략>#</a></h3><p>비동기식 API를 구현하기 위한 다양한 기술적 접근 방식과 전략</p><h4 id=작업-상태-저장소>작업 상태 저장소<a hidden class=anchor aria-hidden=true href=#작업-상태-저장소>#</a></h4><p>비동기 작업의 상태를 저장하고 조회하기 위한 저장소는 필수적이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>  1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>  2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>  3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>  4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>  5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>  6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>  7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8>  8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9>  9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10> 10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11> 11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12> 12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13> 13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14> 14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15> 15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16> 16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17> 17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18> 18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19> 19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20> 20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21> 21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22> 22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23> 23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24> 24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25> 25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26> 26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27> 27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28> 28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29> 29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30> 30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31> 31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32> 32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33> 33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34> 34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35> 35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36> 36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37> 37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38> 38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39> 39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40> 40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41> 41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42> 42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43> 43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44> 44</a>
</span><span class=lnt id=hl-15-45><a class=lnlinks href=#hl-15-45> 45</a>
</span><span class=lnt id=hl-15-46><a class=lnlinks href=#hl-15-46> 46</a>
</span><span class=lnt id=hl-15-47><a class=lnlinks href=#hl-15-47> 47</a>
</span><span class=lnt id=hl-15-48><a class=lnlinks href=#hl-15-48> 48</a>
</span><span class=lnt id=hl-15-49><a class=lnlinks href=#hl-15-49> 49</a>
</span><span class=lnt id=hl-15-50><a class=lnlinks href=#hl-15-50> 50</a>
</span><span class=lnt id=hl-15-51><a class=lnlinks href=#hl-15-51> 51</a>
</span><span class=lnt id=hl-15-52><a class=lnlinks href=#hl-15-52> 52</a>
</span><span class=lnt id=hl-15-53><a class=lnlinks href=#hl-15-53> 53</a>
</span><span class=lnt id=hl-15-54><a class=lnlinks href=#hl-15-54> 54</a>
</span><span class=lnt id=hl-15-55><a class=lnlinks href=#hl-15-55> 55</a>
</span><span class=lnt id=hl-15-56><a class=lnlinks href=#hl-15-56> 56</a>
</span><span class=lnt id=hl-15-57><a class=lnlinks href=#hl-15-57> 57</a>
</span><span class=lnt id=hl-15-58><a class=lnlinks href=#hl-15-58> 58</a>
</span><span class=lnt id=hl-15-59><a class=lnlinks href=#hl-15-59> 59</a>
</span><span class=lnt id=hl-15-60><a class=lnlinks href=#hl-15-60> 60</a>
</span><span class=lnt id=hl-15-61><a class=lnlinks href=#hl-15-61> 61</a>
</span><span class=lnt id=hl-15-62><a class=lnlinks href=#hl-15-62> 62</a>
</span><span class=lnt id=hl-15-63><a class=lnlinks href=#hl-15-63> 63</a>
</span><span class=lnt id=hl-15-64><a class=lnlinks href=#hl-15-64> 64</a>
</span><span class=lnt id=hl-15-65><a class=lnlinks href=#hl-15-65> 65</a>
</span><span class=lnt id=hl-15-66><a class=lnlinks href=#hl-15-66> 66</a>
</span><span class=lnt id=hl-15-67><a class=lnlinks href=#hl-15-67> 67</a>
</span><span class=lnt id=hl-15-68><a class=lnlinks href=#hl-15-68> 68</a>
</span><span class=lnt id=hl-15-69><a class=lnlinks href=#hl-15-69> 69</a>
</span><span class=lnt id=hl-15-70><a class=lnlinks href=#hl-15-70> 70</a>
</span><span class=lnt id=hl-15-71><a class=lnlinks href=#hl-15-71> 71</a>
</span><span class=lnt id=hl-15-72><a class=lnlinks href=#hl-15-72> 72</a>
</span><span class=lnt id=hl-15-73><a class=lnlinks href=#hl-15-73> 73</a>
</span><span class=lnt id=hl-15-74><a class=lnlinks href=#hl-15-74> 74</a>
</span><span class=lnt id=hl-15-75><a class=lnlinks href=#hl-15-75> 75</a>
</span><span class=lnt id=hl-15-76><a class=lnlinks href=#hl-15-76> 76</a>
</span><span class=lnt id=hl-15-77><a class=lnlinks href=#hl-15-77> 77</a>
</span><span class=lnt id=hl-15-78><a class=lnlinks href=#hl-15-78> 78</a>
</span><span class=lnt id=hl-15-79><a class=lnlinks href=#hl-15-79> 79</a>
</span><span class=lnt id=hl-15-80><a class=lnlinks href=#hl-15-80> 80</a>
</span><span class=lnt id=hl-15-81><a class=lnlinks href=#hl-15-81> 81</a>
</span><span class=lnt id=hl-15-82><a class=lnlinks href=#hl-15-82> 82</a>
</span><span class=lnt id=hl-15-83><a class=lnlinks href=#hl-15-83> 83</a>
</span><span class=lnt id=hl-15-84><a class=lnlinks href=#hl-15-84> 84</a>
</span><span class=lnt id=hl-15-85><a class=lnlinks href=#hl-15-85> 85</a>
</span><span class=lnt id=hl-15-86><a class=lnlinks href=#hl-15-86> 86</a>
</span><span class=lnt id=hl-15-87><a class=lnlinks href=#hl-15-87> 87</a>
</span><span class=lnt id=hl-15-88><a class=lnlinks href=#hl-15-88> 88</a>
</span><span class=lnt id=hl-15-89><a class=lnlinks href=#hl-15-89> 89</a>
</span><span class=lnt id=hl-15-90><a class=lnlinks href=#hl-15-90> 90</a>
</span><span class=lnt id=hl-15-91><a class=lnlinks href=#hl-15-91> 91</a>
</span><span class=lnt id=hl-15-92><a class=lnlinks href=#hl-15-92> 92</a>
</span><span class=lnt id=hl-15-93><a class=lnlinks href=#hl-15-93> 93</a>
</span><span class=lnt id=hl-15-94><a class=lnlinks href=#hl-15-94> 94</a>
</span><span class=lnt id=hl-15-95><a class=lnlinks href=#hl-15-95> 95</a>
</span><span class=lnt id=hl-15-96><a class=lnlinks href=#hl-15-96> 96</a>
</span><span class=lnt id=hl-15-97><a class=lnlinks href=#hl-15-97> 97</a>
</span><span class=lnt id=hl-15-98><a class=lnlinks href=#hl-15-98> 98</a>
</span><span class=lnt id=hl-15-99><a class=lnlinks href=#hl-15-99> 99</a>
</span><span class=lnt id=hl-15-100><a class=lnlinks href=#hl-15-100>100</a>
</span><span class=lnt id=hl-15-101><a class=lnlinks href=#hl-15-101>101</a>
</span><span class=lnt id=hl-15-102><a class=lnlinks href=#hl-15-102>102</a>
</span><span class=lnt id=hl-15-103><a class=lnlinks href=#hl-15-103>103</a>
</span><span class=lnt id=hl-15-104><a class=lnlinks href=#hl-15-104>104</a>
</span><span class=lnt id=hl-15-105><a class=lnlinks href=#hl-15-105>105</a>
</span><span class=lnt id=hl-15-106><a class=lnlinks href=#hl-15-106>106</a>
</span><span class=lnt id=hl-15-107><a class=lnlinks href=#hl-15-107>107</a>
</span><span class=lnt id=hl-15-108><a class=lnlinks href=#hl-15-108>108</a>
</span><span class=lnt id=hl-15-109><a class=lnlinks href=#hl-15-109>109</a>
</span><span class=lnt id=hl-15-110><a class=lnlinks href=#hl-15-110>110</a>
</span><span class=lnt id=hl-15-111><a class=lnlinks href=#hl-15-111>111</a>
</span><span class=lnt id=hl-15-112><a class=lnlinks href=#hl-15-112>112</a>
</span><span class=lnt id=hl-15-113><a class=lnlinks href=#hl-15-113>113</a>
</span><span class=lnt id=hl-15-114><a class=lnlinks href=#hl-15-114>114</a>
</span><span class=lnt id=hl-15-115><a class=lnlinks href=#hl-15-115>115</a>
</span><span class=lnt id=hl-15-116><a class=lnlinks href=#hl-15-116>116</a>
</span><span class=lnt id=hl-15-117><a class=lnlinks href=#hl-15-117>117</a>
</span><span class=lnt id=hl-15-118><a class=lnlinks href=#hl-15-118>118</a>
</span><span class=lnt id=hl-15-119><a class=lnlinks href=#hl-15-119>119</a>
</span><span class=lnt id=hl-15-120><a class=lnlinks href=#hl-15-120>120</a>
</span><span class=lnt id=hl-15-121><a class=lnlinks href=#hl-15-121>121</a>
</span><span class=lnt id=hl-15-122><a class=lnlinks href=#hl-15-122>122</a>
</span><span class=lnt id=hl-15-123><a class=lnlinks href=#hl-15-123>123</a>
</span><span class=lnt id=hl-15-124><a class=lnlinks href=#hl-15-124>124</a>
</span><span class=lnt id=hl-15-125><a class=lnlinks href=#hl-15-125>125</a>
</span><span class=lnt id=hl-15-126><a class=lnlinks href=#hl-15-126>126</a>
</span><span class=lnt id=hl-15-127><a class=lnlinks href=#hl-15-127>127</a>
</span><span class=lnt id=hl-15-128><a class=lnlinks href=#hl-15-128>128</a>
</span><span class=lnt id=hl-15-129><a class=lnlinks href=#hl-15-129>129</a>
</span><span class=lnt id=hl-15-130><a class=lnlinks href=#hl-15-130>130</a>
</span><span class=lnt id=hl-15-131><a class=lnlinks href=#hl-15-131>131</a>
</span><span class=lnt id=hl-15-132><a class=lnlinks href=#hl-15-132>132</a>
</span><span class=lnt id=hl-15-133><a class=lnlinks href=#hl-15-133>133</a>
</span><span class=lnt id=hl-15-134><a class=lnlinks href=#hl-15-134>134</a>
</span><span class=lnt id=hl-15-135><a class=lnlinks href=#hl-15-135>135</a>
</span><span class=lnt id=hl-15-136><a class=lnlinks href=#hl-15-136>136</a>
</span><span class=lnt id=hl-15-137><a class=lnlinks href=#hl-15-137>137</a>
</span><span class=lnt id=hl-15-138><a class=lnlinks href=#hl-15-138>138</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 작업 저장소 인터페이스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>JobRepository</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=nf>createJob</span><span class=p>(</span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Job</span><span class=w> </span><span class=nf>findById</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>updateStatus</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>JobStatus</span><span class=w> </span><span class=n>status</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>updateProgress</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=kt>float</span><span class=w> </span><span class=n>progress</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>completeJob</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>failJob</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>errorMessage</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>cancelJob</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Job</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findExpiredJobs</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>expirationTime</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Job</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findJobsByStatus</span><span class=p>(</span><span class=n>JobStatus</span><span class=w> </span><span class=n>status</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Redis를 사용한 작업 저장소 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RedisJobRepository</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>JobRepository</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>StringRedisTemplate</span><span class=w> </span><span class=n>redisTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ObjectMapper</span><span class=w> </span><span class=n>objectMapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Hash 작업을 위한 Redis 키 접두사</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>JOB_KEY_PREFIX</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;job:&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>createJob</span><span class=p>(</span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Job</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kc>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kc>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>0</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kc>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>saveJob</span><span class=p>(</span><span class=n>job</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>jobId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Job</span><span class=w> </span><span class=nf>findById</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JOB_KEY_PREFIX</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>jobId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Object</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>entries</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForHash</span><span class=p>().</span><span class=na>entries</span><span class=p>(</span><span class=n>key</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>entries</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// Redis 해시에서 Job 객체로 변환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Job</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>job</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>job</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>JobStatus</span><span class=p>.</span><span class=na>valueOf</span><span class=p>((</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>entries</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;status&#34;</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>job</span><span class=p>.</span><span class=na>setRequest</span><span class=p>(</span><span class=n>objectMapper</span><span class=p>.</span><span class=na>readValue</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>(</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>entries</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;request&#34;</span><span class=p>),</span><span class=w> </span><span class=n>JobRequest</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>entries</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=s>&#34;progress&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>job</span><span class=p>.</span><span class=na>setProgress</span><span class=p>(</span><span class=n>Float</span><span class=p>.</span><span class=na>parseFloat</span><span class=p>((</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>entries</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;progress&#34;</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>entries</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=s>&#34;message&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>job</span><span class=p>.</span><span class=na>setMessage</span><span class=p>((</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>entries</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;message&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>entries</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=s>&#34;result&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>job</span><span class=p>.</span><span class=na>setResult</span><span class=p>(</span><span class=n>objectMapper</span><span class=p>.</span><span class=na>readValue</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>(</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>entries</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;result&#34;</span><span class=p>),</span><span class=w> </span><span class=n>Object</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>entries</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=s>&#34;errorMessage&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>job</span><span class=p>.</span><span class=na>setErrorMessage</span><span class=p>((</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>entries</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;errorMessage&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>entries</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=s>&#34;createdAt&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>job</span><span class=p>.</span><span class=na>setCreatedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>parse</span><span class=p>((</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>entries</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;createdAt&#34;</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>entries</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=s>&#34;updatedAt&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>job</span><span class=p>.</span><span class=na>setUpdatedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>parse</span><span class=p>((</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>entries</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;updatedAt&#34;</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>entries</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=s>&#34;completedAt&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>job</span><span class=p>.</span><span class=na>setCompletedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>parse</span><span class=p>((</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>entries</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;completedAt&#34;</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>job</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=s>&#34;Error deserializing job&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 기타 메서드 구현…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>saveJob</span><span class=p>(</span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JOB_KEY_PREFIX</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>hash</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>hash</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>name</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>hash</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;request&#34;</span><span class=p>,</span><span class=w> </span><span class=n>objectMapper</span><span class=p>.</span><span class=na>writeValueAsString</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getRequest</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>hash</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;createdAt&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getCreatedAt</span><span class=p>().</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getUpdatedAt</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>hash</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;updatedAt&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getUpdatedAt</span><span class=p>().</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getProgress</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>hash</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;progress&#34;</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getProgress</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>hash</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;message&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getResult</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>hash</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;result&#34;</span><span class=p>,</span><span class=w> </span><span class=n>objectMapper</span><span class=p>.</span><span class=na>writeValueAsString</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getResult</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getErrorMessage</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>hash</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;errorMessage&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getErrorMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getCompletedAt</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>hash</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;completedAt&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getCompletedAt</span><span class=p>().</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForHash</span><span class=p>().</span><span class=na>putAll</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>hash</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 만료 시간 설정 (예: 7일)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>expire</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>7</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>DAYS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=s>&#34;Error serializing job&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=작업-스케줄링-및-배치-처리>작업 스케줄링 및 배치 처리<a hidden class=anchor aria-hidden=true href=#작업-스케줄링-및-배치-처리>#</a></h4><p>정기적으로 실행되어야 하는 작업이나 배치 처리가 필요한 경우의 전략.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33>33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34>34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35>35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36>36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37>37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38>38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39>39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40>40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41>41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42>42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43>43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44>44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45>45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46>46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47>47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48>48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49>49</a>
</span><span class=lnt id=hl-16-50><a class=lnlinks href=#hl-16-50>50</a>
</span><span class=lnt id=hl-16-51><a class=lnlinks href=#hl-16-51>51</a>
</span><span class=lnt id=hl-16-52><a class=lnlinks href=#hl-16-52>52</a>
</span><span class=lnt id=hl-16-53><a class=lnlinks href=#hl-16-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableScheduling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobSchedulingConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobRepository</span><span class=w> </span><span class=n>jobRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobProcessor</span><span class=w> </span><span class=n>jobProcessor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 만료된 작업 정리 스케줄러</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>fixedDelay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>60000</span><span class=p>)</span><span class=w> </span><span class=c1>// 1분마다 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>cleanupExpiredJobs</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>expirationTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>().</span><span class=na>minusDays</span><span class=p>(</span><span class=n>7</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Job</span><span class=o>&gt;</span><span class=w> </span><span class=n>expiredJobs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>findExpiredJobs</span><span class=p>(</span><span class=n>expirationTime</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>expiredJobs</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Job expired&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 오래된 작업 데이터 정리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>deleteJob</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 중단된 작업 복구 스케줄러</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>fixedDelay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>300000</span><span class=p>)</span><span class=w> </span><span class=c1>// 5분마다 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>recoverStalledJobs</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 오래 실행 중인 작업 찾기 (1시간 이상)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>cutoffTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>().</span><span class=na>minusHours</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Job</span><span class=o>&gt;</span><span class=w> </span><span class=n>stalledJobs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>findStalledJobs</span><span class=p>(</span><span class=n>cutoffTime</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>stalledJobs</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;Recovering stalled job: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 재시작 또는 실패 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getRetryCount</span><span class=p>()</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>3</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>incrementRetryCount</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>jobProcessor</span><span class=p>.</span><span class=na>processJob</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>failJob</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=s>&#34;Max retries exceeded after stall&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 배치 작업 처리 스케줄러</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>cron</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;0 0 2 * * *&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>// 매일 새벽 2시에 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>runDailyBatchJobs</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Starting daily batch job processing&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 배치 작업 생성 및 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>batchJobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>createJob</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>BatchJobRequest</span><span class=p>(</span><span class=s>&#34;DAILY_REPORT&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jobProcessor</span><span class=p>.</span><span class=na>processJob</span><span class=p>(</span><span class=n>batchJobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=웹훅-전송-및-재시도-전략>웹훅 전송 및 재시도 전략<a hidden class=anchor aria-hidden=true href=#웹훅-전송-및-재시도-전략>#</a></h4><p>웹훅 패턴 구현 시 전송 실패에 대한 재시도 전략이 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25>25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26>26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27>27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28>28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29>29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30>30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31>31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32>32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33>33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34>34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35>35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36>36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37>37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38>38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39>39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40>40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41>41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42>42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43>43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44>44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45>45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46>46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47>47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48>48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49>49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50>50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51>51</a>
</span><span class=lnt id=hl-17-52><a class=lnlinks href=#hl-17-52>52</a>
</span><span class=lnt id=hl-17-53><a class=lnlinks href=#hl-17-53>53</a>
</span><span class=lnt id=hl-17-54><a class=lnlinks href=#hl-17-54>54</a>
</span><span class=lnt id=hl-17-55><a class=lnlinks href=#hl-17-55>55</a>
</span><span class=lnt id=hl-17-56><a class=lnlinks href=#hl-17-56>56</a>
</span><span class=lnt id=hl-17-57><a class=lnlinks href=#hl-17-57>57</a>
</span><span class=lnt id=hl-17-58><a class=lnlinks href=#hl-17-58>58</a>
</span><span class=lnt id=hl-17-59><a class=lnlinks href=#hl-17-59>59</a>
</span><span class=lnt id=hl-17-60><a class=lnlinks href=#hl-17-60>60</a>
</span><span class=lnt id=hl-17-61><a class=lnlinks href=#hl-17-61>61</a>
</span><span class=lnt id=hl-17-62><a class=lnlinks href=#hl-17-62>62</a>
</span><span class=lnt id=hl-17-63><a class=lnlinks href=#hl-17-63>63</a>
</span><span class=lnt id=hl-17-64><a class=lnlinks href=#hl-17-64>64</a>
</span><span class=lnt id=hl-17-65><a class=lnlinks href=#hl-17-65>65</a>
</span><span class=lnt id=hl-17-66><a class=lnlinks href=#hl-17-66>66</a>
</span><span class=lnt id=hl-17-67><a class=lnlinks href=#hl-17-67>67</a>
</span><span class=lnt id=hl-17-68><a class=lnlinks href=#hl-17-68>68</a>
</span><span class=lnt id=hl-17-69><a class=lnlinks href=#hl-17-69>69</a>
</span><span class=lnt id=hl-17-70><a class=lnlinks href=#hl-17-70>70</a>
</span><span class=lnt id=hl-17-71><a class=lnlinks href=#hl-17-71>71</a>
</span><span class=lnt id=hl-17-72><a class=lnlinks href=#hl-17-72>72</a>
</span><span class=lnt id=hl-17-73><a class=lnlinks href=#hl-17-73>73</a>
</span><span class=lnt id=hl-17-74><a class=lnlinks href=#hl-17-74>74</a>
</span><span class=lnt id=hl-17-75><a class=lnlinks href=#hl-17-75>75</a>
</span><span class=lnt id=hl-17-76><a class=lnlinks href=#hl-17-76>76</a>
</span><span class=lnt id=hl-17-77><a class=lnlinks href=#hl-17-77>77</a>
</span><span class=lnt id=hl-17-78><a class=lnlinks href=#hl-17-78>78</a>
</span><span class=lnt id=hl-17-79><a class=lnlinks href=#hl-17-79>79</a>
</span><span class=lnt id=hl-17-80><a class=lnlinks href=#hl-17-80>80</a>
</span><span class=lnt id=hl-17-81><a class=lnlinks href=#hl-17-81>81</a>
</span><span class=lnt id=hl-17-82><a class=lnlinks href=#hl-17-82>82</a>
</span><span class=lnt id=hl-17-83><a class=lnlinks href=#hl-17-83>83</a>
</span><span class=lnt id=hl-17-84><a class=lnlinks href=#hl-17-84>84</a>
</span><span class=lnt id=hl-17-85><a class=lnlinks href=#hl-17-85>85</a>
</span><span class=lnt id=hl-17-86><a class=lnlinks href=#hl-17-86>86</a>
</span><span class=lnt id=hl-17-87><a class=lnlinks href=#hl-17-87>87</a>
</span><span class=lnt id=hl-17-88><a class=lnlinks href=#hl-17-88>88</a>
</span><span class=lnt id=hl-17-89><a class=lnlinks href=#hl-17-89>89</a>
</span><span class=lnt id=hl-17-90><a class=lnlinks href=#hl-17-90>90</a>
</span><span class=lnt id=hl-17-91><a class=lnlinks href=#hl-17-91>91</a>
</span><span class=lnt id=hl-17-92><a class=lnlinks href=#hl-17-92>92</a>
</span><span class=lnt id=hl-17-93><a class=lnlinks href=#hl-17-93>93</a>
</span><span class=lnt id=hl-17-94><a class=lnlinks href=#hl-17-94>94</a>
</span><span class=lnt id=hl-17-95><a class=lnlinks href=#hl-17-95>95</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebhookService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>WebhookRepository</span><span class=w> </span><span class=n>webhookRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ScheduledExecutorService</span><span class=w> </span><span class=n>executorService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendWebhook</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>payload</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 웹훅 레코드 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>WebhookRecord</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>WebhookRecord</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>url</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>payload</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>0</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>WebhookStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kc>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>webhookRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>record</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 웹훅 전송 시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>tryDeliverWebhook</span><span class=p>(</span><span class=n>record</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>tryDeliverWebhook</span><span class=p>(</span><span class=n>WebhookRecord</span><span class=w> </span><span class=n>record</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>attemptCount</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 웹훅 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HttpHeaders</span><span class=w> </span><span class=n>headers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HttpHeaders</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>headers</span><span class=p>.</span><span class=na>setContentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>headers</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=s>&#34;X-Webhook-ID&#34;</span><span class=p>,</span><span class=w> </span><span class=n>record</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>headers</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=s>&#34;X-Webhook-Timestamp&#34;</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HttpEntity</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HttpEntity</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>record</span><span class=p>.</span><span class=na>getPayload</span><span class=p>(),</span><span class=w> </span><span class=n>headers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>postForEntity</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>record</span><span class=err>.</span><span class=nc>getUrl</span><span class=p>(),</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 성공 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>getStatusCode</span><span class=p>().</span><span class=na>is2xxSuccessful</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>webhookRepository</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kd>record</span><span class=err>.</span><span class=nc>getId</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>WebhookStatus</span><span class=p>.</span><span class=na>DELIVERED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>response</span><span class=p>.</span><span class=na>getStatusCode</span><span class=p>().</span><span class=na>toString</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>handleDeliveryFailure</span><span class=p>(</span><span class=n>record</span><span class=p>,</span><span class=w> </span><span class=n>attemptCount</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;Non-success status code: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getStatusCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>handleDeliveryFailure</span><span class=p>(</span><span class=n>record</span><span class=p>,</span><span class=w> </span><span class=n>attemptCount</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleDeliveryFailure</span><span class=p>(</span><span class=n>WebhookRecord</span><span class=w> </span><span class=n>record</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>attemptCount</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 최대 재시도 횟수 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>attemptCount</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>5</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>webhookRepository</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>record</span><span class=err>.</span><span class=nc>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>WebhookStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;Max retries exceeded. Last error: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>error</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재시도 횟수 및 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>webhookRepository</span><span class=p>.</span><span class=na>incrementRetryCount</span><span class=p>(</span><span class=n>record</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>webhookRepository</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>record</span><span class=err>.</span><span class=nc>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>WebhookStatus</span><span class=p>.</span><span class=na>RETRY_PENDING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;Will retry. Last error: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>error</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 지수 백오프를 사용한 재시도 스케줄링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>delaySeconds</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=n>Math</span><span class=p>.</span><span class=na>pow</span><span class=p>(</span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>attemptCount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executorService</span><span class=p>.</span><span class=na>schedule</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>tryDeliverWebhook</span><span class=p>(</span><span class=n>record</span><span class=p>,</span><span class=w> </span><span class=n>attemptCount</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>delaySeconds</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 실패한 웹훅 수동 재시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>retryFailedWebhook</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>webhookId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>WebhookRecord</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>webhookRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>webhookId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>record</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>(</span><span class=n>record</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WebhookStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=w> </span><span class=o>||</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>             </span><span class=kd>record</span><span class=err>.</span><span class=nc>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WebhookStatus</span><span class=p>.</span><span class=na>RETRY_PENDING</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 재시도 카운트 초기화 및 재시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>webhookRepository</span><span class=p>.</span><span class=na>resetRetryCount</span><span class=p>(</span><span class=n>webhookId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>tryDeliverWebhook</span><span class=p>(</span><span class=n>record</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=상태-머신state-machine-기반-워크플로>상태 머신(State Machine) 기반 워크플로<a hidden class=anchor aria-hidden=true href=#상태-머신state-machine-기반-워크플로>#</a></h4><p>복잡한 비동기 워크플로우를 관리하기 위한 상태 머신 기반 접근 방식.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>  1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>  2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>  3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>  4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>  5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6>  6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7>  7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8>  8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9>  9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10> 10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11> 11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12> 12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13> 13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14> 14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15> 15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16> 16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17> 17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18> 18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19> 19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20> 20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21> 21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22> 22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23> 23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24> 24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25> 25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26> 26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27> 27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28> 28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29> 29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30> 30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31> 31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32> 32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33> 33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34> 34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35> 35</a>
</span><span class=lnt id=hl-18-36><a class=lnlinks href=#hl-18-36> 36</a>
</span><span class=lnt id=hl-18-37><a class=lnlinks href=#hl-18-37> 37</a>
</span><span class=lnt id=hl-18-38><a class=lnlinks href=#hl-18-38> 38</a>
</span><span class=lnt id=hl-18-39><a class=lnlinks href=#hl-18-39> 39</a>
</span><span class=lnt id=hl-18-40><a class=lnlinks href=#hl-18-40> 40</a>
</span><span class=lnt id=hl-18-41><a class=lnlinks href=#hl-18-41> 41</a>
</span><span class=lnt id=hl-18-42><a class=lnlinks href=#hl-18-42> 42</a>
</span><span class=lnt id=hl-18-43><a class=lnlinks href=#hl-18-43> 43</a>
</span><span class=lnt id=hl-18-44><a class=lnlinks href=#hl-18-44> 44</a>
</span><span class=lnt id=hl-18-45><a class=lnlinks href=#hl-18-45> 45</a>
</span><span class=lnt id=hl-18-46><a class=lnlinks href=#hl-18-46> 46</a>
</span><span class=lnt id=hl-18-47><a class=lnlinks href=#hl-18-47> 47</a>
</span><span class=lnt id=hl-18-48><a class=lnlinks href=#hl-18-48> 48</a>
</span><span class=lnt id=hl-18-49><a class=lnlinks href=#hl-18-49> 49</a>
</span><span class=lnt id=hl-18-50><a class=lnlinks href=#hl-18-50> 50</a>
</span><span class=lnt id=hl-18-51><a class=lnlinks href=#hl-18-51> 51</a>
</span><span class=lnt id=hl-18-52><a class=lnlinks href=#hl-18-52> 52</a>
</span><span class=lnt id=hl-18-53><a class=lnlinks href=#hl-18-53> 53</a>
</span><span class=lnt id=hl-18-54><a class=lnlinks href=#hl-18-54> 54</a>
</span><span class=lnt id=hl-18-55><a class=lnlinks href=#hl-18-55> 55</a>
</span><span class=lnt id=hl-18-56><a class=lnlinks href=#hl-18-56> 56</a>
</span><span class=lnt id=hl-18-57><a class=lnlinks href=#hl-18-57> 57</a>
</span><span class=lnt id=hl-18-58><a class=lnlinks href=#hl-18-58> 58</a>
</span><span class=lnt id=hl-18-59><a class=lnlinks href=#hl-18-59> 59</a>
</span><span class=lnt id=hl-18-60><a class=lnlinks href=#hl-18-60> 60</a>
</span><span class=lnt id=hl-18-61><a class=lnlinks href=#hl-18-61> 61</a>
</span><span class=lnt id=hl-18-62><a class=lnlinks href=#hl-18-62> 62</a>
</span><span class=lnt id=hl-18-63><a class=lnlinks href=#hl-18-63> 63</a>
</span><span class=lnt id=hl-18-64><a class=lnlinks href=#hl-18-64> 64</a>
</span><span class=lnt id=hl-18-65><a class=lnlinks href=#hl-18-65> 65</a>
</span><span class=lnt id=hl-18-66><a class=lnlinks href=#hl-18-66> 66</a>
</span><span class=lnt id=hl-18-67><a class=lnlinks href=#hl-18-67> 67</a>
</span><span class=lnt id=hl-18-68><a class=lnlinks href=#hl-18-68> 68</a>
</span><span class=lnt id=hl-18-69><a class=lnlinks href=#hl-18-69> 69</a>
</span><span class=lnt id=hl-18-70><a class=lnlinks href=#hl-18-70> 70</a>
</span><span class=lnt id=hl-18-71><a class=lnlinks href=#hl-18-71> 71</a>
</span><span class=lnt id=hl-18-72><a class=lnlinks href=#hl-18-72> 72</a>
</span><span class=lnt id=hl-18-73><a class=lnlinks href=#hl-18-73> 73</a>
</span><span class=lnt id=hl-18-74><a class=lnlinks href=#hl-18-74> 74</a>
</span><span class=lnt id=hl-18-75><a class=lnlinks href=#hl-18-75> 75</a>
</span><span class=lnt id=hl-18-76><a class=lnlinks href=#hl-18-76> 76</a>
</span><span class=lnt id=hl-18-77><a class=lnlinks href=#hl-18-77> 77</a>
</span><span class=lnt id=hl-18-78><a class=lnlinks href=#hl-18-78> 78</a>
</span><span class=lnt id=hl-18-79><a class=lnlinks href=#hl-18-79> 79</a>
</span><span class=lnt id=hl-18-80><a class=lnlinks href=#hl-18-80> 80</a>
</span><span class=lnt id=hl-18-81><a class=lnlinks href=#hl-18-81> 81</a>
</span><span class=lnt id=hl-18-82><a class=lnlinks href=#hl-18-82> 82</a>
</span><span class=lnt id=hl-18-83><a class=lnlinks href=#hl-18-83> 83</a>
</span><span class=lnt id=hl-18-84><a class=lnlinks href=#hl-18-84> 84</a>
</span><span class=lnt id=hl-18-85><a class=lnlinks href=#hl-18-85> 85</a>
</span><span class=lnt id=hl-18-86><a class=lnlinks href=#hl-18-86> 86</a>
</span><span class=lnt id=hl-18-87><a class=lnlinks href=#hl-18-87> 87</a>
</span><span class=lnt id=hl-18-88><a class=lnlinks href=#hl-18-88> 88</a>
</span><span class=lnt id=hl-18-89><a class=lnlinks href=#hl-18-89> 89</a>
</span><span class=lnt id=hl-18-90><a class=lnlinks href=#hl-18-90> 90</a>
</span><span class=lnt id=hl-18-91><a class=lnlinks href=#hl-18-91> 91</a>
</span><span class=lnt id=hl-18-92><a class=lnlinks href=#hl-18-92> 92</a>
</span><span class=lnt id=hl-18-93><a class=lnlinks href=#hl-18-93> 93</a>
</span><span class=lnt id=hl-18-94><a class=lnlinks href=#hl-18-94> 94</a>
</span><span class=lnt id=hl-18-95><a class=lnlinks href=#hl-18-95> 95</a>
</span><span class=lnt id=hl-18-96><a class=lnlinks href=#hl-18-96> 96</a>
</span><span class=lnt id=hl-18-97><a class=lnlinks href=#hl-18-97> 97</a>
</span><span class=lnt id=hl-18-98><a class=lnlinks href=#hl-18-98> 98</a>
</span><span class=lnt id=hl-18-99><a class=lnlinks href=#hl-18-99> 99</a>
</span><span class=lnt id=hl-18-100><a class=lnlinks href=#hl-18-100>100</a>
</span><span class=lnt id=hl-18-101><a class=lnlinks href=#hl-18-101>101</a>
</span><span class=lnt id=hl-18-102><a class=lnlinks href=#hl-18-102>102</a>
</span><span class=lnt id=hl-18-103><a class=lnlinks href=#hl-18-103>103</a>
</span><span class=lnt id=hl-18-104><a class=lnlinks href=#hl-18-104>104</a>
</span><span class=lnt id=hl-18-105><a class=lnlinks href=#hl-18-105>105</a>
</span><span class=lnt id=hl-18-106><a class=lnlinks href=#hl-18-106>106</a>
</span><span class=lnt id=hl-18-107><a class=lnlinks href=#hl-18-107>107</a>
</span><span class=lnt id=hl-18-108><a class=lnlinks href=#hl-18-108>108</a>
</span><span class=lnt id=hl-18-109><a class=lnlinks href=#hl-18-109>109</a>
</span><span class=lnt id=hl-18-110><a class=lnlinks href=#hl-18-110>110</a>
</span><span class=lnt id=hl-18-111><a class=lnlinks href=#hl-18-111>111</a>
</span><span class=lnt id=hl-18-112><a class=lnlinks href=#hl-18-112>112</a>
</span><span class=lnt id=hl-18-113><a class=lnlinks href=#hl-18-113>113</a>
</span><span class=lnt id=hl-18-114><a class=lnlinks href=#hl-18-114>114</a>
</span><span class=lnt id=hl-18-115><a class=lnlinks href=#hl-18-115>115</a>
</span><span class=lnt id=hl-18-116><a class=lnlinks href=#hl-18-116>116</a>
</span><span class=lnt id=hl-18-117><a class=lnlinks href=#hl-18-117>117</a>
</span><span class=lnt id=hl-18-118><a class=lnlinks href=#hl-18-118>118</a>
</span><span class=lnt id=hl-18-119><a class=lnlinks href=#hl-18-119>119</a>
</span><span class=lnt id=hl-18-120><a class=lnlinks href=#hl-18-120>120</a>
</span><span class=lnt id=hl-18-121><a class=lnlinks href=#hl-18-121>121</a>
</span><span class=lnt id=hl-18-122><a class=lnlinks href=#hl-18-122>122</a>
</span><span class=lnt id=hl-18-123><a class=lnlinks href=#hl-18-123>123</a>
</span><span class=lnt id=hl-18-124><a class=lnlinks href=#hl-18-124>124</a>
</span><span class=lnt id=hl-18-125><a class=lnlinks href=#hl-18-125>125</a>
</span><span class=lnt id=hl-18-126><a class=lnlinks href=#hl-18-126>126</a>
</span><span class=lnt id=hl-18-127><a class=lnlinks href=#hl-18-127>127</a>
</span><span class=lnt id=hl-18-128><a class=lnlinks href=#hl-18-128>128</a>
</span><span class=lnt id=hl-18-129><a class=lnlinks href=#hl-18-129>129</a>
</span><span class=lnt id=hl-18-130><a class=lnlinks href=#hl-18-130>130</a>
</span><span class=lnt id=hl-18-131><a class=lnlinks href=#hl-18-131>131</a>
</span><span class=lnt id=hl-18-132><a class=lnlinks href=#hl-18-132>132</a>
</span><span class=lnt id=hl-18-133><a class=lnlinks href=#hl-18-133>133</a>
</span><span class=lnt id=hl-18-134><a class=lnlinks href=#hl-18-134>134</a>
</span><span class=lnt id=hl-18-135><a class=lnlinks href=#hl-18-135>135</a>
</span><span class=lnt id=hl-18-136><a class=lnlinks href=#hl-18-136>136</a>
</span><span class=lnt id=hl-18-137><a class=lnlinks href=#hl-18-137>137</a>
</span><span class=lnt id=hl-18-138><a class=lnlinks href=#hl-18-138>138</a>
</span><span class=lnt id=hl-18-139><a class=lnlinks href=#hl-18-139>139</a>
</span><span class=lnt id=hl-18-140><a class=lnlinks href=#hl-18-140>140</a>
</span><span class=lnt id=hl-18-141><a class=lnlinks href=#hl-18-141>141</a>
</span><span class=lnt id=hl-18-142><a class=lnlinks href=#hl-18-142>142</a>
</span><span class=lnt id=hl-18-143><a class=lnlinks href=#hl-18-143>143</a>
</span><span class=lnt id=hl-18-144><a class=lnlinks href=#hl-18-144>144</a>
</span><span class=lnt id=hl-18-145><a class=lnlinks href=#hl-18-145>145</a>
</span><span class=lnt id=hl-18-146><a class=lnlinks href=#hl-18-146>146</a>
</span><span class=lnt id=hl-18-147><a class=lnlinks href=#hl-18-147>147</a>
</span><span class=lnt id=hl-18-148><a class=lnlinks href=#hl-18-148>148</a>
</span><span class=lnt id=hl-18-149><a class=lnlinks href=#hl-18-149>149</a>
</span><span class=lnt id=hl-18-150><a class=lnlinks href=#hl-18-150>150</a>
</span><span class=lnt id=hl-18-151><a class=lnlinks href=#hl-18-151>151</a>
</span><span class=lnt id=hl-18-152><a class=lnlinks href=#hl-18-152>152</a>
</span><span class=lnt id=hl-18-153><a class=lnlinks href=#hl-18-153>153</a>
</span><span class=lnt id=hl-18-154><a class=lnlinks href=#hl-18-154>154</a>
</span><span class=lnt id=hl-18-155><a class=lnlinks href=#hl-18-155>155</a>
</span><span class=lnt id=hl-18-156><a class=lnlinks href=#hl-18-156>156</a>
</span><span class=lnt id=hl-18-157><a class=lnlinks href=#hl-18-157>157</a>
</span><span class=lnt id=hl-18-158><a class=lnlinks href=#hl-18-158>158</a>
</span><span class=lnt id=hl-18-159><a class=lnlinks href=#hl-18-159>159</a>
</span><span class=lnt id=hl-18-160><a class=lnlinks href=#hl-18-160>160</a>
</span><span class=lnt id=hl-18-161><a class=lnlinks href=#hl-18-161>161</a>
</span><span class=lnt id=hl-18-162><a class=lnlinks href=#hl-18-162>162</a>
</span><span class=lnt id=hl-18-163><a class=lnlinks href=#hl-18-163>163</a>
</span><span class=lnt id=hl-18-164><a class=lnlinks href=#hl-18-164>164</a>
</span><span class=lnt id=hl-18-165><a class=lnlinks href=#hl-18-165>165</a>
</span><span class=lnt id=hl-18-166><a class=lnlinks href=#hl-18-166>166</a>
</span><span class=lnt id=hl-18-167><a class=lnlinks href=#hl-18-167>167</a>
</span><span class=lnt id=hl-18-168><a class=lnlinks href=#hl-18-168>168</a>
</span><span class=lnt id=hl-18-169><a class=lnlinks href=#hl-18-169>169</a>
</span><span class=lnt id=hl-18-170><a class=lnlinks href=#hl-18-170>170</a>
</span><span class=lnt id=hl-18-171><a class=lnlinks href=#hl-18-171>171</a>
</span><span class=lnt id=hl-18-172><a class=lnlinks href=#hl-18-172>172</a>
</span><span class=lnt id=hl-18-173><a class=lnlinks href=#hl-18-173>173</a>
</span><span class=lnt id=hl-18-174><a class=lnlinks href=#hl-18-174>174</a>
</span><span class=lnt id=hl-18-175><a class=lnlinks href=#hl-18-175>175</a>
</span><span class=lnt id=hl-18-176><a class=lnlinks href=#hl-18-176>176</a>
</span><span class=lnt id=hl-18-177><a class=lnlinks href=#hl-18-177>177</a>
</span><span class=lnt id=hl-18-178><a class=lnlinks href=#hl-18-178>178</a>
</span><span class=lnt id=hl-18-179><a class=lnlinks href=#hl-18-179>179</a>
</span><span class=lnt id=hl-18-180><a class=lnlinks href=#hl-18-180>180</a>
</span><span class=lnt id=hl-18-181><a class=lnlinks href=#hl-18-181>181</a>
</span><span class=lnt id=hl-18-182><a class=lnlinks href=#hl-18-182>182</a>
</span><span class=lnt id=hl-18-183><a class=lnlinks href=#hl-18-183>183</a>
</span><span class=lnt id=hl-18-184><a class=lnlinks href=#hl-18-184>184</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 주문 처리 워크플로우 상태 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>OrderState</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CREATED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PAYMENT_PENDING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PAYMENT_COMPLETED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PAYMENT_FAILED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>INVENTORY_CHECKING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>INVENTORY_CONFIRMED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>INVENTORY_FAILED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PROCESSING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SHIPPED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DELIVERED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CANCELLED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>REFUNDED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 주문 이벤트 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>OrderEvent</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CREATE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SUBMIT_PAYMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PAYMENT_SUCCEEDED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PAYMENT_FAILED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CHECK_INVENTORY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>INVENTORY_AVAILABLE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>INVENTORY_UNAVAILABLE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PROCESS</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SHIP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DELIVER</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CANCEL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>REFUND</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableStateMachineFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderStateMachineConfig</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>StateMachineConfigurerAdapter</span><span class=o>&lt;</span><span class=n>OrderState</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>StateMachineStateConfigurer</span><span class=o>&lt;</span><span class=n>OrderState</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>states</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>states</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withStates</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>initial</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>CREATED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_PENDING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_COMPLETED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_FAILED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>INVENTORY_CHECKING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>INVENTORY_CONFIRMED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>INVENTORY_FAILED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>SHIPPED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>DELIVERED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>CANCELLED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>REFUNDED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>StateMachineTransitionConfigurer</span><span class=o>&lt;</span><span class=n>OrderState</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>transitions</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transitions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>CREATED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_PENDING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>SUBMIT_PAYMENT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_PENDING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_COMPLETED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>PAYMENT_SUCCEEDED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_PENDING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_FAILED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>PAYMENT_FAILED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_COMPLETED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>INVENTORY_CHECKING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>CHECK_INVENTORY</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>INVENTORY_CHECKING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>INVENTORY_CONFIRMED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>INVENTORY_AVAILABLE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>INVENTORY_CHECKING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>INVENTORY_FAILED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>INVENTORY_UNAVAILABLE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>INVENTORY_CONFIRMED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>PROCESS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>SHIPPED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>SHIP</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>SHIPPED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>DELIVERED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>DELIVER</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>CREATED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>CANCELLED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>CANCEL</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_PENDING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>CANCELLED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>CANCEL</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withExternal</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>source</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>PAYMENT_COMPLETED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=n>OrderState</span><span class=p>.</span><span class=na>REFUNDED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>event</span><span class=p>(</span><span class=n>OrderEvent</span><span class=p>.</span><span class=na>REFUND</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>StateMachineConfigurationConfigurer</span><span class=o>&lt;</span><span class=n>OrderState</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>config</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withConfiguration</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>autoStartup</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>listener</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>OrderStateMachineListener</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 상태 변경 리스너</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderStateMachineListener</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>StateMachineListenerAdapter</span><span class=o>&lt;</span><span class=n>OrderState</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>stateChanged</span><span class=p>(</span><span class=n>State</span><span class=o>&lt;</span><span class=n>OrderState</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>from</span><span class=p>,</span><span class=w> </span><span class=n>State</span><span class=o>&lt;</span><span class=n>OrderState</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>to</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>from</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Order state changed from {} to {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>from</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>to</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>StateMachineFactory</span><span class=o>&lt;</span><span class=n>OrderState</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>stateMachineFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 주문 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>createOrder</span><span class=p>(</span><span class=n>OrderRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 주문 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Order</span><span class=p>(</span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>OrderState</span><span class=p>.</span><span class=na>CREATED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>orderId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 주문 상태 변경</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>processOrderEvent</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=w> </span><span class=n>event</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=c1>// 주문 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>orderId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>order</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	        </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=c1>// 상태 머신 생성 및 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>StateMachine</span><span class=o>&lt;</span><span class=n>OrderState</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>stateMachine</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stateMachineFactory</span><span class=p>.</span><span class=na>getStateMachine</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>stateMachine</span><span class=p>.</span><span class=na>getExtendedState</span><span class=p>().</span><span class=na>getVariables</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;order&#34;</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>stateMachine</span><span class=p>.</span><span class=na>getExtendedState</span><span class=p>().</span><span class=na>getVariables</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;data&#34;</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=c1>// 현재 상태로 복원</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>StateMachineAccessor</span><span class=o>&lt;</span><span class=n>OrderState</span><span class=p>,</span><span class=w> </span><span class=n>OrderEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>accessor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stateMachine</span><span class=p>.</span><span class=na>getStateMachineAccessor</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>accessor</span><span class=p>.</span><span class=na>doWithAllRegions</span><span class=p>(</span><span class=n>stateMachineAccess</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	        </span><span class=n>stateMachineAccess</span><span class=p>.</span><span class=na>resetStateMachine</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>DefaultStateMachineContext</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	            </span><span class=n>order</span><span class=p>.</span><span class=na>getState</span><span class=p>(),</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=c1>// 이벤트 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=kt>boolean</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stateMachine</span><span class=p>.</span><span class=na>sendEvent</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=c1>// 상태 변경이 성공하면 주문 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>result</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	        </span><span class=n>order</span><span class=p>.</span><span class=na>setState</span><span class=p>(</span><span class=n>stateMachine</span><span class=p>.</span><span class=na>getState</span><span class=p>().</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	        </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=이벤트-소싱event-sourcing-패턴>이벤트 소싱(Event Sourcing) 패턴<a hidden class=anchor aria-hidden=true href=#이벤트-소싱event-sourcing-패턴>#</a></h4><p>이벤트 소싱은 시스템의 상태 변화를 이벤트의 시퀀스로 저장하는 패턴으로, 비동기 API 구현에 자주 사용된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>  1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>  2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>  3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>  4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>  5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>  6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>  7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8>  8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9>  9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10> 10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11> 11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12> 12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13> 13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14> 14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15> 15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16> 16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17> 17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18> 18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19> 19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20> 20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21> 21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22> 22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23> 23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24> 24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25> 25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26> 26</a>
</span><span class=lnt id=hl-19-27><a class=lnlinks href=#hl-19-27> 27</a>
</span><span class=lnt id=hl-19-28><a class=lnlinks href=#hl-19-28> 28</a>
</span><span class=lnt id=hl-19-29><a class=lnlinks href=#hl-19-29> 29</a>
</span><span class=lnt id=hl-19-30><a class=lnlinks href=#hl-19-30> 30</a>
</span><span class=lnt id=hl-19-31><a class=lnlinks href=#hl-19-31> 31</a>
</span><span class=lnt id=hl-19-32><a class=lnlinks href=#hl-19-32> 32</a>
</span><span class=lnt id=hl-19-33><a class=lnlinks href=#hl-19-33> 33</a>
</span><span class=lnt id=hl-19-34><a class=lnlinks href=#hl-19-34> 34</a>
</span><span class=lnt id=hl-19-35><a class=lnlinks href=#hl-19-35> 35</a>
</span><span class=lnt id=hl-19-36><a class=lnlinks href=#hl-19-36> 36</a>
</span><span class=lnt id=hl-19-37><a class=lnlinks href=#hl-19-37> 37</a>
</span><span class=lnt id=hl-19-38><a class=lnlinks href=#hl-19-38> 38</a>
</span><span class=lnt id=hl-19-39><a class=lnlinks href=#hl-19-39> 39</a>
</span><span class=lnt id=hl-19-40><a class=lnlinks href=#hl-19-40> 40</a>
</span><span class=lnt id=hl-19-41><a class=lnlinks href=#hl-19-41> 41</a>
</span><span class=lnt id=hl-19-42><a class=lnlinks href=#hl-19-42> 42</a>
</span><span class=lnt id=hl-19-43><a class=lnlinks href=#hl-19-43> 43</a>
</span><span class=lnt id=hl-19-44><a class=lnlinks href=#hl-19-44> 44</a>
</span><span class=lnt id=hl-19-45><a class=lnlinks href=#hl-19-45> 45</a>
</span><span class=lnt id=hl-19-46><a class=lnlinks href=#hl-19-46> 46</a>
</span><span class=lnt id=hl-19-47><a class=lnlinks href=#hl-19-47> 47</a>
</span><span class=lnt id=hl-19-48><a class=lnlinks href=#hl-19-48> 48</a>
</span><span class=lnt id=hl-19-49><a class=lnlinks href=#hl-19-49> 49</a>
</span><span class=lnt id=hl-19-50><a class=lnlinks href=#hl-19-50> 50</a>
</span><span class=lnt id=hl-19-51><a class=lnlinks href=#hl-19-51> 51</a>
</span><span class=lnt id=hl-19-52><a class=lnlinks href=#hl-19-52> 52</a>
</span><span class=lnt id=hl-19-53><a class=lnlinks href=#hl-19-53> 53</a>
</span><span class=lnt id=hl-19-54><a class=lnlinks href=#hl-19-54> 54</a>
</span><span class=lnt id=hl-19-55><a class=lnlinks href=#hl-19-55> 55</a>
</span><span class=lnt id=hl-19-56><a class=lnlinks href=#hl-19-56> 56</a>
</span><span class=lnt id=hl-19-57><a class=lnlinks href=#hl-19-57> 57</a>
</span><span class=lnt id=hl-19-58><a class=lnlinks href=#hl-19-58> 58</a>
</span><span class=lnt id=hl-19-59><a class=lnlinks href=#hl-19-59> 59</a>
</span><span class=lnt id=hl-19-60><a class=lnlinks href=#hl-19-60> 60</a>
</span><span class=lnt id=hl-19-61><a class=lnlinks href=#hl-19-61> 61</a>
</span><span class=lnt id=hl-19-62><a class=lnlinks href=#hl-19-62> 62</a>
</span><span class=lnt id=hl-19-63><a class=lnlinks href=#hl-19-63> 63</a>
</span><span class=lnt id=hl-19-64><a class=lnlinks href=#hl-19-64> 64</a>
</span><span class=lnt id=hl-19-65><a class=lnlinks href=#hl-19-65> 65</a>
</span><span class=lnt id=hl-19-66><a class=lnlinks href=#hl-19-66> 66</a>
</span><span class=lnt id=hl-19-67><a class=lnlinks href=#hl-19-67> 67</a>
</span><span class=lnt id=hl-19-68><a class=lnlinks href=#hl-19-68> 68</a>
</span><span class=lnt id=hl-19-69><a class=lnlinks href=#hl-19-69> 69</a>
</span><span class=lnt id=hl-19-70><a class=lnlinks href=#hl-19-70> 70</a>
</span><span class=lnt id=hl-19-71><a class=lnlinks href=#hl-19-71> 71</a>
</span><span class=lnt id=hl-19-72><a class=lnlinks href=#hl-19-72> 72</a>
</span><span class=lnt id=hl-19-73><a class=lnlinks href=#hl-19-73> 73</a>
</span><span class=lnt id=hl-19-74><a class=lnlinks href=#hl-19-74> 74</a>
</span><span class=lnt id=hl-19-75><a class=lnlinks href=#hl-19-75> 75</a>
</span><span class=lnt id=hl-19-76><a class=lnlinks href=#hl-19-76> 76</a>
</span><span class=lnt id=hl-19-77><a class=lnlinks href=#hl-19-77> 77</a>
</span><span class=lnt id=hl-19-78><a class=lnlinks href=#hl-19-78> 78</a>
</span><span class=lnt id=hl-19-79><a class=lnlinks href=#hl-19-79> 79</a>
</span><span class=lnt id=hl-19-80><a class=lnlinks href=#hl-19-80> 80</a>
</span><span class=lnt id=hl-19-81><a class=lnlinks href=#hl-19-81> 81</a>
</span><span class=lnt id=hl-19-82><a class=lnlinks href=#hl-19-82> 82</a>
</span><span class=lnt id=hl-19-83><a class=lnlinks href=#hl-19-83> 83</a>
</span><span class=lnt id=hl-19-84><a class=lnlinks href=#hl-19-84> 84</a>
</span><span class=lnt id=hl-19-85><a class=lnlinks href=#hl-19-85> 85</a>
</span><span class=lnt id=hl-19-86><a class=lnlinks href=#hl-19-86> 86</a>
</span><span class=lnt id=hl-19-87><a class=lnlinks href=#hl-19-87> 87</a>
</span><span class=lnt id=hl-19-88><a class=lnlinks href=#hl-19-88> 88</a>
</span><span class=lnt id=hl-19-89><a class=lnlinks href=#hl-19-89> 89</a>
</span><span class=lnt id=hl-19-90><a class=lnlinks href=#hl-19-90> 90</a>
</span><span class=lnt id=hl-19-91><a class=lnlinks href=#hl-19-91> 91</a>
</span><span class=lnt id=hl-19-92><a class=lnlinks href=#hl-19-92> 92</a>
</span><span class=lnt id=hl-19-93><a class=lnlinks href=#hl-19-93> 93</a>
</span><span class=lnt id=hl-19-94><a class=lnlinks href=#hl-19-94> 94</a>
</span><span class=lnt id=hl-19-95><a class=lnlinks href=#hl-19-95> 95</a>
</span><span class=lnt id=hl-19-96><a class=lnlinks href=#hl-19-96> 96</a>
</span><span class=lnt id=hl-19-97><a class=lnlinks href=#hl-19-97> 97</a>
</span><span class=lnt id=hl-19-98><a class=lnlinks href=#hl-19-98> 98</a>
</span><span class=lnt id=hl-19-99><a class=lnlinks href=#hl-19-99> 99</a>
</span><span class=lnt id=hl-19-100><a class=lnlinks href=#hl-19-100>100</a>
</span><span class=lnt id=hl-19-101><a class=lnlinks href=#hl-19-101>101</a>
</span><span class=lnt id=hl-19-102><a class=lnlinks href=#hl-19-102>102</a>
</span><span class=lnt id=hl-19-103><a class=lnlinks href=#hl-19-103>103</a>
</span><span class=lnt id=hl-19-104><a class=lnlinks href=#hl-19-104>104</a>
</span><span class=lnt id=hl-19-105><a class=lnlinks href=#hl-19-105>105</a>
</span><span class=lnt id=hl-19-106><a class=lnlinks href=#hl-19-106>106</a>
</span><span class=lnt id=hl-19-107><a class=lnlinks href=#hl-19-107>107</a>
</span><span class=lnt id=hl-19-108><a class=lnlinks href=#hl-19-108>108</a>
</span><span class=lnt id=hl-19-109><a class=lnlinks href=#hl-19-109>109</a>
</span><span class=lnt id=hl-19-110><a class=lnlinks href=#hl-19-110>110</a>
</span><span class=lnt id=hl-19-111><a class=lnlinks href=#hl-19-111>111</a>
</span><span class=lnt id=hl-19-112><a class=lnlinks href=#hl-19-112>112</a>
</span><span class=lnt id=hl-19-113><a class=lnlinks href=#hl-19-113>113</a>
</span><span class=lnt id=hl-19-114><a class=lnlinks href=#hl-19-114>114</a>
</span><span class=lnt id=hl-19-115><a class=lnlinks href=#hl-19-115>115</a>
</span><span class=lnt id=hl-19-116><a class=lnlinks href=#hl-19-116>116</a>
</span><span class=lnt id=hl-19-117><a class=lnlinks href=#hl-19-117>117</a>
</span><span class=lnt id=hl-19-118><a class=lnlinks href=#hl-19-118>118</a>
</span><span class=lnt id=hl-19-119><a class=lnlinks href=#hl-19-119>119</a>
</span><span class=lnt id=hl-19-120><a class=lnlinks href=#hl-19-120>120</a>
</span><span class=lnt id=hl-19-121><a class=lnlinks href=#hl-19-121>121</a>
</span><span class=lnt id=hl-19-122><a class=lnlinks href=#hl-19-122>122</a>
</span><span class=lnt id=hl-19-123><a class=lnlinks href=#hl-19-123>123</a>
</span><span class=lnt id=hl-19-124><a class=lnlinks href=#hl-19-124>124</a>
</span><span class=lnt id=hl-19-125><a class=lnlinks href=#hl-19-125>125</a>
</span><span class=lnt id=hl-19-126><a class=lnlinks href=#hl-19-126>126</a>
</span><span class=lnt id=hl-19-127><a class=lnlinks href=#hl-19-127>127</a>
</span><span class=lnt id=hl-19-128><a class=lnlinks href=#hl-19-128>128</a>
</span><span class=lnt id=hl-19-129><a class=lnlinks href=#hl-19-129>129</a>
</span><span class=lnt id=hl-19-130><a class=lnlinks href=#hl-19-130>130</a>
</span><span class=lnt id=hl-19-131><a class=lnlinks href=#hl-19-131>131</a>
</span><span class=lnt id=hl-19-132><a class=lnlinks href=#hl-19-132>132</a>
</span><span class=lnt id=hl-19-133><a class=lnlinks href=#hl-19-133>133</a>
</span><span class=lnt id=hl-19-134><a class=lnlinks href=#hl-19-134>134</a>
</span><span class=lnt id=hl-19-135><a class=lnlinks href=#hl-19-135>135</a>
</span><span class=lnt id=hl-19-136><a class=lnlinks href=#hl-19-136>136</a>
</span><span class=lnt id=hl-19-137><a class=lnlinks href=#hl-19-137>137</a>
</span><span class=lnt id=hl-19-138><a class=lnlinks href=#hl-19-138>138</a>
</span><span class=lnt id=hl-19-139><a class=lnlinks href=#hl-19-139>139</a>
</span><span class=lnt id=hl-19-140><a class=lnlinks href=#hl-19-140>140</a>
</span><span class=lnt id=hl-19-141><a class=lnlinks href=#hl-19-141>141</a>
</span><span class=lnt id=hl-19-142><a class=lnlinks href=#hl-19-142>142</a>
</span><span class=lnt id=hl-19-143><a class=lnlinks href=#hl-19-143>143</a>
</span><span class=lnt id=hl-19-144><a class=lnlinks href=#hl-19-144>144</a>
</span><span class=lnt id=hl-19-145><a class=lnlinks href=#hl-19-145>145</a>
</span><span class=lnt id=hl-19-146><a class=lnlinks href=#hl-19-146>146</a>
</span><span class=lnt id=hl-19-147><a class=lnlinks href=#hl-19-147>147</a>
</span><span class=lnt id=hl-19-148><a class=lnlinks href=#hl-19-148>148</a>
</span><span class=lnt id=hl-19-149><a class=lnlinks href=#hl-19-149>149</a>
</span><span class=lnt id=hl-19-150><a class=lnlinks href=#hl-19-150>150</a>
</span><span class=lnt id=hl-19-151><a class=lnlinks href=#hl-19-151>151</a>
</span><span class=lnt id=hl-19-152><a class=lnlinks href=#hl-19-152>152</a>
</span><span class=lnt id=hl-19-153><a class=lnlinks href=#hl-19-153>153</a>
</span><span class=lnt id=hl-19-154><a class=lnlinks href=#hl-19-154>154</a>
</span><span class=lnt id=hl-19-155><a class=lnlinks href=#hl-19-155>155</a>
</span><span class=lnt id=hl-19-156><a class=lnlinks href=#hl-19-156>156</a>
</span><span class=lnt id=hl-19-157><a class=lnlinks href=#hl-19-157>157</a>
</span><span class=lnt id=hl-19-158><a class=lnlinks href=#hl-19-158>158</a>
</span><span class=lnt id=hl-19-159><a class=lnlinks href=#hl-19-159>159</a>
</span><span class=lnt id=hl-19-160><a class=lnlinks href=#hl-19-160>160</a>
</span><span class=lnt id=hl-19-161><a class=lnlinks href=#hl-19-161>161</a>
</span><span class=lnt id=hl-19-162><a class=lnlinks href=#hl-19-162>162</a>
</span><span class=lnt id=hl-19-163><a class=lnlinks href=#hl-19-163>163</a>
</span><span class=lnt id=hl-19-164><a class=lnlinks href=#hl-19-164>164</a>
</span><span class=lnt id=hl-19-165><a class=lnlinks href=#hl-19-165>165</a>
</span><span class=lnt id=hl-19-166><a class=lnlinks href=#hl-19-166>166</a>
</span><span class=lnt id=hl-19-167><a class=lnlinks href=#hl-19-167>167</a>
</span><span class=lnt id=hl-19-168><a class=lnlinks href=#hl-19-168>168</a>
</span><span class=lnt id=hl-19-169><a class=lnlinks href=#hl-19-169>169</a>
</span><span class=lnt id=hl-19-170><a class=lnlinks href=#hl-19-170>170</a>
</span><span class=lnt id=hl-19-171><a class=lnlinks href=#hl-19-171>171</a>
</span><span class=lnt id=hl-19-172><a class=lnlinks href=#hl-19-172>172</a>
</span><span class=lnt id=hl-19-173><a class=lnlinks href=#hl-19-173>173</a>
</span><span class=lnt id=hl-19-174><a class=lnlinks href=#hl-19-174>174</a>
</span><span class=lnt id=hl-19-175><a class=lnlinks href=#hl-19-175>175</a>
</span><span class=lnt id=hl-19-176><a class=lnlinks href=#hl-19-176>176</a>
</span><span class=lnt id=hl-19-177><a class=lnlinks href=#hl-19-177>177</a>
</span><span class=lnt id=hl-19-178><a class=lnlinks href=#hl-19-178>178</a>
</span><span class=lnt id=hl-19-179><a class=lnlinks href=#hl-19-179>179</a>
</span><span class=lnt id=hl-19-180><a class=lnlinks href=#hl-19-180>180</a>
</span><span class=lnt id=hl-19-181><a class=lnlinks href=#hl-19-181>181</a>
</span><span class=lnt id=hl-19-182><a class=lnlinks href=#hl-19-182>182</a>
</span><span class=lnt id=hl-19-183><a class=lnlinks href=#hl-19-183>183</a>
</span><span class=lnt id=hl-19-184><a class=lnlinks href=#hl-19-184>184</a>
</span><span class=lnt id=hl-19-185><a class=lnlinks href=#hl-19-185>185</a>
</span><span class=lnt id=hl-19-186><a class=lnlinks href=#hl-19-186>186</a>
</span><span class=lnt id=hl-19-187><a class=lnlinks href=#hl-19-187>187</a>
</span><span class=lnt id=hl-19-188><a class=lnlinks href=#hl-19-188>188</a>
</span><span class=lnt id=hl-19-189><a class=lnlinks href=#hl-19-189>189</a>
</span><span class=lnt id=hl-19-190><a class=lnlinks href=#hl-19-190>190</a>
</span><span class=lnt id=hl-19-191><a class=lnlinks href=#hl-19-191>191</a>
</span><span class=lnt id=hl-19-192><a class=lnlinks href=#hl-19-192>192</a>
</span><span class=lnt id=hl-19-193><a class=lnlinks href=#hl-19-193>193</a>
</span><span class=lnt id=hl-19-194><a class=lnlinks href=#hl-19-194>194</a>
</span><span class=lnt id=hl-19-195><a class=lnlinks href=#hl-19-195>195</a>
</span><span class=lnt id=hl-19-196><a class=lnlinks href=#hl-19-196>196</a>
</span><span class=lnt id=hl-19-197><a class=lnlinks href=#hl-19-197>197</a>
</span><span class=lnt id=hl-19-198><a class=lnlinks href=#hl-19-198>198</a>
</span><span class=lnt id=hl-19-199><a class=lnlinks href=#hl-19-199>199</a>
</span><span class=lnt id=hl-19-200><a class=lnlinks href=#hl-19-200>200</a>
</span><span class=lnt id=hl-19-201><a class=lnlinks href=#hl-19-201>201</a>
</span><span class=lnt id=hl-19-202><a class=lnlinks href=#hl-19-202>202</a>
</span><span class=lnt id=hl-19-203><a class=lnlinks href=#hl-19-203>203</a>
</span><span class=lnt id=hl-19-204><a class=lnlinks href=#hl-19-204>204</a>
</span><span class=lnt id=hl-19-205><a class=lnlinks href=#hl-19-205>205</a>
</span><span class=lnt id=hl-19-206><a class=lnlinks href=#hl-19-206>206</a>
</span><span class=lnt id=hl-19-207><a class=lnlinks href=#hl-19-207>207</a>
</span><span class=lnt id=hl-19-208><a class=lnlinks href=#hl-19-208>208</a>
</span><span class=lnt id=hl-19-209><a class=lnlinks href=#hl-19-209>209</a>
</span><span class=lnt id=hl-19-210><a class=lnlinks href=#hl-19-210>210</a>
</span><span class=lnt id=hl-19-211><a class=lnlinks href=#hl-19-211>211</a>
</span><span class=lnt id=hl-19-212><a class=lnlinks href=#hl-19-212>212</a>
</span><span class=lnt id=hl-19-213><a class=lnlinks href=#hl-19-213>213</a>
</span><span class=lnt id=hl-19-214><a class=lnlinks href=#hl-19-214>214</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 이벤트 인터페이스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>DomainEvent</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=nf>getAggregateId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>LocalDateTime</span><span class=w> </span><span class=nf>getTimestamp</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=nf>getEventType</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 주문 이벤트 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderCreatedEvent</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>DomainEvent</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>customerId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>OrderItem</span><span class=o>&gt;</span><span class=w> </span><span class=n>items</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>totalAmount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>timestamp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getAggregateId</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>orderId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=nf>getTimestamp</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>timestamp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getEventType</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;OrderCreated&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자, 게터 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 이벤트 저장소</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>EventStoreRepository</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JdbcTemplate</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ObjectMapper</span><span class=w> </span><span class=n>objectMapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 이벤트 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>saveEvent</span><span class=p>(</span><span class=n>DomainEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>eventData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>objectMapper</span><span class=p>.</span><span class=na>writeValueAsString</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;INSERT INTO event_store (aggregate_id, event_type, data, timestamp) VALUES (?, ?, ?, ?)&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>event</span><span class=p>.</span><span class=na>getAggregateId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>event</span><span class=p>.</span><span class=na>getEventType</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>eventData</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Timestamp</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>JsonProcessingException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=s>&#34;Error serializing event&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 집계 ID별 이벤트 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>DomainEvent</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getEventsForAggregate</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>aggregateId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>query</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;SELECT * FROM event_store WHERE aggregate_id = ? ORDER BY timestamp ASC&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>(</span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>rowNum</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>String</span><span class=w> </span><span class=n>eventType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;event_type&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>String</span><span class=w> </span><span class=n>eventData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;data&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 이벤트 타입에 따른 역직렬화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>Class</span><span class=o>&lt;?</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>DomainEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>eventClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getEventClass</span><span class=p>(</span><span class=n>eventType</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>objectMapper</span><span class=p>.</span><span class=na>readValue</span><span class=p>(</span><span class=n>eventData</span><span class=p>,</span><span class=w> </span><span class=n>eventClass</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=s>&#34;Error deserializing event&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>aggregateId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;?</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>DomainEvent</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getEventClass</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>eventType</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 이벤트 타입에 따른 클래스 매핑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>eventType</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;OrderCreated&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>OrderCreatedEvent</span><span class=p>.</span><span class=na>class</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;OrderPaid&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>OrderPaidEvent</span><span class=p>.</span><span class=na>class</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;OrderShipped&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>OrderShippedEvent</span><span class=p>.</span><span class=na>class</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 기타 이벤트 타입</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;Unknown event type: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>eventType</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 주문 집계(Aggregate)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Order</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>customerId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>OrderItem</span><span class=o>&gt;</span><span class=w> </span><span class=n>items</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>totalAmount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>createdAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>updatedAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 이벤트에서 주문 재구성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Order</span><span class=w> </span><span class=nf>recreateFromEvents</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>DomainEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>events</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Order</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>DomainEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>events</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>order</span><span class=p>.</span><span class=na>apply</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>order</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 이벤트 적용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>apply</span><span class=p>(</span><span class=n>DomainEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>OrderCreatedEvent</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>OrderCreatedEvent</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>OrderCreatedEvent</span><span class=p>)</span><span class=w> </span><span class=n>event</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getOrderId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>customerId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getCustomerId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getItems</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>totalAmount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getTotalAmount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CREATED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>createdAt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>updatedAt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>OrderPaidEvent</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>OrderPaidEvent</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>OrderPaidEvent</span><span class=p>)</span><span class=w> </span><span class=n>event</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PAID</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>updatedAt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>OrderShippedEvent</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>OrderShippedEvent</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>OrderShippedEvent</span><span class=p>)</span><span class=w> </span><span class=n>event</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>SHIPPED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>updatedAt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 기타 이벤트 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자, 게터, 세터 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>EventStoreRepository</span><span class=w> </span><span class=n>eventStore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>EventPublisher</span><span class=w> </span><span class=n>eventPublisher</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 주문 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>createOrder</span><span class=p>(</span><span class=n>OrderRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 새 주문 ID 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 주문 생성 이벤트 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OrderCreatedEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderCreatedEvent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>orderId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>.</span><span class=na>getCustomerId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>.</span><span class=na>getItems</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>calculateTotal</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getItems</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 이벤트 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>eventStore</span><span class=p>.</span><span class=na>saveEvent</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 이벤트 발행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>eventPublisher</span><span class=p>.</span><span class=na>publish</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>orderId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 주문 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Order</span><span class=w> </span><span class=nf>getOrder</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>DomainEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>events</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>eventStore</span><span class=p>.</span><span class=na>getEventsForAggregate</span><span class=p>(</span><span class=n>orderId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>events</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Order</span><span class=p>.</span><span class=na>recreateFromEvents</span><span class=p>(</span><span class=n>events</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 주문 결제 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>payOrder</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>PaymentDetails</span><span class=w> </span><span class=n>paymentDetails</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 현재 주문 상태 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getOrder</span><span class=p>(</span><span class=n>orderId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>order</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderNotFoundException</span><span class=p>(</span><span class=n>orderId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CREATED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InvalidOrderStateException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;Cannot pay order in state: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getStatus</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 결제 이벤트 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OrderPaidEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderPaidEvent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>orderId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>paymentDetails</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>paymentDetails</span><span class=p>.</span><span class=na>getAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>paymentDetails</span><span class=p>.</span><span class=na>getPaymentMethod</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 이벤트 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>eventStore</span><span class=p>.</span><span class=na>saveEvent</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 이벤트 발행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>eventPublisher</span><span class=p>.</span><span class=na>publish</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 기타 메서드…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=비동기식-api의-보안-고려사항>비동기식 API의 보안 고려사항<a hidden class=anchor aria-hidden=true href=#비동기식-api의-보안-고려사항>#</a></h3><p>비동기 API는 전통적인 동기식 API와는 다른 보안 고려사항이 있다.</p><h4 id=인증-및-권한-부여>인증 및 권한 부여<a hidden class=anchor aria-hidden=true href=#인증-및-권한-부여>#</a></h4><p>비동기 API에서는 장기 실행 작업의 권한 관리가 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22>22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23>23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24>24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25>25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26>26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27>27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28>28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29>29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30>30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31>31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32>32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33>33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34>34</a>
</span><span class=lnt id=hl-20-35><a class=lnlinks href=#hl-20-35>35</a>
</span><span class=lnt id=hl-20-36><a class=lnlinks href=#hl-20-36>36</a>
</span><span class=lnt id=hl-20-37><a class=lnlinks href=#hl-20-37>37</a>
</span><span class=lnt id=hl-20-38><a class=lnlinks href=#hl-20-38>38</a>
</span><span class=lnt id=hl-20-39><a class=lnlinks href=#hl-20-39>39</a>
</span><span class=lnt id=hl-20-40><a class=lnlinks href=#hl-20-40>40</a>
</span><span class=lnt id=hl-20-41><a class=lnlinks href=#hl-20-41>41</a>
</span><span class=lnt id=hl-20-42><a class=lnlinks href=#hl-20-42>42</a>
</span><span class=lnt id=hl-20-43><a class=lnlinks href=#hl-20-43>43</a>
</span><span class=lnt id=hl-20-44><a class=lnlinks href=#hl-20-44>44</a>
</span><span class=lnt id=hl-20-45><a class=lnlinks href=#hl-20-45>45</a>
</span><span class=lnt id=hl-20-46><a class=lnlinks href=#hl-20-46>46</a>
</span><span class=lnt id=hl-20-47><a class=lnlinks href=#hl-20-47>47</a>
</span><span class=lnt id=hl-20-48><a class=lnlinks href=#hl-20-48>48</a>
</span><span class=lnt id=hl-20-49><a class=lnlinks href=#hl-20-49>49</a>
</span><span class=lnt id=hl-20-50><a class=lnlinks href=#hl-20-50>50</a>
</span><span class=lnt id=hl-20-51><a class=lnlinks href=#hl-20-51>51</a>
</span><span class=lnt id=hl-20-52><a class=lnlinks href=#hl-20-52>52</a>
</span><span class=lnt id=hl-20-53><a class=lnlinks href=#hl-20-53>53</a>
</span><span class=lnt id=hl-20-54><a class=lnlinks href=#hl-20-54>54</a>
</span><span class=lnt id=hl-20-55><a class=lnlinks href=#hl-20-55>55</a>
</span><span class=lnt id=hl-20-56><a class=lnlinks href=#hl-20-56>56</a>
</span><span class=lnt id=hl-20-57><a class=lnlinks href=#hl-20-57>57</a>
</span><span class=lnt id=hl-20-58><a class=lnlinks href=#hl-20-58>58</a>
</span><span class=lnt id=hl-20-59><a class=lnlinks href=#hl-20-59>59</a>
</span><span class=lnt id=hl-20-60><a class=lnlinks href=#hl-20-60>60</a>
</span><span class=lnt id=hl-20-61><a class=lnlinks href=#hl-20-61>61</a>
</span><span class=lnt id=hl-20-62><a class=lnlinks href=#hl-20-62>62</a>
</span><span class=lnt id=hl-20-63><a class=lnlinks href=#hl-20-63>63</a>
</span><span class=lnt id=hl-20-64><a class=lnlinks href=#hl-20-64>64</a>
</span><span class=lnt id=hl-20-65><a class=lnlinks href=#hl-20-65>65</a>
</span><span class=lnt id=hl-20-66><a class=lnlinks href=#hl-20-66>66</a>
</span><span class=lnt id=hl-20-67><a class=lnlinks href=#hl-20-67>67</a>
</span><span class=lnt id=hl-20-68><a class=lnlinks href=#hl-20-68>68</a>
</span><span class=lnt id=hl-20-69><a class=lnlinks href=#hl-20-69>69</a>
</span><span class=lnt id=hl-20-70><a class=lnlinks href=#hl-20-70>70</a>
</span><span class=lnt id=hl-20-71><a class=lnlinks href=#hl-20-71>71</a>
</span><span class=lnt id=hl-20-72><a class=lnlinks href=#hl-20-72>72</a>
</span><span class=lnt id=hl-20-73><a class=lnlinks href=#hl-20-73>73</a>
</span><span class=lnt id=hl-20-74><a class=lnlinks href=#hl-20-74>74</a>
</span><span class=lnt id=hl-20-75><a class=lnlinks href=#hl-20-75>75</a>
</span><span class=lnt id=hl-20-76><a class=lnlinks href=#hl-20-76>76</a>
</span><span class=lnt id=hl-20-77><a class=lnlinks href=#hl-20-77>77</a>
</span><span class=lnt id=hl-20-78><a class=lnlinks href=#hl-20-78>78</a>
</span><span class=lnt id=hl-20-79><a class=lnlinks href=#hl-20-79>79</a>
</span><span class=lnt id=hl-20-80><a class=lnlinks href=#hl-20-80>80</a>
</span><span class=lnt id=hl-20-81><a class=lnlinks href=#hl-20-81>81</a>
</span><span class=lnt id=hl-20-82><a class=lnlinks href=#hl-20-82>82</a>
</span><span class=lnt id=hl-20-83><a class=lnlinks href=#hl-20-83>83</a>
</span><span class=lnt id=hl-20-84><a class=lnlinks href=#hl-20-84>84</a>
</span><span class=lnt id=hl-20-85><a class=lnlinks href=#hl-20-85>85</a>
</span><span class=lnt id=hl-20-86><a class=lnlinks href=#hl-20-86>86</a>
</span><span class=lnt id=hl-20-87><a class=lnlinks href=#hl-20-87>87</a>
</span><span class=lnt id=hl-20-88><a class=lnlinks href=#hl-20-88>88</a>
</span><span class=lnt id=hl-20-89><a class=lnlinks href=#hl-20-89>89</a>
</span><span class=lnt id=hl-20-90><a class=lnlinks href=#hl-20-90>90</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 권한 확인을 위한 토큰 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/long-running-tasks&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>TaskResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>startTask</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>TaskRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestHeader</span><span class=p>(</span><span class=s>&#34;Authorization&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>authHeader</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 현재 사용자 인증 정보 추출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>authService</span><span class=p>.</span><span class=na>getUserFromToken</span><span class=p>(</span><span class=n>authHeader</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 권한 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>permissionService</span><span class=p>.</span><span class=na>canCreateTask</span><span class=p>(</span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getTaskType</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>FORBIDDEN</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>taskId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업과 함께 사용자 정보 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Task</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Task</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>taskId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>TaskStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>()</span><span class=w>  </span><span class=c1>// 작업 소유자 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>taskRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>task</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 처리를 위한 인증 정보 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 중요: 원본 토큰이 아닌 제한된 범위의 토큰 또는 작업별 토큰 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>taskToken</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>authService</span><span class=p>.</span><span class=na>createTaskToken</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>taskId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>taskAuthRepository</span><span class=p>.</span><span class=na>saveTaskToken</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>taskToken</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 비동기 작업 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>taskProcessor</span><span class=p>.</span><span class=na>processTaskAsync</span><span class=p>(</span><span class=n>taskId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>TaskResponse</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PENDING&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/api/long-running-tasks/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>taskId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 작업 처리 서비스에서 권한 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TaskProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>TaskRepository</span><span class=w> </span><span class=n>taskRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>TaskAuthRepository</span><span class=w> </span><span class=n>taskAuthRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>AuthService</span><span class=w> </span><span class=n>authService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processTaskAsync</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>taskId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executorService</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 작업 정보 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Task</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>taskRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>taskId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>task</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 작업 토큰 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>taskToken</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>taskAuthRepository</span><span class=p>.</span><span class=na>getTaskToken</span><span class=p>(</span><span class=n>taskId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>taskToken</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>taskRepository</span><span class=p>.</span><span class=na>failTask</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Missing authentication token&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 토큰 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>authService</span><span class=p>.</span><span class=na>validateTaskToken</span><span class=p>(</span><span class=n>taskToken</span><span class=p>,</span><span class=w> </span><span class=n>taskId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>taskRepository</span><span class=p>.</span><span class=na>failTask</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Invalid authentication token&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 작업 실행 컨텍스트 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>SecurityContextHolder</span><span class=p>.</span><span class=na>setContext</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>authService</span><span class=p>.</span><span class=na>createSecurityContextFromTaskToken</span><span class=p>(</span><span class=n>taskToken</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 작업 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>processTask</span><span class=p>(</span><span class=n>task</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 보안 컨텍스트 정리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>SecurityContextHolder</span><span class=p>.</span><span class=na>clearContext</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Error processing task {}: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>taskRepository</span><span class=p>.</span><span class=na>failTask</span><span class=p>(</span><span class=n>taskId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processTask</span><span class=p>(</span><span class=n>Task</span><span class=w> </span><span class=n>task</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=웹훅-보안>웹훅 보안<a hidden class=anchor aria-hidden=true href=#웹훅-보안>#</a></h4><p>웹훅을 사용할 때는 발신자 인증과 메시지 무결성을 보장해야 한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>  1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>  2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>  3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>  4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>  5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>  6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>  7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8>  8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9>  9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10> 10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11> 11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12> 12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13> 13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14> 14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15> 15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16> 16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17> 17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18> 18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19> 19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20> 20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21> 21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22> 22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23> 23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24> 24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25> 25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26> 26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27> 27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28> 28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29> 29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30> 30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31> 31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32> 32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33> 33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34> 34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35> 35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36> 36</a>
</span><span class=lnt id=hl-21-37><a class=lnlinks href=#hl-21-37> 37</a>
</span><span class=lnt id=hl-21-38><a class=lnlinks href=#hl-21-38> 38</a>
</span><span class=lnt id=hl-21-39><a class=lnlinks href=#hl-21-39> 39</a>
</span><span class=lnt id=hl-21-40><a class=lnlinks href=#hl-21-40> 40</a>
</span><span class=lnt id=hl-21-41><a class=lnlinks href=#hl-21-41> 41</a>
</span><span class=lnt id=hl-21-42><a class=lnlinks href=#hl-21-42> 42</a>
</span><span class=lnt id=hl-21-43><a class=lnlinks href=#hl-21-43> 43</a>
</span><span class=lnt id=hl-21-44><a class=lnlinks href=#hl-21-44> 44</a>
</span><span class=lnt id=hl-21-45><a class=lnlinks href=#hl-21-45> 45</a>
</span><span class=lnt id=hl-21-46><a class=lnlinks href=#hl-21-46> 46</a>
</span><span class=lnt id=hl-21-47><a class=lnlinks href=#hl-21-47> 47</a>
</span><span class=lnt id=hl-21-48><a class=lnlinks href=#hl-21-48> 48</a>
</span><span class=lnt id=hl-21-49><a class=lnlinks href=#hl-21-49> 49</a>
</span><span class=lnt id=hl-21-50><a class=lnlinks href=#hl-21-50> 50</a>
</span><span class=lnt id=hl-21-51><a class=lnlinks href=#hl-21-51> 51</a>
</span><span class=lnt id=hl-21-52><a class=lnlinks href=#hl-21-52> 52</a>
</span><span class=lnt id=hl-21-53><a class=lnlinks href=#hl-21-53> 53</a>
</span><span class=lnt id=hl-21-54><a class=lnlinks href=#hl-21-54> 54</a>
</span><span class=lnt id=hl-21-55><a class=lnlinks href=#hl-21-55> 55</a>
</span><span class=lnt id=hl-21-56><a class=lnlinks href=#hl-21-56> 56</a>
</span><span class=lnt id=hl-21-57><a class=lnlinks href=#hl-21-57> 57</a>
</span><span class=lnt id=hl-21-58><a class=lnlinks href=#hl-21-58> 58</a>
</span><span class=lnt id=hl-21-59><a class=lnlinks href=#hl-21-59> 59</a>
</span><span class=lnt id=hl-21-60><a class=lnlinks href=#hl-21-60> 60</a>
</span><span class=lnt id=hl-21-61><a class=lnlinks href=#hl-21-61> 61</a>
</span><span class=lnt id=hl-21-62><a class=lnlinks href=#hl-21-62> 62</a>
</span><span class=lnt id=hl-21-63><a class=lnlinks href=#hl-21-63> 63</a>
</span><span class=lnt id=hl-21-64><a class=lnlinks href=#hl-21-64> 64</a>
</span><span class=lnt id=hl-21-65><a class=lnlinks href=#hl-21-65> 65</a>
</span><span class=lnt id=hl-21-66><a class=lnlinks href=#hl-21-66> 66</a>
</span><span class=lnt id=hl-21-67><a class=lnlinks href=#hl-21-67> 67</a>
</span><span class=lnt id=hl-21-68><a class=lnlinks href=#hl-21-68> 68</a>
</span><span class=lnt id=hl-21-69><a class=lnlinks href=#hl-21-69> 69</a>
</span><span class=lnt id=hl-21-70><a class=lnlinks href=#hl-21-70> 70</a>
</span><span class=lnt id=hl-21-71><a class=lnlinks href=#hl-21-71> 71</a>
</span><span class=lnt id=hl-21-72><a class=lnlinks href=#hl-21-72> 72</a>
</span><span class=lnt id=hl-21-73><a class=lnlinks href=#hl-21-73> 73</a>
</span><span class=lnt id=hl-21-74><a class=lnlinks href=#hl-21-74> 74</a>
</span><span class=lnt id=hl-21-75><a class=lnlinks href=#hl-21-75> 75</a>
</span><span class=lnt id=hl-21-76><a class=lnlinks href=#hl-21-76> 76</a>
</span><span class=lnt id=hl-21-77><a class=lnlinks href=#hl-21-77> 77</a>
</span><span class=lnt id=hl-21-78><a class=lnlinks href=#hl-21-78> 78</a>
</span><span class=lnt id=hl-21-79><a class=lnlinks href=#hl-21-79> 79</a>
</span><span class=lnt id=hl-21-80><a class=lnlinks href=#hl-21-80> 80</a>
</span><span class=lnt id=hl-21-81><a class=lnlinks href=#hl-21-81> 81</a>
</span><span class=lnt id=hl-21-82><a class=lnlinks href=#hl-21-82> 82</a>
</span><span class=lnt id=hl-21-83><a class=lnlinks href=#hl-21-83> 83</a>
</span><span class=lnt id=hl-21-84><a class=lnlinks href=#hl-21-84> 84</a>
</span><span class=lnt id=hl-21-85><a class=lnlinks href=#hl-21-85> 85</a>
</span><span class=lnt id=hl-21-86><a class=lnlinks href=#hl-21-86> 86</a>
</span><span class=lnt id=hl-21-87><a class=lnlinks href=#hl-21-87> 87</a>
</span><span class=lnt id=hl-21-88><a class=lnlinks href=#hl-21-88> 88</a>
</span><span class=lnt id=hl-21-89><a class=lnlinks href=#hl-21-89> 89</a>
</span><span class=lnt id=hl-21-90><a class=lnlinks href=#hl-21-90> 90</a>
</span><span class=lnt id=hl-21-91><a class=lnlinks href=#hl-21-91> 91</a>
</span><span class=lnt id=hl-21-92><a class=lnlinks href=#hl-21-92> 92</a>
</span><span class=lnt id=hl-21-93><a class=lnlinks href=#hl-21-93> 93</a>
</span><span class=lnt id=hl-21-94><a class=lnlinks href=#hl-21-94> 94</a>
</span><span class=lnt id=hl-21-95><a class=lnlinks href=#hl-21-95> 95</a>
</span><span class=lnt id=hl-21-96><a class=lnlinks href=#hl-21-96> 96</a>
</span><span class=lnt id=hl-21-97><a class=lnlinks href=#hl-21-97> 97</a>
</span><span class=lnt id=hl-21-98><a class=lnlinks href=#hl-21-98> 98</a>
</span><span class=lnt id=hl-21-99><a class=lnlinks href=#hl-21-99> 99</a>
</span><span class=lnt id=hl-21-100><a class=lnlinks href=#hl-21-100>100</a>
</span><span class=lnt id=hl-21-101><a class=lnlinks href=#hl-21-101>101</a>
</span><span class=lnt id=hl-21-102><a class=lnlinks href=#hl-21-102>102</a>
</span><span class=lnt id=hl-21-103><a class=lnlinks href=#hl-21-103>103</a>
</span><span class=lnt id=hl-21-104><a class=lnlinks href=#hl-21-104>104</a>
</span><span class=lnt id=hl-21-105><a class=lnlinks href=#hl-21-105>105</a>
</span><span class=lnt id=hl-21-106><a class=lnlinks href=#hl-21-106>106</a>
</span><span class=lnt id=hl-21-107><a class=lnlinks href=#hl-21-107>107</a>
</span><span class=lnt id=hl-21-108><a class=lnlinks href=#hl-21-108>108</a>
</span><span class=lnt id=hl-21-109><a class=lnlinks href=#hl-21-109>109</a>
</span><span class=lnt id=hl-21-110><a class=lnlinks href=#hl-21-110>110</a>
</span><span class=lnt id=hl-21-111><a class=lnlinks href=#hl-21-111>111</a>
</span><span class=lnt id=hl-21-112><a class=lnlinks href=#hl-21-112>112</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 웹훅 서명 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebhookSigner</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>secretKey</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>WebhookSigner</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>secretKey</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>secretKey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>secretKey</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>generateSignature</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>payload</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Mac</span><span class=w> </span><span class=n>hmac</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Mac</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;HmacSHA256&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>SecretKeySpec</span><span class=w> </span><span class=n>keySpec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SecretKeySpec</span><span class=p>(</span><span class=n>secretKey</span><span class=p>.</span><span class=na>getBytes</span><span class=p>(),</span><span class=w> </span><span class=s>&#34;HmacSHA256&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>hmac</span><span class=p>.</span><span class=na>init</span><span class=p>(</span><span class=n>keySpec</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>hash</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>hmac</span><span class=p>.</span><span class=na>doFinal</span><span class=p>(</span><span class=n>payload</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>Base64</span><span class=p>.</span><span class=na>getEncoder</span><span class=p>().</span><span class=na>encodeToString</span><span class=p>(</span><span class=n>hash</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=s>&#34;Error generating webhook signature&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 웹훅 발송 시 서명 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebhookService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>WebhookSigner</span><span class=w> </span><span class=n>webhookSigner</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendWebhook</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>payload</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 페이로드 직렬화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>payloadJson</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>objectMapper</span><span class=p>.</span><span class=na>writeValueAsString</span><span class=p>(</span><span class=n>payload</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 서명 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>signature</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>webhookSigner</span><span class=p>.</span><span class=na>generateSignature</span><span class=p>(</span><span class=n>payloadJson</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 헤더 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HttpHeaders</span><span class=w> </span><span class=n>headers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HttpHeaders</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>headers</span><span class=p>.</span><span class=na>setContentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>headers</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=s>&#34;X-Webhook-Signature&#34;</span><span class=p>,</span><span class=w> </span><span class=n>signature</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>headers</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=s>&#34;X-Webhook-Timestamp&#34;</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 웹훅 요청 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HttpEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HttpEntity</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>payloadJson</span><span class=p>,</span><span class=w> </span><span class=n>headers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>postForEntity</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Error sending webhook: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 웹훅 수신 시 서명 검증 (클라이언트 측)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/webhooks&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebhookController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>webhookSecret</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ObjectMapper</span><span class=w> </span><span class=n>objectMapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/orders&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>receiveOrderWebhook</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>payload</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestHeader</span><span class=p>(</span><span class=s>&#34;X-Webhook-Signature&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>signature</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestHeader</span><span class=p>(</span><span class=s>&#34;X-Webhook-Timestamp&#34;</span><span class=p>)</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>timestamp</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 타임스탬프 검증 (5분 내 발송된 웹훅만 허용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>timestamp</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>300000</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// 5분 = 300,000ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>UNAUTHORIZED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=s>&#34;Webhook timestamp too old&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 서명 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Mac</span><span class=w> </span><span class=n>hmac</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Mac</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;HmacSHA256&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>SecretKeySpec</span><span class=w> </span><span class=n>keySpec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SecretKeySpec</span><span class=p>(</span><span class=n>webhookSecret</span><span class=p>.</span><span class=na>getBytes</span><span class=p>(),</span><span class=w> </span><span class=s>&#34;HmacSHA256&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>hmac</span><span class=p>.</span><span class=na>init</span><span class=p>(</span><span class=n>keySpec</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>hash</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>hmac</span><span class=p>.</span><span class=na>doFinal</span><span class=p>(</span><span class=n>payload</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>expectedSignature</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Base64</span><span class=p>.</span><span class=na>getEncoder</span><span class=p>().</span><span class=na>encodeToString</span><span class=p>(</span><span class=n>hash</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>MessageDigest</span><span class=p>.</span><span class=na>isEqual</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>expectedSignature</span><span class=p>.</span><span class=na>getBytes</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>signature</span><span class=p>.</span><span class=na>getBytes</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>UNAUTHORIZED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=s>&#34;Invalid webhook signature&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=s>&#34;Error validating webhook signature&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 페이로드 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>OrderWebhookPayload</span><span class=w> </span><span class=n>orderPayload</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>objectMapper</span><span class=p>.</span><span class=na>readValue</span><span class=p>(</span><span class=n>payload</span><span class=p>,</span><span class=w> </span><span class=n>OrderWebhookPayload</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 주문 웹훅 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>processOrderWebhook</span><span class=p>(</span><span class=n>orderPayload</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=s>&#34;Error processing webhook payload&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processOrderWebhook</span><span class=p>(</span><span class=n>OrderWebhookPayload</span><span class=w> </span><span class=n>payload</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 웹훅 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=데이터-보안>데이터 보안<a hidden class=anchor aria-hidden=true href=#데이터-보안>#</a></h4><p>비동기 API에서는 장기간 저장되는 데이터의 보안도 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17>17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18>18</a>
</span><span class=lnt id=hl-22-19><a class=lnlinks href=#hl-22-19>19</a>
</span><span class=lnt id=hl-22-20><a class=lnlinks href=#hl-22-20>20</a>
</span><span class=lnt id=hl-22-21><a class=lnlinks href=#hl-22-21>21</a>
</span><span class=lnt id=hl-22-22><a class=lnlinks href=#hl-22-22>22</a>
</span><span class=lnt id=hl-22-23><a class=lnlinks href=#hl-22-23>23</a>
</span><span class=lnt id=hl-22-24><a class=lnlinks href=#hl-22-24>24</a>
</span><span class=lnt id=hl-22-25><a class=lnlinks href=#hl-22-25>25</a>
</span><span class=lnt id=hl-22-26><a class=lnlinks href=#hl-22-26>26</a>
</span><span class=lnt id=hl-22-27><a class=lnlinks href=#hl-22-27>27</a>
</span><span class=lnt id=hl-22-28><a class=lnlinks href=#hl-22-28>28</a>
</span><span class=lnt id=hl-22-29><a class=lnlinks href=#hl-22-29>29</a>
</span><span class=lnt id=hl-22-30><a class=lnlinks href=#hl-22-30>30</a>
</span><span class=lnt id=hl-22-31><a class=lnlinks href=#hl-22-31>31</a>
</span><span class=lnt id=hl-22-32><a class=lnlinks href=#hl-22-32>32</a>
</span><span class=lnt id=hl-22-33><a class=lnlinks href=#hl-22-33>33</a>
</span><span class=lnt id=hl-22-34><a class=lnlinks href=#hl-22-34>34</a>
</span><span class=lnt id=hl-22-35><a class=lnlinks href=#hl-22-35>35</a>
</span><span class=lnt id=hl-22-36><a class=lnlinks href=#hl-22-36>36</a>
</span><span class=lnt id=hl-22-37><a class=lnlinks href=#hl-22-37>37</a>
</span><span class=lnt id=hl-22-38><a class=lnlinks href=#hl-22-38>38</a>
</span><span class=lnt id=hl-22-39><a class=lnlinks href=#hl-22-39>39</a>
</span><span class=lnt id=hl-22-40><a class=lnlinks href=#hl-22-40>40</a>
</span><span class=lnt id=hl-22-41><a class=lnlinks href=#hl-22-41>41</a>
</span><span class=lnt id=hl-22-42><a class=lnlinks href=#hl-22-42>42</a>
</span><span class=lnt id=hl-22-43><a class=lnlinks href=#hl-22-43>43</a>
</span><span class=lnt id=hl-22-44><a class=lnlinks href=#hl-22-44>44</a>
</span><span class=lnt id=hl-22-45><a class=lnlinks href=#hl-22-45>45</a>
</span><span class=lnt id=hl-22-46><a class=lnlinks href=#hl-22-46>46</a>
</span><span class=lnt id=hl-22-47><a class=lnlinks href=#hl-22-47>47</a>
</span><span class=lnt id=hl-22-48><a class=lnlinks href=#hl-22-48>48</a>
</span><span class=lnt id=hl-22-49><a class=lnlinks href=#hl-22-49>49</a>
</span><span class=lnt id=hl-22-50><a class=lnlinks href=#hl-22-50>50</a>
</span><span class=lnt id=hl-22-51><a class=lnlinks href=#hl-22-51>51</a>
</span><span class=lnt id=hl-22-52><a class=lnlinks href=#hl-22-52>52</a>
</span><span class=lnt id=hl-22-53><a class=lnlinks href=#hl-22-53>53</a>
</span><span class=lnt id=hl-22-54><a class=lnlinks href=#hl-22-54>54</a>
</span><span class=lnt id=hl-22-55><a class=lnlinks href=#hl-22-55>55</a>
</span><span class=lnt id=hl-22-56><a class=lnlinks href=#hl-22-56>56</a>
</span><span class=lnt id=hl-22-57><a class=lnlinks href=#hl-22-57>57</a>
</span><span class=lnt id=hl-22-58><a class=lnlinks href=#hl-22-58>58</a>
</span><span class=lnt id=hl-22-59><a class=lnlinks href=#hl-22-59>59</a>
</span><span class=lnt id=hl-22-60><a class=lnlinks href=#hl-22-60>60</a>
</span><span class=lnt id=hl-22-61><a class=lnlinks href=#hl-22-61>61</a>
</span><span class=lnt id=hl-22-62><a class=lnlinks href=#hl-22-62>62</a>
</span><span class=lnt id=hl-22-63><a class=lnlinks href=#hl-22-63>63</a>
</span><span class=lnt id=hl-22-64><a class=lnlinks href=#hl-22-64>64</a>
</span><span class=lnt id=hl-22-65><a class=lnlinks href=#hl-22-65>65</a>
</span><span class=lnt id=hl-22-66><a class=lnlinks href=#hl-22-66>66</a>
</span><span class=lnt id=hl-22-67><a class=lnlinks href=#hl-22-67>67</a>
</span><span class=lnt id=hl-22-68><a class=lnlinks href=#hl-22-68>68</a>
</span><span class=lnt id=hl-22-69><a class=lnlinks href=#hl-22-69>69</a>
</span><span class=lnt id=hl-22-70><a class=lnlinks href=#hl-22-70>70</a>
</span><span class=lnt id=hl-22-71><a class=lnlinks href=#hl-22-71>71</a>
</span><span class=lnt id=hl-22-72><a class=lnlinks href=#hl-22-72>72</a>
</span><span class=lnt id=hl-22-73><a class=lnlinks href=#hl-22-73>73</a>
</span><span class=lnt id=hl-22-74><a class=lnlinks href=#hl-22-74>74</a>
</span><span class=lnt id=hl-22-75><a class=lnlinks href=#hl-22-75>75</a>
</span><span class=lnt id=hl-22-76><a class=lnlinks href=#hl-22-76>76</a>
</span><span class=lnt id=hl-22-77><a class=lnlinks href=#hl-22-77>77</a>
</span><span class=lnt id=hl-22-78><a class=lnlinks href=#hl-22-78>78</a>
</span><span class=lnt id=hl-22-79><a class=lnlinks href=#hl-22-79>79</a>
</span><span class=lnt id=hl-22-80><a class=lnlinks href=#hl-22-80>80</a>
</span><span class=lnt id=hl-22-81><a class=lnlinks href=#hl-22-81>81</a>
</span><span class=lnt id=hl-22-82><a class=lnlinks href=#hl-22-82>82</a>
</span><span class=lnt id=hl-22-83><a class=lnlinks href=#hl-22-83>83</a>
</span><span class=lnt id=hl-22-84><a class=lnlinks href=#hl-22-84>84</a>
</span><span class=lnt id=hl-22-85><a class=lnlinks href=#hl-22-85>85</a>
</span><span class=lnt id=hl-22-86><a class=lnlinks href=#hl-22-86>86</a>
</span><span class=lnt id=hl-22-87><a class=lnlinks href=#hl-22-87>87</a>
</span><span class=lnt id=hl-22-88><a class=lnlinks href=#hl-22-88>88</a>
</span><span class=lnt id=hl-22-89><a class=lnlinks href=#hl-22-89>89</a>
</span><span class=lnt id=hl-22-90><a class=lnlinks href=#hl-22-90>90</a>
</span><span class=lnt id=hl-22-91><a class=lnlinks href=#hl-22-91>91</a>
</span><span class=lnt id=hl-22-92><a class=lnlinks href=#hl-22-92>92</a>
</span><span class=lnt id=hl-22-93><a class=lnlinks href=#hl-22-93>93</a>
</span><span class=lnt id=hl-22-94><a class=lnlinks href=#hl-22-94>94</a>
</span><span class=lnt id=hl-22-95><a class=lnlinks href=#hl-22-95>95</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 민감한 데이터의 암호화 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SecureJobService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobRepository</span><span class=w> </span><span class=n>jobRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>EncryptionService</span><span class=w> </span><span class=n>encryptionService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>createJob</span><span class=p>(</span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 민감한 데이터 암호화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>hasSensitiveData</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>encryptSensitiveData</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Job</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>job</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>jobId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>JobRequest</span><span class=w> </span><span class=nf>encryptSensitiveData</span><span class=p>(</span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 요청 복제</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JobRequest</span><span class=w> </span><span class=n>encryptedRequest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>clone</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 민감한 필드 암호화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPaymentInfo</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PaymentInfo</span><span class=w> </span><span class=n>encryptedPaymentInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PaymentInfo</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>encryptionService</span><span class=p>.</span><span class=na>encrypt</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPaymentInfo</span><span class=p>().</span><span class=na>getCardNumber</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>request</span><span class=p>.</span><span class=na>getPaymentInfo</span><span class=p>().</span><span class=na>getExpiryMonth</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>request</span><span class=p>.</span><span class=na>getPaymentInfo</span><span class=p>().</span><span class=na>getExpiryYear</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>encryptionService</span><span class=p>.</span><span class=na>encrypt</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPaymentInfo</span><span class=p>().</span><span class=na>getCvv</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>encryptedRequest</span><span class=p>.</span><span class=na>setPaymentInfo</span><span class=p>(</span><span class=n>encryptedPaymentInfo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPersonalInfo</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PersonalInfo</span><span class=w> </span><span class=n>encryptedPersonalInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PersonalInfo</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>request</span><span class=p>.</span><span class=na>getPersonalInfo</span><span class=p>().</span><span class=na>getName</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>encryptionService</span><span class=p>.</span><span class=na>encrypt</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPersonalInfo</span><span class=p>().</span><span class=na>getSsn</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>encryptionService</span><span class=p>.</span><span class=na>encrypt</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPersonalInfo</span><span class=p>().</span><span class=na>getDateOfBirth</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>encryptedRequest</span><span class=p>.</span><span class=na>setPersonalInfo</span><span class=p>(</span><span class=n>encryptedPersonalInfo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 민감 데이터 포함 표시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>encryptedRequest</span><span class=p>.</span><span class=na>setContainsSensitiveData</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>encryptedRequest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 결과 조회 시 복호화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Job</span><span class=w> </span><span class=nf>getJob</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>decryptSensitiveData</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 민감한 데이터가 있고 복호화가 요청된 경우</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>decryptSensitiveData</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>isContainsSensitiveData</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>decryptSensitiveData</span><span class=p>(</span><span class=n>job</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>job</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Job</span><span class=w> </span><span class=nf>decryptSensitiveData</span><span class=p>(</span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 복제</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Job</span><span class=w> </span><span class=n>decryptedJob</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>clone</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getRequest</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 민감한 필드 복호화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPaymentInfo</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PaymentInfo</span><span class=w> </span><span class=n>decryptedPaymentInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PaymentInfo</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>encryptionService</span><span class=p>.</span><span class=na>decrypt</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPaymentInfo</span><span class=p>().</span><span class=na>getCardNumber</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>request</span><span class=p>.</span><span class=na>getPaymentInfo</span><span class=p>().</span><span class=na>getExpiryMonth</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>request</span><span class=p>.</span><span class=na>getPaymentInfo</span><span class=p>().</span><span class=na>getExpiryYear</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>encryptionService</span><span class=p>.</span><span class=na>decrypt</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPaymentInfo</span><span class=p>().</span><span class=na>getCvv</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>decryptedJob</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>setPaymentInfo</span><span class=p>(</span><span class=n>decryptedPaymentInfo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPersonalInfo</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PersonalInfo</span><span class=w> </span><span class=n>decryptedPersonalInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PersonalInfo</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>request</span><span class=p>.</span><span class=na>getPersonalInfo</span><span class=p>().</span><span class=na>getName</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>encryptionService</span><span class=p>.</span><span class=na>decrypt</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPersonalInfo</span><span class=p>().</span><span class=na>getSsn</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>encryptionService</span><span class=p>.</span><span class=na>decrypt</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPersonalInfo</span><span class=p>().</span><span class=na>getDateOfBirth</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>decryptedJob</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>setPersonalInfo</span><span class=p>(</span><span class=n>decryptedPersonalInfo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>decryptedJob</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=비동기식-api-모니터링-및-관측성>비동기식 API 모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#비동기식-api-모니터링-및-관측성>#</a></h3><p>비동기 API 시스템의 모니터링과 관측성은 운영상 매우 중요하다.</p><h4 id=비동기-작업-모니터링>비동기 작업 모니터링<a hidden class=anchor aria-hidden=true href=#비동기-작업-모니터링>#</a></h4><p>작업 상태와 성능을 모니터링하기 위한 대시보드와 도구를 구현한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17>17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18>18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19>19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20>20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21>21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22>22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23>23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24>24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25>25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26>26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27>27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28>28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29>29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30>30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31>31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32>32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33>33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34>34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35>35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36>36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37>37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38>38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39>39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40>40</a>
</span><span class=lnt id=hl-23-41><a class=lnlinks href=#hl-23-41>41</a>
</span><span class=lnt id=hl-23-42><a class=lnlinks href=#hl-23-42>42</a>
</span><span class=lnt id=hl-23-43><a class=lnlinks href=#hl-23-43>43</a>
</span><span class=lnt id=hl-23-44><a class=lnlinks href=#hl-23-44>44</a>
</span><span class=lnt id=hl-23-45><a class=lnlinks href=#hl-23-45>45</a>
</span><span class=lnt id=hl-23-46><a class=lnlinks href=#hl-23-46>46</a>
</span><span class=lnt id=hl-23-47><a class=lnlinks href=#hl-23-47>47</a>
</span><span class=lnt id=hl-23-48><a class=lnlinks href=#hl-23-48>48</a>
</span><span class=lnt id=hl-23-49><a class=lnlinks href=#hl-23-49>49</a>
</span><span class=lnt id=hl-23-50><a class=lnlinks href=#hl-23-50>50</a>
</span><span class=lnt id=hl-23-51><a class=lnlinks href=#hl-23-51>51</a>
</span><span class=lnt id=hl-23-52><a class=lnlinks href=#hl-23-52>52</a>
</span><span class=lnt id=hl-23-53><a class=lnlinks href=#hl-23-53>53</a>
</span><span class=lnt id=hl-23-54><a class=lnlinks href=#hl-23-54>54</a>
</span><span class=lnt id=hl-23-55><a class=lnlinks href=#hl-23-55>55</a>
</span><span class=lnt id=hl-23-56><a class=lnlinks href=#hl-23-56>56</a>
</span><span class=lnt id=hl-23-57><a class=lnlinks href=#hl-23-57>57</a>
</span><span class=lnt id=hl-23-58><a class=lnlinks href=#hl-23-58>58</a>
</span><span class=lnt id=hl-23-59><a class=lnlinks href=#hl-23-59>59</a>
</span><span class=lnt id=hl-23-60><a class=lnlinks href=#hl-23-60>60</a>
</span><span class=lnt id=hl-23-61><a class=lnlinks href=#hl-23-61>61</a>
</span><span class=lnt id=hl-23-62><a class=lnlinks href=#hl-23-62>62</a>
</span><span class=lnt id=hl-23-63><a class=lnlinks href=#hl-23-63>63</a>
</span><span class=lnt id=hl-23-64><a class=lnlinks href=#hl-23-64>64</a>
</span><span class=lnt id=hl-23-65><a class=lnlinks href=#hl-23-65>65</a>
</span><span class=lnt id=hl-23-66><a class=lnlinks href=#hl-23-66>66</a>
</span><span class=lnt id=hl-23-67><a class=lnlinks href=#hl-23-67>67</a>
</span><span class=lnt id=hl-23-68><a class=lnlinks href=#hl-23-68>68</a>
</span><span class=lnt id=hl-23-69><a class=lnlinks href=#hl-23-69>69</a>
</span><span class=lnt id=hl-23-70><a class=lnlinks href=#hl-23-70>70</a>
</span><span class=lnt id=hl-23-71><a class=lnlinks href=#hl-23-71>71</a>
</span><span class=lnt id=hl-23-72><a class=lnlinks href=#hl-23-72>72</a>
</span><span class=lnt id=hl-23-73><a class=lnlinks href=#hl-23-73>73</a>
</span><span class=lnt id=hl-23-74><a class=lnlinks href=#hl-23-74>74</a>
</span><span class=lnt id=hl-23-75><a class=lnlinks href=#hl-23-75>75</a>
</span><span class=lnt id=hl-23-76><a class=lnlinks href=#hl-23-76>76</a>
</span><span class=lnt id=hl-23-77><a class=lnlinks href=#hl-23-77>77</a>
</span><span class=lnt id=hl-23-78><a class=lnlinks href=#hl-23-78>78</a>
</span><span class=lnt id=hl-23-79><a class=lnlinks href=#hl-23-79>79</a>
</span><span class=lnt id=hl-23-80><a class=lnlinks href=#hl-23-80>80</a>
</span><span class=lnt id=hl-23-81><a class=lnlinks href=#hl-23-81>81</a>
</span><span class=lnt id=hl-23-82><a class=lnlinks href=#hl-23-82>82</a>
</span><span class=lnt id=hl-23-83><a class=lnlinks href=#hl-23-83>83</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 작업 모니터링 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobMonitoringService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobRepository</span><span class=w> </span><span class=n>jobRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MeterRegistry</span><span class=w> </span><span class=n>meterRegistry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 통계 수집 (스케줄링된 메서드)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>fixedRate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>60000</span><span class=p>)</span><span class=w> </span><span class=c1>// 1분마다 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>collectJobMetrics</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 상태별 작업 수 통계</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>JobStatus</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=n>countByStatus</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>countByStatus</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>JobStatus</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>countByStatus</span><span class=p>.</span><span class=na>entrySet</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>meterRegistry</span><span class=p>.</span><span class=na>gauge</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;jobs.count&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Tags</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>entry</span><span class=p>.</span><span class=na>getKey</span><span class=p>().</span><span class=na>name</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>entry</span><span class=p>.</span><span class=na>getValue</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 처리 시간 통계</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Double</span><span class=o>&gt;</span><span class=w> </span><span class=n>avgProcessingTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>getAverageProcessingTimeByType</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Double</span><span class=o>&gt;</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>avgProcessingTime</span><span class=p>.</span><span class=na>entrySet</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>meterRegistry</span><span class=p>.</span><span class=na>gauge</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;jobs.processing_time&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Tags</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;job_type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>entry</span><span class=p>.</span><span class=na>getKey</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>entry</span><span class=p>.</span><span class=na>getValue</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 실패율 통계</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Double</span><span class=o>&gt;</span><span class=w> </span><span class=n>failureRates</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>getFailureRateByType</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Double</span><span class=o>&gt;</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>failureRates</span><span class=p>.</span><span class=na>entrySet</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>meterRegistry</span><span class=p>.</span><span class=na>gauge</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;jobs.failure_rate&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Tags</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;job_type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>entry</span><span class=p>.</span><span class=na>getKey</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>entry</span><span class=p>.</span><span class=na>getValue</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 오래 실행 중인 작업 탐지</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>fixedRate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>300000</span><span class=p>)</span><span class=w> </span><span class=c1>// 5분마다 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>detectLongRunningJobs</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Job</span><span class=o>&gt;</span><span class=w> </span><span class=n>longRunningJobs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>findLongRunningJobs</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofMinutes</span><span class=p>(</span><span class=n>30</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 메트릭 기록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>meterRegistry</span><span class=p>.</span><span class=na>gauge</span><span class=p>(</span><span class=s>&#34;jobs.long_running.count&#34;</span><span class=p>,</span><span class=w> </span><span class=n>longRunningJobs</span><span class=p>.</span><span class=na>size</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 알림 발송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>longRunningJobs</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>StringBuilder</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuilder</span><span class=p>(</span><span class=s>&#34;Long running jobs detected:\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>longRunningJobs</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>message</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;Job %s (type: %s) running for %s minutes\n&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>job</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getType</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>Duration</span><span class=p>.</span><span class=na>between</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getStartedAt</span><span class=p>(),</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()).</span><span class=na>toMinutes</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>alertService</span><span class=p>.</span><span class=na>sendAlert</span><span class=p>(</span><span class=s>&#34;LONG_RUNNING_JOBS&#34;</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 처리 시간 히스토그램</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>recordJobProcessingTime</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobType</span><span class=p>,</span><span class=w> </span><span class=n>Duration</span><span class=w> </span><span class=n>duration</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>meterRegistry</span><span class=p>.</span><span class=na>timer</span><span class=p>(</span><span class=s>&#34;jobs.processing_duration&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;job_type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>jobType</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>record</span><span class=p>(</span><span class=n>duration</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 결과 카운터</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>recordJobResult</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobType</span><span class=p>,</span><span class=w> </span><span class=n>JobStatus</span><span class=w> </span><span class=n>status</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>meterRegistry</span><span class=p>.</span><span class=na>counter</span><span class=p>(</span><span class=s>&#34;jobs.completed&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;job_type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>jobType</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>name</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>increment</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=분산-추적>분산 추적<a hidden class=anchor aria-hidden=true href=#분산-추적>#</a></h4><p>마이크로서비스 환경에서는 분산 추적을 통해 비동기 작업의 흐름을 추적할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29>29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30>30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31>31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32>32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33>33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34>34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35>35</a>
</span><span class=lnt id=hl-24-36><a class=lnlinks href=#hl-24-36>36</a>
</span><span class=lnt id=hl-24-37><a class=lnlinks href=#hl-24-37>37</a>
</span><span class=lnt id=hl-24-38><a class=lnlinks href=#hl-24-38>38</a>
</span><span class=lnt id=hl-24-39><a class=lnlinks href=#hl-24-39>39</a>
</span><span class=lnt id=hl-24-40><a class=lnlinks href=#hl-24-40>40</a>
</span><span class=lnt id=hl-24-41><a class=lnlinks href=#hl-24-41>41</a>
</span><span class=lnt id=hl-24-42><a class=lnlinks href=#hl-24-42>42</a>
</span><span class=lnt id=hl-24-43><a class=lnlinks href=#hl-24-43>43</a>
</span><span class=lnt id=hl-24-44><a class=lnlinks href=#hl-24-44>44</a>
</span><span class=lnt id=hl-24-45><a class=lnlinks href=#hl-24-45>45</a>
</span><span class=lnt id=hl-24-46><a class=lnlinks href=#hl-24-46>46</a>
</span><span class=lnt id=hl-24-47><a class=lnlinks href=#hl-24-47>47</a>
</span><span class=lnt id=hl-24-48><a class=lnlinks href=#hl-24-48>48</a>
</span><span class=lnt id=hl-24-49><a class=lnlinks href=#hl-24-49>49</a>
</span><span class=lnt id=hl-24-50><a class=lnlinks href=#hl-24-50>50</a>
</span><span class=lnt id=hl-24-51><a class=lnlinks href=#hl-24-51>51</a>
</span><span class=lnt id=hl-24-52><a class=lnlinks href=#hl-24-52>52</a>
</span><span class=lnt id=hl-24-53><a class=lnlinks href=#hl-24-53>53</a>
</span><span class=lnt id=hl-24-54><a class=lnlinks href=#hl-24-54>54</a>
</span><span class=lnt id=hl-24-55><a class=lnlinks href=#hl-24-55>55</a>
</span><span class=lnt id=hl-24-56><a class=lnlinks href=#hl-24-56>56</a>
</span><span class=lnt id=hl-24-57><a class=lnlinks href=#hl-24-57>57</a>
</span><span class=lnt id=hl-24-58><a class=lnlinks href=#hl-24-58>58</a>
</span><span class=lnt id=hl-24-59><a class=lnlinks href=#hl-24-59>59</a>
</span><span class=lnt id=hl-24-60><a class=lnlinks href=#hl-24-60>60</a>
</span><span class=lnt id=hl-24-61><a class=lnlinks href=#hl-24-61>61</a>
</span><span class=lnt id=hl-24-62><a class=lnlinks href=#hl-24-62>62</a>
</span><span class=lnt id=hl-24-63><a class=lnlinks href=#hl-24-63>63</a>
</span><span class=lnt id=hl-24-64><a class=lnlinks href=#hl-24-64>64</a>
</span><span class=lnt id=hl-24-65><a class=lnlinks href=#hl-24-65>65</a>
</span><span class=lnt id=hl-24-66><a class=lnlinks href=#hl-24-66>66</a>
</span><span class=lnt id=hl-24-67><a class=lnlinks href=#hl-24-67>67</a>
</span><span class=lnt id=hl-24-68><a class=lnlinks href=#hl-24-68>68</a>
</span><span class=lnt id=hl-24-69><a class=lnlinks href=#hl-24-69>69</a>
</span><span class=lnt id=hl-24-70><a class=lnlinks href=#hl-24-70>70</a>
</span><span class=lnt id=hl-24-71><a class=lnlinks href=#hl-24-71>71</a>
</span><span class=lnt id=hl-24-72><a class=lnlinks href=#hl-24-72>72</a>
</span><span class=lnt id=hl-24-73><a class=lnlinks href=#hl-24-73>73</a>
</span><span class=lnt id=hl-24-74><a class=lnlinks href=#hl-24-74>74</a>
</span><span class=lnt id=hl-24-75><a class=lnlinks href=#hl-24-75>75</a>
</span><span class=lnt id=hl-24-76><a class=lnlinks href=#hl-24-76>76</a>
</span><span class=lnt id=hl-24-77><a class=lnlinks href=#hl-24-77>77</a>
</span><span class=lnt id=hl-24-78><a class=lnlinks href=#hl-24-78>78</a>
</span><span class=lnt id=hl-24-79><a class=lnlinks href=#hl-24-79>79</a>
</span><span class=lnt id=hl-24-80><a class=lnlinks href=#hl-24-80>80</a>
</span><span class=lnt id=hl-24-81><a class=lnlinks href=#hl-24-81>81</a>
</span><span class=lnt id=hl-24-82><a class=lnlinks href=#hl-24-82>82</a>
</span><span class=lnt id=hl-24-83><a class=lnlinks href=#hl-24-83>83</a>
</span><span class=lnt id=hl-24-84><a class=lnlinks href=#hl-24-84>84</a>
</span><span class=lnt id=hl-24-85><a class=lnlinks href=#hl-24-85>85</a>
</span><span class=lnt id=hl-24-86><a class=lnlinks href=#hl-24-86>86</a>
</span><span class=lnt id=hl-24-87><a class=lnlinks href=#hl-24-87>87</a>
</span><span class=lnt id=hl-24-88><a class=lnlinks href=#hl-24-88>88</a>
</span><span class=lnt id=hl-24-89><a class=lnlinks href=#hl-24-89>89</a>
</span><span class=lnt id=hl-24-90><a class=lnlinks href=#hl-24-90>90</a>
</span><span class=lnt id=hl-24-91><a class=lnlinks href=#hl-24-91>91</a>
</span><span class=lnt id=hl-24-92><a class=lnlinks href=#hl-24-92>92</a>
</span><span class=lnt id=hl-24-93><a class=lnlinks href=#hl-24-93>93</a>
</span><span class=lnt id=hl-24-94><a class=lnlinks href=#hl-24-94>94</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 분산 추적 서비스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TraceableJobService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobRepository</span><span class=w> </span><span class=n>jobRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Tracer</span><span class=w> </span><span class=n>tracer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>createJob</span><span class=p>(</span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 현재 활성 스팬 가져오기</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Span</span><span class=w> </span><span class=n>parentSpan</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tracer</span><span class=p>.</span><span class=na>currentSpan</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 생성 스팬 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Span</span><span class=w> </span><span class=n>span</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tracer</span><span class=p>.</span><span class=na>nextSpan</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>name</span><span class=p>(</span><span class=s>&#34;job.create&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;job.type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getType</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Tracer</span><span class=p>.</span><span class=na>SpanInScope</span><span class=w> </span><span class=n>ws</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tracer</span><span class=p>.</span><span class=na>withSpanInScope</span><span class=p>(</span><span class=n>span</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 추적 컨텍스트 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>TraceContext</span><span class=w> </span><span class=n>traceContext</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>span</span><span class=p>.</span><span class=na>context</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>traceId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>traceContext</span><span class=p>.</span><span class=na>traceIdString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>spanId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>traceContext</span><span class=p>.</span><span class=na>spanIdString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 저장 (추적 정보 포함)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Job</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>jobId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>traceId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>spanId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>job</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 로그</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>span</span><span class=p>.</span><span class=na>annotate</span><span class=p>(</span><span class=s>&#34;Job created: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>jobId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>span</span><span class=p>.</span><span class=na>finish</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processJob</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 저장된 추적 컨텍스트에서 스팬 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>TraceContext</span><span class=w> </span><span class=n>parentContext</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TraceContext</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>traceId</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getTraceId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>spanId</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getSpanId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Span</span><span class=w> </span><span class=n>parentSpan</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tracer</span><span class=p>.</span><span class=na>toSpan</span><span class=p>(</span><span class=n>parentContext</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 처리 스팬 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Span</span><span class=w> </span><span class=n>span</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tracer</span><span class=p>.</span><span class=na>newChild</span><span class=p>(</span><span class=n>parentSpan</span><span class=p>.</span><span class=na>context</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>name</span><span class=p>(</span><span class=s>&#34;job.process&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;job.id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;job.type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getType</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Tracer</span><span class=p>.</span><span class=na>SpanInScope</span><span class=w> </span><span class=n>ws</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tracer</span><span class=p>.</span><span class=na>withSpanInScope</span><span class=p>(</span><span class=n>span</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>span</span><span class=p>.</span><span class=na>annotate</span><span class=p>(</span><span class=s>&#34;Job processing started&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>JobResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>processJobRequest</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getRequest</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 완료 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>complete</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>span</span><span class=p>.</span><span class=na>annotate</span><span class=p>(</span><span class=s>&#34;Job completed successfully&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>span</span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;error&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;true&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>span</span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;error.message&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 실패 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>fail</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>span</span><span class=p>.</span><span class=na>annotate</span><span class=p>(</span><span class=s>&#34;Job failed: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>span</span><span class=p>.</span><span class=na>finish</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>JobResult</span><span class=w> </span><span class=nf>processJobRequest</span><span class=p>(</span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobResult</span><span class=p>(</span><span class=cm>/* 결과 데이터 */</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=로깅-전략>로깅 전략<a hidden class=anchor aria-hidden=true href=#로깅-전략>#</a></h4><p>효과적인 문제 해결을 위해 구조화된 로깅이 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>  1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2>  2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3>  3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4>  4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5>  5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6>  6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7>  7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8>  8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9>  9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10> 10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11> 11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12> 12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13> 13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14> 14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15> 15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16> 16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17> 17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18> 18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19> 19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20> 20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21> 21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22> 22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23> 23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24> 24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25> 25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26> 26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27> 27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28> 28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29> 29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30> 30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31> 31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32> 32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33> 33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34> 34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35> 35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36> 36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37> 37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38> 38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39> 39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40> 40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41> 41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42> 42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43> 43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44> 44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45> 45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46> 46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47> 47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48> 48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49> 49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50> 50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51> 51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52> 52</a>
</span><span class=lnt id=hl-25-53><a class=lnlinks href=#hl-25-53> 53</a>
</span><span class=lnt id=hl-25-54><a class=lnlinks href=#hl-25-54> 54</a>
</span><span class=lnt id=hl-25-55><a class=lnlinks href=#hl-25-55> 55</a>
</span><span class=lnt id=hl-25-56><a class=lnlinks href=#hl-25-56> 56</a>
</span><span class=lnt id=hl-25-57><a class=lnlinks href=#hl-25-57> 57</a>
</span><span class=lnt id=hl-25-58><a class=lnlinks href=#hl-25-58> 58</a>
</span><span class=lnt id=hl-25-59><a class=lnlinks href=#hl-25-59> 59</a>
</span><span class=lnt id=hl-25-60><a class=lnlinks href=#hl-25-60> 60</a>
</span><span class=lnt id=hl-25-61><a class=lnlinks href=#hl-25-61> 61</a>
</span><span class=lnt id=hl-25-62><a class=lnlinks href=#hl-25-62> 62</a>
</span><span class=lnt id=hl-25-63><a class=lnlinks href=#hl-25-63> 63</a>
</span><span class=lnt id=hl-25-64><a class=lnlinks href=#hl-25-64> 64</a>
</span><span class=lnt id=hl-25-65><a class=lnlinks href=#hl-25-65> 65</a>
</span><span class=lnt id=hl-25-66><a class=lnlinks href=#hl-25-66> 66</a>
</span><span class=lnt id=hl-25-67><a class=lnlinks href=#hl-25-67> 67</a>
</span><span class=lnt id=hl-25-68><a class=lnlinks href=#hl-25-68> 68</a>
</span><span class=lnt id=hl-25-69><a class=lnlinks href=#hl-25-69> 69</a>
</span><span class=lnt id=hl-25-70><a class=lnlinks href=#hl-25-70> 70</a>
</span><span class=lnt id=hl-25-71><a class=lnlinks href=#hl-25-71> 71</a>
</span><span class=lnt id=hl-25-72><a class=lnlinks href=#hl-25-72> 72</a>
</span><span class=lnt id=hl-25-73><a class=lnlinks href=#hl-25-73> 73</a>
</span><span class=lnt id=hl-25-74><a class=lnlinks href=#hl-25-74> 74</a>
</span><span class=lnt id=hl-25-75><a class=lnlinks href=#hl-25-75> 75</a>
</span><span class=lnt id=hl-25-76><a class=lnlinks href=#hl-25-76> 76</a>
</span><span class=lnt id=hl-25-77><a class=lnlinks href=#hl-25-77> 77</a>
</span><span class=lnt id=hl-25-78><a class=lnlinks href=#hl-25-78> 78</a>
</span><span class=lnt id=hl-25-79><a class=lnlinks href=#hl-25-79> 79</a>
</span><span class=lnt id=hl-25-80><a class=lnlinks href=#hl-25-80> 80</a>
</span><span class=lnt id=hl-25-81><a class=lnlinks href=#hl-25-81> 81</a>
</span><span class=lnt id=hl-25-82><a class=lnlinks href=#hl-25-82> 82</a>
</span><span class=lnt id=hl-25-83><a class=lnlinks href=#hl-25-83> 83</a>
</span><span class=lnt id=hl-25-84><a class=lnlinks href=#hl-25-84> 84</a>
</span><span class=lnt id=hl-25-85><a class=lnlinks href=#hl-25-85> 85</a>
</span><span class=lnt id=hl-25-86><a class=lnlinks href=#hl-25-86> 86</a>
</span><span class=lnt id=hl-25-87><a class=lnlinks href=#hl-25-87> 87</a>
</span><span class=lnt id=hl-25-88><a class=lnlinks href=#hl-25-88> 88</a>
</span><span class=lnt id=hl-25-89><a class=lnlinks href=#hl-25-89> 89</a>
</span><span class=lnt id=hl-25-90><a class=lnlinks href=#hl-25-90> 90</a>
</span><span class=lnt id=hl-25-91><a class=lnlinks href=#hl-25-91> 91</a>
</span><span class=lnt id=hl-25-92><a class=lnlinks href=#hl-25-92> 92</a>
</span><span class=lnt id=hl-25-93><a class=lnlinks href=#hl-25-93> 93</a>
</span><span class=lnt id=hl-25-94><a class=lnlinks href=#hl-25-94> 94</a>
</span><span class=lnt id=hl-25-95><a class=lnlinks href=#hl-25-95> 95</a>
</span><span class=lnt id=hl-25-96><a class=lnlinks href=#hl-25-96> 96</a>
</span><span class=lnt id=hl-25-97><a class=lnlinks href=#hl-25-97> 97</a>
</span><span class=lnt id=hl-25-98><a class=lnlinks href=#hl-25-98> 98</a>
</span><span class=lnt id=hl-25-99><a class=lnlinks href=#hl-25-99> 99</a>
</span><span class=lnt id=hl-25-100><a class=lnlinks href=#hl-25-100>100</a>
</span><span class=lnt id=hl-25-101><a class=lnlinks href=#hl-25-101>101</a>
</span><span class=lnt id=hl-25-102><a class=lnlinks href=#hl-25-102>102</a>
</span><span class=lnt id=hl-25-103><a class=lnlinks href=#hl-25-103>103</a>
</span><span class=lnt id=hl-25-104><a class=lnlinks href=#hl-25-104>104</a>
</span><span class=lnt id=hl-25-105><a class=lnlinks href=#hl-25-105>105</a>
</span><span class=lnt id=hl-25-106><a class=lnlinks href=#hl-25-106>106</a>
</span><span class=lnt id=hl-25-107><a class=lnlinks href=#hl-25-107>107</a>
</span><span class=lnt id=hl-25-108><a class=lnlinks href=#hl-25-108>108</a>
</span><span class=lnt id=hl-25-109><a class=lnlinks href=#hl-25-109>109</a>
</span><span class=lnt id=hl-25-110><a class=lnlinks href=#hl-25-110>110</a>
</span><span class=lnt id=hl-25-111><a class=lnlinks href=#hl-25-111>111</a>
</span><span class=lnt id=hl-25-112><a class=lnlinks href=#hl-25-112>112</a>
</span><span class=lnt id=hl-25-113><a class=lnlinks href=#hl-25-113>113</a>
</span><span class=lnt id=hl-25-114><a class=lnlinks href=#hl-25-114>114</a>
</span><span class=lnt id=hl-25-115><a class=lnlinks href=#hl-25-115>115</a>
</span><span class=lnt id=hl-25-116><a class=lnlinks href=#hl-25-116>116</a>
</span><span class=lnt id=hl-25-117><a class=lnlinks href=#hl-25-117>117</a>
</span><span class=lnt id=hl-25-118><a class=lnlinks href=#hl-25-118>118</a>
</span><span class=lnt id=hl-25-119><a class=lnlinks href=#hl-25-119>119</a>
</span><span class=lnt id=hl-25-120><a class=lnlinks href=#hl-25-120>120</a>
</span><span class=lnt id=hl-25-121><a class=lnlinks href=#hl-25-121>121</a>
</span><span class=lnt id=hl-25-122><a class=lnlinks href=#hl-25-122>122</a>
</span><span class=lnt id=hl-25-123><a class=lnlinks href=#hl-25-123>123</a>
</span><span class=lnt id=hl-25-124><a class=lnlinks href=#hl-25-124>124</a>
</span><span class=lnt id=hl-25-125><a class=lnlinks href=#hl-25-125>125</a>
</span><span class=lnt id=hl-25-126><a class=lnlinks href=#hl-25-126>126</a>
</span><span class=lnt id=hl-25-127><a class=lnlinks href=#hl-25-127>127</a>
</span><span class=lnt id=hl-25-128><a class=lnlinks href=#hl-25-128>128</a>
</span><span class=lnt id=hl-25-129><a class=lnlinks href=#hl-25-129>129</a>
</span><span class=lnt id=hl-25-130><a class=lnlinks href=#hl-25-130>130</a>
</span><span class=lnt id=hl-25-131><a class=lnlinks href=#hl-25-131>131</a>
</span><span class=lnt id=hl-25-132><a class=lnlinks href=#hl-25-132>132</a>
</span><span class=lnt id=hl-25-133><a class=lnlinks href=#hl-25-133>133</a>
</span><span class=lnt id=hl-25-134><a class=lnlinks href=#hl-25-134>134</a>
</span><span class=lnt id=hl-25-135><a class=lnlinks href=#hl-25-135>135</a>
</span><span class=lnt id=hl-25-136><a class=lnlinks href=#hl-25-136>136</a>
</span><span class=lnt id=hl-25-137><a class=lnlinks href=#hl-25-137>137</a>
</span><span class=lnt id=hl-25-138><a class=lnlinks href=#hl-25-138>138</a>
</span><span class=lnt id=hl-25-139><a class=lnlinks href=#hl-25-139>139</a>
</span><span class=lnt id=hl-25-140><a class=lnlinks href=#hl-25-140>140</a>
</span><span class=lnt id=hl-25-141><a class=lnlinks href=#hl-25-141>141</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 구조화된 로깅 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AsyncJobProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Logger</span><span class=w> </span><span class=n>log</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LoggerFactory</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>AsyncJobProcessor</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobRepository</span><span class=w> </span><span class=n>jobRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processJob</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// MDC에 작업 컨텍스트 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MDC</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;jobId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Job not found&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 추가 컨텍스트 정보</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>MDC</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;jobType&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getType</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>MDC</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;userId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getUserId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Starting job processing&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>JobStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 진행 상황 업데이트를 위한 리스너</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ProgressListener</span><span class=w> </span><span class=n>progressListener</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>progress</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Job progress: {}% - {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>progress</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>100</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>updateProgress</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>progress</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 작업 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>debug</span><span class=p>(</span><span class=s>&#34;Executing job with parameters: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getRequest</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>JobResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>executeJob</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getRequest</span><span class=p>(),</span><span class=w> </span><span class=n>progressListener</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 성공 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Job completed successfully&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>complete</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;Job execution failed&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>jobRepository</span><span class=p>.</span><span class=na>fail</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// MDC 정리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>MDC</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>JobResult</span><span class=w> </span><span class=nf>executeJob</span><span class=p>(</span><span class=n>JobRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>ProgressListener</span><span class=w> </span><span class=n>progressListener</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 진행 상황 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>progressListener</span><span class=p>.</span><span class=na>onProgress</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>25f</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Initial processing completed&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 더 많은 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>progressListener</span><span class=p>.</span><span class=na>onProgress</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>5f</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Halfway done&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 더 많은 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>progressListener</span><span class=p>.</span><span class=na>onProgress</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>75f</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Almost there&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 최종 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>progressListener</span><span class=p>.</span><span class=na>onProgress</span><span class=p>(</span><span class=n>1</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Processing complete&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobResult</span><span class=p>(</span><span class=cm>/* 결과 데이터 */</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 진행 상황 리스너 인터페이스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>ProgressListener</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>onProgress</span><span class=p>(</span><span class=kt>float</span><span class=w> </span><span class=n>progress</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 로그 이벤트 구조체</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobLogEvent</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>eventType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>details</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>timestamp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자, 게터 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>JobLogEvent</span><span class=w> </span><span class=nf>info</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobLogEvent</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;INFO&#34;</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>Collections</span><span class=p>.</span><span class=na>emptyMap</span><span class=p>(),</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>JobLogEvent</span><span class=w> </span><span class=nf>warning</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobLogEvent</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;WARNING&#34;</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>Collections</span><span class=p>.</span><span class=na>emptyMap</span><span class=p>(),</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>JobLogEvent</span><span class=w> </span><span class=nf>error</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=n>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>details</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>details</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;errorType&#34;</span><span class=p>,</span><span class=w> </span><span class=n>error</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>details</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;errorMessage&#34;</span><span class=p>,</span><span class=w> </span><span class=n>error</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>details</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;stackTrace&#34;</span><span class=p>,</span><span class=w> </span><span class=n>getStackTraceAsString</span><span class=p>(</span><span class=n>error</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobLogEvent</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;ERROR&#34;</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>JobLogEvent</span><span class=w> </span><span class=nf>progress</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=kt>float</span><span class=w> </span><span class=n>progress</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>details</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>details</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;progress&#34;</span><span class=p>,</span><span class=w> </span><span class=n>progress</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobLogEvent</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PROGRESS&#34;</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getStackTraceAsString</span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StringWriter</span><span class=w> </span><span class=n>sw</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringWriter</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>error</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>PrintWriter</span><span class=p>(</span><span class=n>sw</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>sw</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 작업 로그 저장소</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobLogRepository</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MongoTemplate</span><span class=w> </span><span class=n>mongoTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>saveLogEvent</span><span class=p>(</span><span class=n>JobLogEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mongoTemplate</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>event</span><span class=p>,</span><span class=w> </span><span class=s>&#34;job_logs&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>JobLogEvent</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getJobLogs</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Query</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Query</span><span class=p>.</span><span class=na>query</span><span class=p>(</span><span class=n>Criteria</span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=s>&#34;jobId&#34;</span><span class=p>).</span><span class=na>is</span><span class=p>(</span><span class=n>jobId</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=n>Sort</span><span class=p>.</span><span class=na>by</span><span class=p>(</span><span class=n>Sort</span><span class=p>.</span><span class=na>Direction</span><span class=p>.</span><span class=na>ASC</span><span class=p>,</span><span class=w> </span><span class=s>&#34;timestamp&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>mongoTemplate</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>query</span><span class=p>,</span><span class=w> </span><span class=n>JobLogEvent</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=s>&#34;job_logs&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=비동기식-api의-적용-사례>비동기식 API의 적용 사례<a hidden class=anchor aria-hidden=true href=#비동기식-api의-적용-사례>#</a></h3><p>비동기식 API가 특히 유용한 다양한 실제 사용 사례</p><h4 id=파일-처리-및-변환>파일 처리 및 변환<a hidden class=anchor aria-hidden=true href=#파일-처리-및-변환>#</a></h4><p>대용량 파일의 업로드, 처리, 변환을 위한 비동기 API 구현 예시.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>  1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2>  2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3>  3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4>  4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5>  5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6>  6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7>  7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8>  8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9>  9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10> 10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11> 11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12> 12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13> 13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14> 14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15> 15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16> 16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17> 17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18> 18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19> 19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20> 20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21> 21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22> 22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23> 23</a>
</span><span class=lnt id=hl-26-24><a class=lnlinks href=#hl-26-24> 24</a>
</span><span class=lnt id=hl-26-25><a class=lnlinks href=#hl-26-25> 25</a>
</span><span class=lnt id=hl-26-26><a class=lnlinks href=#hl-26-26> 26</a>
</span><span class=lnt id=hl-26-27><a class=lnlinks href=#hl-26-27> 27</a>
</span><span class=lnt id=hl-26-28><a class=lnlinks href=#hl-26-28> 28</a>
</span><span class=lnt id=hl-26-29><a class=lnlinks href=#hl-26-29> 29</a>
</span><span class=lnt id=hl-26-30><a class=lnlinks href=#hl-26-30> 30</a>
</span><span class=lnt id=hl-26-31><a class=lnlinks href=#hl-26-31> 31</a>
</span><span class=lnt id=hl-26-32><a class=lnlinks href=#hl-26-32> 32</a>
</span><span class=lnt id=hl-26-33><a class=lnlinks href=#hl-26-33> 33</a>
</span><span class=lnt id=hl-26-34><a class=lnlinks href=#hl-26-34> 34</a>
</span><span class=lnt id=hl-26-35><a class=lnlinks href=#hl-26-35> 35</a>
</span><span class=lnt id=hl-26-36><a class=lnlinks href=#hl-26-36> 36</a>
</span><span class=lnt id=hl-26-37><a class=lnlinks href=#hl-26-37> 37</a>
</span><span class=lnt id=hl-26-38><a class=lnlinks href=#hl-26-38> 38</a>
</span><span class=lnt id=hl-26-39><a class=lnlinks href=#hl-26-39> 39</a>
</span><span class=lnt id=hl-26-40><a class=lnlinks href=#hl-26-40> 40</a>
</span><span class=lnt id=hl-26-41><a class=lnlinks href=#hl-26-41> 41</a>
</span><span class=lnt id=hl-26-42><a class=lnlinks href=#hl-26-42> 42</a>
</span><span class=lnt id=hl-26-43><a class=lnlinks href=#hl-26-43> 43</a>
</span><span class=lnt id=hl-26-44><a class=lnlinks href=#hl-26-44> 44</a>
</span><span class=lnt id=hl-26-45><a class=lnlinks href=#hl-26-45> 45</a>
</span><span class=lnt id=hl-26-46><a class=lnlinks href=#hl-26-46> 46</a>
</span><span class=lnt id=hl-26-47><a class=lnlinks href=#hl-26-47> 47</a>
</span><span class=lnt id=hl-26-48><a class=lnlinks href=#hl-26-48> 48</a>
</span><span class=lnt id=hl-26-49><a class=lnlinks href=#hl-26-49> 49</a>
</span><span class=lnt id=hl-26-50><a class=lnlinks href=#hl-26-50> 50</a>
</span><span class=lnt id=hl-26-51><a class=lnlinks href=#hl-26-51> 51</a>
</span><span class=lnt id=hl-26-52><a class=lnlinks href=#hl-26-52> 52</a>
</span><span class=lnt id=hl-26-53><a class=lnlinks href=#hl-26-53> 53</a>
</span><span class=lnt id=hl-26-54><a class=lnlinks href=#hl-26-54> 54</a>
</span><span class=lnt id=hl-26-55><a class=lnlinks href=#hl-26-55> 55</a>
</span><span class=lnt id=hl-26-56><a class=lnlinks href=#hl-26-56> 56</a>
</span><span class=lnt id=hl-26-57><a class=lnlinks href=#hl-26-57> 57</a>
</span><span class=lnt id=hl-26-58><a class=lnlinks href=#hl-26-58> 58</a>
</span><span class=lnt id=hl-26-59><a class=lnlinks href=#hl-26-59> 59</a>
</span><span class=lnt id=hl-26-60><a class=lnlinks href=#hl-26-60> 60</a>
</span><span class=lnt id=hl-26-61><a class=lnlinks href=#hl-26-61> 61</a>
</span><span class=lnt id=hl-26-62><a class=lnlinks href=#hl-26-62> 62</a>
</span><span class=lnt id=hl-26-63><a class=lnlinks href=#hl-26-63> 63</a>
</span><span class=lnt id=hl-26-64><a class=lnlinks href=#hl-26-64> 64</a>
</span><span class=lnt id=hl-26-65><a class=lnlinks href=#hl-26-65> 65</a>
</span><span class=lnt id=hl-26-66><a class=lnlinks href=#hl-26-66> 66</a>
</span><span class=lnt id=hl-26-67><a class=lnlinks href=#hl-26-67> 67</a>
</span><span class=lnt id=hl-26-68><a class=lnlinks href=#hl-26-68> 68</a>
</span><span class=lnt id=hl-26-69><a class=lnlinks href=#hl-26-69> 69</a>
</span><span class=lnt id=hl-26-70><a class=lnlinks href=#hl-26-70> 70</a>
</span><span class=lnt id=hl-26-71><a class=lnlinks href=#hl-26-71> 71</a>
</span><span class=lnt id=hl-26-72><a class=lnlinks href=#hl-26-72> 72</a>
</span><span class=lnt id=hl-26-73><a class=lnlinks href=#hl-26-73> 73</a>
</span><span class=lnt id=hl-26-74><a class=lnlinks href=#hl-26-74> 74</a>
</span><span class=lnt id=hl-26-75><a class=lnlinks href=#hl-26-75> 75</a>
</span><span class=lnt id=hl-26-76><a class=lnlinks href=#hl-26-76> 76</a>
</span><span class=lnt id=hl-26-77><a class=lnlinks href=#hl-26-77> 77</a>
</span><span class=lnt id=hl-26-78><a class=lnlinks href=#hl-26-78> 78</a>
</span><span class=lnt id=hl-26-79><a class=lnlinks href=#hl-26-79> 79</a>
</span><span class=lnt id=hl-26-80><a class=lnlinks href=#hl-26-80> 80</a>
</span><span class=lnt id=hl-26-81><a class=lnlinks href=#hl-26-81> 81</a>
</span><span class=lnt id=hl-26-82><a class=lnlinks href=#hl-26-82> 82</a>
</span><span class=lnt id=hl-26-83><a class=lnlinks href=#hl-26-83> 83</a>
</span><span class=lnt id=hl-26-84><a class=lnlinks href=#hl-26-84> 84</a>
</span><span class=lnt id=hl-26-85><a class=lnlinks href=#hl-26-85> 85</a>
</span><span class=lnt id=hl-26-86><a class=lnlinks href=#hl-26-86> 86</a>
</span><span class=lnt id=hl-26-87><a class=lnlinks href=#hl-26-87> 87</a>
</span><span class=lnt id=hl-26-88><a class=lnlinks href=#hl-26-88> 88</a>
</span><span class=lnt id=hl-26-89><a class=lnlinks href=#hl-26-89> 89</a>
</span><span class=lnt id=hl-26-90><a class=lnlinks href=#hl-26-90> 90</a>
</span><span class=lnt id=hl-26-91><a class=lnlinks href=#hl-26-91> 91</a>
</span><span class=lnt id=hl-26-92><a class=lnlinks href=#hl-26-92> 92</a>
</span><span class=lnt id=hl-26-93><a class=lnlinks href=#hl-26-93> 93</a>
</span><span class=lnt id=hl-26-94><a class=lnlinks href=#hl-26-94> 94</a>
</span><span class=lnt id=hl-26-95><a class=lnlinks href=#hl-26-95> 95</a>
</span><span class=lnt id=hl-26-96><a class=lnlinks href=#hl-26-96> 96</a>
</span><span class=lnt id=hl-26-97><a class=lnlinks href=#hl-26-97> 97</a>
</span><span class=lnt id=hl-26-98><a class=lnlinks href=#hl-26-98> 98</a>
</span><span class=lnt id=hl-26-99><a class=lnlinks href=#hl-26-99> 99</a>
</span><span class=lnt id=hl-26-100><a class=lnlinks href=#hl-26-100>100</a>
</span><span class=lnt id=hl-26-101><a class=lnlinks href=#hl-26-101>101</a>
</span><span class=lnt id=hl-26-102><a class=lnlinks href=#hl-26-102>102</a>
</span><span class=lnt id=hl-26-103><a class=lnlinks href=#hl-26-103>103</a>
</span><span class=lnt id=hl-26-104><a class=lnlinks href=#hl-26-104>104</a>
</span><span class=lnt id=hl-26-105><a class=lnlinks href=#hl-26-105>105</a>
</span><span class=lnt id=hl-26-106><a class=lnlinks href=#hl-26-106>106</a>
</span><span class=lnt id=hl-26-107><a class=lnlinks href=#hl-26-107>107</a>
</span><span class=lnt id=hl-26-108><a class=lnlinks href=#hl-26-108>108</a>
</span><span class=lnt id=hl-26-109><a class=lnlinks href=#hl-26-109>109</a>
</span><span class=lnt id=hl-26-110><a class=lnlinks href=#hl-26-110>110</a>
</span><span class=lnt id=hl-26-111><a class=lnlinks href=#hl-26-111>111</a>
</span><span class=lnt id=hl-26-112><a class=lnlinks href=#hl-26-112>112</a>
</span><span class=lnt id=hl-26-113><a class=lnlinks href=#hl-26-113>113</a>
</span><span class=lnt id=hl-26-114><a class=lnlinks href=#hl-26-114>114</a>
</span><span class=lnt id=hl-26-115><a class=lnlinks href=#hl-26-115>115</a>
</span><span class=lnt id=hl-26-116><a class=lnlinks href=#hl-26-116>116</a>
</span><span class=lnt id=hl-26-117><a class=lnlinks href=#hl-26-117>117</a>
</span><span class=lnt id=hl-26-118><a class=lnlinks href=#hl-26-118>118</a>
</span><span class=lnt id=hl-26-119><a class=lnlinks href=#hl-26-119>119</a>
</span><span class=lnt id=hl-26-120><a class=lnlinks href=#hl-26-120>120</a>
</span><span class=lnt id=hl-26-121><a class=lnlinks href=#hl-26-121>121</a>
</span><span class=lnt id=hl-26-122><a class=lnlinks href=#hl-26-122>122</a>
</span><span class=lnt id=hl-26-123><a class=lnlinks href=#hl-26-123>123</a>
</span><span class=lnt id=hl-26-124><a class=lnlinks href=#hl-26-124>124</a>
</span><span class=lnt id=hl-26-125><a class=lnlinks href=#hl-26-125>125</a>
</span><span class=lnt id=hl-26-126><a class=lnlinks href=#hl-26-126>126</a>
</span><span class=lnt id=hl-26-127><a class=lnlinks href=#hl-26-127>127</a>
</span><span class=lnt id=hl-26-128><a class=lnlinks href=#hl-26-128>128</a>
</span><span class=lnt id=hl-26-129><a class=lnlinks href=#hl-26-129>129</a>
</span><span class=lnt id=hl-26-130><a class=lnlinks href=#hl-26-130>130</a>
</span><span class=lnt id=hl-26-131><a class=lnlinks href=#hl-26-131>131</a>
</span><span class=lnt id=hl-26-132><a class=lnlinks href=#hl-26-132>132</a>
</span><span class=lnt id=hl-26-133><a class=lnlinks href=#hl-26-133>133</a>
</span><span class=lnt id=hl-26-134><a class=lnlinks href=#hl-26-134>134</a>
</span><span class=lnt id=hl-26-135><a class=lnlinks href=#hl-26-135>135</a>
</span><span class=lnt id=hl-26-136><a class=lnlinks href=#hl-26-136>136</a>
</span><span class=lnt id=hl-26-137><a class=lnlinks href=#hl-26-137>137</a>
</span><span class=lnt id=hl-26-138><a class=lnlinks href=#hl-26-138>138</a>
</span><span class=lnt id=hl-26-139><a class=lnlinks href=#hl-26-139>139</a>
</span><span class=lnt id=hl-26-140><a class=lnlinks href=#hl-26-140>140</a>
</span><span class=lnt id=hl-26-141><a class=lnlinks href=#hl-26-141>141</a>
</span><span class=lnt id=hl-26-142><a class=lnlinks href=#hl-26-142>142</a>
</span><span class=lnt id=hl-26-143><a class=lnlinks href=#hl-26-143>143</a>
</span><span class=lnt id=hl-26-144><a class=lnlinks href=#hl-26-144>144</a>
</span><span class=lnt id=hl-26-145><a class=lnlinks href=#hl-26-145>145</a>
</span><span class=lnt id=hl-26-146><a class=lnlinks href=#hl-26-146>146</a>
</span><span class=lnt id=hl-26-147><a class=lnlinks href=#hl-26-147>147</a>
</span><span class=lnt id=hl-26-148><a class=lnlinks href=#hl-26-148>148</a>
</span><span class=lnt id=hl-26-149><a class=lnlinks href=#hl-26-149>149</a>
</span><span class=lnt id=hl-26-150><a class=lnlinks href=#hl-26-150>150</a>
</span><span class=lnt id=hl-26-151><a class=lnlinks href=#hl-26-151>151</a>
</span><span class=lnt id=hl-26-152><a class=lnlinks href=#hl-26-152>152</a>
</span><span class=lnt id=hl-26-153><a class=lnlinks href=#hl-26-153>153</a>
</span><span class=lnt id=hl-26-154><a class=lnlinks href=#hl-26-154>154</a>
</span><span class=lnt id=hl-26-155><a class=lnlinks href=#hl-26-155>155</a>
</span><span class=lnt id=hl-26-156><a class=lnlinks href=#hl-26-156>156</a>
</span><span class=lnt id=hl-26-157><a class=lnlinks href=#hl-26-157>157</a>
</span><span class=lnt id=hl-26-158><a class=lnlinks href=#hl-26-158>158</a>
</span><span class=lnt id=hl-26-159><a class=lnlinks href=#hl-26-159>159</a>
</span><span class=lnt id=hl-26-160><a class=lnlinks href=#hl-26-160>160</a>
</span><span class=lnt id=hl-26-161><a class=lnlinks href=#hl-26-161>161</a>
</span><span class=lnt id=hl-26-162><a class=lnlinks href=#hl-26-162>162</a>
</span><span class=lnt id=hl-26-163><a class=lnlinks href=#hl-26-163>163</a>
</span><span class=lnt id=hl-26-164><a class=lnlinks href=#hl-26-164>164</a>
</span><span class=lnt id=hl-26-165><a class=lnlinks href=#hl-26-165>165</a>
</span><span class=lnt id=hl-26-166><a class=lnlinks href=#hl-26-166>166</a>
</span><span class=lnt id=hl-26-167><a class=lnlinks href=#hl-26-167>167</a>
</span><span class=lnt id=hl-26-168><a class=lnlinks href=#hl-26-168>168</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/files&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>FileProcessingController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>FileProcessingService</span><span class=w> </span><span class=n>fileService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>FileRepository</span><span class=w> </span><span class=n>fileRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/convert&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>FileConversionResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>convertFile</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=s>&#34;file&#34;</span><span class=p>)</span><span class=w> </span><span class=n>MultipartFile</span><span class=w> </span><span class=n>file</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=s>&#34;targetFormat&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>targetFormat</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 입력 파일 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>sourceFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>file</span><span class=p>.</span><span class=na>getOriginalFilename</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>sourceContentType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>file</span><span class=p>.</span><span class=na>getContentType</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>sourceFilePath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fileService</span><span class=p>.</span><span class=na>saveUploadedFile</span><span class=p>(</span><span class=n>file</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 변환 작업 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>conversionId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>FileConversion</span><span class=w> </span><span class=n>conversion</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FileConversion</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>conversionId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>sourceFileName</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>sourceContentType</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>sourceFilePath</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>targetFormat</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>FileConversionStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>fileRepository</span><span class=p>.</span><span class=na>saveConversion</span><span class=p>(</span><span class=n>conversion</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 비동기 변환 작업 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>fileService</span><span class=p>.</span><span class=na>convertFileAsync</span><span class=p>(</span><span class=n>conversionId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 즉시 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>FileConversionResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>conversionId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;PENDING&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;/api/files/conversions/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>conversionId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>FileConversionResponse</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s>&#34;ERROR&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/conversions/{conversionId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>FileConversionStatusResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getConversionStatus</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>conversionId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>FileConversion</span><span class=w> </span><span class=n>conversion</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fileRepository</span><span class=p>.</span><span class=na>findConversionById</span><span class=p>(</span><span class=n>conversionId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>conversion</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>FileConversionStatusResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FileConversionStatusResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>conversion</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>conversion</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>conversion</span><span class=p>.</span><span class=na>getProgress</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>conversion</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 변환이 완료된 경우 다운로드 URL 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>conversion</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>FileConversionStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>response</span><span class=p>.</span><span class=na>setDownloadUrl</span><span class=p>(</span><span class=s>&#34;/api/files/download/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>conversion</span><span class=p>.</span><span class=na>getOutputFileId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/download/{fileId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Resource</span><span class=o>&gt;</span><span class=w> </span><span class=nf>downloadFile</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>fileId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StoredFile</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fileRepository</span><span class=p>.</span><span class=na>findFileById</span><span class=p>(</span><span class=n>fileId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>file</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Resource</span><span class=w> </span><span class=n>resource</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fileService</span><span class=p>.</span><span class=na>loadFileAsResource</span><span class=p>(</span><span class=n>file</span><span class=p>.</span><span class=na>getFilePath</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>contentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>parseMediaType</span><span class=p>(</span><span class=n>file</span><span class=p>.</span><span class=na>getContentType</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>header</span><span class=p>(</span><span class=n>HttpHeaders</span><span class=p>.</span><span class=na>CONTENT_DISPOSITION</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;attachment; filename=\&#34;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>file</span><span class=p>.</span><span class=na>getFileName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;\&#34;&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>resource</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>FileProcessingService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>FileRepository</span><span class=w> </span><span class=n>fileRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ProgressTracker</span><span class=w> </span><span class=n>progressTracker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>convertFileAsync</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>conversionId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executorService</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 변환 작업 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>FileConversion</span><span class=w> </span><span class=n>conversion</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fileRepository</span><span class=p>.</span><span class=na>findConversionById</span><span class=p>(</span><span class=n>conversionId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>conversion</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>fileRepository</span><span class=p>.</span><span class=na>updateConversionStatus</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>conversionId</span><span class=p>,</span><span class=w> </span><span class=n>FileConversionStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 진행 상황 추적을 위한 리스너 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ProgressListener</span><span class=w> </span><span class=n>progressListener</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>progress</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>progressTracker</span><span class=p>.</span><span class=na>updateProgress</span><span class=p>(</span><span class=n>conversionId</span><span class=p>,</span><span class=w> </span><span class=n>progress</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 파일 변환 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>outputFilePath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>convertFile</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>conversion</span><span class=p>.</span><span class=na>getSourceFilePath</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>conversion</span><span class=p>.</span><span class=na>getTargetFormat</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>progressListener</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 결과 파일 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>outputFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>generateOutputFileName</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>conversion</span><span class=p>.</span><span class=na>getSourceFileName</span><span class=p>(),</span><span class=w> </span><span class=n>conversion</span><span class=p>.</span><span class=na>getTargetFormat</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>outputContentType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>determineContentType</span><span class=p>(</span><span class=n>conversion</span><span class=p>.</span><span class=na>getTargetFormat</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>outputFileId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>StoredFile</span><span class=w> </span><span class=n>outputFile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StoredFile</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>outputFileId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>outputFileName</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>outputContentType</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>outputFilePath</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>fileRepository</span><span class=p>.</span><span class=na>saveFile</span><span class=p>(</span><span class=n>outputFile</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 변환 완료 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>fileRepository</span><span class=p>.</span><span class=na>completeConversion</span><span class=p>(</span><span class=n>conversionId</span><span class=p>,</span><span class=w> </span><span class=n>outputFileId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 변환 실패 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>fileRepository</span><span class=p>.</span><span class=na>failConversion</span><span class=p>(</span><span class=n>conversionId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>convertFile</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>sourceFilePath</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>targetFormat</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ProgressListener</span><span class=w> </span><span class=n>progressListener</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 실제 파일 변환 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// (예: FFmpeg, ImageMagick, Apache POI 등을 사용한 변환)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 파일 형식에 따른 적절한 변환기 선택</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>FileConverter</span><span class=w> </span><span class=n>converter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getConverterForFormat</span><span class=p>(</span><span class=n>targetFormat</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 변환 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>converter</span><span class=p>.</span><span class=na>convert</span><span class=p>(</span><span class=n>sourceFilePath</span><span class=p>,</span><span class=w> </span><span class=n>targetFormat</span><span class=p>,</span><span class=w> </span><span class=n>progressListener</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 기타 헬퍼 메서드…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=데이터-분석-및-보고서-생성>데이터 분석 및 보고서 생성<a hidden class=anchor aria-hidden=true href=#데이터-분석-및-보고서-생성>#</a></h4><p>대량의 데이터를 처리하고 보고서를 생성하는 비동기 API 예시.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1>  1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2>  2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3>  3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4>  4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5>  5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6>  6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7>  7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8>  8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9>  9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10> 10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11> 11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12> 12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13> 13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14> 14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15> 15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16> 16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17> 17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18> 18</a>
</span><span class=lnt id=hl-27-19><a class=lnlinks href=#hl-27-19> 19</a>
</span><span class=lnt id=hl-27-20><a class=lnlinks href=#hl-27-20> 20</a>
</span><span class=lnt id=hl-27-21><a class=lnlinks href=#hl-27-21> 21</a>
</span><span class=lnt id=hl-27-22><a class=lnlinks href=#hl-27-22> 22</a>
</span><span class=lnt id=hl-27-23><a class=lnlinks href=#hl-27-23> 23</a>
</span><span class=lnt id=hl-27-24><a class=lnlinks href=#hl-27-24> 24</a>
</span><span class=lnt id=hl-27-25><a class=lnlinks href=#hl-27-25> 25</a>
</span><span class=lnt id=hl-27-26><a class=lnlinks href=#hl-27-26> 26</a>
</span><span class=lnt id=hl-27-27><a class=lnlinks href=#hl-27-27> 27</a>
</span><span class=lnt id=hl-27-28><a class=lnlinks href=#hl-27-28> 28</a>
</span><span class=lnt id=hl-27-29><a class=lnlinks href=#hl-27-29> 29</a>
</span><span class=lnt id=hl-27-30><a class=lnlinks href=#hl-27-30> 30</a>
</span><span class=lnt id=hl-27-31><a class=lnlinks href=#hl-27-31> 31</a>
</span><span class=lnt id=hl-27-32><a class=lnlinks href=#hl-27-32> 32</a>
</span><span class=lnt id=hl-27-33><a class=lnlinks href=#hl-27-33> 33</a>
</span><span class=lnt id=hl-27-34><a class=lnlinks href=#hl-27-34> 34</a>
</span><span class=lnt id=hl-27-35><a class=lnlinks href=#hl-27-35> 35</a>
</span><span class=lnt id=hl-27-36><a class=lnlinks href=#hl-27-36> 36</a>
</span><span class=lnt id=hl-27-37><a class=lnlinks href=#hl-27-37> 37</a>
</span><span class=lnt id=hl-27-38><a class=lnlinks href=#hl-27-38> 38</a>
</span><span class=lnt id=hl-27-39><a class=lnlinks href=#hl-27-39> 39</a>
</span><span class=lnt id=hl-27-40><a class=lnlinks href=#hl-27-40> 40</a>
</span><span class=lnt id=hl-27-41><a class=lnlinks href=#hl-27-41> 41</a>
</span><span class=lnt id=hl-27-42><a class=lnlinks href=#hl-27-42> 42</a>
</span><span class=lnt id=hl-27-43><a class=lnlinks href=#hl-27-43> 43</a>
</span><span class=lnt id=hl-27-44><a class=lnlinks href=#hl-27-44> 44</a>
</span><span class=lnt id=hl-27-45><a class=lnlinks href=#hl-27-45> 45</a>
</span><span class=lnt id=hl-27-46><a class=lnlinks href=#hl-27-46> 46</a>
</span><span class=lnt id=hl-27-47><a class=lnlinks href=#hl-27-47> 47</a>
</span><span class=lnt id=hl-27-48><a class=lnlinks href=#hl-27-48> 48</a>
</span><span class=lnt id=hl-27-49><a class=lnlinks href=#hl-27-49> 49</a>
</span><span class=lnt id=hl-27-50><a class=lnlinks href=#hl-27-50> 50</a>
</span><span class=lnt id=hl-27-51><a class=lnlinks href=#hl-27-51> 51</a>
</span><span class=lnt id=hl-27-52><a class=lnlinks href=#hl-27-52> 52</a>
</span><span class=lnt id=hl-27-53><a class=lnlinks href=#hl-27-53> 53</a>
</span><span class=lnt id=hl-27-54><a class=lnlinks href=#hl-27-54> 54</a>
</span><span class=lnt id=hl-27-55><a class=lnlinks href=#hl-27-55> 55</a>
</span><span class=lnt id=hl-27-56><a class=lnlinks href=#hl-27-56> 56</a>
</span><span class=lnt id=hl-27-57><a class=lnlinks href=#hl-27-57> 57</a>
</span><span class=lnt id=hl-27-58><a class=lnlinks href=#hl-27-58> 58</a>
</span><span class=lnt id=hl-27-59><a class=lnlinks href=#hl-27-59> 59</a>
</span><span class=lnt id=hl-27-60><a class=lnlinks href=#hl-27-60> 60</a>
</span><span class=lnt id=hl-27-61><a class=lnlinks href=#hl-27-61> 61</a>
</span><span class=lnt id=hl-27-62><a class=lnlinks href=#hl-27-62> 62</a>
</span><span class=lnt id=hl-27-63><a class=lnlinks href=#hl-27-63> 63</a>
</span><span class=lnt id=hl-27-64><a class=lnlinks href=#hl-27-64> 64</a>
</span><span class=lnt id=hl-27-65><a class=lnlinks href=#hl-27-65> 65</a>
</span><span class=lnt id=hl-27-66><a class=lnlinks href=#hl-27-66> 66</a>
</span><span class=lnt id=hl-27-67><a class=lnlinks href=#hl-27-67> 67</a>
</span><span class=lnt id=hl-27-68><a class=lnlinks href=#hl-27-68> 68</a>
</span><span class=lnt id=hl-27-69><a class=lnlinks href=#hl-27-69> 69</a>
</span><span class=lnt id=hl-27-70><a class=lnlinks href=#hl-27-70> 70</a>
</span><span class=lnt id=hl-27-71><a class=lnlinks href=#hl-27-71> 71</a>
</span><span class=lnt id=hl-27-72><a class=lnlinks href=#hl-27-72> 72</a>
</span><span class=lnt id=hl-27-73><a class=lnlinks href=#hl-27-73> 73</a>
</span><span class=lnt id=hl-27-74><a class=lnlinks href=#hl-27-74> 74</a>
</span><span class=lnt id=hl-27-75><a class=lnlinks href=#hl-27-75> 75</a>
</span><span class=lnt id=hl-27-76><a class=lnlinks href=#hl-27-76> 76</a>
</span><span class=lnt id=hl-27-77><a class=lnlinks href=#hl-27-77> 77</a>
</span><span class=lnt id=hl-27-78><a class=lnlinks href=#hl-27-78> 78</a>
</span><span class=lnt id=hl-27-79><a class=lnlinks href=#hl-27-79> 79</a>
</span><span class=lnt id=hl-27-80><a class=lnlinks href=#hl-27-80> 80</a>
</span><span class=lnt id=hl-27-81><a class=lnlinks href=#hl-27-81> 81</a>
</span><span class=lnt id=hl-27-82><a class=lnlinks href=#hl-27-82> 82</a>
</span><span class=lnt id=hl-27-83><a class=lnlinks href=#hl-27-83> 83</a>
</span><span class=lnt id=hl-27-84><a class=lnlinks href=#hl-27-84> 84</a>
</span><span class=lnt id=hl-27-85><a class=lnlinks href=#hl-27-85> 85</a>
</span><span class=lnt id=hl-27-86><a class=lnlinks href=#hl-27-86> 86</a>
</span><span class=lnt id=hl-27-87><a class=lnlinks href=#hl-27-87> 87</a>
</span><span class=lnt id=hl-27-88><a class=lnlinks href=#hl-27-88> 88</a>
</span><span class=lnt id=hl-27-89><a class=lnlinks href=#hl-27-89> 89</a>
</span><span class=lnt id=hl-27-90><a class=lnlinks href=#hl-27-90> 90</a>
</span><span class=lnt id=hl-27-91><a class=lnlinks href=#hl-27-91> 91</a>
</span><span class=lnt id=hl-27-92><a class=lnlinks href=#hl-27-92> 92</a>
</span><span class=lnt id=hl-27-93><a class=lnlinks href=#hl-27-93> 93</a>
</span><span class=lnt id=hl-27-94><a class=lnlinks href=#hl-27-94> 94</a>
</span><span class=lnt id=hl-27-95><a class=lnlinks href=#hl-27-95> 95</a>
</span><span class=lnt id=hl-27-96><a class=lnlinks href=#hl-27-96> 96</a>
</span><span class=lnt id=hl-27-97><a class=lnlinks href=#hl-27-97> 97</a>
</span><span class=lnt id=hl-27-98><a class=lnlinks href=#hl-27-98> 98</a>
</span><span class=lnt id=hl-27-99><a class=lnlinks href=#hl-27-99> 99</a>
</span><span class=lnt id=hl-27-100><a class=lnlinks href=#hl-27-100>100</a>
</span><span class=lnt id=hl-27-101><a class=lnlinks href=#hl-27-101>101</a>
</span><span class=lnt id=hl-27-102><a class=lnlinks href=#hl-27-102>102</a>
</span><span class=lnt id=hl-27-103><a class=lnlinks href=#hl-27-103>103</a>
</span><span class=lnt id=hl-27-104><a class=lnlinks href=#hl-27-104>104</a>
</span><span class=lnt id=hl-27-105><a class=lnlinks href=#hl-27-105>105</a>
</span><span class=lnt id=hl-27-106><a class=lnlinks href=#hl-27-106>106</a>
</span><span class=lnt id=hl-27-107><a class=lnlinks href=#hl-27-107>107</a>
</span><span class=lnt id=hl-27-108><a class=lnlinks href=#hl-27-108>108</a>
</span><span class=lnt id=hl-27-109><a class=lnlinks href=#hl-27-109>109</a>
</span><span class=lnt id=hl-27-110><a class=lnlinks href=#hl-27-110>110</a>
</span><span class=lnt id=hl-27-111><a class=lnlinks href=#hl-27-111>111</a>
</span><span class=lnt id=hl-27-112><a class=lnlinks href=#hl-27-112>112</a>
</span><span class=lnt id=hl-27-113><a class=lnlinks href=#hl-27-113>113</a>
</span><span class=lnt id=hl-27-114><a class=lnlinks href=#hl-27-114>114</a>
</span><span class=lnt id=hl-27-115><a class=lnlinks href=#hl-27-115>115</a>
</span><span class=lnt id=hl-27-116><a class=lnlinks href=#hl-27-116>116</a>
</span><span class=lnt id=hl-27-117><a class=lnlinks href=#hl-27-117>117</a>
</span><span class=lnt id=hl-27-118><a class=lnlinks href=#hl-27-118>118</a>
</span><span class=lnt id=hl-27-119><a class=lnlinks href=#hl-27-119>119</a>
</span><span class=lnt id=hl-27-120><a class=lnlinks href=#hl-27-120>120</a>
</span><span class=lnt id=hl-27-121><a class=lnlinks href=#hl-27-121>121</a>
</span><span class=lnt id=hl-27-122><a class=lnlinks href=#hl-27-122>122</a>
</span><span class=lnt id=hl-27-123><a class=lnlinks href=#hl-27-123>123</a>
</span><span class=lnt id=hl-27-124><a class=lnlinks href=#hl-27-124>124</a>
</span><span class=lnt id=hl-27-125><a class=lnlinks href=#hl-27-125>125</a>
</span><span class=lnt id=hl-27-126><a class=lnlinks href=#hl-27-126>126</a>
</span><span class=lnt id=hl-27-127><a class=lnlinks href=#hl-27-127>127</a>
</span><span class=lnt id=hl-27-128><a class=lnlinks href=#hl-27-128>128</a>
</span><span class=lnt id=hl-27-129><a class=lnlinks href=#hl-27-129>129</a>
</span><span class=lnt id=hl-27-130><a class=lnlinks href=#hl-27-130>130</a>
</span><span class=lnt id=hl-27-131><a class=lnlinks href=#hl-27-131>131</a>
</span><span class=lnt id=hl-27-132><a class=lnlinks href=#hl-27-132>132</a>
</span><span class=lnt id=hl-27-133><a class=lnlinks href=#hl-27-133>133</a>
</span><span class=lnt id=hl-27-134><a class=lnlinks href=#hl-27-134>134</a>
</span><span class=lnt id=hl-27-135><a class=lnlinks href=#hl-27-135>135</a>
</span><span class=lnt id=hl-27-136><a class=lnlinks href=#hl-27-136>136</a>
</span><span class=lnt id=hl-27-137><a class=lnlinks href=#hl-27-137>137</a>
</span><span class=lnt id=hl-27-138><a class=lnlinks href=#hl-27-138>138</a>
</span><span class=lnt id=hl-27-139><a class=lnlinks href=#hl-27-139>139</a>
</span><span class=lnt id=hl-27-140><a class=lnlinks href=#hl-27-140>140</a>
</span><span class=lnt id=hl-27-141><a class=lnlinks href=#hl-27-141>141</a>
</span><span class=lnt id=hl-27-142><a class=lnlinks href=#hl-27-142>142</a>
</span><span class=lnt id=hl-27-143><a class=lnlinks href=#hl-27-143>143</a>
</span><span class=lnt id=hl-27-144><a class=lnlinks href=#hl-27-144>144</a>
</span><span class=lnt id=hl-27-145><a class=lnlinks href=#hl-27-145>145</a>
</span><span class=lnt id=hl-27-146><a class=lnlinks href=#hl-27-146>146</a>
</span><span class=lnt id=hl-27-147><a class=lnlinks href=#hl-27-147>147</a>
</span><span class=lnt id=hl-27-148><a class=lnlinks href=#hl-27-148>148</a>
</span><span class=lnt id=hl-27-149><a class=lnlinks href=#hl-27-149>149</a>
</span><span class=lnt id=hl-27-150><a class=lnlinks href=#hl-27-150>150</a>
</span><span class=lnt id=hl-27-151><a class=lnlinks href=#hl-27-151>151</a>
</span><span class=lnt id=hl-27-152><a class=lnlinks href=#hl-27-152>152</a>
</span><span class=lnt id=hl-27-153><a class=lnlinks href=#hl-27-153>153</a>
</span><span class=lnt id=hl-27-154><a class=lnlinks href=#hl-27-154>154</a>
</span><span class=lnt id=hl-27-155><a class=lnlinks href=#hl-27-155>155</a>
</span><span class=lnt id=hl-27-156><a class=lnlinks href=#hl-27-156>156</a>
</span><span class=lnt id=hl-27-157><a class=lnlinks href=#hl-27-157>157</a>
</span><span class=lnt id=hl-27-158><a class=lnlinks href=#hl-27-158>158</a>
</span><span class=lnt id=hl-27-159><a class=lnlinks href=#hl-27-159>159</a>
</span><span class=lnt id=hl-27-160><a class=lnlinks href=#hl-27-160>160</a>
</span><span class=lnt id=hl-27-161><a class=lnlinks href=#hl-27-161>161</a>
</span><span class=lnt id=hl-27-162><a class=lnlinks href=#hl-27-162>162</a>
</span><span class=lnt id=hl-27-163><a class=lnlinks href=#hl-27-163>163</a>
</span><span class=lnt id=hl-27-164><a class=lnlinks href=#hl-27-164>164</a>
</span><span class=lnt id=hl-27-165><a class=lnlinks href=#hl-27-165>165</a>
</span><span class=lnt id=hl-27-166><a class=lnlinks href=#hl-27-166>166</a>
</span><span class=lnt id=hl-27-167><a class=lnlinks href=#hl-27-167>167</a>
</span><span class=lnt id=hl-27-168><a class=lnlinks href=#hl-27-168>168</a>
</span><span class=lnt id=hl-27-169><a class=lnlinks href=#hl-27-169>169</a>
</span><span class=lnt id=hl-27-170><a class=lnlinks href=#hl-27-170>170</a>
</span><span class=lnt id=hl-27-171><a class=lnlinks href=#hl-27-171>171</a>
</span><span class=lnt id=hl-27-172><a class=lnlinks href=#hl-27-172>172</a>
</span><span class=lnt id=hl-27-173><a class=lnlinks href=#hl-27-173>173</a>
</span><span class=lnt id=hl-27-174><a class=lnlinks href=#hl-27-174>174</a>
</span><span class=lnt id=hl-27-175><a class=lnlinks href=#hl-27-175>175</a>
</span><span class=lnt id=hl-27-176><a class=lnlinks href=#hl-27-176>176</a>
</span><span class=lnt id=hl-27-177><a class=lnlinks href=#hl-27-177>177</a>
</span><span class=lnt id=hl-27-178><a class=lnlinks href=#hl-27-178>178</a>
</span><span class=lnt id=hl-27-179><a class=lnlinks href=#hl-27-179>179</a>
</span><span class=lnt id=hl-27-180><a class=lnlinks href=#hl-27-180>180</a>
</span><span class=lnt id=hl-27-181><a class=lnlinks href=#hl-27-181>181</a>
</span><span class=lnt id=hl-27-182><a class=lnlinks href=#hl-27-182>182</a>
</span><span class=lnt id=hl-27-183><a class=lnlinks href=#hl-27-183>183</a>
</span><span class=lnt id=hl-27-184><a class=lnlinks href=#hl-27-184>184</a>
</span><span class=lnt id=hl-27-185><a class=lnlinks href=#hl-27-185>185</a>
</span><span class=lnt id=hl-27-186><a class=lnlinks href=#hl-27-186>186</a>
</span><span class=lnt id=hl-27-187><a class=lnlinks href=#hl-27-187>187</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/reports&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ReportGenerationController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ReportService</span><span class=w> </span><span class=n>reportService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/generate&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ReportGenerationResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>generateReport</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>ReportRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>webhookUrl</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 보고서 작업 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>reportId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>reportService</span><span class=p>.</span><span class=na>initiateReportGeneration</span><span class=p>(</span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>webhookUrl</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 즉시 응답 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>ReportGenerationResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>reportId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;PENDING&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;/api/reports/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>reportId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/{reportId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ReportStatusResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getReportStatus</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>reportId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Report</span><span class=w> </span><span class=n>report</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>reportService</span><span class=p>.</span><span class=na>getReport</span><span class=p>(</span><span class=n>reportId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>report</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ReportStatusResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ReportStatusResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>report</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>report</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>report</span><span class=p>.</span><span class=na>getProgress</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>report</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 보고서가 완료된 경우 다운로드 URL 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>report</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ReportStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>response</span><span class=p>.</span><span class=na>setDownloadUrl</span><span class=p>(</span><span class=s>&#34;/api/reports/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>reportId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;/download&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/{reportId}/download&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Resource</span><span class=o>&gt;</span><span class=w> </span><span class=nf>downloadReport</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>reportId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Report</span><span class=w> </span><span class=n>report</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>reportService</span><span class=p>.</span><span class=na>getReport</span><span class=p>(</span><span class=n>reportId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>report</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>report</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>ReportStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Resource</span><span class=w> </span><span class=n>resource</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>reportService</span><span class=p>.</span><span class=na>getReportFile</span><span class=p>(</span><span class=n>reportId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>contentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_PDF</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>header</span><span class=p>(</span><span class=n>HttpHeaders</span><span class=p>.</span><span class=na>CONTENT_DISPOSITION</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;attachment; filename=\&#34;report_&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>reportId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;.pdf\&#34;&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>resource</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ReportService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ReportRepository</span><span class=w> </span><span class=n>reportRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>DataSourceService</span><span class=w> </span><span class=n>dataSourceService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>WebhookService</span><span class=w> </span><span class=n>webhookService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>initiateReportGeneration</span><span class=p>(</span><span class=n>ReportRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>webhookUrl</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 보고서 ID 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>reportId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 보고서 레코드 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Report</span><span class=w> </span><span class=n>report</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Report</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>reportId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ReportStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>0</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;Initializing report generation&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>webhookUrl</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>reportRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>report</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비동기 보고서 생성 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>generateReportAsync</span><span class=p>(</span><span class=n>reportId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>reportId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>generateReportAsync</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>reportId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executorService</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Report</span><span class=w> </span><span class=n>report</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>reportRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>reportId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>report</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>reportRepository</span><span class=p>.</span><span class=na>updateStatus</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=n>ReportStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>1f</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Collecting data&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 데이터 수집</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ReportData</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>collectReportData</span><span class=p>(</span><span class=n>report</span><span class=p>.</span><span class=na>getRequest</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>reportRepository</span><span class=p>.</span><span class=na>updateProgress</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>4f</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Analyzing data&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 데이터 분석</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>AnalysisResult</span><span class=w> </span><span class=n>analysis</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>analyzeData</span><span class=p>(</span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>reportRepository</span><span class=p>.</span><span class=na>updateProgress</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>7f</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Generating report document&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 보고서 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>reportFilePath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>generateReportDocument</span><span class=p>(</span><span class=n>analysis</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 보고서 완료</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>reportRepository</span><span class=p>.</span><span class=na>completeReport</span><span class=p>(</span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=n>reportFilePath</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 웹훅 URL이 제공된 경우 알림 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>report</span><span class=p>.</span><span class=na>getWebhookUrl</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>webhookService</span><span class=p>.</span><span class=na>sendReportCompletionWebhook</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>report</span><span class=p>.</span><span class=na>getWebhookUrl</span><span class=p>(),</span><span class=w> </span><span class=n>reportId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 보고서 생성 실패 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>reportRepository</span><span class=p>.</span><span class=na>failReport</span><span class=p>(</span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 실패 웹훅 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>report</span><span class=p>.</span><span class=na>getWebhookUrl</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>webhookService</span><span class=p>.</span><span class=na>sendReportFailureWebhook</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>report</span><span class=p>.</span><span class=na>getWebhookUrl</span><span class=p>(),</span><span class=w> </span><span class=n>reportId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>ReportData</span><span class=w> </span><span class=nf>collectReportData</span><span class=p>(</span><span class=n>ReportRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 보고서 유형에 따른 데이터 수집</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getType</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;SALES&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>dataSourceService</span><span class=p>.</span><span class=na>collectSalesData</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>request</span><span class=p>.</span><span class=na>getStartDate</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>request</span><span class=p>.</span><span class=na>getEndDate</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>request</span><span class=p>.</span><span class=na>getFilters</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;INVENTORY&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>dataSourceService</span><span class=p>.</span><span class=na>collectInventoryData</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>request</span><span class=p>.</span><span class=na>getCategories</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>request</span><span class=p>.</span><span class=na>getLocations</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;CUSTOMER&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>dataSourceService</span><span class=p>.</span><span class=na>collectCustomerData</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>request</span><span class=p>.</span><span class=na>getSegments</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>request</span><span class=p>.</span><span class=na>getTimeframe</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;Unsupported report type: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getType</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>AnalysisResult</span><span class=w> </span><span class=nf>analyzeData</span><span class=p>(</span><span class=n>ReportData</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 데이터 분석 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AnalysisResult</span><span class=p>(</span><span class=cm>/* 분석 결과 */</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>generateReportDocument</span><span class=p>(</span><span class=n>AnalysisResult</span><span class=w> </span><span class=n>analysis</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 보고서 문서 생성 로직 (PDF, Excel 등)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;/path/to/report/file.pdf&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 기타 메서드…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=결제-처리>결제 처리<a hidden class=anchor aria-hidden=true href=#결제-처리>#</a></h4><p>결제 처리와 같이 외부 서비스 호출이 필요한 작업에 대한 비동기 API 예시.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1>  1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2>  2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3>  3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4>  4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5>  5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6>  6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7>  7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8>  8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9>  9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10> 10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11> 11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12> 12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13> 13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14> 14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15> 15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16> 16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17> 17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18> 18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19> 19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20> 20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21> 21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22> 22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23> 23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24> 24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25> 25</a>
</span><span class=lnt id=hl-28-26><a class=lnlinks href=#hl-28-26> 26</a>
</span><span class=lnt id=hl-28-27><a class=lnlinks href=#hl-28-27> 27</a>
</span><span class=lnt id=hl-28-28><a class=lnlinks href=#hl-28-28> 28</a>
</span><span class=lnt id=hl-28-29><a class=lnlinks href=#hl-28-29> 29</a>
</span><span class=lnt id=hl-28-30><a class=lnlinks href=#hl-28-30> 30</a>
</span><span class=lnt id=hl-28-31><a class=lnlinks href=#hl-28-31> 31</a>
</span><span class=lnt id=hl-28-32><a class=lnlinks href=#hl-28-32> 32</a>
</span><span class=lnt id=hl-28-33><a class=lnlinks href=#hl-28-33> 33</a>
</span><span class=lnt id=hl-28-34><a class=lnlinks href=#hl-28-34> 34</a>
</span><span class=lnt id=hl-28-35><a class=lnlinks href=#hl-28-35> 35</a>
</span><span class=lnt id=hl-28-36><a class=lnlinks href=#hl-28-36> 36</a>
</span><span class=lnt id=hl-28-37><a class=lnlinks href=#hl-28-37> 37</a>
</span><span class=lnt id=hl-28-38><a class=lnlinks href=#hl-28-38> 38</a>
</span><span class=lnt id=hl-28-39><a class=lnlinks href=#hl-28-39> 39</a>
</span><span class=lnt id=hl-28-40><a class=lnlinks href=#hl-28-40> 40</a>
</span><span class=lnt id=hl-28-41><a class=lnlinks href=#hl-28-41> 41</a>
</span><span class=lnt id=hl-28-42><a class=lnlinks href=#hl-28-42> 42</a>
</span><span class=lnt id=hl-28-43><a class=lnlinks href=#hl-28-43> 43</a>
</span><span class=lnt id=hl-28-44><a class=lnlinks href=#hl-28-44> 44</a>
</span><span class=lnt id=hl-28-45><a class=lnlinks href=#hl-28-45> 45</a>
</span><span class=lnt id=hl-28-46><a class=lnlinks href=#hl-28-46> 46</a>
</span><span class=lnt id=hl-28-47><a class=lnlinks href=#hl-28-47> 47</a>
</span><span class=lnt id=hl-28-48><a class=lnlinks href=#hl-28-48> 48</a>
</span><span class=lnt id=hl-28-49><a class=lnlinks href=#hl-28-49> 49</a>
</span><span class=lnt id=hl-28-50><a class=lnlinks href=#hl-28-50> 50</a>
</span><span class=lnt id=hl-28-51><a class=lnlinks href=#hl-28-51> 51</a>
</span><span class=lnt id=hl-28-52><a class=lnlinks href=#hl-28-52> 52</a>
</span><span class=lnt id=hl-28-53><a class=lnlinks href=#hl-28-53> 53</a>
</span><span class=lnt id=hl-28-54><a class=lnlinks href=#hl-28-54> 54</a>
</span><span class=lnt id=hl-28-55><a class=lnlinks href=#hl-28-55> 55</a>
</span><span class=lnt id=hl-28-56><a class=lnlinks href=#hl-28-56> 56</a>
</span><span class=lnt id=hl-28-57><a class=lnlinks href=#hl-28-57> 57</a>
</span><span class=lnt id=hl-28-58><a class=lnlinks href=#hl-28-58> 58</a>
</span><span class=lnt id=hl-28-59><a class=lnlinks href=#hl-28-59> 59</a>
</span><span class=lnt id=hl-28-60><a class=lnlinks href=#hl-28-60> 60</a>
</span><span class=lnt id=hl-28-61><a class=lnlinks href=#hl-28-61> 61</a>
</span><span class=lnt id=hl-28-62><a class=lnlinks href=#hl-28-62> 62</a>
</span><span class=lnt id=hl-28-63><a class=lnlinks href=#hl-28-63> 63</a>
</span><span class=lnt id=hl-28-64><a class=lnlinks href=#hl-28-64> 64</a>
</span><span class=lnt id=hl-28-65><a class=lnlinks href=#hl-28-65> 65</a>
</span><span class=lnt id=hl-28-66><a class=lnlinks href=#hl-28-66> 66</a>
</span><span class=lnt id=hl-28-67><a class=lnlinks href=#hl-28-67> 67</a>
</span><span class=lnt id=hl-28-68><a class=lnlinks href=#hl-28-68> 68</a>
</span><span class=lnt id=hl-28-69><a class=lnlinks href=#hl-28-69> 69</a>
</span><span class=lnt id=hl-28-70><a class=lnlinks href=#hl-28-70> 70</a>
</span><span class=lnt id=hl-28-71><a class=lnlinks href=#hl-28-71> 71</a>
</span><span class=lnt id=hl-28-72><a class=lnlinks href=#hl-28-72> 72</a>
</span><span class=lnt id=hl-28-73><a class=lnlinks href=#hl-28-73> 73</a>
</span><span class=lnt id=hl-28-74><a class=lnlinks href=#hl-28-74> 74</a>
</span><span class=lnt id=hl-28-75><a class=lnlinks href=#hl-28-75> 75</a>
</span><span class=lnt id=hl-28-76><a class=lnlinks href=#hl-28-76> 76</a>
</span><span class=lnt id=hl-28-77><a class=lnlinks href=#hl-28-77> 77</a>
</span><span class=lnt id=hl-28-78><a class=lnlinks href=#hl-28-78> 78</a>
</span><span class=lnt id=hl-28-79><a class=lnlinks href=#hl-28-79> 79</a>
</span><span class=lnt id=hl-28-80><a class=lnlinks href=#hl-28-80> 80</a>
</span><span class=lnt id=hl-28-81><a class=lnlinks href=#hl-28-81> 81</a>
</span><span class=lnt id=hl-28-82><a class=lnlinks href=#hl-28-82> 82</a>
</span><span class=lnt id=hl-28-83><a class=lnlinks href=#hl-28-83> 83</a>
</span><span class=lnt id=hl-28-84><a class=lnlinks href=#hl-28-84> 84</a>
</span><span class=lnt id=hl-28-85><a class=lnlinks href=#hl-28-85> 85</a>
</span><span class=lnt id=hl-28-86><a class=lnlinks href=#hl-28-86> 86</a>
</span><span class=lnt id=hl-28-87><a class=lnlinks href=#hl-28-87> 87</a>
</span><span class=lnt id=hl-28-88><a class=lnlinks href=#hl-28-88> 88</a>
</span><span class=lnt id=hl-28-89><a class=lnlinks href=#hl-28-89> 89</a>
</span><span class=lnt id=hl-28-90><a class=lnlinks href=#hl-28-90> 90</a>
</span><span class=lnt id=hl-28-91><a class=lnlinks href=#hl-28-91> 91</a>
</span><span class=lnt id=hl-28-92><a class=lnlinks href=#hl-28-92> 92</a>
</span><span class=lnt id=hl-28-93><a class=lnlinks href=#hl-28-93> 93</a>
</span><span class=lnt id=hl-28-94><a class=lnlinks href=#hl-28-94> 94</a>
</span><span class=lnt id=hl-28-95><a class=lnlinks href=#hl-28-95> 95</a>
</span><span class=lnt id=hl-28-96><a class=lnlinks href=#hl-28-96> 96</a>
</span><span class=lnt id=hl-28-97><a class=lnlinks href=#hl-28-97> 97</a>
</span><span class=lnt id=hl-28-98><a class=lnlinks href=#hl-28-98> 98</a>
</span><span class=lnt id=hl-28-99><a class=lnlinks href=#hl-28-99> 99</a>
</span><span class=lnt id=hl-28-100><a class=lnlinks href=#hl-28-100>100</a>
</span><span class=lnt id=hl-28-101><a class=lnlinks href=#hl-28-101>101</a>
</span><span class=lnt id=hl-28-102><a class=lnlinks href=#hl-28-102>102</a>
</span><span class=lnt id=hl-28-103><a class=lnlinks href=#hl-28-103>103</a>
</span><span class=lnt id=hl-28-104><a class=lnlinks href=#hl-28-104>104</a>
</span><span class=lnt id=hl-28-105><a class=lnlinks href=#hl-28-105>105</a>
</span><span class=lnt id=hl-28-106><a class=lnlinks href=#hl-28-106>106</a>
</span><span class=lnt id=hl-28-107><a class=lnlinks href=#hl-28-107>107</a>
</span><span class=lnt id=hl-28-108><a class=lnlinks href=#hl-28-108>108</a>
</span><span class=lnt id=hl-28-109><a class=lnlinks href=#hl-28-109>109</a>
</span><span class=lnt id=hl-28-110><a class=lnlinks href=#hl-28-110>110</a>
</span><span class=lnt id=hl-28-111><a class=lnlinks href=#hl-28-111>111</a>
</span><span class=lnt id=hl-28-112><a class=lnlinks href=#hl-28-112>112</a>
</span><span class=lnt id=hl-28-113><a class=lnlinks href=#hl-28-113>113</a>
</span><span class=lnt id=hl-28-114><a class=lnlinks href=#hl-28-114>114</a>
</span><span class=lnt id=hl-28-115><a class=lnlinks href=#hl-28-115>115</a>
</span><span class=lnt id=hl-28-116><a class=lnlinks href=#hl-28-116>116</a>
</span><span class=lnt id=hl-28-117><a class=lnlinks href=#hl-28-117>117</a>
</span><span class=lnt id=hl-28-118><a class=lnlinks href=#hl-28-118>118</a>
</span><span class=lnt id=hl-28-119><a class=lnlinks href=#hl-28-119>119</a>
</span><span class=lnt id=hl-28-120><a class=lnlinks href=#hl-28-120>120</a>
</span><span class=lnt id=hl-28-121><a class=lnlinks href=#hl-28-121>121</a>
</span><span class=lnt id=hl-28-122><a class=lnlinks href=#hl-28-122>122</a>
</span><span class=lnt id=hl-28-123><a class=lnlinks href=#hl-28-123>123</a>
</span><span class=lnt id=hl-28-124><a class=lnlinks href=#hl-28-124>124</a>
</span><span class=lnt id=hl-28-125><a class=lnlinks href=#hl-28-125>125</a>
</span><span class=lnt id=hl-28-126><a class=lnlinks href=#hl-28-126>126</a>
</span><span class=lnt id=hl-28-127><a class=lnlinks href=#hl-28-127>127</a>
</span><span class=lnt id=hl-28-128><a class=lnlinks href=#hl-28-128>128</a>
</span><span class=lnt id=hl-28-129><a class=lnlinks href=#hl-28-129>129</a>
</span><span class=lnt id=hl-28-130><a class=lnlinks href=#hl-28-130>130</a>
</span><span class=lnt id=hl-28-131><a class=lnlinks href=#hl-28-131>131</a>
</span><span class=lnt id=hl-28-132><a class=lnlinks href=#hl-28-132>132</a>
</span><span class=lnt id=hl-28-133><a class=lnlinks href=#hl-28-133>133</a>
</span><span class=lnt id=hl-28-134><a class=lnlinks href=#hl-28-134>134</a>
</span><span class=lnt id=hl-28-135><a class=lnlinks href=#hl-28-135>135</a>
</span><span class=lnt id=hl-28-136><a class=lnlinks href=#hl-28-136>136</a>
</span><span class=lnt id=hl-28-137><a class=lnlinks href=#hl-28-137>137</a>
</span><span class=lnt id=hl-28-138><a class=lnlinks href=#hl-28-138>138</a>
</span><span class=lnt id=hl-28-139><a class=lnlinks href=#hl-28-139>139</a>
</span><span class=lnt id=hl-28-140><a class=lnlinks href=#hl-28-140>140</a>
</span><span class=lnt id=hl-28-141><a class=lnlinks href=#hl-28-141>141</a>
</span><span class=lnt id=hl-28-142><a class=lnlinks href=#hl-28-142>142</a>
</span><span class=lnt id=hl-28-143><a class=lnlinks href=#hl-28-143>143</a>
</span><span class=lnt id=hl-28-144><a class=lnlinks href=#hl-28-144>144</a>
</span><span class=lnt id=hl-28-145><a class=lnlinks href=#hl-28-145>145</a>
</span><span class=lnt id=hl-28-146><a class=lnlinks href=#hl-28-146>146</a>
</span><span class=lnt id=hl-28-147><a class=lnlinks href=#hl-28-147>147</a>
</span><span class=lnt id=hl-28-148><a class=lnlinks href=#hl-28-148>148</a>
</span><span class=lnt id=hl-28-149><a class=lnlinks href=#hl-28-149>149</a>
</span><span class=lnt id=hl-28-150><a class=lnlinks href=#hl-28-150>150</a>
</span><span class=lnt id=hl-28-151><a class=lnlinks href=#hl-28-151>151</a>
</span><span class=lnt id=hl-28-152><a class=lnlinks href=#hl-28-152>152</a>
</span><span class=lnt id=hl-28-153><a class=lnlinks href=#hl-28-153>153</a>
</span><span class=lnt id=hl-28-154><a class=lnlinks href=#hl-28-154>154</a>
</span><span class=lnt id=hl-28-155><a class=lnlinks href=#hl-28-155>155</a>
</span><span class=lnt id=hl-28-156><a class=lnlinks href=#hl-28-156>156</a>
</span><span class=lnt id=hl-28-157><a class=lnlinks href=#hl-28-157>157</a>
</span><span class=lnt id=hl-28-158><a class=lnlinks href=#hl-28-158>158</a>
</span><span class=lnt id=hl-28-159><a class=lnlinks href=#hl-28-159>159</a>
</span><span class=lnt id=hl-28-160><a class=lnlinks href=#hl-28-160>160</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/payments&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PaymentController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PaymentService</span><span class=w> </span><span class=n>paymentService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>PaymentResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>processPayment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>PaymentRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestHeader</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Idempotency-Key&#34;</span><span class=p>,</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>idempotencyKey</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 멱등성 키로 기존 요청 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Payment</span><span class=w> </span><span class=n>existingPayment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentService</span><span class=p>.</span><span class=na>findByIdempotencyKey</span><span class=p>(</span><span class=n>idempotencyKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>existingPayment</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 기존 응답 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>existingPayment</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>PaymentStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=w> </span><span class=o>?</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>OK</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>ACCEPTED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>mapToResponse</span><span class=p>(</span><span class=n>existingPayment</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 결제 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentService</span><span class=p>.</span><span class=na>initiatePayment</span><span class=p>(</span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>idempotencyKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 즉시 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>PaymentResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>paymentId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;PROCESSING&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;/api/payments/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>paymentId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/{paymentId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>PaymentResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getPaymentStatus</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Payment</span><span class=w> </span><span class=n>payment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentService</span><span class=p>.</span><span class=na>getPayment</span><span class=p>(</span><span class=n>paymentId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>payment</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>mapToResponse</span><span class=p>(</span><span class=n>payment</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>PaymentResponse</span><span class=w> </span><span class=nf>mapToResponse</span><span class=p>(</span><span class=n>Payment</span><span class=w> </span><span class=n>payment</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PaymentResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PaymentResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>payment</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>payment</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;/api/payments/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>payment</span><span class=p>.</span><span class=na>getId</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>payment</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>PaymentStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>response</span><span class=p>.</span><span class=na>setTransactionId</span><span class=p>(</span><span class=n>payment</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>response</span><span class=p>.</span><span class=na>setCompletedAt</span><span class=p>(</span><span class=n>payment</span><span class=p>.</span><span class=na>getCompletedAt</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>payment</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>PaymentStatus</span><span class=p>.</span><span class=na>FAILED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>response</span><span class=p>.</span><span class=na>setError</span><span class=p>(</span><span class=n>payment</span><span class=p>.</span><span class=na>getErrorMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>response</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PaymentService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PaymentRepository</span><span class=w> </span><span class=n>paymentRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PaymentGateway</span><span class=w> </span><span class=n>paymentGateway</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>NotificationService</span><span class=w> </span><span class=n>notificationService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>initiatePayment</span><span class=p>(</span><span class=n>PaymentRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>idempotencyKey</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 결제 ID 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 결제 레코드 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Payment</span><span class=w> </span><span class=n>payment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Payment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>paymentId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PaymentStatus</span><span class=p>.</span><span class=na>PROCESSING</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>idempotencyKey</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>payment</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비동기 결제 처리 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>processPaymentAsync</span><span class=p>(</span><span class=n>paymentId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>paymentId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processPaymentAsync</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executorService</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Payment</span><span class=w> </span><span class=n>payment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>paymentId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>payment</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 결제 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>PaymentResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paymentGateway</span><span class=p>.</span><span class=na>processPayment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>payment</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>payment</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getCurrency</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>payment</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getPaymentMethod</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>payment</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getCustomerInfo</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>isSuccessful</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 결제 성공 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>completePayment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>paymentId</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>result</span><span class=p>.</span><span class=na>getTransactionId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>result</span><span class=p>.</span><span class=na>getAuthorizationCode</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 알림 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>notificationService</span><span class=p>.</span><span class=na>sendPaymentSuccessNotification</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>payment</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getCustomerId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>payment</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>payment</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getCurrency</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 결제 실패 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>failPayment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>paymentId</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>result</span><span class=p>.</span><span class=na>getErrorCode</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>result</span><span class=p>.</span><span class=na>getErrorMessage</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 실패 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>notificationService</span><span class=p>.</span><span class=na>sendPaymentFailureNotification</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>payment</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getCustomerId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>payment</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>result</span><span class=p>.</span><span class=na>getErrorMessage</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 처리 오류 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>failPayment</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>paymentId</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;PROCESSING_ERROR&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 오류 알림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>notificationService</span><span class=p>.</span><span class=na>sendPaymentErrorNotification</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>payment</span><span class=p>.</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getCustomerId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Payment</span><span class=w> </span><span class=nf>findByIdempotencyKey</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>idempotencyKey</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>findByIdempotencyKey</span><span class=p>(</span><span class=n>idempotencyKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Payment</span><span class=w> </span><span class=nf>getPayment</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>paymentRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>paymentId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=비동기식-api의-모범-사례>비동기식 API의 모범 사례<a hidden class=anchor aria-hidden=true href=#비동기식-api의-모범-사례>#</a></h3><p>효과적인 비동기식 API를 설계하고 구현하기 위한 모범 사례</p><h4 id=명확한-api-계약-및-문서화>명확한 API 계약 및 문서화<a hidden class=anchor aria-hidden=true href=#명확한-api-계약-및-문서화>#</a></h4><p>비동기 API의 동작을 명확하게 문서화하는 것이 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1>  1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2>  2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3>  3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4>  4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5>  5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6>  6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7>  7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8>  8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9>  9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10> 10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11> 11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12> 12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13> 13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14> 14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15> 15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16> 16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17> 17</a>
</span><span class=lnt id=hl-29-18><a class=lnlinks href=#hl-29-18> 18</a>
</span><span class=lnt id=hl-29-19><a class=lnlinks href=#hl-29-19> 19</a>
</span><span class=lnt id=hl-29-20><a class=lnlinks href=#hl-29-20> 20</a>
</span><span class=lnt id=hl-29-21><a class=lnlinks href=#hl-29-21> 21</a>
</span><span class=lnt id=hl-29-22><a class=lnlinks href=#hl-29-22> 22</a>
</span><span class=lnt id=hl-29-23><a class=lnlinks href=#hl-29-23> 23</a>
</span><span class=lnt id=hl-29-24><a class=lnlinks href=#hl-29-24> 24</a>
</span><span class=lnt id=hl-29-25><a class=lnlinks href=#hl-29-25> 25</a>
</span><span class=lnt id=hl-29-26><a class=lnlinks href=#hl-29-26> 26</a>
</span><span class=lnt id=hl-29-27><a class=lnlinks href=#hl-29-27> 27</a>
</span><span class=lnt id=hl-29-28><a class=lnlinks href=#hl-29-28> 28</a>
</span><span class=lnt id=hl-29-29><a class=lnlinks href=#hl-29-29> 29</a>
</span><span class=lnt id=hl-29-30><a class=lnlinks href=#hl-29-30> 30</a>
</span><span class=lnt id=hl-29-31><a class=lnlinks href=#hl-29-31> 31</a>
</span><span class=lnt id=hl-29-32><a class=lnlinks href=#hl-29-32> 32</a>
</span><span class=lnt id=hl-29-33><a class=lnlinks href=#hl-29-33> 33</a>
</span><span class=lnt id=hl-29-34><a class=lnlinks href=#hl-29-34> 34</a>
</span><span class=lnt id=hl-29-35><a class=lnlinks href=#hl-29-35> 35</a>
</span><span class=lnt id=hl-29-36><a class=lnlinks href=#hl-29-36> 36</a>
</span><span class=lnt id=hl-29-37><a class=lnlinks href=#hl-29-37> 37</a>
</span><span class=lnt id=hl-29-38><a class=lnlinks href=#hl-29-38> 38</a>
</span><span class=lnt id=hl-29-39><a class=lnlinks href=#hl-29-39> 39</a>
</span><span class=lnt id=hl-29-40><a class=lnlinks href=#hl-29-40> 40</a>
</span><span class=lnt id=hl-29-41><a class=lnlinks href=#hl-29-41> 41</a>
</span><span class=lnt id=hl-29-42><a class=lnlinks href=#hl-29-42> 42</a>
</span><span class=lnt id=hl-29-43><a class=lnlinks href=#hl-29-43> 43</a>
</span><span class=lnt id=hl-29-44><a class=lnlinks href=#hl-29-44> 44</a>
</span><span class=lnt id=hl-29-45><a class=lnlinks href=#hl-29-45> 45</a>
</span><span class=lnt id=hl-29-46><a class=lnlinks href=#hl-29-46> 46</a>
</span><span class=lnt id=hl-29-47><a class=lnlinks href=#hl-29-47> 47</a>
</span><span class=lnt id=hl-29-48><a class=lnlinks href=#hl-29-48> 48</a>
</span><span class=lnt id=hl-29-49><a class=lnlinks href=#hl-29-49> 49</a>
</span><span class=lnt id=hl-29-50><a class=lnlinks href=#hl-29-50> 50</a>
</span><span class=lnt id=hl-29-51><a class=lnlinks href=#hl-29-51> 51</a>
</span><span class=lnt id=hl-29-52><a class=lnlinks href=#hl-29-52> 52</a>
</span><span class=lnt id=hl-29-53><a class=lnlinks href=#hl-29-53> 53</a>
</span><span class=lnt id=hl-29-54><a class=lnlinks href=#hl-29-54> 54</a>
</span><span class=lnt id=hl-29-55><a class=lnlinks href=#hl-29-55> 55</a>
</span><span class=lnt id=hl-29-56><a class=lnlinks href=#hl-29-56> 56</a>
</span><span class=lnt id=hl-29-57><a class=lnlinks href=#hl-29-57> 57</a>
</span><span class=lnt id=hl-29-58><a class=lnlinks href=#hl-29-58> 58</a>
</span><span class=lnt id=hl-29-59><a class=lnlinks href=#hl-29-59> 59</a>
</span><span class=lnt id=hl-29-60><a class=lnlinks href=#hl-29-60> 60</a>
</span><span class=lnt id=hl-29-61><a class=lnlinks href=#hl-29-61> 61</a>
</span><span class=lnt id=hl-29-62><a class=lnlinks href=#hl-29-62> 62</a>
</span><span class=lnt id=hl-29-63><a class=lnlinks href=#hl-29-63> 63</a>
</span><span class=lnt id=hl-29-64><a class=lnlinks href=#hl-29-64> 64</a>
</span><span class=lnt id=hl-29-65><a class=lnlinks href=#hl-29-65> 65</a>
</span><span class=lnt id=hl-29-66><a class=lnlinks href=#hl-29-66> 66</a>
</span><span class=lnt id=hl-29-67><a class=lnlinks href=#hl-29-67> 67</a>
</span><span class=lnt id=hl-29-68><a class=lnlinks href=#hl-29-68> 68</a>
</span><span class=lnt id=hl-29-69><a class=lnlinks href=#hl-29-69> 69</a>
</span><span class=lnt id=hl-29-70><a class=lnlinks href=#hl-29-70> 70</a>
</span><span class=lnt id=hl-29-71><a class=lnlinks href=#hl-29-71> 71</a>
</span><span class=lnt id=hl-29-72><a class=lnlinks href=#hl-29-72> 72</a>
</span><span class=lnt id=hl-29-73><a class=lnlinks href=#hl-29-73> 73</a>
</span><span class=lnt id=hl-29-74><a class=lnlinks href=#hl-29-74> 74</a>
</span><span class=lnt id=hl-29-75><a class=lnlinks href=#hl-29-75> 75</a>
</span><span class=lnt id=hl-29-76><a class=lnlinks href=#hl-29-76> 76</a>
</span><span class=lnt id=hl-29-77><a class=lnlinks href=#hl-29-77> 77</a>
</span><span class=lnt id=hl-29-78><a class=lnlinks href=#hl-29-78> 78</a>
</span><span class=lnt id=hl-29-79><a class=lnlinks href=#hl-29-79> 79</a>
</span><span class=lnt id=hl-29-80><a class=lnlinks href=#hl-29-80> 80</a>
</span><span class=lnt id=hl-29-81><a class=lnlinks href=#hl-29-81> 81</a>
</span><span class=lnt id=hl-29-82><a class=lnlinks href=#hl-29-82> 82</a>
</span><span class=lnt id=hl-29-83><a class=lnlinks href=#hl-29-83> 83</a>
</span><span class=lnt id=hl-29-84><a class=lnlinks href=#hl-29-84> 84</a>
</span><span class=lnt id=hl-29-85><a class=lnlinks href=#hl-29-85> 85</a>
</span><span class=lnt id=hl-29-86><a class=lnlinks href=#hl-29-86> 86</a>
</span><span class=lnt id=hl-29-87><a class=lnlinks href=#hl-29-87> 87</a>
</span><span class=lnt id=hl-29-88><a class=lnlinks href=#hl-29-88> 88</a>
</span><span class=lnt id=hl-29-89><a class=lnlinks href=#hl-29-89> 89</a>
</span><span class=lnt id=hl-29-90><a class=lnlinks href=#hl-29-90> 90</a>
</span><span class=lnt id=hl-29-91><a class=lnlinks href=#hl-29-91> 91</a>
</span><span class=lnt id=hl-29-92><a class=lnlinks href=#hl-29-92> 92</a>
</span><span class=lnt id=hl-29-93><a class=lnlinks href=#hl-29-93> 93</a>
</span><span class=lnt id=hl-29-94><a class=lnlinks href=#hl-29-94> 94</a>
</span><span class=lnt id=hl-29-95><a class=lnlinks href=#hl-29-95> 95</a>
</span><span class=lnt id=hl-29-96><a class=lnlinks href=#hl-29-96> 96</a>
</span><span class=lnt id=hl-29-97><a class=lnlinks href=#hl-29-97> 97</a>
</span><span class=lnt id=hl-29-98><a class=lnlinks href=#hl-29-98> 98</a>
</span><span class=lnt id=hl-29-99><a class=lnlinks href=#hl-29-99> 99</a>
</span><span class=lnt id=hl-29-100><a class=lnlinks href=#hl-29-100>100</a>
</span><span class=lnt id=hl-29-101><a class=lnlinks href=#hl-29-101>101</a>
</span><span class=lnt id=hl-29-102><a class=lnlinks href=#hl-29-102>102</a>
</span><span class=lnt id=hl-29-103><a class=lnlinks href=#hl-29-103>103</a>
</span><span class=lnt id=hl-29-104><a class=lnlinks href=#hl-29-104>104</a>
</span><span class=lnt id=hl-29-105><a class=lnlinks href=#hl-29-105>105</a>
</span><span class=lnt id=hl-29-106><a class=lnlinks href=#hl-29-106>106</a>
</span><span class=lnt id=hl-29-107><a class=lnlinks href=#hl-29-107>107</a>
</span><span class=lnt id=hl-29-108><a class=lnlinks href=#hl-29-108>108</a>
</span><span class=lnt id=hl-29-109><a class=lnlinks href=#hl-29-109>109</a>
</span><span class=lnt id=hl-29-110><a class=lnlinks href=#hl-29-110>110</a>
</span><span class=lnt id=hl-29-111><a class=lnlinks href=#hl-29-111>111</a>
</span><span class=lnt id=hl-29-112><a class=lnlinks href=#hl-29-112>112</a>
</span><span class=lnt id=hl-29-113><a class=lnlinks href=#hl-29-113>113</a>
</span><span class=lnt id=hl-29-114><a class=lnlinks href=#hl-29-114>114</a>
</span><span class=lnt id=hl-29-115><a class=lnlinks href=#hl-29-115>115</a>
</span><span class=lnt id=hl-29-116><a class=lnlinks href=#hl-29-116>116</a>
</span><span class=lnt id=hl-29-117><a class=lnlinks href=#hl-29-117>117</a>
</span><span class=lnt id=hl-29-118><a class=lnlinks href=#hl-29-118>118</a>
</span><span class=lnt id=hl-29-119><a class=lnlinks href=#hl-29-119>119</a>
</span><span class=lnt id=hl-29-120><a class=lnlinks href=#hl-29-120>120</a>
</span><span class=lnt id=hl-29-121><a class=lnlinks href=#hl-29-121>121</a>
</span><span class=lnt id=hl-29-122><a class=lnlinks href=#hl-29-122>122</a>
</span><span class=lnt id=hl-29-123><a class=lnlinks href=#hl-29-123>123</a>
</span><span class=lnt id=hl-29-124><a class=lnlinks href=#hl-29-124>124</a>
</span><span class=lnt id=hl-29-125><a class=lnlinks href=#hl-29-125>125</a>
</span><span class=lnt id=hl-29-126><a class=lnlinks href=#hl-29-126>126</a>
</span><span class=lnt id=hl-29-127><a class=lnlinks href=#hl-29-127>127</a>
</span><span class=lnt id=hl-29-128><a class=lnlinks href=#hl-29-128>128</a>
</span><span class=lnt id=hl-29-129><a class=lnlinks href=#hl-29-129>129</a>
</span><span class=lnt id=hl-29-130><a class=lnlinks href=#hl-29-130>130</a>
</span><span class=lnt id=hl-29-131><a class=lnlinks href=#hl-29-131>131</a>
</span><span class=lnt id=hl-29-132><a class=lnlinks href=#hl-29-132>132</a>
</span><span class=lnt id=hl-29-133><a class=lnlinks href=#hl-29-133>133</a>
</span><span class=lnt id=hl-29-134><a class=lnlinks href=#hl-29-134>134</a>
</span><span class=lnt id=hl-29-135><a class=lnlinks href=#hl-29-135>135</a>
</span><span class=lnt id=hl-29-136><a class=lnlinks href=#hl-29-136>136</a>
</span><span class=lnt id=hl-29-137><a class=lnlinks href=#hl-29-137>137</a>
</span><span class=lnt id=hl-29-138><a class=lnlinks href=#hl-29-138>138</a>
</span><span class=lnt id=hl-29-139><a class=lnlinks href=#hl-29-139>139</a>
</span><span class=lnt id=hl-29-140><a class=lnlinks href=#hl-29-140>140</a>
</span><span class=lnt id=hl-29-141><a class=lnlinks href=#hl-29-141>141</a>
</span><span class=lnt id=hl-29-142><a class=lnlinks href=#hl-29-142>142</a>
</span><span class=lnt id=hl-29-143><a class=lnlinks href=#hl-29-143>143</a>
</span><span class=lnt id=hl-29-144><a class=lnlinks href=#hl-29-144>144</a>
</span><span class=lnt id=hl-29-145><a class=lnlinks href=#hl-29-145>145</a>
</span><span class=lnt id=hl-29-146><a class=lnlinks href=#hl-29-146>146</a>
</span><span class=lnt id=hl-29-147><a class=lnlinks href=#hl-29-147>147</a>
</span><span class=lnt id=hl-29-148><a class=lnlinks href=#hl-29-148>148</a>
</span><span class=lnt id=hl-29-149><a class=lnlinks href=#hl-29-149>149</a>
</span><span class=lnt id=hl-29-150><a class=lnlinks href=#hl-29-150>150</a>
</span><span class=lnt id=hl-29-151><a class=lnlinks href=#hl-29-151>151</a>
</span><span class=lnt id=hl-29-152><a class=lnlinks href=#hl-29-152>152</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># OpenAPI 명세 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>openapi</span><span class=p>:</span><span class=w> </span><span class=m>3.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>info</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class=l>비동기 파일 변환 API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    대용량 파일을 비동기적으로 변환하기 위한 API입니다.
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    ## 비동기 처리 흐름
</span></span></span><span class=line><span class=cl><span class=sd>    1. 파일을 업로드하고 변환 요청을 제출합니다.
</span></span></span><span class=line><span class=cl><span class=sd>    2. API는 즉시 작업 ID와 함께 202 Accepted 응답을 반환합니다.
</span></span></span><span class=line><span class=cl><span class=sd>    3. 클라이언트는 제공된 상태 URL을 폴링하여 변환 상태를 확인합니다.
</span></span></span><span class=line><span class=cl><span class=sd>    4. 변환이 완료되면 상태 엔드포인트가 다운로드 URL을 제공합니다.
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    ## 웹훅 지원
</span></span></span><span class=line><span class=cl><span class=sd>    웹훅 URL을 제공하면 작업이 완료될 때 알림을 받을 수 있습니다.
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    ## 오류 처리
</span></span></span><span class=line><span class=cl><span class=sd>    작업이 실패하면 상태 엔드포인트에서 오류 정보를 제공합니다.
</span></span></span><span class=line><span class=cl><span class=sd>    
</span></span></span><span class=line><span class=cl><span class=sd>    ## 타임아웃 및 만료
</span></span></span><span class=line><span class=cl><span class=sd>    작업은 최대 24시간 동안 유효하며, 그 이후에는 자동으로 정리됩니다.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>/api/files/convert</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>post</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=l>파일 변환 요청 제출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>파일 업로드 및 변환 작업 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>requestBody</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>content</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>multipart/form-data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>schema</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>object</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=l>binary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>변환할 파일</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>targetFormat</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>대상 파일 형식 (pdf, docx, jpg 등)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>webhookUrl</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=l>uri</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>작업 완료 시 알림을 받을 웹훅 URL (선택 사항)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>required</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>targetFormat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>responses</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#39;202&#39;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>변환 작업이 성공적으로 시작됨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>content</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>application/json</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>schema</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>$ref</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;#/components/schemas/FileConversionResponse&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#39;400&#39;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>잘못된 요청</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>/api/files/conversions/{conversionId}:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>get</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=l>변환 작업 상태 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>conversionId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>in</span><span class=p>:</span><span class=w> </span><span class=l>path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>schema</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>responses</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#39;200&#39;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>현재 변환 상태</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>content</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>application/json</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>schema</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>$ref</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;#/components/schemas/FileConversionStatusResponse&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>examples</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>pending</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>value</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;123e4567-e89b-12d3-a456-426614174000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;PENDING&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>progress</span><span class=p>:</span><span class=w> </span><span class=m>0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Waiting to start&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>processing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>value</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;123e4567-e89b-12d3-a456-426614174000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;PROCESSING&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>progress</span><span class=p>:</span><span class=w> </span><span class=m>0.65</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Converting page 13 of 20&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>completed</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>value</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;123e4567-e89b-12d3-a456-426614174000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;COMPLETED&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>progress</span><span class=p>:</span><span class=w> </span><span class=m>1.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Conversion complete&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>downloadUrl</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/api/files/download/abc123&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>failed</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>value</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;123e4567-e89b-12d3-a456-426614174000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;FAILED&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>progress</span><span class=p>:</span><span class=w> </span><span class=m>0.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Conversion failed: Unsupported file format&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>error</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;UNSUPPORTED_FORMAT&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#39;404&#39;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>변환 작업을 찾을 수 없음</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>components</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>schemas</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>FileConversionResponse</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>object</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>변환 작업 ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>enum</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>PENDING, PROCESSING, COMPLETED, FAILED]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>작업 상태</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>statusUrl</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>상태 확인을 위한 URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>required</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>status</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>statusUrl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>FileConversionStatusResponse</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>object</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>변환 작업 ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>enum</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>PENDING, PROCESSING, COMPLETED, FAILED]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>작업 상태</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>progress</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>number</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=l>float</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>minimum</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>maximum</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>진행률 (0.0 ~ 1.0)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>message</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>상태 메시지</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>downloadUrl</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>완료된 경우 다운로드 URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>error</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>실패한 경우 오류 코드</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>required</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>status</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=견고한-오류-처리>견고한 오류 처리<a hidden class=anchor aria-hidden=true href=#견고한-오류-처리>#</a></h4><p>비동기 API에서는 다양한 오류 상황에 대한 처리가 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1>  1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2>  2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3>  3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4>  4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5>  5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6>  6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7>  7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8>  8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9>  9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10> 10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11> 11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12> 12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13> 13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14> 14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15> 15</a>
</span><span class=lnt id=hl-30-16><a class=lnlinks href=#hl-30-16> 16</a>
</span><span class=lnt id=hl-30-17><a class=lnlinks href=#hl-30-17> 17</a>
</span><span class=lnt id=hl-30-18><a class=lnlinks href=#hl-30-18> 18</a>
</span><span class=lnt id=hl-30-19><a class=lnlinks href=#hl-30-19> 19</a>
</span><span class=lnt id=hl-30-20><a class=lnlinks href=#hl-30-20> 20</a>
</span><span class=lnt id=hl-30-21><a class=lnlinks href=#hl-30-21> 21</a>
</span><span class=lnt id=hl-30-22><a class=lnlinks href=#hl-30-22> 22</a>
</span><span class=lnt id=hl-30-23><a class=lnlinks href=#hl-30-23> 23</a>
</span><span class=lnt id=hl-30-24><a class=lnlinks href=#hl-30-24> 24</a>
</span><span class=lnt id=hl-30-25><a class=lnlinks href=#hl-30-25> 25</a>
</span><span class=lnt id=hl-30-26><a class=lnlinks href=#hl-30-26> 26</a>
</span><span class=lnt id=hl-30-27><a class=lnlinks href=#hl-30-27> 27</a>
</span><span class=lnt id=hl-30-28><a class=lnlinks href=#hl-30-28> 28</a>
</span><span class=lnt id=hl-30-29><a class=lnlinks href=#hl-30-29> 29</a>
</span><span class=lnt id=hl-30-30><a class=lnlinks href=#hl-30-30> 30</a>
</span><span class=lnt id=hl-30-31><a class=lnlinks href=#hl-30-31> 31</a>
</span><span class=lnt id=hl-30-32><a class=lnlinks href=#hl-30-32> 32</a>
</span><span class=lnt id=hl-30-33><a class=lnlinks href=#hl-30-33> 33</a>
</span><span class=lnt id=hl-30-34><a class=lnlinks href=#hl-30-34> 34</a>
</span><span class=lnt id=hl-30-35><a class=lnlinks href=#hl-30-35> 35</a>
</span><span class=lnt id=hl-30-36><a class=lnlinks href=#hl-30-36> 36</a>
</span><span class=lnt id=hl-30-37><a class=lnlinks href=#hl-30-37> 37</a>
</span><span class=lnt id=hl-30-38><a class=lnlinks href=#hl-30-38> 38</a>
</span><span class=lnt id=hl-30-39><a class=lnlinks href=#hl-30-39> 39</a>
</span><span class=lnt id=hl-30-40><a class=lnlinks href=#hl-30-40> 40</a>
</span><span class=lnt id=hl-30-41><a class=lnlinks href=#hl-30-41> 41</a>
</span><span class=lnt id=hl-30-42><a class=lnlinks href=#hl-30-42> 42</a>
</span><span class=lnt id=hl-30-43><a class=lnlinks href=#hl-30-43> 43</a>
</span><span class=lnt id=hl-30-44><a class=lnlinks href=#hl-30-44> 44</a>
</span><span class=lnt id=hl-30-45><a class=lnlinks href=#hl-30-45> 45</a>
</span><span class=lnt id=hl-30-46><a class=lnlinks href=#hl-30-46> 46</a>
</span><span class=lnt id=hl-30-47><a class=lnlinks href=#hl-30-47> 47</a>
</span><span class=lnt id=hl-30-48><a class=lnlinks href=#hl-30-48> 48</a>
</span><span class=lnt id=hl-30-49><a class=lnlinks href=#hl-30-49> 49</a>
</span><span class=lnt id=hl-30-50><a class=lnlinks href=#hl-30-50> 50</a>
</span><span class=lnt id=hl-30-51><a class=lnlinks href=#hl-30-51> 51</a>
</span><span class=lnt id=hl-30-52><a class=lnlinks href=#hl-30-52> 52</a>
</span><span class=lnt id=hl-30-53><a class=lnlinks href=#hl-30-53> 53</a>
</span><span class=lnt id=hl-30-54><a class=lnlinks href=#hl-30-54> 54</a>
</span><span class=lnt id=hl-30-55><a class=lnlinks href=#hl-30-55> 55</a>
</span><span class=lnt id=hl-30-56><a class=lnlinks href=#hl-30-56> 56</a>
</span><span class=lnt id=hl-30-57><a class=lnlinks href=#hl-30-57> 57</a>
</span><span class=lnt id=hl-30-58><a class=lnlinks href=#hl-30-58> 58</a>
</span><span class=lnt id=hl-30-59><a class=lnlinks href=#hl-30-59> 59</a>
</span><span class=lnt id=hl-30-60><a class=lnlinks href=#hl-30-60> 60</a>
</span><span class=lnt id=hl-30-61><a class=lnlinks href=#hl-30-61> 61</a>
</span><span class=lnt id=hl-30-62><a class=lnlinks href=#hl-30-62> 62</a>
</span><span class=lnt id=hl-30-63><a class=lnlinks href=#hl-30-63> 63</a>
</span><span class=lnt id=hl-30-64><a class=lnlinks href=#hl-30-64> 64</a>
</span><span class=lnt id=hl-30-65><a class=lnlinks href=#hl-30-65> 65</a>
</span><span class=lnt id=hl-30-66><a class=lnlinks href=#hl-30-66> 66</a>
</span><span class=lnt id=hl-30-67><a class=lnlinks href=#hl-30-67> 67</a>
</span><span class=lnt id=hl-30-68><a class=lnlinks href=#hl-30-68> 68</a>
</span><span class=lnt id=hl-30-69><a class=lnlinks href=#hl-30-69> 69</a>
</span><span class=lnt id=hl-30-70><a class=lnlinks href=#hl-30-70> 70</a>
</span><span class=lnt id=hl-30-71><a class=lnlinks href=#hl-30-71> 71</a>
</span><span class=lnt id=hl-30-72><a class=lnlinks href=#hl-30-72> 72</a>
</span><span class=lnt id=hl-30-73><a class=lnlinks href=#hl-30-73> 73</a>
</span><span class=lnt id=hl-30-74><a class=lnlinks href=#hl-30-74> 74</a>
</span><span class=lnt id=hl-30-75><a class=lnlinks href=#hl-30-75> 75</a>
</span><span class=lnt id=hl-30-76><a class=lnlinks href=#hl-30-76> 76</a>
</span><span class=lnt id=hl-30-77><a class=lnlinks href=#hl-30-77> 77</a>
</span><span class=lnt id=hl-30-78><a class=lnlinks href=#hl-30-78> 78</a>
</span><span class=lnt id=hl-30-79><a class=lnlinks href=#hl-30-79> 79</a>
</span><span class=lnt id=hl-30-80><a class=lnlinks href=#hl-30-80> 80</a>
</span><span class=lnt id=hl-30-81><a class=lnlinks href=#hl-30-81> 81</a>
</span><span class=lnt id=hl-30-82><a class=lnlinks href=#hl-30-82> 82</a>
</span><span class=lnt id=hl-30-83><a class=lnlinks href=#hl-30-83> 83</a>
</span><span class=lnt id=hl-30-84><a class=lnlinks href=#hl-30-84> 84</a>
</span><span class=lnt id=hl-30-85><a class=lnlinks href=#hl-30-85> 85</a>
</span><span class=lnt id=hl-30-86><a class=lnlinks href=#hl-30-86> 86</a>
</span><span class=lnt id=hl-30-87><a class=lnlinks href=#hl-30-87> 87</a>
</span><span class=lnt id=hl-30-88><a class=lnlinks href=#hl-30-88> 88</a>
</span><span class=lnt id=hl-30-89><a class=lnlinks href=#hl-30-89> 89</a>
</span><span class=lnt id=hl-30-90><a class=lnlinks href=#hl-30-90> 90</a>
</span><span class=lnt id=hl-30-91><a class=lnlinks href=#hl-30-91> 91</a>
</span><span class=lnt id=hl-30-92><a class=lnlinks href=#hl-30-92> 92</a>
</span><span class=lnt id=hl-30-93><a class=lnlinks href=#hl-30-93> 93</a>
</span><span class=lnt id=hl-30-94><a class=lnlinks href=#hl-30-94> 94</a>
</span><span class=lnt id=hl-30-95><a class=lnlinks href=#hl-30-95> 95</a>
</span><span class=lnt id=hl-30-96><a class=lnlinks href=#hl-30-96> 96</a>
</span><span class=lnt id=hl-30-97><a class=lnlinks href=#hl-30-97> 97</a>
</span><span class=lnt id=hl-30-98><a class=lnlinks href=#hl-30-98> 98</a>
</span><span class=lnt id=hl-30-99><a class=lnlinks href=#hl-30-99> 99</a>
</span><span class=lnt id=hl-30-100><a class=lnlinks href=#hl-30-100>100</a>
</span><span class=lnt id=hl-30-101><a class=lnlinks href=#hl-30-101>101</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 오류 처리 패턴 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ControllerAdvice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AsyncApiExceptionHandler</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>ResourceNotFoundException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ErrorResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>handleResourceNotFound</span><span class=p>(</span><span class=n>ResourceNotFoundException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ErrorResponse</span><span class=w> </span><span class=n>error</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;RESOURCE_NOT_FOUND&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>.</span><span class=na>value</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>error</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>InvalidRequestException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ErrorResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>handleInvalidRequest</span><span class=p>(</span><span class=n>InvalidRequestException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ErrorResponse</span><span class=w> </span><span class=n>error</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;INVALID_REQUEST&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>.</span><span class=na>value</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>error</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>ConflictException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ErrorResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>handleConflict</span><span class=p>(</span><span class=n>ConflictException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ErrorResponse</span><span class=w> </span><span class=n>error</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;CONFLICT&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>.</span><span class=na>value</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>error</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>AsyncJobProcessingException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ErrorResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>handleAsyncJobProcessing</span><span class=p>(</span><span class=n>AsyncJobProcessingException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ErrorResponse</span><span class=w> </span><span class=n>error</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ex</span><span class=p>.</span><span class=na>getErrorCode</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>.</span><span class=na>value</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>error</span><span class=p>.</span><span class=na>addDetail</span><span class=p>(</span><span class=s>&#34;jobId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ex</span><span class=p>.</span><span class=na>getJobId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>error</span><span class=p>.</span><span class=na>addDetail</span><span class=p>(</span><span class=s>&#34;jobType&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ex</span><span class=p>.</span><span class=na>getJobType</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>error</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>Exception</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>ErrorResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>handleGenericException</span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ErrorResponse</span><span class=w> </span><span class=n>error</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;INTERNAL_SERVER_ERROR&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;An unexpected error occurred&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>.</span><span class=na>value</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>error</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 비동기 작업 관련 예외</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AsyncJobProcessingException</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>RuntimeException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>errorCode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>AsyncJobProcessingException</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobType</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>errorCode</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>(</span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>jobType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>errorCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>errorCode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 게터 메서드…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 오류 응답 모델</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ErrorResponse</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>details</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>timestamp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ErrorResponse</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>status</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>details</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>timestamp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>addDetail</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>details</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 게터 메서드…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=효율적인-리소스-관리>효율적인 리소스 관리<a hidden class=anchor aria-hidden=true href=#효율적인-리소스-관리>#</a></h4><p>비동기 작업은 시스템 리소스를 효율적으로 관리해야 한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1>  1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2>  2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3>  3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4>  4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5>  5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6>  6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7>  7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8>  8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9>  9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10> 10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11> 11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12> 12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13> 13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14> 14</a>
</span><span class=lnt id=hl-31-15><a class=lnlinks href=#hl-31-15> 15</a>
</span><span class=lnt id=hl-31-16><a class=lnlinks href=#hl-31-16> 16</a>
</span><span class=lnt id=hl-31-17><a class=lnlinks href=#hl-31-17> 17</a>
</span><span class=lnt id=hl-31-18><a class=lnlinks href=#hl-31-18> 18</a>
</span><span class=lnt id=hl-31-19><a class=lnlinks href=#hl-31-19> 19</a>
</span><span class=lnt id=hl-31-20><a class=lnlinks href=#hl-31-20> 20</a>
</span><span class=lnt id=hl-31-21><a class=lnlinks href=#hl-31-21> 21</a>
</span><span class=lnt id=hl-31-22><a class=lnlinks href=#hl-31-22> 22</a>
</span><span class=lnt id=hl-31-23><a class=lnlinks href=#hl-31-23> 23</a>
</span><span class=lnt id=hl-31-24><a class=lnlinks href=#hl-31-24> 24</a>
</span><span class=lnt id=hl-31-25><a class=lnlinks href=#hl-31-25> 25</a>
</span><span class=lnt id=hl-31-26><a class=lnlinks href=#hl-31-26> 26</a>
</span><span class=lnt id=hl-31-27><a class=lnlinks href=#hl-31-27> 27</a>
</span><span class=lnt id=hl-31-28><a class=lnlinks href=#hl-31-28> 28</a>
</span><span class=lnt id=hl-31-29><a class=lnlinks href=#hl-31-29> 29</a>
</span><span class=lnt id=hl-31-30><a class=lnlinks href=#hl-31-30> 30</a>
</span><span class=lnt id=hl-31-31><a class=lnlinks href=#hl-31-31> 31</a>
</span><span class=lnt id=hl-31-32><a class=lnlinks href=#hl-31-32> 32</a>
</span><span class=lnt id=hl-31-33><a class=lnlinks href=#hl-31-33> 33</a>
</span><span class=lnt id=hl-31-34><a class=lnlinks href=#hl-31-34> 34</a>
</span><span class=lnt id=hl-31-35><a class=lnlinks href=#hl-31-35> 35</a>
</span><span class=lnt id=hl-31-36><a class=lnlinks href=#hl-31-36> 36</a>
</span><span class=lnt id=hl-31-37><a class=lnlinks href=#hl-31-37> 37</a>
</span><span class=lnt id=hl-31-38><a class=lnlinks href=#hl-31-38> 38</a>
</span><span class=lnt id=hl-31-39><a class=lnlinks href=#hl-31-39> 39</a>
</span><span class=lnt id=hl-31-40><a class=lnlinks href=#hl-31-40> 40</a>
</span><span class=lnt id=hl-31-41><a class=lnlinks href=#hl-31-41> 41</a>
</span><span class=lnt id=hl-31-42><a class=lnlinks href=#hl-31-42> 42</a>
</span><span class=lnt id=hl-31-43><a class=lnlinks href=#hl-31-43> 43</a>
</span><span class=lnt id=hl-31-44><a class=lnlinks href=#hl-31-44> 44</a>
</span><span class=lnt id=hl-31-45><a class=lnlinks href=#hl-31-45> 45</a>
</span><span class=lnt id=hl-31-46><a class=lnlinks href=#hl-31-46> 46</a>
</span><span class=lnt id=hl-31-47><a class=lnlinks href=#hl-31-47> 47</a>
</span><span class=lnt id=hl-31-48><a class=lnlinks href=#hl-31-48> 48</a>
</span><span class=lnt id=hl-31-49><a class=lnlinks href=#hl-31-49> 49</a>
</span><span class=lnt id=hl-31-50><a class=lnlinks href=#hl-31-50> 50</a>
</span><span class=lnt id=hl-31-51><a class=lnlinks href=#hl-31-51> 51</a>
</span><span class=lnt id=hl-31-52><a class=lnlinks href=#hl-31-52> 52</a>
</span><span class=lnt id=hl-31-53><a class=lnlinks href=#hl-31-53> 53</a>
</span><span class=lnt id=hl-31-54><a class=lnlinks href=#hl-31-54> 54</a>
</span><span class=lnt id=hl-31-55><a class=lnlinks href=#hl-31-55> 55</a>
</span><span class=lnt id=hl-31-56><a class=lnlinks href=#hl-31-56> 56</a>
</span><span class=lnt id=hl-31-57><a class=lnlinks href=#hl-31-57> 57</a>
</span><span class=lnt id=hl-31-58><a class=lnlinks href=#hl-31-58> 58</a>
</span><span class=lnt id=hl-31-59><a class=lnlinks href=#hl-31-59> 59</a>
</span><span class=lnt id=hl-31-60><a class=lnlinks href=#hl-31-60> 60</a>
</span><span class=lnt id=hl-31-61><a class=lnlinks href=#hl-31-61> 61</a>
</span><span class=lnt id=hl-31-62><a class=lnlinks href=#hl-31-62> 62</a>
</span><span class=lnt id=hl-31-63><a class=lnlinks href=#hl-31-63> 63</a>
</span><span class=lnt id=hl-31-64><a class=lnlinks href=#hl-31-64> 64</a>
</span><span class=lnt id=hl-31-65><a class=lnlinks href=#hl-31-65> 65</a>
</span><span class=lnt id=hl-31-66><a class=lnlinks href=#hl-31-66> 66</a>
</span><span class=lnt id=hl-31-67><a class=lnlinks href=#hl-31-67> 67</a>
</span><span class=lnt id=hl-31-68><a class=lnlinks href=#hl-31-68> 68</a>
</span><span class=lnt id=hl-31-69><a class=lnlinks href=#hl-31-69> 69</a>
</span><span class=lnt id=hl-31-70><a class=lnlinks href=#hl-31-70> 70</a>
</span><span class=lnt id=hl-31-71><a class=lnlinks href=#hl-31-71> 71</a>
</span><span class=lnt id=hl-31-72><a class=lnlinks href=#hl-31-72> 72</a>
</span><span class=lnt id=hl-31-73><a class=lnlinks href=#hl-31-73> 73</a>
</span><span class=lnt id=hl-31-74><a class=lnlinks href=#hl-31-74> 74</a>
</span><span class=lnt id=hl-31-75><a class=lnlinks href=#hl-31-75> 75</a>
</span><span class=lnt id=hl-31-76><a class=lnlinks href=#hl-31-76> 76</a>
</span><span class=lnt id=hl-31-77><a class=lnlinks href=#hl-31-77> 77</a>
</span><span class=lnt id=hl-31-78><a class=lnlinks href=#hl-31-78> 78</a>
</span><span class=lnt id=hl-31-79><a class=lnlinks href=#hl-31-79> 79</a>
</span><span class=lnt id=hl-31-80><a class=lnlinks href=#hl-31-80> 80</a>
</span><span class=lnt id=hl-31-81><a class=lnlinks href=#hl-31-81> 81</a>
</span><span class=lnt id=hl-31-82><a class=lnlinks href=#hl-31-82> 82</a>
</span><span class=lnt id=hl-31-83><a class=lnlinks href=#hl-31-83> 83</a>
</span><span class=lnt id=hl-31-84><a class=lnlinks href=#hl-31-84> 84</a>
</span><span class=lnt id=hl-31-85><a class=lnlinks href=#hl-31-85> 85</a>
</span><span class=lnt id=hl-31-86><a class=lnlinks href=#hl-31-86> 86</a>
</span><span class=lnt id=hl-31-87><a class=lnlinks href=#hl-31-87> 87</a>
</span><span class=lnt id=hl-31-88><a class=lnlinks href=#hl-31-88> 88</a>
</span><span class=lnt id=hl-31-89><a class=lnlinks href=#hl-31-89> 89</a>
</span><span class=lnt id=hl-31-90><a class=lnlinks href=#hl-31-90> 90</a>
</span><span class=lnt id=hl-31-91><a class=lnlinks href=#hl-31-91> 91</a>
</span><span class=lnt id=hl-31-92><a class=lnlinks href=#hl-31-92> 92</a>
</span><span class=lnt id=hl-31-93><a class=lnlinks href=#hl-31-93> 93</a>
</span><span class=lnt id=hl-31-94><a class=lnlinks href=#hl-31-94> 94</a>
</span><span class=lnt id=hl-31-95><a class=lnlinks href=#hl-31-95> 95</a>
</span><span class=lnt id=hl-31-96><a class=lnlinks href=#hl-31-96> 96</a>
</span><span class=lnt id=hl-31-97><a class=lnlinks href=#hl-31-97> 97</a>
</span><span class=lnt id=hl-31-98><a class=lnlinks href=#hl-31-98> 98</a>
</span><span class=lnt id=hl-31-99><a class=lnlinks href=#hl-31-99> 99</a>
</span><span class=lnt id=hl-31-100><a class=lnlinks href=#hl-31-100>100</a>
</span><span class=lnt id=hl-31-101><a class=lnlinks href=#hl-31-101>101</a>
</span><span class=lnt id=hl-31-102><a class=lnlinks href=#hl-31-102>102</a>
</span><span class=lnt id=hl-31-103><a class=lnlinks href=#hl-31-103>103</a>
</span><span class=lnt id=hl-31-104><a class=lnlinks href=#hl-31-104>104</a>
</span><span class=lnt id=hl-31-105><a class=lnlinks href=#hl-31-105>105</a>
</span><span class=lnt id=hl-31-106><a class=lnlinks href=#hl-31-106>106</a>
</span><span class=lnt id=hl-31-107><a class=lnlinks href=#hl-31-107>107</a>
</span><span class=lnt id=hl-31-108><a class=lnlinks href=#hl-31-108>108</a>
</span><span class=lnt id=hl-31-109><a class=lnlinks href=#hl-31-109>109</a>
</span><span class=lnt id=hl-31-110><a class=lnlinks href=#hl-31-110>110</a>
</span><span class=lnt id=hl-31-111><a class=lnlinks href=#hl-31-111>111</a>
</span><span class=lnt id=hl-31-112><a class=lnlinks href=#hl-31-112>112</a>
</span><span class=lnt id=hl-31-113><a class=lnlinks href=#hl-31-113>113</a>
</span><span class=lnt id=hl-31-114><a class=lnlinks href=#hl-31-114>114</a>
</span><span class=lnt id=hl-31-115><a class=lnlinks href=#hl-31-115>115</a>
</span><span class=lnt id=hl-31-116><a class=lnlinks href=#hl-31-116>116</a>
</span><span class=lnt id=hl-31-117><a class=lnlinks href=#hl-31-117>117</a>
</span><span class=lnt id=hl-31-118><a class=lnlinks href=#hl-31-118>118</a>
</span><span class=lnt id=hl-31-119><a class=lnlinks href=#hl-31-119>119</a>
</span><span class=lnt id=hl-31-120><a class=lnlinks href=#hl-31-120>120</a>
</span><span class=lnt id=hl-31-121><a class=lnlinks href=#hl-31-121>121</a>
</span><span class=lnt id=hl-31-122><a class=lnlinks href=#hl-31-122>122</a>
</span><span class=lnt id=hl-31-123><a class=lnlinks href=#hl-31-123>123</a>
</span><span class=lnt id=hl-31-124><a class=lnlinks href=#hl-31-124>124</a>
</span><span class=lnt id=hl-31-125><a class=lnlinks href=#hl-31-125>125</a>
</span><span class=lnt id=hl-31-126><a class=lnlinks href=#hl-31-126>126</a>
</span><span class=lnt id=hl-31-127><a class=lnlinks href=#hl-31-127>127</a>
</span><span class=lnt id=hl-31-128><a class=lnlinks href=#hl-31-128>128</a>
</span><span class=lnt id=hl-31-129><a class=lnlinks href=#hl-31-129>129</a>
</span><span class=lnt id=hl-31-130><a class=lnlinks href=#hl-31-130>130</a>
</span><span class=lnt id=hl-31-131><a class=lnlinks href=#hl-31-131>131</a>
</span><span class=lnt id=hl-31-132><a class=lnlinks href=#hl-31-132>132</a>
</span><span class=lnt id=hl-31-133><a class=lnlinks href=#hl-31-133>133</a>
</span><span class=lnt id=hl-31-134><a class=lnlinks href=#hl-31-134>134</a>
</span><span class=lnt id=hl-31-135><a class=lnlinks href=#hl-31-135>135</a>
</span><span class=lnt id=hl-31-136><a class=lnlinks href=#hl-31-136>136</a>
</span><span class=lnt id=hl-31-137><a class=lnlinks href=#hl-31-137>137</a>
</span><span class=lnt id=hl-31-138><a class=lnlinks href=#hl-31-138>138</a>
</span><span class=lnt id=hl-31-139><a class=lnlinks href=#hl-31-139>139</a>
</span><span class=lnt id=hl-31-140><a class=lnlinks href=#hl-31-140>140</a>
</span><span class=lnt id=hl-31-141><a class=lnlinks href=#hl-31-141>141</a>
</span><span class=lnt id=hl-31-142><a class=lnlinks href=#hl-31-142>142</a>
</span><span class=lnt id=hl-31-143><a class=lnlinks href=#hl-31-143>143</a>
</span><span class=lnt id=hl-31-144><a class=lnlinks href=#hl-31-144>144</a>
</span><span class=lnt id=hl-31-145><a class=lnlinks href=#hl-31-145>145</a>
</span><span class=lnt id=hl-31-146><a class=lnlinks href=#hl-31-146>146</a>
</span><span class=lnt id=hl-31-147><a class=lnlinks href=#hl-31-147>147</a>
</span><span class=lnt id=hl-31-148><a class=lnlinks href=#hl-31-148>148</a>
</span><span class=lnt id=hl-31-149><a class=lnlinks href=#hl-31-149>149</a>
</span><span class=lnt id=hl-31-150><a class=lnlinks href=#hl-31-150>150</a>
</span><span class=lnt id=hl-31-151><a class=lnlinks href=#hl-31-151>151</a>
</span><span class=lnt id=hl-31-152><a class=lnlinks href=#hl-31-152>152</a>
</span><span class=lnt id=hl-31-153><a class=lnlinks href=#hl-31-153>153</a>
</span><span class=lnt id=hl-31-154><a class=lnlinks href=#hl-31-154>154</a>
</span><span class=lnt id=hl-31-155><a class=lnlinks href=#hl-31-155>155</a>
</span><span class=lnt id=hl-31-156><a class=lnlinks href=#hl-31-156>156</a>
</span><span class=lnt id=hl-31-157><a class=lnlinks href=#hl-31-157>157</a>
</span><span class=lnt id=hl-31-158><a class=lnlinks href=#hl-31-158>158</a>
</span><span class=lnt id=hl-31-159><a class=lnlinks href=#hl-31-159>159</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 효율적인 스레드 풀 구성 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AsyncTaskExecutorConfig</span><span class=w> </span><span class=p>{</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;taskExecutor&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Executor</span><span class=w> </span><span class=nf>taskExecutor</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ThreadPoolTaskExecutor</span><span class=w> </span><span class=n>executor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ThreadPoolTaskExecutor</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 코어 스레드 수 (항상 유지되는 스레드 수)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setCorePoolSize</span><span class=p>(</span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 최대 스레드 수 (부하가 높을 때)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setMaxPoolSize</span><span class=p>(</span><span class=n>50</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 큐 크기 (대기 작업)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setQueueCapacity</span><span class=p>(</span><span class=n>100</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 유휴 스레드 제거 시간(초)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setKeepAliveSeconds</span><span class=p>(</span><span class=n>60</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 스레드 이름 접두사</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setThreadNamePrefix</span><span class=p>(</span><span class=s>&#34;async-task-&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 큐가 가득 찼을 때 정책: CallerRunsPolicy는 호출 스레드에서 작업 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setRejectedExecutionHandler</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>ThreadPoolExecutor</span><span class=p>.</span><span class=na>CallerRunsPolicy</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 완료 대기 없이 즉시 종료 방지</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setWaitForTasksToCompleteOnShutdown</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 종료 시 최대 대기 시간(초)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setAwaitTerminationSeconds</span><span class=p>(</span><span class=n>60</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>initialize</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>executor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 유형별 별도 스레드 풀</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;fileProcessingExecutor&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Executor</span><span class=w> </span><span class=nf>fileProcessingExecutor</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ThreadPoolTaskExecutor</span><span class=w> </span><span class=n>executor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ThreadPoolTaskExecutor</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setCorePoolSize</span><span class=p>(</span><span class=n>5</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setMaxPoolSize</span><span class=p>(</span><span class=n>20</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setQueueCapacity</span><span class=p>(</span><span class=n>50</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setThreadNamePrefix</span><span class=p>(</span><span class=s>&#34;file-proc-&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>initialize</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>executor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;reportGenerationExecutor&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Executor</span><span class=w> </span><span class=nf>reportGenerationExecutor</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ThreadPoolTaskExecutor</span><span class=w> </span><span class=n>executor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ThreadPoolTaskExecutor</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setCorePoolSize</span><span class=p>(</span><span class=n>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setMaxPoolSize</span><span class=p>(</span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setQueueCapacity</span><span class=p>(</span><span class=n>25</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>setThreadNamePrefix</span><span class=p>(</span><span class=s>&#34;report-gen-&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>initialize</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>executor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 스레드 풀 사용 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ResourceEfficientJobService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Qualifier</span><span class=p>(</span><span class=s>&#34;taskExecutor&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Executor</span><span class=w> </span><span class=n>taskExecutor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Qualifier</span><span class=p>(</span><span class=s>&#34;fileProcessingExecutor&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Executor</span><span class=w> </span><span class=n>fileProcessingExecutor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Qualifier</span><span class=p>(</span><span class=s>&#34;reportGenerationExecutor&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Executor</span><span class=w> </span><span class=n>reportGenerationExecutor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>submitJob</span><span class=p>(</span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 유형에 따라 적절한 스레드 풀 선택</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Executor</span><span class=w> </span><span class=n>selectedExecutor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getType</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;FILE_PROCESSING&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>selectedExecutor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fileProcessingExecutor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s>&#34;REPORT_GENERATION&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>selectedExecutor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>reportGenerationExecutor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>selectedExecutor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>taskExecutor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 선택한 스레드 풀에 작업 제출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>selectedExecutor</span><span class=p>.</span><span class=na>execute</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>processJob</span><span class=p>(</span><span class=n>job</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>handleJobError</span><span class=p>(</span><span class=n>job</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 자원 제한 관리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processJob</span><span class=p>(</span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 작업 유형에 따른 자원 제한 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>memoryLimitMB</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getMemoryLimitForJobType</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getType</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>timeoutSeconds</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getTimeoutForJobType</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getType</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 메모리 사용량 모니터링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MemoryMXBean</span><span class=w> </span><span class=n>memoryBean</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ManagementFactory</span><span class=p>.</span><span class=na>getMemoryMXBean</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MemoryUsage</span><span class=w> </span><span class=n>heapUsage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memoryBean</span><span class=p>.</span><span class=na>getHeapMemoryUsage</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 시간 제한 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>startTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>endTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>startTime</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>timeoutSeconds</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 작업 처리 진행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>job</span><span class=p>.</span><span class=na>isCompleted</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 메모리 사용량 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>heapUsage</span><span class=p>.</span><span class=na>getUsed</span><span class=p>()</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=p>(</span><span class=n>1024</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>1024</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>memoryLimitMB</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResourceLimitExceededException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s>&#34;Memory limit exceeded for job: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 시간 제한 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>endTime</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResourceLimitExceededException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s>&#34;Time limit exceeded for job: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 작업 처리 단계 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>executeNextStep</span><span class=p>(</span><span class=n>job</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 메모리 사용량 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>heapUsage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memoryBean</span><span class=p>.</span><span class=na>getHeapMemoryUsage</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 자원 정리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>cleanupResources</span><span class=p>(</span><span class=n>job</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 자원 정리 메서드</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>cleanupResources</span><span class=p>(</span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 임시 파일 삭제</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>hasTempFiles</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>filePath</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getTempFilePaths</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>Files</span><span class=p>.</span><span class=na>deleteIfExists</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>filePath</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>log</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;Failed to delete temp file: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>filePath</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 기타 자원 정리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=클라이언트-sdk-및-도우미-라이브러리>클라이언트 SDK 및 도우미 라이브러리<a hidden class=anchor aria-hidden=true href=#클라이언트-sdk-및-도우미-라이브러리>#</a></h4><p>비동기 API의 사용성을 향상시키기 위한 클라이언트 SDK 예시.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1>  1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2>  2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3>  3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4>  4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5>  5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6>  6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7>  7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8>  8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9>  9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10> 10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11> 11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12> 12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13> 13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14> 14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15> 15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16> 16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17> 17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18> 18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19> 19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20> 20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21> 21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22> 22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23> 23</a>
</span><span class=lnt id=hl-32-24><a class=lnlinks href=#hl-32-24> 24</a>
</span><span class=lnt id=hl-32-25><a class=lnlinks href=#hl-32-25> 25</a>
</span><span class=lnt id=hl-32-26><a class=lnlinks href=#hl-32-26> 26</a>
</span><span class=lnt id=hl-32-27><a class=lnlinks href=#hl-32-27> 27</a>
</span><span class=lnt id=hl-32-28><a class=lnlinks href=#hl-32-28> 28</a>
</span><span class=lnt id=hl-32-29><a class=lnlinks href=#hl-32-29> 29</a>
</span><span class=lnt id=hl-32-30><a class=lnlinks href=#hl-32-30> 30</a>
</span><span class=lnt id=hl-32-31><a class=lnlinks href=#hl-32-31> 31</a>
</span><span class=lnt id=hl-32-32><a class=lnlinks href=#hl-32-32> 32</a>
</span><span class=lnt id=hl-32-33><a class=lnlinks href=#hl-32-33> 33</a>
</span><span class=lnt id=hl-32-34><a class=lnlinks href=#hl-32-34> 34</a>
</span><span class=lnt id=hl-32-35><a class=lnlinks href=#hl-32-35> 35</a>
</span><span class=lnt id=hl-32-36><a class=lnlinks href=#hl-32-36> 36</a>
</span><span class=lnt id=hl-32-37><a class=lnlinks href=#hl-32-37> 37</a>
</span><span class=lnt id=hl-32-38><a class=lnlinks href=#hl-32-38> 38</a>
</span><span class=lnt id=hl-32-39><a class=lnlinks href=#hl-32-39> 39</a>
</span><span class=lnt id=hl-32-40><a class=lnlinks href=#hl-32-40> 40</a>
</span><span class=lnt id=hl-32-41><a class=lnlinks href=#hl-32-41> 41</a>
</span><span class=lnt id=hl-32-42><a class=lnlinks href=#hl-32-42> 42</a>
</span><span class=lnt id=hl-32-43><a class=lnlinks href=#hl-32-43> 43</a>
</span><span class=lnt id=hl-32-44><a class=lnlinks href=#hl-32-44> 44</a>
</span><span class=lnt id=hl-32-45><a class=lnlinks href=#hl-32-45> 45</a>
</span><span class=lnt id=hl-32-46><a class=lnlinks href=#hl-32-46> 46</a>
</span><span class=lnt id=hl-32-47><a class=lnlinks href=#hl-32-47> 47</a>
</span><span class=lnt id=hl-32-48><a class=lnlinks href=#hl-32-48> 48</a>
</span><span class=lnt id=hl-32-49><a class=lnlinks href=#hl-32-49> 49</a>
</span><span class=lnt id=hl-32-50><a class=lnlinks href=#hl-32-50> 50</a>
</span><span class=lnt id=hl-32-51><a class=lnlinks href=#hl-32-51> 51</a>
</span><span class=lnt id=hl-32-52><a class=lnlinks href=#hl-32-52> 52</a>
</span><span class=lnt id=hl-32-53><a class=lnlinks href=#hl-32-53> 53</a>
</span><span class=lnt id=hl-32-54><a class=lnlinks href=#hl-32-54> 54</a>
</span><span class=lnt id=hl-32-55><a class=lnlinks href=#hl-32-55> 55</a>
</span><span class=lnt id=hl-32-56><a class=lnlinks href=#hl-32-56> 56</a>
</span><span class=lnt id=hl-32-57><a class=lnlinks href=#hl-32-57> 57</a>
</span><span class=lnt id=hl-32-58><a class=lnlinks href=#hl-32-58> 58</a>
</span><span class=lnt id=hl-32-59><a class=lnlinks href=#hl-32-59> 59</a>
</span><span class=lnt id=hl-32-60><a class=lnlinks href=#hl-32-60> 60</a>
</span><span class=lnt id=hl-32-61><a class=lnlinks href=#hl-32-61> 61</a>
</span><span class=lnt id=hl-32-62><a class=lnlinks href=#hl-32-62> 62</a>
</span><span class=lnt id=hl-32-63><a class=lnlinks href=#hl-32-63> 63</a>
</span><span class=lnt id=hl-32-64><a class=lnlinks href=#hl-32-64> 64</a>
</span><span class=lnt id=hl-32-65><a class=lnlinks href=#hl-32-65> 65</a>
</span><span class=lnt id=hl-32-66><a class=lnlinks href=#hl-32-66> 66</a>
</span><span class=lnt id=hl-32-67><a class=lnlinks href=#hl-32-67> 67</a>
</span><span class=lnt id=hl-32-68><a class=lnlinks href=#hl-32-68> 68</a>
</span><span class=lnt id=hl-32-69><a class=lnlinks href=#hl-32-69> 69</a>
</span><span class=lnt id=hl-32-70><a class=lnlinks href=#hl-32-70> 70</a>
</span><span class=lnt id=hl-32-71><a class=lnlinks href=#hl-32-71> 71</a>
</span><span class=lnt id=hl-32-72><a class=lnlinks href=#hl-32-72> 72</a>
</span><span class=lnt id=hl-32-73><a class=lnlinks href=#hl-32-73> 73</a>
</span><span class=lnt id=hl-32-74><a class=lnlinks href=#hl-32-74> 74</a>
</span><span class=lnt id=hl-32-75><a class=lnlinks href=#hl-32-75> 75</a>
</span><span class=lnt id=hl-32-76><a class=lnlinks href=#hl-32-76> 76</a>
</span><span class=lnt id=hl-32-77><a class=lnlinks href=#hl-32-77> 77</a>
</span><span class=lnt id=hl-32-78><a class=lnlinks href=#hl-32-78> 78</a>
</span><span class=lnt id=hl-32-79><a class=lnlinks href=#hl-32-79> 79</a>
</span><span class=lnt id=hl-32-80><a class=lnlinks href=#hl-32-80> 80</a>
</span><span class=lnt id=hl-32-81><a class=lnlinks href=#hl-32-81> 81</a>
</span><span class=lnt id=hl-32-82><a class=lnlinks href=#hl-32-82> 82</a>
</span><span class=lnt id=hl-32-83><a class=lnlinks href=#hl-32-83> 83</a>
</span><span class=lnt id=hl-32-84><a class=lnlinks href=#hl-32-84> 84</a>
</span><span class=lnt id=hl-32-85><a class=lnlinks href=#hl-32-85> 85</a>
</span><span class=lnt id=hl-32-86><a class=lnlinks href=#hl-32-86> 86</a>
</span><span class=lnt id=hl-32-87><a class=lnlinks href=#hl-32-87> 87</a>
</span><span class=lnt id=hl-32-88><a class=lnlinks href=#hl-32-88> 88</a>
</span><span class=lnt id=hl-32-89><a class=lnlinks href=#hl-32-89> 89</a>
</span><span class=lnt id=hl-32-90><a class=lnlinks href=#hl-32-90> 90</a>
</span><span class=lnt id=hl-32-91><a class=lnlinks href=#hl-32-91> 91</a>
</span><span class=lnt id=hl-32-92><a class=lnlinks href=#hl-32-92> 92</a>
</span><span class=lnt id=hl-32-93><a class=lnlinks href=#hl-32-93> 93</a>
</span><span class=lnt id=hl-32-94><a class=lnlinks href=#hl-32-94> 94</a>
</span><span class=lnt id=hl-32-95><a class=lnlinks href=#hl-32-95> 95</a>
</span><span class=lnt id=hl-32-96><a class=lnlinks href=#hl-32-96> 96</a>
</span><span class=lnt id=hl-32-97><a class=lnlinks href=#hl-32-97> 97</a>
</span><span class=lnt id=hl-32-98><a class=lnlinks href=#hl-32-98> 98</a>
</span><span class=lnt id=hl-32-99><a class=lnlinks href=#hl-32-99> 99</a>
</span><span class=lnt id=hl-32-100><a class=lnlinks href=#hl-32-100>100</a>
</span><span class=lnt id=hl-32-101><a class=lnlinks href=#hl-32-101>101</a>
</span><span class=lnt id=hl-32-102><a class=lnlinks href=#hl-32-102>102</a>
</span><span class=lnt id=hl-32-103><a class=lnlinks href=#hl-32-103>103</a>
</span><span class=lnt id=hl-32-104><a class=lnlinks href=#hl-32-104>104</a>
</span><span class=lnt id=hl-32-105><a class=lnlinks href=#hl-32-105>105</a>
</span><span class=lnt id=hl-32-106><a class=lnlinks href=#hl-32-106>106</a>
</span><span class=lnt id=hl-32-107><a class=lnlinks href=#hl-32-107>107</a>
</span><span class=lnt id=hl-32-108><a class=lnlinks href=#hl-32-108>108</a>
</span><span class=lnt id=hl-32-109><a class=lnlinks href=#hl-32-109>109</a>
</span><span class=lnt id=hl-32-110><a class=lnlinks href=#hl-32-110>110</a>
</span><span class=lnt id=hl-32-111><a class=lnlinks href=#hl-32-111>111</a>
</span><span class=lnt id=hl-32-112><a class=lnlinks href=#hl-32-112>112</a>
</span><span class=lnt id=hl-32-113><a class=lnlinks href=#hl-32-113>113</a>
</span><span class=lnt id=hl-32-114><a class=lnlinks href=#hl-32-114>114</a>
</span><span class=lnt id=hl-32-115><a class=lnlinks href=#hl-32-115>115</a>
</span><span class=lnt id=hl-32-116><a class=lnlinks href=#hl-32-116>116</a>
</span><span class=lnt id=hl-32-117><a class=lnlinks href=#hl-32-117>117</a>
</span><span class=lnt id=hl-32-118><a class=lnlinks href=#hl-32-118>118</a>
</span><span class=lnt id=hl-32-119><a class=lnlinks href=#hl-32-119>119</a>
</span><span class=lnt id=hl-32-120><a class=lnlinks href=#hl-32-120>120</a>
</span><span class=lnt id=hl-32-121><a class=lnlinks href=#hl-32-121>121</a>
</span><span class=lnt id=hl-32-122><a class=lnlinks href=#hl-32-122>122</a>
</span><span class=lnt id=hl-32-123><a class=lnlinks href=#hl-32-123>123</a>
</span><span class=lnt id=hl-32-124><a class=lnlinks href=#hl-32-124>124</a>
</span><span class=lnt id=hl-32-125><a class=lnlinks href=#hl-32-125>125</a>
</span><span class=lnt id=hl-32-126><a class=lnlinks href=#hl-32-126>126</a>
</span><span class=lnt id=hl-32-127><a class=lnlinks href=#hl-32-127>127</a>
</span><span class=lnt id=hl-32-128><a class=lnlinks href=#hl-32-128>128</a>
</span><span class=lnt id=hl-32-129><a class=lnlinks href=#hl-32-129>129</a>
</span><span class=lnt id=hl-32-130><a class=lnlinks href=#hl-32-130>130</a>
</span><span class=lnt id=hl-32-131><a class=lnlinks href=#hl-32-131>131</a>
</span><span class=lnt id=hl-32-132><a class=lnlinks href=#hl-32-132>132</a>
</span><span class=lnt id=hl-32-133><a class=lnlinks href=#hl-32-133>133</a>
</span><span class=lnt id=hl-32-134><a class=lnlinks href=#hl-32-134>134</a>
</span><span class=lnt id=hl-32-135><a class=lnlinks href=#hl-32-135>135</a>
</span><span class=lnt id=hl-32-136><a class=lnlinks href=#hl-32-136>136</a>
</span><span class=lnt id=hl-32-137><a class=lnlinks href=#hl-32-137>137</a>
</span><span class=lnt id=hl-32-138><a class=lnlinks href=#hl-32-138>138</a>
</span><span class=lnt id=hl-32-139><a class=lnlinks href=#hl-32-139>139</a>
</span><span class=lnt id=hl-32-140><a class=lnlinks href=#hl-32-140>140</a>
</span><span class=lnt id=hl-32-141><a class=lnlinks href=#hl-32-141>141</a>
</span><span class=lnt id=hl-32-142><a class=lnlinks href=#hl-32-142>142</a>
</span><span class=lnt id=hl-32-143><a class=lnlinks href=#hl-32-143>143</a>
</span><span class=lnt id=hl-32-144><a class=lnlinks href=#hl-32-144>144</a>
</span><span class=lnt id=hl-32-145><a class=lnlinks href=#hl-32-145>145</a>
</span><span class=lnt id=hl-32-146><a class=lnlinks href=#hl-32-146>146</a>
</span><span class=lnt id=hl-32-147><a class=lnlinks href=#hl-32-147>147</a>
</span><span class=lnt id=hl-32-148><a class=lnlinks href=#hl-32-148>148</a>
</span><span class=lnt id=hl-32-149><a class=lnlinks href=#hl-32-149>149</a>
</span><span class=lnt id=hl-32-150><a class=lnlinks href=#hl-32-150>150</a>
</span><span class=lnt id=hl-32-151><a class=lnlinks href=#hl-32-151>151</a>
</span><span class=lnt id=hl-32-152><a class=lnlinks href=#hl-32-152>152</a>
</span><span class=lnt id=hl-32-153><a class=lnlinks href=#hl-32-153>153</a>
</span><span class=lnt id=hl-32-154><a class=lnlinks href=#hl-32-154>154</a>
</span><span class=lnt id=hl-32-155><a class=lnlinks href=#hl-32-155>155</a>
</span><span class=lnt id=hl-32-156><a class=lnlinks href=#hl-32-156>156</a>
</span><span class=lnt id=hl-32-157><a class=lnlinks href=#hl-32-157>157</a>
</span><span class=lnt id=hl-32-158><a class=lnlinks href=#hl-32-158>158</a>
</span><span class=lnt id=hl-32-159><a class=lnlinks href=#hl-32-159>159</a>
</span><span class=lnt id=hl-32-160><a class=lnlinks href=#hl-32-160>160</a>
</span><span class=lnt id=hl-32-161><a class=lnlinks href=#hl-32-161>161</a>
</span><span class=lnt id=hl-32-162><a class=lnlinks href=#hl-32-162>162</a>
</span><span class=lnt id=hl-32-163><a class=lnlinks href=#hl-32-163>163</a>
</span><span class=lnt id=hl-32-164><a class=lnlinks href=#hl-32-164>164</a>
</span><span class=lnt id=hl-32-165><a class=lnlinks href=#hl-32-165>165</a>
</span><span class=lnt id=hl-32-166><a class=lnlinks href=#hl-32-166>166</a>
</span><span class=lnt id=hl-32-167><a class=lnlinks href=#hl-32-167>167</a>
</span><span class=lnt id=hl-32-168><a class=lnlinks href=#hl-32-168>168</a>
</span><span class=lnt id=hl-32-169><a class=lnlinks href=#hl-32-169>169</a>
</span><span class=lnt id=hl-32-170><a class=lnlinks href=#hl-32-170>170</a>
</span><span class=lnt id=hl-32-171><a class=lnlinks href=#hl-32-171>171</a>
</span><span class=lnt id=hl-32-172><a class=lnlinks href=#hl-32-172>172</a>
</span><span class=lnt id=hl-32-173><a class=lnlinks href=#hl-32-173>173</a>
</span><span class=lnt id=hl-32-174><a class=lnlinks href=#hl-32-174>174</a>
</span><span class=lnt id=hl-32-175><a class=lnlinks href=#hl-32-175>175</a>
</span><span class=lnt id=hl-32-176><a class=lnlinks href=#hl-32-176>176</a>
</span><span class=lnt id=hl-32-177><a class=lnlinks href=#hl-32-177>177</a>
</span><span class=lnt id=hl-32-178><a class=lnlinks href=#hl-32-178>178</a>
</span><span class=lnt id=hl-32-179><a class=lnlinks href=#hl-32-179>179</a>
</span><span class=lnt id=hl-32-180><a class=lnlinks href=#hl-32-180>180</a>
</span><span class=lnt id=hl-32-181><a class=lnlinks href=#hl-32-181>181</a>
</span><span class=lnt id=hl-32-182><a class=lnlinks href=#hl-32-182>182</a>
</span><span class=lnt id=hl-32-183><a class=lnlinks href=#hl-32-183>183</a>
</span><span class=lnt id=hl-32-184><a class=lnlinks href=#hl-32-184>184</a>
</span><span class=lnt id=hl-32-185><a class=lnlinks href=#hl-32-185>185</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 자바 클라이언트 SDK 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AsyncApiClient</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>baseUrl</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>HttpClient</span><span class=w> </span><span class=n>httpClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ObjectMapper</span><span class=w> </span><span class=n>objectMapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ScheduledExecutorService</span><span class=w> </span><span class=n>scheduler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>AsyncApiClient</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>baseUrl</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>baseUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>baseUrl</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>httpClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HttpClient</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>connectTimeout</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>10</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>objectMapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ObjectMapper</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>registerModule</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JavaTimeModule</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>scheduler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Executors</span><span class=p>.</span><span class=na>newScheduledThreadPool</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 파일 변환 작업 시작</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>FileConversionResult</span><span class=o>&gt;</span><span class=w> </span><span class=nf>convertFile</span><span class=p>(</span><span class=n>File</span><span class=w> </span><span class=n>file</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>targetFormat</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 멀티파트 요청 작성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HttpRequest</span><span class=p>.</span><span class=na>Builder</span><span class=w> </span><span class=n>requestBuilder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HttpRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=n>URI</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>baseUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;/api/files/convert&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>header</span><span class=p>(</span><span class=s>&#34;Accept&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;application/json&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비동기 요청 제출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>submitMultipartRequest</span><span class=p>(</span><span class=n>requestBuilder</span><span class=p>,</span><span class=w> </span><span class=n>file</span><span class=p>,</span><span class=w> </span><span class=n>targetFormat</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>thenCompose</span><span class=p>(</span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>statusCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>202</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 작업 ID 파싱</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>FileConversionResponse</span><span class=w> </span><span class=n>conversionResponse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parseResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>response</span><span class=p>.</span><span class=na>body</span><span class=p>(),</span><span class=w> </span><span class=n>FileConversionResponse</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 작업 완료 대기</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>waitForCompletion</span><span class=p>(</span><span class=n>conversionResponse</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>conversionResponse</span><span class=p>.</span><span class=na>getStatusUrl</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AsyncApiException</span><span class=p>(</span><span class=s>&#34;Failed to start conversion: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>statusCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 작업 완료 대기 (폴링)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>FileConversionResult</span><span class=o>&gt;</span><span class=w> </span><span class=nf>waitForCompletion</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>statusUrl</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>FileConversionResult</span><span class=o>&gt;</span><span class=w> </span><span class=n>resultFuture</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 폴링 작업 스케줄링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>AtomicInteger</span><span class=w> </span><span class=n>attempts</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AtomicInteger</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>AtomicReference</span><span class=o>&lt;</span><span class=n>ScheduledFuture</span><span class=o>&lt;?&gt;&gt;</span><span class=w> </span><span class=n>futureRef</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AtomicReference</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ScheduledFuture</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>future</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>scheduler</span><span class=p>.</span><span class=na>scheduleAtFixedRate</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 상태 확인 요청</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>HttpRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HttpRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=n>URI</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>baseUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>statusUrl</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>GET</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>header</span><span class=p>(</span><span class=s>&#34;Accept&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;application/json&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>HttpResponse</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>httpClient</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>HttpResponse</span><span class=p>.</span><span class=na>BodyHandlers</span><span class=p>.</span><span class=na>ofString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>statusCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>200</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>FileConversionStatusResponse</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parseResponse</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>response</span><span class=p>.</span><span class=na>body</span><span class=p>(),</span><span class=w> </span><span class=n>FileConversionStatusResponse</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 상태에 따른 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getStatus</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>case</span><span class=w> </span><span class=s>&#34;COMPLETED&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=c1>// 작업 완료 - 결과 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>FileConversionResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FileConversionResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>jobId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>status</span><span class=p>.</span><span class=na>getStatus</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>baseUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getDownloadUrl</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>complete</span><span class=p>(</span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>cancelScheduledTask</span><span class=p>(</span><span class=n>futureRef</span><span class=p>.</span><span class=na>get</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>case</span><span class=w> </span><span class=s>&#34;FAILED&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=c1>// 작업 실패 - 예외 발생</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>completeExceptionally</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=k>new</span><span class=w> </span><span class=n>AsyncJobFailedException</span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getError</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>cancelScheduledTask</span><span class=p>(</span><span class=n>futureRef</span><span class=p>.</span><span class=na>get</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>case</span><span class=w> </span><span class=s>&#34;PROCESSING&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>case</span><span class=w> </span><span class=s>&#34;PENDING&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=c1>// 진행 중 - 계속 대기</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>attempts</span><span class=p>.</span><span class=na>incrementAndGet</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>maxAttempts</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>completeExceptionally</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=k>new</span><span class=w> </span><span class=n>AsyncJobTimeoutException</span><span class=p>(</span><span class=s>&#34;Job timed out after &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>maxAttempts</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; attempts&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>cancelScheduledTask</span><span class=p>(</span><span class=n>futureRef</span><span class=p>.</span><span class=na>get</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>statusCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>404</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>completeExceptionally</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>new</span><span class=w> </span><span class=n>AsyncJobNotFoundException</span><span class=p>(</span><span class=s>&#34;Job not found: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>jobId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>cancelScheduledTask</span><span class=p>(</span><span class=n>futureRef</span><span class=p>.</span><span class=na>get</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>attempts</span><span class=p>.</span><span class=na>incrementAndGet</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>maxAttempts</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>completeExceptionally</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>new</span><span class=w> </span><span class=n>AsyncApiException</span><span class=p>(</span><span class=s>&#34;Failed to get job status: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>statusCode</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>cancelScheduledTask</span><span class=p>(</span><span class=n>futureRef</span><span class=p>.</span><span class=na>get</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>attempts</span><span class=p>.</span><span class=na>incrementAndGet</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>maxRetries</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>completeExceptionally</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>cancelScheduledTask</span><span class=p>(</span><span class=n>futureRef</span><span class=p>.</span><span class=na>get</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>},</span><span class=w> </span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>pollingIntervalMillis</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>MILLISECONDS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>futureRef</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>future</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>resultFuture</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 웹훅 기반 작업 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>FileConversionResult</span><span class=o>&gt;</span><span class=w> </span><span class=nf>convertFileWithWebhook</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>File</span><span class=w> </span><span class=n>file</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>targetFormat</span><span class=p>,</span><span class=w> </span><span class=n>WebhookHandler</span><span class=o>&lt;</span><span class=n>FileConversionResult</span><span class=o>&gt;</span><span class=w> </span><span class=n>webhookHandler</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>FileConversionResult</span><span class=o>&gt;</span><span class=w> </span><span class=n>resultFuture</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 웹훅 핸들러 등록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>webhookId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>webhookHandler</span><span class=p>.</span><span class=na>register</span><span class=p>((</span><span class=n>json</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>WebhookPayload</span><span class=w> </span><span class=n>payload</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>objectMapper</span><span class=p>.</span><span class=na>readValue</span><span class=p>(</span><span class=n>json</span><span class=p>,</span><span class=w> </span><span class=n>WebhookPayload</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=s>&#34;COMPLETED&#34;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>payload</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>FileConversionResult</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FileConversionResult</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>payload</span><span class=p>.</span><span class=na>getJobId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>payload</span><span class=p>.</span><span class=na>getStatus</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>baseUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>payload</span><span class=p>.</span><span class=na>getDownloadUrl</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>complete</span><span class=p>(</span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=s>&#34;FAILED&#34;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>payload</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>completeExceptionally</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>new</span><span class=w> </span><span class=n>AsyncJobFailedException</span><span class=p>(</span><span class=n>payload</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span><span class=w> </span><span class=n>payload</span><span class=p>.</span><span class=na>getError</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 요청 준비</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HttpRequest</span><span class=p>.</span><span class=na>Builder</span><span class=w> </span><span class=n>requestBuilder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HttpRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=n>URI</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>baseUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;/api/files/convert?webhookUrl=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>URLEncoder</span><span class=p>.</span><span class=na>encode</span><span class=p>(</span><span class=n>webhookHandler</span><span class=p>.</span><span class=na>getCallbackUrl</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;?id=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>webhookId</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>StandardCharsets</span><span class=p>.</span><span class=na>UTF_8</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>header</span><span class=p>(</span><span class=s>&#34;Accept&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;application/json&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비동기 요청 제출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>submitMultipartRequest</span><span class=p>(</span><span class=n>requestBuilder</span><span class=p>,</span><span class=w> </span><span class=n>file</span><span class=p>,</span><span class=w> </span><span class=n>targetFormat</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>thenAccept</span><span class=p>(</span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>statusCode</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>202</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>completeExceptionally</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>new</span><span class=w> </span><span class=n>AsyncApiException</span><span class=p>(</span><span class=s>&#34;Failed to start conversion: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>statusCode</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>webhookHandler</span><span class=p>.</span><span class=na>unregister</span><span class=p>(</span><span class=n>webhookId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>exceptionally</span><span class=p>(</span><span class=n>e</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>completeExceptionally</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>webhookHandler</span><span class=p>.</span><span class=na>unregister</span><span class=p>(</span><span class=n>webhookId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 타임아웃 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>scheduler</span><span class=p>.</span><span class=na>schedule</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>resultFuture</span><span class=p>.</span><span class=na>isDone</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>resultFuture</span><span class=p>.</span><span class=na>completeExceptionally</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>new</span><span class=w> </span><span class=n>AsyncJobTimeoutException</span><span class=p>(</span><span class=s>&#34;Webhook callback timed out&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>webhookHandler</span><span class=p>.</span><span class=na>unregister</span><span class=p>(</span><span class=n>webhookId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>},</span><span class=w> </span><span class=n>webhookTimeoutSeconds</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>resultFuture</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 헬퍼 메서드…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=버전-관리-및-호환성>버전 관리 및 호환성<a hidden class=anchor aria-hidden=true href=#버전-관리-및-호환성>#</a></h4><p>비동기 API의 버전 관리와 하위 호환성 유지를 위한 전략.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1>  1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2>  2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3>  3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4>  4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5>  5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6>  6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7>  7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8>  8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9>  9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10> 10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11> 11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12> 12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13> 13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14> 14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15> 15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16> 16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17> 17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18> 18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19> 19</a>
</span><span class=lnt id=hl-33-20><a class=lnlinks href=#hl-33-20> 20</a>
</span><span class=lnt id=hl-33-21><a class=lnlinks href=#hl-33-21> 21</a>
</span><span class=lnt id=hl-33-22><a class=lnlinks href=#hl-33-22> 22</a>
</span><span class=lnt id=hl-33-23><a class=lnlinks href=#hl-33-23> 23</a>
</span><span class=lnt id=hl-33-24><a class=lnlinks href=#hl-33-24> 24</a>
</span><span class=lnt id=hl-33-25><a class=lnlinks href=#hl-33-25> 25</a>
</span><span class=lnt id=hl-33-26><a class=lnlinks href=#hl-33-26> 26</a>
</span><span class=lnt id=hl-33-27><a class=lnlinks href=#hl-33-27> 27</a>
</span><span class=lnt id=hl-33-28><a class=lnlinks href=#hl-33-28> 28</a>
</span><span class=lnt id=hl-33-29><a class=lnlinks href=#hl-33-29> 29</a>
</span><span class=lnt id=hl-33-30><a class=lnlinks href=#hl-33-30> 30</a>
</span><span class=lnt id=hl-33-31><a class=lnlinks href=#hl-33-31> 31</a>
</span><span class=lnt id=hl-33-32><a class=lnlinks href=#hl-33-32> 32</a>
</span><span class=lnt id=hl-33-33><a class=lnlinks href=#hl-33-33> 33</a>
</span><span class=lnt id=hl-33-34><a class=lnlinks href=#hl-33-34> 34</a>
</span><span class=lnt id=hl-33-35><a class=lnlinks href=#hl-33-35> 35</a>
</span><span class=lnt id=hl-33-36><a class=lnlinks href=#hl-33-36> 36</a>
</span><span class=lnt id=hl-33-37><a class=lnlinks href=#hl-33-37> 37</a>
</span><span class=lnt id=hl-33-38><a class=lnlinks href=#hl-33-38> 38</a>
</span><span class=lnt id=hl-33-39><a class=lnlinks href=#hl-33-39> 39</a>
</span><span class=lnt id=hl-33-40><a class=lnlinks href=#hl-33-40> 40</a>
</span><span class=lnt id=hl-33-41><a class=lnlinks href=#hl-33-41> 41</a>
</span><span class=lnt id=hl-33-42><a class=lnlinks href=#hl-33-42> 42</a>
</span><span class=lnt id=hl-33-43><a class=lnlinks href=#hl-33-43> 43</a>
</span><span class=lnt id=hl-33-44><a class=lnlinks href=#hl-33-44> 44</a>
</span><span class=lnt id=hl-33-45><a class=lnlinks href=#hl-33-45> 45</a>
</span><span class=lnt id=hl-33-46><a class=lnlinks href=#hl-33-46> 46</a>
</span><span class=lnt id=hl-33-47><a class=lnlinks href=#hl-33-47> 47</a>
</span><span class=lnt id=hl-33-48><a class=lnlinks href=#hl-33-48> 48</a>
</span><span class=lnt id=hl-33-49><a class=lnlinks href=#hl-33-49> 49</a>
</span><span class=lnt id=hl-33-50><a class=lnlinks href=#hl-33-50> 50</a>
</span><span class=lnt id=hl-33-51><a class=lnlinks href=#hl-33-51> 51</a>
</span><span class=lnt id=hl-33-52><a class=lnlinks href=#hl-33-52> 52</a>
</span><span class=lnt id=hl-33-53><a class=lnlinks href=#hl-33-53> 53</a>
</span><span class=lnt id=hl-33-54><a class=lnlinks href=#hl-33-54> 54</a>
</span><span class=lnt id=hl-33-55><a class=lnlinks href=#hl-33-55> 55</a>
</span><span class=lnt id=hl-33-56><a class=lnlinks href=#hl-33-56> 56</a>
</span><span class=lnt id=hl-33-57><a class=lnlinks href=#hl-33-57> 57</a>
</span><span class=lnt id=hl-33-58><a class=lnlinks href=#hl-33-58> 58</a>
</span><span class=lnt id=hl-33-59><a class=lnlinks href=#hl-33-59> 59</a>
</span><span class=lnt id=hl-33-60><a class=lnlinks href=#hl-33-60> 60</a>
</span><span class=lnt id=hl-33-61><a class=lnlinks href=#hl-33-61> 61</a>
</span><span class=lnt id=hl-33-62><a class=lnlinks href=#hl-33-62> 62</a>
</span><span class=lnt id=hl-33-63><a class=lnlinks href=#hl-33-63> 63</a>
</span><span class=lnt id=hl-33-64><a class=lnlinks href=#hl-33-64> 64</a>
</span><span class=lnt id=hl-33-65><a class=lnlinks href=#hl-33-65> 65</a>
</span><span class=lnt id=hl-33-66><a class=lnlinks href=#hl-33-66> 66</a>
</span><span class=lnt id=hl-33-67><a class=lnlinks href=#hl-33-67> 67</a>
</span><span class=lnt id=hl-33-68><a class=lnlinks href=#hl-33-68> 68</a>
</span><span class=lnt id=hl-33-69><a class=lnlinks href=#hl-33-69> 69</a>
</span><span class=lnt id=hl-33-70><a class=lnlinks href=#hl-33-70> 70</a>
</span><span class=lnt id=hl-33-71><a class=lnlinks href=#hl-33-71> 71</a>
</span><span class=lnt id=hl-33-72><a class=lnlinks href=#hl-33-72> 72</a>
</span><span class=lnt id=hl-33-73><a class=lnlinks href=#hl-33-73> 73</a>
</span><span class=lnt id=hl-33-74><a class=lnlinks href=#hl-33-74> 74</a>
</span><span class=lnt id=hl-33-75><a class=lnlinks href=#hl-33-75> 75</a>
</span><span class=lnt id=hl-33-76><a class=lnlinks href=#hl-33-76> 76</a>
</span><span class=lnt id=hl-33-77><a class=lnlinks href=#hl-33-77> 77</a>
</span><span class=lnt id=hl-33-78><a class=lnlinks href=#hl-33-78> 78</a>
</span><span class=lnt id=hl-33-79><a class=lnlinks href=#hl-33-79> 79</a>
</span><span class=lnt id=hl-33-80><a class=lnlinks href=#hl-33-80> 80</a>
</span><span class=lnt id=hl-33-81><a class=lnlinks href=#hl-33-81> 81</a>
</span><span class=lnt id=hl-33-82><a class=lnlinks href=#hl-33-82> 82</a>
</span><span class=lnt id=hl-33-83><a class=lnlinks href=#hl-33-83> 83</a>
</span><span class=lnt id=hl-33-84><a class=lnlinks href=#hl-33-84> 84</a>
</span><span class=lnt id=hl-33-85><a class=lnlinks href=#hl-33-85> 85</a>
</span><span class=lnt id=hl-33-86><a class=lnlinks href=#hl-33-86> 86</a>
</span><span class=lnt id=hl-33-87><a class=lnlinks href=#hl-33-87> 87</a>
</span><span class=lnt id=hl-33-88><a class=lnlinks href=#hl-33-88> 88</a>
</span><span class=lnt id=hl-33-89><a class=lnlinks href=#hl-33-89> 89</a>
</span><span class=lnt id=hl-33-90><a class=lnlinks href=#hl-33-90> 90</a>
</span><span class=lnt id=hl-33-91><a class=lnlinks href=#hl-33-91> 91</a>
</span><span class=lnt id=hl-33-92><a class=lnlinks href=#hl-33-92> 92</a>
</span><span class=lnt id=hl-33-93><a class=lnlinks href=#hl-33-93> 93</a>
</span><span class=lnt id=hl-33-94><a class=lnlinks href=#hl-33-94> 94</a>
</span><span class=lnt id=hl-33-95><a class=lnlinks href=#hl-33-95> 95</a>
</span><span class=lnt id=hl-33-96><a class=lnlinks href=#hl-33-96> 96</a>
</span><span class=lnt id=hl-33-97><a class=lnlinks href=#hl-33-97> 97</a>
</span><span class=lnt id=hl-33-98><a class=lnlinks href=#hl-33-98> 98</a>
</span><span class=lnt id=hl-33-99><a class=lnlinks href=#hl-33-99> 99</a>
</span><span class=lnt id=hl-33-100><a class=lnlinks href=#hl-33-100>100</a>
</span><span class=lnt id=hl-33-101><a class=lnlinks href=#hl-33-101>101</a>
</span><span class=lnt id=hl-33-102><a class=lnlinks href=#hl-33-102>102</a>
</span><span class=lnt id=hl-33-103><a class=lnlinks href=#hl-33-103>103</a>
</span><span class=lnt id=hl-33-104><a class=lnlinks href=#hl-33-104>104</a>
</span><span class=lnt id=hl-33-105><a class=lnlinks href=#hl-33-105>105</a>
</span><span class=lnt id=hl-33-106><a class=lnlinks href=#hl-33-106>106</a>
</span><span class=lnt id=hl-33-107><a class=lnlinks href=#hl-33-107>107</a>
</span><span class=lnt id=hl-33-108><a class=lnlinks href=#hl-33-108>108</a>
</span><span class=lnt id=hl-33-109><a class=lnlinks href=#hl-33-109>109</a>
</span><span class=lnt id=hl-33-110><a class=lnlinks href=#hl-33-110>110</a>
</span><span class=lnt id=hl-33-111><a class=lnlinks href=#hl-33-111>111</a>
</span><span class=lnt id=hl-33-112><a class=lnlinks href=#hl-33-112>112</a>
</span><span class=lnt id=hl-33-113><a class=lnlinks href=#hl-33-113>113</a>
</span><span class=lnt id=hl-33-114><a class=lnlinks href=#hl-33-114>114</a>
</span><span class=lnt id=hl-33-115><a class=lnlinks href=#hl-33-115>115</a>
</span><span class=lnt id=hl-33-116><a class=lnlinks href=#hl-33-116>116</a>
</span><span class=lnt id=hl-33-117><a class=lnlinks href=#hl-33-117>117</a>
</span><span class=lnt id=hl-33-118><a class=lnlinks href=#hl-33-118>118</a>
</span><span class=lnt id=hl-33-119><a class=lnlinks href=#hl-33-119>119</a>
</span><span class=lnt id=hl-33-120><a class=lnlinks href=#hl-33-120>120</a>
</span><span class=lnt id=hl-33-121><a class=lnlinks href=#hl-33-121>121</a>
</span><span class=lnt id=hl-33-122><a class=lnlinks href=#hl-33-122>122</a>
</span><span class=lnt id=hl-33-123><a class=lnlinks href=#hl-33-123>123</a>
</span><span class=lnt id=hl-33-124><a class=lnlinks href=#hl-33-124>124</a>
</span><span class=lnt id=hl-33-125><a class=lnlinks href=#hl-33-125>125</a>
</span><span class=lnt id=hl-33-126><a class=lnlinks href=#hl-33-126>126</a>
</span><span class=lnt id=hl-33-127><a class=lnlinks href=#hl-33-127>127</a>
</span><span class=lnt id=hl-33-128><a class=lnlinks href=#hl-33-128>128</a>
</span><span class=lnt id=hl-33-129><a class=lnlinks href=#hl-33-129>129</a>
</span><span class=lnt id=hl-33-130><a class=lnlinks href=#hl-33-130>130</a>
</span><span class=lnt id=hl-33-131><a class=lnlinks href=#hl-33-131>131</a>
</span><span class=lnt id=hl-33-132><a class=lnlinks href=#hl-33-132>132</a>
</span><span class=lnt id=hl-33-133><a class=lnlinks href=#hl-33-133>133</a>
</span><span class=lnt id=hl-33-134><a class=lnlinks href=#hl-33-134>134</a>
</span><span class=lnt id=hl-33-135><a class=lnlinks href=#hl-33-135>135</a>
</span><span class=lnt id=hl-33-136><a class=lnlinks href=#hl-33-136>136</a>
</span><span class=lnt id=hl-33-137><a class=lnlinks href=#hl-33-137>137</a>
</span><span class=lnt id=hl-33-138><a class=lnlinks href=#hl-33-138>138</a>
</span><span class=lnt id=hl-33-139><a class=lnlinks href=#hl-33-139>139</a>
</span><span class=lnt id=hl-33-140><a class=lnlinks href=#hl-33-140>140</a>
</span><span class=lnt id=hl-33-141><a class=lnlinks href=#hl-33-141>141</a>
</span><span class=lnt id=hl-33-142><a class=lnlinks href=#hl-33-142>142</a>
</span><span class=lnt id=hl-33-143><a class=lnlinks href=#hl-33-143>143</a>
</span><span class=lnt id=hl-33-144><a class=lnlinks href=#hl-33-144>144</a>
</span><span class=lnt id=hl-33-145><a class=lnlinks href=#hl-33-145>145</a>
</span><span class=lnt id=hl-33-146><a class=lnlinks href=#hl-33-146>146</a>
</span><span class=lnt id=hl-33-147><a class=lnlinks href=#hl-33-147>147</a>
</span><span class=lnt id=hl-33-148><a class=lnlinks href=#hl-33-148>148</a>
</span><span class=lnt id=hl-33-149><a class=lnlinks href=#hl-33-149>149</a>
</span><span class=lnt id=hl-33-150><a class=lnlinks href=#hl-33-150>150</a>
</span><span class=lnt id=hl-33-151><a class=lnlinks href=#hl-33-151>151</a>
</span><span class=lnt id=hl-33-152><a class=lnlinks href=#hl-33-152>152</a>
</span><span class=lnt id=hl-33-153><a class=lnlinks href=#hl-33-153>153</a>
</span><span class=lnt id=hl-33-154><a class=lnlinks href=#hl-33-154>154</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// API 버전 관리 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/v1/jobs&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobControllerV1</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobService</span><span class=w> </span><span class=n>jobService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponseV1</span><span class=o>&gt;</span><span class=w> </span><span class=nf>createJob</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>JobRequestV1</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 버전 1 요청 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>createJob</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>toInternalModel</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 버전 1 응답 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>accepted</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>JobResponseV1</span><span class=p>(</span><span class=n>jobId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;PENDING&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/api/v1/jobs/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>jobId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/{jobId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponseV1</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getJobStatus</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>getJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 버전 1 응답 매핑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>JobResponseV1</span><span class=p>.</span><span class=na>fromInternalModel</span><span class=p>(</span><span class=n>job</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/api/v2/jobs&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobControllerV2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JobService</span><span class=w> </span><span class=n>jobService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponseV2</span><span class=o>&gt;</span><span class=w> </span><span class=nf>createJob</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>JobRequestV2</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>webhookUrl</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 버전 2 요청 처리 (웹훅 지원 추가)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>createJobWithWebhook</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>.</span><span class=na>toInternalModel</span><span class=p>(),</span><span class=w> </span><span class=n>webhookUrl</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 버전 2 응답 생성 (추가 정보 포함)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JobResponseV2</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobResponseV2</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jobId</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;PENDING&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;/api/v2/jobs/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>jobId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>webhookUrl</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>accepted</span><span class=p>().</span><span class=na>body</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/{jobId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>JobResponseV2</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getJobStatus</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>getJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>job</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 버전 2 응답 매핑 (추가 정보 포함)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>JobResponseV2</span><span class=p>.</span><span class=na>fromInternalModel</span><span class=p>(</span><span class=n>job</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 버전 2에서 추가된 엔드포인트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DeleteMapping</span><span class=p>(</span><span class=s>&#34;/{jobId}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span><span class=w> </span><span class=nf>cancelJob</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>jobId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>boolean</span><span class=w> </span><span class=n>cancelled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jobService</span><span class=p>.</span><span class=na>cancelJob</span><span class=p>(</span><span class=n>jobId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>cancelled</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>notFound</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>noContent</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// API 모델 버전 관리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobRequestV1</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>type</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>parameters</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 내부 모델로 변환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>JobRequest</span><span class=w> </span><span class=nf>toInternalModel</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobRequest</span><span class=p>(</span><span class=n>type</span><span class=p>,</span><span class=w> </span><span class=n>parameters</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자, 게터, 세터 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobRequestV2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>type</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>parameters</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>priority</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>callbackId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 내부 모델로 변환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>JobRequest</span><span class=w> </span><span class=nf>toInternalModel</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JobRequest</span><span class=w> </span><span class=n>internalRequest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobRequest</span><span class=p>(</span><span class=n>type</span><span class=p>,</span><span class=w> </span><span class=n>parameters</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>internalRequest</span><span class=p>.</span><span class=na>setPriority</span><span class=p>(</span><span class=n>priority</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>internalRequest</span><span class=p>.</span><span class=na>setCallbackId</span><span class=p>(</span><span class=n>callbackId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>internalRequest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자, 게터, 세터 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobResponseV1</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>statusUrl</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 내부 모델에서 변환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>JobResponseV1</span><span class=w> </span><span class=nf>fromInternalModel</span><span class=p>(</span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobResponseV1</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;/api/v1/jobs/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자, 게터, 세터 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JobResponseV2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>statusUrl</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>createdAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>updatedAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>webhookEnabled</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Float</span><span class=w> </span><span class=n>progress</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 내부 모델에서 변환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>JobResponseV2</span><span class=w> </span><span class=nf>fromInternalModel</span><span class=p>(</span><span class=n>Job</span><span class=w> </span><span class=n>job</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JobResponseV2</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JobResponseV2</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setStatusUrl</span><span class=p>(</span><span class=s>&#34;/api/v2/jobs/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>job</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setCreatedAt</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getCreatedAt</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setUpdatedAt</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getUpdatedAt</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setWebhookEnabled</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getWebhookUrl</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setProgress</span><span class=p>(</span><span class=n>job</span><span class=p>.</span><span class=na>getProgress</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>response</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자, 게터, 세터 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>