<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Databases | hyunyoun's Blog</title>
<meta name=keywords content="Backend-Development,Best-Practices,Databases"><meta name=description content="백엔드 성능 최적화는 현대 웹 애플리케이션 개발에서 필수적인 요소이다. 사용자 경험을 향상시키고, 서버 자원을 효율적으로 활용하며, 확장성을 보장하기 위해서는 데이터베이스의 최적화가 필수적이다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/backend-development/performance-optimization/database/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/backend-development/performance-optimization/database/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/backend-development/performance-optimization/database/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/backend-development/performance-optimization/database/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Databases"><meta property="og:description" content="백엔드 성능 최적화는 현대 웹 애플리케이션 개발에서 필수적인 요소이다. 사용자 경험을 향상시키고, 서버 자원을 효율적으로 활용하며, 확장성을 보장하기 위해서는 데이터베이스의 최적화가 필수적이다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Databases"><meta name=twitter:description content="백엔드 성능 최적화는 현대 웹 애플리케이션 개발에서 필수적인 요소이다. 사용자 경험을 향상시키고, 서버 자원을 효율적으로 활용하며, 확장성을 보장하기 위해서는 데이터베이스의 최적화가 필수적이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Databases","item":"https://buenhyden.github.io/posts/backend-development/performance-optimization/database/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>Databases</h1><div class=post-description>백엔드 성능 최적화는 현대 웹 애플리케이션 개발에서 필수적인 요소이다. 사용자 경험을 향상시키고, 서버 자원을 효율적으로 활용하며, 확장성을 보장하기 위해서는 데이터베이스의 최적화가 필수적이다.</div></header><div class=post-content><h2 id=databases>Databases<a hidden class=anchor aria-hidden=true href=#databases>#</a></h2><h3 id=connection-pooling-reducing-connection-overhead>Connection Pooling: Reducing Connection Overhead<a hidden class=anchor aria-hidden=true href=#connection-pooling-reducing-connection-overhead>#</a></h3><h4 id=커넥션-풀링의-개념과-중요성>커넥션 풀링의 개념과 중요성<a hidden class=anchor aria-hidden=true href=#커넥션-풀링의-개념과-중요성>#</a></h4><p>데이터베이스 연결은 상당한 리소스를 소모하는 작업이다.</p><p>각 연결을 설정할 때마다 다음과 같은 과정이 필요하다:</p><ol><li>네트워크 소켓 생성</li><li>데이터베이스 서버와의 TCP 핸드셰이크</li><li>사용자 인증 및 권한 확인</li><li>세션 변수 설정</li><li>트랜잭션 상태 초기화</li></ol><p>이러한 과정은 수 밀리초에서 수백 밀리초까지 시간이 소요될 수 있다. 따라서 사용자 요청마다 새로운 연결을 생성하고 종료하는 것은 상당한 오버헤드를 발생시킨다.</p><p>커넥션 풀링은 이러한 문제를 해결하기 위한 기술로, 미리 여러 데이터베이스 연결을 생성하고 이를 풀(pool)에 보관하여 필요할 때 재사용한다. 이는 새로운 연결 설정에 드는 시간과 리소스를 크게 절약한다.</p><h4 id=실제-구현-예시>실제 구현 예시<a hidden class=anchor aria-hidden=true href=#실제-구현-예시>#</a></h4><p><strong>Java/Spring Boot 환경에서의 HikariCP 설정:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DatabaseConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=nf>dataSource</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HikariConfig</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HikariConfig</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setDriverClassName</span><span class=p>(</span><span class=s>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setJdbcUrl</span><span class=p>(</span><span class=s>&#34;jdbc:mysql://localhost:3306/mydb&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 커넥션 풀 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setMinimumIdle</span><span class=p>(</span><span class=n>5</span><span class=p>);</span><span class=w>           </span><span class=c1>// 풀에서 유지할 최소 연결 수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setMaximumPoolSize</span><span class=p>(</span><span class=n>20</span><span class=p>);</span><span class=w>      </span><span class=c1>// 풀의 최대 연결 수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setConnectionTimeout</span><span class=p>(</span><span class=n>30000</span><span class=p>);</span><span class=w> </span><span class=c1>// 연결 타임아웃 (30초)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setIdleTimeout</span><span class=p>(</span><span class=n>600000</span><span class=p>);</span><span class=w>      </span><span class=c1>// 유휴 연결 타임아웃 (10분)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setMaxLifetime</span><span class=p>(</span><span class=n>1800000</span><span class=p>);</span><span class=w>     </span><span class=c1>// 연결 최대 수명 (30분)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HikariDataSource</span><span class=p>(</span><span class=n>config</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>Node.js에서의 MySQL 커넥션 풀 설정:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mysql</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;mysql2&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>pool</span> <span class=o>=</span> <span class=nx>mysql</span><span class=p>.</span><span class=nx>createPool</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>user</span><span class=o>:</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>password</span><span class=o>:</span> <span class=s1>&#39;password&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>database</span><span class=o>:</span> <span class=s1>&#39;mydb&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>waitForConnections</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>connectionLimit</span><span class=o>:</span> <span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>queueLimit</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>idleTimeout</span><span class=o>:</span> <span class=mi>60000</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 풀에서 연결 가져오기
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>query</span><span class=p>(</span><span class=nx>sql</span><span class=p>,</span> <span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>promisePool</span> <span class=o>=</span> <span class=nx>pool</span><span class=p>.</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>rows</span><span class=p>]</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>promisePool</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=nx>sql</span><span class=p>,</span> <span class=nx>params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>rows</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>query</span> <span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=성능-향상-효과>성능 향상 효과<a hidden class=anchor aria-hidden=true href=#성능-향상-효과>#</a></h4><p>커넥션 풀링을 적용하면 다음과 같은 성능 향상을 기대할 수 있다:</p><ol><li><strong>응답 시간 감소</strong>: 연결 설정 시간을 절약하여 즉시 쿼리 실행 가능</li><li><strong>처리량 증가</strong>: 동일 시간 내 더 많은 요청 처리 가능</li><li><strong>서버 부하 감소</strong>: 빈번한 연결 생성/종료로 인한 CPU 및 메모리 사용량 감소</li><li><strong>안정성 향상</strong>: 연결 수 제한으로 데이터베이스 서버 과부하 방지</li></ol><p>실제 성능 테스트에서는 커넥션 풀링 적용 시 응답 시간이 50-80% 감소하는 사례가 많다.</p><h3 id=optimizing-connection-pool-settings>Optimizing Connection Pool Settings<a hidden class=anchor aria-hidden=true href=#optimizing-connection-pool-settings>#</a></h3><p>커넥션 풀을 단순히 구현하는 것뿐만 아니라, 애플리케이션 특성에 맞게 설정을 최적화하는 것이 중요하다.</p><h4 id=주요-최적화-매개변수>주요 최적화 매개변수<a hidden class=anchor aria-hidden=true href=#주요-최적화-매개변수>#</a></h4><ol><li><strong>최소/최대 연결 수(Min/Max Pool Size)</strong><ul><li>최소 연결 수: 풀에서 항상 유지되는 연결 수</li><li>최대 연결 수: 풀이 관리할 수 있는 최대 연결 수</li></ul></li><li><strong>연결 타임아웃(Connection Timeout)</strong><ul><li>새 연결을 얻기 위해 대기하는 최대 시간</li></ul></li><li><strong>유휴 타임아웃(Idle Timeout)</strong><ul><li>비활성 상태의 연결이 풀에서 제거되기 전에 유지되는 시간</li></ul></li><li><strong>연결 수명(Max Lifetime)</strong><ul><li>연결이 재사용되다가 종료되고 새로운 연결로 대체되는 최대 시간</li></ul></li></ol><h4 id=최적-설정-가이드라인>최적 설정 가이드라인<a hidden class=anchor aria-hidden=true href=#최적-설정-가이드라인>#</a></h4><ol><li><p><strong>최대 풀 크기 결정:</strong><br>최대 풀 크기는 다음 공식을 참고할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>최대 풀 크기 = (CPU 코어 수 * 2) + 유효 디스크 수
</span></span></code></pre></td></tr></table></div></div><p>예를 들어 8코어 CPU와 1개의 SSD가 있는 경우:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>최대 풀 크기 = (8 * 2) + 1 = 17
</span></span></code></pre></td></tr></table></div></div><p>그러나 이는 시작점일 뿐, 실제 워크로드에 따라 조정이 필요하다.</p></li><li><p><strong>최소 풀 크기 설정:</strong><br>일반적으로 최대 풀 크기의 25-50%로 설정하는 것이 좋다. 이는 초기 연결 생성 비용을 절약하면서 기본 부하를 처리할 수 있는 연결을 유지한다.</p></li><li><p><strong>타임아웃 설정:</strong></p><ul><li>연결 타임아웃: 일반적으로 5-30초 (워크로드에 따라 다름)</li><li>유휴 타임아웃: 일반적으로 5-10분</li><li>최대 수명: 일반적으로 30분-2시간 (데이터베이스 서버 설정에 따라 다름)</li></ul></li></ol><h4 id=모니터링-및-조정-전략>모니터링 및 조정 전략<a hidden class=anchor aria-hidden=true href=#모니터링-및-조정-전략>#</a></h4><p>커넥션 풀 성능을 지속적으로 모니터링하고 다음 지표를 추적해야 한다:</p><ol><li><strong>활성 연결 수</strong>: 현재 사용 중인 연결 수</li><li><strong>유휴 연결 수</strong>: 사용 가능한 연결 수</li><li><strong>대기 시간</strong>: 연결을 얻기 위해 대기한 시간</li><li><strong>타임아웃 발생 빈도</strong>: 연결을 얻지 못한 요청 수</li></ol><p>이러한 지표를 기반으로 풀 설정을 조정할 수 있다:</p><ul><li>대기 시간이 길거나 타임아웃이 자주 발생하면 최대 풀 크기를 늘림</li><li>유휴 연결이 많으면 최소 풀 크기를 줄임</li><li>데이터베이스 서버 부하가 높으면 최대 풀 크기를 줄임</li></ul><h3 id=efficient-database-indexing>Efficient Database Indexing<a hidden class=anchor aria-hidden=true href=#efficient-database-indexing>#</a></h3><p>데이터베이스 성능을 최적화하는 가장 효과적인 방법 중 하나는 적절한 인덱스를 생성하는 것이다.</p><h4 id=인덱스의-역할과-중요성>인덱스의 역할과 중요성<a hidden class=anchor aria-hidden=true href=#인덱스의-역할과-중요성>#</a></h4><p>인덱스는 데이터베이스 테이블에서 데이터를 빠르게 찾기 위한 자료 구조이다. 인덱스가 없으면 데이터베이스는 테이블의 모든 행을 검사하는 &lsquo;전체 테이블 스캔(Full Table Scan)&lsquo;을 수행해야 한다.</p><p>예를 들어, 1백만 개의 레코드가 있는 테이블에서 특정 사용자를 찾는 경우:</p><ul><li>인덱스 없이: 최악의 경우 1백만 개 모든 레코드 검사 필요</li><li>인덱스 사용: B-Tree 인덱스의 경우 약 log2(1,000,000) ≈ 20번의 비교로 찾을 수 있음</li></ul><h4 id=인덱스-유형>인덱스 유형<a hidden class=anchor aria-hidden=true href=#인덱스-유형>#</a></h4><ol><li><strong>단일 컬럼 인덱스(Single Column Index)</strong>: 하나의 컬럼에 대한, 가장 기본적인 인덱스</li><li><strong>복합 인덱스(Composite Index)</strong>: 여러 컬럼을 포함하는 인덱스</li><li><strong>고유 인덱스(Unique Index)</strong>: 중복 값을 허용하지 않는 인덱스</li><li><strong>부분 인덱스(Partial Index)</strong>: 테이블의 일부 행만 포함하는 인덱스</li><li><strong>함수 기반 인덱스(Function-Based Index)</strong>: 컬럼 값이 아닌 함수 결과에 대한 인덱스</li></ol><h4 id=효과적인-인덱스-전략>효과적인 인덱스 전략<a hidden class=anchor aria-hidden=true href=#효과적인-인덱스-전략>#</a></h4><p><strong>인덱스가 필요한 컬럼:</strong></p><ol><li>WHERE 절에서 자주 사용되는 컬럼</li><li>JOIN 절에서 사용되는 컬럼</li><li>ORDER BY 또는 GROUP BY 절에서 사용되는 컬럼</li><li>고유성이 높은 컬럼 (선택성이 좋은 컬럼)</li></ol><p><strong>인덱스 생성 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 단일 컬럼 인덱스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_user_email</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=n>email</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 복합 인덱스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_product_category_price</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>products</span><span class=p>(</span><span class=n>category_id</span><span class=p>,</span><span class=w> </span><span class=n>price</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 고유 인덱스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_order_number</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>orders</span><span class=p>(</span><span class=n>order_number</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 부분 인덱스 (PostgreSQL)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_active_users</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>is_active</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>TRUE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 함수 기반 인덱스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_lower_email</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=k>LOWER</span><span class=p>(</span><span class=n>email</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=인덱스-관리-및-모니터링>인덱스 관리 및 모니터링<a hidden class=anchor aria-hidden=true href=#인덱스-관리-및-모니터링>#</a></h4><p>인덱스는 정기적으로 관리해야 한다:</p><ol><li><strong>사용되지 않는 인덱스 식별 및 제거</strong>: 불필요한 인덱스는 쓰기 성능에 부담을 줌</li><li><strong>인덱스 단편화 확인 및 재구성</strong>: 시간이 지남에 따라 인덱스 효율성이 저하될 수 있음</li><li><strong>인덱스 통계 업데이트</strong>: 쿼리 최적화기가 정확한 실행 계획을 생성하도록 함</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- MySQL에서 인덱스 사용 통계 확인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=n>schema_index_statistics</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- PostgreSQL에서 사용되지 않는 인덱스 찾기
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>schemaname</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>s</span><span class=p>.</span><span class=n>relname</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>tablename</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>s</span><span class=p>.</span><span class=n>indexrelname</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>indexname</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>pg_relation_size</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>indexrelid</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>index_size</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>idx_scan</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>index_scans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>pg_stat_user_indexes</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>pg_index</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>indexrelid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>indexrelid</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>idx_scan</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w>      </span><span class=c1>-- 스캔 횟수가 0인 인덱스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>&lt;&gt;</span><span class=w> </span><span class=k>ALL</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>indkey</span><span class=p>)</span><span class=w>  </span><span class=c1>-- 표현식이 아닌 경우
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>indisunique</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>FALSE</span><span class=p>;</span><span class=w> </span><span class=c1>-- 고유 인덱스가 아닌 경우
</span></span></span></code></pre></td></tr></table></div></div><h3 id=fine-tuning-orm-queries>Fine-Tuning ORM Queries<a hidden class=anchor aria-hidden=true href=#fine-tuning-orm-queries>#</a></h3><p>ORM(Object-Relational Mapping)은 객체지향 프로그래밍 언어와 관계형 데이터베이스 사이의 다리 역할을 한다. 그러나 ORM을 잘못 사용하면 성능 문제가 발생할 수 있다.</p><h4 id=orm의-일반적인-성능-문제>ORM의 일반적인 성능 문제<a hidden class=anchor aria-hidden=true href=#orm의-일반적인-성능-문제>#</a></h4><ol><li><strong>N+1 문제</strong>: 부모 레코드 하나에 대해 자식 레코드를 조회할 때 추가 쿼리가 N번 발생하는 문제</li><li><strong>과도한 데이터 로딩</strong>: 필요 이상의 데이터를 불러오는 경우</li><li><strong>비효율적인 쿼리 생성</strong>: ORM이 최적화되지 않은 SQL 쿼리를 생성하는 경우</li><li><strong>캐시 미사용</strong>: ORM의 캐싱 기능을 활용하지 않는 경우</li></ol><h4 id=n1-문제-해결>N+1 문제 해결<a hidden class=anchor aria-hidden=true href=#n1-문제-해결>#</a></h4><p><strong>Hibernate/JPA에서의 N+1 문제 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// N+1 문제 발생</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Department</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@OneToMany</span><span class=p>(</span><span class=n>mappedBy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;department&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Employee</span><span class=o>&gt;</span><span class=w> </span><span class=n>employees</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// getters and setters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 이 코드는 N+1 문제를 발생시킵니다</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Department</span><span class=o>&gt;</span><span class=w> </span><span class=n>departments</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;SELECT d FROM Department d&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Department</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Department</span><span class=w> </span><span class=n>dept</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>departments</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Department: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>dept</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 각 부서마다 직원 목록을 조회하는 추가 쿼리 발생</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Employee</span><span class=w> </span><span class=n>emp</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>dept</span><span class=p>.</span><span class=na>getEmployees</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Employee: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>emp</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>해결책: Fetch Join 사용:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Fetch Join으로 N+1 문제 해결</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Department</span><span class=o>&gt;</span><span class=w> </span><span class=n>departments</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;SELECT d FROM Department d LEFT JOIN FETCH d.employees&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Department</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 이제 추가 쿼리 없이 직원 정보 접근 가능</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Department</span><span class=w> </span><span class=n>dept</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>departments</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Department: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>dept</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Employee</span><span class=w> </span><span class=n>emp</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>dept</span><span class=p>.</span><span class=na>getEmployees</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Employee: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>emp</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=orm-쿼리-최적화-기법>ORM 쿼리 최적화 기법<a hidden class=anchor aria-hidden=true href=#orm-쿼리-최적화-기법>#</a></h4><ol><li><p><strong>필요한 필드만 선택:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 전체 엔티티 대신 필요한 필드만 선택</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>[]&gt;</span><span class=w> </span><span class=n>results</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;SELECT e.id, e.name, e.salary FROM Employee e WHERE e.department.id = :deptId&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;deptId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>1L</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>네이티브 쿼리 활용:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 복잡한 쿼리는 네이티브 SQL 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Employee</span><span class=o>&gt;</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>createNativeQuery</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;SELECT e.* FROM employees e &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;JOIN departments d ON e.department_id = d.id &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;WHERE d.name = :deptName AND e.salary &gt; :minSalary&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Employee</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;deptName&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Engineering&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;minSalary&#34;</span><span class=p>,</span><span class=w> </span><span class=n>50000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>배치 처리:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 대량 데이터 처리 시 배치 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Session</span><span class=w> </span><span class=n>session</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=p>.</span><span class=na>unwrap</span><span class=p>(</span><span class=n>Session</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ScrollableResults</span><span class=w> </span><span class=n>scrollableResults</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;FROM Employee&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>setCacheMode</span><span class=p>(</span><span class=n>CacheMode</span><span class=p>.</span><span class=na>IGNORE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>scroll</span><span class=p>(</span><span class=n>ScrollMode</span><span class=p>.</span><span class=na>FORWARD_ONLY</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>scrollableResults</span><span class=p>.</span><span class=na>next</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Employee</span><span class=w> </span><span class=n>employee</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Employee</span><span class=p>)</span><span class=w> </span><span class=n>scrollableResults</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>processEmployee</span><span class=p>(</span><span class=n>employee</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>++</span><span class=n>count</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>100</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>session</span><span class=p>.</span><span class=na>flush</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>session</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>scrollableResults</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>캐시 활용:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 2차 캐시 활용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Cacheable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Cache</span><span class=p>(</span><span class=n>usage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CacheConcurrencyStrategy</span><span class=p>.</span><span class=na>READ_WRITE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Product</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>price</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// getters and setters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=orm-성능-모니터링>ORM 성능 모니터링<a hidden class=anchor aria-hidden=true href=#orm-성능-모니터링>#</a></h4><p>ORM 쿼리 성능을 모니터링하려면 다음 도구를 활용할 수 있다:</p><ol><li><strong>로깅 활성화</strong>: Hibernate의 경우 <code>show_sql</code> 및 <code>format_sql</code> 속성 활성화</li><li><strong>프로파일링 도구</strong>: p6spy, datasource-proxy 등을 사용한 SQL 모니터링</li><li><strong>APM 도구</strong>: New Relic, Datadog 등을 이용한 쿼리 성능 추적</li></ol><h3 id=optimizing-data-retrieval-with-lazy-loading-eager-loading-and-batch-processing>Optimizing Data Retrieval with Lazy Loading, Eager Loading, and Batch Processing<a hidden class=anchor aria-hidden=true href=#optimizing-data-retrieval-with-lazy-loading-eager-loading-and-batch-processing>#</a></h3><p>데이터 로딩 전략은 애플리케이션의 성능에 큰 영향을 미친다.</p><h4 id=지연-로딩lazy-loading>지연 로딩(Lazy Loading)<a hidden class=anchor aria-hidden=true href=#지연-로딩lazy-loading>#</a></h4><p>지연 로딩은 데이터가 실제로 필요할 때까지 로딩을 지연시키는 전략이다.</p><p><strong>장점:</strong></p><ul><li>초기 로딩 시간 단축</li><li>메모리 사용량 감소</li></ul><p><strong>단점:</strong></p><ul><li>데이터 접근 시 추가 쿼리 발생 가능(N+1 문제)</li><li>세션 종료 후 접근 시 문제 발생(LazyInitializationException)</li></ul><p><strong>Hibernate/JPA에서의 지연 로딩 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6>6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7>7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8>8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Order</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 지연 로딩 (기본값)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@OneToMany</span><span class=p>(</span><span class=n>mappedBy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;order&#34;</span><span class=p>,</span><span class=w> </span><span class=n>fetch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FetchType</span><span class=p>.</span><span class=na>LAZY</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>OrderItem</span><span class=o>&gt;</span><span class=w> </span><span class=n>items</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=즉시-로딩eager-loading>즉시 로딩(Eager Loading)<a hidden class=anchor aria-hidden=true href=#즉시-로딩eager-loading>#</a></h4><p>즉시 로딩은 연관된 데이터를 초기 쿼리 시점에 함께 로딩하는 전략이다.</p><p><strong>장점:</strong></p><ul><li>추가 쿼리 없이 연관 데이터 접근 가능</li><li>세션 종료 후에도 데이터 접근 가능</li></ul><p><strong>단점:</strong></p><ul><li>초기 로딩 시간 증가</li><li>불필요한 데이터까지 로딩 가능성</li></ul><p><strong>Hibernate/JPA에서의 즉시 로딩 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderItem</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 즉시 로딩</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ManyToOne</span><span class=p>(</span><span class=n>fetch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FetchType</span><span class=p>.</span><span class=na>EAGER</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;product_id&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=배치-로딩batch-loading>배치 로딩(Batch Loading)<a hidden class=anchor aria-hidden=true href=#배치-로딩batch-loading>#</a></h4><p>배치 로딩은 여러 개체를 한 번에 로딩하여 쿼리 수를 줄이는 기법이다.</p><p><strong>Hibernate에서의 배치 로딩 설정:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4>4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5>5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6>6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7>7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8>8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 엔티티 클래스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@BatchSize</span><span class=p>(</span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>25</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Order</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 또는 글로벌 설정 (hibernate.properties)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>hibernate</span><span class=p>.</span><span class=na>default_batch_fetch_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>25</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>배치 로딩 실행 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8>8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 주문 목록 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;FROM Order&#34;</span><span class=p>).</span><span class=na>list</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 각 주문의 항목에 접근 (배치 로딩 적용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>orders</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 처음 접근 시 최대 25개 주문의 항목을 한 번에 로딩</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>OrderItem</span><span class=o>&gt;</span><span class=w> </span><span class=n>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getItems</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=상황별-최적-로딩-전략>상황별 최적 로딩 전략<a hidden class=anchor aria-hidden=true href=#상황별-최적-로딩-전략>#</a></h4><table><thead><tr><th>상황</th><th>권장 전략</th><th>이유</th></tr></thead><tbody><tr><td>대부분의 경우 연관 데이터가 필요한 경우</td><td>즉시 로딩</td><td>추가 쿼리 감소</td></tr><tr><td>연관 데이터가 거의 필요 없는 경우</td><td>지연 로딩</td><td>불필요한 데이터 로딩 방지</td></tr><tr><td>목록에서 연관 데이터에 자주 접근하는 경우</td><td>배치 로딩</td><td>N+1 문제 방지, 쿼리 수 최소화</td></tr><tr><td>매우 큰 데이터셋 처리</td><td>지연 로딩 + 스트리밍</td><td>메모리 사용량 최소화</td></tr></tbody></table><h3 id=efficient-pagination-for-large-datasets>Efficient Pagination for Large Datasets<a hidden class=anchor aria-hidden=true href=#efficient-pagination-for-large-datasets>#</a></h3><p>대용량 데이터를 처리할 때 페이지네이션은 필수적인 기법이다.</p><h4 id=전통적인-페이지네이션의-문제점>전통적인 페이지네이션의 문제점<a hidden class=anchor aria-hidden=true href=#전통적인-페이지네이션의-문제점>#</a></h4><p>전통적인 오프셋 기반 페이지네이션(OFFSET/LIMIT)은 데이터가 많아질수록 성능이 저하된다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 오프셋 기반 페이지네이션
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>20</span><span class=w> </span><span class=k>OFFSET</span><span class=w> </span><span class=mi>980</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>이 쿼리는 다음과 같은 문제가 있다:</p><ol><li>데이터베이스는 981번째 행까지 모두 읽어야 함</li><li>페이지가 클수록 성능이 저하됨</li><li>데이터 변경 시 결과가 중복되거나 누락될 수 있음</li></ol><h4 id=커서-기반-페이지네이션>커서 기반 페이지네이션<a hidden class=anchor aria-hidden=true href=#커서-기반-페이지네이션>#</a></h4><p>커서 기반 페이지네이션은 마지막으로 조회한 항목의 식별자를 기준으로 다음 항목을 가져오는 방식이다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 커서 기반 페이지네이션
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=p>:</span><span class=n>lastSeenId</span><span class=w>  </span><span class=c1>-- 마지막으로 본 ID 이후의 항목만 조회
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>장점:</strong></p><ol><li>페이지 크기에 상관없이 일정한 성능</li><li>인덱스를 효율적으로 활용 가능</li><li>데이터 변경에도 안정적</li></ol><p><strong>JPA/Spring Data 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18>18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19>19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20>20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21>21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22>22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23>23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24>24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25>25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26>26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27>27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28>28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29>29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30>30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 엔티티 클래스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Product</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>price</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 리포지토리 인터페이스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>ProductRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Product</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 커서 기반 페이지네이션 쿼리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;SELECT p FROM Product p WHERE p.id &gt; :lastId ORDER BY p.id ASC LIMIT :limit&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByIdGreaterThan</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;lastId&#34;</span><span class=p>)</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>lastId</span><span class=p>,</span><span class=w> </span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;limit&#34;</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>limit</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 서비스 클래스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ProductService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ProductRepository</span><span class=w> </span><span class=n>productRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getProductsPage</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>lastId</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>pageSize</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>lastId</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>lastId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0L</span><span class=p>;</span><span class=w> </span><span class=c1>// 첫 페이지인 경우</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productRepository</span><span class=p>.</span><span class=na>findByIdGreaterThan</span><span class=p>(</span><span class=n>lastId</span><span class=p>,</span><span class=w> </span><span class=n>pageSize</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=키셋-페이지네이션>키셋 페이지네이션<a hidden class=anchor aria-hidden=true href=#키셋-페이지네이션>#</a></h4><p>키셋 페이지네이션은 커서 기반 페이지네이션의 확장으로, 여러 컬럼을 기준으로 정렬할 때 사용한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 키셋 페이지네이션 (가격 내림차순, 동일 가격은 ID 오름차순)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=p>(</span><span class=n>price</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=p>:</span><span class=n>lastPrice</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>price</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>lastPrice</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=p>:</span><span class=n>lastId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=k>DESC</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>ASC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>이 방식은 복합 인덱스를 효율적으로 활용할 수 있다.</p><h4 id=스트리밍-api>스트리밍 API<a hidden class=anchor aria-hidden=true href=#스트리밍-api>#</a></h4><p>매우 큰 데이터셋의 경우, 페이지네이션보다는 스트리밍 API를 고려할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Spring WebFlux를 사용한 스트리밍 API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@GetMapping</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;/products/stream&#34;</span><span class=p>,</span><span class=w> </span><span class=n>produces</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_STREAM_JSON_VALUE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Flux</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>streamProducts</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>productRepository</span><span class=p>.</span><span class=na>findAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>delayElements</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofMillis</span><span class=p>(</span><span class=n>100</span><span class=p>));</span><span class=w> </span><span class=c1>// 백프레셔 시뮬레이션</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>이 방식은 클라이언트가 데이터를 처리할 수 있는 속도로 서버가 데이터를 전송한다.</p><h3 id=data-optimization-avoid-select--queries-and-fetch-only-required-columns>Data Optimization: Avoid Select * Queries and Fetch Only Required Columns<a hidden class=anchor aria-hidden=true href=#data-optimization-avoid-select--queries-and-fetch-only-required-columns>#</a></h3><p>불필요한 데이터 조회는 성능에 부정적인 영향을 미친다.</p><h4 id=select--사용의-문제점><code>SELECT *</code> 사용의 문제점<a hidden class=anchor aria-hidden=true href=#select--사용의-문제점>#</a></h4><p><code>SELECT *</code> 쿼리의 주요 문제점:</p><ol><li><strong>불필요한 데이터 전송</strong>: 필요하지 않은 컬럼 데이터까지 전송</li><li><strong>네트워크 대역폭 낭비</strong>: 더 많은 데이터 전송으로 대역폭 소비</li><li><strong>메모리 사용량 증가</strong>: 애플리케이션에서 더 많은 메모리 사용</li><li><strong>인덱스 커버링 불가</strong>: 인덱스만으로 쿼리를 해결할 수 없음</li><li><strong>스키마 변경 시 위험</strong>: 테이블 구조 변경 시 예상치 못한 동작 발생 가능</li></ol><h4 id=필요한-컬럼만-선택하는-방법>필요한 컬럼만 선택하는 방법<a hidden class=anchor aria-hidden=true href=#필요한-컬럼만-선택하는-방법>#</a></h4><p><strong>SQL 쿼리:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 나쁜 예
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>123</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 좋은 예
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>order_id</span><span class=p>,</span><span class=w> </span><span class=n>order_date</span><span class=p>,</span><span class=w> </span><span class=n>total_amount</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>123</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>JPA/Hibernate:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 나쁜 예</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;SELECT o FROM Order o WHERE o.customer.id = :customerId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Order</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;customerId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>123L</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 좋은 예 (DTO 프로젝션 사용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>OrderSummary</span><span class=o>&gt;</span><span class=w> </span><span class=n>orderSummaries</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;SELECT new com.example.dto.OrderSummary(o.id, o.orderDate, o.totalAmount) &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                 </span><span class=s>&#34;FROM Order o WHERE o.customer.id = :customerId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>OrderSummary</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;customerId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>123L</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>Spring Data JPA:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 인터페이스 기반 프로젝션</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>OrderProjection</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Long</span><span class=w> </span><span class=nf>getId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>LocalDate</span><span class=w> </span><span class=nf>getOrderDate</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>BigDecimal</span><span class=w> </span><span class=nf>getTotalAmount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>OrderRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Order</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>OrderProjection</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByCustomerId</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>customerId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=대용량-테이블에서의-영향>대용량 테이블에서의 영향<a hidden class=anchor aria-hidden=true href=#대용량-테이블에서의-영향>#</a></h4><p>특히 대용량 테이블에서는 필요한 컬럼만 선택하는 것이 중요하다.</p><p>예를 들어, 1,000만 행을 가진 테이블에서 각 행이 20개의 컬럼을 가지고 있다고 가정해 보면:</p><ul><li>모든 컬럼을 선택할 경우: 10,000,000 × 20 = 200,000,000개의 값 전송</li><li>필요한 3개 컬럼만 선택할 경우: 10,000,000 × 3 = 30,000,000개의 값 전송</li></ul><p>이는 약 85%의 데이터 전송량 감소를 의미하며, 이에 따라 네트워크 대역폭 사용량, 메모리 사용량, 처리 시간 모두가 크게 줄어든다.</p><h4 id=성능-개선-사례>성능 개선 사례<a hidden class=anchor aria-hidden=true href=#성능-개선-사례>#</a></h4><p>실제 프로젝트에서 <code>SELECT *</code> 쿼리를 최적화한 사례를 살펴보면:</p><p><strong>쿼리 최적화 전:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>product_catalog</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>category_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=k>DESC</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>50</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>쿼리 최적화 후:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2>2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3>3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4>4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>product_id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=n>thumbnail_url</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>product_catalog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>category_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=k>DESC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>50</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>최적화 결과:</p><ul><li>쿼리 실행 시간: 250ms → 60ms (76% 감소)</li><li>전송 데이터 크기: 1.2MB → 180KB (85% 감소)</li><li>메모리 사용량: 1.4MB → 220KB (84% 감소)</li></ul><p>이러한 최적화는 특히 고부하 상황이나 모바일 환경에서 상당한 성능 향상을 가져온다.</p><h3 id=denormalizing-database-schema-for-read-heavy-workloads-and-reducing-join-operations>Denormalizing Database Schema for Read-Heavy Workloads and Reducing Join Operations<a hidden class=anchor aria-hidden=true href=#denormalizing-database-schema-for-read-heavy-workloads-and-reducing-join-operations>#</a></h3><h4 id=정규화와-비정규화의-이해>정규화와 비정규화의 이해<a hidden class=anchor aria-hidden=true href=#정규화와-비정규화의-이해>#</a></h4><p>데이터베이스 설계에서 정규화는 중복을 제거하고 데이터 일관성을 유지하는 과정이다. 그러나 읽기 중심 애플리케이션에서는 비정규화가 성능 향상에 도움이 될 수 있다.</p><p><strong>정규화된 스키마 (3NF):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2>2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3>3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4>4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5>5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6>6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>customers (id, name, email, address_id)
</span></span><span class=line><span class=cl>addresses (id, street, city, state, zip, country_id)
</span></span><span class=line><span class=cl>countries (id, name, code)
</span></span><span class=line><span class=cl>orders (id, customer_id, order_date, status)
</span></span><span class=line><span class=cl>order_items (id, order_id, product_id, quantity, price)
</span></span><span class=line><span class=cl>products (id, name, description, category_id, price)
</span></span><span class=line><span class=cl>categories (id, name, parent_id)
</span></span></code></pre></td></tr></table></div></div><p><strong>비정규화된 스키마 (읽기 최적화):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1>1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2>2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3>3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>customers (id, name, email, street, city, state, zip, country_name, country_code)
</span></span><span class=line><span class=cl>orders (id, customer_id, customer_name, customer_email, order_date, status)
</span></span><span class=line><span class=cl>order_items (id, order_id, product_id, product_name, category_name, quantity, price)
</span></span><span class=line><span class=cl>products (id, name, description, category_name, parent_category_name, price)
</span></span></code></pre></td></tr></table></div></div><h4 id=비정규화-전략>비정규화 전략<a hidden class=anchor aria-hidden=true href=#비정규화-전략>#</a></h4><ol><li><p><strong>자주 조인되는 테이블 병합</strong>: 조회 시 항상 함께 사용되는 테이블은 병합 고려</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 비정규화 전: 두 테이블 조인 필요
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>category_name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>category_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 비정규화 후: 단일 테이블 조회만으로 충분
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=n>category_name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products_denormalized</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>category_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>계산된 필드 저장</strong>: 자주 계산하는 값을 미리 저장</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 비정규화 전: 주문 총액 계산을 위한 서브쿼리 필요
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>oi</span><span class=p>.</span><span class=n>price</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>quantity</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>FROM</span><span class=w> </span><span class=n>order_items</span><span class=w> </span><span class=n>oi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>WHERE</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>order_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>total_amount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>123</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 비정규화 후: 미리 계산된 총액 사용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>order_date</span><span class=p>,</span><span class=w> </span><span class=n>total_amount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orders_denormalized</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>123</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>집계 테이블 활용</strong>: 통계 및 분석을 위한 별도 테이블 유지</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 비정규화 전: 매일 집계를 위한 복잡한 쿼리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=nb>DATE</span><span class=p>(</span><span class=n>order_date</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nb>date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>order_count</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>SUM</span><span class=p>(</span><span class=n>total_amount</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>daily_revenue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>order_date</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=s1>&#39;2023-01-01&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=s1>&#39;2023-01-31&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=nb>DATE</span><span class=p>(</span><span class=n>order_date</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 비정규화 후: 미리 계산된 집계 테이블 사용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=nb>date</span><span class=p>,</span><span class=w> </span><span class=n>order_count</span><span class=p>,</span><span class=w> </span><span class=n>daily_revenue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>daily_sales_stats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=nb>date</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=s1>&#39;2023-01-01&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=s1>&#39;2023-01-31&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=비정규화-구현-방법>비정규화 구현 방법<a hidden class=anchor aria-hidden=true href=#비정규화-구현-방법>#</a></h4><ol><li><p><strong>트리거 사용</strong>: 데이터 변경 시 비정규화 테이블 자동 업데이트</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=n>update_product_denormalized</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AFTER</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FOR</span><span class=w> </span><span class=k>EACH</span><span class=w> </span><span class=k>ROW</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>products_denormalized</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SET</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>price</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>price</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>category_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>category_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>배치 처리</strong>: 주기적으로 비정규화 테이블 갱신</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>cron</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;0 0 * * * *&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>// 매시간 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>updateProductDenormalizedTable</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;INSERT INTO products_denormalized (id, name, price, category_name) &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;SELECT p.id, p.name, p.price, c.name &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;FROM products p JOIN categories c ON p.category_id = c.id &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;ON DUPLICATE KEY UPDATE &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;name = VALUES(name), price = VALUES(price), category_name = VALUES(category_name)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>이벤트 기반 업데이트</strong>: 메시지 큐를 활용한 비동기 업데이트</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@TransactionalEventListener</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleProductUpdateEvent</span><span class=p>(</span><span class=n>ProductUpdatedEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getProduct</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Category</span><span class=w> </span><span class=n>category</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>categoryRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>product</span><span class=p>.</span><span class=na>getCategoryId</span><span class=p>()).</span><span class=na>orElse</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>category</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>productDenormalizedRepository</span><span class=p>.</span><span class=na>updateProductWithCategory</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>product</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>product</span><span class=p>.</span><span class=na>getName</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>product</span><span class=p>.</span><span class=na>getPrice</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>category</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=비정규화의-장단점>비정규화의 장단점<a hidden class=anchor aria-hidden=true href=#비정규화의-장단점>#</a></h4><p><strong>장점:</strong></p><ul><li>읽기 작업 성능 향상</li><li>복잡한 조인 쿼리 감소</li><li>애플리케이션 로직 단순화</li></ul><p><strong>단점:</strong></p><ul><li>데이터 중복으로 인한 저장 공간 증가</li><li>데이터 일관성 유지의 어려움</li><li>쓰기 작업 성능 저하 가능성</li></ul><p>비정규화는 읽기 작업이 쓰기 작업보다 훨씬 많은 애플리케이션(예: 전자상거래 카탈로그, 콘텐츠 관리 시스템)에 가장 적합하다.</p><h3 id=optimizing-join-operations-and-avoiding-unnecessary-joins>Optimizing Join Operations and Avoiding Unnecessary Joins<a hidden class=anchor aria-hidden=true href=#optimizing-join-operations-and-avoiding-unnecessary-joins>#</a></h3><h4 id=조인-작업의-성능-영향>조인 작업의 성능 영향<a hidden class=anchor aria-hidden=true href=#조인-작업의-성능-영향>#</a></h4><p>조인은 관계형 데이터베이스의 핵심 기능이지만, 잘못 사용하면 성능 저하의 주요 원인이 될 수 있다. 테이블 크기가 클수록 조인 작업의 비용은 기하급수적으로 증가할 수 있다.</p><h4 id=조인-유형과-성능-특성>조인 유형과 성능 특성<a hidden class=anchor aria-hidden=true href=#조인-유형과-성능-특성>#</a></h4><p><strong>내부 조인(INNER JOIN):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1>1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2>2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>category</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>category_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>양쪽 테이블에 모두 일치하는 행만 반환</li><li>일반적으로 가장 빠른 조인 유형</li></ul><p><strong>왼쪽 외부 조인(LEFT OUTER JOIN):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1>1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2>2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=p>,</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>customer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>왼쪽 테이블의 모든 행과 오른쪽 테이블의 일치하는 행 반환</li><li>내부 조인보다 약간 느림</li></ul><p><strong>오른쪽 외부 조인(RIGHT OUTER JOIN):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1>1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2>2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>rating</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>RIGHT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>product_reviews</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>product_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>오른쪽 테이블의 모든 행과 왼쪽 테이블의 일치하는 행 반환</li><li>LEFT JOIN과 유사한 성능 특성</li></ul><p><strong>전체 외부 조인(FULL OUTER JOIN):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1>1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2>2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3>3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>employee_id</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>employee_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>d</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>department_id</span><span class=p>,</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>department_name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=n>e</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FULL</span><span class=w> </span><span class=k>OUTER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>departments</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>department_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>양쪽 테이블의 모든 행 반환</li><li>일반적으로 가장 느린 조인 유형</li></ul><h4 id=조인-최적화-기법>조인 최적화 기법<a hidden class=anchor aria-hidden=true href=#조인-최적화-기법>#</a></h4><ol><li><strong>적절한 인덱스 생성</strong>: 조인 컬럼에는 반드시 인덱스 생성</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1>1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2>2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 조인 컬럼에 인덱스 생성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_order_items_order_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>order_items</span><span class=p>(</span><span class=n>order_id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_order_items_product_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>order_items</span><span class=p>(</span><span class=n>product_id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><strong>조인 순서 최적화</strong>: 가능하면 작은 테이블을 먼저 참조</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1>1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2>2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3>3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4>4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5>5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6>6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 나쁜 예: 큰 테이블이 왼쪽에 위치
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>order_items</span><span class=w> </span><span class=n>oi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>order_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 좋은 예: 작은 테이블이 왼쪽에 위치
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>order_items</span><span class=w> </span><span class=n>oi</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>order_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><strong>조인 조건 최적화</strong>: 가능한 한 동등 조인(Equi-Join) 사용</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1>1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2>2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3>3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4>4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5>5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6>6</a>
</span><span class=lnt id=hl-40-7><a class=lnlinks href=#hl-40-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 나쁜 예: 범위 조인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>category_id</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 좋은 예: 동등 조인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>category_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><strong>불필요한 조인 제거</strong>: 실제로 필요한 테이블만 조인</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1> 1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2> 2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3> 3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4> 4</a>
</span><span class=lnt id=hl-41-5><a class=lnlinks href=#hl-41-5> 5</a>
</span><span class=lnt id=hl-41-6><a class=lnlinks href=#hl-41-6> 6</a>
</span><span class=lnt id=hl-41-7><a class=lnlinks href=#hl-41-7> 7</a>
</span><span class=lnt id=hl-41-8><a class=lnlinks href=#hl-41-8> 8</a>
</span><span class=lnt id=hl-41-9><a class=lnlinks href=#hl-41-9> 9</a>
</span><span class=lnt id=hl-41-10><a class=lnlinks href=#hl-41-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 나쁜 예: 불필요한 조인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>price</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>category_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>price</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>100</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 좋은 예: 필요한 테이블만 사용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>price</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>100</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=서브쿼리-vs-조인>서브쿼리 vs. 조인<a hidden class=anchor aria-hidden=true href=#서브쿼리-vs-조인>#</a></h4><p>경우에 따라 조인 대신 서브쿼리를 사용하는 것이 더 효율적일 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1> 1</a>
</span><span class=lnt id=hl-42-2><a class=lnlinks href=#hl-42-2> 2</a>
</span><span class=lnt id=hl-42-3><a class=lnlinks href=#hl-42-3> 3</a>
</span><span class=lnt id=hl-42-4><a class=lnlinks href=#hl-42-4> 4</a>
</span><span class=lnt id=hl-42-5><a class=lnlinks href=#hl-42-5> 5</a>
</span><span class=lnt id=hl-42-6><a class=lnlinks href=#hl-42-6> 6</a>
</span><span class=lnt id=hl-42-7><a class=lnlinks href=#hl-42-7> 7</a>
</span><span class=lnt id=hl-42-8><a class=lnlinks href=#hl-42-8> 8</a>
</span><span class=lnt id=hl-42-9><a class=lnlinks href=#hl-42-9> 9</a>
</span><span class=lnt id=hl-42-10><a class=lnlinks href=#hl-42-10>10</a>
</span><span class=lnt id=hl-42-11><a class=lnlinks href=#hl-42-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 조인을 사용한 방식
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=p>,</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>customer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;SHIPPED&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 서브쿼리를 사용한 방식 (고객 데이터가 실제로 필요한 경우만 조회)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>customer_id</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>customer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;SHIPPED&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>서브쿼리는 다음과 같은 경우에 조인보다 효율적일 수 있다:</p><ul><li>관련 데이터가 적은 경우</li><li>1:1 관계에서 모든 필드가 필요하지 않은 경우</li><li>특정 조건에 따라 다른 테이블의 데이터가 필요한 경우</li></ul><h4 id=조인-최적화-모니터링>조인 최적화 모니터링<a hidden class=anchor aria-hidden=true href=#조인-최적화-모니터링>#</a></h4><p>쿼리 실행 계획을 분석하여 조인 작업의 효율성을 모니터링할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1>1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2>2</a>
</span><span class=lnt id=hl-43-3><a class=lnlinks href=#hl-43-3>3</a>
</span><span class=lnt id=hl-43-4><a class=lnlinks href=#hl-43-4>4</a>
</span><span class=lnt id=hl-43-5><a class=lnlinks href=#hl-43-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- MySQL에서 실행 계획 확인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=p>,</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>customer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;SHIPPED&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>실행 계획에서 다음 사항을 확인해야 한다:</p><ul><li>조인 방식(nested loop, hash join, merge join 등)</li><li>테이블 액세스 방법(인덱스 스캔, 전체 테이블 스캔 등)</li><li>조인 순서</li><li>필터링 시점</li></ul><h3 id=regular-maintenance-and-cleanup-of-data>Regular Maintenance and Cleanup of Data<a hidden class=anchor aria-hidden=true href=#regular-maintenance-and-cleanup-of-data>#</a></h3><h4 id=데이터-유지보수의-중요성>데이터 유지보수의 중요성<a hidden class=anchor aria-hidden=true href=#데이터-유지보수의-중요성>#</a></h4><p>데이터베이스는 시간이 지남에 따라 성능이 저하될 수 있다. 정기적인 유지보수는 데이터베이스 성능을 최적의 상태로 유지하는 데 필수적이다.</p><h4 id=주요-유지보수-작업>주요 유지보수 작업<a hidden class=anchor aria-hidden=true href=#주요-유지보수-작업>#</a></h4><ol><li><p><strong>테이블 및 인덱스 단편화 해소</strong><br>테이블과 인덱스는 데이터 삽입, 수정, 삭제로 인해 시간이 지남에 따라 단편화된다. 이는 디스크 공간 낭비와 성능 저하를 초래한다.</p><p><strong>MySQL에서의 테이블 최적화:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1>1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2>2</a>
</span><span class=lnt id=hl-44-3><a class=lnlinks href=#hl-44-3>3</a>
</span><span class=lnt id=hl-44-4><a class=lnlinks href=#hl-44-4>4</a>
</span><span class=lnt id=hl-44-5><a class=lnlinks href=#hl-44-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 테이블 재구성 (단편화 제거)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>OPTIMIZE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders</span><span class=p>,</span><span class=w> </span><span class=n>order_items</span><span class=p>,</span><span class=w> </span><span class=n>products</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 또는 InnoDB 테이블의 경우
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>PostgreSQL에서의 테이블 최적화:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-45-1><a class=lnlinks href=#hl-45-1>1</a>
</span><span class=lnt id=hl-45-2><a class=lnlinks href=#hl-45-2>2</a>
</span><span class=lnt id=hl-45-3><a class=lnlinks href=#hl-45-3>3</a>
</span><span class=lnt id=hl-45-4><a class=lnlinks href=#hl-45-4>4</a>
</span><span class=lnt id=hl-45-5><a class=lnlinks href=#hl-45-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 테이블 완전 재구성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>VACUUM</span><span class=w> </span><span class=k>FULL</span><span class=w> </span><span class=n>orders</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 또는 정기적인 자동 청소 (덜 방해적)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>VACUUM</span><span class=w> </span><span class=k>ANALYZE</span><span class=w> </span><span class=n>orders</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>통계 업데이트</strong><br>쿼리 최적화기는 통계 정보를 기반으로 실행 계획을 수립한다. 오래된 통계는 비효율적인 실행 계획을 초래할 수 있다.</p><p><strong>MySQL에서의 통계 업데이트:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-46-1><a class=lnlinks href=#hl-46-1>1</a>
</span><span class=lnt id=hl-46-2><a class=lnlinks href=#hl-46-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 테이블 통계 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ANALYZE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders</span><span class=p>,</span><span class=w> </span><span class=n>order_items</span><span class=p>,</span><span class=w> </span><span class=n>products</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>PostgreSQL에서의 통계 업데이트:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-47-1><a class=lnlinks href=#hl-47-1>1</a>
</span><span class=lnt id=hl-47-2><a class=lnlinks href=#hl-47-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 테이블 통계 업데이트
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ANALYZE</span><span class=w> </span><span class=n>orders</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>미사용 인덱스 식별 및 제거</strong><br>미사용 인덱스는 쓰기 작업의 성능을 저하시키고 디스크 공간을 낭비한다.</p><p><strong>MySQL에서 미사용 인덱스 식별:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-48-1><a class=lnlinks href=#hl-48-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>sys</span><span class=p>.</span><span class=n>schema_unused_indexes</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>PostgreSQL에서 미사용 인덱스 식별:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1>1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2>2</a>
</span><span class=lnt id=hl-49-3><a class=lnlinks href=#hl-49-3>3</a>
</span><span class=lnt id=hl-49-4><a class=lnlinks href=#hl-49-4>4</a>
</span><span class=lnt id=hl-49-5><a class=lnlinks href=#hl-49-5>5</a>
</span><span class=lnt id=hl-49-6><a class=lnlinks href=#hl-49-6>6</a>
</span><span class=lnt id=hl-49-7><a class=lnlinks href=#hl-49-7>7</a>
</span><span class=lnt id=hl-49-8><a class=lnlinks href=#hl-49-8>8</a>
</span><span class=lnt id=hl-49-9><a class=lnlinks href=#hl-49-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>schemaname</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s1>&#39;.&#39;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>relname</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>table</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>indexrelname</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>index</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>pg_size_pretty</span><span class=p>(</span><span class=n>pg_relation_size</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>indexrelid</span><span class=p>))</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>index_size</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>idx_scan</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>index_scans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>pg_stat_user_indexes</span><span class=w> </span><span class=n>ui</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>pg_index</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>ui</span><span class=p>.</span><span class=n>indexrelid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>indexrelid</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>idx_scan</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>idx_tup_read</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>idx_tup_fetch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>pg_relation_size</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>indexrelid</span><span class=p>)</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>데이터 아카이빙 및 정리</strong><br>오래된 데이터는 아카이빙하고, 불필요한 데이터는 정리하여 데이터베이스 크기를 관리한다.</p><p><strong>단계적 데이터 아카이빙:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-50-1><a class=lnlinks href=#hl-50-1> 1</a>
</span><span class=lnt id=hl-50-2><a class=lnlinks href=#hl-50-2> 2</a>
</span><span class=lnt id=hl-50-3><a class=lnlinks href=#hl-50-3> 3</a>
</span><span class=lnt id=hl-50-4><a class=lnlinks href=#hl-50-4> 4</a>
</span><span class=lnt id=hl-50-5><a class=lnlinks href=#hl-50-5> 5</a>
</span><span class=lnt id=hl-50-6><a class=lnlinks href=#hl-50-6> 6</a>
</span><span class=lnt id=hl-50-7><a class=lnlinks href=#hl-50-7> 7</a>
</span><span class=lnt id=hl-50-8><a class=lnlinks href=#hl-50-8> 8</a>
</span><span class=lnt id=hl-50-9><a class=lnlinks href=#hl-50-9> 9</a>
</span><span class=lnt id=hl-50-10><a class=lnlinks href=#hl-50-10>10</a>
</span><span class=lnt id=hl-50-11><a class=lnlinks href=#hl-50-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 1. 아카이브 테이블 생성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders_archive</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=n>orders</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 2. 오래된 데이터를 아카이브 테이블로 이동
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>orders_archive</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>order_date</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>DATE_SUB</span><span class=p>(</span><span class=k>CURRENT_DATE</span><span class=p>,</span><span class=w> </span><span class=nb>INTERVAL</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>YEAR</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 3. 원본 테이블에서 아카이브된 데이터 삭제
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>order_date</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>DATE_SUB</span><span class=p>(</span><span class=k>CURRENT_DATE</span><span class=p>,</span><span class=w> </span><span class=nb>INTERVAL</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>YEAR</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>로그 및 임시 데이터 정리</strong><br>로그 테이블과 임시 데이터는 빠르게 커질 수 있으며 정기적인 정리가 필요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-51-1><a class=lnlinks href=#hl-51-1>1</a>
</span><span class=lnt id=hl-51-2><a class=lnlinks href=#hl-51-2>2</a>
</span><span class=lnt id=hl-51-3><a class=lnlinks href=#hl-51-3>3</a>
</span><span class=lnt id=hl-51-4><a class=lnlinks href=#hl-51-4>4</a>
</span><span class=lnt id=hl-51-5><a class=lnlinks href=#hl-51-5>5</a>
</span><span class=lnt id=hl-51-6><a class=lnlinks href=#hl-51-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 오래된 로그 삭제
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>system_logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>log_date</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>DATE_SUB</span><span class=p>(</span><span class=k>CURRENT_DATE</span><span class=p>,</span><span class=w> </span><span class=nb>INTERVAL</span><span class=w> </span><span class=mi>90</span><span class=w> </span><span class=k>DAY</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 임시 테이블 비우기
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>TRUNCATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>temp_import_data</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=자동화된-유지보수-스크립트>자동화된 유지보수 스크립트<a hidden class=anchor aria-hidden=true href=#자동화된-유지보수-스크립트>#</a></h4><p>유지보수 작업은 자동화하여 정기적으로 실행하는 것이 좋다.</p><p><strong>MySQL 유지보수 스크립트 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-52-1><a class=lnlinks href=#hl-52-1> 1</a>
</span><span class=lnt id=hl-52-2><a class=lnlinks href=#hl-52-2> 2</a>
</span><span class=lnt id=hl-52-3><a class=lnlinks href=#hl-52-3> 3</a>
</span><span class=lnt id=hl-52-4><a class=lnlinks href=#hl-52-4> 4</a>
</span><span class=lnt id=hl-52-5><a class=lnlinks href=#hl-52-5> 5</a>
</span><span class=lnt id=hl-52-6><a class=lnlinks href=#hl-52-6> 6</a>
</span><span class=lnt id=hl-52-7><a class=lnlinks href=#hl-52-7> 7</a>
</span><span class=lnt id=hl-52-8><a class=lnlinks href=#hl-52-8> 8</a>
</span><span class=lnt id=hl-52-9><a class=lnlinks href=#hl-52-9> 9</a>
</span><span class=lnt id=hl-52-10><a class=lnlinks href=#hl-52-10>10</a>
</span><span class=lnt id=hl-52-11><a class=lnlinks href=#hl-52-11>11</a>
</span><span class=lnt id=hl-52-12><a class=lnlinks href=#hl-52-12>12</a>
</span><span class=lnt id=hl-52-13><a class=lnlinks href=#hl-52-13>13</a>
</span><span class=lnt id=hl-52-14><a class=lnlinks href=#hl-52-14>14</a>
</span><span class=lnt id=hl-52-15><a class=lnlinks href=#hl-52-15>15</a>
</span><span class=lnt id=hl-52-16><a class=lnlinks href=#hl-52-16>16</a>
</span><span class=lnt id=hl-52-17><a class=lnlinks href=#hl-52-17>17</a>
</span><span class=lnt id=hl-52-18><a class=lnlinks href=#hl-52-18>18</a>
</span><span class=lnt id=hl-52-19><a class=lnlinks href=#hl-52-19>19</a>
</span><span class=lnt id=hl-52-20><a class=lnlinks href=#hl-52-20>20</a>
</span><span class=lnt id=hl-52-21><a class=lnlinks href=#hl-52-21>21</a>
</span><span class=lnt id=hl-52-22><a class=lnlinks href=#hl-52-22>22</a>
</span><span class=lnt id=hl-52-23><a class=lnlinks href=#hl-52-23>23</a>
</span><span class=lnt id=hl-52-24><a class=lnlinks href=#hl-52-24>24</a>
</span><span class=lnt id=hl-52-25><a class=lnlinks href=#hl-52-25>25</a>
</span><span class=lnt id=hl-52-26><a class=lnlinks href=#hl-52-26>26</a>
</span><span class=lnt id=hl-52-27><a class=lnlinks href=#hl-52-27>27</a>
</span><span class=lnt id=hl-52-28><a class=lnlinks href=#hl-52-28>28</a>
</span><span class=lnt id=hl-52-29><a class=lnlinks href=#hl-52-29>29</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># 데이터베이스 연결 정보</span>
</span></span><span class=line><span class=cl><span class=nv>DB_USER</span><span class=o>=</span><span class=s2>&#34;admin&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DB_PASS</span><span class=o>=</span><span class=s2>&#34;password&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DB_NAME</span><span class=o>=</span><span class=s2>&#34;myapp&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 미사용 테이블 공간 정리</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Optimizing tables…&#34;</span>
</span></span><span class=line><span class=cl>mysql -u<span class=nv>$DB_USER</span> -p<span class=nv>$DB_PASS</span> <span class=nv>$DB_NAME</span> -e <span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  SELECT CONCAT(&#39;OPTIMIZE TABLE &#39;, table_schema, &#39;.&#39;, table_name, &#39;;&#39;)
</span></span></span><span class=line><span class=cl><span class=s2>  FROM information_schema.tables
</span></span></span><span class=line><span class=cl><span class=s2>  WHERE table_schema = &#39;</span><span class=nv>$DB_NAME</span><span class=s2>&#39;
</span></span></span><span class=line><span class=cl><span class=s2>  AND engine = &#39;InnoDB&#39;;&#34;</span> <span class=p>|</span> grep -v CONCAT <span class=p>|</span> mysql -u<span class=nv>$DB_USER</span> -p<span class=nv>$DB_PASS</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 통계 업데이트</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Updating statistics…&#34;</span>
</span></span><span class=line><span class=cl>mysql -u<span class=nv>$DB_USER</span> -p<span class=nv>$DB_PASS</span> <span class=nv>$DB_NAME</span> -e <span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  SELECT CONCAT(&#39;ANALYZE TABLE &#39;, table_schema, &#39;.&#39;, table_name, &#39;;&#39;)
</span></span></span><span class=line><span class=cl><span class=s2>  FROM information_schema.tables
</span></span></span><span class=line><span class=cl><span class=s2>  WHERE table_schema = &#39;</span><span class=nv>$DB_NAME</span><span class=s2>&#39;;&#34;</span> <span class=p>|</span> grep -v CONCAT <span class=p>|</span> mysql -u<span class=nv>$DB_USER</span> -p<span class=nv>$DB_PASS</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 오래된 로그 삭제</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Cleaning old logs…&#34;</span>
</span></span><span class=line><span class=cl>mysql -u<span class=nv>$DB_USER</span> -p<span class=nv>$DB_PASS</span> <span class=nv>$DB_NAME</span> -e <span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  DELETE FROM system_logs
</span></span></span><span class=line><span class=cl><span class=s2>  WHERE log_date &lt; DATE_SUB(CURRENT_DATE, INTERVAL 90 DAY);&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Maintenance completed.&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=유지보수-일정-수립>유지보수 일정 수립<a hidden class=anchor aria-hidden=true href=#유지보수-일정-수립>#</a></h4><p>유지보수 작업은 시스템 부하가 적은 시간에 실행하는 것이 좋다.</p><table><thead><tr><th>유지보수 작업</th><th>권장 주기</th><th>비고</th></tr></thead><tbody><tr><td>통계 업데이트</td><td>매일</td><td>데이터 변경이 많은 경우 더 자주</td></tr><tr><td>인덱스 재구성</td><td>주간</td><td>쓰기 작업이 많은 경우 더 자주</td></tr><tr><td>미사용 인덱스 확인</td><td>월간</td><td>개발 주기에 맞춰 조정</td></tr><tr><td>데이터 아카이빙</td><td>월간/분기</td><td>데이터 증가 속도에 따라 조정</td></tr><tr><td>전체 데이터베이스 점검</td><td>분기</td><td>대규모 유지보수 작업 포함</td></tr></tbody></table><h3 id=slow-query-logging-and-regular-monitoring>Slow-Query Logging and Regular Monitoring<a hidden class=anchor aria-hidden=true href=#slow-query-logging-and-regular-monitoring>#</a></h3><h4 id=슬로우-쿼리-로깅의-중요성>슬로우 쿼리 로깅의 중요성<a hidden class=anchor aria-hidden=true href=#슬로우-쿼리-로깅의-중요성>#</a></h4><p>슬로우 쿼리 로깅은 성능 최적화의 첫 번째 단계이다. 이를 통해 성능 문제를 일으키는 쿼리를 식별하고 최적화할 수 있다.</p><h4 id=슬로우-쿼리-로깅-설정>슬로우 쿼리 로깅 설정<a hidden class=anchor aria-hidden=true href=#슬로우-쿼리-로깅-설정>#</a></h4><p><strong>MySQL에서의 슬로우 쿼리 로깅 설정:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-53-1><a class=lnlinks href=#hl-53-1>1</a>
</span><span class=lnt id=hl-53-2><a class=lnlinks href=#hl-53-2>2</a>
</span><span class=lnt id=hl-53-3><a class=lnlinks href=#hl-53-3>3</a>
</span><span class=lnt id=hl-53-4><a class=lnlinks href=#hl-53-4>4</a>
</span><span class=lnt id=hl-53-5><a class=lnlinks href=#hl-53-5>5</a>
</span><span class=lnt id=hl-53-6><a class=lnlinks href=#hl-53-6>6</a>
</span><span class=lnt id=hl-53-7><a class=lnlinks href=#hl-53-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 슬로우 쿼리 로깅 활성화
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>slow_query_log</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;ON&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>slow_query_log_file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;/var/log/mysql/mysql-slow.log&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>long_query_time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=c1>-- 1초 이상 걸리는 쿼리 로깅
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 인덱스를 사용하지 않는 쿼리도 로깅 (선택 사항)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>log_queries_not_using_indexes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;ON&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>PostgreSQL에서의 슬로우 쿼리 로깅 설정:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-54-1><a class=lnlinks href=#hl-54-1>1</a>
</span><span class=lnt id=hl-54-2><a class=lnlinks href=#hl-54-2>2</a>
</span><span class=lnt id=hl-54-3><a class=lnlinks href=#hl-54-3>3</a>
</span><span class=lnt id=hl-54-4><a class=lnlinks href=#hl-54-4>4</a>
</span><span class=lnt id=hl-54-5><a class=lnlinks href=#hl-54-5>5</a>
</span><span class=lnt id=hl-54-6><a class=lnlinks href=#hl-54-6>6</a>
</span><span class=lnt id=hl-54-7><a class=lnlinks href=#hl-54-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- postgresql.conf 파일 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>log_min_duration_statement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1000</span><span class=w>  </span><span class=c1>-- 1000ms(1초) 이상 걸리는 쿼리 로깅
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>log_statement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;none&#39;</span><span class=w>             </span><span class=c1>-- 모든 SQL 문 로깅하지 않음
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>log_duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>off</span><span class=w>                 </span><span class=c1>-- 실행 시간만 로깅하지 않음
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>log_line_prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h &#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>log_destination</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;csvlog&#39;</span><span class=w>         </span><span class=c1>-- CSV 형식으로 로깅
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>logging_collector</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>on</span><span class=w>             </span><span class=c1>-- 로그 파일로 저장
</span></span></span></code></pre></td></tr></table></div></div><h4 id=슬로우-쿼리-분석>슬로우 쿼리 분석<a hidden class=anchor aria-hidden=true href=#슬로우-쿼리-분석>#</a></h4><p>슬로우 쿼리 로그를 분석하여 최적화가 필요한 쿼리를 식별한다.</p><p><strong>MySQL용 pt-query-digest 도구 사용:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-55-1><a class=lnlinks href=#hl-55-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pt-query-digest /var/log/mysql/mysql-slow.log &gt; slow_query_report.txt
</span></span></code></pre></td></tr></table></div></div><p><strong>PostgreSQL용 pgBadger 도구 사용:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-56-1><a class=lnlinks href=#hl-56-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pgbadger /var/log/postgresql/postgresql-10-main.log -o slow_query_report.html
</span></span></code></pre></td></tr></table></div></div><h4 id=쿼리-성능-모니터링-도구>쿼리 성능 모니터링 도구<a hidden class=anchor aria-hidden=true href=#쿼리-성능-모니터링-도구>#</a></h4><p>지속적인 쿼리 성능 모니터링을 위한 도구는 다음과 같다:</p><ol><li><strong>Prometheus + Grafana</strong>: 시계열 데이터 수집 및 시각화</li><li><strong>MySQL Enterprise Monitor</strong>: MySQL 전용 모니터링 도구</li><li><strong>pganalyze</strong>: PostgreSQL 성능 모니터링 도구</li><li><strong>New Relic / Datadog</strong>: 애플리케이션 및 데이터베이스 통합 모니터링</li><li><strong>PMM (Percona Monitoring and Management)</strong>: MySQL, MongoDB, PostgreSQL 모니터링</li></ol><h4 id=성능-메트릭-모니터링>성능 메트릭 모니터링<a hidden class=anchor aria-hidden=true href=#성능-메트릭-모니터링>#</a></h4><p>다음 메트릭을 정기적으로 모니터링해야 한다:</p><ol><li><strong>쿼리 실행 시간</strong>: 평균 및 최대 실행 시간</li><li><strong>쿼리 실행 빈도</strong>: 가장 자주 실행되는 쿼리</li><li><strong>테이블 스캔</strong>: 인덱스 없이 수행되는 전체 테이블 스캔</li><li><strong>캐시 적중률</strong>: 쿼리 캐시, 버퍼 풀 적중률</li><li><strong>락 대기 시간</strong>: 락으로 인한 대기 시간</li><li><strong>임시 테이블 사용</strong>: 디스크 기반 임시 테이블 생성</li><li><strong>연결 수</strong>: 활성 및 대기 연결 수</li></ol><h4 id=대시보드-구성-예시>대시보드 구성 예시<a hidden class=anchor aria-hidden=true href=#대시보드-구성-예시>#</a></h4><p>Grafana와 Prometheus를 사용한 데이터베이스 모니터링 대시보드는 다음과 같은 패널을 포함할 수 있다:</p><ol><li><strong>쿼리 성능 개요</strong>:<ul><li>초당 쿼리 수</li><li>평균 쿼리 실행 시간</li><li>슬로우 쿼리 비율</li></ul></li><li><strong>리소스 사용량</strong>:<ul><li>CPU 사용률</li><li>메모리 사용률</li><li>디스크 I/O</li><li>연결 수</li></ul></li><li><strong>쿼리 분석</strong>:<ul><li>상위 10개 슬로우 쿼리</li><li>인덱스 사용 현황</li><li>테이블 스캔 빈도</li></ul></li><li><strong>캐시 성능</strong>:<ul><li>버퍼 풀 적중률</li><li>쿼리 캐시 적중률</li><li>테이블 캐시 적중률</li></ul></li></ol><h4 id=알림-설정>알림 설정<a hidden class=anchor aria-hidden=true href=#알림-설정>#</a></h4><p>중요한 성능 문제가 발생할 때 알림을 받을 수 있도록 설정한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-57-1><a class=lnlinks href=#hl-57-1> 1</a>
</span><span class=lnt id=hl-57-2><a class=lnlinks href=#hl-57-2> 2</a>
</span><span class=lnt id=hl-57-3><a class=lnlinks href=#hl-57-3> 3</a>
</span><span class=lnt id=hl-57-4><a class=lnlinks href=#hl-57-4> 4</a>
</span><span class=lnt id=hl-57-5><a class=lnlinks href=#hl-57-5> 5</a>
</span><span class=lnt id=hl-57-6><a class=lnlinks href=#hl-57-6> 6</a>
</span><span class=lnt id=hl-57-7><a class=lnlinks href=#hl-57-7> 7</a>
</span><span class=lnt id=hl-57-8><a class=lnlinks href=#hl-57-8> 8</a>
</span><span class=lnt id=hl-57-9><a class=lnlinks href=#hl-57-9> 9</a>
</span><span class=lnt id=hl-57-10><a class=lnlinks href=#hl-57-10>10</a>
</span><span class=lnt id=hl-57-11><a class=lnlinks href=#hl-57-11>11</a>
</span><span class=lnt id=hl-57-12><a class=lnlinks href=#hl-57-12>12</a>
</span><span class=lnt id=hl-57-13><a class=lnlinks href=#hl-57-13>13</a>
</span><span class=lnt id=hl-57-14><a class=lnlinks href=#hl-57-14>14</a>
</span><span class=lnt id=hl-57-15><a class=lnlinks href=#hl-57-15>15</a>
</span><span class=lnt id=hl-57-16><a class=lnlinks href=#hl-57-16>16</a>
</span><span class=lnt id=hl-57-17><a class=lnlinks href=#hl-57-17>17</a>
</span><span class=lnt id=hl-57-18><a class=lnlinks href=#hl-57-18>18</a>
</span><span class=lnt id=hl-57-19><a class=lnlinks href=#hl-57-19>19</a>
</span><span class=lnt id=hl-57-20><a class=lnlinks href=#hl-57-20>20</a>
</span><span class=lnt id=hl-57-21><a class=lnlinks href=#hl-57-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Prometheus 알림 규칙 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>DatabaseAlerts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class=l>SlowQueriesIncreasing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class=l>rate(mysql_global_status_slow_queries[5m]) &gt; 10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class=l>5m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>warning</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;슬로우 쿼리 증가&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;최근 5분 동안 초당 10개 이상의 슬로우 쿼리가 발생했습니다.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class=l>HighConnectionUsage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class=l>mysql_global_status_threads_connected / mysql_global_variables_max_connections &gt; 0.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class=l>5m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>warning</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;높은 연결 사용률&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;데이터베이스 연결 사용률이 80%를 초과했습니다.&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=database-replication-for-redundancy-and-enhanced-read-performance>Database Replication for Redundancy and Enhanced Read Performance<a hidden class=anchor aria-hidden=true href=#database-replication-for-redundancy-and-enhanced-read-performance>#</a></h3><h4 id=데이터베이스-복제의-개념>데이터베이스 복제의 개념<a hidden class=anchor aria-hidden=true href=#데이터베이스-복제의-개념>#</a></h4><p>데이터베이스 복제는 하나의 데이터베이스(마스터)의 데이터를 다른 데이터베이스(복제본)에 복사하여 동기화하는 프로세스이다. 이를 통해 데이터 중복성을 확보하고 읽기 작업을 분산시킬 수 있다.</p><h4 id=복제-구성-유형>복제 구성 유형<a hidden class=anchor aria-hidden=true href=#복제-구성-유형>#</a></h4><ol><li><strong>마스터-슬레이브 복제</strong>:<ul><li>모든 쓰기 작업은 마스터에서 수행</li><li>읽기 작업은 마스터와 슬레이브에 분산</li><li>슬레이브는 마스터의 변경 사항을 비동기적으로 복제</li></ul></li><li><strong>마스터-마스터 복제</strong>:<ul><li>양방향 복제로 두 서버 모두에서 쓰기 가능</li><li>복잡성 증가 및 충돌 가능성</li><li>특정 사용 사례에만 권장</li></ul></li><li><strong>다중 슬레이브 구성</strong>:<ul><li>하나의 마스터와 여러 슬레이브</li><li>읽기 작업을 여러 슬레이브에 분산</li><li>지리적으로 분산된 배포 지원</li></ul></li></ol><h4 id=mysql-복제-설정>MySQL 복제 설정<a hidden class=anchor aria-hidden=true href=#mysql-복제-설정>#</a></h4><p><strong>마스터 서버 설정:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-58-1><a class=lnlinks href=#hl-58-1>1</a>
</span><span class=lnt id=hl-58-2><a class=lnlinks href=#hl-58-2>2</a>
</span><span class=lnt id=hl-58-3><a class=lnlinks href=#hl-58-3>3</a>
</span><span class=lnt id=hl-58-4><a class=lnlinks href=#hl-58-4>4</a>
</span><span class=lnt id=hl-58-5><a class=lnlinks href=#hl-58-5>5</a>
</span><span class=lnt id=hl-58-6><a class=lnlinks href=#hl-58-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># my.cnf
</span></span><span class=line><span class=cl>[mysqld]
</span></span><span class=line><span class=cl>server-id = 1
</span></span><span class=line><span class=cl>log_bin = mysql-bin
</span></span><span class=line><span class=cl>binlog_format = ROW
</span></span><span class=line><span class=cl>binlog_do_db = myapp  # 복제할 데이터베이스 지정
</span></span></code></pre></td></tr></table></div></div><p><strong>슬레이브 서버 설정:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-59-1><a class=lnlinks href=#hl-59-1>1</a>
</span><span class=lnt id=hl-59-2><a class=lnlinks href=#hl-59-2>2</a>
</span><span class=lnt id=hl-59-3><a class=lnlinks href=#hl-59-3>3</a>
</span><span class=lnt id=hl-59-4><a class=lnlinks href=#hl-59-4>4</a>
</span><span class=lnt id=hl-59-5><a class=lnlinks href=#hl-59-5>5</a>
</span><span class=lnt id=hl-59-6><a class=lnlinks href=#hl-59-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># my.cnf
</span></span><span class=line><span class=cl>[mysqld]
</span></span><span class=line><span class=cl>server-id = 2
</span></span><span class=line><span class=cl>relay-log = mysql-relay-bin
</span></span><span class=line><span class=cl>log_bin = mysql-bin
</span></span><span class=line><span class=cl>read_only = 1  # 슬레이브를 읽기 전용으로 설정
</span></span></code></pre></td></tr></table></div></div><p><strong>복제 설정 명령:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-60-1><a class=lnlinks href=#hl-60-1> 1</a>
</span><span class=lnt id=hl-60-2><a class=lnlinks href=#hl-60-2> 2</a>
</span><span class=lnt id=hl-60-3><a class=lnlinks href=#hl-60-3> 3</a>
</span><span class=lnt id=hl-60-4><a class=lnlinks href=#hl-60-4> 4</a>
</span><span class=lnt id=hl-60-5><a class=lnlinks href=#hl-60-5> 5</a>
</span><span class=lnt id=hl-60-6><a class=lnlinks href=#hl-60-6> 6</a>
</span><span class=lnt id=hl-60-7><a class=lnlinks href=#hl-60-7> 7</a>
</span><span class=lnt id=hl-60-8><a class=lnlinks href=#hl-60-8> 8</a>
</span><span class=lnt id=hl-60-9><a class=lnlinks href=#hl-60-9> 9</a>
</span><span class=lnt id=hl-60-10><a class=lnlinks href=#hl-60-10>10</a>
</span><span class=lnt id=hl-60-11><a class=lnlinks href=#hl-60-11>11</a>
</span><span class=lnt id=hl-60-12><a class=lnlinks href=#hl-60-12>12</a>
</span><span class=lnt id=hl-60-13><a class=lnlinks href=#hl-60-13>13</a>
</span><span class=lnt id=hl-60-14><a class=lnlinks href=#hl-60-14>14</a>
</span><span class=lnt id=hl-60-15><a class=lnlinks href=#hl-60-15>15</a>
</span><span class=lnt id=hl-60-16><a class=lnlinks href=#hl-60-16>16</a>
</span><span class=lnt id=hl-60-17><a class=lnlinks href=#hl-60-17>17</a>
</span><span class=lnt id=hl-60-18><a class=lnlinks href=#hl-60-18>18</a>
</span><span class=lnt id=hl-60-19><a class=lnlinks href=#hl-60-19>19</a>
</span><span class=lnt id=hl-60-20><a class=lnlinks href=#hl-60-20>20</a>
</span><span class=lnt id=hl-60-21><a class=lnlinks href=#hl-60-21>21</a>
</span><span class=lnt id=hl-60-22><a class=lnlinks href=#hl-60-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 마스터 서버에서 복제 사용자 생성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>USER</span><span class=w> </span><span class=s1>&#39;repl_user&#39;</span><span class=o>@</span><span class=s1>&#39;%&#39;</span><span class=w> </span><span class=n>IDENTIFIED</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=s1>&#39;password&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GRANT</span><span class=w> </span><span class=n>REPLICATION</span><span class=w> </span><span class=n>SLAVE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=o>*</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=s1>&#39;repl_user&#39;</span><span class=o>@</span><span class=s1>&#39;%&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>FLUSH</span><span class=w> </span><span class=k>PRIVILEGES</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 마스터 상태 확인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SHOW</span><span class=w> </span><span class=n>MASTER</span><span class=w> </span><span class=n>STATUS</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 출력 결과에서 File 및 Position 값 기록
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 슬레이브 서버에서 복제 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>CHANGE</span><span class=w> </span><span class=n>MASTER</span><span class=w> </span><span class=k>TO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>MASTER_HOST</span><span class=o>=</span><span class=s1>&#39;master_server_ip&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>MASTER_USER</span><span class=o>=</span><span class=s1>&#39;repl_user&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>MASTER_PASSWORD</span><span class=o>=</span><span class=s1>&#39;password&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>MASTER_LOG_FILE</span><span class=o>=</span><span class=s1>&#39;mysql-bin.000001&#39;</span><span class=p>,</span><span class=w> </span><span class=c1>-- 마스터 상태에서 확인한 File 값
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>  </span><span class=n>MASTER_LOG_POS</span><span class=o>=</span><span class=mi>123</span><span class=p>;</span><span class=w>                </span><span class=c1>-- 마스터 상태에서 확인한 Position 값
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 슬레이브 시작
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>START</span><span class=w> </span><span class=n>SLAVE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 슬레이브 상태 확인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SHOW</span><span class=w> </span><span class=n>SLAVE</span><span class=w> </span><span class=n>STATUS</span><span class=err>\</span><span class=k>G</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=postgresql-복제-설정>PostgreSQL 복제 설정<a hidden class=anchor aria-hidden=true href=#postgresql-복제-설정>#</a></h4><p><strong>마스터 서버 설정 (postgresql.conf):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-61-1><a class=lnlinks href=#hl-61-1>1</a>
</span><span class=lnt id=hl-61-2><a class=lnlinks href=#hl-61-2>2</a>
</span><span class=lnt id=hl-61-3><a class=lnlinks href=#hl-61-3>3</a>
</span><span class=lnt id=hl-61-4><a class=lnlinks href=#hl-61-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 복제 설정
</span></span><span class=line><span class=cl>wal_level = replica
</span></span><span class=line><span class=cl>max_wal_senders = 10
</span></span><span class=line><span class=cl>wal_keep_segments = 32
</span></span></code></pre></td></tr></table></div></div><p><strong>마스터 서버 설정 (pg_hba.conf):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-62-1><a class=lnlinks href=#hl-62-1>1</a>
</span><span class=lnt id=hl-62-2><a class=lnlinks href=#hl-62-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 복제 연결 허용
</span></span><span class=line><span class=cl>host    replication     repl_user    slave_server_ip/32     md5
</span></span></code></pre></td></tr></table></div></div><p><strong>슬레이브 서버 설정:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-63-1><a class=lnlinks href=#hl-63-1>1</a>
</span><span class=lnt id=hl-63-2><a class=lnlinks href=#hl-63-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 초기 데이터 복사</span>
</span></span><span class=line><span class=cl>pg_basebackup -h master_server_ip -D /var/lib/postgresql/data -U repl_user -P -v -X stream
</span></span></code></pre></td></tr></table></div></div><p><strong>슬레이브 서버 설정 (recovery.conf):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-64-1><a class=lnlinks href=#hl-64-1>1</a>
</span><span class=lnt id=hl-64-2><a class=lnlinks href=#hl-64-2>2</a>
</span><span class=lnt id=hl-64-3><a class=lnlinks href=#hl-64-3>3</a>
</span><span class=lnt id=hl-64-4><a class=lnlinks href=#hl-64-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 복제 설정
</span></span><span class=line><span class=cl>standby_mode = &#39;on&#39;
</span></span><span class=line><span class=cl>primary_conninfo = &#39;host=master_server_ip port=5432 user=repl_user password=password&#39;
</span></span><span class=line><span class=cl>trigger_file = &#39;/tmp/postgresql.trigger&#39;
</span></span></code></pre></td></tr></table></div></div><h4 id=애플리케이션에서의-복제-활용>애플리케이션에서의 복제 활용<a hidden class=anchor aria-hidden=true href=#애플리케이션에서의-복제-활용>#</a></h4><p>복제 구성을 최대한 활용하려면 애플리케이션에서 읽기 및 쓰기 작업을 적절하게 분리해야 한다.</p><p><strong>Java/Spring Boot 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-65-1><a class=lnlinks href=#hl-65-1> 1</a>
</span><span class=lnt id=hl-65-2><a class=lnlinks href=#hl-65-2> 2</a>
</span><span class=lnt id=hl-65-3><a class=lnlinks href=#hl-65-3> 3</a>
</span><span class=lnt id=hl-65-4><a class=lnlinks href=#hl-65-4> 4</a>
</span><span class=lnt id=hl-65-5><a class=lnlinks href=#hl-65-5> 5</a>
</span><span class=lnt id=hl-65-6><a class=lnlinks href=#hl-65-6> 6</a>
</span><span class=lnt id=hl-65-7><a class=lnlinks href=#hl-65-7> 7</a>
</span><span class=lnt id=hl-65-8><a class=lnlinks href=#hl-65-8> 8</a>
</span><span class=lnt id=hl-65-9><a class=lnlinks href=#hl-65-9> 9</a>
</span><span class=lnt id=hl-65-10><a class=lnlinks href=#hl-65-10>10</a>
</span><span class=lnt id=hl-65-11><a class=lnlinks href=#hl-65-11>11</a>
</span><span class=lnt id=hl-65-12><a class=lnlinks href=#hl-65-12>12</a>
</span><span class=lnt id=hl-65-13><a class=lnlinks href=#hl-65-13>13</a>
</span><span class=lnt id=hl-65-14><a class=lnlinks href=#hl-65-14>14</a>
</span><span class=lnt id=hl-65-15><a class=lnlinks href=#hl-65-15>15</a>
</span><span class=lnt id=hl-65-16><a class=lnlinks href=#hl-65-16>16</a>
</span><span class=lnt id=hl-65-17><a class=lnlinks href=#hl-65-17>17</a>
</span><span class=lnt id=hl-65-18><a class=lnlinks href=#hl-65-18>18</a>
</span><span class=lnt id=hl-65-19><a class=lnlinks href=#hl-65-19>19</a>
</span><span class=lnt id=hl-65-20><a class=lnlinks href=#hl-65-20>20</a>
</span><span class=lnt id=hl-65-21><a class=lnlinks href=#hl-65-21>21</a>
</span><span class=lnt id=hl-65-22><a class=lnlinks href=#hl-65-22>22</a>
</span><span class=lnt id=hl-65-23><a class=lnlinks href=#hl-65-23>23</a>
</span><span class=lnt id=hl-65-24><a class=lnlinks href=#hl-65-24>24</a>
</span><span class=lnt id=hl-65-25><a class=lnlinks href=#hl-65-25>25</a>
</span><span class=lnt id=hl-65-26><a class=lnlinks href=#hl-65-26>26</a>
</span><span class=lnt id=hl-65-27><a class=lnlinks href=#hl-65-27>27</a>
</span><span class=lnt id=hl-65-28><a class=lnlinks href=#hl-65-28>28</a>
</span><span class=lnt id=hl-65-29><a class=lnlinks href=#hl-65-29>29</a>
</span><span class=lnt id=hl-65-30><a class=lnlinks href=#hl-65-30>30</a>
</span><span class=lnt id=hl-65-31><a class=lnlinks href=#hl-65-31>31</a>
</span><span class=lnt id=hl-65-32><a class=lnlinks href=#hl-65-32>32</a>
</span><span class=lnt id=hl-65-33><a class=lnlinks href=#hl-65-33>33</a>
</span><span class=lnt id=hl-65-34><a class=lnlinks href=#hl-65-34>34</a>
</span><span class=lnt id=hl-65-35><a class=lnlinks href=#hl-65-35>35</a>
</span><span class=lnt id=hl-65-36><a class=lnlinks href=#hl-65-36>36</a>
</span><span class=lnt id=hl-65-37><a class=lnlinks href=#hl-65-37>37</a>
</span><span class=lnt id=hl-65-38><a class=lnlinks href=#hl-65-38>38</a>
</span><span class=lnt id=hl-65-39><a class=lnlinks href=#hl-65-39>39</a>
</span><span class=lnt id=hl-65-40><a class=lnlinks href=#hl-65-40>40</a>
</span><span class=lnt id=hl-65-41><a class=lnlinks href=#hl-65-41>41</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DataSourceConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Primary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ConfigurationProperties</span><span class=p>(</span><span class=s>&#34;spring.datasource.master&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=nf>masterDataSource</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>DataSourceBuilder</span><span class=p>.</span><span class=na>create</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ConfigurationProperties</span><span class=p>(</span><span class=s>&#34;spring.datasource.slave&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=nf>slaveDataSource</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>DataSourceBuilder</span><span class=p>.</span><span class=na>create</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=nf>routingDataSource</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Qualifier</span><span class=p>(</span><span class=s>&#34;masterDataSource&#34;</span><span class=p>)</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=n>masterDataSource</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Qualifier</span><span class=p>(</span><span class=s>&#34;slaveDataSource&#34;</span><span class=p>)</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=n>slaveDataSource</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ReplicationRoutingDataSource</span><span class=w> </span><span class=n>routingDataSource</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ReplicationRoutingDataSource</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Object</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>dataSources</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dataSources</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;master&#34;</span><span class=p>,</span><span class=w> </span><span class=n>masterDataSource</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dataSources</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;slave&#34;</span><span class=p>,</span><span class=w> </span><span class=n>slaveDataSource</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>routingDataSource</span><span class=p>.</span><span class=na>setTargetDataSources</span><span class=p>(</span><span class=n>dataSources</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>routingDataSource</span><span class=p>.</span><span class=na>setDefaultTargetDataSource</span><span class=p>(</span><span class=n>masterDataSource</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>routingDataSource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 트랜잭션 타입에 따라 데이터 소스 선택</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ReplicationRoutingDataSource</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AbstractRoutingDataSource</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>determineCurrentLookupKey</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>TransactionSynchronizationManager</span><span class=p>.</span><span class=na>isCurrentTransactionReadOnly</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=o>?</span><span class=w> </span><span class=s>&#34;slave&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=s>&#34;master&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>애플리케이션 속성 설정:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-66-1><a class=lnlinks href=#hl-66-1> 1</a>
</span><span class=lnt id=hl-66-2><a class=lnlinks href=#hl-66-2> 2</a>
</span><span class=lnt id=hl-66-3><a class=lnlinks href=#hl-66-3> 3</a>
</span><span class=lnt id=hl-66-4><a class=lnlinks href=#hl-66-4> 4</a>
</span><span class=lnt id=hl-66-5><a class=lnlinks href=#hl-66-5> 5</a>
</span><span class=lnt id=hl-66-6><a class=lnlinks href=#hl-66-6> 6</a>
</span><span class=lnt id=hl-66-7><a class=lnlinks href=#hl-66-7> 7</a>
</span><span class=lnt id=hl-66-8><a class=lnlinks href=#hl-66-8> 8</a>
</span><span class=lnt id=hl-66-9><a class=lnlinks href=#hl-66-9> 9</a>
</span><span class=lnt id=hl-66-10><a class=lnlinks href=#hl-66-10>10</a>
</span><span class=lnt id=hl-66-11><a class=lnlinks href=#hl-66-11>11</a>
</span><span class=lnt id=hl-66-12><a class=lnlinks href=#hl-66-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>spring</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>datasource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>master</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>jdbc:mysql://master-db:3306/myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>app_user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>driver-class-name</span><span class=p>:</span><span class=w> </span><span class=l>com.mysql.cj.jdbc.Driver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>slave</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>jdbc:mysql://slave-db:3306/myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>app_user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>driver-class-name</span><span class=p>:</span><span class=w> </span><span class=l>com.mysql.cj.jdbc.Driver</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>서비스 계층 구현:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-67-1><a class=lnlinks href=#hl-67-1> 1</a>
</span><span class=lnt id=hl-67-2><a class=lnlinks href=#hl-67-2> 2</a>
</span><span class=lnt id=hl-67-3><a class=lnlinks href=#hl-67-3> 3</a>
</span><span class=lnt id=hl-67-4><a class=lnlinks href=#hl-67-4> 4</a>
</span><span class=lnt id=hl-67-5><a class=lnlinks href=#hl-67-5> 5</a>
</span><span class=lnt id=hl-67-6><a class=lnlinks href=#hl-67-6> 6</a>
</span><span class=lnt id=hl-67-7><a class=lnlinks href=#hl-67-7> 7</a>
</span><span class=lnt id=hl-67-8><a class=lnlinks href=#hl-67-8> 8</a>
</span><span class=lnt id=hl-67-9><a class=lnlinks href=#hl-67-9> 9</a>
</span><span class=lnt id=hl-67-10><a class=lnlinks href=#hl-67-10>10</a>
</span><span class=lnt id=hl-67-11><a class=lnlinks href=#hl-67-11>11</a>
</span><span class=lnt id=hl-67-12><a class=lnlinks href=#hl-67-12>12</a>
</span><span class=lnt id=hl-67-13><a class=lnlinks href=#hl-67-13>13</a>
</span><span class=lnt id=hl-67-14><a class=lnlinks href=#hl-67-14>14</a>
</span><span class=lnt id=hl-67-15><a class=lnlinks href=#hl-67-15>15</a>
</span><span class=lnt id=hl-67-16><a class=lnlinks href=#hl-67-16>16</a>
</span><span class=lnt id=hl-67-17><a class=lnlinks href=#hl-67-17>17</a>
</span><span class=lnt id=hl-67-18><a class=lnlinks href=#hl-67-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ProductService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ProductRepository</span><span class=w> </span><span class=n>productRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 읽기 전용 트랜잭션 (슬레이브 데이터 소스 사용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=p>(</span><span class=n>readOnly</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getAllProducts</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productRepository</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 쓰기 트랜잭션 (마스터 데이터 소스 사용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=nf>createProduct</span><span class=p>(</span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>productRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>product</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=복제-모니터링-및-관리>복제 모니터링 및 관리<a hidden class=anchor aria-hidden=true href=#복제-모니터링-및-관리>#</a></h4><p>복제 환경을 안정적으로 운영하려면 다음 사항을 모니터링해야 한다:</p><ol><li><strong>복제 지연(Replication Lag)</strong>: 마스터와 슬레이브 간의 데이터 동기화 지연 시간</li><li><strong>복제 오류</strong>: 복제 프로세스 중 발생하는 오류</li><li><strong>연결 상태</strong>: 마스터와 슬레이브 간의 연결 상태</li><li><strong>디스크 공간</strong>: 특히 바이너리 로그 및 릴레이 로그 크기</li></ol><p><strong>MySQL 복제 모니터링 쿼리:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-68-1><a class=lnlinks href=#hl-68-1>1</a>
</span><span class=lnt id=hl-68-2><a class=lnlinks href=#hl-68-2>2</a>
</span><span class=lnt id=hl-68-3><a class=lnlinks href=#hl-68-3>3</a>
</span><span class=lnt id=hl-68-4><a class=lnlinks href=#hl-68-4>4</a>
</span><span class=lnt id=hl-68-5><a class=lnlinks href=#hl-68-5>5</a>
</span><span class=lnt id=hl-68-6><a class=lnlinks href=#hl-68-6>6</a>
</span><span class=lnt id=hl-68-7><a class=lnlinks href=#hl-68-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 슬레이브 상태 확인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SHOW</span><span class=w> </span><span class=n>SLAVE</span><span class=w> </span><span class=n>STATUS</span><span class=err>\</span><span class=k>G</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 주요 확인 사항:
</span></span></span><span class=line><span class=cl><span class=c1>-- Slave_IO_Running: Yes
</span></span></span><span class=line><span class=cl><span class=c1>-- Slave_SQL_Running: Yes
</span></span></span><span class=line><span class=cl><span class=c1>-- Seconds_Behind_Master: 복제 지연 시간 (초)
</span></span></span></code></pre></td></tr></table></div></div><p><strong>PostgreSQL 복제 모니터링 쿼리:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-69-1><a class=lnlinks href=#hl-69-1>1</a>
</span><span class=lnt id=hl-69-2><a class=lnlinks href=#hl-69-2>2</a>
</span><span class=lnt id=hl-69-3><a class=lnlinks href=#hl-69-3>3</a>
</span><span class=lnt id=hl-69-4><a class=lnlinks href=#hl-69-4>4</a>
</span><span class=lnt id=hl-69-5><a class=lnlinks href=#hl-69-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 복제 상태 확인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pg_stat_replication</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 복제 지연 확인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>now</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>pg_last_xact_replay_timestamp</span><span class=p>()</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>replication_lag</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=복제-장애-대응>복제 장애 대응<a hidden class=anchor aria-hidden=true href=#복제-장애-대응>#</a></h4><p>복제 장애 발생 시 대응 방법이다:</p><ol><li><p><strong>슬레이브 재동기화</strong>: 복제가 중단된 경우 슬레이브를 재동기화</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-70-1><a class=lnlinks href=#hl-70-1>1</a>
</span><span class=lnt id=hl-70-2><a class=lnlinks href=#hl-70-2>2</a>
</span><span class=lnt id=hl-70-3><a class=lnlinks href=#hl-70-3>3</a>
</span><span class=lnt id=hl-70-4><a class=lnlinks href=#hl-70-4>4</a>
</span><span class=lnt id=hl-70-5><a class=lnlinks href=#hl-70-5>5</a>
</span><span class=lnt id=hl-70-6><a class=lnlinks href=#hl-70-6>6</a>
</span><span class=lnt id=hl-70-7><a class=lnlinks href=#hl-70-7>7</a>
</span><span class=lnt id=hl-70-8><a class=lnlinks href=#hl-70-8>8</a>
</span><span class=lnt id=hl-70-9><a class=lnlinks href=#hl-70-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- MySQL 슬레이브 재동기화
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>STOP</span><span class=w> </span><span class=n>SLAVE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>CHANGE</span><span class=w> </span><span class=n>MASTER</span><span class=w> </span><span class=k>TO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>MASTER_LOG_FILE</span><span class=o>=</span><span class=s1>&#39;mysql-bin.000001&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>MASTER_LOG_POS</span><span class=o>=</span><span class=mi>123</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>START</span><span class=w> </span><span class=n>SLAVE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- PostgreSQL 슬레이브 재동기화
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>pg_basebackup</span><span class=w> </span><span class=o>-</span><span class=n>h</span><span class=w> </span><span class=n>master_server_ip</span><span class=w> </span><span class=o>-</span><span class=n>D</span><span class=w> </span><span class=o>/</span><span class=n>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>postgresql</span><span class=o>/</span><span class=k>data</span><span class=w> </span><span class=o>-</span><span class=n>U</span><span class=w> </span><span class=n>repl_user</span><span class=w> </span><span class=o>-</span><span class=n>P</span><span class=w> </span><span class=o>-</span><span class=n>v</span><span class=w> </span><span class=o>-</span><span class=n>X</span><span class=w> </span><span class=n>stream</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>마스터 장애 대응(장애 조치, Failover)</strong>: 마스터 서버 장애 시 슬레이브를 마스터로 승격</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-71-1><a class=lnlinks href=#hl-71-1>1</a>
</span><span class=lnt id=hl-71-2><a class=lnlinks href=#hl-71-2>2</a>
</span><span class=lnt id=hl-71-3><a class=lnlinks href=#hl-71-3>3</a>
</span><span class=lnt id=hl-71-4><a class=lnlinks href=#hl-71-4>4</a>
</span><span class=lnt id=hl-71-5><a class=lnlinks href=#hl-71-5>5</a>
</span><span class=lnt id=hl-71-6><a class=lnlinks href=#hl-71-6>6</a>
</span><span class=lnt id=hl-71-7><a class=lnlinks href=#hl-71-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- MySQL 슬레이브를 마스터로 승격
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>STOP</span><span class=w> </span><span class=n>SLAVE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>RESET</span><span class=w> </span><span class=n>SLAVE</span><span class=w> </span><span class=k>ALL</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>read_only</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>OFF</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- PostgreSQL 슬레이브를 마스터로 승격
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>touch</span><span class=w> </span><span class=o>/</span><span class=n>tmp</span><span class=o>/</span><span class=n>postgresql</span><span class=p>.</span><span class=k>trigger</span><span class=w>  </span><span class=c1>-- recovery.conf에 지정된 트리거 파일 생성
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=database-sharding-for-data-distribution>Database Sharding for Data Distribution<a hidden class=anchor aria-hidden=true href=#database-sharding-for-data-distribution>#</a></h3><h4 id=샤딩의-개념>샤딩의 개념<a hidden class=anchor aria-hidden=true href=#샤딩의-개념>#</a></h4><p>샤딩은 대규모 데이터베이스를 더 작고 관리하기 쉬운 조각(샤드)으로 분할하는 기술이다. 각 샤드는 별도의 서버에 호스팅되어 부하를 분산시킨다.</p><h4 id=샤딩-전략>샤딩 전략<a hidden class=anchor aria-hidden=true href=#샤딩-전략>#</a></h4><ol><li><p><strong>수평 샤딩(Horizontal Sharding)</strong>: 동일한 스키마를 가진 여러 서버에 행을 분산</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-72-1><a class=lnlinks href=#hl-72-1>1</a>
</span><span class=lnt id=hl-72-2><a class=lnlinks href=#hl-72-2>2</a>
</span><span class=lnt id=hl-72-3><a class=lnlinks href=#hl-72-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>서버 1: 고객 ID 1-1000
</span></span><span class=line><span class=cl>서버 2: 고객 ID 1001-2000
</span></span><span class=line><span class=cl>서버 3: 고객 ID 2001-3000
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>수직 샤딩(Vertical Sharding)</strong>: 테이블 또는 스키마를 여러 서버에 분산</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-73-1><a class=lnlinks href=#hl-73-1>1</a>
</span><span class=lnt id=hl-73-2><a class=lnlinks href=#hl-73-2>2</a>
</span><span class=lnt id=hl-73-3><a class=lnlinks href=#hl-73-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>서버 1: 고객, 주문 테이블
</span></span><span class=line><span class=cl>서버 2: 제품, 인벤토리 테이블
</span></span><span class=line><span class=cl>서버 3: 결제, 배송 테이블
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>디렉토리 기반 샤딩</strong>: 중앙 디렉토리를 사용하여 데이터 위치 추적</p></li></ol><h4 id=샤딩-키-선택>샤딩 키 선택<a hidden class=anchor aria-hidden=true href=#샤딩-키-선택>#</a></h4><p>샤딩 키는 데이터를 어떤 샤드에 배치할지 결정하는 중요한 요소이다.</p><p><strong>좋은 샤딩 키의 특성:</strong></p><ol><li>균등한 데이터 분포</li><li>최소한의 크로스-샤드 쿼리</li><li>확장성 고려</li></ol><p><strong>일반적인 샤딩 키:</strong></p><ul><li>고객 ID</li><li>지리적 위치</li><li>날짜/시간</li><li>해시 값</li></ul><h4 id=샤딩-구현-방법>샤딩 구현 방법<a hidden class=anchor aria-hidden=true href=#샤딩-구현-방법>#</a></h4><ol><li><p><strong>애플리케이션 레벨 샤딩</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-74-1><a class=lnlinks href=#hl-74-1> 1</a>
</span><span class=lnt id=hl-74-2><a class=lnlinks href=#hl-74-2> 2</a>
</span><span class=lnt id=hl-74-3><a class=lnlinks href=#hl-74-3> 3</a>
</span><span class=lnt id=hl-74-4><a class=lnlinks href=#hl-74-4> 4</a>
</span><span class=lnt id=hl-74-5><a class=lnlinks href=#hl-74-5> 5</a>
</span><span class=lnt id=hl-74-6><a class=lnlinks href=#hl-74-6> 6</a>
</span><span class=lnt id=hl-74-7><a class=lnlinks href=#hl-74-7> 7</a>
</span><span class=lnt id=hl-74-8><a class=lnlinks href=#hl-74-8> 8</a>
</span><span class=lnt id=hl-74-9><a class=lnlinks href=#hl-74-9> 9</a>
</span><span class=lnt id=hl-74-10><a class=lnlinks href=#hl-74-10>10</a>
</span><span class=lnt id=hl-74-11><a class=lnlinks href=#hl-74-11>11</a>
</span><span class=lnt id=hl-74-12><a class=lnlinks href=#hl-74-12>12</a>
</span><span class=lnt id=hl-74-13><a class=lnlinks href=#hl-74-13>13</a>
</span><span class=lnt id=hl-74-14><a class=lnlinks href=#hl-74-14>14</a>
</span><span class=lnt id=hl-74-15><a class=lnlinks href=#hl-74-15>15</a>
</span><span class=lnt id=hl-74-16><a class=lnlinks href=#hl-74-16>16</a>
</span><span class=lnt id=hl-74-17><a class=lnlinks href=#hl-74-17>17</a>
</span><span class=lnt id=hl-74-18><a class=lnlinks href=#hl-74-18>18</a>
</span><span class=lnt id=hl-74-19><a class=lnlinks href=#hl-74-19>19</a>
</span><span class=lnt id=hl-74-20><a class=lnlinks href=#hl-74-20>20</a>
</span><span class=lnt id=hl-74-21><a class=lnlinks href=#hl-74-21>21</a>
</span><span class=lnt id=hl-74-22><a class=lnlinks href=#hl-74-22>22</a>
</span><span class=lnt id=hl-74-23><a class=lnlinks href=#hl-74-23>23</a>
</span><span class=lnt id=hl-74-24><a class=lnlinks href=#hl-74-24>24</a>
</span><span class=lnt id=hl-74-25><a class=lnlinks href=#hl-74-25>25</a>
</span><span class=lnt id=hl-74-26><a class=lnlinks href=#hl-74-26>26</a>
</span><span class=lnt id=hl-74-27><a class=lnlinks href=#hl-74-27>27</a>
</span><span class=lnt id=hl-74-28><a class=lnlinks href=#hl-74-28>28</a>
</span><span class=lnt id=hl-74-29><a class=lnlinks href=#hl-74-29>29</a>
</span><span class=lnt id=hl-74-30><a class=lnlinks href=#hl-74-30>30</a>
</span><span class=lnt id=hl-74-31><a class=lnlinks href=#hl-74-31>31</a>
</span><span class=lnt id=hl-74-32><a class=lnlinks href=#hl-74-32>32</a>
</span><span class=lnt id=hl-74-33><a class=lnlinks href=#hl-74-33>33</a>
</span><span class=lnt id=hl-74-34><a class=lnlinks href=#hl-74-34>34</a>
</span><span class=lnt id=hl-74-35><a class=lnlinks href=#hl-74-35>35</a>
</span><span class=lnt id=hl-74-36><a class=lnlinks href=#hl-74-36>36</a>
</span><span class=lnt id=hl-74-37><a class=lnlinks href=#hl-74-37>37</a>
</span><span class=lnt id=hl-74-38><a class=lnlinks href=#hl-74-38>38</a>
</span><span class=lnt id=hl-74-39><a class=lnlinks href=#hl-74-39>39</a>
</span><span class=lnt id=hl-74-40><a class=lnlinks href=#hl-74-40>40</a>
</span><span class=lnt id=hl-74-41><a class=lnlinks href=#hl-74-41>41</a>
</span><span class=lnt id=hl-74-42><a class=lnlinks href=#hl-74-42>42</a>
</span><span class=lnt id=hl-74-43><a class=lnlinks href=#hl-74-43>43</a>
</span><span class=lnt id=hl-74-44><a class=lnlinks href=#hl-74-44>44</a>
</span><span class=lnt id=hl-74-45><a class=lnlinks href=#hl-74-45>45</a>
</span><span class=lnt id=hl-74-46><a class=lnlinks href=#hl-74-46>46</a>
</span><span class=lnt id=hl-74-47><a class=lnlinks href=#hl-74-47>47</a>
</span><span class=lnt id=hl-74-48><a class=lnlinks href=#hl-74-48>48</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ShardingDataSource</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Integer</span><span class=p>,</span><span class=w> </span><span class=n>DataSource</span><span class=o>&gt;</span><span class=w> </span><span class=n>shards</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ShardingDataSource</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 샤드 데이터 소스 초기화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>shards</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>createDataSource</span><span class=p>(</span><span class=s>&#34;jdbc:mysql://shard0:3306/myapp&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>shards</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>createDataSource</span><span class=p>(</span><span class=s>&#34;jdbc:mysql://shard1:3306/myapp&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>shards</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>createDataSource</span><span class=p>(</span><span class=s>&#34;jdbc:mysql://shard2:3306/myapp&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=nf>getShardForCustomerId</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>customerId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 고객 ID를 샤드 번호로 매핑 (모듈로 샤딩)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>shardNumber</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>customerId</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>shards</span><span class=p>.</span><span class=na>size</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>shards</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>shardNumber</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=nf>createDataSource</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>url</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HikariConfig</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HikariConfig</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setJdbcUrl</span><span class=p>(</span><span class=n>url</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HikariDataSource</span><span class=p>(</span><span class=n>config</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CustomerService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ShardingDataSource</span><span class=w> </span><span class=n>shardingDataSource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Customer</span><span class=w> </span><span class=nf>getCustomerById</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>customerId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 적절한 샤드 결정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DataSource</span><span class=w> </span><span class=n>shard</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>shardingDataSource</span><span class=p>.</span><span class=na>getShardForCustomerId</span><span class=p>(</span><span class=n>customerId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 선택한 샤드에서 고객 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JdbcTemplate</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JdbcTemplate</span><span class=p>(</span><span class=n>shard</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>queryForObject</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;SELECT * FROM customers WHERE id = ?&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=p>{</span><span class=n>customerId</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>(</span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>rowNum</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Customer</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rs</span><span class=p>.</span><span class=na>getLong</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rs</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;name&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rs</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;email&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>샤딩 미들웨어 사용</strong>:<br>여러 데이터베이스 시스템은 샤딩을 지원하는 미들웨어를 제공한다:</p><ul><li>MySQL: MySQL Cluster, Vitess</li><li>PostgreSQL: Citus, Postgres-XL</li><li>MongoDB: 내장 샤딩 기능</li><li>범용: ShardingSphere, Apache GORA</li></ul><p><strong>Vitess 설정 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-75-1><a class=lnlinks href=#hl-75-1> 1</a>
</span><span class=lnt id=hl-75-2><a class=lnlinks href=#hl-75-2> 2</a>
</span><span class=lnt id=hl-75-3><a class=lnlinks href=#hl-75-3> 3</a>
</span><span class=lnt id=hl-75-4><a class=lnlinks href=#hl-75-4> 4</a>
</span><span class=lnt id=hl-75-5><a class=lnlinks href=#hl-75-5> 5</a>
</span><span class=lnt id=hl-75-6><a class=lnlinks href=#hl-75-6> 6</a>
</span><span class=lnt id=hl-75-7><a class=lnlinks href=#hl-75-7> 7</a>
</span><span class=lnt id=hl-75-8><a class=lnlinks href=#hl-75-8> 8</a>
</span><span class=lnt id=hl-75-9><a class=lnlinks href=#hl-75-9> 9</a>
</span><span class=lnt id=hl-75-10><a class=lnlinks href=#hl-75-10>10</a>
</span><span class=lnt id=hl-75-11><a class=lnlinks href=#hl-75-11>11</a>
</span><span class=lnt id=hl-75-12><a class=lnlinks href=#hl-75-12>12</a>
</span><span class=lnt id=hl-75-13><a class=lnlinks href=#hl-75-13>13</a>
</span><span class=lnt id=hl-75-14><a class=lnlinks href=#hl-75-14>14</a>
</span><span class=lnt id=hl-75-15><a class=lnlinks href=#hl-75-15>15</a>
</span><span class=lnt id=hl-75-16><a class=lnlinks href=#hl-75-16>16</a>
</span><span class=lnt id=hl-75-17><a class=lnlinks href=#hl-75-17>17</a>
</span><span class=lnt id=hl-75-18><a class=lnlinks href=#hl-75-18>18</a>
</span><span class=lnt id=hl-75-19><a class=lnlinks href=#hl-75-19>19</a>
</span><span class=lnt id=hl-75-20><a class=lnlinks href=#hl-75-20>20</a>
</span><span class=lnt id=hl-75-21><a class=lnlinks href=#hl-75-21>21</a>
</span><span class=lnt id=hl-75-22><a class=lnlinks href=#hl-75-22>22</a>
</span><span class=lnt id=hl-75-23><a class=lnlinks href=#hl-75-23>23</a>
</span><span class=lnt id=hl-75-24><a class=lnlinks href=#hl-75-24>24</a>
</span><span class=lnt id=hl-75-25><a class=lnlinks href=#hl-75-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># vitess 토폴로지 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>topo_cell</span><span class=p>:</span><span class=w> </span><span class=l>local</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>topo_implementation</span><span class=p>:</span><span class=w> </span><span class=l>etcd2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>topo_global_root</span><span class=p>:</span><span class=w> </span><span class=l>/vitess/global</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>topo_global_server_address</span><span class=p>:</span><span class=w> </span><span class=l>localhost:2379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># keyspace 정의 (MySQL의 데이터베이스에 해당)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>keyspaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>customer_keyspace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sharding_strategy</span><span class=p>:</span><span class=w> </span><span class=l>customer_id_hash</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>replica_count</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rdonly_count</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 샤드 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>shards</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>db_name_override</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;vt_customer_0000000000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key_range</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>start</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>end</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8000000000000000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>db_name_override</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;vt_customer_8000000000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key_range</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>start</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8000000000000000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>end</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>클라우드 기반 샤딩 서비스</strong>:<br>많은 클라우드 제공업체가 자동 샤딩을 지원하는 분산 데이터베이스 서비스를 제공한다:</p><ul><li>Amazon Aurora</li><li>Google Cloud Spanner</li><li>Azure Cosmos DB</li></ul></li></ol><h4 id=샤딩의-과제와-해결-방법>샤딩의 과제와 해결 방법<a hidden class=anchor aria-hidden=true href=#샤딩의-과제와-해결-방법>#</a></h4><ol><li><strong>크로스-샤드 쿼리</strong>:<ul><li>문제: 여러 샤드에 걸친 데이터 조회 필요</li><li>해결책: 샤드 간 조인 최소화, 쿼리 팬아웃, 결과 집계</li></ul></li><li><strong>분산 트랜잭션</strong>:<ul><li>문제: 여러 샤드에 걸친 트랜잭션 일관성</li><li>해결책: 2단계 커밋 프로토콜, 분산 트랜잭션 관리자</li></ul></li><li><strong>스키마 변경</strong>:<ul><li>문제: 여러 샤드에서 일관된 스키마 변경 관리</li><li>해결책: 롤링 업데이트, 스키마 버전 관리</li></ul></li><li><strong>샤드 재분배</strong>:<ul><li>문제: 데이터 증가에 따른 샤드 재조정 필요</li><li>해결책: 일관성 해시, 온라인 마이그레이션 도구</li></ul></li><li><strong>ID 생성</strong>:<ul><li>문제: 분산 환경에서 고유 ID 생성</li><li>해결책: UUID, Snowflake ID, 중앙 ID 생성기</li></ul></li></ol><h3 id=use-of-profiling-tools-in-database-management>Use of Profiling Tools in Database Management<a hidden class=anchor aria-hidden=true href=#use-of-profiling-tools-in-database-management>#</a></h3><h4 id=프로파일링-도구의-중요성>프로파일링 도구의 중요성<a hidden class=anchor aria-hidden=true href=#프로파일링-도구의-중요성>#</a></h4><p>데이터베이스 프로파일링 도구는 성능 병목 지점을 식별하고 최적화 기회를 발견하는 데 필수적이다.</p><h4 id=주요-데이터베이스-프로파일링-도구>주요 데이터베이스 프로파일링 도구<a hidden class=anchor aria-hidden=true href=#주요-데이터베이스-프로파일링-도구>#</a></h4><ol><li><p><strong>MySQL 프로파일링 도구</strong>:</p><ul><li><strong>Performance Schema</strong>: MySQL 내장 모니터링 시스템</li><li><strong>MySQL Enterprise Monitor</strong>: Oracle의 상용 모니터링 도구</li><li><strong>Percona Toolkit</strong>: 다양한 성능 분석 도구 모음</li><li><strong>MySQL Workbench</strong>: 쿼리 실행 계획 분석 도구</li></ul><p><strong>Performance Schema 활성화:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-76-1><a class=lnlinks href=#hl-76-1> 1</a>
</span><span class=lnt id=hl-76-2><a class=lnlinks href=#hl-76-2> 2</a>
</span><span class=lnt id=hl-76-3><a class=lnlinks href=#hl-76-3> 3</a>
</span><span class=lnt id=hl-76-4><a class=lnlinks href=#hl-76-4> 4</a>
</span><span class=lnt id=hl-76-5><a class=lnlinks href=#hl-76-5> 5</a>
</span><span class=lnt id=hl-76-6><a class=lnlinks href=#hl-76-6> 6</a>
</span><span class=lnt id=hl-76-7><a class=lnlinks href=#hl-76-7> 7</a>
</span><span class=lnt id=hl-76-8><a class=lnlinks href=#hl-76-8> 8</a>
</span><span class=lnt id=hl-76-9><a class=lnlinks href=#hl-76-9> 9</a>
</span><span class=lnt id=hl-76-10><a class=lnlinks href=#hl-76-10>10</a>
</span><span class=lnt id=hl-76-11><a class=lnlinks href=#hl-76-11>11</a>
</span><span class=lnt id=hl-76-12><a class=lnlinks href=#hl-76-12>12</a>
</span><span class=lnt id=hl-76-13><a class=lnlinks href=#hl-76-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- Performance Schema 활성화
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>performance_schema</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>ON</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 특정 이벤트 모니터링 활성화
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>performance_schema</span><span class=p>.</span><span class=n>setup_instruments</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>ENABLED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;YES&#39;</span><span class=p>,</span><span class=w> </span><span class=n>TIMED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;YES&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>NAME</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;statement/%&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 주요 쿼리 통계 확인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>DIGEST_TEXT</span><span class=p>,</span><span class=w> </span><span class=n>COUNT_STAR</span><span class=p>,</span><span class=w> </span><span class=n>AVG_TIMER_WAIT</span><span class=p>,</span><span class=w> </span><span class=n>MAX_TIMER_WAIT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>performance_schema</span><span class=p>.</span><span class=n>events_statements_summary_by_digest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>AVG_TIMER_WAIT</span><span class=w> </span><span class=k>DESC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>PostgreSQL 프로파일링 도구</strong>:</p><ul><li><strong>pg_stat_statements</strong>: 쿼리 실행 통계 수집</li><li><strong>auto_explain</strong>: 쿼리 실행 계획 자동 로깅</li><li><strong>pgBadger</strong>: 로그 기반 성능 분석 도구</li><li><strong>pg_stat_activity</strong>: 활성 세션 모니터링</li></ul><p><strong>pg_stat_statements 활성화:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-77-1><a class=lnlinks href=#hl-77-1> 1</a>
</span><span class=lnt id=hl-77-2><a class=lnlinks href=#hl-77-2> 2</a>
</span><span class=lnt id=hl-77-3><a class=lnlinks href=#hl-77-3> 3</a>
</span><span class=lnt id=hl-77-4><a class=lnlinks href=#hl-77-4> 4</a>
</span><span class=lnt id=hl-77-5><a class=lnlinks href=#hl-77-5> 5</a>
</span><span class=lnt id=hl-77-6><a class=lnlinks href=#hl-77-6> 6</a>
</span><span class=lnt id=hl-77-7><a class=lnlinks href=#hl-77-7> 7</a>
</span><span class=lnt id=hl-77-8><a class=lnlinks href=#hl-77-8> 8</a>
</span><span class=lnt id=hl-77-9><a class=lnlinks href=#hl-77-9> 9</a>
</span><span class=lnt id=hl-77-10><a class=lnlinks href=#hl-77-10>10</a>
</span><span class=lnt id=hl-77-11><a class=lnlinks href=#hl-77-11>11</a>
</span><span class=lnt id=hl-77-12><a class=lnlinks href=#hl-77-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- postgresql.conf 설정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>shared_preload_libraries</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;pg_stat_statements&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>pg_stat_statements</span><span class=p>.</span><span class=n>track</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 확장 모듈 생성
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=n>EXTENSION</span><span class=w> </span><span class=n>pg_stat_statements</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 쿼리 통계 확인
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>query</span><span class=p>,</span><span class=w> </span><span class=n>calls</span><span class=p>,</span><span class=w> </span><span class=n>total_time</span><span class=p>,</span><span class=w> </span><span class=n>mean_time</span><span class=p>,</span><span class=w> </span><span class=k>rows</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>pg_stat_statements</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>mean_time</span><span class=w> </span><span class=k>DESC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>범용 데이터베이스 프로파일링 도구</strong>:</p><ul><li><strong>Datadog</strong>: 클라우드 기반 모니터링 서비스</li><li><strong>New Relic</strong>: 애플리케이션 및 데이터베이스 성능 모니터링</li><li><strong>SolarWinds Database Performance Analyzer</strong>: 데이터베이스 성능 분석</li><li><strong>Prometheus + Grafana</strong>: 오픈 소스 모니터링 스택</li></ul></li></ol><h4 id=애플리케이션-레벨-sql-모니터링>애플리케이션 레벨 SQL 모니터링<a hidden class=anchor aria-hidden=true href=#애플리케이션-레벨-sql-모니터링>#</a></h4><p>애플리케이션에서 SQL 쿼리를 모니터링하는 방법이다:</p><ol><li><p><strong>Java/Spring Boot에서의 SQL 로깅:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-78-1><a class=lnlinks href=#hl-78-1>1</a>
</span><span class=lnt id=hl-78-2><a class=lnlinks href=#hl-78-2>2</a>
</span><span class=lnt id=hl-78-3><a class=lnlinks href=#hl-78-3>3</a>
</span><span class=lnt id=hl-78-4><a class=lnlinks href=#hl-78-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=c1># application.properties</span>
</span></span><span class=line><span class=cl><span class=na>spring.jpa.show-sql</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>spring.jpa.properties.hibernate.format_sql</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>logging.level.org.hibernate.type.descriptor.sql</span><span class=o>=</span><span class=s>trace</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>P6Spy를 사용한 고급 SQL 모니터링:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-79-1><a class=lnlinks href=#hl-79-1>1</a>
</span><span class=lnt id=hl-79-2><a class=lnlinks href=#hl-79-2>2</a>
</span><span class=lnt id=hl-79-3><a class=lnlinks href=#hl-79-3>3</a>
</span><span class=lnt id=hl-79-4><a class=lnlinks href=#hl-79-4>4</a>
</span><span class=lnt id=hl-79-5><a class=lnlinks href=#hl-79-5>5</a>
</span><span class=lnt id=hl-79-6><a class=lnlinks href=#hl-79-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- Maven 의존성 --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>p6spy<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>p6spy<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>3.9.1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-80-1><a class=lnlinks href=#hl-80-1>1</a>
</span><span class=lnt id=hl-80-2><a class=lnlinks href=#hl-80-2>2</a>
</span><span class=lnt id=hl-80-3><a class=lnlinks href=#hl-80-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=c1># application.properties</span>
</span></span><span class=line><span class=cl><span class=na>spring.datasource.driver-class-name</span><span class=o>=</span><span class=s>com.p6spy.engine.spy.P6SpyDriver</span>
</span></span><span class=line><span class=cl><span class=na>spring.datasource.url</span><span class=o>=</span><span class=s>jdbc:p6spy:mysql://localhost:3306/myapp</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-81-1><a class=lnlinks href=#hl-81-1>1</a>
</span><span class=lnt id=hl-81-2><a class=lnlinks href=#hl-81-2>2</a>
</span><span class=lnt id=hl-81-3><a class=lnlinks href=#hl-81-3>3</a>
</span><span class=lnt id=hl-81-4><a class=lnlinks href=#hl-81-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=c1># spy.properties</span>
</span></span><span class=line><span class=cl><span class=na>appender</span><span class=o>=</span><span class=s>com.p6spy.engine.spy.appender.Slf4JLogger</span>
</span></span><span class=line><span class=cl><span class=na>logMessageFormat</span><span class=o>=</span><span class=s>com.p6spy.engine.spy.appender.CustomLineFormat</span>
</span></span><span class=line><span class=cl><span class=na>customLogMessageFormat</span><span class=o>=</span><span class=s>Time: %(executionTime)ms | SQL: %(sqlSingleLine)</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=실행-계획-분석>실행 계획 분석<a hidden class=anchor aria-hidden=true href=#실행-계획-분석>#</a></h4><p>쿼리 실행 계획은 데이터베이스가 쿼리를 어떻게 실행할지 보여주는 로드맵이다.</p><p><strong>MySQL 실행 계획 분석:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-82-1><a class=lnlinks href=#hl-82-1>1</a>
</span><span class=lnt id=hl-82-2><a class=lnlinks href=#hl-82-2>2</a>
</span><span class=lnt id=hl-82-3><a class=lnlinks href=#hl-82-3>3</a>
</span><span class=lnt id=hl-82-4><a class=lnlinks href=#hl-82-4>4</a>
</span><span class=lnt id=hl-82-5><a class=lnlinks href=#hl-82-5>5</a>
</span><span class=lnt id=hl-82-6><a class=lnlinks href=#hl-82-6>6</a>
</span><span class=lnt id=hl-82-7><a class=lnlinks href=#hl-82-7>7</a>
</span><span class=lnt id=hl-82-8><a class=lnlinks href=#hl-82-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=p>,</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>oi</span><span class=p>.</span><span class=n>price</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>quantity</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>total</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>customer_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>order_items</span><span class=w> </span><span class=n>oi</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>order_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>country</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;USA&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=s1>&#39;2023-01-01&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=k>DESC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>PostgreSQL 실행 계획 분석:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-83-1><a class=lnlinks href=#hl-83-1>1</a>
</span><span class=lnt id=hl-83-2><a class=lnlinks href=#hl-83-2>2</a>
</span><span class=lnt id=hl-83-3><a class=lnlinks href=#hl-83-3>3</a>
</span><span class=lnt id=hl-83-4><a class=lnlinks href=#hl-83-4>4</a>
</span><span class=lnt id=hl-83-5><a class=lnlinks href=#hl-83-5>5</a>
</span><span class=lnt id=hl-83-6><a class=lnlinks href=#hl-83-6>6</a>
</span><span class=lnt id=hl-83-7><a class=lnlinks href=#hl-83-7>7</a>
</span><span class=lnt id=hl-83-8><a class=lnlinks href=#hl-83-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>EXPLAIN</span><span class=w> </span><span class=k>ANALYZE</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=p>,</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>oi</span><span class=p>.</span><span class=n>price</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>quantity</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>total</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>customer_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>order_items</span><span class=w> </span><span class=n>oi</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>order_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>country</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;USA&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=s1>&#39;2023-01-01&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=k>DESC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>실행 계획에서 주의해야 할 사항:</strong></p><ol><li>테이블 스캔(Full Table Scan): 대용량 테이블에서 인덱스 없이 전체 스캔</li><li>비효율적인 조인 방식: 특히 중첩 루프 조인(Nested Loop Join)</li><li>인덱스 미사용: 인덱스가 있음에도 사용되지 않는 경우</li><li>임시 테이블 생성: 정렬이나 그룹화에 임시 테이블 사용</li><li>비효율적인 정렬: 대용량 데이터의 외부 정렬</li></ol><h4 id=실시간-모니터링-및-알림>실시간 모니터링 및 알림<a hidden class=anchor aria-hidden=true href=#실시간-모니터링-및-알림>#</a></h4><p>지속적인 모니터링과 문제 발생 시 자동 알림은 사전 예방적 관리에 중요하다.</p><p><strong>프로메테우스 모니터링 설정 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-84-1><a class=lnlinks href=#hl-84-1>1</a>
</span><span class=lnt id=hl-84-2><a class=lnlinks href=#hl-84-2>2</a>
</span><span class=lnt id=hl-84-3><a class=lnlinks href=#hl-84-3>3</a>
</span><span class=lnt id=hl-84-4><a class=lnlinks href=#hl-84-4>4</a>
</span><span class=lnt id=hl-84-5><a class=lnlinks href=#hl-84-5>5</a>
</span><span class=lnt id=hl-84-6><a class=lnlinks href=#hl-84-6>6</a>
</span><span class=lnt id=hl-84-7><a class=lnlinks href=#hl-84-7>7</a>
</span><span class=lnt id=hl-84-8><a class=lnlinks href=#hl-84-8>8</a>
</span><span class=lnt id=hl-84-9><a class=lnlinks href=#hl-84-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># prometheus.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;mysql&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;mysql-exporter:9104&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;postgresql&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;postgres-exporter:9187&#39;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>그라파나 대시보드 예시:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-85-1><a class=lnlinks href=#hl-85-1> 1</a>
</span><span class=lnt id=hl-85-2><a class=lnlinks href=#hl-85-2> 2</a>
</span><span class=lnt id=hl-85-3><a class=lnlinks href=#hl-85-3> 3</a>
</span><span class=lnt id=hl-85-4><a class=lnlinks href=#hl-85-4> 4</a>
</span><span class=lnt id=hl-85-5><a class=lnlinks href=#hl-85-5> 5</a>
</span><span class=lnt id=hl-85-6><a class=lnlinks href=#hl-85-6> 6</a>
</span><span class=lnt id=hl-85-7><a class=lnlinks href=#hl-85-7> 7</a>
</span><span class=lnt id=hl-85-8><a class=lnlinks href=#hl-85-8> 8</a>
</span><span class=lnt id=hl-85-9><a class=lnlinks href=#hl-85-9> 9</a>
</span><span class=lnt id=hl-85-10><a class=lnlinks href=#hl-85-10>10</a>
</span><span class=lnt id=hl-85-11><a class=lnlinks href=#hl-85-11>11</a>
</span><span class=lnt id=hl-85-12><a class=lnlinks href=#hl-85-12>12</a>
</span><span class=lnt id=hl-85-13><a class=lnlinks href=#hl-85-13>13</a>
</span><span class=lnt id=hl-85-14><a class=lnlinks href=#hl-85-14>14</a>
</span><span class=lnt id=hl-85-15><a class=lnlinks href=#hl-85-15>15</a>
</span><span class=lnt id=hl-85-16><a class=lnlinks href=#hl-85-16>16</a>
</span><span class=lnt id=hl-85-17><a class=lnlinks href=#hl-85-17>17</a>
</span><span class=lnt id=hl-85-18><a class=lnlinks href=#hl-85-18>18</a>
</span><span class=lnt id=hl-85-19><a class=lnlinks href=#hl-85-19>19</a>
</span><span class=lnt id=hl-85-20><a class=lnlinks href=#hl-85-20>20</a>
</span><span class=lnt id=hl-85-21><a class=lnlinks href=#hl-85-21>21</a>
</span><span class=lnt id=hl-85-22><a class=lnlinks href=#hl-85-22>22</a>
</span><span class=lnt id=hl-85-23><a class=lnlinks href=#hl-85-23>23</a>
</span><span class=lnt id=hl-85-24><a class=lnlinks href=#hl-85-24>24</a>
</span><span class=lnt id=hl-85-25><a class=lnlinks href=#hl-85-25>25</a>
</span><span class=lnt id=hl-85-26><a class=lnlinks href=#hl-85-26>26</a>
</span><span class=lnt id=hl-85-27><a class=lnlinks href=#hl-85-27>27</a>
</span><span class=lnt id=hl-85-28><a class=lnlinks href=#hl-85-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Database Performance Dashboard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;panels&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Query Response Time&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;graph&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;datasource&#34;</span><span class=p>:</span> <span class=s2>&#34;Prometheus&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;targets&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;expr&#34;</span><span class=p>:</span> <span class=s2>&#34;rate(mysql_global_status_questions[5m])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;legendFormat&#34;</span><span class=p>:</span> <span class=s2>&#34;Queries/sec&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Slow Queries&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;graph&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;datasource&#34;</span><span class=p>:</span> <span class=s2>&#34;Prometheus&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;targets&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;expr&#34;</span><span class=p>:</span> <span class=s2>&#34;rate(mysql_global_status_slow_queries[5m])&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;legendFormat&#34;</span><span class=p>:</span> <span class=s2>&#34;Slow queries/sec&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 추가 패널 생략
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>연결 타임아웃(Connection Timeout)</td><td>클라이언트가 Connection Pool에서 새로운 연결을 요청했을 때, 해당 요청이 처리될 수 있는 최대 대기 시간을 의미한다.<br>이 시간이 초과되면 예외(Exception)가 발생하며, 클라이언트는 실패 메시지를 받게 된다.<br><strong>사용 목적</strong><br>- <strong>과도한 대기 방지</strong>: 요청이 너무 오래 대기하지 않도록 설정하여 사용자 경험을 개선.<br>- <strong>자원 관리</strong>: 풀에서 사용 가능한 연결이 부족할 때 적절히 실패 처리를 제공.</td></tr><tr><td>유휴 타임아웃(Idle Timeout)</td><td>Connection Pool에서 사용되지 않는 상태로 대기 중인 연결이 제거되기까지의 시간을 의미한다.<br>일정 시간 동안 유휴 상태인 연결은 풀에서 제거되어 자원을 회수한다.<br><strong>사용 목적</strong><br>- <strong>자원 절약</strong>: 사용되지 않는 연결을 제거하여 메모리와 네트워크 자원을 절약.<br>- <strong>풀 크기 유지</strong>: 최소 커넥션 수(<code>minimum-idle</code>)를 유지하면서 불필요한 커넥션 제거.</td></tr><tr><td>최대 수명(Max Lifetime)</td><td>Connection Pool에서 생성된 각 연결이 유지될 수 있는 최대 시간을 의미한다.<br>이 시간이 초과되면 해당 연결은 풀에서 제거되고 새로 생성된다.<br><strong>사용 목적</strong><br>- <strong>오래된 연결 제거</strong>: 장시간 유지된 연결이 네트워크 변경이나 데이터베이스 상태 변화에 영향을 받을 수 있으므로 이를 방지.<br>- <strong>성능 최적화</strong>: 주기적으로 새 연결을 생성하여 최신 상태를 유지.</td></tr><tr><td>정규화(Normalization)</td><td>데이터 중복을 최소화하고 데이터 무결성을 보장하기 위해 데이터를 여러 작은 테이블로 분리하는 과정이다.<br>관계형 데이터베이스에서 데이터가 **정상 형태(Normal Forms)**를 만족하도록 설계된다.<br><br><strong>주요 목표</strong><br>- 데이터 중복 제거: 동일한 데이터가 여러 곳에 저장되지 않도록 함.<br>- 데이터 무결성 유지: 삽입, 삭제, 갱신 시 데이터 불일치 방지.<br>- 저장 공간 최적화: 중복 데이터를 제거하여 스토리지 사용량 감소.<br><br><strong>정규화 단계</strong><br>- 1NF (First Normal Form): 각 컬럼이 원자값(Atomic Value)을 가져야 함.<br>- 2NF (Second Normal Form): 부분 종속성 제거 (모든 비키 속성은 기본 키에 전적으로 종속).<br>- 3NF (Third Normal Form): 이행 종속성 제거 (비키 속성이 다른 비키 속성에 종속되지 않음).<br>- BCNF (Boyce-Codd Normal Form): 모든 결정자가 후보 키여야 함.<br>- 4NF, 5NF: 다중 값 종속성과 조인 종속성을 제거.</td></tr><tr><td>비정규화(Denormalization)</td><td>성능 최적화를 위해 정규화된 데이터베이스에 일부 데이터 중복을 의도적으로 추가하는 과정이다.<br>주로 읽기 성능 향상을 위해 사용되며, JOIN 연산을 줄이고 데이터를 더 빠르게 검색할 수 있도록 한다.<br><br><strong>주요 목표</strong><br>- 쿼리 성능 향상: 복잡한 JOIN 연산을 줄여 읽기 작업 속도를 개선.<br>- 데이터 접근 단순화: 필요한 데이터를 한 번의 조회로 가져올 수 있도록 설계.</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>