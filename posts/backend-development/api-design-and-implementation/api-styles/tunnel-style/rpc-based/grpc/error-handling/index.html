<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Error Handling | hyunyoun's Blog</title>
<meta name=keywords content="Backend-Development,API-Design-and-Implementation,API-Styles,gRPC-API,Error-Handling"><meta name=description content="gRPC는 이러한 다양한 오류 상황을 일관되고 체계적으로 처리하기 위한 포괄적인 오류 처리 메커니즘을 제공한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/api-styles/tunnel-style/rpc-based/grpc/error-handling/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/api-styles/tunnel-style/rpc-based/grpc/error-handling/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/api-styles/tunnel-style/rpc-based/grpc/error-handling/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/api-styles/tunnel-style/rpc-based/grpc/error-handling/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Error Handling"><meta property="og:description" content="gRPC는 이러한 다양한 오류 상황을 일관되고 체계적으로 처리하기 위한 포괄적인 오류 처리 메커니즘을 제공한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Error Handling"><meta name=twitter:description content="gRPC는 이러한 다양한 오류 상황을 일관되고 체계적으로 처리하기 위한 포괄적인 오류 처리 메커니즘을 제공한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기술 블로그","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Backend Development","item":"https://buenhyden.github.io/posts/backend-development/"},{"@type":"ListItem","position":3,"name":"API Design and Implementation","item":"https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/"},{"@type":"ListItem","position":4,"name":"API Styles","item":"https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/api-styles/"},{"@type":"ListItem","position":5,"name":"Tunnel Style","item":""},{"@type":"ListItem","position":6,"name":"RPC-Based","item":""},{"@type":"ListItem","position":7,"name":"gRPC API","item":"https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/api-styles/tunnel-style/rpc-based/grpc/"},{"@type":"ListItem","position":8,"name":"Error Handling","item":"https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/api-styles/tunnel-style/rpc-based/grpc/error-handling/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>기술 블로그</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend-development/>Backend Development</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/>API Design and Implementation</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/api-styles/>API Styles</a>&nbsp;»&nbsp;<a href>Tunnel Style</a>&nbsp;»&nbsp;<a href>RPC-Based</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/backend-development/api-design-and-implementation/api-styles/tunnel-style/rpc-based/grpc/>gRPC API</a></div><h1>Error Handling</h1><div class=post-description>gRPC는 이러한 다양한 오류 상황을 일관되고 체계적으로 처리하기 위한 포괄적인 오류 처리 메커니즘을 제공한다.</div></header><div class=post-content><h2 id=error-handling>Error Handling<a hidden class=anchor aria-hidden=true href=#error-handling>#</a></h2><p>gRPC는 분산 시스템에서 서비스 간 통신을 위한 강력한 프레임워크이다. 복잡한 분산 환경에서는 네트워크 문제, 서버 장애, 비즈니스 로직 오류 등 다양한 오류 상황이 발생할 수 있다. gRPC는 이러한 다양한 오류 상황을 일관되고 체계적으로 처리하기 위한 포괄적인 오류 처리 메커니즘을 제공한다.</p><p>gRPC의 오류 처리는 HTTP/2 상태 코드, gRPC 상태 코드, 그리고 상세 오류 메시지를 조합하여 클라이언트에게 오류 정보를 전달한다. 이 시스템은 모든 지원 언어에서 일관되게 작동하며, 개발자가 다양한 오류 상황에 적절히 대응할 수 있도록 돕는다.</p><h3 id=grpc-상태-코드status-codes>gRPC 상태 코드(Status Codes)<a hidden class=anchor aria-hidden=true href=#grpc-상태-코드status-codes>#</a></h3><p>gRPC 오류 처리의 핵심은 상태 코드 시스템이다. 각 gRPC 호출은 성공 또는 실패를 나타내는 상태 코드와 함께 완료된다. 이 상태 코드는 오류의 유형과 심각도를 나타낸다.</p><h4 id=주요-grpc-상태-코드>주요 gRPC 상태 코드<a hidden class=anchor aria-hidden=true href=#주요-grpc-상태-코드>#</a></h4><p>gRPC는 다음과 같은 주요 상태 코드를 정의한다:</p><table><thead><tr><th>상태 코드</th><th>값</th><th>설명</th></tr></thead><tbody><tr><td>OK</td><td>0</td><td>성공적인 호출</td></tr><tr><td>CANCELLED</td><td>1</td><td>클라이언트에 의해 작업이 취소됨</td></tr><tr><td>UNKNOWN</td><td>2</td><td>알 수 없는 오류가 발생함</td></tr><tr><td>INVALID_ARGUMENT</td><td>3</td><td>클라이언트가 잘못된 인수를 제공함</td></tr><tr><td>DEADLINE_EXCEEDED</td><td>4</td><td>작업 완료 전에 데드라인이 만료됨</td></tr><tr><td>NOT_FOUND</td><td>5</td><td>요청된 엔티티를 찾을 수 없음</td></tr><tr><td>ALREADY_EXISTS</td><td>6</td><td>클라이언트가 생성하려는 엔티티가 이미 존재함</td></tr><tr><td>PERMISSION_DENIED</td><td>7</td><td>클라이언트가 작업을 수행할 권한이 없음</td></tr><tr><td>RESOURCE_EXHAUSTED</td><td>8</td><td>리소스가 소진됨(할당량 초과 등)</td></tr><tr><td>FAILED_PRECONDITION</td><td>9</td><td>시스템이 작업을 수행할 상태가 아님</td></tr><tr><td>ABORTED</td><td>10</td><td>작업이 중단됨(일반적으로 동시성 문제로 인해)</td></tr><tr><td>OUT_OF_RANGE</td><td>11</td><td>작업이 유효 범위를 벗어남</td></tr><tr><td>UNIMPLEMENTED</td><td>12</td><td>요청된 작업이 구현되지 않음</td></tr><tr><td>INTERNAL</td><td>13</td><td>내부 서버 오류</td></tr><tr><td>UNAVAILABLE</td><td>14</td><td>서비스를 일시적으로 사용할 수 없음</td></tr><tr><td>DATA_LOSS</td><td>15</td><td>복구할 수 없는 데이터 손실이 발생함</td></tr><tr><td>UNAUTHENTICATED</td><td>16</td><td>클라이언트가 인증되지 않음</td></tr></tbody></table><h4 id=상태-코드-선택-가이드라인>상태 코드 선택 가이드라인<a hidden class=anchor aria-hidden=true href=#상태-코드-선택-가이드라인>#</a></h4><p>올바른 상태 코드를 선택하는 것은 클라이언트가 오류에 적절히 대응하는 데 중요하다.</p><p>다음은 상태 코드 선택에 대한 가이드라인이다:</p><ul><li><strong>클라이언트 오류</strong> (요청이 잘못된 경우):<ul><li><code>INVALID_ARGUMENT</code>: 요청 매개변수가 잘못된 경우</li><li><code>NOT_FOUND</code>: 요청된 리소스가 존재하지 않는 경우</li><li><code>ALREADY_EXISTS</code>: 리소스 생성 시도시 이미 존재하는 경우</li><li><code>PERMISSION_DENIED</code>: 권한 부족</li><li><code>UNAUTHENTICATED</code>: 인증 실패</li></ul></li><li><strong>서버 오류</strong> (서버 측 문제):<ul><li><code>INTERNAL</code>: 일반적인 서버 오류</li><li><code>UNAVAILABLE</code>: 일시적인 서비스 중단</li><li><code>DATA_LOSS</code>: 데이터 손실이나 손상</li></ul></li><li><strong>네트워크/타이밍 오류</strong>:<ul><li><code>DEADLINE_EXCEEDED</code>: 타임아웃</li><li><code>CANCELLED</code>: 클라이언트에 의해 취소됨</li><li><code>ABORTED</code>: 동시성 충돌</li></ul></li><li><strong>프로그래밍 오류</strong>:<ul><li><code>UNIMPLEMENTED</code>: 요청된 기능이 구현되지 않음</li><li><code>FAILED_PRECONDITION</code>: 시스템 상태가 작업을 수행할 수 없음</li></ul></li></ul><h3 id=오류-세부-정보error-details>오류 세부 정보(Error Details)<a hidden class=anchor aria-hidden=true href=#오류-세부-정보error-details>#</a></h3><p>gRPC는 기본 상태 코드 외에도 더 상세한 오류 정보를 제공할 수 있는 메커니즘을 제공한다.</p><h4 id=오류-메시지>오류 메시지<a hidden class=anchor aria-hidden=true href=#오류-메시지>#</a></h4><p>각 gRPC 상태 코드는 문자열 메시지를 포함할 수 있다. 이 메시지는 디버깅 목적으로 사용되며, 최종 사용자에게 직접 표시하도록 설계되지 않았다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=c1>// 서버 측 구현 예시 (Go)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>return</span> <span class=n>nil</span><span class=p>,</span> <span class=n>status.Errorf</span><span class=p>(</span><span class=n>codes.InvalidArgument</span><span class=p>,</span> <span class=s>&#34;필드 값 %s이(가) 유효하지 않습니다&#34;</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=오류-상세-정보-error-details>오류 상세 정보 (Error Details)<a hidden class=anchor aria-hidden=true href=#오류-상세-정보-error-details>#</a></h4><p>gRPC는 <code>google.rpc.Status</code> 메시지를 확장하여 더 구조화된 오류 정보를 제공할 수 있다. 이를 통해 클라이언트에 다음과 같은 추가 정보를 전달할 수 있다:</p><ul><li><strong>BadRequest</strong>: 잘못된 요청의 필드별 오류 정보</li><li><strong>RetryInfo</strong>: 재시도 지연 정보</li><li><strong>DebugInfo</strong>: 디버깅을 위한 상세 정보</li><li><strong>QuotaFailure</strong>: 할당량 위반 정보</li><li><strong>PreconditionFailure</strong>: 전제 조건 실패 세부 정보</li><li><strong>ResourceInfo</strong>: 리소스 관련 정보</li><li><strong>Help</strong>: 도움말 정보와 링크</li><li><strong>LocalizedMessage</strong>: 지역화된 오류 메시지</li></ul><p>이러한 상세 정보는 <code>google.rpc.ErrorInfo</code> 프로토콜 버퍼 메시지를 사용하여 정의된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=c1>// 오류 상세 정보 예시 (proto 정의)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>message</span> <span class=nc>BadRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kd>message</span> <span class=nc>FieldViolation</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=kt>string</span> <span class=n>field</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=kt>string</span> <span class=n>description</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>repeated</span> <span class=n>FieldViolation</span> <span class=n>field_violations</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h4><p>Java에서 오류 상세 정보를 포함한 상태 생성 예시:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 필드 유효성 검사 오류에 대한 상세 정보 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=o>&lt;</span><span class=n>BadRequest</span><span class=o>&gt;</span><span class=w> </span><span class=n>badRequestKey</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ProtoUtils</span><span class=p>.</span><span class=na>keyForProto</span><span class=p>(</span><span class=n>BadRequest</span><span class=p>.</span><span class=na>getDefaultInstance</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>BadRequest</span><span class=w> </span><span class=n>badRequest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BadRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>addFieldViolations</span><span class=p>(</span><span class=n>FieldViolation</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>setField</span><span class=p>(</span><span class=s>&#34;email&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>setDescription</span><span class=p>(</span><span class=s>&#34;올바른 이메일 형식이 아닙니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>trailers</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>badRequestKey</span><span class=p>,</span><span class=w> </span><span class=n>badRequest</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>return</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;요청에 유효하지 않은 필드가 있습니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>(</span><span class=n>trailers</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=언어별-오류-처리-구현>언어별 오류 처리 구현<a hidden class=anchor aria-hidden=true href=#언어별-오류-처리-구현>#</a></h3><p>gRPC는 다양한 프로그래밍 언어를 지원하며, 각 언어별로 오류 처리 메커니즘을 제공한다.</p><h4 id=go-언어에서의-오류-처리>Go 언어에서의 오류 처리<a hidden class=anchor aria-hidden=true href=#go-언어에서의-오류-처리>#</a></h4><p>Go 언어에서 gRPC 오류 처리는 <code>status</code> 패키지를 사용한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29>29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30>30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31>31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32>32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33>33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34>34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35>35</a>
</span><span class=lnt id=hl-3-36><a class=lnlinks href=#hl-3-36>36</a>
</span><span class=lnt id=hl-3-37><a class=lnlinks href=#hl-3-37>37</a>
</span><span class=lnt id=hl-3-38><a class=lnlinks href=#hl-3-38>38</a>
</span><span class=lnt id=hl-3-39><a class=lnlinks href=#hl-3-39>39</a>
</span><span class=lnt id=hl-3-40><a class=lnlinks href=#hl-3-40>40</a>
</span><span class=lnt id=hl-3-41><a class=lnlinks href=#hl-3-41>41</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;google.golang.org/grpc/codes&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;google.golang.org/grpc/status&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 서버 측에서 오류 반환</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>server</span><span class=p>)</span> <span class=nf>GetUser</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>req</span> <span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>GetUserRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>req</span><span class=p>.</span><span class=nx>Id</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>InvalidArgument</span><span class=p>,</span> <span class=s>&#34;사용자 ID는 양수여야 합니다: %v&#34;</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>Id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>user</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nf>FindUser</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>Id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>Internal</span><span class=p>,</span> <span class=s>&#34;내부 오류: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>user</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>NotFound</span><span class=p>,</span> <span class=s>&#34;ID가 %d인 사용자를 찾을 수 없습니다&#34;</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>Id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>user</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 클라이언트 측에서 오류 처리</span>
</span></span><span class=line><span class=cl><span class=nx>resp</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>GetUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pb</span><span class=p>.</span><span class=nx>GetUserRequest</span><span class=p>{</span><span class=nx>Id</span><span class=p>:</span> <span class=o>-</span><span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>st</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>status</span><span class=p>.</span><span class=nf>FromError</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=nx>st</span><span class=p>.</span><span class=nf>Code</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nx>codes</span><span class=p>.</span><span class=nx>InvalidArgument</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;잘못된 인수: %v&#34;</span><span class=p>,</span> <span class=nx>st</span><span class=p>.</span><span class=nf>Message</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nx>codes</span><span class=p>.</span><span class=nx>NotFound</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;사용자를 찾을 수 없음: %v&#34;</span><span class=p>,</span> <span class=nx>st</span><span class=p>.</span><span class=nf>Message</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;gRPC 오류: %v&#34;</span><span class=p>,</span> <span class=nx>st</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;일반 오류: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=java-언어에서의-오류-처리>Java 언어에서의 오류 처리<a hidden class=anchor aria-hidden=true href=#java-언어에서의-오류-처리>#</a></h4><p>Java에서는 <code>Status</code>와 <code>StatusRuntimeException</code>을 사용한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25>25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26>26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27>27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28>28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29>29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30>30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31>31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32>32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33>33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34>34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35>35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36>36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37>37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38>38</a>
</span><span class=lnt id=hl-4-39><a class=lnlinks href=#hl-4-39>39</a>
</span><span class=lnt id=hl-4-40><a class=lnlinks href=#hl-4-40>40</a>
</span><span class=lnt id=hl-4-41><a class=lnlinks href=#hl-4-41>41</a>
</span><span class=lnt id=hl-4-42><a class=lnlinks href=#hl-4-42>42</a>
</span><span class=lnt id=hl-4-43><a class=lnlinks href=#hl-4-43>43</a>
</span><span class=lnt id=hl-4-44><a class=lnlinks href=#hl-4-44>44</a>
</span><span class=lnt id=hl-4-45><a class=lnlinks href=#hl-4-45>45</a>
</span><span class=lnt id=hl-4-46><a class=lnlinks href=#hl-4-46>46</a>
</span><span class=lnt id=hl-4-47><a class=lnlinks href=#hl-4-47>47</a>
</span><span class=lnt id=hl-4-48><a class=lnlinks href=#hl-4-48>48</a>
</span><span class=lnt id=hl-4-49><a class=lnlinks href=#hl-4-49>49</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 서버 측에서 오류 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>getUser</span><span class=p>(</span><span class=n>GetUserRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getId</span><span class=p>()</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Status</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;사용자 ID는 양수여야 합니다: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=na>findUser</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>user</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Status</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;ID가 &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getId</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;인 사용자를 찾을 수 없습니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Status</span><span class=p>.</span><span class=na>INTERNAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;내부 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>withCause</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=w>  </span><span class=c1>// 원인 예외 추가 (전송되지 않음, 로깅용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 클라이언트 측에서 오류 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blockingStub</span><span class=p>.</span><span class=na>getUser</span><span class=p>(</span><span class=n>GetUserRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>().</span><span class=na>setId</span><span class=p>(</span><span class=o>-</span><span class=n>1</span><span class=p>).</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 성공적인 응답 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=n>INVALID_ARGUMENT</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>Level</span><span class=p>.</span><span class=na>WARNING</span><span class=p>,</span><span class=w> </span><span class=s>&#34;잘못된 인수: {0}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=n>NOT_FOUND</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>Level</span><span class=p>.</span><span class=na>INFO</span><span class=p>,</span><span class=w> </span><span class=s>&#34;사용자를 찾을 수 없음: {0}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>Level</span><span class=p>.</span><span class=na>SEVERE</span><span class=p>,</span><span class=w> </span><span class=s>&#34;gRPC 오류: {0}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=python-언어에서의-오류-처리>Python 언어에서의 오류 처리<a hidden class=anchor aria-hidden=true href=#python-언어에서의-오류-처리>#</a></h4><p>Python에서는 <code>grpc.StatusCode</code>와 예외를 사용한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 서버 측에서 오류 반환</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>GetUser</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>id</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>.</span><span class=n>set_code</span><span class=p>(</span><span class=n>grpc</span><span class=o>.</span><span class=n>StatusCode</span><span class=o>.</span><span class=n>INVALID_ARGUMENT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>.</span><span class=n>set_details</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;사용자 ID는 양수여야 합니다: </span><span class=si>{</span><span class=n>request</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pb</span><span class=o>.</span><span class=n>User</span><span class=p>()</span>  <span class=c1># 더미 응답</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>user</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repository</span><span class=o>.</span><span class=n>find_user</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>user</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>context</span><span class=o>.</span><span class=n>set_code</span><span class=p>(</span><span class=n>grpc</span><span class=o>.</span><span class=n>StatusCode</span><span class=o>.</span><span class=n>NOT_FOUND</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>context</span><span class=o>.</span><span class=n>set_details</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ID가 </span><span class=si>{</span><span class=n>request</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>인 사용자를 찾을 수 없습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>pb</span><span class=o>.</span><span class=n>User</span><span class=p>()</span>  <span class=c1># 더미 응답</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>.</span><span class=n>set_code</span><span class=p>(</span><span class=n>grpc</span><span class=o>.</span><span class=n>StatusCode</span><span class=o>.</span><span class=n>INTERNAL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>.</span><span class=n>set_details</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;내부 오류: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pb</span><span class=o>.</span><span class=n>User</span><span class=p>()</span>  <span class=c1># 더미 응답</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 클라이언트 측에서 오류 처리</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>stub</span><span class=o>.</span><span class=n>GetUser</span><span class=p>(</span><span class=n>pb</span><span class=o>.</span><span class=n>GetUserRequest</span><span class=p>(</span><span class=nb>id</span><span class=o>=-</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># 성공적인 응답 처리</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=n>grpc</span><span class=o>.</span><span class=n>RpcError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>status_code</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=n>code</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>status_code</span> <span class=o>==</span> <span class=n>grpc</span><span class=o>.</span><span class=n>StatusCode</span><span class=o>.</span><span class=n>INVALID_ARGUMENT</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;잘못된 인수: </span><span class=si>{</span><span class=n>e</span><span class=o>.</span><span class=n>details</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>status_code</span> <span class=o>==</span> <span class=n>grpc</span><span class=o>.</span><span class=n>StatusCode</span><span class=o>.</span><span class=n>NOT_FOUND</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;사용자를 찾을 수 없음: </span><span class=si>{</span><span class=n>e</span><span class=o>.</span><span class=n>details</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;gRPC 오류: </span><span class=si>{</span><span class=n>status_code</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>e</span><span class=o>.</span><span class=n>details</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=고급-오류-처리-패턴>고급 오류 처리 패턴<a hidden class=anchor aria-hidden=true href=#고급-오류-처리-패턴>#</a></h3><p>실제 프로덕션 환경에서는 더 복잡한 오류 처리 패턴이 필요하다.</p><p>다음은 gRPC 애플리케이션에서 사용할 수 있는 고급 오류 처리 패턴이다.</p><h4 id=오류-인터셉터error-interceptors>오류 인터셉터(Error Interceptors)<a hidden class=anchor aria-hidden=true href=#오류-인터셉터error-interceptors>#</a></h4><p>인터셉터를 사용하면 오류 처리 로직을 중앙화하고 일관성 있게 적용할 수 있다.</p><p>Java 서버 측 인터셉터 예시:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34>34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ErrorInterceptor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ServerInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=w> </span><span class=nf>interceptCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>call</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCallHandler</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=w> </span><span class=n>listener</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>next</span><span class=p>.</span><span class=na>startCall</span><span class=p>(</span><span class=n>call</span><span class=p>,</span><span class=w> </span><span class=n>headers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ForwardingServerCallListener</span><span class=p>.</span><span class=na>SimpleForwardingServerCallListener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=p>(</span><span class=n>listener</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onHalfClose</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kd>super</span><span class=p>.</span><span class=na>onHalfClose</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>RuntimeException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>handleException</span><span class=p>(</span><span class=n>call</span><span class=p>,</span><span class=w> </span><span class=n>ex</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>throw</span><span class=w> </span><span class=n>ex</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleException</span><span class=p>(</span><span class=n>ServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>call</span><span class=p>,</span><span class=w> </span><span class=n>RuntimeException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ex</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ex</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>ResourceNotFoundException</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>INTERNAL</span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;내부 서버 오류&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>call</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=오류-매핑error-mapping>오류 매핑(Error Mapping)<a hidden class=anchor aria-hidden=true href=#오류-매핑error-mapping>#</a></h4><p>비즈니스 로직 예외를 적절한 gRPC 상태 코드로 매핑하는 전략은 모든 gRPC 서비스에서 중요하다.</p><p>Go 언어에서의 오류 매핑 예시:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 오류 매핑 함수</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>mapToStatusError</span><span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Is</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>ErrNotFound</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>NotFound</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Is</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>ErrInvalidInput</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>InvalidArgument</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Is</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>ErrPermissionDenied</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>PermissionDenied</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Is</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>ErrUnauthenticated</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>Unauthenticated</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Is</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>ErrAlreadyExists</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>AlreadyExists</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 내부 오류는 자세한 정보를 노출하지 않음</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>Internal</span><span class=p>,</span> <span class=s>&#34;내부 서버 오류가 발생했습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 서비스 구현에서 사용</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>server</span><span class=p>)</span> <span class=nf>CreateUser</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>req</span> <span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>CreateUserRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>user</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>service</span><span class=p>.</span><span class=nf>CreateUser</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>Email</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nf>mapToStatusError</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>user</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=오류-처리-모범-사례>오류 처리 모범 사례<a hidden class=anchor aria-hidden=true href=#오류-처리-모범-사례>#</a></h4><p>gRPC 애플리케이션에서 오류를 처리할 때 다음 모범 사례를 고려한다:</p><ol><li><strong>일관된 오류 코드 사용</strong>: 애플리케이션 전체에서 오류 코드를 일관되게 사용한다.</li><li><strong>적절한 상태 코드 선택</strong>: 오류 상황에 가장 적합한 상태 코드를 선택한다.</li><li><strong>유용한 오류 메시지 제공</strong>: 디버깅에 도움이 되는 명확한 오류 메시지를 제공한다.</li><li><strong>민감한 정보 노출 방지</strong>: 오류 메시지에 민감한 정보가 포함되지 않도록 주의한다.</li><li><strong>구조화된 오류 상세 정보 사용</strong>: 가능한 경우 구조화된 오류 세부 정보를 사용하여 클라이언트에게 더 많은 컨텍스트를 제공한다.</li><li><strong>오류 처리 중앙화</strong>: 인터셉터나 미들웨어를 사용하여 오류 처리 로직을 중앙화한다.</li><li><strong>재시도 가능한 오류와 재시도 불가능한 오류 구분</strong>: 클라이언트가 적절한 재시도 전략을 선택할 수 있도록 오류를 명확히 구분한다.</li></ol><h3 id=오류-전파와-처리-전략>오류 전파와 처리 전략<a hidden class=anchor aria-hidden=true href=#오류-전파와-처리-전략>#</a></h3><p>분산 시스템에서는 오류가 서비스 체인을 통해 전파되는 방식이 중요하다.</p><h4 id=오류-전파-패턴>오류 전파 패턴<a hidden class=anchor aria-hidden=true href=#오류-전파-패턴>#</a></h4><p>분산 시스템에서 오류를 처리하는 몇 가지 일반적인 패턴이 있다:</p><ol><li><p><strong>직접 전파(Direct Propagation)</strong>: 하위 서비스의 오류를 상위 서비스로 그대로 전달한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>resp</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>downstreamService</span><span class=p>.</span><span class=nf>Call</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>  <span class=c1>// 오류를 그대로 상위 서비스로 전달</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>오류 변환(Error Translation)</strong>: 하위 서비스의 오류를 상위 서비스 컨텍스트에 맞게 변환한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5>5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6>6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7>7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>resp</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>downstreamService</span><span class=p>.</span><span class=nf>Call</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>st</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>status</span><span class=p>.</span><span class=nf>FromError</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>ok</span> <span class=o>&amp;&amp;</span> <span class=nx>st</span><span class=p>.</span><span class=nf>Code</span><span class=p>()</span> <span class=o>==</span> <span class=nx>codes</span><span class=p>.</span><span class=nx>NotFound</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>NotFound</span><span class=p>,</span> <span class=s>&#34;사용자 프로필을 찾을 수 없습니다: %v&#34;</span><span class=p>,</span> <span class=nx>st</span><span class=p>.</span><span class=nf>Message</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>Internal</span><span class=p>,</span> <span class=s>&#34;프로필 서비스 오류&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>오류 래핑(Error Wrapping)</strong>: 오류 컨텍스트를 추가하면서 원래 오류를 유지한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>resp</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>downstreamService</span><span class=p>.</span><span class=nf>Call</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;프로필 서비스 호출 중 오류: %w&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>오류 흡수(Error Absorption)</strong>: 특정 오류를 처리하고 대체 로직을 실행한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3>3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4>4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5>5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6>6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7>7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8>8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>resp</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>downstreamService</span><span class=p>.</span><span class=nf>Call</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>st</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>status</span><span class=p>.</span><span class=nf>FromError</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>ok</span> <span class=o>&amp;&amp;</span> <span class=nx>st</span><span class=p>.</span><span class=nf>Code</span><span class=p>()</span> <span class=o>==</span> <span class=nx>codes</span><span class=p>.</span><span class=nx>NotFound</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 대체 로직: 기본 프로필 반환</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nf>getDefaultProfile</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=클라이언트-측-오류-처리-전략>클라이언트 측 오류 처리 전략<a hidden class=anchor aria-hidden=true href=#클라이언트-측-오류-처리-전략>#</a></h4><p>gRPC 클라이언트는 다양한 오류 상황에 효과적으로 대응하기 위한 전략이 필요하다.</p><h5 id=재시도-전략>재시도 전략<a hidden class=anchor aria-hidden=true href=#재시도-전략>#</a></h5><p>일시적인 오류가 발생할 경우 자동 재시도를 구현할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a>
</span><span class=lnt id=hl-12-31><a class=lnlinks href=#hl-12-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java에서의 재시도 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Response</span><span class=w> </span><span class=nf>callWithRetry</span><span class=p>(</span><span class=n>Request</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>maxRetries</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>retryCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>long</span><span class=w> </span><span class=n>retryDelayMs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>100</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>stub</span><span class=p>.</span><span class=na>serviceMethod</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>retryCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>retryCount</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>maxRetries</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=o>!</span><span class=n>isRetryable</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>  </span><span class=c1>// 최대 재시도 횟수 초과 또는 재시도 불가능한 오류</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>warning</span><span class=p>(</span><span class=s>&#34;재시도 가능한 오류 발생, 재시도 중… (&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>retryCount</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;/&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>maxRetries</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;)&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>retryDelayMs</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=p>(</span><span class=n>retryCount</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)));</span><span class=w>  </span><span class=c1>// 지수 백오프</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>ie</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>interrupt</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isRetryable</span><span class=p>(</span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=w> </span><span class=n>code</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>UNAVAILABLE</span><span class=w> </span><span class=o>||</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=n>code</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>RESOURCE_EXHAUSTED</span><span class=w> </span><span class=o>||</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=n>code</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>DEADLINE_EXCEEDED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=서킷-브레이커circuit-breaker-패턴>서킷 브레이커(Circuit Breaker) 패턴<a hidden class=anchor aria-hidden=true href=#서킷-브레이커circuit-breaker-패턴>#</a></h5><p>연속적인 오류가 발생할 경우 서비스 호출을 일시적으로 중단하는 서킷 브레이커 패턴을 구현할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27>27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28>28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29>29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30>30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31>31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32>32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33>33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34>34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35>35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36>36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37>37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38>38</a>
</span><span class=lnt id=hl-13-39><a class=lnlinks href=#hl-13-39>39</a>
</span><span class=lnt id=hl-13-40><a class=lnlinks href=#hl-13-40>40</a>
</span><span class=lnt id=hl-13-41><a class=lnlinks href=#hl-13-41>41</a>
</span><span class=lnt id=hl-13-42><a class=lnlinks href=#hl-13-42>42</a>
</span><span class=lnt id=hl-13-43><a class=lnlinks href=#hl-13-43>43</a>
</span><span class=lnt id=hl-13-44><a class=lnlinks href=#hl-13-44>44</a>
</span><span class=lnt id=hl-13-45><a class=lnlinks href=#hl-13-45>45</a>
</span><span class=lnt id=hl-13-46><a class=lnlinks href=#hl-13-46>46</a>
</span><span class=lnt id=hl-13-47><a class=lnlinks href=#hl-13-47>47</a>
</span><span class=lnt id=hl-13-48><a class=lnlinks href=#hl-13-48>48</a>
</span><span class=lnt id=hl-13-49><a class=lnlinks href=#hl-13-49>49</a>
</span><span class=lnt id=hl-13-50><a class=lnlinks href=#hl-13-50>50</a>
</span><span class=lnt id=hl-13-51><a class=lnlinks href=#hl-13-51>51</a>
</span><span class=lnt id=hl-13-52><a class=lnlinks href=#hl-13-52>52</a>
</span><span class=lnt id=hl-13-53><a class=lnlinks href=#hl-13-53>53</a>
</span><span class=lnt id=hl-13-54><a class=lnlinks href=#hl-13-54>54</a>
</span><span class=lnt id=hl-13-55><a class=lnlinks href=#hl-13-55>55</a>
</span><span class=lnt id=hl-13-56><a class=lnlinks href=#hl-13-56>56</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 간단한 서킷 브레이커 구현 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CircuitBreaker</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>failureThreshold</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>resetTimeout</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>failureCount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>lastFailureTime</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>State</span><span class=w> </span><span class=n>state</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>State</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CLOSED</span><span class=p>,</span><span class=w>    </span><span class=c1>// 정상 작동</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OPEN</span><span class=p>,</span><span class=w>      </span><span class=c1>// 서킷 열림 (호출 중단)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HALF_OPEN</span><span class=w>  </span><span class=c1>// 시험 작동</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>CircuitBreaker</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>failureThreshold</span><span class=p>,</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>resetTimeoutMs</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>failureThreshold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>failureThreshold</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>resetTimeout</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resetTimeoutMs</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>CLOSED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>failureCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=nf>execute</span><span class=p>(</span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>operation</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>OPEN</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>lastFailureTime</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>resetTimeout</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>HALF_OPEN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CircuitBreakerOpenException</span><span class=p>(</span><span class=s>&#34;서킷 브레이커가 열려 있습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>T</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>operation</span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>HALF_OPEN</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>reset</span><span class=p>();</span><span class=w>  </span><span class=c1>// 성공 시 상태 재설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>recordFailure</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>recordFailure</span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>failureCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>lastFailureTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>HALF_OPEN</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>failureCount</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>failureThreshold</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>OPEN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>reset</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>failureCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>CLOSED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=타임아웃-설정>타임아웃 설정<a hidden class=anchor aria-hidden=true href=#타임아웃-설정>#</a></h5><p>모든 gRPC 호출에 적절한 타임아웃을 설정하는 것이 중요하다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java에서의 타임아웃 설정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ManagedChannel</span><span class=w> </span><span class=n>channel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ManagedChannelBuilder</span><span class=p>.</span><span class=na>forAddress</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span><span class=w> </span><span class=n>50051</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>usePlaintext</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 클라이언트 스텁 생성 시 데드라인 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>UserServiceGrpc</span><span class=p>.</span><span class=na>UserServiceBlockingStub</span><span class=w> </span><span class=n>stub</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserServiceGrpc</span><span class=p>.</span><span class=na>newBlockingStub</span><span class=p>(</span><span class=n>channel</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>withDeadlineAfter</span><span class=p>(</span><span class=n>5</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 개별 호출에 대한 타임아웃 설정도 가능</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 기본 클라이언트 스텁에서 메서드별 타임아웃 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stub</span><span class=p>.</span><span class=na>withDeadlineAfter</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>getUser</span><span class=p>(</span><span class=n>GetUserRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>().</span><span class=na>setId</span><span class=p>(</span><span class=n>123</span><span class=p>).</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>DEADLINE_EXCEEDED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;호출 타임아웃&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=서버-측-오류-처리-전략>서버 측 오류 처리 전략<a hidden class=anchor aria-hidden=true href=#서버-측-오류-처리-전략>#</a></h4><p>서버 측에서도 오류를 효과적으로 처리하기 위한 전략이 필요하다.</p><h5 id=요청-검증validation>요청 검증(Validation)<a hidden class=anchor aria-hidden=true href=#요청-검증validation>#</a></h5><p>요청을 처리하기 전에 철저히 검증하여 많은 오류를 조기에 방지할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>server</span><span class=p>)</span> <span class=nf>CreateUser</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>req</span> <span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>CreateUserRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 입력 검증</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>req</span><span class=p>.</span><span class=nx>Name</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>InvalidArgument</span><span class=p>,</span> <span class=s>&#34;이름은 필수 필드입니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nf>isValidEmail</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>Email</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>InvalidArgument</span><span class=p>,</span> <span class=s>&#34;유효하지 않은 이메일 형식입니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 비즈니스 로직 실행</span>
</span></span><span class=line><span class=cl>    <span class=nx>user</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>service</span><span class=p>.</span><span class=nf>CreateUser</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>Email</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nf>mapToStatusError</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>user</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=교착-상태-방지deadlock-prevention>교착 상태 방지(Deadlock Prevention)<a hidden class=anchor aria-hidden=true href=#교착-상태-방지deadlock-prevention>#</a></h5><p>gRPC 서버에서는 교착 상태를 방지하기 위해 모든 요청에 대해 적절한 타임아웃을 설정하는 것이 중요하다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>server</span><span class=p>)</span> <span class=nf>ProcessData</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>req</span> <span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>ProcessDataRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>ProcessDataResponse</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 컨텍스트에서 데드라인 확인</span>
</span></span><span class=line><span class=cl>    <span class=nx>deadline</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>ctx</span><span class=p>.</span><span class=nf>Deadline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 기본 타임아웃 설정</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>cancel</span> <span class=nx>context</span><span class=p>.</span><span class=nx>CancelFunc</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span><span class=p>,</span> <span class=nx>cancel</span> <span class=p>=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>WithTimeout</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=mi>30</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>defer</span> <span class=nf>cancel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 남은 처리 시간 계산</span>
</span></span><span class=line><span class=cl>        <span class=nx>remaining</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Until</span><span class=p>(</span><span class=nx>deadline</span><span class=p>)</span> <span class=o>-</span> <span class=mi>100</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>remaining</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>status</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>DeadlineExceeded</span><span class=p>,</span> <span class=s>&#34;데드라인이 너무 짧습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 하위 서비스 호출 시 컨텍스트 전파</span>
</span></span><span class=line><span class=cl>    <span class=nx>result</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>dataProcessor</span><span class=p>.</span><span class=nf>Process</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>Data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>pb</span><span class=p>.</span><span class=nx>ProcessDataResponse</span><span class=p>{</span><span class=nx>Result</span><span class=p>:</span> <span class=nx>result</span><span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=점진적-성능-저하graceful-degradation>점진적 성능 저하(Graceful Degradation)<a hidden class=anchor aria-hidden=true href=#점진적-성능-저하graceful-degradation>#</a></h5><p>서비스 일부에 문제가 발생하더라도 전체 기능을 유지하는 전략을 구현할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25>25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26>26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27>27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28>28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29>29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30>30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31>31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=nf>getUser</span><span class=p>(</span><span class=n>GetUserRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 기본 사용자 정보 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserInfo</span><span class=w> </span><span class=n>info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userInfoService</span><span class=p>.</span><span class=na>getUserInfo</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>info</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=n>info</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=n>info</span><span class=p>.</span><span class=na>getEmail</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;사용자 기본 정보 조회 실패: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>  </span><span class=c1>// NOT_FOUND가 아닌 경우에만 예외 전파</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// NOT_FOUND인 경우, 기본값으로 계속 진행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;Unknown&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 사용자 프로필 조회 (선택적 기능)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserProfile</span><span class=w> </span><span class=n>profile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>profileService</span><span class=p>.</span><span class=na>getProfile</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setProfilePicture</span><span class=p>(</span><span class=n>profile</span><span class=p>.</span><span class=na>getPictureUrl</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setBio</span><span class=p>(</span><span class=n>profile</span><span class=p>.</span><span class=na>getBio</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 프로필 정보가 없어도 기본 사용자 정보는 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>warning</span><span class=p>(</span><span class=s>&#34;사용자 프로필 조회 실패, 기본값 사용: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setProfilePicture</span><span class=p>(</span><span class=s>&#34;default.png&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=메타데이터를-통한-오류-정보-전달>메타데이터를 통한 오류 정보 전달<a hidden class=anchor aria-hidden=true href=#메타데이터를-통한-오류-정보-전달>#</a></h3><p>gRPC는 메타데이터(Metadata)를 통해 추가적인 오류 정보를 전달할 수 있다.</p><h4 id=트레일러-메타데이터trailer-metadata>트레일러 메타데이터(Trailer Metadata)<a hidden class=anchor aria-hidden=true href=#트레일러-메타데이터trailer-metadata>#</a></h4><p>gRPC는 응답 트레일러(trailers)를 통해 오류에 대한 추가 정보를 전달할 수 있다. 이는 특히 오류 상세 정보를 전달하는 데 유용하다.</p><p>Java 서버 예시:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18>18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19>19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20>20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21>21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22>22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23>23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24>24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25>25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26>26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27>27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28>28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29>29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30>30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processRequest</span><span class=p>(</span><span class=n>Request</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비즈니스 로직 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Response</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>processBusinessLogic</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 트레일러 메타데이터 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>processingTimeKey</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;processing-time-ms&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>trailers</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>processingTimeKey</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>processingTime</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 완료 시 트레일러 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>((</span><span class=n>ServerCallStreamObserver</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=n>responseObserver</span><span class=p>).</span><span class=na>setTrailers</span><span class=p>(</span><span class=n>trailers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 오류 처리 및 트레일러 메타데이터 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>errorDetailsKey</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;error-details&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>trailers</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>errorDetailsKey</span><span class=p>,</span><span class=w> </span><span class=s>&#34;오류 세부 정보: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>INTERNAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;처리 중 오류 발생&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withCause</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>(</span><span class=n>trailers</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Java 클라이언트 예시:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18>18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19>19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20>20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21>21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ClientCall</span><span class=o>&lt;</span><span class=n>Request</span><span class=p>,</span><span class=w> </span><span class=n>Response</span><span class=o>&gt;</span><span class=w> </span><span class=n>call</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>channel</span><span class=p>.</span><span class=na>newCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ServiceGrpc</span><span class=p>.</span><span class=na>getProcessRequestMethod</span><span class=p>(),</span><span class=w> </span><span class=n>CallOptions</span><span class=p>.</span><span class=na>DEFAULT</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>call</span><span class=p>.</span><span class=na>start</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>ClientCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onClose</span><span class=p>(</span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>status</span><span class=p>.</span><span class=na>isOk</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>errorDetails</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>trailers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;error-details&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;오류 발생: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;, 세부 정보: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>errorDetails</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onMessage</span><span class=p>(</span><span class=n>Response</span><span class=w> </span><span class=n>response</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 응답 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>},</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>call</span><span class=p>.</span><span class=na>sendMessage</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>call</span><span class=p>.</span><span class=na>halfClose</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>call</span><span class=p>.</span><span class=na>request</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=바이너리-메타데이터를-사용한-구조화된-오류-정보>바이너리 메타데이터를 사용한 구조화된 오류 정보<a hidden class=anchor aria-hidden=true href=#바이너리-메타데이터를-사용한-구조화된-오류-정보>#</a></h4><p>Protocol Buffers로 정의된 구조화된 오류 정보를 바이너리 메타데이터로 전송할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22>22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23>23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24>24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25>25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26>26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27>27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28>28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29>29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30>30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31>31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32>32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33>33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34>34</a>
</span><span class=lnt id=hl-20-35><a class=lnlinks href=#hl-20-35>35</a>
</span><span class=lnt id=hl-20-36><a class=lnlinks href=#hl-20-36>36</a>
</span><span class=lnt id=hl-20-37><a class=lnlinks href=#hl-20-37>37</a>
</span><span class=lnt id=hl-20-38><a class=lnlinks href=#hl-20-38>38</a>
</span><span class=lnt id=hl-20-39><a class=lnlinks href=#hl-20-39>39</a>
</span><span class=lnt id=hl-20-40><a class=lnlinks href=#hl-20-40>40</a>
</span><span class=lnt id=hl-20-41><a class=lnlinks href=#hl-20-41>41</a>
</span><span class=lnt id=hl-20-42><a class=lnlinks href=#hl-20-42>42</a>
</span><span class=lnt id=hl-20-43><a class=lnlinks href=#hl-20-43>43</a>
</span><span class=lnt id=hl-20-44><a class=lnlinks href=#hl-20-44>44</a>
</span><span class=lnt id=hl-20-45><a class=lnlinks href=#hl-20-45>45</a>
</span><span class=lnt id=hl-20-46><a class=lnlinks href=#hl-20-46>46</a>
</span><span class=lnt id=hl-20-47><a class=lnlinks href=#hl-20-47>47</a>
</span><span class=lnt id=hl-20-48><a class=lnlinks href=#hl-20-48>48</a>
</span><span class=lnt id=hl-20-49><a class=lnlinks href=#hl-20-49>49</a>
</span><span class=lnt id=hl-20-50><a class=lnlinks href=#hl-20-50>50</a>
</span><span class=lnt id=hl-20-51><a class=lnlinks href=#hl-20-51>51</a>
</span><span class=lnt id=hl-20-52><a class=lnlinks href=#hl-20-52>52</a>
</span><span class=lnt id=hl-20-53><a class=lnlinks href=#hl-20-53>53</a>
</span><span class=lnt id=hl-20-54><a class=lnlinks href=#hl-20-54>54</a>
</span><span class=lnt id=hl-20-55><a class=lnlinks href=#hl-20-55>55</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 서버 측 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processRequest</span><span class=p>(</span><span class=n>Request</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비즈니스 로직 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>ValidationException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 구조화된 오류 정보 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ErrorDetails</span><span class=w> </span><span class=n>errorDetails</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ErrorDetails</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setCode</span><span class=p>(</span><span class=s>&#34;VALIDATION_ERROR&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setMessage</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>addFields</span><span class=p>(</span><span class=n>FieldError</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setField</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getField</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setDescription</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getDescription</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 바이너리 메타데이터로 변환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=o>&lt;</span><span class=kt>byte</span><span class=o>[]&gt;</span><span class=w> </span><span class=n>errorDetailsKey</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;error-details-bin&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>BINARY_BYTE_MARSHALLER</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>trailers</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>errorDetailsKey</span><span class=p>,</span><span class=w> </span><span class=n>errorDetails</span><span class=p>.</span><span class=na>toByteArray</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 오류 상태와 함께 트레일러 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Status</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;유효성 검사 오류&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>(</span><span class=n>trailers</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 클라이언트 측 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Response</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stub</span><span class=p>.</span><span class=na>processRequest</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 성공적인 응답 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getTrailers</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>trailers</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=o>&lt;</span><span class=kt>byte</span><span class=o>[]&gt;</span><span class=w> </span><span class=n>errorDetailsKey</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;error-details-bin&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>BINARY_BYTE_MARSHALLER</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>errorDetailsBytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>trailers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>errorDetailsKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>errorDetailsBytes</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ErrorDetails</span><span class=w> </span><span class=n>errorDetails</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ErrorDetails</span><span class=p>.</span><span class=na>parseFrom</span><span class=p>(</span><span class=n>errorDetailsBytes</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;유효성 검사 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>errorDetails</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>FieldError</span><span class=w> </span><span class=n>field</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>errorDetails</span><span class=p>.</span><span class=na>getFieldsList</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;필드 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>field</span><span class=p>.</span><span class=na>getField</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; - &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>field</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InvalidProtocolBufferException</span><span class=w> </span><span class=n>ipbe</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;오류 세부 정보 파싱 실패&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=스트리밍-rpc에서의-오류-처리>스트리밍 RPC에서의 오류 처리<a hidden class=anchor aria-hidden=true href=#스트리밍-rpc에서의-오류-처리>#</a></h3><p>gRPC는 단일 요청/응답 외에도 스트리밍 RPC를 지원한다.</p><p>스트리밍 RPC에서의 오류 처리는 몇 가지 추가적인 고려 사항이 필요하다.</p><h4 id=서버-스트리밍-rpc>서버 스트리밍 RPC<a hidden class=anchor aria-hidden=true href=#서버-스트리밍-rpc>#</a></h4><p>서버 스트리밍 RPC에서 서버는 여러 응답을 클라이언트에게 전송한다. 오류가 발생하면 스트림이 종료된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17>17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18>18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19>19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20>20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21>21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22>22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23>23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24>24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25>25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26>26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27>27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28>28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29>29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30>30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31>31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32>32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33>33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34>34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35>35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36>36</a>
</span><span class=lnt id=hl-21-37><a class=lnlinks href=#hl-21-37>37</a>
</span><span class=lnt id=hl-21-38><a class=lnlinks href=#hl-21-38>38</a>
</span><span class=lnt id=hl-21-39><a class=lnlinks href=#hl-21-39>39</a>
</span><span class=lnt id=hl-21-40><a class=lnlinks href=#hl-21-40>40</a>
</span><span class=lnt id=hl-21-41><a class=lnlinks href=#hl-21-41>41</a>
</span><span class=lnt id=hl-21-42><a class=lnlinks href=#hl-21-42>42</a>
</span><span class=lnt id=hl-21-43><a class=lnlinks href=#hl-21-43>43</a>
</span><span class=lnt id=hl-21-44><a class=lnlinks href=#hl-21-44>44</a>
</span><span class=lnt id=hl-21-45><a class=lnlinks href=#hl-21-45>45</a>
</span><span class=lnt id=hl-21-46><a class=lnlinks href=#hl-21-46>46</a>
</span><span class=lnt id=hl-21-47><a class=lnlinks href=#hl-21-47>47</a>
</span><span class=lnt id=hl-21-48><a class=lnlinks href=#hl-21-48>48</a>
</span><span class=lnt id=hl-21-49><a class=lnlinks href=#hl-21-49>49</a>
</span><span class=lnt id=hl-21-50><a class=lnlinks href=#hl-21-50>50</a>
</span><span class=lnt id=hl-21-51><a class=lnlinks href=#hl-21-51>51</a>
</span><span class=lnt id=hl-21-52><a class=lnlinks href=#hl-21-52>52</a>
</span><span class=lnt id=hl-21-53><a class=lnlinks href=#hl-21-53>53</a>
</span><span class=lnt id=hl-21-54><a class=lnlinks href=#hl-21-54>54</a>
</span><span class=lnt id=hl-21-55><a class=lnlinks href=#hl-21-55>55</a>
</span><span class=lnt id=hl-21-56><a class=lnlinks href=#hl-21-56>56</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 서버 측 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>listUsers</span><span class=p>(</span><span class=n>ListUsersRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 페이지네이션 파라미터 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPageSize</span><span class=p>()</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Status</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;페이지 크기는 양수여야 합니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 사용자 목록 조회 및 스트리밍</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepository</span><span class=p>.</span><span class=na>findUsers</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getPageToken</span><span class=p>(),</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getPageSize</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>users</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 각 사용자를 스트림으로 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 컨텍스트 취소 여부 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>Context</span><span class=p>.</span><span class=na>current</span><span class=p>().</span><span class=na>isCancelled</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;클라이언트가 스트림을 취소했습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;사용자 목록 조회 중 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Status</span><span class=p>.</span><span class=na>INTERNAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;내부 서버 오류&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 클라이언트 측 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ListUsersRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ListUsersRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>setPageSize</span><span class=p>(</span><span class=n>10</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blockingStub</span><span class=p>.</span><span class=na>listUsers</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>users</span><span class=p>.</span><span class=na>hasNext</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>users</span><span class=p>.</span><span class=na>next</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 사용자 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>INTERNAL</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;서버 내부 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;스트리밍 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=클라이언트-스트리밍-rpc>클라이언트 스트리밍 RPC<a hidden class=anchor aria-hidden=true href=#클라이언트-스트리밍-rpc>#</a></h4><p>클라이언트 스트리밍 RPC에서는 클라이언트가 여러 요청을 서버에 전송한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17>17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18>18</a>
</span><span class=lnt id=hl-22-19><a class=lnlinks href=#hl-22-19>19</a>
</span><span class=lnt id=hl-22-20><a class=lnlinks href=#hl-22-20>20</a>
</span><span class=lnt id=hl-22-21><a class=lnlinks href=#hl-22-21>21</a>
</span><span class=lnt id=hl-22-22><a class=lnlinks href=#hl-22-22>22</a>
</span><span class=lnt id=hl-22-23><a class=lnlinks href=#hl-22-23>23</a>
</span><span class=lnt id=hl-22-24><a class=lnlinks href=#hl-22-24>24</a>
</span><span class=lnt id=hl-22-25><a class=lnlinks href=#hl-22-25>25</a>
</span><span class=lnt id=hl-22-26><a class=lnlinks href=#hl-22-26>26</a>
</span><span class=lnt id=hl-22-27><a class=lnlinks href=#hl-22-27>27</a>
</span><span class=lnt id=hl-22-28><a class=lnlinks href=#hl-22-28>28</a>
</span><span class=lnt id=hl-22-29><a class=lnlinks href=#hl-22-29>29</a>
</span><span class=lnt id=hl-22-30><a class=lnlinks href=#hl-22-30>30</a>
</span><span class=lnt id=hl-22-31><a class=lnlinks href=#hl-22-31>31</a>
</span><span class=lnt id=hl-22-32><a class=lnlinks href=#hl-22-32>32</a>
</span><span class=lnt id=hl-22-33><a class=lnlinks href=#hl-22-33>33</a>
</span><span class=lnt id=hl-22-34><a class=lnlinks href=#hl-22-34>34</a>
</span><span class=lnt id=hl-22-35><a class=lnlinks href=#hl-22-35>35</a>
</span><span class=lnt id=hl-22-36><a class=lnlinks href=#hl-22-36>36</a>
</span><span class=lnt id=hl-22-37><a class=lnlinks href=#hl-22-37>37</a>
</span><span class=lnt id=hl-22-38><a class=lnlinks href=#hl-22-38>38</a>
</span><span class=lnt id=hl-22-39><a class=lnlinks href=#hl-22-39>39</a>
</span><span class=lnt id=hl-22-40><a class=lnlinks href=#hl-22-40>40</a>
</span><span class=lnt id=hl-22-41><a class=lnlinks href=#hl-22-41>41</a>
</span><span class=lnt id=hl-22-42><a class=lnlinks href=#hl-22-42>42</a>
</span><span class=lnt id=hl-22-43><a class=lnlinks href=#hl-22-43>43</a>
</span><span class=lnt id=hl-22-44><a class=lnlinks href=#hl-22-44>44</a>
</span><span class=lnt id=hl-22-45><a class=lnlinks href=#hl-22-45>45</a>
</span><span class=lnt id=hl-22-46><a class=lnlinks href=#hl-22-46>46</a>
</span><span class=lnt id=hl-22-47><a class=lnlinks href=#hl-22-47>47</a>
</span><span class=lnt id=hl-22-48><a class=lnlinks href=#hl-22-48>48</a>
</span><span class=lnt id=hl-22-49><a class=lnlinks href=#hl-22-49>49</a>
</span><span class=lnt id=hl-22-50><a class=lnlinks href=#hl-22-50>50</a>
</span><span class=lnt id=hl-22-51><a class=lnlinks href=#hl-22-51>51</a>
</span><span class=lnt id=hl-22-52><a class=lnlinks href=#hl-22-52>52</a>
</span><span class=lnt id=hl-22-53><a class=lnlinks href=#hl-22-53>53</a>
</span><span class=lnt id=hl-22-54><a class=lnlinks href=#hl-22-54>54</a>
</span><span class=lnt id=hl-22-55><a class=lnlinks href=#hl-22-55>55</a>
</span><span class=lnt id=hl-22-56><a class=lnlinks href=#hl-22-56>56</a>
</span><span class=lnt id=hl-22-57><a class=lnlinks href=#hl-22-57>57</a>
</span><span class=lnt id=hl-22-58><a class=lnlinks href=#hl-22-58>58</a>
</span><span class=lnt id=hl-22-59><a class=lnlinks href=#hl-22-59>59</a>
</span><span class=lnt id=hl-22-60><a class=lnlinks href=#hl-22-60>60</a>
</span><span class=lnt id=hl-22-61><a class=lnlinks href=#hl-22-61>61</a>
</span><span class=lnt id=hl-22-62><a class=lnlinks href=#hl-22-62>62</a>
</span><span class=lnt id=hl-22-63><a class=lnlinks href=#hl-22-63>63</a>
</span><span class=lnt id=hl-22-64><a class=lnlinks href=#hl-22-64>64</a>
</span><span class=lnt id=hl-22-65><a class=lnlinks href=#hl-22-65>65</a>
</span><span class=lnt id=hl-22-66><a class=lnlinks href=#hl-22-66>66</a>
</span><span class=lnt id=hl-22-67><a class=lnlinks href=#hl-22-67>67</a>
</span><span class=lnt id=hl-22-68><a class=lnlinks href=#hl-22-68>68</a>
</span><span class=lnt id=hl-22-69><a class=lnlinks href=#hl-22-69>69</a>
</span><span class=lnt id=hl-22-70><a class=lnlinks href=#hl-22-70>70</a>
</span><span class=lnt id=hl-22-71><a class=lnlinks href=#hl-22-71>71</a>
</span><span class=lnt id=hl-22-72><a class=lnlinks href=#hl-22-72>72</a>
</span><span class=lnt id=hl-22-73><a class=lnlinks href=#hl-22-73>73</a>
</span><span class=lnt id=hl-22-74><a class=lnlinks href=#hl-22-74>74</a>
</span><span class=lnt id=hl-22-75><a class=lnlinks href=#hl-22-75>75</a>
</span><span class=lnt id=hl-22-76><a class=lnlinks href=#hl-22-76>76</a>
</span><span class=lnt id=hl-22-77><a class=lnlinks href=#hl-22-77>77</a>
</span><span class=lnt id=hl-22-78><a class=lnlinks href=#hl-22-78>78</a>
</span><span class=lnt id=hl-22-79><a class=lnlinks href=#hl-22-79>79</a>
</span><span class=lnt id=hl-22-80><a class=lnlinks href=#hl-22-80>80</a>
</span><span class=lnt id=hl-22-81><a class=lnlinks href=#hl-22-81>81</a>
</span><span class=lnt id=hl-22-82><a class=lnlinks href=#hl-22-82>82</a>
</span><span class=lnt id=hl-22-83><a class=lnlinks href=#hl-22-83>83</a>
</span><span class=lnt id=hl-22-84><a class=lnlinks href=#hl-22-84>84</a>
</span><span class=lnt id=hl-22-85><a class=lnlinks href=#hl-22-85>85</a>
</span><span class=lnt id=hl-22-86><a class=lnlinks href=#hl-22-86>86</a>
</span><span class=lnt id=hl-22-87><a class=lnlinks href=#hl-22-87>87</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 서버 측 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>createUsers</span><span class=p>(</span><span class=kd>final</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>CreateUsersResponse</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>successCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>failedUsers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onNext</span><span class=p>(</span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 사용자 유효성 검사</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getName</span><span class=p>().</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>failedUsers</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;ID: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; - 이름은 필수 필드입니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 사용자 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>userRepository</span><span class=p>.</span><span class=na>createUser</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>successCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>failedUsers</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;ID: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; - &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onError</span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;클라이언트 스트림 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>fromThrowable</span><span class=p>(</span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onCompleted</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 모든 결과 요약하여 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CreateUsersResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CreateUsersResponse</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setSuccessCount</span><span class=p>(</span><span class=n>successCount</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>addAllFailedUsers</span><span class=p>(</span><span class=n>failedUsers</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 클라이언트 측 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>CreateUsersResponse</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>CreateUsersResponse</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onNext</span><span class=p>(</span><span class=n>CreateUsersResponse</span><span class=w> </span><span class=n>response</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;성공적으로 생성된 사용자 수: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getSuccessCount</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>failure</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getFailedUsersList</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>warning</span><span class=p>(</span><span class=s>&#34;사용자 생성 실패: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>failure</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onError</span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>fromThrowable</span><span class=p>(</span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;스트림 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>status</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onCompleted</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;스트림 완료&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>requestObserver</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>asyncStub</span><span class=p>.</span><span class=na>createUsers</span><span class=p>(</span><span class=n>responseObserver</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>users</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>requestObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 일시 중단을 요청받았는지 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>isInterrupted</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InterruptedException</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>requestObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>RuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>requestObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>throw</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>requestObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=n>Status</span><span class=p>.</span><span class=na>CANCELLED</span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;취소됨&#34;</span><span class=p>).</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>interrupt</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=양방향-스트리밍-rpc>양방향 스트리밍 RPC<a hidden class=anchor aria-hidden=true href=#양방향-스트리밍-rpc>#</a></h4><p>양방향 스트리밍 RPC에서는 클라이언트와 서버 모두 스트림을 통해 메시지를 주고받는다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17>17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18>18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19>19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20>20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21>21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22>22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23>23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24>24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25>25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26>26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27>27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28>28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29>29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30>30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31>31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32>32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33>33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34>34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35>35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36>36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37>37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38>38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39>39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40>40</a>
</span><span class=lnt id=hl-23-41><a class=lnlinks href=#hl-23-41>41</a>
</span><span class=lnt id=hl-23-42><a class=lnlinks href=#hl-23-42>42</a>
</span><span class=lnt id=hl-23-43><a class=lnlinks href=#hl-23-43>43</a>
</span><span class=lnt id=hl-23-44><a class=lnlinks href=#hl-23-44>44</a>
</span><span class=lnt id=hl-23-45><a class=lnlinks href=#hl-23-45>45</a>
</span><span class=lnt id=hl-23-46><a class=lnlinks href=#hl-23-46>46</a>
</span><span class=lnt id=hl-23-47><a class=lnlinks href=#hl-23-47>47</a>
</span><span class=lnt id=hl-23-48><a class=lnlinks href=#hl-23-48>48</a>
</span><span class=lnt id=hl-23-49><a class=lnlinks href=#hl-23-49>49</a>
</span><span class=lnt id=hl-23-50><a class=lnlinks href=#hl-23-50>50</a>
</span><span class=lnt id=hl-23-51><a class=lnlinks href=#hl-23-51>51</a>
</span><span class=lnt id=hl-23-52><a class=lnlinks href=#hl-23-52>52</a>
</span><span class=lnt id=hl-23-53><a class=lnlinks href=#hl-23-53>53</a>
</span><span class=lnt id=hl-23-54><a class=lnlinks href=#hl-23-54>54</a>
</span><span class=lnt id=hl-23-55><a class=lnlinks href=#hl-23-55>55</a>
</span><span class=lnt id=hl-23-56><a class=lnlinks href=#hl-23-56>56</a>
</span><span class=lnt id=hl-23-57><a class=lnlinks href=#hl-23-57>57</a>
</span><span class=lnt id=hl-23-58><a class=lnlinks href=#hl-23-58>58</a>
</span><span class=lnt id=hl-23-59><a class=lnlinks href=#hl-23-59>59</a>
</span><span class=lnt id=hl-23-60><a class=lnlinks href=#hl-23-60>60</a>
</span><span class=lnt id=hl-23-61><a class=lnlinks href=#hl-23-61>61</a>
</span><span class=lnt id=hl-23-62><a class=lnlinks href=#hl-23-62>62</a>
</span><span class=lnt id=hl-23-63><a class=lnlinks href=#hl-23-63>63</a>
</span><span class=lnt id=hl-23-64><a class=lnlinks href=#hl-23-64>64</a>
</span><span class=lnt id=hl-23-65><a class=lnlinks href=#hl-23-65>65</a>
</span><span class=lnt id=hl-23-66><a class=lnlinks href=#hl-23-66>66</a>
</span><span class=lnt id=hl-23-67><a class=lnlinks href=#hl-23-67>67</a>
</span><span class=lnt id=hl-23-68><a class=lnlinks href=#hl-23-68>68</a>
</span><span class=lnt id=hl-23-69><a class=lnlinks href=#hl-23-69>69</a>
</span><span class=lnt id=hl-23-70><a class=lnlinks href=#hl-23-70>70</a>
</span><span class=lnt id=hl-23-71><a class=lnlinks href=#hl-23-71>71</a>
</span><span class=lnt id=hl-23-72><a class=lnlinks href=#hl-23-72>72</a>
</span><span class=lnt id=hl-23-73><a class=lnlinks href=#hl-23-73>73</a>
</span><span class=lnt id=hl-23-74><a class=lnlinks href=#hl-23-74>74</a>
</span><span class=lnt id=hl-23-75><a class=lnlinks href=#hl-23-75>75</a>
</span><span class=lnt id=hl-23-76><a class=lnlinks href=#hl-23-76>76</a>
</span><span class=lnt id=hl-23-77><a class=lnlinks href=#hl-23-77>77</a>
</span><span class=lnt id=hl-23-78><a class=lnlinks href=#hl-23-78>78</a>
</span><span class=lnt id=hl-23-79><a class=lnlinks href=#hl-23-79>79</a>
</span><span class=lnt id=hl-23-80><a class=lnlinks href=#hl-23-80>80</a>
</span><span class=lnt id=hl-23-81><a class=lnlinks href=#hl-23-81>81</a>
</span><span class=lnt id=hl-23-82><a class=lnlinks href=#hl-23-82>82</a>
</span><span class=lnt id=hl-23-83><a class=lnlinks href=#hl-23-83>83</a>
</span><span class=lnt id=hl-23-84><a class=lnlinks href=#hl-23-84>84</a>
</span><span class=lnt id=hl-23-85><a class=lnlinks href=#hl-23-85>85</a>
</span><span class=lnt id=hl-23-86><a class=lnlinks href=#hl-23-86>86</a>
</span><span class=lnt id=hl-23-87><a class=lnlinks href=#hl-23-87>87</a>
</span><span class=lnt id=hl-23-88><a class=lnlinks href=#hl-23-88>88</a>
</span><span class=lnt id=hl-23-89><a class=lnlinks href=#hl-23-89>89</a>
</span><span class=lnt id=hl-23-90><a class=lnlinks href=#hl-23-90>90</a>
</span><span class=lnt id=hl-23-91><a class=lnlinks href=#hl-23-91>91</a>
</span><span class=lnt id=hl-23-92><a class=lnlinks href=#hl-23-92>92</a>
</span><span class=lnt id=hl-23-93><a class=lnlinks href=#hl-23-93>93</a>
</span><span class=lnt id=hl-23-94><a class=lnlinks href=#hl-23-94>94</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 서버 측 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>ChatMessage</span><span class=o>&gt;</span><span class=w> </span><span class=nf>chat</span><span class=p>(</span><span class=kd>final</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>ChatMessage</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>ChatMessage</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onNext</span><span class=p>(</span><span class=n>ChatMessage</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 메시지 유효성 검사</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=na>getContent</span><span class=p>().</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>Status</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;빈 메시지는 허용되지 않습니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 금지된 단어 검사</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>containsProfanity</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=na>getContent</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>Status</span><span class=p>.</span><span class=na>PERMISSION_DENIED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;부적절한 콘텐츠가 포함되어 있습니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 메시지 처리 및 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ChatMessage</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>processAndCreateResponse</span><span class=p>(</span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;채팅 메시지 처리 중 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>Status</span><span class=p>.</span><span class=na>INTERNAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;메시지 처리 중 오류가 발생했습니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onError</span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>warning</span><span class=p>(</span><span class=s>&#34;클라이언트 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 리소스 정리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onCompleted</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;클라이언트가 채팅을 완료했습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 클라이언트 측 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>ChatMessage</span><span class=o>&gt;</span><span class=w> </span><span class=n>requestObserver</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>asyncStub</span><span class=p>.</span><span class=na>chat</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>ChatMessage</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onNext</span><span class=p>(</span><span class=n>ChatMessage</span><span class=w> </span><span class=n>response</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 서버 응답 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>processServerResponse</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onError</span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>fromThrowable</span><span class=p>(</span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>warning</span><span class=p>(</span><span class=s>&#34;잘못된 메시지: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>PERMISSION_DENIED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>warning</span><span class=p>(</span><span class=s>&#34;권한 거부: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;채팅 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>status</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// UI에 오류 표시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>showErrorToUser</span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onCompleted</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;채팅이 완료되었습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 사용자 메시지 전송</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>ChatMessage</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>userMessages</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>requestObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 채팅 완료</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>requestObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>RuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>requestObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>throw</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=grpc-오류-처리와-모니터링>gRPC 오류 처리와 모니터링<a hidden class=anchor aria-hidden=true href=#grpc-오류-처리와-모니터링>#</a></h3><p>분산 시스템에서는 오류를 모니터링하고 추적하는 것이 중요하다.</p><h4 id=로깅과-추적logging-and-tracing>로깅과 추적(Logging and Tracing)<a hidden class=anchor aria-hidden=true href=#로깅과-추적logging-and-tracing>#</a></h4><p>모든 서비스에서 일관된 로깅 및 추적을 구현하는 것이 중요하다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29>29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30>30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31>31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32>32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33>33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34>34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35>35</a>
</span><span class=lnt id=hl-24-36><a class=lnlinks href=#hl-24-36>36</a>
</span><span class=lnt id=hl-24-37><a class=lnlinks href=#hl-24-37>37</a>
</span><span class=lnt id=hl-24-38><a class=lnlinks href=#hl-24-38>38</a>
</span><span class=lnt id=hl-24-39><a class=lnlinks href=#hl-24-39>39</a>
</span><span class=lnt id=hl-24-40><a class=lnlinks href=#hl-24-40>40</a>
</span><span class=lnt id=hl-24-41><a class=lnlinks href=#hl-24-41>41</a>
</span><span class=lnt id=hl-24-42><a class=lnlinks href=#hl-24-42>42</a>
</span><span class=lnt id=hl-24-43><a class=lnlinks href=#hl-24-43>43</a>
</span><span class=lnt id=hl-24-44><a class=lnlinks href=#hl-24-44>44</a>
</span><span class=lnt id=hl-24-45><a class=lnlinks href=#hl-24-45>45</a>
</span><span class=lnt id=hl-24-46><a class=lnlinks href=#hl-24-46>46</a>
</span><span class=lnt id=hl-24-47><a class=lnlinks href=#hl-24-47>47</a>
</span><span class=lnt id=hl-24-48><a class=lnlinks href=#hl-24-48>48</a>
</span><span class=lnt id=hl-24-49><a class=lnlinks href=#hl-24-49>49</a>
</span><span class=lnt id=hl-24-50><a class=lnlinks href=#hl-24-50>50</a>
</span><span class=lnt id=hl-24-51><a class=lnlinks href=#hl-24-51>51</a>
</span><span class=lnt id=hl-24-52><a class=lnlinks href=#hl-24-52>52</a>
</span><span class=lnt id=hl-24-53><a class=lnlinks href=#hl-24-53>53</a>
</span><span class=lnt id=hl-24-54><a class=lnlinks href=#hl-24-54>54</a>
</span><span class=lnt id=hl-24-55><a class=lnlinks href=#hl-24-55>55</a>
</span><span class=lnt id=hl-24-56><a class=lnlinks href=#hl-24-56>56</a>
</span><span class=lnt id=hl-24-57><a class=lnlinks href=#hl-24-57>57</a>
</span><span class=lnt id=hl-24-58><a class=lnlinks href=#hl-24-58>58</a>
</span><span class=lnt id=hl-24-59><a class=lnlinks href=#hl-24-59>59</a>
</span><span class=lnt id=hl-24-60><a class=lnlinks href=#hl-24-60>60</a>
</span><span class=lnt id=hl-24-61><a class=lnlinks href=#hl-24-61>61</a>
</span><span class=lnt id=hl-24-62><a class=lnlinks href=#hl-24-62>62</a>
</span><span class=lnt id=hl-24-63><a class=lnlinks href=#hl-24-63>63</a>
</span><span class=lnt id=hl-24-64><a class=lnlinks href=#hl-24-64>64</a>
</span><span class=lnt id=hl-24-65><a class=lnlinks href=#hl-24-65>65</a>
</span><span class=lnt id=hl-24-66><a class=lnlinks href=#hl-24-66>66</a>
</span><span class=lnt id=hl-24-67><a class=lnlinks href=#hl-24-67>67</a>
</span><span class=lnt id=hl-24-68><a class=lnlinks href=#hl-24-68>68</a>
</span><span class=lnt id=hl-24-69><a class=lnlinks href=#hl-24-69>69</a>
</span><span class=lnt id=hl-24-70><a class=lnlinks href=#hl-24-70>70</a>
</span><span class=lnt id=hl-24-71><a class=lnlinks href=#hl-24-71>71</a>
</span><span class=lnt id=hl-24-72><a class=lnlinks href=#hl-24-72>72</a>
</span><span class=lnt id=hl-24-73><a class=lnlinks href=#hl-24-73>73</a>
</span><span class=lnt id=hl-24-74><a class=lnlinks href=#hl-24-74>74</a>
</span><span class=lnt id=hl-24-75><a class=lnlinks href=#hl-24-75>75</a>
</span><span class=lnt id=hl-24-76><a class=lnlinks href=#hl-24-76>76</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 인터셉터를 통한 로깅 및 추적 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>LoggingInterceptor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ServerInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Logger</span><span class=w> </span><span class=n>logger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Logger</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>LoggingInterceptor</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=w> </span><span class=nf>interceptCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>call</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCallHandler</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>methodName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>call</span><span class=p>.</span><span class=na>getMethodDescriptor</span><span class=p>().</span><span class=na>getFullMethodName</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>traceId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>extractTraceId</span><span class=p>(</span><span class=n>headers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;[%s] 메서드 호출 시작: %s&#34;</span><span class=p>,</span><span class=w> </span><span class=n>traceId</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ForwardingServerCallListener</span><span class=p>.</span><span class=na>SimpleForwardingServerCallListener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>next</span><span class=p>.</span><span class=na>startCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>new</span><span class=w> </span><span class=n>ForwardingServerCall</span><span class=p>.</span><span class=na>SimpleForwardingServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=p>(</span><span class=n>call</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>close</span><span class=p>(</span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=s>&#34;[%s] 메서드 완료: %s, 상태: %s&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>traceId</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>status</span><span class=p>.</span><span class=na>isOk</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>logger</span><span class=p>.</span><span class=na>warning</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=s>&#34;[%s] 오류 발생: %s, 설명: %s&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=n>traceId</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>(),</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=kd>super</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>trailers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>},</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>headers</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onMessage</span><span class=p>(</span><span class=n>ReqT</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;[%s] 메시지 수신: %s&#34;</span><span class=p>,</span><span class=w> </span><span class=n>traceId</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>super</span><span class=p>.</span><span class=na>onMessage</span><span class=p>(</span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onHalfClose</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;[%s] 클라이언트 스트림 종료: %s&#34;</span><span class=p>,</span><span class=w> </span><span class=n>traceId</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>super</span><span class=p>.</span><span class=na>onHalfClose</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onCancel</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>warning</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;[%s] 호출 취소됨: %s&#34;</span><span class=p>,</span><span class=w> </span><span class=n>traceId</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>super</span><span class=p>.</span><span class=na>onCancel</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onComplete</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;[%s] 호출 완료: %s&#34;</span><span class=p>,</span><span class=w> </span><span class=n>traceId</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>super</span><span class=p>.</span><span class=na>onComplete</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>extractTraceId</span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 헤더에서 추적 ID 추출 또는 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>traceIdKey</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;x-trace-id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>traceId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>headers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>traceIdKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>traceId</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>traceId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 새로운 추적 ID를 헤더에 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>headers</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>traceIdKey</span><span class=p>,</span><span class=w> </span><span class=n>traceId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>traceId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=메트릭-수집metrics-collection>메트릭 수집(Metrics Collection)<a hidden class=anchor aria-hidden=true href=#메트릭-수집metrics-collection>#</a></h4><p>gRPC 호출 성공률, 지연 시간, 오류율 등의 메트릭을 수집하여 서비스 품질을 모니터링할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37>37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38>38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39>39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40>40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41>41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42>42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43>43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44>44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45>45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46>46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47>47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48>48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49>49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50>50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51>51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52>52</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 메트릭 수집 인터셉터 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MetricsInterceptor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ServerInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MeterRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>MetricsInterceptor</span><span class=p>(</span><span class=n>MeterRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>registry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>registry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=w> </span><span class=nf>interceptCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>call</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCallHandler</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>methodName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>call</span><span class=p>.</span><span class=na>getMethodDescriptor</span><span class=p>().</span><span class=na>getFullMethodName</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Timer</span><span class=p>.</span><span class=na>Sample</span><span class=w> </span><span class=n>timer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Timer</span><span class=p>.</span><span class=na>start</span><span class=p>(</span><span class=n>registry</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 요청 카운터 증가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>registry</span><span class=p>.</span><span class=na>counter</span><span class=p>(</span><span class=s>&#34;grpc.requests.total&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;method&#34;</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>).</span><span class=na>increment</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ForwardingServerCallListener</span><span class=p>.</span><span class=na>SimpleForwardingServerCallListener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>next</span><span class=p>.</span><span class=na>startCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>new</span><span class=w> </span><span class=n>ForwardingServerCall</span><span class=p>.</span><span class=na>SimpleForwardingServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=p>(</span><span class=n>call</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>close</span><span class=p>(</span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=c1>// 타이머 정지 및 레이턴시 기록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>timer</span><span class=p>.</span><span class=na>stop</span><span class=p>(</span><span class=n>Timer</span><span class=p>.</span><span class=na>builder</span><span class=p>(</span><span class=s>&#34;grpc.requests.latency&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;method&#34;</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>().</span><span class=na>toString</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>registry</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=c1>// 상태 코드별 카운터 증가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>registry</span><span class=p>.</span><span class=na>counter</span><span class=p>(</span><span class=s>&#34;grpc.requests.status&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=s>&#34;method&#34;</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>().</span><span class=na>toString</span><span class=p>()).</span><span class=na>increment</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=c1>// 오류인 경우 오류 카운터 증가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>status</span><span class=p>.</span><span class=na>isOk</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>registry</span><span class=p>.</span><span class=na>counter</span><span class=p>(</span><span class=s>&#34;grpc.requests.errors&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                        </span><span class=s>&#34;method&#34;</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                        </span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>().</span><span class=na>toString</span><span class=p>()).</span><span class=na>increment</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=kd>super</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>trailers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>},</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>headers</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 리스너 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=분산-추적distributed-tracing>분산 추적(Distributed Tracing)<a hidden class=anchor aria-hidden=true href=#분산-추적distributed-tracing>#</a></h4><p>OpenTelemetry와 같은 분산 추적 시스템을 사용하여 서비스 간 호출을 추적할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15>15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16>16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17>17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18>18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19>19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20>20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21>21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22>22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23>23</a>
</span><span class=lnt id=hl-26-24><a class=lnlinks href=#hl-26-24>24</a>
</span><span class=lnt id=hl-26-25><a class=lnlinks href=#hl-26-25>25</a>
</span><span class=lnt id=hl-26-26><a class=lnlinks href=#hl-26-26>26</a>
</span><span class=lnt id=hl-26-27><a class=lnlinks href=#hl-26-27>27</a>
</span><span class=lnt id=hl-26-28><a class=lnlinks href=#hl-26-28>28</a>
</span><span class=lnt id=hl-26-29><a class=lnlinks href=#hl-26-29>29</a>
</span><span class=lnt id=hl-26-30><a class=lnlinks href=#hl-26-30>30</a>
</span><span class=lnt id=hl-26-31><a class=lnlinks href=#hl-26-31>31</a>
</span><span class=lnt id=hl-26-32><a class=lnlinks href=#hl-26-32>32</a>
</span><span class=lnt id=hl-26-33><a class=lnlinks href=#hl-26-33>33</a>
</span><span class=lnt id=hl-26-34><a class=lnlinks href=#hl-26-34>34</a>
</span><span class=lnt id=hl-26-35><a class=lnlinks href=#hl-26-35>35</a>
</span><span class=lnt id=hl-26-36><a class=lnlinks href=#hl-26-36>36</a>
</span><span class=lnt id=hl-26-37><a class=lnlinks href=#hl-26-37>37</a>
</span><span class=lnt id=hl-26-38><a class=lnlinks href=#hl-26-38>38</a>
</span><span class=lnt id=hl-26-39><a class=lnlinks href=#hl-26-39>39</a>
</span><span class=lnt id=hl-26-40><a class=lnlinks href=#hl-26-40>40</a>
</span><span class=lnt id=hl-26-41><a class=lnlinks href=#hl-26-41>41</a>
</span><span class=lnt id=hl-26-42><a class=lnlinks href=#hl-26-42>42</a>
</span><span class=lnt id=hl-26-43><a class=lnlinks href=#hl-26-43>43</a>
</span><span class=lnt id=hl-26-44><a class=lnlinks href=#hl-26-44>44</a>
</span><span class=lnt id=hl-26-45><a class=lnlinks href=#hl-26-45>45</a>
</span><span class=lnt id=hl-26-46><a class=lnlinks href=#hl-26-46>46</a>
</span><span class=lnt id=hl-26-47><a class=lnlinks href=#hl-26-47>47</a>
</span><span class=lnt id=hl-26-48><a class=lnlinks href=#hl-26-48>48</a>
</span><span class=lnt id=hl-26-49><a class=lnlinks href=#hl-26-49>49</a>
</span><span class=lnt id=hl-26-50><a class=lnlinks href=#hl-26-50>50</a>
</span><span class=lnt id=hl-26-51><a class=lnlinks href=#hl-26-51>51</a>
</span><span class=lnt id=hl-26-52><a class=lnlinks href=#hl-26-52>52</a>
</span><span class=lnt id=hl-26-53><a class=lnlinks href=#hl-26-53>53</a>
</span><span class=lnt id=hl-26-54><a class=lnlinks href=#hl-26-54>54</a>
</span><span class=lnt id=hl-26-55><a class=lnlinks href=#hl-26-55>55</a>
</span><span class=lnt id=hl-26-56><a class=lnlinks href=#hl-26-56>56</a>
</span><span class=lnt id=hl-26-57><a class=lnlinks href=#hl-26-57>57</a>
</span><span class=lnt id=hl-26-58><a class=lnlinks href=#hl-26-58>58</a>
</span><span class=lnt id=hl-26-59><a class=lnlinks href=#hl-26-59>59</a>
</span><span class=lnt id=hl-26-60><a class=lnlinks href=#hl-26-60>60</a>
</span><span class=lnt id=hl-26-61><a class=lnlinks href=#hl-26-61>61</a>
</span><span class=lnt id=hl-26-62><a class=lnlinks href=#hl-26-62>62</a>
</span><span class=lnt id=hl-26-63><a class=lnlinks href=#hl-26-63>63</a>
</span><span class=lnt id=hl-26-64><a class=lnlinks href=#hl-26-64>64</a>
</span><span class=lnt id=hl-26-65><a class=lnlinks href=#hl-26-65>65</a>
</span><span class=lnt id=hl-26-66><a class=lnlinks href=#hl-26-66>66</a>
</span><span class=lnt id=hl-26-67><a class=lnlinks href=#hl-26-67>67</a>
</span><span class=lnt id=hl-26-68><a class=lnlinks href=#hl-26-68>68</a>
</span><span class=lnt id=hl-26-69><a class=lnlinks href=#hl-26-69>69</a>
</span><span class=lnt id=hl-26-70><a class=lnlinks href=#hl-26-70>70</a>
</span><span class=lnt id=hl-26-71><a class=lnlinks href=#hl-26-71>71</a>
</span><span class=lnt id=hl-26-72><a class=lnlinks href=#hl-26-72>72</a>
</span><span class=lnt id=hl-26-73><a class=lnlinks href=#hl-26-73>73</a>
</span><span class=lnt id=hl-26-74><a class=lnlinks href=#hl-26-74>74</a>
</span><span class=lnt id=hl-26-75><a class=lnlinks href=#hl-26-75>75</a>
</span><span class=lnt id=hl-26-76><a class=lnlinks href=#hl-26-76>76</a>
</span><span class=lnt id=hl-26-77><a class=lnlinks href=#hl-26-77>77</a>
</span><span class=lnt id=hl-26-78><a class=lnlinks href=#hl-26-78>78</a>
</span><span class=lnt id=hl-26-79><a class=lnlinks href=#hl-26-79>79</a>
</span><span class=lnt id=hl-26-80><a class=lnlinks href=#hl-26-80>80</a>
</span><span class=lnt id=hl-26-81><a class=lnlinks href=#hl-26-81>81</a>
</span><span class=lnt id=hl-26-82><a class=lnlinks href=#hl-26-82>82</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// OpenTelemetry를 사용한 분산 추적 인터셉터 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TracingInterceptor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ServerInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Tracer</span><span class=w> </span><span class=n>tracer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>TracingInterceptor</span><span class=p>(</span><span class=n>Tracer</span><span class=w> </span><span class=n>tracer</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>tracer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tracer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=w> </span><span class=nf>interceptCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>call</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCallHandler</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>methodName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>call</span><span class=p>.</span><span class=na>getMethodDescriptor</span><span class=p>().</span><span class=na>getFullMethodName</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 헤더에서 상위 컨텍스트 추출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Context</span><span class=w> </span><span class=n>parentContext</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OpenTelemetry</span><span class=p>.</span><span class=na>getPropagators</span><span class=p>().</span><span class=na>getTextMapPropagator</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>extract</span><span class=p>(</span><span class=n>Context</span><span class=p>.</span><span class=na>current</span><span class=p>(),</span><span class=w> </span><span class=n>headers</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HeadersExtractor</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 새 스팬 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Span</span><span class=w> </span><span class=n>span</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tracer</span><span class=p>.</span><span class=na>spanBuilder</span><span class=p>(</span><span class=n>methodName</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setParent</span><span class=p>(</span><span class=n>parentContext</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setSpanKind</span><span class=p>(</span><span class=n>SpanKind</span><span class=p>.</span><span class=na>SERVER</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>startSpan</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 스팬에 메서드 정보 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>span</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;rpc.service&#34;</span><span class=p>,</span><span class=w> </span><span class=n>extractService</span><span class=p>(</span><span class=n>methodName</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>span</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;rpc.method&#34;</span><span class=p>,</span><span class=w> </span><span class=n>extractMethod</span><span class=p>(</span><span class=n>methodName</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Scope</span><span class=w> </span><span class=n>scope</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>span</span><span class=p>.</span><span class=na>makeCurrent</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ForwardingServerCallListener</span><span class=p>.</span><span class=na>SimpleForwardingServerCallListener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>next</span><span class=p>.</span><span class=na>startCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>new</span><span class=w> </span><span class=n>ForwardingServerCall</span><span class=p>.</span><span class=na>SimpleForwardingServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=p>(</span><span class=n>call</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>close</span><span class=p>(</span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=c1>// 스팬에 상태 정보 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>span</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;rpc.status_code&#34;</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>().</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>status</span><span class=p>.</span><span class=na>isOk</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=c1>// 오류 정보 기록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=n>span</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>StatusCode</span><span class=p>.</span><span class=na>ERROR</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=n>span</span><span class=p>.</span><span class=na>recordException</span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=n>span</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;error.message&#34;</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=kd>super</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>trailers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>span</span><span class=p>.</span><span class=na>end</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>},</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>headers</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 리스너 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>extractService</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>fullMethodName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>index</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fullMethodName</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=sc>&#39;/&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>index</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>fullMethodName</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>index</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>fullMethodName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>extractMethod</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>fullMethodName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>index</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fullMethodName</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=sc>&#39;/&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>index</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>fullMethodName</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span><span class=n>index</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 헤더에서 컨텍스트 추출을 위한 도우미 클래스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>HeadersExtractor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>TextMapGetter</span><span class=o>&lt;</span><span class=n>Metadata</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=n>Iterable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>keys</span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>carrier</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 메타데이터 키 추출 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>Collections</span><span class=p>.</span><span class=na>emptyList</span><span class=p>();</span><span class=w>  </span><span class=c1>// 간단한 예시용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>carrier</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 메타데이터에서 값 추출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>k</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>carrier</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>k</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=보안-관련-오류-처리>보안 관련 오류 처리<a hidden class=anchor aria-hidden=true href=#보안-관련-오류-처리>#</a></h3><p>gRPC 서비스에서 보안 관련 오류는 특별한 주의가 필요하다.</p><h4 id=인증-및-인가-오류>인증 및 인가 오류<a hidden class=anchor aria-hidden=true href=#인증-및-인가-오류>#</a></h4><p>인증 및 인가 오류를 적절하게 처리하는 것이 중요하다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17>17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18>18</a>
</span><span class=lnt id=hl-27-19><a class=lnlinks href=#hl-27-19>19</a>
</span><span class=lnt id=hl-27-20><a class=lnlinks href=#hl-27-20>20</a>
</span><span class=lnt id=hl-27-21><a class=lnlinks href=#hl-27-21>21</a>
</span><span class=lnt id=hl-27-22><a class=lnlinks href=#hl-27-22>22</a>
</span><span class=lnt id=hl-27-23><a class=lnlinks href=#hl-27-23>23</a>
</span><span class=lnt id=hl-27-24><a class=lnlinks href=#hl-27-24>24</a>
</span><span class=lnt id=hl-27-25><a class=lnlinks href=#hl-27-25>25</a>
</span><span class=lnt id=hl-27-26><a class=lnlinks href=#hl-27-26>26</a>
</span><span class=lnt id=hl-27-27><a class=lnlinks href=#hl-27-27>27</a>
</span><span class=lnt id=hl-27-28><a class=lnlinks href=#hl-27-28>28</a>
</span><span class=lnt id=hl-27-29><a class=lnlinks href=#hl-27-29>29</a>
</span><span class=lnt id=hl-27-30><a class=lnlinks href=#hl-27-30>30</a>
</span><span class=lnt id=hl-27-31><a class=lnlinks href=#hl-27-31>31</a>
</span><span class=lnt id=hl-27-32><a class=lnlinks href=#hl-27-32>32</a>
</span><span class=lnt id=hl-27-33><a class=lnlinks href=#hl-27-33>33</a>
</span><span class=lnt id=hl-27-34><a class=lnlinks href=#hl-27-34>34</a>
</span><span class=lnt id=hl-27-35><a class=lnlinks href=#hl-27-35>35</a>
</span><span class=lnt id=hl-27-36><a class=lnlinks href=#hl-27-36>36</a>
</span><span class=lnt id=hl-27-37><a class=lnlinks href=#hl-27-37>37</a>
</span><span class=lnt id=hl-27-38><a class=lnlinks href=#hl-27-38>38</a>
</span><span class=lnt id=hl-27-39><a class=lnlinks href=#hl-27-39>39</a>
</span><span class=lnt id=hl-27-40><a class=lnlinks href=#hl-27-40>40</a>
</span><span class=lnt id=hl-27-41><a class=lnlinks href=#hl-27-41>41</a>
</span><span class=lnt id=hl-27-42><a class=lnlinks href=#hl-27-42>42</a>
</span><span class=lnt id=hl-27-43><a class=lnlinks href=#hl-27-43>43</a>
</span><span class=lnt id=hl-27-44><a class=lnlinks href=#hl-27-44>44</a>
</span><span class=lnt id=hl-27-45><a class=lnlinks href=#hl-27-45>45</a>
</span><span class=lnt id=hl-27-46><a class=lnlinks href=#hl-27-46>46</a>
</span><span class=lnt id=hl-27-47><a class=lnlinks href=#hl-27-47>47</a>
</span><span class=lnt id=hl-27-48><a class=lnlinks href=#hl-27-48>48</a>
</span><span class=lnt id=hl-27-49><a class=lnlinks href=#hl-27-49>49</a>
</span><span class=lnt id=hl-27-50><a class=lnlinks href=#hl-27-50>50</a>
</span><span class=lnt id=hl-27-51><a class=lnlinks href=#hl-27-51>51</a>
</span><span class=lnt id=hl-27-52><a class=lnlinks href=#hl-27-52>52</a>
</span><span class=lnt id=hl-27-53><a class=lnlinks href=#hl-27-53>53</a>
</span><span class=lnt id=hl-27-54><a class=lnlinks href=#hl-27-54>54</a>
</span><span class=lnt id=hl-27-55><a class=lnlinks href=#hl-27-55>55</a>
</span><span class=lnt id=hl-27-56><a class=lnlinks href=#hl-27-56>56</a>
</span><span class=lnt id=hl-27-57><a class=lnlinks href=#hl-27-57>57</a>
</span><span class=lnt id=hl-27-58><a class=lnlinks href=#hl-27-58>58</a>
</span><span class=lnt id=hl-27-59><a class=lnlinks href=#hl-27-59>59</a>
</span><span class=lnt id=hl-27-60><a class=lnlinks href=#hl-27-60>60</a>
</span><span class=lnt id=hl-27-61><a class=lnlinks href=#hl-27-61>61</a>
</span><span class=lnt id=hl-27-62><a class=lnlinks href=#hl-27-62>62</a>
</span><span class=lnt id=hl-27-63><a class=lnlinks href=#hl-27-63>63</a>
</span><span class=lnt id=hl-27-64><a class=lnlinks href=#hl-27-64>64</a>
</span><span class=lnt id=hl-27-65><a class=lnlinks href=#hl-27-65>65</a>
</span><span class=lnt id=hl-27-66><a class=lnlinks href=#hl-27-66>66</a>
</span><span class=lnt id=hl-27-67><a class=lnlinks href=#hl-27-67>67</a>
</span><span class=lnt id=hl-27-68><a class=lnlinks href=#hl-27-68>68</a>
</span><span class=lnt id=hl-27-69><a class=lnlinks href=#hl-27-69>69</a>
</span><span class=lnt id=hl-27-70><a class=lnlinks href=#hl-27-70>70</a>
</span><span class=lnt id=hl-27-71><a class=lnlinks href=#hl-27-71>71</a>
</span><span class=lnt id=hl-27-72><a class=lnlinks href=#hl-27-72>72</a>
</span><span class=lnt id=hl-27-73><a class=lnlinks href=#hl-27-73>73</a>
</span><span class=lnt id=hl-27-74><a class=lnlinks href=#hl-27-74>74</a>
</span><span class=lnt id=hl-27-75><a class=lnlinks href=#hl-27-75>75</a>
</span><span class=lnt id=hl-27-76><a class=lnlinks href=#hl-27-76>76</a>
</span><span class=lnt id=hl-27-77><a class=lnlinks href=#hl-27-77>77</a>
</span><span class=lnt id=hl-27-78><a class=lnlinks href=#hl-27-78>78</a>
</span><span class=lnt id=hl-27-79><a class=lnlinks href=#hl-27-79>79</a>
</span><span class=lnt id=hl-27-80><a class=lnlinks href=#hl-27-80>80</a>
</span><span class=lnt id=hl-27-81><a class=lnlinks href=#hl-27-81>81</a>
</span><span class=lnt id=hl-27-82><a class=lnlinks href=#hl-27-82>82</a>
</span><span class=lnt id=hl-27-83><a class=lnlinks href=#hl-27-83>83</a>
</span><span class=lnt id=hl-27-84><a class=lnlinks href=#hl-27-84>84</a>
</span><span class=lnt id=hl-27-85><a class=lnlinks href=#hl-27-85>85</a>
</span><span class=lnt id=hl-27-86><a class=lnlinks href=#hl-27-86>86</a>
</span><span class=lnt id=hl-27-87><a class=lnlinks href=#hl-27-87>87</a>
</span><span class=lnt id=hl-27-88><a class=lnlinks href=#hl-27-88>88</a>
</span><span class=lnt id=hl-27-89><a class=lnlinks href=#hl-27-89>89</a>
</span><span class=lnt id=hl-27-90><a class=lnlinks href=#hl-27-90>90</a>
</span><span class=lnt id=hl-27-91><a class=lnlinks href=#hl-27-91>91</a>
</span><span class=lnt id=hl-27-92><a class=lnlinks href=#hl-27-92>92</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 인증 인터셉터 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AuthInterceptor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ServerInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=w> </span><span class=nf>interceptCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>call</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCallHandler</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// … 앞부분 생략 …</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 토큰 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>UserContext</span><span class=w> </span><span class=n>userContext</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>authService</span><span class=p>.</span><span class=na>validateToken</span><span class=p>(</span><span class=n>token</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 접근 권한 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>hasPermission</span><span class=p>(</span><span class=n>userContext</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>call</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>Status</span><span class=p>.</span><span class=na>PERMISSION_DENIED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;이 작업을 수행할 권한이 없습니다&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 유효한 인증 컨텍스트를 다음 인터셉터 또는 서비스로 전달</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Context</span><span class=w> </span><span class=n>ctx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Context</span><span class=p>.</span><span class=na>current</span><span class=p>().</span><span class=na>withValue</span><span class=p>(</span><span class=n>USER_CONTEXT_KEY</span><span class=p>,</span><span class=w> </span><span class=n>userContext</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>Contexts</span><span class=p>.</span><span class=na>interceptCall</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>call</span><span class=p>,</span><span class=w> </span><span class=n>headers</span><span class=p>,</span><span class=w> </span><span class=n>next</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>ExpiredTokenException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 만료된 토큰 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>trailers</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;token-expired&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;true&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>call</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Status</span><span class=p>.</span><span class=na>UNAUTHENTICATED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;인증 토큰이 만료되었습니다&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>trailers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InvalidTokenException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 유효하지 않은 토큰 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>call</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Status</span><span class=p>.</span><span class=na>UNAUTHENTICATED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;유효하지 않은 인증 토큰입니다&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>extractToken</span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>headers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;authorization&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isPublicMethod</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>methodName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 공개 메서드 확인 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>methodName</span><span class=p>.</span><span class=na>endsWith</span><span class=p>(</span><span class=s>&#34;/Login&#34;</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>methodName</span><span class=p>.</span><span class=na>endsWith</span><span class=p>(</span><span class=s>&#34;/Register&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>hasPermission</span><span class=p>(</span><span class=n>UserContext</span><span class=w> </span><span class=n>userContext</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>methodName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 권한 확인 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>methodName</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=s>&#34;Admin&#34;</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=n>userContext</span><span class=p>.</span><span class=na>hasRole</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 클라이언트 측 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Response</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stub</span><span class=p>.</span><span class=na>protectedMethod</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 성공적인 응답 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>UNAUTHENTICATED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getTrailers</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>trailers</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;true&#34;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>trailers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;token-expired&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>))))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 토큰 재발급 시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>refreshToken</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 재시도 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 로그인 화면으로 리디렉션</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>redirectToLogin</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>PERMISSION_DENIED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 접근 거부 화면 표시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>showAccessDenied</span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=속도-제한rate-limiting-오류>속도 제한(Rate Limiting) 오류<a hidden class=anchor aria-hidden=true href=#속도-제한rate-limiting-오류>#</a></h4><p>서비스 남용을 방지하기 위한 속도 제한과 관련된 오류를 처리하는 방법:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18>18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19>19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20>20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21>21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22>22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23>23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24>24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25>25</a>
</span><span class=lnt id=hl-28-26><a class=lnlinks href=#hl-28-26>26</a>
</span><span class=lnt id=hl-28-27><a class=lnlinks href=#hl-28-27>27</a>
</span><span class=lnt id=hl-28-28><a class=lnlinks href=#hl-28-28>28</a>
</span><span class=lnt id=hl-28-29><a class=lnlinks href=#hl-28-29>29</a>
</span><span class=lnt id=hl-28-30><a class=lnlinks href=#hl-28-30>30</a>
</span><span class=lnt id=hl-28-31><a class=lnlinks href=#hl-28-31>31</a>
</span><span class=lnt id=hl-28-32><a class=lnlinks href=#hl-28-32>32</a>
</span><span class=lnt id=hl-28-33><a class=lnlinks href=#hl-28-33>33</a>
</span><span class=lnt id=hl-28-34><a class=lnlinks href=#hl-28-34>34</a>
</span><span class=lnt id=hl-28-35><a class=lnlinks href=#hl-28-35>35</a>
</span><span class=lnt id=hl-28-36><a class=lnlinks href=#hl-28-36>36</a>
</span><span class=lnt id=hl-28-37><a class=lnlinks href=#hl-28-37>37</a>
</span><span class=lnt id=hl-28-38><a class=lnlinks href=#hl-28-38>38</a>
</span><span class=lnt id=hl-28-39><a class=lnlinks href=#hl-28-39>39</a>
</span><span class=lnt id=hl-28-40><a class=lnlinks href=#hl-28-40>40</a>
</span><span class=lnt id=hl-28-41><a class=lnlinks href=#hl-28-41>41</a>
</span><span class=lnt id=hl-28-42><a class=lnlinks href=#hl-28-42>42</a>
</span><span class=lnt id=hl-28-43><a class=lnlinks href=#hl-28-43>43</a>
</span><span class=lnt id=hl-28-44><a class=lnlinks href=#hl-28-44>44</a>
</span><span class=lnt id=hl-28-45><a class=lnlinks href=#hl-28-45>45</a>
</span><span class=lnt id=hl-28-46><a class=lnlinks href=#hl-28-46>46</a>
</span><span class=lnt id=hl-28-47><a class=lnlinks href=#hl-28-47>47</a>
</span><span class=lnt id=hl-28-48><a class=lnlinks href=#hl-28-48>48</a>
</span><span class=lnt id=hl-28-49><a class=lnlinks href=#hl-28-49>49</a>
</span><span class=lnt id=hl-28-50><a class=lnlinks href=#hl-28-50>50</a>
</span><span class=lnt id=hl-28-51><a class=lnlinks href=#hl-28-51>51</a>
</span><span class=lnt id=hl-28-52><a class=lnlinks href=#hl-28-52>52</a>
</span><span class=lnt id=hl-28-53><a class=lnlinks href=#hl-28-53>53</a>
</span><span class=lnt id=hl-28-54><a class=lnlinks href=#hl-28-54>54</a>
</span><span class=lnt id=hl-28-55><a class=lnlinks href=#hl-28-55>55</a>
</span><span class=lnt id=hl-28-56><a class=lnlinks href=#hl-28-56>56</a>
</span><span class=lnt id=hl-28-57><a class=lnlinks href=#hl-28-57>57</a>
</span><span class=lnt id=hl-28-58><a class=lnlinks href=#hl-28-58>58</a>
</span><span class=lnt id=hl-28-59><a class=lnlinks href=#hl-28-59>59</a>
</span><span class=lnt id=hl-28-60><a class=lnlinks href=#hl-28-60>60</a>
</span><span class=lnt id=hl-28-61><a class=lnlinks href=#hl-28-61>61</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 속도 제한 인터셉터 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RateLimitInterceptor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ServerInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RateLimiter</span><span class=w> </span><span class=n>rateLimiter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>RateLimitInterceptor</span><span class=p>(</span><span class=n>RateLimiter</span><span class=w> </span><span class=n>rateLimiter</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>rateLimiter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rateLimiter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=w> </span><span class=nf>interceptCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>call</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCallHandler</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>methodName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>call</span><span class=p>.</span><span class=na>getMethodDescriptor</span><span class=p>().</span><span class=na>getFullMethodName</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>clientId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>extractClientId</span><span class=p>(</span><span class=n>headers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 속도 제한 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>rateLimiter</span><span class=p>.</span><span class=na>allowRequest</span><span class=p>(</span><span class=n>clientId</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 재시도 정보 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>trailers</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;retry-after-ms&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>rateLimiter</span><span class=p>.</span><span class=na>getRetryAfterMs</span><span class=p>(</span><span class=n>clientId</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>call</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Status</span><span class=p>.</span><span class=na>RESOURCE_EXHAUSTED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;요청 한도 초과. 나중에 다시 시도하세요&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>trailers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span><span class=p>{};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>next</span><span class=p>.</span><span class=na>startCall</span><span class=p>(</span><span class=n>call</span><span class=p>,</span><span class=w> </span><span class=n>headers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>extractClientId</span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 클라이언트 ID 추출 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>headers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;client-id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 클라이언트 측 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Response</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stub</span><span class=p>.</span><span class=na>frequentMethod</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 성공적인 응답 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>RESOURCE_EXHAUSTED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재시도 지연 정보 추출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getTrailers</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>retryAfterMs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>trailers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;retry-after-ms&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>retryAfterMs</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>long</span><span class=w> </span><span class=n>delayMs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Long</span><span class=p>.</span><span class=na>parseLong</span><span class=p>(</span><span class=n>retryAfterMs</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;속도 제한 초과, &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>delayMs</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;ms 후 재시도 예정&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 지연 후 재시도 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>scheduler</span><span class=p>.</span><span class=na>schedule</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>retryRequest</span><span class=p>(</span><span class=n>request</span><span class=p>),</span><span class=w> </span><span class=n>delayMs</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>MILLISECONDS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=민감한-정보-처리>민감한 정보 처리<a hidden class=anchor aria-hidden=true href=#민감한-정보-처리>#</a></h4><p>오류 메시지에서 민감한 정보가 노출되지 않도록 주의해야 한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13>13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14>14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15>15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16>16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17>17</a>
</span><span class=lnt id=hl-29-18><a class=lnlinks href=#hl-29-18>18</a>
</span><span class=lnt id=hl-29-19><a class=lnlinks href=#hl-29-19>19</a>
</span><span class=lnt id=hl-29-20><a class=lnlinks href=#hl-29-20>20</a>
</span><span class=lnt id=hl-29-21><a class=lnlinks href=#hl-29-21>21</a>
</span><span class=lnt id=hl-29-22><a class=lnlinks href=#hl-29-22>22</a>
</span><span class=lnt id=hl-29-23><a class=lnlinks href=#hl-29-23>23</a>
</span><span class=lnt id=hl-29-24><a class=lnlinks href=#hl-29-24>24</a>
</span><span class=lnt id=hl-29-25><a class=lnlinks href=#hl-29-25>25</a>
</span><span class=lnt id=hl-29-26><a class=lnlinks href=#hl-29-26>26</a>
</span><span class=lnt id=hl-29-27><a class=lnlinks href=#hl-29-27>27</a>
</span><span class=lnt id=hl-29-28><a class=lnlinks href=#hl-29-28>28</a>
</span><span class=lnt id=hl-29-29><a class=lnlinks href=#hl-29-29>29</a>
</span><span class=lnt id=hl-29-30><a class=lnlinks href=#hl-29-30>30</a>
</span><span class=lnt id=hl-29-31><a class=lnlinks href=#hl-29-31>31</a>
</span><span class=lnt id=hl-29-32><a class=lnlinks href=#hl-29-32>32</a>
</span><span class=lnt id=hl-29-33><a class=lnlinks href=#hl-29-33>33</a>
</span><span class=lnt id=hl-29-34><a class=lnlinks href=#hl-29-34>34</a>
</span><span class=lnt id=hl-29-35><a class=lnlinks href=#hl-29-35>35</a>
</span><span class=lnt id=hl-29-36><a class=lnlinks href=#hl-29-36>36</a>
</span><span class=lnt id=hl-29-37><a class=lnlinks href=#hl-29-37>37</a>
</span><span class=lnt id=hl-29-38><a class=lnlinks href=#hl-29-38>38</a>
</span><span class=lnt id=hl-29-39><a class=lnlinks href=#hl-29-39>39</a>
</span><span class=lnt id=hl-29-40><a class=lnlinks href=#hl-29-40>40</a>
</span><span class=lnt id=hl-29-41><a class=lnlinks href=#hl-29-41>41</a>
</span><span class=lnt id=hl-29-42><a class=lnlinks href=#hl-29-42>42</a>
</span><span class=lnt id=hl-29-43><a class=lnlinks href=#hl-29-43>43</a>
</span><span class=lnt id=hl-29-44><a class=lnlinks href=#hl-29-44>44</a>
</span><span class=lnt id=hl-29-45><a class=lnlinks href=#hl-29-45>45</a>
</span><span class=lnt id=hl-29-46><a class=lnlinks href=#hl-29-46>46</a>
</span><span class=lnt id=hl-29-47><a class=lnlinks href=#hl-29-47>47</a>
</span><span class=lnt id=hl-29-48><a class=lnlinks href=#hl-29-48>48</a>
</span><span class=lnt id=hl-29-49><a class=lnlinks href=#hl-29-49>49</a>
</span><span class=lnt id=hl-29-50><a class=lnlinks href=#hl-29-50>50</a>
</span><span class=lnt id=hl-29-51><a class=lnlinks href=#hl-29-51>51</a>
</span><span class=lnt id=hl-29-52><a class=lnlinks href=#hl-29-52>52</a>
</span><span class=lnt id=hl-29-53><a class=lnlinks href=#hl-29-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 민감한 정보 필터링 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ErrorSanitizingInterceptor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ServerInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Logger</span><span class=w> </span><span class=n>logger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Logger</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>ErrorSanitizingInterceptor</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=w> </span><span class=nf>interceptCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>call</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCallHandler</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>next</span><span class=p>.</span><span class=na>startCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>ForwardingServerCall</span><span class=p>.</span><span class=na>SimpleForwardingServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=p>(</span><span class=n>call</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>close</span><span class=p>(</span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>status</span><span class=p>.</span><span class=na>isOk</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=c1>// 내부 오류의 경우 상세 정보 로깅 후 일반적인 메시지로 대체</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>INTERNAL</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;내부 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=c1>// 민감한 정보가 포함된 원래 메시지 대신 일반적인 메시지 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>INTERNAL</span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;내부 서버 오류가 발생했습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=c1>// SQL 주입, 스택 트레이스 등의 패턴 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>String</span><span class=w> </span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sanitizeErrorMessage</span><span class=p>(</span><span class=n>description</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=n>description</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kd>super</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>trailers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>sanitizeErrorMessage</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// SQL 오류 패턴 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>replaceAll</span><span class=p>(</span><span class=s>&#34;(SQL|sql)\\s+error.*&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;데이터베이스 오류&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 스택 트레이스 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>replaceAll</span><span class=p>(</span><span class=s>&#34;at\\s+[\\w\\.\\$]+\\([^)]*\\).*&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 파일 경로 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>replaceAll</span><span class=p>(</span><span class=s>&#34;/(home|usr|var|etc)/[\\w/]*&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;[PATH]&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// IP 주소 제거</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>.</span><span class=na>replaceAll</span><span class=p>(</span><span class=s>&#34;\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;[IP]&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>},</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>headers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=다국어-지원과-오류-메시지-지역화>다국어 지원과 오류 메시지 지역화<a hidden class=anchor aria-hidden=true href=#다국어-지원과-오류-메시지-지역화>#</a></h3><p>국제적인 사용자를 위한 애플리케이션에서는 오류 메시지의 지역화가 중요하다.</p><h4 id=지역화된-오류-메시지-제공>지역화된 오류 메시지 제공<a hidden class=anchor aria-hidden=true href=#지역화된-오류-메시지-제공>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1>  1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2>  2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3>  3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4>  4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5>  5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6>  6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7>  7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8>  8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9>  9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10> 10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11> 11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12> 12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13> 13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14> 14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15> 15</a>
</span><span class=lnt id=hl-30-16><a class=lnlinks href=#hl-30-16> 16</a>
</span><span class=lnt id=hl-30-17><a class=lnlinks href=#hl-30-17> 17</a>
</span><span class=lnt id=hl-30-18><a class=lnlinks href=#hl-30-18> 18</a>
</span><span class=lnt id=hl-30-19><a class=lnlinks href=#hl-30-19> 19</a>
</span><span class=lnt id=hl-30-20><a class=lnlinks href=#hl-30-20> 20</a>
</span><span class=lnt id=hl-30-21><a class=lnlinks href=#hl-30-21> 21</a>
</span><span class=lnt id=hl-30-22><a class=lnlinks href=#hl-30-22> 22</a>
</span><span class=lnt id=hl-30-23><a class=lnlinks href=#hl-30-23> 23</a>
</span><span class=lnt id=hl-30-24><a class=lnlinks href=#hl-30-24> 24</a>
</span><span class=lnt id=hl-30-25><a class=lnlinks href=#hl-30-25> 25</a>
</span><span class=lnt id=hl-30-26><a class=lnlinks href=#hl-30-26> 26</a>
</span><span class=lnt id=hl-30-27><a class=lnlinks href=#hl-30-27> 27</a>
</span><span class=lnt id=hl-30-28><a class=lnlinks href=#hl-30-28> 28</a>
</span><span class=lnt id=hl-30-29><a class=lnlinks href=#hl-30-29> 29</a>
</span><span class=lnt id=hl-30-30><a class=lnlinks href=#hl-30-30> 30</a>
</span><span class=lnt id=hl-30-31><a class=lnlinks href=#hl-30-31> 31</a>
</span><span class=lnt id=hl-30-32><a class=lnlinks href=#hl-30-32> 32</a>
</span><span class=lnt id=hl-30-33><a class=lnlinks href=#hl-30-33> 33</a>
</span><span class=lnt id=hl-30-34><a class=lnlinks href=#hl-30-34> 34</a>
</span><span class=lnt id=hl-30-35><a class=lnlinks href=#hl-30-35> 35</a>
</span><span class=lnt id=hl-30-36><a class=lnlinks href=#hl-30-36> 36</a>
</span><span class=lnt id=hl-30-37><a class=lnlinks href=#hl-30-37> 37</a>
</span><span class=lnt id=hl-30-38><a class=lnlinks href=#hl-30-38> 38</a>
</span><span class=lnt id=hl-30-39><a class=lnlinks href=#hl-30-39> 39</a>
</span><span class=lnt id=hl-30-40><a class=lnlinks href=#hl-30-40> 40</a>
</span><span class=lnt id=hl-30-41><a class=lnlinks href=#hl-30-41> 41</a>
</span><span class=lnt id=hl-30-42><a class=lnlinks href=#hl-30-42> 42</a>
</span><span class=lnt id=hl-30-43><a class=lnlinks href=#hl-30-43> 43</a>
</span><span class=lnt id=hl-30-44><a class=lnlinks href=#hl-30-44> 44</a>
</span><span class=lnt id=hl-30-45><a class=lnlinks href=#hl-30-45> 45</a>
</span><span class=lnt id=hl-30-46><a class=lnlinks href=#hl-30-46> 46</a>
</span><span class=lnt id=hl-30-47><a class=lnlinks href=#hl-30-47> 47</a>
</span><span class=lnt id=hl-30-48><a class=lnlinks href=#hl-30-48> 48</a>
</span><span class=lnt id=hl-30-49><a class=lnlinks href=#hl-30-49> 49</a>
</span><span class=lnt id=hl-30-50><a class=lnlinks href=#hl-30-50> 50</a>
</span><span class=lnt id=hl-30-51><a class=lnlinks href=#hl-30-51> 51</a>
</span><span class=lnt id=hl-30-52><a class=lnlinks href=#hl-30-52> 52</a>
</span><span class=lnt id=hl-30-53><a class=lnlinks href=#hl-30-53> 53</a>
</span><span class=lnt id=hl-30-54><a class=lnlinks href=#hl-30-54> 54</a>
</span><span class=lnt id=hl-30-55><a class=lnlinks href=#hl-30-55> 55</a>
</span><span class=lnt id=hl-30-56><a class=lnlinks href=#hl-30-56> 56</a>
</span><span class=lnt id=hl-30-57><a class=lnlinks href=#hl-30-57> 57</a>
</span><span class=lnt id=hl-30-58><a class=lnlinks href=#hl-30-58> 58</a>
</span><span class=lnt id=hl-30-59><a class=lnlinks href=#hl-30-59> 59</a>
</span><span class=lnt id=hl-30-60><a class=lnlinks href=#hl-30-60> 60</a>
</span><span class=lnt id=hl-30-61><a class=lnlinks href=#hl-30-61> 61</a>
</span><span class=lnt id=hl-30-62><a class=lnlinks href=#hl-30-62> 62</a>
</span><span class=lnt id=hl-30-63><a class=lnlinks href=#hl-30-63> 63</a>
</span><span class=lnt id=hl-30-64><a class=lnlinks href=#hl-30-64> 64</a>
</span><span class=lnt id=hl-30-65><a class=lnlinks href=#hl-30-65> 65</a>
</span><span class=lnt id=hl-30-66><a class=lnlinks href=#hl-30-66> 66</a>
</span><span class=lnt id=hl-30-67><a class=lnlinks href=#hl-30-67> 67</a>
</span><span class=lnt id=hl-30-68><a class=lnlinks href=#hl-30-68> 68</a>
</span><span class=lnt id=hl-30-69><a class=lnlinks href=#hl-30-69> 69</a>
</span><span class=lnt id=hl-30-70><a class=lnlinks href=#hl-30-70> 70</a>
</span><span class=lnt id=hl-30-71><a class=lnlinks href=#hl-30-71> 71</a>
</span><span class=lnt id=hl-30-72><a class=lnlinks href=#hl-30-72> 72</a>
</span><span class=lnt id=hl-30-73><a class=lnlinks href=#hl-30-73> 73</a>
</span><span class=lnt id=hl-30-74><a class=lnlinks href=#hl-30-74> 74</a>
</span><span class=lnt id=hl-30-75><a class=lnlinks href=#hl-30-75> 75</a>
</span><span class=lnt id=hl-30-76><a class=lnlinks href=#hl-30-76> 76</a>
</span><span class=lnt id=hl-30-77><a class=lnlinks href=#hl-30-77> 77</a>
</span><span class=lnt id=hl-30-78><a class=lnlinks href=#hl-30-78> 78</a>
</span><span class=lnt id=hl-30-79><a class=lnlinks href=#hl-30-79> 79</a>
</span><span class=lnt id=hl-30-80><a class=lnlinks href=#hl-30-80> 80</a>
</span><span class=lnt id=hl-30-81><a class=lnlinks href=#hl-30-81> 81</a>
</span><span class=lnt id=hl-30-82><a class=lnlinks href=#hl-30-82> 82</a>
</span><span class=lnt id=hl-30-83><a class=lnlinks href=#hl-30-83> 83</a>
</span><span class=lnt id=hl-30-84><a class=lnlinks href=#hl-30-84> 84</a>
</span><span class=lnt id=hl-30-85><a class=lnlinks href=#hl-30-85> 85</a>
</span><span class=lnt id=hl-30-86><a class=lnlinks href=#hl-30-86> 86</a>
</span><span class=lnt id=hl-30-87><a class=lnlinks href=#hl-30-87> 87</a>
</span><span class=lnt id=hl-30-88><a class=lnlinks href=#hl-30-88> 88</a>
</span><span class=lnt id=hl-30-89><a class=lnlinks href=#hl-30-89> 89</a>
</span><span class=lnt id=hl-30-90><a class=lnlinks href=#hl-30-90> 90</a>
</span><span class=lnt id=hl-30-91><a class=lnlinks href=#hl-30-91> 91</a>
</span><span class=lnt id=hl-30-92><a class=lnlinks href=#hl-30-92> 92</a>
</span><span class=lnt id=hl-30-93><a class=lnlinks href=#hl-30-93> 93</a>
</span><span class=lnt id=hl-30-94><a class=lnlinks href=#hl-30-94> 94</a>
</span><span class=lnt id=hl-30-95><a class=lnlinks href=#hl-30-95> 95</a>
</span><span class=lnt id=hl-30-96><a class=lnlinks href=#hl-30-96> 96</a>
</span><span class=lnt id=hl-30-97><a class=lnlinks href=#hl-30-97> 97</a>
</span><span class=lnt id=hl-30-98><a class=lnlinks href=#hl-30-98> 98</a>
</span><span class=lnt id=hl-30-99><a class=lnlinks href=#hl-30-99> 99</a>
</span><span class=lnt id=hl-30-100><a class=lnlinks href=#hl-30-100>100</a>
</span><span class=lnt id=hl-30-101><a class=lnlinks href=#hl-30-101>101</a>
</span><span class=lnt id=hl-30-102><a class=lnlinks href=#hl-30-102>102</a>
</span><span class=lnt id=hl-30-103><a class=lnlinks href=#hl-30-103>103</a>
</span><span class=lnt id=hl-30-104><a class=lnlinks href=#hl-30-104>104</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 오류 메시지 지역화 인터셉터 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>LocalizedErrorInterceptor</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ServerInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ResourceBundle</span><span class=p>.</span><span class=na>Control</span><span class=w> </span><span class=n>bundleControl</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Locale</span><span class=p>,</span><span class=w> </span><span class=n>ResourceBundle</span><span class=o>&gt;</span><span class=w> </span><span class=n>errorMessageBundles</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>LocalizedErrorInterceptor</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>bundleControl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ResourceBundle</span><span class=p>.</span><span class=na>Control</span><span class=p>.</span><span class=na>getControl</span><span class=p>(</span><span class=n>ResourceBundle</span><span class=p>.</span><span class=na>Control</span><span class=p>.</span><span class=na>FORMAT_PROPERTIES</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>errorMessageBundles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ConcurrentHashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>ServerCall</span><span class=p>.</span><span class=na>Listener</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=o>&gt;</span><span class=w> </span><span class=nf>interceptCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>call</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ServerCallHandler</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=w> </span><span class=n>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 클라이언트 로케일 추출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Locale</span><span class=w> </span><span class=n>clientLocale</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>extractLocale</span><span class=p>(</span><span class=n>headers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>next</span><span class=p>.</span><span class=na>startCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>ForwardingServerCall</span><span class=p>.</span><span class=na>SimpleForwardingServerCall</span><span class=o>&lt;</span><span class=n>ReqT</span><span class=p>,</span><span class=w> </span><span class=n>RespT</span><span class=o>&gt;</span><span class=p>(</span><span class=n>call</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>close</span><span class=p>(</span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>status</span><span class=p>.</span><span class=na>isOk</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=c1>// 오류 코드 추출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>String</span><span class=w> </span><span class=n>errorCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>extractErrorCode</span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>errorCode</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=c1>// 지역화된 오류 메시지 찾기</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>String</span><span class=w> </span><span class=n>localizedMessage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getLocalizedErrorMessage</span><span class=p>(</span><span class=n>clientLocale</span><span class=p>,</span><span class=w> </span><span class=n>errorCode</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>localizedMessage</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=c1>// 지역화된 메시지로 상태 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=n>localizedMessage</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=c1>// 원래 오류 코드를 메타데이터에 포함</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>trailers</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;error-code&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=n>errorCode</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kd>super</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>trailers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>extractErrorCode</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>description</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 오류 설명에서 코드 추출 (형식: [CODE:xxxx] 메시지)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>Matcher</span><span class=w> </span><span class=n>matcher</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Pattern</span><span class=p>.</span><span class=na>compile</span><span class=p>(</span><span class=s>&#34;\\[CODE:(\\w+)\\].*&#34;</span><span class=p>).</span><span class=na>matcher</span><span class=p>(</span><span class=n>description</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>matcher</span><span class=p>.</span><span class=na>matches</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>return</span><span class=w> </span><span class=n>matcher</span><span class=p>.</span><span class=na>group</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getLocalizedErrorMessage</span><span class=p>(</span><span class=n>Locale</span><span class=w> </span><span class=n>locale</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>errorCode</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>ResourceBundle</span><span class=w> </span><span class=n>bundle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>errorMessageBundles</span><span class=p>.</span><span class=na>computeIfAbsent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>locale</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>l</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>ResourceBundle</span><span class=p>.</span><span class=na>getBundle</span><span class=p>(</span><span class=s>&#34;errors&#34;</span><span class=p>,</span><span class=w> </span><span class=n>l</span><span class=p>,</span><span class=w> </span><span class=n>bundleControl</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>return</span><span class=w> </span><span class=n>bundle</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=n>errorCode</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>MissingResourceException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=c1>// 번역이 없는 경우 원래 메시지 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>},</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>headers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Locale</span><span class=w> </span><span class=nf>extractLocale</span><span class=p>(</span><span class=n>Metadata</span><span class=w> </span><span class=n>headers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>localeStr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>headers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Metadata</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;accept-language&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=p>.</span><span class=na>ASCII_STRING_MARSHALLER</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>localeStr</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>parts</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>localeStr</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&#34;[-_]&#34;</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>parts</span><span class=p>.</span><span class=na>length</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>2</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Locale</span><span class=p>(</span><span class=n>parts</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>parts</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Locale</span><span class=p>(</span><span class=n>parts</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 기본 로케일</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Locale</span><span class=p>.</span><span class=na>US</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 서비스 구현에서 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>createUser</span><span class=p>(</span><span class=n>CreateUserRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getEmail</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=o>!</span><span class=n>isValidEmail</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getEmail</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Status</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;[CODE:INVALID_EMAIL] 유효하지 않은 이메일 주소입니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 나머지 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=다양한-언어로-오류-메시지-정의>다양한 언어로 오류 메시지 정의<a hidden class=anchor aria-hidden=true href=#다양한-언어로-오류-메시지-정의>#</a></h4><p>각 언어별 속성 파일에 오류 메시지를 정의한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10>10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11>11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12>12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13>13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=c1># errors_en.properties (영어)</span>
</span></span><span class=line><span class=cl><span class=na>INVALID_EMAIL</span><span class=o>=</span><span class=s>Invalid email address</span>
</span></span><span class=line><span class=cl><span class=na>USER_NOT_FOUND</span><span class=o>=</span><span class=s>User not found</span>
</span></span><span class=line><span class=cl><span class=na>PERMISSION_DENIED</span><span class=o>=</span><span class=s>You do not have permission to perform this action</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># errors_ko.properties (한국어)</span>
</span></span><span class=line><span class=cl><span class=na>INVALID_EMAIL</span><span class=o>=</span><span class=s>유효하지 않은 이메일 주소입니다</span>
</span></span><span class=line><span class=cl><span class=na>USER_NOT_FOUND</span><span class=o>=</span><span class=s>사용자를 찾을 수 없습니다</span>
</span></span><span class=line><span class=cl><span class=na>PERMISSION_DENIED</span><span class=o>=</span><span class=s>이 작업을 수행할 권한이 없습니다</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># errors_ja.properties (일본어)</span>
</span></span><span class=line><span class=cl><span class=na>INVALID_EMAIL</span><span class=o>=</span><span class=s>無効なメールアドレスです</span>
</span></span><span class=line><span class=cl><span class=na>USER_NOT_FOUND</span><span class=o>=</span><span class=s>ユーザーが見つかりません</span>
</span></span><span class=line><span class=cl><span class=na>PERMISSION_DENIED</span><span class=o>=</span><span class=s>この操作を実行する権限がありません</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=확장성을-고려한-오류-처리-설계>확장성을 고려한 오류 처리 설계<a hidden class=anchor aria-hidden=true href=#확장성을-고려한-오류-처리-설계>#</a></h3><p>대규모 마이크로서비스 환경에서는 확장 가능한 오류 처리 시스템이 필요하다.</p><h4 id=오류-처리-라이브러리>오류 처리 라이브러리<a hidden class=anchor aria-hidden=true href=#오류-처리-라이브러리>#</a></h4><p>모든 서비스가 공통된 오류 처리 패턴을 사용할 수 있도록 라이브러리화할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10>10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11>11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12>12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13>13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14>14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15>15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16>16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17>17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18>18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19>19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20>20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21>21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22>22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23>23</a>
</span><span class=lnt id=hl-32-24><a class=lnlinks href=#hl-32-24>24</a>
</span><span class=lnt id=hl-32-25><a class=lnlinks href=#hl-32-25>25</a>
</span><span class=lnt id=hl-32-26><a class=lnlinks href=#hl-32-26>26</a>
</span><span class=lnt id=hl-32-27><a class=lnlinks href=#hl-32-27>27</a>
</span><span class=lnt id=hl-32-28><a class=lnlinks href=#hl-32-28>28</a>
</span><span class=lnt id=hl-32-29><a class=lnlinks href=#hl-32-29>29</a>
</span><span class=lnt id=hl-32-30><a class=lnlinks href=#hl-32-30>30</a>
</span><span class=lnt id=hl-32-31><a class=lnlinks href=#hl-32-31>31</a>
</span><span class=lnt id=hl-32-32><a class=lnlinks href=#hl-32-32>32</a>
</span><span class=lnt id=hl-32-33><a class=lnlinks href=#hl-32-33>33</a>
</span><span class=lnt id=hl-32-34><a class=lnlinks href=#hl-32-34>34</a>
</span><span class=lnt id=hl-32-35><a class=lnlinks href=#hl-32-35>35</a>
</span><span class=lnt id=hl-32-36><a class=lnlinks href=#hl-32-36>36</a>
</span><span class=lnt id=hl-32-37><a class=lnlinks href=#hl-32-37>37</a>
</span><span class=lnt id=hl-32-38><a class=lnlinks href=#hl-32-38>38</a>
</span><span class=lnt id=hl-32-39><a class=lnlinks href=#hl-32-39>39</a>
</span><span class=lnt id=hl-32-40><a class=lnlinks href=#hl-32-40>40</a>
</span><span class=lnt id=hl-32-41><a class=lnlinks href=#hl-32-41>41</a>
</span><span class=lnt id=hl-32-42><a class=lnlinks href=#hl-32-42>42</a>
</span><span class=lnt id=hl-32-43><a class=lnlinks href=#hl-32-43>43</a>
</span><span class=lnt id=hl-32-44><a class=lnlinks href=#hl-32-44>44</a>
</span><span class=lnt id=hl-32-45><a class=lnlinks href=#hl-32-45>45</a>
</span><span class=lnt id=hl-32-46><a class=lnlinks href=#hl-32-46>46</a>
</span><span class=lnt id=hl-32-47><a class=lnlinks href=#hl-32-47>47</a>
</span><span class=lnt id=hl-32-48><a class=lnlinks href=#hl-32-48>48</a>
</span><span class=lnt id=hl-32-49><a class=lnlinks href=#hl-32-49>49</a>
</span><span class=lnt id=hl-32-50><a class=lnlinks href=#hl-32-50>50</a>
</span><span class=lnt id=hl-32-51><a class=lnlinks href=#hl-32-51>51</a>
</span><span class=lnt id=hl-32-52><a class=lnlinks href=#hl-32-52>52</a>
</span><span class=lnt id=hl-32-53><a class=lnlinks href=#hl-32-53>53</a>
</span><span class=lnt id=hl-32-54><a class=lnlinks href=#hl-32-54>54</a>
</span><span class=lnt id=hl-32-55><a class=lnlinks href=#hl-32-55>55</a>
</span><span class=lnt id=hl-32-56><a class=lnlinks href=#hl-32-56>56</a>
</span><span class=lnt id=hl-32-57><a class=lnlinks href=#hl-32-57>57</a>
</span><span class=lnt id=hl-32-58><a class=lnlinks href=#hl-32-58>58</a>
</span><span class=lnt id=hl-32-59><a class=lnlinks href=#hl-32-59>59</a>
</span><span class=lnt id=hl-32-60><a class=lnlinks href=#hl-32-60>60</a>
</span><span class=lnt id=hl-32-61><a class=lnlinks href=#hl-32-61>61</a>
</span><span class=lnt id=hl-32-62><a class=lnlinks href=#hl-32-62>62</a>
</span><span class=lnt id=hl-32-63><a class=lnlinks href=#hl-32-63>63</a>
</span><span class=lnt id=hl-32-64><a class=lnlinks href=#hl-32-64>64</a>
</span><span class=lnt id=hl-32-65><a class=lnlinks href=#hl-32-65>65</a>
</span><span class=lnt id=hl-32-66><a class=lnlinks href=#hl-32-66>66</a>
</span><span class=lnt id=hl-32-67><a class=lnlinks href=#hl-32-67>67</a>
</span><span class=lnt id=hl-32-68><a class=lnlinks href=#hl-32-68>68</a>
</span><span class=lnt id=hl-32-69><a class=lnlinks href=#hl-32-69>69</a>
</span><span class=lnt id=hl-32-70><a class=lnlinks href=#hl-32-70>70</a>
</span><span class=lnt id=hl-32-71><a class=lnlinks href=#hl-32-71>71</a>
</span><span class=lnt id=hl-32-72><a class=lnlinks href=#hl-32-72>72</a>
</span><span class=lnt id=hl-32-73><a class=lnlinks href=#hl-32-73>73</a>
</span><span class=lnt id=hl-32-74><a class=lnlinks href=#hl-32-74>74</a>
</span><span class=lnt id=hl-32-75><a class=lnlinks href=#hl-32-75>75</a>
</span><span class=lnt id=hl-32-76><a class=lnlinks href=#hl-32-76>76</a>
</span><span class=lnt id=hl-32-77><a class=lnlinks href=#hl-32-77>77</a>
</span><span class=lnt id=hl-32-78><a class=lnlinks href=#hl-32-78>78</a>
</span><span class=lnt id=hl-32-79><a class=lnlinks href=#hl-32-79>79</a>
</span><span class=lnt id=hl-32-80><a class=lnlinks href=#hl-32-80>80</a>
</span><span class=lnt id=hl-32-81><a class=lnlinks href=#hl-32-81>81</a>
</span><span class=lnt id=hl-32-82><a class=lnlinks href=#hl-32-82>82</a>
</span><span class=lnt id=hl-32-83><a class=lnlinks href=#hl-32-83>83</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 공통 오류 처리 라이브러리 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ErrorLibrary</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 공통 오류 코드 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>ErrorCode</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>INVALID_INPUT</span><span class=p>(</span><span class=s>&#34;INVALID_INPUT&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>NOT_FOUND</span><span class=p>(</span><span class=s>&#34;NOT_FOUND&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ALREADY_EXISTS</span><span class=p>(</span><span class=s>&#34;ALREADY_EXISTS&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>ALREADY_EXISTS</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PERMISSION_DENIED</span><span class=p>(</span><span class=s>&#34;PERMISSION_DENIED&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>PERMISSION_DENIED</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UNAUTHENTICATED</span><span class=p>(</span><span class=s>&#34;UNAUTHENTICATED&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>UNAUTHENTICATED</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>INTERNAL</span><span class=p>(</span><span class=s>&#34;INTERNAL&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>INTERNAL</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=w> </span><span class=n>statusCode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ErrorCode</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=w> </span><span class=n>statusCode</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>statusCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>statusCode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getCode</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=w> </span><span class=nf>getStatusCode</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>statusCode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 오류 상태 생성 헬퍼 메서드</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Status</span><span class=w> </span><span class=nf>createStatus</span><span class=p>(</span><span class=n>ErrorCode</span><span class=w> </span><span class=n>errorCode</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>fromCode</span><span class=p>(</span><span class=n>errorCode</span><span class=p>.</span><span class=na>getStatusCode</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;[CODE:%s] %s&#34;</span><span class=p>,</span><span class=w> </span><span class=n>errorCode</span><span class=p>.</span><span class=na>getCode</span><span class=p>(),</span><span class=w> </span><span class=n>message</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 오류 상태와 상세 정보를 포함한 예외 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=nf>createException</span><span class=p>(</span><span class=n>ErrorCode</span><span class=w> </span><span class=n>errorCode</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>createStatus</span><span class=p>(</span><span class=n>errorCode</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>).</span><span class=na>asRuntimeException</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=nf>createException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ErrorCode</span><span class=w> </span><span class=n>errorCode</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>Metadata</span><span class=w> </span><span class=n>trailers</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>createStatus</span><span class=p>(</span><span class=n>errorCode</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>).</span><span class=na>asRuntimeException</span><span class=p>(</span><span class=n>trailers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 필드 오류 상세 정보 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Metadata</span><span class=w> </span><span class=nf>createFieldErrorMetadata</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>fieldName</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>errorMessage</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Metadata</span><span class=w> </span><span class=n>metadata</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Metadata</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>BadRequest</span><span class=w> </span><span class=n>badRequest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BadRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>addFieldViolations</span><span class=p>(</span><span class=n>FieldViolation</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setField</span><span class=p>(</span><span class=n>fieldName</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setDescription</span><span class=p>(</span><span class=n>errorMessage</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>metadata</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ProtoUtils</span><span class=p>.</span><span class=na>keyForProto</span><span class=p>(</span><span class=n>BadRequest</span><span class=p>.</span><span class=na>getDefaultInstance</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>badRequest</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>metadata</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 일반적인 비즈니스 예외를 gRPC 상태로 변환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=nf>mapBusinessException</span><span class=p>(</span><span class=n>BusinessException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비즈니스 예외 유형에 따라 적절한 gRPC 상태 코드 매핑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getType</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>VALIDATION</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>createException</span><span class=p>(</span><span class=n>ErrorCode</span><span class=p>.</span><span class=na>INVALID_INPUT</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>NOT_FOUND</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>createException</span><span class=p>(</span><span class=n>ErrorCode</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>DUPLICATE</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>createException</span><span class=p>(</span><span class=n>ErrorCode</span><span class=p>.</span><span class=na>ALREADY_EXISTS</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>AUTHORIZATION</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>createException</span><span class=p>(</span><span class=n>ErrorCode</span><span class=p>.</span><span class=na>PERMISSION_DENIED</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>AUTHENTICATION</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>createException</span><span class=p>(</span><span class=n>ErrorCode</span><span class=p>.</span><span class=na>UNAUTHENTICATED</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 내부 오류는 로깅하고 일반적인 메시지 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;내부 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>createException</span><span class=p>(</span><span class=n>ErrorCode</span><span class=p>.</span><span class=na>INTERNAL</span><span class=p>,</span><span class=w> </span><span class=s>&#34;내부 서버 오류가 발생했습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=서비스-경계에서의-일관된-오류-변환>서비스 경계에서의 일관된 오류 변환<a hidden class=anchor aria-hidden=true href=#서비스-경계에서의-일관된-오류-변환>#</a></h4><p>분산 시스템의 각 계층에서 일관된 오류 변환을 적용한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15>15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16>16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17>17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18>18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19>19</a>
</span><span class=lnt id=hl-33-20><a class=lnlinks href=#hl-33-20>20</a>
</span><span class=lnt id=hl-33-21><a class=lnlinks href=#hl-33-21>21</a>
</span><span class=lnt id=hl-33-22><a class=lnlinks href=#hl-33-22>22</a>
</span><span class=lnt id=hl-33-23><a class=lnlinks href=#hl-33-23>23</a>
</span><span class=lnt id=hl-33-24><a class=lnlinks href=#hl-33-24>24</a>
</span><span class=lnt id=hl-33-25><a class=lnlinks href=#hl-33-25>25</a>
</span><span class=lnt id=hl-33-26><a class=lnlinks href=#hl-33-26>26</a>
</span><span class=lnt id=hl-33-27><a class=lnlinks href=#hl-33-27>27</a>
</span><span class=lnt id=hl-33-28><a class=lnlinks href=#hl-33-28>28</a>
</span><span class=lnt id=hl-33-29><a class=lnlinks href=#hl-33-29>29</a>
</span><span class=lnt id=hl-33-30><a class=lnlinks href=#hl-33-30>30</a>
</span><span class=lnt id=hl-33-31><a class=lnlinks href=#hl-33-31>31</a>
</span><span class=lnt id=hl-33-32><a class=lnlinks href=#hl-33-32>32</a>
</span><span class=lnt id=hl-33-33><a class=lnlinks href=#hl-33-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 서비스 계층에서의 오류 변환 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@GrpcService</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>UserServiceImpl</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>UserServiceGrpc</span><span class=p>.</span><span class=na>UserServiceImplBase</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>UserManager</span><span class=w> </span><span class=n>userManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>getUser</span><span class=p>(</span><span class=n>GetUserRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 비즈니스 로직 호출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userManager</span><span class=p>.</span><span class=na>getUser</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>UserNotFoundException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 도메인 예외를 gRPC 상태로 변환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ErrorLibrary</span><span class=p>.</span><span class=na>createException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ErrorLibrary</span><span class=p>.</span><span class=na>ErrorCode</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InvalidInputException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ErrorLibrary</span><span class=p>.</span><span class=na>createException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ErrorLibrary</span><span class=p>.</span><span class=na>ErrorCode</span><span class=p>.</span><span class=na>INVALID_INPUT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 예상치 못한 오류는 로깅하고 일반적인 메시지 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;사용자 조회 중 예상치 못한 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ErrorLibrary</span><span class=p>.</span><span class=na>createException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ErrorLibrary</span><span class=p>.</span><span class=na>ErrorCode</span><span class=p>.</span><span class=na>INTERNAL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;내부 서버 오류가 발생했습니다&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=마이크로서비스-간-오류-전파-표준화>마이크로서비스 간 오류 전파 표준화<a hidden class=anchor aria-hidden=true href=#마이크로서비스-간-오류-전파-표준화>#</a></h4><p>마이크로서비스 간 통신에서 오류 전파를 표준화하는 것은 매우 중요하다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1> 1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2> 2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3> 3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4> 4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5> 5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6> 6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7> 7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8> 8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9> 9</a>
</span><span class=lnt id=hl-34-10><a class=lnlinks href=#hl-34-10>10</a>
</span><span class=lnt id=hl-34-11><a class=lnlinks href=#hl-34-11>11</a>
</span><span class=lnt id=hl-34-12><a class=lnlinks href=#hl-34-12>12</a>
</span><span class=lnt id=hl-34-13><a class=lnlinks href=#hl-34-13>13</a>
</span><span class=lnt id=hl-34-14><a class=lnlinks href=#hl-34-14>14</a>
</span><span class=lnt id=hl-34-15><a class=lnlinks href=#hl-34-15>15</a>
</span><span class=lnt id=hl-34-16><a class=lnlinks href=#hl-34-16>16</a>
</span><span class=lnt id=hl-34-17><a class=lnlinks href=#hl-34-17>17</a>
</span><span class=lnt id=hl-34-18><a class=lnlinks href=#hl-34-18>18</a>
</span><span class=lnt id=hl-34-19><a class=lnlinks href=#hl-34-19>19</a>
</span><span class=lnt id=hl-34-20><a class=lnlinks href=#hl-34-20>20</a>
</span><span class=lnt id=hl-34-21><a class=lnlinks href=#hl-34-21>21</a>
</span><span class=lnt id=hl-34-22><a class=lnlinks href=#hl-34-22>22</a>
</span><span class=lnt id=hl-34-23><a class=lnlinks href=#hl-34-23>23</a>
</span><span class=lnt id=hl-34-24><a class=lnlinks href=#hl-34-24>24</a>
</span><span class=lnt id=hl-34-25><a class=lnlinks href=#hl-34-25>25</a>
</span><span class=lnt id=hl-34-26><a class=lnlinks href=#hl-34-26>26</a>
</span><span class=lnt id=hl-34-27><a class=lnlinks href=#hl-34-27>27</a>
</span><span class=lnt id=hl-34-28><a class=lnlinks href=#hl-34-28>28</a>
</span><span class=lnt id=hl-34-29><a class=lnlinks href=#hl-34-29>29</a>
</span><span class=lnt id=hl-34-30><a class=lnlinks href=#hl-34-30>30</a>
</span><span class=lnt id=hl-34-31><a class=lnlinks href=#hl-34-31>31</a>
</span><span class=lnt id=hl-34-32><a class=lnlinks href=#hl-34-32>32</a>
</span><span class=lnt id=hl-34-33><a class=lnlinks href=#hl-34-33>33</a>
</span><span class=lnt id=hl-34-34><a class=lnlinks href=#hl-34-34>34</a>
</span><span class=lnt id=hl-34-35><a class=lnlinks href=#hl-34-35>35</a>
</span><span class=lnt id=hl-34-36><a class=lnlinks href=#hl-34-36>36</a>
</span><span class=lnt id=hl-34-37><a class=lnlinks href=#hl-34-37>37</a>
</span><span class=lnt id=hl-34-38><a class=lnlinks href=#hl-34-38>38</a>
</span><span class=lnt id=hl-34-39><a class=lnlinks href=#hl-34-39>39</a>
</span><span class=lnt id=hl-34-40><a class=lnlinks href=#hl-34-40>40</a>
</span><span class=lnt id=hl-34-41><a class=lnlinks href=#hl-34-41>41</a>
</span><span class=lnt id=hl-34-42><a class=lnlinks href=#hl-34-42>42</a>
</span><span class=lnt id=hl-34-43><a class=lnlinks href=#hl-34-43>43</a>
</span><span class=lnt id=hl-34-44><a class=lnlinks href=#hl-34-44>44</a>
</span><span class=lnt id=hl-34-45><a class=lnlinks href=#hl-34-45>45</a>
</span><span class=lnt id=hl-34-46><a class=lnlinks href=#hl-34-46>46</a>
</span><span class=lnt id=hl-34-47><a class=lnlinks href=#hl-34-47>47</a>
</span><span class=lnt id=hl-34-48><a class=lnlinks href=#hl-34-48>48</a>
</span><span class=lnt id=hl-34-49><a class=lnlinks href=#hl-34-49>49</a>
</span><span class=lnt id=hl-34-50><a class=lnlinks href=#hl-34-50>50</a>
</span><span class=lnt id=hl-34-51><a class=lnlinks href=#hl-34-51>51</a>
</span><span class=lnt id=hl-34-52><a class=lnlinks href=#hl-34-52>52</a>
</span><span class=lnt id=hl-34-53><a class=lnlinks href=#hl-34-53>53</a>
</span><span class=lnt id=hl-34-54><a class=lnlinks href=#hl-34-54>54</a>
</span><span class=lnt id=hl-34-55><a class=lnlinks href=#hl-34-55>55</a>
</span><span class=lnt id=hl-34-56><a class=lnlinks href=#hl-34-56>56</a>
</span><span class=lnt id=hl-34-57><a class=lnlinks href=#hl-34-57>57</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 마이크로서비스 간 오류 전파 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>UserProfileServiceImpl</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>UserProfileServiceGrpc</span><span class=p>.</span><span class=na>UserProfileServiceImplBase</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>UserServiceClient</span><span class=w> </span><span class=n>userServiceClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ProfileStore</span><span class=w> </span><span class=n>profileStore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>getUserProfile</span><span class=p>(</span><span class=n>GetUserProfileRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                              </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>UserProfile</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 다른 서비스 호출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userServiceClient</span><span class=p>.</span><span class=na>getUser</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getUserId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 프로필 정보 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ProfileData</span><span class=w> </span><span class=n>profileData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>profileStore</span><span class=p>.</span><span class=na>getProfileData</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getUserId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 응답 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>UserProfile</span><span class=w> </span><span class=n>profile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserProfile</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setUserId</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getName</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getEmail</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setBio</span><span class=p>(</span><span class=n>profileData</span><span class=p>.</span><span class=na>getBio</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setPictureUrl</span><span class=p>(</span><span class=n>profileData</span><span class=p>.</span><span class=na>getPictureUrl</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>profile</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 다른 서비스에서 발생한 gRPC 오류 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Status</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getStatus</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 사용자 서비스에서 사용자를 찾지 못한 경우</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>Status</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;사용자 프로필을 찾을 수 없습니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>PERMISSION_DENIED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 권한 오류 전파</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 다른 오류의 경우 로깅 후 내부 오류로 변환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;사용자 서비스 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>status</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>Status</span><span class=p>.</span><span class=na>INTERNAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;프로필을 처리하는 중 오류가 발생했습니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 예상치 못한 오류 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>severe</span><span class=p>(</span><span class=s>&#34;프로필 처리 중 예상치 못한 오류: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Status</span><span class=p>.</span><span class=na>INTERNAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;내부 서버 오류가 발생했습니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=테스트와-오류-시뮬레이션>테스트와 오류 시뮬레이션<a hidden class=anchor aria-hidden=true href=#테스트와-오류-시뮬레이션>#</a></h3><p>오류 처리 메커니즘을 철저히 테스트하는 것은 신뢰성 있는 gRPC 서비스를 제공하는 데 필수적이다.</p><h4 id=단위-테스트와-오류-시나리오>단위 테스트와 오류 시나리오<a hidden class=anchor aria-hidden=true href=#단위-테스트와-오류-시나리오>#</a></h4><p>다양한 오류 시나리오에 대한 단위 테스트를 작성한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span><span class=lnt id=hl-35-26><a class=lnlinks href=#hl-35-26>26</a>
</span><span class=lnt id=hl-35-27><a class=lnlinks href=#hl-35-27>27</a>
</span><span class=lnt id=hl-35-28><a class=lnlinks href=#hl-35-28>28</a>
</span><span class=lnt id=hl-35-29><a class=lnlinks href=#hl-35-29>29</a>
</span><span class=lnt id=hl-35-30><a class=lnlinks href=#hl-35-30>30</a>
</span><span class=lnt id=hl-35-31><a class=lnlinks href=#hl-35-31>31</a>
</span><span class=lnt id=hl-35-32><a class=lnlinks href=#hl-35-32>32</a>
</span><span class=lnt id=hl-35-33><a class=lnlinks href=#hl-35-33>33</a>
</span><span class=lnt id=hl-35-34><a class=lnlinks href=#hl-35-34>34</a>
</span><span class=lnt id=hl-35-35><a class=lnlinks href=#hl-35-35>35</a>
</span><span class=lnt id=hl-35-36><a class=lnlinks href=#hl-35-36>36</a>
</span><span class=lnt id=hl-35-37><a class=lnlinks href=#hl-35-37>37</a>
</span><span class=lnt id=hl-35-38><a class=lnlinks href=#hl-35-38>38</a>
</span><span class=lnt id=hl-35-39><a class=lnlinks href=#hl-35-39>39</a>
</span><span class=lnt id=hl-35-40><a class=lnlinks href=#hl-35-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 오류 처리 단위 테스트 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testInvalidArgumentError</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 테스트 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>UserServiceGrpc</span><span class=p>.</span><span class=na>UserServiceBlockingStub</span><span class=w> </span><span class=n>stub</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserServiceGrpc</span><span class=p>.</span><span class=na>newBlockingStub</span><span class=p>(</span><span class=n>channel</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 잘못된 입력으로 테스트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>GetUserRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GetUserRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=o>-</span><span class=n>1</span><span class=p>)</span><span class=w>  </span><span class=c1>// 음수 ID는 유효하지 않음</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 예외 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>exception</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>assertThrows</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StatusRuntimeException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>stub</span><span class=p>.</span><span class=na>getUser</span><span class=p>(</span><span class=n>request</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 상태 코드 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>INVALID_ARGUMENT</span><span class=p>,</span><span class=w> </span><span class=n>exception</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertTrue</span><span class=p>(</span><span class=n>exception</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getDescription</span><span class=p>().</span><span class=na>contains</span><span class=p>(</span><span class=s>&#34;양수여야 합니다&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testUserNotFoundError</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 테스트 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>UserServiceGrpc</span><span class=p>.</span><span class=na>UserServiceBlockingStub</span><span class=w> </span><span class=n>stub</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserServiceGrpc</span><span class=p>.</span><span class=na>newBlockingStub</span><span class=p>(</span><span class=n>channel</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 존재하지 않는 사용자 ID로 테스트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>GetUserRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GetUserRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>9999</span><span class=p>)</span><span class=w>  </span><span class=c1>// 존재하지 않는 ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 예외 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>exception</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>assertThrows</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StatusRuntimeException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>stub</span><span class=p>.</span><span class=na>getUser</span><span class=p>(</span><span class=n>request</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 상태 코드 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>,</span><span class=w> </span><span class=n>exception</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertTrue</span><span class=p>(</span><span class=n>exception</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getDescription</span><span class=p>().</span><span class=na>contains</span><span class=p>(</span><span class=s>&#34;찾을 수 없습니다&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=통합-테스트와-오류-전파-검증>통합 테스트와 오류 전파 검증<a hidden class=anchor aria-hidden=true href=#통합-테스트와-오류-전파-검증>#</a></h4><p>여러 서비스 간의 오류 전파를 검증하는 통합 테스트를 작성한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13>13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14>14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15>15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16>16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17>17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18>18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19>19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20>20</a>
</span><span class=lnt id=hl-36-21><a class=lnlinks href=#hl-36-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 오류 전파 통합 테스트 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testErrorPropagationAcrossServices</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 테스트 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>UserProfileServiceGrpc</span><span class=p>.</span><span class=na>UserProfileServiceBlockingStub</span><span class=w> </span><span class=n>profileStub</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserProfileServiceGrpc</span><span class=p>.</span><span class=na>newBlockingStub</span><span class=p>(</span><span class=n>profileChannel</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 존재하지 않는 사용자로 프로필 요청</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>GetUserProfileRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GetUserProfileRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>setUserId</span><span class=p>(</span><span class=n>9999</span><span class=p>)</span><span class=w>  </span><span class=c1>// 존재하지 않는 ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 예외 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>StatusRuntimeException</span><span class=w> </span><span class=n>exception</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>assertThrows</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StatusRuntimeException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>profileStub</span><span class=p>.</span><span class=na>getUserProfile</span><span class=p>(</span><span class=n>request</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 프로필 서비스에서 NOT_FOUND로 변환되었는지 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>Status</span><span class=p>.</span><span class=na>Code</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>,</span><span class=w> </span><span class=n>exception</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertTrue</span><span class=p>(</span><span class=n>exception</span><span class=p>.</span><span class=na>getStatus</span><span class=p>().</span><span class=na>getDescription</span><span class=p>().</span><span class=na>contains</span><span class=p>(</span><span class=s>&#34;프로필을 찾을 수 없습니다&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=오류-시뮬레이션-테스트>오류 시뮬레이션 테스트<a hidden class=anchor aria-hidden=true href=#오류-시뮬레이션-테스트>#</a></h4><p>다양한 오류 상황을 시뮬레이션하여 시스템의 견고성을 테스트한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a>
</span><span class=lnt id=hl-37-12><a class=lnlinks href=#hl-37-12>12</a>
</span><span class=lnt id=hl-37-13><a class=lnlinks href=#hl-37-13>13</a>
</span><span class=lnt id=hl-37-14><a class=lnlinks href=#hl-37-14>14</a>
</span><span class=lnt id=hl-37-15><a class=lnlinks href=#hl-37-15>15</a>
</span><span class=lnt id=hl-37-16><a class=lnlinks href=#hl-37-16>16</a>
</span><span class=lnt id=hl-37-17><a class=lnlinks href=#hl-37-17>17</a>
</span><span class=lnt id=hl-37-18><a class=lnlinks href=#hl-37-18>18</a>
</span><span class=lnt id=hl-37-19><a class=lnlinks href=#hl-37-19>19</a>
</span><span class=lnt id=hl-37-20><a class=lnlinks href=#hl-37-20>20</a>
</span><span class=lnt id=hl-37-21><a class=lnlinks href=#hl-37-21>21</a>
</span><span class=lnt id=hl-37-22><a class=lnlinks href=#hl-37-22>22</a>
</span><span class=lnt id=hl-37-23><a class=lnlinks href=#hl-37-23>23</a>
</span><span class=lnt id=hl-37-24><a class=lnlinks href=#hl-37-24>24</a>
</span><span class=lnt id=hl-37-25><a class=lnlinks href=#hl-37-25>25</a>
</span><span class=lnt id=hl-37-26><a class=lnlinks href=#hl-37-26>26</a>
</span><span class=lnt id=hl-37-27><a class=lnlinks href=#hl-37-27>27</a>
</span><span class=lnt id=hl-37-28><a class=lnlinks href=#hl-37-28>28</a>
</span><span class=lnt id=hl-37-29><a class=lnlinks href=#hl-37-29>29</a>
</span><span class=lnt id=hl-37-30><a class=lnlinks href=#hl-37-30>30</a>
</span><span class=lnt id=hl-37-31><a class=lnlinks href=#hl-37-31>31</a>
</span><span class=lnt id=hl-37-32><a class=lnlinks href=#hl-37-32>32</a>
</span><span class=lnt id=hl-37-33><a class=lnlinks href=#hl-37-33>33</a>
</span><span class=lnt id=hl-37-34><a class=lnlinks href=#hl-37-34>34</a>
</span><span class=lnt id=hl-37-35><a class=lnlinks href=#hl-37-35>35</a>
</span><span class=lnt id=hl-37-36><a class=lnlinks href=#hl-37-36>36</a>
</span><span class=lnt id=hl-37-37><a class=lnlinks href=#hl-37-37>37</a>
</span><span class=lnt id=hl-37-38><a class=lnlinks href=#hl-37-38>38</a>
</span><span class=lnt id=hl-37-39><a class=lnlinks href=#hl-37-39>39</a>
</span><span class=lnt id=hl-37-40><a class=lnlinks href=#hl-37-40>40</a>
</span><span class=lnt id=hl-37-41><a class=lnlinks href=#hl-37-41>41</a>
</span><span class=lnt id=hl-37-42><a class=lnlinks href=#hl-37-42>42</a>
</span><span class=lnt id=hl-37-43><a class=lnlinks href=#hl-37-43>43</a>
</span><span class=lnt id=hl-37-44><a class=lnlinks href=#hl-37-44>44</a>
</span><span class=lnt id=hl-37-45><a class=lnlinks href=#hl-37-45>45</a>
</span><span class=lnt id=hl-37-46><a class=lnlinks href=#hl-37-46>46</a>
</span><span class=lnt id=hl-37-47><a class=lnlinks href=#hl-37-47>47</a>
</span><span class=lnt id=hl-37-48><a class=lnlinks href=#hl-37-48>48</a>
</span><span class=lnt id=hl-37-49><a class=lnlinks href=#hl-37-49>49</a>
</span><span class=lnt id=hl-37-50><a class=lnlinks href=#hl-37-50>50</a>
</span><span class=lnt id=hl-37-51><a class=lnlinks href=#hl-37-51>51</a>
</span><span class=lnt id=hl-37-52><a class=lnlinks href=#hl-37-52>52</a>
</span><span class=lnt id=hl-37-53><a class=lnlinks href=#hl-37-53>53</a>
</span><span class=lnt id=hl-37-54><a class=lnlinks href=#hl-37-54>54</a>
</span><span class=lnt id=hl-37-55><a class=lnlinks href=#hl-37-55>55</a>
</span><span class=lnt id=hl-37-56><a class=lnlinks href=#hl-37-56>56</a>
</span><span class=lnt id=hl-37-57><a class=lnlinks href=#hl-37-57>57</a>
</span><span class=lnt id=hl-37-58><a class=lnlinks href=#hl-37-58>58</a>
</span><span class=lnt id=hl-37-59><a class=lnlinks href=#hl-37-59>59</a>
</span><span class=lnt id=hl-37-60><a class=lnlinks href=#hl-37-60>60</a>
</span><span class=lnt id=hl-37-61><a class=lnlinks href=#hl-37-61>61</a>
</span><span class=lnt id=hl-37-62><a class=lnlinks href=#hl-37-62>62</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 오류 시뮬레이션 테스트 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testRetryMechanismOnUnavailable</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 일시적으로 사용할 수 없는 서비스 모의 객체 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Server</span><span class=w> </span><span class=n>flakyServer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createFlakyServer</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>flakyServer</span><span class=p>.</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재시도 메커니즘이 있는 스텁 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserServiceGrpc</span><span class=p>.</span><span class=na>UserServiceBlockingStub</span><span class=w> </span><span class=n>retryingStub</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>UserServiceGrpc</span><span class=p>.</span><span class=na>newBlockingStub</span><span class=p>(</span><span class=n>ManagedChannelBuilder</span><span class=p>.</span><span class=na>forAddress</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span><span class=w> </span><span class=n>flakyServer</span><span class=p>.</span><span class=na>getPort</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>usePlaintext</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>withDeadlineAfter</span><span class=p>(</span><span class=n>10</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 테스트 요청</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>GetUserRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GetUserRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>123</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재시도 후 성공적으로 응답을 받아야 함</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>retryingStub</span><span class=p>.</span><span class=na>getUser</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 응답 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>123</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=s>&#34;Test User&#34;</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>flakyServer</span><span class=p>.</span><span class=na>shutdownNow</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=n>Server</span><span class=w> </span><span class=nf>createFlakyServer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 처음 두 번은 UNAVAILABLE 오류를 반환하고, 세 번째 요청부터는 성공하는 서버</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>AtomicInteger</span><span class=w> </span><span class=n>requestCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AtomicInteger</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ServerBuilder</span><span class=p>.</span><span class=na>forPort</span><span class=p>(</span><span class=n>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>addService</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>UserServiceGrpc</span><span class=p>.</span><span class=na>UserServiceImplBase</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>getUser</span><span class=p>(</span><span class=n>GetUserRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseObserver</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>requestCount</span><span class=p>.</span><span class=na>incrementAndGet</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>count</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>2</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 처음 두 번은 UNAVAILABLE 오류</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>Status</span><span class=p>.</span><span class=na>UNAVAILABLE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>withDescription</span><span class=p>(</span><span class=s>&#34;서비스를 일시적으로 사용할 수 없습니다&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>asRuntimeException</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// 세 번째부터는 정상 응답</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;Test User&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setEmail</span><span class=p>(</span><span class=s>&#34;test@example.com&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=주요-원칙>주요 원칙<a hidden class=anchor aria-hidden=true href=#주요-원칙>#</a></h3><ol><li><strong>일관성</strong>: 모든 서비스에서 일관된 오류 코드와 형식을 사용하여 클라이언트가 쉽게 예측하고 대응할 수 있도록 한다.</li><li><strong>명확성</strong>: 오류 메시지와 코드는 오류의 원인과 가능한 해결 방법을 명확하게 전달해야 한다.</li><li><strong>보안성</strong>: 오류 메시지에 민감한 정보가 포함되지 않도록 하고, 인증 및 인가 오류를 적절하게 처리해야 한다.</li><li><strong>확장성</strong>: 오류 처리 메커니즘은 새로운 오류 유형을 추가하고 여러 서비스 간에 오류를 전파할 수 있도록 확장 가능해야 한다.</li><li><strong>재사용성</strong>: 공통 오류 처리 로직을 라이브러리나 인터셉터로 구현하여 코드 중복을 줄이고 일관성을 향상시킨다.</li></ol><h3 id=모범-사례-요약>모범 사례 요약<a hidden class=anchor aria-hidden=true href=#모범-사례-요약>#</a></h3><h4 id=서버-측-모범-사례>서버 측 모범 사례<a hidden class=anchor aria-hidden=true href=#서버-측-모범-사례>#</a></h4><ol><li><strong>적절한 상태 코드 선택</strong>: 오류 상황에 가장 적합한 gRPC 상태 코드를 선택한다.<ul><li>클라이언트 오류에는 <code>INVALID_ARGUMENT</code>, <code>NOT_FOUND</code>, <code>ALREADY_EXISTS</code> 등</li><li>서버 오류에는 <code>INTERNAL</code>, <code>UNAVAILABLE</code> 등</li><li>권한 관련 오류에는 <code>PERMISSION_DENIED</code>, <code>UNAUTHENTICATED</code> 등</li></ul></li><li><strong>유용한 오류 메시지 제공</strong>: 디버깅에 도움이 되는 명확한 오류 메시지를 제공하되, 민감한 정보는 노출하지 않는다.</li><li><strong>구조화된 오류 상세 정보</strong>: 가능한 경우 <code>google.rpc.Status</code> 확장이나 메타데이터를 사용하여 구조화된 오류 정보를 제공한다.</li><li><strong>오류 처리 중앙화</strong>: 인터셉터나 공통 라이브러리를 사용하여 오류 처리 로직을 중앙화한다.</li><li><strong>오류 매핑 표준화</strong>: 비즈니스 로직 예외를 gRPC 상태 코드로 매핑하는 일관된 전략을 사용한다.</li><li><strong>적절한 로깅</strong>: 오류 발생 시 디버깅에 필요한 정보를 로깅하되, 민감한 정보는 제외한다.</li><li><strong>스트리밍 RPC에서의 적절한 오류 처리</strong>: 스트리밍 RPC에서 오류가 발생하면 스트림을 적절하게 종료한다.</li></ol><h4 id=클라이언트-측-모범-사례>클라이언트 측 모범 사례<a hidden class=anchor aria-hidden=true href=#클라이언트-측-모범-사례>#</a></h4><ol><li><strong>오류 상태 코드 확인</strong>: 오류 응답에서 상태 코드를 확인하고 상황에 맞게 처리한다.</li><li><strong>재시도 전략 구현</strong>: 일시적인 오류(UNAVAILABLE, RESOURCE_EXHAUSTED 등)에 대한 적절한 재시도 전략을 구현한다.</li><li><strong>적절한 타임아웃 설정</strong>: 모든 RPC 호출에 적절한 타임아웃을 설정하여 응답을 무한정 기다리는 상황을 방지한다.</li><li><strong>점진적 성능 저하 처리</strong>: 일부 서비스에 문제가 발생하더라도 가능한 기능은 정상 작동하도록 설계한다.</li><li><strong>오류 메타데이터 활용</strong>: 서버에서 제공하는 추가 오류 정보(트레일러 메타데이터)를 활용한다.</li></ol><h3 id=언어별-고려-사항>언어별 고려 사항<a hidden class=anchor aria-hidden=true href=#언어별-고려-사항>#</a></h3><p>각 프로그래밍 언어는 gRPC 오류 처리에 대한 특정 패턴과 관용구를 가지고 있다:</p><ol><li><strong>Java</strong>: <code>Status</code>, <code>StatusRuntimeException</code>, <code>StreamObserver.onError()</code>를 사용한다.</li><li><strong>Go</strong>: <code>status</code> 패키지와 <code>codes</code> 패키지를 사용하여 오류를 처리한다.</li><li><strong>Python</strong>: <code>grpc.StatusCode</code>와 <code>context.set_code()</code>, <code>context.set_details()</code>를 사용한다.</li><li><strong>C#</strong>: <code>RpcException</code>과 <code>StatusCode</code> 열거형을 사용한다.</li><li><strong>JavaScript/TypeScript</strong>: <code>status</code> 객체와 콜백 패턴 또는 Promise를 사용한다.</li></ol><h3 id=전체-시스템-수준-고려-사항>전체 시스템 수준 고려 사항<a hidden class=anchor aria-hidden=true href=#전체-시스템-수준-고려-사항>#</a></h3><ol><li><strong>일관된 모니터링</strong>: 모든 서비스에서 오류 발생률, 유형, 심각도를 모니터링한다.</li><li><strong>서비스 수준 목표(SLO) 정의</strong>: 허용 가능한 오류율과 응답 시간을 정의하고 모니터링한다.</li><li><strong>문서화</strong>: 모든 서비스의 가능한 오류 코드와 처리 방법을 문서화한다.</li><li><strong>카오스 테스트</strong>: 다양한 오류 시나리오를 시뮬레이션하여 시스템의 견고성을 테스트한다.</li><li><strong>오류 처리 방식 개선</strong>: 생산 환경에서 발생하는 실제 오류를 분석하고 오류 처리 메커니즘을 지속적으로 개선한다.</li></ol><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>