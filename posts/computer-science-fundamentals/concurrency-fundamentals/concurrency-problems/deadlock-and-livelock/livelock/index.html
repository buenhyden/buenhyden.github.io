<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Livelock | hyunyoun's Blog</title><meta name=keywords content="Computer-Science-Fundamentals,Concurrency-and-Parallelism,Concurrency-Problems,Livelock,Concurrency-Issue,System-Bottleneck"><meta name=description content="라이브락(Livelock)은 둘 이상의 스레드나 프로세스가 서로 상태 변화에 반응해 계속 동작하지만, 실제 작업은 전혀 진전되지 않는 동시성 문제. 데드락과 달리 블로킹 없이 실행되나 결과는 없음. 재시도 제한, 랜덤 백오프 등이 해결책."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-fundamentals/concurrency-problems/deadlock-and-livelock/livelock/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-fundamentals/concurrency-problems/deadlock-and-livelock/livelock/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-fundamentals/concurrency-problems/deadlock-and-livelock/livelock/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-fundamentals/concurrency-problems/deadlock-and-livelock/livelock/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Livelock"><meta property="og:description" content="라이브락(Livelock)은 둘 이상의 스레드나 프로세스가 서로 상태 변화에 반응해 계속 동작하지만, 실제 작업은 전혀 진전되지 않는 동시성 문제. 데드락과 달리 블로킹 없이 실행되나 결과는 없음. 재시도 제한, 랜덤 백오프 등이 해결책."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Livelock"><meta name=twitter:description content="라이브락(Livelock)은 둘 이상의 스레드나 프로세스가 서로 상태 변화에 반응해 계속 동작하지만, 실제 작업은 전혀 진전되지 않는 동시성 문제. 데드락과 달리 블로킹 없이 실행되나 결과는 없음. 재시도 제한, 랜덤 백오프 등이 해결책."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HY's Blog","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Computer Science Fundamentals","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/"},{"@type":"ListItem","position":4,"name":"Concurrency Problems","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-fundamentals/concurrency-problems/"},{"@type":"ListItem","position":5,"name":"Livelock","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-fundamentals/concurrency-problems/deadlock-and-livelock/livelock/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>HY's Blog</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/>Computer Science Fundamentals</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-fundamentals/concurrency-problems/>Concurrency Problems</a></div><h1>Livelock</h1><div class=post-description>라이브락(Livelock)은 둘 이상의 스레드나 프로세스가 서로 상태 변화에 반응해 계속 동작하지만, 실제 작업은 전혀 진전되지 않는 동시성 문제. 데드락과 달리 블로킹 없이 실행되나 결과는 없음. 재시도 제한, 랜덤 백오프 등이 해결책.</div></header><div class=post-content><h2 id=livelock>Livelock<a hidden class=anchor aria-hidden=true href=#livelock>#</a></h2><p>라이브락 (Livelock) 은 프로세스나 스레드가 <strong>계속 실행되지만 실제 진전 없이 상태만 반복 변경하는 동시성 문제</strong>다. 데드락처럼 시스템 진행을 막지만, 블로킹 없이 동작해 탐지가 어렵다.</p><p>주로 <strong>자원 회피 전략 과잉, 잘못된 재시도 루틴, 비효율적 동기화</strong>로 발생하며, <strong>분산 트랜잭션 재시도, 네트워크 백오프, 인터럽트 핸들러 경쟁</strong> 상황에서 자주 관찰된다.<br>실무에서는 <strong>CPU 과소비, 처리 지연, 메시지 무한 대기</strong>로 이어져 성능 저하를 초래하며, <strong>랜덤 백오프, 타임아웃, 우선순위 제어</strong>로 해결할 수 있다.</p><p>Livelock 방지는 고성능 시스템 설계의 필수 요소다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><table><thead><tr><th>분류</th><th>개념</th><th>정의 요약</th></tr></thead><tbody><tr><td><strong>기본 개념</strong></td><td><strong>Livelock</strong></td><td>상태는 변하나 실질 진전이 없는 병행성 문제</td></tr><tr><td></td><td><strong>Deadlock</strong></td><td>자원 순환 대기로 인한 시스템 정지</td></tr><tr><td></td><td><strong>Starvation</strong></td><td>특정 프로세스가 자원을 계속 얻지 못하는 현상</td></tr><tr><td><strong>이론 개념</strong></td><td><strong>Liveness Property</strong></td><td>시스템이 결국 진전을 이루는 특성</td></tr><tr><td></td><td><strong>Mutual Responsiveness</strong></td><td>프로세스들이 서로 양보하며 무한 반응 상태</td></tr><tr><td></td><td><strong>Resource Contention</strong></td><td>공유 자원에 대한 경합 상황</td></tr><tr><td><strong>실무 개념</strong></td><td><strong>Backoff Algorithm</strong></td><td>실패 후 재시도 전 대기 전략 (지수/랜덤)</td></tr><tr><td></td><td><strong>Timeout</strong></td><td>일정 시간 초과 시 작업 포기</td></tr><tr><td></td><td><strong>Retry Limit</strong></td><td>재시도 횟수 제한으로 Livelock 방지</td></tr><tr><td></td><td><strong>Priority Scheduling</strong></td><td>자원 획득 우선순위 지정</td></tr><tr><td></td><td><strong>Spinlock</strong></td><td>락을 얻기 위해 지속적으로 확인하는 기법</td></tr><tr><td><strong>심화 개념</strong></td><td><strong>Wait-Free Algorithm</strong></td><td>각 스레드가 제한된 시간 내 작업 완료 보장</td></tr><tr><td></td><td><strong>Lock-Free Algorithm</strong></td><td>전체 시스템이 멈추지 않고 진전하도록 설계</td></tr><tr><td></td><td><strong>WFG (Wait-For Graph)</strong></td><td>병행성 문제를 그래프 구조로 분석</td></tr><tr><td></td><td><strong>HTM</strong></td><td>하드웨어 수준 트랜잭션 충돌 회피</td></tr><tr><td></td><td><strong>Chaos Engineering</strong></td><td>장애를 주입해 Livelock 등 회복력 점검</td></tr></tbody></table><h4 id=실무-구현-연관성-및-적용-방식>실무 구현 연관성 및 적용 방식<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성-및-적용-방식>#</a></h4><table><thead><tr><th>핵심 개념</th><th>실무 구현 연관성</th><th>적용 방식 예시</th></tr></thead><tbody><tr><td><strong>Livelock</strong></td><td>병행 시스템 내 무한 상태 전이</td><td>Retry 루프 내 양보 반복, 락 충돌 회피 로직 충돌</td></tr><tr><td><strong>Backoff Algorithm</strong></td><td>재시도 기반 동기화 구조, 네트워크 충돌 회피</td><td>Exponential Backoff + Jitter, 임계 구간 분산</td></tr><tr><td><strong>Timeout</strong></td><td>트랜잭션, API, 락 획득 등의 유한 대기 보장</td><td><code>try N seconds then abort</code>, retry-with-timeout 구조</td></tr><tr><td><strong>Retry Limit</strong></td><td>무한 루프 방지</td><td>Circuit Breaker, 최대 횟수 제한 후 Alert 발생</td></tr><tr><td><strong>Priority Scheduling</strong></td><td>우선순위에 따라 자원 할당 순서 결정</td><td>RTOS, ThreadPool 내 우선순위 기반 실행</td></tr><tr><td><strong>Spinlock</strong></td><td>커널 수준 락, 짧은 구간에서 선호됨</td><td>일정 반복 후 yield 또는 backoff 삽입</td></tr><tr><td><strong>Wait-Free</strong></td><td>고성능 병렬 자료구조 (큐, 리스트 등)</td><td>wait-free queue, Michael-Scott queue</td></tr><tr><td><strong>Lock-Free</strong></td><td>락 없는 연산을 통해 전체 시스템 진전 확보</td><td>Compare-And-Swap (CAS), Atomic 연산</td></tr><tr><td><strong>WFG</strong></td><td>병행성 분석 도구에서 Deadlock/Livelock 탐지에 활용</td><td>정적 분석 도구 또는 Runtime 추적 구조</td></tr><tr><td><strong>HTM</strong></td><td>트랜잭션 충돌로 인한 Livelock 감지 및 하드웨어 최적화</td><td>Intel TSX 기반 트랜잭션 메모리 활용</td></tr><tr><td><strong>Chaos Engineering</strong></td><td>실 시스템에 장애를 주입해 Livelock 대응력 테스트</td><td>Gremlin, Litmus 등 장애 주입 프레임워크</td></tr></tbody></table><ul><li><strong>Livelock 은 &rsquo; 진전 없는 상태 변화 &rsquo; 라는 병행성의 비효율적 현상이며</strong>, 이론적으로는 Liveness 위반으로, 실무적으로는 <strong>Retry 기반 로직과 동기화 실패</strong>에서 자주 발생해.</li><li><strong>탐지는 어렵지만</strong>, 상태 변화 + CPU 소비율 등의 지표로 간접 추적 가능.</li><li><strong>Wait-Free, Backoff, Timeout, 우선순위 스케줄링</strong> 등의 설계를 통해 예방이 가능하며, <strong>분산 시스템, 네트워크, 운영체제</strong> 등 다양한 분야에서 적용돼.</li><li>실무 적용에 있어서는 <strong>제한 기반 재시도, 랜덤화, 모니터링 지표 구성</strong>이 핵심.</li></ul><h3 id=기초-이해-foundation-understanding>기초 이해 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#기초-이해-foundation-understanding>#</a></h3><h4 id=개념-정의-및-본질><strong>개념 정의 및 본질</strong><a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질>#</a></h4><p>라이브락 (Livelock) 은 둘 이상의 프로세스 또는 스레드가 서로의 상태 변화에 끊임없이 반응하며 반복적으로 실행하지만, <strong>실질적인 진전 없이 동일한 패턴을 반복하는 동시성 문제</strong>이다.<br>시스템은 활동 중이지만 실제 작업은 수행되지 않고, 결과적으로 자원만 소모된다.</p><h4 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h4><ul><li><strong>1975 년</strong>: Edward A. Ashcroft 가 항공 예약 시스템 사례를 통해 &lsquo;Livelock&rsquo; 용어를 처음 사용하며 정의됨</li><li><strong>1996–97 년</strong>: Mogul 과 Ramakrishnan 이 네트워크 인터럽트 처리에서 발생하는 &ldquo;Receive Livelock&rdquo; 문제를 연구하고, <strong>Interrupt 와 Polling 전환, batching, CPU 할당 제어</strong> 등의 해결책을 제안</li><li><strong>2000 년대 이후</strong>: 멀티코어 및 분산 시스템, 클라우드/마이크로서비스 아키텍처에서 Livelock 문제는 점차 다차원적으로 확대되고 있으며, 공정성 기반 스케줄링과 동기화 전략 개선, 운영층 알고리즘 설계 등이 주요 대응 방식이 됨</li></ul><h4 id=발생-원인-및-문제-상황>발생 원인 및 문제 상황<a hidden class=anchor aria-hidden=true href=#발생-원인-및-문제-상황>#</a></h4><h5 id=발생-원인>발생 원인<a hidden class=anchor aria-hidden=true href=#발생-원인>#</a></h5><ol><li><strong>과도한 양보 전략 (Excessive Yielding)</strong><ul><li>프로세스가 충돌 회피를 위해 무조건 상대에게 양보 → 서로 반복적으로 상태 변경 반복</li></ul></li><li><strong>동기화 오류 또는 잘못된 백오프/재시도 로직</strong><ul><li>동일한 retry 간격을 가진 백오프 패턴 또는 무한 retry 루프 → CPU 만 소모</li></ul></li><li><strong>Polling 기반 락 획득 로직</strong><ul><li><code>enterReg()</code> 등의 프리미티브로 계속 락 시도 → 실패 시 즉시 재시도 반복</li></ul></li><li><strong>리소스 분배 실패 사례 (Resource Starvation)</strong><ul><li>예: process table 풀 포화 시 응답 실패 → 모든 프로세스가 재시도 반복 → livelock 발생</li></ul></li><li><strong>분산 시스템 상의 프로브 또는 탐지 메시지 루프</strong><ul><li>분산 락 환경에서 리더 또는 락 소유자를 서로 양보하려 반복 메시지 송수신</li></ul></li></ol><h5 id=문제-상황>문제 상황<a hidden class=anchor aria-hidden=true href=#문제-상황>#</a></h5><ul><li><strong>활성 상태 유지</strong>: CPU 사용률은 높지만 실제 업무는 진행되지 않음</li><li><strong>시스템 정체</strong>: 외부에서 보면 응답 가능해 보이지만, 내부적으로는 기능적 정지 상태</li><li><strong>자원 낭비</strong>: 메모리, 연결 풀, 스레드 등 자원은 유지되나 유용한 작업은 수행되지 않음</li></ul><p><strong>문제 상황 예시</strong>:</p><pre class=mermaid>sequenceDiagram
    participant P1 as Process 1
    participant R as Shared Resource  
    participant P2 as Process 2
    
    loop Livelock Cycle
        P1-&gt;&gt;R: Request Access
        P2-&gt;&gt;R: Request Access  
        R--&gt;&gt;P1: Conflict Detected
        R--&gt;&gt;P2: Conflict Detected
        P1-&gt;&gt;P1: Yield &amp; Retry
        P2-&gt;&gt;P2: Yield &amp; Retry
        Note over P1,P2: Both processes are active&lt;br/&gt;but no progress made
    end
</pre><h4 id=주요-특징>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징>#</a></h4><table><thead><tr><th>구분</th><th>특징</th><th>설명</th><th>기술적 근거 및 사례</th></tr></thead><tbody><tr><td>비차단성</td><td>프로세스가 실행 상태 (RUNNING) 유지</td><td>Deadlock 과 달리 프로세스는 멈추지 않고 계속 상태 전환을 시도함</td><td>상태는 RUNNING 이지만 lock 또는 자원 요청에 반복 실패</td></tr><tr><td>진행 실패</td><td>실질 작업 미수행 (No Progress)</td><td>반복 재시도, 양보, 충돌 회피 등의 로직이 반복되며 아무 작업도 완료되지 않음</td><td>동일 자원 요청 → 자원 양보 → 재시도 → 루프 발생 (예: polite algorithm)</td></tr><tr><td>상호 반응성</td><td>프로세스 간 상태 반응 반복</td><td>프로세스들이 서로의 행동에 반응하며 충돌을 피하려다 결국 무한 반복으로 빠짐</td><td>협력 알고리즘 또는 리더 선출 시 양보 반복, 비동기 우선순위 조정 실패 사례</td></tr><tr><td>자원 소모</td><td>CPU 및 I/O 자원 낭비</td><td>처리 결과 없이 상태만 변경되므로, 지속적인 연산이 발생하며 리소스를 낭비</td><td>스핀락 반복, 폴링 루프, 재전송 메시지 등으로 인한 CPU/네트워크 사용률 급증</td></tr><tr><td>탐지 어려움</td><td>외부에서 정상처럼 보임</td><td>시스템은 계속 동작하는 듯 보이나 실제로는 작업이 진전되지 않음</td><td>로그나 모니터링 기준에서는 오류 없이 정상 처리 중처럼 인식됨 → Activity 기반 탐지 필요</td></tr><tr><td>발생 예측 어려움</td><td>재현 어려움, 타이밍 의존적</td><td>Livelock 은 충돌 시점, 재시도 간격, 양보 패턴에 따라 발생 여부가 달라짐</td><td>병렬 처리 시 실행 순서, OS 스케줄러 정책 등에 따라 비결정적 발생</td></tr></tbody></table><h3 id=핵심-이론-core-theory>핵심 이론 (Core Theory)<a hidden class=anchor aria-hidden=true href=#핵심-이론-core-theory>#</a></h3><h4 id=설계-원칙-livelock-해결-중심>설계 원칙 (Livelock 해결 중심)<a hidden class=anchor aria-hidden=true href=#설계-원칙-livelock-해결-중심>#</a></h4><ol><li><p><strong>진행 보장 (Progress Guarantee)</strong></p><ul><li>비록 livelock 상태일지라도 <strong>시스템 전체 또는 일부 작업이 최소 한 명이라도 진전하도록 설계</strong>해야 한다.</li><li><code>Non-blocking</code>, <code>lock-free</code>, <code>wait-free</code> 알고리즘은 forward progress 를 구조적으로 보장하는 좋은 설계 방식이다.</li></ul></li><li><p><strong>공정성 (Fairness)</strong></p><ul><li>특정 스레드/프로세스가 반복적으로 양보만 하게 되는 <strong>Starvation</strong> 상황을 방지해야 한다.</li><li><strong>우선순위 큐, 라운드로빈, 토큰 기반 접근, 또는 priority elevation</strong> 등을 통해 양보 전략에 균형을 줄 수 있다.</li></ul></li><li><p><strong>무작위화 원칙 (Randomization)</strong></p><ul><li>재시도 타이밍에 <strong>랜덤 jitter 또는 난수 기반 backoff</strong>를 도입해 동기화된 행동 패턴을 깨야 한다.</li><li>효과적인 충돌 회피 및 progress 확보를 위해 <strong>randomized exponential backoff</strong> 전략을 사용해야 한다.</li></ul></li><li><p><strong>적응형 백오프 (Adaptive Backoff)</strong></p><ul><li>시스템 부하나 반복 충돌 횟수에 따라 <strong>백오프 지연 시간</strong>을 동적으로 조정하는 방식.</li><li>특정 조건 (충돌 빈도, CPU 사용률 등) 에 대응해 지수형으로 증가하거나 조절된 대기 시간 설정이 효과적</li></ul></li><li><p><strong>비대칭성 (Asymmetry)</strong></p><ul><li>단일 양보 전략이 모든 참여자에게 동일하게 적용되면 synchronize 된 상태 반복 가능.</li><li><strong>프로세스별 고유한 backoff 패턴 또는 행동 루틴</strong>을 부여해 경쟁제를 분리해야 한다.</li></ul></li><li><p><strong>우선순위 기반 전략 (Priority-based)</strong></p><ul><li><strong>Priority Inversion</strong> 방지를 위해 기아 상태가 장기화되지 않도록 우선순위 승격 또는 우선순위 기반 재시도 허용.</li><li>특히 복잡한 트랜잭션 환경에서는 <strong>priority + Karma 기반 접근</strong>이 실효성 있다.</li></ul></li><li><p><strong>체크포인트 및 진전 점검 (Progress Checkpoints)</strong></p><ul><li>반복 재시도나 backoff 로직 중 <strong>주기적으로 진행 여부를 확인</strong>하고, 일정 시간 이상 진전이 없으면 행동을 전환.</li><li>checkpoint 기반 재설계가 livelock 장기화 방지에 유효</li></ul></li></ol><h5 id=설계-원칙-요약>설계 원칙 요약<a hidden class=anchor aria-hidden=true href=#설계-원칙-요약>#</a></h5><table><thead><tr><th>원칙</th><th>핵심 설명</th></tr></thead><tbody><tr><td>Progress Guarantee</td><td><code>lock-free</code> / <code>wait-free</code> 설계 확보 → forward progress 보장</td></tr><tr><td>Fairness</td><td>starvation 방지 위해 priority / round-robin / token 적용</td></tr><tr><td>Randomization</td><td>재시도 interval 에 jitter 적용 → 동기화된 패턴 회피</td></tr><tr><td>Adaptive Backoff</td><td>충돌 빈도 / 부하 반영해 지연 동적으로 조절</td></tr><tr><td>Asymmetry</td><td>동일 행동 대신 프로세스별 고유 전략 부여 → 패턴 반복 회피</td></tr><tr><td>Priority-based Strategy</td><td>우선순위 승격 기반 재진입 허용 → 기아 방지</td></tr><tr><td>Progress Checkpoints</td><td>일정 주기로 진전 여부 점검 → 정지 상태 장기화 방지</td></tr></tbody></table><h4 id=기본-원리-및-동작-메커니즘>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘>#</a></h4><h5 id=기본-원리-principles-of-livelock>기본 원리 (Principles of Livelock)<a hidden class=anchor aria-hidden=true href=#기본-원리-principles-of-livelock>#</a></h5><table><thead><tr><th>원리 구분</th><th>설명</th><th>기술적 사례 및 맥락</th></tr></thead><tbody><tr><td>비차단성</td><td>프로세스가 실행 상태를 유지하며 블로킹되지 않음 (Deadlock 과 구별됨)</td><td>상태가 RUNNING 으로 유지되며 스케줄러 관점에선 정상으로 보임</td></tr><tr><td>상호 반응성</td><td>각 프로세스가 상대 프로세스의 행동에 반응하여 자신의 상태를 조정 → 무한 반응 루프 형성</td><td>동기화 회피, polite yielding, mutual avoidance 시나리오</td></tr><tr><td>진전 실패</td><td>반복 양보와 재시도에도 불구하고 자원 확보 실패 및 작업 미진행</td><td>lock 획득 실패 → 백오프 → 재시도 → 반복 → 무진전</td></tr><tr><td>자원 소모</td><td>CPU, 네트워크, 디스크 등 시스템 자원이 반복 동작으로 낭비됨</td><td>Spinlock, polling, 메시지 재전송 루프 등</td></tr><tr><td>발생 불확실성</td><td>타이밍, 경쟁 상태, 백오프 패턴 등에 따라 재현이 어렵고 불규칙하게 발생</td><td>분산 시스템, 병렬 처리 시스템에서 스케줄러/부하 상태 따라 간헐적 발생</td></tr><tr><td>탐지 난이도</td><td>실행은 계속되고 상태 변화도 있어 외부 관측으로는 이상이 없어 보임 → 탐지 어려움</td><td>모니터링 지표 상 CPU 는 정상, Throughput 은 감소 → 비정상 감지 어려움</td></tr></tbody></table><p>Livelock 은 시스템이 활동 중인 것처럼 보이지만, 실질적인 작업은 수행되지 않는 상태다. 이 현상은 프로세스들이 서로의 행동에 반복적으로 반응하며 발생하며, 자원 충돌 회피나 백오프 알고리즘의 부적절한 설계로 인해 무한 루프가 형성된다. 비차단 상태에서 발생하므로 Deadlock 보다 탐지하기 어렵고, CPU 및 기타 시스템 자원이 낭비된다. 복잡한 병렬 또는 분산 시스템에서 특히 주의해야 하며, 무작위성 도입과 재시도 전략의 다양화가 중요하다.</p><h5 id=livelock-발생-흐름>Livelock 발생 흐름<a hidden class=anchor aria-hidden=true href=#livelock-발생-흐름>#</a></h5><pre class=mermaid>sequenceDiagram
    participant Thread A
    participant Thread B
    participant Shared Resource

    Thread A-&gt;&gt;Shared Resource: 자원 접근 시도
    Thread B-&gt;&gt;Shared Resource: 자원 접근 시도
    Shared Resource--&gt;&gt;Thread A: 충돌 발생
    Shared Resource--&gt;&gt;Thread B: 충돌 발생

    Thread A-&gt;&gt;Thread A: 회피/양보 (Yield)
    Thread B-&gt;&gt;Thread B: 회피/양보 (Yield)

    Note over Thread A, Thread B: 동시에 재시도 → 또 충돌

    loop 무한 반복
        Thread A-&gt;&gt;Shared Resource: 재시도
        Thread B-&gt;&gt;Shared Resource: 재시도
        Shared Resource--&gt;&gt;Thread A/B: 또 충돌 발생
        Thread A/B-&gt;&gt;Thread A/B: 다시 양보
    end
</pre><p>이 흐름도는 Livelock 이 발생하는 반복 구조를 시간 순서에 따라 시각적으로 보여준다. 자발적인 양보 (Yield) 가 반복되며, 그 결과 시스템은 무한히 상태를 전환하지만 실질적인 자원 획득이나 작업 진행은 발생하지 않는다.</p><h4 id=아키텍처-및-구성-요소>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소>#</a></h4><pre class=mermaid>flowchart TD
  subgraph SyncLayer [Synchronization Layer]
    Detector[Conflict Detector] --&gt; Backoff[Backoff Manager]
    Backoff --&gt; Scheduler[Retry Scheduler]
    Scheduler --&gt; ResourceMgr[Resource Manager]
    Monitor[Livelock Monitor] --&gt;|피드백| Detector
    Priority[Priority Manager] --&gt; Scheduler
  end

  ResourceMgr --&gt; LockMgr[Lock Manager]
  API[API Layer] --&gt; Logic[Business Logic Layer] --&gt; Detector
</pre><p>이 구조와 구성 요소 정리는 livelock 감지부터 재시도 관리, 우선순위 조정, 자원 관리까지 종합적인 대응 방식을 담고 있다.</p><h5 id=아키텍처-구성-요소-및-역할>아키텍처 구성 요소 및 역할<a hidden class=anchor aria-hidden=true href=#아키텍처-구성-요소-및-역할>#</a></h5><table><thead><tr><th>구성 요소</th><th>필수/선택</th><th>주요 역할</th><th>기능 및 특징</th></tr></thead><tbody><tr><td>Conflict Detector</td><td>필수</td><td>자원 충돌 감지</td><td>CAS, atomic 상태 체크, 상태 머신 기반 충돌 탐지</td></tr><tr><td>Backoff Manager</td><td>필수</td><td>재시도 대기 시간 계산 및 관리</td><td>randomized exponential backoff, jitter 적용</td></tr><tr><td>Retry Scheduler</td><td>필수</td><td>재시도 타이밍 결정 및 스케줄링</td><td>타이머 기반 재시도, 스레드 풀 연계, adaptive delay 포함</td></tr><tr><td>Livelock Monitor</td><td>선택</td><td>시스템 내 livelock 여부 탐지 및 알림</td><td>메트릭 수집 (CPU, 지연 시간), 패턴 분석, 경고/롤백 트리거</td></tr><tr><td>Priority Manager</td><td>선택</td><td>우선순위 기반 조정 및 starvation 방지</td><td>dynamic priority, aging, 우선순위 기반 rollback 또는 승격 로직</td></tr><tr><td>Resource Manager / Lock Manager</td><td>필수/기반</td><td>자원 할당, 락 관리, 데이터베이스 또는 리소스 풀 관리</td><td>자원 테이블 풀, 분산 락 관리, 상태 기록 및 조정</td></tr></tbody></table><h4 id=livelock-방지를-위한-주요-기능>Livelock 방지를 위한 주요 기능<a hidden class=anchor aria-hidden=true href=#livelock-방지를-위한-주요-기능>#</a></h4><table><thead><tr><th>주요 기능</th><th>책임 및 역할 설명</th><th>상호 관계</th><th>기술적 구현 또는 고려 요소</th></tr></thead><tbody><tr><td>충돌 감지 (Detection)</td><td>자원 접근 충돌 여부 판단 및 알림</td><td>백오프/양보 로직 트리거</td><td>락 상태 확인, CAS, 세마포어 등</td></tr><tr><td>백오프 알고리즘 (Backoff)</td><td>재시도 지연 시간 조정</td><td>충돌 감지 → 재시도 제어</td><td>지수 백오프, 지터, 무작위성 필요</td></tr><tr><td>재시도 로직 (Retry Logic)</td><td>재시도 시점 및 횟수 제어</td><td>백오프 → 재시도 수행</td><td>최대 재시도, 타임아웃, 조건 재검사</td></tr><tr><td>양보 로직 (Yield Logic)</td><td>충돌 시 자발적 회피 및 기회 제공</td><td>충돌 감지와 함께 동작</td><td><code>yield</code>, 상태 체크 후 해제</td></tr><tr><td>스케줄링 (Scheduling)</td><td>자원 접근 순서 조정, 우선순위 관리</td><td>전체 재시도 흐름에 영향</td><td>우선순위 상속, 타임슬라이스</td></tr><tr><td>진행 검사 (Progress Check)</td><td>유효한 진전 여부 판별</td><td>무한 루프/리벨록 종료 판별</td><td>처리량 감소, 이벤트 반복 분석</td></tr><tr><td>모니터링/진단 (Monitoring & Diagnostics)</td><td>반복 행동 탐지 및 경보</td><td>모든 로직 분석 대상</td><td>메트릭 수집, 경고 임계값, tracing</td></tr></tbody></table><p>Livelock 의 방지는 단일 기능이 아닌, 충돌 감지 → 회피/양보 → 재시도 → 진행 검사로 이어지는 일련의 동작 흐름을 필요로 한다. 각 기능은 독립적이지만 상호 연계되어야 하며, 스케줄링 및 모니터링 계층은 이러한 로직들이 올바르게 작동하도록 보조하고 조율하는 역할을 수행한다. 실무에서는 이들 기능을 조합한 전략적 구현이 필수이며, 특히 분산 시스템이나 실시간 시스템에서는 백오프, 스케줄링, 탐지의 정교한 조합이 리벨록 회피의 핵심이다.</p><h3 id=특성-분석-characteristics-analysis>특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#특성-분석-characteristics-analysis>#</a></h3><h4 id=예방-및-해결-방안>예방 및 해결 방안<a hidden class=anchor aria-hidden=true href=#예방-및-해결-방안>#</a></h4><ol><li><p>예방 전략 (Prevention)</p><ul><li><strong>랜덤 백오프 (Random Backoff)</strong>: 재시도 간 무작위 지연을 적용해 동기화된 패턴 반복 방지.</li><li><strong>우선순위 차등 전략 (Priority-based Resolution)</strong>: 한쪽 프로세스가 재시도하거나 대기하게 하여 행동 대칭성 제거.</li><li><strong>타임아웃 (Timeout Mechanism)</strong>: 일정 시간 이상 실패 시 자동 종료 또는 다른 전략으로 전환.</li></ul></li><li><p>탐지 및 조기 개입 (Detection / Monitoring)</p><ul><li><strong>모니터링 및 로그 분석</strong>: 반복 패턴 감지 시 운영자 알림이나 진행 방식을 조정.</li><li><strong>체크포인트 진전 확인 (Progress Checkpoints)</strong>: 주기적으로 진행 여부 확인해 stagnation 감지 후 전략 전환.</li></ul></li><li><p>해결 전략 (Resolution)</p><ul><li><strong>중앙 중재자 (Central Coordinator)</strong>: 분산된 의사결정 대신 중앙 컨트롤러가 자원 할당 조정.</li><li><strong>적응형 알고리즘 (Adaptive Retry Logic)</strong>: 실패·충돌 패턴에 맞춰 행동 전략을 변경하거나 재시도 정책 조정.</li></ul></li></ol><table><thead><tr><th>구분</th><th>전략</th><th>역할 및 설명</th><th>기술적 근거 및 효과</th></tr></thead><tbody><tr><td>예방</td><td>랜덤 백오프</td><td>재시도 간 jitter 적용으로 동기화된 반복 회피</td><td>동일 패턴 차단, 충돌 확률 감소 (<a href="https://dl.acm.org/doi/10.1145/3708543?utm_source=chatgpt.com" title="Steered Bubble: An Interposer-based Deadlock Recovery ...">dl.acm.org</a>, <a href="https://medium.com/%40pronnoy.goswami/system-design-101-deadlock-vs-livelock-926165c8e578?utm_source=chatgpt.com" title="System Design 101 : Deadlock vs. Livelock">Medium</a>, <a href="https://upcommons.upc.edu/bitstream/handle/2117/95386/TAAS1de1.pdf?isAllowed=y&amp;sequence=1&amp;utm_source=chatgpt.com" title="Techniques to Improve Concurrency in Hardware Transactional ...">upcommons.upc.edu</a>)</td></tr><tr><td>예방</td><td>우선순위 기반 해결</td><td>한쪽만 재시도／다른쪽 대기 설정 → 행동 비대칭 유도</td><td>동시 양보 메커니즘 탈피로 패턴 반복 방지</td></tr><tr><td>예방</td><td>타임아웃 메커니즘</td><td>일정 시간 내 실패 시 종료 또는 다른 방식 전환</td><td>무한 루프 방지, 안정성 확보 (<a href="https://www.geeksforgeeks.org/operating-systems/deadlock-starvation-and-livelock/?utm_source=chatgpt.com" title="Deadlock, Starvation, and Livelock">GeeksforGeeks</a>)</td></tr><tr><td>탐지</td><td>모니터링/패턴 로그 분석</td><td>비정상 반복 감지 시 알림 또는 자동 중단</td><td>운영 중 조기 대응 가능, APM 및 observability 도구 활용</td></tr><tr><td>탐지</td><td>진행 체크포인트</td><td>주기적으로 작업 진행 여부 확인 → stagnation 감지 시 대응</td><td>livelock 장기화 방지, 동적 전략 전환 가능 (<a href="https://medium.com/%40pronnoy.goswami/system-design-101-deadlock-vs-livelock-926165c8e578?utm_source=chatgpt.com" title="System Design 101 : Deadlock vs. Livelock">Medium</a>, <a href="https://www.numberanalytics.com/blog/avoiding-livelock-in-concurrent-algorithm-design?utm_source=chatgpt.com" title="Avoiding Livelock in Concurrent Algorithm Design">넘버 애널리틱스</a>)</td></tr><tr><td>해결</td><td>중앙 중재자 패턴</td><td>중앙에서 자원 충돌 조정 및 할당 결정</td><td>분산된 결정 복잡성 감소, 충돌 제거 효과</td></tr><tr><td>해결</td><td>적응형 재시도 알고리즘</td><td>실패 패턴 감지 시 backoff, action 변경 적용</td><td>동적 상황 대응 가능, livelock 해결 가능성 증가</td></tr></tbody></table><p>Livelock 은 반복적이고 동기화된 상태 변화로 인해 시스템이 멈추지 않지만 진전이 없는 상황을 말한다.<br>이를 예방하고 해결하기 위해서는 다음과 같은 전략을 적용해야 한다:</p><ul><li><strong>랜덤 백오프와 지터</strong>를 도입해 동기화 패턴을 분산시킨다.</li><li><strong>우선순위 기반 처리</strong>로 행동의 비대칭성을 유도한다.</li><li><strong>타임아웃 설정</strong>으로 무한 루프를 제한한다.</li><li><strong>모니터링/체크포인트 기반 탐지</strong>로 조기 대응을 가능하게 한다.</li><li><strong>중앙 중재자 또는 적응형 알고리즘</strong>을 통해 리소스 충돌과 반복 상태를 구조적으로 해결하는 방식이 효과적이다.</li></ul><h4 id=단점-및-제약사항과-해결방안>단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#단점-및-제약사항과-해결방안>#</a></h4><table><thead><tr><th>구분</th><th>주요 문제 항목</th><th>근본 원인</th><th>시스템에 미치는 영향</th><th>탐지 및 진단 방법</th><th>예방 전략</th><th>해결 기법/대안 기술</th></tr></thead><tbody><tr><td>처리 미진행</td><td>무한 재시도, 상태 변화 반복</td><td>상호 양보 로직 충돌, 충돌 회피 전략 실패</td><td>처리량 저하, 사용자 요청 대기</td><td>작업 완료율 추적, 상태 전이 모니터링</td><td>타임아웃 조건 명시, 상태 기반 조건식 강화</td><td>선점형 스케줄링, 우선순위 큐, 타임바운드 재시도</td></tr><tr><td>CPU 낭비</td><td>스핀락, 바쁜 대기 반복</td><td>충돌 발생 후 유효 백오프 미적용</td><td>자원 낭비, 시스템 반응성 저하</td><td>CPU 사용률, 스레드 상태 추적</td><td>랜덤 백오프, Jitter 삽입</td><td>스케줄러 개입, 이벤트 기반 처리가 대안</td></tr><tr><td>탐지 실패</td><td>정상처럼 보이는 실행 상태</td><td>외부 상태만 보면 RUNNING 지속</td><td>문제 인지 지연, 복구 타이밍 상실</td><td>로그 분석, rollback count, throughput</td><td>헬스 체크 + 지표 기반 모니터링</td><td>트레이싱 시스템 도입 (OpenTelemetry 등)</td></tr><tr><td>확장성 저하</td><td>동시성 처리 실패</td><td>공유 자원 충돌 지속, 비효율 락/자원 설계</td><td>스케일 아웃 불가능, 처리량 제한</td><td>처리량 선형성 추적, 병목 구간 탐색</td><td>락프리 알고리즘, 공유 자원 분리</td><td>샤딩, CQRS, 무상태 처리 전략</td></tr><tr><td>응답 지연</td><td>반복 충돌/양보로 인한 지연</td><td>우선순위 불균형, 재시도 중첩</td><td>사용자 경험 저하, SLA 위반 가능성</td><td>응답 시간 측정, 타임라인 분석</td><td>우선순위 제어, 공정 스케줄링</td><td>회로 차단기 (Circuit Breaker), Aging, Thread Preemption</td></tr><tr><td>가용성 문제</td><td>핵심 스레드 무한 루프</td><td>동기화 구조 오류, 피드백 루프 발생</td><td>전체 서비스 정지, 장애 전파</td><td>경보 임계값 초과 감지, heartbeat 확인</td><td>동적 리소스 회수 정책, 격리 전략</td><td>강제 종료, 중재자 (Mediator) 도입, 서킷 브레이커</td></tr></tbody></table><p>리벨록은 단순히 동기화 문제로 보이지만, 시스템 전반에 걸쳐 성능, 안정성, 확장성에 파급 효과를 일으킨다.<br>이를 해결하기 위해서는 개별 기능의 최적화보다, 충돌 감지 → 회피 → 재시도 → 진전 확인 → 모니터링으로 이어지는 연속적인 흐름을 조율해야 한다. 각 문제는 겉으로 드러나는 증상이 다를 수 있지만, 대부분 리소스 접근 충돌과 타이밍 오류에서 기인하며, 공통적으로 " 진전 없음 " 이라는 핵심 속성을 가진다.<br>실무에서는 <strong>랜덤화된 백오프 + 상태 기반 타임아웃 + 우선순위 기반 스케줄링 + 실시간 모니터링</strong>의 조합이 가장 효과적인 대응 방안으로 평가된다.</p><h4 id=트레이드오프-관계-분석>트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석>#</a></h4><p>Livelock 방지를 위한 설계는 일정한 수준의 성능 손실과 시스템 안정성 강화 사이에서 균형을 맞춰야 한다.<br>성능을 극대화하기 위해 빠른 재시도를 도입하면 livelock 가능성이 높아지고, 반대로 안정성을 강화하려 과도한 delay 를 넣으면 응답성이 떨어져 사용자 경험이 저하될 수 있다.<br>따라서 시스템 설계자는 공정성 (Fairness), 복잡성 수준, 리소스 활용, 분산 환경의 일관성 등을 함께 고려해야 한다.<br>현실적 접근으로는 랜덤화된 backoff, adaptive delay, 우선순위 기반 수행, checkpoint 및 모니터링 도입, 중앙 중재자 혹은 hybrid 구조를 혼합해 <strong>성능과 안정성 사이의 적절한 균형</strong>을 구현하는 것이 중요하다.</p><table><thead><tr><th>항목</th><th>장점</th><th>단점</th><th>고려사항 / 균형 전략</th></tr></thead><tbody><tr><td>빠른 재시도 (성능)</td><td>응답 지연 최소화, 높은 처리량</td><td>충돌 빈도 증가 → livelock 발생 위험</td><td>랜덤 지터, adaptive delay 적용</td></tr><tr><td>공정성 중심 (throughput 양보)</td><td>약한 작업도 실행 기회 보장</td><td>전체 처리량 낮아질 수 있음</td><td>공정 스케줄링, 우선순위 aging 적용</td></tr><tr><td>단순 정책</td><td>구현 및 유지보수 용이</td><td>복잡 상황 대응 한계, livelock 발생 가능성 존재</td><td>점진적 복잡화 + 논리 검증 도입</td></tr><tr><td>백오프 시간 설정</td><td>지연 최소화 또는 CPU 절약 가능</td><td>너무 짧거나 길면 각각 livelock/응답 지연 유발</td><td>adaptive backoff, 지터 조합 조정</td></tr><tr><td>Lock-free 설계</td><td>높은 동시성 처리성능 보장</td><td>고충돌 환경에서 livelock 또는 starvation 발생</td><td>contention-aware 알고리즘 조정</td></tr><tr><td>분산 결정 방식</td><td>장애 허용성ㆍ확장성 우수</td><td>의사결정 일관성 부족, 중복 반응으로 livelock 유도</td><td>중앙 중재자 또는 조정 레이어 도입</td></tr></tbody></table><ul><li><strong>성능 ↔ 안정성</strong>: 빠른 폴링 또는 낮은 delay 재시도는 응답성을 높이지만 livelock 위험 증가</li><li><strong>처리량 ↔ 공정성</strong>: 우선순위 기반 처리로 throughput 향상 가능하지만 일부 low-priority 처리 지연 또는 starvation 발생</li><li><strong>단순성 ↔ 완전성</strong>: 단순 백오프 알고리즘은 구현 효율 향상되지만, 복잡한 충돌 상황에 대응하기 어려움</li><li><strong>응답성 ↔ 자원 효율성</strong>: 짧은 백오프는 빠른 응답 가능하지만 자원 소비 증가. 오래 대기하면 자원 절약되나 지연 발생</li><li><strong>분산 처리 ↔ 일관성</strong>: 각 노드 독립 결정은 성능 향상되지만 분산 livelock 또는 상태 불일치 위험 증가</li></ul><pre class=mermaid>
graph LR  
    A[성능 vs 안정성] --&gt; A1[빠른 재시도 vs 충돌 방지]
    B[처리량 vs 공정성] --&gt; B1[효율성 우선 vs 모든 프로세스 공평]  
    C[복잡성 vs 효과성] --&gt; C1[단순 구현 vs 정교한 백오프]
    D[자원 사용 vs 응답성] --&gt; D1[백오프 시간 vs 빠른 응답]
    
    style A1 fill:#e3f2fd
    style B1 fill:#f3e5f5  
    style C1 fill:#e8f5e8
    style D1 fill:#fff3e0
</pre><h3 id=구현-및-분류-implementation--classification>구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#구현-및-분류-implementation--classification>#</a></h3><h4 id=livelock-대응-전략-및-구현-방식>Livelock 대응 전략 및 구현 방식<a hidden class=anchor aria-hidden=true href=#livelock-대응-전략-및-구현-방식>#</a></h4><table><thead><tr><th>구현 기법 구분</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td><strong>Exponential Backoff + Jitter</strong></td><td>재시도 시 대기 시간을 점진적으로 늘리고 무작위성을 추가함</td><td>지수 증가 로직, 랜덤 지연</td><td>재충돌 방지</td><td>충돌 회피, CPU 낭비 방지</td><td>분산 시스템, 동시성 큐</td><td>간단하며 효과적</td></tr><tr><td><strong>Timeout 제한 및 오류 반환</strong></td><td>특정 시간 내 작업 미완료 시 중단</td><td>타이머, 실패 반환 핸들러</td><td>무한 재시도 차단</td><td>무한 루프 회피</td><td>실시간 처리, 트랜잭션 시스템</td><td>신속한 실패 처리 가능</td></tr><tr><td><strong>락 순서화 및 계층 구조</strong></td><td>락 획득 순서나 계층을 사전에 지정</td><td>락 관리 모듈, 순서 규칙</td><td>충돌 가능성 제거</td><td>데드락/리벨록 예방</td><td>다중 자원 접근 알고리즘</td><td>설계 복잡도 높음</td></tr><tr><td><strong>Lock-Free 데이터 구조</strong></td><td>락 없이 동시성 보장</td><td>CAS 연산, 상태 기반 트랜잭션</td><td>경합 최소화</td><td>성능 최적화</td><td>실시간 시스템, 고성능 컴퓨팅</td><td>구현 난이도 높음</td></tr><tr><td><strong>정적 분석 도구 활용</strong></td><td>코드 내 리벨록 가능성 사전 탐지</td><td>AST, 제어 흐름 분석기</td><td>컴파일 단계 검출</td><td>개발 초기 탐지</td><td>CI 파이프라인</td><td>예방 중심 접근</td></tr><tr><td><strong>동적 모니터링 및 알림</strong></td><td>런타임 동안 시스템 상태 실시간 추적</td><td>메트릭 수집, 트레이싱, 로그 분석</td><td>패턴 탐지</td><td>운영 중 문제 실시간 대응</td><td>운영 환경, 서버 모니터링</td><td>트래픽 부하 영향 고려 필요</td></tr></tbody></table><h5 id=livelock-탐지-및-진단-기법>Livelock 탐지 및 진단 기법<a hidden class=anchor aria-hidden=true href=#livelock-탐지-및-진단-기법>#</a></h5><table><thead><tr><th>분류 기준</th><th>유형</th><th>정의</th><th>구성</th><th>목적</th><th>실제 예시</th></tr></thead><tbody><tr><td><strong>구현 위치</strong></td><td>하드웨어 기반</td><td>HW 레벨 스핀 탐지</td><td>카운터, 레지스터</td><td>저오버헤드 탐지</td><td>Intel 의 스핀 탐지 하드웨어</td></tr><tr><td><strong>구현 위치</strong></td><td>소프트웨어 기반</td><td>런타임 모니터링</td><td>프로파일러, 메트릭</td><td>상세 분석 가능</td><td>JVM ThreadMXBean</td></tr><tr><td><strong>탐지 방식</strong></td><td>정적 분석</td><td>코드 레벨 패턴 분석</td><td>AST, CFG</td><td>컴파일 타임 예방</td><td>LLVM 정적 분석기</td></tr><tr><td><strong>탐지 방식</strong></td><td>동적 분석</td><td>실행 시 행동 관찰</td><td>트레이싱, 로깅</td><td>실시간 상황 파악</td><td>DTrace, eBPF</td></tr><tr><td><strong>시스템 범위</strong></td><td>로컬 시스템</td><td>단일 노드 내 탐지</td><td>프로세스, 스레드 모니터</td><td>로컬 최적화</td><td>htop, perf</td></tr><tr><td><strong>시스템 범위</strong></td><td>분산 시스템</td><td>다중 노드 협력 탐지</td><td>분산 모니터링</td><td>글로벌 가시성</td><td>Prometheus, Jaeger</td></tr></tbody></table><h5 id=코드-구현-예시-python-기반---exponential-backoff-with-jitter>코드 구현 예시 (Python 기반 - Exponential Backoff with Jitter)<a hidden class=anchor aria-hidden=true href=#코드-구현-예시-python-기반---exponential-backoff-with-jitter>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>acquire_lock_simulated</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;락 획득 시도 시뮬레이션 (임의 성공/실패)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span><span class=p>])</span>  <span class=c1># 낮은 확률로 성공</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>exponential_backoff_retry</span><span class=p>(</span><span class=n>max_retries</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>retry</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_retries</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>success</span> <span class=o>=</span> <span class=n>acquire_lock_simulated</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[✓] Lock acquired at attempt </span><span class=si>{</span><span class=n>retry</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=c1># 지수 백오프 + 지터</span>
</span></span><span class=line><span class=cl>        <span class=n>delay</span> <span class=o>=</span> <span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>retry</span><span class=p>)</span> <span class=o>+</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[x] Retry </span><span class=si>{</span><span class=n>retry</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s2>: waiting </span><span class=si>{</span><span class=n>delay</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>s before next attempt…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>delay</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[!] Failed to acquire lock after max retries.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행 예시</span>
</span></span><span class=line><span class=cl><span class=n>exponential_backoff_retry</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=분류-기준에-따른-유형-구분>분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분>#</a></h4><table><thead><tr><th>분류 기준</th><th>유형</th><th>주요 특징</th><th>탐지 방법</th><th>해결 전략</th></tr></thead><tbody><tr><td>발생 범위</td><td>로컬 라이브락</td><td>단일 시스템 내 스레드 간 상호 양보 반복</td><td>스레드 덤프, local trace</td><td>백오프, 지터</td></tr><tr><td></td><td>분산 라이브락</td><td>여러 노드 간 분산 락/메시지 순환 반복</td><td>분산 추적 (Distributed tracing)</td><td>분산 락, 리더 선출, 중앙 중재</td></tr><tr><td>지속 시간</td><td>일시적 라이브락</td><td>짧은 시간 내 해결 가능</td><td>짧은 간격 모니터링</td><td>빠른 백오프, random jitter</td></tr><tr><td></td><td>영구적 라이브락</td><td>무한 반복 지속, 재설계 필요</td><td>장기간 패턴 분석</td><td>타임아웃, 전략 변경, 강제 차단</td></tr><tr><td>자원 유형</td><td>메모리 라이브락</td><td>공유 메모리 접근 시 경쟁으로 상태 변화 반복</td><td>메모리 접근 로그 분석</td><td>락프리 자료구조, CAS 기반 설계</td></tr><tr><td></td><td>I/O 라이브락</td><td>파일 또는 네트워크 자원 접근 충돌 반복</td><td>I/O latency 모니터링</td><td>비동기 I/O, 재시도 정책 조정</td></tr><tr><td>프로세스 수</td><td>이진 라이브락</td><td>딱 두 개 프로세스/스레드 간 상호 회피 양보 패턴</td><td>상태 추적 로깅</td><td>우선순위 차등, 비대칭 백오프</td></tr><tr><td></td><td>다중 라이브락</td><td>세 개 이상 참여자 간 복잡한 상태 변화 반복</td><td>복합 상태 분석 및 흐름 추적</td><td>중앙 중재자, distributed coordinator</td></tr></tbody></table><p>라이브락은 발생 환경과 범위, 지속 시간, 자원 유형, 관련 프로세스 수 등에 따라 다양한 유형으로 구분할 수 있으며, 각 유형마다 탐지 및 해결 전략이 달라져야 한다.</p><ul><li><strong>로컬 라이브락</strong>은 스레드 덤프나 메모리 접근 로그를 통해 탐지하고, jitter 와 백오프 등을 이용해 해결</li><li><strong>분산 라이브락</strong>은 tracing 도구로 탐지하고, 중앙 락 관리자 또는 리더 선출 방식으로 해결</li><li><strong>일시적 vs 영구적</strong> 유형은 모니터링 시간 범위와 전략 전환 기준이 중요</li><li><strong>자원 유형</strong>에 따라 락프리 설계나 비동기 접근 방식 등 기술적 전략 선택이 달라져</li><li><strong>프로세스 참여 수</strong>에 따라 이진 vs 다중 전략을 구별해 우선순위 또는 중재자 방식 도입 가능해</li></ul><p>실제 시스템에 맞춰 분류 기준을 적용하면, 발생 유형을 정확히 파악하고 그에 맞는 대응 전략을 설계할 수 있다.</p><h3 id=실무-적용-practical-application>실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#실무-적용-practical-application>#</a></h3><h4 id=실제-도입-사례>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례>#</a></h4><table><thead><tr><th>사례</th><th>문제 상황</th><th>적용 기술/조치</th><th>효과 요약</th></tr></thead><tbody><tr><td><strong>4.2BSD 네트워크 인터럽트</strong></td><td>입력 패킷 폭주 → 시스템이 인터럽트 처리에만 시간 소모 (Receive Livelock)</td><td>NAPI 도입: 배치 처리 + polled mode 병행</td><td>유용한 전달률 유지, 불필요한 패킷 처리 감소</td></tr><tr><td><strong>DB/HTTP 고동시성 환경</strong></td><td>트랜잭션 실패 반복 재시도 → 처리량 저하 및 CPU 과부하</td><td>지수 백오프 + 캐싱/비동기 로깅 적용</td><td>실패 재시도 감소, 시스템 안정성 증가</td></tr><tr><td><strong>Java tryLock 기반 Livelock</strong></td><td><code>tryLock()</code> 반복 실패 → livelock 발생 가능성 존재</td><td>랜덤 타임아웃 및 백오프 전략 도입</td><td>무한 반복 방지 및 안정성 확보</td></tr></tbody></table><ul><li><p><strong>NAPI 도입 사례</strong>: 4.2BSD 기반 시스템은 interrupt-driven 디자인에서 overload 발생 → NAPI 로 polling 모드 전환 및 interrupt 억제, quota 기반 fairness 제공 → livelock 방지에 성공.</p></li><li><p><strong>지수 백오프 사례</strong>:.NET 및 DB retry 정책에서 fixed wait 대신 exponential backoff 를 도입하면 무차별 재시도로 인한 리소스 낭비와 충돌이 줄어들고 안정성이 향상됨.</p></li><li><p><strong>Java tryLock 사례</strong>: <code>ReentrantLock.tryLock(timeout)</code> 과 jitter 를 함께 적용하면 동일한 백오프 패턴에 의한 livelock 가능성을 줄일 수 있어.</p></li></ul><h4 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h4><h5 id=사례-두-개의-스레드가-동일한-자원에-접근>사례: 두 개의 스레드가 동일한 자원에 접근<a hidden class=anchor aria-hidden=true href=#사례-두-개의-스레드가-동일한-자원에-접근>#</a></h5><p><strong>시나리오</strong>: 두 개의 스레드가 동일한 자원에 접근하려 하나, 서로를 회피하려고 계속 양보하면서 아무 일도 처리하지 못하는 상황 발생</p><p><strong>시스템 구성</strong>:</p><ul><li>스레드 A, 스레드 B</li><li>공유 리소스 (락 객체)</li><li>재시도 기반 자원 접근 로직</li></ul><pre class=mermaid>graph TB
    A[Thread A] --&gt;|자원 접근| R[Shared Resource]
    B[Thread B] --&gt;|자원 접근| R
    R --&gt;|충돌 발생| A
    R --&gt;|충돌 발생| B
    A --&gt;|양보 후 재시도| R
    B --&gt;|양보 후 재시도| R
</pre><p><strong>Workflow</strong>:</p><ol><li>Thread A, B 가 동시에 자원 접근 시도</li><li>충돌 감지 → 양측 모두 자발적으로 양보</li><li>동일 시간 재시도 → 또 충돌</li><li>이 과정을 무한 반복 (Livelock)</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Livelock 은 자원 접근 충돌 상황에서, 단순히 &rsquo; 양보 &rsquo; 만으로 해결되지 않음을 보여줌</li></ul><p><strong>유무에 따른 차이점</strong></p><table><thead><tr><th>항목</th><th>도입 전 (Livelock 발생)</th><th>도입 후 (백오프/타임아웃 적용)</th></tr></thead><tbody><tr><td>처리량</td><td>0 TPS</td><td>정상 처리량 회복</td></tr><tr><td>CPU 사용량</td><td>90~100% (루프 반복)</td><td>정상 수준</td></tr><tr><td>응답 시간</td><td>무한 대기</td><td>수 밀리초 수준</td></tr><tr><td>시스템 안정성</td><td>전체 서비스 블로킹 가능</td><td>부분 장애 격리 가능</td></tr></tbody></table><p><strong>구현 예시</strong> (Python–Livelock 회피 포함)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>safe_task</span><span class=p>(</span><span class=n>thread_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>  <span class=c1># 최대 재시도 횟수 제한</span>
</span></span><span class=line><span class=cl>        <span class=n>acquired</span> <span class=o>=</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>blocking</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>acquired</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>] 자원 획득 성공, 작업 수행 중…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>            <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>backoff</span> <span class=o>=</span> <span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>attempt</span><span class=p>)</span> <span class=o>+</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>] 자원 충돌, </span><span class=si>{</span><span class=n>backoff</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>초 대기 후 재시도…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>backoff</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>] 재시도 한도 초과로 작업 중단&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>safe_task</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>    <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>핵심 포인트</strong>:<ul><li><code>blocking=False</code> 로 Deadlock 방지</li><li><code>Exponential Backoff + Jitter</code> 로 Livelock 회피</li><li><code>재시도 횟수 제한</code> 으로 무한 루프 방지</li></ul></li></ul><h5 id=사례-마이크로서비스-환경에서-분산-락-distributed-lock-경합>사례: 마이크로서비스 환경에서 분산 락 (Distributed Lock) 경합<a hidden class=anchor aria-hidden=true href=#사례-마이크로서비스-환경에서-분산-락-distributed-lock-경합>#</a></h5><p><strong>시나리오</strong>: 마이크로서비스 환경에서 분산 락 (Distributed Lock) 경합으로 인한 라이브락</p><p><strong>시스템 구성</strong>:</p><ul><li>Redis 클러스터 (분산 락 저장소)</li><li>3 개의 마이크로서비스 인스턴스</li><li>로드 밸런서 및 모니터링 시스템</li><li>Prometheus + Grafana (메트릭 수집)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    LB[로드 밸런서] --&gt; MS1[마이크로서비스 1]
    LB --&gt; MS2[마이크로서비스 2] 
    LB --&gt; MS3[마이크로서비스 3]
    
    MS1 --&gt; RC[Redis 클러스터]
    MS2 --&gt; RC
    MS3 --&gt; RC
    
    MS1 --&gt; PM[Prometheus]
    MS2 --&gt; PM
    MS3 --&gt; PM
    
    PM --&gt; GF[Grafana 대시보드]
    
    subgraph &#34;라이브락 탐지&#34;
        LD[라이브락 탐지기]
        PM --&gt; LD
        LD --&gt; AL[알림 시스템]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li><strong>요청 수신</strong>: 로드 밸런서가 요청을 각 서비스로 분산</li><li><strong>락 획득 시도</strong>: 각 서비스가 Redis 에서 분산 락 획득 시도</li><li><strong>백오프 실행</strong>: 실패 시 지수적 백오프 + 랜덤 지터 적용</li><li><strong>상태 모니터링</strong>: Prometheus 가 각 서비스의 락 시도 횟수 수집</li><li><strong>라이브락 탐지</strong>: 탐지기가 패턴 분석하여 라이브락 여부 판단</li><li><strong>자동 해결</strong>: 탐지 시 우선순위 재할당 및 백오프 파라미터 조정</li></ol><p><strong>핵심 역할</strong>:</p><ul><li><strong>라이브락 예방</strong>: 스마트 백오프 알고리즘으로 동기화 방지</li><li><strong>실시간 탐지</strong>: 메트릭 기반 패턴 인식으로 조기 발견</li><li><strong>자동 복구</strong>: 탐지 시 알고리즘 파라미터 동적 조정</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 분산 락 경합 시 서비스들이 동일한 백오프 패턴으로 무한 재시도</li><li><strong>도입 후</strong>: 지능적 백오프와 우선순위 메커니즘으로 공정한 락 분배</li></ul><p><strong>JavaScript 기반 구현 예시</strong>: Node.js + Redis</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>  1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>  2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>  3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>  4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5>  5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6>  6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7>  7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8>  8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9>  9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10> 10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11> 11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12> 12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13> 13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14> 14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15> 15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16> 16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17> 17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18> 18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19> 19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20> 20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21> 21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22> 22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23> 23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24> 24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25> 25</a>
</span><span class=lnt id=hl-8-26><a class=lnlinks href=#hl-8-26> 26</a>
</span><span class=lnt id=hl-8-27><a class=lnlinks href=#hl-8-27> 27</a>
</span><span class=lnt id=hl-8-28><a class=lnlinks href=#hl-8-28> 28</a>
</span><span class=lnt id=hl-8-29><a class=lnlinks href=#hl-8-29> 29</a>
</span><span class=lnt id=hl-8-30><a class=lnlinks href=#hl-8-30> 30</a>
</span><span class=lnt id=hl-8-31><a class=lnlinks href=#hl-8-31> 31</a>
</span><span class=lnt id=hl-8-32><a class=lnlinks href=#hl-8-32> 32</a>
</span><span class=lnt id=hl-8-33><a class=lnlinks href=#hl-8-33> 33</a>
</span><span class=lnt id=hl-8-34><a class=lnlinks href=#hl-8-34> 34</a>
</span><span class=lnt id=hl-8-35><a class=lnlinks href=#hl-8-35> 35</a>
</span><span class=lnt id=hl-8-36><a class=lnlinks href=#hl-8-36> 36</a>
</span><span class=lnt id=hl-8-37><a class=lnlinks href=#hl-8-37> 37</a>
</span><span class=lnt id=hl-8-38><a class=lnlinks href=#hl-8-38> 38</a>
</span><span class=lnt id=hl-8-39><a class=lnlinks href=#hl-8-39> 39</a>
</span><span class=lnt id=hl-8-40><a class=lnlinks href=#hl-8-40> 40</a>
</span><span class=lnt id=hl-8-41><a class=lnlinks href=#hl-8-41> 41</a>
</span><span class=lnt id=hl-8-42><a class=lnlinks href=#hl-8-42> 42</a>
</span><span class=lnt id=hl-8-43><a class=lnlinks href=#hl-8-43> 43</a>
</span><span class=lnt id=hl-8-44><a class=lnlinks href=#hl-8-44> 44</a>
</span><span class=lnt id=hl-8-45><a class=lnlinks href=#hl-8-45> 45</a>
</span><span class=lnt id=hl-8-46><a class=lnlinks href=#hl-8-46> 46</a>
</span><span class=lnt id=hl-8-47><a class=lnlinks href=#hl-8-47> 47</a>
</span><span class=lnt id=hl-8-48><a class=lnlinks href=#hl-8-48> 48</a>
</span><span class=lnt id=hl-8-49><a class=lnlinks href=#hl-8-49> 49</a>
</span><span class=lnt id=hl-8-50><a class=lnlinks href=#hl-8-50> 50</a>
</span><span class=lnt id=hl-8-51><a class=lnlinks href=#hl-8-51> 51</a>
</span><span class=lnt id=hl-8-52><a class=lnlinks href=#hl-8-52> 52</a>
</span><span class=lnt id=hl-8-53><a class=lnlinks href=#hl-8-53> 53</a>
</span><span class=lnt id=hl-8-54><a class=lnlinks href=#hl-8-54> 54</a>
</span><span class=lnt id=hl-8-55><a class=lnlinks href=#hl-8-55> 55</a>
</span><span class=lnt id=hl-8-56><a class=lnlinks href=#hl-8-56> 56</a>
</span><span class=lnt id=hl-8-57><a class=lnlinks href=#hl-8-57> 57</a>
</span><span class=lnt id=hl-8-58><a class=lnlinks href=#hl-8-58> 58</a>
</span><span class=lnt id=hl-8-59><a class=lnlinks href=#hl-8-59> 59</a>
</span><span class=lnt id=hl-8-60><a class=lnlinks href=#hl-8-60> 60</a>
</span><span class=lnt id=hl-8-61><a class=lnlinks href=#hl-8-61> 61</a>
</span><span class=lnt id=hl-8-62><a class=lnlinks href=#hl-8-62> 62</a>
</span><span class=lnt id=hl-8-63><a class=lnlinks href=#hl-8-63> 63</a>
</span><span class=lnt id=hl-8-64><a class=lnlinks href=#hl-8-64> 64</a>
</span><span class=lnt id=hl-8-65><a class=lnlinks href=#hl-8-65> 65</a>
</span><span class=lnt id=hl-8-66><a class=lnlinks href=#hl-8-66> 66</a>
</span><span class=lnt id=hl-8-67><a class=lnlinks href=#hl-8-67> 67</a>
</span><span class=lnt id=hl-8-68><a class=lnlinks href=#hl-8-68> 68</a>
</span><span class=lnt id=hl-8-69><a class=lnlinks href=#hl-8-69> 69</a>
</span><span class=lnt id=hl-8-70><a class=lnlinks href=#hl-8-70> 70</a>
</span><span class=lnt id=hl-8-71><a class=lnlinks href=#hl-8-71> 71</a>
</span><span class=lnt id=hl-8-72><a class=lnlinks href=#hl-8-72> 72</a>
</span><span class=lnt id=hl-8-73><a class=lnlinks href=#hl-8-73> 73</a>
</span><span class=lnt id=hl-8-74><a class=lnlinks href=#hl-8-74> 74</a>
</span><span class=lnt id=hl-8-75><a class=lnlinks href=#hl-8-75> 75</a>
</span><span class=lnt id=hl-8-76><a class=lnlinks href=#hl-8-76> 76</a>
</span><span class=lnt id=hl-8-77><a class=lnlinks href=#hl-8-77> 77</a>
</span><span class=lnt id=hl-8-78><a class=lnlinks href=#hl-8-78> 78</a>
</span><span class=lnt id=hl-8-79><a class=lnlinks href=#hl-8-79> 79</a>
</span><span class=lnt id=hl-8-80><a class=lnlinks href=#hl-8-80> 80</a>
</span><span class=lnt id=hl-8-81><a class=lnlinks href=#hl-8-81> 81</a>
</span><span class=lnt id=hl-8-82><a class=lnlinks href=#hl-8-82> 82</a>
</span><span class=lnt id=hl-8-83><a class=lnlinks href=#hl-8-83> 83</a>
</span><span class=lnt id=hl-8-84><a class=lnlinks href=#hl-8-84> 84</a>
</span><span class=lnt id=hl-8-85><a class=lnlinks href=#hl-8-85> 85</a>
</span><span class=lnt id=hl-8-86><a class=lnlinks href=#hl-8-86> 86</a>
</span><span class=lnt id=hl-8-87><a class=lnlinks href=#hl-8-87> 87</a>
</span><span class=lnt id=hl-8-88><a class=lnlinks href=#hl-8-88> 88</a>
</span><span class=lnt id=hl-8-89><a class=lnlinks href=#hl-8-89> 89</a>
</span><span class=lnt id=hl-8-90><a class=lnlinks href=#hl-8-90> 90</a>
</span><span class=lnt id=hl-8-91><a class=lnlinks href=#hl-8-91> 91</a>
</span><span class=lnt id=hl-8-92><a class=lnlinks href=#hl-8-92> 92</a>
</span><span class=lnt id=hl-8-93><a class=lnlinks href=#hl-8-93> 93</a>
</span><span class=lnt id=hl-8-94><a class=lnlinks href=#hl-8-94> 94</a>
</span><span class=lnt id=hl-8-95><a class=lnlinks href=#hl-8-95> 95</a>
</span><span class=lnt id=hl-8-96><a class=lnlinks href=#hl-8-96> 96</a>
</span><span class=lnt id=hl-8-97><a class=lnlinks href=#hl-8-97> 97</a>
</span><span class=lnt id=hl-8-98><a class=lnlinks href=#hl-8-98> 98</a>
</span><span class=lnt id=hl-8-99><a class=lnlinks href=#hl-8-99> 99</a>
</span><span class=lnt id=hl-8-100><a class=lnlinks href=#hl-8-100>100</a>
</span><span class=lnt id=hl-8-101><a class=lnlinks href=#hl-8-101>101</a>
</span><span class=lnt id=hl-8-102><a class=lnlinks href=#hl-8-102>102</a>
</span><span class=lnt id=hl-8-103><a class=lnlinks href=#hl-8-103>103</a>
</span><span class=lnt id=hl-8-104><a class=lnlinks href=#hl-8-104>104</a>
</span><span class=lnt id=hl-8-105><a class=lnlinks href=#hl-8-105>105</a>
</span><span class=lnt id=hl-8-106><a class=lnlinks href=#hl-8-106>106</a>
</span><span class=lnt id=hl-8-107><a class=lnlinks href=#hl-8-107>107</a>
</span><span class=lnt id=hl-8-108><a class=lnlinks href=#hl-8-108>108</a>
</span><span class=lnt id=hl-8-109><a class=lnlinks href=#hl-8-109>109</a>
</span><span class=lnt id=hl-8-110><a class=lnlinks href=#hl-8-110>110</a>
</span><span class=lnt id=hl-8-111><a class=lnlinks href=#hl-8-111>111</a>
</span><span class=lnt id=hl-8-112><a class=lnlinks href=#hl-8-112>112</a>
</span><span class=lnt id=hl-8-113><a class=lnlinks href=#hl-8-113>113</a>
</span><span class=lnt id=hl-8-114><a class=lnlinks href=#hl-8-114>114</a>
</span><span class=lnt id=hl-8-115><a class=lnlinks href=#hl-8-115>115</a>
</span><span class=lnt id=hl-8-116><a class=lnlinks href=#hl-8-116>116</a>
</span><span class=lnt id=hl-8-117><a class=lnlinks href=#hl-8-117>117</a>
</span><span class=lnt id=hl-8-118><a class=lnlinks href=#hl-8-118>118</a>
</span><span class=lnt id=hl-8-119><a class=lnlinks href=#hl-8-119>119</a>
</span><span class=lnt id=hl-8-120><a class=lnlinks href=#hl-8-120>120</a>
</span><span class=lnt id=hl-8-121><a class=lnlinks href=#hl-8-121>121</a>
</span><span class=lnt id=hl-8-122><a class=lnlinks href=#hl-8-122>122</a>
</span><span class=lnt id=hl-8-123><a class=lnlinks href=#hl-8-123>123</a>
</span><span class=lnt id=hl-8-124><a class=lnlinks href=#hl-8-124>124</a>
</span><span class=lnt id=hl-8-125><a class=lnlinks href=#hl-8-125>125</a>
</span><span class=lnt id=hl-8-126><a class=lnlinks href=#hl-8-126>126</a>
</span><span class=lnt id=hl-8-127><a class=lnlinks href=#hl-8-127>127</a>
</span><span class=lnt id=hl-8-128><a class=lnlinks href=#hl-8-128>128</a>
</span><span class=lnt id=hl-8-129><a class=lnlinks href=#hl-8-129>129</a>
</span><span class=lnt id=hl-8-130><a class=lnlinks href=#hl-8-130>130</a>
</span><span class=lnt id=hl-8-131><a class=lnlinks href=#hl-8-131>131</a>
</span><span class=lnt id=hl-8-132><a class=lnlinks href=#hl-8-132>132</a>
</span><span class=lnt id=hl-8-133><a class=lnlinks href=#hl-8-133>133</a>
</span><span class=lnt id=hl-8-134><a class=lnlinks href=#hl-8-134>134</a>
</span><span class=lnt id=hl-8-135><a class=lnlinks href=#hl-8-135>135</a>
</span><span class=lnt id=hl-8-136><a class=lnlinks href=#hl-8-136>136</a>
</span><span class=lnt id=hl-8-137><a class=lnlinks href=#hl-8-137>137</a>
</span><span class=lnt id=hl-8-138><a class=lnlinks href=#hl-8-138>138</a>
</span><span class=lnt id=hl-8-139><a class=lnlinks href=#hl-8-139>139</a>
</span><span class=lnt id=hl-8-140><a class=lnlinks href=#hl-8-140>140</a>
</span><span class=lnt id=hl-8-141><a class=lnlinks href=#hl-8-141>141</a>
</span><span class=lnt id=hl-8-142><a class=lnlinks href=#hl-8-142>142</a>
</span><span class=lnt id=hl-8-143><a class=lnlinks href=#hl-8-143>143</a>
</span><span class=lnt id=hl-8-144><a class=lnlinks href=#hl-8-144>144</a>
</span><span class=lnt id=hl-8-145><a class=lnlinks href=#hl-8-145>145</a>
</span><span class=lnt id=hl-8-146><a class=lnlinks href=#hl-8-146>146</a>
</span><span class=lnt id=hl-8-147><a class=lnlinks href=#hl-8-147>147</a>
</span><span class=lnt id=hl-8-148><a class=lnlinks href=#hl-8-148>148</a>
</span><span class=lnt id=hl-8-149><a class=lnlinks href=#hl-8-149>149</a>
</span><span class=lnt id=hl-8-150><a class=lnlinks href=#hl-8-150>150</a>
</span><span class=lnt id=hl-8-151><a class=lnlinks href=#hl-8-151>151</a>
</span><span class=lnt id=hl-8-152><a class=lnlinks href=#hl-8-152>152</a>
</span><span class=lnt id=hl-8-153><a class=lnlinks href=#hl-8-153>153</a>
</span><span class=lnt id=hl-8-154><a class=lnlinks href=#hl-8-154>154</a>
</span><span class=lnt id=hl-8-155><a class=lnlinks href=#hl-8-155>155</a>
</span><span class=lnt id=hl-8-156><a class=lnlinks href=#hl-8-156>156</a>
</span><span class=lnt id=hl-8-157><a class=lnlinks href=#hl-8-157>157</a>
</span><span class=lnt id=hl-8-158><a class=lnlinks href=#hl-8-158>158</a>
</span><span class=lnt id=hl-8-159><a class=lnlinks href=#hl-8-159>159</a>
</span><span class=lnt id=hl-8-160><a class=lnlinks href=#hl-8-160>160</a>
</span><span class=lnt id=hl-8-161><a class=lnlinks href=#hl-8-161>161</a>
</span><span class=lnt id=hl-8-162><a class=lnlinks href=#hl-8-162>162</a>
</span><span class=lnt id=hl-8-163><a class=lnlinks href=#hl-8-163>163</a>
</span><span class=lnt id=hl-8-164><a class=lnlinks href=#hl-8-164>164</a>
</span><span class=lnt id=hl-8-165><a class=lnlinks href=#hl-8-165>165</a>
</span><span class=lnt id=hl-8-166><a class=lnlinks href=#hl-8-166>166</a>
</span><span class=lnt id=hl-8-167><a class=lnlinks href=#hl-8-167>167</a>
</span><span class=lnt id=hl-8-168><a class=lnlinks href=#hl-8-168>168</a>
</span><span class=lnt id=hl-8-169><a class=lnlinks href=#hl-8-169>169</a>
</span><span class=lnt id=hl-8-170><a class=lnlinks href=#hl-8-170>170</a>
</span><span class=lnt id=hl-8-171><a class=lnlinks href=#hl-8-171>171</a>
</span><span class=lnt id=hl-8-172><a class=lnlinks href=#hl-8-172>172</a>
</span><span class=lnt id=hl-8-173><a class=lnlinks href=#hl-8-173>173</a>
</span><span class=lnt id=hl-8-174><a class=lnlinks href=#hl-8-174>174</a>
</span><span class=lnt id=hl-8-175><a class=lnlinks href=#hl-8-175>175</a>
</span><span class=lnt id=hl-8-176><a class=lnlinks href=#hl-8-176>176</a>
</span><span class=lnt id=hl-8-177><a class=lnlinks href=#hl-8-177>177</a>
</span><span class=lnt id=hl-8-178><a class=lnlinks href=#hl-8-178>178</a>
</span><span class=lnt id=hl-8-179><a class=lnlinks href=#hl-8-179>179</a>
</span><span class=lnt id=hl-8-180><a class=lnlinks href=#hl-8-180>180</a>
</span><span class=lnt id=hl-8-181><a class=lnlinks href=#hl-8-181>181</a>
</span><span class=lnt id=hl-8-182><a class=lnlinks href=#hl-8-182>182</a>
</span><span class=lnt id=hl-8-183><a class=lnlinks href=#hl-8-183>183</a>
</span><span class=lnt id=hl-8-184><a class=lnlinks href=#hl-8-184>184</a>
</span><span class=lnt id=hl-8-185><a class=lnlinks href=#hl-8-185>185</a>
</span><span class=lnt id=hl-8-186><a class=lnlinks href=#hl-8-186>186</a>
</span><span class=lnt id=hl-8-187><a class=lnlinks href=#hl-8-187>187</a>
</span><span class=lnt id=hl-8-188><a class=lnlinks href=#hl-8-188>188</a>
</span><span class=lnt id=hl-8-189><a class=lnlinks href=#hl-8-189>189</a>
</span><span class=lnt id=hl-8-190><a class=lnlinks href=#hl-8-190>190</a>
</span><span class=lnt id=hl-8-191><a class=lnlinks href=#hl-8-191>191</a>
</span><span class=lnt id=hl-8-192><a class=lnlinks href=#hl-8-192>192</a>
</span><span class=lnt id=hl-8-193><a class=lnlinks href=#hl-8-193>193</a>
</span><span class=lnt id=hl-8-194><a class=lnlinks href=#hl-8-194>194</a>
</span><span class=lnt id=hl-8-195><a class=lnlinks href=#hl-8-195>195</a>
</span><span class=lnt id=hl-8-196><a class=lnlinks href=#hl-8-196>196</a>
</span><span class=lnt id=hl-8-197><a class=lnlinks href=#hl-8-197>197</a>
</span><span class=lnt id=hl-8-198><a class=lnlinks href=#hl-8-198>198</a>
</span><span class=lnt id=hl-8-199><a class=lnlinks href=#hl-8-199>199</a>
</span><span class=lnt id=hl-8-200><a class=lnlinks href=#hl-8-200>200</a>
</span><span class=lnt id=hl-8-201><a class=lnlinks href=#hl-8-201>201</a>
</span><span class=lnt id=hl-8-202><a class=lnlinks href=#hl-8-202>202</a>
</span><span class=lnt id=hl-8-203><a class=lnlinks href=#hl-8-203>203</a>
</span><span class=lnt id=hl-8-204><a class=lnlinks href=#hl-8-204>204</a>
</span><span class=lnt id=hl-8-205><a class=lnlinks href=#hl-8-205>205</a>
</span><span class=lnt id=hl-8-206><a class=lnlinks href=#hl-8-206>206</a>
</span><span class=lnt id=hl-8-207><a class=lnlinks href=#hl-8-207>207</a>
</span><span class=lnt id=hl-8-208><a class=lnlinks href=#hl-8-208>208</a>
</span><span class=lnt id=hl-8-209><a class=lnlinks href=#hl-8-209>209</a>
</span><span class=lnt id=hl-8-210><a class=lnlinks href=#hl-8-210>210</a>
</span><span class=lnt id=hl-8-211><a class=lnlinks href=#hl-8-211>211</a>
</span><span class=lnt id=hl-8-212><a class=lnlinks href=#hl-8-212>212</a>
</span><span class=lnt id=hl-8-213><a class=lnlinks href=#hl-8-213>213</a>
</span><span class=lnt id=hl-8-214><a class=lnlinks href=#hl-8-214>214</a>
</span><span class=lnt id=hl-8-215><a class=lnlinks href=#hl-8-215>215</a>
</span><span class=lnt id=hl-8-216><a class=lnlinks href=#hl-8-216>216</a>
</span><span class=lnt id=hl-8-217><a class=lnlinks href=#hl-8-217>217</a>
</span><span class=lnt id=hl-8-218><a class=lnlinks href=#hl-8-218>218</a>
</span><span class=lnt id=hl-8-219><a class=lnlinks href=#hl-8-219>219</a>
</span><span class=lnt id=hl-8-220><a class=lnlinks href=#hl-8-220>220</a>
</span><span class=lnt id=hl-8-221><a class=lnlinks href=#hl-8-221>221</a>
</span><span class=lnt id=hl-8-222><a class=lnlinks href=#hl-8-222>222</a>
</span><span class=lnt id=hl-8-223><a class=lnlinks href=#hl-8-223>223</a>
</span><span class=lnt id=hl-8-224><a class=lnlinks href=#hl-8-224>224</a>
</span><span class=lnt id=hl-8-225><a class=lnlinks href=#hl-8-225>225</a>
</span><span class=lnt id=hl-8-226><a class=lnlinks href=#hl-8-226>226</a>
</span><span class=lnt id=hl-8-227><a class=lnlinks href=#hl-8-227>227</a>
</span><span class=lnt id=hl-8-228><a class=lnlinks href=#hl-8-228>228</a>
</span><span class=lnt id=hl-8-229><a class=lnlinks href=#hl-8-229>229</a>
</span><span class=lnt id=hl-8-230><a class=lnlinks href=#hl-8-230>230</a>
</span><span class=lnt id=hl-8-231><a class=lnlinks href=#hl-8-231>231</a>
</span><span class=lnt id=hl-8-232><a class=lnlinks href=#hl-8-232>232</a>
</span><span class=lnt id=hl-8-233><a class=lnlinks href=#hl-8-233>233</a>
</span><span class=lnt id=hl-8-234><a class=lnlinks href=#hl-8-234>234</a>
</span><span class=lnt id=hl-8-235><a class=lnlinks href=#hl-8-235>235</a>
</span><span class=lnt id=hl-8-236><a class=lnlinks href=#hl-8-236>236</a>
</span><span class=lnt id=hl-8-237><a class=lnlinks href=#hl-8-237>237</a>
</span><span class=lnt id=hl-8-238><a class=lnlinks href=#hl-8-238>238</a>
</span><span class=lnt id=hl-8-239><a class=lnlinks href=#hl-8-239>239</a>
</span><span class=lnt id=hl-8-240><a class=lnlinks href=#hl-8-240>240</a>
</span><span class=lnt id=hl-8-241><a class=lnlinks href=#hl-8-241>241</a>
</span><span class=lnt id=hl-8-242><a class=lnlinks href=#hl-8-242>242</a>
</span><span class=lnt id=hl-8-243><a class=lnlinks href=#hl-8-243>243</a>
</span><span class=lnt id=hl-8-244><a class=lnlinks href=#hl-8-244>244</a>
</span><span class=lnt id=hl-8-245><a class=lnlinks href=#hl-8-245>245</a>
</span><span class=lnt id=hl-8-246><a class=lnlinks href=#hl-8-246>246</a>
</span><span class=lnt id=hl-8-247><a class=lnlinks href=#hl-8-247>247</a>
</span><span class=lnt id=hl-8-248><a class=lnlinks href=#hl-8-248>248</a>
</span><span class=lnt id=hl-8-249><a class=lnlinks href=#hl-8-249>249</a>
</span><span class=lnt id=hl-8-250><a class=lnlinks href=#hl-8-250>250</a>
</span><span class=lnt id=hl-8-251><a class=lnlinks href=#hl-8-251>251</a>
</span><span class=lnt id=hl-8-252><a class=lnlinks href=#hl-8-252>252</a>
</span><span class=lnt id=hl-8-253><a class=lnlinks href=#hl-8-253>253</a>
</span><span class=lnt id=hl-8-254><a class=lnlinks href=#hl-8-254>254</a>
</span><span class=lnt id=hl-8-255><a class=lnlinks href=#hl-8-255>255</a>
</span><span class=lnt id=hl-8-256><a class=lnlinks href=#hl-8-256>256</a>
</span><span class=lnt id=hl-8-257><a class=lnlinks href=#hl-8-257>257</a>
</span><span class=lnt id=hl-8-258><a class=lnlinks href=#hl-8-258>258</a>
</span><span class=lnt id=hl-8-259><a class=lnlinks href=#hl-8-259>259</a>
</span><span class=lnt id=hl-8-260><a class=lnlinks href=#hl-8-260>260</a>
</span><span class=lnt id=hl-8-261><a class=lnlinks href=#hl-8-261>261</a>
</span><span class=lnt id=hl-8-262><a class=lnlinks href=#hl-8-262>262</a>
</span><span class=lnt id=hl-8-263><a class=lnlinks href=#hl-8-263>263</a>
</span><span class=lnt id=hl-8-264><a class=lnlinks href=#hl-8-264>264</a>
</span><span class=lnt id=hl-8-265><a class=lnlinks href=#hl-8-265>265</a>
</span><span class=lnt id=hl-8-266><a class=lnlinks href=#hl-8-266>266</a>
</span><span class=lnt id=hl-8-267><a class=lnlinks href=#hl-8-267>267</a>
</span><span class=lnt id=hl-8-268><a class=lnlinks href=#hl-8-268>268</a>
</span><span class=lnt id=hl-8-269><a class=lnlinks href=#hl-8-269>269</a>
</span><span class=lnt id=hl-8-270><a class=lnlinks href=#hl-8-270>270</a>
</span><span class=lnt id=hl-8-271><a class=lnlinks href=#hl-8-271>271</a>
</span><span class=lnt id=hl-8-272><a class=lnlinks href=#hl-8-272>272</a>
</span><span class=lnt id=hl-8-273><a class=lnlinks href=#hl-8-273>273</a>
</span><span class=lnt id=hl-8-274><a class=lnlinks href=#hl-8-274>274</a>
</span><span class=lnt id=hl-8-275><a class=lnlinks href=#hl-8-275>275</a>
</span><span class=lnt id=hl-8-276><a class=lnlinks href=#hl-8-276>276</a>
</span><span class=lnt id=hl-8-277><a class=lnlinks href=#hl-8-277>277</a>
</span><span class=lnt id=hl-8-278><a class=lnlinks href=#hl-8-278>278</a>
</span><span class=lnt id=hl-8-279><a class=lnlinks href=#hl-8-279>279</a>
</span><span class=lnt id=hl-8-280><a class=lnlinks href=#hl-8-280>280</a>
</span><span class=lnt id=hl-8-281><a class=lnlinks href=#hl-8-281>281</a>
</span><span class=lnt id=hl-8-282><a class=lnlinks href=#hl-8-282>282</a>
</span><span class=lnt id=hl-8-283><a class=lnlinks href=#hl-8-283>283</a>
</span><span class=lnt id=hl-8-284><a class=lnlinks href=#hl-8-284>284</a>
</span><span class=lnt id=hl-8-285><a class=lnlinks href=#hl-8-285>285</a>
</span><span class=lnt id=hl-8-286><a class=lnlinks href=#hl-8-286>286</a>
</span><span class=lnt id=hl-8-287><a class=lnlinks href=#hl-8-287>287</a>
</span><span class=lnt id=hl-8-288><a class=lnlinks href=#hl-8-288>288</a>
</span><span class=lnt id=hl-8-289><a class=lnlinks href=#hl-8-289>289</a>
</span><span class=lnt id=hl-8-290><a class=lnlinks href=#hl-8-290>290</a>
</span><span class=lnt id=hl-8-291><a class=lnlinks href=#hl-8-291>291</a>
</span><span class=lnt id=hl-8-292><a class=lnlinks href=#hl-8-292>292</a>
</span><span class=lnt id=hl-8-293><a class=lnlinks href=#hl-8-293>293</a>
</span><span class=lnt id=hl-8-294><a class=lnlinks href=#hl-8-294>294</a>
</span><span class=lnt id=hl-8-295><a class=lnlinks href=#hl-8-295>295</a>
</span><span class=lnt id=hl-8-296><a class=lnlinks href=#hl-8-296>296</a>
</span><span class=lnt id=hl-8-297><a class=lnlinks href=#hl-8-297>297</a>
</span><span class=lnt id=hl-8-298><a class=lnlinks href=#hl-8-298>298</a>
</span><span class=lnt id=hl-8-299><a class=lnlinks href=#hl-8-299>299</a>
</span><span class=lnt id=hl-8-300><a class=lnlinks href=#hl-8-300>300</a>
</span><span class=lnt id=hl-8-301><a class=lnlinks href=#hl-8-301>301</a>
</span><span class=lnt id=hl-8-302><a class=lnlinks href=#hl-8-302>302</a>
</span><span class=lnt id=hl-8-303><a class=lnlinks href=#hl-8-303>303</a>
</span><span class=lnt id=hl-8-304><a class=lnlinks href=#hl-8-304>304</a>
</span><span class=lnt id=hl-8-305><a class=lnlinks href=#hl-8-305>305</a>
</span><span class=lnt id=hl-8-306><a class=lnlinks href=#hl-8-306>306</a>
</span><span class=lnt id=hl-8-307><a class=lnlinks href=#hl-8-307>307</a>
</span><span class=lnt id=hl-8-308><a class=lnlinks href=#hl-8-308>308</a>
</span><span class=lnt id=hl-8-309><a class=lnlinks href=#hl-8-309>309</a>
</span><span class=lnt id=hl-8-310><a class=lnlinks href=#hl-8-310>310</a>
</span><span class=lnt id=hl-8-311><a class=lnlinks href=#hl-8-311>311</a>
</span><span class=lnt id=hl-8-312><a class=lnlinks href=#hl-8-312>312</a>
</span><span class=lnt id=hl-8-313><a class=lnlinks href=#hl-8-313>313</a>
</span><span class=lnt id=hl-8-314><a class=lnlinks href=#hl-8-314>314</a>
</span><span class=lnt id=hl-8-315><a class=lnlinks href=#hl-8-315>315</a>
</span><span class=lnt id=hl-8-316><a class=lnlinks href=#hl-8-316>316</a>
</span><span class=lnt id=hl-8-317><a class=lnlinks href=#hl-8-317>317</a>
</span><span class=lnt id=hl-8-318><a class=lnlinks href=#hl-8-318>318</a>
</span><span class=lnt id=hl-8-319><a class=lnlinks href=#hl-8-319>319</a>
</span><span class=lnt id=hl-8-320><a class=lnlinks href=#hl-8-320>320</a>
</span><span class=lnt id=hl-8-321><a class=lnlinks href=#hl-8-321>321</a>
</span><span class=lnt id=hl-8-322><a class=lnlinks href=#hl-8-322>322</a>
</span><span class=lnt id=hl-8-323><a class=lnlinks href=#hl-8-323>323</a>
</span><span class=lnt id=hl-8-324><a class=lnlinks href=#hl-8-324>324</a>
</span><span class=lnt id=hl-8-325><a class=lnlinks href=#hl-8-325>325</a>
</span><span class=lnt id=hl-8-326><a class=lnlinks href=#hl-8-326>326</a>
</span><span class=lnt id=hl-8-327><a class=lnlinks href=#hl-8-327>327</a>
</span><span class=lnt id=hl-8-328><a class=lnlinks href=#hl-8-328>328</a>
</span><span class=lnt id=hl-8-329><a class=lnlinks href=#hl-8-329>329</a>
</span><span class=lnt id=hl-8-330><a class=lnlinks href=#hl-8-330>330</a>
</span><span class=lnt id=hl-8-331><a class=lnlinks href=#hl-8-331>331</a>
</span><span class=lnt id=hl-8-332><a class=lnlinks href=#hl-8-332>332</a>
</span><span class=lnt id=hl-8-333><a class=lnlinks href=#hl-8-333>333</a>
</span><span class=lnt id=hl-8-334><a class=lnlinks href=#hl-8-334>334</a>
</span><span class=lnt id=hl-8-335><a class=lnlinks href=#hl-8-335>335</a>
</span><span class=lnt id=hl-8-336><a class=lnlinks href=#hl-8-336>336</a>
</span><span class=lnt id=hl-8-337><a class=lnlinks href=#hl-8-337>337</a>
</span><span class=lnt id=hl-8-338><a class=lnlinks href=#hl-8-338>338</a>
</span><span class=lnt id=hl-8-339><a class=lnlinks href=#hl-8-339>339</a>
</span><span class=lnt id=hl-8-340><a class=lnlinks href=#hl-8-340>340</a>
</span><span class=lnt id=hl-8-341><a class=lnlinks href=#hl-8-341>341</a>
</span><span class=lnt id=hl-8-342><a class=lnlinks href=#hl-8-342>342</a>
</span><span class=lnt id=hl-8-343><a class=lnlinks href=#hl-8-343>343</a>
</span><span class=lnt id=hl-8-344><a class=lnlinks href=#hl-8-344>344</a>
</span><span class=lnt id=hl-8-345><a class=lnlinks href=#hl-8-345>345</a>
</span><span class=lnt id=hl-8-346><a class=lnlinks href=#hl-8-346>346</a>
</span><span class=lnt id=hl-8-347><a class=lnlinks href=#hl-8-347>347</a>
</span><span class=lnt id=hl-8-348><a class=lnlinks href=#hl-8-348>348</a>
</span><span class=lnt id=hl-8-349><a class=lnlinks href=#hl-8-349>349</a>
</span><span class=lnt id=hl-8-350><a class=lnlinks href=#hl-8-350>350</a>
</span><span class=lnt id=hl-8-351><a class=lnlinks href=#hl-8-351>351</a>
</span><span class=lnt id=hl-8-352><a class=lnlinks href=#hl-8-352>352</a>
</span><span class=lnt id=hl-8-353><a class=lnlinks href=#hl-8-353>353</a>
</span><span class=lnt id=hl-8-354><a class=lnlinks href=#hl-8-354>354</a>
</span><span class=lnt id=hl-8-355><a class=lnlinks href=#hl-8-355>355</a>
</span><span class=lnt id=hl-8-356><a class=lnlinks href=#hl-8-356>356</a>
</span><span class=lnt id=hl-8-357><a class=lnlinks href=#hl-8-357>357</a>
</span><span class=lnt id=hl-8-358><a class=lnlinks href=#hl-8-358>358</a>
</span><span class=lnt id=hl-8-359><a class=lnlinks href=#hl-8-359>359</a>
</span><span class=lnt id=hl-8-360><a class=lnlinks href=#hl-8-360>360</a>
</span><span class=lnt id=hl-8-361><a class=lnlinks href=#hl-8-361>361</a>
</span><span class=lnt id=hl-8-362><a class=lnlinks href=#hl-8-362>362</a>
</span><span class=lnt id=hl-8-363><a class=lnlinks href=#hl-8-363>363</a>
</span><span class=lnt id=hl-8-364><a class=lnlinks href=#hl-8-364>364</a>
</span><span class=lnt id=hl-8-365><a class=lnlinks href=#hl-8-365>365</a>
</span><span class=lnt id=hl-8-366><a class=lnlinks href=#hl-8-366>366</a>
</span><span class=lnt id=hl-8-367><a class=lnlinks href=#hl-8-367>367</a>
</span><span class=lnt id=hl-8-368><a class=lnlinks href=#hl-8-368>368</a>
</span><span class=lnt id=hl-8-369><a class=lnlinks href=#hl-8-369>369</a>
</span><span class=lnt id=hl-8-370><a class=lnlinks href=#hl-8-370>370</a>
</span><span class=lnt id=hl-8-371><a class=lnlinks href=#hl-8-371>371</a>
</span><span class=lnt id=hl-8-372><a class=lnlinks href=#hl-8-372>372</a>
</span><span class=lnt id=hl-8-373><a class=lnlinks href=#hl-8-373>373</a>
</span><span class=lnt id=hl-8-374><a class=lnlinks href=#hl-8-374>374</a>
</span><span class=lnt id=hl-8-375><a class=lnlinks href=#hl-8-375>375</a>
</span><span class=lnt id=hl-8-376><a class=lnlinks href=#hl-8-376>376</a>
</span><span class=lnt id=hl-8-377><a class=lnlinks href=#hl-8-377>377</a>
</span><span class=lnt id=hl-8-378><a class=lnlinks href=#hl-8-378>378</a>
</span><span class=lnt id=hl-8-379><a class=lnlinks href=#hl-8-379>379</a>
</span><span class=lnt id=hl-8-380><a class=lnlinks href=#hl-8-380>380</a>
</span><span class=lnt id=hl-8-381><a class=lnlinks href=#hl-8-381>381</a>
</span><span class=lnt id=hl-8-382><a class=lnlinks href=#hl-8-382>382</a>
</span><span class=lnt id=hl-8-383><a class=lnlinks href=#hl-8-383>383</a>
</span><span class=lnt id=hl-8-384><a class=lnlinks href=#hl-8-384>384</a>
</span><span class=lnt id=hl-8-385><a class=lnlinks href=#hl-8-385>385</a>
</span><span class=lnt id=hl-8-386><a class=lnlinks href=#hl-8-386>386</a>
</span><span class=lnt id=hl-8-387><a class=lnlinks href=#hl-8-387>387</a>
</span><span class=lnt id=hl-8-388><a class=lnlinks href=#hl-8-388>388</a>
</span><span class=lnt id=hl-8-389><a class=lnlinks href=#hl-8-389>389</a>
</span><span class=lnt id=hl-8-390><a class=lnlinks href=#hl-8-390>390</a>
</span><span class=lnt id=hl-8-391><a class=lnlinks href=#hl-8-391>391</a>
</span><span class=lnt id=hl-8-392><a class=lnlinks href=#hl-8-392>392</a>
</span><span class=lnt id=hl-8-393><a class=lnlinks href=#hl-8-393>393</a>
</span><span class=lnt id=hl-8-394><a class=lnlinks href=#hl-8-394>394</a>
</span><span class=lnt id=hl-8-395><a class=lnlinks href=#hl-8-395>395</a>
</span><span class=lnt id=hl-8-396><a class=lnlinks href=#hl-8-396>396</a>
</span><span class=lnt id=hl-8-397><a class=lnlinks href=#hl-8-397>397</a>
</span><span class=lnt id=hl-8-398><a class=lnlinks href=#hl-8-398>398</a>
</span><span class=lnt id=hl-8-399><a class=lnlinks href=#hl-8-399>399</a>
</span><span class=lnt id=hl-8-400><a class=lnlinks href=#hl-8-400>400</a>
</span><span class=lnt id=hl-8-401><a class=lnlinks href=#hl-8-401>401</a>
</span><span class=lnt id=hl-8-402><a class=lnlinks href=#hl-8-402>402</a>
</span><span class=lnt id=hl-8-403><a class=lnlinks href=#hl-8-403>403</a>
</span><span class=lnt id=hl-8-404><a class=lnlinks href=#hl-8-404>404</a>
</span><span class=lnt id=hl-8-405><a class=lnlinks href=#hl-8-405>405</a>
</span><span class=lnt id=hl-8-406><a class=lnlinks href=#hl-8-406>406</a>
</span><span class=lnt id=hl-8-407><a class=lnlinks href=#hl-8-407>407</a>
</span><span class=lnt id=hl-8-408><a class=lnlinks href=#hl-8-408>408</a>
</span><span class=lnt id=hl-8-409><a class=lnlinks href=#hl-8-409>409</a>
</span><span class=lnt id=hl-8-410><a class=lnlinks href=#hl-8-410>410</a>
</span><span class=lnt id=hl-8-411><a class=lnlinks href=#hl-8-411>411</a>
</span><span class=lnt id=hl-8-412><a class=lnlinks href=#hl-8-412>412</a>
</span><span class=lnt id=hl-8-413><a class=lnlinks href=#hl-8-413>413</a>
</span><span class=lnt id=hl-8-414><a class=lnlinks href=#hl-8-414>414</a>
</span><span class=lnt id=hl-8-415><a class=lnlinks href=#hl-8-415>415</a>
</span><span class=lnt id=hl-8-416><a class=lnlinks href=#hl-8-416>416</a>
</span><span class=lnt id=hl-8-417><a class=lnlinks href=#hl-8-417>417</a>
</span><span class=lnt id=hl-8-418><a class=lnlinks href=#hl-8-418>418</a>
</span><span class=lnt id=hl-8-419><a class=lnlinks href=#hl-8-419>419</a>
</span><span class=lnt id=hl-8-420><a class=lnlinks href=#hl-8-420>420</a>
</span><span class=lnt id=hl-8-421><a class=lnlinks href=#hl-8-421>421</a>
</span><span class=lnt id=hl-8-422><a class=lnlinks href=#hl-8-422>422</a>
</span><span class=lnt id=hl-8-423><a class=lnlinks href=#hl-8-423>423</a>
</span><span class=lnt id=hl-8-424><a class=lnlinks href=#hl-8-424>424</a>
</span><span class=lnt id=hl-8-425><a class=lnlinks href=#hl-8-425>425</a>
</span><span class=lnt id=hl-8-426><a class=lnlinks href=#hl-8-426>426</a>
</span><span class=lnt id=hl-8-427><a class=lnlinks href=#hl-8-427>427</a>
</span><span class=lnt id=hl-8-428><a class=lnlinks href=#hl-8-428>428</a>
</span><span class=lnt id=hl-8-429><a class=lnlinks href=#hl-8-429>429</a>
</span><span class=lnt id=hl-8-430><a class=lnlinks href=#hl-8-430>430</a>
</span><span class=lnt id=hl-8-431><a class=lnlinks href=#hl-8-431>431</a>
</span><span class=lnt id=hl-8-432><a class=lnlinks href=#hl-8-432>432</a>
</span><span class=lnt id=hl-8-433><a class=lnlinks href=#hl-8-433>433</a>
</span><span class=lnt id=hl-8-434><a class=lnlinks href=#hl-8-434>434</a>
</span><span class=lnt id=hl-8-435><a class=lnlinks href=#hl-8-435>435</a>
</span><span class=lnt id=hl-8-436><a class=lnlinks href=#hl-8-436>436</a>
</span><span class=lnt id=hl-8-437><a class=lnlinks href=#hl-8-437>437</a>
</span><span class=lnt id=hl-8-438><a class=lnlinks href=#hl-8-438>438</a>
</span><span class=lnt id=hl-8-439><a class=lnlinks href=#hl-8-439>439</a>
</span><span class=lnt id=hl-8-440><a class=lnlinks href=#hl-8-440>440</a>
</span><span class=lnt id=hl-8-441><a class=lnlinks href=#hl-8-441>441</a>
</span><span class=lnt id=hl-8-442><a class=lnlinks href=#hl-8-442>442</a>
</span><span class=lnt id=hl-8-443><a class=lnlinks href=#hl-8-443>443</a>
</span><span class=lnt id=hl-8-444><a class=lnlinks href=#hl-8-444>444</a>
</span><span class=lnt id=hl-8-445><a class=lnlinks href=#hl-8-445>445</a>
</span><span class=lnt id=hl-8-446><a class=lnlinks href=#hl-8-446>446</a>
</span><span class=lnt id=hl-8-447><a class=lnlinks href=#hl-8-447>447</a>
</span><span class=lnt id=hl-8-448><a class=lnlinks href=#hl-8-448>448</a>
</span><span class=lnt id=hl-8-449><a class=lnlinks href=#hl-8-449>449</a>
</span><span class=lnt id=hl-8-450><a class=lnlinks href=#hl-8-450>450</a>
</span><span class=lnt id=hl-8-451><a class=lnlinks href=#hl-8-451>451</a>
</span><span class=lnt id=hl-8-452><a class=lnlinks href=#hl-8-452>452</a>
</span><span class=lnt id=hl-8-453><a class=lnlinks href=#hl-8-453>453</a>
</span><span class=lnt id=hl-8-454><a class=lnlinks href=#hl-8-454>454</a>
</span><span class=lnt id=hl-8-455><a class=lnlinks href=#hl-8-455>455</a>
</span><span class=lnt id=hl-8-456><a class=lnlinks href=#hl-8-456>456</a>
</span><span class=lnt id=hl-8-457><a class=lnlinks href=#hl-8-457>457</a>
</span><span class=lnt id=hl-8-458><a class=lnlinks href=#hl-8-458>458</a>
</span><span class=lnt id=hl-8-459><a class=lnlinks href=#hl-8-459>459</a>
</span><span class=lnt id=hl-8-460><a class=lnlinks href=#hl-8-460>460</a>
</span><span class=lnt id=hl-8-461><a class=lnlinks href=#hl-8-461>461</a>
</span><span class=lnt id=hl-8-462><a class=lnlinks href=#hl-8-462>462</a>
</span><span class=lnt id=hl-8-463><a class=lnlinks href=#hl-8-463>463</a>
</span><span class=lnt id=hl-8-464><a class=lnlinks href=#hl-8-464>464</a>
</span><span class=lnt id=hl-8-465><a class=lnlinks href=#hl-8-465>465</a>
</span><span class=lnt id=hl-8-466><a class=lnlinks href=#hl-8-466>466</a>
</span><span class=lnt id=hl-8-467><a class=lnlinks href=#hl-8-467>467</a>
</span><span class=lnt id=hl-8-468><a class=lnlinks href=#hl-8-468>468</a>
</span><span class=lnt id=hl-8-469><a class=lnlinks href=#hl-8-469>469</a>
</span><span class=lnt id=hl-8-470><a class=lnlinks href=#hl-8-470>470</a>
</span><span class=lnt id=hl-8-471><a class=lnlinks href=#hl-8-471>471</a>
</span><span class=lnt id=hl-8-472><a class=lnlinks href=#hl-8-472>472</a>
</span><span class=lnt id=hl-8-473><a class=lnlinks href=#hl-8-473>473</a>
</span><span class=lnt id=hl-8-474><a class=lnlinks href=#hl-8-474>474</a>
</span><span class=lnt id=hl-8-475><a class=lnlinks href=#hl-8-475>475</a>
</span><span class=lnt id=hl-8-476><a class=lnlinks href=#hl-8-476>476</a>
</span><span class=lnt id=hl-8-477><a class=lnlinks href=#hl-8-477>477</a>
</span><span class=lnt id=hl-8-478><a class=lnlinks href=#hl-8-478>478</a>
</span><span class=lnt id=hl-8-479><a class=lnlinks href=#hl-8-479>479</a>
</span><span class=lnt id=hl-8-480><a class=lnlinks href=#hl-8-480>480</a>
</span><span class=lnt id=hl-8-481><a class=lnlinks href=#hl-8-481>481</a>
</span><span class=lnt id=hl-8-482><a class=lnlinks href=#hl-8-482>482</a>
</span><span class=lnt id=hl-8-483><a class=lnlinks href=#hl-8-483>483</a>
</span><span class=lnt id=hl-8-484><a class=lnlinks href=#hl-8-484>484</a>
</span><span class=lnt id=hl-8-485><a class=lnlinks href=#hl-8-485>485</a>
</span><span class=lnt id=hl-8-486><a class=lnlinks href=#hl-8-486>486</a>
</span><span class=lnt id=hl-8-487><a class=lnlinks href=#hl-8-487>487</a>
</span><span class=lnt id=hl-8-488><a class=lnlinks href=#hl-8-488>488</a>
</span><span class=lnt id=hl-8-489><a class=lnlinks href=#hl-8-489>489</a>
</span><span class=lnt id=hl-8-490><a class=lnlinks href=#hl-8-490>490</a>
</span><span class=lnt id=hl-8-491><a class=lnlinks href=#hl-8-491>491</a>
</span><span class=lnt id=hl-8-492><a class=lnlinks href=#hl-8-492>492</a>
</span><span class=lnt id=hl-8-493><a class=lnlinks href=#hl-8-493>493</a>
</span><span class=lnt id=hl-8-494><a class=lnlinks href=#hl-8-494>494</a>
</span><span class=lnt id=hl-8-495><a class=lnlinks href=#hl-8-495>495</a>
</span><span class=lnt id=hl-8-496><a class=lnlinks href=#hl-8-496>496</a>
</span><span class=lnt id=hl-8-497><a class=lnlinks href=#hl-8-497>497</a>
</span><span class=lnt id=hl-8-498><a class=lnlinks href=#hl-8-498>498</a>
</span><span class=lnt id=hl-8-499><a class=lnlinks href=#hl-8-499>499</a>
</span><span class=lnt id=hl-8-500><a class=lnlinks href=#hl-8-500>500</a>
</span><span class=lnt id=hl-8-501><a class=lnlinks href=#hl-8-501>501</a>
</span><span class=lnt id=hl-8-502><a class=lnlinks href=#hl-8-502>502</a>
</span><span class=lnt id=hl-8-503><a class=lnlinks href=#hl-8-503>503</a>
</span><span class=lnt id=hl-8-504><a class=lnlinks href=#hl-8-504>504</a>
</span><span class=lnt id=hl-8-505><a class=lnlinks href=#hl-8-505>505</a>
</span><span class=lnt id=hl-8-506><a class=lnlinks href=#hl-8-506>506</a>
</span><span class=lnt id=hl-8-507><a class=lnlinks href=#hl-8-507>507</a>
</span><span class=lnt id=hl-8-508><a class=lnlinks href=#hl-8-508>508</a>
</span><span class=lnt id=hl-8-509><a class=lnlinks href=#hl-8-509>509</a>
</span><span class=lnt id=hl-8-510><a class=lnlinks href=#hl-8-510>510</a>
</span><span class=lnt id=hl-8-511><a class=lnlinks href=#hl-8-511>511</a>
</span><span class=lnt id=hl-8-512><a class=lnlinks href=#hl-8-512>512</a>
</span><span class=lnt id=hl-8-513><a class=lnlinks href=#hl-8-513>513</a>
</span><span class=lnt id=hl-8-514><a class=lnlinks href=#hl-8-514>514</a>
</span><span class=lnt id=hl-8-515><a class=lnlinks href=#hl-8-515>515</a>
</span><span class=lnt id=hl-8-516><a class=lnlinks href=#hl-8-516>516</a>
</span><span class=lnt id=hl-8-517><a class=lnlinks href=#hl-8-517>517</a>
</span><span class=lnt id=hl-8-518><a class=lnlinks href=#hl-8-518>518</a>
</span><span class=lnt id=hl-8-519><a class=lnlinks href=#hl-8-519>519</a>
</span><span class=lnt id=hl-8-520><a class=lnlinks href=#hl-8-520>520</a>
</span><span class=lnt id=hl-8-521><a class=lnlinks href=#hl-8-521>521</a>
</span><span class=lnt id=hl-8-522><a class=lnlinks href=#hl-8-522>522</a>
</span><span class=lnt id=hl-8-523><a class=lnlinks href=#hl-8-523>523</a>
</span><span class=lnt id=hl-8-524><a class=lnlinks href=#hl-8-524>524</a>
</span><span class=lnt id=hl-8-525><a class=lnlinks href=#hl-8-525>525</a>
</span><span class=lnt id=hl-8-526><a class=lnlinks href=#hl-8-526>526</a>
</span><span class=lnt id=hl-8-527><a class=lnlinks href=#hl-8-527>527</a>
</span><span class=lnt id=hl-8-528><a class=lnlinks href=#hl-8-528>528</a>
</span><span class=lnt id=hl-8-529><a class=lnlinks href=#hl-8-529>529</a>
</span><span class=lnt id=hl-8-530><a class=lnlinks href=#hl-8-530>530</a>
</span><span class=lnt id=hl-8-531><a class=lnlinks href=#hl-8-531>531</a>
</span><span class=lnt id=hl-8-532><a class=lnlinks href=#hl-8-532>532</a>
</span><span class=lnt id=hl-8-533><a class=lnlinks href=#hl-8-533>533</a>
</span><span class=lnt id=hl-8-534><a class=lnlinks href=#hl-8-534>534</a>
</span><span class=lnt id=hl-8-535><a class=lnlinks href=#hl-8-535>535</a>
</span><span class=lnt id=hl-8-536><a class=lnlinks href=#hl-8-536>536</a>
</span><span class=lnt id=hl-8-537><a class=lnlinks href=#hl-8-537>537</a>
</span><span class=lnt id=hl-8-538><a class=lnlinks href=#hl-8-538>538</a>
</span><span class=lnt id=hl-8-539><a class=lnlinks href=#hl-8-539>539</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Redis</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;ioredis&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>EventEmitter</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>crypto</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;crypto&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 라이브락 방지 기능이 내장된 분산 락 시스템
</span></span></span><span class=line><span class=cl><span class=cm> * Redis를 백엔드로 사용하며 지능적 백오프와 우선순위 메커니즘 제공
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>SmartDistributedLock</span> <span class=kr>extends</span> <span class=nx>EventEmitter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>redisConfig</span> <span class=o>=</span> <span class=p>{},</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Redis 클라이언트 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>redis</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Redis</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>host</span><span class=o>:</span> <span class=nx>redisConfig</span><span class=p>.</span><span class=nx>host</span> <span class=o>||</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>port</span><span class=o>:</span> <span class=nx>redisConfig</span><span class=p>.</span><span class=nx>port</span> <span class=o>||</span> <span class=mi>6379</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>retryDelayOnFailover</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>maxRetriesPerRequest</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=err>…</span><span class=nx>redisConfig</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 시스템 옵션
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>defaultTTL</span><span class=o>:</span> <span class=mi>30000</span><span class=p>,</span>           <span class=c1>// 기본 락 TTL (30초)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>maxBackoffTime</span><span class=o>:</span> <span class=mi>5000</span><span class=p>,</span>        <span class=c1>// 최대 백오프 시간 (5초)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>initialBackoffTime</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span>     <span class=c1>// 초기 백오프 시간 (100ms)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>maxRetries</span><span class=o>:</span> <span class=mi>10</span><span class=p>,</span>              <span class=c1>// 최대 재시도 횟수
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>livelockThreshold</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span>        <span class=c1>// 라이브락 판단 임계값
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>priorityBase</span><span class=o>:</span> <span class=mi>1000</span><span class=p>,</span>          <span class=c1>// 우선순위 기준값
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>jitterFactor</span><span class=o>:</span> <span class=mf>0.1</span><span class=p>,</span>           <span class=c1>// 지터 계수 (10%)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>monitoringInterval</span><span class=o>:</span> <span class=mi>5000</span><span class=p>,</span>    <span class=c1>// 모니터링 주기 (5초)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=err>…</span><span class=nx>options</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 내부 상태 관리
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateInstanceId</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>lockAttempts</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>    <span class=c1>// 락별 시도 횟수
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>backoffHistory</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>  <span class=c1>// 백오프 히스토리
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>activeMonitoring</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span> <span class=c1>// 활성 모니터링 타이머
</span></span></span><span class=line><span class=cl><span class=c1></span>        
</span></span><span class=line><span class=cl>        <span class=c1>// 라이브락 탐지 메트릭
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>totalAttempts</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>successfulAcquisitions</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>livelockDetections</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>averageAcquisitionTime</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>lastReset</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>initializeMonitoring</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`SmartDistributedLock 초기화 완료 - Instance ID: </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 고유 인스턴스 ID 생성 (우선순위 계산용)
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>generateInstanceId</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>timestamp</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>36</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>random</span> <span class=o>=</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>randomBytes</span><span class=p>(</span><span class=mi>4</span><span class=p>).</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>hostname</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;os&#39;</span><span class=p>).</span><span class=nx>hostname</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`</span><span class=si>${</span><span class=nx>hostname</span><span class=si>}</span><span class=sb>-</span><span class=si>${</span><span class=nx>timestamp</span><span class=si>}</span><span class=sb>-</span><span class=si>${</span><span class=nx>random</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 라이브락 방지 분산 락 획득
</span></span></span><span class=line><span class=cl><span class=cm>     * @param {string} lockKey - 락 키
</span></span></span><span class=line><span class=cl><span class=cm>     * @param {number} ttl - TTL (밀리초)
</span></span></span><span class=line><span class=cl><span class=cm>     * @param {number} timeout - 타임아웃 (밀리초)
</span></span></span><span class=line><span class=cl><span class=cm>     * @returns {Promise&lt;{success: boolean, lockValue?: string, metadata?: Object}&gt;}
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>acquire</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>ttl</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>defaultTTL</span><span class=p>,</span> <span class=nx>timeout</span> <span class=o>=</span> <span class=mi>10000</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>startTime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>lockValue</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>generateLockValue</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>priority</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>calculatePriority</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>attempt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>totalBackoffTime</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 락 획득 시작: </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb> (우선순위: </span><span class=si>${</span><span class=nx>priority</span><span class=si>}</span><span class=sb>)`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 모니터링 시작
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>startLockMonitoring</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>startTime</span> <span class=o>&lt;</span> <span class=nx>timeout</span> <span class=o>&amp;&amp;</span> <span class=nx>attempt</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>maxRetries</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>attempt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>totalAttempts</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>recordAttempt</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Redis SETNX를 사용한 원자적 락 획득 시도
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=sb>`lock:</span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=nx>value</span><span class=o>:</span> <span class=nx>lockValue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>instanceId</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>priority</span><span class=o>:</span> <span class=nx>priority</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>acquiredAt</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=nx>ttl</span><span class=o>:</span> <span class=nx>ttl</span>
</span></span><span class=line><span class=cl>                    <span class=p>}),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;PX&#39;</span><span class=p>,</span> <span class=nx>ttl</span><span class=p>,</span>  <span class=c1>// TTL 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=s1>&#39;NX&#39;</span>        <span class=c1>// Only if Not eXists
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>result</span> <span class=o>===</span> <span class=s1>&#39;OK&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 락 획득 성공
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=kr>const</span> <span class=nx>acquisitionTime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>startTime</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>successfulAcquisitions</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>this</span><span class=p>.</span><span class=nx>updateAverageAcquisitionTime</span><span class=p>(</span><span class=nx>acquisitionTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 락 획득 성공: </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb> (시도: </span><span class=si>${</span><span class=nx>attempt</span><span class=si>}</span><span class=sb>, 시간: </span><span class=si>${</span><span class=nx>acquisitionTime</span><span class=si>}</span><span class=sb>ms)`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1>// 성공 시 모니터링 중지
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=k>this</span><span class=p>.</span><span class=nx>stopLockMonitoring</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>lockValue</span><span class=o>:</span> <span class=nx>lockValue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>metadata</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=nx>attempt</span><span class=o>:</span> <span class=nx>attempt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=nx>acquisitionTime</span><span class=o>:</span> <span class=nx>acquisitionTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=nx>totalBackoffTime</span><span class=o>:</span> <span class=nx>totalBackoffTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=nx>priority</span><span class=o>:</span> <span class=nx>priority</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>};</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// 락 획득 실패 - 백오프 계산
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kr>const</span> <span class=nx>backoffTime</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>calculateSmartBackoff</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>attempt</span><span class=p>,</span> <span class=nx>priority</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>totalBackoffTime</span> <span class=o>+=</span> <span class=nx>backoffTime</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 락 획득 실패 (시도 </span><span class=si>${</span><span class=nx>attempt</span><span class=si>}</span><span class=sb>): </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb>, 백오프: </span><span class=si>${</span><span class=nx>backoffTime</span><span class=si>}</span><span class=sb>ms`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// 라이브락 탐지
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>detectLivelock</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>attempt</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 라이브락 탐지됨: </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb> - 복구 시도 중`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleLivelockRecovery</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>attempt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// 백오프 실행
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sleep</span><span class=p>(</span><span class=nx>backoffTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 락 획득 오류: </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// 네트워크 오류 등의 경우 추가 백오프
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sleep</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>initialBackoffTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 타임아웃 또는 최대 재시도 초과
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 락 획득 실패 (타임아웃/최대재시도): </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>stopLockMonitoring</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>metadata</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>attempt</span><span class=o>:</span> <span class=nx>attempt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>totalTime</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>startTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>totalBackoffTime</span><span class=o>:</span> <span class=nx>totalBackoffTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>reason</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>startTime</span> <span class=o>&gt;=</span> <span class=nx>timeout</span> <span class=o>?</span> <span class=s1>&#39;timeout&#39;</span> <span class=o>:</span> <span class=s1>&#39;max_retries&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 분산 락 해제
</span></span></span><span class=line><span class=cl><span class=cm>     * @param {string} lockKey - 락 키
</span></span></span><span class=line><span class=cl><span class=cm>     * @param {string} lockValue - 락 값 (소유권 검증용)
</span></span></span><span class=line><span class=cl><span class=cm>     * @returns {Promise&lt;boolean&gt;}
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>release</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>lockValue</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Lua 스크립트를 사용한 원자적 락 해제
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>luaScript</span> <span class=o>=</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>                local lockKey = KEYS[1]
</span></span></span><span class=line><span class=cl><span class=sb>                local lockValue = ARGV[1]
</span></span></span><span class=line><span class=cl><span class=sb>                local instanceId = ARGV[2]
</span></span></span><span class=line><span class=cl><span class=sb>                
</span></span></span><span class=line><span class=cl><span class=sb>                local currentLock = redis.call(&#39;GET&#39;, lockKey)
</span></span></span><span class=line><span class=cl><span class=sb>                if currentLock then
</span></span></span><span class=line><span class=cl><span class=sb>                    local lockData = cjson.decode(currentLock)
</span></span></span><span class=line><span class=cl><span class=sb>                    if lockData.value == lockValue and lockData.instanceId == instanceId then
</span></span></span><span class=line><span class=cl><span class=sb>                        return redis.call(&#39;DEL&#39;, lockKey)
</span></span></span><span class=line><span class=cl><span class=sb>                    end
</span></span></span><span class=line><span class=cl><span class=sb>                end
</span></span></span><span class=line><span class=cl><span class=sb>                return 0
</span></span></span><span class=line><span class=cl><span class=sb>            `</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nb>eval</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nx>luaScript</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=mi>1</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=sb>`lock:</span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=nx>lockValue</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>released</span> <span class=o>=</span> <span class=nx>result</span> <span class=o>===</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>released</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 락 해제 성공: </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>clearAttemptHistory</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 락 해제 실패 (소유권 없음): </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>released</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 락 해제 오류: </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 우선순위 기반 스마트 백오프 계산
</span></span></span><span class=line><span class=cl><span class=cm>     * 라이브락 방지를 위한 지능적 대기 시간 계산
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>calculateSmartBackoff</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>attempt</span><span class=p>,</span> <span class=nx>priority</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 기본 지수적 백오프
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>let</span> <span class=nx>baseBackoff</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>initialBackoffTime</span> <span class=o>*</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=nx>attempt</span> <span class=o>-</span> <span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>maxBackoffTime</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 우선순위 기반 조정 (높은 우선순위 = 짧은 백오프)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>priorityFactor</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>+</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>priorityBase</span> <span class=o>-</span> <span class=nx>priority</span><span class=p>)</span> <span class=o>/</span> <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>priorityBase</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>baseBackoff</span> <span class=o>=</span> <span class=nx>baseBackoff</span> <span class=o>*</span> <span class=nx>priorityFactor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 랜덤 지터 추가 (라이브락 방지 핵심)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>jitter</span> <span class=o>=</span> <span class=nx>baseBackoff</span> <span class=o>*</span> <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>jitterFactor</span> <span class=o>*</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 현재 락 경합자 수에 따른 추가 조정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>contenders</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>estimateContenders</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>contentionFactor</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>+</span> <span class=p>(</span><span class=nx>contenders</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>);</span> <span class=c1>// 경합자 1명당 10% 증가
</span></span></span><span class=line><span class=cl><span class=c1></span>        
</span></span><span class=line><span class=cl>        <span class=c1>// 인스턴스 ID 기반 결정적 지연 (대칭성 제거)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>instanceHash</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>hashInstanceId</span><span class=p>()</span> <span class=o>%</span> <span class=mi>100</span><span class=p>;</span> <span class=c1>// 0-99
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>instanceDelay</span> <span class=o>=</span> <span class=nx>instanceHash</span> <span class=o>*</span> <span class=mi>10</span><span class=p>;</span> <span class=c1>// 0-990ms
</span></span></span><span class=line><span class=cl><span class=c1></span>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>finalBackoff</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nx>baseBackoff</span> <span class=o>+</span> <span class=nx>jitter</span><span class=p>)</span> <span class=o>*</span> <span class=nx>contentionFactor</span> <span class=o>+</span> <span class=nx>instanceDelay</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 백오프 히스토리 기록
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>recordBackoff</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>finalBackoff</span><span class=p>,</span> <span class=nx>attempt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>finalBackoff</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>maxBackoffTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 현재 경합자 수 추정
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>estimateContenders</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Redis에서 락 관련 메트릭 조회 (구현은 애플리케이션별로 다름)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>metricKey</span> <span class=o>=</span> <span class=sb>`lock:metrics:</span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>contenders</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>metricKey</span><span class=p>)</span> <span class=o>||</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>contenders</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=c1>// 기본값
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 라이브락 탐지 알고리즘
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>detectLivelock</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>currentAttempt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>attemptHistory</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lockAttempts</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 임계값 이상의 시도가 있는지 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>currentAttempt</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>livelockThreshold</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 백오프 패턴 분석
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>backoffHistory</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>backoffHistory</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>backoffHistory</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;=</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 동일한 백오프 패턴이 반복되는지 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>recentBackoffs</span> <span class=o>=</span> <span class=nx>backoffHistory</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=o>-</span><span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>avgBackoff</span> <span class=o>=</span> <span class=nx>recentBackoffs</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>sum</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>sum</span> <span class=o>+</span> <span class=nx>b</span><span class=p>.</span><span class=nx>time</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>/</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>variance</span> <span class=o>=</span> <span class=nx>recentBackoffs</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>sum</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>sum</span> <span class=o>+</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>pow</span><span class=p>(</span><span class=nx>b</span><span class=p>.</span><span class=nx>time</span> <span class=o>-</span> <span class=nx>avgBackoff</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=mi>0</span><span class=p>)</span> <span class=o>/</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 분산이 낮으면 (유사한 백오프 시간) 라이브락 의심
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=nx>variance</span> <span class=o>&lt;</span> <span class=nx>avgBackoff</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>livelockDetections</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 라이브락 복구 처리
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>handleLivelockRecovery</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>attempt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 라이브락 복구 시작: </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 전략 1: 백오프 시간 재조정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>emergencyBackoff</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>maxBackoffTime</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sleep</span><span class=p>(</span><span class=nx>emergencyBackoff</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 전략 2: 우선순위 재계산
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// (실제 구현에서는 글로벌 코디네이터 등을 활용)
</span></span></span><span class=line><span class=cl><span class=c1></span>        
</span></span><span class=line><span class=cl>        <span class=c1>// 전략 3: 알림 발송
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;livelockDetected&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>lockKey</span><span class=o>:</span> <span class=nx>lockKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>instanceId</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>attempt</span><span class=o>:</span> <span class=nx>attempt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>recoveryAction</span><span class=o>:</span> <span class=s1>&#39;emergency_backoff&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 라이브락 복구 완료: </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb> (긴급 백오프: </span><span class=si>${</span><span class=nx>emergencyBackoff</span><span class=si>}</span><span class=sb>ms)`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 유틸리티 메서드들
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>generateLockValue</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>randomBytes</span><span class=p>(</span><span class=mi>16</span><span class=p>).</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>calculatePriority</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 인스턴스 ID와 락 키를 기반으로 고유 우선순위 계산
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>hash</span> <span class=o>=</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>createHash</span><span class=p>(</span><span class=s1>&#39;md5&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span> <span class=o>+</span> <span class=nx>lockKey</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>digest</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>hash</span><span class=p>.</span><span class=nx>substring</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>8</span><span class=p>),</span> <span class=mi>16</span><span class=p>)</span> <span class=o>%</span> <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>priorityBase</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>hashInstanceId</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>createHash</span><span class=p>(</span><span class=s1>&#39;md5&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>readUInt32BE</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>recordAttempt</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>attempts</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lockAttempts</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=nx>attempts</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>lockAttempts</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>attempts</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=o>-</span><span class=mi>10</span><span class=p>));</span> <span class=c1>// 최근 10개만 보관
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>recordBackoff</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>backoffTime</span><span class=p>,</span> <span class=nx>attempt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>backoffs</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>backoffHistory</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=nx>backoffs</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> 
</span></span><span class=line><span class=cl>            <span class=nx>time</span><span class=o>:</span> <span class=nx>backoffTime</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nx>attempt</span><span class=o>:</span> <span class=nx>attempt</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>backoffHistory</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>backoffs</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=o>-</span><span class=mi>10</span><span class=p>));</span> <span class=c1>// 최근 10개만 보관
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>clearAttemptHistory</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>lockAttempts</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>backoffHistory</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>updateAverageAcquisitionTime</span><span class=p>(</span><span class=nx>acquisitionTime</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>alpha</span> <span class=o>=</span> <span class=mf>0.1</span><span class=p>;</span> <span class=c1>// 지수 이동 평균 계수
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>averageAcquisitionTime</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>averageAcquisitionTime</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=nx>alpha</span><span class=p>)</span> <span class=o>+</span> <span class=nx>acquisitionTime</span> <span class=o>*</span> <span class=nx>alpha</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>startLockMonitoring</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>activeMonitoring</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>))</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>monitoringTimer</span> <span class=o>=</span> <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>attempts</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lockAttempts</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span> <span class=o>||</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>attempts</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>livelockThreshold</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 모니터링 알림: </span><span class=si>${</span><span class=nx>lockKey</span><span class=si>}</span><span class=sb> - </span><span class=si>${</span><span class=nx>attempts</span><span class=si>}</span><span class=sb>회 시도`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;lockContentionWarning&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>lockKey</span><span class=o>:</span> <span class=nx>lockKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>instanceId</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>attempts</span><span class=o>:</span> <span class=nx>attempts</span>
</span></span><span class=line><span class=cl>                <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>monitoringInterval</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>activeMonitoring</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>monitoringTimer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>stopLockMonitoring</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>timer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>activeMonitoring</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>timer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>clearInterval</span><span class=p>(</span><span class=nx>timer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>activeMonitoring</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>initializeMonitoring</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 전체 시스템 메트릭 주기적 출력
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>uptime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>lastReset</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>successRate</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>totalAttempts</span> <span class=o>&gt;</span> <span class=mi>0</span> 
</span></span><span class=line><span class=cl>                <span class=o>?</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>successfulAcquisitions</span> <span class=o>/</span> <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>totalAttempts</span> <span class=o>*</span> <span class=mi>100</span><span class=p>).</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] 시스템 메트릭 (</span><span class=si>${</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>uptime</span><span class=o>/</span><span class=mi>1000</span><span class=p>)</span><span class=si>}</span><span class=sb>초):`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>총시도</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>totalAttempts</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>성공</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>successfulAcquisitions</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>성공률</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=nx>successRate</span><span class=si>}</span><span class=sb>%`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>평균획득시간</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>averageAcquisitionTime</span><span class=p>)</span><span class=si>}</span><span class=sb>ms`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>라이브락탐지</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>livelockDetections</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>30000</span><span class=p>);</span> <span class=c1>// 30초마다
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>sleep</span><span class=p>(</span><span class=nx>ms</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span> <span class=p>=&gt;</span> <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>ms</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 시스템 메트릭 조회
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>getMetrics</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=err>…</span><span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>uptime</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>lastReset</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>activeLocks</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>lockAttempts</span><span class=p>.</span><span class=nx>size</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>instanceId</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 리소스 정리
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>disconnect</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 모든 모니터링 타이머 정리
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>timer</span> <span class=k>of</span> <span class=k>this</span><span class=p>.</span><span class=nx>activeMonitoring</span><span class=p>.</span><span class=nx>values</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>clearInterval</span><span class=p>(</span><span class=nx>timer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>activeMonitoring</span><span class=p>.</span><span class=nx>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Redis 연결 종료
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>quit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>instanceId</span><span class=si>}</span><span class=sb>] SmartDistributedLock 종료 완료`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 라이브락 시나리오 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>simulateLivelockScenario</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;=== 분산 락 라이브락 방지 시뮬레이션 시작 ===\n&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 3개의 마이크로서비스 인스턴스 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>services</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;=</span> <span class=mi>3</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>service</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>SmartDistributedLock</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=nx>port</span><span class=o>:</span> <span class=mi>6379</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=nx>livelockThreshold</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>maxBackoffTime</span><span class=o>:</span> <span class=mi>2000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>monitoringInterval</span><span class=o>:</span> <span class=mi>3000</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 이벤트 리스너 등록
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>service</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;livelockDetected&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`🚨 라이브락 탐지 알림:`</span><span class=p>,</span> <span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>service</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;lockContentionWarning&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`⚠️  락 경합 경고:`</span><span class=p>,</span> <span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>services</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>service</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 동일한 자원에 대한 경합 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>lockKey</span> <span class=o>=</span> <span class=s1>&#39;shared_database_table&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>promises</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;모든 서비스가 동시에 같은 락 획득 시도를 시작합니다…\n&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>services</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>service</span> <span class=o>=</span> <span class=nx>services</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>promise</span> <span class=o>=</span> <span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>attempt</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>attempt</span> <span class=o>&lt;=</span> <span class=mi>3</span><span class=p>;</span> <span class=nx>attempt</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`서비스 </span><span class=si>${</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=sb> - 작업 </span><span class=si>${</span><span class=nx>attempt</span><span class=si>}</span><span class=sb> 시작`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>service</span><span class=p>.</span><span class=nx>acquire</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=mi>5000</span><span class=p>,</span> <span class=mi>8000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`✅ 서비스 </span><span class=si>${</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=sb> - 작업 </span><span class=si>${</span><span class=nx>attempt</span><span class=si>}</span><span class=sb> 성공 (</span><span class=si>${</span><span class=nx>result</span><span class=p>.</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>acquisitionTime</span><span class=si>}</span><span class=sb>ms)`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1>// 작업 시뮬레이션 (1-2초)
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=kr>await</span> <span class=nx>service</span><span class=p>.</span><span class=nx>sleep</span><span class=p>(</span><span class=mi>1000</span> <span class=o>+</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=kr>await</span> <span class=nx>service</span><span class=p>.</span><span class=nx>release</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>result</span><span class=p>.</span><span class=nx>lockValue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`📤 서비스 </span><span class=si>${</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=sb> - 작업 </span><span class=si>${</span><span class=nx>attempt</span><span class=si>}</span><span class=sb> 완료\n`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`❌ 서비스 </span><span class=si>${</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=sb> - 작업 </span><span class=si>${</span><span class=nx>attempt</span><span class=si>}</span><span class=sb> 실패: </span><span class=si>${</span><span class=nx>result</span><span class=p>.</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>reason</span><span class=si>}</span><span class=sb>\n`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// 작업 간 간격
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kr>await</span> <span class=nx>service</span><span class=p>.</span><span class=nx>sleep</span><span class=p>(</span><span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>})();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>promises</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>promise</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 모든 작업 완료 대기
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span><span class=nx>promises</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n=== 시뮬레이션 결과 ===&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 각 서비스의 메트릭 출력
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>services</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>metrics</span> <span class=o>=</span> <span class=nx>services</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>getMetrics</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`서비스 </span><span class=si>${</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=sb> 메트릭:`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>성공률</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=p>(</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>successfulAcquisitions</span> <span class=o>/</span> <span class=nx>metrics</span><span class=p>.</span><span class=nx>totalAttempts</span> <span class=o>*</span> <span class=mi>100</span><span class=p>).</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=si>}</span><span class=sb>%`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>평균획득시간</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>averageAcquisitionTime</span><span class=p>)</span><span class=si>}</span><span class=sb>ms`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>라이브락탐지</span><span class=o>:</span> <span class=nx>metrics</span><span class=p>.</span><span class=nx>livelockDetections</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>총시도</span><span class=o>:</span> <span class=nx>metrics</span><span class=p>.</span><span class=nx>totalAttempts</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 리소스 정리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\n시스템 종료 중…&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>service</span> <span class=k>of</span> <span class=nx>services</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>service</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;시뮬레이션 완료! 🎉&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 직접 실행 시 시뮬레이션 시작
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>require</span><span class=p>.</span><span class=nx>main</span> <span class=o>===</span> <span class=nx>module</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>simulateLivelockScenario</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>SmartDistributedLock</span><span class=p>,</span> <span class=nx>simulateLivelockScenario</span> <span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-분산-트랜잭션-라이브락>사례: 분산 트랜잭션 라이브락<a hidden class=anchor aria-hidden=true href=#사례-분산-트랜잭션-라이브락>#</a></h5><p><strong>시스템 구성</strong></p><ul><li>Microservices A/B/C, 각자 분산 락 획득 필요</li><li>락 풀: etcd 또는 ZooKeeper</li></ul><p><strong>Workflow</strong></p><ol><li>Microservice A, B, C 각각 분산 락 요청</li><li>모두 &rsquo; 양보 &rsquo; 및 빠른 재시도 (백오프 없이) 로 락이 끝없이 회전 (프로세스 모두 아무도 락 보유 못함)</li><li>진전 (RPC, 트랜잭션 커밋) 이 발생하지 않음 → 라이브락 상황</li><li>AI/관측성 모듈이 &lsquo;N 분간 트랜잭션 진척 없음 &rsquo; 감지</li><li>자동 롤백/서비스 재기동, 백오프 정책 동적 갱신</li></ol><p><strong>코드 의사 예시 (Python.gRPC + etcd 활용 간략화)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 잠정적 분산 락 시나리오</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>acquire_distributed_lock</span><span class=p>(</span><span class=n>etcd</span><span class=p>,</span> <span class=n>lock_key</span><span class=p>,</span> <span class=n>max_retries</span><span class=o>=</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>random</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_retries</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>success</span> <span class=o>=</span> <span class=n>etcd</span><span class=o>.</span><span class=n>try_acquire</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 실제 트랜잭션 진행</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=c1># 예: 라이브락 방지 위한 랜덤 백오프 도입</span>
</span></span><span class=line><span class=cl>        <span class=n>backoff</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>backoff</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-두-스레드가-try_lock-실패>사례: 두 스레드가 <code>try_lock()</code> 실패<a hidden class=anchor aria-hidden=true href=#사례-두-스레드가-try_lock-실패>#</a></h5><p><strong>시나리오</strong>: 두 스레드가 <code>try_lock()</code> 실패 후 즉시 해제하고 반복 재시도하여 livelock 상태 진입</p><p><strong>시스템 구성</strong>:</p><ul><li>Thread A, Thread B</li><li>공유 자원 접근 시도</li><li>실패 시 unlock 및 즉시 재시도</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>sequenceDiagram
    participant ThreadA
    participant ThreadB
    participant Resource

    ThreadA-&gt;&gt;Resource: tryLock() 실패
    ThreadB-&gt;&gt;Resource: tryLock() 실패
    ThreadA-&gt;&gt;ThreadB: 양보 후 재시도
    ThreadB-&gt;&gt;ThreadA: 양보 후 재시도
    loop 반복됨
        Note over ThreadA, ThreadB: 상태만 바꾸며 작업 불가
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>두 스레드가 동시에 자원 접근 시도</li><li>둘 다 실패 후 즉시 unlock</li><li>양보 후 재시도 → 계속 겹침 → livelock 발생</li></ol><p><strong>유무에 따른 차이점</strong>:</p><table><thead><tr><th>구분</th><th>Livelock 없음</th><th>Livelock 발생</th></tr></thead><tbody><tr><td>CPU 사용률</td><td>안정적</td><td>과도하게 상승</td></tr><tr><td>진행 상태</td><td>완료 가능</td><td>무한 루프 진입</td></tr><tr><td>로깅/모니터링</td><td>정상 로깅</td><td>반복 패턴 확인</td></tr></tbody></table><p><strong>구현 예시</strong> (Python - 시뮬레이션 기반):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>livelock_thread</span><span class=p>(</span><span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>acquired</span> <span class=o>=</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>blocking</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>acquired</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2> acquired the lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2> released the lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2> couldn&#39;t acquire lock, yielding…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># 여기서 지연 없이 반복하면 livelock 발생</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>thread1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>livelock_thread</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=s2>&#34;Thread-A&#34;</span><span class=p>,))</span>
</span></span><span class=line><span class=cl><span class=n>thread2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>livelock_thread</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=s2>&#34;Thread-B&#34;</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>thread1</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>thread2</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>thread1</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>thread2</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-두-개의-프로세스가-하나의-자원>사례: 두 개의 프로세스가 하나의 자원<a hidden class=anchor aria-hidden=true href=#사례-두-개의-프로세스가-하나의-자원>#</a></h5><p><strong>시나리오</strong>: 두 개의 프로세스가 하나의 자원에 대해 <strong>반복적으로 접근 시도</strong>, <strong>상호 반응</strong>하며 리벨록 발생.</p><p><strong>시스템 구성</strong>:</p><ul><li>Process A, Process B</li><li>Shared Resource (file, database, network port 등)</li><li>Lock (Mutex, Semaphore 등)</li><li>Backoff/Timeout 메커니즘</li></ul><p><strong>Workflow</strong>:</p><ol><li>Process A 가 Lock 획득 시도 → 실패 → 일정 시간 대기 (Backoff) → 재시도</li><li>Process B 도 동일하게 Lock 획득 시도 → 실패 → Backoff → 재시도</li><li><strong>A, B 의 Backoff/재시도 타이밍이 맞아, 서로 자원을 내주고 새 자원을 요청하는 무한 반복</strong></li></ol><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 시스템은 계속 동작하지만, 실제 작업은 전혀 진전 X, 자원만 낭비</li><li><strong>도입 후</strong>: Backoff/Timeout/락 정책 적용 시, 일정 시간 내 자원 독점/포기로 Deadlock/Livelock 방지</li></ul><p><strong>구현 예시 (Python)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>threading</span> <span class=kn>import</span> <span class=n>Thread</span><span class=p>,</span> <span class=n>Lock</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>resource</span> <span class=o>=</span> <span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=n>task_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>backoff_time</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>max_attempt</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_attempt</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>success</span> <span class=o>=</span> <span class=n>resource</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 2초 동안 락 획득 시도</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>task_name</span><span class=si>}</span><span class=s2> lock acquired, working…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>resource</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>task_name</span><span class=si>}</span><span class=s2> lock failed, backing off…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>backoff_time</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>            <span class=n>backoff_time</span> <span class=o>+=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>task_name</span><span class=si>}</span><span class=s2> lock failed after </span><span class=si>{</span><span class=n>max_attempt</span><span class=si>}</span><span class=s2> attempts!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 두 스레드 (프로세스) 실행</span>
</span></span><span class=line><span class=cl><span class=n>thread_a</span> <span class=o>=</span> <span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>process</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=s2>&#34;Process A&#34;</span><span class=p>,))</span>
</span></span><span class=line><span class=cl><span class=n>thread_b</span> <span class=o>=</span> <span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>process</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=s2>&#34;Process B&#34;</span><span class=p>,))</span>
</span></span><span class=line><span class=cl><span class=n>thread_a</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>thread_b</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>thread_a</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>thread_b</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>락 획득 실패 시 <strong>랜덤 백오프</strong>와 <strong>타임아웃</strong>을 통해 무한 반응 (리벨록) 방지</li></ul><h5 id=사례-온라인-쇼핑몰의-재고-관리-시스템>사례: 온라인 쇼핑몰의 재고 관리 시스템<a hidden class=anchor aria-hidden=true href=#사례-온라인-쇼핑몰의-재고-관리-시스템>#</a></h5><p><strong>시나리오</strong>: 온라인 쇼핑몰의 재고 관리 시스템에서 동시 구매 시 재고 차감 처리</p><p><strong>시스템 구성</strong>:</p><ul><li>재고 관리 서비스 (Inventory Service)</li><li>주문 처리 서비스 (Order Service)</li><li>Redis 분산 락 (Distributed Lock)</li><li>백오프 재시도 메커니즘 (Backoff Retry Mechanism)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[사용자 주문 요청] --&gt; B[Order Service]
    B --&gt; C[Inventory Service]
    C --&gt; D[Redis 분산 락]
    C --&gt; E[재고 DB]
    
    F[백오프 관리자] --&gt; B
    G[라이브락 모니터] --&gt; C
    H[Circuit Breaker] --&gt; B
    
    subgraph &#34;라이브락 방지 시스템&#34;
        F
        G  
        H
    end
    
    style D fill:#ffcdd2
    style F fill:#c8e6c9
    style G fill:#fff3e0
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 상품 주문 요청</li><li>Order Service 가 Inventory Service 호출</li><li>Inventory Service 가 Redis 분산 락 획득 시도</li><li>락 획득 실패 시 백오프 전략으로 재시도</li><li>재시도 패턴 모니터링으로 라이브락 감지</li><li>임계점 도달 시 Circuit Breaker 동작</li></ol><p><strong>핵심 역할</strong>:</p><ul><li><strong>백오프 메커니즘</strong>: 동기화된 재시도 방지 및 시스템 안정성 확보</li><li><strong>분산 락</strong>: 동시 재고 접근 제어 및 데이터 일관성 보장</li><li><strong>라이브락 모니터</strong>: 실시간 패턴 감지 및 조기 경보</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><p><strong>도입 전</strong>:</p><ul><li>동시 주문 시 재고 처리 실패율 35%</li><li>평균 응답 시간 8 초, 시스템 CPU 사용률 90%</li><li>고객 불만 및 주문 취소율 증가</li></ul></li><li><p><strong>도입 후</strong>:</p><ul><li>재고 처리 실패율 3% 이하로 감소</li><li>평균 응답 시간 1.5 초, CPU 사용률 65%</li><li>고객 만족도 향상 및 매출 15% 증가</li></ul></li></ul><p><strong>구현 예시 (Python)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>  1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>  2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>  3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4>  4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5>  5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6>  6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7>  7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8>  8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9>  9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10> 10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11> 11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12> 12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13> 13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14> 14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15> 15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16> 16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17> 17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18> 18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19> 19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20> 20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21> 21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22> 22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23> 23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24> 24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25> 25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26> 26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27> 27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28> 28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29> 29</a>
</span><span class=lnt id=hl-14-30><a class=lnlinks href=#hl-14-30> 30</a>
</span><span class=lnt id=hl-14-31><a class=lnlinks href=#hl-14-31> 31</a>
</span><span class=lnt id=hl-14-32><a class=lnlinks href=#hl-14-32> 32</a>
</span><span class=lnt id=hl-14-33><a class=lnlinks href=#hl-14-33> 33</a>
</span><span class=lnt id=hl-14-34><a class=lnlinks href=#hl-14-34> 34</a>
</span><span class=lnt id=hl-14-35><a class=lnlinks href=#hl-14-35> 35</a>
</span><span class=lnt id=hl-14-36><a class=lnlinks href=#hl-14-36> 36</a>
</span><span class=lnt id=hl-14-37><a class=lnlinks href=#hl-14-37> 37</a>
</span><span class=lnt id=hl-14-38><a class=lnlinks href=#hl-14-38> 38</a>
</span><span class=lnt id=hl-14-39><a class=lnlinks href=#hl-14-39> 39</a>
</span><span class=lnt id=hl-14-40><a class=lnlinks href=#hl-14-40> 40</a>
</span><span class=lnt id=hl-14-41><a class=lnlinks href=#hl-14-41> 41</a>
</span><span class=lnt id=hl-14-42><a class=lnlinks href=#hl-14-42> 42</a>
</span><span class=lnt id=hl-14-43><a class=lnlinks href=#hl-14-43> 43</a>
</span><span class=lnt id=hl-14-44><a class=lnlinks href=#hl-14-44> 44</a>
</span><span class=lnt id=hl-14-45><a class=lnlinks href=#hl-14-45> 45</a>
</span><span class=lnt id=hl-14-46><a class=lnlinks href=#hl-14-46> 46</a>
</span><span class=lnt id=hl-14-47><a class=lnlinks href=#hl-14-47> 47</a>
</span><span class=lnt id=hl-14-48><a class=lnlinks href=#hl-14-48> 48</a>
</span><span class=lnt id=hl-14-49><a class=lnlinks href=#hl-14-49> 49</a>
</span><span class=lnt id=hl-14-50><a class=lnlinks href=#hl-14-50> 50</a>
</span><span class=lnt id=hl-14-51><a class=lnlinks href=#hl-14-51> 51</a>
</span><span class=lnt id=hl-14-52><a class=lnlinks href=#hl-14-52> 52</a>
</span><span class=lnt id=hl-14-53><a class=lnlinks href=#hl-14-53> 53</a>
</span><span class=lnt id=hl-14-54><a class=lnlinks href=#hl-14-54> 54</a>
</span><span class=lnt id=hl-14-55><a class=lnlinks href=#hl-14-55> 55</a>
</span><span class=lnt id=hl-14-56><a class=lnlinks href=#hl-14-56> 56</a>
</span><span class=lnt id=hl-14-57><a class=lnlinks href=#hl-14-57> 57</a>
</span><span class=lnt id=hl-14-58><a class=lnlinks href=#hl-14-58> 58</a>
</span><span class=lnt id=hl-14-59><a class=lnlinks href=#hl-14-59> 59</a>
</span><span class=lnt id=hl-14-60><a class=lnlinks href=#hl-14-60> 60</a>
</span><span class=lnt id=hl-14-61><a class=lnlinks href=#hl-14-61> 61</a>
</span><span class=lnt id=hl-14-62><a class=lnlinks href=#hl-14-62> 62</a>
</span><span class=lnt id=hl-14-63><a class=lnlinks href=#hl-14-63> 63</a>
</span><span class=lnt id=hl-14-64><a class=lnlinks href=#hl-14-64> 64</a>
</span><span class=lnt id=hl-14-65><a class=lnlinks href=#hl-14-65> 65</a>
</span><span class=lnt id=hl-14-66><a class=lnlinks href=#hl-14-66> 66</a>
</span><span class=lnt id=hl-14-67><a class=lnlinks href=#hl-14-67> 67</a>
</span><span class=lnt id=hl-14-68><a class=lnlinks href=#hl-14-68> 68</a>
</span><span class=lnt id=hl-14-69><a class=lnlinks href=#hl-14-69> 69</a>
</span><span class=lnt id=hl-14-70><a class=lnlinks href=#hl-14-70> 70</a>
</span><span class=lnt id=hl-14-71><a class=lnlinks href=#hl-14-71> 71</a>
</span><span class=lnt id=hl-14-72><a class=lnlinks href=#hl-14-72> 72</a>
</span><span class=lnt id=hl-14-73><a class=lnlinks href=#hl-14-73> 73</a>
</span><span class=lnt id=hl-14-74><a class=lnlinks href=#hl-14-74> 74</a>
</span><span class=lnt id=hl-14-75><a class=lnlinks href=#hl-14-75> 75</a>
</span><span class=lnt id=hl-14-76><a class=lnlinks href=#hl-14-76> 76</a>
</span><span class=lnt id=hl-14-77><a class=lnlinks href=#hl-14-77> 77</a>
</span><span class=lnt id=hl-14-78><a class=lnlinks href=#hl-14-78> 78</a>
</span><span class=lnt id=hl-14-79><a class=lnlinks href=#hl-14-79> 79</a>
</span><span class=lnt id=hl-14-80><a class=lnlinks href=#hl-14-80> 80</a>
</span><span class=lnt id=hl-14-81><a class=lnlinks href=#hl-14-81> 81</a>
</span><span class=lnt id=hl-14-82><a class=lnlinks href=#hl-14-82> 82</a>
</span><span class=lnt id=hl-14-83><a class=lnlinks href=#hl-14-83> 83</a>
</span><span class=lnt id=hl-14-84><a class=lnlinks href=#hl-14-84> 84</a>
</span><span class=lnt id=hl-14-85><a class=lnlinks href=#hl-14-85> 85</a>
</span><span class=lnt id=hl-14-86><a class=lnlinks href=#hl-14-86> 86</a>
</span><span class=lnt id=hl-14-87><a class=lnlinks href=#hl-14-87> 87</a>
</span><span class=lnt id=hl-14-88><a class=lnlinks href=#hl-14-88> 88</a>
</span><span class=lnt id=hl-14-89><a class=lnlinks href=#hl-14-89> 89</a>
</span><span class=lnt id=hl-14-90><a class=lnlinks href=#hl-14-90> 90</a>
</span><span class=lnt id=hl-14-91><a class=lnlinks href=#hl-14-91> 91</a>
</span><span class=lnt id=hl-14-92><a class=lnlinks href=#hl-14-92> 92</a>
</span><span class=lnt id=hl-14-93><a class=lnlinks href=#hl-14-93> 93</a>
</span><span class=lnt id=hl-14-94><a class=lnlinks href=#hl-14-94> 94</a>
</span><span class=lnt id=hl-14-95><a class=lnlinks href=#hl-14-95> 95</a>
</span><span class=lnt id=hl-14-96><a class=lnlinks href=#hl-14-96> 96</a>
</span><span class=lnt id=hl-14-97><a class=lnlinks href=#hl-14-97> 97</a>
</span><span class=lnt id=hl-14-98><a class=lnlinks href=#hl-14-98> 98</a>
</span><span class=lnt id=hl-14-99><a class=lnlinks href=#hl-14-99> 99</a>
</span><span class=lnt id=hl-14-100><a class=lnlinks href=#hl-14-100>100</a>
</span><span class=lnt id=hl-14-101><a class=lnlinks href=#hl-14-101>101</a>
</span><span class=lnt id=hl-14-102><a class=lnlinks href=#hl-14-102>102</a>
</span><span class=lnt id=hl-14-103><a class=lnlinks href=#hl-14-103>103</a>
</span><span class=lnt id=hl-14-104><a class=lnlinks href=#hl-14-104>104</a>
</span><span class=lnt id=hl-14-105><a class=lnlinks href=#hl-14-105>105</a>
</span><span class=lnt id=hl-14-106><a class=lnlinks href=#hl-14-106>106</a>
</span><span class=lnt id=hl-14-107><a class=lnlinks href=#hl-14-107>107</a>
</span><span class=lnt id=hl-14-108><a class=lnlinks href=#hl-14-108>108</a>
</span><span class=lnt id=hl-14-109><a class=lnlinks href=#hl-14-109>109</a>
</span><span class=lnt id=hl-14-110><a class=lnlinks href=#hl-14-110>110</a>
</span><span class=lnt id=hl-14-111><a class=lnlinks href=#hl-14-111>111</a>
</span><span class=lnt id=hl-14-112><a class=lnlinks href=#hl-14-112>112</a>
</span><span class=lnt id=hl-14-113><a class=lnlinks href=#hl-14-113>113</a>
</span><span class=lnt id=hl-14-114><a class=lnlinks href=#hl-14-114>114</a>
</span><span class=lnt id=hl-14-115><a class=lnlinks href=#hl-14-115>115</a>
</span><span class=lnt id=hl-14-116><a class=lnlinks href=#hl-14-116>116</a>
</span><span class=lnt id=hl-14-117><a class=lnlinks href=#hl-14-117>117</a>
</span><span class=lnt id=hl-14-118><a class=lnlinks href=#hl-14-118>118</a>
</span><span class=lnt id=hl-14-119><a class=lnlinks href=#hl-14-119>119</a>
</span><span class=lnt id=hl-14-120><a class=lnlinks href=#hl-14-120>120</a>
</span><span class=lnt id=hl-14-121><a class=lnlinks href=#hl-14-121>121</a>
</span><span class=lnt id=hl-14-122><a class=lnlinks href=#hl-14-122>122</a>
</span><span class=lnt id=hl-14-123><a class=lnlinks href=#hl-14-123>123</a>
</span><span class=lnt id=hl-14-124><a class=lnlinks href=#hl-14-124>124</a>
</span><span class=lnt id=hl-14-125><a class=lnlinks href=#hl-14-125>125</a>
</span><span class=lnt id=hl-14-126><a class=lnlinks href=#hl-14-126>126</a>
</span><span class=lnt id=hl-14-127><a class=lnlinks href=#hl-14-127>127</a>
</span><span class=lnt id=hl-14-128><a class=lnlinks href=#hl-14-128>128</a>
</span><span class=lnt id=hl-14-129><a class=lnlinks href=#hl-14-129>129</a>
</span><span class=lnt id=hl-14-130><a class=lnlinks href=#hl-14-130>130</a>
</span><span class=lnt id=hl-14-131><a class=lnlinks href=#hl-14-131>131</a>
</span><span class=lnt id=hl-14-132><a class=lnlinks href=#hl-14-132>132</a>
</span><span class=lnt id=hl-14-133><a class=lnlinks href=#hl-14-133>133</a>
</span><span class=lnt id=hl-14-134><a class=lnlinks href=#hl-14-134>134</a>
</span><span class=lnt id=hl-14-135><a class=lnlinks href=#hl-14-135>135</a>
</span><span class=lnt id=hl-14-136><a class=lnlinks href=#hl-14-136>136</a>
</span><span class=lnt id=hl-14-137><a class=lnlinks href=#hl-14-137>137</a>
</span><span class=lnt id=hl-14-138><a class=lnlinks href=#hl-14-138>138</a>
</span><span class=lnt id=hl-14-139><a class=lnlinks href=#hl-14-139>139</a>
</span><span class=lnt id=hl-14-140><a class=lnlinks href=#hl-14-140>140</a>
</span><span class=lnt id=hl-14-141><a class=lnlinks href=#hl-14-141>141</a>
</span><span class=lnt id=hl-14-142><a class=lnlinks href=#hl-14-142>142</a>
</span><span class=lnt id=hl-14-143><a class=lnlinks href=#hl-14-143>143</a>
</span><span class=lnt id=hl-14-144><a class=lnlinks href=#hl-14-144>144</a>
</span><span class=lnt id=hl-14-145><a class=lnlinks href=#hl-14-145>145</a>
</span><span class=lnt id=hl-14-146><a class=lnlinks href=#hl-14-146>146</a>
</span><span class=lnt id=hl-14-147><a class=lnlinks href=#hl-14-147>147</a>
</span><span class=lnt id=hl-14-148><a class=lnlinks href=#hl-14-148>148</a>
</span><span class=lnt id=hl-14-149><a class=lnlinks href=#hl-14-149>149</a>
</span><span class=lnt id=hl-14-150><a class=lnlinks href=#hl-14-150>150</a>
</span><span class=lnt id=hl-14-151><a class=lnlinks href=#hl-14-151>151</a>
</span><span class=lnt id=hl-14-152><a class=lnlinks href=#hl-14-152>152</a>
</span><span class=lnt id=hl-14-153><a class=lnlinks href=#hl-14-153>153</a>
</span><span class=lnt id=hl-14-154><a class=lnlinks href=#hl-14-154>154</a>
</span><span class=lnt id=hl-14-155><a class=lnlinks href=#hl-14-155>155</a>
</span><span class=lnt id=hl-14-156><a class=lnlinks href=#hl-14-156>156</a>
</span><span class=lnt id=hl-14-157><a class=lnlinks href=#hl-14-157>157</a>
</span><span class=lnt id=hl-14-158><a class=lnlinks href=#hl-14-158>158</a>
</span><span class=lnt id=hl-14-159><a class=lnlinks href=#hl-14-159>159</a>
</span><span class=lnt id=hl-14-160><a class=lnlinks href=#hl-14-160>160</a>
</span><span class=lnt id=hl-14-161><a class=lnlinks href=#hl-14-161>161</a>
</span><span class=lnt id=hl-14-162><a class=lnlinks href=#hl-14-162>162</a>
</span><span class=lnt id=hl-14-163><a class=lnlinks href=#hl-14-163>163</a>
</span><span class=lnt id=hl-14-164><a class=lnlinks href=#hl-14-164>164</a>
</span><span class=lnt id=hl-14-165><a class=lnlinks href=#hl-14-165>165</a>
</span><span class=lnt id=hl-14-166><a class=lnlinks href=#hl-14-166>166</a>
</span><span class=lnt id=hl-14-167><a class=lnlinks href=#hl-14-167>167</a>
</span><span class=lnt id=hl-14-168><a class=lnlinks href=#hl-14-168>168</a>
</span><span class=lnt id=hl-14-169><a class=lnlinks href=#hl-14-169>169</a>
</span><span class=lnt id=hl-14-170><a class=lnlinks href=#hl-14-170>170</a>
</span><span class=lnt id=hl-14-171><a class=lnlinks href=#hl-14-171>171</a>
</span><span class=lnt id=hl-14-172><a class=lnlinks href=#hl-14-172>172</a>
</span><span class=lnt id=hl-14-173><a class=lnlinks href=#hl-14-173>173</a>
</span><span class=lnt id=hl-14-174><a class=lnlinks href=#hl-14-174>174</a>
</span><span class=lnt id=hl-14-175><a class=lnlinks href=#hl-14-175>175</a>
</span><span class=lnt id=hl-14-176><a class=lnlinks href=#hl-14-176>176</a>
</span><span class=lnt id=hl-14-177><a class=lnlinks href=#hl-14-177>177</a>
</span><span class=lnt id=hl-14-178><a class=lnlinks href=#hl-14-178>178</a>
</span><span class=lnt id=hl-14-179><a class=lnlinks href=#hl-14-179>179</a>
</span><span class=lnt id=hl-14-180><a class=lnlinks href=#hl-14-180>180</a>
</span><span class=lnt id=hl-14-181><a class=lnlinks href=#hl-14-181>181</a>
</span><span class=lnt id=hl-14-182><a class=lnlinks href=#hl-14-182>182</a>
</span><span class=lnt id=hl-14-183><a class=lnlinks href=#hl-14-183>183</a>
</span><span class=lnt id=hl-14-184><a class=lnlinks href=#hl-14-184>184</a>
</span><span class=lnt id=hl-14-185><a class=lnlinks href=#hl-14-185>185</a>
</span><span class=lnt id=hl-14-186><a class=lnlinks href=#hl-14-186>186</a>
</span><span class=lnt id=hl-14-187><a class=lnlinks href=#hl-14-187>187</a>
</span><span class=lnt id=hl-14-188><a class=lnlinks href=#hl-14-188>188</a>
</span><span class=lnt id=hl-14-189><a class=lnlinks href=#hl-14-189>189</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis.asyncio</span> <span class=k>as</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BackoffStrategy</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;백오프 전략 열거형&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>EXPONENTIAL</span> <span class=o>=</span> <span class=s2>&#34;exponential&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>LINEAR</span> <span class=o>=</span> <span class=s2>&#34;linear&#34;</span>  
</span></span><span class=line><span class=cl>    <span class=n>FIXED</span> <span class=o>=</span> <span class=s2>&#34;fixed&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RetryConfig</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;재시도 설정 데이터 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>max_attempts</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=n>base_delay</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.1</span>  <span class=c1># 기본 지연 시간 (초)</span>
</span></span><span class=line><span class=cl>    <span class=n>max_delay</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>5.0</span>   <span class=c1># 최대 지연 시간 (초) </span>
</span></span><span class=line><span class=cl>    <span class=n>jitter_factor</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.1</span>  <span class=c1># 지터 팩터</span>
</span></span><span class=line><span class=cl>    <span class=n>strategy</span><span class=p>:</span> <span class=n>BackoffStrategy</span> <span class=o>=</span> <span class=n>BackoffStrategy</span><span class=o>.</span><span class=n>EXPONENTIAL</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>InventoryService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;재고 관리 서비스 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>:</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>retry_stats</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 재시도 통계</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>decrease_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                               <span class=n>retry_config</span><span class=p>:</span> <span class=n>RetryConfig</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 차감 with 라이브락 방지 백오프&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>retry_config</span><span class=o>.</span><span class=n>max_attempts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 분산 락 획득 시도</span>
</span></span><span class=line><span class=cl>                <span class=n>lock_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;inventory_lock:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=n>lock_acquired</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_acquire_lock</span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span> <span class=n>ttl</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>lock_acquired</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 재고 확인 및 차감</span>
</span></span><span class=line><span class=cl>                    <span class=n>current_stock</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_current_stock</span><span class=p>(</span><span class=n>product_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>current_stock</span> <span class=o>&gt;=</span> <span class=n>quantity</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_update_stock</span><span class=p>(</span><span class=n>product_id</span><span class=p>,</span> <span class=n>current_stock</span> <span class=o>-</span> <span class=n>quantity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_release_lock</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=c1># 성공 통계 업데이트</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>_update_success_stats</span><span class=p>(</span><span class=n>product_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_release_lock</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=kc>False</span>  <span class=c1># 재고 부족</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                <span class=c1># 락 획득 실패 시 백오프 적용</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>attempt</span> <span class=o>&lt;</span> <span class=n>retry_config</span><span class=o>.</span><span class=n>max_attempts</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>delay</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calculate_backoff_delay</span><span class=p>(</span><span class=n>attempt</span><span class=p>,</span> <span class=n>retry_config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_update_retry_stats</span><span class=p>(</span><span class=n>product_id</span><span class=p>,</span> <span class=n>attempt</span><span class=p>,</span> <span class=n>delay</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재시도 </span><span class=si>{</span><span class=n>attempt</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>retry_config</span><span class=o>.</span><span class=n>max_attempts</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                          <span class=sa>f</span><span class=s2>&#34;대기 시간: </span><span class=si>{</span><span class=n>delay</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>초&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>delay</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 처리 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>attempt</span> <span class=o>&lt;</span> <span class=n>retry_config</span><span class=o>.</span><span class=n>max_attempts</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>delay</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calculate_backoff_delay</span><span class=p>(</span><span class=n>attempt</span><span class=p>,</span> <span class=n>retry_config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>delay</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>        <span class=c1># 모든 재시도 실패</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_update_failure_stats</span><span class=p>(</span><span class=n>product_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_calculate_backoff_delay</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attempt</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>RetryConfig</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;백오프 지연 시간 계산&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>config</span><span class=o>.</span><span class=n>strategy</span> <span class=o>==</span> <span class=n>BackoffStrategy</span><span class=o>.</span><span class=n>EXPONENTIAL</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 지수 백오프: delay = base_delay * (2 ^ attempt)</span>
</span></span><span class=line><span class=cl>            <span class=n>delay</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>base_delay</span> <span class=o>*</span> <span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>attempt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>config</span><span class=o>.</span><span class=n>strategy</span> <span class=o>==</span> <span class=n>BackoffStrategy</span><span class=o>.</span><span class=n>LINEAR</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 선형 백오프: delay = base_delay * (attempt + 1)</span>
</span></span><span class=line><span class=cl>            <span class=n>delay</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>base_delay</span> <span class=o>*</span> <span class=p>(</span><span class=n>attempt</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 고정 백오프: delay = base_delay</span>
</span></span><span class=line><span class=cl>            <span class=n>delay</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>base_delay</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=c1># 최대 지연 시간 제한</span>
</span></span><span class=line><span class=cl>        <span class=n>delay</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>delay</span><span class=p>,</span> <span class=n>config</span><span class=o>.</span><span class=n>max_delay</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 지터 적용 (라이브락 방지 핵심)</span>
</span></span><span class=line><span class=cl>        <span class=n>jitter</span> <span class=o>=</span> <span class=n>delay</span> <span class=o>*</span> <span class=n>config</span><span class=o>.</span><span class=n>jitter_factor</span> <span class=o>*</span> <span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>delay</span> <span class=o>+</span> <span class=n>jitter</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_acquire_lock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lock_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>ttl</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Redis 분산 락 획득&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>lock_key</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;locked&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># 키가 없을 때만 설정</span>
</span></span><span class=line><span class=cl>            <span class=n>ex</span><span class=o>=</span><span class=n>ttl</span>    <span class=c1># TTL 설정</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span> <span class=ow>is</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_release_lock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lock_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Redis 분산 락 해제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_get_current_stock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;현재 재고 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>stock</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;stock:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>stock</span><span class=p>)</span> <span class=k>if</span> <span class=n>stock</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_update_stock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>new_stock</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;stock:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>new_stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_update_retry_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>attempt</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>delay</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재시도 통계 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>product_id</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_stats</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>retry_stats</span><span class=p>[</span><span class=n>product_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;total_retries&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;total_delay&#39;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;last_attempt_time&#39;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>stats</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_stats</span><span class=p>[</span><span class=n>product_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>stats</span><span class=p>[</span><span class=s1>&#39;total_retries&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>stats</span><span class=p>[</span><span class=s1>&#39;total_delay&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=n>delay</span>
</span></span><span class=line><span class=cl>        <span class=n>stats</span><span class=p>[</span><span class=s1>&#39;last_attempt_time&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_update_success_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;성공 통계 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>product_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_stats</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_stats</span><span class=p>[</span><span class=n>product_id</span><span class=p>]</span>  <span class=c1># 성공 시 통계 초기화</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_update_failure_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;실패 통계 업데이트&#34;&#34;&#34;</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>product_id</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_stats</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>stats</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_stats</span><span class=p>[</span><span class=n>product_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;상품 </span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2> 처리 최종 실패 - &#34;</span>
</span></span><span class=line><span class=cl>                  <span class=sa>f</span><span class=s2>&#34;총 재시도: </span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;total_retries&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                  <span class=sa>f</span><span class=s2>&#34;총 대기시간: </span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;total_delay&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>초&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;라이브락 방지 재고 관리 시스템 테스트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Redis 클라이언트 초기화</span>
</span></span><span class=line><span class=cl>    <span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 재고 서비스 초기화</span>
</span></span><span class=line><span class=cl>    <span class=n>inventory_service</span> <span class=o>=</span> <span class=n>InventoryService</span><span class=p>(</span><span class=n>redis_client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 초기 재고 설정</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;stock:product_001&#34;</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 백오프 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>retry_config</span> <span class=o>=</span> <span class=n>RetryConfig</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>max_attempts</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>base_delay</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>max_delay</span><span class=o>=</span><span class=mf>2.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>jitter_factor</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span>  <span class=c1># 20% 지터로 라이브락 방지</span>
</span></span><span class=line><span class=cl>        <span class=n>strategy</span><span class=o>=</span><span class=n>BackoffStrategy</span><span class=o>.</span><span class=n>EXPONENTIAL</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 동시 재고 차감 시뮬레이션 (라이브락 발생 가능 상황)</span>
</span></span><span class=line><span class=cl>    <span class=n>tasks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>task</span> <span class=o>=</span> <span class=n>inventory_service</span><span class=o>.</span><span class=n>decrease_inventory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;product_001&#34;</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=n>retry_config</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>tasks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>task</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># 동시 실행</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 결과 출력</span>
</span></span><span class=line><span class=cl>    <span class=n>success_count</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;총 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>tasks</span><span class=p>)</span><span class=si>}</span><span class=s2>개 요청 중 </span><span class=si>{</span><span class=n>success_count</span><span class=si>}</span><span class=s2>개 성공&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 최종 재고 확인</span>
</span></span><span class=line><span class=cl>    <span class=n>final_stock</span> <span class=o>=</span> <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;stock:product_001&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;최종 재고: </span><span class=si>{</span><span class=n>final_stock</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>JavaScript 구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>  1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>  2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>  3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>  4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>  5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>  6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>  7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8>  8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9>  9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10> 10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11> 11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12> 12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13> 13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14> 14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15> 15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16> 16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17> 17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18> 18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19> 19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20> 20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21> 21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22> 22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23> 23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24> 24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25> 25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26> 26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27> 27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28> 28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29> 29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30> 30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31> 31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32> 32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33> 33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34> 34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35> 35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36> 36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37> 37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38> 38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39> 39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40> 40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41> 41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42> 42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43> 43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44> 44</a>
</span><span class=lnt id=hl-15-45><a class=lnlinks href=#hl-15-45> 45</a>
</span><span class=lnt id=hl-15-46><a class=lnlinks href=#hl-15-46> 46</a>
</span><span class=lnt id=hl-15-47><a class=lnlinks href=#hl-15-47> 47</a>
</span><span class=lnt id=hl-15-48><a class=lnlinks href=#hl-15-48> 48</a>
</span><span class=lnt id=hl-15-49><a class=lnlinks href=#hl-15-49> 49</a>
</span><span class=lnt id=hl-15-50><a class=lnlinks href=#hl-15-50> 50</a>
</span><span class=lnt id=hl-15-51><a class=lnlinks href=#hl-15-51> 51</a>
</span><span class=lnt id=hl-15-52><a class=lnlinks href=#hl-15-52> 52</a>
</span><span class=lnt id=hl-15-53><a class=lnlinks href=#hl-15-53> 53</a>
</span><span class=lnt id=hl-15-54><a class=lnlinks href=#hl-15-54> 54</a>
</span><span class=lnt id=hl-15-55><a class=lnlinks href=#hl-15-55> 55</a>
</span><span class=lnt id=hl-15-56><a class=lnlinks href=#hl-15-56> 56</a>
</span><span class=lnt id=hl-15-57><a class=lnlinks href=#hl-15-57> 57</a>
</span><span class=lnt id=hl-15-58><a class=lnlinks href=#hl-15-58> 58</a>
</span><span class=lnt id=hl-15-59><a class=lnlinks href=#hl-15-59> 59</a>
</span><span class=lnt id=hl-15-60><a class=lnlinks href=#hl-15-60> 60</a>
</span><span class=lnt id=hl-15-61><a class=lnlinks href=#hl-15-61> 61</a>
</span><span class=lnt id=hl-15-62><a class=lnlinks href=#hl-15-62> 62</a>
</span><span class=lnt id=hl-15-63><a class=lnlinks href=#hl-15-63> 63</a>
</span><span class=lnt id=hl-15-64><a class=lnlinks href=#hl-15-64> 64</a>
</span><span class=lnt id=hl-15-65><a class=lnlinks href=#hl-15-65> 65</a>
</span><span class=lnt id=hl-15-66><a class=lnlinks href=#hl-15-66> 66</a>
</span><span class=lnt id=hl-15-67><a class=lnlinks href=#hl-15-67> 67</a>
</span><span class=lnt id=hl-15-68><a class=lnlinks href=#hl-15-68> 68</a>
</span><span class=lnt id=hl-15-69><a class=lnlinks href=#hl-15-69> 69</a>
</span><span class=lnt id=hl-15-70><a class=lnlinks href=#hl-15-70> 70</a>
</span><span class=lnt id=hl-15-71><a class=lnlinks href=#hl-15-71> 71</a>
</span><span class=lnt id=hl-15-72><a class=lnlinks href=#hl-15-72> 72</a>
</span><span class=lnt id=hl-15-73><a class=lnlinks href=#hl-15-73> 73</a>
</span><span class=lnt id=hl-15-74><a class=lnlinks href=#hl-15-74> 74</a>
</span><span class=lnt id=hl-15-75><a class=lnlinks href=#hl-15-75> 75</a>
</span><span class=lnt id=hl-15-76><a class=lnlinks href=#hl-15-76> 76</a>
</span><span class=lnt id=hl-15-77><a class=lnlinks href=#hl-15-77> 77</a>
</span><span class=lnt id=hl-15-78><a class=lnlinks href=#hl-15-78> 78</a>
</span><span class=lnt id=hl-15-79><a class=lnlinks href=#hl-15-79> 79</a>
</span><span class=lnt id=hl-15-80><a class=lnlinks href=#hl-15-80> 80</a>
</span><span class=lnt id=hl-15-81><a class=lnlinks href=#hl-15-81> 81</a>
</span><span class=lnt id=hl-15-82><a class=lnlinks href=#hl-15-82> 82</a>
</span><span class=lnt id=hl-15-83><a class=lnlinks href=#hl-15-83> 83</a>
</span><span class=lnt id=hl-15-84><a class=lnlinks href=#hl-15-84> 84</a>
</span><span class=lnt id=hl-15-85><a class=lnlinks href=#hl-15-85> 85</a>
</span><span class=lnt id=hl-15-86><a class=lnlinks href=#hl-15-86> 86</a>
</span><span class=lnt id=hl-15-87><a class=lnlinks href=#hl-15-87> 87</a>
</span><span class=lnt id=hl-15-88><a class=lnlinks href=#hl-15-88> 88</a>
</span><span class=lnt id=hl-15-89><a class=lnlinks href=#hl-15-89> 89</a>
</span><span class=lnt id=hl-15-90><a class=lnlinks href=#hl-15-90> 90</a>
</span><span class=lnt id=hl-15-91><a class=lnlinks href=#hl-15-91> 91</a>
</span><span class=lnt id=hl-15-92><a class=lnlinks href=#hl-15-92> 92</a>
</span><span class=lnt id=hl-15-93><a class=lnlinks href=#hl-15-93> 93</a>
</span><span class=lnt id=hl-15-94><a class=lnlinks href=#hl-15-94> 94</a>
</span><span class=lnt id=hl-15-95><a class=lnlinks href=#hl-15-95> 95</a>
</span><span class=lnt id=hl-15-96><a class=lnlinks href=#hl-15-96> 96</a>
</span><span class=lnt id=hl-15-97><a class=lnlinks href=#hl-15-97> 97</a>
</span><span class=lnt id=hl-15-98><a class=lnlinks href=#hl-15-98> 98</a>
</span><span class=lnt id=hl-15-99><a class=lnlinks href=#hl-15-99> 99</a>
</span><span class=lnt id=hl-15-100><a class=lnlinks href=#hl-15-100>100</a>
</span><span class=lnt id=hl-15-101><a class=lnlinks href=#hl-15-101>101</a>
</span><span class=lnt id=hl-15-102><a class=lnlinks href=#hl-15-102>102</a>
</span><span class=lnt id=hl-15-103><a class=lnlinks href=#hl-15-103>103</a>
</span><span class=lnt id=hl-15-104><a class=lnlinks href=#hl-15-104>104</a>
</span><span class=lnt id=hl-15-105><a class=lnlinks href=#hl-15-105>105</a>
</span><span class=lnt id=hl-15-106><a class=lnlinks href=#hl-15-106>106</a>
</span><span class=lnt id=hl-15-107><a class=lnlinks href=#hl-15-107>107</a>
</span><span class=lnt id=hl-15-108><a class=lnlinks href=#hl-15-108>108</a>
</span><span class=lnt id=hl-15-109><a class=lnlinks href=#hl-15-109>109</a>
</span><span class=lnt id=hl-15-110><a class=lnlinks href=#hl-15-110>110</a>
</span><span class=lnt id=hl-15-111><a class=lnlinks href=#hl-15-111>111</a>
</span><span class=lnt id=hl-15-112><a class=lnlinks href=#hl-15-112>112</a>
</span><span class=lnt id=hl-15-113><a class=lnlinks href=#hl-15-113>113</a>
</span><span class=lnt id=hl-15-114><a class=lnlinks href=#hl-15-114>114</a>
</span><span class=lnt id=hl-15-115><a class=lnlinks href=#hl-15-115>115</a>
</span><span class=lnt id=hl-15-116><a class=lnlinks href=#hl-15-116>116</a>
</span><span class=lnt id=hl-15-117><a class=lnlinks href=#hl-15-117>117</a>
</span><span class=lnt id=hl-15-118><a class=lnlinks href=#hl-15-118>118</a>
</span><span class=lnt id=hl-15-119><a class=lnlinks href=#hl-15-119>119</a>
</span><span class=lnt id=hl-15-120><a class=lnlinks href=#hl-15-120>120</a>
</span><span class=lnt id=hl-15-121><a class=lnlinks href=#hl-15-121>121</a>
</span><span class=lnt id=hl-15-122><a class=lnlinks href=#hl-15-122>122</a>
</span><span class=lnt id=hl-15-123><a class=lnlinks href=#hl-15-123>123</a>
</span><span class=lnt id=hl-15-124><a class=lnlinks href=#hl-15-124>124</a>
</span><span class=lnt id=hl-15-125><a class=lnlinks href=#hl-15-125>125</a>
</span><span class=lnt id=hl-15-126><a class=lnlinks href=#hl-15-126>126</a>
</span><span class=lnt id=hl-15-127><a class=lnlinks href=#hl-15-127>127</a>
</span><span class=lnt id=hl-15-128><a class=lnlinks href=#hl-15-128>128</a>
</span><span class=lnt id=hl-15-129><a class=lnlinks href=#hl-15-129>129</a>
</span><span class=lnt id=hl-15-130><a class=lnlinks href=#hl-15-130>130</a>
</span><span class=lnt id=hl-15-131><a class=lnlinks href=#hl-15-131>131</a>
</span><span class=lnt id=hl-15-132><a class=lnlinks href=#hl-15-132>132</a>
</span><span class=lnt id=hl-15-133><a class=lnlinks href=#hl-15-133>133</a>
</span><span class=lnt id=hl-15-134><a class=lnlinks href=#hl-15-134>134</a>
</span><span class=lnt id=hl-15-135><a class=lnlinks href=#hl-15-135>135</a>
</span><span class=lnt id=hl-15-136><a class=lnlinks href=#hl-15-136>136</a>
</span><span class=lnt id=hl-15-137><a class=lnlinks href=#hl-15-137>137</a>
</span><span class=lnt id=hl-15-138><a class=lnlinks href=#hl-15-138>138</a>
</span><span class=lnt id=hl-15-139><a class=lnlinks href=#hl-15-139>139</a>
</span><span class=lnt id=hl-15-140><a class=lnlinks href=#hl-15-140>140</a>
</span><span class=lnt id=hl-15-141><a class=lnlinks href=#hl-15-141>141</a>
</span><span class=lnt id=hl-15-142><a class=lnlinks href=#hl-15-142>142</a>
</span><span class=lnt id=hl-15-143><a class=lnlinks href=#hl-15-143>143</a>
</span><span class=lnt id=hl-15-144><a class=lnlinks href=#hl-15-144>144</a>
</span><span class=lnt id=hl-15-145><a class=lnlinks href=#hl-15-145>145</a>
</span><span class=lnt id=hl-15-146><a class=lnlinks href=#hl-15-146>146</a>
</span><span class=lnt id=hl-15-147><a class=lnlinks href=#hl-15-147>147</a>
</span><span class=lnt id=hl-15-148><a class=lnlinks href=#hl-15-148>148</a>
</span><span class=lnt id=hl-15-149><a class=lnlinks href=#hl-15-149>149</a>
</span><span class=lnt id=hl-15-150><a class=lnlinks href=#hl-15-150>150</a>
</span><span class=lnt id=hl-15-151><a class=lnlinks href=#hl-15-151>151</a>
</span><span class=lnt id=hl-15-152><a class=lnlinks href=#hl-15-152>152</a>
</span><span class=lnt id=hl-15-153><a class=lnlinks href=#hl-15-153>153</a>
</span><span class=lnt id=hl-15-154><a class=lnlinks href=#hl-15-154>154</a>
</span><span class=lnt id=hl-15-155><a class=lnlinks href=#hl-15-155>155</a>
</span><span class=lnt id=hl-15-156><a class=lnlinks href=#hl-15-156>156</a>
</span><span class=lnt id=hl-15-157><a class=lnlinks href=#hl-15-157>157</a>
</span><span class=lnt id=hl-15-158><a class=lnlinks href=#hl-15-158>158</a>
</span><span class=lnt id=hl-15-159><a class=lnlinks href=#hl-15-159>159</a>
</span><span class=lnt id=hl-15-160><a class=lnlinks href=#hl-15-160>160</a>
</span><span class=lnt id=hl-15-161><a class=lnlinks href=#hl-15-161>161</a>
</span><span class=lnt id=hl-15-162><a class=lnlinks href=#hl-15-162>162</a>
</span><span class=lnt id=hl-15-163><a class=lnlinks href=#hl-15-163>163</a>
</span><span class=lnt id=hl-15-164><a class=lnlinks href=#hl-15-164>164</a>
</span><span class=lnt id=hl-15-165><a class=lnlinks href=#hl-15-165>165</a>
</span><span class=lnt id=hl-15-166><a class=lnlinks href=#hl-15-166>166</a>
</span><span class=lnt id=hl-15-167><a class=lnlinks href=#hl-15-167>167</a>
</span><span class=lnt id=hl-15-168><a class=lnlinks href=#hl-15-168>168</a>
</span><span class=lnt id=hl-15-169><a class=lnlinks href=#hl-15-169>169</a>
</span><span class=lnt id=hl-15-170><a class=lnlinks href=#hl-15-170>170</a>
</span><span class=lnt id=hl-15-171><a class=lnlinks href=#hl-15-171>171</a>
</span><span class=lnt id=hl-15-172><a class=lnlinks href=#hl-15-172>172</a>
</span><span class=lnt id=hl-15-173><a class=lnlinks href=#hl-15-173>173</a>
</span><span class=lnt id=hl-15-174><a class=lnlinks href=#hl-15-174>174</a>
</span><span class=lnt id=hl-15-175><a class=lnlinks href=#hl-15-175>175</a>
</span><span class=lnt id=hl-15-176><a class=lnlinks href=#hl-15-176>176</a>
</span><span class=lnt id=hl-15-177><a class=lnlinks href=#hl-15-177>177</a>
</span><span class=lnt id=hl-15-178><a class=lnlinks href=#hl-15-178>178</a>
</span><span class=lnt id=hl-15-179><a class=lnlinks href=#hl-15-179>179</a>
</span><span class=lnt id=hl-15-180><a class=lnlinks href=#hl-15-180>180</a>
</span><span class=lnt id=hl-15-181><a class=lnlinks href=#hl-15-181>181</a>
</span><span class=lnt id=hl-15-182><a class=lnlinks href=#hl-15-182>182</a>
</span><span class=lnt id=hl-15-183><a class=lnlinks href=#hl-15-183>183</a>
</span><span class=lnt id=hl-15-184><a class=lnlinks href=#hl-15-184>184</a>
</span><span class=lnt id=hl-15-185><a class=lnlinks href=#hl-15-185>185</a>
</span><span class=lnt id=hl-15-186><a class=lnlinks href=#hl-15-186>186</a>
</span><span class=lnt id=hl-15-187><a class=lnlinks href=#hl-15-187>187</a>
</span><span class=lnt id=hl-15-188><a class=lnlinks href=#hl-15-188>188</a>
</span><span class=lnt id=hl-15-189><a class=lnlinks href=#hl-15-189>189</a>
</span><span class=lnt id=hl-15-190><a class=lnlinks href=#hl-15-190>190</a>
</span><span class=lnt id=hl-15-191><a class=lnlinks href=#hl-15-191>191</a>
</span><span class=lnt id=hl-15-192><a class=lnlinks href=#hl-15-192>192</a>
</span><span class=lnt id=hl-15-193><a class=lnlinks href=#hl-15-193>193</a>
</span><span class=lnt id=hl-15-194><a class=lnlinks href=#hl-15-194>194</a>
</span><span class=lnt id=hl-15-195><a class=lnlinks href=#hl-15-195>195</a>
</span><span class=lnt id=hl-15-196><a class=lnlinks href=#hl-15-196>196</a>
</span><span class=lnt id=hl-15-197><a class=lnlinks href=#hl-15-197>197</a>
</span><span class=lnt id=hl-15-198><a class=lnlinks href=#hl-15-198>198</a>
</span><span class=lnt id=hl-15-199><a class=lnlinks href=#hl-15-199>199</a>
</span><span class=lnt id=hl-15-200><a class=lnlinks href=#hl-15-200>200</a>
</span><span class=lnt id=hl-15-201><a class=lnlinks href=#hl-15-201>201</a>
</span><span class=lnt id=hl-15-202><a class=lnlinks href=#hl-15-202>202</a>
</span><span class=lnt id=hl-15-203><a class=lnlinks href=#hl-15-203>203</a>
</span><span class=lnt id=hl-15-204><a class=lnlinks href=#hl-15-204>204</a>
</span><span class=lnt id=hl-15-205><a class=lnlinks href=#hl-15-205>205</a>
</span><span class=lnt id=hl-15-206><a class=lnlinks href=#hl-15-206>206</a>
</span><span class=lnt id=hl-15-207><a class=lnlinks href=#hl-15-207>207</a>
</span><span class=lnt id=hl-15-208><a class=lnlinks href=#hl-15-208>208</a>
</span><span class=lnt id=hl-15-209><a class=lnlinks href=#hl-15-209>209</a>
</span><span class=lnt id=hl-15-210><a class=lnlinks href=#hl-15-210>210</a>
</span><span class=lnt id=hl-15-211><a class=lnlinks href=#hl-15-211>211</a>
</span><span class=lnt id=hl-15-212><a class=lnlinks href=#hl-15-212>212</a>
</span><span class=lnt id=hl-15-213><a class=lnlinks href=#hl-15-213>213</a>
</span><span class=lnt id=hl-15-214><a class=lnlinks href=#hl-15-214>214</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Node.js + Redis 기반 라이브락 방지 시스템
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>Redis</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;ioredis&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>promisify</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;util&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>LivelockPreventionService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>redisConfig</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>redis</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Redis</span><span class=p>(</span><span class=nx>redisConfig</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>retryStats</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 지수 백오프 with 지터 적용 재시도 메커니즘
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>retryWithBackoff</span><span class=p>(</span><span class=nx>operation</span><span class=p>,</span> <span class=nx>config</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>maxAttempts</span> <span class=o>=</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>baseDelay</span> <span class=o>=</span> <span class=mi>100</span><span class=p>,</span>     <span class=c1>// ms
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>maxDelay</span> <span class=o>=</span> <span class=mi>5000</span><span class=p>,</span>     <span class=c1>// ms  
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>jitterFactor</span> <span class=o>=</span> <span class=mf>0.1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>exponentialBase</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=o>=</span> <span class=nx>config</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>attempt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>attempt</span> <span class=o>&lt;</span> <span class=nx>maxAttempts</span><span class=p>;</span> <span class=nx>attempt</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>operation</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// 성공 시 통계 초기화
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>this</span><span class=p>.</span><span class=nx>retryStats</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>operation</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span> <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>result</span><span class=p>,</span> <span class=nx>attempts</span><span class=o>:</span> <span class=nx>attempt</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`시도 </span><span class=si>${</span><span class=nx>attempt</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>maxAttempts</span><span class=si>}</span><span class=sb> 실패: </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>attempt</span> <span class=o>&lt;</span> <span class=nx>maxAttempts</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>delay</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>calculateBackoffDelay</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=nx>attempt</span><span class=p>,</span> <span class=nx>baseDelay</span><span class=p>,</span> <span class=nx>maxDelay</span><span class=p>,</span> <span class=nx>exponentialBase</span><span class=p>,</span> <span class=nx>jitterFactor</span>
</span></span><span class=line><span class=cl>                    <span class=p>);</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>this</span><span class=p>.</span><span class=nx>updateRetryStats</span><span class=p>(</span><span class=nx>operation</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>attempt</span><span class=p>,</span> <span class=nx>delay</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sleep</span><span class=p>(</span><span class=nx>delay</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 모든 재시도 실패
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=p>{</span> <span class=nx>success</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>attempts</span><span class=o>:</span> <span class=nx>maxAttempts</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 라이브락 방지를 위한 백오프 지연 계산
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>calculateBackoffDelay</span><span class=p>(</span><span class=nx>attempt</span><span class=p>,</span> <span class=nx>baseDelay</span><span class=p>,</span> <span class=nx>maxDelay</span><span class=p>,</span> <span class=nx>exponentialBase</span><span class=p>,</span> <span class=nx>jitterFactor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 지수 백오프 계산
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>let</span> <span class=nx>delay</span> <span class=o>=</span> <span class=nx>baseDelay</span> <span class=o>*</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>pow</span><span class=p>(</span><span class=nx>exponentialBase</span><span class=p>,</span> <span class=nx>attempt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 최대 지연 시간 제한
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>delay</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>delay</span><span class=p>,</span> <span class=nx>maxDelay</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 지터 적용 (핵심: 동기화된 재시도 방지)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>jitter</span> <span class=o>=</span> <span class=nx>delay</span> <span class=o>*</span> <span class=nx>jitterFactor</span> <span class=o>*</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>delay</span> <span class=o>+</span> <span class=nx>jitter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 분산 락을 이용한 안전한 리소스 접근
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>withDistributedLock</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=nx>operation</span><span class=p>,</span> <span class=nx>lockTtl</span> <span class=o>=</span> <span class=mi>30000</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>lockValue</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=si>}</span><span class=sb>-</span><span class=si>${</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 락 획득 시도
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>acquired</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nx>lockKey</span><span class=p>,</span> <span class=nx>lockValue</span><span class=p>,</span> <span class=s1>&#39;PX&#39;</span><span class=p>,</span> <span class=nx>lockTtl</span><span class=p>,</span> <span class=s1>&#39;NX&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>acquired</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;락 획득 실패&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 보호된 작업 실행
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>operation</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 락 해제 (Lua 스크립트로 안전한 해제)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nb>eval</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sb>`if redis.call(&#34;get&#34;, KEYS[1]) == ARGV[1] then
</span></span></span><span class=line><span class=cl><span class=sb>                    return redis.call(&#34;del&#34;, KEYS[1])
</span></span></span><span class=line><span class=cl><span class=sb>                else
</span></span></span><span class=line><span class=cl><span class=sb>                    return 0
</span></span></span><span class=line><span class=cl><span class=sb>                end`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>lockKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>lockValue</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 재시도 통계 업데이트
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>updateRetryStats</span><span class=p>(</span><span class=nx>operationName</span><span class=p>,</span> <span class=nx>attempt</span><span class=p>,</span> <span class=nx>delay</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>retryStats</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>operationName</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>retryStats</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>operationName</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>totalRetries</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>totalDelay</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>lastAttemptTime</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>stats</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>retryStats</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>operationName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>stats</span><span class=p>.</span><span class=nx>totalRetries</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>stats</span><span class=p>.</span><span class=nx>totalDelay</span> <span class=o>+=</span> <span class=nx>delay</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>stats</span><span class=p>.</span><span class=nx>lastAttemptTime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 라이브락 패턴 탐지
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nx>detectLivelockPattern</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>suspiciousOperations</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>currentTime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>threshold</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>minRetries</span><span class=o>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>timeWindow</span><span class=o>:</span> <span class=mi>60000</span><span class=p>,</span>  <span class=c1>// 1분
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>maxRetryRate</span><span class=o>:</span> <span class=mi>5</span>     <span class=c1>// 초당 5회 이상
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>operationName</span><span class=p>,</span> <span class=nx>stats</span><span class=p>]</span> <span class=k>of</span> <span class=k>this</span><span class=p>.</span><span class=nx>retryStats</span><span class=p>.</span><span class=nx>entries</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>timeSinceLastAttempt</span> <span class=o>=</span> <span class=nx>currentTime</span> <span class=o>-</span> <span class=nx>stats</span><span class=p>.</span><span class=nx>lastAttemptTime</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>stats</span><span class=p>.</span><span class=nx>totalRetries</span> <span class=o>&gt;=</span> <span class=nx>threshold</span><span class=p>.</span><span class=nx>minRetries</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                <span class=nx>timeSinceLastAttempt</span> <span class=o>&lt;</span> <span class=nx>threshold</span><span class=p>.</span><span class=nx>timeWindow</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>retryRate</span> <span class=o>=</span> <span class=nx>stats</span><span class=p>.</span><span class=nx>totalRetries</span> <span class=o>/</span> <span class=p>(</span><span class=nx>stats</span><span class=p>.</span><span class=nx>totalDelay</span> <span class=o>/</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>retryRate</span> <span class=o>&gt;</span> <span class=nx>threshold</span><span class=p>.</span><span class=nx>maxRetryRate</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>suspiciousOperations</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=nx>operation</span><span class=o>:</span> <span class=nx>operationName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>retries</span><span class=o>:</span> <span class=nx>stats</span><span class=p>.</span><span class=nx>totalRetries</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>retryRate</span><span class=o>:</span> <span class=nx>retryRate</span><span class=p>.</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>});</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>suspiciousOperations</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>sleep</span><span class=p>(</span><span class=nx>ms</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span> <span class=p>=&gt;</span> <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>ms</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>demonstrateLivelockPrevention</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>service</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>LivelockPreventionService</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>port</span><span class=o>:</span> <span class=mi>6379</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 위험한 작업 정의 (재고 차감)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>decreaseInventory</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>productId</span><span class=p>,</span> <span class=nx>quantity</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>lockKey</span> <span class=o>=</span> <span class=sb>`inventory_lock:</span><span class=si>${</span><span class=nx>productId</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kr>await</span> <span class=nx>service</span><span class=p>.</span><span class=nx>withDistributedLock</span><span class=p>(</span><span class=nx>lockKey</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>currentStock</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>service</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`stock:</span><span class=si>${</span><span class=nx>productId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>stock</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>currentStock</span><span class=p>)</span> <span class=o>||</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>stock</span> <span class=o>&gt;=</span> <span class=nx>quantity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=nx>service</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=sb>`stock:</span><span class=si>${</span><span class=nx>productId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>stock</span> <span class=o>-</span> <span class=nx>quantity</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span> <span class=nx>success</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>newStock</span><span class=o>:</span> <span class=nx>stock</span> <span class=o>-</span> <span class=nx>quantity</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;재고 부족&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 라이브락 방지 재시도로 래핑
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>safeDecreaseInventory</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> 
</span></span><span class=line><span class=cl>        <span class=nx>service</span><span class=p>.</span><span class=nx>retryWithBackoff</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>decreaseInventory</span><span class=p>(</span><span class=s1>&#39;product_001&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>maxAttempts</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>baseDelay</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>maxDelay</span><span class=o>:</span> <span class=mi>2000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>jitterFactor</span><span class=o>:</span> <span class=mf>0.2</span>  <span class=c1>// 20% 지터로 라이브락 방지
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 초기 재고 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nx>service</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>&#39;stock:product_001&#39;</span><span class=p>,</span> <span class=mi>50</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 동시 재고 차감 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>promises</span> <span class=o>=</span> <span class=nb>Array</span><span class=p>.</span><span class=nx>from</span><span class=p>({</span> <span class=nx>length</span><span class=o>:</span> <span class=mi>20</span> <span class=p>},</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>safeDecreaseInventory</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>results</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span><span class=nx>promises</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 결과 분석
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>successCount</span> <span class=o>=</span> <span class=nx>results</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>r</span> <span class=p>=&gt;</span> <span class=nx>r</span><span class=p>.</span><span class=nx>success</span><span class=p>).</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>promises</span><span class=p>.</span><span class=nx>length</span><span class=si>}</span><span class=sb>개 요청 중 </span><span class=si>${</span><span class=nx>successCount</span><span class=si>}</span><span class=sb>개 성공`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 라이브락 패턴 탐지
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>suspiciousOps</span> <span class=o>=</span> <span class=nx>service</span><span class=p>.</span><span class=nx>detectLivelockPattern</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>suspiciousOps</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;라이브락 의심 작업:&#39;</span><span class=p>,</span> <span class=nx>suspiciousOps</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>service</span><span class=p>.</span><span class=nx>redis</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 실행
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>demonstrateLivelockPrevention</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-kafka-기반-로그-수집-시스템>사례: Kafka 기반 로그 수집 시스템<a hidden class=anchor aria-hidden=true href=#사례-kafka-기반-로그-수집-시스템>#</a></h5><p><strong>시나리오</strong>: Kafka 기반 로그 수집 시스템에서, 소비자가 메시지를 처리 실패한 후 메시지를 다시 큐 앞에 삽입하는 구조. 모든 소비자가 같은 방식으로 동작하면 livelock 상태 발생.</p><p><strong>시스템 구성</strong>:</p><ul><li>Kafka broker</li><li>Consumer group with auto-commit disabled</li><li>Retry queue or same topic re-ingestion</li><li>Error handler for exception 재시도</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>flowchart TD
    Producer --&gt; Kafka[Kafka Topic]
    Kafka --&gt; Consumer1[Consumer #1]
    Kafka --&gt; Consumer2[Consumer #2]
    Consumer1 --&gt;|fail + re-ingest| Kafka
    Consumer2 --&gt;|fail + re-ingest| Kafka
</pre><p><strong>Workflow</strong>:</p><ul><li>Consumer fetches message</li><li>Fails to process</li><li>Sends back to same topic (or retry topic)</li><li>Another consumer fetches it → 반복</li></ul><p><strong>역할</strong>:</p><ul><li>Kafka: 메시지 큐 역할, 재시도 메시지도 동일하게 처리</li><li>Consumer: 메시지 처리와 동시에 재삽입 로직 실행</li><li>시스템 전체: busy 상태 유지하나 유효 처리 불가 (Livelock 상태)</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>Livelock 존재</strong>: 메시지는 끊임없이 처리 실패 후 재삽입, 처리율 0</li><li><strong>Livelock 제거</strong>: 재시도 간 백오프 적용, retry 횟수 제한, DLQ (Dead Letter Queue) 사용</li></ul><p><strong>구현 예시 (Node.js + KafkaJS)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>Kafka</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;kafkajs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>kafka</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Kafka</span><span class=p>({</span> <span class=nx>clientId</span><span class=o>:</span> <span class=s1>&#39;log-consumer&#39;</span><span class=p>,</span> <span class=nx>brokers</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;broker:9092&#39;</span><span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>consumer</span> <span class=o>=</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>consumer</span><span class=p>({</span> <span class=nx>groupId</span><span class=o>:</span> <span class=s1>&#39;log-group&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>await</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>({</span> <span class=nx>topic</span><span class=o>:</span> <span class=s1>&#39;logs&#39;</span><span class=p>,</span> <span class=nx>fromBeginning</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>consumer</span><span class=p>.</span><span class=nx>run</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>eachMessage</span><span class=o>:</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>topic</span><span class=p>,</span> <span class=nx>partition</span><span class=p>,</span> <span class=nx>message</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>processLogMessage</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Processing failed, retrying later:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>kafka</span><span class=p>.</span><span class=nx>producer</span><span class=p>().</span><span class=nx>send</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>topic</span><span class=o>:</span> <span class=s1>&#39;retry-logs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>messages</span><span class=o>:</span> <span class=p>[{</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>message</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>toString</span><span class=p>()</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-분산-메시지-큐-시스템>사례: 분산 메시지 큐 시스템<a hidden class=anchor aria-hidden=true href=#사례-분산-메시지-큐-시스템>#</a></h5><p><strong>시나리오</strong>: 분산 메시지 큐 시스템에서 두 노드 (node) 가 메시지 수신 락을 번갈아 시도하며 서로 양보만 반복. 작업 자체 (메시지 소비) 는 계속 시도되지만, 처리 진전은 없음.</p><p><strong>시스템 구성</strong>:</p><ul><li>노드 2 개 (프로세스 A, B)</li><li>메시지 큐</li><li>락 (뮤텍스)</li><li>백오프 및 진전 감지 로직</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>flowchart TD
    MQ(메시지 큐)
    A(프로세스 A)
    B(프로세스 B)
    L(락/뮤텍스)

    MQ --&gt; L
    L --&gt; A
    L --&gt; B
</pre><p><strong>Workflow</strong>:</p><ol><li>프로세스 A, B 가 동시에 락 획득 시도</li><li>서로 양보, 백오프 없이 계속 반복</li><li>메시지는 소비되지 않음 (진전 없음)</li></ol><p><strong>역할</strong>:</p><ul><li>메시지 전달 및 소비 담당</li><li>락 획득 및 해제 담당</li><li>진전 상황 모니터링</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>라이브락 발생 시 진전 없음, 무한 반복</li><li>라이브락 방지 구조 도입 시 메시지 소비 정상 진행</li></ul><p><strong>구현 예시</strong> (Python)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18>18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19>19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20>20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21>21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22>22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23>23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24>24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25>25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26>26</a>
</span><span class=lnt id=hl-19-27><a class=lnlinks href=#hl-19-27>27</a>
</span><span class=lnt id=hl-19-28><a class=lnlinks href=#hl-19-28>28</a>
</span><span class=lnt id=hl-19-29><a class=lnlinks href=#hl-19-29>29</a>
</span><span class=lnt id=hl-19-30><a class=lnlinks href=#hl-19-30>30</a>
</span><span class=lnt id=hl-19-31><a class=lnlinks href=#hl-19-31>31</a>
</span><span class=lnt id=hl-19-32><a class=lnlinks href=#hl-19-32>32</a>
</span><span class=lnt id=hl-19-33><a class=lnlinks href=#hl-19-33>33</a>
</span><span class=lnt id=hl-19-34><a class=lnlinks href=#hl-19-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>queue</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;메시지1&#34;</span><span class=p>,</span> <span class=s2>&#34;메시지2&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>worker</span><span class=p>(</span><span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>queue</span>
</span></span><span class=line><span class=cl>    <span class=n>retries</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>queue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>got_lock</span> <span class=o>=</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>got_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>queue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>msg</span> <span class=o>=</span> <span class=n>queue</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2> 메시지 소비: </span><span class=si>{</span><span class=n>msg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 라이브락 방지를 위한 random 백오프 적용</span>
</span></span><span class=line><span class=cl>            <span class=n>wait</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2> 대기 중(백오프 </span><span class=si>{</span><span class=n>wait</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>초)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>wait</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>retries</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>retries</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2> : 라이브락 발생 가능성, 강제 종료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threadA</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>worker</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=s2>&#34;A&#34;</span><span class=p>,))</span>
</span></span><span class=line><span class=cl><span class=n>threadB</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>worker</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=s2>&#34;B&#34;</span><span class=p>,))</span>
</span></span><span class=line><span class=cl><span class=n>threadA</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>threadB</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>threadA</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>threadB</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-고가용성-웹-서비스의-분산-캐시-시스템>사례: 고가용성 웹 서비스의 분산 캐시 시스템<a hidden class=anchor aria-hidden=true href=#사례-고가용성-웹-서비스의-분산-캐시-시스템>#</a></h5><p><strong>시나리오</strong>: 고가용성 웹 서비스의 분산 캐시 시스템에서 발생하는 Livelock 문제 해결</p><p><strong>시스템 구성</strong>:</p><ul><li>3 개의 캐시 노드 (Redis Cluster)</li><li>로드 밸런서 (HAProxy)</li><li>애플리케이션 서버 (Node.js)</li><li>모니터링 시스템 (Prometheus + Grafana)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;클라이언트 계층&#34;
        C1[Client 1]
        C2[Client 2]
        C3[Client N]
    end
    
    subgraph &#34;로드 밸런싱 계층&#34;
        LB[HAProxy Load Balancer]
    end
    
    subgraph &#34;애플리케이션 계층&#34;
        A1[App Server 1]
        A2[App Server 2]
        A3[App Server 3]
    end
    
    subgraph &#34;캐시 계층&#34;
        R1[Redis Node 1]
        R2[Redis Node 2]
        R3[Redis Node 3]
    end
    
    subgraph &#34;모니터링 계층&#34;
        P[Prometheus]
        G[Grafana]
    end
    
    C1 --&gt; LB
    C2 --&gt; LB
    C3 --&gt; LB
    LB --&gt; A1
    LB --&gt; A2
    LB --&gt; A3
    A1 --&gt; R1
    A1 --&gt; R2
    A1 --&gt; R3
    A2 --&gt; R1
    A2 --&gt; R2
    A2 --&gt; R3
    A3 --&gt; R1
    A3 --&gt; R2
    A3 --&gt; R3
    R1 --&gt; P
    R2 --&gt; P
    R3 --&gt; P
    A1 --&gt; P
    A2 --&gt; P
    A3 --&gt; P
    P --&gt; G
</pre><p><strong>Workflow</strong>:</p><ul><li>클라이언트 요청이 로드 밸런서를 통해 애플리케이션 서버로 전달</li><li>애플리케이션 서버가 캐시 노드에 데이터 요청</li><li>캐시 미스 시 여러 서버가 동시에 동일한 데이터 생성 시도</li><li>Livelock 발생: 서버들이 서로 방해하며 무한 재시도</li><li>모니터링 시스템이 이상 상태 탐지 및 알림</li></ul><p><strong>역할</strong>:</p><ul><li><strong>HAProxy</strong>: 요청 분산 및 헬스체크</li><li><strong>Redis Cluster</strong>: 분산 캐시 저장소</li><li><strong>Node.js App</strong>: 비즈니스 로직 처리 및 캐시 접근</li><li><strong>Prometheus</strong>: 메트릭 수집 및 저장</li><li><strong>Grafana</strong>: 실시간 모니터링 대시보드</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>Livelock 방지 시</strong>: 99.9% 가용성, 평균 응답시간 50ms</li><li><strong>Livelock 발생 시</strong>: 60% 가용성, 평균 응답시간 5000ms+, CPU 사용률 90%+</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>  1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>  2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>  3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>  4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>  5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>  6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>  7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8>  8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9>  9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10> 10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11> 11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12> 12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13> 13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14> 14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15> 15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16> 16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17> 17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18> 18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19> 19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20> 20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21> 21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22> 22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23> 23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24> 24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25> 25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26> 26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27> 27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28> 28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29> 29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30> 30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31> 31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32> 32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33> 33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34> 34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35> 35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36> 36</a>
</span><span class=lnt id=hl-21-37><a class=lnlinks href=#hl-21-37> 37</a>
</span><span class=lnt id=hl-21-38><a class=lnlinks href=#hl-21-38> 38</a>
</span><span class=lnt id=hl-21-39><a class=lnlinks href=#hl-21-39> 39</a>
</span><span class=lnt id=hl-21-40><a class=lnlinks href=#hl-21-40> 40</a>
</span><span class=lnt id=hl-21-41><a class=lnlinks href=#hl-21-41> 41</a>
</span><span class=lnt id=hl-21-42><a class=lnlinks href=#hl-21-42> 42</a>
</span><span class=lnt id=hl-21-43><a class=lnlinks href=#hl-21-43> 43</a>
</span><span class=lnt id=hl-21-44><a class=lnlinks href=#hl-21-44> 44</a>
</span><span class=lnt id=hl-21-45><a class=lnlinks href=#hl-21-45> 45</a>
</span><span class=lnt id=hl-21-46><a class=lnlinks href=#hl-21-46> 46</a>
</span><span class=lnt id=hl-21-47><a class=lnlinks href=#hl-21-47> 47</a>
</span><span class=lnt id=hl-21-48><a class=lnlinks href=#hl-21-48> 48</a>
</span><span class=lnt id=hl-21-49><a class=lnlinks href=#hl-21-49> 49</a>
</span><span class=lnt id=hl-21-50><a class=lnlinks href=#hl-21-50> 50</a>
</span><span class=lnt id=hl-21-51><a class=lnlinks href=#hl-21-51> 51</a>
</span><span class=lnt id=hl-21-52><a class=lnlinks href=#hl-21-52> 52</a>
</span><span class=lnt id=hl-21-53><a class=lnlinks href=#hl-21-53> 53</a>
</span><span class=lnt id=hl-21-54><a class=lnlinks href=#hl-21-54> 54</a>
</span><span class=lnt id=hl-21-55><a class=lnlinks href=#hl-21-55> 55</a>
</span><span class=lnt id=hl-21-56><a class=lnlinks href=#hl-21-56> 56</a>
</span><span class=lnt id=hl-21-57><a class=lnlinks href=#hl-21-57> 57</a>
</span><span class=lnt id=hl-21-58><a class=lnlinks href=#hl-21-58> 58</a>
</span><span class=lnt id=hl-21-59><a class=lnlinks href=#hl-21-59> 59</a>
</span><span class=lnt id=hl-21-60><a class=lnlinks href=#hl-21-60> 60</a>
</span><span class=lnt id=hl-21-61><a class=lnlinks href=#hl-21-61> 61</a>
</span><span class=lnt id=hl-21-62><a class=lnlinks href=#hl-21-62> 62</a>
</span><span class=lnt id=hl-21-63><a class=lnlinks href=#hl-21-63> 63</a>
</span><span class=lnt id=hl-21-64><a class=lnlinks href=#hl-21-64> 64</a>
</span><span class=lnt id=hl-21-65><a class=lnlinks href=#hl-21-65> 65</a>
</span><span class=lnt id=hl-21-66><a class=lnlinks href=#hl-21-66> 66</a>
</span><span class=lnt id=hl-21-67><a class=lnlinks href=#hl-21-67> 67</a>
</span><span class=lnt id=hl-21-68><a class=lnlinks href=#hl-21-68> 68</a>
</span><span class=lnt id=hl-21-69><a class=lnlinks href=#hl-21-69> 69</a>
</span><span class=lnt id=hl-21-70><a class=lnlinks href=#hl-21-70> 70</a>
</span><span class=lnt id=hl-21-71><a class=lnlinks href=#hl-21-71> 71</a>
</span><span class=lnt id=hl-21-72><a class=lnlinks href=#hl-21-72> 72</a>
</span><span class=lnt id=hl-21-73><a class=lnlinks href=#hl-21-73> 73</a>
</span><span class=lnt id=hl-21-74><a class=lnlinks href=#hl-21-74> 74</a>
</span><span class=lnt id=hl-21-75><a class=lnlinks href=#hl-21-75> 75</a>
</span><span class=lnt id=hl-21-76><a class=lnlinks href=#hl-21-76> 76</a>
</span><span class=lnt id=hl-21-77><a class=lnlinks href=#hl-21-77> 77</a>
</span><span class=lnt id=hl-21-78><a class=lnlinks href=#hl-21-78> 78</a>
</span><span class=lnt id=hl-21-79><a class=lnlinks href=#hl-21-79> 79</a>
</span><span class=lnt id=hl-21-80><a class=lnlinks href=#hl-21-80> 80</a>
</span><span class=lnt id=hl-21-81><a class=lnlinks href=#hl-21-81> 81</a>
</span><span class=lnt id=hl-21-82><a class=lnlinks href=#hl-21-82> 82</a>
</span><span class=lnt id=hl-21-83><a class=lnlinks href=#hl-21-83> 83</a>
</span><span class=lnt id=hl-21-84><a class=lnlinks href=#hl-21-84> 84</a>
</span><span class=lnt id=hl-21-85><a class=lnlinks href=#hl-21-85> 85</a>
</span><span class=lnt id=hl-21-86><a class=lnlinks href=#hl-21-86> 86</a>
</span><span class=lnt id=hl-21-87><a class=lnlinks href=#hl-21-87> 87</a>
</span><span class=lnt id=hl-21-88><a class=lnlinks href=#hl-21-88> 88</a>
</span><span class=lnt id=hl-21-89><a class=lnlinks href=#hl-21-89> 89</a>
</span><span class=lnt id=hl-21-90><a class=lnlinks href=#hl-21-90> 90</a>
</span><span class=lnt id=hl-21-91><a class=lnlinks href=#hl-21-91> 91</a>
</span><span class=lnt id=hl-21-92><a class=lnlinks href=#hl-21-92> 92</a>
</span><span class=lnt id=hl-21-93><a class=lnlinks href=#hl-21-93> 93</a>
</span><span class=lnt id=hl-21-94><a class=lnlinks href=#hl-21-94> 94</a>
</span><span class=lnt id=hl-21-95><a class=lnlinks href=#hl-21-95> 95</a>
</span><span class=lnt id=hl-21-96><a class=lnlinks href=#hl-21-96> 96</a>
</span><span class=lnt id=hl-21-97><a class=lnlinks href=#hl-21-97> 97</a>
</span><span class=lnt id=hl-21-98><a class=lnlinks href=#hl-21-98> 98</a>
</span><span class=lnt id=hl-21-99><a class=lnlinks href=#hl-21-99> 99</a>
</span><span class=lnt id=hl-21-100><a class=lnlinks href=#hl-21-100>100</a>
</span><span class=lnt id=hl-21-101><a class=lnlinks href=#hl-21-101>101</a>
</span><span class=lnt id=hl-21-102><a class=lnlinks href=#hl-21-102>102</a>
</span><span class=lnt id=hl-21-103><a class=lnlinks href=#hl-21-103>103</a>
</span><span class=lnt id=hl-21-104><a class=lnlinks href=#hl-21-104>104</a>
</span><span class=lnt id=hl-21-105><a class=lnlinks href=#hl-21-105>105</a>
</span><span class=lnt id=hl-21-106><a class=lnlinks href=#hl-21-106>106</a>
</span><span class=lnt id=hl-21-107><a class=lnlinks href=#hl-21-107>107</a>
</span><span class=lnt id=hl-21-108><a class=lnlinks href=#hl-21-108>108</a>
</span><span class=lnt id=hl-21-109><a class=lnlinks href=#hl-21-109>109</a>
</span><span class=lnt id=hl-21-110><a class=lnlinks href=#hl-21-110>110</a>
</span><span class=lnt id=hl-21-111><a class=lnlinks href=#hl-21-111>111</a>
</span><span class=lnt id=hl-21-112><a class=lnlinks href=#hl-21-112>112</a>
</span><span class=lnt id=hl-21-113><a class=lnlinks href=#hl-21-113>113</a>
</span><span class=lnt id=hl-21-114><a class=lnlinks href=#hl-21-114>114</a>
</span><span class=lnt id=hl-21-115><a class=lnlinks href=#hl-21-115>115</a>
</span><span class=lnt id=hl-21-116><a class=lnlinks href=#hl-21-116>116</a>
</span><span class=lnt id=hl-21-117><a class=lnlinks href=#hl-21-117>117</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DistributedCacheLivelock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>cache_nodes</span><span class=p>:</span> <span class=nb>list</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>node_id</span> <span class=o>=</span> <span class=n>node_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cache_nodes</span> <span class=o>=</span> <span class=n>cache_nodes</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>backoff_base</span> <span class=o>=</span> <span class=mf>0.1</span>  <span class=c1># 백오프 기본 시간</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>max_retries</span> <span class=o>=</span> <span class=mi>5</span>     <span class=c1># 최대 재시도 횟수</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>jitter_factor</span> <span class=o>=</span> <span class=mf>0.1</span> <span class=c1># 지터 팩터</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_with_livelock_prevention</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Livelock 방지 로직이 포함된 캐시 접근&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>retry_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>retry_count</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_retries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 1. 캐시에서 데이터 조회 시도</span>
</span></span><span class=line><span class=cl>                <span class=n>value</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_try_get_from_cache</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>value</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 2. 캐시 미스 시 분산 락 시도 (Livelock 방지)</span>
</span></span><span class=line><span class=cl>                <span class=n>lock_acquired</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_try_acquire_distributed_lock</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>lock_acquired</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 3. 락 획득 성공 시 데이터 생성</span>
</span></span><span class=line><span class=cl>                        <span class=n>value</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_generate_data</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_set_cache</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>                    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_release_distributed_lock</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 4. 락 획득 실패 시 지수 백오프 + 지터</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_backoff_with_jitter</span><span class=p>(</span><span class=n>retry_count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>retry_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Node </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>: Error occurred - </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_backoff_with_jitter</span><span class=p>(</span><span class=n>retry_count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>retry_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 5. 최대 재시도 초과 시 기본값 반환</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_default_value</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_try_get_from_cache</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;캐시에서 데이터 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Redis 등 캐시 시스템 조회 로직</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>  <span class=c1># 네트워크 지연 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>  <span class=c1># 캐시 미스 시뮬레이션</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_try_acquire_distributed_lock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;분산 락 획득 시도 (Redlock 알고리즘 등 사용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>lock_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;lock:</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 무작위 우선순위 기반 락 획득 시도</span>
</span></span><span class=line><span class=cl>        <span class=n>priority</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>  <span class=c1># 락 획득 시간</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 50% 확률로 락 획득 실패 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>priority</span> <span class=o>&gt;</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_generate_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;데이터 생성 (DB 조회 등)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 데이터 생성 시간</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;generated_data_for_</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_set_cache</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;캐시에 데이터 저장&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>  <span class=c1># 캐시 저장 시간</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Node </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>: Cached </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2> = </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_release_distributed_lock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;분산 락 해제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>  <span class=c1># 락 해제 시간</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_backoff_with_jitter</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>retry_count</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;지수 백오프 + 지터 적용&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>base_delay</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>backoff_base</span> <span class=o>*</span> <span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>retry_count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>jitter</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>jitter_factor</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>jitter_factor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>delay</span> <span class=o>=</span> <span class=n>base_delay</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>jitter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Node </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>: Backing off for </span><span class=si>{</span><span class=n>delay</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>s (retry </span><span class=si>{</span><span class=n>retry_count</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>delay</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>_get_default_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;기본값 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;default_value_for_</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>simulate_livelock_scenario</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Livelock 시나리오 시뮬레이션&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cache_nodes</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;node1&#34;</span><span class=p>,</span> <span class=s2>&#34;node2&#34;</span><span class=p>,</span> <span class=s2>&#34;node3&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 여러 노드가 동시에 같은 키에 접근하는 상황</span>
</span></span><span class=line><span class=cl>    <span class=n>tasks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>node_id</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>cache_nodes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>cache</span> <span class=o>=</span> <span class=n>DistributedCacheLivelock</span><span class=p>(</span><span class=n>node_id</span><span class=p>,</span> <span class=n>cache_nodes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>task</span> <span class=o>=</span> <span class=n>cache</span><span class=o>.</span><span class=n>get_with_livelock_prevention</span><span class=p>(</span><span class=s2>&#34;hot_key&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>tasks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>task</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 모든 노드의 요청을 동시 실행</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>,</span> <span class=n>return_exceptions</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 결과 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;실행 시간: </span><span class=si>{</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>s&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>results</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Node </span><span class=si>{</span><span class=n>cache_nodes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>simulate_livelock_scenario</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-네트워크-충돌>사례: 네트워크 충돌<a hidden class=anchor aria-hidden=true href=#사례-네트워크-충돌>#</a></h5><p><strong>시나리오</strong>: 이더넷 (Ethernet) 프로토콜에서 두 장치가 동시에 신호를 보내고 충돌 (Colision) 발생 시, 양쪽이 정확히 같은 시간 기다리고 재전송을 반복할 경우 라이브락 발생.</p><p><strong>Mermaid 다이어그램</strong>:</p><pre class=mermaid>sequenceDiagram
    participant DeviceA as 장치A
    participant DeviceB as 장치B
    DeviceA-&gt;&gt;DeviceB: 신호 송신
    DeviceB-&gt;&gt;DeviceA: 신호 송신
    Note over DeviceA,DeviceB: 충돌 발생
    DeviceA-&gt;&gt;DeviceB: 대기 및 재시도 (동시)
    DeviceB-&gt;&gt;DeviceA: 대기 및 재시도 (동시)
    Note over DeviceA,DeviceB: 무한 반복 (Livelock)
</pre><p><strong>관측성 향상 실무 예시 (Python)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17>17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18>18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19>19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>retry_count</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>livelock_monitor</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>retry_count</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.02</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 단순히 진전 없는 상태를 카운팅</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread-</span><span class=si>{</span><span class=n>idx</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2>: Retry </span><span class=si>{</span><span class=n>retry_count</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span><span class=si>}</span><span class=s2>회&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>retry_count</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span> <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>livelock_monitor</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,))</span>
</span></span><span class=line><span class=cl><span class=n>t2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>livelock_monitor</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>t2</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>위 코드에서 retry_count 를 모니터링하여 반복 재시도 징후를 탐지할 수 있다.</li></ul><h3 id=운영-및-최적화-operations--optimization>운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#운영-및-최적화-operations--optimization>#</a></h3><h4 id=보안-및-거버넌스>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스>#</a></h4><ul><li><strong>안정성</strong>: livelock 이 DoS 의 형태로 발전하지 않도록 Retry 제한, 백오프, 회로 차단 정책 수립</li><li><strong>설정 관리 및 자동화</strong>: 외부에서 변경 가능한 정책 파일이나 정책 엔진 (OPa 등) 을 통한 중앙 관리</li><li><strong>무한 루프 방지</strong>: Watchdog 나 정책 엔진을 통해 루프 탐지 시 자동 차단</li><li><strong>공격 방지</strong>:<ul><li>Timing Attack: 진짜 랜덤 지터 적용</li><li>Resource Exhaustion: 재시도 횟수 제한</li><li>정보 노출: 로그 마스킹 및 안전한 에러 처리</li></ul></li><li><strong>거버넌스 + 규정 준수</strong>:<ul><li>SLA: livelock 발생/해결 시간 기준 포함</li><li>감사 로깅: 발생 및 조치 내역 기록</li><li>컴플라이언스: 가용성 요구사항 충족 및 증빙</li></ul></li></ul><table><thead><tr><th>항목</th><th>설명</th><th>구현 기술 / 실무 적용</th></tr></thead><tbody><tr><td>안정성 보장</td><td>livelock → DoS 형태 전환 방지</td><td>백오프 전략, 최대 재시도 수 지정, 회로 차단 (Circuit Breaker)</td></tr><tr><td>설정 관리</td><td>정책 기반 제어 (Retry, Timeout 등)</td><td><code>RetryPolicy.yaml</code>, Feature Flags, OPA 정책 엔진</td></tr><tr><td>자동화 정책</td><td>무한 루프 탐지 및 자동 차단</td><td>Watchdog, Fail‑safe Breaker, OPA 룰 기반 정책 적용</td></tr><tr><td>타이밍 공격 방지</td><td>지터 패턴 분석으로 시스템 예측 방지</td><td>SecureRandom 혹은 CSPRNG 기반 지터 적용</td></tr><tr><td>리소스 고갈 공격 방지</td><td>재시도 남발로 인한 DoS 예방</td><td>재시도 제한, Rate Limiting, Circuit Breaker</td></tr><tr><td>정보 누설 방지</td><td>노출된 내부 정보로 인한 보안 위협 방지</td><td>로그 마스킹, 에러 메시지 추상화</td></tr><tr><td>SLA 정의</td><td>livelock 발생/복구 시간 기준 명시</td><td>SLA 문서, 운영 정책 수립</td></tr><tr><td>감사 추적</td><td>발생 및 해결 과정 기록 및 추적</td><td>로깅, 감사 로그, Decision Logs (OPA) 등의 연계</td></tr><tr><td>규정 준수</td><td>GDPR, SOX 등 가용성 및 감사 요구사항 충족</td><td>거버넌스 프로세스 도입, 정기 검증</td></tr></tbody></table><p>보안 및 거버넌스 관점에서 livelock 을 관리하려면, 단순히 기술적 대응뿐 아니라 정책 기반의 관리 및 사고 예방 체계를 갖추는 것이 중요하다.</p><ul><li>안정성을 보장하기 위해 재시도 로직을 제한하거나 회로 차단기를 도입</li><li>정책은 외부 관리 가능하도록 구성하며, Watchdog 나 OPA 같은 엔진으로 자동</li><li>Timing Attack, 자원 고갈, 정보 누출 등 공격 벡터를 차단</li><li>SLA, 감사, 규정 준수 등 거버넌스 측면의 사전 준비와 증빙 체계 마련</li></ul><p><strong>거버넌스 체계</strong>:</p><pre class=mermaid>graph TB
    A[정책 수립] --&gt; B[표준 정의]
    B --&gt; C[구현 가이드라인]
    C --&gt; D[모니터링 체계]
    D --&gt; E[컴플라이언스 검증]
    E --&gt; F[지속적 개선]
    F --&gt; A
    
    subgraph &#34;거버넌스 요소&#34;
        G[백오프 정책]
        H[재시도 한계]
        I[모니터링 기준]
        J[알림 체계]
    end
    
    B --&gt; G
    B --&gt; H  
    C --&gt; I
    D --&gt; J
</pre><h4 id=모니터링-및-관측성>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성>#</a></h4><p><strong>Observability 구성 요소</strong>:</p><ul><li><strong>Metrics (메트릭):</strong> Retry 횟수, Backoff 시간 분포, Livelock 활성 프로세스 수, 성공률, CPU/응답 지연 등 주요 지표</li><li><strong>Logs (로그):</strong> JSON 기반 구조화 로그에 retry, trace ID, backoff strategy, 남은 시도 횟수 등 포함</li><li><strong>Traces (트레이스):</strong> 개별 요청 흐름에서 livelock 패턴 발생 여부 추적</li></ul><p><strong>도입 효과적인 도구</strong>:</p><ul><li>Prometheus + Grafana: 실시간 시각화 및 알림 기반 대시보드</li><li>AlertManager / Datadog: 이슈 발생 시 즉각 알림 및 운용자 대응 유도</li><li>ELK Stack / Loki: 반복적 패턴 탐지에 유리한 로그 분석</li><li>Jaeger / OpenTelemetry: 분산 시스템 트레이싱 및 trace_id 연계 탐지</li></ul><p><strong>운영 지표 및 경고 기준</strong>:</p><ul><li>CPU 대비 처리량 비율 저하, Retry 급증, Lock 실패율 증가, 지연 시간 확대 등</li><li>이상 패턴: 예) livelock 탐지율이 일정 기준 이상, P95 응답시간 초과 등</li></ul><table><thead><tr><th>카테고리</th><th>구성 요소 / 지표</th><th>설명 및 임계치</th><th>도구</th></tr></thead><tbody><tr><td><strong>성능 지표</strong></td><td>Retry 횟수, Backoff 시간, Livelock 프로세스 수</td><td>이상 증가 시 livelock 가능성 지표</td><td>Prometheus + Grafana</td></tr><tr><td><strong>시스템 지표</strong></td><td>CPU 사용률, 처리량, 응답 지연 (latency)</td><td>CPU 만 높고 처리량 낮을 시 livelock 의심</td><td>Prometheus + Grafana</td></tr><tr><td><strong>로그 기반 탐지</strong></td><td>구조화된 로그 (retry, trace, backoff 전략 등)</td><td>특정 패턴 반복 탐지 (retry loop 등)</td><td>ELK Stack / Loki</td></tr><tr><td><strong>트레이스 분석</strong></td><td>분산 트랜잭션 흐름 (retry loop depth 등)</td><td>livelock 경로 및 상태 변화 분석</td><td>Jaeger / OpenTelemetry</td></tr><tr><td><strong>알림 자동화</strong></td><td>임계치 기반 경보 설정 (e.g., retry 급증 등)</td><td>자동 Alert 발생 → 운영자 개입 유도</td><td>AlertManager / Datadog</td></tr></tbody></table><p>모니터링 및 관측성 전략은 <strong>메트릭, 로그, 트레이스</strong> 세 축을 통합적으로 운영해야 실질적인 livelock 탐지 및 대응이 가능하다.</p><ul><li><strong>메트릭</strong>으로는 retry 빈도, backoff 지속시간, CPU 대비 처리량, 지연시간 등의 지표를 수집</li><li><strong>로그</strong>에서는 retry 패턴과 연관된 상세 데이터를 기록</li><li><strong>트레이스</strong>를 통해 요청 흐름 중심에서 문제 발생 지점을 추적해보는 방식이 핵심이야.<br>이를 Prometheus/Grafana 기반 시스템, 구조적 로그 분석 도구, 분산 트레이싱 툴을 활용해 구현하면, livelock 상태를 실시간으로 인지하고 빠르게 대응할 수 있다.</li></ul><p><strong>핵심 메트릭</strong>:</p><ol><li><strong>성능 메트릭 (Performance Metrics)</strong></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Prometheus 메트릭 정의 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>prometheus_client</span> <span class=kn>import</span> <span class=n>Counter</span><span class=p>,</span> <span class=n>Histogram</span><span class=p>,</span> <span class=n>Gauge</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LivelockMetrics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 재시도 카운터</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>retry_counter</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;livelock_retries_total&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Total number of retries&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;service&#39;</span><span class=p>,</span> <span class=s1>&#39;operation&#39;</span><span class=p>,</span> <span class=s1>&#39;reason&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 백오프 시간 히스토그램</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>backoff_histogram</span> <span class=o>=</span> <span class=n>Histogram</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;livelock_backoff_duration_seconds&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Duration of backoff delays&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;service&#39;</span><span class=p>,</span> <span class=s1>&#39;strategy&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>buckets</span><span class=o>=</span><span class=p>[</span><span class=mf>0.001</span><span class=p>,</span> <span class=mf>0.01</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>5.0</span><span class=p>,</span> <span class=mf>10.0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 현재 라이브락 상태 게이지</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>livelock_gauge</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;livelock_active_processes&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Number of processes in livelock state&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;service&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 성공률 메트릭</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>success_rate</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;livelock_success_rate&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Success rate after retries&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s1>&#39;service&#39;</span><span class=p>,</span> <span class=s1>&#39;operation&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ol><li><strong>로깅 전략</strong>:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15>15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16>16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17>17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18>18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19>19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20>20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21>21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-08-06T15:30:45.123Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;WARN&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;service&#34;</span><span class=p>:</span> <span class=s2>&#34;inventory-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;trace_id&#34;</span><span class=p>:</span> <span class=s2>&#34;abc123def456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;span_id&#34;</span><span class=p>:</span> <span class=s2>&#34;def456ghi789&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Livelock pattern detected&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;details&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;operation&#34;</span><span class=p>:</span> <span class=s2>&#34;decrease_inventory&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;product_id&#34;</span><span class=p>:</span> <span class=s2>&#34;product_001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;retry_count&#34;</span><span class=p>:</span> <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;total_delay_ms&#34;</span><span class=p>:</span> <span class=mi>12450</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;backoff_strategy&#34;</span><span class=p>:</span> <span class=s2>&#34;exponential_jitter&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;current_delay_ms&#34;</span><span class=p>:</span> <span class=mi>2156</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;remaining_attempts&#34;</span><span class=p>:</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;node_id&#34;</span><span class=p>:</span> <span class=s2>&#34;inv-service-pod-3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cluster&#34;</span><span class=p>:</span> <span class=s2>&#34;production-east&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;v1.2.3&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=실무-적용-고려사항-및-주의점>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점>#</a></h4><table><thead><tr><th>카테고리</th><th>주요 고려사항</th><th>권장 사항</th></tr></thead><tbody><tr><td>정책 및 구성 관리</td><td>하드코딩된 재시도 정책은 유연성 부족</td><td>RetryPolicy 설정 외부화, Feature Flag 활용</td></tr><tr><td>충돌 회피 전략</td><td>무한 재시도는 livelock 유발 위험</td><td>지수 백오프 + 랜덤 지터 도입</td></tr><tr><td>공정성 및 우선순위</td><td>한쪽 스레드가 계속 양보만 하며 progress 독점 가능성 존재</td><td>우선순위 기반 큐, aging 적용 통해 starvation 방지</td></tr><tr><td>관측 및 탐지 체계</td><td>livelock 은 외형으로는 활동 중 같아도 진전 없음 → 감지 어려움</td><td>처리량 대비 CPU 비율 모니터링, 진행률 지표 실시간 감시</td></tr><tr><td>테스트 및 운영 지표</td><td>실제 부하 상황에서 livelock 패턴 드러남</td><td>스트레스 테스트, 카오스 엔지니어링 수행, P95 응답 시간 등 지표 수립</td></tr></tbody></table><p>실무에서는 livelock 방지를 위해 아래 사항들을 고려해야 한다:</p><ul><li><strong>정책 설정 (UI / 환경변수 등으로 분리)</strong>: 재시도 로직은 하드코딩보다는 외부에서 제어가 가능하게.</li><li><strong>충돌 회피 전략</strong>: 지수 백오프와 랜덤 지터를 조합하여 동기화된 충돌을 방지하고 livelock 가능성을 줄인다.</li><li><strong>공정성 확보</strong>: 특정 스레드가 계속 양보하지 않도록 우선순위 기반 접근 또는 고령화 로직을 고려.</li><li><strong>모니터링</strong>: 단순한 CPU 사용률이 아닌, 처리량 대비 리소스 사용률을 함께 관찰하면서 livelock 을 조기에 감지해야 한다.</li><li><strong>지표 기반 테스트</strong>: 스트레스 테스트와 실제 운영 지표 (P95 응답시간, CPU 사용률 등) 를 통해 재현 가능한 livelock 패턴을 사전 확인하는 체계가 필요하다.</li></ul><h4 id=성능-최적화-전략-및-고려사항>성능 최적화 전략 및 고려사항<a hidden class=anchor aria-hidden=true href=#성능-최적화-전략-및-고려사항>#</a></h4><table><thead><tr><th>카테고리</th><th>전략/고려사항</th><th>설명 및 권장 사항</th></tr></thead><tbody><tr><td>충돌 회피 전략</td><td>지수 백오프 + 지터</td><td>AWS/Google 등에서 권장, 재시도 동기화 방지</td></tr><tr><td>시스템 보호 전략</td><td>Circuit Breaker 활용</td><td>반복 실패 시 호출 차단, 시스템 안정성 강화</td></tr><tr><td>경쟁 조건 완화 전략</td><td>분산 락 with TTL, 고정 락 순서</td><td>Deadlock/livelock 예방</td></tr><tr><td>동시성 경량화</td><td>Lock-free / wait-free 설계, 크리티컬 최소화</td><td>성능 저하와 충돌 회피 기여</td></tr><tr><td>자원 최적화 전략</td><td>메시지 큐 활용, 배치 처리, 스레드 수 관리</td><td>부하 분산 및 처리 효율 증가</td></tr><tr><td>확장성 및 테스트 전략</td><td>스트레스/카오스 테스트, RTT 기반 적응형 조정</td><td>실전 문제 예측 · 대응 방안 강화</td></tr></tbody></table><ul><li><strong>충돌 회피</strong>: Exponential Backoff 에 Jitter 를 더해 동시 재시도를 분산시키는 패턴</li><li><strong>시스템 보호</strong>: Circuit Breaker 도입으로 반복 실패 시 빠르게 실패 반환, 자원 고갈 방지</li><li><strong>경쟁 조건 완화</strong>: 분산 락 설계 시 TTL, 고유 ID, 선행 순서 기반 정책 적용</li><li><strong>동시성 최소화</strong>: 락프리 설계·lock-free 알고리즘과 크리티컬 섹션 최소화로 오버헤드 및 장애 감소</li><li><strong>자원 최적화</strong>: 큐 기반 처리 및 스레드 관리로 과부하 완화, 메시지 처리 병렬화</li><li><strong>확장성 확보</strong>: 테스트 환경에서 극한 조건 시뮬레이션, 적응형 전략을 통한 성능 유지</li></ul><h3 id=고급-주제-advanced-topics>고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#고급-주제-advanced-topics>#</a></h3><h4 id=현재-도전-과제>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제>#</a></h4><table><thead><tr><th>카테고리</th><th>설명 및 원인</th><th>영향 및 기술 난제</th><th>권장 해결방안</th></tr></thead><tbody><tr><td>탐지 & 진단의 어려움</td><td>livelock 은 외형상 활동 중으로 정상처럼 보여 탐지 어려움</td><td>CPU 만 소모되고 실제 진행 없음 상태를 놓치게 됨</td><td>처리량 대비 지연 기반 상태 무진전 감지 로직 도입</td></tr><tr><td>분산 환경의 복잡성</td><td>네트워크 지연, 동기화 복잡성 등으로 livelock 확산 가능</td><td>시스템 전역에 걸쳐 장기적 성능 저하 및 오류 확산</td><td>전역 분산 트레이싱, 분산 합의 (Raft, PBFT) 또는 카오스 테스트 도입</td></tr><tr><td>클라우드/서버리스 특유 과제</td><td>컨테이너 생명주기, cold start 지연 등으로 livelock 조건 예측 불가능</td><td>서버리스 환경에서 비정형 재시도, 예측 불가한 지연 유발</td><td>함수 &rsquo; 워밍 &lsquo;, AOT 컴파일, 컨테이너 풀링, 프리페치 전략 활용</td></tr><tr><td>비결정성 재현 문제</td><td>race condition 이나 타이밍 의존성으로 발생 빈도 적고 재현 어려움</td><td>QA 테스트 및 운영 중 분석 어려움</td><td>카오스 엔지니어링, 시뮬레이션, 반복 가능한 테스트 환경 구축</td></tr><tr><td>우선순위 및 공정성 문제</td><td>낮은 우선순위 작업의 반복 양보로 진행 정체</td><td>특정 프로세스만 진전, 시스템 전반적인 비효율성 발생</td><td>Aging, Fair Lock 또는 우선순위 리밸런싱 전략 적용</td></tr><tr><td>특수 워크로드 자원 경쟁</td><td>AI/ML GPU 경쟁, 스트리밍 등 고성능 워크로드의 리소스 경합</td><td>학습 지연, 데이터 손실, 시스템 불안정</td><td>우선순위 기반 스케줄링, 리소스 추상화, event sourcing 등 적용</td></tr></tbody></table><p>실제 운영 환경에서는 livelock 을 단순한 락 문제로 바라보기보다, <strong>분산 시스템의 복잡성, 서버리스 특성, 난해한 탐지 조건, 워크로드별 자원 경쟁</strong> 등이 얽힌 기술 난제가 함께 존재한다.<br>이를 해결하기 위해서는 전역 분석 (트레이싱), 운용 자동화 (프로그램 기반 탐지), 인프라 특성에 맞춘 예방 전략 (워밍, 스케줄링 등) 이 함께 필요하다.</p><p><strong>분산 라이브락 사례</strong>:</p><pre class=mermaid>sequenceDiagram
    participant N1 as Node 1
    participant N2 as Node 2  
    participant N3 as Node 3
    participant R as Resource Manager
    
    Note over N1,N3: 분산 환경에서의 라이브락
    
    N1-&gt;&gt;R: Request Lock A
    N2-&gt;&gt;R: Request Lock A
    N3-&gt;&gt;R: Request Lock A
    
    R--&gt;&gt;N1: Lock Denied (N2 has it)
    R--&gt;&gt;N2: Lock Denied (conflict with N1)
    R--&gt;&gt;N3: Lock Denied (conflict detected)
    
    Note over N1,N3: 모든 노드가 동시에 백오프
    
    par Synchronized Backoff
        N1-&gt;&gt;N1: Wait &amp; Retry
    and
        N2-&gt;&gt;N2: Wait &amp; Retry  
    and
        N3-&gt;&gt;N3: Wait &amp; Retry
    end
    
    Note over N1,N3: 동일한 시점에 재시도 → 라이브락
</pre><h4 id=생태계-및-관련-기술>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술>#</a></h4><table><thead><tr><th>카테고리</th><th>연계 기술 및 표준</th><th>활용 목적 및 설명</th></tr></thead><tbody><tr><td>관측성 및 추적</td><td>Istio (Service Mesh), Prometheus, Grafana, Jaeger, OpenTelemetry</td><td>메트릭, 로그, 트레이스를 통한 livelock 조기 탐지 및 분석</td></tr><tr><td>서비스 메시 / CI/CD / AIOps</td><td>Istio, CI/CD 파이프라인, AIOps 플랫폼</td><td>자동 빌드·릴리스·모니터링·사건 대응 자동화</td></tr><tr><td>분산 락 및 일관성 알고리즘</td><td>etcd, Zookeeper, Consul, Raft, PBFT</td><td>분산 환경에서의 리더 선출, 락 조정, livelock 회피</td></tr><tr><td>언어 및 병행성 도구</td><td>Rust, Go, Erlang</td><td>병행성 설계에 적합, livelock 가능성 감소</td></tr><tr><td>정적/동적 검증</td><td>Formal Methods, Model Checking</td><td>livelock 상태 모델 기반 검증 및 사전 예방</td></tr><tr><td>제어 및 보호 메커니즘</td><td>Circuit Breaker, Rate Limiter, Scheduler, Lock-Free 알고리즘</td><td>재시도 차단 및 경쟁 완화 등 시스템 보호 기능</td></tr></tbody></table><p>현재 생태계에서는 OpenTelemetry 기반 관측성과 Istio 서비스 메시의 도입이 livelock 탐지 및 대응의 핵심 뼈대가 되고 있다.<br>분산 락, consensus 알고리즘, 그리고 Circuit Breaker 등 제어 메커니즘은 시스템 보호를 강력하게 만든다.<br>Rust 나 Erlang 같은 병행성 친화적 언어와 Formal Methods 기반 검증기술은 livelock 발생 가능성을 구조적으로 낮출 수 있다.<br>이런 다양한 기술들이 통합적으로 사용될 때 livelock 대응 시스템의 신뢰성과 견고성이 강화된다고 볼 수 있다.</p><p><strong>통합 연계 가능한 기술</strong>:</p><pre class=mermaid>graph LR
    A[라이브락 탐지] --&gt; B[서비스 메시]
    A --&gt; C[컨테이너 오케스트레이션]
    A --&gt; D[분산 추적]
    A --&gt; E[혼돈 공학]
    
    B --&gt; F[Istio/Envoy]
    C --&gt; G[Kubernetes]
    D --&gt; H[Jaeger/Zipkin]
    E --&gt; I[Chaos Monkey]
    
    J[모니터링] --&gt; K[Prometheus/Grafana]
    J --&gt; L[OpenTelemetry]
    J --&gt; M[ELK Stack]
</pre><h4 id=최신-기술-트렌드-및-방향>최신 기술 트렌드 및 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드-및-방향>#</a></h4><p>라이브락 대응은 점차 <strong>지능화 (AI)</strong>, <strong>표준화 (OpenTelemetry)</strong>, **구성 관리화 (OPA)**로 나아가고 있으며, 클라우드·에지·양자 등 특수 환경에 적응하는 기술들이 실험적이나 점점 현실에 다가오고 있음. 기존의 수동 탐지 및 고정 백오프 로직에서 벗어나, 동적인 시스템 상태 분석을 통한 자동 반응 체계로 진화 중이다.</p><table><thead><tr><th><strong>카테고리</strong></th><th><strong>핵심 기술 또는 전략</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>AI 기반 자동화</td><td>AI-Adaptive Backoff, Auto Retry, Reinforcement Learning</td><td>시스템 상태 기반 백오프 시간 예측 및 재시도 제어</td></tr><tr><td>관측성 및 진단</td><td>OpenTelemetry, Observability-First, 진척 메트릭</td><td>로그, 지표, 트레이스 통합 추적 → Livelock 실시간 진단 가능</td></tr><tr><td>구성 중심 제어</td><td>Open Policy Agent (OPA), 구성 정책 기반 재시도/타임아웃 관리</td><td>Retry/Timeout 을 코드에서 분리 → 정책화로 일관성 및 관리성 향상</td></tr><tr><td>분산/블록체인 기반 조정</td><td>스마트 컨트랙트, 블록체인 자원 분배</td><td>분산 락 제어, 탈중앙화 기반 공정한 자원 할당 및 백오프 협조</td></tr><tr><td>미래 대응 기술</td><td>양자 지터, 생체 모방 알고리즘, 에지 대응 전략</td><td>물리 기반 비결정성 활용, 분산 협조 최적화, 특수 환경 적응형 설계</td></tr></tbody></table><ul><li><strong>AI 중심</strong>: 실패 패턴을 학습하고 적응하는 백오프 정책이 주류가 되고 있으며, 과도 재시도 방지에 효과적이다.</li><li><strong>관측 가능성 강화</strong>: 로그, 지표, 트레이스가 통합되어 Livelock 의 진척 없음 상태를 실시간으로 추적 가능하다.</li><li><strong>정책 중심 제어</strong>: Retry/Timeout 제어를 코드가 아닌 선언적 정책으로 외부화하여 운영 일관성을 확보한다.</li><li><strong>분산 자원 조정 기술 확장</strong>: 블록체인이나 스마트 계약 기반의 자원 분배가 실험적으로 도입되며, 공정한 백오프 조정이 가능해진다.</li><li><strong>미래 기술 대응</strong>: 양자 기술의 무작위성, 생체 모방 알고리즘의 집단 협조 전략 등 새로운 형태의 락 회피 기술들이 연구되고 있다.</li></ul><h4 id=livelock-vs-deadlock-vs-starvation>Livelock vs. Deadlock vs. Starvation<a hidden class=anchor aria-hidden=true href=#livelock-vs-deadlock-vs-starvation>#</a></h4><ul><li><strong>Deadlock</strong>: 프로세스들이 서로 자원을 점유한 채 대기하여 아무 작업도 진행되지 않음. 정지 상태 (Blocked) 이며 탐지가 상대적으로 쉬움.</li><li><strong>Livelock</strong>: 프로세스들이 양보하거나 회피하며 상태를 계속 바꾸지만 실질적 진전이 없음. 탐지 어려움.</li><li><strong>Starvation</strong>: 낮은 우선순위 프로세스가 지속적으로 자원을 할당받지 못함. 공정성 문제.</li></ul><table><thead><tr><th>구분</th><th>Deadlock (교착 상태)</th><th>Livelock (활성 정지 상태)</th><th>Starvation (기아 상태)</th></tr></thead><tbody><tr><td>정의</td><td>서로 자원을 점유한 채 대기</td><td>계속 상태 변화하나 작업은 미진행</td><td>자원 할당 우선순위 문제로 계속 밀림</td></tr><tr><td>활동 여부</td><td>없음 (완전 정지)</td><td>있음 (반응은 계속, 진행 없음)</td><td>있음 (진행 가능하나 기회 없음)</td></tr><tr><td>원인</td><td>순환 대기, 자원 점유 등</td><td>서로 양보하거나 재시도 반복</td><td>우선순위 낮거나 자원 부족</td></tr><tr><td>해결 방식</td><td>자원 순서 정리, 타임아웃 설정</td><td>백오프 전략, 랜덤화, 리더 지정</td><td>공정성 (fairness) 보장, 우선순위 제한</td></tr><tr><td>탐지 난이도</td><td>비교적 쉬움 (스레드 정지 감지)</td><td>어려움 (상태 변화는 계속되므로)</td><td>쉬움 (우선순위 로그로 판단 가능)</td></tr></tbody></table><pre class=mermaid>flowchart TB
    subgraph Deadlock
      A1[Process A - waits for B]
      B1[Process B - waits for A]
      A1 --&gt; B1
      B1 --&gt; A1
    end

    subgraph Livelock
      A2[Process A - retries]
      B2[Process B - retries]
      A2 --&gt;|yield| B2
      B2 --&gt;|yield| A2
    end
</pre><ul><li><strong>Deadlock</strong>: 양쪽이 서로 자원을 기다리며 멈춤 (진전 없음, 정지)</li><li><strong>Livelock</strong>: 양쪽이 서로 양보하며 무한 반복 (진전 없음, 동작은 계속됨)</li></ul><hr><h2 id=정리-및-학습-가이드>정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#정리-및-학습-가이드>#</a></h2><h3 id=내용-종합><strong>내용 종합</strong><a hidden class=anchor aria-hidden=true href=#내용-종합>#</a></h3><p>Livelock 은 <strong>시스템이 중단되지 않고 계속 활동하지만 실질적인 작업은 이루어지지 않는 상태</strong>로, 특히 마이크로서비스 및 클라우드 기반 분산 환경에서 탐지 및 대응이 까다로운 병목 유형이다. 데드락과 달리 외부에서 정상처럼 보이기 때문에 <strong>관측성, 자동화 탐지, 정책 제어</strong> 등의 복합적인 대응 체계가 필요하다.</p><h4 id=현대-기술-트렌드>현대 기술 트렌드<a hidden class=anchor aria-hidden=true href=#현대-기술-트렌드>#</a></h4><p>현대 기술 트렌드는 다음과 같은 5 가지 방향으로 정리된다:</p><ol><li><strong>AI 기반 동적 정책 생성</strong><ul><li>백오프 시간, 재시도 횟수 등을 실시간 학습 기반으로 조정</li></ul></li><li><strong>정교한 관측성 체계 구축</strong><ul><li>OpenTelemetry, 분산 트레이싱, 진척 메트릭을 활용한 비정상 상태 감지</li></ul></li><li><strong>구성 중심 제어 모델 채택</strong><ul><li>Retry/Timeout 등의 동작을 정책 기반으로 외부화 (OPA 등)</li></ul></li><li><strong>미래 환경 대응 기술 실험</strong><ul><li>양자 기반 동기화 회피, 블록체인 자원 분배, 생체 모방 자율 협업 알고리즘 등</li></ul></li><li><strong>서버리스/엣지 환경 최적화</strong><ul><li>함수 단위 백오프, 지역 기반 분산 제어, 리소스 경합 예방 전략 도입</li></ul></li></ol><table><thead><tr><th>분류</th><th>핵심 트렌드</th><th>설명</th></tr></thead><tbody><tr><td><strong>AI 기반 대응</strong></td><td>AI-Adaptive Backoff</td><td>머신러닝 기반 백오프/재시도 제어로 Livelock 회피</td></tr><tr><td><strong>관측성 강화</strong></td><td>Observability-First</td><td>OpenTelemetry 및 진척 메트릭 기반 실시간 탐지 및 자동화 대응</td></tr><tr><td><strong>정책 기반 제어</strong></td><td>OPA, Retry Policy 외부화</td><td>Retry/Timeout 로직을 정책으로 선언적 관리하여 유지보수성 향상</td></tr><tr><td><strong>서버리스/엣지 대응</strong></td><td>Cold Start 대응, 지역 락 방지</td><td>Lambda, K8s, IoT 등 환경에서의 동적 동기화 문제 완화</td></tr><tr><td><strong>미래 지향 기술</strong></td><td>블록체인, 양자, 생체 모방 알고리즘</td><td>신뢰 없는 환경에서의 협조적 자원 분배 및 동기화 회피 설계</td></tr></tbody></table><ul><li><p><strong>AI 기반 대응</strong>은 Livelock 예방의 핵심으로, 반복된 실패 패턴을 학습하여 재시도 전략을 최적화한다.</p></li><li><p><strong>관측성 강화</strong>는 단순 Alive 체크를 넘어서, 진척률 기반의 지표로 Livelock 상태를 조기에 파악할 수 있게 한다.</p></li><li><p><strong>정책 기반 제어</strong>는 로직과 운영을 분리하여 시스템 일관성을 확보하며, 실시간 정책 변경에도 유연하게 대응한다.</p></li><li><p><strong>서버리스/엣지 대응</strong>은 제한된 리소스 환경에서의 재시도 병목 문제를 최소화하고 지연을 줄이는 전략을 포함한다.</p></li><li><p><strong>미래 기술</strong>은 아직 실험 단계지만, 분산 시스템의 새로운 동기화 모델로 주목받고 있다.</p></li></ul><h3 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h3><table><thead><tr><th>단계</th><th>목표</th><th>주요 내용</th><th>도구/언어 예시</th></tr></thead><tbody><tr><td>1 단계</td><td>기초 개념 이해</td><td>동시성 문제 이해, 프로세스 상태, 데드락/라이브락 차이</td><td>-</td></tr><tr><td>2 단계</td><td>탐지 및 진단 기법 학습</td><td>정적/동적 분석, 메트릭 기반 탐지, 로그 이상 감지</td><td>ELK, Jaeger</td></tr><tr><td>3 단계</td><td>예방 및 대응 전략 습득</td><td>백오프, Retry Policy, Circuit Breaker, Rate Limiting 설계</td><td>Resilience4j</td></tr><tr><td>4 단계</td><td>실무 구현 경험 축적</td><td>코드 기반 구현, 관측성 도구 연동, 지표 기반 자동화 대응</td><td>Python, Go</td></tr><tr><td>5 단계</td><td>고급 최적화 및 자동화</td><td>AI 기반 적응형 백오프, 시스템 리소스 기반 동적 조정</td><td>scikit-learn</td></tr><tr><td>6 단계</td><td>전문가 수준 연구 및 응용</td><td>TLA+, SMT Solver, 양자 기반 기법, 생체 모방 알고리즘</td><td>Alloy, Z3</td></tr></tbody></table><ul><li><p><strong>1 단계에서는 기본 개념과 동시성 문제의 본질</strong>을 이해하는 데 집중해야 한다. 이때 실생활 예시를 활용한 개념 연결이 효과적이다.</p></li><li><p><strong>2 단계는 탐지 기술의 폭을 넓히는 과정</strong>으로, 정적 분석 도구와 실시간 지표 수집/분석 능력을 함께 키워야 한다.</p></li><li><p><strong>3 단계에서는 적극적 예방과 제어 기술</strong>을 습득하며, Retry, 백오프, Rate Limiting, Circuit Breaker 등을 실무 맥락에서 설계할 수 있어야 한다.</p></li><li><p><strong>4 단계는 구현 중심의 실습 단계</strong>로, 각 기술을 코드로 실현하며 관측 도구와 연계하여 통합 대응 시스템을 완성한다.</p></li><li><p><strong>5 단계에서는 AI 기술과 고급 최적화 전략</strong>을 접목하여 실시간 적응형 대응 체계를 설계하고, 운영 효율성을 극대화한다.</p></li><li><p><strong>6 단계는 수학적 모델링 및 최신 기술 연구 영역</strong>으로, Livelock 문제를 이론적 기반까지 확장해 해결하고, 미래 환경까지 고려한 응용력을 확보한다.</p></li></ul><h3 id=학습-항목-매트릭스><strong>학습 항목 매트릭스</strong><a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스>#</a></h3><table><thead><tr><th>단계</th><th>카테고리</th><th>항목</th><th>중요도</th><th>설명</th></tr></thead><tbody><tr><td>1</td><td>기초</td><td>Livelock 정의 및 구분</td><td>필수</td><td>Deadlock/Starvation 과 비교, 개념 정립</td></tr><tr><td>2</td><td>이론</td><td>발생 메커니즘/상태 전이 구조</td><td>필수</td><td>동기화, 양보, 루프 기반 상태 흐름 이해</td></tr><tr><td>2</td><td>이론</td><td>비동기 설계 전략 (지터/백오프)</td><td>필수</td><td>재시도 충돌 방지 및 비결정성 확보 전략</td></tr><tr><td>3</td><td>분석</td><td>특성 분석 및 트레이드오프</td><td>권장</td><td>탐지/예방 기법 간 장단점 파악</td></tr><tr><td>3</td><td>분석</td><td>Wait-for Graph / CSP 모델</td><td>선택</td><td>수학적 기반의 구조 분석</td></tr><tr><td>4</td><td>구현/실습</td><td>백오프 구현 및 분산 락 구조</td><td>필수</td><td>Redis, Zookeeper 연계 구현</td></tr><tr><td>4</td><td>구현/실습</td><td>재시도 시뮬레이션 및 실습 예제</td><td>권장</td><td>반복 조건 구현 실험</td></tr><tr><td>5</td><td>운영/관측</td><td>관측성 지표 설계 및 메트릭 활용</td><td>필수</td><td>Prometheus, OTEL, 로그 기반 진단</td></tr><tr><td>5</td><td>운영/관측</td><td>자동 대응 구성 (Circuit Breaker 등)</td><td>권장</td><td>SLA 기반 트리거링 전략</td></tr><tr><td>6</td><td>테스트/보증</td><td>Chaos Test / QA 체크리스트</td><td>권장</td><td>병행성 조건 재현 및 검증 절차</td></tr><tr><td>7</td><td>고급/미래지향</td><td>Lock-Free / CAS / AI 예측 설계</td><td>선택</td><td>고성능 병렬 시스템 대응 전략</td></tr><tr><td>7</td><td>고급/미래지향</td><td>Formal Verification, 양자/바이오 모델</td><td>선택</td><td>최신 이론 기반 연구 방향</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의 요약</th><th>관련 개념</th></tr></thead><tbody><tr><td>핵심 동시성 개념</td><td>Livelock</td><td>상태 변화는 있으나 진전 없는 병행성 문제</td><td>Deadlock, Starvation</td></tr><tr><td></td><td>Deadlock</td><td>자원 대기로 시스템 전체 정지</td><td>Circular Wait</td></tr><tr><td></td><td>Starvation</td><td>자원 접근 기회를 박탈당한 상태</td><td>Priority Inversion</td></tr><tr><td>동기화 및 병행 제어 구조</td><td>Mutex</td><td>하나의 프로세스만 임계 영역 접근 가능</td><td>Critical Section</td></tr><tr><td></td><td>Semaphore</td><td>제한된 수의 프로세스가 자원 접근 가능</td><td>Mutex, Resource Count</td></tr><tr><td></td><td>Spinlock</td><td>락이 풀릴 때까지 반복 확인하는 락 방식</td><td>Busy Wait</td></tr><tr><td></td><td>Lock-Free</td><td>락 없이도 전체적 진전을 보장하는 구조</td><td>CAS, Atomic Operation</td></tr><tr><td></td><td>Wait-Free</td><td>개별 스레드도 진전을 보장하는 구조</td><td>Lock-Free</td></tr><tr><td>재시도/대기 알고리즘</td><td>Backoff</td><td>실패 후 일정 시간 (랜덤 포함) 대기 후 재시도</td><td>Retry, Timeout</td></tr><tr><td></td><td>Jitter</td><td>Backoff 시간에 무작위성 추가</td><td>Randomization</td></tr><tr><td></td><td>Timeout</td><td>일정 시간 동안 성공하지 못하면 중단</td><td>Watchdog, Fail-fast</td></tr><tr><td>감지/운영/모니터링</td><td>Observability</td><td>시스템 상태를 관측하고 분석하는 능력</td><td>Logging, Metrics, Tracing</td></tr><tr><td></td><td>Probe</td><td>상태 확인을 위한 감시 메시지</td><td>Health Check</td></tr><tr><td></td><td>Activity Monitoring</td><td>상태 변화 없이 자원 사용률 지속 시 탐지 지표</td><td>Livelock Detection</td></tr><tr><td>실무 운영 패턴/도구</td><td>Circuit Breaker</td><td>실패가 누적될 경우 실행 중단을 통해 장애 확산 방지</td><td>Retry Limit, Resilience4j</td></tr><tr><td></td><td>Auto-Remediation</td><td>장애 탐지 시 자동 복구 수행</td><td>Alerting, Self-healing</td></tr><tr><td>병행성 분석 및 테스트</td><td>Chaos Testing</td><td>장애를 주입하여 시스템 복원력 검증</td><td>Fault Injection, Resilience</td></tr><tr><td></td><td>Concurrency QA</td><td>병행 환경에서 오류 시나리오 탐지용 테스트</td><td>Race Detection</td></tr><tr><td>분산 시스템 구성 요소</td><td>Distributed Lock</td><td>다수 노드에서 공유 자원 접근 제어용 락</td><td>ZooKeeper, Consensus</td></tr><tr><td></td><td>CSP</td><td>메시지 기반 동시성 모델링 기법</td><td>채널 통신, 프로세스 대수</td></tr><tr><td></td><td>NAPI</td><td>리눅스 커널에서 네트워크 인터럽트 혼잡 완화 기법</td><td>Polling 최적화, Livelock 회피</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://www.geeksforgeeks.org/operating-systems/deadlock-starvation-and-livelock/>Deadlock, Starvation and Livelock – GeeksforGeeks</a></li><li><a href=https://www.baeldung.com/cs/deadlock-livelock-starvation>Deadlock, Livelock and Starvation – Baeldung</a></li><li><a href=https://docs.oracle.com/javase/tutorial/essential/concurrency/starvelive.html>Java™ Tutorials – Starvation and Livelock</a></li><li><a href=https://stackoverflow.com/questions/6155951/whats-the-difference-between-deadlock-and-livelock>What’s the difference between deadlock and livelock? – StackOverflow</a></li><li><a href=https://www.numberanalytics.com/blog/livelock-in-algorithm-design-ultimate-guide>Livelock in Algorithm Design: Ultimate Guide – NumberAnalytics</a></li><li><a href=https://en.wikipedia.org/wiki/Deadlock_%28computer_science%29>Deadlock (computer science) – Wikipedia</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>