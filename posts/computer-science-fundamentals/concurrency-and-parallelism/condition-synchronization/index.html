<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Condition Synchronization | hyunyoun's Blog</title><meta name=keywords content="Computer-Science-Fundamentals,Concurrency-and-Parallelism,Condition-Synchronization,Condition-Variable"><meta name=description content="조건 동기화는 스레드가 특정 조건이 충족될 때까지 안전하게 대기하고, 조건이 참이면 다른 스레드의 신호를 통해 실행을 재개하는 메커니즘이다. 조건 변수는 뮤텍스와 함께 사용되며, busy-waiting 없이 효율적 동기화를 제공한다. Producer-Consumer 문제 등에서 자주 활용된다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/condition-synchronization/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/condition-synchronization/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/condition-synchronization/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/condition-synchronization/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Condition Synchronization"><meta property="og:description" content="조건 동기화는 스레드가 특정 조건이 충족될 때까지 안전하게 대기하고, 조건이 참이면 다른 스레드의 신호를 통해 실행을 재개하는 메커니즘이다. 조건 변수는 뮤텍스와 함께 사용되며, busy-waiting 없이 효율적 동기화를 제공한다. Producer-Consumer 문제 등에서 자주 활용된다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Condition Synchronization"><meta name=twitter:description content="조건 동기화는 스레드가 특정 조건이 충족될 때까지 안전하게 대기하고, 조건이 참이면 다른 스레드의 신호를 통해 실행을 재개하는 메커니즘이다. 조건 변수는 뮤텍스와 함께 사용되며, busy-waiting 없이 효율적 동기화를 제공한다. Producer-Consumer 문제 등에서 자주 활용된다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기록하고 기억하고 활용하자.","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Computer Science Fundamentals","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/"},{"@type":"ListItem","position":3,"name":"Concurrency and Parallelism","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/"},{"@type":"ListItem","position":4,"name":"Condition Synchronization","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/condition-synchronization/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>기록하고 기억하고 활용하자.</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/>Computer Science Fundamentals</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/>Concurrency and Parallelism</a></div><h1>Condition Synchronization</h1><div class=post-description>조건 동기화는 스레드가 특정 조건이 충족될 때까지 안전하게 대기하고, 조건이 참이면 다른 스레드의 신호를 통해 실행을 재개하는 메커니즘이다. 조건 변수는 뮤텍스와 함께 사용되며, busy-waiting 없이 효율적 동기화를 제공한다. Producer-Consumer 문제 등에서 자주 활용된다.</div></header><div class=post-content><h2 id=condition-synchronization-조건-동기화>Condition Synchronization (조건 동기화)<a hidden class=anchor aria-hidden=true href=#condition-synchronization-조건-동기화>#</a></h2><p>조건 동기화는 다중 스레드 또는 프로세스가 특정 조건이 충족될 때까지 안전하게 대기하고, 이후 조건 만족 시 실행을 재개하도록 하는 고급 동기화 기법이다.</p><p>이는 조건 변수, 세마포어, 모니터 등의 도구를 통해 구현되며, busy-waiting 없이 CPU 효율을 높인다. 자원 경쟁을 방지하고 실행 순서를 제어하며, 대표적으로 생산자 - 소비자, 리더 - 라이터 문제 해결에 활용된다.</p><p>Java 의 <code>wait/notify</code>, Python 의 <code>threading.Condition</code>, POSIX 의 <code>pthread_cond_t</code> 등에서 지원되며, 클라우드 기반 아키텍처나 커널 수준에서도 필수적으로 적용된다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p>조건 동기화는 동시성 프로그래밍에서 <strong>상태 기반 흐름 제어</strong>를 담당하는 핵심 메커니즘이다.<br>주요 구성 요소는 조건 변수, 뮤텍스, 임계 구역 등이며, wait/notify 패턴을 통해 스레드 협조가 이루어진다.</p><p><strong>기본 개념</strong>으로는 조건 변수와 뮤텍스,<br><strong>이론적 측면</strong>에서는 Guarded Block 및 시맨틱스 구분,<br><strong>실무적 관점</strong>에서는 Monitor, Broadcast 사용,<br><strong>심화 개념</strong>으로는 스퓨리어스 웨이크업, 우선순위 역전, 컨보이 효과 등이 있다.</p><p>이러한 개념은 생산자 - 소비자 문제, 병렬 서버, 이벤트 처리 등 다양한 실무 시나리오에 직접 적용되며, POSIX, Java, Python, Windows 등 주요 플랫폼에서 표준으로 지원되고 있다.</p><table><thead><tr><th>구분</th><th>개념</th><th>설명</th></tr></thead><tbody><tr><td><strong>기본</strong></td><td>조건 동기화</td><td>특정 조건이 만족될 때까지 스레드를 일시 중단</td></tr><tr><td></td><td>조건 변수</td><td>조건 만족 여부에 따라 스레드를 wait/notify</td></tr><tr><td></td><td>뮤텍스</td><td>임계 구역 보호를 위한 상호 배제</td></tr><tr><td></td><td>임계 구역</td><td>공유 자원 접근이 보호되어야 하는 코드 영역</td></tr><tr><td><strong>이론</strong></td><td>Guarded Block</td><td>조건을 반복 검사하며 wait 하는 블록</td></tr><tr><td></td><td>Hoare / Mesa</td><td>신호 후 실행 순서 시맨틱스 차이</td></tr><tr><td><strong>실무</strong></td><td>Wait / Notify</td><td>조건 기반 상태 전이 메커니즘</td></tr><tr><td></td><td>Broadcast vs Signal</td><td>다중 vs 단일 스레드 통지</td></tr><tr><td></td><td>Monitor</td><td>뮤텍스 + 조건 변수 통합 추상화 구조</td></tr><tr><td><strong>심화</strong></td><td>Spurious Wakeup</td><td>신호 없이 스레드가 깨어나는 예외 케이스</td></tr><tr><td></td><td>우선순위 역전</td><td>낮은 우선순위가 높은 우선순위를 블로킹하는 현상</td></tr><tr><td></td><td>컨보이 효과</td><td>느린 스레드로 전체가 지연되는 병목 현상</td></tr></tbody></table><h4 id=실무-연관성-및-적용-방식-정리>실무 연관성 및 적용 방식 정리<a hidden class=anchor aria-hidden=true href=#실무-연관성-및-적용-방식-정리>#</a></h4><table><thead><tr><th>개념</th><th>실무 구현 연관성</th><th>적용 방식 / API</th><th>주요 사례</th></tr></thead><tbody><tr><td>조건 변수</td><td>매우 높음</td><td><code>pthread_cond</code>, <code>std::condition_variable</code>, <code>threading.Condition</code></td><td>생산자 - 소비자, 스레드풀</td></tr><tr><td>뮤텍스</td><td>높음</td><td><code>pthread_mutex</code>, <code>threading.Lock</code></td><td>임계 구역 보호, 병렬 데이터 접근</td></tr><tr><td>Guarded Block</td><td>매우 높음</td><td><code>while (!condition) wait()</code></td><td>spurious wakeup 방지</td></tr><tr><td>Monitor</td><td>높음</td><td>Java <code>synchronized</code>, Python <code>with Condition()</code></td><td>객체 동기화, 스레드 협조</td></tr><tr><td>Broadcast</td><td>중간~높음</td><td><code>notify_all()</code>, <code>pthread_cond_broadcast</code></td><td>다중 스레드 알림</td></tr><tr><td>Spurious Wakeup</td><td>중간</td><td>Guarded block 으로 대응</td><td>성능 안정성 확보</td></tr><tr><td>우선순위 역전</td><td>중간~높음</td><td>Priority Inheritance 알고리즘</td><td>실시간 시스템, OS 커널</td></tr><tr><td>컨보이 효과</td><td>중간</td><td>큐 기반 동기화 최적화</td><td>고성능 서버, 병렬 시스템</td></tr></tbody></table><ul><li><strong>조건 동기화</strong>는 특정 조건이 만족되기 전까지 스레드의 실행을 중단하고, 조건이 충족되면 재개시키는 메커니즘으로, 동기화 흐름 제어의 핵심이다.</li><li><strong>조건 변수</strong>는 <code>wait()</code> 와 <code>notify()</code> 를 통해 스레드 간 상태 기반 통신을 가능하게 하며, 보통 <strong>뮤텍스</strong>와 함께 사용된다.</li><li>실무에서는 생산자 - 소비자 문제, 이벤트 대기, 비동기 처리 등에서 매우 자주 사용된다.</li><li><strong>스퓨리어스 웨이크업</strong>, <strong>우선순위 역전</strong>, <strong>컨보이 효과</strong> 등은 동기화 구현 시 성능 및 안정성에 영향을 주는 고급 이슈이다.</li></ul><h3 id=기초-이해-foundation-understanding>기초 이해 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#기초-이해-foundation-understanding>#</a></h3><h4 id=개념-정의-및-본질>개념 정의 및 본질<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질>#</a></h4><p>조건 동기화는 멀티스레드 환경에서 스레드가 특정 조건이 만족될 때까지 대기하고, 조건이 충족되면 신호를 받아 실행을 재개하는 동기화 메커니즘이다.<br>조건 변수는 뮤텍스와 함께 사용되어 공유 자원의 상태를 안전하게 제어하며, busy-waiting 없이 효율적인 협조 실행을 가능하게 한다.<br>이는 단순한 락보다 고도화된 방식으로, 동시성 프로그래밍에서 상태 기반 제어를 구현하는 핵심 기술이다.</p><h4 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h4><h5 id=등장-배경>등장 배경<a hidden class=anchor aria-hidden=true href=#등장-배경>#</a></h5><p>조건 동기화는 1960 년대 후반, 멀티프로그래밍 시스템에서 여러 프로세스가 동시에 공유 자원에 접근하면서 발생한 <strong>경쟁 상태 (Race Condition)</strong> 문제를 해결하기 위한 수단으로 등장했다.</p><p>초기에는 <strong>Busy Waiting</strong> 기법을 통해 자원 접근을 제어했지만, 이는 CPU 낭비가 심각하다는 단점을 가졌다. 이를 해결하기 위해 <strong>Edsger Dijkstra</strong>는 세마포어를 도입하여 자원 접근을 제어했으며, 이후 <strong>C.A.R. Hoare</strong>와 <strong>Per Brinch Hansen</strong>이 <strong>모니터 (Monitor)</strong> 개념을 제안하면서 조건 변수를 통한 효율적인 스레드 협조 방식이 개발되었다.</p><p>이들은 현대 동기화 구조의 기초를 형성하였으며, 조건 동기화는 이후 다양한 프로그래밍 언어와 운영체제에서 필수 요소로 발전하게 되었다.</p><h5 id=발전-과정>발전 과정<a hidden class=anchor aria-hidden=true href=#발전-과정>#</a></h5><table><thead><tr><th>시기</th><th>주요 사건 및 기술</th><th>설명</th></tr></thead><tbody><tr><td><strong>1965~1968</strong></td><td>Dijkstra 의 세마포어</td><td>P(), V() 연산으로 임계 구역 보호</td></tr><tr><td><strong>1974</strong></td><td>Hoare 의 Monitor 이론</td><td>조건 변수 기반의 구조화된 동기화 개념 제시</td></tr><tr><td><strong>1975</strong></td><td>Concurrent Pascal 에서 Monitor 구현</td><td>모니터 기반 언어적 실험</td></tr><tr><td><strong>1995</strong></td><td>POSIX pthread 조건 변수 도입</td><td><code>pthread_cond_wait</code> 등 표준화된 조건 동기화 API</td></tr><tr><td><strong>1995</strong></td><td>Java 1.0 <code>wait()/notify()</code> 제공</td><td>객체 수준에서 조건 변수 지원</td></tr><tr><td><strong>2000 년대</strong></td><td>Python <code>threading.Condition</code> 도입</td><td>고수준 조건 동기화 추상화 제공</td></tr><tr><td><strong>2011</strong></td><td>C++11 <code>std::condition_variable</code> 도입</td><td>RAII 기반 동기화 구조 확립</td></tr><tr><td><strong>2020~2024</strong></td><td>Async/await 및 리액티브 시스템과의 통합</td><td>비동기 환경에서도 조건 동기화 방식이 재해석됨</td></tr></tbody></table><pre class=mermaid>timeline
    title 조건 동기화 발전 과정 타임라인

    1965 : Dijkstra 세마포어 개념 발표
    1974 : Hoare Monitor 개념 도입
    1975 : Concurrent Pascal에서 Monitor 최초 구현
    1995 : POSIX 스레드 조건 변수 API 도입
    1995 : Java 1.0 wait notify 메서드 제공
    2000 : Python Threading Condition 클래스 도입
    2011 : C Plus Plus 11 표준에서 조건 변수 포함
    2024 : 비동기 리액티브 시스템 적용 확대
</pre><h4 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h4><table><thead><tr><th><strong>카테고리</strong></th><th><strong>핵심 동기 / 가치 제안</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td>CPU 효율성</td><td>바쁜 대기 (Busy-Wait) 제거</td><td>이벤트 기반 대기로 CPU 점유율 감소 및 자원 낭비 방지</td></tr><tr><td>스레드 협력 및 제어</td><td>조건 기반 스레드 흐름 제어</td><td>조건 충족 시 스레드를 순차적으로 실행, 협업 방식 설계 용이</td></tr><tr><td>자원 보호 및 무결성</td><td>데이터 경쟁 방지, 일관된 자원 접근 보장</td><td>공유 자원 접근 시 충돌 방지 및 일관성 유지</td></tr><tr><td>확장성과 안정성</td><td>병목 없는 동시성 확장 구조</td><td>다수 스레드 환경에서도 성능 저하 없이 유연하게 작동</td></tr><tr><td>시스템 반응성</td><td>조건 발생 즉시 처리 가능</td><td>이벤트나 상태 변화에 대한 빠른 대응 구조 구성</td></tr><tr><td>유지보수성</td><td>명시적 조건 구조로 디버깅 용이</td><td>조건 기반 흐름으로 논리적 구조가 명확하여 유지보수 간편</td></tr><tr><td>에너지 효율성</td><td>불필요한 연산 제거로 전력 절감</td><td>Idle 상태에서 CPU/전력 사용 최소화, 모바일/임베디드에 적합</td></tr></tbody></table><p>조건 동기화의 목적과 가치는 <strong>멀티스레드 환경에서 발생하는 자원 경쟁, 스케줄링, 상태 제어 문제</strong>를 구조적으로 해결함으로써 시스템의 성능, 안정성, 확장성을 확보하는 데 있다.<br>특히 CPU 효율성을 높이고, 스레드 간 협업을 유도하며, 조건 기반 처리 흐름을 통해 빠른 반응성과 유지보수성을 갖춘 설계를 가능하게 한다.<br>이는 현대의 복잡한 병렬 시스템, 서버, 모바일, IoT 시스템에서 실질적인 이점을 제공한다.</p><pre class=mermaid>graph TB
    A[멀티스레딩 환경] --&gt; B[동기화 문제]
    B --&gt; C[경쟁 상태]
    B --&gt; D[데이터 불일치]
    B --&gt; E[자원 접근 충돌]
    
    C --&gt; F[컨디션 동기화]
    D --&gt; F
    E --&gt; F
    
    F --&gt; G[안전한 스레드 협력]
    F --&gt; H[효율적 자원 활용]
    F --&gt; I[시스템 안정성]
</pre><h4 id=주요-특징>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징>#</a></h4><p>조건 동기화는 단순한 락 기반 제어를 넘어서, <strong>조건 상태 변화에 따른 흐름 제어</strong>, <strong>스레드 효율성 극대화</strong>, 그리고 <strong>우선순위 기반 자원 접근 제어</strong>를 가능하게 한다.</p><p>이때 <code>mutex</code> 와 조건 변수는 항상 결합되어 사용되며, 대기 스레드는 커널 큐에 안전하게 등록된다. <code>while</code> 루프를 통한 조건 재확인이 필수이며, <code>notify_one</code>, <code>notify_all</code> 등의 신호 메커니즘으로 선택적 스레드 깨어남이 가능하다.</p><p>현대 구현은 대부분 CAS 등의 원자적 연산을 통해 상태 불일치를 방지하고, <code>ReentrantLock</code>, <code>Priority Inheritance</code> 같은 고급 기능을 통해 실시간성까지 보장한다.</p><table><thead><tr><th><strong>특징</strong></th><th><strong>설명</strong></th><th><strong>기술적 근거</strong></th></tr></thead><tbody><tr><td>조건부 대기</td><td>조건이 만족될 때까지 스레드는 <code>wait()</code> 를 호출하여 블로킹 상태로 진입</td><td>커널의 대기 큐에 등록되며, busy-waiting 없이 CPU 리소스 절약</td></tr><tr><td>락과의 결합 사용</td><td><code>mutex</code> 와 함께 사용하여 조건 검사 및 대기 전환이 원자적으로 이루어짐</td><td><code>compare-and-swap</code>, <code>test-and-set</code> 등 하드웨어 원자 연산 사용</td></tr><tr><td>조건 재확인 필요</td><td>Spurious Wakeup 방지를 위해 <code>while</code> 로 조건 재확인</td><td>인터럽트, 시그널 등 외부 이벤트로 인한 불확실한 깨어남 가능성 존재</td></tr><tr><td>신호 메커니즘</td><td><code>notify_one()</code>, <code>notify_all()</code> 등으로 조건 충족 시 대기 중인 스레드에 신호 전송</td><td>OS 내부 대기 큐 및 스케줄러와 연동하여 효율적인 스레드 전환 지원</td></tr><tr><td>재진입 가능 락 지원</td><td>동일 스레드가 락을 중첩해서 획득할 수 있음</td><td>Java 의 <code>ReentrantLock</code>, Python 의 <code>RLock</code> 등 스레드 ID 기반 재귀 제어</td></tr><tr><td>우선순위 상속</td><td>낮은 우선순위 스레드가 높은 우선순위 스레드의 자원을 점유했을 때 임시 우선순위를 상속받아 역전 방지</td><td>실시간 OS 나 커널 스케줄러에서 제공하는 Priority Inheritance 메커니즘</td></tr></tbody></table><ul><li><strong>조건부 대기와 락 결합</strong>은 조건 동기화의 핵심으로, 조건 만족 전까지 스레드를 안전하게 블로킹하고, 락을 통해 자원 접근의 원자성을 보장한다.</li><li><strong>Spurious Wakeup 대응을 위한 조건 재확인</strong>은 실제 시스템에서의 신뢰성 확보를 위한 필수 절차이다.</li><li><strong>신호 메커니즘은 단일 또는 다수 스레드 깨우기가 가능</strong>하며, 이를 통해 자원 소비 최적화 또는 병렬 처리를 설계할 수 있다.</li><li><strong>재진입 락과 우선순위 상속</strong>은 실시간 시스템이나 고성능 애플리케이션에서 안정성과 응답성을 확보하기 위한 고급 동기화 전략이다.</li></ul><h3 id=핵심-이론-core-theory>핵심 이론 (Core Theory)<a hidden class=anchor aria-hidden=true href=#핵심-이론-core-theory>#</a></h3><h4 id=핵심-설계-원칙>핵심 설계 원칙<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙>#</a></h4><p>조건 동기화의 핵심 설계 원칙은,</p><ul><li><strong>스레드 안전성과 효율성</strong></li><li><strong>조건 기반 제어의 명확성</strong></li><li><strong>공정한 스케줄링</strong>을 달성하기 위한 기반 규칙이다.</li></ul><p>스레드는 자원 접근 전에 락을 소유하고 조건을 확인하며, 조건이 만족되지 않으면 <code>while</code> 루프와 함께 <code>wait()</code> 를 호출한다.<br>신호는 조건을 변경한 측에서 책임지고 <code>notify()</code> 를 호출하며, 이 모든 과정은 <strong>원자적이고 메모리 일관성</strong>을 갖도록 설계된다.<br>이러한 원칙은 데드락을 방지하고, CPU 리소스를 절약하며, 모든 스레드에 공평한 실행 기회를 부여한다.</p><table><thead><tr><th><strong>설계 원칙</strong></th><th><strong>설명</strong></th><th><strong>기술적 근거 / 구현 예시</strong></th></tr></thead><tbody><tr><td><strong>원자성 보장</strong></td><td>조건 검사와 대기 (또는 해제) 가 분리되지 않도록 함</td><td><code>mutex + condition</code> 을 함께 사용하여 race condition 방지</td></tr><tr><td><strong>조건 기반 대기</strong></td><td>조건이 만족될 때까지 <code>while (!cond) wait()</code> 방식으로 명시적 대기</td><td>Spurious Wakeup 방지, 상태 기반 동작 명확화</td></tr><tr><td><strong>락 선점 후 조건 검사</strong></td><td>자원 접근 전 락을 획득한 상태에서 조건을 점검</td><td>상태와 자원의 일관성 유지, 동시 수정 방지</td></tr><tr><td><strong>신호자 책임 원칙</strong></td><td>조건을 변경한 측이 반드시 <code>notify()</code> 또는 <code>signal()</code> 을 호출해야 함</td><td>조건을 아는 주체만이 안전한 깨어남을 유도할 수 있음</td></tr><tr><td><strong>메모리 일관성 보장</strong></td><td>상태 변화가 모든 스레드에 일관되게 보이도록 함</td><td>Memory Barrier, Happens-Before (JMM, C++ Memory Model 등)</td></tr><tr><td><strong>공정성 확보</strong></td><td>모든 대기 중인 스레드가 차별 없이 실행될 수 있도록 설계</td><td>FIFO 대기 큐 (POSIX), AQS 기반 공정성 설정 (Java 등)</td></tr><tr><td><strong>데드락 방지</strong></td><td>교착 상태를 피하기 위한 순환 대기 차단</td><td>Lock 순서 고정, 타임아웃 사용, lock hierarchy 등</td></tr><tr><td><strong>자원 효율성</strong></td><td>불필요한 busy-waiting 없이 효율적인 스레드 블로킹 및 깨어남 설계</td><td>OS 대기 큐, Futex, 조건 변수 내부 큐 기반 효율적 전환 구현</td></tr></tbody></table><ul><li><p><strong>조건 동기화의 기본은 " 조건 검사 → 대기 → 신호 " 라는 명확한 흐름을 원자적으로 보장하는 것</strong>이다. 이때 락을 선점하고 조건을 확인함으로써 경쟁 상태를 방지한다.</p></li><li><p><strong>조건 기반 대기에서는 반드시 <code>while</code> 루프를 사용해 Spurious Wakeup 에 대응</strong>해야 하며, 조건이 만족될 경우에만 스레드는 깨어나야 한다.</p></li><li><p><strong>조건을 변경한 측에서 <code>notify()</code> 를 호출하는 신호 책임 원칙</strong>은 상태 일관성과 실행 흐름의 안정성을 보장한다.</p></li><li><p><strong>메모리 일관성과 공정성 확보는 고성능 시스템에서 신뢰성과 응답성을 높이는 중요한 요소</strong>이며, 데드락 예방과 자원 효율성도 설계 시 반드시 고려되어야 한다.</p></li></ul><h4 id=기본-원리-및-동작-메커니즘>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘>#</a></h4><h5 id=기본-원리>기본 원리<a hidden class=anchor aria-hidden=true href=#기본-원리>#</a></h5><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>조건 검사</strong></td><td>스레드는 작업 수행 전 조건이 만족되는지 확인한다.</td></tr><tr><td><strong>조건 변수 대기</strong></td><td>조건이 만족되지 않으면 <code>wait()</code> 을 호출하여 조건 변수에 등록 후 대기한다.</td></tr><tr><td><strong>락 해제와 재획득</strong></td><td><code>wait()</code> 는 락을 자동 해제하고, 깨어날 때 다시 획득한다.</td></tr><tr><td><strong>신호 전달</strong></td><td>다른 스레드가 조건을 만족시키면 <code>signal()</code> 또는 <code>broadcast()</code> 로 알린다.</td></tr><tr><td><strong>조건 재검사</strong></td><td>깨어난 스레드는 조건이 실제로 만족되었는지 반드시 반복 검사한다.</td></tr><tr><td><strong>작업 수행 및 락 해제</strong></td><td>조건 만족 시 작업을 수행하고 락을 해제한다.</td></tr></tbody></table><p>조건 동기화는 스레드 간 협력 실행을 위한 메커니즘으로, 스레드는 특정 조건이 충족되기를 기다리며 조건 변수에 등록되어 대기한다. 대기 중에는 락을 해제하고, 조건이 충족되었을 때 신호를 받아 깨어나며, 다시 락을 획득하고 조건을 재검사한 후 작업을 수행한다. 이러한 흐름은 busy-waiting 없이 효율적인 동기화를 보장한다.</p><h5 id=동작-메커니즘>동작 메커니즘<a hidden class=anchor aria-hidden=true href=#동작-메커니즘>#</a></h5><pre class=mermaid>sequenceDiagram
    participant T1 as Thread A (Consumer)
    participant T2 as Thread B (Producer)
    participant L as Mutex Lock
    participant CV as Condition Variable

    T1-&gt;&gt;L: lock()
    T1-&gt;&gt;T1: while (!조건) wait(CV)
    Note right of T1: CV에 대기 등록 + 락 해제
    T2-&gt;&gt;L: lock()
    T2-&gt;&gt;T2: 조건 만족 상태 생성
    T2-&gt;&gt;CV: signal()
    T2-&gt;&gt;L: unlock()
    Note over T1,CV: T1 깨어나고 락 재획득
    T1-&gt;&gt;T1: 조건 재검사
    T1-&gt;&gt;T1: 작업 수행
    T1-&gt;&gt;L: unlock()
</pre><p>조건 동기화의 동작 흐름은 스레드 A 가 락을 획득한 후 조건을 검사하고, 조건이 만족되지 않으면 <code>wait()</code> 를 호출해 락을 해제하고 대기 상태로 들어간다. 다른 스레드 B 가 조건을 만족시키면 <code>signal()</code> 을 호출하고 락을 해제한다. 이후 A 는 깨어나 락을 다시 획득한 뒤 조건을 재검사하고, 만족될 경우 작업을 수행한 후 락을 해제한다. 이 과정은 멀티스레드 환경에서 안전하고 효율적인 상태 전이를 보장한다.</p><pre class=mermaid>graph TB
    A[Thread A] --&gt; B[acquire lock]
    B --&gt; C{condition check}
    C --&gt;|false| D[wait on condition]
    C --&gt;|true| E[execute critical section]
    D --&gt; F[release lock &amp; sleep]
    F --&gt; G[wait queue]
    G --&gt; H[signal received]
    H --&gt; I[re-acquire lock]
    I --&gt; C
    E --&gt; J[modify shared state]
    J --&gt; K[signal/broadcast]
    K --&gt; L[release lock]
    
    M[Thread B] --&gt; N[acquire lock]
    N --&gt; O[modify condition]
    O --&gt; P[signal condition]
    P --&gt; Q[release lock]
    Q --&gt; H
</pre><h5 id=핵심-연산-과정>핵심 연산 과정<a hidden class=anchor aria-hidden=true href=#핵심-연산-과정>#</a></h5><h6 id=1-wait-연산-조건-대기>1. Wait 연산 (조건 대기)<a hidden class=anchor aria-hidden=true href=#1-wait-연산-조건-대기>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>wait</span><span class=p>(</span><span class=n>condition_variable</span><span class=p>,</span> <span class=n>mutex</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=mf>1.</span> <span class=n>mutex가</span> <span class=err>현재</span> <span class=err>스레드에</span> <span class=err>의해</span> <span class=err>소유되어야</span> <span class=err>함</span>
</span></span><span class=line><span class=cl>    <span class=mf>2.</span> <span class=err>현재</span> <span class=err>스레드를</span> <span class=n>condition_variable의</span> <span class=err>대기</span> <span class=err>큐에</span> <span class=err>추가</span>
</span></span><span class=line><span class=cl>    <span class=mf>3.</span> <span class=n>mutex를</span> <span class=err>원자적으로</span> <span class=err>해제</span>
</span></span><span class=line><span class=cl>    <span class=mf>4.</span> <span class=err>스레드를</span> <span class=err>블로킹</span> <span class=err>상태로</span> <span class=err>전환</span>
</span></span><span class=line><span class=cl>    <span class=mf>5.</span> <span class=err>신호</span> <span class=err>수신</span> <span class=err>시</span> <span class=n>mutex를</span> <span class=err>다시</span> <span class=err>획득하고</span> <span class=err>반환</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=2-signal-연산-단일-알림>2. Signal 연산 (단일 알림)<a hidden class=anchor aria-hidden=true href=#2-signal-연산-단일-알림>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>signal</span><span class=p>(</span><span class=n>condition_variable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=mf>1.</span> <span class=n>condition_variable의</span> <span class=err>대기</span> <span class=err>큐에서</span> <span class=err>하나의</span> <span class=err>스레드</span> <span class=err>선택</span>
</span></span><span class=line><span class=cl>    <span class=mf>2.</span> <span class=err>선택된</span> <span class=err>스레드를</span> <span class=err>실행</span> <span class=err>가능</span> <span class=err>상태로</span> <span class=err>전환</span>
</span></span><span class=line><span class=cl>    <span class=mf>3.</span> <span class=err>스케줄러에게</span> <span class=err>스레드</span> <span class=err>실행</span> <span class=err>요청</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=3-broadcast-연산-전체-알림>3. Broadcast 연산 (전체 알림)<a hidden class=anchor aria-hidden=true href=#3-broadcast-연산-전체-알림>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>broadcast</span><span class=p>(</span><span class=n>condition_variable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=mf>1.</span> <span class=n>condition_variable의</span> <span class=err>대기</span> <span class=err>큐에</span> <span class=err>있는</span> <span class=err>모든</span> <span class=err>스레드</span> <span class=err>선택</span>
</span></span><span class=line><span class=cl>    <span class=mf>2.</span> <span class=err>모든</span> <span class=err>스레드를</span> <span class=err>실행</span> <span class=err>가능</span> <span class=err>상태로</span> <span class=err>전환</span>
</span></span><span class=line><span class=cl>    <span class=mf>3.</span> <span class=err>스케줄러에게</span> <span class=err>다중</span> <span class=err>스레드</span> <span class=err>실행</span> <span class=err>요청</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=아키텍처-및-구성-요소>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소>#</a></h4><p>조건 동기화의 아키텍처는 <strong>공유 자원 보호</strong>, <strong>조건 기반 협력</strong>, 그리고 <strong>스레드 상태 전이 관리</strong>를 중심으로 구성된다.</p><p>이 구조는 <code>Mutex</code>, <code>Condition Variable</code>, <code>Wait Queue</code>, <code>Shared Resource</code> 등으로 구성되며, 각 요소는 상호 연동하여 스레드 간 안전하고 효율적인 협업을 가능하게 한다.</p><ul><li><code>Mutex</code> 는 상호 배제를 보장하고,</li><li><code>Condition Variable</code> 은 조건 기반 대기를 가능하게 하며,</li><li><code>Wait Queue</code> 는 조건 만족 전까지 스레드를 대기 상태로 유지한다.</li><li><code>Signal</code> 과 <code>Broadcast</code> 는 조건 변화 시 스레드를 깨우는 핵심 트리거이며,</li><li>선택적으로 <code>Entry Queue</code>, <code>Timeout</code>, <code>Priority Queue</code> 등도 구성에 포함된다.</li></ul><h5 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h5><table><thead><tr><th>구성 요소</th><th>필수/선택</th><th>설명</th><th>역할</th><th>기능/특징</th></tr></thead><tbody><tr><td><strong>Mutex (락)</strong></td><td>필수</td><td>공유 자원의 상호 배제를 위한 락</td><td>스레드 간 자원 충돌 방지</td><td>재진입 가능, 원자성 보장, 우선순위 상속 지원</td></tr><tr><td><strong>Condition Variable</strong></td><td>필수</td><td>조건이 만족될 때까지 스레드를 대기시키는 변수</td><td>조건 기반 스레드 협업 제어</td><td><code>wait()</code>, <code>notify()</code>, <code>notify_all()</code> 제공, 내부 대기 큐 보유</td></tr><tr><td><strong>Wait Queue</strong></td><td>필수</td><td>조건 대기 중인 스레드들을 보관하는 큐</td><td>신호 발생 전 스레드 대기 장소</td><td>FIFO 기반, 우선순위 큐 가능, 커널 스케줄러 연동</td></tr><tr><td><strong>Shared Resource</strong></td><td>필수</td><td>스레드 간에 보호되어야 할 공용 자원</td><td>임계 구역 대상</td><td>Mutex 로 보호되어야 하며, 상태 변화가 조건 변수에 영향을 줌</td></tr><tr><td><strong>Signal/Broadcast</strong></td><td>필수</td><td>조건이 만족됐을 때 대기 중인 스레드를 깨우는 트리거</td><td>조건 상태 변화 후 스레드 전환 유도</td><td><code>notify_one()</code> 은 하나, <code>notify_all()</code> 은 전체 스레드에 신호</td></tr><tr><td><strong>Entry Queue</strong></td><td>선택</td><td>락 획득을 기다리는 스레드가 진입하는 큐</td><td>공정한 락 획득 순서 제어</td><td>FIFO 또는 우선순위 기반, Java AQS 기반 스케줄링 구조</td></tr><tr><td><strong>Timeout Mechanism</strong></td><td>선택</td><td>무한 대기 방지를 위한 타이머 기능</td><td>대기 시간 초과 시 스레드 복귀</td><td>POSIX 의 <code>pthread_cond_timedwait</code> 등에서 지원</td></tr><tr><td><strong>Priority Queue</strong></td><td>선택</td><td>우선순위 기반 스레드 스케줄링</td><td>응답 우선순위 고려한 실행 제어</td><td>실시간 시스템에서 기아 상태 방지</td></tr></tbody></table><h5 id=아키텍처-구조>아키텍처 구조<a hidden class=anchor aria-hidden=true href=#아키텍처-구조>#</a></h5><pre class=mermaid>graph TD
    subgraph 스레드
        T1[Thread 1] --&gt; M[Mutex Lock]
        T2[Thread 2] --&gt; M
        T3[Thread N] --&gt; M
    end

    M --&gt; SR[Shared Resource]
    SR --&gt; CV[Condition Variable]

    CV --&gt; WQ[Wait Queue]
    WQ --&gt;|대기 중| T1
    WQ --&gt;|대기 중| T2
    CV --&gt; SIG[Signal/Broadcast]

    subgraph 신호 처리
        SIG --&gt;|notify_one / notify_all| WQ
        SIG --&gt; SCHED[OS Scheduler]
        SCHED --&gt;|선택적 복귀| T1
        SCHED --&gt;|선택적 복귀| T2
    end

    subgraph 선택 요소
        EQ[Entry Queue] --&gt; M
        CV --&gt; TO[Timeout Handler]
        CV --&gt; PQ[Priority Queue]
    end
</pre><hr><p>이 구조는 <strong>스레드 → 락 → 조건 변수 → 대기 큐 → 신호 → 스케줄러 → 복귀</strong>라는 조건 동기화의 핵심 흐름을 반영하고 있다.</p><h4 id=주요-기능과-역할>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할>#</a></h4><table><thead><tr><th><strong>구성 요소</strong></th><th><strong>주요 기능</strong></th><th><strong>책임</strong></th><th><strong>상호 관계</strong></th></tr></thead><tbody><tr><td><strong>뮤텍스</strong></td><td>상호 배제</td><td>임계 구역 보호 및 동시성 제어</td><td>조건 변수와 함께 사용되어 <code>wait()</code> 전후 락 해제/획득 처리</td></tr><tr><td><strong>조건 변수</strong></td><td>조건부 대기, 알림</td><td>스레드 간 조건 기반 협력</td><td>뮤텍스 없이 작동 불가, 대기 큐 및 신호 메커니즘과 연결됨</td></tr><tr><td><strong>대기 큐</strong></td><td>스레드 대기 관리</td><td>조건 미충족 시 스레드를 큐에 저장</td><td>조건 변수 내부 구조로, 공정성과 순서를 보장</td></tr><tr><td><strong>신호 메커니즘</strong></td><td>상태 변화 감지 및 통지</td><td>조건이 변경되면 대기 스레드 깨움</td><td>조건 변수에서 호출됨. 보통 상태 변경 후 <code>notify()</code> 호출해야 함</td></tr></tbody></table><p>조건 동기화의 주요 기능은 <code>wait()</code> 을 통한 조건 기반 대기와 <code>notify()</code>/<code>broadcast()</code> 등의 신호 메커니즘으로 이루어진다.</p><p><code>뮤텍스</code> 는 임계 구역 보호를 통해 경쟁 상태를 방지하며, 조건 변수는 스레드가 특정 조건이 충족될 때까지 대기할 수 있게 해준다.</p><p>모든 동작은 대기 큐와 상호 연계되어 동시성 처리의 공정성과 안정성을 보장하며, 신호는 항상 공유 상태 변경 후 호출되어야 한다.</p><p>기능 간 상호작용은 단순히 동작을 분산시키기보다 <strong>원자성, 공정성, 명확한 흐름 제어</strong>를 목적으로 긴밀하게 설계되어 있다.</p><h3 id=특성-분석-characteristics-analysis>특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#특성-분석-characteristics-analysis>#</a></h3><h4 id=장점-및-이점>장점 및 이점<a hidden class=anchor aria-hidden=true href=#장점-및-이점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td>효율성</td><td>CPU 자원 절약</td><td>조건 충족 전까지 스레드를 블로킹하여 불필요한 폴링 제거</td><td>wait() 는 OS 스케줄러 대기 큐에 등록되어 CPU 를 점유하지 않음</td></tr><tr><td>안정성</td><td>정밀한 상태 제어</td><td>조건 검사와 락의 결합으로 경합 상태 없이 상태 전이 가능</td><td>조건 변수는 락과 함께 사용되어 원자적 상태 전이 보장</td></tr><tr><td>유연성</td><td>다양한 동기화 패턴 지원</td><td>생산자 - 소비자, 리더 - 라이터 등 패턴에 자연스럽게 통합 가능</td><td>notify/notify_all 메커니즘을 통한 다중 조건 기반 통신</td></tr><tr><td>구조성</td><td>코드 구조화 지원</td><td>Java synchronized, Python with 구문 등으로 안전하게 구현 가능</td><td>고수준 언어의 구조화된 동기화 API 지원</td></tr><tr><td>일관성</td><td>메모리 가시성 보장</td><td>동기화된 스레드 간 메모리 상태가 일관되게 유지됨</td><td>락과 배리어를 통한 가시성/순서성 보장 (<code>acquire/release</code> 모델)</td></tr><tr><td>확장성</td><td>대규모 스레드 관리 용이</td><td>다수 스레드 환경에서도 조건 기반 블로킹을 통한 부하 분산 가능</td><td>조건 변수는 내부적으로 FIFO 또는 우선순위 기반 큐를 통해 다중 대기 처리 가능</td></tr><tr><td>신뢰성</td><td>데드락/기아 상태 완화</td><td>명확한 조건 검사와 락 해제 순서로 교착 상태 예방 가능</td><td>while 조건 검사 및 올바른 락 - 해제 순서로 상태 불일치 예방 가능</td></tr></tbody></table><p>조건 동기화는 불필요한 CPU 사용을 줄이고 스레드 간 협력을 정밀하게 제어할 수 있는 효율적인 동기화 방식이다.</p><ul><li>락과 조건 변수를 결합함으로써 상태 전이를 안전하게 수행할 수 있으며, 다양한 동기화 패턴에 확장 가능하다.</li><li>코드의 구조화된 표현과 함께 메모리 일관성도 확보할 수 있어 운영체제 및 사용자 수준 모두에서 신뢰성 높은 스레드 동기화를 구현할 수 있다.</li></ul><p>이러한 특성은 실시간 처리, 고성능 서버, 분산 시스템 등 다양한 환경에서 조건 동기화를 강력한 선택지로 만들어준다.</p><h4 id=단점-및-제약사항>단점 및 제약사항<a hidden class=anchor aria-hidden=true href=#단점-및-제약사항>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술 / 기법</th></tr></thead><tbody><tr><td>단점</td><td>Spurious Wakeup</td><td>조건 미충족 상태에서 스레드가 깨어남</td><td><code>while</code> 조건 검사 반복</td><td>상태 플래그, 이벤트 큐</td></tr><tr><td>단점</td><td>Lost Wakeup</td><td><code>wait()</code> 호출 전에 <code>notify()</code> 발생 시 신호 손실</td><td>상태 변수 + 조건 루프 보호</td><td>타임아웃 기반 대기, 메시지 큐</td></tr><tr><td>단점</td><td>우선순위 역전</td><td>낮은 우선순위 스레드가 락 점유 → 고우선순위 스레드 블로킹</td><td>우선순위 상속, Priority Ceiling</td><td>Real-time Mutex, 스케줄러 튜닝</td></tr><tr><td>단점</td><td>데드락</td><td>잘못된 락 획득 순서, 순환 대기 등으로 교착 발생</td><td>락 순서 일관성, 타임아웃 설정</td><td>lock ordering, Watchdog 타이머</td></tr><tr><td>단점</td><td>Starvation</td><td>일부 스레드가 지속적으로 자원 미할당</td><td>공정한 대기 큐, aging 적용</td><td>페어 스케줄링, notify_all</td></tr><tr><td>단점</td><td>Thundering Herd</td><td><code>broadcast()</code> 시 다수 스레드 동시에 깨어나며 경합</td><td><code>notify_one()</code> 우선 사용</td><td>대기 큐 분산, 작업 부하 균등화</td></tr><tr><td>단점</td><td>복잡성 증가</td><td>락보다 구현·디버깅이 어렵고, 예외 상황 추적 어려움</td><td>표준 패턴 활용, 단위 테스트 강화</td><td>Actor 모델, CSP</td></tr><tr><td>단점</td><td>성능 오버헤드</td><td>컨텍스트 스위칭, 락 경합 등으로 인한 지연 발생</td><td>사용자 공간 락, 스핀락 하이브리드</td><td>Lock-free 구조, Futex</td></tr><tr><td>단점</td><td>이식성 문제</td><td>플랫폼/언어마다 조건 변수 구현 차이 존재</td><td>POSIX, Java 등 표준 API 사용</td><td>언어 내장 추상화, 런타임 일관성 확보</td></tr></tbody></table><p>조건 동기화는 정확한 조건 제어와 자원 보호를 위해 유용하지만,</p><ul><li><strong>비결정적 이벤트 (예: Spurious Wakeup, Lost Wakeup)</strong></li><li><strong>우선순위 역전</strong></li><li><strong>데드락</strong></li><li><strong>Starvation</strong><br>같은 동시성 고유의 문제를 내포한다. 또한, 많은 시스템 호출과 컨텍스트 스위칭으로 인해 <strong>성능 오버헤드</strong>가 발생할 수 있고, 구현 자체도 락보다 <strong>복잡하고 이식성이 낮을 수 있다</strong>.</li></ul><p>이를 극복하기 위해서는</p><ul><li><code>while</code> 조건 재검사</li><li>상태 플래그 사용</li><li>타임아웃 대기</li><li>우선순위 상속</li><li>공정한 스케줄링<br>등 <strong>설계적 해결책</strong>이 필요하다.<br>또한, 메시지 큐, lock-free 구조, Actor 모델 등 <strong>대안 기술</strong>을 상황에 맞게 적용하는 것도 고려해야 한다.</li></ul><h4 id=트레이드오프-분석>트레이드오프 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-분석>#</a></h4><table><thead><tr><th>트레이드오프 항목</th><th>선택 A</th><th>장점 A</th><th>단점 A</th><th>선택 B</th><th>장점 B</th><th>단점 B</th><th>설계 고려 기준</th></tr></thead><tbody><tr><td><code>notify</code> vs <code>notify_all</code></td><td><code>notify()</code></td><td>최소한의 깨어남으로 경합 최소화</td><td>조건 불충족 스레드 깨어나면 기아 발생 가능</td><td><code>notify_all()</code></td><td>공정성, 모든 조건 만족 스레드 깨어남</td><td>과도한 깨어남, <code>Thundering Herd</code> 유발</td><td>조건 충족 스레드 수 예측 가능 여부</td></tr><tr><td>Busy-Wait 제거 vs Spinlock</td><td>Spinlock</td><td>응답성 빠름, context switch 없음</td><td>CPU 사용량 증가, starvation 위험</td><td><code>wait()</code> 기반 대기</td><td>자원 효율, CPU 절약</td><td>context switch 로 인한 지연</td><td>임계 영역 길이, 대기 시간 평균</td></tr><tr><td>단순 Mutex vs 조건 변수/모니터</td><td>Mutex</td><td>구현 단순, 디버깅 쉬움</td><td>조건 분기/다중 상태 처리 어려움</td><td>Monitor/Condition Var</td><td>고급 상태/조건 분기 대응 가능</td><td>구현 복잡성 증가, 디버깅 난이도 상승</td><td>조건 분기 수, 동시성 패턴 구조</td></tr><tr><td>성능 vs 안정성</td><td>Lock-free, Spinlock</td><td>처리량 극대화, 빠른 응답성</td><td>디버깅/예외처리 어려움, 안정성 낮음</td><td>Condition Variable 기반</td><td>안정성 높고 예측 가능</td><td>성능 오버헤드 존재</td><td>안정성 요구 수준, 에러 민감성</td></tr><tr><td>응답성 vs 처리량</td><td>빠른 wake-up</td><td>즉각 반응 가능</td><td>낮은 throughput, 경합 위험</td><td>Batch 처리</td><td>높은 처리량</td><td>사용자 체감 지연 가능성</td><td>실시간 요구 vs 백엔드 처리 구조</td></tr><tr><td>메모리 vs 확장성</td><td>메모리 절약 설계</td><td>가볍고 자원 소모 적음</td><td>조건/상태 표현력 낮음</td><td>상태 기반 확장 설계</td><td>다양한 조건 대응 가능</td><td>메모리 사용 증가, 상태 관리 필요</td><td>스레드 수, 조건 다양성</td></tr></tbody></table><p>조건 동기화는 높은 제어력과 안정성을 제공하지만, 항상 성능, 단순성, 응답성, 자원 소모 사이에서 선택과 조절이 필요하다.</p><ul><li><code>notify()</code> 는 경합을 줄이지만 기아를 유발할 수 있고, <code>notify_all()</code> 은 공정성을 보장하지만 불필요한 경쟁을 초래한다.</li><li>Spinlock 은 빠른 응답에는 좋지만 CPU 낭비가 크고, Condition Variable 은 예측 가능하지만 context switching 오버헤드가 있다.</li></ul><p>설계자는 <strong>실행 환경, 대기 시간, 조건 분기 수, 처리량 요구</strong> 등을 종합적으로 고려하여 최적의 동기화 전략을 선택해야 한다. 특정 패턴 하나가 항상 옳지는 않으며, 상황에 따라 trade-off 의 균형을 잡는 것이 핵심이다.</p><h5 id=성능-vs-정확성>성능 vs. 정확성<a hidden class=anchor aria-hidden=true href=#성능-vs-정확성>#</a></h5><pre class=mermaid>graph LR
    A[높은 성능] --&gt;|구현 복잡성| B[정확성 보장]
    B --&gt;|오버헤드 증가| A
    
    C[Spinlock] --&gt; A
    D[Condition Variable] --&gt; B
    E[Lock-free] --&gt; A
    F[Monitor Pattern] --&gt; B
</pre><p><strong>분석</strong>:</p><ul><li><strong>성능 우선</strong>: 짧은 대기 시간에는 스핀락이 유리</li><li><strong>정확성 우선</strong>: 복잡한 조건과 긴 대기에는 조건 변수가 필수</li></ul><h5 id=단순성-vs-유연성>단순성 vs. 유연성<a hidden class=anchor aria-hidden=true href=#단순성-vs-유연성>#</a></h5><pre class=mermaid>graph TD
    A[단순한 뮤텍스] --&gt;|기능 확장| B[조건 변수]
    B --&gt;|복잡성 증가| C[모니터 패턴]
    C --&gt;|추상화| D[고급 동기화 패턴]
    
    E[개발 용이성] -.-&gt;|감소| F[기능 풍부성]
    F -.-&gt;|증가| E
</pre><h5 id=확장성-vs-오버헤드>확장성 vs. 오버헤드<a hidden class=anchor aria-hidden=true href=#확장성-vs-오버헤드>#</a></h5><ul><li><strong>스레드 수 &lt; 10</strong>: 단순한 락으로 충분</li><li><strong>스레드 수 10-100</strong>: 조건 변수 권장</li><li><strong>스레드 수 > 100</strong>: Lock-free 또는 메시지 패싱 고려</li></ul><h5 id=메모리-사용량-vs-응답성>메모리 사용량 vs. 응답성<a hidden class=anchor aria-hidden=true href=#메모리-사용량-vs-응답성>#</a></h5><table><thead><tr><th>접근법</th><th>메모리 사용량</th><th>응답 시간</th><th>적용 시나리오</th></tr></thead><tbody><tr><td>스핀락</td><td>낮음</td><td>매우 빠름</td><td>짧은 임계영역</td></tr><tr><td>조건 변수</td><td>중간</td><td>빠름</td><td>일반적 동기화</td></tr><tr><td>모니터</td><td>높음</td><td>중간</td><td>복잡한 상태 관리</td></tr></tbody></table><h3 id=구현-및-분류>구현 및 분류<a hidden class=anchor aria-hidden=true href=#구현-및-분류>#</a></h3><h4 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h4><table><thead><tr><th>분류</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td>조건 변수</td><td>특정 조건이 만족될 때까지 스레드 대기</td><td>wait, signal, mutex</td><td>대기 스레드는 큐에 등록되어 락 해제 후 수면 상태</td><td>조건부 대기, 협력 제어</td><td>생산자–소비자, 작업 큐</td><td>락과 결합, 효율적인 CPU 사용</td></tr><tr><td>Mesa 시맨틱스</td><td>신호를 보내도 신호자 스레드가 계속 실행</td><td>signal, 대기 큐, 조건 재검사</td><td>깨어난 스레드는 다시 락 요청 및 조건 재확인</td><td>성능 최적화, 구현 단순화</td><td>Java, Python, POSIX 등 대부분 시스템</td><td>while 재검사 필수, 예측성 낮음</td></tr><tr><td>Hoare 시맨틱스</td><td>신호 즉시 수신자가 실행</td><td>신호 큐, 진입 큐</td><td>신호자가 실행 양보 → 깨어난 스레드가 즉시 실행</td><td>논리적 정확성, 실시간 보장</td><td>이론적 모델, 일부 RTOS</td><td>예측성 높음, 구현 복잡</td></tr><tr><td>Guarded Suspension</td><td>조건 만족 전까지 스레드 블로킹</td><td>조건 검사 + wait + notify</td><td>조건을 검사하고 만족될 때까지 기다림</td><td>안전한 상태 확인 후 진행</td><td>다중 조건 처리, 생산자–소비자 패턴</td><td>재검사 필수, 조건 변수의 전형적 사용 형태</td></tr><tr><td>이벤트 객체</td><td>신호 기반 동기화 (플래그 기반)</td><td>set, reset, wait</td><td>이벤트 발생 시 대기 스레드 일괄 해제</td><td>이벤트 중심 협업</td><td>.NET, Windows 등 이벤트 중심 시스템</td><td>조건 변수 유사, 상태 유지 여부 명확함</td></tr><tr><td>Signal-before-release</td><td>조건 변경 즉시 notify 후 락 해제</td><td>락, 조건 변수, 순서 제어</td><td>signal() 호출 후 바로 unlock()</td><td>신호 유실 방지</td><td>Java/POSIX 등 전통적 구현</td><td>조건과 상태의 타이밍 일관성 중요</td></tr><tr><td>Two-condition 전략</td><td>조건별로 개별 변수 관리</td><td>notEmpty, notFull 등 다중 조건</td><td>소비자/생산자 별 조건 변수 분리</td><td>분리된 조건 제어, 대기 분산</td><td>생산자–소비자, 버퍼 관리 구조</td><td>각 조건 별로 효율적 처리 가능</td></tr></tbody></table><p>조건 동기화는 다양한 환경과 요구사항에 맞춰 여러 기법으로 구현된다.</p><p>가장 널리 사용되는 조건 변수는 락과 결합해 안전한 협조 실행을 가능하게 하며, 대부분의 현대 시스템에서는 Mesa 스타일 시맨틱스를 채택하여 깨어난 스레드가 조건을 재확인하도록 요구한다. 이 외에도 Guarded Suspension, Two-condition 전략 등은 복잡한 조건 분리를 효율적으로 다룰 수 있는 전략이고, 이벤트 객체는 이벤트 기반 시스템에서 더 직관적인 제어를 가능하게 한다.<br>각 기법은 조건 검사 타이밍, 신호 전달 방식, 구현 복잡도에 따라 장단점이 뚜렷하므로 상황에 맞게 선택해야 한다.</p><h4 id=분류-기준에-따른-유형-구분>분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분>#</a></h4><table><thead><tr><th><strong>분류 기준</strong></th><th><strong>유형</strong></th><th><strong>설명</strong></th><th><strong>활용 예시</strong></th><th><strong>장점</strong></th><th><strong>단점</strong></th></tr></thead><tbody><tr><td>구현 수준</td><td>언어 내장형</td><td>키워드 기반 동기화 (<code>synchronized</code>, <code>with</code>)</td><td>Java Monitor, Python Condition</td><td>간편한 구현</td><td>낮은 유연성</td></tr><tr><td></td><td>라이브러리 기반</td><td>API 기반 명시적 제어</td><td>POSIX pthread_cond, C++ std</td><td>유연성, 이식성</td><td>복잡한 인터페이스</td></tr><tr><td></td><td>커널/하드웨어 기반</td><td>OS/Futex 기반, 하드웨어 명령어 사용</td><td>Linux Futex, Windows WaitOnAddress</td><td>높은 성능</td><td>고난도 구현 필요</td></tr><tr><td>조건 변수 구조</td><td>단일 조건 변수</td><td>하나의 조건만 감지</td><td>단순 큐, 버퍼</td><td>단순 구조</td><td>유연성 부족</td></tr><tr><td></td><td>다중 조건 변수</td><td>조건별 별도 변수로 분리</td><td>우선순위 큐, 멀티 파이프라인</td><td>동시성 향상</td><td>구현 복잡도 증가</td></tr><tr><td></td><td>글로벌 조건 변수</td><td>모든 스레드에 알림 전파</td><td>이벤트 브로드캐스트</td><td>전역 반응성</td><td>불필요한 스레드 활성화</td></tr><tr><td>신호 방식</td><td>단일 신호 (<code>notify</code>)</td><td>하나의 대기 스레드 깨움</td><td>일반 생산자 - 소비자 큐</td><td>효율성, 선택적 자원 분배</td><td>조건 불충족 시 깨어난 스레드 낭비</td></tr><tr><td></td><td>전체 신호 (<code>notify_all</code>)</td><td>모든 대기 스레드에 알림</td><td>장애 복구, 상태 전체 반영</td><td>공정성, 전파력</td><td>불필요한 스레드 실행</td></tr><tr><td>대기 방식</td><td>블로킹 대기</td><td>조건 만족까지 완전 대기</td><td>데이터 수신, 서버 대기 루프</td><td>CPU 절약</td><td>컨텍스트 스위칭 오버헤드</td></tr><tr><td></td><td>논블로킹 대기</td><td>상태를 지속적으로 검사 (스핀)</td><td>실시간 프로세스, 로직 타이머</td><td>빠른 응답</td><td>CPU 사용량 증가</td></tr><tr><td></td><td>하이브리드 대기</td><td>초반 스핀 + 이후 블로킹</td><td>고성능 이벤트 처리 서버</td><td>반응성 + CPU 효율 균형</td><td>복잡한 구현, 임계 조정 필요</td></tr></tbody></table><p>조건 동기화는 다양한 구현 및 사용 시나리오에 따라 <strong>구현 수준, 조건 변수 구조, 신호 방식, 대기 방식</strong>으로 구분할 수 있다.<br>각 유형은 <strong>성능, 응답성, 구현 난이도, 확장성</strong>에서 차이를 가지며, 요구하는 시스템 특성에 따라 선택해야 한다.</p><p>예를 들어 <strong>Java</strong>와 같은 언어는 내장형 구조로 단순 구현이 가능하지만, <strong>POSIX pthread</strong>는 유연성과 성능 제어가 가능하다.<br>또한 스레드 수가 많거나 조건이 자주 변하는 시스템에서는 <strong>다중 조건 변수와 전체 신호 방식</strong>이 효과적이며,<br>반대로 조건이 드물게 발생하고 리소스 절약이 중요한 시스템에서는 <strong>단일 조건 + notify 조합</strong>이 유리하다.</p><p>실시간 시스템, 서버, 대용량 메시지 처리 환경에 따라 적절한 분류 조합을 선택하면 성능과 안정성을 동시에 확보할 수 있다.</p><h3 id=실무-적용>실무 적용<a hidden class=anchor aria-hidden=true href=#실무-적용>#</a></h3><h4 id=실제-도입-사례>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례>#</a></h4><table><thead><tr><th>시스템 / 프레임워크</th><th>사용된 동기화 기술 조합</th><th>주요 효과 및 장점</th></tr></thead><tbody><tr><td><strong>Apache Kafka</strong></td><td>Ring Buffer + 조건 변수 기반 큐 관리 + 백프레셔 제어</td><td>높은 처리량 (수백만 msg/s), 낮은 지연 (P99 ~ 마이크로초 단위), 뛰어난 확장성</td></tr><tr><td><strong>PostgreSQL</strong></td><td>Lightweight Locks + Condition Variables + Deadlock Detection</td><td>수천 동시 트랜잭션 지원, ACID 보장, 락 경합 최소화</td></tr><tr><td><strong>Go 런타임 (Golang)</strong></td><td>sync.Cond + 채널 + 뮤텍스 기반 M:N 스케줄러 구현</td><td>수백만 고루틴 지원, 효율적 자원 활용, CSP 스타일 단순 구조 유지</td></tr></tbody></table><p>이 세 사례를 보면 <strong>조건 동기화를 기반으로 한 기능 조합은 모두 고성능, 확장성, 응답성을 확보하는 데 핵심적인 역할</strong>을 하고 있다.</p><ul><li><strong>Apache Kafka</strong>는 메시지 큐 관리의 실시간성과 고처리량 요구를 충족시키기 위해 조건 변수 기반 대기와 signal/broadcast 메커니즘을 활용.</li><li><strong>PostgreSQL</strong>은 다중 트랜잭션 환경에서 일관성과 경쟁 상태 처리를 위해 Condition Variables 와 Deadlock Detection 을 조합한 정교한 동기화 구조를 사용.</li><li><strong>Go 런타임</strong>은 사용자 코드에 가볍게 조건 동기화를 제공하면서도, M:N 스케줄러의 복잡한 협조를 CSP(Communicating Sequential Processes) 스타일로 간단하게 구현.</li></ul><p>이처럼, <strong>조건 동기화 메커니즘은 다양한 시스템에서 필수적인 경쟁 제어와 대기/신호 기능을 구현하는 핵심 도구로 채택되고 있음</strong>을 알 수 있다.</p><h4 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h4><h5 id=사례-생산자---소비자-문제-해결>사례: 생산자 - 소비자 문제 해결<a hidden class=anchor aria-hidden=true href=#사례-생산자---소비자-문제-해결>#</a></h5><p><strong>시나리오</strong>: 생산자 - 소비자 문제 해결 (제한된 크기의 버퍼)</p><p><strong>시스템 구성</strong>:</p><ul><li>생산자 스레드: 데이터 생성 및 버퍼에 추가</li><li>소비자 스레드: 버퍼에서 데이터 취득 및 처리</li><li>공유 버퍼: 고정 크기 순환 큐</li><li>동기화 객체: 뮤텍스 + 조건 변수</li></ul><pre class=mermaid>graph TB
    subgraph &#34;생산자-소비자 시스템&#34;
        P1[생산자 1] --&gt; B[공유 버퍼]
        P2[생산자 2] --&gt; B
        B --&gt; C1[소비자 1]
        B --&gt; C2[소비자 2]
        
        B --&gt; M[뮤텍스]
        B --&gt; CV1[조건변수: not_full]
        B --&gt; CV2[조건변수: not_empty]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>생산자가 버퍼 락 획득</li><li>버퍼 가득참 여부 검사</li><li>가득찬 경우 not_full 조건 대기</li><li>데이터 추가 후 not_empty 신호 전송</li><li>소비자가 유사한 과정으로 데이터 소비</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>컨디션 동기화가 버퍼 상태에 따른 스레드 대기/깨우기 조정</li><li>데이터 손실 방지 및 오버플로우 예방</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 폴링 방식으로 CPU 과부하, 비효율적 자원 사용</li><li>도입 후: 이벤트 기반 대기로 CPU 효율성 향상, 응답성 개선</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span><span class=lnt id=hl-11-36><a class=lnlinks href=#hl-11-36>36</a>
</span><span class=lnt id=hl-11-37><a class=lnlinks href=#hl-11-37>37</a>
</span><span class=lnt id=hl-11-38><a class=lnlinks href=#hl-11-38>38</a>
</span><span class=lnt id=hl-11-39><a class=lnlinks href=#hl-11-39>39</a>
</span><span class=lnt id=hl-11-40><a class=lnlinks href=#hl-11-40>40</a>
</span><span class=lnt id=hl-11-41><a class=lnlinks href=#hl-11-41>41</a>
</span><span class=lnt id=hl-11-42><a class=lnlinks href=#hl-11-42>42</a>
</span><span class=lnt id=hl-11-43><a class=lnlinks href=#hl-11-43>43</a>
</span><span class=lnt id=hl-11-44><a class=lnlinks href=#hl-11-44>44</a>
</span><span class=lnt id=hl-11-45><a class=lnlinks href=#hl-11-45>45</a>
</span><span class=lnt id=hl-11-46><a class=lnlinks href=#hl-11-46>46</a>
</span><span class=lnt id=hl-11-47><a class=lnlinks href=#hl-11-47>47</a>
</span><span class=lnt id=hl-11-48><a class=lnlinks href=#hl-11-48>48</a>
</span><span class=lnt id=hl-11-49><a class=lnlinks href=#hl-11-49>49</a>
</span><span class=lnt id=hl-11-50><a class=lnlinks href=#hl-11-50>50</a>
</span><span class=lnt id=hl-11-51><a class=lnlinks href=#hl-11-51>51</a>
</span><span class=lnt id=hl-11-52><a class=lnlinks href=#hl-11-52>52</a>
</span><span class=lnt id=hl-11-53><a class=lnlinks href=#hl-11-53>53</a>
</span><span class=lnt id=hl-11-54><a class=lnlinks href=#hl-11-54>54</a>
</span><span class=lnt id=hl-11-55><a class=lnlinks href=#hl-11-55>55</a>
</span><span class=lnt id=hl-11-56><a class=lnlinks href=#hl-11-56>56</a>
</span><span class=lnt id=hl-11-57><a class=lnlinks href=#hl-11-57>57</a>
</span><span class=lnt id=hl-11-58><a class=lnlinks href=#hl-11-58>58</a>
</span><span class=lnt id=hl-11-59><a class=lnlinks href=#hl-11-59>59</a>
</span><span class=lnt id=hl-11-60><a class=lnlinks href=#hl-11-60>60</a>
</span><span class=lnt id=hl-11-61><a class=lnlinks href=#hl-11-61>61</a>
</span><span class=lnt id=hl-11-62><a class=lnlinks href=#hl-11-62>62</a>
</span><span class=lnt id=hl-11-63><a class=lnlinks href=#hl-11-63>63</a>
</span><span class=lnt id=hl-11-64><a class=lnlinks href=#hl-11-64>64</a>
</span><span class=lnt id=hl-11-65><a class=lnlinks href=#hl-11-65>65</a>
</span><span class=lnt id=hl-11-66><a class=lnlinks href=#hl-11-66>66</a>
</span><span class=lnt id=hl-11-67><a class=lnlinks href=#hl-11-67>67</a>
</span><span class=lnt id=hl-11-68><a class=lnlinks href=#hl-11-68>68</a>
</span><span class=lnt id=hl-11-69><a class=lnlinks href=#hl-11-69>69</a>
</span><span class=lnt id=hl-11-70><a class=lnlinks href=#hl-11-70>70</a>
</span><span class=lnt id=hl-11-71><a class=lnlinks href=#hl-11-71>71</a>
</span><span class=lnt id=hl-11-72><a class=lnlinks href=#hl-11-72>72</a>
</span><span class=lnt id=hl-11-73><a class=lnlinks href=#hl-11-73>73</a>
</span><span class=lnt id=hl-11-74><a class=lnlinks href=#hl-11-74>74</a>
</span><span class=lnt id=hl-11-75><a class=lnlinks href=#hl-11-75>75</a>
</span><span class=lnt id=hl-11-76><a class=lnlinks href=#hl-11-76>76</a>
</span><span class=lnt id=hl-11-77><a class=lnlinks href=#hl-11-77>77</a>
</span><span class=lnt id=hl-11-78><a class=lnlinks href=#hl-11-78>78</a>
</span><span class=lnt id=hl-11-79><a class=lnlinks href=#hl-11-79>79</a>
</span><span class=lnt id=hl-11-80><a class=lnlinks href=#hl-11-80>80</a>
</span><span class=lnt id=hl-11-81><a class=lnlinks href=#hl-11-81>81</a>
</span><span class=lnt id=hl-11-82><a class=lnlinks href=#hl-11-82>82</a>
</span><span class=lnt id=hl-11-83><a class=lnlinks href=#hl-11-83>83</a>
</span><span class=lnt id=hl-11-84><a class=lnlinks href=#hl-11-84>84</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>deque</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ProducerConsumerBuffer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>buffer</span> <span class=o>=</span> <span class=n>deque</span><span class=p>()</span>  <span class=c1># 공유 버퍼</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>max_size</span> <span class=o>=</span> <span class=n>max_size</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 동기화 객체들</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>  <span class=c1># 상호 배제</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>not_full</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=p>)</span>  <span class=c1># 버퍼가 가득차지 않음</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>not_empty</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=p>)</span>  <span class=c1># 버퍼가 비어있지 않음</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>produce</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;생산자가 아이템을 버퍼에 추가&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>not_full</span><span class=p>:</span>  <span class=c1># 락 획득 및 조건 변수 연결</span>
</span></span><span class=line><span class=cl>            <span class=c1># 버퍼가 가득찰 때까지 대기</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>buffer</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Producer waiting - buffer full (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>buffer</span><span class=p>)</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>max_size</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>not_full</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>  <span class=c1># 조건부 대기</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 아이템 추가</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>buffer</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Produced: </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2> (buffer size: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>buffer</span><span class=p>)</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 소비자에게 버퍼가 비어있지 않음을 알림</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>not_empty</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>consume</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;소비자가 버퍼에서 아이템을 취득&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>not_empty</span><span class=p>:</span>  <span class=c1># 락 획득 및 조건 변수 연결</span>
</span></span><span class=line><span class=cl>            <span class=c1># 버퍼가 비어있을 때까지 대기</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>buffer</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Consumer waiting - buffer empty&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>not_empty</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>  <span class=c1># 조건부 대기</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 아이템 소비</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>buffer</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Consumed: </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2> (buffer size: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>buffer</span><span class=p>)</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 생산자에게 버퍼가 가득차지 않음을 알림</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>not_full</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>producer_worker</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=n>producer_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;생산자 스레드 작업 함수&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;item_</span><span class=si>{</span><span class=n>producer_id</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>buffer</span><span class=o>.</span><span class=n>produce</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 생산 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consumer_worker</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=n>consumer_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;소비자 스레드 작업 함수&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=n>buffer</span><span class=o>.</span><span class=n>consume</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.2</span><span class=p>)</span>  <span class=c1># 소비 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예제</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 크기 3인 버퍼 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer</span> <span class=o>=</span> <span class=n>ProducerConsumerBuffer</span><span class=p>(</span><span class=n>max_size</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 스레드 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>threads</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 생산자 스레드 2개</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>producer_worker</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=n>i</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 소비자 스레드 2개  </span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>consumer_worker</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=n>i</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 모든 스레드 완료 대기</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;모든 작업 완료&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-생산자---소비자-버퍼-동기화>사례: 생산자 - 소비자 버퍼 동기화<a hidden class=anchor aria-hidden=true href=#사례-생산자---소비자-버퍼-동기화>#</a></h5><p><strong>시나리오</strong>: 생산자–소비자 버퍼 동기화</p><p><strong>시스템 구성</strong>:</p><ul><li>Producer(생산자)</li><li>Consumer(소비자)</li><li>Buffer(공유 버퍼)</li><li>Condition Variable + Mutex</li></ul><pre class=mermaid>graph TB
    P[Producer] --&gt;|Produce data| B(Buffer)
    C[Consumer] --&gt;|Consume data| B
    B --&gt;|Condition variable signal| P
    B --&gt;|Condition variable signal| C
</pre><p><strong>Workflow</strong>:</p><ol><li>생산자가 buffer 가 꽉 켜지면 wait</li><li>소비자가 buffer 가 비면 wait</li><li>데이터 추가/삭제 시 signal → 대기자 깨움</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>안전한 자원 공유 + 조건에 따른 동기화·재개</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 바쁜 대기 및 경쟁 상태, 비효율적 자원 소모</li><li>도입 후: 효율적 대기/신호, 자원 일관성 유지</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buffer</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>max_size</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>condition</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>producer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span> <span class=o>==</span> <span class=n>max_size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>condition</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>  <span class=c1># 버퍼가 꽉 차 있으면 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>buffer</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Produced, buffer:&#34;</span><span class=p>,</span> <span class=n>buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>condition</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>  <span class=c1># 소비자가 대기 중이면 신호</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consumer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>condition</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span> <span class=c1># 버퍼 비었으면 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>buffer</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Consumed, buffer:&#34;</span><span class=p>,</span> <span class=n>buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>condition</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>  <span class=c1># 생산자가 대기 중이면 신호</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>producer</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>consumer</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-생산자---소비자-모델에서-조건-변수를-사용>사례: 생산자 - 소비자 모델에서 조건 변수를 사용<a hidden class=anchor aria-hidden=true href=#사례-생산자---소비자-모델에서-조건-변수를-사용>#</a></h5><p><strong>시나리오</strong>: 생산자 - 소비자 모델에서 조건 변수를 사용하여 버퍼가 가득 찼을 때 생산자는 대기하고, 비었을 때 소비자는 대기한다.</p><p><strong>시스템 구성</strong>:</p><ul><li>Shared Buffer (Queue)</li><li>Producer Thread</li><li>Consumer Thread</li><li>Lock (Mutex)</li><li>Condition Variable</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    Producer --&gt; Buffer
    Consumer --&gt; Buffer
    Buffer --&gt; ConditionVariable
    Buffer --&gt; Mutex
</pre><p><strong>Workflow</strong>:</p><ol><li>생산자는 락을 획득하고 큐 상태를 확인</li><li>큐가 가득 차면 조건 변수에서 대기</li><li>아이템 추가 후 notify 를 호출</li><li>소비자는 락을 획득하고 큐가 비었는지 확인</li><li>비어있으면 조건 변수에서 대기</li><li>아이템 소비 후 notify</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Condition Variable: 큐 상태에 따라 스레드 상태 조절</li><li>Lock: 상태 전이의 원자성 보장</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: busy wait, CPU 낭비</li><li>도입 후: 대기 스레드 효율적 제어, 자원 낭비 없음</li></ul><p><strong>구현 예시 (Python)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25>25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26>26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27>27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28>28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29>29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30>30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31>31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32>32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33>33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34>34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>deque</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buffer</span> <span class=o>=</span> <span class=n>deque</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>buffer_size</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>condition</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=n>lock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>producer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>buffer_size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>condition</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>  <span class=c1># 큐가 가득 찼다면 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>buffer</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Producer] Produced </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>condition</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>  <span class=c1># 소비자 깨우기</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consumer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=ow>not</span> <span class=n>buffer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>condition</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>  <span class=c1># 큐가 비었다면 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span> <span class=o>=</span> <span class=n>buffer</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Consumer] Consumed </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>condition</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>  <span class=c1># 생산자 깨우기</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>producer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>t2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>consumer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>t2</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-python-thread-pool-에서-작업-큐-제어>사례: Python Thread Pool 에서 작업 큐 제어<a hidden class=anchor aria-hidden=true href=#사례-python-thread-pool-에서-작업-큐-제어>#</a></h5><p><strong>시나리오</strong>: Python 기반 백엔드 시스템에서 작업 큐를 처리하는 다중 스레드 Thread Pool 을 운영. 큐가 비었을 경우 작업자 스레드는 조건 변수로 대기하며, 작업이 들어오면 producer 가 조건 변수로 notify 하여 스레드를 깨운다.</p><p><strong>시스템 구성</strong>:</p><ul><li>JobQueue (공유 버퍼)</li><li>Worker Thread Pool (소비자)</li><li>Dispatcher (생산자 역할)</li><li>Lock, Condition Variable</li></ul><pre class=mermaid>graph TB
    Dispatcher --&gt; Queue
    Worker1 --&gt; Queue
    Worker2 --&gt; Queue
    Queue --&gt; ConditionVariable
    Queue --&gt; Mutex
</pre><p><strong>Workflow</strong>:</p><ol><li>Dispatcher 가 작업을 JobQueue 에 push</li><li>Worker 스레드는 큐가 비어 있으면 조건 변수로 wait</li><li>작업이 들어오면 notify → Worker 가 작업 수행</li><li>Worker 는 작업 후 다시 큐 확인 → 반복</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Condition Variable: Worker 의 대기 및 깨어남 제어</li><li>Mutex: 큐 접근 시 상호 배제 보장</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: worker 가 큐 상태를 polling → 자원 낭비</li><li>도입 후: 효율적 상태 기반 대기 → 리소스 최적화</li></ul><p><strong>구현 예시 (Python)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25>25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26>26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27>27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28>28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29>29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30>30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31>31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32>32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33>33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34>34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35>35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36>36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37>37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38>38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39>39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40>40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41>41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42>42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43>43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44>44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>queue</span> <span class=kn>import</span> <span class=n>deque</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>JobQueue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queue</span> <span class=o>=</span> <span class=n>deque</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>condition</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>add_job</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>job</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>job</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Dispatcher] Job added: </span><span class=si>{</span><span class=n>job</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>condition</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_job</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>condition</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>job</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>job</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Worker</span><span class=p>(</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>job_queue</span><span class=p>,</span> <span class=n>worker_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>job_queue</span> <span class=o>=</span> <span class=n>job_queue</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>worker_id</span> <span class=o>=</span> <span class=n>worker_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>job</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>job_queue</span><span class=o>.</span><span class=n>get_job</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Worker-</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>worker_id</span><span class=si>}</span><span class=s2>] Processing job: </span><span class=si>{</span><span class=n>job</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># simulate work</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>job_queue</span> <span class=o>=</span> <span class=n>JobQueue</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>workers</span> <span class=o>=</span> <span class=p>[</span><span class=n>Worker</span><span class=p>(</span><span class=n>job_queue</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>workers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>w</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Dispatcher: simulate job addition</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>job_queue</span><span class=o>.</span><span class=n>add_job</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Task-</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-다중-스레드-작업-큐>사례: 다중 스레드 작업 큐<a hidden class=anchor aria-hidden=true href=#사례-다중-스레드-작업-큐>#</a></h5><p><strong>시나리오</strong>: 다중 스레드 작업 큐 (예: 웹 서버에서 연결 처리)</p><p><strong>시스템 구성</strong>:</p><ul><li>Worker Thread (작업 처리자)</li><li>Task Queue (작업 대기열)</li><li>Condition Variable, Lock(Mutex)</li></ul><pre class=mermaid>graph TB
    T[TaskQueue] --&gt;|new task signal| W1[Worker1]
    T --&gt;|new task signal| W2[Worker2]
    W1 --&gt;|complete| T
    W2 --&gt;|complete| T
</pre><p><strong>Workflow</strong>:</p><ol><li>클라이언트 요청이 TaskQueue 에 추가될 때 signal</li><li>Worker 는 조건 변수 대기, 작업 생기면 활성화</li><li>처리 후 다시 대기</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>고효율로 작업 분배, 중복·경쟁 없이 처리</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 바쁜 대기, 리소스 낭비 및 경쟁</li><li>도입 후: 필요한 순간만 활성화, 자원 최적화</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18>18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19>19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20>20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21>21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22>22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23>23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24>24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25>25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Worker</span><span class=p>(</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>task_queue</span><span class=p>,</span> <span class=n>condition</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>task_queue</span> <span class=o>=</span> <span class=n>task_queue</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>condition</span> <span class=o>=</span> <span class=n>condition</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>while</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>task_queue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>condition</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>task</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>task_queue</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>  <span class=c1># 조건 충족 시 작업 처리</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Processing:&#34;</span><span class=p>,</span> <span class=n>task</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>task_queue</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>condition</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>workers</span> <span class=o>=</span> <span class=p>[</span><span class=n>Worker</span><span class=p>(</span><span class=n>task_queue</span><span class=p>,</span> <span class=n>condition</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>workers</span><span class=p>:</span> <span class=n>w</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Main thread: 작업 추가 및 신호</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_task</span><span class=p>(</span><span class=n>task</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>task_queue</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>task</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>condition</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add_task</span><span class=p>(</span><span class=s2>&#34;Job1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add_task</span><span class=p>(</span><span class=s2>&#34;Job2&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-redis-클러스터의-키---값-동기화>사례: Redis 클러스터의 키 - 값 동기화<a hidden class=anchor aria-hidden=true href=#사례-redis-클러스터의-키---값-동기화>#</a></h5><p><strong>시나리오</strong>: Redis 클러스터의 키 - 값 동기화 (Redis Cluster 키 마이그레이션)</p><p><strong>시스템 구성</strong>:</p><ul><li>마스터 노드: 키 - 값 쌍 관리 및 클라이언트 요청 처리</li><li>슬레이브 노드: 복제 데이터 동기화</li><li>클러스터 매니저: 노드 간 키 재분배 조정</li><li>동기화 메커니즘: 조건 변수 기반 상태 동기화</li></ul><pre class=mermaid>graph TB
    subgraph &#34;Redis 클러스터 동기화&#34;
        CM[클러스터 매니저] --&gt; M1[마스터 노드 1]
        CM --&gt; M2[마스터 노드 2]
        CM --&gt; M3[마스터 노드 3]
        
        M1 --&gt; S1[슬레이브 노드 1]
        M2 --&gt; S2[슬레이브 노드 2]
        M3 --&gt; S3[슬레이브 노드 3]
        
        M1 -.-&gt;|키 마이그레이션| M2
        M2 -.-&gt;|키 마이그레이션| M3
        M3 -.-&gt;|키 마이그레이션| M1
        
        CV[조건 변수: migration_complete]
        MX[뮤텍스: cluster_state]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>클러스터 매니저가 리밸런싱 필요성 감지</li><li>마이그레이션 대상 노드들에 상태 변경 신호</li><li>소스 노드가 키 전송 준비 완료까지 대기</li><li>타겟 노드가 키 수신 및 확인 응답</li><li>모든 노드에 마이그레이션 완료 신호 브로드캐스트</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>컨디션 동기화가 노드 간 상태 일관성 보장</li><li>마이그레이션 중 클라이언트 요청 처리 순서 제어</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 폴링 기반 상태 확인으로 네트워크 오버헤드 증가</li><li>도입 후: 이벤트 기반 동기화로 즉시 반응하는 분산 시스템</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>  1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>  2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>  3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>  4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>  5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>  6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>  7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8>  8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9>  9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10> 10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11> 11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12> 12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13> 13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14> 14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15> 15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16> 16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17> 17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18> 18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19> 19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20> 20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21> 21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22> 22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23> 23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24> 24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25> 25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26> 26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27> 27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28> 28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29> 29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30> 30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31> 31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32> 32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33> 33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34> 34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35> 35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36> 36</a>
</span><span class=lnt id=hl-21-37><a class=lnlinks href=#hl-21-37> 37</a>
</span><span class=lnt id=hl-21-38><a class=lnlinks href=#hl-21-38> 38</a>
</span><span class=lnt id=hl-21-39><a class=lnlinks href=#hl-21-39> 39</a>
</span><span class=lnt id=hl-21-40><a class=lnlinks href=#hl-21-40> 40</a>
</span><span class=lnt id=hl-21-41><a class=lnlinks href=#hl-21-41> 41</a>
</span><span class=lnt id=hl-21-42><a class=lnlinks href=#hl-21-42> 42</a>
</span><span class=lnt id=hl-21-43><a class=lnlinks href=#hl-21-43> 43</a>
</span><span class=lnt id=hl-21-44><a class=lnlinks href=#hl-21-44> 44</a>
</span><span class=lnt id=hl-21-45><a class=lnlinks href=#hl-21-45> 45</a>
</span><span class=lnt id=hl-21-46><a class=lnlinks href=#hl-21-46> 46</a>
</span><span class=lnt id=hl-21-47><a class=lnlinks href=#hl-21-47> 47</a>
</span><span class=lnt id=hl-21-48><a class=lnlinks href=#hl-21-48> 48</a>
</span><span class=lnt id=hl-21-49><a class=lnlinks href=#hl-21-49> 49</a>
</span><span class=lnt id=hl-21-50><a class=lnlinks href=#hl-21-50> 50</a>
</span><span class=lnt id=hl-21-51><a class=lnlinks href=#hl-21-51> 51</a>
</span><span class=lnt id=hl-21-52><a class=lnlinks href=#hl-21-52> 52</a>
</span><span class=lnt id=hl-21-53><a class=lnlinks href=#hl-21-53> 53</a>
</span><span class=lnt id=hl-21-54><a class=lnlinks href=#hl-21-54> 54</a>
</span><span class=lnt id=hl-21-55><a class=lnlinks href=#hl-21-55> 55</a>
</span><span class=lnt id=hl-21-56><a class=lnlinks href=#hl-21-56> 56</a>
</span><span class=lnt id=hl-21-57><a class=lnlinks href=#hl-21-57> 57</a>
</span><span class=lnt id=hl-21-58><a class=lnlinks href=#hl-21-58> 58</a>
</span><span class=lnt id=hl-21-59><a class=lnlinks href=#hl-21-59> 59</a>
</span><span class=lnt id=hl-21-60><a class=lnlinks href=#hl-21-60> 60</a>
</span><span class=lnt id=hl-21-61><a class=lnlinks href=#hl-21-61> 61</a>
</span><span class=lnt id=hl-21-62><a class=lnlinks href=#hl-21-62> 62</a>
</span><span class=lnt id=hl-21-63><a class=lnlinks href=#hl-21-63> 63</a>
</span><span class=lnt id=hl-21-64><a class=lnlinks href=#hl-21-64> 64</a>
</span><span class=lnt id=hl-21-65><a class=lnlinks href=#hl-21-65> 65</a>
</span><span class=lnt id=hl-21-66><a class=lnlinks href=#hl-21-66> 66</a>
</span><span class=lnt id=hl-21-67><a class=lnlinks href=#hl-21-67> 67</a>
</span><span class=lnt id=hl-21-68><a class=lnlinks href=#hl-21-68> 68</a>
</span><span class=lnt id=hl-21-69><a class=lnlinks href=#hl-21-69> 69</a>
</span><span class=lnt id=hl-21-70><a class=lnlinks href=#hl-21-70> 70</a>
</span><span class=lnt id=hl-21-71><a class=lnlinks href=#hl-21-71> 71</a>
</span><span class=lnt id=hl-21-72><a class=lnlinks href=#hl-21-72> 72</a>
</span><span class=lnt id=hl-21-73><a class=lnlinks href=#hl-21-73> 73</a>
</span><span class=lnt id=hl-21-74><a class=lnlinks href=#hl-21-74> 74</a>
</span><span class=lnt id=hl-21-75><a class=lnlinks href=#hl-21-75> 75</a>
</span><span class=lnt id=hl-21-76><a class=lnlinks href=#hl-21-76> 76</a>
</span><span class=lnt id=hl-21-77><a class=lnlinks href=#hl-21-77> 77</a>
</span><span class=lnt id=hl-21-78><a class=lnlinks href=#hl-21-78> 78</a>
</span><span class=lnt id=hl-21-79><a class=lnlinks href=#hl-21-79> 79</a>
</span><span class=lnt id=hl-21-80><a class=lnlinks href=#hl-21-80> 80</a>
</span><span class=lnt id=hl-21-81><a class=lnlinks href=#hl-21-81> 81</a>
</span><span class=lnt id=hl-21-82><a class=lnlinks href=#hl-21-82> 82</a>
</span><span class=lnt id=hl-21-83><a class=lnlinks href=#hl-21-83> 83</a>
</span><span class=lnt id=hl-21-84><a class=lnlinks href=#hl-21-84> 84</a>
</span><span class=lnt id=hl-21-85><a class=lnlinks href=#hl-21-85> 85</a>
</span><span class=lnt id=hl-21-86><a class=lnlinks href=#hl-21-86> 86</a>
</span><span class=lnt id=hl-21-87><a class=lnlinks href=#hl-21-87> 87</a>
</span><span class=lnt id=hl-21-88><a class=lnlinks href=#hl-21-88> 88</a>
</span><span class=lnt id=hl-21-89><a class=lnlinks href=#hl-21-89> 89</a>
</span><span class=lnt id=hl-21-90><a class=lnlinks href=#hl-21-90> 90</a>
</span><span class=lnt id=hl-21-91><a class=lnlinks href=#hl-21-91> 91</a>
</span><span class=lnt id=hl-21-92><a class=lnlinks href=#hl-21-92> 92</a>
</span><span class=lnt id=hl-21-93><a class=lnlinks href=#hl-21-93> 93</a>
</span><span class=lnt id=hl-21-94><a class=lnlinks href=#hl-21-94> 94</a>
</span><span class=lnt id=hl-21-95><a class=lnlinks href=#hl-21-95> 95</a>
</span><span class=lnt id=hl-21-96><a class=lnlinks href=#hl-21-96> 96</a>
</span><span class=lnt id=hl-21-97><a class=lnlinks href=#hl-21-97> 97</a>
</span><span class=lnt id=hl-21-98><a class=lnlinks href=#hl-21-98> 98</a>
</span><span class=lnt id=hl-21-99><a class=lnlinks href=#hl-21-99> 99</a>
</span><span class=lnt id=hl-21-100><a class=lnlinks href=#hl-21-100>100</a>
</span><span class=lnt id=hl-21-101><a class=lnlinks href=#hl-21-101>101</a>
</span><span class=lnt id=hl-21-102><a class=lnlinks href=#hl-21-102>102</a>
</span><span class=lnt id=hl-21-103><a class=lnlinks href=#hl-21-103>103</a>
</span><span class=lnt id=hl-21-104><a class=lnlinks href=#hl-21-104>104</a>
</span><span class=lnt id=hl-21-105><a class=lnlinks href=#hl-21-105>105</a>
</span><span class=lnt id=hl-21-106><a class=lnlinks href=#hl-21-106>106</a>
</span><span class=lnt id=hl-21-107><a class=lnlinks href=#hl-21-107>107</a>
</span><span class=lnt id=hl-21-108><a class=lnlinks href=#hl-21-108>108</a>
</span><span class=lnt id=hl-21-109><a class=lnlinks href=#hl-21-109>109</a>
</span><span class=lnt id=hl-21-110><a class=lnlinks href=#hl-21-110>110</a>
</span><span class=lnt id=hl-21-111><a class=lnlinks href=#hl-21-111>111</a>
</span><span class=lnt id=hl-21-112><a class=lnlinks href=#hl-21-112>112</a>
</span><span class=lnt id=hl-21-113><a class=lnlinks href=#hl-21-113>113</a>
</span><span class=lnt id=hl-21-114><a class=lnlinks href=#hl-21-114>114</a>
</span><span class=lnt id=hl-21-115><a class=lnlinks href=#hl-21-115>115</a>
</span><span class=lnt id=hl-21-116><a class=lnlinks href=#hl-21-116>116</a>
</span><span class=lnt id=hl-21-117><a class=lnlinks href=#hl-21-117>117</a>
</span><span class=lnt id=hl-21-118><a class=lnlinks href=#hl-21-118>118</a>
</span><span class=lnt id=hl-21-119><a class=lnlinks href=#hl-21-119>119</a>
</span><span class=lnt id=hl-21-120><a class=lnlinks href=#hl-21-120>120</a>
</span><span class=lnt id=hl-21-121><a class=lnlinks href=#hl-21-121>121</a>
</span><span class=lnt id=hl-21-122><a class=lnlinks href=#hl-21-122>122</a>
</span><span class=lnt id=hl-21-123><a class=lnlinks href=#hl-21-123>123</a>
</span><span class=lnt id=hl-21-124><a class=lnlinks href=#hl-21-124>124</a>
</span><span class=lnt id=hl-21-125><a class=lnlinks href=#hl-21-125>125</a>
</span><span class=lnt id=hl-21-126><a class=lnlinks href=#hl-21-126>126</a>
</span><span class=lnt id=hl-21-127><a class=lnlinks href=#hl-21-127>127</a>
</span><span class=lnt id=hl-21-128><a class=lnlinks href=#hl-21-128>128</a>
</span><span class=lnt id=hl-21-129><a class=lnlinks href=#hl-21-129>129</a>
</span><span class=lnt id=hl-21-130><a class=lnlinks href=#hl-21-130>130</a>
</span><span class=lnt id=hl-21-131><a class=lnlinks href=#hl-21-131>131</a>
</span><span class=lnt id=hl-21-132><a class=lnlinks href=#hl-21-132>132</a>
</span><span class=lnt id=hl-21-133><a class=lnlinks href=#hl-21-133>133</a>
</span><span class=lnt id=hl-21-134><a class=lnlinks href=#hl-21-134>134</a>
</span><span class=lnt id=hl-21-135><a class=lnlinks href=#hl-21-135>135</a>
</span><span class=lnt id=hl-21-136><a class=lnlinks href=#hl-21-136>136</a>
</span><span class=lnt id=hl-21-137><a class=lnlinks href=#hl-21-137>137</a>
</span><span class=lnt id=hl-21-138><a class=lnlinks href=#hl-21-138>138</a>
</span><span class=lnt id=hl-21-139><a class=lnlinks href=#hl-21-139>139</a>
</span><span class=lnt id=hl-21-140><a class=lnlinks href=#hl-21-140>140</a>
</span><span class=lnt id=hl-21-141><a class=lnlinks href=#hl-21-141>141</a>
</span><span class=lnt id=hl-21-142><a class=lnlinks href=#hl-21-142>142</a>
</span><span class=lnt id=hl-21-143><a class=lnlinks href=#hl-21-143>143</a>
</span><span class=lnt id=hl-21-144><a class=lnlinks href=#hl-21-144>144</a>
</span><span class=lnt id=hl-21-145><a class=lnlinks href=#hl-21-145>145</a>
</span><span class=lnt id=hl-21-146><a class=lnlinks href=#hl-21-146>146</a>
</span><span class=lnt id=hl-21-147><a class=lnlinks href=#hl-21-147>147</a>
</span><span class=lnt id=hl-21-148><a class=lnlinks href=#hl-21-148>148</a>
</span><span class=lnt id=hl-21-149><a class=lnlinks href=#hl-21-149>149</a>
</span><span class=lnt id=hl-21-150><a class=lnlinks href=#hl-21-150>150</a>
</span><span class=lnt id=hl-21-151><a class=lnlinks href=#hl-21-151>151</a>
</span><span class=lnt id=hl-21-152><a class=lnlinks href=#hl-21-152>152</a>
</span><span class=lnt id=hl-21-153><a class=lnlinks href=#hl-21-153>153</a>
</span><span class=lnt id=hl-21-154><a class=lnlinks href=#hl-21-154>154</a>
</span><span class=lnt id=hl-21-155><a class=lnlinks href=#hl-21-155>155</a>
</span><span class=lnt id=hl-21-156><a class=lnlinks href=#hl-21-156>156</a>
</span><span class=lnt id=hl-21-157><a class=lnlinks href=#hl-21-157>157</a>
</span><span class=lnt id=hl-21-158><a class=lnlinks href=#hl-21-158>158</a>
</span><span class=lnt id=hl-21-159><a class=lnlinks href=#hl-21-159>159</a>
</span><span class=lnt id=hl-21-160><a class=lnlinks href=#hl-21-160>160</a>
</span><span class=lnt id=hl-21-161><a class=lnlinks href=#hl-21-161>161</a>
</span><span class=lnt id=hl-21-162><a class=lnlinks href=#hl-21-162>162</a>
</span><span class=lnt id=hl-21-163><a class=lnlinks href=#hl-21-163>163</a>
</span><span class=lnt id=hl-21-164><a class=lnlinks href=#hl-21-164>164</a>
</span><span class=lnt id=hl-21-165><a class=lnlinks href=#hl-21-165>165</a>
</span><span class=lnt id=hl-21-166><a class=lnlinks href=#hl-21-166>166</a>
</span><span class=lnt id=hl-21-167><a class=lnlinks href=#hl-21-167>167</a>
</span><span class=lnt id=hl-21-168><a class=lnlinks href=#hl-21-168>168</a>
</span><span class=lnt id=hl-21-169><a class=lnlinks href=#hl-21-169>169</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Set</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NodeState</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;노드 상태 정의&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>NORMAL</span> <span class=o>=</span> <span class=s2>&#34;normal&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>MIGRATING</span> <span class=o>=</span> <span class=s2>&#34;migrating&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>IMPORTING</span> <span class=o>=</span> <span class=s2>&#34;importing&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>COMPLETED</span> <span class=o>=</span> <span class=s2>&#34;completed&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RedisClusterSync</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>node_id</span> <span class=o>=</span> <span class=n>node_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>NodeState</span><span class=o>.</span><span class=n>NORMAL</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>keys_storage</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># 키-값 저장소</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 동기화 객체들</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state_mutex</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>migration_complete</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>state_mutex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>import_ready</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>state_mutex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 마이그레이션 관련 상태</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>migrating_keys</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>pending_imports</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>start_key_migration</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>target_node</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>keys_to_migrate</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;키 마이그레이션 시작 (소스 노드)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 키 마이그레이션 시작: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>keys_to_migrate</span><span class=p>)</span><span class=si>}</span><span class=s2>개 키 -&gt; </span><span class=si>{</span><span class=n>target_node</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 상태를 마이그레이션으로 변경</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>NodeState</span><span class=o>.</span><span class=n>MIGRATING</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>migrating_keys</span> <span class=o>=</span> <span class=n>keys_to_migrate</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 다른 노드들이 준비될 때까지 대기</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>NodeState</span><span class=o>.</span><span class=n>COMPLETED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 마이그레이션 완료 대기 중…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>migration_complete</span><span class=o>.</span><span class=n>wait</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 마이그레이션 완료 확인됨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>prepare_key_import</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>source_node</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>incoming_keys</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;키 임포트 준비 (타겟 노드)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 키 임포트 준비: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>incoming_keys</span><span class=p>)</span><span class=si>}</span><span class=s2>개 키 &lt;- </span><span class=si>{</span><span class=n>source_node</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 상태를 임포팅으로 변경</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>NodeState</span><span class=o>.</span><span class=n>IMPORTING</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>pending_imports</span> <span class=o>=</span> <span class=n>incoming_keys</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 임포트 준비 완료 신호</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>import_ready</span><span class=o>.</span><span class=n>notify_all</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>execute_key_transfer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>target_node_sync</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;실제 키 전송 실행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 마이그레이션할 키들을 준비</span>
</span></span><span class=line><span class=cl>            <span class=n>keys_to_transfer</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>migrating_keys</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>keys_storage</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>keys_to_transfer</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>keys_storage</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 키 전송 실행: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>keys_to_transfer</span><span class=p>)</span><span class=si>}</span><span class=s2>개&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 타겟 노드에 키 전송 (실제로는 네트워크를 통해)</span>
</span></span><span class=line><span class=cl>        <span class=n>target_node_sync</span><span class=o>.</span><span class=n>prepare_key_import</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=p>,</span> <span class=n>keys_to_transfer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 타겟 노드가 준비될 때까지 대기</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>target_node_sync</span><span class=o>.</span><span class=n>import_ready</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=n>target_node_sync</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>NodeState</span><span class=o>.</span><span class=n>IMPORTING</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 타겟 노드 임포트 준비 대기…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>target_node_sync</span><span class=o>.</span><span class=n>import_ready</span><span class=o>.</span><span class=n>wait</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 키 전송 완료 처리</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_complete_migration</span><span class=p>(</span><span class=n>keys_to_transfer</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>target_node_sync</span><span class=o>.</span><span class=n>_complete_import</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_complete_migration</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>transferred_keys</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;마이그레이션 완료 처리 (소스 노드)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 전송된 키들을 로컬에서 제거</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>transferred_keys</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>keys_storage</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=n>keys_storage</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 키 삭제: </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 상태를 완료로 변경</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>NodeState</span><span class=o>.</span><span class=n>COMPLETED</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>migrating_keys</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 마이그레이션 완료 신호</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>migration_complete</span><span class=o>.</span><span class=n>notify_all</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 마이그레이션 완료 - 남은 키: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>keys_storage</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_complete_import</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;임포트 완료 처리 (타겟 노드)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 펜딩된 키들을 로컬 저장소에 추가</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>pending_imports</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>keys_storage</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 키 임포트: </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2> = </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 상태를 완료로 변경</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>NodeState</span><span class=o>.</span><span class=n>COMPLETED</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>pending_imports</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 임포트 완료 - 총 키: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>keys_storage</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>add_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;키-값 추가 (테스트용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>keys_storage</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=si>}</span><span class=s2>] 키 추가: </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2> = </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_state_info</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;현재 상태 정보 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;node_id&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>node_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;state&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;keys_count&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>keys_storage</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;migrating_keys&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>migrating_keys</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;pending_imports&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>pending_imports</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>simulate_cluster_migration</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;클러스터 키 마이그레이션 시뮬레이션&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 노드 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>node1</span> <span class=o>=</span> <span class=n>RedisClusterSync</span><span class=p>(</span><span class=s2>&#34;node1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>node2</span> <span class=o>=</span> <span class=n>RedisClusterSync</span><span class=p>(</span><span class=s2>&#34;node2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>node3</span> <span class=o>=</span> <span class=n>RedisClusterSync</span><span class=p>(</span><span class=s2>&#34;node3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 초기 데이터 설정</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>node1</span><span class=o>.</span><span class=n>add_key</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;key_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;value_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 마이그레이션할 키 선택</span>
</span></span><span class=line><span class=cl>    <span class=n>keys_to_migrate</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;key_0&#34;</span><span class=p>,</span> <span class=s2>&#34;key_1&#34;</span><span class=p>,</span> <span class=s2>&#34;key_2&#34;</span><span class=p>,</span> <span class=s2>&#34;key_3&#34;</span><span class=p>,</span> <span class=s2>&#34;key_4&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 마이그레이션 시작 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 마이그레이션 스레드들</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>migration_task</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>node1</span><span class=o>.</span><span class=n>start_key_migration</span><span class=p>(</span><span class=s2>&#34;node2&#34;</span><span class=p>,</span> <span class=n>keys_to_migrate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>transfer_task</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 약간의 지연</span>
</span></span><span class=line><span class=cl>        <span class=n>node1</span><span class=o>.</span><span class=n>execute_key_transfer</span><span class=p>(</span><span class=n>node2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 스레드 실행</span>
</span></span><span class=line><span class=cl>    <span class=n>migration_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>migration_task</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>transfer_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>transfer_task</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>migration_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>transfer_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>migration_thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>transfer_thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 마이그레이션 완료 후 상태 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Node1: </span><span class=si>{</span><span class=n>node1</span><span class=o>.</span><span class=n>get_state_info</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Node2: </span><span class=si>{</span><span class=n>node2</span><span class=o>.</span><span class=n>get_state_info</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예제</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>simulate_cluster_migration</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-프로듀서-producer-와-컨슈머-consumer>사례: 프로듀서 (Producer) 와 컨슈머 (Consumer)<a hidden class=anchor aria-hidden=true href=#사례-프로듀서-producer-와-컨슈머-consumer>#</a></h5><p><strong>시나리오</strong>: 프로듀서 (Producer) 가 고정 크기 버퍼에 데이터를 넣고, 컨슈머 (Consumer) 가 데이터를 꺼낸다. 버퍼가 가득 차면 프로듀서는 대기, 버퍼가 비면 컨슈머는 대기한다. 상태 변화 시 알림 (notify/signal) 으로 상대를 깨운다.</p><p><strong>시스템 구성</strong>:</p><ul><li><code>BoundedBlockingQueue</code> (공유 버퍼)</li><li><code>Producer</code> 스레드 2 개</li><li><code>Consumer</code> 스레드 2 개</li><li><code>Lock(Mutex)</code>, <code>Condition</code> 2 개 (<code>notEmpty</code>, <code>notFull</code>)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    P1[Producer-1] --&gt; Q[Bounded Queue]
    P2[Producer-2] --&gt; Q
    C1[Consumer-1] --&gt; Q
    C2[Consumer-2] --&gt; Q
    Q --&gt; L[Lock]
    Q --&gt; CE[Condition: notEmpty]
    Q --&gt; CF[Condition: notFull]
</pre><p><strong>Workflow</strong>:</p><ol><li>Producer 가 락 획득 → 버퍼 full 이면 <code>notFull.wait()</code> 루프 대기</li><li>아이템 push → <code>notEmpty.notify()</code> → 락 해제</li><li>Consumer 가 락 획득 → 버퍼 empty 면 <code>notEmpty.wait()</code> 루프 대기</li><li>아이템 pop → <code>notFull.notify()</code> → 락 해제</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Condition: 상태 기반 대기/깨움</li><li>Lock: 상태 변경과 조건 검사 사이의 원자성 보장</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 폴링, busy-wait, 경쟁 심함</li><li>도입 후: 필요 시에만 슬립, CPU 낭비 감소, 처리율 안정화</li></ul><p><strong>구현 예시</strong>: Python, <code>threading.Condition</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17>17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18>18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19>19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20>20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21>21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22>22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23>23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24>24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25>25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26>26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27>27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28>28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29>29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30>30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31>31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32>32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33>33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34>34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35>35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36>36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37>37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38>38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39>39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40>40</a>
</span><span class=lnt id=hl-23-41><a class=lnlinks href=#hl-23-41>41</a>
</span><span class=lnt id=hl-23-42><a class=lnlinks href=#hl-23-42>42</a>
</span><span class=lnt id=hl-23-43><a class=lnlinks href=#hl-23-43>43</a>
</span><span class=lnt id=hl-23-44><a class=lnlinks href=#hl-23-44>44</a>
</span><span class=lnt id=hl-23-45><a class=lnlinks href=#hl-23-45>45</a>
</span><span class=lnt id=hl-23-46><a class=lnlinks href=#hl-23-46>46</a>
</span><span class=lnt id=hl-23-47><a class=lnlinks href=#hl-23-47>47</a>
</span><span class=lnt id=hl-23-48><a class=lnlinks href=#hl-23-48>48</a>
</span><span class=lnt id=hl-23-49><a class=lnlinks href=#hl-23-49>49</a>
</span><span class=lnt id=hl-23-50><a class=lnlinks href=#hl-23-50>50</a>
</span><span class=lnt id=hl-23-51><a class=lnlinks href=#hl-23-51>51</a>
</span><span class=lnt id=hl-23-52><a class=lnlinks href=#hl-23-52>52</a>
</span><span class=lnt id=hl-23-53><a class=lnlinks href=#hl-23-53>53</a>
</span><span class=lnt id=hl-23-54><a class=lnlinks href=#hl-23-54>54</a>
</span><span class=lnt id=hl-23-55><a class=lnlinks href=#hl-23-55>55</a>
</span><span class=lnt id=hl-23-56><a class=lnlinks href=#hl-23-56>56</a>
</span><span class=lnt id=hl-23-57><a class=lnlinks href=#hl-23-57>57</a>
</span><span class=lnt id=hl-23-58><a class=lnlinks href=#hl-23-58>58</a>
</span><span class=lnt id=hl-23-59><a class=lnlinks href=#hl-23-59>59</a>
</span><span class=lnt id=hl-23-60><a class=lnlinks href=#hl-23-60>60</a>
</span><span class=lnt id=hl-23-61><a class=lnlinks href=#hl-23-61>61</a>
</span><span class=lnt id=hl-23-62><a class=lnlinks href=#hl-23-62>62</a>
</span><span class=lnt id=hl-23-63><a class=lnlinks href=#hl-23-63>63</a>
</span><span class=lnt id=hl-23-64><a class=lnlinks href=#hl-23-64>64</a>
</span><span class=lnt id=hl-23-65><a class=lnlinks href=#hl-23-65>65</a>
</span><span class=lnt id=hl-23-66><a class=lnlinks href=#hl-23-66>66</a>
</span><span class=lnt id=hl-23-67><a class=lnlinks href=#hl-23-67>67</a>
</span><span class=lnt id=hl-23-68><a class=lnlinks href=#hl-23-68>68</a>
</span><span class=lnt id=hl-23-69><a class=lnlinks href=#hl-23-69>69</a>
</span><span class=lnt id=hl-23-70><a class=lnlinks href=#hl-23-70>70</a>
</span><span class=lnt id=hl-23-71><a class=lnlinks href=#hl-23-71>71</a>
</span><span class=lnt id=hl-23-72><a class=lnlinks href=#hl-23-72>72</a>
</span><span class=lnt id=hl-23-73><a class=lnlinks href=#hl-23-73>73</a>
</span><span class=lnt id=hl-23-74><a class=lnlinks href=#hl-23-74>74</a>
</span><span class=lnt id=hl-23-75><a class=lnlinks href=#hl-23-75>75</a>
</span><span class=lnt id=hl-23-76><a class=lnlinks href=#hl-23-76>76</a>
</span><span class=lnt id=hl-23-77><a class=lnlinks href=#hl-23-77>77</a>
</span><span class=lnt id=hl-23-78><a class=lnlinks href=#hl-23-78>78</a>
</span><span class=lnt id=hl-23-79><a class=lnlinks href=#hl-23-79>79</a>
</span><span class=lnt id=hl-23-80><a class=lnlinks href=#hl-23-80>80</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>deque</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BoundedBlockingQueue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;고정 크기 큐: 두 조건 변수(notFull, notEmpty)로 상태를 제어&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>capacity</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>capacity</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;capacity must be &gt; 0&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>capacity</span> <span class=o>=</span> <span class=n>capacity</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>q</span> <span class=o>=</span> <span class=n>deque</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>notEmpty</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>notFull</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>put</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;큐가 가득 차면 notFull 조건에서 대기. timeout 지원.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>end</span> <span class=o>=</span> <span class=kc>None</span> <span class=k>if</span> <span class=n>timeout</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>time</span><span class=o>.</span><span class=n>monotonic</span><span class=p>()</span> <span class=o>+</span> <span class=n>timeout</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>notFull</span><span class=p>:</span>  <span class=c1># lock도 함께 획득</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>q</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>capacity</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>timeout</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>notFull</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>remaining</span> <span class=o>=</span> <span class=n>end</span> <span class=o>-</span> <span class=n>time</span><span class=o>.</span><span class=n>monotonic</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>remaining</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>raise</span> <span class=ne>TimeoutError</span><span class=p>(</span><span class=s2>&#34;put timeout&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>notFull</span><span class=o>.</span><span class=n>wait</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=n>remaining</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>q</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># 상태 변경 직후 알림</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>notEmpty</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>  <span class=c1># 하나만 깨워도 충분한 패턴</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>take</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;큐가 비었으면 notEmpty 조건에서 대기. timeout 지원.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>end</span> <span class=o>=</span> <span class=kc>None</span> <span class=k>if</span> <span class=n>timeout</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>time</span><span class=o>.</span><span class=n>monotonic</span><span class=p>()</span> <span class=o>+</span> <span class=n>timeout</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>notEmpty</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>q</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>timeout</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>notEmpty</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>remaining</span> <span class=o>=</span> <span class=n>end</span> <span class=o>-</span> <span class=n>time</span><span class=o>.</span><span class=n>monotonic</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>remaining</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>raise</span> <span class=ne>TimeoutError</span><span class=p>(</span><span class=s2>&#34;take timeout&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>notEmpty</span><span class=o>.</span><span class=n>wait</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=n>remaining</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>q</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=c1># 상태 변경 직후 알림</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>notFull</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>size</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>q</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---- 데모: 생산자/소비자 ----</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>producer</span><span class=p>(</span><span class=n>q</span><span class=p>:</span> <span class=n>BoundedBlockingQueue</span><span class=p>,</span> <span class=n>pid</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>n</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;P</span><span class=si>{</span><span class=n>pid</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mf>2.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Producer </span><span class=si>{</span><span class=n>pid</span><span class=si>}</span><span class=s2>] put </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2>, size=</span><span class=si>{</span><span class=n>q</span><span class=o>.</span><span class=n>size</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consumer</span><span class=p>(</span><span class=n>q</span><span class=p>:</span> <span class=n>BoundedBlockingQueue</span><span class=p>,</span> <span class=n>cid</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>n</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=n>q</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>2.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Consumer </span><span class=si>{</span><span class=n>cid</span><span class=si>}</span><span class=s2>] took </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2>, size=</span><span class=si>{</span><span class=n>q</span><span class=o>.</span><span class=n>size</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>BoundedBlockingQueue</span><span class=p>(</span><span class=n>capacity</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>producers</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>producer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>q</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>                 <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>producer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>q</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>10</span><span class=p>))]</span>
</span></span><span class=line><span class=cl>    <span class=n>consumers</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>consumer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>q</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>                 <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>consumer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>q</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>10</span><span class=p>))]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>producers</span> <span class=o>+</span> <span class=n>consumers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>producers</span> <span class=o>+</span> <span class=n>consumers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Done. final size:&#34;</span><span class=p>,</span> <span class=n>q</span><span class=o>.</span><span class=n>size</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>while</code> 루프: 스푸리어스 웨이크업 및 경쟁 시나리오 대비</li><li><strong>두 조건 변수</strong>: <code>notFull</code>/<code>notEmpty</code> 로 역할 분리 → 불필요한 깨어남 감소</li><li><code>timeout</code> 지원: 운영 중 hang 진단/회복에 유용</li><li><code>notify()</code> vs <code>notify_all()</code>: 여기선 단일 깨움이 적합 (큐 1 칸만 변함). 폭주/우선순위 문제 있으면 <code>notify_all()</code> 고려</li></ul><h3 id=운영-및-최적화>운영 및 최적화<a hidden class=anchor aria-hidden=true href=#운영-및-최적화>#</a></h3><h4 id=보안-및-거버넌스>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스>#</a></h4><table><thead><tr><th>보안/거버넌스 항목</th><th>설명</th><th>위협 요소</th><th>대응 방안</th><th>기술/도구</th></tr></thead><tbody><tr><td>경쟁 상태 보안</td><td>다중 스레드 접근 시 동시 수정 위험</td><td>데이터 변조, 비정상 동작</td><td>락, CAS, 메모리 배리어</td><td>Atomic API, std::atomic</td></tr><tr><td>시간 기반 공격</td><td>실행 시간으로 내부 상태 유추 가능</td><td>키 추출, 조건 우회</td><td>시간 균등 처리</td><td>Constant-time 연산</td></tr><tr><td>우선순위 역전</td><td>낮은 우선순위 스레드가 높은 스레드 블로킹</td><td>시스템 응답 지연</td><td>우선순위 상속, 우선순위 큐</td><td>RTOS 스케줄링, Priority Inheritance</td></tr><tr><td>메모리 안전성</td><td>장기 대기나 예외로 인한 리소스 누수</td><td>시스템 불안정</td><td>타임아웃 설정, 자동 메모리 관리</td><td>RAII, GC, ASan</td></tr><tr><td>권한 상승 및 격리 실패</td><td>스레드 간 권한 격리 실패로 내부 접근 가능</td><td>데이터 탈취</td><td>최소 권한 원칙, 컨테이너 격리</td><td>SELinux, AppArmor</td></tr><tr><td>서비스 거부 (DoS)</td><td>무한 대기, 신호 누락 등으로 인한 시스템 정지</td><td>가용성 저하</td><td>타임아웃, watchdog</td><td>systemd watchdog, wait timeout</td></tr><tr><td>정보 유출 (Side-channel)</td><td>캐시, 타이밍 등으로 조건 상태 노출</td><td>민감 정보 노출</td><td>메모리 접근 무작위화, 방어적 프로그래밍</td><td>Intel SGX, TrustZone</td></tr><tr><td>감사 및 추적 가능성</td><td>wait/signal 의 흐름 추적 어려움</td><td>비정상 대기 탐지 어려움</td><td>동기화 이벤트 로깅</td><td>Audit log, Telemetry</td></tr><tr><td>규정 준수 (Governance)</td><td>산업 표준 및 보안 규제 준수 필요</td><td>인증 실패, 법적 책임</td><td>정적 분석, 코드 검증</td><td>MISRA, DO-178C, GDPR 등</td></tr></tbody></table><p>조건 동기화는 동시성 문제 해결의 핵심 도구이지만, <strong>보안적인 측면에서 치명적 결함의 진원지</strong>가 될 수 있다.<br>특히, <strong>경쟁 상태, 우선순위 역전, 시간 기반 공격, 서비스 거부</strong>와 같은 취약점은 전체 시스템 안정성과 무결성에 심각한 영향을 줄 수 있다.</p><p>따라서 보안적인 관점에서 조건 동기화를 사용할 때는:</p><ul><li><strong>락 범위 최소화</strong>, <strong>신호 후 조건 재검사</strong>, <strong>자원 회수 메커니즘</strong>, <strong>우선순위 정책 설계</strong>, <strong>타이밍 균등화</strong> 등의 대응 전략을 반드시 적용해야 한다.</li><li>또한, <strong>정적 분석 도구</strong>, <strong>감사 로그</strong>, <strong>표준 준수 검증</strong>을 통해 거버넌스 차원에서 운영 위험을 예방해야 한다.</li></ul><p>결론적으로, 조건 동기화는 강력한 기능이지만, <strong>보안과 거버넌스가 뒷받침되지 않으면 시스템 전체의 약점</strong>으로 작용할 수 있다.</p><h4 id=모니터링-및-관측성>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성>#</a></h4><p>조건 동기화 환경에서의 모니터링은 <strong>스레드 상태 추적</strong>, <strong>락 경합 분석</strong>, <strong>신호 이벤트 감시</strong> 등을 통해 시스템 병목, 오동작, 데드락 가능성을 사전에 파악하고 대응하는 데 중요한 역할을 한다.</p><p>핵심 지표로는 <code>대기 시간</code>, <code>깨어남 횟수</code>, <code>락 경합률</code>, <code>큐 길이</code> 등이 있으며, 이를 통해 스레드 성능, 자원 경합, 상태 변화 흐름을 실시간으로 관찰할 수 있다.</p><p>운영 도구로는 Java 의 JMX/ThreadMXBean, Python 의 prometheus_client, 수동 로그 기반의 분석 등이 활용된다. 또한 로그 분석 및 알림 설정을 통해 <code>Spurious Wakeup</code>, <code>Thundering Herd</code>, <code>Deadlock</code> 등을 효과적으로 감지하고 대응할 수 있다.</p><table><thead><tr><th>항목</th><th>설명</th><th>주요 지표 (메트릭)</th><th>수집 방법 / 도구 예시</th></tr></thead><tbody><tr><td><strong>대기 시간 추적</strong></td><td>스레드가 조건 변수에서 대기한 평균/최대 시간 측정</td><td><code>avg_wait_time</code>, <code>max_wait_time</code></td><td><code>time.perf_counter()</code>, <code>JMX</code></td></tr><tr><td><strong>신호 이벤트 감시</strong></td><td><code>notify()</code>/<code>notify_all()</code> 로 깨어난 스레드 수 추적</td><td><code>notified_threads_count</code>, <code>signal_rate</code></td><td>로그 기반 카운팅, 메트릭 수집기</td></tr><tr><td><strong>락 경쟁률 분석</strong></td><td>락 획득 지연 시간 및 경쟁 발생률 측정</td><td><code>lock_acquire_delay</code>, <code>lock_held_duration</code>, <code>contentions</code></td><td><code>SyncMonitor</code>, <code>Thread contention logs</code></td></tr><tr><td><strong>데드락 진단</strong></td><td>상호 대기 상황 발생 여부 모니터링</td><td><code>deadlocked_threads</code>, <code>thread blocking graph</code></td><td>Java: <code>ThreadMXBean.findDeadlockedThreads()</code></td></tr><tr><td><strong>대기 큐 길이</strong></td><td>조건 변수 큐 또는 락 대기 큐에 쌓인 스레드 수</td><td><code>wait_queue_length</code>, <code>entry_queue_size</code></td><td>내부 상태 추적 or 커널 도구 (e.g., eBPF)</td></tr><tr><td><strong>이벤트 폭주 탐지</strong></td><td><code>broadcast()</code> 로 인한 과도한 스레드 깨어남 확인</td><td><code>broadcast_count</code>, <code>spike_rate</code></td><td>notify 이벤트 로그 분석, custom hook</td></tr><tr><td><strong>실시간 처리량</strong></td><td>초당 처리되는 wait/notify 연산량</td><td><code>sync_ops_per_sec</code>, <code>throughput</code></td><td>Prometheus, JMX exporter</td></tr><tr><td><strong>관측성 강화 전략</strong></td><td>지연, 경합, 블로킹을 추적하기 위한 로깅 및 시각화 체계 구축</td><td>커스텀 로그, 알림 임계값, 대시보드 상태 시각화</td><td>Grafana, Alertmanager, 로그 기반 모니터링 시스템 (Logstash 등)</td></tr></tbody></table><p><strong>성능 모니터링 메트릭:</strong></p><pre class=mermaid>graph TB
    subgraph &#34;컨디션 동기화 모니터링&#34;
        A[응답 시간] --&gt; M[메트릭 수집기]
        B[대기 시간] --&gt; M
        C[처리량] --&gt; M
        D[경합 비율] --&gt; M
        E[데드락 발생] --&gt; M
        
        M --&gt; F[대시보드]
        M --&gt; G[알림 시스템]
        M --&gt; H[로그 분석]
    end
</pre><p><strong>핵심 메트릭:</strong></p><table><thead><tr><th>메트릭 카테고리</th><th>측정 항목</th><th>정상 범위</th><th>임계값</th><th>수집 방법</th></tr></thead><tbody><tr><td>지연시간</td><td>락 획득 시간</td><td>&lt; 1ms</td><td>> 10ms</td><td>타임스탬프 기반 측정</td></tr><tr><td>처리량</td><td>초당 동기화 연산 수</td><td>> 10K ops/sec</td><td>&lt; 1K ops/sec</td><td>카운터 기반 측정</td></tr><tr><td>경합</td><td>락 경합 비율</td><td>&lt; 5%</td><td>> 20%</td><td>충돌 카운터</td></tr><tr><td>리소스</td><td>대기 큐 길이</td><td>&lt; 10</td><td>> 100</td><td>큐 사이즈 모니터링</td></tr></tbody></table><p><strong>로깅 전략:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37>37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38>38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39>39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40>40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41>41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42>42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43>43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44>44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45>45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46>46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47>47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48>48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49>49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50>50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51>51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52>52</a>
</span><span class=lnt id=hl-25-53><a class=lnlinks href=#hl-25-53>53</a>
</span><span class=lnt id=hl-25-54><a class=lnlinks href=#hl-25-54>54</a>
</span><span class=lnt id=hl-25-55><a class=lnlinks href=#hl-25-55>55</a>
</span><span class=lnt id=hl-25-56><a class=lnlinks href=#hl-25-56>56</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 동기화 전용 로거 설정</span>
</span></span><span class=line><span class=cl><span class=n>sync_logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;sync_monitor&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sync_logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SyncMonitor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;lock_acquisitions&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;wait_times&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;contentions&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;deadlock_detections&#39;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>monitor_lock_acquisition</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lock_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;락 획득 모니터링 컨텍스트 매니저&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>sync_logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Lock acquisition attempt: </span><span class=si>{</span><span class=n>lock_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>acquisition_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;lock_acquisitions&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;wait_times&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>acquisition_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>acquisition_time</span> <span class=o>&gt;</span> <span class=mf>0.01</span><span class=p>:</span>  <span class=c1># 10ms 이상이면 경합으로 간주</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;contentions&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=n>sync_logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Lock contention detected: </span><span class=si>{</span><span class=n>lock_name</span><span class=si>}</span><span class=s2>, time: </span><span class=si>{</span><span class=n>acquisition_time</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>s&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>sync_logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Lock acquisition failed: </span><span class=si>{</span><span class=n>lock_name</span><span class=si>}</span><span class=s2>, error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>sync_logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Lock released: </span><span class=si>{</span><span class=n>lock_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_performance_report</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;성능 리포트 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;wait_times&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;No data available&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>avg_wait</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;wait_times&#39;</span><span class=p>])</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;wait_times&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>max_wait</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;wait_times&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>contention_rate</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;contentions&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;lock_acquisitions&#39;</span><span class=p>])</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        동기화 성능 리포트:
</span></span></span><span class=line><span class=cl><span class=s2>        - 총 락 획득 횟수: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;lock_acquisitions&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        - 평균 대기 시간: </span><span class=si>{</span><span class=n>avg_wait</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>초
</span></span></span><span class=line><span class=cl><span class=s2>        - 최대 대기 시간: </span><span class=si>{</span><span class=n>max_wait</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>초
</span></span></span><span class=line><span class=cl><span class=s2>        - 경합 비율: </span><span class=si>{</span><span class=n>contention_rate</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>%
</span></span></span><span class=line><span class=cl><span class=s2>        - 데드락 탐지 횟수: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;deadlock_detections&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=실무-적용-고려사항-및-주의점>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점>#</a></h4><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>권장사항</th><th>위험도</th></tr></thead><tbody><tr><td>락/조건 변수</td><td>조건 재검사 (<code>while</code>)</td><td>스푸리어스 웨이크업으로 인한 논리 오류 가능</td><td>항상 while 루프 조건 재확인</td><td>높음</td></tr><tr><td>락/조건 변수</td><td>락 획득/해제 순서 관리</td><td>데드락 발생 가능</td><td>전역 락 순서 정의, 문서화</td><td>높음</td></tr><tr><td>락/조건 변수</td><td>락 범위 최적화</td><td>긴 락 보유 시 병목 발생</td><td>임계 영역 최소화, 락 해제 후 작업 분리</td><td>중간</td></tr><tr><td>신호/타이밍</td><td>notify 시점</td><td>조건 만족 후 신호하지 않으면 스레드 무한 대기 가능</td><td>상태 변경 직후에 notify 수행</td><td>높음</td></tr><tr><td>신호/타이밍</td><td>signal vs broadcast</td><td>broadcast 사용 시 스레드 경합 발생</td><td>필요 시 signal 사용, 조건 분리 (Two-condition 전략)</td><td>중간</td></tr><tr><td>예외/복구</td><td>예외 발생 시 자원 정리</td><td>예외 중 락이 해제되지 않으면 교착 상태 발생</td><td>RAII 적용, finally 블록 사용 등</td><td>높음</td></tr><tr><td>성능</td><td>Thundering Herd</td><td>모든 스레드 깨어나 경합 → 캐시 손실, 병목</td><td>signal 사용, 조건 분리 전략</td><td>중간</td></tr><tr><td>성능</td><td>Context Switch 과다</td><td>빈번한 전환으로 인한 성능 저하</td><td>스핀락 혼용, 배치 처리, 조건 큐 설계 개선</td><td>중간</td></tr><tr><td>스케줄링</td><td>우선순위 역전</td><td>낮은 우선순위 스레드가 락 점유 시 고우선순위 스레드 대기</td><td>우선순위 상속, 우선순위 Ceiling 적용</td><td>중간</td></tr><tr><td>운영/디버깅</td><td>테스트 재현성 확보</td><td>동기화 오류는 재현 어려움</td><td>결정론적 테스트, Race Detector 사용</td><td>높음</td></tr><tr><td>운영/디버깅</td><td>로그/모니터링 관리</td><td>이슈 추적 어려움</td><td>실시간 메트릭 수집, 로그 압축/순환 로직 적용</td><td>중간</td></tr><tr><td>확장/이식성</td><td>플랫폼 간 동작 차이</td><td>OS/언어마다 조건 변수 구현 방식 상이</td><td>표준 API 사용, 테스트 플랫폼 명확화</td><td>중간</td></tr><tr><td>확장/이식성</td><td>조건 변수 재사용성</td><td>복잡한 로직 내 반복 사용 시 오류 유발</td><td>동기화 모듈화, 추상화 컴포넌트 사용</td><td>중간</td></tr></tbody></table><ol><li><p><strong>락 및 조건 변수 사용 전략</strong>:<br>조건 변수는 락과 함께 사용되어야 하며, 항상 <code>while</code> 루프로 조건을 재확인해야 한다. 락 획득 순서를 일관되게 유지하고, 락의 범위를 최소화하여 병목을 줄여야 한다.</p></li><li><p><strong>신호 및 타이밍 제어 전략</strong>:<br>조건이 변경된 직후에만 <code>notify()</code> 를 호출해야 하며, 스레드 경합을 방지하기 위해 <code>signal()</code> 과 <code>broadcast()</code> 를 상황에 맞게 선택해야 한다.</p></li><li><p><strong>예외 안전성과 복구</strong>:<br>예외 발생 시 락 해제가 되지 않으면 데드락 발생 위험이 크다. 이를 방지하기 위해 RAII 나 finally 패턴을 사용해 자원 해제를 보장해야 한다.</p></li><li><p><strong>성능 및 스케줄링 이슈</strong>:<br>스레드 폭주나 컨텍스트 스위치로 인해 성능 저하가 발생할 수 있다. 스핀락, 배치 처리, 조건 큐 최적화 등을 통해 대응할 수 있다. 우선순위 역전 문제는 실시간 시스템에서 특히 주의해야 한다.</p></li><li><p><strong>운영·테스트·디버깅 전략</strong>:<br>조건 동기화는 타이밍 의존이 높아 테스트가 어려우므로 결정론적 테스트와 레이스 감지 도구를 활용해야 한다. 로그와 모니터링 전략도 병행되어야 한다.</p></li><li><p><strong>플랫폼·확장성 고려</strong>:<br>조건 변수의 내부 동작이 플랫폼에 따라 다르므로, 크로스 플랫폼 지원이 필요한 경우에는 표준 API 및 명확한 문서화를 통한 관리가 필수다.</p></li></ol><h4 id=성능-최적화-전략>성능 최적화 전략<a hidden class=anchor aria-hidden=true href=#성능-최적화-전략>#</a></h4><table><thead><tr><th>카테고리</th><th>전략 항목</th><th>설명</th><th>기대 효과</th><th>주의사항</th></tr></thead><tbody><tr><td>락 최적화</td><td>락 분할</td><td>세그먼트화된 락으로 병렬성 향상</td><td>경합 최소화, 병목 해소</td><td>복잡성 증가</td></tr><tr><td></td><td>락 유지 시간 최소화</td><td>조건 검사 및 갱신 구간만 보호</td><td>락 보유 시간 단축</td><td>락 범위 누락 주의</td></tr><tr><td>대기/통지 전략</td><td>신호 최소화</td><td>조건 충족 시에만 notify, broadcast 사용 지양</td><td>컨텍스트 전환 감소</td><td>누락 시 deadlock 가능</td></tr><tr><td></td><td>배치 통지</td><td>여러 wakeup 신호를 한 번에 처리</td><td>signal 효율 극대화</td><td>응답성 저하 우려</td></tr><tr><td></td><td>적응적 스핀락</td><td>짧은 대기는 spin, 긴 대기는 block</td><td>CPU 자원 최적화</td><td>CPU 낭비 가능성</td></tr><tr><td>메모리/하드웨어 최적화</td><td>캐시 최적화</td><td>false sharing 제거, 메모리 정렬</td><td>30% 이상 성능 개선</td><td>구조체 정렬 고려 필요</td></tr><tr><td></td><td>메모리 순서 최적화</td><td>불필요한 memory barrier 제거</td><td>오버헤드 감소</td><td>정확성 테스트 필수</td></tr><tr><td>락 없는 병렬성</td><td>CAS 기반 락 프리 구조체</td><td>compare-and-swap 기반 구조 설계</td><td>최대한의 병렬성</td><td>디버깅 어려움</td></tr><tr><td>운영 안정성</td><td>타임아웃 적용</td><td>무한 대기 방지 및 장애 탐지</td><td>응답성 향상</td><td>적정 timeout 설정 필요</td></tr><tr><td></td><td>스레드 수 조절</td><td>컨텍스트 스위칭 비용 절감</td><td>안정적 처리량 유지</td><td>과소 설정 시 처리량 저하</td></tr><tr><td></td><td>지연 초기화</td><td>자원 초기화를 필요한 시점에 수행</td><td>자원 효율성 향상</td><td>thread-safe 초기화 필요</td></tr></tbody></table><p>조건 동기화에서의 성능 최적화는 단순히 락을 쓰는 것 이상의 정교한 전략이 요구된다.<br>핵심은 <strong>락 경쟁 최소화, 정확한 신호 처리, 하드웨어/메모리 최적화, 그리고 응답성을 보장하는 운영 전략</strong>이다.<br>락 분할, 캐시 친화적 구조 설계, CAS 기반의 락 프리 알고리즘 등을 적절히 적용하면 병목을 제거하고 고성능 시스템 구축이 가능하다.<br>또한 <code>타임아웃</code>, <code>스레드 수 조절</code>, <code>지연 초기화</code> 등의 운영 전략은 안정성과 확장성 확보에 중요한 역할을 한다.<br>다만 복잡도가 증가할 수 있으므로, 프로파일링을 통해 병목 지점을 정확히 파악하고 상황에 맞는 전략을 선별적으로 적용하는 것이 중요하다.</p><p><strong>고급 최적화 기법:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15>15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16>16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17>17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18>18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19>19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20>20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21>21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22>22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23>23</a>
</span><span class=lnt id=hl-26-24><a class=lnlinks href=#hl-26-24>24</a>
</span><span class=lnt id=hl-26-25><a class=lnlinks href=#hl-26-25>25</a>
</span><span class=lnt id=hl-26-26><a class=lnlinks href=#hl-26-26>26</a>
</span><span class=lnt id=hl-26-27><a class=lnlinks href=#hl-26-27>27</a>
</span><span class=lnt id=hl-26-28><a class=lnlinks href=#hl-26-28>28</a>
</span><span class=lnt id=hl-26-29><a class=lnlinks href=#hl-26-29>29</a>
</span><span class=lnt id=hl-26-30><a class=lnlinks href=#hl-26-30>30</a>
</span><span class=lnt id=hl-26-31><a class=lnlinks href=#hl-26-31>31</a>
</span><span class=lnt id=hl-26-32><a class=lnlinks href=#hl-26-32>32</a>
</span><span class=lnt id=hl-26-33><a class=lnlinks href=#hl-26-33>33</a>
</span><span class=lnt id=hl-26-34><a class=lnlinks href=#hl-26-34>34</a>
</span><span class=lnt id=hl-26-35><a class=lnlinks href=#hl-26-35>35</a>
</span><span class=lnt id=hl-26-36><a class=lnlinks href=#hl-26-36>36</a>
</span><span class=lnt id=hl-26-37><a class=lnlinks href=#hl-26-37>37</a>
</span><span class=lnt id=hl-26-38><a class=lnlinks href=#hl-26-38>38</a>
</span><span class=lnt id=hl-26-39><a class=lnlinks href=#hl-26-39>39</a>
</span><span class=lnt id=hl-26-40><a class=lnlinks href=#hl-26-40>40</a>
</span><span class=lnt id=hl-26-41><a class=lnlinks href=#hl-26-41>41</a>
</span><span class=lnt id=hl-26-42><a class=lnlinks href=#hl-26-42>42</a>
</span><span class=lnt id=hl-26-43><a class=lnlinks href=#hl-26-43>43</a>
</span><span class=lnt id=hl-26-44><a class=lnlinks href=#hl-26-44>44</a>
</span><span class=lnt id=hl-26-45><a class=lnlinks href=#hl-26-45>45</a>
</span><span class=lnt id=hl-26-46><a class=lnlinks href=#hl-26-46>46</a>
</span><span class=lnt id=hl-26-47><a class=lnlinks href=#hl-26-47>47</a>
</span><span class=lnt id=hl-26-48><a class=lnlinks href=#hl-26-48>48</a>
</span><span class=lnt id=hl-26-49><a class=lnlinks href=#hl-26-49>49</a>
</span><span class=lnt id=hl-26-50><a class=lnlinks href=#hl-26-50>50</a>
</span><span class=lnt id=hl-26-51><a class=lnlinks href=#hl-26-51>51</a>
</span><span class=lnt id=hl-26-52><a class=lnlinks href=#hl-26-52>52</a>
</span><span class=lnt id=hl-26-53><a class=lnlinks href=#hl-26-53>53</a>
</span><span class=lnt id=hl-26-54><a class=lnlinks href=#hl-26-54>54</a>
</span><span class=lnt id=hl-26-55><a class=lnlinks href=#hl-26-55>55</a>
</span><span class=lnt id=hl-26-56><a class=lnlinks href=#hl-26-56>56</a>
</span><span class=lnt id=hl-26-57><a class=lnlinks href=#hl-26-57>57</a>
</span><span class=lnt id=hl-26-58><a class=lnlinks href=#hl-26-58>58</a>
</span><span class=lnt id=hl-26-59><a class=lnlinks href=#hl-26-59>59</a>
</span><span class=lnt id=hl-26-60><a class=lnlinks href=#hl-26-60>60</a>
</span><span class=lnt id=hl-26-61><a class=lnlinks href=#hl-26-61>61</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AdaptiveSpinLock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;적응적 스핀락 구현&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_spin_count</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_max_spin_count</span> <span class=o>=</span> <span class=n>max_spin_count</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_contention_history</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># 경합 히스토리</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;적응적 락 획득&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>spin_count</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calculate_optimal_spin_count</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 1단계: 스핀 락 시도</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>spin_count</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>blocking</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_record_success</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.000001</span><span class=p>)</span>  <span class=c1># 1마이크로초 대기</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 2단계: 블로킹 락 시도</span>
</span></span><span class=line><span class=cl>        <span class=n>remaining_time</span> <span class=o>=</span> <span class=n>timeout</span> <span class=o>-</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=k>if</span> <span class=n>timeout</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>blocking</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=n>remaining_time</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_record_contention</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;락 해제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_calculate_optimal_spin_count</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;최적 스핀 카운트 계산&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_contention_history</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_max_spin_count</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 최근 경합 히스토리 기반으로 적응</span>
</span></span><span class=line><span class=cl>        <span class=n>recent_contentions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_contention_history</span><span class=p>[</span><span class=o>-</span><span class=mi>10</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>avg_contention</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>recent_contentions</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>recent_contentions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>avg_contention</span> <span class=o>&lt;</span> <span class=mf>0.001</span><span class=p>:</span>  <span class=c1># 1ms 미만</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_max_spin_count</span>  <span class=c1># 더 많이 스핀</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>avg_contention</span> <span class=o>&lt;</span> <span class=mf>0.010</span><span class=p>:</span>  <span class=c1># 10ms 미만</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_max_spin_count</span> <span class=o>//</span> <span class=mi>2</span>  <span class=c1># 중간 정도 스핀</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_max_spin_count</span> <span class=o>//</span> <span class=mi>10</span>  <span class=c1># 적게 스핀</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_record_success</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>duration</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;성공적인 획득 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>  <span class=c1># 성공 시 특별한 기록 없음</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_record_contention</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>duration</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;경합 발생 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_contention_history</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>duration</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_contention_history</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_contention_history</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>  <span class=c1># 히스토리 크기 제한</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=고급-주제-advanced-topics>고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#고급-주제-advanced-topics>#</a></h3><h4 id=현재-도전-과제>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제>#</a></h4><table><thead><tr><th>카테고리</th><th>도전 과제</th><th>원인</th><th>영향</th><th>해결 방안</th></tr></thead><tbody><tr><td>시스템 확장성</td><td>멀티코어 확장 시 캐시 일관성 비용 증가</td><td>NUMA 아키텍처의 캐시 coherence 유지 비용</td><td>코어 수 증가에 따른 성능 저하</td><td>NUMA-aware 동기화, Lock-free 알고리즘 도입</td></tr><tr><td>시스템 확장성</td><td>Spurious Wakeup</td><td>OS/런타임 내부에서 예측 불가능한 깨움 발생</td><td>조건 불충족 상태에서 잘못된 실행</td><td><code>while</code> 기반 조건 재확인 패턴 적용</td></tr><tr><td>스케줄링/실시간성</td><td>우선순위 역전 (Priority Inversion)</td><td>낮은 우선순위 스레드가 락을 선점함</td><td>실시간성 저하, 데드라인 미스</td><td>Priority Inheritance 또는 Ceiling Protocol</td></tr><tr><td>조건/패턴 구조</td><td>복잡한 조건 간 협조</td><td>다중 조건 변수, 경합 조건의 충돌</td><td>교착 상태, 기아 상태 발생 가능</td><td>다중 Condition + 우선순위 큐 구성</td></tr><tr><td>클라우드/분산 환경</td><td>컨테이너/서버리스 환경에서 상태 유실</td><td>인스턴스 간 상태 공유 불가, 휘발성 메모리 구조</td><td>동기화 실패, 데이터 불일치</td><td>외부 상태 저장소 (Redis, etcd), 분산 락 적용</td></tr><tr><td>클라우드/분산 환경</td><td>분산 환경의 지연/네트워크 분할</td><td>비동기 전파, 네트워크 지연</td><td>동기화 지연, CAP trade-off 발생</td><td>Consensus 알고리즘 (Paxos, Raft), Vector Clock</td></tr><tr><td>신뢰성/디버깅</td><td>동기화 오류 디버깅 어려움</td><td>타이밍 의존적 동작, 비결정성</td><td>재현 실패, 릴리즈 전 오류 미탐지</td><td>결정론적 테스트, Chaos Engineering, Race Detector</td></tr></tbody></table><ol><li><p><strong>시스템 아키텍처 확장성 문제</strong><br>멀티코어/NUMA 환경에서는 조건 동기화 시 캐시 일관성 유지 비용이 커지며, Spurious Wakeup 과 같은 하드웨어/OS 기반 문제도 병행 발생한다. 이를 위해 락리스 알고리즘, NUMA 최적화가 요구된다.</p></li><li><p><strong>실시간성 및 스케줄링 문제</strong><br>우선순위 역전은 실시간 시스템에서 치명적이며, 조건 동기화 내에서도 정확한 타이밍 보장이 어렵다. 우선순위 상속이나 시간분할 동기화 같은 특수한 스케줄링 정책이 필요하다.</p></li><li><p><strong>복잡 조건 및 다중 동기화 구조 문제</strong><br>복수의 조건 변수나 경합 상태가 얽히면 Deadlock 이나 Starvation 이 발생할 수 있다. 이를 해결하기 위해 우선순위 기반 큐, 다중 조건 분리 설계가 필요하다.</p></li><li><p><strong>환경 변화 대응 (클라우드/서버리스)</strong><br>컨테이너나 서버리스 환경에서는 휘발성 메모리로 인해 조건 동기화 상태가 보존되지 않는다. 외부 저장소 기반 상태 관리, 이벤트 중심 동기화 전략을 도입해야 한다.</p></li><li><p><strong>신뢰성 및 디버깅 문제</strong><br>동기화 오류는 대부분 비결정적이고 재현이 어렵다. 결정론적 테스트와 Race Condition 탐지 도구의 활용, 로그 기반 상태 추적이 필수적이다.</p></li></ol><h5 id=트러블슈팅-시나리오>트러블슈팅 시나리오<a hidden class=anchor aria-hidden=true href=#트러블슈팅-시나리오>#</a></h5><table><thead><tr><th>시나리오</th><th>증상</th><th>원인</th><th>분석 절차</th><th>해결책</th></tr></thead><tbody><tr><td><strong>Spurious Wakeup</strong></td><td>버퍼가 비어 있는데도 소비자 스레드가 <code>wait()</code> 에서 깨어나 작업 시도 → IndexError/NullPointerException</td><td>OS·런타임의 비의도적 스레드 깨움</td><td>① 조건 검사 방식 (if/while) 확인<br>② 락 내부 조건 검사 여부 점검<br>③ 플랫폼 문서에서 Spurious Wakeup 가능성 확인</td><td><code>while (!condition) wait()</code> 패턴 적용<br>조건 플래그를 락으로 보호</td></tr><tr><td><strong>Lost Wakeup</strong></td><td><code>notify()</code> 호출 후 소비자가 <code>wait()</code> 에 진입하지 못해 무한 대기</td><td><code>notify()</code> 호출 시 대기 큐에 스레드 미등록 상태</td><td>① <code>wait()</code>-<code>notify()</code> 호출 시점 로그 확인<br>② 락 보유 여부 확인<br>③ 상태 플래그와 신호 순서 점검</td><td>상태 플래그 변경 후 <code>notify()</code> 호출<br><code>wait()</code> 전 락 획득 및 조건 검사</td></tr><tr><td><strong>Thundering Herd</strong></td><td><code>broadcast()</code> 후 다수 스레드가 동시에 깨어나 CPU 경합 심화</td><td>불필요하게 많은 스레드 깨움으로 락 경합</td><td>① <code>broadcast()</code> 호출 빈도 확인<br>② 실제 작업 수행 스레드 비율 분석<br>③ 락 경합 및 Context Switch 모니터링</td><td><code>signal()</code> 로 필요한 스레드만 깨우기<br>조건 변수 세분화</td></tr><tr><td><strong>우선순위 역전</strong></td><td>실시간 스레드가 낮은 우선순위 스레드의 락 대기 → 데드라인 미스</td><td>낮은 우선순위 스레드 실행 지연</td><td>① 대기 스레드·보유 스레드 우선순위 비교<br>② OS 스케줄러 우선순위 상속 여부 확인<br>③ 공유 자원 접근 경로 분석</td><td>Priority Inheritance 활성화<br>실시간 스레드의 공유 자원 접근 최소화</td></tr><tr><td><strong>컨테이너 재시작 후 상태 유실</strong></td><td>컨테이너 재시작 시 대기·락 상태 초기화로 불일치 발생</td><td>메모리 내 동기화 객체의 휘발성</td><td>① 상태 저장 위치 확인<br>② 재시작 이벤트 로그 확인<br>③ 분산 노드 여부 점검</td><td>외부 분산 락 매니저 사용<br>상태 복구 로직 추가</td></tr><tr><td><strong>Deadlock</strong></td><td>모든 스레드가 대기 상태 → CPU 사용률 0% 고정</td><td>순환 대기에 의한 교착 상태</td><td>① 락 획득 순서 로그 분석<br>② 락 경합 시각화 도구 활용<br>③ 중첩 임계 구역 식별</td><td>전역 락 순서 규칙 수립<br>타임아웃 기반 락 사용</td></tr></tbody></table><ul><li><strong>Spurious Wakeup/Lost Wakeup</strong> → 조건 재검사와 상태 플래그 설계가 핵심</li><li><strong>Thundering Herd</strong> → 신호 최소화, 조건 세분화</li><li><strong>우선순위 역전</strong> → OS 레벨 우선순위 정책 적용</li><li><strong>컨테이너 상태 유실</strong> → 외부 분산 동기화 서비스 활용</li><li><strong>Deadlock</strong> → 락 순서 일관성 + 타임아웃</li></ul><h4 id=생태계-및-관련-기술>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술>#</a></h4><table><thead><tr><th>카테고리</th><th>기술/표준</th><th>정의</th><th>사용 목적</th><th>특징/연계</th></tr></thead><tbody><tr><td><strong>동기화 기본 기술</strong></td><td>Semaphore, Monitor, Event, ReentrantLock+Condition</td><td>자원 접근 제어·조건 대기 구현을 위한 기본 동기화 도구</td><td>스레드·프로세스 간 안정적 자원 공유</td><td>낮은 수준부터 언어 내장 고수준 API 까지 다양</td></tr><tr><td><strong>비동기·메시징 시스템</strong></td><td>Apache Kafka, RabbitMQ, Redis Streams, Apache Flink</td><td>데이터·이벤트 비동기 전달·처리</td><td>분산 환경에서 조건 발생 전파</td><td>백프레셔·스트리밍 처리 지원</td></tr><tr><td><strong>분산 시스템·락 서비스</strong></td><td>etcd, Consul, ZooKeeper, Redis RedLock, Kubernetes Lease</td><td>네트워크 분산 환경에서 일관성 있는 락·상태 관리</td><td>리더 선출, 분산 동기화</td><td>CAP 트레이드오프 고려 필요</td></tr><tr><td><strong>실시간·임베디드 OS</strong></td><td>FreeRTOS, QNX</td><td>하드웨어 근접 실시간 동기화 지원</td><td>마이크로컨트롤러·산업 제어</td><td>제한된 리소스 환경 최적화</td></tr><tr><td><strong>표준 및 프로토콜</strong></td><td>POSIX Threads, C++ Memory Model, Java Memory Model, Raft, MQTT, CoAP</td><td>플랫폼·언어 간 호환성 보장</td><td>메모리 일관성, 네트워크 동기화</td><td>산업·IoT·분산 시스템에 적용</td></tr><tr><td><strong>언어별 고수준 API</strong></td><td>Python <code>Condition</code>, Go <code>sync.Cond</code>, Rust <code>Condvar</code></td><td>조건 동기화를 위한 언어 런타임 제공 API</td><td>생산성 향상·안전성 강화</td><td>언어별 메모리 모델과 결합</td></tr></tbody></table><p>조건 동기화는 단일 기술이 아니라 <strong>기본 동기화 메커니즘 → 메시징/데이터 흐름 → 분산 락/상태 관리 → 실시간 OS → 표준/프로토콜 → 언어별 고수준 API</strong>로 이어지는 생태계 속에서 작동한다.<br>실무에서는 특정 환경 (예: 클라우드 네이티브, IoT, 실시간 제어) 에 맞춰 적절한 계층의 기술을 선택·조합하는 것이 핵심이며, 표준 준수와 플랫폼 특성을 고려한 설계가 필수적이다.</p><hr><h2 id=최종-정리-및-학습-가이드>최종 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#최종-정리-및-학습-가이드>#</a></h2><h3 id=내용-종합>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합>#</a></h3><p><strong>Condition Synchronization(조건 동기화)</strong> 는 공유 자원을 다루는 다중 스레드 환경에서, 스레드가 특정 조건이 충족될 때까지 효율적으로 대기하고 조건 변경 시 알림을 통해 실행을 재개하는 동기화 기법이다.<br>이는 단순한 상호 배제를 넘어, 스레드 간 <strong>협력적 실행</strong>을 지원하고 <strong>상태 기반 제어</strong>를 구현하는 핵심 기술이다.</p><p><strong>핵심 가치</strong></p><ol><li><strong>효율성</strong>–폴링 대신 이벤트 기반 대기로 CPU 자원 절약</li><li><strong>정확성</strong>–원자적 조건 검사와 대기로 경쟁 상태 방지</li><li><strong>확장성</strong>–스레드 수 증가에도 안정적 성능 유지</li><li><strong>유연성</strong>–다양한 동시성 패턴 (생산자 - 소비자, 리더 - 라이터 등) 에 적용 가능</li></ol><p><strong>최신 동향 (2025)</strong></p><ul><li><strong>언어·플랫폼 통합 비동기화</strong>: <code>async/await</code>, <code>asyncio.Condition</code>, Swift Concurrency</li><li><strong>고성능 동기화</strong>: Lock-free·NUMA-aware condition variable</li><li><strong>분산·클라우드 환경 적용</strong>: Kubernetes, 서버리스 (Temporal.io, AWS Step Functions)</li><li><strong>엣지·IoT 최적화</strong>: 전력 인식 동기화, 제한 자원 환경 설계</li><li><strong>지능형 운영</strong>: 관측성·Self-Healing·AI Orchestration 기반 정책 최적화</li></ul><p><strong>활용 예시</strong></p><ul><li>생산자 - 소비자 패턴, 작업 큐, 실시간 이벤트 처리, 분산 합의 (Consensus) 에서의 상태 대기</li></ul><table><thead><tr><th>구분</th><th>내용</th></tr></thead><tbody><tr><td><strong>정의</strong></td><td>공유 자원 접근에서 특정 조건이 만족될 때까지 스레드를 효율적으로 대기시키고, 조건 변화 시 실행을 재개하는 동기화 기법</td></tr><tr><td><strong>핵심 가치</strong></td><td>효율성 (CPU 절약), 정확성 (경쟁 상태 방지), 확장성 (성능 유지), 유연성 (다양한 패턴 적용)</td></tr><tr><td><strong>최신 동향 (2025)</strong></td><td>① 언어·플랫폼 통합 비동기화<br>② Lock-free·NUMA-aware 최적화<br>③ 분산·클라우드 적용<br>④ 엣지·IoT 최적화<br>⑤ 지능형 운영</td></tr><tr><td><strong>활용 예시</strong></td><td>생산자 - 소비자, 작업 큐, 실시간 이벤트 처리, 분산 합의 알고리즘</td></tr><tr><td><strong>대표 구현</strong></td><td>Python <code>threading.Condition</code>, Java <code>Condition</code>, POSIX <code>pthread_cond_t</code></td></tr></tbody></table><p>조건 동기화는 멀티스레드·멀티코어 환경의 핵심 제어 메커니즘으로, 효율적·정확한 상태 기반 실행을 보장한다.<br>2025 년 현재, 전통적인 OS·언어 레벨 구현을 넘어 클라우드·엣지·AI 기반 환경으로 확장되며, 성능 최적화와 회복성 강화, 에너지 효율성을 동시에 추구하는 방향으로 진화하고 있다.</p><h3 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h3><table><thead><tr><th>단계</th><th>목표</th><th>학습 주제 예시</th><th>기간 (권장)</th><th>수준</th></tr></thead><tbody><tr><td>1 단계</td><td>조건 동기화 개념 및 기초 이론 이해</td><td>스레드, 경쟁 상태, 조건 변수, 뮤텍스, 임계 구역</td><td>1~2 주</td><td>초급</td></tr><tr><td>2 단계</td><td>핵심 동기화 메커니즘 익히기</td><td>Wait/Notify, 생산자 - 소비자, 세마포어, 모니터 패턴 등</td><td>2~3 주</td><td>초~중급</td></tr><tr><td>3 단계</td><td>실습 중심 구현 및 코드 내재화</td><td>Python/Java/POSIX 기반 조건 변수 활용, Reader-Writer 구현 등</td><td>3~4 주</td><td>중급</td></tr><tr><td>4 단계</td><td>운영 환경에서의 적용과 최적화</td><td>데드락 탐지, 모니터링 도구, 병목 지점 분석, 로그 기반 진단</td><td>2~3 주</td><td>중~고급</td></tr><tr><td>5 단계</td><td>고급 동기화 기술과 분산 환경 확장</td><td>Lock-Free, 분산 조건 변수, 트랜잭션 메모리, 하드웨어 동기화 등</td><td>4 주 이상, 지속</td><td>고급 이상</td></tr><tr><td>6 단계</td><td>전문가로서 실무·이론 융합 및 확장</td><td>커널 동기화 구조 분석, 오픈소스 기여, 학술논문 정리, 시스템 설계</td><td>지속적 학습</td><td>전문가</td></tr></tbody></table><h3 id=학습-항목-매트릭스>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스>#</a></h3><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>조건 변수와 모니터 개념</td><td>필수</td><td>Wait/Notify, 상태 기반 제어의 기본</td></tr><tr><td>기초</td><td>1</td><td>동시성, 경쟁 상태, 임계 구역</td><td>필수</td><td>조건 동기화가 필요한 근본 원리</td></tr><tr><td>이론</td><td>2</td><td>뮤텍스, 세마포어, 모니터 시맨틱스</td><td>필수</td><td>조건 동기화의 기반이 되는 동기화 메커니즘</td></tr><tr><td>이론</td><td>2</td><td>Mesa vs Hoare 시맨틱스</td><td>권장</td><td>조건 알림의 처리 방식 차이 이해</td></tr><tr><td>이론</td><td>2</td><td>메모리 모델과 가시성 보장</td><td>필수</td><td>조건 동기화에서의 순서성과 메모리 동기화</td></tr><tr><td>구현</td><td>5</td><td>Producer-Consumer 패턴</td><td>필수</td><td>가장 보편적인 조건 동기화 예제</td></tr><tr><td>구현</td><td>5</td><td>Reader-Writer, 스레드 풀 등</td><td>권장</td><td>병렬 작업 최적화 활용</td></tr><tr><td>운영</td><td>6</td><td>성능 모니터링 및 디버깅</td><td>필수</td><td>Spurious wakeup, 데드락 탐지, 관측성</td></tr><tr><td>고급</td><td>7</td><td>Lock-Free / Wait-Free 기법</td><td>선택</td><td>고성능 병렬 처리를 위한 기법</td></tr><tr><td>고급</td><td>7</td><td>분산 조건 동기화 및 클라우드 적용</td><td>선택</td><td>ZooKeeper, Raft 등 활용 사례</td></tr><tr><td>확장</td><td>8</td><td>트랜잭셔널 메모리, 액터 모델</td><td>선택</td><td>전통적 조건 동기화 외 대안적 접근</td></tr><tr><td>확장</td><td>8</td><td>실시간/보안/양자/RTOS 동기화</td><td>선택</td><td>특수 환경에서의 조건 동기화 이슈</td></tr></tbody></table><p>이 매트릭스는 조건 동기화에 대한 체계적인 학습 로드맵을 제공한다. 기초 개념부터 시작해 동기화 메커니즘, 메모리 모델, 구현 패턴, 운영 및 디버깅까지 전반적인 이론과 실무를 아우른다. 또한, Lock-Free, 분산 시스템, 트랜잭셔널 메모리 등 고급 주제를 통해 병렬 처리 환경의 최신 트렌드까지 확장할 수 있다. 이 구조는 단계별 학습뿐 아니라 실무 적용에도 효율적으로 활용될 수 있다.</p><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th></tr></thead><tbody><tr><td><strong>핵심 개념</strong></td><td>Condition Variable</td><td>조건이 만족될 때까지 스레드 대기, 만족되면 신호로 재개</td><td>Monitor, wait, notify</td></tr><tr><td></td><td>Mutex</td><td>공유 자원에 대해 하나의 스레드만 접근하도록 보장하는 락</td><td>Atomicity, Critical Section</td></tr><tr><td></td><td>Monitor</td><td>뮤텍스와 조건 변수의 결합을 추상화한 고급 동기화 구조</td><td>Java synchronized, 캡슐화</td></tr><tr><td><strong>구현 메커니즘</strong></td><td>Wait Queue</td><td>조건 변수 내부에서 대기하는 스레드들을 관리하는 큐</td><td>FIFO, 우선순위 큐</td></tr><tr><td></td><td>Notification Mechanism</td><td>조건 만족 시 스레드를 깨우는 방식: <code>notify</code>, <code>notify_all</code>, <code>signal</code>, <code>broadcast</code></td><td>Signal, Broadcast</td></tr><tr><td></td><td>Atomic Operation</td><td>중단 불가능한 단일 연산으로, 상태 전이를 일관되게 보장</td><td>CAS, Test-and-Set</td></tr><tr><td></td><td>Context Switching</td><td>CPU 가 한 스레드에서 다른 스레드로 제어권을 전환하는 과정</td><td>OS 스케줄링, 오버헤드</td></tr><tr><td><strong>운영 및 문제 상황</strong></td><td>Race Condition</td><td>두 개 이상의 스레드가 동시에 자원에 접근하며 실행 순서에 따라 결과가 달라지는 상태</td><td>동시성 버그, 타이밍 이슈</td></tr><tr><td></td><td>Deadlock</td><td>두 스레드 이상이 서로의 락을 기다리며 무한 대기하는 상태</td><td>순환 대기, 교착</td></tr><tr><td></td><td>Starvation</td><td>특정 스레드가 자원을 계속 할당받지 못해 실행되지 못하는 상태</td><td>우선순위 역전, 공정성</td></tr><tr><td></td><td>Lock Contention</td><td>여러 스레드가 동시에 같은 락을 요구하면서 충돌이 발생하는 상태</td><td>병목, 성능 저하</td></tr><tr><td></td><td>Spurious Wakeup</td><td>조건이 만족되지 않았는데도 스레드가 깨어나는 현상</td><td>while 조건 재확인 필요</td></tr><tr><td><strong>고급 개념/기법</strong></td><td>Lock-free / Wait-free</td><td>락 없이 동기화를 구현하는 고성능 구조, 스레드 블로킹 없음</td><td>CAS, 원자 연산, 고성능 큐</td></tr><tr><td></td><td>Thundering Herd Problem</td><td>broadcast 시 많은 스레드가 깨어나면서 자원 병목을 유발하는 현상</td><td>Signal vs Broadcast</td></tr><tr><td></td><td>Observability</td><td>동기화 상태나 이벤트 흐름을 관측하고 로깅하는 기능</td><td>eBPF, APM, 트러블슈팅</td></tr><tr><td><strong>시맨틱스/행동 모델</strong></td><td>Mesa Semantics</td><td>통지 후 스레드가 즉시 실행되지 않고 다시 락 획득을 기다리는 구현 방식</td><td>Java, Python 조건 변수</td></tr><tr><td></td><td>Hoare Semantics</td><td>통지된 스레드가 즉시 실행되도록 락을 양보하는 시맨틱스</td><td>이론적 모델, 실시간 시스템</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://pages.cs.wisc.edu/~remzi/OSTEP/threads-cv.pdf>Operating Systems: Three Easy Pieces – Condition Variables</a></li><li><a href=https://pages.cs.wisc.edu/~remzi/OSTEP/>Operating Systems: Three Easy Pieces (전체 개요)</a></li><li><a href=https://learn.microsoft.com/en-us/windows/win32/sync/condition-variables>Condition Variables in Win32 apps – Microsoft Learn</a></li><li><a href="https://www.ibm.com/docs/zh/aix/7.1?topic=programming-using-condition-variables">Using Condition Variables in AIX – IBM Documentation</a></li><li><a href=https://docs.oracle.com/javase/tutorial/essential/concurrency/guardmeth.html>Guarded Blocks / Monitor 메커니즘 – Oracle Java Tutorial</a></li><li><a href=https://man7.org/linux/man-pages/man3/pthread_cond_wait.3.html>pthread_cond_wait (POSIX) – Linux man pages</a></li><li><a href=https://www.geeksforgeeks.org/condition-variables-in-operating-system/>Condition Variables in Operating Systems – GeeksForGeeks</a></li><li><a href=https://en.wikipedia.org/wiki/Monitor_%28synchronization%29>Monitor (synchronization) – Wikipedia (모니터 개념 설명)</a></li><li><a href=https://ieeexplore.ieee.org/Xplore/home.jsp>Synchronization Trends in Multi-core Systems – IEEE Xplore (학술 자료)</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>