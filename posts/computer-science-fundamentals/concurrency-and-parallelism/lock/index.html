<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Lock | hyunyoun's Blog</title><meta name=keywords content="Computer-Science-Fundamentals,Concurrency-and-Parallelism,Lock,Concurrency-Control,Synchronization-Primitives"><meta name=description content="Lock은 멀티스레드 환경에서 공유 자원에 대한 동시 접근을 제어하여 상호 배제(Mutual Exclusion)를 보장하는 동기화 수단이다. 임계 구역 보호를 통해 원자성을 제공하며, 경쟁 조건(Race Condition)을 방지한다. Spin Lock, Mutex, Reentrant Lock 등 다양한 유형이 존재하며, 선택에 따라 성능과 안정성에 영향을 미친다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/lock/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/lock/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/lock/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/lock/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Lock"><meta property="og:description" content="Lock은 멀티스레드 환경에서 공유 자원에 대한 동시 접근을 제어하여 상호 배제(Mutual Exclusion)를 보장하는 동기화 수단이다. 임계 구역 보호를 통해 원자성을 제공하며, 경쟁 조건(Race Condition)을 방지한다. Spin Lock, Mutex, Reentrant Lock 등 다양한 유형이 존재하며, 선택에 따라 성능과 안정성에 영향을 미친다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Lock"><meta name=twitter:description content="Lock은 멀티스레드 환경에서 공유 자원에 대한 동시 접근을 제어하여 상호 배제(Mutual Exclusion)를 보장하는 동기화 수단이다. 임계 구역 보호를 통해 원자성을 제공하며, 경쟁 조건(Race Condition)을 방지한다. Spin Lock, Mutex, Reentrant Lock 등 다양한 유형이 존재하며, 선택에 따라 성능과 안정성에 영향을 미친다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Computer Science and Engineering","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Computer Science Fundamentals Overview","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/"},{"@type":"ListItem","position":3,"name":"Concurrency and Parallelism","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/"},{"@type":"ListItem","position":4,"name":"Lock","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/lock/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>Computer Science and Engineering</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/>Computer Science Fundamentals Overview</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/>Concurrency and Parallelism</a></div><h1>Lock</h1><div class=post-description>Lock은 멀티스레드 환경에서 공유 자원에 대한 동시 접근을 제어하여 상호 배제(Mutual Exclusion)를 보장하는 동기화 수단이다. 임계 구역 보호를 통해 원자성을 제공하며, 경쟁 조건(Race Condition)을 방지한다. Spin Lock, Mutex, Reentrant Lock 등 다양한 유형이 존재하며, 선택에 따라 성능과 안정성에 영향을 미친다.</div></header><div class=post-content><h2 id=lock>Lock<a hidden class=anchor aria-hidden=true href=#lock>#</a></h2><p>Lock 은 동시성 환경에서 공유 자원의 일관성과 무결성을 보장하기 위한 상호 배제 (Mutual Exclusion) 동기화 기법이다.<br>하드웨어의 원자적 명령 (CAS, TAS) 기반에서 소프트웨어 추상화 수준 (Mutex, ReentrantLock 등) 까지 다양한 구현이 존재한다. Mutex, Spinlock, Reader-Writer Lock 외에도 Ticket Lock, MCS Lock, Backoff 기반 알고리즘이 활용되며, 운영체제, 데이터베이스, 분산 시스템 등에서 핵심 동기화 수단으로 사용된다. 적절한 적용은 성능 최적화와 안정성을 보장하지만, 데드락, 라이블락, Starvation 등의 문제를 유발할 수 있다.</p><h3 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h3><p>락 (Lock) 은 <strong>멀티태스킹 환경에서 공유 자원에 대한 동시 접근으로 인한 충돌</strong>을 방지하기 위해 도입된 핵심 동기화 기법이다.<br>초기에는 단일 프로세서 시스템에서 인터럽트를 비활성화하여 원자성을 보장했지만, <strong>멀티프로세서 환경</strong>에서는 하드웨어 수준의 원자 명령어 (Test-and-Set, Compare-and-Swap 등) 를 활용한 락이 필요해졌다.</p><h4 id=발전-과정>발전 과정<a hidden class=anchor aria-hidden=true href=#발전-과정>#</a></h4><pre class=mermaid>timeline
    title 락 기술의 등장 및 발전 흐름

    1965 : Edsger Dijkstra, 세마포어 개념 (P/V 연산) 제시
         : THE 운영체제에서 세마포어 도입

    1970s : 모니터(Monitor) 개념 등장 (Hoare, Hansen)
           : 구조적 동기화 방식의 시초

    1980s : 스핀락, Test-and-Set 활용
           : 간단한 커널 락 구현

    1990s : Compare-and-Swap 기반 무잠금 알고리즘 도입
           : 효율적인 사용자 수준 동기화 시작

    2000s : 적응형 락 (Adaptive Lock), 재진입 락 (Reentrant Lock)
           : 자원 상황에 따라 락 전략 자동 전환

    2010s : Lock-Free, Wait-Free 알고리즘 성숙
           : 멀티코어 환경에 최적화된 구조로 발전
</pre><ul><li>모니터, 세마포어, CAS 등은 락 개념의 확장/고도화에 기여한 기반 기술.</li><li>현대 락 구현은 <strong>성능, 일관성, 확장성</strong>을 고려하여 다양화됨 (예: Java ReentrantLock, Redis 분산 락 등).</li><li>클라우드 기반 시스템에서는 <strong>분산 락 (예: Redlock, ZK-based lock)</strong> 이 필수 기술로 발전.</li></ul><h4 id=실무-적용-흐름락-유형별-적용-사례>실무 적용 흐름–락 유형별 적용 사례<a hidden class=anchor aria-hidden=true href=#실무-적용-흐름락-유형별-적용-사례>#</a></h4><pre class=mermaid>flowchart TD
    A[&#34;실행 단위 (Thread/Process)&#34;] --&gt; B{공유 자원 접근 필요}
    
    B --&gt; C1[단일 서버 환경]
    B --&gt; C2[분산 환경]

    %% 단일 서버 환경
    C1 --&gt; D1[언어/OS 수준 락 사용]
    D1 --&gt; E1[Mutex/Spinlock]
    E1 --&gt; F1{락 구현 선택}
    F1 --&gt; G1[Mutex: Blocking 방식, 효율적]
    F1 --&gt; G2[Spinlock: 짧은 임계구역, 커널 락에 적합]
    F1 --&gt; G3[RWLock: 읽기 많은 경우에 최적화]

    %% 분산 환경
    C2 --&gt; D2[외부 락 서비스 연동]
    D2 --&gt; E2[Redis/ZooKeeper/etcd 기반 분산 락]
    E2 --&gt; F2{합의 방식 선택}
    F2 --&gt; G4[Redis Redlock: 빠르지만 시간 동기화 주의]
    F2 --&gt; G5[ZK-based Lock: 안정성 ↑, 느림]
    F2 --&gt; G6[etcd 기반 Lock: Kubernetes 환경 연계에 최적화]

    %% 결과 공통 처리
    G1 &amp; G2 &amp; G3 &amp; G4 &amp; G5 &amp; G6 --&gt; H[임계 구역 진입]
    H --&gt; I[작업 처리 후 Lock 해제]
    I --&gt; J[다음 실행 단위 처리]
</pre><table><thead><tr><th>환경</th><th>적용 락</th><th>특징</th></tr></thead><tbody><tr><td><strong>단일 스레드 애플리케이션</strong></td><td>없음 or Global Interpreter Lock(GIL)</td><td>파이썬 등 일부 언어에서만 적용</td></tr><tr><td><strong>멀티스레드 서버 (Java, C++)</strong></td><td><code>synchronized</code>, <code>ReentrantLock</code>, <code>pthread_mutex</code></td><td>언어 런타임/OS 커널 지원</td></tr><tr><td><strong>멀티프로세스 서버</strong></td><td>세마포어, 파일 락, shared memory + 락</td><td>POSIX 기반, 성능 병목 유의</td></tr><tr><td><strong>분산 마이크로서비스</strong></td><td>Redis Redlock, Zookeeper Lock, etcd Lock</td><td>장애 복구 및 TTL, 리더 선출 등 고려</td></tr></tbody></table><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><h4 id=목적>목적<a hidden class=anchor aria-hidden=true href=#목적>#</a></h4><ol><li><p><strong>데이터 무결성과 일관성 보장</strong></p><ul><li>Race Condition 발생을 방지하고 공유 자원의 일관된 상태 유지</li></ul></li><li><p><strong>시스템 안정성과 예측 가능성 확보</strong></p><ul><li>오류 발생 가능성을 줄이고, 디버깅 가능한 코드 구조 유지</li></ul></li><li><p><strong>자원 활용 효율화</strong></p><ul><li>공유 자원의 동시 접근 제어를 통해 병렬 시스템의 리소스 낭비 방지</li></ul></li><li><p><strong>복잡도 감소 및 프로그램 논리 단순화</strong></p><ul><li>동기화 이슈를 추상화함으로써 구조적이고 유지보수 가능한 코드 제공</li></ul></li></ol><h4 id=필요성>필요성<a hidden class=anchor aria-hidden=true href=#필요성>#</a></h4><table><thead><tr><th>구분</th><th>설명</th></tr></thead><tbody><tr><td><strong>기술적 필요성</strong></td><td>멀티코어 시스템에서 병렬 처리를 위한 동기화 메커니즘 필수. 락은 그 중 핵심 기법</td></tr><tr><td><strong>설계적 필요성</strong></td><td>공유 메모리 기반 설계 시 동시성 제어 없이는 시스템 무결성 유지 불가</td></tr><tr><td><strong>운영적 필요성</strong></td><td>장애 진단, 성능 분석, 예측 가능한 운영을 위해 안정성 확보 필요</td></tr><tr><td><strong>비즈니스 필요성</strong></td><td>고성능 처리, SLA 만족, 서비스 품질 보장 등에서 락 기반 동기화는 핵심 전략 중 하나</td></tr></tbody></table><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><table><thead><tr><th>개념</th><th>설명</th></tr></thead><tbody><tr><td><strong>상호 배제 (Mutual Exclusion)</strong></td><td>하나의 실행 단위만 자원에 접근하도록 보장</td></tr><tr><td><strong>임계 구역 (Critical Section)</strong></td><td>공유 자원 접근 코드로 보호가 필요한 영역</td></tr><tr><td><strong>원자성 (Atomicity)</strong></td><td>락의 획득/해제는 더 이상 분해 불가능한 단위 연산</td></tr><tr><td><strong>락 획득/해제</strong></td><td>자원 접근 전 락 획득, 종료 후 반드시 해제</td></tr><tr><td><strong>데드락</strong></td><td>교착 상태 발생: 락 간 순환 대기로 시스템 정지</td></tr><tr><td><strong>기아 상태</strong></td><td>락 획득 우선순위에 따라 특정 스레드가 계속 대기하는 현상</td></tr><tr><td><strong>Spinlock vs Blocking</strong></td><td>대기 방식에 따른 분류: CPU 지속 점유 vs sleep</td></tr></tbody></table><h4 id=상호-배제-mutual-exclusion>상호 배제 (Mutual Exclusion)<a hidden class=anchor aria-hidden=true href=#상호-배제-mutual-exclusion>#</a></h4><pre class=mermaid>flowchart TD
    A[Thread A] --&gt;|Lock 요청| L[Lock]
    B[Thread B] --&gt;|Lock 요청| L
    L --&gt;|Lock 획득 허용| A1[Thread A 임계 구역 진입]
    B -. 대기 중 .-&gt; B1[Thread B 대기]
    A1 --&gt;|Lock 해제| L
    L --&gt;|Lock 허용| B2[Thread B 임계 구역 진입]
</pre><h4 id=임계-구역-critical-section>임계 구역 (Critical Section)<a hidden class=anchor aria-hidden=true href=#임계-구역-critical-section>#</a></h4><pre class=mermaid>graph TD
    T1[Thread] --&gt; C{임계 구역 진입 전}
    C --&gt;|Lock 있음| C1[Lock 획득]
    C1 --&gt; CS[Critical Section]
    CS --&gt; C2[Lock 해제]
    C2 --&gt; E[작업 종료]
</pre><h4 id=원자성-atomicity>원자성 (Atomicity)<a hidden class=anchor aria-hidden=true href=#원자성-atomicity>#</a></h4><pre class=mermaid>sequenceDiagram
    participant CPU as CPU
    participant Memory as Shared Memory

    CPU-&gt;&gt;Memory: CAS(address, expected, new)
    alt 일치함
        Memory--&gt;&gt;CPU: 성공 (원자적 갱신)
    else 일치하지 않음
        Memory--&gt;&gt;CPU: 실패 (다시 시도)
    end
</pre><h4 id=락-획득과-해제-acquirerelease>락 획득과 해제 (Acquire/Release)<a hidden class=anchor aria-hidden=true href=#락-획득과-해제-acquirerelease>#</a></h4><pre class=mermaid>flowchart TD
    Start --&gt; CheckLock{Lock 상태 확인}
    CheckLock -- &#34;Unlocked&#34; --&gt; Acquire[Lock 획득]
    Acquire --&gt; CS[임계 구역 실행]
    CS --&gt; Release[Lock 해제]
    Release --&gt; End
    CheckLock -- &#34;Locked&#34; --&gt; Wait[대기 또는 재시도]
    Wait --&gt; CheckLock
</pre><h4 id=데드락-deadlock>데드락 (Deadlock)<a hidden class=anchor aria-hidden=true href=#데드락-deadlock>#</a></h4><pre class=mermaid>flowchart LR
    T1[Thread 1] --&gt;|요청| R2[Resource 2]
    R2 --&gt;|점유| T2[Thread 2]
    T2 --&gt;|요청| R1[Resource 1]
    R1 --&gt;|점유| T1
    style T1 fill:#fdd,stroke:#f00,stroke-width:2px
    style T2 fill:#fdd,stroke:#f00,stroke-width:2px
</pre><blockquote><p>순환 대기 상태 → 데드락 발생</p></blockquote><h4 id=기아-상태-starvation>기아 상태 (Starvation)<a hidden class=anchor aria-hidden=true href=#기아-상태-starvation>#</a></h4><pre class=mermaid>sequenceDiagram
    participant L as Lock
    participant T1 as Thread 1 (우선순위 높음)
    participant T2 as Thread 2 (우선순위 낮음)

    T1-&gt;&gt;L: Lock 요청
    L--&gt;&gt;T1: Lock 허용
    T2-&gt;&gt;L: Lock 요청 (대기)
    T1-&gt;&gt;L: 재요청 (우선순위 때문에 계속 선점)
    Note over T2: Thread 2는 계속 대기 → Starvation
</pre><h4 id=spinlock-vs-blocking-lock>Spinlock Vs Blocking Lock<a hidden class=anchor aria-hidden=true href=#spinlock-vs-blocking-lock>#</a></h4><pre class=mermaid>flowchart TD
    Try[Lock 시도] --&gt; IsLocked{Lock 상태 확인}
    IsLocked -- No --&gt; Proceed[임계 구역 진입]
    IsLocked -- Yes --&gt; TypeCheck{Spin?}
    TypeCheck -- Spinlock --&gt; Spin[&#34;계속 확인 (Busy Wait)&#34;]
    Spin --&gt; IsLocked
    TypeCheck -- Blocking Lock --&gt; Sleep[OS에 의해 블로킹됨]
    Sleep --&gt; Wake[Lock 해제 후 깨어남]
    Wake --&gt; IsLocked
</pre><h4 id=실무-구현-연관성-요약>실무 구현 연관성 요약<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성-요약>#</a></h4><table><thead><tr><th>관점</th><th>설명</th></tr></thead><tbody><tr><td><strong>성능 최적화</strong></td><td>락 경합을 줄이기 위해 Fine-Grained Locking, Lock Coarsening 적용</td></tr><tr><td><strong>메모리 일관성</strong></td><td>락은 CPU 간 캐시 일관성과 Memory Barrier 를 보장</td></tr><tr><td><strong>하드웨어 지원</strong></td><td>Compare-And-Swap(CAS), Test-And-Set 등의 원자 연산으로 구현됨</td></tr><tr><td><strong>언어/플랫폼 예시</strong></td><td>Java: <code>ReentrantLock</code>, C++: <code>std::mutex</code>, Go: <code>sync.Mutex</code>, Python: <code>threading.Lock</code></td></tr><tr><td><strong>운영 안정성 확보</strong></td><td>RAII 패턴, 예외 시 자원 자동 해제를 통한 안정성 확보</td></tr><tr><td><strong>분산 환경 연계</strong></td><td>Zookeeper, Redis, etcd 등 기반의 Distributed Lock 사용</td></tr><tr><td><strong>Lock-Free 대안 고려</strong></td><td>성능 요구에 따라 CAS 기반의 Lock-Free 구조도 활용됨</td></tr></tbody></table><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><h4 id=기능>기능<a hidden class=anchor aria-hidden=true href=#기능>#</a></h4><table><thead><tr><th>기능 구분</th><th>기능 항목</th><th>설명</th></tr></thead><tbody><tr><td>기본 기능</td><td>Lock 획득 (Acquire)</td><td>자원에 대한 진입 권한 확보</td></tr><tr><td></td><td>Lock 해제 (Release)</td><td>자원에 대한 점유권 해제</td></tr><tr><td></td><td>상호 배제 보장</td><td>임계 구역의 단일 접근 보장</td></tr><tr><td></td><td>대기 관리</td><td>점유 중일 때 다른 스레드 대기</td></tr><tr><td>고급 기능</td><td>공정성 (Fairness) 관리</td><td>FIFO 또는 우선순위 기반 순서 제어</td></tr><tr><td></td><td>타임아웃</td><td>일정 시간 대기 후 실패 반환</td></tr><tr><td></td><td>재진입 지원</td><td>동일 스레드가 반복 획득 가능</td></tr><tr><td>확장 기능</td><td>Lock 이벤트 트리거</td><td>상태 변화에 대한 후속 로직 트리거</td></tr><tr><td></td><td>Lock 상태 추적</td><td>모니터링, 디버깅을 위한 실시간 상태 확인</td></tr><tr><td>전략적 기능</td><td>Lock Granularity</td><td>락의 범위를 조정하여 성능 최적화</td></tr></tbody></table><h4 id=역할>역할<a hidden class=anchor aria-hidden=true href=#역할>#</a></h4><table><thead><tr><th>역할 구분</th><th>역할 항목</th><th>설명</th></tr></thead><tbody><tr><td>핵심 역할</td><td>자원 정합성 보호</td><td>공유 자원의 일관성과 무결성 유지</td></tr><tr><td>핵심 역할</td><td>동시성 오류 방지</td><td>Race Condition, Deadlock, Starvation 예방</td></tr><tr><td>핵심 역할</td><td>원자성 보장</td><td>중단 불가능한 연산을 통한 상태 안정성 확보</td></tr><tr><td>시스템 통합 역할</td><td>스레드 스케줄링 연계</td><td>OS 수준에서 락 상태 기반 스케줄링 제어</td></tr><tr><td>애플리케이션 역할</td><td>로직 일관성 유지</td><td>트랜잭션, 상태 머신 등 고수준 로직의 정합성 보장</td></tr><tr><td>운영 지원 역할</td><td>장애 추적 및 회복</td><td>모니터링, 알림, 재시도 등 운영 대응 연계 가능</td></tr></tbody></table><h4 id=기능---역할-매핑-기능이-역할을-실현함>기능 - 역할 매핑 (기능이 역할을 실현함)<a hidden class=anchor aria-hidden=true href=#기능---역할-매핑-기능이-역할을-실현함>#</a></h4><pre class=mermaid>graph TD
  %% 기능 정의
  F1[&#34;Lock 획득 (Acquire)&#34;]
  F2[&#34;Lock 해제 (Release)&#34;]
  F3[상호 배제 보장]
  F4[&#34;공정성 보장 (FIFO, 우선순위)&#34;]
  F5[&#34;재진입 지원 (Reentrant)&#34;]
  F6[타임아웃 기능]
  F7[대기 상태 관리]
  F8[Lock 상태 추적]
  F9[Lock 이벤트 트리거]

  %% 역할 정의
  R1[자원 정합성 보호]
  R2[동시성 오류 방지]
  R3[원자성 보장]
  R4[시스템 스케줄링 연계]
  R5[애플리케이션 로직 정합성 유지]
  R6[운영 및 모니터링 지원]

  %% 연결 관계
  F1 --&gt; R1
  F1 --&gt; R2
  F2 --&gt; R1
  F2 --&gt; R2
  F3 --&gt; R2
  F3 --&gt; R3
  F4 --&gt; R2
  F4 --&gt; R4
  F5 --&gt; R5
  F6 --&gt; R2
  F6 --&gt; R6
  F7 --&gt; R4
  F8 --&gt; R6
  F9 --&gt; R6
</pre><h4 id=lock-기능-흐름>Lock 기능 흐름<a hidden class=anchor aria-hidden=true href=#lock-기능-흐름>#</a></h4><pre class=mermaid>flowchart TD
    A[스레드 실행 요청] --&gt; B{Lock 상태 확인}
    B -- 미점유 상태 --&gt; C[&#34;Lock 획득 (Acquire)&#34;]
    C --&gt; D[&#34;임계 구역(Critical Section) 실행&#34;]
    D --&gt; E[&#34;Lock 해제 (Release)&#34;]
    E --&gt; F[작업 완료]

    B -- 이미 점유됨 --&gt; G{대기 방식 선택}
    G -- Spinlock --&gt; H[Busy Waiting 지속]
    G -- Blocking --&gt; I[스케줄러에 의해 Sleep]
    H --&gt; B
    I --&gt; Wake[Lock 해제 후 깨어남] --&gt; B

    %% 확장 흐름
    B --&gt;|Timeout| T1[타임아웃 발생 → Lock 실패 반환]
    C --&gt;|이벤트 Hook| T2[Lock 획득 이벤트 트리거]
    E --&gt;|상태 추적| T3[Lock 해제 기록 / 상태 업데이트]
</pre><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><p>Lock 은 동시성 제어의 핵심 수단으로, 다음과 같은 주요 특징을 가진다.</p><ol><li><strong>원자성</strong>: 락 획득과 해제는 반드시 원자적이어야 하며, 주로 하드웨어 CAS 등의 명령어를 기반으로 구현된다.</li><li><strong>배타성 및 소유권</strong>: 특정 시점에 하나의 스레드만 공유 자원에 접근 가능하며, 락을 소유한 스레드만이 해제할 수 있다.</li><li><strong>재진입성</strong>: 일부 락은 동일 스레드의 중첩 락 획득을 허용하며, 이를 위해 카운터 기반 관리가 필요하다.</li><li><strong>블로킹/스핀 특성</strong>: 스레드는 락 획득 실패 시 블로킹되거나 바쁘게 대기 (스핀) 할 수 있으며, 커널 스케줄링과 연계된다.</li><li><strong>공정성과 우선순위 상속</strong>은 실시간성 보장 또는 우선순위 역전 문제 해결을 위한 선택적 기능이다.</li></ol><table><thead><tr><th>카테고리</th><th>특징</th><th>설명</th><th>달성 메커니즘 / 적용 예시</th></tr></thead><tbody><tr><td><strong>기본 속성</strong></td><td>원자성 (Atomicity)</td><td>락 획득/해제는 중단 불가능한 단일 연산</td><td>CAS, Test-and-Set</td></tr><tr><td></td><td>배타성 (Exclusiveness)</td><td>한 시점에 하나의 스레드만 자원 접근</td><td>임계 구역 보호</td></tr><tr><td><strong>운영 메커니즘</strong></td><td>블로킹 특성</td><td>실패한 스레드는 대기 상태 전환</td><td>커널 스케줄링, condition 변수</td></tr><tr><td></td><td>스핀 특성 (Spin behavior)</td><td>락 대기 중 루프 반복하며 CPU 점유</td><td>Spinlock, busy-wait</td></tr><tr><td></td><td>소유권 (Ownership)</td><td>락 소유자만 해제 가능</td><td>Mutex, ReentrantLock</td></tr><tr><td></td><td>재진입성 (Reentrancy)</td><td>동일 스레드의 중첩 락 허용</td><td>ReentrantLock, recursive mutex</td></tr><tr><td><strong>고급 특성</strong></td><td>공정성 (Fairness)</td><td>락 획득 순서 보장</td><td>FIFO 대기 큐, Java fair lock</td></tr><tr><td></td><td>우선순위 상속</td><td>낮은 우선순위가 락 소유 시 역전 방지</td><td>Priority Inheritance in RTOS</td></tr><tr><td><strong>부작용 및 유연성</strong></td><td>부작용 발생 가능성</td><td>데드락, 기아, 병목</td><td>설계/모니터링 필요</td></tr><tr><td></td><td>유연성/확장성</td><td>구현 방식에 따라 다양한 종류</td><td>Mutex, Spinlock, Semaphore 등</td></tr></tbody></table><p>Lock 은 배타성, 원자성, 소유권이라는 핵심 속성을 기반으로 임계 구역을 보호하며, 커널 또는 사용자 수준에서 블로킹 또는 스핀 방식으로 구현된다.<br>재진입성, 공정성, 우선순위 상속 등의 고급 특성은 특정 요구사항 (성능, 실시간성, 예측 가능성) 에 따라 선택적으로 구현되며, 락의 설계와 선택은 시스템 구조에 따라 결정되어야 한다.<br>잘못된 설계는 데드락이나 병목 같은 부작용을 초래할 수 있으므로, 유연성과 안정성의 균형이 중요하다.</p><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><table><thead><tr><th>카테고리</th><th>원칙명</th><th>설명</th></tr></thead><tbody><tr><td>동기화 기본 원칙</td><td><strong>상호 배제 원칙</strong></td><td>하나의 실행 단위만 임계 구역에 진입할 수 있어야 함</td></tr><tr><td></td><td><strong>진행성 보장 원칙</strong></td><td>락을 요청한 스레드는 유한 시간 내에 진입 가능해야 함</td></tr><tr><td></td><td><strong>유한 대기 원칙</strong></td><td>어떤 스레드도 무한히 대기하지 않도록 공정한 락 분배 필요</td></tr><tr><td>자원 관리 원칙</td><td><strong>자원 해제 원칙</strong></td><td>획득한 락은 명확한 시점에 반드시 해제되어야 함</td></tr><tr><td></td><td><strong>예외 안전성 보장 원칙</strong></td><td>예외 발생 시에도 락이 해제되도록 설계되어야 함</td></tr><tr><td>성능 최적화 원칙</td><td><strong>임계 구역 최소화 원칙</strong></td><td>락 점유 시간을 최소화하여 경합과 병목을 줄임</td></tr><tr><td></td><td><strong>컨텍스트 전환 최소화 원칙</strong></td><td>스레드 블로킹을 줄여 CPU 자원 낭비를 줄임</td></tr><tr><td>안전 설계 원칙</td><td><strong>락 획득 순서 일관성 원칙</strong></td><td>데드락을 방지하기 위해 락 획득 순서를 고정</td></tr><tr><td></td><td><strong>락 계층화 원칙 (Lock Hierarchy)</strong></td><td>계층적인 락 우선순위를 부여하여 하위 → 상위 순으로만 락 획득</td></tr><tr><td>실무 설계 원칙</td><td><strong>재진입성 보장 원칙</strong></td><td>동일 스레드가 이미 보유한 락을 재획득할 수 있어야 함 (Reentrant)</td></tr></tbody></table><ul><li><strong>동기화 기본 원칙</strong>은 멀티스레드 환경에서 상호 배제를 유지하고, 스레드가 합리적인 시간 내에 임계 구역에 진입할 수 있도록 보장한다. 이는 동시성 문제의 핵심 조건들을 충족시키며, 기아 상태와 무한 대기를 방지하는 기반이 된다.</li><li><strong>자원 관리 원칙</strong>은 락의 생명주기를 명확히 정의하고, 예외 상황에서도 안정적으로 자원을 반환하는 것이 핵심이다. 이를 통해 메모리 누수, 데드락, 불안정한 실행 흐름을 예방할 수 있다.</li><li><strong>성능 최적화 원칙</strong>은 락 점유 시간을 줄이고 컨텍스트 스위칭을 최소화하여 시스템의 전반적인 처리 성능을 유지하는 데 중점을 둔다. 특히 경합이 높은 시스템에서는 이 원칙이 병목 현상을 줄이는 데 중요하다.</li><li><strong>안전 설계 원칙</strong>은 데드락 발생을 방지하고 구조적인 락 획득 순서를 유지하는 데 초점을 둔다. 특히 락 계층화는 다중 락을 사용하는 환경에서 필수적인 설계 전략이다.</li><li><strong>실무 설계 원칙</strong>은 실질적인 구현에서의 유연성을 높이기 위한 방안으로, 재진입 가능한 락 구조를 활용해 복잡한 트랜잭션 및 상태 머신 로직에서 안정성을 확보하는 데 사용된다.</li></ul><h3 id=주요-원리-및-작동-원리>주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#주요-원리-및-작동-원리>#</a></h3><p>Lock 은 공유 자원에 대한 상호 배제를 보장하기 위해 도입된 핵심 동기화 기법이다.<br>기본 작동 방식은 Thread 가 Lock 을 요청하고, 성공적으로 획득하면 Critical Section 에 진입하며, 작업 후 Lock 을 해제하여 대기 중인 스레드에게 양도된다.<br>이 과정은 하드웨어 수준의 원자적 연산 (CAS, Test-and-Set 등) 을 기반으로 하며, 스핀락은 락을 획득할 때까지 busy-wait 를 반복하고, 뮤텍스는 커널 스케줄링과 연계되어 블로킹 대기 상태로 진입한다.<br>현대 락 구현에서는 공정성 (Fairness), 백오프 전략, 우선순위 상속 등 고급 기능이 결합되어 성능과 안정성 모두를 고려한 구조로 발전하였다.</p><h4 id=작동-원리-흐름도>작동 원리 흐름도<a hidden class=anchor aria-hidden=true href=#작동-원리-흐름도>#</a></h4><pre class=mermaid>flowchart TD
    A[Thread 시작] --&gt; B[Lock 요청]
    B --&gt; C{Lock 가능 여부}
    C --&gt;|가능| D[Lock 획득]
    D --&gt; E[Critical Section 진입]
    E --&gt; F[작업 처리]
    F --&gt; G[Lock 해제]
    G --&gt; H{대기 중 Thread 존재?}
    H --&gt;|Yes| I[다음 Thread에 Lock 전달]
    H --&gt;|No| J[종료]
</pre><h4 id=주요-원리-다이어그램>주요 원리 다이어그램<a hidden class=anchor aria-hidden=true href=#주요-원리-다이어그램>#</a></h4><pre class=mermaid>graph TD
    Start[Thread A 시도] --&gt; Check[CAS or TAS 사용]
    Check --&gt;|성공| Enter[임계 구역 진입]
    Check --&gt;|실패| WaitType[스핀 or 블로킹 선택]
    
    WaitType --&gt;|스핀락| Spin[&#34;루프 대기 (busy-wait)&#34;]
    WaitType --&gt;|뮤텍스| Block[스레드 블록 / OS 대기 큐 진입]

    Enter --&gt; Exit[임계 구역 종료]
    Exit --&gt; Release[Lock 해제]
    Release --&gt; Notify[대기 스레드 깨움 or 종료]
</pre><h4 id=하드웨어-수준-원리>하드웨어 수준 원리<a hidden class=anchor aria-hidden=true href=#하드웨어-수준-원리>#</a></h4><p><strong>원자적 연산 기반</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>Test</span><span class=o>-</span><span class=ow>and</span><span class=o>-</span><span class=n>Set</span> <span class=err>의사코드</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>function</span> <span class=n>test_and_set</span><span class=p>(</span><span class=n>lock_variable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>old_value</span> <span class=o>=</span> <span class=n>lock_variable</span>
</span></span><span class=line><span class=cl>    <span class=n>lock_variable</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>old_value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Compare</span><span class=o>-</span><span class=ow>and</span><span class=o>-</span><span class=n>Swap</span> <span class=err>의사코드</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>function</span> <span class=n>compare_and_swap</span><span class=p>(</span><span class=n>variable</span><span class=p>,</span> <span class=n>expected</span><span class=p>,</span> <span class=n>new_value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>variable</span> <span class=o>==</span> <span class=n>expected</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>variable</span> <span class=o>=</span> <span class=n>new_value</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=bp>false</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=소프트웨어-수준-원리>소프트웨어 수준 원리<a hidden class=anchor aria-hidden=true href=#소프트웨어-수준-원리>#</a></h4><p><strong>스핀락 vs 뮤텍스 차이</strong>:</p><pre class=mermaid>graph TD
    A[Lock 요청] --&gt; B{Lock 사용 가능?}
    B --&gt;|Yes| C[Lock 획득]
    B --&gt;|No - 스핀락| D[바쁜 대기&lt;br/&gt;CPU 사용]
    B --&gt;|No - 뮤텍스| E[스레드 블록&lt;br/&gt;커널 스케줄링]
    D --&gt; B
    E --&gt; F[스레드 대기 큐]
    C --&gt; G[Critical Section 실행]
    G --&gt; H[Lock 해제]
    H --&gt; I{대기 중인 스레드?}
    I --&gt;|Yes| J[스레드 깨우기]
    I --&gt;|No| K[완료]
</pre><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><pre class=mermaid>graph TD
    subgraph Application Layer
        A1[&#34;Requestor (Thread/Process)&#34;]
        A2[Critical Section]
    end

    subgraph Locking Layer
        L1[Lock State]
        L2[Wait Queue]
        L3[Timeout Control]
        L4[Priority Inheritance]
        L5[Lock Monitoring]
    end

    subgraph OS Layer
        K1[Scheduler]
        K2[System Call Interface]
    end

    subgraph Hardware Layer
        H1[CAS]
        H2[Test-and-Set]
        H3[Memory Barrier]
    end

    %% 흐름 연결
    A1 --&gt;|Lock 요청| L1
    L1 --&gt;|Locked?| L2
    L2 --&gt; K1
    K1 --&gt; K2

    L1 --&gt;|Lock 허용| A2
    A2 --&gt;|작업 완료 후 해제| L1

    L1 --&gt; H1
    L1 --&gt; H2
    H1 --&gt; H3
    H2 --&gt; H3

    L3 --&gt; L1
    L4 --&gt; L2
    L5 --&gt; L1
</pre><ul><li><strong>Lock 은 계층적이다</strong>: 사용자 → 커널 → 하드웨어까지 흐름이 명확히 구분됨</li><li><strong>핵심 제어는 Lock State 가 담당</strong>하며, 대기 큐, 타임아웃, 우선순위 제어 기능과 함께 구성됨</li><li><strong>Atomic Operation 은 모든 제어의 기반</strong>이며, 하드웨어가 제공하는 메커니즘으로 락의 안정성과 원자성을 보장함</li><li><strong>확장 요소</strong>로서 타임아웃, 우선순위 상속, 모니터링 기능이 선택적으로 통합되어 실무 요구에 대응함</li></ul><h4 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h4><table><thead><tr><th>분류</th><th>구성 요소</th><th>설명</th><th>필수/선택</th></tr></thead><tbody><tr><td>구조 주체</td><td><strong>Requestor</strong></td><td>락을 요청하고 해제하는 실행 단위 (스레드/프로세스)</td><td>필수</td></tr><tr><td>제어 핵심</td><td><strong>Lock State</strong></td><td>잠금 상태, 소유자, 재진입 카운터 포함</td><td></td></tr><tr><td>보호 대상</td><td><strong>Critical Section</strong></td><td>보호되어야 하는 공유 자원 접근 코드 블록</td><td></td></tr><tr><td>대기 구조</td><td><strong>Wait Queue</strong></td><td>락을 대기 중인 스레드들을 FIFO 또는 우선순위로 관리</td><td></td></tr><tr><td>제어 방식</td><td><strong>Atomic Operation</strong></td><td>CAS, Test-and-Set 등 원자적 락 제어 연산</td><td></td></tr><tr><td>시간 제어</td><td><strong>Timeout Control</strong></td><td>일정 시간 내 락 미획득 시 실패 처리</td><td>선택</td></tr><tr><td>우선순위 제어</td><td><strong>Priority Inheritance</strong></td><td>우선순위 역전 해결을 위한 상속 구조</td><td></td></tr><tr><td>상태 추적</td><td><strong>Lock Monitoring</strong></td><td>Lock 횟수, 대기 시간, 획득 실패 통계 등 수집</td><td></td></tr></tbody></table><h3 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h3><table><thead><tr><th>구현 기법</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td><strong>Spinlock</strong></td><td>바쁜 대기 상태에서 락 획득 반복 시도</td><td>atomic flag, memory barrier, backoff 전략</td><td>Test-and-Set 또는 CAS 기반 busy-wait</td><td>짧은 임계구역에서 빠른 제어</td><td>커널 락, 하이퍼포머 코드 등</td><td>빠르지만 CPU 자원 소모, 스케줄링 없음</td></tr><tr><td><strong>Mutex</strong></td><td>OS 스케줄링 기반의 블로킹 락</td><td>커널 락 객체, 대기 큐, 스레드 관리</td><td>실패 시 스레드 sleep, 성공 시 wake-up</td><td>자원 낭비 없는 락 대기</td><td>긴 작업, 일반 사용자 공간 락</td><td>블로킹 방식, 데드락 예방 필요</td></tr><tr><td><strong>Reader-Writer</strong></td><td>읽기는 병렬, 쓰기는 단독 락</td><td>읽기 카운터, 쓰기 플래그, 조건 변수</td><td>읽기 우선 or 쓰기 우선 정책에 따라 잠금 조건 분기</td><td>읽기 많은 워크로드에서 처리량 향상</td><td>DB 캐시, 통계 조회, config 등</td><td>공정성/기아 고려 필요, 경합 높을 경우 성능 저하</td></tr><tr><td><strong>Reentrant</strong></td><td>동일 스레드의 중첩 락 허용</td><td>락 객체 + 소유자 ID + 횟수 카운터</td><td>스레드 ID 기반 락 획득 여부 판단 후 카운터 증가</td><td>재귀 함수나 콜백 내 재진입 가능 보장</td><td>Java, Python 재귀적 연산</td><td>상태 관리 복잡, 락 해제 시 주의 필요</td></tr><tr><td><strong>Semaphore</strong></td><td>제한된 수만큼 스레드에 진입 허용</td><td>카운터 변수, 대기 큐</td><td>P(Wait)/V(Signal) 연산으로 동기화</td><td>제한된 리소스 동시 접근 제어</td><td>DB Connection Pool 등</td><td>Lock 보다 범용, Deadlock 방지 필요</td></tr><tr><td><strong>Distributed</strong></td><td>다중 노드에서 락 상태를 일관성 있게 유지</td><td>외부 저장소 (Redis, etcd, ZK), TTL, quorum</td><td>Key/Lease 기반 합의 메커니즘, 시간 기반 만료 포함</td><td>분산 환경에서의 자원 동기화</td><td>MSA, 클러스터, 리더 선출</td><td>네트워크 지연/장애 고려, 시간 동기화 문제</td></tr><tr><td><strong>Futex 기반</strong></td><td>사용자 공간에서 빠르게 락 시도, 실패 시 커널로 전환</td><td>atomic 변수, syscall fallback</td><td>fast-user-space-mutex → 커널 syscall</td><td>사용자 공간 성능 최적화</td><td>Linux glibc, JVM 등</td><td>빠르지만 복잡한 구현 구조, 시스템 의존</td></tr></tbody></table><h4 id=스핀락-spin-lock>스핀락 (Spin Lock)<a hidden class=anchor aria-hidden=true href=#스핀락-spin-lock>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33>33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SpinLock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_locked</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_flag</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_locked</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_flag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_flag</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span>
</span></span><span class=line><span class=cl>            <span class=c1># 짧은 백오프로 CPU 사용량 조절</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.0001</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_locked</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_flag</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>spin_lock</span> <span class=o>=</span> <span class=n>SpinLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>shared_resource</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>worker</span><span class=p>(</span><span class=n>worker_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>shared_resource</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>spin_lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># Critical Section - 짧은 연산</span>
</span></span><span class=line><span class=cl>        <span class=n>temp</span> <span class=o>=</span> <span class=n>shared_resource</span>
</span></span><span class=line><span class=cl>        <span class=n>temp</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>shared_resource</span> <span class=o>=</span> <span class=n>temp</span>
</span></span><span class=line><span class=cl>        <span class=n>spin_lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=뮤텍스-mutex>뮤텍스 (Mutex)<a hidden class=anchor aria-hidden=true href=#뮤텍스-mutex>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25>25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26>26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27>27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28>28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29>29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30>30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31>31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32>32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33>33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34>34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35>35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36>36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37>37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38>38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39>39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40>40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41>41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42>42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43>43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44>44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45>45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46>46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47>47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48>48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49>49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50>50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51>51</a>
</span><span class=lnt id=hl-17-52><a class=lnlinks href=#hl-17-52>52</a>
</span><span class=lnt id=hl-17-53><a class=lnlinks href=#hl-17-53>53</a>
</span><span class=lnt id=hl-17-54><a class=lnlinks href=#hl-17-54>54</a>
</span><span class=lnt id=hl-17-55><a class=lnlinks href=#hl-17-55>55</a>
</span><span class=lnt id=hl-17-56><a class=lnlinks href=#hl-17-56>56</a>
</span><span class=lnt id=hl-17-57><a class=lnlinks href=#hl-17-57>57</a>
</span><span class=lnt id=hl-17-58><a class=lnlinks href=#hl-17-58>58</a>
</span><span class=lnt id=hl-17-59><a class=lnlinks href=#hl-17-59>59</a>
</span><span class=lnt id=hl-17-60><a class=lnlinks href=#hl-17-60>60</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>queue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MutexExample</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>shared_queue</span> <span class=o>=</span> <span class=n>queue</span><span class=o>.</span><span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>processing_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>producer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>producer_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;item-</span><span class=si>{</span><span class=n>producer_id</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 뮤텍스로 보호되는 Critical Section</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>shared_queue</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>processing_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Producer </span><span class=si>{</span><span class=n>producer_id</span><span class=si>}</span><span class=s2> added </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                      <span class=sa>f</span><span class=s2>&#34;total items: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>processing_count</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 생산 작업 시뮬레이션</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>consumer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>consumer_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 타임아웃을 통한 안전한 종료</span>
</span></span><span class=line><span class=cl>                <span class=n>item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>shared_queue</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>processing_count</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Consumer </span><span class=si>{</span><span class=n>consumer_id</span><span class=si>}</span><span class=s2> processed </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2>, &#34;</span>
</span></span><span class=line><span class=cl>                          <span class=sa>f</span><span class=s2>&#34;remaining: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>processing_count</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.2</span><span class=p>)</span>  <span class=c1># 처리 작업 시뮬레이션</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=n>queue</span><span class=o>.</span><span class=n>Empty</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 시스템 구성 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mutex_system_example</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>system</span> <span class=o>=</span> <span class=n>MutexExample</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 생산자와 소비자 스레드 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>producers</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>system</span><span class=o>.</span><span class=n>producer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span> 
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>consumers</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>system</span><span class=o>.</span><span class=n>consumer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span> 
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 모든 스레드 시작</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>producers</span> <span class=o>+</span> <span class=n>consumers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 생산자 완료 대기</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>producers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 소비자 완료 대기</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>consumers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=읽기---쓰기-락-reader-writer-lock>읽기 - 쓰기 락 (Reader-Writer Lock)<a hidden class=anchor aria-hidden=true href=#읽기---쓰기-락-reader-writer-lock>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18>18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19>19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20>20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21>21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22>22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23>23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24>24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25>25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26>26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27>27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28>28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29>29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30>30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31>31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32>32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33>33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34>34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35>35</a>
</span><span class=lnt id=hl-18-36><a class=lnlinks href=#hl-18-36>36</a>
</span><span class=lnt id=hl-18-37><a class=lnlinks href=#hl-18-37>37</a>
</span><span class=lnt id=hl-18-38><a class=lnlinks href=#hl-18-38>38</a>
</span><span class=lnt id=hl-18-39><a class=lnlinks href=#hl-18-39>39</a>
</span><span class=lnt id=hl-18-40><a class=lnlinks href=#hl-18-40>40</a>
</span><span class=lnt id=hl-18-41><a class=lnlinks href=#hl-18-41>41</a>
</span><span class=lnt id=hl-18-42><a class=lnlinks href=#hl-18-42>42</a>
</span><span class=lnt id=hl-18-43><a class=lnlinks href=#hl-18-43>43</a>
</span><span class=lnt id=hl-18-44><a class=lnlinks href=#hl-18-44>44</a>
</span><span class=lnt id=hl-18-45><a class=lnlinks href=#hl-18-45>45</a>
</span><span class=lnt id=hl-18-46><a class=lnlinks href=#hl-18-46>46</a>
</span><span class=lnt id=hl-18-47><a class=lnlinks href=#hl-18-47>47</a>
</span><span class=lnt id=hl-18-48><a class=lnlinks href=#hl-18-48>48</a>
</span><span class=lnt id=hl-18-49><a class=lnlinks href=#hl-18-49>49</a>
</span><span class=lnt id=hl-18-50><a class=lnlinks href=#hl-18-50>50</a>
</span><span class=lnt id=hl-18-51><a class=lnlinks href=#hl-18-51>51</a>
</span><span class=lnt id=hl-18-52><a class=lnlinks href=#hl-18-52>52</a>
</span><span class=lnt id=hl-18-53><a class=lnlinks href=#hl-18-53>53</a>
</span><span class=lnt id=hl-18-54><a class=lnlinks href=#hl-18-54>54</a>
</span><span class=lnt id=hl-18-55><a class=lnlinks href=#hl-18-55>55</a>
</span><span class=lnt id=hl-18-56><a class=lnlinks href=#hl-18-56>56</a>
</span><span class=lnt id=hl-18-57><a class=lnlinks href=#hl-18-57>57</a>
</span><span class=lnt id=hl-18-58><a class=lnlinks href=#hl-18-58>58</a>
</span><span class=lnt id=hl-18-59><a class=lnlinks href=#hl-18-59>59</a>
</span><span class=lnt id=hl-18-60><a class=lnlinks href=#hl-18-60>60</a>
</span><span class=lnt id=hl-18-61><a class=lnlinks href=#hl-18-61>61</a>
</span><span class=lnt id=hl-18-62><a class=lnlinks href=#hl-18-62>62</a>
</span><span class=lnt id=hl-18-63><a class=lnlinks href=#hl-18-63>63</a>
</span><span class=lnt id=hl-18-64><a class=lnlinks href=#hl-18-64>64</a>
</span><span class=lnt id=hl-18-65><a class=lnlinks href=#hl-18-65>65</a>
</span><span class=lnt id=hl-18-66><a class=lnlinks href=#hl-18-66>66</a>
</span><span class=lnt id=hl-18-67><a class=lnlinks href=#hl-18-67>67</a>
</span><span class=lnt id=hl-18-68><a class=lnlinks href=#hl-18-68>68</a>
</span><span class=lnt id=hl-18-69><a class=lnlinks href=#hl-18-69>69</a>
</span><span class=lnt id=hl-18-70><a class=lnlinks href=#hl-18-70>70</a>
</span><span class=lnt id=hl-18-71><a class=lnlinks href=#hl-18-71>71</a>
</span><span class=lnt id=hl-18-72><a class=lnlinks href=#hl-18-72>72</a>
</span><span class=lnt id=hl-18-73><a class=lnlinks href=#hl-18-73>73</a>
</span><span class=lnt id=hl-18-74><a class=lnlinks href=#hl-18-74>74</a>
</span><span class=lnt id=hl-18-75><a class=lnlinks href=#hl-18-75>75</a>
</span><span class=lnt id=hl-18-76><a class=lnlinks href=#hl-18-76>76</a>
</span><span class=lnt id=hl-18-77><a class=lnlinks href=#hl-18-77>77</a>
</span><span class=lnt id=hl-18-78><a class=lnlinks href=#hl-18-78>78</a>
</span><span class=lnt id=hl-18-79><a class=lnlinks href=#hl-18-79>79</a>
</span><span class=lnt id=hl-18-80><a class=lnlinks href=#hl-18-80>80</a>
</span><span class=lnt id=hl-18-81><a class=lnlinks href=#hl-18-81>81</a>
</span><span class=lnt id=hl-18-82><a class=lnlinks href=#hl-18-82>82</a>
</span><span class=lnt id=hl-18-83><a class=lnlinks href=#hl-18-83>83</a>
</span><span class=lnt id=hl-18-84><a class=lnlinks href=#hl-18-84>84</a>
</span><span class=lnt id=hl-18-85><a class=lnlinks href=#hl-18-85>85</a>
</span><span class=lnt id=hl-18-86><a class=lnlinks href=#hl-18-86>86</a>
</span><span class=lnt id=hl-18-87><a class=lnlinks href=#hl-18-87>87</a>
</span><span class=lnt id=hl-18-88><a class=lnlinks href=#hl-18-88>88</a>
</span><span class=lnt id=hl-18-89><a class=lnlinks href=#hl-18-89>89</a>
</span><span class=lnt id=hl-18-90><a class=lnlinks href=#hl-18-90>90</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ReaderWriterLock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_readers</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_writers</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_read_ready</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_write_ready</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire_read</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_read_ready</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>_writers</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_read_ready</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_readers</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release_read</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_read_ready</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_readers</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_readers</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_read_ready</span><span class=o>.</span><span class=n>notifyAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire_write</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_write_ready</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>_writers</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>_readers</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_write_ready</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_writers</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release_write</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_write_ready</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_writers</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_write_ready</span><span class=o>.</span><span class=n>notifyAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_read_ready</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_read_ready</span><span class=o>.</span><span class=n>notifyAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 공유 데이터베이스 시뮬레이션</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SharedDatabase</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>rw_lock</span> <span class=o>=</span> <span class=n>ReaderWriterLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;users&#34;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span> <span class=s2>&#34;posts&#34;</span><span class=p>:</span> <span class=mi>5000</span><span class=p>,</span> <span class=s2>&#34;comments&#34;</span><span class=p>:</span> <span class=mi>15000</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>read_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>reader_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>rw_lock</span><span class=o>.</span><span class=n>acquire_read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=s2>&#34;Not Found&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Reader </span><span class=si>{</span><span class=n>reader_id</span><span class=si>}</span><span class=s2> read </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 읽기 작업 시뮬레이션</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>rw_lock</span><span class=o>.</span><span class=n>release_read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>write_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>writer_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>rw_lock</span><span class=o>.</span><span class=n>acquire_write</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>old_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Writer </span><span class=si>{</span><span class=n>writer_id</span><span class=si>}</span><span class=s2> updated </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>old_value</span><span class=si>}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.2</span><span class=p>)</span>  <span class=c1># 쓰기 작업 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>rw_lock</span><span class=o>.</span><span class=n>release_write</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 시나리오: 읽기 집약적 워크로드</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>reader_writer_scenario</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span> <span class=o>=</span> <span class=n>SharedDatabase</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>reader_worker</span><span class=p>(</span><span class=n>reader_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=s2>&#34;users&#34;</span><span class=p>,</span> <span class=s2>&#34;posts&#34;</span><span class=p>,</span> <span class=s2>&#34;comments&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>db</span><span class=o>.</span><span class=n>read_data</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>reader_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>writer_worker</span><span class=p>(</span><span class=n>writer_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=s2>&#34;users&#34;</span><span class=p>,</span> <span class=s2>&#34;posts&#34;</span><span class=p>,</span> <span class=s2>&#34;comments&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>value</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>9999</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>db</span><span class=o>.</span><span class=n>write_data</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>writer_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 많은 읽기 스레드와 적은 쓰기 스레드</span>
</span></span><span class=line><span class=cl>    <span class=n>readers</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>reader_worker</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span> 
</span></span><span class=line><span class=cl>               <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>writers</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>writer_worker</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span> 
</span></span><span class=line><span class=cl>               <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>readers</span> <span class=o>+</span> <span class=n>writers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>readers</span> <span class=o>+</span> <span class=n>writers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=semaphore>Semaphore<a hidden class=anchor aria-hidden=true href=#semaphore>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18>18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19>19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20>20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21>21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22>22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23>23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24>24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25>25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26>26</a>
</span><span class=lnt id=hl-19-27><a class=lnlinks href=#hl-19-27>27</a>
</span><span class=lnt id=hl-19-28><a class=lnlinks href=#hl-19-28>28</a>
</span><span class=lnt id=hl-19-29><a class=lnlinks href=#hl-19-29>29</a>
</span><span class=lnt id=hl-19-30><a class=lnlinks href=#hl-19-30>30</a>
</span><span class=lnt id=hl-19-31><a class=lnlinks href=#hl-19-31>31</a>
</span><span class=lnt id=hl-19-32><a class=lnlinks href=#hl-19-32>32</a>
</span><span class=lnt id=hl-19-33><a class=lnlinks href=#hl-19-33>33</a>
</span><span class=lnt id=hl-19-34><a class=lnlinks href=#hl-19-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 세마포어(동시 접근 3개 제한)</span>
</span></span><span class=line><span class=cl><span class=n>semaphore</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 공유 자원 (예: 외부 API 호출, DB 커넥션 등)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>access_shared_resource</span><span class=p>(</span><span class=n>thread_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread-</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2> 대기 중…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 세마포어 획득</span>
</span></span><span class=line><span class=cl>    <span class=n>semaphore</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread-</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2> 공유 자원에 접근&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 임계 구역(자원 접근)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>  <span class=c1># 자원 사용 시뮬레이션</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 세마포어 해제</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread-</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2> 자원 사용 종료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>semaphore</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 10개의 스레드 실행</span>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>access_shared_resource</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>    <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 모든 스레드 종료 대기</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;모든 스레드 완료&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=futex-기반>Futex 기반<a hidden class=anchor aria-hidden=true href=#futex-기반>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22>22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23>23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24>24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25>25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26>26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27>27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28>28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29>29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30>30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31>31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32>32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33>33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34>34</a>
</span><span class=lnt id=hl-20-35><a class=lnlinks href=#hl-20-35>35</a>
</span><span class=lnt id=hl-20-36><a class=lnlinks href=#hl-20-36>36</a>
</span><span class=lnt id=hl-20-37><a class=lnlinks href=#hl-20-37>37</a>
</span><span class=lnt id=hl-20-38><a class=lnlinks href=#hl-20-38>38</a>
</span><span class=lnt id=hl-20-39><a class=lnlinks href=#hl-20-39>39</a>
</span><span class=lnt id=hl-20-40><a class=lnlinks href=#hl-20-40>40</a>
</span><span class=lnt id=hl-20-41><a class=lnlinks href=#hl-20-41>41</a>
</span><span class=lnt id=hl-20-42><a class=lnlinks href=#hl-20-42>42</a>
</span><span class=lnt id=hl-20-43><a class=lnlinks href=#hl-20-43>43</a>
</span><span class=lnt id=hl-20-44><a class=lnlinks href=#hl-20-44>44</a>
</span><span class=lnt id=hl-20-45><a class=lnlinks href=#hl-20-45>45</a>
</span><span class=lnt id=hl-20-46><a class=lnlinks href=#hl-20-46>46</a>
</span><span class=lnt id=hl-20-47><a class=lnlinks href=#hl-20-47>47</a>
</span><span class=lnt id=hl-20-48><a class=lnlinks href=#hl-20-48>48</a>
</span><span class=lnt id=hl-20-49><a class=lnlinks href=#hl-20-49>49</a>
</span><span class=lnt id=hl-20-50><a class=lnlinks href=#hl-20-50>50</a>
</span><span class=lnt id=hl-20-51><a class=lnlinks href=#hl-20-51>51</a>
</span><span class=lnt id=hl-20-52><a class=lnlinks href=#hl-20-52>52</a>
</span><span class=lnt id=hl-20-53><a class=lnlinks href=#hl-20-53>53</a>
</span><span class=lnt id=hl-20-54><a class=lnlinks href=#hl-20-54>54</a>
</span><span class=lnt id=hl-20-55><a class=lnlinks href=#hl-20-55>55</a>
</span><span class=lnt id=hl-20-56><a class=lnlinks href=#hl-20-56>56</a>
</span><span class=lnt id=hl-20-57><a class=lnlinks href=#hl-20-57>57</a>
</span><span class=lnt id=hl-20-58><a class=lnlinks href=#hl-20-58>58</a>
</span><span class=lnt id=hl-20-59><a class=lnlinks href=#hl-20-59>59</a>
</span><span class=lnt id=hl-20-60><a class=lnlinks href=#hl-20-60>60</a>
</span><span class=lnt id=hl-20-61><a class=lnlinks href=#hl-20-61>61</a>
</span><span class=lnt id=hl-20-62><a class=lnlinks href=#hl-20-62>62</a>
</span><span class=lnt id=hl-20-63><a class=lnlinks href=#hl-20-63>63</a>
</span><span class=lnt id=hl-20-64><a class=lnlinks href=#hl-20-64>64</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>ctypes</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Linux syscall 번호 (x86_64 기준)</span>
</span></span><span class=line><span class=cl><span class=n>SYS_futex</span> <span class=o>=</span> <span class=mi>202</span>  <span class=c1># __NR_futex</span>
</span></span><span class=line><span class=cl><span class=n>FUTEX_WAIT</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>FUTEX_WAKE</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ctypes</span><span class=o>.</span><span class=n>CDLL</span><span class=p>(</span><span class=s2>&#34;libc.so&#34;</span><span class=p>,</span> <span class=n>use_errno</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ctypes를 통한 futex syscall 함수 정의</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>futex</span><span class=p>(</span><span class=n>uaddr</span><span class=p>,</span> <span class=n>futex_op</span><span class=p>,</span> <span class=n>val</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>uaddr_p</span> <span class=o>=</span> <span class=n>ctypes</span><span class=o>.</span><span class=n>pointer</span><span class=p>(</span><span class=n>ctypes</span><span class=o>.</span><span class=n>c_int</span><span class=p>(</span><span class=n>uaddr</span><span class=p>[</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>libc</span><span class=o>.</span><span class=n>syscall</span><span class=p>(</span><span class=n>SYS_futex</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>uaddr_p</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>futex_op</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>val</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>ctypes</span><span class=o>.</span><span class=n>c_void_p</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>FutexLock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># 공유 메모리 (값이 0이면 락 없음, 1이면 락 중)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 실패 시 사용자 공간에서 실패 → 커널로 들어가 대기</span>
</span></span><span class=line><span class=cl>            <span class=n>futex</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=p>,</span> <span class=n>FUTEX_WAIT</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=n>futex</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=p>,</span> <span class=n>FUTEX_WAKE</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 테스트 예시</span>
</span></span><span class=line><span class=cl><span class=n>futex_lock</span> <span class=o>=</span> <span class=n>FutexLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>shared_value</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>worker</span><span class=p>(</span><span class=n>tid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>shared_value</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>futex_lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>temp</span> <span class=o>=</span> <span class=n>shared_value</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>  <span class=c1># 시뮬레이션용</span>
</span></span><span class=line><span class=cl>        <span class=n>shared_value</span> <span class=o>=</span> <span class=n>temp</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>futex_lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread-</span><span class=si>{</span><span class=n>tid</span><span class=si>}</span><span class=s2> done.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>worker</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;최종 shared_value: </span><span class=si>{</span><span class=n>shared_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>1. 정합성 및 안정성 확보</strong></td><td>데이터 일관성 유지</td><td>동시 수정 방지, 무결성 보장, race condition 예방</td></tr><tr><td></td><td>시스템 안정성 향상</td><td>비정상 접근, segmentation fault 등 오류 감소</td></tr><tr><td></td><td>예측 가능한 실행 흐름</td><td>동기화된 실행 순서로 디버깅 및 테스트 용이</td></tr><tr><td><strong>2. 개발 및 설계 효율</strong></td><td>구현의 단순성</td><td>acquire/release 패턴으로 직관적 설계 가능</td></tr><tr><td></td><td>디버깅 및 추적 용이성</td><td>락 기반 구조는 분석 툴, trace 도구와 잘 통합됨</td></tr><tr><td><strong>3. 운영 환경 및 성능 최적화</strong></td><td>하드웨어 활용 최적화</td><td>멀티코어 환경에서 병렬성 확보와 성능 향상</td></tr><tr><td></td><td>락 기반 정책 확장 용이</td><td>timeout, 우선순위, 공정성 등 정책 적용 가능</td></tr><tr><td><strong>4. 유연한 적용과 확장성</strong></td><td>다양한 구현체 존재</td><td>OS/언어별 최적화된 API 제공</td></tr><tr><td></td><td>요구사항에 맞는 락 선택</td><td>목적에 따라 mutex, semaphore, RW lock 선택 가능</td></tr></tbody></table><ul><li><p><strong>정합성 및 안정성 확보</strong>: 락은 데이터의 일관성과 무결성을 유지하며, Race Condition 을 방지하고 예외 발생 가능성을 줄여 시스템의 안정성을 높인다.</p></li><li><p><strong>개발 및 설계 효율</strong>: 명확한 동기화 패턴을 통해 개발자에게 직관적인 설계를 제공하고, 디버깅 및 상태 추적이 용이하다.</p></li><li><p><strong>운영 환경 및 성능 최적화</strong>: 멀티코어 환경에서 병렬성을 유지하며 안정적으로 자원을 제어하고, 다양한 정책 (우선순위, timeout) 을 락에 적용할 수 있어 성능 및 안정성 양립이 가능하다.</p></li><li><p><strong>유연한 적용과 확장성</strong>: 락은 OS 및 언어에서 표준적으로 제공되며, 시스템 구조나 요구사항에 따라 다양한 구현체를 선택적으로 활용할 수 있다.</p></li></ul><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h4><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>성능</td><td>성능 오버헤드</td><td>Lock 획득/해제 시 CPU 및 메모리 자원 사용 증가</td><td>Lock-Free 구조, Spin-Lock 최소화</td></tr><tr><td>확장성</td><td>확장성 제한</td><td>다수의 스레드가 동일 자원에 접근 시 경합 증가</td><td>Lock Splitting, Sharding</td></tr><tr><td>스케줄링 비용</td><td>컨텍스트 스위칭 오버헤드</td><td>블로킹 Lock 시 커널 전환 비용 발생</td><td>Hybrid Lock, 사용자 공간 우선 락</td></tr><tr><td>운영 복잡성</td><td>디버깅 복잡성</td><td>동기화 오류는 재현 어려우며 상태 추적 어려움</td><td>ThreadSanitizer, 락 시각화 도구 사용</td></tr></tbody></table><p>락은 기본적으로 공유 자원에 대한 보호를 제공하지만, 성능 저하와 확장성 문제를 동반한다. 특히 스레드 경합이 심할 경우 Lock 획득/해제로 인한 오버헤드가 발생하며, 블로킹 락은 스케줄링 효율까지 저하시킨다. 또한 락 기반 시스템은 디버깅이 복잡하여 실시간 분석 도구 없이는 오류 추적이 어렵다. 이를 해결하기 위해 락 세분화, Lock-Free 구조, Hybrid Lock 전략 등이 적용된다.</p><h4 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h4><table><thead><tr><th>카테고리</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단 방법</th><th>예방 및 해결 방법</th></tr></thead><tbody><tr><td>동기화 교착</td><td>데드락 (Deadlock)</td><td>순환 락 점유, 락 순서 불일치</td><td>시스템 정지, 무한 대기</td><td>스레드 덤프, 락 의존 그래프 분석</td><td>락 순서 정의, 타임아웃 설정, 감지 알고리즘</td></tr><tr><td>진행성 오류</td><td>기아 상태 (Starvation)</td><td>낮은 우선순위 스레드가 지속적으로 Lock 획득 실패</td><td>응답 시간 증가, 처리 지연</td><td>대기 시간 모니터링, 큐 분석</td><td>공정 큐, 우선순위 조정, 상속 프로토콜 적용</td></tr><tr><td>비진행성 오류</td><td>라이브락 (Livelock)</td><td>양보 반복으로 인한 무진입</td><td>CPU 낭비, 진입 불가</td><td>진행률 측정, CPU 사용률 분석</td><td>지수 백오프, 임의 지연</td></tr><tr><td>CPU 낭비 문제</td><td>Busy Waiting</td><td>SpinLock 사용 시 지속 루프 발생</td><td>CPU 과점유</td><td>시스템 부하 분석, CPU 사용량 모니터링</td><td>Hybrid Lock (Spin 후 Block)</td></tr><tr><td>우선순위 제약</td><td>우선순위 역전 문제</td><td>낮은 우선순위 스레드가 락 보유 → 높은 우선순위 차단</td><td>실시간 제약 위반</td><td>우선순위 추적</td><td>Priority Inheritance, Ceiling Protocol</td></tr></tbody></table><p>락 기반 동기화는 데드락, 기아 상태, 라이브락, 우선순위 역전 등 다양한 동시성 문제를 초래할 수 있다. 이러한 문제들은 시스템의 안정성과 응답성을 해치며, 특히 실시간 시스템에서는 치명적이다. 예방을 위해 락 획득 순서 고정, 타임아웃 설정, 공정한 대기 큐 및 우선순위 상속 프로토콜이 사용되며, 백오프 전략이나 감지 알고리즘을 통해 해결 전략이 병행되어야 한다.</p><h5 id=데드락-deadlock-1>데드락 (Deadlock)<a hidden class=anchor aria-hidden=true href=#데드락-deadlock-1>#</a></h5><p><strong>해결 전략</strong>: <strong>Lock 순서 정의 + 타임아웃 + 백오프</strong></p><p><strong>적용 기준</strong></p><table><thead><tr><th>적용 전략</th><th>적용 조건 / 고려사항</th></tr></thead><tbody><tr><td>Lock 순서 정의</td><td>둘 이상의 락을 사용할 경우, 항상 동일한 순서로 락 획득</td></tr><tr><td>타임아웃</td><td>특정 시간 내 락 획득 실패 시 포기 처리</td></tr><tr><td>백오프 (Backoff)</td><td>재시도 시 점진적으로 대기 시간 증가 (혼잡 회피)</td></tr></tbody></table><p><strong>Python 예시</strong>: <code>lock acquisition with timeout</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17>17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18>18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19>19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20>20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21>21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22>22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23>23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24>24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock_a</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>lock_b</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>safe_task</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>acquired_a</span> <span class=o>=</span> <span class=n>lock_a</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>acquired_a</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>  <span class=c1># backoff 가능</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>acquired_b</span> <span class=o>=</span> <span class=n>lock_b</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>acquired_b</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>lock_a</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># backoff</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 임계 구역 작업</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Lock A and B acquired&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>lock_b</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>lock_a</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=기아-상태-starvation-1>기아 상태 (Starvation)<a hidden class=anchor aria-hidden=true href=#기아-상태-starvation-1>#</a></h5><p><strong>해결 전략</strong>: <strong>공정한 큐잉 (FIFO), 우선순위 상속</strong></p><p><strong>적용 기준</strong>:</p><table><thead><tr><th>적용 전략</th><th>적용 조건 / 고려사항</th></tr></thead><tbody><tr><td>FIFO 큐</td><td>요청 순서대로 처리, 선점 없음</td></tr><tr><td>우선순위 상속</td><td>낮은 우선순위 락 보유자가 높은 우선순위에 의해 상속됨 (실시간 시스템)</td></tr></tbody></table><p><strong>Python 예시</strong>: <code>Queue + Lock</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17>17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>queue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>task_queue</span> <span class=o>=</span> <span class=n>queue</span><span class=o>.</span><span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>worker</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>task</span> <span class=o>=</span> <span class=n>task_queue</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock</span><span class=p>:</span>  <span class=c1># FIFO 큐 처리 기반</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Processing </span><span class=si>{</span><span class=n>task</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>task_queue</span><span class=o>.</span><span class=n>task_done</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>worker</span><span class=p>,</span> <span class=n>daemon</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>task_queue</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Task-</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=라이브락-livelock>라이브락 (Livelock)<a hidden class=anchor aria-hidden=true href=#라이브락-livelock>#</a></h5><p><strong>해결 전략</strong>: <strong>랜덤/지수 백오프, 우선순위 기반 선택</strong></p><p><strong>적용 기준</strong></p><table><thead><tr><th>적용 전략</th><th>적용 조건 / 고려사항</th></tr></thead><tbody><tr><td>지수적 백오프</td><td>재시도 시 대기 시간이 점차 증가</td></tr><tr><td>우선순위 큐 또는 랜덤 선택</td><td>서로 양보만 반복하지 않도록 선점 유도</td></tr></tbody></table><p><strong>Python 예시</strong>: <code>Exponential Backoff</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17>17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18>18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19>19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20>20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>livelock_safe_worker</span><span class=p>(</span><span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>backoff</span> <span class=o>=</span> <span class=mf>0.01</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>blocking</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2> acquired lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>backoff</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>backoff</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>backoff</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>  <span class=c1># 최대 1초까지 증가</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>livelock_safe_worker</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread-</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,))</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=우선순위-역전-priority-inversion>우선순위 역전 (Priority Inversion)<a hidden class=anchor aria-hidden=true href=#우선순위-역전-priority-inversion>#</a></h5><p><strong>해결 전략</strong>: <strong>Priority Inheritance / Priority Ceiling Protocol</strong></p><p><strong>적용 기준</strong>:</p><table><thead><tr><th>적용 전략</th><th>적용 조건 / 고려사항</th></tr></thead><tbody><tr><td>우선순위 상속</td><td>낮은 우선순위 락 보유자 → 높은 우선순위 상속</td></tr><tr><td>Ceiling 프로토콜 사용</td><td>공유 자원마다 ceiling level 정의</td></tr></tbody></table><p><strong>Java 예시</strong>: <code>Priority Inheritance using Thread priorities</code></p><blockquote><p>⚠️ Python 은 우선순위 스케줄링을 직접 제어할 수 없어 Java 예시 사용</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PriorityInversionDemo</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>lock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Thread</span><span class=w> </span><span class=n>low</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>lock</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>3000</span><span class=p>);</span><span class=w>  </span><span class=c1>// 락을 오래 보유</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>ignored</span><span class=p>)</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>},</span><span class=w> </span><span class=s>&#34;LowPriority&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Thread</span><span class=w> </span><span class=n>high</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>lock</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;High priority thread got lock&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>},</span><span class=w> </span><span class=s>&#34;HighPriority&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>low</span><span class=p>.</span><span class=na>setPriority</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>MIN_PRIORITY</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>high</span><span class=p>.</span><span class=na>setPriority</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>MAX_PRIORITY</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>low</span><span class=p>.</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Thread</span><span class=p>.</span><span class=na>yield</span><span class=p>();</span><span class=w>  </span><span class=c1>// low가 먼저 락을 잡게 유도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>high</span><span class=p>.</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>실시간 시스템에서는 POSIX 의 <code>pthread_mutexattr_setprotocol(PTHREAD_PRIO_INHERIT)</code> 로 구현 가능.</p></blockquote><h5 id=성능-오버헤드-lock-contention>성능 오버헤드 (Lock Contention)<a hidden class=anchor aria-hidden=true href=#성능-오버헤드-lock-contention>#</a></h5><p><strong>해결 전략</strong>: <strong>Lock 세분화, Lock Striping, Lock-Free 구조</strong></p><p><strong>적용 기준</strong></p><table><thead><tr><th>전략</th><th>적용 조건</th></tr></thead><tbody><tr><td>Fine-Grained Locking</td><td>공유 자원을 더 세분화해서 관리</td></tr><tr><td>Lock Striping</td><td>해시 기반으로 락을 분산 처리</td></tr><tr><td>Lock-Free</td><td>CAS 기반 자료구조 사용 (성능 최적화)</td></tr></tbody></table><p><strong>Python 예시</strong>: <code>Lock Striping with Sharded Locks</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2>2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3>3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4>4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5>5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6>6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7>7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8>8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=n>NUM_SHARDS</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>locks</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>NUM_SHARDS</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[{}</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>NUM_SHARDS</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>access_data</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>shard</span> <span class=o>=</span> <span class=nb>hash</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=o>%</span> <span class=n>NUM_SHARDS</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>locks</span><span class=p>[</span><span class=n>shard</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span><span class=p>[</span><span class=n>shard</span><span class=p>][</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>세부 과제</th><th>설명</th></tr></thead><tbody><tr><td><strong>1. 성능 및 확장성 문제</strong></td><td>락 경합 최적화</td><td>멀티코어/NUMA 환경에서 캐시 일관성 및 False Sharing 문제 발생</td></tr><tr><td></td><td>락 -Free/Wait-Free 설계 유도</td><td>CAS, LL/SC 기반 구조로 고성능 환경에서 락 최소화</td></tr><tr><td></td><td>적응형 락 전략 필요</td><td>상황에 따라 스핀 ↔ 블록 전환 또는 락 그라뉼러리티 조정 필요</td></tr><tr><td><strong>2. 분산 시스템 일관성 문제</strong></td><td>글로벌 락 동기화</td><td>네트워크 파티션, 노드 장애 시 일관성 유지 어려움</td></tr><tr><td></td><td>분산 트랜잭션과의 연계</td><td>락과 2PC/SAGA 연동 시 처리 복잡성 증가</td></tr><tr><td></td><td>장애 복구 메커니즘 필요</td><td>Lease-based Lock, Raft/Paxos 등 합의 기반 복구 필수</td></tr><tr><td><strong>3. 실시간 예측성 문제</strong></td><td>우선순위 역전</td><td>낮은 우선순위 스레드가 락 보유 시 높은 우선순위 스레드가 대기</td></tr><tr><td></td><td>락 획득 시간 비결정성</td><td>실시간 시스템에서 시간 제약 조건 위반 위험</td></tr><tr><td></td><td>제한 시간 기반 락 정책 필요</td><td><code>try_lock(timeout)</code>, 우선순위 상속, ceiling 기법 필요</td></tr><tr><td><strong>4. 설계 및 디버깅 복잡성</strong></td><td>동기화 버그 추적 어려움</td><td>race condition, deadlock, starvation 등 재현 어려움</td></tr><tr><td></td><td>디버깅 도구 부족</td><td>동적 분석, 정적 모델 검증 도구와의 통합 필요</td></tr><tr><td></td><td>복잡한 락 그래프 구조 추적</td><td>다중 경로에서 락이 얽히는 경우 설계 및 분석이 어려움</td></tr></tbody></table><ul><li><p><strong>성능 및 확장성 문제</strong>: 멀티코어 및 NUMA 시스템에서는 락 경합과 캐시 무효화로 인해 성능 병목이 발생할 수 있다. 이를 해결하기 위해 락을 최소화하거나, 스핀락과 블로킹 락을 하이브리드로 사용하는 전략이 필요하다.</p></li><li><p><strong>분산 시스템 일관성 문제</strong>: 분산 환경에서는 글로벌 락의 일관성 유지가 어렵고, 네트워크 파티션이나 노드 장애가 발생하면 데이터 정합성 문제가 생긴다. 이를 해결하기 위해 Lease 기반 락, 합의 알고리즘 (Raft/Paxos), 트랜잭션 연계 설계가 요구된다.</p></li><li><p><strong>실시간 예측성 문제</strong>: 락 획득의 불확실성과 우선순위 역전은 실시간 시스템에서 시간 제약을 위반하게 만든다. 우선순위 상속, 우선순위 천이, 시간 제한 기반 락 획득 같은 기법을 통해 보완할 수 있다.</p></li><li><p><strong>설계 및 디버깅 복잡성 문제</strong>: 동기화 문제는 재현이 어렵고, 문제의 원인을 추적하기 위한 도구나 기법이 부족할 수 있다. 락 그래프 시각화, 정적 분석, 모델 검증 도구의 통합이 필요한 영역이다.</p></li></ul><h4 id=도전-과제별-해결-전략-정리표>도전 과제별 해결 전략 정리표<a hidden class=anchor aria-hidden=true href=#도전-과제별-해결-전략-정리표>#</a></h4><table><thead><tr><th>카테고리</th><th>도전 과제</th><th>원인</th><th>해결 전략</th></tr></thead><tbody><tr><td><strong>1. 성능 및 확장성 문제</strong></td><td>Lock 경합 및 병목</td><td>멀티코어 환경에서 동일 캐시에 대한 경합, False Sharing</td><td>- Per-core Lock, Sharded Lock<br>- 락 로컬리티 향상<br>- 캐시 정렬 및 Padding</td></tr><tr><td></td><td>락으로 인한 처리량 저하</td><td>락 획득/해제 비용, 스레드 간 전환 비용</td><td>- Lock-Free/Wait-Free 설계 (CAS, LL/SC)<br>- MCS/CLH Queue 기반 락</td></tr><tr><td></td><td>Granularity 최적화 필요</td><td>락 범위가 너무 넓으면 병목, 너무 세분화하면 복잡도 증가</td><td>- Adaptive Lock Granularity<br>- Read/Write 분리<br>- Fine-grained Lock</td></tr><tr><td></td><td>스핀락 과도 사용</td><td>짧은 작업엔 유리하지만 경합 시 CPU 낭비</td><td>- Adaptive Spin-then-Block 전략<br>- Exponential Backoff</td></tr><tr><td><strong>2. 분산 시스템 일관성 문제</strong></td><td>글로벌 락 일관성 유지 어려움</td><td>네트워크 파티션, 노드 장애, 지연 등</td><td>- Lease 기반 락 (TTL)<br>- Raft/Paxos 기반 합의<br>- Quorum Locking</td></tr><tr><td></td><td>장애 발생 시 락 유실/고립</td><td>주 노드 사망, 연결 끊김 등</td><td>- 자동 만료 (TTL), 리스 재협상<br>- 장애 감지 및 Lock 재획득 로직</td></tr><tr><td></td><td>락 + 트랜잭션 연계 복잡성</td><td>락 상태와 트랜잭션 상태 간 일관성 유지 어려움</td><td>- Outbox + Distributed Lock<br>- 2PC or SAGA + Global Lock</td></tr><tr><td><strong>3. 실시간 예측성 문제</strong></td><td>우선순위 역전</td><td>낮은 우선순위 스레드가 락 보유 → 높은 우선순위 대기</td><td>- 우선순위 상속 (Priority Inheritance)<br>- 우선순위 천이 (Ceiling Protocol)</td></tr><tr><td></td><td>락 획득 시간의 비결정성</td><td>스케줄링, 락 경쟁 등으로 응답 시간 변동성 발생</td><td>- Time-bounded Lock<br>- Preemptive Scheduling<br>- 실시간 OS 락 프로토콜 사용</td></tr><tr><td></td><td>데드락에 의한 응답 시간 초과</td><td>락 순서 충돌 등으로 인한 순환 대기</td><td>- Lock Ordering Policy<br>- Deadlock Detection & Recovery</td></tr><tr><td><strong>4. 설계 및 디버깅 복잡성</strong></td><td>동기화 문제 디버깅 어려움</td><td>Race Condition, Deadlock 등은 재현/추적이 어려움</td><td>- Thread Sanitizer, Valgrind<br>- Dynamic Race Detection</td></tr><tr><td></td><td>락 그래프 구조 분석의 어려움</td><td>복잡한 락 획득 경로 간 순환 의존</td><td>- Lock Dependency Graph 시각화<br>- 정적 분석 도구 활용</td></tr><tr><td></td><td>복잡한 상태 전이로 인한 설계 오버헤드</td><td>상태 기반 동기화 로직 증가로 설계/검증 비용 상승</td><td>- 모델 기반 설계 (Model Checking)<br>- FSM 기반 상태 추적</td></tr></tbody></table><ul><li><p><strong>성능 문제</strong>는 주로 멀티코어 환경의 락 경합에서 발생하며, queue-based lock, local lock 전략, adaptive locking 기법으로 해결할 수 있다.</p></li><li><p><strong>분산 환경 문제</strong>는 네트워크 장애와 글로벌 일관성 유지가 주요 도전 과제이며, lease 기반 TTL, 분산 합의 알고리즘 (Raft/Paxos), 장애 복구 전략이 핵심이다.</p></li><li><p><strong>실시간 시스템 문제</strong>는 락으로 인해 시간 제약 조건을 위반할 수 있기 때문에, 우선순위 상속/천이, 시간 제한 락, 실시간 OS 락 프로토콜을 활용해야 한다.</p></li><li><p><strong>디버깅 및 설계 문제</strong>는 추적과 분석의 어려움이 있으며, 시각화 도구, 정적 분석, 모델 기반 설계를 통해 구조적 접근이 가능하다.</p></li></ul><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>락 유형</th><th>특징</th><th>사용 사례</th></tr></thead><tbody><tr><td><strong>대기 방식</strong></td><td>스핀락 (Spin Lock)</td><td>busy-wait, 낮은 지연, 높은 CPU 사용</td><td>짧은 임계 구역, 커널 내부</td></tr><tr><td></td><td>뮤텍스 (Mutex)</td><td>sleep 기반 블로킹, 낮은 CPU 사용</td><td>긴 임계 구역, 사용자 공간</td></tr><tr><td></td><td>하이브리드 락</td><td>일정 시간 spin 후 block</td><td>임계 구역 길이 불확실한 경우</td></tr><tr><td><strong>접근 권한</strong></td><td>배타적 락 (Exclusive Lock)</td><td>단일 스레드 접근 허용</td><td>쓰기 작업 위주 구조</td></tr><tr><td></td><td>공유 락 (Shared Lock)</td><td>다중 읽기 가능, 쓰기 불가</td><td>읽기 전용 다중 접근</td></tr><tr><td></td><td>읽기 - 쓰기 락 (Read-Write Lock)</td><td>읽기는 병렬, 쓰기는 배타</td><td>캐시 조회/업데이트 병행 시스템</td></tr><tr><td><strong>재진입성</strong></td><td>재진입 락 (Reentrant Lock)</td><td>동일 스레드가 중복 락 획득 가능</td><td>재귀 함수, 복합 로직 구조</td></tr><tr><td></td><td>비재진입 락</td><td>중복 획득 시 데드락 발생 가능</td><td>단일 단계 락 처리 구조</td></tr><tr><td><strong>공정성</strong></td><td>공정 락 (Fair Lock)</td><td>요청 순서대로 락 획득, FIFO 보장</td><td>응답 시간 보장 시스템</td></tr><tr><td></td><td>비공정 락</td><td>처리량 우선, 락 획득 순서 무관</td><td>Throughput 중시 서비스</td></tr><tr><td><strong>스코프</strong></td><td>프로세스 내 락</td><td>동일 프로세스 내 스레드 간 동기화</td><td>멀티스레드 서버</td></tr><tr><td></td><td>프로세스 간 락</td><td>공유 메모리 기반 락, OS 지원 필요</td><td>IPC 시스템, DBMS 내부 락</td></tr><tr><td></td><td>분산 락</td><td>네트워크 기반 락, 노드 간 동기화</td><td>Redis Redlock, ZK, etcd</td></tr><tr><td><strong>기타 모델</strong></td><td>세마포어 (Semaphore)</td><td>계수 기반, n 개 스레드까지 동시에 접근 허용</td><td>DB connection pool, 자원 제한</td></tr><tr><td></td><td>Counting Lock</td><td>세마포어 유사, 자원 개수 기준</td><td>쓰레드 풀, 리밋 제어</td></tr><tr><td></td><td>비관적 락 (Pessimistic Lock)</td><td>접근 시 항상 락 획득, 충돌 방지 중시</td><td>DB 트랜잭션, 충돌 가능성 높은 환경</td></tr><tr><td></td><td>낙관적 락 (Optimistic Lock)</td><td>변경 감지 후 커밋, 충돌 발생 시 롤백</td><td>CAS 기반 구조, 낮은 충돌 확률 환경</td></tr></tbody></table><p><strong>대기 방식에 따른 분류</strong>에서는 CPU 자원을 어떻게 소모하며 락을 대기하는지가 기준이다. Spin Lock 은 낮은 지연이 필요할 때 적합하고, Mutex 는 CPU 효율성이 중요할 때 사용된다. 하이브리드 락은 두 방식의 장점을 절충한다.</p><p><strong>접근 권한 기준</strong>은 다중 읽기/쓰기 환경을 어떻게 제어할지 결정한다. Shared Lock 은 읽기 중심 워크로드에 유리하고, Exclusive Lock 은 쓰기 일관성이 중요할 때 필요하며, Read-Write Lock 은 두 가지의 균형을 잡는다.</p><p><strong>재진입성 기준</strong>은 락을 획득한 스레드가 다시 락을 요청할 수 있는지를 판단한다. 재진입 락은 재귀 호출이나 내부 중첩된 로직에 유용하지만, 단순 구조에서는 비재진입 락이 더 안전하다.</p><p><strong>공정성 기준</strong>은 락 획득 순서의 예측 가능성과 관련 있다. 공정 락은 Starvation 을 방지하지만, 시스템 전체 처리량이 감소할 수 있다. 반대로 비공정 락은 효율이 높지만 응답 시간 보장이 어렵다.</p><p><strong>스코프 기준</strong>은 락이 적용되는 실행 단위 범위를 구분한다. 동일 프로세스 내 락은 일반 멀티스레드 환경에서, 프로세스 간 락은 IPC 나 DB 내부 락으로, 분산 락은 MSA 나 분산 환경에서 사용된다.</p><p><strong>기타 동기화 모델</strong>은 동시 접근 수 제한 (Semaphore, Counting Lock) 이나 트랜잭션 충돌 가능성에 따라 낙관적/비관적 락 전략을 적용하는 방식이다. 이는 데이터 일관성과 성능 트레이드오프를 제어하는 데 사용된다.</p><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>카테고리</th><th>사용 시스템</th><th>목적</th><th>함께 사용되는 기술</th><th>효과</th></tr></thead><tbody><tr><td><strong>웹 및 애플리케이션 서버</strong></td><td>Nginx, Apache, Flask, Spring 등</td><td>요청 큐 및 커넥션 풀 보호</td><td>Thread Pool, Semaphore</td><td>race-free 요청 처리</td></tr><tr><td></td><td>API Gateway, WSGI 서버</td><td>공유 설정 보호, 중복 요청 방지</td><td>Lock Decorator, Redis Lock</td><td>설정 충돌 방지</td></tr><tr><td><strong>데이터베이스/캐시 시스템</strong></td><td>MySQL, PostgreSQL</td><td>트랜잭션 동시성 제어, 무결성 유지</td><td>MVCC, Row Lock, WAL</td><td>ACID 보장</td></tr><tr><td></td><td>Redis, Memcached</td><td>캐시 충돌 방지, 작업 중복 방지</td><td>Distributed Lock (Redlock)</td><td>캐시 일관성 유지</td></tr><tr><td><strong>파일/운영체제 리소스</strong></td><td>Linux FS, log rotation, etc.</td><td>파일 접근 동기화, 메타데이터 보호</td><td>flock, File Lock, I/O Scheduler</td><td>파일 무결성 유지</td></tr><tr><td></td><td>Linux Kernel</td><td>메모리/IO/Interrupt 처리 보호</td><td>Spinlock, RCU</td><td>커널 안정성</td></tr><tr><td><strong>분산 시스템/클러스터</strong></td><td>etcd, ZooKeeper, Consul</td><td>리더 선출, 분산 락 관리</td><td>Paxos, Raft, Lease Lock</td><td>클러스터 안정성 확보</td></tr><tr><td></td><td>Kubernetes Controller</td><td>리소스 컨트롤러 동시 실행 방지</td><td>Lease API, Leader Election</td><td>중복 제어 방지</td></tr><tr><td><strong>메시지 큐 및 비동기 시스템</strong></td><td>RabbitMQ, Kafka, Celery</td><td>큐 상태 동기화, 순서 보장</td><td>Ack/Nack, Visibility Timeout</td><td>메시지 유실 방지</td></tr><tr><td><strong>게임/실시간 시스템</strong></td><td>Unreal, Unity, FPS 서버 등</td><td>게임 상태 일관성 유지, 동기화 렌더링</td><td>RWLock, Pipeline Lock</td><td>멀티 플레이 정합성 유지</td></tr><tr><td><strong>CI/CD 및 배포 자동화</strong></td><td>Git, Helm, Jenkins, ArgoCD 등</td><td>동시에 실행되는 배포/릴리즈 충돌 방지</td><td>Git Lockfile, Helm Release Lock</td><td>릴리즈 무결성</td></tr><tr><td><strong>로그 수집기/모니터링 에이전트</strong></td><td>Filebeat, Fluentd, Promtail 등</td><td>로그 파일 동시 접근 방지</td><td>File Lock, Offset Locking</td><td>데이터 손실 방지</td></tr></tbody></table><ul><li><p><strong>웹/앱 서버</strong>에서는 Thread Pool 이나 설정 파일 등 공유 리소스를 보호하기 위해 락이 필수적으로 사용되며, race condition 과 중복 실행을 방지한다.</p></li><li><p><strong>데이터베이스 및 캐시 시스템</strong>은 동시 읽기/쓰기 상황에서의 데이터 정합성과 캐시 충돌을 방지하기 위해 락 또는 MVCC, 분산 락이 사용된다.</p></li><li><p><strong>운영체제 및 파일 시스템</strong>에서는 파일의 메타데이터 보호 및 I/O 병렬 처리의 안전성을 위해 락이 사용되며, flock 이나 Spinlock 등이 적용된다.</p></li><li><p><strong>분산 시스템 및 클러스터링</strong>은 리더 선출, 자원 경합 방지, failover 처리를 위해 Paxos/Raft 와 TTL 기반 Lease Lock 이 필수이다.</p></li><li><p><strong>메시지 큐 및 비동기 환경</strong>에서는 메시지 순서 보장과 작업의 중복 처리 방지를 위해 Ack/Nack, Lock-based Visibility Timeout 이 사용된다.</p></li><li><p><strong>실시간 시스템 및 게임 엔진</strong>은 상태 일관성과 시간 민감한 동기화를 위해 파이프라인 락, 리더 - 라이터 락 등 경량 동기화 방식이 주로 사용된다.</p></li><li><p><strong>CI/CD 및 로깅 시스템</strong>은 병렬 배포나 로그 파일 접근 충돌 방지를 위해 파일 락 또는 분산 락 기반 구조가 적용된다.</p></li></ul><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-멀티스레드-웹-서버에서-사용자-세션-캐시를-보호>사례 1: 멀티스레드 웹 서버에서 사용자 세션 캐시를 보호<a hidden class=anchor aria-hidden=true href=#사례-1-멀티스레드-웹-서버에서-사용자-세션-캐시를-보호>#</a></h4><p><strong>시나리오</strong>: 멀티스레드 웹 서버에서 사용자 세션 캐시를 보호하기 위해 락을 도입함.</p><p><strong>시스템 구성</strong>:</p><ul><li>ThreadPool 기반 요청 처리</li><li>공유 세션 캐시에 대한 mutex 보호</li><li>캐시 미스 시 DB 조회 후 세션 업데이트</li></ul><pre class=mermaid>graph TD
    A[Client Request] --&gt; B[ThreadPool]
    B --&gt; C{Session Cache Hit?}
    C --&gt;|Yes| D[Return Cached Data]
    C --&gt;|No| E[DB Read]
    E --&gt; F[Update Session Cache]
    F --&gt; G[Return Data]
    B --&gt;|Lock| H[Mutex Lock]
    G --&gt;|Unlock| H
</pre><p><strong>Workflow</strong>:</p><ol><li>요청 도착 → ThreadPool 할당</li><li>세션 캐시에 접근하기 위해 mutex lock</li><li>데이터 없으면 DB 읽기</li><li>세션 갱신 후 unlock</li></ol><p><strong>역할</strong>:</p><ul><li>mutex 는 임계 구역 내 공유 데이터 오염 방지</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>락 없음: race condition → session overwrite, stale read</li><li>락 있음: 일관성 보장, 성능은 lock 경합에 따라 영향</li></ul><p><strong>구현 예시 (Python)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>session_cache</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>cache_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_user_session</span><span class=p>(</span><span class=n>user_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>cache_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>user_id</span> <span class=ow>in</span> <span class=n>session_cache</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>session_cache</span><span class=p>[</span><span class=n>user_id</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 캐시 미스 처리 (락 해제 후 DB 접근)</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span> <span class=o>=</span> <span class=n>load_from_db</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>cache_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>session_cache</span><span class=p>[</span><span class=n>user_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>session</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>session</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-2-고성능-웹-서버의-연결-풀-관리-시스템>사례 2: 고성능 웹 서버의 연결 풀 관리 시스템<a hidden class=anchor aria-hidden=true href=#사례-2-고성능-웹-서버의-연결-풀-관리-시스템>#</a></h4><p><strong>시나리오</strong>: 고성능 웹 서버의 연결 풀 관리 시스템</p><p><strong>시스템 구성</strong>:</p><ul><li>웹 서버: Nginx/Apache 기반 HTTP 서버</li><li>애플리케이션 서버: Python/Node.js 기반 백엔드</li><li>데이터베이스: PostgreSQL/MySQL</li><li>연결 풀 관리자: 데이터베이스 연결 재사용 관리</li></ul><pre class=mermaid>graph TB
    subgraph &#34;Client Layer&#34;
        C1[Client 1]
        C2[Client 2]
        C3[Client N]
    end
    
    subgraph &#34;Web Server Layer&#34;
        WS[Web Server&lt;br/&gt;Load Balancer]
    end
    
    subgraph &#34;Application Server Layer&#34;
        AS1[App Server 1]
        AS2[App Server 2]
        AS3[App Server N]
    end
    
    subgraph &#34;Connection Pool Layer&#34;
        CP[Connection Pool Manager]
        L[Lock Mechanism]
        PQ[Pool Queue]
    end
    
    subgraph &#34;Database Layer&#34;
        DB[(Database)]
    end
    
    C1 --&gt; WS
    C2 --&gt; WS
    C3 --&gt; WS
    WS --&gt; AS1
    WS --&gt; AS2
    WS --&gt; AS3
    AS1 --&gt; CP
    AS2 --&gt; CP
    AS3 --&gt; CP
    CP --&gt; L
    CP --&gt; PQ
    L --&gt; PQ
    CP --&gt; DB
</pre><p><strong>Workflow</strong>:</p><ol><li>클라이언트 요청이 웹 서버를 통해 애플리케이션 서버로 전달</li><li>애플리케이션 서버가 데이터베이스 연결이 필요한 요청 처리 시작</li><li>연결 풀 매니저에게 사용 가능한 연결 요청</li><li>Lock 을 통해 연결 풀 상태를 보호하며 연결 할당</li><li>작업 완료 후 연결을 다시 풀로 반환</li><li>Lock 해제 후 대기 중인 다른 요청에 연결 할당</li></ol><p><strong>역할</strong>:</p><ul><li><strong>Lock</strong>: 연결 풀의 동시 접근 제어 및 일관성 보장</li><li><strong>Connection Pool</strong>: 데이터베이스 연결 재사용으로 성능 최적화</li><li><strong>Queue</strong>: 연결 대기 중인 요청들의 순서 관리</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>Lock 있음</strong>: 안전한 연결 할당, 데이터 일관성 보장, 예측 가능한 동작</li><li><strong>Lock 없음</strong>: Race Condition 발생, 연결 중복 할당, 데이터베이스 오류 가능성</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1>  1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2>  2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3>  3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4>  4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5>  5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6>  6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7>  7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8>  8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9>  9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10> 10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11> 11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12> 12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13> 13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14> 14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15> 15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16> 16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17> 17</a>
</span><span class=lnt id=hl-29-18><a class=lnlinks href=#hl-29-18> 18</a>
</span><span class=lnt id=hl-29-19><a class=lnlinks href=#hl-29-19> 19</a>
</span><span class=lnt id=hl-29-20><a class=lnlinks href=#hl-29-20> 20</a>
</span><span class=lnt id=hl-29-21><a class=lnlinks href=#hl-29-21> 21</a>
</span><span class=lnt id=hl-29-22><a class=lnlinks href=#hl-29-22> 22</a>
</span><span class=lnt id=hl-29-23><a class=lnlinks href=#hl-29-23> 23</a>
</span><span class=lnt id=hl-29-24><a class=lnlinks href=#hl-29-24> 24</a>
</span><span class=lnt id=hl-29-25><a class=lnlinks href=#hl-29-25> 25</a>
</span><span class=lnt id=hl-29-26><a class=lnlinks href=#hl-29-26> 26</a>
</span><span class=lnt id=hl-29-27><a class=lnlinks href=#hl-29-27> 27</a>
</span><span class=lnt id=hl-29-28><a class=lnlinks href=#hl-29-28> 28</a>
</span><span class=lnt id=hl-29-29><a class=lnlinks href=#hl-29-29> 29</a>
</span><span class=lnt id=hl-29-30><a class=lnlinks href=#hl-29-30> 30</a>
</span><span class=lnt id=hl-29-31><a class=lnlinks href=#hl-29-31> 31</a>
</span><span class=lnt id=hl-29-32><a class=lnlinks href=#hl-29-32> 32</a>
</span><span class=lnt id=hl-29-33><a class=lnlinks href=#hl-29-33> 33</a>
</span><span class=lnt id=hl-29-34><a class=lnlinks href=#hl-29-34> 34</a>
</span><span class=lnt id=hl-29-35><a class=lnlinks href=#hl-29-35> 35</a>
</span><span class=lnt id=hl-29-36><a class=lnlinks href=#hl-29-36> 36</a>
</span><span class=lnt id=hl-29-37><a class=lnlinks href=#hl-29-37> 37</a>
</span><span class=lnt id=hl-29-38><a class=lnlinks href=#hl-29-38> 38</a>
</span><span class=lnt id=hl-29-39><a class=lnlinks href=#hl-29-39> 39</a>
</span><span class=lnt id=hl-29-40><a class=lnlinks href=#hl-29-40> 40</a>
</span><span class=lnt id=hl-29-41><a class=lnlinks href=#hl-29-41> 41</a>
</span><span class=lnt id=hl-29-42><a class=lnlinks href=#hl-29-42> 42</a>
</span><span class=lnt id=hl-29-43><a class=lnlinks href=#hl-29-43> 43</a>
</span><span class=lnt id=hl-29-44><a class=lnlinks href=#hl-29-44> 44</a>
</span><span class=lnt id=hl-29-45><a class=lnlinks href=#hl-29-45> 45</a>
</span><span class=lnt id=hl-29-46><a class=lnlinks href=#hl-29-46> 46</a>
</span><span class=lnt id=hl-29-47><a class=lnlinks href=#hl-29-47> 47</a>
</span><span class=lnt id=hl-29-48><a class=lnlinks href=#hl-29-48> 48</a>
</span><span class=lnt id=hl-29-49><a class=lnlinks href=#hl-29-49> 49</a>
</span><span class=lnt id=hl-29-50><a class=lnlinks href=#hl-29-50> 50</a>
</span><span class=lnt id=hl-29-51><a class=lnlinks href=#hl-29-51> 51</a>
</span><span class=lnt id=hl-29-52><a class=lnlinks href=#hl-29-52> 52</a>
</span><span class=lnt id=hl-29-53><a class=lnlinks href=#hl-29-53> 53</a>
</span><span class=lnt id=hl-29-54><a class=lnlinks href=#hl-29-54> 54</a>
</span><span class=lnt id=hl-29-55><a class=lnlinks href=#hl-29-55> 55</a>
</span><span class=lnt id=hl-29-56><a class=lnlinks href=#hl-29-56> 56</a>
</span><span class=lnt id=hl-29-57><a class=lnlinks href=#hl-29-57> 57</a>
</span><span class=lnt id=hl-29-58><a class=lnlinks href=#hl-29-58> 58</a>
</span><span class=lnt id=hl-29-59><a class=lnlinks href=#hl-29-59> 59</a>
</span><span class=lnt id=hl-29-60><a class=lnlinks href=#hl-29-60> 60</a>
</span><span class=lnt id=hl-29-61><a class=lnlinks href=#hl-29-61> 61</a>
</span><span class=lnt id=hl-29-62><a class=lnlinks href=#hl-29-62> 62</a>
</span><span class=lnt id=hl-29-63><a class=lnlinks href=#hl-29-63> 63</a>
</span><span class=lnt id=hl-29-64><a class=lnlinks href=#hl-29-64> 64</a>
</span><span class=lnt id=hl-29-65><a class=lnlinks href=#hl-29-65> 65</a>
</span><span class=lnt id=hl-29-66><a class=lnlinks href=#hl-29-66> 66</a>
</span><span class=lnt id=hl-29-67><a class=lnlinks href=#hl-29-67> 67</a>
</span><span class=lnt id=hl-29-68><a class=lnlinks href=#hl-29-68> 68</a>
</span><span class=lnt id=hl-29-69><a class=lnlinks href=#hl-29-69> 69</a>
</span><span class=lnt id=hl-29-70><a class=lnlinks href=#hl-29-70> 70</a>
</span><span class=lnt id=hl-29-71><a class=lnlinks href=#hl-29-71> 71</a>
</span><span class=lnt id=hl-29-72><a class=lnlinks href=#hl-29-72> 72</a>
</span><span class=lnt id=hl-29-73><a class=lnlinks href=#hl-29-73> 73</a>
</span><span class=lnt id=hl-29-74><a class=lnlinks href=#hl-29-74> 74</a>
</span><span class=lnt id=hl-29-75><a class=lnlinks href=#hl-29-75> 75</a>
</span><span class=lnt id=hl-29-76><a class=lnlinks href=#hl-29-76> 76</a>
</span><span class=lnt id=hl-29-77><a class=lnlinks href=#hl-29-77> 77</a>
</span><span class=lnt id=hl-29-78><a class=lnlinks href=#hl-29-78> 78</a>
</span><span class=lnt id=hl-29-79><a class=lnlinks href=#hl-29-79> 79</a>
</span><span class=lnt id=hl-29-80><a class=lnlinks href=#hl-29-80> 80</a>
</span><span class=lnt id=hl-29-81><a class=lnlinks href=#hl-29-81> 81</a>
</span><span class=lnt id=hl-29-82><a class=lnlinks href=#hl-29-82> 82</a>
</span><span class=lnt id=hl-29-83><a class=lnlinks href=#hl-29-83> 83</a>
</span><span class=lnt id=hl-29-84><a class=lnlinks href=#hl-29-84> 84</a>
</span><span class=lnt id=hl-29-85><a class=lnlinks href=#hl-29-85> 85</a>
</span><span class=lnt id=hl-29-86><a class=lnlinks href=#hl-29-86> 86</a>
</span><span class=lnt id=hl-29-87><a class=lnlinks href=#hl-29-87> 87</a>
</span><span class=lnt id=hl-29-88><a class=lnlinks href=#hl-29-88> 88</a>
</span><span class=lnt id=hl-29-89><a class=lnlinks href=#hl-29-89> 89</a>
</span><span class=lnt id=hl-29-90><a class=lnlinks href=#hl-29-90> 90</a>
</span><span class=lnt id=hl-29-91><a class=lnlinks href=#hl-29-91> 91</a>
</span><span class=lnt id=hl-29-92><a class=lnlinks href=#hl-29-92> 92</a>
</span><span class=lnt id=hl-29-93><a class=lnlinks href=#hl-29-93> 93</a>
</span><span class=lnt id=hl-29-94><a class=lnlinks href=#hl-29-94> 94</a>
</span><span class=lnt id=hl-29-95><a class=lnlinks href=#hl-29-95> 95</a>
</span><span class=lnt id=hl-29-96><a class=lnlinks href=#hl-29-96> 96</a>
</span><span class=lnt id=hl-29-97><a class=lnlinks href=#hl-29-97> 97</a>
</span><span class=lnt id=hl-29-98><a class=lnlinks href=#hl-29-98> 98</a>
</span><span class=lnt id=hl-29-99><a class=lnlinks href=#hl-29-99> 99</a>
</span><span class=lnt id=hl-29-100><a class=lnlinks href=#hl-29-100>100</a>
</span><span class=lnt id=hl-29-101><a class=lnlinks href=#hl-29-101>101</a>
</span><span class=lnt id=hl-29-102><a class=lnlinks href=#hl-29-102>102</a>
</span><span class=lnt id=hl-29-103><a class=lnlinks href=#hl-29-103>103</a>
</span><span class=lnt id=hl-29-104><a class=lnlinks href=#hl-29-104>104</a>
</span><span class=lnt id=hl-29-105><a class=lnlinks href=#hl-29-105>105</a>
</span><span class=lnt id=hl-29-106><a class=lnlinks href=#hl-29-106>106</a>
</span><span class=lnt id=hl-29-107><a class=lnlinks href=#hl-29-107>107</a>
</span><span class=lnt id=hl-29-108><a class=lnlinks href=#hl-29-108>108</a>
</span><span class=lnt id=hl-29-109><a class=lnlinks href=#hl-29-109>109</a>
</span><span class=lnt id=hl-29-110><a class=lnlinks href=#hl-29-110>110</a>
</span><span class=lnt id=hl-29-111><a class=lnlinks href=#hl-29-111>111</a>
</span><span class=lnt id=hl-29-112><a class=lnlinks href=#hl-29-112>112</a>
</span><span class=lnt id=hl-29-113><a class=lnlinks href=#hl-29-113>113</a>
</span><span class=lnt id=hl-29-114><a class=lnlinks href=#hl-29-114>114</a>
</span><span class=lnt id=hl-29-115><a class=lnlinks href=#hl-29-115>115</a>
</span><span class=lnt id=hl-29-116><a class=lnlinks href=#hl-29-116>116</a>
</span><span class=lnt id=hl-29-117><a class=lnlinks href=#hl-29-117>117</a>
</span><span class=lnt id=hl-29-118><a class=lnlinks href=#hl-29-118>118</a>
</span><span class=lnt id=hl-29-119><a class=lnlinks href=#hl-29-119>119</a>
</span><span class=lnt id=hl-29-120><a class=lnlinks href=#hl-29-120>120</a>
</span><span class=lnt id=hl-29-121><a class=lnlinks href=#hl-29-121>121</a>
</span><span class=lnt id=hl-29-122><a class=lnlinks href=#hl-29-122>122</a>
</span><span class=lnt id=hl-29-123><a class=lnlinks href=#hl-29-123>123</a>
</span><span class=lnt id=hl-29-124><a class=lnlinks href=#hl-29-124>124</a>
</span><span class=lnt id=hl-29-125><a class=lnlinks href=#hl-29-125>125</a>
</span><span class=lnt id=hl-29-126><a class=lnlinks href=#hl-29-126>126</a>
</span><span class=lnt id=hl-29-127><a class=lnlinks href=#hl-29-127>127</a>
</span><span class=lnt id=hl-29-128><a class=lnlinks href=#hl-29-128>128</a>
</span><span class=lnt id=hl-29-129><a class=lnlinks href=#hl-29-129>129</a>
</span><span class=lnt id=hl-29-130><a class=lnlinks href=#hl-29-130>130</a>
</span><span class=lnt id=hl-29-131><a class=lnlinks href=#hl-29-131>131</a>
</span><span class=lnt id=hl-29-132><a class=lnlinks href=#hl-29-132>132</a>
</span><span class=lnt id=hl-29-133><a class=lnlinks href=#hl-29-133>133</a>
</span><span class=lnt id=hl-29-134><a class=lnlinks href=#hl-29-134>134</a>
</span><span class=lnt id=hl-29-135><a class=lnlinks href=#hl-29-135>135</a>
</span><span class=lnt id=hl-29-136><a class=lnlinks href=#hl-29-136>136</a>
</span><span class=lnt id=hl-29-137><a class=lnlinks href=#hl-29-137>137</a>
</span><span class=lnt id=hl-29-138><a class=lnlinks href=#hl-29-138>138</a>
</span><span class=lnt id=hl-29-139><a class=lnlinks href=#hl-29-139>139</a>
</span><span class=lnt id=hl-29-140><a class=lnlinks href=#hl-29-140>140</a>
</span><span class=lnt id=hl-29-141><a class=lnlinks href=#hl-29-141>141</a>
</span><span class=lnt id=hl-29-142><a class=lnlinks href=#hl-29-142>142</a>
</span><span class=lnt id=hl-29-143><a class=lnlinks href=#hl-29-143>143</a>
</span><span class=lnt id=hl-29-144><a class=lnlinks href=#hl-29-144>144</a>
</span><span class=lnt id=hl-29-145><a class=lnlinks href=#hl-29-145>145</a>
</span><span class=lnt id=hl-29-146><a class=lnlinks href=#hl-29-146>146</a>
</span><span class=lnt id=hl-29-147><a class=lnlinks href=#hl-29-147>147</a>
</span><span class=lnt id=hl-29-148><a class=lnlinks href=#hl-29-148>148</a>
</span><span class=lnt id=hl-29-149><a class=lnlinks href=#hl-29-149>149</a>
</span><span class=lnt id=hl-29-150><a class=lnlinks href=#hl-29-150>150</a>
</span><span class=lnt id=hl-29-151><a class=lnlinks href=#hl-29-151>151</a>
</span><span class=lnt id=hl-29-152><a class=lnlinks href=#hl-29-152>152</a>
</span><span class=lnt id=hl-29-153><a class=lnlinks href=#hl-29-153>153</a>
</span><span class=lnt id=hl-29-154><a class=lnlinks href=#hl-29-154>154</a>
</span><span class=lnt id=hl-29-155><a class=lnlinks href=#hl-29-155>155</a>
</span><span class=lnt id=hl-29-156><a class=lnlinks href=#hl-29-156>156</a>
</span><span class=lnt id=hl-29-157><a class=lnlinks href=#hl-29-157>157</a>
</span><span class=lnt id=hl-29-158><a class=lnlinks href=#hl-29-158>158</a>
</span><span class=lnt id=hl-29-159><a class=lnlinks href=#hl-29-159>159</a>
</span><span class=lnt id=hl-29-160><a class=lnlinks href=#hl-29-160>160</a>
</span><span class=lnt id=hl-29-161><a class=lnlinks href=#hl-29-161>161</a>
</span><span class=lnt id=hl-29-162><a class=lnlinks href=#hl-29-162>162</a>
</span><span class=lnt id=hl-29-163><a class=lnlinks href=#hl-29-163>163</a>
</span><span class=lnt id=hl-29-164><a class=lnlinks href=#hl-29-164>164</a>
</span><span class=lnt id=hl-29-165><a class=lnlinks href=#hl-29-165>165</a>
</span><span class=lnt id=hl-29-166><a class=lnlinks href=#hl-29-166>166</a>
</span><span class=lnt id=hl-29-167><a class=lnlinks href=#hl-29-167>167</a>
</span><span class=lnt id=hl-29-168><a class=lnlinks href=#hl-29-168>168</a>
</span><span class=lnt id=hl-29-169><a class=lnlinks href=#hl-29-169>169</a>
</span><span class=lnt id=hl-29-170><a class=lnlinks href=#hl-29-170>170</a>
</span><span class=lnt id=hl-29-171><a class=lnlinks href=#hl-29-171>171</a>
</span><span class=lnt id=hl-29-172><a class=lnlinks href=#hl-29-172>172</a>
</span><span class=lnt id=hl-29-173><a class=lnlinks href=#hl-29-173>173</a>
</span><span class=lnt id=hl-29-174><a class=lnlinks href=#hl-29-174>174</a>
</span><span class=lnt id=hl-29-175><a class=lnlinks href=#hl-29-175>175</a>
</span><span class=lnt id=hl-29-176><a class=lnlinks href=#hl-29-176>176</a>
</span><span class=lnt id=hl-29-177><a class=lnlinks href=#hl-29-177>177</a>
</span><span class=lnt id=hl-29-178><a class=lnlinks href=#hl-29-178>178</a>
</span><span class=lnt id=hl-29-179><a class=lnlinks href=#hl-29-179>179</a>
</span><span class=lnt id=hl-29-180><a class=lnlinks href=#hl-29-180>180</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>queue</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DatabaseConnection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;데이터베이스 연결을 시뮬레이션하는 클래스&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection_id</span> <span class=o>=</span> <span class=n>connection_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_active</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>execute_query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_active</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Connection </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>connection_id</span><span class=si>}</span><span class=s2> executing: </span><span class=si>{</span><span class=n>query</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 쿼리 실행 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Result from connection </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>connection_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_active</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;DBConnection(</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>connection_id</span><span class=si>}</span><span class=s2>)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ThreadSafeConnectionPool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;스레드 안전한 연결 풀 구현&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>pool_size</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Lock을 통한 동시성 제어</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>  <span class=c1># 재진입 가능한 Lock 사용</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_condition</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 연결 풀 초기화</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span> <span class=o>=</span> <span class=n>queue</span><span class=o>.</span><span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_active_connections</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 풀 통계</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_total_requests</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_active_requests</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_max_active</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 연결 생성</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>pool_size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span> <span class=o>=</span> <span class=n>DatabaseConnection</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;conn_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Connection pool initialized with </span><span class=si>{</span><span class=n>pool_size</span><span class=si>}</span><span class=s2> connections&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        컨텍스트 매니저를 통한 안전한 연결 획득/반환
</span></span></span><span class=line><span class=cl><span class=s2>        Lock을 사용하여 스레드 안전성 보장
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>connection</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Lock 획득 및 연결 할당</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_total_requests</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 사용 가능한 연결이 있을 때까지 대기</span>
</span></span><span class=line><span class=cl>                <span class=k>while</span> <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>empty</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                    <span class=n>elapsed</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>elapsed</span> <span class=o>&gt;=</span> <span class=n>timeout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>raise</span> <span class=ne>TimeoutError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Connection timeout after </span><span class=si>{</span><span class=n>timeout</span><span class=si>}</span><span class=s2>s&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread </span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> waiting for connection…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_condition</span><span class=o>.</span><span class=n>wait</span><span class=p>(</span><span class=n>timeout</span> <span class=o>-</span> <span class=n>elapsed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 연결 획득</span>
</span></span><span class=line><span class=cl>                <span class=n>connection</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_active_connections</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_active_requests</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_max_active</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_max_active</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_active_requests</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread </span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> acquired </span><span class=si>{</span><span class=n>connection</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Critical Section: 연결 사용</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>connection</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 연결 반환 (예외 발생 시에도 실행됨)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_active_connections</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_active_requests</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread </span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> returned </span><span class=si>{</span><span class=n>connection</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># 대기 중인 스레드들에게 알림</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_condition</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_statistics</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;풀 사용 통계 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;total_connections&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;available_connections&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>qsize</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;active_connections&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_active_connections</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;total_requests&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_total_requests</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;max_concurrent_active&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_max_active</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 웹 서버 요청 시뮬레이션</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>simulate_web_request</span><span class=p>(</span><span class=n>pool</span><span class=p>,</span> <span class=n>request_id</span><span class=p>,</span> <span class=n>queries</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;웹 요청을 시뮬레이션하는 워커 함수&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>thread_name</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 연결 풀에서 연결 획득 (Lock으로 보호됨)</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>pool</span><span class=o>.</span><span class=n>get_connection</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span> <span class=k>as</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Request </span><span class=si>{</span><span class=n>request_id</span><span class=si>}</span><span class=s2> started by </span><span class=si>{</span><span class=n>thread_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 여러 쿼리 실행</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>query</span> <span class=ow>in</span> <span class=n>queries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>execute_query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Request </span><span class=si>{</span><span class=n>request_id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 쿼리 간 처리 시간</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.05</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Request </span><span class=si>{</span><span class=n>request_id</span><span class=si>}</span><span class=s2> completed successfully&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>TimeoutError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Request </span><span class=si>{</span><span class=n>request_id</span><span class=si>}</span><span class=s2> failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Request </span><span class=si>{</span><span class=n>request_id</span><span class=si>}</span><span class=s2> error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>demonstrate_connection_pool</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;연결 풀 데모 실행&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 작은 풀 크기로 경합 상황 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=n>pool</span> <span class=o>=</span> <span class=n>ThreadSafeConnectionPool</span><span class=p>(</span><span class=n>pool_size</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 다양한 웹 요청 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=n>requests</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;SELECT * FROM users&#34;</span><span class=p>,</span> <span class=s2>&#34;UPDATE user_stats SET last_login=NOW()&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;SELECT * FROM products WHERE category=&#39;electronics&#39;&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;INSERT INTO orders (user_id, total) VALUES (123, 99.99)&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;SELECT COUNT(*) FROM orders WHERE status=&#39;pending&#39;&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;DELETE FROM temp_sessions WHERE created &lt; NOW() - INTERVAL 1 HOUR&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;SELECT * FROM user_preferences WHERE user_id=456&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>7</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;UPDATE inventory SET quantity=quantity-1 WHERE product_id=789&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 동시 요청 처리를 위한 스레드 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>threads</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>request_id</span><span class=p>,</span> <span class=n>queries</span> <span class=ow>in</span> <span class=n>requests</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>target</span><span class=o>=</span><span class=n>simulate_web_request</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>pool</span><span class=p>,</span> <span class=n>request_id</span><span class=p>,</span> <span class=n>queries</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>name</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;Worker-</span><span class=si>{</span><span class=n>request_id</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>thread</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Starting concurrent web requests simulation…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 모든 요청 스레드 시작</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>thread</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 약간의 시작 지연으로 경합 상황 생성</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 모든 요청 완료 대기</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>thread</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;All requests completed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 최종 통계 출력</span>
</span></span><span class=line><span class=cl>    <span class=n>stats</span> <span class=o>=</span> <span class=n>pool</span><span class=o>.</span><span class=n>get_statistics</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Connection Pool Statistics:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>stats</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>demonstrate_connection_pool</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-3-대규모-웹-서버에서-redis-분산락-distributed-lock-을-적용>사례 3: 대규모 웹 서버에서 Redis 분산락 (Distributed Lock) 을 적용<a hidden class=anchor aria-hidden=true href=#사례-3-대규모-웹-서버에서-redis-분산락-distributed-lock-을-적용>#</a></h4><p><strong>시나리오</strong>: 대규모 웹 서버에서 Redis 분산락 (Distributed Lock) 을 적용하여 작업 중복 (Cron Job 동시실행 등) 방지</p><p><strong>시스템 구성</strong>:</p><ul><li>여러 웹 서버 인스턴스 (다중 노드)</li><li>중앙 Redis 서버 (분산 락 관리)</li><li>Cron Job 실행 주기가 동일한 여러 애플리케이션</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    WebServer1((Web Server 1))
    WebServer2((Web Server 2))
    WebServer3((Web Server 3))
    Redis[[&#34;Redis(분산 락)&#34;]]
    WebServer1 --&gt;|락 요청| Redis
    WebServer2 --&gt;|락 요청| Redis
    WebServer3 --&gt;|락 요청| Redis
    Redis --&gt;|락 점유 허가| WebServer2
</pre><p><strong>Workflow</strong>:</p><ul><li>각 노드는 Cron Job 준비 시 Redis 에 락 점유 요청</li><li>한 노드만 락 점유 가능 (선착순)</li><li>락 점유 노드만 Job 실행, 완료 후 락 해제</li><li>나머지 노드는 다음 실행 때 재시도</li></ul><p><strong>역할</strong>:</p><ul><li>Redis: 분산 환경에서 Lock 상태 유지 및 동기화</li><li>Web Servers: 락을 획득한 서버만 작업 실행</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>락 없을 때: 여러 노드에서 동일 작업 중복 발생, 데이터 불일치, 외부 시스템 과부하</li><li>락 있을 때: 오직 1 건만 단일 시간에 실행, 일관성/신뢰성 보장</li></ul><p><strong>구현 예시 (파이썬, redis-py 사용)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10>10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11>11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12>12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13>13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14>14</a>
</span><span class=lnt id=hl-31-15><a class=lnlinks href=#hl-31-15>15</a>
</span><span class=lnt id=hl-31-16><a class=lnlinks href=#hl-31-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;redis-server&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>lock</span><span class=p>(</span><span class=s1>&#39;cron_job_lock&#39;</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>blocking</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 단일 노드만 이 블록 실행!</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Job started&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 작업 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Lock held by another node. Skipping job.&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-4-마이크로서비스에서-매시간-실행되는-백그라운드-크론-잡>사례 4: 마이크로서비스에서 매시간 실행되는 백그라운드 크론 잡<a hidden class=anchor aria-hidden=true href=#사례-4-마이크로서비스에서-매시간-실행되는-백그라운드-크론-잡>#</a></h4><p><strong>시나리오</strong>: AWS ECS 기반 마이크로서비스에서 매시간 실행되는 백그라운드 크론 잡이 있는데, 여러 인스턴스가 띄워져 있는 상황에서 <strong>단일 실행 보장</strong>을 위해 분산 락이 필요.</p><p><strong>시스템 구성</strong>:</p><ul><li>ECS Fargate 에서 Task 가 실행됨</li><li>락은 Redis 기반 Redlock 으로 구현</li><li>ElastiCache Redis 인스턴스를 사용</li><li>CloudWatch Event → Lambda → ECS Task 실행</li></ul><pre class=mermaid>sequenceDiagram
    participant CW as CloudWatch Event
    participant L as Lambda Trigger
    participant ECS as ECS Fargate Task
    participant R as ElastiCache Redis Cluster

    CW-&gt;&gt;L: 매시간 트리거
    L-&gt;&gt;ECS: Task 실행
    ECS-&gt;&gt;R: Redlock 시도
    alt 락 성공
        ECS-&gt;&gt;ECS: 작업 수행
        ECS-&gt;&gt;R: 락 해제
    else 락 실패
        ECS-&gt;&gt;ECS: 종료
    end
</pre><hr><p><strong>Workflow</strong>:</p><ol><li>CloudWatch 가 1 시간마다 Lambda 를 호출</li><li>Lambda 는 ECS Task 를 트리거</li><li>ECS 내부에서는 Redis 에 <code>SET lock:job NX PX 300000</code> 요청</li><li>락 획득 시 Job 수행, 아니면 바로 종료</li><li>TTL 또는 수동 해제를 통해 락 소멸</li></ol><p><strong>역할</strong>:</p><ul><li>Redis Redlock 은 분산 환경에서의 <strong>중복 실행 방지</strong></li><li>CloudWatch 는 <strong>트리거</strong>, Lambda 는 <strong>실행 중재</strong></li><li>ECS 는 <strong>잡 수행자</strong>, 락 상태에 따라 작업 여부 결정</li></ul><p><strong>유무에 따른 차이점</strong>:</p><table><thead><tr><th>조건</th><th>결과</th></tr></thead><tbody><tr><td>락 없음</td><td>동시에 여러 ECS 인스턴스가 Job 실행 → 중복/충돌 발생</td></tr><tr><td>락 있음</td><td>오직 한 인스턴스만 Job 수행 → 일관된 상태 유지</td></tr></tbody></table><p><strong>구현 예시</strong>: Python + Redis Redlock</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15>15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16>16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17>17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18>18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redlock</span> <span class=kn>import</span> <span class=n>Redlock</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dlm</span> <span class=o>=</span> <span class=n>Redlock</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;redis1.example.com&#34;</span><span class=p>,</span> <span class=s2>&#34;port&#34;</span><span class=p>:</span> <span class=mi>6379</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;redis2.example.com&#34;</span><span class=p>,</span> <span class=s2>&#34;port&#34;</span><span class=p>:</span> <span class=mi>6379</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;redis3.example.com&#34;</span><span class=p>,</span> <span class=s2>&#34;port&#34;</span><span class=p>:</span> <span class=mi>6379</span><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>dlm</span><span class=o>.</span><span class=n>lock</span><span class=p>(</span><span class=s2>&#34;distributed:cron:lock&#34;</span><span class=p>,</span> <span class=mi>10000</span><span class=p>)</span>  <span class=c1># 10초 TTL</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Lock acquired, running job…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>run_hourly_job</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>dlm</span><span class=o>.</span><span class=n>unlock</span><span class=p>(</span><span class=n>lock</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Another instance is running. Exiting.&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td>설계 원칙</td><td>임계 구역 최소화</td><td>락이 적용되는 코드 영역 최소화, 긴 연산은 락 밖에서 수행</td><td>세분화된 락 구조 적용</td></tr><tr><td></td><td>락 획득 순서 일관성</td><td>여러 락을 사용하는 경우 항상 고정된 순서로 획득하여 데드락 방지</td><td>락 계층 정의, 순서 정책 적용</td></tr><tr><td></td><td>적절한 락 유형 선택</td><td>워크로드 특성 (읽기/쓰기 비율, 충돌 빈도) 에 따라 락 종류를 선택</td><td>RWLock, SpinLock, Semaphore 등 고려</td></tr><tr><td>운영 안정성</td><td>예외 안전성 보장</td><td>예외 발생 시에도 락이 반드시 해제되도록 보장</td><td>try-finally, RAII, context 사용</td></tr><tr><td></td><td>대기 제한 설정</td><td>무한 대기 방지를 위한 타임아웃 값 지정</td><td>timeout 인자 설정, fallback 처리</td></tr><tr><td></td><td>공정성 확보</td><td>Starvation 방지를 위해 공정한 락 구현 적용 (FIFO 등)</td><td>공정 락 또는 큐 기반 락 도입</td></tr><tr><td>성능 및 모니터링</td><td>성능 분석 및 병목 진단</td><td>락 경합도, 대기 시간, 락 획득 시간 등 정기 모니터링</td><td>contention 로그, wait time 트레이싱</td></tr><tr><td></td><td>락 보유 시간 측정 및 제한</td><td>장시간 락 보유 스레드 식별 및 해제 방지</td><td>락 hold time 기록, 임계 구역 타이머</td></tr><tr><td>테스트 및 품질 검증</td><td>동시성 테스트 및 검증 전략</td><td>동시성 이슈는 재현이 어려우므로 테스트 체계 강화</td><td>스트레스 테스트, TSan, 코드 리뷰 등</td></tr></tbody></table><p><strong>설계 원칙</strong>은 락을 어디에, 어떻게 적용할지 결정하는 기준이다. 임계 구역을 최소화하고, 락 획득 순서를 일관되게 유지하며, 작업 특성에 맞는 락을 선택하는 것이 중요하다. 이는 데드락 예방과 성능 최적화에 직결된다.</p><p><strong>운영 안정성</strong>은 락 해제가 누락되지 않고, 예외 상황에도 일관성이 유지되며, 지나치게 긴 대기나 기아 상태가 발생하지 않도록 보장하는 데 초점을 맞춘다. 타임아웃과 공정성 메커니즘은 이를 위한 핵심 수단이다.</p><p><strong>성능 및 모니터링</strong>은 락 경합이나 병목을 실시간으로 파악하고, 시스템 부하를 진단해 지속적인 최적화를 가능하게 한다. 락 보유 시간 추적, 대기 시간 로그 분석 등의 기법이 효과적이다.</p><p><strong>테스트 및 품질 검증</strong>은 락 기반 시스템의 동시성 버그를 사전에 식별하기 위해 필수적이다. 스트레스 테스트, TSan, 시뮬레이션 기반 검증 전략은 동기화 이슈를 조기에 발견하는 데 유리하다.</p><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td><strong>1. 구조적 설계 최적화</strong></td><td>Lock Granularity</td><td>세밀한 락은 병렬성 ↑, 과도하면 복잡도 증가</td><td>데이터 구조별 락 분리, 독립성 유지</td></tr><tr><td></td><td>Lock Striping</td><td>해시 기반 락 분할로 경합 분산</td><td>해시 슬롯 별 락 배열 구성</td></tr><tr><td></td><td>Read-Write Lock 분리</td><td>읽기 작업 병렬성 향상</td><td>Reader-Writer Lock 적용</td></tr><tr><td><strong>2. 운영 환경 기반 최적화</strong></td><td>NUMA 인식 구조</td><td>메모리 지역성 고려</td><td>락과 데이터를 같은 노드에 배치</td></tr><tr><td></td><td>캐시 최적화</td><td>False Sharing 제거</td><td>변수 패딩, 라인 정렬 적용</td></tr><tr><td><strong>3. 성능 향상 전략</strong></td><td>Hybrid Lock</td><td>상황에 따라 spin ↔ block 전환</td><td>시간 기반 또는 경합 기반 전환 전략</td></tr><tr><td></td><td>백오프 전략</td><td>스핀 시 CPU 낭비 방지</td><td>Exponential Backoff, yield 사용</td></tr><tr><td></td><td>Lock-Free 대안</td><td>병목 최소화</td><td>CAS 기반 자료구조 활용</td></tr><tr><td><strong>4. 공정성 및 안정성 확보</strong></td><td>공정성 보장</td><td>starvation 방지</td><td>FIFO 락, fair mode 사용</td></tr><tr><td></td><td>우선순위 역전 대응</td><td>실시간 환경 대응</td><td>Priority Inheritance 적용</td></tr><tr><td><strong>5. 관찰성 및 디버깅 강화</strong></td><td>Lock Contention 모니터링</td><td>병목 탐지</td><td>wait time, lock hold metrics 수집</td></tr><tr><td></td><td>디버깅 도구 활용</td><td>재현 어려운 오류 추적</td><td>perf, eBPF, thread dump 등 활용</td></tr></tbody></table><ul><li><p><strong>구조적 설계 최적화</strong>는 락의 범위와 구조를 세분화하여 병렬성을 높이고, 경합을 줄이기 위한 전략이다. 대표적으로 Lock Striping 과 Reader-Writer Lock 분리 방식이 있다.</p></li><li><p><strong>운영 환경 기반 최적화</strong>는 NUMA 시스템에서의 메모리 로컬리티, 캐시라인 충돌을 줄이기 위한 구조 설계로, 성능 병목을 방지한다.</p></li><li><p><strong>성능 향상 전략</strong>은 Hybrid Lock 또는 Spin + Backoff 구조를 통해 락 대기 비용을 줄이고 효율을 높이며, 필요 시 무잠금 구조로 전환하는 것도 고려 대상이다.</p></li><li><p><strong>공정성 및 안정성 확보</strong>는 락 경합에서 우선순위 역전이나 starvation 방지 등 공정성 있는 자원 분배를 보장하기 위한 전략이다.</p></li><li><p><strong>관찰성과 디버깅 강화</strong>는 락 관련 병목 및 오류를 실시간으로 모니터링하고, 문제를 빠르게 재현하고 분석할 수 있는 메커니즘이 포함된다.</p></li></ul><hr><h2 id=정리-및-학습-가이드>정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#정리-및-학습-가이드>#</a></h2><h3 id=내용-정리>내용 정리<a hidden class=anchor aria-hidden=true href=#내용-정리>#</a></h3><p><strong>Lock</strong>은 동시성 제어를 위한 가장 기본적이고 핵심적인 **동기화 기법 (Synchronization Primitive)**이다. 다수의 실행 흐름 (스레드 또는 프로세스) 이 <strong>공유 자원에 동시 접근</strong>하지 못하도록 제어함으로써 <strong>데이터 정합성과 시스템 안정성</strong>을 보장한다.</p><h4 id=기술-발전의-흐름>기술 발전의 흐름<a hidden class=anchor aria-hidden=true href=#기술-발전의-흐름>#</a></h4><table><thead><tr><th>발전 단계</th><th>주요 기술 요소</th></tr></thead><tbody><tr><td>초기</td><td><code>disable interrupt</code> 기반 동기화 (단일 CPU 한정)</td></tr><tr><td>고급 연산</td><td><code>Test-and-Set</code>, <code>Compare-and-Swap (CAS)</code>, <code>LL/SC</code></td></tr><tr><td>커널 연동</td><td><code>Futex (Fast Userspace Mutex)</code>: 유저 공간 + 커널 연동</td></tr><tr><td>하드웨어</td><td>하드웨어 트랜잭셔널 메모리 (HTM), NUMA-aware Lock</td></tr><tr><td>최신 트렌드</td><td>ML 기반 Adaptive Lock, Lock-Free/Wait-Free 알고리즘, Lease 기반 동기화, 불변 자료구조를 통한 락 제거 시도</td></tr></tbody></table><h4 id=대표적인-lock-유형>대표적인 Lock 유형<a hidden class=anchor aria-hidden=true href=#대표적인-lock-유형>#</a></h4><ul><li><strong>Mutex</strong>: 단일 스레드만 접근 가능한 상호 배제 락</li><li><strong>Spinlock</strong>: 락을 얻을 때까지 CPU 에서 바쁘게 대기</li><li><strong>Read-Write Lock</strong>: 다수 읽기 / 단일 쓰기 구조 지원</li><li><strong>Recursive Lock</strong>: 동일 스레드 중첩 획득 허용</li><li><strong>Semaphore</strong>: 접근 허용 횟수 제한</li><li><strong>Condition Variable</strong>: 조건 만족 시까지 대기/신호</li><li><strong>Timeout Lock / Fair Lock</strong>: 획득 실패 시 예외 처리 / 순서 보장</li></ul><h4 id=분산-환경에서의-확장>분산 환경에서의 확장<a hidden class=anchor aria-hidden=true href=#분산-환경에서의-확장>#</a></h4><table><thead><tr><th>전략</th><th>설명</th></tr></thead><tbody><tr><td><strong>Distributed Lock</strong></td><td>다중 노드 자원 접근 제어 (Redis, etcd, Zookeeper)</td></tr><tr><td><strong>Redlock</strong></td><td>Redis 기반의 다중 노드 락 알고리즘 (<em>Redis Cluster 사용 시 신뢰성 위험 있음</em>)</td></tr><tr><td><strong>Lease</strong></td><td>TTL 기반 일시적 자원 점유권 부여</td></tr><tr><td><strong>Leader Election</strong></td><td>분산 시스템 내 대표 노드 선출 (e.g., Kubernetes Lease API)</td></tr><tr><td><strong>Consensus</strong></td><td>Paxos, Raft 기반 분산 동기화 처리</td></tr></tbody></table><h4 id=실무-적용-영역>실무 적용 영역<a hidden class=anchor aria-hidden=true href=#실무-적용-영역>#</a></h4><table><thead><tr><th>적용 분야</th><th>상세 예시</th></tr></thead><tbody><tr><td>Database</td><td>트랜잭션 격리 (Serializable, Repeatable Read 등)</td></tr><tr><td>Cache</td><td>Redis, Memcached 의 일관성 유지</td></tr><tr><td>Web Server</td><td>커넥션 풀, 세션 락, Rate Limiting</td></tr><tr><td>Game</td><td>오브젝트 상태 동기화, 물리 엔진 충돌 방지</td></tr><tr><td>분산 시스템</td><td>큐 처리, 분산 DB 락, 마이크로서비스 간 자원 접근 제어</td></tr></tbody></table><h4 id=최적화-및-운영-전략>최적화 및 운영 전략<a hidden class=anchor aria-hidden=true href=#최적화-및-운영-전략>#</a></h4><table><thead><tr><th>전략</th><th>설명</th></tr></thead><tbody><tr><td><strong>임계 구역 최소화</strong></td><td>락 점유 시간 단축으로 경합 감소</td></tr><tr><td><strong>Lock Striping</strong></td><td>자원 분할로 병목 분산</td></tr><tr><td><strong>공정성 확보</strong></td><td>Starvation 방지 및 우선순위 기반 처리</td></tr><tr><td><strong>Timeout/Backoff</strong></td><td>데드락 예방 및 재시도 전략</td></tr><tr><td><strong>락 병목 분석</strong></td><td><code>perf</code>, <code>lockstat</code>, tracing 툴 활용</td></tr><tr><td><strong>모니터링 지표화</strong></td><td>락 획득 실패율, 평균 대기 시간 등 수집</td></tr></tbody></table><h4 id=미래-기술-동향>미래 기술 동향<a hidden class=anchor aria-hidden=true href=#미래-기술-동향>#</a></h4><ul><li><strong>Lock-Free/Wait-Free 알고리즘</strong>: 병목 제거 및 실시간 성능 보장</li><li><strong>ML 기반 락 튜닝</strong>: 락 획득 전략 자동화</li><li><strong>HTM (Hardware Transactional Memory)</strong>: 명시적 락 없이 동기화</li><li><strong>함수형 프로그래밍 + 불변 자료구조</strong>: 락 제거 설계 확산</li><li><strong>분산 시스템의 Lease 및 Quorum 기반 락 모델</strong> 강화</li></ul><h3 id=학습-항목-정리>학습 항목 정리<a hidden class=anchor aria-hidden=true href=#학습-항목-정리>#</a></h3><table><thead><tr><th>분류</th><th>과목 구분</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기본</td><td>이론</td><td>동기화 원리</td><td>Mutual Exclusion, Critical Section</td><td>공유 자원 보호 핵심 개념</td></tr><tr><td></td><td>이론</td><td>원자 연산</td><td>Test‑and‑Set, Compare‑and‑Swap</td><td>락 구현을 위한 하드웨어 기반 연산</td></tr><tr><td>심화</td><td>이론</td><td>조건 동기화</td><td>Condition Variable</td><td>wait/pulse 형태 조건 제어</td></tr><tr><td>심화</td><td>실무</td><td>락 종류 / 패턴</td><td>Mutex, Spinlock, Reader‑Writer Lock, Semaphore</td><td>워크로드 기반 락 선택</td></tr><tr><td>실무</td><td>실무</td><td>재진입 지원</td><td>Reentrant Lock (lock count, owner 추적)</td><td>재귀 호출 또는 중첩 로직 시 적용</td></tr><tr><td>실무</td><td>실무</td><td>동시성 문제 해결</td><td>Deadlock, Starvation, Priority inversion</td><td>예방 및 해결 전략 필요</td></tr><tr><td>심화</td><td>고급 동기화</td><td>Non‑blocking 구조</td><td>Lock‑Free, Wait‑Free</td><td>CAS 기반 고성능 병렬 제어</td></tr><tr><td>실무</td><td>실무</td><td>최적화 및 확장성 전략</td><td>Fine‑grained Locking, Lock Striping, Hybrid Lock, Futex</td><td>성능 및 확장성 강화</td></tr><tr><td>실무</td><td>분산</td><td>분산 동기화</td><td>Zookeeper, etcd, Redis Redlock 등</td><td>서비스 일관성 유지 기반 동기화</td></tr></tbody></table><ul><li><p><strong>기본 (Fundamentals)</strong><br>동시성의 기본 개념인 Mutual Exclusion 과 Critical Section 이 토대이며, Test‑and‑Set 과 CAS 와 같은 하드웨어 수준의 원자 연산은 락 구현의 기반이다.</p></li><li><p><strong>심화 (Advanced)</strong><br>Condition Variable 은 복합적인 동기화 시나리오에서 조건 기반 대기를 제어하는 핵심 도구이며, Reader‑Writer 락의 설계는 읽기/쓰기 우선순위 모델에 따라 성능과 공정성 트레이드오프를 고려해야 한다.</p></li><li><p><strong>실무 (Practical Application)</strong><br>각 락 유형 (Mutex, Spinlock, Semaphore 등) 은 워크로드 특성에 따라 선택되어야 하며, 동시성 오류 (Deadlock, Starvation 등) 에 대한 예방과 해결 전략이 필수다. 또한 Fine‑grained Locking, Lock Striping, Hybrid Lock, Futex 활용은 고성능 시스템 구현에 동기화 최적화를 제공한다. Reentrant Lock 은 중첩된 실행 흐름에서 안전성을 보장하며, 분산 락 (Zookeeper, etcd, Redis Redlock) 은 마이크로서비스 및 MSA 기반 시스템에서 일관성을 확보하는 핵심적 동기화 방식이다.</p></li></ul><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td><strong>기본 개념</strong></td><td>Mutual Exclusion</td><td>하나의 실행 단위만이 공유 자원 접근을 허용하는 원칙</td></tr><tr><td></td><td>Critical Section</td><td>동기화로 보호해야 할 공유 자원 접근 코드 블록</td></tr><tr><td></td><td>Synchronization Primitive</td><td>동기화를 위한 기본 도구 (락, 세마포어 등)</td></tr><tr><td></td><td>Lock</td><td>자원 접근을 직렬화하여 상호 배제 보장</td></tr><tr><td></td><td>Atomic Operation</td><td>중단 불가능한 단일 연산으로, 락 없이 일관성 유지</td></tr><tr><td></td><td>Memory Barrier</td><td>CPU 메모리 접근 순서를 보장하는 명령</td></tr><tr><td></td><td>Test-and-Set</td><td>메모리 값 확인과 동시에 설정하는 원자 연산</td></tr><tr><td></td><td>Compare-And-Swap (CAS)</td><td>값이 예상과 같을 때만 교체하는 연산</td></tr><tr><td></td><td>LL/SC</td><td>Load-Linked / Store-Conditional: CAS 대체 원자 연산 모델</td></tr><tr><td><strong>Lock 유형</strong></td><td>Mutex</td><td>하나의 스레드만 접근 가능한 기본 락 (blocking)</td></tr><tr><td></td><td>Spinlock</td><td>락을 얻을 때까지 바쁘게 대기하는 락 (non-blocking)</td></tr><tr><td></td><td>Read-Write Lock</td><td>읽기는 병렬, 쓰기는 단독 허용하는 락</td></tr><tr><td></td><td>Recursive Lock</td><td>동일 스레드가 중첩 획득 가능한 락</td></tr><tr><td></td><td>Adaptive Lock</td><td>대기 시간에 따라 Spin ↔ Block 전환</td></tr><tr><td></td><td>Hybrid Lock</td><td>Spinlock + Mutex 혼합으로 성능 최적화</td></tr><tr><td></td><td>Fair Lock</td><td>락 요청 순서 보장 (FIFO)</td></tr><tr><td></td><td>Timeout Lock</td><td>일정 시간 내 획득 실패 시 예외 발생</td></tr><tr><td></td><td>Condition Variable</td><td>조건 기반으로 대기/신호를 주고받는 동기화 도구</td></tr><tr><td></td><td>Semaphore</td><td>자원 접근 개수를 제한하는 계수 기반 동기화</td></tr><tr><td><strong>하드웨어 관련</strong></td><td>Cache Coherence</td><td>멀티코어 간 캐시 일관성 보장 프로토콜</td></tr><tr><td></td><td>False Sharing</td><td>캐시 라인 공유로 인한 불필요한 경합</td></tr><tr><td></td><td>Futex (Fast Userspace Mutex)</td><td>유저 공간에서 락 수행, 필요 시 커널 호출</td></tr><tr><td><strong>성능 및 최적화</strong></td><td>Lock Contention</td><td>여러 스레드가 동일 락을 동시에 시도해 생기는 병목</td></tr><tr><td></td><td>Lock Striping</td><td>객체 단위로 락을 분할해 경합 완화</td></tr><tr><td></td><td>Backoff Strategy</td><td>재시도 시 대기 간격을 늘리는 전략</td></tr><tr><td></td><td>Wait-Free Algorithm</td><td>모든 스레드가 유한한 단계 내 종료 보장</td></tr><tr><td></td><td>Lock-Free Algorithm</td><td>최소한 하나는 항상 전진 가능한 락 없는 알고리즘</td></tr><tr><td></td><td>RAII</td><td>자원 할당 시점에 해제도 보장하는 구조 (C++, Rust 등)</td></tr><tr><td><strong>문제 및 현상</strong></td><td>Deadlock</td><td>서로 자원을 기다리다 무한 대기</td></tr><tr><td></td><td>Starvation</td><td>특정 스레드가 자원을 영원히 얻지 못함</td></tr><tr><td></td><td>Livelock</td><td>계속 양보하다가 아무도 진입하지 못함</td></tr><tr><td></td><td>Race Condition</td><td>실행 순서에 따라 결과가 달라지는 비결정성 현상</td></tr><tr><td></td><td>Priority Inversion</td><td>낮은 우선순위 스레드가 높은 우선순위를 블로킹</td></tr><tr><td></td><td>ABA Problem</td><td>A→B→A 로 값이 바뀌며 CAS 가 잘못 인식</td></tr><tr><td><strong>분산 환경</strong></td><td>Distributed Lock</td><td>네트워크 간 자원 접근을 직렬화하는 락</td></tr><tr><td></td><td>Redlock</td><td>Redis 기반 다중 노드 분산 락 알고리즘</td></tr><tr><td></td><td>Lease</td><td>시간 제한 있는 자원 점유권 (TTL 기반)</td></tr><tr><td></td><td>Leader Election</td><td>다수 노드 중 제어 노드를 선출하는 방식</td></tr><tr><td></td><td>Consensus Algorithm</td><td>다수 노드 간 합의 형성 알고리즘 (RAFT, Paxos 등)</td></tr><tr><td></td><td>Heartbeat</td><td>노드 생존 확인을 위한 주기적 신호</td></tr><tr><td></td><td>Failover</td><td>장애 발생 시 다른 인스턴스로 대체</td></tr><tr><td><strong>구현 전략</strong></td><td>Outbox Pattern</td><td>트랜잭션 내 이벤트 저장 후 외부 발행</td></tr><tr><td></td><td>Watchdog</td><td>비정상 상태 감지 및 자동 복구 트리거</td></tr><tr><td><strong>운영 및 모니터링</strong></td><td>Lock Monitoring</td><td>락 대기 시간, 경합 횟수 등 추적 메커니즘</td></tr><tr><td></td><td>Distributed Tracing</td><td>락 지연, 병목 등 시스템 경로 시각화 도구 (Jaeger 등)</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://www.cs.cmu.edu/afs/cs/academic/class/15213-m13/www/lectures/23-concurrency.html>Introduction to Computer Systems (CMU 15‑213)</a></li><li><a href=https://ocw.mit.edu/courses/6-828-operating-system-engineering-fall-2012/pages/lecture-notes-and-readings/>Operating System Engineering (MIT 6.828 Lecture Notes)</a></li><li><a href=https://en.wikipedia.org/wiki/Lock_%28computer_science%29>Wikipedia – Lock (computer science)</a></li><li><a href=https://en.wikipedia.org/wiki/Compare-and-swap>Wikipedia – Compare-and-swap</a></li><li><a href=https://en.wikipedia.org/wiki/Spinlock>Wikipedia – Spinlock</a></li><li><a href=https://man7.org/linux/man-pages/man2/futex.2.html>Linux futex documentation</a></li><li><a href=https://man7.org/linux/man-pages/man3/pthread_mutex_lock.3p.html>POSIX pthread_mutex_lock (pthread_mutex API)</a></li><li><a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/ReentrantLock.html>Java ReentrantLock API (Java 8 Concurrent Locks)</a></li><li><a href=https://clang.llvm.org/docs/ThreadSanitizer.html>ThreadSanitizer (TSan)</a></li><li><a href=http://valgrind.org/docs/manual/hg-manual.html>Helgrind (Valgrind)</a></li></ul><hr></div><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Pessimistic vs. Optimistic Locking</h2></header><div class=entry-content><p>Pessimistic vs. Optimistic Locking Pessimistic Locking은 충돌을 우려해 먼저 락을 거는 방식으로, 데이터 무결성이 중요한 환경에서 적합하다. Optimistic Locking은 충돌 가능성이 낮다고 보고 사후 검증을 통해 일관성을 보장한다. 시스템 요구사항과 성능 특성에 따라 선택된다.
등장 배경 및 발전 과정 Pessimistic Locking은 초기 RDBMS + ACID 보장 요구에서 발전했으며, 충돌 회피를 위한 보수적 접근 방식이 정립되었으며, Optimistic Locking은 낮은 충돌 환경을 가정한 성능 중심 전략으로, 분산 시스템, 웹/모바일 기반 환경에서 발전해왔다.
...</p></div><footer class=entry-footer><span title='2025-08-04 03:58:00 +0000 UTC'>August 4, 2025</span>&nbsp;·&nbsp;40 min&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Pessimistic vs. Optimistic Locking" href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency-and-parallelism/lock/pessimistic-vs-optimistic-locking/></a></article></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>