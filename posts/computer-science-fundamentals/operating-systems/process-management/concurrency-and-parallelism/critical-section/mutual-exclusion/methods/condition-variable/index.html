<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>조건 변수 (Condition Variable) | hyunyoun's Blog</title>
<meta name=keywords content="Computer-System,Operating-System,Synchronization-and-Concurrency-Control,Process-Synchronization,Condition-Variables,Spurious-Wakeup"><meta name=description content="조건 변수(Condition Variables)는 프로세스 동기화에서 중요한 역할을 하는 동기화 기본 요소로, 스레드가 특정 조건이 충족될 때까지 대기하도록 하는 메커니즘을 제공한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/condition-variable/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/condition-variable/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/condition-variable/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="조건 변수 (Condition Variable)"><meta property="og:description" content="조건 변수(Condition Variables)는 프로세스 동기화에서 중요한 역할을 하는 동기화 기본 요소로, 스레드가 특정 조건이 충족될 때까지 대기하도록 하는 메커니즘을 제공한다."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-04T10:54:00+00:00"><meta property="article:modified_time" content="2024-10-04T10:54:00+00:00"><meta property="article:tag" content="Computer-System"><meta property="article:tag" content="Operating-System"><meta property="article:tag" content="Synchronization-and-Concurrency-Control"><meta property="article:tag" content="Process-Synchronization"><meta property="article:tag" content="Condition-Variables"><meta property="article:tag" content="Spurious-Wakeup"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="조건 변수 (Condition Variable)"><meta name=twitter:description content="조건 변수(Condition Variables)는 프로세스 동기화에서 중요한 역할을 하는 동기화 기본 요소로, 스레드가 특정 조건이 충족될 때까지 대기하도록 하는 메커니즘을 제공한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"기술 블로그","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Computer Science Fundamentals","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/"},{"@type":"ListItem","position":3,"name":"Operating System","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/"},{"@type":"ListItem","position":5,"name":"Concurrency and Parallelism","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/"},{"@type":"ListItem","position":6,"name":"임계 영역 (Critical Section)","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/"},{"@type":"ListItem","position":7,"name":"상호 배제 (Mutual Exclusion)","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/"},{"@type":"ListItem","position":8,"name":"Syncronization Algorithms","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/"},{"@type":"ListItem","position":9,"name":"조건 변수 (Condition Variable)","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/condition-variable/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"조건 변수 (Condition Variable)","name":"조건 변수 (Condition Variable)","description":"조건 변수(Condition Variables)는 프로세스 동기화에서 중요한 역할을 하는 동기화 기본 요소로, 스레드가 특정 조건이 충족될 때까지 대기하도록 하는 메커니즘을 제공한다.","keywords":["Computer-System","Operating-System","Synchronization-and-Concurrency-Control","Process-Synchronization","Condition-Variables","Spurious-Wakeup"],"articleBody":"조건 변수 (Condition Variable) 조건 변수(Condition Variables)는 프로세스 동기화에서 중요한 역할을 하는 동기화 기본 요소로, 스레드가 특정 조건이 충족될 때까지 대기하도록 하는 메커니즘을 제공한다.\n스레드가 특정 조건이 만족될 때까지 대기하고, 조건이 충족되면 다른 스레드가 대기 중인 스레드를 깨우는 데 사용된다.\n뮤텍스와의 연관 조건 변수는 일반적으로 뮤텍스와 함께 사용된다.\n뮤텍스는 조건을 원자적으로 검사하고 변경할 수 있도록 보장한다.\n주요 연산 wait(): 스레드가 조건이 충족될 때까지 대기하도록 한다. signal()/notify_one(): 대기 중인 단일 스레드를 깨운다. broadcast()/notify_all(): 해당 조건 변수에서 대기 중인 모든 스레드를 깨운다. 사용 패턴 조건을 보호하는 뮤텍스를 획득한다. 조건을 테스트한다. 조건이 거짓이면 wait()를 호출하여 대기한다. 조건이 참이면 작업을 수행하고 뮤텍스를 해제한다. 가짜 깨우기(Spurious Wakeup) 가짜 깨우기는 조건 변수(Condition Variable)를 사용할 때 발생할 수 있는 현상이다.\n스레드가 실제로 signal이나 broadcast를 받지 않았는데도 wait 상태에서 깨어나는 현상을 말한다.\n이는 운영체제의 구현 방식이나 하드웨어의 특성으로 인해 발생할 수 있다.\n가짜 깨우기가 발생하는 이유들은 다음과 같다:\n운영체제 최적화: 일부 운영체제는 성능 향상을 위해 의도적으로 가짜 깨우기를 발생시킬 수 있다. 하드웨어 인터럽트: 시스템 이벤트나 하드웨어 인터럽트로 인해 스레드가 예기치 않게 깨어날 수 있다. 시그널 처리: 운영체제의 시그널 처리 메커니즘이 의도치 않은 깨우기를 유발할 수 있다. 가짜 깨우기를 처리하는 일반적인 패턴은 다음과 같다:\n조건을 while 루프로 감싸기 명확한 상태 변수 사용하기 모든 상태 변경을 적절한 동기화 블록 내에서 수행하기 notify() 호출 전에 상태 변경하기\n이러한 방어적 프로그래밍 기법을 사용함으로써, 가짜 깨우기로 인한 문제를 효과적으로 방지할 수 있다.\n특히 멀티스레드 프로그래밍에서는 이러한 세부사항에 주의를 기울이는 것이 매우 중요하다. 예시 다음은 가짜 깨우기 문제를 보여주는 잘못된 코드 예시:\n1 2 3 4 5 6 # 잘못된 구현 - 가짜 깨우기에 취약 def wait_for_data(condition, shared_data): with condition: if not shared_data.is_ready: # if 사용 - 문제 있음 condition.wait() return shared_data.value 이 코드의 문제점은 if문을 사용하여 조건을 한 번만 검사한다는 것이다.\n가짜 깨우기가 발생하면, 실제로 데이터가 준비되지 않았는데도 스레드가 깨어나서 잘못된 데이터를 반환할 수 있다.\n다음은 가짜 깨우기를 올바르게 처리하는 코드:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 import threading import time class SharedData: def __init__(self): self.condition = threading.Condition() self.is_ready = False self.value = None def wait_for_data(self): with self.condition: while not self.is_ready: # while 사용 - 안전한 구현 self.condition.wait() return self.value def set_data(self, value): with self.condition: self.value = value self.is_ready = True self.condition.notify_all() # 사용 예시 def consumer(shared_data): print(\"소비자: 데이터 대기 중…\") value = shared_data.wait_for_data() print(f\"소비자: 데이터 수신 - {value}\") def producer(shared_data): print(\"생산자: 잠시 대기…\") time.sleep(2) print(\"생산자: 데이터 설정\") shared_data.set_data(\"중요한 데이터\") # 테스트 shared_data = SharedData() consumer_thread = threading.Thread(target=consumer, args=(shared_data,)) producer_thread = threading.Thread(target=producer, args=(shared_data,)) consumer_thread.start() producer_thread.start() consumer_thread.join() producer_thread.join() 이 개선된 구현에서는 다음과 같은 중요한 포인트들을 주목해야 한다:\nwhile 루프 사용: if 대신 while을 사용하여 조건을 반복적으로 검사한다. 이는 가짜 깨우기가 발생하더라도 조건이 실제로 만족될 때까지 대기하도록 보장한다. 상태 변수(is_ready): 단순히 신호만 기다리는 것이 아니라, 실제 데이터의 상태를 추적하는 변수를 사용한다. 동기화 블록: 모든 공유 데이터 접근은 condition lock으로 보호된다. 구현 대부분의 현대 운영 체제와 프로그래밍 언어에서 조건 변수를 지원한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 import threading import time class DataQueue: def __init__(self, size): self.queue = [] self.size = size self.lock = threading.Lock() # 큐가 비어있지 않음을 나타내는 조건 변수 self.not_empty = threading.Condition(self.lock) # 큐가 가득 차지 않음을 나타내는 조건 변수 self.not_full = threading.Condition(self.lock) def put(self, data): with self.lock: # 큐가 가득 찼다면 대기 while len(self.queue) \u003e= self.size: print(f\"큐가 가득 찼습니다. 생산자 대기 중…\") self.not_full.wait() # 데이터 추가 self.queue.append(data) print(f\"생산: {data}\") # 대기 중인 소비자에게 신호 전송 self.not_empty.notify() def get(self): with self.lock: # 큐가 비었다면 대기 while len(self.queue) == 0: print(\"큐가 비었습니다. 소비자 대기 중…\") self.not_empty.wait() # 데이터 추출 data = self.queue.pop(0) print(f\"소비: {data}\") # 대기 중인 생산자에게 신호 전송 self.not_full.notify() return data # 생산자 함수 def producer(queue): for i in range(5): time.sleep(0.5) # 생산 시간 시뮬레이션 queue.put(f\"항목 {i}\") # 소비자 함수 def consumer(queue): for i in range(5): time.sleep(1) # 소비 시간 시뮬레이션 queue.get() # 실행 queue = DataQueue(3) # 크기가 3인 큐 생성 producer_thread = threading.Thread(target=producer, args=(queue,)) consumer_thread = threading.Thread(target=consumer, args=(queue,)) producer_thread.start() consumer_thread.start() producer_thread.join() consumer_thread.join() 이 코드는 생산자-소비자 문제를 조건 변수를 사용하여 해결하는 예시이다.\n여기서 조건 변수는 두 가지 중요한 역할을 한다:\n큐가 가득 찼을 때 생산자를 대기시키고, 공간이 생기면 깨우기 큐가 비었을 때 소비자를 대기시키고, 데이터가 들어오면 깨우기 참고 및 출처 ","wordCount":"754","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-10-04T10:54:00Z","dateModified":"2024-10-04T10:54:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/condition-variable/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>기술 블로그</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/>Computer Science Fundamentals</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/>Operating System</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/>Concurrency and Parallelism</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/>임계 영역 (Critical Section)</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/>상호 배제 (Mutual Exclusion)</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/>Syncronization Algorithms</a></div><h1 class="post-title entry-hint-parent">조건 변수 (Condition Variable)</h1><div class=post-description>조건 변수(Condition Variables)는 프로세스 동기화에서 중요한 역할을 하는 동기화 기본 요소로, 스레드가 특정 조건이 충족될 때까지 대기하도록 하는 메커니즘을 제공한다.</div><div class=post-meta><span title='2024-10-04 10:54:00 +0000 UTC'>October 4, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/Computer%20Science%20Fundamentals/Operating%20systems/Process%20Management/Concurrency%20and%20Parallelism/Critical%20Section/Mutual%20Exclusion/Methods/Condition-Variable.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#조건-변수-condition-variable>조건 변수 (Condition Variable)</a><ul><li><a href=#뮤텍스와의-연관>뮤텍스와의 연관</a></li><li><a href=#주요-연산>주요 연산</a></li><li><a href=#사용-패턴>사용 패턴</a></li><li><a href=#가짜-깨우기spurious-wakeup>가짜 깨우기(Spurious Wakeup)</a></li><li><a href=#구현>구현</a></li></ul></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=조건-변수-condition-variable>조건 변수 (Condition Variable)<a hidden class=anchor aria-hidden=true href=#조건-변수-condition-variable>#</a></h2><p>조건 변수(Condition Variables)는 프로세스 동기화에서 중요한 역할을 하는 동기화 기본 요소로, 스레드가 특정 조건이 충족될 때까지 대기하도록 하는 메커니즘을 제공한다.</p><p>스레드가 특정 조건이 만족될 때까지 대기하고, 조건이 충족되면 다른 스레드가 대기 중인 스레드를 깨우는 데 사용된다.</p><h3 id=뮤텍스와의-연관>뮤텍스와의 연관<a hidden class=anchor aria-hidden=true href=#뮤텍스와의-연관>#</a></h3><p>조건 변수는 일반적으로 뮤텍스와 함께 사용된다.<br>뮤텍스는 조건을 원자적으로 검사하고 변경할 수 있도록 보장한다.</p><h3 id=주요-연산>주요 연산<a hidden class=anchor aria-hidden=true href=#주요-연산>#</a></h3><ul><li>wait(): 스레드가 조건이 충족될 때까지 대기하도록 한다.</li><li>signal()/notify_one(): 대기 중인 단일 스레드를 깨운다.</li><li>broadcast()/notify_all(): 해당 조건 변수에서 대기 중인 모든 스레드를 깨운다.</li></ul><h3 id=사용-패턴>사용 패턴<a hidden class=anchor aria-hidden=true href=#사용-패턴>#</a></h3><ul><li>조건을 보호하는 뮤텍스를 획득한다.</li><li>조건을 테스트한다.</li><li>조건이 거짓이면 wait()를 호출하여 대기한다.</li><li>조건이 참이면 작업을 수행하고 뮤텍스를 해제한다.</li></ul><h3 id=가짜-깨우기spurious-wakeup>가짜 깨우기(Spurious Wakeup)<a hidden class=anchor aria-hidden=true href=#가짜-깨우기spurious-wakeup>#</a></h3><p>가짜 깨우기는 조건 변수(Condition Variable)를 사용할 때 발생할 수 있는 현상이다.<br>스레드가 실제로 signal이나 broadcast를 받지 않았는데도 wait 상태에서 깨어나는 현상을 말한다.</p><p>이는 운영체제의 구현 방식이나 하드웨어의 특성으로 인해 발생할 수 있다.<br>가짜 깨우기가 발생하는 이유들은 다음과 같다:</p><ol><li>운영체제 최적화: 일부 운영체제는 성능 향상을 위해 의도적으로 가짜 깨우기를 발생시킬 수 있다.</li><li>하드웨어 인터럽트: 시스템 이벤트나 하드웨어 인터럽트로 인해 스레드가 예기치 않게 깨어날 수 있다.</li><li>시그널 처리: 운영체제의 시그널 처리 메커니즘이 의도치 않은 깨우기를 유발할 수 있다.</li></ol><p>가짜 깨우기를 처리하는 일반적인 패턴은 다음과 같다:</p><ol><li>조건을 while 루프로 감싸기</li><li>명확한 상태 변수 사용하기</li><li>모든 상태 변경을 적절한 동기화 블록 내에서 수행하기</li><li>notify() 호출 전에 상태 변경하기<br>이러한 방어적 프로그래밍 기법을 사용함으로써, 가짜 깨우기로 인한 문제를 효과적으로 방지할 수 있다.<br>특히 멀티스레드 프로그래밍에서는 이러한 세부사항에 주의를 기울이는 것이 매우 중요하다.</li></ol><h4 id=예시>예시<a hidden class=anchor aria-hidden=true href=#예시>#</a></h4><p>다음은 가짜 깨우기 문제를 보여주는 잘못된 코드 예시:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 잘못된 구현 - 가짜 깨우기에 취약</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>wait_for_data</span><span class=p>(</span><span class=n>condition</span><span class=p>,</span> <span class=n>shared_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>shared_data</span><span class=o>.</span><span class=n>is_ready</span><span class=p>:</span>  <span class=c1># if 사용 - 문제 있음</span>
</span></span><span class=line><span class=cl>            <span class=n>condition</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>shared_data</span><span class=o>.</span><span class=n>value</span>
</span></span></code></pre></td></tr></table></div></div><p>이 코드의 문제점은 if문을 사용하여 조건을 한 번만 검사한다는 것이다.<br>가짜 깨우기가 발생하면, 실제로 데이터가 준비되지 않았는데도 스레드가 깨어나서 잘못된 데이터를 반환할 수 있다.</p><p>다음은 가짜 깨우기를 올바르게 처리하는 코드:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22>22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23>23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24>24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25>25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26>26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27>27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28>28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29>29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30>30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31>31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32>32</a>
</span><span class=lnt id=hl-1-33><a class=lnlinks href=#hl-1-33>33</a>
</span><span class=lnt id=hl-1-34><a class=lnlinks href=#hl-1-34>34</a>
</span><span class=lnt id=hl-1-35><a class=lnlinks href=#hl-1-35>35</a>
</span><span class=lnt id=hl-1-36><a class=lnlinks href=#hl-1-36>36</a>
</span><span class=lnt id=hl-1-37><a class=lnlinks href=#hl-1-37>37</a>
</span><span class=lnt id=hl-1-38><a class=lnlinks href=#hl-1-38>38</a>
</span><span class=lnt id=hl-1-39><a class=lnlinks href=#hl-1-39>39</a>
</span><span class=lnt id=hl-1-40><a class=lnlinks href=#hl-1-40>40</a>
</span><span class=lnt id=hl-1-41><a class=lnlinks href=#hl-1-41>41</a>
</span><span class=lnt id=hl-1-42><a class=lnlinks href=#hl-1-42>42</a>
</span><span class=lnt id=hl-1-43><a class=lnlinks href=#hl-1-43>43</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SharedData</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>condition</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_ready</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>wait_for_data</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_ready</span><span class=p>:</span>  <span class=c1># while 사용 - 안전한 구현</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>condition</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>condition</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>is_ready</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>condition</span><span class=o>.</span><span class=n>notify_all</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consumer</span><span class=p>(</span><span class=n>shared_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;소비자: 데이터 대기 중…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>value</span> <span class=o>=</span> <span class=n>shared_data</span><span class=o>.</span><span class=n>wait_for_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;소비자: 데이터 수신 - </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>producer</span><span class=p>(</span><span class=n>shared_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;생산자: 잠시 대기…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;생산자: 데이터 설정&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>shared_data</span><span class=o>.</span><span class=n>set_data</span><span class=p>(</span><span class=s2>&#34;중요한 데이터&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 테스트</span>
</span></span><span class=line><span class=cl><span class=n>shared_data</span> <span class=o>=</span> <span class=n>SharedData</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>consumer_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>consumer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>shared_data</span><span class=p>,))</span>
</span></span><span class=line><span class=cl><span class=n>producer_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>producer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>shared_data</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>consumer_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>producer_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>consumer_thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>producer_thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>이 개선된 구현에서는 다음과 같은 중요한 포인트들을 주목해야 한다:</p><ol><li>while 루프 사용: if 대신 while을 사용하여 조건을 반복적으로 검사한다. 이는 가짜 깨우기가 발생하더라도 조건이 실제로 만족될 때까지 대기하도록 보장한다.</li><li>상태 변수(is_ready): 단순히 신호만 기다리는 것이 아니라, 실제 데이터의 상태를 추적하는 변수를 사용한다.</li><li>동기화 블록: 모든 공유 데이터 접근은 condition lock으로 보호된다.</li></ol><h3 id=구현>구현<a hidden class=anchor aria-hidden=true href=#구현>#</a></h3><p>대부분의 현대 운영 체제와 프로그래밍 언어에서 조건 변수를 지원한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span><span class=lnt id=hl-2-27><a class=lnlinks href=#hl-2-27>27</a>
</span><span class=lnt id=hl-2-28><a class=lnlinks href=#hl-2-28>28</a>
</span><span class=lnt id=hl-2-29><a class=lnlinks href=#hl-2-29>29</a>
</span><span class=lnt id=hl-2-30><a class=lnlinks href=#hl-2-30>30</a>
</span><span class=lnt id=hl-2-31><a class=lnlinks href=#hl-2-31>31</a>
</span><span class=lnt id=hl-2-32><a class=lnlinks href=#hl-2-32>32</a>
</span><span class=lnt id=hl-2-33><a class=lnlinks href=#hl-2-33>33</a>
</span><span class=lnt id=hl-2-34><a class=lnlinks href=#hl-2-34>34</a>
</span><span class=lnt id=hl-2-35><a class=lnlinks href=#hl-2-35>35</a>
</span><span class=lnt id=hl-2-36><a class=lnlinks href=#hl-2-36>36</a>
</span><span class=lnt id=hl-2-37><a class=lnlinks href=#hl-2-37>37</a>
</span><span class=lnt id=hl-2-38><a class=lnlinks href=#hl-2-38>38</a>
</span><span class=lnt id=hl-2-39><a class=lnlinks href=#hl-2-39>39</a>
</span><span class=lnt id=hl-2-40><a class=lnlinks href=#hl-2-40>40</a>
</span><span class=lnt id=hl-2-41><a class=lnlinks href=#hl-2-41>41</a>
</span><span class=lnt id=hl-2-42><a class=lnlinks href=#hl-2-42>42</a>
</span><span class=lnt id=hl-2-43><a class=lnlinks href=#hl-2-43>43</a>
</span><span class=lnt id=hl-2-44><a class=lnlinks href=#hl-2-44>44</a>
</span><span class=lnt id=hl-2-45><a class=lnlinks href=#hl-2-45>45</a>
</span><span class=lnt id=hl-2-46><a class=lnlinks href=#hl-2-46>46</a>
</span><span class=lnt id=hl-2-47><a class=lnlinks href=#hl-2-47>47</a>
</span><span class=lnt id=hl-2-48><a class=lnlinks href=#hl-2-48>48</a>
</span><span class=lnt id=hl-2-49><a class=lnlinks href=#hl-2-49>49</a>
</span><span class=lnt id=hl-2-50><a class=lnlinks href=#hl-2-50>50</a>
</span><span class=lnt id=hl-2-51><a class=lnlinks href=#hl-2-51>51</a>
</span><span class=lnt id=hl-2-52><a class=lnlinks href=#hl-2-52>52</a>
</span><span class=lnt id=hl-2-53><a class=lnlinks href=#hl-2-53>53</a>
</span><span class=lnt id=hl-2-54><a class=lnlinks href=#hl-2-54>54</a>
</span><span class=lnt id=hl-2-55><a class=lnlinks href=#hl-2-55>55</a>
</span><span class=lnt id=hl-2-56><a class=lnlinks href=#hl-2-56>56</a>
</span><span class=lnt id=hl-2-57><a class=lnlinks href=#hl-2-57>57</a>
</span><span class=lnt id=hl-2-58><a class=lnlinks href=#hl-2-58>58</a>
</span><span class=lnt id=hl-2-59><a class=lnlinks href=#hl-2-59>59</a>
</span><span class=lnt id=hl-2-60><a class=lnlinks href=#hl-2-60>60</a>
</span><span class=lnt id=hl-2-61><a class=lnlinks href=#hl-2-61>61</a>
</span><span class=lnt id=hl-2-62><a class=lnlinks href=#hl-2-62>62</a>
</span><span class=lnt id=hl-2-63><a class=lnlinks href=#hl-2-63>63</a>
</span><span class=lnt id=hl-2-64><a class=lnlinks href=#hl-2-64>64</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DataQueue</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queue</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=n>size</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># 큐가 비어있지 않음을 나타내는 조건 변수</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>not_empty</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 큐가 가득 차지 않음을 나타내는 조건 변수</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>not_full</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>put</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 큐가 가득 찼다면 대기</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;큐가 가득 찼습니다. 생산자 대기 중…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>not_full</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 데이터 추가</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;생산: </span><span class=si>{</span><span class=n>data</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 대기 중인 소비자에게 신호 전송</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>not_empty</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 큐가 비었다면 대기</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;큐가 비었습니다. 소비자 대기 중…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>not_empty</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 데이터 추출</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;소비: </span><span class=si>{</span><span class=n>data</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 대기 중인 생산자에게 신호 전송</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>not_full</span><span class=o>.</span><span class=n>notify</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 생산자 함수</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>producer</span><span class=p>(</span><span class=n>queue</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>  <span class=c1># 생산 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=n>queue</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;항목 </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 소비자 함수</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consumer</span><span class=p>(</span><span class=n>queue</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 소비 시간 시뮬레이션</span>
</span></span><span class=line><span class=cl>        <span class=n>queue</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행</span>
</span></span><span class=line><span class=cl><span class=n>queue</span> <span class=o>=</span> <span class=n>DataQueue</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>  <span class=c1># 크기가 3인 큐 생성</span>
</span></span><span class=line><span class=cl><span class=n>producer_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>producer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>queue</span><span class=p>,))</span>
</span></span><span class=line><span class=cl><span class=n>consumer_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>consumer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>queue</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>producer_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>consumer_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>producer_thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>consumer_thread</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>이 코드는 생산자-소비자 문제를 조건 변수를 사용하여 해결하는 예시이다.<br>여기서 조건 변수는 두 가지 중요한 역할을 한다:</p><ol><li>큐가 가득 찼을 때 생산자를 대기시키고, 공간이 생기면 깨우기</li><li>큐가 비었을 때 소비자를 대기시키고, 데이터가 들어오면 깨우기</li></ol><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/computer-system/>Computer-System</a></li><li><a href=https://buenhyden.github.io/tags/operating-system/>Operating-System</a></li><li><a href=https://buenhyden.github.io/tags/synchronization-and-concurrency-control/>Synchronization-and-Concurrency-Control</a></li><li><a href=https://buenhyden.github.io/tags/process-synchronization/>Process-Synchronization</a></li><li><a href=https://buenhyden.github.io/tags/condition-variables/>Condition-Variables</a></li><li><a href=https://buenhyden.github.io/tags/spurious-wakeup/>Spurious-Wakeup</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/mutex/><span class=title>« Prev</span><br><span>Mutex</span>
</a><a class=next href=https://buenhyden.github.io/posts/computer-science-fundamentals/operating-systems/process-management/concurrency-and-parallelism/critical-section/mutual-exclusion/methods/atomic-operation/><span class=title>Next »</span><br><span>원자적 연산 (Atomic Operation)</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>