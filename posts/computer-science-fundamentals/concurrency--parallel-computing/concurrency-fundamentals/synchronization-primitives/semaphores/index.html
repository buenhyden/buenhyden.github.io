<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Semaphore | hyunyoun's Blog</title><meta name=keywords content="Computer-Science-Fundamentals,Concurrency-and-Parallelism,Synchronization-Primitives,Software-Level,Semaphore,Thread-Safety"><meta name=description content="세마포어(Semaphore)는 멀티스레드·멀티프로세스 환경에서 공유 자원 접근을 제어하는 동기화 원시로, 카운터와 원자적 P(wait)·V(signal) 연산을 기반으로 동작한다. 이진·카운팅 방식이 있으며, 데드락·경쟁 조건 방지와 IPC, 임계 구역 관리 등 OS와 병렬 프로그래밍에서 폭넓게 활용된다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency--parallel-computing/concurrency-fundamentals/synchronization-primitives/semaphores/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency--parallel-computing/concurrency-fundamentals/synchronization-primitives/semaphores/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency--parallel-computing/concurrency-fundamentals/synchronization-primitives/semaphores/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency--parallel-computing/concurrency-fundamentals/synchronization-primitives/semaphores/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Semaphore"><meta property="og:description" content="세마포어(Semaphore)는 멀티스레드·멀티프로세스 환경에서 공유 자원 접근을 제어하는 동기화 원시로, 카운터와 원자적 P(wait)·V(signal) 연산을 기반으로 동작한다. 이진·카운팅 방식이 있으며, 데드락·경쟁 조건 방지와 IPC, 임계 구역 관리 등 OS와 병렬 프로그래밍에서 폭넓게 활용된다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Semaphore"><meta name=twitter:description content="세마포어(Semaphore)는 멀티스레드·멀티프로세스 환경에서 공유 자원 접근을 제어하는 동기화 원시로, 카운터와 원자적 P(wait)·V(signal) 연산을 기반으로 동작한다. 이진·카운팅 방식이 있으며, 데드락·경쟁 조건 방지와 IPC, 임계 구역 관리 등 OS와 병렬 프로그래밍에서 폭넓게 활용된다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HY's Blog","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Computer Science Fundamentals","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/"},{"@type":"ListItem","position":3,"name":"Semaphore","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency--parallel-computing/concurrency-fundamentals/synchronization-primitives/semaphores/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>HY's Blog</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/>Computer Science Fundamentals</a></div><h1>Semaphore</h1><div class=post-description>세마포어(Semaphore)는 멀티스레드·멀티프로세스 환경에서 공유 자원 접근을 제어하는 동기화 원시로, 카운터와 원자적 P(wait)·V(signal) 연산을 기반으로 동작한다. 이진·카운팅 방식이 있으며, 데드락·경쟁 조건 방지와 IPC, 임계 구역 관리 등 OS와 병렬 프로그래밍에서 폭넓게 활용된다.</div></header><div class=post-content><h2 id=semaphore>Semaphore<a hidden class=anchor aria-hidden=true href=#semaphore>#</a></h2><p>세마포어 (Semaphore) 는 1965 년 에츠허르 W. 다이크스트라가 제안한 동기화 메커니즘으로, 멀티스레드·멀티프로세스 환경에서 공유 자원 접근을 제어한다.</p><p>내부 정수 카운터와 대기 큐를 관리하며, 원자적 연산인 P(wait/acquire) 와 V(signal/release) 를 통해 자원 사용 순서를 조율한다.<br>이진 세마포어 (Binary) 는 뮤텍스처럼 단일 접근을 보장하고, 카운팅 세마포어 (Counting) 는 N 개의 자원을 관리한다. POSIX, System V, Java, Python, Go 등 다양한 환경에서 구현되어 임계 구역 보호, 리소스 풀 관리, 생산자 - 소비자 문제, 네트워크 요청 제한 등 폭넓게 활용된다.</p><p>올바른 설계와 사용을 통해 데드락, 경쟁 조건, 우선순위 역전 등 동시성 문제를 예방하며, 클라우드·분산 시스템에서도 리소스 스로틀링과 동시성 제어의 핵심 도구로 자리잡고 있다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><table><thead><tr><th>관점</th><th>핵심 개념</th><th>설명</th></tr></thead><tbody><tr><td><strong>이론</strong></td><td>정수형 카운터 기반 동기화 프리미티브</td><td>공유 자원 접근 횟수를 제어하는 동기화 원시체</td></tr><tr><td></td><td>원자적 P/V 연산</td><td>P(wait): 카운터 감소·대기, V(signal): 카운터 증가·깨움</td></tr><tr><td></td><td>세마포어 유형</td><td>Binary(0/1), Counting(N), Weighted</td></tr><tr><td><strong>기본</strong></td><td>뮤텍스와 차이</td><td>뮤텍스는 소유권 존재, 세마포어는 없음</td></tr><tr><td></td><td>임계 구역 보호</td><td>경쟁 조건 방지 및 자원 일관성 유지</td></tr><tr><td><strong>실무</strong></td><td>자원 접근 제한</td><td>DB 커넥션 풀, API Rate Limit, 스레드 풀 제어</td></tr><tr><td></td><td>공정성 보장</td><td>FIFO 큐로 대기 순서 보장, 기아 방지</td></tr><tr><td><strong>심화</strong></td><td>데드락·기아 방지 전략</td><td>올바른 락 순서, 타임아웃, 공정성 정책</td></tr><tr><td></td><td>분산 세마포어</td><td>Redis/ZooKeeper/Etcd 로 멀티 노드 동기화</td></tr><tr><td></td><td>메모리 가시성 보장</td><td>연산 시 메모리 배리어 역할 수행</td></tr></tbody></table><ul><li><strong>정수형 카운터 기반 동기화 프리미티브</strong>: 세마포어 값은 현재 접근 가능한 자원의 개수를 나타냄.</li><li><strong>원자적 P/V 연산</strong>: 다중 스레드가 동시에 호출해도 일관성을 유지하는 분할 불가능한 연산.<ul><li><code>acquire()/P/wait</code>: 허가증이 <strong>남아있으면 즉시 1 감소</strong>하고 통과, <strong>0 이면 대기 (블록)</strong></li><li><code>release()/V/signal</code>: 허가증을 <strong>1 증가</strong>시키고, 대기 중인 스레드가 있으면 깨움</li></ul></li><li><strong>세마포어 유형</strong>: Binary 는 상호 배제, Counting 은 다중 접근, Weighted 는 요청별 가중치.<ul><li><strong>Binary(=1)</strong>: 상호배제용 (뮤텍스처럼 쓰지만 <em>소유권 없음</em>)</li><li><strong>Counting(N)</strong>: N 개까지 동시 접근 허용</li><li><strong>BoundedSemaphore</strong>(Python): <strong>초기치 초과 release</strong>를 런타임 에러로 잡아줌 (버그 탐지에 좋음)</li></ul></li><li><strong>뮤텍스와 차이</strong>: 뮤텍스는 소유 스레드만 해제 가능, 세마포어는 누구나 해제 가능.</li><li><strong>임계 구역 보호</strong>: 공유 자원 접근을 직렬화하여 데이터 무결성 확보.</li><li><strong>자원 접근 제한</strong>: 동시 처리량 제어에 활용.</li><li><strong>공정성 보장</strong>: FIFO 큐 등 정책으로 특정 스레드가 무한 대기하는 기아 상태 방지.</li><li><strong>데드락·기아 방지 전략</strong>: 올바른 락 획득 순서, 타임아웃, 재시도 로직.</li><li><strong>분산 세마포어</strong>: 네트워크를 통한 자원 동기화.</li><li><strong>메모리 가시성 보장</strong>: 쓰기/읽기 순서를 보장하여 최신 데이터 반영.</li></ul><h4 id=핵심-개념의-실무-구현-연관성-및-적용-방식>핵심 개념의 실무 구현 연관성 및 적용 방식<a hidden class=anchor aria-hidden=true href=#핵심-개념의-실무-구현-연관성-및-적용-방식>#</a></h4><table><thead><tr><th>핵심 개념</th><th>실무 구현 연관성</th><th>적용 방식</th></tr></thead><tbody><tr><td>정수형 카운터 기반 동기화</td><td>운영체제 커널, 라이브러리 수준 동기화</td><td>POSIX <code>sem_t</code>, Java <code>Semaphore</code>, Python <code>threading.Semaphore</code></td></tr><tr><td>원자적 P/V 연산</td><td>자원 획득·반환의 원자성 보장</td><td><code>acquire()</code> / <code>release()</code> API 호출</td></tr><tr><td>세마포어 유형</td><td>시나리오별 선택적 사용</td><td>Binary=락 대체, Counting=풀 관리, Weighted=가중치 요청 처리</td></tr><tr><td>뮤텍스와 차이</td><td>설계 시 동기화 객체 선택 기준</td><td>소유권 필요 여부 판단</td></tr><tr><td>임계 구역 보호</td><td>멀티스레드 안전성 확보</td><td>세마포어로 보호 범위 한정</td></tr><tr><td>자원 접근 제한</td><td>Rate Limiting, Backpressure</td><td>API 게이트웨이, 큐 시스템</td></tr><tr><td>공정성 보장</td><td>SLA 유지, 기아 방지</td><td>FIFO 큐 구현</td></tr><tr><td>데드락·기아 방지</td><td>장애 예방</td><td>타임아웃·재시도·락 순서 규칙</td></tr><tr><td>분산 세마포어</td><td>마이크로서비스 동기화</td><td>Redis/ZooKeeper 기반 구현</td></tr><tr><td>메모리 가시성 보장</td><td>최신 데이터 일관성</td><td>세마포어 연산 내부의 메모리 배리어</td></tr></tbody></table><p>세마포어는 <strong>정수형 카운터를 기반으로 공유 자원 접근을 제어하는 동기화 원시체</strong>로, <code>P(wait)</code> 와 <code>V(signal)</code> 연산을 통해 자원 요청·반환을 원자적으로 수행한다.<br><strong>Binary</strong> 세마포어는 뮤텍스와 유사하게 상호 배제를 제공하며, <strong>Counting</strong> 세마포어는 다중 자원 접근을 허용한다.<br>실무에서는 <strong>DB 커넥션 풀 제어</strong>, <strong>API Rate Limiting</strong>, <strong>멀티스레드 임계 구역 보호</strong> 등에 사용되며, <strong>분산 환경</strong>에서는 Redis·ZooKeeper 기반의 분산 세마포어로 확장 가능하다.<br>안전한 사용을 위해 <strong>공정성 (FIFO)</strong>, <strong>데드락 방지</strong>, <strong>기아 상태 방지</strong> 전략이 필요하며, 세마포어 연산은 <strong>메모리 가시성 보장</strong> 기능도 갖는다.</p><h3 id=phase-1-기초-이해>Phase 1: 기초 이해<a hidden class=anchor aria-hidden=true href=#phase-1-기초-이해>#</a></h3><h4 id=개념-정의-및-본질>개념 정의 및 본질<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질>#</a></h4><p>세마포어 (Semaphore) 는 동시성 시스템에서 여러 프로세스나 스레드가 공유 자원에 안전하게 접근하도록 제어하는 카운터 기반 동기화 원시 자료구조다.</p><p>1962~1963 년 네덜란드의 에츠허르 다이크스트라 (Edsger Dijkstra) 가 임계 구역 문제 해결을 위해 고안했으며, 내부적으로 부호 없는 정수 카운터와 대기 큐를 유지한다.<br><code>wait(P)</code> 연산은 카운터를 감소시키고, 값이 0 이면 호출 스레드를 대기시킨다.<br><code>signal(V)</code> 연산은 카운터를 증가시키고 대기 중인 스레드를 깨운다.</p><p>이진 세마포어는 0/1 값으로 상호 배제에 사용되며, 카운팅 세마포어는 자원 수를 제한하는 데 활용된다.</p><p>뮤텍스와 달리 소유권 개념이 없어 다른 스레드가 해제할 수 있으며, 스레드 간뿐 아니라 프로세스 간 동기화 (IPC) 에도 널리 쓰인다.</p><h4 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h4><p>세마포어 (Semaphore) 는 1960 년대 초 멀티프로그래밍 환경에서 경쟁 조건, 임계 구역 문제, 교착 상태를 예방하기 위해 Edsger W. Dijkstra 가 고안한 동기화 메커니즘이다.</p><p>THE 시스템 개발 중 제안되었으며, P(시도) 와 V(증가) 연산으로 자원 접근을 제어한다.</p><p>초기에는 운영체제 커널의 프로세스 동기화 수단으로 활용되었고, 이후 다양한 알고리즘 및 동기화 기법과 함께 현대 동시성 제어의 기초 이론으로 자리잡았다.</p><h5 id=발전-과정>발전 과정<a hidden class=anchor aria-hidden=true href=#발전-과정>#</a></h5><table><thead><tr><th>시기</th><th>주요 발전 사항</th></tr></thead><tbody><tr><td>1960s 초</td><td>Dijkstra, THE 시스템 개발 중 세마포어 개념 제안</td></tr><tr><td>1960s 후반</td><td>P(시도)/V(증가) 연산 정립, OS 커널 동기화 도입</td></tr><tr><td>1970s</td><td>UNIX System V IPC 세마포어 구현</td></tr><tr><td>1980s~1990s</td><td>POSIX 세마포어 표준화, Windows NT 세마포어 객체 제공</td></tr><tr><td>2000s</td><td>Java,.NET, Python, Go 등 언어 표준 라이브러리 포함</td></tr><tr><td>현대</td><td>멀티코어, 비동기·분산 시스템, 클라우드 환경 적용</td></tr></tbody></table><pre class=mermaid>timeline
    title Semaphore 발전 과정
    1962-1965 : Dijkstra, THE 시스템 개발 중 세마포어 개념 제안
    1967-1969 : P/V 연산 정의 및 OS 커널 동기화 적용
    1970s : UNIX System V IPC 세마포어 구현
    1980s-1990s : POSIX 표준화, Windows NT 세마포어 제공
    2000s : Java, .NET, Python, Go 등 언어 API 포함
    2010s~현재 : 멀티코어, 분산·클라우드 환경, 최신 언어 지원
</pre><h4 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h4><table><thead><tr><th>카테고리</th><th>목적/필요성 설명</th></tr></thead><tbody><tr><td><strong>경쟁 조건 방지</strong></td><td>공유 자원에 대한 동시에 접근 시 발생하는 데이터 불일치, 비정상 동작 예방</td></tr><tr><td><strong>임계 구역 보호</strong></td><td>상호 배제가 필요한 코드 영역에서 단일 스레드만 접근하도록 보장</td></tr><tr><td><strong>자원 관리</strong></td><td>제한된 자원을 효율적으로 분배·회수하여 자원 고갈 방지</td></tr><tr><td><strong>동기화</strong></td><td>스레드·프로세스 간 실행 순서를 제어하고 협업 흐름 보장</td></tr><tr><td><strong>공정성 보장</strong></td><td>FIFO 큐 또는 우선순위 기반으로 기아 상태 없이 자원 접근 허용</td></tr><tr><td><strong>데드락 방지</strong></td><td>순환 대기를 차단하는 설계로 시스템 교착 상태 예방</td></tr><tr><td><strong>부하 제어</strong></td><td>백프레셔로 과도한 요청을 조절, 시스템 안정성 확보</td></tr><tr><td><strong>분산 환경 적용</strong></td><td>Redis, ZooKeeper 등 활용으로 멀티 노드 환경에서도 동기화 가능</td></tr><tr><td><strong>타임아웃 지원</strong></td><td>무한 대기로 인한 장애 방지, 안정적인 응답성 확보</td></tr><tr><td><strong>관측성 확보</strong></td><td>세마포어 대기 시간, 타임아웃 발생률 모니터링으로 문제 조기 감지</td></tr></tbody></table><p>세마포어의 목적과 필요성은 <strong>안전한 동시성 제어와 시스템 안정성</strong>을 확보하는 데 있다.<br>이는 경쟁 조건 방지, 임계 구역 보호, 제한된 자원 관리, 스레드/프로세스 동기화, 공정성 보장, 데드락 방지 같은 고전적 동기와, 백프레셔·분산 환경·타임아웃·관측성 같은 현대 시스템에서의 추가 요구를 포함한다.<br>결국 세마포어는 <strong>자원 사용량을 제어하는 신뢰성 있는 게이트</strong>로서, 안정적인 처리량과 예측 가능한 동작을 보장하는 핵심 메커니즘이다.</p><h4 id=주요-특징>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징>#</a></h4><p>세마포어 (Semaphore) 는 카운터 기반의 동기화 원시 자료구조로, <code>wait(P)</code> 와 <code>signal(V)</code> 연산이 원자적으로 수행되어 데이터 일관성을 보장한다.</p><p>Binary Semaphore 는 상호 배제를 제공하고 Counting Semaphore 는 다수 자원 관리가 가능하다.<br>POSIX, Windows,.NET 등 다양한 플랫폼에서 커널 또는 사용자 공간 구현을 지원하며, 스레드 간뿐 아니라 프로세스 간 동기화도 가능하다. 일부 구현은 FIFO 큐 기반 공정성 옵션과 타임아웃 대기, 비블로킹 모드를 제공하며, 조건 변수와 달리 스푸리어스 웨이크업 처리가 필요 없다.<br>그러나 잘못 설계하면 데드락이 발생할 수 있으므로 주의가 필요하다.</p><table><thead><tr><th>특징 카테고리</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td><strong>원자성 보장</strong></td><td><code>wait(P)</code> / <code>signal(V)</code> 연산이 불가분적으로 수행되어 중단 불가</td><td>OS/라이브러리 수준에서 atomic 연산 제공</td></tr><tr><td><strong>카운터 기반 제어</strong></td><td>정수 카운터 값이 사용 가능한 자원 수를 나타내며 동시 접근 수를 제한</td><td>카운터 감소 (P), 증가 (V) 방식</td></tr><tr><td><strong>타입 구분</strong></td><td>Binary Semaphore(0/1) 와 Counting Semaphore(N) 지원</td><td>설계 및 구현 표준 (POSIX, Windows API)</td></tr><tr><td><strong>자원 접근 제어</strong></td><td>카운터가 0 이면 P 요청 스레드를 대기 큐에 넣음</td><td>커널/유저 공간 큐 관리</td></tr><tr><td><strong>블로킹/비블로킹</strong></td><td>자원 확보 불가 시 블로킹, 일부 구현은 타임아웃·비블로킹 모드 지원</td><td><code>sem_timedwait</code>, <code>tryWait</code></td></tr><tr><td><strong>플랫폼 지원</strong></td><td>POSIX, Windows,.NET 등 다양한 환경 지원</td><td>표준 API 및 호환성</td></tr><tr><td><strong>공정성 옵션</strong></td><td>FIFO 큐 기반 공정성 제공 가능</td><td>Java 등 일부 구현에서 옵션 제공</td></tr><tr><td><strong>프로세스/스레드 간</strong></td><td>IPC 및 스레드 동기화 모두 가능</td><td>POSIX named/unnamed semaphore</td></tr><tr><td><strong>커널/유저 레벨</strong></td><td>시스템 호출 기반 또는 사용자 공간에서 구현 가능</td><td><code>sem_t</code>, HANDLE, SemaphoreSlim</td></tr><tr><td><strong>스푸리어스 웨이크업 없음</strong></td><td>조건 변수와 달리 깨어난 후 재검사 루프 필요 없음</td><td>세마포어 값이 직접 자원 수를 보장</td></tr><tr><td><strong>주의사항</strong></td><td>설계 오류 시 데드락 가능</td><td>동기화 순서·락 획득 정책 설계 필요</td></tr></tbody></table><h4 id=semaphore-vs-mutex-vs-condition-variable-비교>Semaphore vs. Mutex vs. Condition Variable 비교<a hidden class=anchor aria-hidden=true href=#semaphore-vs-mutex-vs-condition-variable-비교>#</a></h4><table><thead><tr><th>구분</th><th><strong>Semaphore</strong></th><th><strong>Mutex</strong></th><th><strong>Condition Variable</strong></th></tr></thead><tbody><tr><td><strong>핵심 개념</strong></td><td>카운터 기반 동기화 프리미티브로, 허용 가능한 동시 접근 수를 관리</td><td>단일 자원에 대한 배타적 접근을 보장하는 락</td><td>특정 조건 (조건식) 이 참이 될 때까지 스레드를 대기시키는 동기화 메커니즘</td></tr><tr><td><strong>동작 방식</strong></td><td><code>wait(P)</code> 로 카운터 감소, 0 이면 대기 / <code>signal(V)</code> 로 카운터 증가 및 대기자 깨움</td><td><code>lock()</code>/<code>unlock()</code> 호출로 임계 구역 보호</td><td><code>wait()</code> 로 조건 만족 전 대기, 다른 스레드의 <code>signal()</code>/<code>broadcast()</code> 로 깨어남</td></tr><tr><td><strong>자원 접근 수</strong></td><td>Binary(0/1) 또는 Counting(N)</td><td>1 (항상 단일 소유)</td><td>제한 없음 (조건 만족 시 여러 스레드 동시에 진행 가능)</td></tr><tr><td><strong>소유권 (Ownership)</strong></td><td>없음 → 누구나 <code>signal()</code> 가능</td><td>소유권 있음 → 락을 획득한 스레드만 해제 가능</td><td>락과 함께 사용하며 락 소유자만 <code>signal()</code> 호출 가능</td></tr><tr><td><strong>사용 목적</strong></td><td>다중 자원 동시 접근 제어, IPC, 생산자 - 소비자 패턴</td><td>임계 구역의 배타적 실행 보장</td><td>조건 충족 전까지 효율적 대기, 이벤트 기반 동기화</td></tr><tr><td><strong>블로킹 여부</strong></td><td>자원 부족 시 블로킹, 일부 구현은 타임아웃/비블로킹 지원</td><td>락이 이미 점유되면 블로킹</td><td>조건이 거짓이면 블로킹 (타임아웃 가능)</td></tr><tr><td><strong>스푸리어스 웨이크업</strong></td><td>없음</td><td>없음</td><td>있음 → <code>while</code> 루프 재검사 필요</td></tr><tr><td><strong>공정성 (Fairness)</strong></td><td>FIFO 큐 기반 구현 가능</td><td>보장 여부는 구현 의존</td><td>보장 여부는 구현 의존</td></tr><tr><td><strong>프로세스 간 동기화</strong></td><td>지원 (POSIX named/unnamed 등)</td><td>일반적으로 스레드 간, 일부 구현은 IPC 지원</td><td>주로 스레드 간</td></tr><tr><td><strong>장점</strong></td><td>다중 자원 제어 가능, 스레드/프로세스 모두 지원, 조건 변수보다 단순</td><td>구현 단순, 낮은 오버헤드, 명확한 소유권</td><td>조건 기반 동기화 효율적, Busy-wait 방지</td></tr><tr><td><strong>단점</strong></td><td>잘못된 사용 시 데드락/리소스 누수, 소유권 없음으로 인해 설계 주의 필요</td><td>단일 자원만 보호 가능, 데드락 위험</td><td>스푸리어스 웨이크업 처리 필요, 락과 함께 사용해야 함</td></tr><tr><td><strong>대표 API</strong></td><td>POSIX <code>sem_wait/sem_post</code>, Windows <code>ReleaseSemaphore</code></td><td>POSIX <code>pthread_mutex_lock/unlock</code>, Windows <code>CRITICAL_SECTION</code></td><td>POSIX <code>pthread_cond_wait/signal</code>, Java <code>Object.wait/notify</code></td></tr></tbody></table><ul><li><strong>Semaphore</strong> → 자원 개수 제어에 유리, Binary 는 뮤텍스 대체 가능하지만 소유권이 없어서 설계 주의.</li><li><strong>Mutex</strong> → 단일 자원 보호에 특화, 소유권 개념이 있어 안전성 높음.</li><li><strong>Condition Variable</strong> → 조건이 만족될 때까지 효율적으로 대기, 반드시 락과 함께 사용, 스푸리어스 웨이크업 처리 필수.</li></ul><h4 id=사용-시나리오-중심-의사결정-트리>사용 시나리오 중심 의사결정 트리<a hidden class=anchor aria-hidden=true href=#사용-시나리오-중심-의사결정-트리>#</a></h4><pre class=mermaid>graph TD
  A[문제 유형 파악] --&gt; B{조건이 &#39;참&#39;이 될 때까지&lt;br/&gt;대기/깨우기 필요?}
  B -- 예 --&gt; CV[Condition Variable 선택]
  CV --&gt; CV1{조건이 여러 개인가?}
  CV1 -- 예 --&gt; CV2[조건 분리: notEmpty / notFull]
  CV1 -- 아니오 --&gt; CV3[단일 조건 wait / notify]
  CV --&gt; CV4{여러 스레드를&lt;br/&gt;동시에 깨워야 하나?}
  CV4 -- 예 --&gt; CV5[&#34;notify_all (경합 주의)&#34;]
  CV4 -- 아니오 --&gt; CV6[&#34;notify_one (기본)&#34;]
  CV --&gt; CV7{타임아웃/취소 필요?}
  CV7 -- 예 --&gt; CV8[wait_for / wait_until]
  CV7 -- 아니오 --&gt; CV9[표준 wait]

  B -- 아니오 --&gt; C{동시에 허용할 자원 수 &gt; 1 ?}
  C -- 예 --&gt; S[Counting Semaphore]
  S --&gt; S1{&#34;프로세스 간(IPC) 필요한가?&#34;}
  S1 -- 예 --&gt; S2[POSIX named semaphore]
  S1 -- 아니오 --&gt; S3[Unnamed/스레드용 semaphore]

  C -- 아니오 --&gt; D{엄격한 소유권/재진입 보장 필요한가?}
  D -- 예 --&gt; M[Mutex]
  M --&gt; M1{재진입 필요한가?}
  M1 -- 예 --&gt; M2[Reentrant Mutex]
  M1 -- 아니오 --&gt; M3[일반 Mutex]

  D -- 아니오 --&gt; BSEM[Binary Semaphore 또는 Mutex]
  BSEM --&gt; B1{프로세스 간 동기화?}
  B1 -- 예 --&gt; B2[Binary Semaphore 권장]
  B1 -- 아니오 --&gt; B3[Mutex 권장]

  %% 성능 팁(선택)
  CV -. 대기 매우 짧음(수~수백 µs)? .-&gt; P1[&#34;스핀 후 CV 전환(하이브리드)&#34;]
  M  -. 동일 .-&gt; P1
  S  -. 동일 .-&gt; **P1**
</pre><h3 id=핵심-이론-core-theory>핵심 이론 (Core Theory)<a hidden class=anchor aria-hidden=true href=#핵심-이론-core-theory>#</a></h3><h4 id=핵심-설계-원칙>핵심 설계 원칙<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙>#</a></h4><table><thead><tr><th>원칙</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td><strong>원자성 보장</strong></td><td>카운터 변경과 큐 조작은 불가분하게 수행</td><td>Atomic 연산 사용, 커널/하드웨어 지원</td></tr><tr><td><strong>상호 배제</strong></td><td>임계 구역 동시 접근 차단</td><td>Race Condition 방지</td></tr><tr><td><strong>공정성 (기아 방지)</strong></td><td>FIFO 큐 등으로 모든 대기자에게 기회 보장</td><td>Starvation 방지</td></tr><tr><td><strong>진행 보장</strong></td><td>임계 구역이 비면 즉시 대기자 중 하나를 실행</td><td>Busy Waiting 최소화</td></tr><tr><td><strong>교착 방지</strong></td><td>자원 획득 순서, 타임아웃, 우선순위 고려</td><td>Deadlock 예방 알고리즘</td></tr><tr><td><strong>우선순위 역전 방지</strong></td><td>Priority Inheritance 등 메커니즘 적용</td><td>실시간 시스템 안정성</td></tr><tr><td><strong>자원 누수 방지</strong></td><td>비정상 종료 시 세마포어 해제</td><td>OS IPC 관리 규약</td></tr><tr><td><strong>유연성</strong></td><td>Binary/Counting 세마포어 지원</td><td>다양한 동기화 시나리오 적용</td></tr><tr><td><strong>타임아웃/취소 지원</strong></td><td>장기 대기 방지 및 회복 가능성 제공</td><td><code>sem_timedwait</code> 등 표준 API 지원</td></tr></tbody></table><ul><li><strong>이론적 필수 원칙</strong>: 원자성, 상호 배제, 공정성, 진행 보장, 교착 방지</li><li><strong>실무 보완 원칙</strong>: 우선순위 역전 방지, 자원 누수 방지, 타임아웃/취소 지원, 유연성 확보</li></ul><h4 id=기본-원리-및-동작-메커니즘>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘>#</a></h4><h5 id=기본-원리>기본 원리<a hidden class=anchor aria-hidden=true href=#기본-원리>#</a></h5><table><thead><tr><th>항목</th><th>내용</th><th>핵심 포인트</th><th>주의사항</th></tr></thead><tbody><tr><td>상태</td><td>정수 카운터와 대기 큐</td><td>카운터는 사용 가능 자원 수</td><td>음수 금지, 불변식 유지</td></tr><tr><td>P(wait)</td><td>값>0 이면 1 감소 후 통과, 0 이면 큐에 대기</td><td>임계 진입 이전에 <strong>원자적 검사 - 감소</strong></td><td>스핀 대신 블로킹 사용 (플랫폼 의존)</td></tr><tr><td>V(signal)</td><td>값 1 증가, 대기자가 있으면 1 명 깨움</td><td><strong>증가→깨움</strong> 순서</td><td>과도한 release 금지 (논리 오류)</td></tr><tr><td>유형</td><td>Binary / Counting</td><td>Binary=뮤텍스 유사, Counting=N 자원</td><td>Binary 로 소유권·재진입성 혼동 금지</td></tr><tr><td>공정성</td><td>깨어남 순서 정책</td><td>FIFO/우선순위는 구현 의존</td><td>기아 방지 필요 시 정책 선택</td></tr><tr><td>확장</td><td>try/timeout/cancel</td><td>무한 대기 방지, 탄력성 확보</td><td>타임아웃 경로의 롤백 처리</td></tr><tr><td>안전성</td><td>원자성·가시성</td><td>커널·원자 연산으로 보장</td><td>우선순위 역전 시 PI 고려</td></tr></tbody></table><p>세마포어는 " 카운터 + 대기 큐 " 로 표현되는 상태 기계다.<br>P 는 <strong>검사 - 감소 - 통과/대기</strong>를 원자적으로, V 는 <strong>증가 - 깨움</strong>을 원자적으로 수행해 자원 수를 보존한다.<br>공정성·타임아웃·PI(우선순위 상속) 는 구현/요구 사항에 맞춰 선택한다.</p><h5 id=동작-메커니즘>동작 메커니즘<a hidden class=anchor aria-hidden=true href=#동작-메커니즘>#</a></h5><pre class=mermaid>flowchart TD
  A[스레드가 P 호출] --&gt; B{세마포어 값 &gt; 0?}
  B -- 예 --&gt; C[값 1 감소]
  C --&gt; D[임계 구역 진입]
  D --&gt; E[V 호출]
  E --&gt; F[값 1 증가]
  F --&gt; G{대기 큐 비었나?}
  G -- 예 --&gt; H[종료]
  G -- 아니오 --&gt; I[대기 스레드 1명 깨움]
  I --&gt; H

  B -- 아니오 --&gt; Q[대기 큐에 삽입 후 블록]
  Q --&gt; R[다른 스레드의 V를 대기]
  R --&gt; I
</pre><p>P 는 <strong>값 검사→감소 또는 블록</strong>으로 흐르고, V 는 **값 증가→대기자 깨움 (있으면)**으로 흐른다.</p><ul><li><strong>P 연산 (Wait/Acquire)</strong>: 세마포어 값을 확인하고, 0 보다 크면 감소시키고 진행, 그렇지 않으면 대기</li><li><strong>V 연산 (Signal/Release)</strong>: 세마포어 값을 증가시키고 대기 중인 프로세스가 있으면 깨움<br>이 두 연산은 커널/원자적 연산으로 보호되어 경쟁 조건을 막고, 깨어난 스레드는 임계 구역 진입으로 이어진다. 공정성·타임아웃·우선순위 상속 등은 구현 정책에 따라 추가된다.</li></ul><h5 id=세마포어-counting-동작-시퀀스-acquireuserelease>세마포어 (Counting) 동작 시퀀스: Acquire–Use–Release<a hidden class=anchor aria-hidden=true href=#세마포어-counting-동작-시퀀스-acquireuserelease>#</a></h5><pre class=mermaid>sequenceDiagram
  participant T as Thread
  participant S as Semaphore(count=k)
  participant R as ResourcePool
  T-&gt;&gt;S: acquire()
  alt count &gt; 0
    S--&gt;&gt;T: grant &amp; count--
    T-&gt;&gt;R: use()
  else count == 0
    S--&gt;&gt;T: enqueue(wait)
  end
  T-&gt;&gt;S: release()
  S--&gt;&gt;Next: dequeue &amp; grant
</pre><h4 id=아키텍처-및-구성-요소>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소>#</a></h4><p>세마포어 (Semaphore) 는 <strong>동시성 제어</strong>를 위한 핵심 동기화 프리미티브로,<br><strong>자원 접근 횟수 제어 + 대기 큐 관리 + 원자 연산 보장</strong>이라는 세 가지 축으로 구성된다.<br>운영체제 수준에서는 커널 자료구조와 스케줄러 연동을 통해 이를 보장한다.</p><pre class=mermaid>flowchart TB
    subgraph &#34;세마포어&#34;
        A[&#34;카운터&lt;br/&gt;(Permit 수)&#34;]
        B[&#34;대기 큐&lt;br/&gt;(FIFO/Priority)&#34;]
        C[&#34;원자 연산 모듈&lt;br/&gt;(P/V)&#34;]
    end

    subgraph &#34;스레드/프로세스&#34;
        T1[Thread 1]
        T2[Thread 2]
        T3[Thread 3]
    end

    %% 동작 흐름
    T1 --&gt;|P 연산 요청| C
    T2 --&gt;|P 연산 요청| C
    T3 --&gt;|V 연산 요청| C

    C --&gt;|카운터 감소/증가| A
    C --&gt;|대기 스레드 추가/제거| B
    A --&gt;|값=0이면 대기| B
    B --&gt;|자원 해제 시 스레드 깨움| C
</pre><h5 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h5><table><thead><tr><th>구분</th><th>구성 요소</th><th>설명</th><th>역할</th><th>기능</th><th>특징</th></tr></thead><tbody><tr><td><strong>필수</strong></td><td>카운터 (Counter / Permit)</td><td>사용 가능한 자원 개수를 나타내는 정수 값</td><td>자원 사용량 추적</td><td>P 연산 시 감소, V 연산 시 증가</td><td>음수가 되면 대기, 0 이상이면 즉시 접근 가능</td></tr><tr><td><strong>필수</strong></td><td>대기 큐 (Wait Queue)</td><td>자원을 기다리는 스레드 목록</td><td>대기 스레드 순서 관리</td><td>자원 해제 시 큐에서 스레드 깨움</td><td>FIFO 또는 Priority 정책 적용 가능</td></tr><tr><td><strong>필수</strong></td><td>원자 연산 (Atomic Operations)</td><td>P/V 연산과 큐 조작을 불가분하게 처리</td><td>동시 접근 충돌 방지</td><td>락·CAS(Compare-And-Swap) 사용</td><td>커널 또는 라이브러리 수준에서 보장</td></tr><tr><td><strong>선택</strong></td><td>공정성 (Fairness)</td><td>FIFO 방식으로 순서 보장</td><td>기아 상태 방지</td><td>순서대로 큐에서 꺼냄</td><td>Java 의 <code>fair=true</code> 옵션 등</td></tr><tr><td><strong>선택</strong></td><td>우선순위 (Priority)</td><td>중요도 높은 스레드 우선 처리</td><td>긴급 작업 보장</td><td>우선순위 큐 사용</td><td>실시간 시스템에 유용</td></tr><tr><td><strong>선택</strong></td><td>타임아웃 (Timeout)</td><td>대기 시간 제한</td><td>무한 대기 방지</td><td>acquire(timeout=…)</td><td>실패 시 graceful fallback</td></tr></tbody></table><h4 id=주요-기능과-역할>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>기능</td><td>P 연산 (wait/down)</td><td>세마포어 값을 1 감소시키고, 값이 0 미만이면 호출 스레드/프로세스를 대기 상태로 전환</td></tr><tr><td></td><td>V 연산 (signal/up)</td><td>세마포어 값을 1 증가시키고, 대기 중인 스레드/프로세스를 깨움</td></tr><tr><td></td><td>자원 카운팅</td><td>사용 가능한 자원 개수를 추적하여 동시 접근 가능 수 관리</td></tr><tr><td></td><td>대기 관리</td><td>자원 부족 시 큐에 안전하게 대기시키고 스케줄러와 연동</td></tr><tr><td></td><td>비동기 제어</td><td><code>tryAcquire</code>, <code>timed wait</code> 등을 통한 블로킹 회피</td></tr><tr><td></td><td>IPC 지원</td><td>Named/Unnamed 세마포어로 프로세스 간 동기화</td></tr><tr><td>역할</td><td>상호 배제 제공</td><td>임계 구역 동시 접근 차단</td></tr><tr><td></td><td>자원 할당 조정</td><td>제한된 자원의 공정하고 효율적인 분배</td></tr><tr><td></td><td>흐름 제어</td><td>특정 조건 충족 시에만 실행 흐름 진행</td></tr><tr><td></td><td>데드락·기아 방지</td><td>올바른 자원 할당 순서와 정책 유지</td></tr><tr><td></td><td>성능 최적화</td><td>Busy-wait 최소화, 커널 모드 전환 감소</td></tr><tr><td></td><td>우선순위 기반 동기화</td><td>실시간 시스템에서 우선순위 큐를 사용해 고우선순위 작업 우선 처리</td></tr></tbody></table><h4 id=기능과-역할-관계>기능과 역할 관계<a hidden class=anchor aria-hidden=true href=#기능과-역할-관계>#</a></h4><table><thead><tr><th>기능</th><th>해당 역할</th></tr></thead><tbody><tr><td>P 연산 (wait/down)</td><td>상호 배제 제공, 흐름 제어</td></tr><tr><td>V 연산 (signal/up)</td><td>자원 할당 조정, 흐름 제어</td></tr><tr><td>자원 카운팅</td><td>자원 할당 조정, 데드락·기아 방지</td></tr><tr><td>대기 관리</td><td>상호 배제 제공, 데드락·기아 방지</td></tr><tr><td>비동기 제어</td><td>성능 최적화, 흐름 제어</td></tr><tr><td>IPC 지원</td><td>프로세스 간 동기화, 자원 할당 조정</td></tr></tbody></table><p>세마포어의 주요 기능은 <strong>자원 상태를 관리하고 대기·신호 메커니즘을 통해 실행 흐름을 제어</strong>하는 것이다. 이를 통해 <strong>상호 배제, 자원 분배, 데드락 방지, 성능 최적화</strong>가 가능하다. 또한, 비동기 제어·IPC·우선순위 기반 대기 같은 확장 기능을 활용하면 실시간·고성능 시스템에도 적합하게 설계할 수 있다.</p><h3 id=특성-분석-characteristics-analysis>특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#특성-분석-characteristics-analysis>#</a></h3><h4 id=장점-및-이점>장점 및 이점<a hidden class=anchor aria-hidden=true href=#장점-및-이점>#</a></h4><p>세마포어는 단순하고 범용적인 동기화 기법으로, 상호배제와 경쟁 조건 방지, 유연한 병렬성 관리, 공정성 옵션, 비동기 API 지원, IPC 활용, 플랫폼 간 호환성, 효율적 자원 제어 등의 장점을 가진다.<br>현대 환경에서는 멀티코어·비동기·분산 시스템에서 확장 가능하며, 언어·운영체제 표준에 폭넓게 내장되어 있어 개발·운영 양측에서 안정성과 생산성을 높인다.</p><table><thead><tr><th>항목</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td>상호배제와 경쟁 조건 방지</td><td>임계 구역 동시 진입 차단, 데이터 무결성 보장</td><td>wait(P)/signal(V) 원자 연산, OS 수준 지원</td></tr><tr><td>유연한 자원 및 병렬성 관리</td><td>N 개 자원 동시 접근 제어, 스로틀링 가능</td><td>Counting 세마포어 메커니즘</td></tr><tr><td>범용성</td><td>스레드·프로세스, IPC 모두 지원</td><td>커널·유저 레벨 구현</td></tr><tr><td>공정성 보장</td><td>FIFO/우선순위 기반 접근 순서 제어</td><td>Java <code>fair=true</code>, POSIX sem 옵션</td></tr><tr><td>비동기·비블로킹 지원</td><td>이벤트 루프·비동기 API 와 결합 가능</td><td><code>.NET SemaphoreSlim.WaitAsync</code></td></tr><tr><td>IPC 활용</td><td>프로세스 간 자원 공유 가능</td><td>POSIX named/unnamed semaphores</td></tr><tr><td>플랫폼/언어 간 호환성</td><td>다양한 OS·언어에서 동일 개념 사용 가능</td><td>POSIX 표준, System V, Java/Python API</td></tr><tr><td>효율성</td><td>바쁜 대기 없이 블로킹 대기 처리</td><td>커널 수준 스케줄링</td></tr></tbody></table><p>세마포어는 <strong>자원 접근 제어와 동시성 문제 해결에 필수적인 범용 동기화 도구</strong>다. 카운팅 메커니즘을 통해 <strong>병렬성 제어</strong>와 <strong>상호배제</strong>를 보장하며, 공정성·비동기 지원·IPC 활용·다양한 플랫폼 호환성을 갖춘다. 커널 수준의 효율적인 대기 처리로 성능 저하를 최소화하고, 멀티스레드·분산·비동기 환경까지 확장 가능하다.</p><h4 id=단점-및-제약사항과-해결방안>단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#단점-및-제약사항과-해결방안>#</a></h4><p>세마포어는 강력한 동기화 도구지만, <strong>설계·구현·운영</strong> 과정에서 다음과 같은 위험과 제약이 존재하며, 이를 해결하기 위한 구조적·정책적 보완이 필요하다.</p><table><thead><tr><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>교착상태 (Deadlock)</td><td>여러 세마포어를 순환 대기하며 요청 시 시스템 정지</td><td>자원 획득 순서 고정, 타임아웃 설정</td><td>Lock-free 구조, STM</td></tr><tr><td>기아 상태 (Starvation)</td><td>비공정 정책 시 후발 스레드 무한 대기</td><td>FIFO 큐, 공정 모드 (fair=true)</td><td>공정 락, Condition Variable</td></tr><tr><td>오버릴리스 (Over-release)</td><td>release 횟수 초과로 permit 왜곡</td><td>BoundedSemaphore 사용</td><td>CountDownLatch, 래치</td></tr><tr><td>성능 오버헤드</td><td>커널 모드 전환, 빈번한 대기/깨움 연산</td><td>SemaphoreSlim, 연산 최소화</td><td>락프리 자료구조</td></tr><tr><td>디버깅 복잡성</td><td>동시성 버그 추적·재현 어려움</td><td>로깅·모니터링 강화, 정적 분석</td><td>액터 모델, CSP</td></tr><tr><td>분산 환경 제약</td><td>단일 메모리 설계로 네트워크 환경 불안정 시 안전성 저하</td><td>분산 세마포어 (ZooKeeper, etcd)</td><td>Redis Redlock(주의)</td></tr><tr><td>우선순위 역전</td><td>낮은 우선순위 작업이 높은 우선순위 작업을 지연</td><td>Priority Inheritance/Ceiling</td><td>RTOS 우선순위 프로토콜</td></tr></tbody></table><p>세마포어는 임계 구역 보호와 자원 관리에 효과적이지만,<br><strong>교착상태·기아·성능·분산 안정성·우선순위 역전</strong> 같은 문제가 실무에서 발생한다.<br>이 문제들은 <strong>정책적 설계 (자원 순서·공정 모드·타임아웃)</strong> 와 <strong>구조적 대안 (락프리·분산 세마포어·우선순위 상속)</strong> 을 적용하면 완화할 수 있다.<br>또한, 프로그래밍 시 <strong>P/V 연산 쌍 보장, 예외 안전성 확보, 로깅 및 모니터링 강화</strong>가 필수다.</p><h4 id=트레이드오프-관계-분석>트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석>#</a></h4><table><thead><tr><th>비교 축 (A vs B)</th><th>A 선택 장점</th><th>A 선택 단점</th><th>B 선택 장점</th><th>B 선택 단점</th><th>고려 기준/권장 판단</th></tr></thead><tbody><tr><td><strong>FIFO 공정성 vs 비공정 (스루풋 우선)</strong></td><td>기아 방지, 지연 분포 안정</td><td>큐 관리 오버헤드, 처리량↓</td><td>처리량↑, 간단한 구현</td><td>편향·기아 가능</td><td>실시간/사용자 작업은 <strong>FIFO</strong>, 백엔드는 <strong>비공정 + 모니터링</strong></td></tr><tr><td><strong>Binary vs Counting</strong></td><td>단순·명확한 상호배제, 오류 표면화 쉬움</td><td>동시성 상한 표현 불가</td><td>동시성 상한 관리, 리소스 풀 모델링</td><td>오버릴리스/이중 반납 리스크</td><td>단일 자원=<strong>Binary</strong>, N 자원=<strong>Counting(랩퍼로 안전장치)</strong></td></tr><tr><td><strong>블로킹 wait vs try/timed wait</strong></td><td>코드 단순, 오버헤드↓</td><td>장애 전파·응답성 저하</td><td>응답성↑, 장애 격리·백프레셔</td><td>리트라이·타임아웃 처리 복잡</td><td>서비스 SLO 가 있으면 <strong>타임아웃 기반</strong>, 내부 워커는 <strong>블로킹</strong></td></tr><tr><td><strong>커널 세마포어 vs 유저 공간 (경량)</strong></td><td>IPC 용이, 견고, 공정성 옵션</td><td>시스템 콜 비용</td><td>전환 오버헤드↓, 경량</td><td>프로세스 간 공유 어려움</td><td>프로세스 간=<strong>커널</strong>, 스레드 내부=<strong>유저 공간 (SemaphoreSlim 등)</strong></td></tr><tr><td><strong>단일 공유 세마포어 vs 샤딩 (파티셔닝)</strong></td><td>일관성·단순 운영</td><td>핫스팟 경합, p99↑</td><td>경합 분산, 스케일↑</td><td>복잡도↑, 재분배 필요</td><td>고부하·키 스큐 있으면 <strong>샤딩</strong>, 소규모는 <strong>단일</strong></td></tr><tr><td><strong>세마포어 vs 뮤텍스 (상호배제)</strong></td><td>동시성 상한·IPC 용이</td><td>소유권 부재로 오남용 위험</td><td>소유권/RAII 로 안전</td><td>N>1 표현 불가</td><td>단일 임계구역=<strong>뮤텍스</strong>, 자원 수 제어=<strong>세마포어</strong></td></tr><tr><td><strong>세마포어 vs 조건 변수 (CV)</strong></td><td>카운팅·수량 제어 직관</td><td>조건 기반 이벤트엔 부적합</td><td>조건 대기·이벤트 모델 적합</td><td>수량 제어엔 부적합, 스푸리어스 처리 필요</td><td>" 수량 &ldquo;=<strong>세마포어</strong>, " 상태/조건 &ldquo;=<strong>CV</strong></td></tr><tr><td><strong>공정성 (FIFO/우선순위) vs 처리량 최적화</strong></td><td>SLA·실시간성 보장</td><td>컨텍스트 스위치↑</td><td>캐시·처리량 최적화</td><td>기아/우선순위 역전</td><td>RT 는 <strong>우선순위/상속</strong>, 일반은 <strong>처리량 우선 + 모니터링</strong></td></tr><tr><td><strong>단순 정책 vs 광범위 검증/가드</strong></td><td>경량·저지연</td><td>버그 잠복 위험</td><td>안전·가시성↑, 회복 용이</td><td>오버헤드↑</td><td>외부 노출 경로는 <strong>가드 추가</strong>, 내부 전용은 <strong>단순 정책</strong></td></tr></tbody></table><p>세마포어 설계는 <strong>무엇을 최적화할지</strong>를 먼저 정해야 한다.</p><ul><li>공정성 (SLA) 인지, 처리량인지, 응답성인지.</li><li>&ldquo;<strong>수량 제어</strong>&rdquo; 가 목적이면 세마포어, &ldquo;<strong>상태/조건 대기</strong>&rdquo; 는 조건 변수, &ldquo;<strong>단일 임계구역 보호</strong>&rdquo; 는 뮤텍스를 고르는 게 기본 원칙이다.</li><li>커널/유저 공간, 블로킹/타임아웃, 단일/샤딩 등 세부 선택은 <strong>SLO, 부하 패턴, IPC 필요성</strong>을 기준으로 결정하면 된다.</li></ul><pre class=mermaid>graph LR
    A[단순성] &lt;--&gt; B[기능성]
    C[성능] &lt;--&gt; D[안전성]
    E[메모리 사용량] &lt;--&gt; F[처리량]
    G[공정성] &lt;--&gt; H[효율성]
    
    A -.-&gt;|제약| I[복잡한 동기화 불가]
    B -.-&gt;|제약| J[구현 복잡도 증가]
    C -.-&gt;|제약| K[동기화 오버헤드]
    D -.-&gt;|제약| L[성능 저하]
</pre><h3 id=구현-및-분류-implementation--classification>구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#구현-및-분류-implementation--classification>#</a></h3><h4 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h4><table><thead><tr><th>분류</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td>하드웨어/저수준</td><td>원자적 CPU 명령어로 구현되는 기본 동기화 빌딩블록</td><td>CAS/TAS, 메모리 배리어</td><td>원자적 증감·플래그 전환</td><td>커널/런타임의 상위 세마포어 구현 기반</td><td>커널 락, 런타임 프리미티브</td><td>최고 성능·복잡도 높음·휴대성 제한</td></tr><tr><td>OS 커널 세마포어</td><td>시스템콜로 노출되는 커널 객체</td><td>카운터, 대기 큐, 스케줄러 연동</td><td>부족 시 슬립, 신호 시 웨이터 깨움</td><td>견고한 동기화·IPC 지원</td><td>POSIX <code>sem_*</code>, Win Semaphore</td><td>공정성 옵션 가능, 타임아웃, IPC 네임 관리</td></tr><tr><td>사용자 공간 라이브러리</td><td>프로세스 내 경량 동기화</td><td>락 + 조건변수/원자연산</td><td>유저레벨에서 카운팅·대기</td><td>문맥전환 비용↓</td><td>.NET <code>SemaphoreSlim</code> 등</td><td>경량·비동기 API·IPC X</td></tr><tr><td>언어 런타임/고급 API</td><td>언어 표준이 제공하는 세마포어</td><td>스레드/태스크 런타임</td><td>카운트 기반 허가/타임아웃/취소</td><td>스로틀링·풀·백프레셔</td><td>Python/Go/JS/.NET</td><td>가중치·공정성·캔슬러 통합 가능</td></tr><tr><td>분산/외부 코디네이터</td><td>외부 일관 스토어로 전역 허가 관리</td><td>ZK 노드/세션, Redis 키</td><td>리스/세션 + 리더/큐 패턴</td><td>다중 인스턴스 전역 제한</td><td>ZK/etcd/Redis</td><td>네트워크·시계 가정 중요, 지연↑, 신뢰성↑</td></tr></tbody></table><ul><li><strong>프로세스 간/컨테이너 경계</strong>: POSIX <strong>named</strong> 세마포어.</li><li><strong>스레드 내부 + 비동기</strong>: <code>.NET SemaphoreSlim</code> / Node 프로미스 세마포어.</li><li><strong>요청 비용 편차 큼</strong>: Go <strong>Weighted</strong>.</li><li><strong>안전 가드 필요</strong>: Python <strong>BoundedSemaphore</strong>.</li></ul><h5 id=python---연결-수-제한-기본바운디드>Python - 연결 수 제한 (기본/바운디드)<a hidden class=anchor aria-hidden=true href=#python---연결-수-제한-기본바운디드>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 동시 5개까지 허용</span>
</span></span><span class=line><span class=cl><span class=n>sem</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>BoundedSemaphore</span><span class=p>(</span><span class=n>value</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>acquire_slot</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># tryAcquire 유사: timeout 없으면 블로킹</span>
</span></span><span class=line><span class=cl>    <span class=n>ok</span> <span class=o>=</span> <span class=n>sem</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=n>timeout</span><span class=p>)</span> <span class=k>if</span> <span class=n>timeout</span> <span class=k>else</span> <span class=n>sem</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>ok</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>TimeoutError</span><span class=p>(</span><span class=s2>&#34;No permit within timeout&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>yield</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># BoundedSemaphore는 과다 release 시 예외로 잡아줌</span>
</span></span><span class=line><span class=cl>        <span class=n>sem</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_request</span><span class=p>(</span><span class=n>i</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>acquire_slot</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>0.2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=c1># 임계 구역: 실제 작업</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.05</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;handled </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>TimeoutError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;throttled </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>handle_request</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=go---가중-세마포어-요청-비용-반영>Go - 가중 세마포어 (요청 비용 반영)<a hidden class=anchor aria-hidden=true href=#go---가중-세마포어-요청-비용-반영>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27>27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28>28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29>29</a>
</span><span class=lnt id=hl-7-30><a class=lnlinks href=#hl-7-30>30</a>
</span><span class=lnt id=hl-7-31><a class=lnlinks href=#hl-7-31>31</a>
</span><span class=lnt id=hl-7-32><a class=lnlinks href=#hl-7-32>32</a>
</span><span class=lnt id=hl-7-33><a class=lnlinks href=#hl-7-33>33</a>
</span><span class=lnt id=hl-7-34><a class=lnlinks href=#hl-7-34>34</a>
</span><span class=lnt id=hl-7-35><a class=lnlinks href=#hl-7-35>35</a>
</span><span class=lnt id=hl-7-36><a class=lnlinks href=#hl-7-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// go get golang.org/x/sync/semaphore</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;context&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;fmt&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;golang.org/x/sync/semaphore&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 총 허용 가중치 10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>sem</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>semaphore</span><span class=p>.</span><span class=nf>NewWeighted</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>ctx</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 비용이 다른 작업들</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>jobs</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=kt>int64</span><span class=p>{</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>w</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>jobs</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>go</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>id</span><span class=w> </span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=nx>weight</span><span class=w> </span><span class=kt>int64</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=c1>// 타임아웃으로 응답성 보장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>cctx</span><span class=p>,</span><span class=w> </span><span class=nx>cancel</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nf>WithTimeout</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=mi>200</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>defer</span><span class=w> </span><span class=nf>cancel</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>sem</span><span class=p>.</span><span class=nf>Acquire</span><span class=p>(</span><span class=nx>cctx</span><span class=p>,</span><span class=w> </span><span class=nx>weight</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;throttled&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=c1>// 임계 구역</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>50</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>sem</span><span class=p>.</span><span class=nf>Release</span><span class=p>(</span><span class=nx>weight</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;done&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}(</span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>w</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>#####.NET (C#) - 비동기 세마포어로 API 스로틀링</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Net.Http</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Threading</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Threading.Tasks</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ThrottledClient</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>SemaphoreSlim</span> <span class=n>_sem</span> <span class=p>=</span> <span class=k>new</span> <span class=n>SemaphoreSlim</span><span class=p>(</span><span class=m>8</span><span class=p>);</span> <span class=c1>// 동시 8</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>HttpClient</span> <span class=n>_http</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HttpClient</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>GetAsync</span><span class=p>(</span><span class=kt>string</span> <span class=n>url</span><span class=p>,</span> <span class=n>CancellationToken</span> <span class=n>ct</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 타임아웃/취소 가능</span>
</span></span><span class=line><span class=cl>        <span class=k>using</span> <span class=nn>var</span> <span class=n>linked</span> <span class=p>=</span> <span class=n>CancellationTokenSource</span><span class=p>.</span><span class=n>CreateLinkedTokenSource</span><span class=p>(</span><span class=n>ct</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>linked</span><span class=p>.</span><span class=n>CancelAfter</span><span class=p>(</span><span class=n>TimeSpan</span><span class=p>.</span><span class=n>FromMilliseconds</span><span class=p>(</span><span class=m>300</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>_sem</span><span class=p>.</span><span class=n>WaitAsync</span><span class=p>(</span><span class=n>linked</span><span class=p>.</span><span class=n>Token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>await</span> <span class=n>_http</span><span class=p>.</span><span class=n>GetStringAsync</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>linked</span><span class=p>.</span><span class=n>Token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>_sem</span><span class=p>.</span><span class=n>Release</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=nodejs---프로미스-기반-카운팅-세마포어>Node.js - 프로미스 기반 카운팅 세마포어<a hidden class=anchor aria-hidden=true href=#nodejs---프로미스-기반-카운팅-세마포어>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22>22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23>23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24>24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25>25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26>26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27>27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28>28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29>29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30>30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31>31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32>32</a>
</span><span class=lnt id=hl-9-33><a class=lnlinks href=#hl-9-33>33</a>
</span><span class=lnt id=hl-9-34><a class=lnlinks href=#hl-9-34>34</a>
</span><span class=lnt id=hl-9-35><a class=lnlinks href=#hl-9-35>35</a>
</span><span class=lnt id=hl-9-36><a class=lnlinks href=#hl-9-36>36</a>
</span><span class=lnt id=hl-9-37><a class=lnlinks href=#hl-9-37>37</a>
</span><span class=lnt id=hl-9-38><a class=lnlinks href=#hl-9-38>38</a>
</span><span class=lnt id=hl-9-39><a class=lnlinks href=#hl-9-39>39</a>
</span><span class=lnt id=hl-9-40><a class=lnlinks href=#hl-9-40>40</a>
</span><span class=lnt id=hl-9-41><a class=lnlinks href=#hl-9-41>41</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Semaphore</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>permits</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>permits</span> <span class=o>=</span> <span class=nx>permits</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>queue</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>acquire</span><span class=p>(</span><span class=nx>timeoutMs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>permits</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span> <span class=k>this</span><span class=p>.</span><span class=nx>permits</span><span class=o>--</span><span class=p>;</span> <span class=k>return</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>timer</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>ticket</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>timer</span><span class=p>);</span> <span class=nx>resolve</span><span class=p>();</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>ticket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>timeoutMs</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>timer</span> <span class=o>=</span> <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>idx</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>ticket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>idx</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=k>this</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=nx>idx</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>reject</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;timeout&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=nx>timeoutMs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>release</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>next</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>shift</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>next</span><span class=p>();</span> <span class=c1>// 깨우기
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>permits</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예: 동시 4개 파일 처리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>sem</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Semaphore</span><span class=p>(</span><span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>work</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>sem</span><span class=p>.</span><span class=nx>acquire</span><span class=p>(</span><span class=mi>200</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>r</span> <span class=p>=&gt;</span> <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=mi>50</span><span class=p>));</span> <span class=c1>// 임계 구역
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;done&#34;</span><span class=p>,</span> <span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>{</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;throttled&#34;</span><span class=p>,</span> <span class=nx>id</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>finally</span> <span class=p>{</span> <span class=nx>sem</span><span class=p>.</span><span class=nx>release</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=nx>i</span><span class=o>&lt;</span><span class=mi>12</span><span class=p>;</span><span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=nx>work</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=분류-기준에-따른-유형-구분>분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-유형-구분>#</a></h4><p>세마포어는 허가 수 (permit 수), 블로킹 방식, 사용 범위, 구현 수준, 가중치 지원 여부 등 다양한 기준으로 분류된다. Binary/Counting 이 기본형이며, Spin/Sleep 같은 대기 방식, Named/Unnamed 또는 분산 환경 적용 여부, 그리고 하드웨어·소프트웨어 구현 수준에 따라 특성이 달라진다.<br>현대 언어와 플랫폼에서는 Weighted, Async 지원 세마포어도 제공하며, 로컬·IPC·분산 환경까지 확장되어 쓰인다.</p><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>사용 사례</th><th>성능 특성</th></tr></thead><tbody><tr><td><strong>허가 수</strong></td><td>Binary Semaphore</td><td>0/1 만 허용, 단일 자원 접근 제어</td><td>뮤텍스 대체, 임계 구역 보호</td><td>단순, 낮은 오버헤드</td></tr><tr><td><strong>허가 수</strong></td><td>Counting Semaphore</td><td>0~N 범위, 다중 자원 제어</td><td>리소스 풀, 스레드 풀 제한</td><td>유연성 높음, 관리 복잡</td></tr><tr><td><strong>허가 수</strong></td><td>Weighted Semaphore</td><td>요청마다 가중치 지정</td><td>대량 자원 예약</td><td>복잡성 증가, 유연성 강화</td></tr><tr><td><strong>블로킹 방식</strong></td><td>Spin Semaphore</td><td>CPU 스핀 대기</td><td>짧은 대기, 실시간 처리</td><td>CPU 사용률 높음</td></tr><tr><td><strong>블로킹 방식</strong></td><td>Sleep Semaphore</td><td>컨텍스트 스위치로 대기</td><td>일반 동기화</td><td>CPU 사용률 낮음</td></tr><tr><td><strong>범위</strong></td><td>Local Semaphore</td><td>프로세스 내부 스레드 동기화</td><td>멀티스레드 앱</td><td>빠름, 범위 제한</td></tr><tr><td><strong>범위</strong></td><td>IPC Semaphore (Named/Unnamed)</td><td>프로세스 간 동기화</td><td>POSIX, System V IPC</td><td>OS API 필요</td></tr><tr><td><strong>범위</strong></td><td>Distributed Semaphore</td><td>네트워크 자원 동기화</td><td>ZooKeeper, Redis</td><td>네트워크 지연 영향</td></tr><tr><td><strong>구현 수준</strong></td><td>Hardware Semaphore</td><td>하드웨어 명령 기반</td><td>실시간, 임베디드</td><td>최고 성능</td></tr><tr><td><strong>구현 수준</strong></td><td>Software Semaphore</td><td>OS/언어 API 구현</td><td>범용 OS, 애플리케이션</td><td>이식성 높음</td></tr></tbody></table><h3 id=실무-적용-practical-application>실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#실무-적용-practical-application>#</a></h3><h4 id=실제-도입-사례>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례>#</a></h4><p>세마포어는 다양한 환경에서 <strong>자원 동시성 제한과 동기화</strong>를 위해 활용된다.<br>단일 서버 내부 동기화부터 대규모 클러스터까지 범위가 넓고, API 호출 제한·리소스 풀 관리·분산 슬롯 제어 등에서 안정성과 효율성을 동시에 달성한다.</p><table><thead><tr><th>구분</th><th>사례</th><th>조합 기술</th><th>효과 분석</th></tr></thead><tbody><tr><td>웹/API 호출 제한</td><td>외부 API 스로틀링</td><td>세마포어 + 타임아웃 + Fail-Fast</td><td>과도한 요청 차단, 외부 서비스 안정성 보장</td></tr><tr><td>DB 커넥션 풀 제한</td><td>JDBC/ODBC 풀 보호</td><td>카운팅 세마포어 + 공정 모드</td><td>동시 연결 수 제한, 기아 방지</td></tr><tr><td>파일 다운로드 제어</td><td>다운로드 매니저</td><td>세마포어 + 비동기 HTTP</td><td>네트워크 대역폭 최적화</td></tr><tr><td>프린터 큐 동기화</td><td>다중 출력 장치 제어</td><td>세마포어 + 장치 드라이버</td><td>출력 작업 충돌 방지</td></tr><tr><td>멀티테넌트 워커 제한</td><td>테넌트별 쿼터</td><td>가중 세마포어 (Weighted)</td><td>테넌트 간 자원 분배 공정성</td></tr><tr><td>분산 환경 작업 슬롯</td><td>클러스터 전역 제어</td><td>Curator InterProcessSemaphoreV2, Redis</td><td>여러 노드 간 안전한 동시 작업 제한</td></tr><tr><td>실시간 시스템</td><td>센서 데이터 동기화</td><td>RTOS 세마포어 + Priority Inheritance</td><td>우선순위 역전 방지, 데이터 무결성 보장</td></tr><tr><td>IoT/임베디드</td><td>ISR- 메인 루프 동기화</td><td>세마포어 + 인터럽트 제어</td><td>버퍼 접근 충돌 방지</td></tr></tbody></table><p>세마포어는 단순한 임계 구역 보호 이상의 역할을 하며,<br><strong>동시성 제어, 자원 제한, 공정성 보장</strong>이라는 세 가지 핵심 목적을 달성합니다.</p><ul><li><strong>단일 서버 환경</strong>: 주로 DB 연결, 네트워크 요청, 장치 접근 제한에 사용.</li><li><strong>분산 환경</strong>: 클러스터 전역에서 작업 슬롯을 관리하며, ZooKeeper·Redis 등으로 세션 일관성 확보.</li><li><strong>실시간·IoT 환경</strong>: 하드웨어 자원과 실시간 데이터 접근 충돌 방지.</li><li><strong>패턴의 특징</strong>: 환경과 요구사항에 맞게 공정성 옵션, 가중치, 타임아웃, 우선순위 상속 등 정책 조합이 필요.</li></ul><h4 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h4><h5 id=사례-외부-번역-api-호출-폭주-방지>사례: 외부 번역 API 호출 폭주 방지<a hidden class=anchor aria-hidden=true href=#사례-외부-번역-api-호출-폭주-방지>#</a></h5><p><strong>시나리오</strong>: " 외부 번역 API&rdquo; 호출 폭주 방지 (동시 5 건 제한, 500ms 타임아웃)</p><p><strong>시스템 구성</strong></p><ul><li>API 게이트웨이 → 애플리케이션 → 외부 번역 API</li><li>세마포어: 애플리케이션 레벨 동시성 상한</li></ul><p><strong>시스템 구성 다이어그램</strong></p><pre class=mermaid>graph TB
  G[API Gateway] --&gt; A[App Service]
  A -- acquire(permit) --&gt; S[[&#34;Semaphore(5)&#34;]]
  A --&gt;|call| X[External Translation API]
  X --&gt; A
  A -- release --&gt; S
</pre><p><strong>Workflow</strong></p><ol><li>요청 수신 → <code>acquire(timeout)</code></li><li>허가 실패 시 즉시 429/503</li><li>성공 시 외부 API 호출</li><li>완료/실패 모두 <code>release</code> 보장</li></ol><p><strong>핵심 역할</strong></p><ul><li>세마포어: <strong>동시 외부 호출 수 상한</strong>으로 의존성 보호</li></ul><p><strong>유무 비교</strong></p><ul><li>도입 전: 순단 시 외부 API 5xx 급증, 큐적체</li><li>도입 후: 고정 동시성으로 안정적 지연/에러율</li></ul><p><strong>구현 예시</strong>:</p><ul><li><p>Python</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 세마포어: 동시 5건</span>
</span></span><span class=line><span class=cl><span class=n>sem</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>BoundedSemaphore</span><span class=p>(</span><span class=n>value</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>  <span class=c1># 오버릴리스 버그 방지(세마포어 관련 핵심) </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>permit</span><span class=p>(</span><span class=n>timeout</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ok</span> <span class=o>=</span> <span class=n>sem</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=n>timeout</span><span class=p>)</span>  <span class=c1># P/acquire: 허가 요청 (세마포어 핵심)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>ok</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>TimeoutError</span><span class=p>(</span><span class=s2>&#34;Throttle exceeded&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>yield</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>sem</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>  <span class=c1># V/release: 허가 반환 (세마포어 핵심)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>call_external</span><span class=p>(</span><span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 외부 API 호출 대체</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>text</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>translate</span><span class=p>(</span><span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timeout_sec</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>permit</span><span class=p>(</span><span class=n>timeout_sec</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>call_external</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 간단 테스트</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>concurrent.futures</span>
</span></span><span class=line><span class=cl>    <span class=n>texts</span> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&#34;msg-</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>concurrent</span><span class=o>.</span><span class=n>futures</span><span class=o>.</span><span class=n>ThreadPoolExecutor</span><span class=p>(</span><span class=n>max_workers</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span> <span class=k>as</span> <span class=n>ex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>futures</span> <span class=o>=</span> <span class=p>[</span><span class=n>ex</span><span class=o>.</span><span class=n>submit</span><span class=p>(</span><span class=n>translate</span><span class=p>,</span> <span class=n>t</span><span class=p>)</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>texts</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>([</span><span class=n>f</span><span class=o>.</span><span class=n>result</span><span class=p>()</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>futures</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>JavaScript(Node.js)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a>
</span><span class=lnt id=hl-12-31><a class=lnlinks href=#hl-12-31>31</a>
</span><span class=lnt id=hl-12-32><a class=lnlinks href=#hl-12-32>32</a>
</span><span class=lnt id=hl-12-33><a class=lnlinks href=#hl-12-33>33</a>
</span><span class=lnt id=hl-12-34><a class=lnlinks href=#hl-12-34>34</a>
</span><span class=lnt id=hl-12-35><a class=lnlinks href=#hl-12-35>35</a>
</span><span class=lnt id=hl-12-36><a class=lnlinks href=#hl-12-36>36</a>
</span><span class=lnt id=hl-12-37><a class=lnlinks href=#hl-12-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 간단한 세마포어 구현으로 외부 API 호출 동시성 제한 (학습용)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>Semaphore</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>max</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>max</span> <span class=o>=</span> <span class=nx>max</span><span class=p>;</span>         <span class=c1>// 허가 수
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=nx>max</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>queue</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>acquire</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>tryAcquire</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>count</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>count</span><span class=o>--</span><span class=p>;</span>     <span class=c1>// P/acquire
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>resolve</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>   <span class=c1>// release 함수 반환
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>this</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span><span class=p>;</span>   <span class=c1>// V/release
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=k>this</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>shift</span><span class=p>()();</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>tryAcquire</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=nx>tryAcquire</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sem</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Semaphore</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>translate</span><span class=p>(</span><span class=nx>text</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>release</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>sem</span><span class=p>.</span><span class=nx>acquire</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 외부 API 호출 대체
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>r</span> <span class=p>=&gt;</span> <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=mi>200</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>text</span><span class=p>.</span><span class=nx>toUpperCase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>release</span><span class=p>();</span> <span class=c1>// 세마포어 반환 필수
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h5 id=사례-한정된-db-커넥션-풀에-접근>사례: 한정된 DB 커넥션 풀에 접근<a hidden class=anchor aria-hidden=true href=#사례-한정된-db-커넥션-풀에-접근>#</a></h5><p><strong>시나리오</strong>: 여러 스레드가 한정된 DB 커넥션 풀에 접근하는 상황<br><strong>시스템 구성</strong>:</p><ul><li>Request Thread(요청 스레드)</li><li>DB Connection(커넥션)</li><li>Semaphore(세마포어)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[Request Thread] --&gt; B[Semaphore]
    B --&gt; C[DB Connection]
</pre><p><strong>Workflow</strong>:</p><ol><li>Thread 가 접속 요청</li><li>Semaphore wait(P) 연산</li><li>커넥션 호출</li><li>작업 종료 후 signal(V)</li><li>다음 Thread 처리 반복</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>세마포어가 동시 접속 제한 및 안전한 자원 관리 담당</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 무제한 동시 접속, 자원 고갈 및 에러 가능</li><li>도입 후: 동시 접속 제어, 자원 일관성 및 서비스 안정</li></ul><p><strong>구현 예시 (Python)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 최대 5개 커넥션 제한 세마포어 생성</span>
</span></span><span class=line><span class=cl><span class=n>db_semaphore</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>db_access</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 세마포어 wait(P) 역할</span>
</span></span><span class=line><span class=cl>    <span class=n>db_semaphore</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 DB 작업 수행</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;DB 작업 수행 중&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># … (DB 로직)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 세마포어 signal(V) 역할 (자원 반환)</span>
</span></span><span class=line><span class=cl>        <span class=n>db_semaphore</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 여러 스레드 시뮬레이션</span>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>db_access</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Semaphore 로 DB 커넥션 병렬 접근을 안전하게 제어함</li></ul><h5 id=사례-웹-크롤러의-동시-요청-수-제한>사례: 웹 크롤러의 동시 요청 수 제한<a hidden class=anchor aria-hidden=true href=#사례-웹-크롤러의-동시-요청-수-제한>#</a></h5><p><strong>시나리오</strong>: 웹 크롤러의 동시 요청 수 제한</p><p><strong>시스템 구성</strong>:</p><ul><li>HTTP 클라이언트 스레드 풀</li><li>세마포어 기반 요청 제한</li><li>결과 수집 큐</li></ul><pre class=mermaid>graph TB
    A[크롤러 매니저] --&gt; B[세마포어&lt;br/&gt;permit: 5]
    B --&gt; C[HTTP 클라이언트 1]
    B --&gt; D[HTTP 클라이언트 2]
    B --&gt; E[HTTP 클라이언트 3]
    B --&gt; F[...]
    
    C --&gt; G[웹사이트 1]
    D --&gt; H[웹사이트 2]
    E --&gt; I[웹사이트 3]
    
    C --&gt; J[결과 큐]
    D --&gt; J
    E --&gt; J
</pre><p><strong>Workflow</strong>:</p><ol><li>크롤러 매니저가 URL 목록 준비</li><li>각 HTTP 클라이언트가 세마포어 acquire 요청</li><li>허용된 클라이언트만 웹 요청 실행</li><li>요청 완료 후 세마포어 release</li><li>결과를 공통 큐에 저장</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>세마포어가 동시 HTTP 요청 수를 5 개로 제한</li><li>서버 과부하 방지 및 응답 시간 안정화</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 수백 개 동시 요청으로 서버 부하, 타임아웃 빈발</li><li>도입 후: 안정적인 5 개 동시 요청, 전체 처리량 향상</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33>33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34>34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35>35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36>36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37>37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38>38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39>39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40>40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41>41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42>42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43>43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44>44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45>45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46>46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47>47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48>48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49>49</a>
</span><span class=lnt id=hl-16-50><a class=lnlinks href=#hl-16-50>50</a>
</span><span class=lnt id=hl-16-51><a class=lnlinks href=#hl-16-51>51</a>
</span><span class=lnt id=hl-16-52><a class=lnlinks href=#hl-16-52>52</a>
</span><span class=lnt id=hl-16-53><a class=lnlinks href=#hl-16-53>53</a>
</span><span class=lnt id=hl-16-54><a class=lnlinks href=#hl-16-54>54</a>
</span><span class=lnt id=hl-16-55><a class=lnlinks href=#hl-16-55>55</a>
</span><span class=lnt id=hl-16-56><a class=lnlinks href=#hl-16-56>56</a>
</span><span class=lnt id=hl-16-57><a class=lnlinks href=#hl-16-57>57</a>
</span><span class=lnt id=hl-16-58><a class=lnlinks href=#hl-16-58>58</a>
</span><span class=lnt id=hl-16-59><a class=lnlinks href=#hl-16-59>59</a>
</span><span class=lnt id=hl-16-60><a class=lnlinks href=#hl-16-60>60</a>
</span><span class=lnt id=hl-16-61><a class=lnlinks href=#hl-16-61>61</a>
</span><span class=lnt id=hl-16-62><a class=lnlinks href=#hl-16-62>62</a>
</span><span class=lnt id=hl-16-63><a class=lnlinks href=#hl-16-63>63</a>
</span><span class=lnt id=hl-16-64><a class=lnlinks href=#hl-16-64>64</a>
</span><span class=lnt id=hl-16-65><a class=lnlinks href=#hl-16-65>65</a>
</span><span class=lnt id=hl-16-66><a class=lnlinks href=#hl-16-66>66</a>
</span><span class=lnt id=hl-16-67><a class=lnlinks href=#hl-16-67>67</a>
</span><span class=lnt id=hl-16-68><a class=lnlinks href=#hl-16-68>68</a>
</span><span class=lnt id=hl-16-69><a class=lnlinks href=#hl-16-69>69</a>
</span><span class=lnt id=hl-16-70><a class=lnlinks href=#hl-16-70>70</a>
</span><span class=lnt id=hl-16-71><a class=lnlinks href=#hl-16-71>71</a>
</span><span class=lnt id=hl-16-72><a class=lnlinks href=#hl-16-72>72</a>
</span><span class=lnt id=hl-16-73><a class=lnlinks href=#hl-16-73>73</a>
</span><span class=lnt id=hl-16-74><a class=lnlinks href=#hl-16-74>74</a>
</span><span class=lnt id=hl-16-75><a class=lnlinks href=#hl-16-75>75</a>
</span><span class=lnt id=hl-16-76><a class=lnlinks href=#hl-16-76>76</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>aiohttp</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>asyncio</span> <span class=kn>import</span> <span class=n>Semaphore</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WebCrawler</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_concurrent_requests</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 세마포어로 동시 요청 수 제한</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>semaphore</span> <span class=o>=</span> <span class=n>Semaphore</span><span class=p>(</span><span class=n>max_concurrent_requests</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>session</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>fetch_url</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>url</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;세마포어를 사용한 안전한 URL 페치&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 세마포어 획득 - 동시 실행 수 제한</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>semaphore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;요청 시작: </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>async</span> <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>content</span> <span class=o>=</span> <span class=k>await</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;요청 완료: </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2> (상태: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;url&#39;</span><span class=p>:</span> <span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=n>response</span><span class=o>.</span><span class=n>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;content_length&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;요청 실패: </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;url&#39;</span><span class=p>:</span> <span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=c1># 세마포어는 async with 블록 종료 시 자동 release</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>crawl_urls</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>urls</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;여러 URL을 동시에 크롤링 (세마포어로 제한)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>()</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>session</span> <span class=o>=</span> <span class=n>session</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 모든 URL에 대해 비동기 작업 생성</span>
</span></span><span class=line><span class=cl>            <span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>fetch_url</span><span class=p>(</span><span class=n>url</span><span class=p>)</span> <span class=k>for</span> <span class=n>url</span> <span class=ow>in</span> <span class=n>urls</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 세마포어가 동시 실행 수를 자동 제어</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>,</span> <span class=n>return_exceptions</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>urls</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/2&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/3&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://httpbin.org/delay/1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>crawler</span> <span class=o>=</span> <span class=n>WebCrawler</span><span class=p>(</span><span class=n>max_concurrent_requests</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>  <span class=c1># 최대 3개 동시 요청</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;크롤링 시작...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>crawler</span><span class=o>.</span><span class=n>crawl_urls</span><span class=p>(</span><span class=n>urls</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>end_time</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>총 소요 시간: </span><span class=si>{</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>초&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;성공한 요청: </span><span class=si>{</span><span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>results</span> <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;success&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>))</span><span class=si>}</span><span class=s2>개&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-동시-api-호출-수를-제한>사례: 동시 API 호출 수를 제한<a hidden class=anchor aria-hidden=true href=#사례-동시-api-호출-수를-제한>#</a></h5><p><strong>시나리오</strong>: 동시 API 호출 수를 제한하여 과부하 방지<br><strong>시스템 구성</strong>:</p><ul><li>API Client(클라이언트)</li><li>Semaphore(세마포어)</li><li>API Server</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[API Client] --&gt; B[Semaphore]
    B --&gt; C[API Server]
</pre><p><strong>Workflow</strong>:</p><ol><li>각 클라이언트가 API 요청</li><li>세마포어에서 허용 가능한 동시 요청만 승인</li><li>초과 요청은 큐 대기</li><li>요청 종료 후 signal 로 반환</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>세마포어가 트래픽 제한 및 서비스 안정성 담당</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 초과 요청으로 인한 서버 다운</li><li>도입 후: 서버 부하 관리, 안정성 향상</li></ul><p><strong>구현 예시 (JavaScript, Node.js)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>Semaphore</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;await-semaphore&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>semaphore</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Semaphore</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span> <span class=c1>// 3 concurrent requests max
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>callApi</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>value</span><span class=p>,</span> <span class=nx>release</span><span class=p>]</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>semaphore</span><span class=p>.</span><span class=nx>acquire</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 실제 API 호출
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;API 호출 실행&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// … (API 로직)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>release</span><span class=p>();</span> <span class=c1>// 세마포어 반환
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 다중 API 요청 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>callApi</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Semaphore 로 Node.js 환경에서 동시 API 요청 수 제한</li></ul><h5 id=사례-세마포어--생산자소비자-패턴>사례: 세마포어 + 생산자/소비자 패턴<a hidden class=anchor aria-hidden=true href=#사례-세마포어--생산자소비자-패턴>#</a></h5><p><strong>시나리오</strong>:</p><ul><li>생산자 (Producer) 는 버퍼 (Buffer) 에 데이터를 추가</li><li>소비자 (Consumer) 는 버퍼에서 데이터를 가져가 처리</li><li>버퍼 크기가 제한되어 있으므로 <strong>세마포어</strong>로 접근 및 용량 제어</li></ul><p><strong>시스템 구성</strong>:</p><ul><li><strong>버퍼 (Buffer)</strong>: 고정 크기의 공유 데이터 공간</li><li><strong>empty 세마포어 (emptySemaphore)</strong>: 남은 빈 공간 수 관리</li><li><strong>full 세마포어 (fullSemaphore)</strong>: 저장된 데이터 개수 관리</li><li><strong>뮤텍스 (Mutex)</strong>: 버퍼 접근 동기화</li></ul><pre class=mermaid>graph TB
    P[Producer] -- produce --&gt; E[Empty Semaphore]
    E -- 공간 점유 --&gt; B[Buffer]
    B -- 데이터 존재 --&gt; F[Full Semaphore]
    F -- consume --&gt; C[Consumer]
</pre><p><strong>Workflow</strong>:</p><ol><li><strong>생산자 (Producer)</strong>: empty 세마포어를 acquire → 버퍼에 데이터 추가 → full 세마포어 release</li><li><strong>소비자 (Consumer)</strong>: full 세마포어 acquire → 버퍼에서 데이터 제거 → empty 세마포어 release</li><li>**뮤텍스 (Mutex)**가 버퍼 접근의 상호배제를 보장</li></ol><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22>22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23>23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24>24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25>25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26>26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27>27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28>28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29>29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30>30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31>31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32>32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33>33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span><span class=o>,</span> <span class=nn>time</span><span class=o>,</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BUFFER_SIZE</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>buffer</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 세마포어 생성</span>
</span></span><span class=line><span class=cl><span class=n>empty</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=n>BUFFER_SIZE</span><span class=p>)</span>  <span class=c1># 남은 공간</span>
</span></span><span class=line><span class=cl><span class=n>full</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>             <span class=c1># 채워진 데이터</span>
</span></span><span class=line><span class=cl><span class=n>mutex</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>                   <span class=c1># 버퍼 접근 보호</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>producer</span><span class=p>(</span><span class=n>pid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>empty</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>  <span class=c1># 빈 공간 확인</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>mutex</span><span class=p>:</span>      <span class=c1># 버퍼 접근 동기화</span>
</span></span><span class=line><span class=cl>            <span class=n>buffer</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[생산자 </span><span class=si>{</span><span class=n>pid</span><span class=si>}</span><span class=s2>] 데이터 </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2> 생산. 버퍼 상태: </span><span class=si>{</span><span class=n>buffer</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>full</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>   <span class=c1># 데이터 증가 알림</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>1.5</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consumer</span><span class=p>(</span><span class=n>cid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>full</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>   <span class=c1># 데이터 존재 확인</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span> <span class=o>=</span> <span class=n>buffer</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[소비자 </span><span class=si>{</span><span class=n>cid</span><span class=si>}</span><span class=s2>] 데이터 </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2> 소비. 버퍼 상태: </span><span class=si>{</span><span class=n>buffer</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>empty</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>  <span class=c1># 빈 공간 증가 알림</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>2.0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 스레드 실행</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>producer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>consumer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>핵심 포인트</strong>: <code>empty</code> 와 <code>full</code> 세마포어가 버퍼의 용량과 데이터 수를 제어하여 **오버플로우 (Overflow)**나 **언더플로우 (Underflow)**를 방지.</li></ul><h5 id=사례-분산-세마포어--생산자소비자-패턴-redis-활용>사례: 분산 세마포어 + 생산자/소비자 패턴 (Redis 활용)<a hidden class=anchor aria-hidden=true href=#사례-분산-세마포어--생산자소비자-패턴-redis-활용>#</a></h5><p><strong>시나리오</strong>:</p><ul><li>여러 서버의 Producer 와 Consumer 가 <strong>공용 버퍼</strong>에 접근</li><li>버퍼와 세마포어 상태를 Redis 에 저장하여 <strong>전역 (Global) 접근 제어</strong></li><li>다수의 프로세스/서버에서도 <strong>동시성 제어</strong>와 <strong>데이터 일관성</strong> 유지</li></ul><p><strong>시스템 구성</strong>:</p><ul><li><strong>Redis 서버</strong><ul><li>버퍼 데이터 저장 (List 자료구조 사용)</li><li>세마포어 값 운영 (키 기반 정수 값)</li></ul></li><li><strong>Producer 서비스</strong>: 데이터를 버퍼에 삽입 (push)</li><li><strong>Consumer 서비스</strong>: 버퍼에서 데이터를 가져와 처리 (pop)</li><li><strong>분산 세마포어 (Distributed Semaphore)</strong>: Redis INCR/DECR 로 구현</li></ul><pre class=mermaid>graph TD
    P1[Producer Service A] --&gt; RS[Redis Server]
    P2[Producer Service B] --&gt; RS
    RS --&gt; C1[Consumer Service X]
    RS --&gt; C2[Consumer Service Y]
</pre><p><strong>Workflow</strong>:</p><ol><li>Producer 가 <code>emptySemaphore</code> 를 확인 후 데이터 생성</li><li>Redis 리스트에 데이터 push</li><li>Consumer 가 <code>fullSemaphore</code> 를 확인 후 데이터 소비 (pop)</li><li>세마포어 값은 Redis 의 INCR/DECR 로 동기화</li></ol><p><strong>구현 예시</strong>: Redis 기반 분산 세마포어어</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17>17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18>18</a>
</span><span class=lnt id=hl-22-19><a class=lnlinks href=#hl-22-19>19</a>
</span><span class=lnt id=hl-22-20><a class=lnlinks href=#hl-22-20>20</a>
</span><span class=lnt id=hl-22-21><a class=lnlinks href=#hl-22-21>21</a>
</span><span class=lnt id=hl-22-22><a class=lnlinks href=#hl-22-22>22</a>
</span><span class=lnt id=hl-22-23><a class=lnlinks href=#hl-22-23>23</a>
</span><span class=lnt id=hl-22-24><a class=lnlinks href=#hl-22-24>24</a>
</span><span class=lnt id=hl-22-25><a class=lnlinks href=#hl-22-25>25</a>
</span><span class=lnt id=hl-22-26><a class=lnlinks href=#hl-22-26>26</a>
</span><span class=lnt id=hl-22-27><a class=lnlinks href=#hl-22-27>27</a>
</span><span class=lnt id=hl-22-28><a class=lnlinks href=#hl-22-28>28</a>
</span><span class=lnt id=hl-22-29><a class=lnlinks href=#hl-22-29>29</a>
</span><span class=lnt id=hl-22-30><a class=lnlinks href=#hl-22-30>30</a>
</span><span class=lnt id=hl-22-31><a class=lnlinks href=#hl-22-31>31</a>
</span><span class=lnt id=hl-22-32><a class=lnlinks href=#hl-22-32>32</a>
</span><span class=lnt id=hl-22-33><a class=lnlinks href=#hl-22-33>33</a>
</span><span class=lnt id=hl-22-34><a class=lnlinks href=#hl-22-34>34</a>
</span><span class=lnt id=hl-22-35><a class=lnlinks href=#hl-22-35>35</a>
</span><span class=lnt id=hl-22-36><a class=lnlinks href=#hl-22-36>36</a>
</span><span class=lnt id=hl-22-37><a class=lnlinks href=#hl-22-37>37</a>
</span><span class=lnt id=hl-22-38><a class=lnlinks href=#hl-22-38>38</a>
</span><span class=lnt id=hl-22-39><a class=lnlinks href=#hl-22-39>39</a>
</span><span class=lnt id=hl-22-40><a class=lnlinks href=#hl-22-40>40</a>
</span><span class=lnt id=hl-22-41><a class=lnlinks href=#hl-22-41>41</a>
</span><span class=lnt id=hl-22-42><a class=lnlinks href=#hl-22-42>42</a>
</span><span class=lnt id=hl-22-43><a class=lnlinks href=#hl-22-43>43</a>
</span><span class=lnt id=hl-22-44><a class=lnlinks href=#hl-22-44>44</a>
</span><span class=lnt id=hl-22-45><a class=lnlinks href=#hl-22-45>45</a>
</span><span class=lnt id=hl-22-46><a class=lnlinks href=#hl-22-46>46</a>
</span><span class=lnt id=hl-22-47><a class=lnlinks href=#hl-22-47>47</a>
</span><span class=lnt id=hl-22-48><a class=lnlinks href=#hl-22-48>48</a>
</span><span class=lnt id=hl-22-49><a class=lnlinks href=#hl-22-49>49</a>
</span><span class=lnt id=hl-22-50><a class=lnlinks href=#hl-22-50>50</a>
</span><span class=lnt id=hl-22-51><a class=lnlinks href=#hl-22-51>51</a>
</span><span class=lnt id=hl-22-52><a class=lnlinks href=#hl-22-52>52</a>
</span><span class=lnt id=hl-22-53><a class=lnlinks href=#hl-22-53>53</a>
</span><span class=lnt id=hl-22-54><a class=lnlinks href=#hl-22-54>54</a>
</span><span class=lnt id=hl-22-55><a class=lnlinks href=#hl-22-55>55</a>
</span><span class=lnt id=hl-22-56><a class=lnlinks href=#hl-22-56>56</a>
</span><span class=lnt id=hl-22-57><a class=lnlinks href=#hl-22-57>57</a>
</span><span class=lnt id=hl-22-58><a class=lnlinks href=#hl-22-58>58</a>
</span><span class=lnt id=hl-22-59><a class=lnlinks href=#hl-22-59>59</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DistributedSemaphore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>limit</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;semaphore:</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>limit</span> <span class=o>=</span> <span class=n>limit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;세마포어 값이 제한보다 작을 때만 진입&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>watch</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span> <span class=ow>or</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>limit</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>pipe</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>pipeline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>pipe</span><span class=o>.</span><span class=n>multi</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>pipe</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>pipe</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>unwatch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.05</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;자원 해제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>decr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Redis 연결</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BUFFER_KEY</span> <span class=o>=</span> <span class=s2>&#34;shared_buffer&#34;</span>
</span></span><span class=line><span class=cl><span class=n>BUFFER_SIZE</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>empty_sem</span> <span class=o>=</span> <span class=n>DistributedSemaphore</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=s2>&#34;empty&#34;</span><span class=p>,</span> <span class=n>BUFFER_SIZE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>full_sem</span> <span class=o>=</span> <span class=n>DistributedSemaphore</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=s2>&#34;full&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>producer</span><span class=p>(</span><span class=n>pid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>empty_sem</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>  <span class=c1># 빈 공간 확보</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>lpush</span><span class=p>(</span><span class=n>BUFFER_KEY</span><span class=p>,</span> <span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Producer </span><span class=si>{</span><span class=n>pid</span><span class=si>}</span><span class=s2>] 생산 → </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>full_sem</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>  <span class=c1># 데이터 개수 증가</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>1.5</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>consumer</span><span class=p>(</span><span class=n>cid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>full_sem</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>  <span class=c1># 데이터 확보</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>rpop</span><span class=p>(</span><span class=n>BUFFER_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>item</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Consumer </span><span class=si>{</span><span class=n>cid</span><span class=si>}</span><span class=s2>] 소비 ← </span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>empty_sem</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>2.0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 예시 실행 (단일 프로세스 내 여러 스레드, 분산 시에는 각기 다른 서버에서 실행)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>producer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=p>,))</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>consumer</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=p>,))</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>empty_sem</code> 과 <code>full_sem</code> 은 각각 <strong>남은 저장 공간</strong>과 <strong>저장된 데이터 개수</strong>를 관리</li><li>Producer 는 데이터 생성 전 <code>empty_sem.acquire()</code> 로 빈 공간 확보</li><li>Consumer 는 데이터 소비 전 <code>full_sem.acquire()</code> 로 데이터 존재 여부 확인</li></ul><p><strong>실무 팁</strong>:</p><ul><li>대규모 트래픽 환경에서는 Redis 를 <strong>클러스터 모드</strong>로 구성하거나 <strong>Sentinel</strong>을 통한 자동 장애 조치 (HA, High Availability) 적용 필요</li><li>버퍼 데이터 구조를 Redis 의 **Stream(스트림)**으로 변경하면 <strong>로그/메시지 큐 (Message Queue)</strong> 기능까지 확장 가능</li><li>세마포어 누수 (leak) 방지를 위해 TTL(Time To Live) 값을 설정해 자동 자원 회수 가능하게 설계</li></ul><h5 id=사례-kafka-를-활용한-세마포어-기반-소비-제어-구조>사례: Kafka 를 활용한 세마포어 기반 소비 제어 구조<a hidden class=anchor aria-hidden=true href=#사례-kafka-를-활용한-세마포어-기반-소비-제어-구조>#</a></h5><p>이 방식은 <strong>메시지 큐 (Message Queue)</strong> 를 사용하는 마이크로서비스 환경에서, <strong>동시에 처리 가능한 Consumer(소비자)</strong> 의 개수를 세마포어로 제어하는 기법.</p><p><strong>실무 시나리오</strong>:</p><ul><li>대규모 Kafka 토픽 (topic) 에 메시지가 빠르게 쌓임</li><li>여러 Consumer 그룹이 메시지를 병렬 처리하지만, 특정 리소스 (DB, API 등) 에 과부하가 걸릴 수 있음</li><li>세마포어 (Semaphore) 를 사용해 <strong>동시 처리량 (Concurrency) 제한</strong></li></ul><p><strong>시스템 구성</strong>:</p><ul><li><strong>Kafka Broker</strong>: 메시지 저장 및 전달</li><li><strong>Producer 서비스</strong>: 메시지를 Kafka 토픽에 전송</li><li><strong>Consumer 서비스 + 세마포어</strong>: 토픽에서 메시지를 가져오되 설정된 동시 처리 한도 이상은 처리하지 않음</li><li><strong>분산 세마포어 (Distributed Semaphore)</strong>: Redis 등을 사용해 Consumer 인스턴스 간 상태 공유</li></ul><pre class=mermaid>graph TB
    P[Producer Service] --&gt; KB[Kafka Broker]
    KB --&gt; C1[Consumer Service 1]
    KB --&gt; C2[Consumer Service 2]
    C1 --&gt; RS[Redis 기반 분산 세마포어]
    C2 --&gt; RS
</pre><p><strong>Workflow</strong>:</p><ol><li>Producer 가 Kafka 토픽에 작업 메시지 전송</li><li>Consumer 인스턴스가 메시지를 수신하려고 할 때, Redis 세마포어로 동시 처리 가능 여부 확인</li><li>세마포어 획득에 성공하면 메시지 처리 시작</li><li>처리 완료 후 세마포어 반환 (release)</li><li>실패 시 메시지를 잠시 큐에 유지하거나 재시도</li></ol><p><strong>구현 예시</strong>: Python 예제 (Kafka + Redis 세마포어 소비제어)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20>20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21>21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22>22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23>23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24>24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25>25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26>26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27>27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28>28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29>29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30>30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31>31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32>32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33>33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34>34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35>35</a>
</span><span class=lnt id=hl-24-36><a class=lnlinks href=#hl-24-36>36</a>
</span><span class=lnt id=hl-24-37><a class=lnlinks href=#hl-24-37>37</a>
</span><span class=lnt id=hl-24-38><a class=lnlinks href=#hl-24-38>38</a>
</span><span class=lnt id=hl-24-39><a class=lnlinks href=#hl-24-39>39</a>
</span><span class=lnt id=hl-24-40><a class=lnlinks href=#hl-24-40>40</a>
</span><span class=lnt id=hl-24-41><a class=lnlinks href=#hl-24-41>41</a>
</span><span class=lnt id=hl-24-42><a class=lnlinks href=#hl-24-42>42</a>
</span><span class=lnt id=hl-24-43><a class=lnlinks href=#hl-24-43>43</a>
</span><span class=lnt id=hl-24-44><a class=lnlinks href=#hl-24-44>44</a>
</span><span class=lnt id=hl-24-45><a class=lnlinks href=#hl-24-45>45</a>
</span><span class=lnt id=hl-24-46><a class=lnlinks href=#hl-24-46>46</a>
</span><span class=lnt id=hl-24-47><a class=lnlinks href=#hl-24-47>47</a>
</span><span class=lnt id=hl-24-48><a class=lnlinks href=#hl-24-48>48</a>
</span><span class=lnt id=hl-24-49><a class=lnlinks href=#hl-24-49>49</a>
</span><span class=lnt id=hl-24-50><a class=lnlinks href=#hl-24-50>50</a>
</span><span class=lnt id=hl-24-51><a class=lnlinks href=#hl-24-51>51</a>
</span><span class=lnt id=hl-24-52><a class=lnlinks href=#hl-24-52>52</a>
</span><span class=lnt id=hl-24-53><a class=lnlinks href=#hl-24-53>53</a>
</span><span class=lnt id=hl-24-54><a class=lnlinks href=#hl-24-54>54</a>
</span><span class=lnt id=hl-24-55><a class=lnlinks href=#hl-24-55>55</a>
</span><span class=lnt id=hl-24-56><a class=lnlinks href=#hl-24-56>56</a>
</span><span class=lnt id=hl-24-57><a class=lnlinks href=#hl-24-57>57</a>
</span><span class=lnt id=hl-24-58><a class=lnlinks href=#hl-24-58>58</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaConsumer</span>  <span class=c1># Kafka 파이썬 클라이언트</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DistributedSemaphore</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>limit</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;semaphore:</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>limit</span> <span class=o>=</span> <span class=n>limit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;해당 세마포어 자원을 획득 (제한 이하면 허용)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>watch</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>current</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span> <span class=ow>or</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>limit</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>pipe</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>pipeline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>pipe</span><span class=o>.</span><span class=n>multi</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>pipe</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>pipe</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>unwatch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.05</span><span class=p>)</span>  <span class=c1># 재시도 대기</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;자원 해제&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>decr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Redis 연결 (세마포어 저장소)</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka Consumer 설정</span>
</span></span><span class=line><span class=cl><span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;task_topic&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bootstrap_servers</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>group_id</span><span class=o>=</span><span class=s1>&#39;processing_group&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>value_deserializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 세마포어 생성 (예: 동시 처리 가능 Consumer 개수 3개로 제한)</span>
</span></span><span class=line><span class=cl><span class=n>semaphore</span> <span class=o>=</span> <span class=n>DistributedSemaphore</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=s2>&#34;consumer_limit&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_message</span><span class=p>(</span><span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;실제 비즈니스 로직&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[처리 시작] </span><span class=si>{</span><span class=n>msg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 실제 처리 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[처리 완료] </span><span class=si>{</span><span class=n>msg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Kafka 메시지 소비 루프</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>consumer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>semaphore</span><span class=o>.</span><span class=n>acquire</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>process_message</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>semaphore</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;처리 슬롯이 가득 찼습니다. 잠시 후 재시도.&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>consumer_limit</code> 세마포어 값이 3 이하일 때만 메시지 처리 시작</li><li>모든 Consumer 인스턴스가 <strong>같은 Redis 세마포어</strong>를 공유</li><li>이를 통해 <strong>클러스터 전체에서 동시에 처리하는 Consumer 수를 제한</strong> 가능</li></ul><h5 id=사례-세마포어를-활용한-복합-동기화-패턴>사례: 세마포어를 활용한 복합 동기화 패턴<a hidden class=anchor aria-hidden=true href=#사례-세마포어를-활용한-복합-동기화-패턴>#</a></h5><p>여러 자원이 복합적으로 사용되는 환경 (예: 입출력 버퍼와 데이터베이스 동시 제어) 에서는 세마포어 (Semaphore) 와 다른 동기화 도구 (뮤텍스 (Mutex), 조건 변수 (Condition Variable)) 를 병행 적용한다.<br>이때 주의할 점은 교착상태 (Deadlock) 방지 및 정합성 보장인데, 리소스 별로 세마포어와 락 (Lock) 획득 순서를 통일하는 전략이 필요하다.</p><p><strong>복합 리소스 동기화 시나리오</strong>: 세마포어 + 뮤텍스 활용</p><pre class=mermaid>flowchart TB
    사용자 --&gt;|버퍼 요청| 세마포어
    세마포어 --&gt;|허용| 버퍼락(뮤텍스)
    버퍼락(뮤텍스) --&gt;|잠금상태로 자원 사용| 데이터베이스락(뮤텍스)
    데이터베이스락(뮤텍스) --&gt;|작업 처리| 사용자
    데이터베이스락(뮤텍스) --&gt;|해제| 버퍼락(뮤텍스)
    버퍼락(뮤텍스) --&gt;|해제| 세마포어
</pre><p>설명:</p><ul><li>세마포어로 버퍼 동시 접근 제한 → 내부 버퍼락 (뮤텍스) 과 외부 데이터베이스락 (뮤텍스) 순서대로 자원 잠금</li><li>모든 락의 획득·해제 순서를 통일한다면 데드락 최소화 가능</li></ul><p><strong>코드 예시</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15>15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16>16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17>17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18>18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19>19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20>20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21>21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22>22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BUFFER_SIZE</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>buffer_semaphore</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=n>BUFFER_SIZE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>buffer_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>  <span class=c1># 버퍼 보호용 뮤텍스</span>
</span></span><span class=line><span class=cl><span class=n>db_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>      <span class=c1># 데이터베이스 보호용 뮤텍스</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>use_shared_resources</span><span class=p>(</span><span class=n>thread_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer_semaphore</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>  <span class=c1># 버퍼 접근 제한(동시 3개)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>buffer_lock</span><span class=p>:</span>           <span class=c1># 버퍼 내 데이터에 대한 상호배제</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread-</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>: 버퍼 내 데이터 사용&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>db_lock</span><span class=p>:</span>           <span class=c1># 데이터베이스 자원 독점</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Thread-</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>: 데이터베이스 접근&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer_semaphore</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>  <span class=c1># 버퍼 반환</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>use_shared_resources</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>    <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>버퍼 세마포어 (BUFFER_SIZE 개수만 동시 처리)</li><li>내부 데이터 보호는 뮤텍스 (Lock) 로 구현</li><li>데이터베이스 동기화도 추가 뮤텍스 적용</li><li>모든 락/세마포어 해제는 반드시 <code>with</code> 또는 finally 구문 으로 보장</li></ul><h4 id=실제-도입-사례의-코드-구현>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현>#</a></h4><h5 id=사례-netflix-의-마이크로서비스-간-api-호출-제한>사례: Netflix 의 마이크로서비스 간 API 호출 제한<a hidden class=anchor aria-hidden=true href=#사례-netflix-의-마이크로서비스-간-api-호출-제한>#</a></h5><p><strong>시나리오</strong>: Netflix 의 마이크로서비스 간 API 호출 제한 (Hystrix 패턴 기반)</p><p><strong>시스템 구성</strong>:</p><ul><li>API 게이트웨이</li><li>마이크로서비스 클러스터</li><li>세마포어 기반 회로 차단기</li><li>모니터링 시스템</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[API Gateway] --&gt; B[세마포어 풀&lt;br/&gt;각 서비스별 제한]
    B --&gt; C[User Service&lt;br/&gt;permits: 10]
    B --&gt; D[Movie Service&lt;br/&gt;permits: 15] 
    B --&gt; E[Rating Service&lt;br/&gt;permits: 8]
    
    C --&gt; F[User DB]
    D --&gt; G[Movie DB]
    E --&gt; H[Rating DB]
    
    I[Monitoring] --&gt; B
    I --&gt; J[Alert System]
</pre><p><strong>Workflow</strong>:</p><ol><li>API 게이트웨이가 요청 수신</li><li>대상 서비스의 세마포어 permit 확인</li><li>허용 시 요청 전달, 거부 시 fallback 응답</li><li>서비스 응답 후 permit 해제</li><li>메트릭 수집 및 모니터링</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>각 마이크로서비스별 동시 호출 수 제한</li><li>서비스 장애 시 cascading failure 방지</li><li>시스템 전체 안정성 확보</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 한 서비스 장애가 전체 시스템에 전파</li><li>도입 후: 격리된 장애로 다른 서비스는 정상 동작</li></ul><p><strong>구현 예시</strong> (JavaScript/Node.js):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1>  1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2>  2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3>  3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4>  4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5>  5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6>  6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7>  7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8>  8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9>  9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10> 10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11> 11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12> 12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13> 13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14> 14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15> 15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16> 16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17> 17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18> 18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19> 19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20> 20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21> 21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22> 22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23> 23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24> 24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25> 25</a>
</span><span class=lnt id=hl-28-26><a class=lnlinks href=#hl-28-26> 26</a>
</span><span class=lnt id=hl-28-27><a class=lnlinks href=#hl-28-27> 27</a>
</span><span class=lnt id=hl-28-28><a class=lnlinks href=#hl-28-28> 28</a>
</span><span class=lnt id=hl-28-29><a class=lnlinks href=#hl-28-29> 29</a>
</span><span class=lnt id=hl-28-30><a class=lnlinks href=#hl-28-30> 30</a>
</span><span class=lnt id=hl-28-31><a class=lnlinks href=#hl-28-31> 31</a>
</span><span class=lnt id=hl-28-32><a class=lnlinks href=#hl-28-32> 32</a>
</span><span class=lnt id=hl-28-33><a class=lnlinks href=#hl-28-33> 33</a>
</span><span class=lnt id=hl-28-34><a class=lnlinks href=#hl-28-34> 34</a>
</span><span class=lnt id=hl-28-35><a class=lnlinks href=#hl-28-35> 35</a>
</span><span class=lnt id=hl-28-36><a class=lnlinks href=#hl-28-36> 36</a>
</span><span class=lnt id=hl-28-37><a class=lnlinks href=#hl-28-37> 37</a>
</span><span class=lnt id=hl-28-38><a class=lnlinks href=#hl-28-38> 38</a>
</span><span class=lnt id=hl-28-39><a class=lnlinks href=#hl-28-39> 39</a>
</span><span class=lnt id=hl-28-40><a class=lnlinks href=#hl-28-40> 40</a>
</span><span class=lnt id=hl-28-41><a class=lnlinks href=#hl-28-41> 41</a>
</span><span class=lnt id=hl-28-42><a class=lnlinks href=#hl-28-42> 42</a>
</span><span class=lnt id=hl-28-43><a class=lnlinks href=#hl-28-43> 43</a>
</span><span class=lnt id=hl-28-44><a class=lnlinks href=#hl-28-44> 44</a>
</span><span class=lnt id=hl-28-45><a class=lnlinks href=#hl-28-45> 45</a>
</span><span class=lnt id=hl-28-46><a class=lnlinks href=#hl-28-46> 46</a>
</span><span class=lnt id=hl-28-47><a class=lnlinks href=#hl-28-47> 47</a>
</span><span class=lnt id=hl-28-48><a class=lnlinks href=#hl-28-48> 48</a>
</span><span class=lnt id=hl-28-49><a class=lnlinks href=#hl-28-49> 49</a>
</span><span class=lnt id=hl-28-50><a class=lnlinks href=#hl-28-50> 50</a>
</span><span class=lnt id=hl-28-51><a class=lnlinks href=#hl-28-51> 51</a>
</span><span class=lnt id=hl-28-52><a class=lnlinks href=#hl-28-52> 52</a>
</span><span class=lnt id=hl-28-53><a class=lnlinks href=#hl-28-53> 53</a>
</span><span class=lnt id=hl-28-54><a class=lnlinks href=#hl-28-54> 54</a>
</span><span class=lnt id=hl-28-55><a class=lnlinks href=#hl-28-55> 55</a>
</span><span class=lnt id=hl-28-56><a class=lnlinks href=#hl-28-56> 56</a>
</span><span class=lnt id=hl-28-57><a class=lnlinks href=#hl-28-57> 57</a>
</span><span class=lnt id=hl-28-58><a class=lnlinks href=#hl-28-58> 58</a>
</span><span class=lnt id=hl-28-59><a class=lnlinks href=#hl-28-59> 59</a>
</span><span class=lnt id=hl-28-60><a class=lnlinks href=#hl-28-60> 60</a>
</span><span class=lnt id=hl-28-61><a class=lnlinks href=#hl-28-61> 61</a>
</span><span class=lnt id=hl-28-62><a class=lnlinks href=#hl-28-62> 62</a>
</span><span class=lnt id=hl-28-63><a class=lnlinks href=#hl-28-63> 63</a>
</span><span class=lnt id=hl-28-64><a class=lnlinks href=#hl-28-64> 64</a>
</span><span class=lnt id=hl-28-65><a class=lnlinks href=#hl-28-65> 65</a>
</span><span class=lnt id=hl-28-66><a class=lnlinks href=#hl-28-66> 66</a>
</span><span class=lnt id=hl-28-67><a class=lnlinks href=#hl-28-67> 67</a>
</span><span class=lnt id=hl-28-68><a class=lnlinks href=#hl-28-68> 68</a>
</span><span class=lnt id=hl-28-69><a class=lnlinks href=#hl-28-69> 69</a>
</span><span class=lnt id=hl-28-70><a class=lnlinks href=#hl-28-70> 70</a>
</span><span class=lnt id=hl-28-71><a class=lnlinks href=#hl-28-71> 71</a>
</span><span class=lnt id=hl-28-72><a class=lnlinks href=#hl-28-72> 72</a>
</span><span class=lnt id=hl-28-73><a class=lnlinks href=#hl-28-73> 73</a>
</span><span class=lnt id=hl-28-74><a class=lnlinks href=#hl-28-74> 74</a>
</span><span class=lnt id=hl-28-75><a class=lnlinks href=#hl-28-75> 75</a>
</span><span class=lnt id=hl-28-76><a class=lnlinks href=#hl-28-76> 76</a>
</span><span class=lnt id=hl-28-77><a class=lnlinks href=#hl-28-77> 77</a>
</span><span class=lnt id=hl-28-78><a class=lnlinks href=#hl-28-78> 78</a>
</span><span class=lnt id=hl-28-79><a class=lnlinks href=#hl-28-79> 79</a>
</span><span class=lnt id=hl-28-80><a class=lnlinks href=#hl-28-80> 80</a>
</span><span class=lnt id=hl-28-81><a class=lnlinks href=#hl-28-81> 81</a>
</span><span class=lnt id=hl-28-82><a class=lnlinks href=#hl-28-82> 82</a>
</span><span class=lnt id=hl-28-83><a class=lnlinks href=#hl-28-83> 83</a>
</span><span class=lnt id=hl-28-84><a class=lnlinks href=#hl-28-84> 84</a>
</span><span class=lnt id=hl-28-85><a class=lnlinks href=#hl-28-85> 85</a>
</span><span class=lnt id=hl-28-86><a class=lnlinks href=#hl-28-86> 86</a>
</span><span class=lnt id=hl-28-87><a class=lnlinks href=#hl-28-87> 87</a>
</span><span class=lnt id=hl-28-88><a class=lnlinks href=#hl-28-88> 88</a>
</span><span class=lnt id=hl-28-89><a class=lnlinks href=#hl-28-89> 89</a>
</span><span class=lnt id=hl-28-90><a class=lnlinks href=#hl-28-90> 90</a>
</span><span class=lnt id=hl-28-91><a class=lnlinks href=#hl-28-91> 91</a>
</span><span class=lnt id=hl-28-92><a class=lnlinks href=#hl-28-92> 92</a>
</span><span class=lnt id=hl-28-93><a class=lnlinks href=#hl-28-93> 93</a>
</span><span class=lnt id=hl-28-94><a class=lnlinks href=#hl-28-94> 94</a>
</span><span class=lnt id=hl-28-95><a class=lnlinks href=#hl-28-95> 95</a>
</span><span class=lnt id=hl-28-96><a class=lnlinks href=#hl-28-96> 96</a>
</span><span class=lnt id=hl-28-97><a class=lnlinks href=#hl-28-97> 97</a>
</span><span class=lnt id=hl-28-98><a class=lnlinks href=#hl-28-98> 98</a>
</span><span class=lnt id=hl-28-99><a class=lnlinks href=#hl-28-99> 99</a>
</span><span class=lnt id=hl-28-100><a class=lnlinks href=#hl-28-100>100</a>
</span><span class=lnt id=hl-28-101><a class=lnlinks href=#hl-28-101>101</a>
</span><span class=lnt id=hl-28-102><a class=lnlinks href=#hl-28-102>102</a>
</span><span class=lnt id=hl-28-103><a class=lnlinks href=#hl-28-103>103</a>
</span><span class=lnt id=hl-28-104><a class=lnlinks href=#hl-28-104>104</a>
</span><span class=lnt id=hl-28-105><a class=lnlinks href=#hl-28-105>105</a>
</span><span class=lnt id=hl-28-106><a class=lnlinks href=#hl-28-106>106</a>
</span><span class=lnt id=hl-28-107><a class=lnlinks href=#hl-28-107>107</a>
</span><span class=lnt id=hl-28-108><a class=lnlinks href=#hl-28-108>108</a>
</span><span class=lnt id=hl-28-109><a class=lnlinks href=#hl-28-109>109</a>
</span><span class=lnt id=hl-28-110><a class=lnlinks href=#hl-28-110>110</a>
</span><span class=lnt id=hl-28-111><a class=lnlinks href=#hl-28-111>111</a>
</span><span class=lnt id=hl-28-112><a class=lnlinks href=#hl-28-112>112</a>
</span><span class=lnt id=hl-28-113><a class=lnlinks href=#hl-28-113>113</a>
</span><span class=lnt id=hl-28-114><a class=lnlinks href=#hl-28-114>114</a>
</span><span class=lnt id=hl-28-115><a class=lnlinks href=#hl-28-115>115</a>
</span><span class=lnt id=hl-28-116><a class=lnlinks href=#hl-28-116>116</a>
</span><span class=lnt id=hl-28-117><a class=lnlinks href=#hl-28-117>117</a>
</span><span class=lnt id=hl-28-118><a class=lnlinks href=#hl-28-118>118</a>
</span><span class=lnt id=hl-28-119><a class=lnlinks href=#hl-28-119>119</a>
</span><span class=lnt id=hl-28-120><a class=lnlinks href=#hl-28-120>120</a>
</span><span class=lnt id=hl-28-121><a class=lnlinks href=#hl-28-121>121</a>
</span><span class=lnt id=hl-28-122><a class=lnlinks href=#hl-28-122>122</a>
</span><span class=lnt id=hl-28-123><a class=lnlinks href=#hl-28-123>123</a>
</span><span class=lnt id=hl-28-124><a class=lnlinks href=#hl-28-124>124</a>
</span><span class=lnt id=hl-28-125><a class=lnlinks href=#hl-28-125>125</a>
</span><span class=lnt id=hl-28-126><a class=lnlinks href=#hl-28-126>126</a>
</span><span class=lnt id=hl-28-127><a class=lnlinks href=#hl-28-127>127</a>
</span><span class=lnt id=hl-28-128><a class=lnlinks href=#hl-28-128>128</a>
</span><span class=lnt id=hl-28-129><a class=lnlinks href=#hl-28-129>129</a>
</span><span class=lnt id=hl-28-130><a class=lnlinks href=#hl-28-130>130</a>
</span><span class=lnt id=hl-28-131><a class=lnlinks href=#hl-28-131>131</a>
</span><span class=lnt id=hl-28-132><a class=lnlinks href=#hl-28-132>132</a>
</span><span class=lnt id=hl-28-133><a class=lnlinks href=#hl-28-133>133</a>
</span><span class=lnt id=hl-28-134><a class=lnlinks href=#hl-28-134>134</a>
</span><span class=lnt id=hl-28-135><a class=lnlinks href=#hl-28-135>135</a>
</span><span class=lnt id=hl-28-136><a class=lnlinks href=#hl-28-136>136</a>
</span><span class=lnt id=hl-28-137><a class=lnlinks href=#hl-28-137>137</a>
</span><span class=lnt id=hl-28-138><a class=lnlinks href=#hl-28-138>138</a>
</span><span class=lnt id=hl-28-139><a class=lnlinks href=#hl-28-139>139</a>
</span><span class=lnt id=hl-28-140><a class=lnlinks href=#hl-28-140>140</a>
</span><span class=lnt id=hl-28-141><a class=lnlinks href=#hl-28-141>141</a>
</span><span class=lnt id=hl-28-142><a class=lnlinks href=#hl-28-142>142</a>
</span><span class=lnt id=hl-28-143><a class=lnlinks href=#hl-28-143>143</a>
</span><span class=lnt id=hl-28-144><a class=lnlinks href=#hl-28-144>144</a>
</span><span class=lnt id=hl-28-145><a class=lnlinks href=#hl-28-145>145</a>
</span><span class=lnt id=hl-28-146><a class=lnlinks href=#hl-28-146>146</a>
</span><span class=lnt id=hl-28-147><a class=lnlinks href=#hl-28-147>147</a>
</span><span class=lnt id=hl-28-148><a class=lnlinks href=#hl-28-148>148</a>
</span><span class=lnt id=hl-28-149><a class=lnlinks href=#hl-28-149>149</a>
</span><span class=lnt id=hl-28-150><a class=lnlinks href=#hl-28-150>150</a>
</span><span class=lnt id=hl-28-151><a class=lnlinks href=#hl-28-151>151</a>
</span><span class=lnt id=hl-28-152><a class=lnlinks href=#hl-28-152>152</a>
</span><span class=lnt id=hl-28-153><a class=lnlinks href=#hl-28-153>153</a>
</span><span class=lnt id=hl-28-154><a class=lnlinks href=#hl-28-154>154</a>
</span><span class=lnt id=hl-28-155><a class=lnlinks href=#hl-28-155>155</a>
</span><span class=lnt id=hl-28-156><a class=lnlinks href=#hl-28-156>156</a>
</span><span class=lnt id=hl-28-157><a class=lnlinks href=#hl-28-157>157</a>
</span><span class=lnt id=hl-28-158><a class=lnlinks href=#hl-28-158>158</a>
</span><span class=lnt id=hl-28-159><a class=lnlinks href=#hl-28-159>159</a>
</span><span class=lnt id=hl-28-160><a class=lnlinks href=#hl-28-160>160</a>
</span><span class=lnt id=hl-28-161><a class=lnlinks href=#hl-28-161>161</a>
</span><span class=lnt id=hl-28-162><a class=lnlinks href=#hl-28-162>162</a>
</span><span class=lnt id=hl-28-163><a class=lnlinks href=#hl-28-163>163</a>
</span><span class=lnt id=hl-28-164><a class=lnlinks href=#hl-28-164>164</a>
</span><span class=lnt id=hl-28-165><a class=lnlinks href=#hl-28-165>165</a>
</span><span class=lnt id=hl-28-166><a class=lnlinks href=#hl-28-166>166</a>
</span><span class=lnt id=hl-28-167><a class=lnlinks href=#hl-28-167>167</a>
</span><span class=lnt id=hl-28-168><a class=lnlinks href=#hl-28-168>168</a>
</span><span class=lnt id=hl-28-169><a class=lnlinks href=#hl-28-169>169</a>
</span><span class=lnt id=hl-28-170><a class=lnlinks href=#hl-28-170>170</a>
</span><span class=lnt id=hl-28-171><a class=lnlinks href=#hl-28-171>171</a>
</span><span class=lnt id=hl-28-172><a class=lnlinks href=#hl-28-172>172</a>
</span><span class=lnt id=hl-28-173><a class=lnlinks href=#hl-28-173>173</a>
</span><span class=lnt id=hl-28-174><a class=lnlinks href=#hl-28-174>174</a>
</span><span class=lnt id=hl-28-175><a class=lnlinks href=#hl-28-175>175</a>
</span><span class=lnt id=hl-28-176><a class=lnlinks href=#hl-28-176>176</a>
</span><span class=lnt id=hl-28-177><a class=lnlinks href=#hl-28-177>177</a>
</span><span class=lnt id=hl-28-178><a class=lnlinks href=#hl-28-178>178</a>
</span><span class=lnt id=hl-28-179><a class=lnlinks href=#hl-28-179>179</a>
</span><span class=lnt id=hl-28-180><a class=lnlinks href=#hl-28-180>180</a>
</span><span class=lnt id=hl-28-181><a class=lnlinks href=#hl-28-181>181</a>
</span><span class=lnt id=hl-28-182><a class=lnlinks href=#hl-28-182>182</a>
</span><span class=lnt id=hl-28-183><a class=lnlinks href=#hl-28-183>183</a>
</span><span class=lnt id=hl-28-184><a class=lnlinks href=#hl-28-184>184</a>
</span><span class=lnt id=hl-28-185><a class=lnlinks href=#hl-28-185>185</a>
</span><span class=lnt id=hl-28-186><a class=lnlinks href=#hl-28-186>186</a>
</span><span class=lnt id=hl-28-187><a class=lnlinks href=#hl-28-187>187</a>
</span><span class=lnt id=hl-28-188><a class=lnlinks href=#hl-28-188>188</a>
</span><span class=lnt id=hl-28-189><a class=lnlinks href=#hl-28-189>189</a>
</span><span class=lnt id=hl-28-190><a class=lnlinks href=#hl-28-190>190</a>
</span><span class=lnt id=hl-28-191><a class=lnlinks href=#hl-28-191>191</a>
</span><span class=lnt id=hl-28-192><a class=lnlinks href=#hl-28-192>192</a>
</span><span class=lnt id=hl-28-193><a class=lnlinks href=#hl-28-193>193</a>
</span><span class=lnt id=hl-28-194><a class=lnlinks href=#hl-28-194>194</a>
</span><span class=lnt id=hl-28-195><a class=lnlinks href=#hl-28-195>195</a>
</span><span class=lnt id=hl-28-196><a class=lnlinks href=#hl-28-196>196</a>
</span><span class=lnt id=hl-28-197><a class=lnlinks href=#hl-28-197>197</a>
</span><span class=lnt id=hl-28-198><a class=lnlinks href=#hl-28-198>198</a>
</span><span class=lnt id=hl-28-199><a class=lnlinks href=#hl-28-199>199</a>
</span><span class=lnt id=hl-28-200><a class=lnlinks href=#hl-28-200>200</a>
</span><span class=lnt id=hl-28-201><a class=lnlinks href=#hl-28-201>201</a>
</span><span class=lnt id=hl-28-202><a class=lnlinks href=#hl-28-202>202</a>
</span><span class=lnt id=hl-28-203><a class=lnlinks href=#hl-28-203>203</a>
</span><span class=lnt id=hl-28-204><a class=lnlinks href=#hl-28-204>204</a>
</span><span class=lnt id=hl-28-205><a class=lnlinks href=#hl-28-205>205</a>
</span><span class=lnt id=hl-28-206><a class=lnlinks href=#hl-28-206>206</a>
</span><span class=lnt id=hl-28-207><a class=lnlinks href=#hl-28-207>207</a>
</span><span class=lnt id=hl-28-208><a class=lnlinks href=#hl-28-208>208</a>
</span><span class=lnt id=hl-28-209><a class=lnlinks href=#hl-28-209>209</a>
</span><span class=lnt id=hl-28-210><a class=lnlinks href=#hl-28-210>210</a>
</span><span class=lnt id=hl-28-211><a class=lnlinks href=#hl-28-211>211</a>
</span><span class=lnt id=hl-28-212><a class=lnlinks href=#hl-28-212>212</a>
</span><span class=lnt id=hl-28-213><a class=lnlinks href=#hl-28-213>213</a>
</span><span class=lnt id=hl-28-214><a class=lnlinks href=#hl-28-214>214</a>
</span><span class=lnt id=hl-28-215><a class=lnlinks href=#hl-28-215>215</a>
</span><span class=lnt id=hl-28-216><a class=lnlinks href=#hl-28-216>216</a>
</span><span class=lnt id=hl-28-217><a class=lnlinks href=#hl-28-217>217</a>
</span><span class=lnt id=hl-28-218><a class=lnlinks href=#hl-28-218>218</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>axios</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;axios&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>SemaphorePool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>semaphores</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 서비스별 세마포어 생성/조회
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>getSemaphore</span><span class=p>(</span><span class=nx>serviceName</span><span class=p>,</span> <span class=nx>maxConcurrent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>semaphores</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>serviceName</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>semaphores</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>serviceName</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Semaphore</span><span class=p>(</span><span class=nx>maxConcurrent</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>semaphores</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>serviceName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 현재 상태 조회 (모니터링용)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>getStatus</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>status</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>service</span><span class=p>,</span> <span class=nx>semaphore</span><span class=p>]</span> <span class=k>of</span> <span class=k>this</span><span class=p>.</span><span class=nx>semaphores</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=p>[</span><span class=nx>service</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>available</span><span class=o>:</span> <span class=nx>semaphore</span><span class=p>.</span><span class=nx>available</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>total</span><span class=o>:</span> <span class=nx>semaphore</span><span class=p>.</span><span class=nx>total</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>waiting</span><span class=o>:</span> <span class=nx>semaphore</span><span class=p>.</span><span class=nx>waitingCount</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Semaphore</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>maxConcurrent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>total</span> <span class=o>=</span> <span class=nx>maxConcurrent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>available</span> <span class=o>=</span> <span class=nx>maxConcurrent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>waitingQueue</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 비동기 acquire - Promise 기반
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=nx>acquire</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>available</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>available</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=nx>resolve</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 대기 큐에 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>this</span><span class=p>.</span><span class=nx>waitingQueue</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>resolve</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// permit 해제 및 대기 중인 요청 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>release</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>waitingQueue</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 대기 중인 요청을 먼저 처리 (FIFO)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>nextResolve</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>waitingQueue</span><span class=p>.</span><span class=nx>shift</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>nextResolve</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>available</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>get</span> <span class=nx>waitingCount</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>waitingQueue</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>APIGateway</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>semaphorePool</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>SemaphorePool</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 서비스별 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>serviceConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;user-service&#39;</span><span class=o>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;http://user-service:3001&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=nx>maxConcurrent</span><span class=o>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>timeout</span><span class=o>:</span> <span class=mi>5000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>fallback</span><span class=o>:</span> <span class=p>{</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;User service unavailable&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;movie-service&#39;</span><span class=o>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;http://movie-service:3002&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=nx>maxConcurrent</span><span class=o>:</span> <span class=mi>15</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>timeout</span><span class=o>:</span> <span class=mi>3000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>fallback</span><span class=o>:</span> <span class=p>{</span> <span class=nx>movies</span><span class=o>:</span> <span class=p>[]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;rating-service&#39;</span><span class=o>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;http://rating-service:3003&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=nx>maxConcurrent</span><span class=o>:</span> <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>timeout</span><span class=o>:</span> <span class=mi>4000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>fallback</span><span class=o>:</span> <span class=p>{</span> <span class=nx>rating</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>setupRoutes</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>setupRoutes</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 동적 프록시 라우팅
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/api/:service/*&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>serviceName</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>service</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>serviceConfig</span><span class=p>[</span><span class=nx>serviceName</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>config</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Service not found&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>proxyRequest</span><span class=p>(</span><span class=nx>serviceName</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 모니터링 엔드포인트
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/health/semaphores&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>timestamp</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=nx>semaphores</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>semaphorePool</span><span class=p>.</span><span class=nx>getStatus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>proxyRequest</span><span class=p>(</span><span class=nx>serviceName</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>serviceConfig</span><span class=p>[</span><span class=nx>serviceName</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>semaphore</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>semaphorePool</span><span class=p>.</span><span class=nx>getSemaphore</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>serviceName</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=nx>config</span><span class=p>.</span><span class=nx>maxConcurrent</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>startTime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 세마포어 획득 대기
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=nx>semaphore</span><span class=p>.</span><span class=nx>acquire</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=nx>serviceName</span><span class=si>}</span><span class=sb>] Request acquired permit`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 실제 서비스 호출
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>targetUrl</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>config</span><span class=p>.</span><span class=nx>url</span><span class=si>}${</span><span class=nx>req</span><span class=p>.</span><span class=nx>path</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>axios</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>method</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>url</span><span class=o>:</span> <span class=nx>targetUrl</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>data</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>...</span><span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;x-forwarded-for&#39;</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>ip</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;x-gateway-time&#39;</span><span class=o>:</span> <span class=nx>startTime</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=nx>timeout</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>timeout</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 성공 응답 전달
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=p>).</span><span class=nx>json</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=nx>serviceName</span><span class=si>}</span><span class=sb>] Request failed:`</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 타임아웃이나 서비스 에러 시 fallback 응답
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=s1>&#39;ECONNABORTED&#39;</span> <span class=o>||</span> <span class=nx>error</span><span class=p>.</span><span class=nx>response</span><span class=o>?</span><span class=p>.</span><span class=nx>status</span> <span class=o>&gt;=</span> <span class=mi>500</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>503</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=p>...</span><span class=nx>config</span><span class=p>.</span><span class=nx>fallback</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>_gateway_fallback</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>_error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span>
</span></span><span class=line><span class=cl>                <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>response</span><span class=o>?</span><span class=p>.</span><span class=nx>status</span> <span class=o>||</span> <span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=nx>error</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>_gateway_error</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 세마포어 해제 (반드시 실행)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>semaphore</span><span class=p>.</span><span class=nx>release</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>duration</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>startTime</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=nx>serviceName</span><span class=si>}</span><span class=sb>] Request completed in </span><span class=si>${</span><span class=nx>duration</span><span class=si>}</span><span class=sb>ms`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`API Gateway listening on port </span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Service configurations:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>serviceConfig</span><span class=p>).</span><span class=nx>forEach</span><span class=p>(([</span><span class=nx>name</span><span class=p>,</span> <span class=nx>config</span><span class=p>])</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`  </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>: max </span><span class=si>${</span><span class=nx>config</span><span class=p>.</span><span class=nx>maxConcurrent</span><span class=si>}</span><span class=sb> concurrent`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 실행
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>gateway</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>APIGateway</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>gateway</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mi>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 부하 테스트 스크립트 (별도 실행)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=kd>function</span> <span class=nx>loadTest</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>requests</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 100개의 동시 요청 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>100</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>requests</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>axios</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`http://localhost:3000/api/user-service/users/</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>({</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>err</span><span class=p>.</span><span class=nx>message</span> <span class=p>}))</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;부하 테스트 시작: 100개 동시 요청&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>start</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>results</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span><span class=nx>requests</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>duration</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>successful</span> <span class=o>=</span> <span class=nx>results</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>r</span> <span class=p>=&gt;</span> <span class=o>!</span><span class=nx>r</span><span class=p>.</span><span class=nx>error</span><span class=p>).</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>failed</span> <span class=o>=</span> <span class=nx>results</span><span class=p>.</span><span class=nx>length</span> <span class=o>-</span> <span class=nx>successful</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`테스트 완료 (</span><span class=si>${</span><span class=nx>duration</span><span class=si>}</span><span class=sb>ms):`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`  성공: </span><span class=si>${</span><span class=nx>successful</span><span class=si>}</span><span class=sb>, 실패: </span><span class=si>${</span><span class=nx>failed</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`  평균 처리율: </span><span class=si>${</span><span class=p>(</span><span class=nx>results</span><span class=p>.</span><span class=nx>length</span> <span class=o>/</span> <span class=nx>duration</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>).</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=sb> req/sec`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 10초 후 부하 테스트 실행
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>loadTest</span><span class=p>,</span> <span class=mi>10000</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=사례-결제-마이크로서비스가-외부-결제-게이트웨이-호출-개수-제한>사례: 결제 마이크로서비스가 외부 결제 게이트웨이 호출 개수 제한<a hidden class=anchor aria-hidden=true href=#사례-결제-마이크로서비스가-외부-결제-게이트웨이-호출-개수-제한>#</a></h5><p><strong>시나리오</strong>: " 결제 마이크로서비스 " 가 외부 결제 게이트웨이 호출을 전역적으로 <strong>동시 100 건</strong>으로 제한 (여러 인스턴스 합산). <strong>Redis 기반 분산 세마포어</strong>로 구현.</p><p><strong>시스템 구성</strong></p><ul><li>결제 서비스 (수평 확장) × N</li><li>Redis 클러스터 (TLS/ACL)</li><li>Lua 스크립트로 원자적 acquire/release</li></ul><p><strong>구성 다이어그램</strong></p><pre class=mermaid>graph TB
  C[Clients] --&gt; P1[Payment Svc Pod 1]
  C --&gt; P2[Payment Svc Pod 2]
  P1 --&gt; R[(Redis)]
  P2 --&gt; R
  R --&gt;|permits| P1
  R --&gt;|permits| P2
</pre><p><strong>Workflow</strong></p><ol><li>서비스 인스턴스가 <code>acquire(k=1)</code> 시도 (Lua 로 원자적 감소)</li><li>성공 시 외부 결제 API 호출</li><li>완료 시 <code>release(1)</code> 로 복원</li><li>실패/타임아웃 시 보상 로직/지표 기록</li></ol><p><strong>핵심 역할</strong></p><ul><li>Redis 키 공간이 <strong>전역 허가 수</strong>를 대표 → 인스턴스 합산 동시성 제어</li></ul><p><strong>유무 비교</strong></p><ul><li>도입 전: 트래픽 스파이크 시 게이트웨이 429/5xx 급증</li><li>도입 후: 실패율/지연 상한 안정, 비용 예측 가능</li></ul><p><strong>구현 예시</strong>:</p><ul><li><p>Node.js(분산 세마포어; 학습용 단순화)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12>12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13>13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14>14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15>15</a>
</span><span class=lnt id=hl-30-16><a class=lnlinks href=#hl-30-16>16</a>
</span><span class=lnt id=hl-30-17><a class=lnlinks href=#hl-30-17>17</a>
</span><span class=lnt id=hl-30-18><a class=lnlinks href=#hl-30-18>18</a>
</span><span class=lnt id=hl-30-19><a class=lnlinks href=#hl-30-19>19</a>
</span><span class=lnt id=hl-30-20><a class=lnlinks href=#hl-30-20>20</a>
</span><span class=lnt id=hl-30-21><a class=lnlinks href=#hl-30-21>21</a>
</span><span class=lnt id=hl-30-22><a class=lnlinks href=#hl-30-22>22</a>
</span><span class=lnt id=hl-30-23><a class=lnlinks href=#hl-30-23>23</a>
</span><span class=lnt id=hl-30-24><a class=lnlinks href=#hl-30-24>24</a>
</span><span class=lnt id=hl-30-25><a class=lnlinks href=#hl-30-25>25</a>
</span><span class=lnt id=hl-30-26><a class=lnlinks href=#hl-30-26>26</a>
</span><span class=lnt id=hl-30-27><a class=lnlinks href=#hl-30-27>27</a>
</span><span class=lnt id=hl-30-28><a class=lnlinks href=#hl-30-28>28</a>
</span><span class=lnt id=hl-30-29><a class=lnlinks href=#hl-30-29>29</a>
</span><span class=lnt id=hl-30-30><a class=lnlinks href=#hl-30-30>30</a>
</span><span class=lnt id=hl-30-31><a class=lnlinks href=#hl-30-31>31</a>
</span><span class=lnt id=hl-30-32><a class=lnlinks href=#hl-30-32>32</a>
</span><span class=lnt id=hl-30-33><a class=lnlinks href=#hl-30-33>33</a>
</span><span class=lnt id=hl-30-34><a class=lnlinks href=#hl-30-34>34</a>
</span><span class=lnt id=hl-30-35><a class=lnlinks href=#hl-30-35>35</a>
</span><span class=lnt id=hl-30-36><a class=lnlinks href=#hl-30-36>36</a>
</span><span class=lnt id=hl-30-37><a class=lnlinks href=#hl-30-37>37</a>
</span><span class=lnt id=hl-30-38><a class=lnlinks href=#hl-30-38>38</a>
</span><span class=lnt id=hl-30-39><a class=lnlinks href=#hl-30-39>39</a>
</span><span class=lnt id=hl-30-40><a class=lnlinks href=#hl-30-40>40</a>
</span><span class=lnt id=hl-30-41><a class=lnlinks href=#hl-30-41>41</a>
</span><span class=lnt id=hl-30-42><a class=lnlinks href=#hl-30-42>42</a>
</span><span class=lnt id=hl-30-43><a class=lnlinks href=#hl-30-43>43</a>
</span><span class=lnt id=hl-30-44><a class=lnlinks href=#hl-30-44>44</a>
</span><span class=lnt id=hl-30-45><a class=lnlinks href=#hl-30-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Redis 분산 세마포어 (학습용): 생산환경은 라이브러리/검증된 알고리즘 사용 권장
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>createClient</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;redis&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=nx>createClient</span><span class=p>({</span> <span class=nx>url</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>REDIS_URL</span><span class=p>,</span> <span class=nx>socket</span><span class=o>:</span> <span class=p>{</span> <span class=nx>tls</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span> <span class=p>});</span> <span class=c1>// 보안
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>KEY</span> <span class=o>=</span> <span class=s2>&#34;sema:payments&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>MAX</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 초기화(배포시 한번)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>setNX</span><span class=p>(</span><span class=nx>KEY</span><span class=p>,</span> <span class=nx>MAX</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Lua 스크립트: atomic acquire (count&gt;0 -&gt; decrement &amp; return 1, else 0)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>ACQUIRE</span> <span class=o>=</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>local v = tonumber(redis.call(&#39;GET&#39;, KEYS[1]) or &#39;0&#39;)
</span></span></span><span class=line><span class=cl><span class=sb>if v &gt; 0 then
</span></span></span><span class=line><span class=cl><span class=sb>  redis.call(&#39;DECR&#39;, KEYS[1])
</span></span></span><span class=line><span class=cl><span class=sb>  return 1
</span></span></span><span class=line><span class=cl><span class=sb>else
</span></span></span><span class=line><span class=cl><span class=sb>  return 0
</span></span></span><span class=line><span class=cl><span class=sb>end
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Lua 스크립트: atomic release (increment but cap at MAX)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>RELEASE</span> <span class=o>=</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>local v = tonumber(redis.call(&#39;GET&#39;, KEYS[1]) or &#39;0&#39;)
</span></span></span><span class=line><span class=cl><span class=sb>if v &lt; tonumber(ARGV[1]) then
</span></span></span><span class=line><span class=cl><span class=sb>  redis.call(&#39;INCR&#39;, KEYS[1])
</span></span></span><span class=line><span class=cl><span class=sb>end
</span></span></span><span class=line><span class=cl><span class=sb>return 1
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>acquire</span><span class=p>(</span><span class=nx>timeoutMs</span> <span class=o>=</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>start</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>start</span> <span class=o>&lt;</span> <span class=nx>timeoutMs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ok</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nb>eval</span><span class=p>(</span><span class=nx>ACQUIRE</span><span class=p>,</span> <span class=p>{</span> <span class=nx>keys</span><span class=o>:</span> <span class=p>[</span><span class=nx>KEY</span><span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>ok</span> <span class=o>===</span> <span class=mi>1</span><span class=p>)</span> <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>                   <span class=c1>// 세마포어 획득(핵심)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>r</span> <span class=p>=&gt;</span> <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=mi>5</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kc>false</span><span class=p>;</span> <span class=c1>// 타임아웃
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>release</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nb>eval</span><span class=p>(</span><span class=nx>RELEASE</span><span class=p>,</span> <span class=p>{</span> <span class=nx>keys</span><span class=o>:</span> <span class=p>[</span><span class=nx>KEY</span><span class=p>],</span> <span class=nx>arguments</span><span class=o>:</span> <span class=p>[</span><span class=nb>String</span><span class=p>(</span><span class=nx>MAX</span><span class=p>)]</span> <span class=p>});</span> <span class=c1>// 세마포어 반환(핵심)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>분산 록/세마포어는 Redis 문서의 패턴과 동급 개념</p></li><li><p>Redlock 은 <strong>잠금 (lease)</strong> 알고리즘으로 세마포어와 목적이 다르며 신뢰성 논쟁이 있으므로 요구 사항에 맞춰 선택</p></li></ul><h3 id=운영-및-최적화-operations--optimization>운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#운영-및-최적화-operations--optimization>#</a></h3><h4 id=보안-및-거버넌스>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>완화/관리 방법</th><th>구현 예시</th></tr></thead><tbody><tr><td><strong>보안</strong></td><td>접근 제어</td><td>세마포어 생성·수정·삭제 권한 제한</td><td>ACL, 인증 연동</td><td>POSIX named 세마포어에 OS 권한 부여</td></tr><tr><td></td><td>데이터 보호</td><td>IPC/분산 전송 시 암호화</td><td>TLS, 네임스페이스 격리</td><td>Redis + TLS, 키 Prefix</td></tr><tr><td></td><td>우선순위 역전 방지</td><td>낮은 우선순위가 높은 우선순위를 블록하는 문제 방지</td><td>우선순위 상속/천장</td><td>RTOS priority inheritance</td></tr><tr><td></td><td>DoS 방지</td><td>세마포어 고갈 공격 차단</td><td>타임아웃, 최대 대기 제한</td><td><code>sem_timedwait</code>, 요청 수 제한</td></tr><tr><td><strong>운영 안정성</strong></td><td>Deadlock 예방</td><td>순환 대기 방지</td><td>자원 획득 순서 정의, 탐지 알고리즘</td><td>전역 자원 순서 테이블</td></tr><tr><td></td><td>Starvation 방지</td><td>특정 스레드 무한 대기 방지</td><td>FIFO 큐, 우선순위 부스팅</td><td>Java fair semaphore</td></tr><tr><td></td><td>장기 보유 탐지</td><td>장시간 해제 안 함 모니터링</td><td>Watchdog, 메트릭 기반 알람</td><td>Prometheus + Alertmanager</td></tr><tr><td><strong>거버넌스</strong></td><td>감사 로깅</td><td>획득/반납/타임아웃 이력 기록</td><td>중앙 로그 서버, SIEM 연동</td><td>ELK, Splunk</td></tr><tr><td></td><td>정책 준수</td><td>내부 보안 규정·외부 법규 준수</td><td>변경 이력 추적, 권한 최소화</td><td>ISO 27001 프로세스</td></tr><tr><td></td><td>리소스 한계 관리</td><td>시스템별 세마포어 개수 제한</td><td>OS/런타임 파라미터 조정</td><td>Linux <code>SEMMSL</code>, <code>SEMMNI</code></td></tr></tbody></table><p>세마포어 보안·거버넌스의 핵심은 <strong>권한·접근 제어</strong>, <strong>데이터 보호</strong>, <strong>동시성 위험 완화</strong>(Deadlock, Starvation, 우선순위 역전), <strong>서비스 안정성</strong>(DoS 방지, 장기 보유 감지), 그리고 <strong>정책·규정 준수</strong>다.<br>IPC·분산 환경에서는 네임스페이스 격리와 전송 암호화가 필수이며, 운영 환경에서는 공정성·타임아웃·감사 로깅을 통해 위험을 예방하고 추적 가능성을 확보해야 한다.</p><h4 id=모니터링-및-관측성>모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성>#</a></h4><p>세마포어의 모니터링과 관측성은 <strong>핵심 메트릭 수집</strong>, <strong>구조화된 로깅/분산 트레이싱</strong>, <strong>알람 및 자동화 대응</strong>으로 구성된다.<br>운영자는 <code>available_permits</code>, <code>wait_queue_length</code>, <code>acquire_latency</code>, <code>timeout_rate</code>, <code>acquire/release throughput</code> 등을 지속적으로 관측하고, CPU/메모리 사용률, 컨텍스트 스위치, 스레드 상태 등 시스템 지표와 함께 분석해야 한다.<br>구조화된 JSON 로깅과 코릴레이션 ID 를 활용하면 요청 단위의 자원 점유 패턴 추적이 가능하며, OpenTelemetry 같은 표준 도구로 스팬/메트릭 통합이 가능하다.<br>경보 조건 (타임아웃 급증, 대기시간 임계 초과, 자원 불균형) 은 자동 스케일링이나 장애 대응의 트리거로 활용할 수 있다.<br>분산 환경에서는 네트워크 지연과 리더 선출 이벤트도 모니터링하여 스플릿 브레인 등 동기화 오류를 조기에 탐지해야 한다.</p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>활용 예</th></tr></thead><tbody><tr><td><strong>핵심 메트릭</strong></td><td>Available Permits</td><td>사용 가능 자원 수</td><td>리소스 풀 크기 적정성 평가</td></tr><tr><td></td><td>Wait Queue Length</td><td>대기 중 스레드 수</td><td>병목 탐지</td></tr><tr><td></td><td>Acquire/Release Rate</td><td>획득/해제 속도</td><td>처리량 변화 분석</td></tr><tr><td></td><td>Acquire Latency</td><td>자원 획득까지 걸린 시간</td><td>성능 저하 감지</td></tr><tr><td></td><td>Timeout Rate</td><td>타임아웃 비율</td><td>과부하 여부 판단</td></tr><tr><td><strong>시스템 메트릭</strong></td><td>CPU/메모리 사용률</td><td>리소스 사용 상태</td><td>병목 원인 분석</td></tr><tr><td></td><td>Context Switch</td><td>스레드 전환 빈도</td><td>동기화 비용 측정</td></tr><tr><td><strong>로깅/트레이싱</strong></td><td>구조화 로깅</td><td>JSON 포맷 이벤트 기록</td><td>중앙 로깅/검색</td></tr><tr><td></td><td>코릴레이션 ID</td><td>요청 단위 추적</td><td>분산 트랜잭션 분석</td></tr><tr><td></td><td>OpenTelemetry</td><td>스팬 + 메트릭 통합</td><td>엔드투엔드 모니터링</td></tr><tr><td><strong>알람 조건</strong></td><td>Timeout 급증</td><td>과부하/자원 부족 감지</td><td>운영 대응</td></tr><tr><td></td><td>대기시간 임계 초과</td><td>SLA 위반 가능성</td><td>자동 스케일링</td></tr><tr><td><strong>분산 환경 추가</strong></td><td>네트워크 지연</td><td>자원 동기화 지연 분석</td><td>분산 세마포어 안정성 확보</td></tr><tr><td></td><td>리더 선출 이벤트</td><td>동기화 메커니즘 상태 파악</td><td>장애 대응</td></tr></tbody></table><h4 id=실무-적용-고려사항-및-주의점>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점>#</a></h4><p>세마포어를 실무에 적용할 때는 <strong>설계·구현·운영 전 주기적 고려</strong>가 필요하다.</p><ul><li>설계 시, 자원 수·공정성·분산 환경 동기화 정책을 먼저 정의한다.</li><li>구현 시, 타임아웃·반환 보장·예외 처리·임계 구역 최소화를 통해 안정성을 확보한다.</li><li>운영 시, 모니터링·큐 크기 제한·데드락 방지·성능 최적화로 장기적인 안정성을 유지한다.</li></ul><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>설계</td><td>카운터 값 결정</td><td>적정 동시성 수준 설정</td><td>부하 테스트 기반 최적값 산출</td></tr><tr><td>설계</td><td>공정성 보장</td><td>기아 상태 방지</td><td>FIFO/우선순위 큐 적용</td></tr><tr><td>설계</td><td>분산 환경 고려</td><td>다중 노드 동기화</td><td>세션·리더·시계 설계, ZooKeeper/Curator 활용</td></tr><tr><td>구현</td><td>타임아웃 설정</td><td>무한 대기 방지</td><td>SLA·비즈니스 요구 기반 timeout</td></tr><tr><td>구현</td><td>반환 보장</td><td>permit 릭 방지</td><td>finally/defer/RAII 패턴</td></tr><tr><td>구현</td><td>예외 처리</td><td>누수 및 장애 방지</td><td>복구 로직 포함</td></tr><tr><td>구현</td><td>임계 구역 최소화</td><td>병목 방지</td><td>필수 부분만 동기화</td></tr><tr><td>운영</td><td>모니터링/계측</td><td>자원 사용 가시화</td><td>Prometheus·OTel 지표 노출</td></tr><tr><td>운영</td><td>큐 크기 제한</td><td>메모리 과다 사용 방지</td><td>백프레셔 구현</td></tr><tr><td>운영</td><td>데드락 방지</td><td>순환 대기 차단</td><td>자원 획득 순서 통일, 타임아웃</td></tr><tr><td>운영</td><td>성능 최적화</td><td>오버헤드 감소</td><td>SemaphoreSlim, lock-free 구조</td></tr></tbody></table><ul><li><strong>설계</strong>: 자원 수와 공정성 정책을 명확히 정의하고, 분산 환경에서는 시계 동기화·리더 선출 전략을 반영해야 함.</li><li><strong>구현</strong>: 타임아웃·반환 보장·예외 처리를 통해 안정성과 릭 방지, 임계 구역 최소화로 성능 확보.</li><li><strong>운영</strong>: 메트릭 기반 모니터링, 큐 크기 제한, 데드락 방지, 성능 최적화로 지속적인 안정성을 유지.</li></ul><h5 id=장애복구-관점>장애·복구 관점<a hidden class=anchor aria-hidden=true href=#장애복구-관점>#</a></h5><ul><li><strong>Fail-Fast</strong>: 세마포어 획득 실패 시 즉시 예외 처리</li><li><strong>Graceful Degradation</strong>: 제한에 걸리면 대체 경로 (Fallback) 호출</li><li><strong>Self-healing</strong>: 세마포어 상태 불일치 시 자동 리셋/재동기화</li></ul><h4 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h4><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>성능 튜닝</strong></td><td>락 경합 최소화</td><td>동시 접근 빈도 줄이고 락 범위 최소화</td><td>lock granularity 조정, 파티셔닝</td></tr><tr><td></td><td>커널 호출 감소</td><td>컨텍스트 스위칭 비용 줄임</td><td>SemaphoreSlim·유저 공간 구현</td></tr><tr><td></td><td>스핀·블록 전략</td><td>대기 시간에 따라 방식 선택</td><td>짧은 대기 스핀, 긴 대기 블록</td></tr><tr><td></td><td>배치 처리</td><td>여러 permit 일괄 처리</td><td>컨텍스트 스위칭 감소</td></tr><tr><td><strong>확장성 최적화</strong></td><td>NUMA-aware</td><td>로컬 메모리 우선 접근</td><td>NUMA 최적화 배치</td></tr><tr><td></td><td>캐시 친화</td><td>false sharing 방지</td><td>구조체 패딩·메모리 레이아웃 조정</td></tr><tr><td></td><td>샤딩</td><td>리소스별 세마포어 분리</td><td>대기 시간 단축</td></tr><tr><td></td><td>가중 세마포어</td><td>요청 비용 기반 제한</td><td>Weighted Semaphore 사용</td></tr><tr><td><strong>안정성·신뢰성</strong></td><td>데드락 방지</td><td>자원 획득 순서 통일</td><td>전역 자원 순서 정의</td></tr><tr><td></td><td>기아 방지</td><td>특정 스레드 무한 대기 방지</td><td>FIFO·우선순위 큐</td></tr><tr><td></td><td>백오프 전략</td><td>실패 시 재시도 간격 조정</td><td>지수적·적응적 백오프</td></tr><tr><td></td><td>동적 Permit 조정</td><td>부하 패턴 대응</td><td>Adaptive Throttling</td></tr><tr><td><strong>비동기·하이브리드 패턴</strong></td><td>비동기 패턴</td><td>스레드 블록 없이 동기화</td><td>async-await·코루틴</td></tr><tr><td></td><td>하이브리드 대기</td><td>스핀 후 블록 전환</td><td>spin-then-park 전략</td></tr><tr><td></td><td>lock-free 결합</td><td>경합 지점 제거</td><td>lock-free 큐·카운터</td></tr><tr><td><strong>모니터링·피드백</strong></td><td>지표 수집</td><td>TPS·지연·경합 모니터링</td><td>실시간 분석 후 파라미터 조정</td></tr></tbody></table><p>세마포어 최적화의 핵심은 <strong>락 경합 최소화</strong>와 <strong>커널 호출 억제</strong>를 통한 성능 확보, <strong>NUMA·캐시 친화</strong> 설계를 통한 확장성, <strong>데드락·기아 방지</strong>와 백오프 전략을 통한 안정성 유지, 그리고 <strong>비동기·하이브리드 대기</strong>로 불필요한 스레드 블로킹을 줄이는 것이다. 마지막으로 <strong>모니터링 기반 피드백 루프</strong>를 적용해야 운영 중에도 지속적으로 성능을 조정·개선할 수 있다.</p><h3 id=고급-주제-advanced-topics>고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#고급-주제-advanced-topics>#</a></h3><h4 id=현재-도전-과제>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제>#</a></h4><p>세마포어의 실무 적용에서 직면하는 도전 과제는 크게 <strong>분산 동기화, 클라우드 네이티브 관측성, 성능 - 공정성 균형, AI 워크로드 확장성, 보안 위협</strong>으로 나눌 수 있다.<br>분산 환경에서는 네트워크 지연·파티션·시계 드리프트가 일관성을 해치며, Redlock 의 안정성 논란도 존재한다.<br>클라우드 네이티브 환경에서는 마이크로서비스 간 동시성 제어 상태가 사각지대를 만들고, 통합 관측성 플랫폼 도입이 필수다.<br>FIFO 기반 공정성은 기아를 줄이지만 처리량을 떨어뜨릴 수 있어, 상황에 따라 적응적 정책이 필요하다.<br>AI 워크로드는 에너지와 자원 소비가 폭증하므로 에너지 인식형 스케줄링과 GPU 토큰 제어가 필요하다.<br>보안 측면에서는 세마포어를 이용한 DoS 공격을 방지하기 위해 인증·이상 탐지·Rate-limiting 을 결합해야 한다.</p><table><thead><tr><th>카테고리</th><th>과제</th><th>원인</th><th>영향</th><th>해결방안</th></tr></thead><tbody><tr><td><strong>분산 환경 동기화</strong></td><td>네트워크 지연·일관성 확보</td><td>지리적 분산, 네트워크 파티션, 시계 드리프트</td><td>중복 접근, 데이터 불일치</td><td>ZooKeeper/etcd 기반 세션·lease, Redlock 대안</td></tr><tr><td><strong>클라우드 네이티브 복잡성</strong></td><td>관측성 사각지대</td><td>마이크로서비스 다수, 포인트 툴 난립</td><td>디버깅·성능 분석 어려움</td><td>통합 관측성 플랫폼, sidecar observability</td></tr><tr><td><strong>성능·공정성 트레이드오프</strong></td><td>FIFO 공정성에 따른 처리량 저하</td><td>대기 순서 보장 정책</td><td>전체 처리율 감소, 응답 지연</td><td>적응형 정책, 혼합 스케줄링</td></tr><tr><td><strong>AI 워크로드 스케일링</strong></td><td>자원 경합·에너지 폭증</td><td>AI 연산 수요 증가, GPU 병목</td><td>성능 저하, 비용 상승</td><td>에너지 인식 스케줄링, GPU 토큰 제어</td></tr><tr><td><strong>보안 위협</strong></td><td>세마포어 남용·DoS 공격</td><td>악의적 요청 폭주</td><td>서비스 중단, 자원 고갈</td><td>인증 기반 세마포어, 이상 탐지, Rate-limiting</td></tr></tbody></table><h4 id=생태계-및-관련-기술>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술>#</a></h4><p>세마포어는 다양한 환경과 기술 스택에서 활용되며, 동기화/분산 제어/관측성 표준과 결합되어 사용된다.<br>플랫폼·언어별 구현체에서부터, Mutex·Monitor·Condition Variable 같은 동기화 객체,<br>ZooKeeper·Redis 기반의 분산 세마포어, OpenTelemetry·gRPC·CloudEvents 기반의 표준화된 상태 전파까지 폭넓게 연계된다.<br>또한 서비스 메시, API 게이트웨이, Kubernetes 와 같은 클라우드 네이티브 인프라와 결합되어 확장성이 보장된다.</p><table><thead><tr><th>카테고리</th><th>기술/구현체</th><th>주요 기능</th><th>표준/프로토콜</th></tr></thead><tbody><tr><td><strong>플랫폼·언어 런타임</strong></td><td>POSIX 세마포어/네임드 세마포어</td><td>프로세스/스레드 간 동기화, IPC</td><td>POSIX API (<code>sem_init</code>, <code>sem_wait</code>)</td></tr><tr><td></td><td>Java Semaphore</td><td>카운팅, fair/non-fair 모드</td><td>Java Concurrency API</td></tr><tr><td></td><td>Python threading.Semaphore</td><td>멀티스레드 동기화</td><td>Python stdlib</td></tr><tr><td></td><td>.NET SemaphoreSlim</td><td>경량 세마포어, 비동기 지원</td><td>.NET BCL</td></tr><tr><td></td><td>Go Weighted Semaphore</td><td>가중치 기반 permit 관리</td><td>Go sync/semaphore</td></tr><tr><td><strong>연관 동기화 기술</strong></td><td>Mutex</td><td>단일 자원 상호 배제</td><td>POSIX, WinAPI</td></tr><tr><td></td><td>Monitor</td><td>상호 배제 + 조건 대기</td><td>Java, C#</td></tr><tr><td></td><td>Condition Variable</td><td>이벤트 기반 동기화</td><td>POSIX, Java</td></tr><tr><td><strong>분산 환경 기술</strong></td><td>ZooKeeper InterProcessSemaphore</td><td>분산 세마포어 구현</td><td>Apache Curator</td></tr><tr><td></td><td>Redis 기반 세마포어/Redlock</td><td>분산 잠금/permit 관리</td><td>Redis API</td></tr><tr><td><strong>표준 및 프로토콜</strong></td><td>OpenTelemetry</td><td>세마포어 메트릭 표준화</td><td>OTLP</td></tr><tr><td></td><td>gRPC</td><td>세마포어 제어 API</td><td>HTTP/2</td></tr><tr><td></td><td>OpenAPI</td><td>REST 기반 세마포어 API</td><td>OpenAPI Spec</td></tr><tr><td></td><td>CloudEvents</td><td>상태 변경 이벤트 표준</td><td>CNCF CloudEvents</td></tr><tr><td><strong>확장 연계 스택</strong></td><td>서비스 메시 (Istio)</td><td>요청 레이트 제어</td><td>Envoy/Istio API</td></tr><tr><td></td><td>API 게이트웨이</td><td>요청 동시성 제한</td><td>Kong, NGINX</td></tr><tr><td></td><td>이벤트 스트림</td><td>상태 이벤트 브로드캐스트</td><td>Kafka, NATS</td></tr><tr><td></td><td>워크플로우 엔진</td><td>동시 작업 슬롯 제어</td><td>Argo, Airflow</td></tr><tr><td></td><td>Kubernetes</td><td>컨테이너 리소스 동시성 제어</td><td>K8s API</td></tr></tbody></table><ul><li><strong>플랫폼·언어 런타임</strong>: OS 및 언어별 세마포어 API 와 특성을 파악해야 효율적으로 동기화 가능</li><li><strong>연관 동기화 기술</strong>: 세마포어는 Mutex, Monitor, Condition Variable 과 조합하여 사용 시 더 강력</li><li><strong>분산 환경 기술</strong>: ZooKeeper, Redis 같은 분산 코디네이션 서비스로 전역 동시성 제어 가능</li><li><strong>표준 및 프로토콜</strong>: OpenTelemetry, gRPC, CloudEvents 등으로 상태·메트릭 전파를 표준화</li><li><strong>확장 연계 스택</strong>: 서비스 메시, API 게이트웨이, 워크플로우 엔진과 결합하여 서비스 전체 동시성 관리</li></ul><p><strong>통합 연계 가능한 기술</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;현대 동기화 스택&#34;
        A[세마포어] --&gt; B[서비스 메시]
        A --&gt; C[API 게이트웨이]
        A --&gt; D[이벤트 스트림]
        A --&gt; E[워크플로우 엔진]
    end
    
    subgraph &#34;클라우드 네이티브&#34;
        F[Kubernetes] --&gt; G[Istio Service Mesh]
        F --&gt; H[Prometheus Monitoring]
        F --&gt; I[OpenTelemetry Tracing]
        F --&gt; J[ArgoCD GitOps]
    end
    
    subgraph &#34;AI/ML 통합&#34;
        K[TensorFlow Serving] --&gt; L[Ray Distributed Computing]
        K --&gt; M[Kubernetes Jobs]
        K --&gt; N[MLflow Tracking]
    end
    
    A --&gt; F
    G --&gt; A
    H --&gt; A
    I --&gt; A
</pre><p><strong>표준 및 프로토콜</strong>:</p><ul><li><strong>OpenTelemetry</strong>: 클라우드 네이티브 관측성의 표준화로 세마포어 메트릭 수집</li><li><strong>gRPC</strong>: 분산 세마포어 서비스 간 통신 프로토콜</li><li><strong>OpenAPI</strong>: 세마포어 관리 API 표준화</li><li><strong>CloudEvents</strong>: 세마포어 상태 변경 이벤트 표준</li></ul><h4 id=최신-기술-트렌드와-미래-방향>최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드와-미래-방향>#</a></h4><table><thead><tr><th>카테고리</th><th>트렌드/방향</th><th>핵심 아이디어</th><th>도입 시 고려사항</th><th>대표 레퍼런스</th></tr></thead><tbody><tr><td>언어·런타임</td><td>비동기/경량 세마포어의 기본값화</td><td><code>WaitAsync</code>/코루틴으로 블로킹 최소화</td><td>취소/타임아웃·스레드풀 고갈 방지</td><td>.NET SemaphoreSlim, asyncio ([Microsoft Learn][1], [Python documentation][2])</td></tr><tr><td>언어·런타임</td><td>Python 무 GIL(Free-threaded)</td><td>인터프리터 레벨 병렬성 확대 신호</td><td>" 실험적 " 상태—성능/안전성 벤치 필요</td><td>Python 3.13 WN, PEP 703 ([Python documentation][8], [Python Enhancement Proposals (PEPs)][9])</td></tr><tr><td>분산/서버리스</td><td>Step Functions+DynamoDB 세마포어</td><td>조건부 쓰기·상태머신으로 분산 동시성 제어</td><td>실패 시 롤백·클린업·모니터링 체계</td><td>AWS Compute/Database Blog ([Amazon Web Services, Inc.][3])</td></tr><tr><td>분산/서버리스</td><td>Redis Redlock 신중 채택</td><td>경량·간단하지만 안전성 논쟁</td><td>장애 모델·클록·네트워크 분할 가정 명확화</td><td>Kleppmann/antirez 논의 ([martin.kleppmann.com][5], [antirez.com][4])</td></tr><tr><td>성능·확장성</td><td>가중 (Weighted) 세마포어</td><td>" 작업비용 가중치 " 로 공정·효율 동시 달성</td><td>가중치 산정·Head-of-line 방지</td><td>Go <code>x/sync/semaphore</code> ([pkg.go.dev][6])</td></tr><tr><td>성능·확장성</td><td>유저 공간 우선/배치/샤딩</td><td>커널 전환 감소·큐 분리로 p99 안정화</td><td>히스테리시스·백오프·혼잡제어 설계</td><td>.NET 가이드라인 ([Microsoft Learn][7])</td></tr><tr><td>그린/관측성</td><td>에너지·탄소 인식 세마포어</td><td>전력·탄소 지표 기반 스로틀링</td><td>SLO 와 충돌 시 정책 우선순위 설계</td><td>Kepler(에너지 메트릭) ([sustainable-computing.io][10])</td></tr></tbody></table><p>2025 년의 세마포어 트렌드는 <strong>비동기·경량화</strong>, <strong>분산/서버리스 패턴의 표준화</strong>, <strong>가중치·샤딩 등 성능 최적화의 체계화</strong>, 그리고 <strong>에너지·탄소 메트릭과의 연계</strong>로 요약된다.<br>Python 의 무 GIL 실험 도입은 동시성 기본 가정 자체를 바꾸는 변화의 시작점이며, 분산 세마포어는 " 패턴/아키텍처 " 수준에서 성숙해졌다. 다만 Redis Redlock 같은 기법은 <strong>위협 모델</strong>을 명확히 한 뒤 선택하는 것이 합리적이다.</p><h4 id=기타-고급-사항>기타 고급 사항<a hidden class=anchor aria-hidden=true href=#기타-고급-사항>#</a></h4><h5 id=세마포어-고급-패턴>세마포어 고급 패턴<a hidden class=anchor aria-hidden=true href=#세마포어-고급-패턴>#</a></h5><table><thead><tr><th>패턴</th><th>설명</th><th>적용 예시</th></tr></thead><tbody><tr><td><strong>Barrier + Semaphore 결합</strong></td><td>세마포어로 병렬 제한, Barrier 로 동시 시작 시점 조율</td><td>대규모 병렬 Job 동시 실행</td></tr><tr><td><strong>Semaphore Chaining</strong></td><td>여러 세마포어를 연속적으로 사용해 다단계 제어</td><td>네트워크 요청 → DB → 캐시 접근 제한</td></tr><tr><td><strong>Hybrid Locking</strong></td><td>세마포어와 뮤텍스를 혼합해 자원 접근 제어 + 데이터 일관성</td><td>동시성 높은 큐 관리</td></tr></tbody></table><h5 id=세마포어와-다른-동기화-기법의-융합>세마포어와 다른 동기화 기법의 융합<a hidden class=anchor aria-hidden=true href=#세마포어와-다른-동기화-기법의-융합>#</a></h5><table><thead><tr><th>기술</th><th>결합 시 기대효과</th><th>대표 사용 사례</th></tr></thead><tbody><tr><td>세마포어 (Semaphore) + 조건 변수 (Condition Variable)</td><td>조건 충족 시에만 동시성 허용</td><td>생산자/소비자 (Producer-Consumer) 패턴</td></tr><tr><td>세마포어 + 큐잉 메커니즘 (Queue Mechanism)</td><td>우선순위 기반 자원 접근 관리</td><td>실시간 OS 스케줄러</td></tr><tr><td>세마포어 + 락프리 자료구조 (Lock-Free Data Structures)</td><td>높은 처리량, 낮은 대기 시간</td><td>고주파 거래 (High-Frequency Trading)</td></tr></tbody></table><h5 id=세마포어--클라우드-네이티브-환경>세마포어 + 클라우드 네이티브 환경<a hidden class=anchor aria-hidden=true href=#세마포어--클라우드-네이티브-환경>#</a></h5><ul><li><strong>Kubernetes (쿠버네티스)</strong>:<ul><li>Pod 수평 확장 시 전역 동시성 제어 필요 → <code>ConfigMap</code> + <code>Lease API</code> 또는 외부 코디네이션 서비스 (ZooKeeper, Redis)</li></ul></li><li><strong>Serverless 환경</strong>:<ul><li>AWS Lambda, GCP Cloud Functions → 동시 실행 제한은 플랫폼 설정 + 애플리케이션 레벨 세마포어 조합</li></ul></li><li><strong>Service Mesh</strong>:<ul><li>Istio/Linkerd 의 rate limiting 필터와 세마포어 결합 가능</li></ul></li></ul><h5 id=분산-환경에서의-세마포어-구현>분산 환경에서의 세마포어 구현<a hidden class=anchor aria-hidden=true href=#분산-환경에서의-세마포어-구현>#</a></h5><p><strong>분산 세마포어 (Distributed Semaphore)</strong>: 여러 노드나 서비스가 물리적으로 분리된 환경에서 세마포어 역할을 수행하여, 글로벌 동시성 제어를 가능하게 함.</p><p><strong>구현 기술</strong></p><ul><li><strong>Redis 기반 세마포어</strong>: INCR/DECR 명령과 TTL(Time To Live) 을 이용해 세마포어 역할 구현</li><li><strong>ZooKeeper 기반 세마포어</strong>: ZNode 를 이용해 잠금/해제 구현 및 분산 합의</li><li><strong>Etcd 기반 분산 락</strong>: 리더 선출과 TTL 을 이용해 안전한 global lock 기능 제공</li></ul><p><strong>구현 예시</strong>: Redis + Python</p><ul><li><strong>ZSET 홀더 (holders)</strong>: 만료 시각 (score) 로 퍼밋 보유자를 저장 → 크래시 시 TTL 지나면 자동 회수</li><li><strong>LIST 대기큐 (queue) + SET(waiters)</strong>: FIFO 보장 및 중복 등록 방지</li><li><strong>토큰별 메일박스 (list) 로 알림</strong>: <code>LPUSH mailbox:&lt;token></code> → 클라이언트는 <code>BLPOP</code> 대기, <strong>미스드 신호 방지</strong></li><li><strong>Lua 스크립트로 원자성 확보</strong>: " 만료 청소 → 큐/용량 검사 → 부여/알림 " 을 한 번에 처리</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1>  1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2>  2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3>  3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4>  4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5>  5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6>  6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7>  7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8>  8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9>  9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10> 10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11> 11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12> 12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13> 13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14> 14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15> 15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16> 16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17> 17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18> 18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19> 19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20> 20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21> 21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22> 22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23> 23</a>
</span><span class=lnt id=hl-32-24><a class=lnlinks href=#hl-32-24> 24</a>
</span><span class=lnt id=hl-32-25><a class=lnlinks href=#hl-32-25> 25</a>
</span><span class=lnt id=hl-32-26><a class=lnlinks href=#hl-32-26> 26</a>
</span><span class=lnt id=hl-32-27><a class=lnlinks href=#hl-32-27> 27</a>
</span><span class=lnt id=hl-32-28><a class=lnlinks href=#hl-32-28> 28</a>
</span><span class=lnt id=hl-32-29><a class=lnlinks href=#hl-32-29> 29</a>
</span><span class=lnt id=hl-32-30><a class=lnlinks href=#hl-32-30> 30</a>
</span><span class=lnt id=hl-32-31><a class=lnlinks href=#hl-32-31> 31</a>
</span><span class=lnt id=hl-32-32><a class=lnlinks href=#hl-32-32> 32</a>
</span><span class=lnt id=hl-32-33><a class=lnlinks href=#hl-32-33> 33</a>
</span><span class=lnt id=hl-32-34><a class=lnlinks href=#hl-32-34> 34</a>
</span><span class=lnt id=hl-32-35><a class=lnlinks href=#hl-32-35> 35</a>
</span><span class=lnt id=hl-32-36><a class=lnlinks href=#hl-32-36> 36</a>
</span><span class=lnt id=hl-32-37><a class=lnlinks href=#hl-32-37> 37</a>
</span><span class=lnt id=hl-32-38><a class=lnlinks href=#hl-32-38> 38</a>
</span><span class=lnt id=hl-32-39><a class=lnlinks href=#hl-32-39> 39</a>
</span><span class=lnt id=hl-32-40><a class=lnlinks href=#hl-32-40> 40</a>
</span><span class=lnt id=hl-32-41><a class=lnlinks href=#hl-32-41> 41</a>
</span><span class=lnt id=hl-32-42><a class=lnlinks href=#hl-32-42> 42</a>
</span><span class=lnt id=hl-32-43><a class=lnlinks href=#hl-32-43> 43</a>
</span><span class=lnt id=hl-32-44><a class=lnlinks href=#hl-32-44> 44</a>
</span><span class=lnt id=hl-32-45><a class=lnlinks href=#hl-32-45> 45</a>
</span><span class=lnt id=hl-32-46><a class=lnlinks href=#hl-32-46> 46</a>
</span><span class=lnt id=hl-32-47><a class=lnlinks href=#hl-32-47> 47</a>
</span><span class=lnt id=hl-32-48><a class=lnlinks href=#hl-32-48> 48</a>
</span><span class=lnt id=hl-32-49><a class=lnlinks href=#hl-32-49> 49</a>
</span><span class=lnt id=hl-32-50><a class=lnlinks href=#hl-32-50> 50</a>
</span><span class=lnt id=hl-32-51><a class=lnlinks href=#hl-32-51> 51</a>
</span><span class=lnt id=hl-32-52><a class=lnlinks href=#hl-32-52> 52</a>
</span><span class=lnt id=hl-32-53><a class=lnlinks href=#hl-32-53> 53</a>
</span><span class=lnt id=hl-32-54><a class=lnlinks href=#hl-32-54> 54</a>
</span><span class=lnt id=hl-32-55><a class=lnlinks href=#hl-32-55> 55</a>
</span><span class=lnt id=hl-32-56><a class=lnlinks href=#hl-32-56> 56</a>
</span><span class=lnt id=hl-32-57><a class=lnlinks href=#hl-32-57> 57</a>
</span><span class=lnt id=hl-32-58><a class=lnlinks href=#hl-32-58> 58</a>
</span><span class=lnt id=hl-32-59><a class=lnlinks href=#hl-32-59> 59</a>
</span><span class=lnt id=hl-32-60><a class=lnlinks href=#hl-32-60> 60</a>
</span><span class=lnt id=hl-32-61><a class=lnlinks href=#hl-32-61> 61</a>
</span><span class=lnt id=hl-32-62><a class=lnlinks href=#hl-32-62> 62</a>
</span><span class=lnt id=hl-32-63><a class=lnlinks href=#hl-32-63> 63</a>
</span><span class=lnt id=hl-32-64><a class=lnlinks href=#hl-32-64> 64</a>
</span><span class=lnt id=hl-32-65><a class=lnlinks href=#hl-32-65> 65</a>
</span><span class=lnt id=hl-32-66><a class=lnlinks href=#hl-32-66> 66</a>
</span><span class=lnt id=hl-32-67><a class=lnlinks href=#hl-32-67> 67</a>
</span><span class=lnt id=hl-32-68><a class=lnlinks href=#hl-32-68> 68</a>
</span><span class=lnt id=hl-32-69><a class=lnlinks href=#hl-32-69> 69</a>
</span><span class=lnt id=hl-32-70><a class=lnlinks href=#hl-32-70> 70</a>
</span><span class=lnt id=hl-32-71><a class=lnlinks href=#hl-32-71> 71</a>
</span><span class=lnt id=hl-32-72><a class=lnlinks href=#hl-32-72> 72</a>
</span><span class=lnt id=hl-32-73><a class=lnlinks href=#hl-32-73> 73</a>
</span><span class=lnt id=hl-32-74><a class=lnlinks href=#hl-32-74> 74</a>
</span><span class=lnt id=hl-32-75><a class=lnlinks href=#hl-32-75> 75</a>
</span><span class=lnt id=hl-32-76><a class=lnlinks href=#hl-32-76> 76</a>
</span><span class=lnt id=hl-32-77><a class=lnlinks href=#hl-32-77> 77</a>
</span><span class=lnt id=hl-32-78><a class=lnlinks href=#hl-32-78> 78</a>
</span><span class=lnt id=hl-32-79><a class=lnlinks href=#hl-32-79> 79</a>
</span><span class=lnt id=hl-32-80><a class=lnlinks href=#hl-32-80> 80</a>
</span><span class=lnt id=hl-32-81><a class=lnlinks href=#hl-32-81> 81</a>
</span><span class=lnt id=hl-32-82><a class=lnlinks href=#hl-32-82> 82</a>
</span><span class=lnt id=hl-32-83><a class=lnlinks href=#hl-32-83> 83</a>
</span><span class=lnt id=hl-32-84><a class=lnlinks href=#hl-32-84> 84</a>
</span><span class=lnt id=hl-32-85><a class=lnlinks href=#hl-32-85> 85</a>
</span><span class=lnt id=hl-32-86><a class=lnlinks href=#hl-32-86> 86</a>
</span><span class=lnt id=hl-32-87><a class=lnlinks href=#hl-32-87> 87</a>
</span><span class=lnt id=hl-32-88><a class=lnlinks href=#hl-32-88> 88</a>
</span><span class=lnt id=hl-32-89><a class=lnlinks href=#hl-32-89> 89</a>
</span><span class=lnt id=hl-32-90><a class=lnlinks href=#hl-32-90> 90</a>
</span><span class=lnt id=hl-32-91><a class=lnlinks href=#hl-32-91> 91</a>
</span><span class=lnt id=hl-32-92><a class=lnlinks href=#hl-32-92> 92</a>
</span><span class=lnt id=hl-32-93><a class=lnlinks href=#hl-32-93> 93</a>
</span><span class=lnt id=hl-32-94><a class=lnlinks href=#hl-32-94> 94</a>
</span><span class=lnt id=hl-32-95><a class=lnlinks href=#hl-32-95> 95</a>
</span><span class=lnt id=hl-32-96><a class=lnlinks href=#hl-32-96> 96</a>
</span><span class=lnt id=hl-32-97><a class=lnlinks href=#hl-32-97> 97</a>
</span><span class=lnt id=hl-32-98><a class=lnlinks href=#hl-32-98> 98</a>
</span><span class=lnt id=hl-32-99><a class=lnlinks href=#hl-32-99> 99</a>
</span><span class=lnt id=hl-32-100><a class=lnlinks href=#hl-32-100>100</a>
</span><span class=lnt id=hl-32-101><a class=lnlinks href=#hl-32-101>101</a>
</span><span class=lnt id=hl-32-102><a class=lnlinks href=#hl-32-102>102</a>
</span><span class=lnt id=hl-32-103><a class=lnlinks href=#hl-32-103>103</a>
</span><span class=lnt id=hl-32-104><a class=lnlinks href=#hl-32-104>104</a>
</span><span class=lnt id=hl-32-105><a class=lnlinks href=#hl-32-105>105</a>
</span><span class=lnt id=hl-32-106><a class=lnlinks href=#hl-32-106>106</a>
</span><span class=lnt id=hl-32-107><a class=lnlinks href=#hl-32-107>107</a>
</span><span class=lnt id=hl-32-108><a class=lnlinks href=#hl-32-108>108</a>
</span><span class=lnt id=hl-32-109><a class=lnlinks href=#hl-32-109>109</a>
</span><span class=lnt id=hl-32-110><a class=lnlinks href=#hl-32-110>110</a>
</span><span class=lnt id=hl-32-111><a class=lnlinks href=#hl-32-111>111</a>
</span><span class=lnt id=hl-32-112><a class=lnlinks href=#hl-32-112>112</a>
</span><span class=lnt id=hl-32-113><a class=lnlinks href=#hl-32-113>113</a>
</span><span class=lnt id=hl-32-114><a class=lnlinks href=#hl-32-114>114</a>
</span><span class=lnt id=hl-32-115><a class=lnlinks href=#hl-32-115>115</a>
</span><span class=lnt id=hl-32-116><a class=lnlinks href=#hl-32-116>116</a>
</span><span class=lnt id=hl-32-117><a class=lnlinks href=#hl-32-117>117</a>
</span><span class=lnt id=hl-32-118><a class=lnlinks href=#hl-32-118>118</a>
</span><span class=lnt id=hl-32-119><a class=lnlinks href=#hl-32-119>119</a>
</span><span class=lnt id=hl-32-120><a class=lnlinks href=#hl-32-120>120</a>
</span><span class=lnt id=hl-32-121><a class=lnlinks href=#hl-32-121>121</a>
</span><span class=lnt id=hl-32-122><a class=lnlinks href=#hl-32-122>122</a>
</span><span class=lnt id=hl-32-123><a class=lnlinks href=#hl-32-123>123</a>
</span><span class=lnt id=hl-32-124><a class=lnlinks href=#hl-32-124>124</a>
</span><span class=lnt id=hl-32-125><a class=lnlinks href=#hl-32-125>125</a>
</span><span class=lnt id=hl-32-126><a class=lnlinks href=#hl-32-126>126</a>
</span><span class=lnt id=hl-32-127><a class=lnlinks href=#hl-32-127>127</a>
</span><span class=lnt id=hl-32-128><a class=lnlinks href=#hl-32-128>128</a>
</span><span class=lnt id=hl-32-129><a class=lnlinks href=#hl-32-129>129</a>
</span><span class=lnt id=hl-32-130><a class=lnlinks href=#hl-32-130>130</a>
</span><span class=lnt id=hl-32-131><a class=lnlinks href=#hl-32-131>131</a>
</span><span class=lnt id=hl-32-132><a class=lnlinks href=#hl-32-132>132</a>
</span><span class=lnt id=hl-32-133><a class=lnlinks href=#hl-32-133>133</a>
</span><span class=lnt id=hl-32-134><a class=lnlinks href=#hl-32-134>134</a>
</span><span class=lnt id=hl-32-135><a class=lnlinks href=#hl-32-135>135</a>
</span><span class=lnt id=hl-32-136><a class=lnlinks href=#hl-32-136>136</a>
</span><span class=lnt id=hl-32-137><a class=lnlinks href=#hl-32-137>137</a>
</span><span class=lnt id=hl-32-138><a class=lnlinks href=#hl-32-138>138</a>
</span><span class=lnt id=hl-32-139><a class=lnlinks href=#hl-32-139>139</a>
</span><span class=lnt id=hl-32-140><a class=lnlinks href=#hl-32-140>140</a>
</span><span class=lnt id=hl-32-141><a class=lnlinks href=#hl-32-141>141</a>
</span><span class=lnt id=hl-32-142><a class=lnlinks href=#hl-32-142>142</a>
</span><span class=lnt id=hl-32-143><a class=lnlinks href=#hl-32-143>143</a>
</span><span class=lnt id=hl-32-144><a class=lnlinks href=#hl-32-144>144</a>
</span><span class=lnt id=hl-32-145><a class=lnlinks href=#hl-32-145>145</a>
</span><span class=lnt id=hl-32-146><a class=lnlinks href=#hl-32-146>146</a>
</span><span class=lnt id=hl-32-147><a class=lnlinks href=#hl-32-147>147</a>
</span><span class=lnt id=hl-32-148><a class=lnlinks href=#hl-32-148>148</a>
</span><span class=lnt id=hl-32-149><a class=lnlinks href=#hl-32-149>149</a>
</span><span class=lnt id=hl-32-150><a class=lnlinks href=#hl-32-150>150</a>
</span><span class=lnt id=hl-32-151><a class=lnlinks href=#hl-32-151>151</a>
</span><span class=lnt id=hl-32-152><a class=lnlinks href=#hl-32-152>152</a>
</span><span class=lnt id=hl-32-153><a class=lnlinks href=#hl-32-153>153</a>
</span><span class=lnt id=hl-32-154><a class=lnlinks href=#hl-32-154>154</a>
</span><span class=lnt id=hl-32-155><a class=lnlinks href=#hl-32-155>155</a>
</span><span class=lnt id=hl-32-156><a class=lnlinks href=#hl-32-156>156</a>
</span><span class=lnt id=hl-32-157><a class=lnlinks href=#hl-32-157>157</a>
</span><span class=lnt id=hl-32-158><a class=lnlinks href=#hl-32-158>158</a>
</span><span class=lnt id=hl-32-159><a class=lnlinks href=#hl-32-159>159</a>
</span><span class=lnt id=hl-32-160><a class=lnlinks href=#hl-32-160>160</a>
</span><span class=lnt id=hl-32-161><a class=lnlinks href=#hl-32-161>161</a>
</span><span class=lnt id=hl-32-162><a class=lnlinks href=#hl-32-162>162</a>
</span><span class=lnt id=hl-32-163><a class=lnlinks href=#hl-32-163>163</a>
</span><span class=lnt id=hl-32-164><a class=lnlinks href=#hl-32-164>164</a>
</span><span class=lnt id=hl-32-165><a class=lnlinks href=#hl-32-165>165</a>
</span><span class=lnt id=hl-32-166><a class=lnlinks href=#hl-32-166>166</a>
</span><span class=lnt id=hl-32-167><a class=lnlinks href=#hl-32-167>167</a>
</span><span class=lnt id=hl-32-168><a class=lnlinks href=#hl-32-168>168</a>
</span><span class=lnt id=hl-32-169><a class=lnlinks href=#hl-32-169>169</a>
</span><span class=lnt id=hl-32-170><a class=lnlinks href=#hl-32-170>170</a>
</span><span class=lnt id=hl-32-171><a class=lnlinks href=#hl-32-171>171</a>
</span><span class=lnt id=hl-32-172><a class=lnlinks href=#hl-32-172>172</a>
</span><span class=lnt id=hl-32-173><a class=lnlinks href=#hl-32-173>173</a>
</span><span class=lnt id=hl-32-174><a class=lnlinks href=#hl-32-174>174</a>
</span><span class=lnt id=hl-32-175><a class=lnlinks href=#hl-32-175>175</a>
</span><span class=lnt id=hl-32-176><a class=lnlinks href=#hl-32-176>176</a>
</span><span class=lnt id=hl-32-177><a class=lnlinks href=#hl-32-177>177</a>
</span><span class=lnt id=hl-32-178><a class=lnlinks href=#hl-32-178>178</a>
</span><span class=lnt id=hl-32-179><a class=lnlinks href=#hl-32-179>179</a>
</span><span class=lnt id=hl-32-180><a class=lnlinks href=#hl-32-180>180</a>
</span><span class=lnt id=hl-32-181><a class=lnlinks href=#hl-32-181>181</a>
</span><span class=lnt id=hl-32-182><a class=lnlinks href=#hl-32-182>182</a>
</span><span class=lnt id=hl-32-183><a class=lnlinks href=#hl-32-183>183</a>
</span><span class=lnt id=hl-32-184><a class=lnlinks href=#hl-32-184>184</a>
</span><span class=lnt id=hl-32-185><a class=lnlinks href=#hl-32-185>185</a>
</span><span class=lnt id=hl-32-186><a class=lnlinks href=#hl-32-186>186</a>
</span><span class=lnt id=hl-32-187><a class=lnlinks href=#hl-32-187>187</a>
</span><span class=lnt id=hl-32-188><a class=lnlinks href=#hl-32-188>188</a>
</span><span class=lnt id=hl-32-189><a class=lnlinks href=#hl-32-189>189</a>
</span><span class=lnt id=hl-32-190><a class=lnlinks href=#hl-32-190>190</a>
</span><span class=lnt id=hl-32-191><a class=lnlinks href=#hl-32-191>191</a>
</span><span class=lnt id=hl-32-192><a class=lnlinks href=#hl-32-192>192</a>
</span><span class=lnt id=hl-32-193><a class=lnlinks href=#hl-32-193>193</a>
</span><span class=lnt id=hl-32-194><a class=lnlinks href=#hl-32-194>194</a>
</span><span class=lnt id=hl-32-195><a class=lnlinks href=#hl-32-195>195</a>
</span><span class=lnt id=hl-32-196><a class=lnlinks href=#hl-32-196>196</a>
</span><span class=lnt id=hl-32-197><a class=lnlinks href=#hl-32-197>197</a>
</span><span class=lnt id=hl-32-198><a class=lnlinks href=#hl-32-198>198</a>
</span><span class=lnt id=hl-32-199><a class=lnlinks href=#hl-32-199>199</a>
</span><span class=lnt id=hl-32-200><a class=lnlinks href=#hl-32-200>200</a>
</span><span class=lnt id=hl-32-201><a class=lnlinks href=#hl-32-201>201</a>
</span><span class=lnt id=hl-32-202><a class=lnlinks href=#hl-32-202>202</a>
</span><span class=lnt id=hl-32-203><a class=lnlinks href=#hl-32-203>203</a>
</span><span class=lnt id=hl-32-204><a class=lnlinks href=#hl-32-204>204</a>
</span><span class=lnt id=hl-32-205><a class=lnlinks href=#hl-32-205>205</a>
</span><span class=lnt id=hl-32-206><a class=lnlinks href=#hl-32-206>206</a>
</span><span class=lnt id=hl-32-207><a class=lnlinks href=#hl-32-207>207</a>
</span><span class=lnt id=hl-32-208><a class=lnlinks href=#hl-32-208>208</a>
</span><span class=lnt id=hl-32-209><a class=lnlinks href=#hl-32-209>209</a>
</span><span class=lnt id=hl-32-210><a class=lnlinks href=#hl-32-210>210</a>
</span><span class=lnt id=hl-32-211><a class=lnlinks href=#hl-32-211>211</a>
</span><span class=lnt id=hl-32-212><a class=lnlinks href=#hl-32-212>212</a>
</span><span class=lnt id=hl-32-213><a class=lnlinks href=#hl-32-213>213</a>
</span><span class=lnt id=hl-32-214><a class=lnlinks href=#hl-32-214>214</a>
</span><span class=lnt id=hl-32-215><a class=lnlinks href=#hl-32-215>215</a>
</span><span class=lnt id=hl-32-216><a class=lnlinks href=#hl-32-216>216</a>
</span><span class=lnt id=hl-32-217><a class=lnlinks href=#hl-32-217>217</a>
</span><span class=lnt id=hl-32-218><a class=lnlinks href=#hl-32-218>218</a>
</span><span class=lnt id=hl-32-219><a class=lnlinks href=#hl-32-219>219</a>
</span><span class=lnt id=hl-32-220><a class=lnlinks href=#hl-32-220>220</a>
</span><span class=lnt id=hl-32-221><a class=lnlinks href=#hl-32-221>221</a>
</span><span class=lnt id=hl-32-222><a class=lnlinks href=#hl-32-222>222</a>
</span><span class=lnt id=hl-32-223><a class=lnlinks href=#hl-32-223>223</a>
</span><span class=lnt id=hl-32-224><a class=lnlinks href=#hl-32-224>224</a>
</span><span class=lnt id=hl-32-225><a class=lnlinks href=#hl-32-225>225</a>
</span><span class=lnt id=hl-32-226><a class=lnlinks href=#hl-32-226>226</a>
</span><span class=lnt id=hl-32-227><a class=lnlinks href=#hl-32-227>227</a>
</span><span class=lnt id=hl-32-228><a class=lnlinks href=#hl-32-228>228</a>
</span><span class=lnt id=hl-32-229><a class=lnlinks href=#hl-32-229>229</a>
</span><span class=lnt id=hl-32-230><a class=lnlinks href=#hl-32-230>230</a>
</span><span class=lnt id=hl-32-231><a class=lnlinks href=#hl-32-231>231</a>
</span><span class=lnt id=hl-32-232><a class=lnlinks href=#hl-32-232>232</a>
</span><span class=lnt id=hl-32-233><a class=lnlinks href=#hl-32-233>233</a>
</span><span class=lnt id=hl-32-234><a class=lnlinks href=#hl-32-234>234</a>
</span><span class=lnt id=hl-32-235><a class=lnlinks href=#hl-32-235>235</a>
</span><span class=lnt id=hl-32-236><a class=lnlinks href=#hl-32-236>236</a>
</span><span class=lnt id=hl-32-237><a class=lnlinks href=#hl-32-237>237</a>
</span><span class=lnt id=hl-32-238><a class=lnlinks href=#hl-32-238>238</a>
</span><span class=lnt id=hl-32-239><a class=lnlinks href=#hl-32-239>239</a>
</span><span class=lnt id=hl-32-240><a class=lnlinks href=#hl-32-240>240</a>
</span><span class=lnt id=hl-32-241><a class=lnlinks href=#hl-32-241>241</a>
</span><span class=lnt id=hl-32-242><a class=lnlinks href=#hl-32-242>242</a>
</span><span class=lnt id=hl-32-243><a class=lnlinks href=#hl-32-243>243</a>
</span><span class=lnt id=hl-32-244><a class=lnlinks href=#hl-32-244>244</a>
</span><span class=lnt id=hl-32-245><a class=lnlinks href=#hl-32-245>245</a>
</span><span class=lnt id=hl-32-246><a class=lnlinks href=#hl-32-246>246</a>
</span><span class=lnt id=hl-32-247><a class=lnlinks href=#hl-32-247>247</a>
</span><span class=lnt id=hl-32-248><a class=lnlinks href=#hl-32-248>248</a>
</span><span class=lnt id=hl-32-249><a class=lnlinks href=#hl-32-249>249</a>
</span><span class=lnt id=hl-32-250><a class=lnlinks href=#hl-32-250>250</a>
</span><span class=lnt id=hl-32-251><a class=lnlinks href=#hl-32-251>251</a>
</span><span class=lnt id=hl-32-252><a class=lnlinks href=#hl-32-252>252</a>
</span><span class=lnt id=hl-32-253><a class=lnlinks href=#hl-32-253>253</a>
</span><span class=lnt id=hl-32-254><a class=lnlinks href=#hl-32-254>254</a>
</span><span class=lnt id=hl-32-255><a class=lnlinks href=#hl-32-255>255</a>
</span><span class=lnt id=hl-32-256><a class=lnlinks href=#hl-32-256>256</a>
</span><span class=lnt id=hl-32-257><a class=lnlinks href=#hl-32-257>257</a>
</span><span class=lnt id=hl-32-258><a class=lnlinks href=#hl-32-258>258</a>
</span><span class=lnt id=hl-32-259><a class=lnlinks href=#hl-32-259>259</a>
</span><span class=lnt id=hl-32-260><a class=lnlinks href=#hl-32-260>260</a>
</span><span class=lnt id=hl-32-261><a class=lnlinks href=#hl-32-261>261</a>
</span><span class=lnt id=hl-32-262><a class=lnlinks href=#hl-32-262>262</a>
</span><span class=lnt id=hl-32-263><a class=lnlinks href=#hl-32-263>263</a>
</span><span class=lnt id=hl-32-264><a class=lnlinks href=#hl-32-264>264</a>
</span><span class=lnt id=hl-32-265><a class=lnlinks href=#hl-32-265>265</a>
</span><span class=lnt id=hl-32-266><a class=lnlinks href=#hl-32-266>266</a>
</span><span class=lnt id=hl-32-267><a class=lnlinks href=#hl-32-267>267</a>
</span><span class=lnt id=hl-32-268><a class=lnlinks href=#hl-32-268>268</a>
</span><span class=lnt id=hl-32-269><a class=lnlinks href=#hl-32-269>269</a>
</span><span class=lnt id=hl-32-270><a class=lnlinks href=#hl-32-270>270</a>
</span><span class=lnt id=hl-32-271><a class=lnlinks href=#hl-32-271>271</a>
</span><span class=lnt id=hl-32-272><a class=lnlinks href=#hl-32-272>272</a>
</span><span class=lnt id=hl-32-273><a class=lnlinks href=#hl-32-273>273</a>
</span><span class=lnt id=hl-32-274><a class=lnlinks href=#hl-32-274>274</a>
</span><span class=lnt id=hl-32-275><a class=lnlinks href=#hl-32-275>275</a>
</span><span class=lnt id=hl-32-276><a class=lnlinks href=#hl-32-276>276</a>
</span><span class=lnt id=hl-32-277><a class=lnlinks href=#hl-32-277>277</a>
</span><span class=lnt id=hl-32-278><a class=lnlinks href=#hl-32-278>278</a>
</span><span class=lnt id=hl-32-279><a class=lnlinks href=#hl-32-279>279</a>
</span><span class=lnt id=hl-32-280><a class=lnlinks href=#hl-32-280>280</a>
</span><span class=lnt id=hl-32-281><a class=lnlinks href=#hl-32-281>281</a>
</span><span class=lnt id=hl-32-282><a class=lnlinks href=#hl-32-282>282</a>
</span><span class=lnt id=hl-32-283><a class=lnlinks href=#hl-32-283>283</a>
</span><span class=lnt id=hl-32-284><a class=lnlinks href=#hl-32-284>284</a>
</span><span class=lnt id=hl-32-285><a class=lnlinks href=#hl-32-285>285</a>
</span><span class=lnt id=hl-32-286><a class=lnlinks href=#hl-32-286>286</a>
</span><span class=lnt id=hl-32-287><a class=lnlinks href=#hl-32-287>287</a>
</span><span class=lnt id=hl-32-288><a class=lnlinks href=#hl-32-288>288</a>
</span><span class=lnt id=hl-32-289><a class=lnlinks href=#hl-32-289>289</a>
</span><span class=lnt id=hl-32-290><a class=lnlinks href=#hl-32-290>290</a>
</span><span class=lnt id=hl-32-291><a class=lnlinks href=#hl-32-291>291</a>
</span><span class=lnt id=hl-32-292><a class=lnlinks href=#hl-32-292>292</a>
</span><span class=lnt id=hl-32-293><a class=lnlinks href=#hl-32-293>293</a>
</span><span class=lnt id=hl-32-294><a class=lnlinks href=#hl-32-294>294</a>
</span><span class=lnt id=hl-32-295><a class=lnlinks href=#hl-32-295>295</a>
</span><span class=lnt id=hl-32-296><a class=lnlinks href=#hl-32-296>296</a>
</span><span class=lnt id=hl-32-297><a class=lnlinks href=#hl-32-297>297</a>
</span><span class=lnt id=hl-32-298><a class=lnlinks href=#hl-32-298>298</a>
</span><span class=lnt id=hl-32-299><a class=lnlinks href=#hl-32-299>299</a>
</span><span class=lnt id=hl-32-300><a class=lnlinks href=#hl-32-300>300</a>
</span><span class=lnt id=hl-32-301><a class=lnlinks href=#hl-32-301>301</a>
</span><span class=lnt id=hl-32-302><a class=lnlinks href=#hl-32-302>302</a>
</span><span class=lnt id=hl-32-303><a class=lnlinks href=#hl-32-303>303</a>
</span><span class=lnt id=hl-32-304><a class=lnlinks href=#hl-32-304>304</a>
</span><span class=lnt id=hl-32-305><a class=lnlinks href=#hl-32-305>305</a>
</span><span class=lnt id=hl-32-306><a class=lnlinks href=#hl-32-306>306</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>공정성(FIFO) + 알림(웨이크업) + 임대(lease) TTL 을 갖춘 분산 세마포어
</span></span></span><span class=line><span class=cl><span class=s2>====================================================================
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>키 설계(sem:</span><span class=si>{name}</span><span class=s2> 해시태그로 Redis Cluster 슬롯 고정):
</span></span></span><span class=line><span class=cl><span class=s2>- sem:</span><span class=si>{name}</span><span class=s2>:holders  : ZSET, member=token, score=expiry_epoch_ms (현재 보유자들)
</span></span></span><span class=line><span class=cl><span class=s2>- sem:</span><span class=si>{name}</span><span class=s2>:queue    : LIST,  대기자 토큰 FIFO
</span></span></span><span class=line><span class=cl><span class=s2>- sem:</span><span class=si>{name}</span><span class=s2>:waiters  : SET,   큐 중복 등록 방지(멱등 등록)
</span></span></span><span class=line><span class=cl><span class=s2>- sem:</span><span class=si>{name}</span><span class=s2>:mb:&lt;tok&gt; : LIST,  토큰별 웨이크업 메일박스(알림 신호 저장; BLPOP으로 안전 수신)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>불변식:
</span></span></span><span class=line><span class=cl><span class=s2>- holders 의 크기(ZCARD) &lt;= limit
</span></span></span><span class=line><span class=cl><span class=s2>- 만료된 holders 는 어떤 획득/해제 경로에서도 먼저 청소됨(ZREMRANGEBYSCORE)
</span></span></span><span class=line><span class=cl><span class=s2>- 공정성: 용량이 있을 때는 항상 큐의 맨 앞(head)에게만 부여
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>안전성 포인트:
</span></span></span><span class=line><span class=cl><span class=s2>- acquire 는 “등록(enqueue)”와 “즉시 부여(grant if head &amp; capacity)”를 **한 스크립트**로 수행 → 레이스 제거
</span></span></span><span class=line><span class=cl><span class=s2>- release 는 “해제 후 가능한 만큼 head 들에게 부여 + 각자 메일박스에 신호”를 **한 스크립트**로 수행
</span></span></span><span class=line><span class=cl><span class=s2>- 알림은 LIST 기반(내구성 있음) → Pub/Sub 의 미스드 신호 문제 회피
</span></span></span><span class=line><span class=cl><span class=s2>- 토큰(소유권) 기반 → 제3자가 마음대로 release 불가, 중복 release 는 무해(idempotent)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>주의:
</span></span></span><span class=line><span class=cl><span class=s2>- 진입/탈퇴 신호가 많은 워크로드에서는 메일박스 키에 짧은 EXPIRE를 걸어 리소스 릭 방지
</span></span></span><span class=line><span class=cl><span class=s2>- 강한 합의가 필요하면 ZooKeeper/etcd 고려(세션/워처/lease 내장). Redis는 고성능·고가용성이나 합의 시스템은 아님.
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span><span class=o>,</span> <span class=nn>uuid</span><span class=o>,</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Redis 클라이언트 (문자열 디코드 편의)</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># Lua 스크립트 정의 (원자성 보장)</span>
</span></span><span class=line><span class=cl><span class=c1># --------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ACQUIRE_FAIR</span>
</span></span><span class=line><span class=cl><span class=c1># - 만료 청소</span>
</span></span><span class=line><span class=cl><span class=c1># - (아직 대기자가 아니면) SET(waiters) + RPUSH(queue) 로 등록</span>
</span></span><span class=line><span class=cl><span class=c1># - capacity &gt; 0 이고 queue head == token 이면:</span>
</span></span><span class=line><span class=cl><span class=c1>#     * LPOP(head 제거), SREM(waiters), ZADD(holders) → 즉시 부여</span>
</span></span><span class=line><span class=cl><span class=c1># - 부여되면 1, 아니면 0 반환</span>
</span></span><span class=line><span class=cl><span class=n>ACQUIRE_FAIR</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>register_script</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>-- KEYS[1]=holders, KEYS[2]=queue, KEYS[3]=waiters
</span></span></span><span class=line><span class=cl><span class=s2>-- ARGV[1]=now_ms, ARGV[2]=limit, ARGV[3]=ttl_ms, ARGV[4]=token
</span></span></span><span class=line><span class=cl><span class=s2>local holders = KEYS[1]
</span></span></span><span class=line><span class=cl><span class=s2>local queue   = KEYS[2]
</span></span></span><span class=line><span class=cl><span class=s2>local waiters = KEYS[3]
</span></span></span><span class=line><span class=cl><span class=s2>local now_ms  = tonumber(ARGV[1])
</span></span></span><span class=line><span class=cl><span class=s2>local limit   = tonumber(ARGV[2])
</span></span></span><span class=line><span class=cl><span class=s2>local ttl_ms  = tonumber(ARGV[3])
</span></span></span><span class=line><span class=cl><span class=s2>local token   = ARGV[4]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>-- 만료된 보유자 정리
</span></span></span><span class=line><span class=cl><span class=s2>redis.call(&#39;ZREMRANGEBYSCORE&#39;, holders, &#39;-inf&#39;, now_ms)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>-- 대기자 중복 등록 방지(Set 이용)
</span></span></span><span class=line><span class=cl><span class=s2>if redis.call(&#39;SISMEMBER&#39;, waiters, token) == 0 then
</span></span></span><span class=line><span class=cl><span class=s2>  redis.call(&#39;SADD&#39;, waiters, token)
</span></span></span><span class=line><span class=cl><span class=s2>  redis.call(&#39;RPUSH&#39;, queue, token)
</span></span></span><span class=line><span class=cl><span class=s2>end
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>-- 현재 용량 확인
</span></span></span><span class=line><span class=cl><span class=s2>local cnt = redis.call(&#39;ZCARD&#39;, holders)
</span></span></span><span class=line><span class=cl><span class=s2>if cnt &lt; limit then
</span></span></span><span class=line><span class=cl><span class=s2>  local head = redis.call(&#39;LINDEX&#39;, queue, 0)
</span></span></span><span class=line><span class=cl><span class=s2>  if head == token then
</span></span></span><span class=line><span class=cl><span class=s2>    -- FIFO 부여: head에게만 부여
</span></span></span><span class=line><span class=cl><span class=s2>    redis.call(&#39;LPOP&#39;, queue)
</span></span></span><span class=line><span class=cl><span class=s2>    redis.call(&#39;SREM&#39;, waiters, token)
</span></span></span><span class=line><span class=cl><span class=s2>    local expiry = now_ms + ttl_ms
</span></span></span><span class=line><span class=cl><span class=s2>    redis.call(&#39;ZADD&#39;, holders, expiry, token)
</span></span></span><span class=line><span class=cl><span class=s2>    return 1  -- granted
</span></span></span><span class=line><span class=cl><span class=s2>  end
</span></span></span><span class=line><span class=cl><span class=s2>end
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>return 0  -- waiting
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RELEASE_FAIR</span>
</span></span><span class=line><span class=cl><span class=c1># - 보유자(token) 제거 (idempotent)</span>
</span></span><span class=line><span class=cl><span class=c1># - 만료 청소</span>
</span></span><span class=line><span class=cl><span class=c1># - 남은 capacity 만큼 queue head 들에게 차례로 부여</span>
</span></span><span class=line><span class=cl><span class=c1># - 각 새 보유자에게 메일박스 알림 LPUSH + EXPIRE</span>
</span></span><span class=line><span class=cl><span class=c1># - 부여된 수를 반환</span>
</span></span><span class=line><span class=cl><span class=n>RELEASE_FAIR</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>register_script</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>-- KEYS[1]=holders, KEYS[2]=queue, KEYS[3]=waiters
</span></span></span><span class=line><span class=cl><span class=s2>-- ARGV[1]=now_ms, ARGV[2]=limit, ARGV[3]=ttl_ms, ARGV[4]=token, ARGV[5]=mb_prefix, ARGV[6]=mb_ttl_sec
</span></span></span><span class=line><span class=cl><span class=s2>local holders  = KEYS[1]
</span></span></span><span class=line><span class=cl><span class=s2>local queue    = KEYS[2]
</span></span></span><span class=line><span class=cl><span class=s2>local waiters  = KEYS[3]
</span></span></span><span class=line><span class=cl><span class=s2>local now_ms   = tonumber(ARGV[1])
</span></span></span><span class=line><span class=cl><span class=s2>local limit    = tonumber(ARGV[2])
</span></span></span><span class=line><span class=cl><span class=s2>local ttl_ms   = tonumber(ARGV[3])
</span></span></span><span class=line><span class=cl><span class=s2>local token    = ARGV[4]
</span></span></span><span class=line><span class=cl><span class=s2>local mb_prefix= ARGV[5]
</span></span></span><span class=line><span class=cl><span class=s2>local mb_ttl   = tonumber(ARGV[6])
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>-- 보유자 제거 (idempotent)
</span></span></span><span class=line><span class=cl><span class=s2>redis.call(&#39;ZREM&#39;, holders, token)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>-- 만료 청소
</span></span></span><span class=line><span class=cl><span class=s2>redis.call(&#39;ZREMRANGEBYSCORE&#39;, holders, &#39;-inf&#39;, now_ms)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>-- 현재 용량 기반으로 head 들에게 부여
</span></span></span><span class=line><span class=cl><span class=s2>local granted = 0
</span></span></span><span class=line><span class=cl><span class=s2>while (redis.call(&#39;ZCARD&#39;, holders) &lt; limit) do
</span></span></span><span class=line><span class=cl><span class=s2>  local head = redis.call(&#39;LINDEX&#39;, queue, 0)
</span></span></span><span class=line><span class=cl><span class=s2>  if not head then break end
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  -- head 제거 &amp; waiters 집합에서 제거
</span></span></span><span class=line><span class=cl><span class=s2>  redis.call(&#39;LPOP&#39;, queue)
</span></span></span><span class=line><span class=cl><span class=s2>  redis.call(&#39;SREM&#39;, waiters, head)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  -- 부여 및 알림
</span></span></span><span class=line><span class=cl><span class=s2>  local expiry = now_ms + ttl_ms
</span></span></span><span class=line><span class=cl><span class=s2>  redis.call(&#39;ZADD&#39;, holders, expiry, head)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  -- 메일박스 알림(내구성 있는 신호). BLPOP 대기자가 수신.
</span></span></span><span class=line><span class=cl><span class=s2>  local mb_key = mb_prefix .. head
</span></span></span><span class=line><span class=cl><span class=s2>  redis.call(&#39;LPUSH&#39;, mb_key, &#39;granted&#39;)
</span></span></span><span class=line><span class=cl><span class=s2>  redis.call(&#39;EXPIRE&#39;, mb_key, mb_ttl)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  granted = granted + 1
</span></span></span><span class=line><span class=cl><span class=s2>end
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>return granted
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DistSemaphoreFair</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    사용법 개요
</span></span></span><span class=line><span class=cl><span class=s2>    ----------
</span></span></span><span class=line><span class=cl><span class=s2>    sem = DistSemaphoreFair(&#34;api&#34;, limit=3, ttl_ms=5000)
</span></span></span><span class=line><span class=cl><span class=s2>    ok = sem.acquire(timeout_ms=3000)
</span></span></span><span class=line><span class=cl><span class=s2>    try:
</span></span></span><span class=line><span class=cl><span class=s2>        if ok:
</span></span></span><span class=line><span class=cl><span class=s2>            … 임계 구역 …
</span></span></span><span class=line><span class=cl><span class=s2>    finally:
</span></span></span><span class=line><span class=cl><span class=s2>        sem.release()
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    특징
</span></span></span><span class=line><span class=cl><span class=s2>    ----
</span></span></span><span class=line><span class=cl><span class=s2>    - FIFO 공정성: queue head에게만 부여
</span></span></span><span class=line><span class=cl><span class=s2>    - 임대 TTL: 크래시/장애 시 자동 회수
</span></span></span><span class=line><span class=cl><span class=s2>    - 알림: 메일박스 LIST + BLPOP, 미스드 신호 방지
</span></span></span><span class=line><span class=cl><span class=s2>    - 타임아웃 + 백오프: 무한 대기 방지/쟁탈 완화
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>ttl_ms</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=n>mailbox_ttl_sec</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>limit</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ttl_ms</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>ttl_ms</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mailbox_ttl_sec</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>mailbox_ttl_sec</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Cluster 슬롯 고정용 해시태그 {name}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>holders_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;sem:</span><span class=se>{{</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=se>}}</span><span class=s2>:holders&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queue_key</span>   <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;sem:</span><span class=se>{{</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=se>}}</span><span class=s2>:queue&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>waiters_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;sem:</span><span class=se>{{</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=se>}}</span><span class=s2>:waiters&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mb_prefix</span>   <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;sem:</span><span class=se>{{</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=se>}}</span><span class=s2>:mb:&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 소유 토큰 (인스턴스 단위로 1개; 필요 시 스레드별로 별도 인스턴스 사용)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>token</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@property</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mailbox_key</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>mb_prefix</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_now_ms</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_new_token</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>try_acquire_once</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        단일 시도:
</span></span></span><span class=line><span class=cl><span class=s2>        - 큐에 자신을 등록(중복 방지)하고,
</span></span></span><span class=line><span class=cl><span class=s2>        - 자신이 head이고, capacity 가 남아 있으면 즉시 부여
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>token</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_new_token</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>=</span> <span class=n>ACQUIRE_FAIR</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>keys</span><span class=o>=</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>holders_key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>queue_key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>waiters_key</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>args</span><span class=o>=</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>_now_ms</span><span class=p>(),</span> <span class=bp>self</span><span class=o>.</span><span class=n>limit</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>ttl_ms</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>res</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>timeout_ms</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5000</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        공정 획득:
</span></span></span><span class=line><span class=cl><span class=s2>        1) 즉시 시도(원자 스크립트). 성공 시 반환.
</span></span></span><span class=line><span class=cl><span class=s2>        2) 실패 시 자신의 메일박스로 BLPOP 대기(알림 기반).
</span></span></span><span class=line><span class=cl><span class=s2>           - 레이스 방지: 대기 전/후에 재확인 루프 수행.
</span></span></span><span class=line><span class=cl><span class=s2>        3) 타임아웃 내 반복(지수 백오프+지터)으로 부하 완화.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>deadline</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>+</span> <span class=n>timeout_ms</span> <span class=o>/</span> <span class=mf>1000.0</span>
</span></span><span class=line><span class=cl>        <span class=n>base</span> <span class=o>=</span> <span class=mf>0.01</span>  <span class=c1># 10ms 시작</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 빠른 경로</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>try_acquire_once</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 알림 기반 대기 루프</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>deadline</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 알림을 받기 전에 혹시 이미 부여되었는지 재확인(드문 레이스)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_already_granted</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 메일박스에서 신호 대기(최대 남은 시간 혹은 짧은 윈도우)</span>
</span></span><span class=line><span class=cl>            <span class=n>wait_secs</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mf>0.05</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>deadline</span> <span class=o>-</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>            <span class=c1># BLPOP은 타임아웃 내 단 1개 메시지 수신; 이후 재검사</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=o>.</span><span class=n>blpop</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>mailbox_key</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=n>wait_secs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 신호 수신 또는 타임아웃 후 재확인</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_already_granted</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 혼잡 완화: 지수 백오프 + 지터</span>
</span></span><span class=line><span class=cl>            <span class=n>base</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>base</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>base</span> <span class=o>*</span> <span class=p>(</span><span class=mf>0.5</span> <span class=o>+</span> <span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 최종 타임아웃</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cancel_waiting</span><span class=p>()</span>  <span class=c1># 큐 정리(옵션)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_already_granted</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        자신이 holders 에 올라갔는지를 확인.
</span></span></span><span class=line><span class=cl><span class=s2>        - 엄밀히는 스크립트 결과로 알 수 있지만, 알림-수신 이후 재확인용으로 가볍게 조회.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=c1># token 의 expiry 존재 여부 확인(ZSCORE)</span>
</span></span><span class=line><span class=cl>        <span class=n>score</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>zscore</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>holders_key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>score</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>renew</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        임대 갱신(옵션): TTL 연장을 원할 때 사용.
</span></span></span><span class=line><span class=cl><span class=s2>        - 설계 단순화를 위해 &#39;다시 acquire&#39;를 시도 → head 가 아니면 대기하지 않고 False.
</span></span></span><span class=line><span class=cl><span class=s2>        - 실무에선 별도의 RENEW 스크립트로 ZADD score 만 갱신하는 방식을 권장.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=c1># 간단 갱신: holders 에 이미 있으면 score 갱신</span>
</span></span><span class=line><span class=cl>        <span class=n>now</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_now_ms</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>expiry</span> <span class=o>=</span> <span class=n>now</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>ttl_ms</span>
</span></span><span class=line><span class=cl>        <span class=n>updated</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>zadd</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>holders_key</span><span class=p>,</span> <span class=p>{</span><span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>:</span> <span class=n>expiry</span><span class=p>},</span> <span class=n>xx</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span><span class=n>updated</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>cancel_waiting</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        대기 취소(옵션): 아직 부여받지 않은 상태에서 대기열 제거.
</span></span></span><span class=line><span class=cl><span class=s2>        - acquire 타임아웃 시 호출 권장.
</span></span></span><span class=line><span class=cl><span class=s2>        - 원자성 완벽 보장은 아니지만 실무용 &#39;best effort&#39; 정리.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        <span class=n>pipe</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>pipeline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>pipe</span><span class=o>.</span><span class=n>srem</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>waiters_key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># LREM 으로 큐에서 자신 제거 (존재하면 1, 없으면 0)</span>
</span></span><span class=line><span class=cl>            <span class=n>pipe</span><span class=o>.</span><span class=n>lrem</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>queue_key</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>pipe</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>pipe</span><span class=o>.</span><span class=n>reset</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        해제:
</span></span></span><span class=line><span class=cl><span class=s2>        - holders 에서 자신의 token 제거(idempotent)
</span></span></span><span class=line><span class=cl><span class=s2>        - capacity 만큼 head 들에게 연쇄 부여(스크립트 내부 루프)
</span></span></span><span class=line><span class=cl><span class=s2>        - 각 부여 대상의 메일박스에 &#39;granted&#39; 알림 푸시 + EXPIRE
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>granted</span> <span class=o>=</span> <span class=n>RELEASE_FAIR</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>keys</span><span class=o>=</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>holders_key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>queue_key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>waiters_key</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>args</span><span class=o>=</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>_now_ms</span><span class=p>(),</span> <span class=bp>self</span><span class=o>.</span><span class=n>limit</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>ttl_ms</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=bp>self</span><span class=o>.</span><span class=n>mb_prefix</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>mailbox_ttl_sec</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 내 토큰은 더 이상 보유하지 않음</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>token</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=c1># --------------------------</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>sem</span> <span class=o>=</span> <span class=n>DistSemaphoreFair</span><span class=p>(</span><span class=s2>&#34;api_limit&#34;</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>ttl_ms</span><span class=o>=</span><span class=mi>5000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>sem</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout_ms</span><span class=o>=</span><span class=mi>3000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[granted] 임계 구역 진입&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>sem</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[release] 해제 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[timeout] 세마포어 획득 실패, 대기 취소&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>공정성 보장</strong>: &ldquo;capacity > 0 & queue head == token&rdquo; 에서만 부여 → 앞사람 새치기 불가</li><li><strong>미스드 신호 방지</strong>: Pub/Sub 대신 <strong>LIST 메일박스 + BLPOP</strong> 사용 (메시지 저장형)</li><li><strong>임대 만료 자동 회수</strong>: holders ZSET score(만료 시각) 관리로 크래시/네트워크 분단에도 누수 최소화</li><li><strong>원자성</strong>: 등록/부여/해제를 Lua 스크립트로 묶어 <strong>경쟁 조건 제거</strong></li><li><strong>운영성</strong>: Redis Cluster 고려한 <code>{name}</code> 해시태그, 타임아웃·백오프·취소 API 제공</li></ul><h5 id=실시간-시스템에서-세마포어-사용-전략>실시간 시스템에서 세마포어 사용 전략<a hidden class=anchor aria-hidden=true href=#실시간-시스템에서-세마포어-사용-전략>#</a></h5><p>실시간 시스템 (Real-Time System) 은 <strong>정확한 시간 내에 작업을 수행하는 것이 필수</strong>이며, 응답 지연이 곧 오류로 간주된다. 이 환경에서는 세마포어의 사용 방식이 일반 시스템과 다르다.</p><table><thead><tr><th>전략</th><th>설명</th><th>장점</th><th>단점</th><th>비고</th></tr></thead><tbody><tr><td><strong>우선순위 역전 방지</strong><br>(Priority Inheritance Protocol, PCP 등)</td><td>낮은 우선순위 태스크가 자원 점유로 높은 우선순위 태스크가 대기하는 문제를 해결. PIP 는 점유 태스크의 우선순위를 일시 승격, PCP 는 자원별 ceiling 기반 사전 예방.</td><td>- 우선순위 역전 최소화<br>- 예측 가능한 응답 시간 보장<br>- PCP 는 데드락 방지도 가능</td><td>- PIP 는 다중 자원 환경에서 상속 체인 복잡<br>- PCP 는 설계·유지보수 복잡<br>- 일부 RTOS/OS 에서 지원 제한</td><td>하드 RT 환경에서는 PCP 선호</td></tr><tr><td><strong>데드락·기아 방지</strong></td><td>자원 획득 순서 고정, 타임아웃 도입, aging 스케줄링으로 교착상태·기아 방지.</td><td>- 시스템 전체 안전성 확보<br>- 예측 가능한 태스크 완료율 보장</td><td>- 순서 고정이 유연성 저하 가능<br>- Aging 은 우선순위 정책과 충돌 위험</td><td>고정 순서 + 타임아웃 조합이 효과적</td></tr><tr><td><strong>타이밍 보장형 블로킹</strong></td><td><code>sem_timedwait()</code> 등으로 무한 대기 방지, 데드라인 내 응답 실패를 조기 감지.</td><td>- Bounded Blocking 보장<br>- Fail-Fast 설계 가능<br>- 디버깅·모니터링 용이</td><td>- 타임아웃 너무 짧으면 false timeout 발생<br>- 값 조정이 환경 의존적</td><td>하드 RT: 절대시간 기반 타임아웃 선호</td></tr><tr><td><strong>이벤트 동기화</strong><br>(ISR ↔ Task)</td><td>Binary/Event Semaphore 를 이용해 인터럽트 서비스 루틴에서 태스크로 신호 전달.</td><td>- ISR 과 Task 간 안전·빠른 통신<br>- 폴링 불필요로 CPU 효율↑</td><td>- 이벤트 유실 방지 설계 필요<br>- 신호 중복 처리 고려 필요</td><td>RTOS 에서 ISR-safe API 필수</td></tr><tr><td><strong>정적 자원 할당</strong></td><td>세마포어 permit 수를 고정, 동적 자원 요청 제거로 예측성 향상.</td><td>- 타이밍 예측성↑<br>- 힙/동적 메모리 의존성 제거</td><td>- 자원 낭비 가능성<br>- 런타임 스파이크 대응 어려움</td><td>하드 RT 에 특히 권장</td></tr></tbody></table><h2 id=최종-정리-및-학습-가이드>최종 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#최종-정리-및-학습-가이드>#</a></h2><h3 id=내용-정리>내용 정리<a hidden class=anchor aria-hidden=true href=#내용-정리>#</a></h3><p>세마포어 (Semaphore) 는 1962 년 다이크스트라가 고안한 <strong>카운터 기반 동기화 프리미티브</strong>로, 하나 이상의 프로세스/스레드가 <strong>동시에 접근 가능한 자원 수를 제한</strong>하여 동시성을 제어한다.</p><ul><li><strong>구성 요소</strong>: 정수형 카운터, P(wait) 연산, V(signal) 연산, 대기 큐.</li><li><strong>적용 환경</strong>:<ul><li><strong>로컬 환경</strong>: Java, Python,.NET, Go 등 언어 표준 라이브러리에서 제공.</li><li><strong>분산 환경</strong>: ZooKeeper, etcd, Redis 기반 분산 세마포어로 클러스터 전역 동시성 제어.</li></ul></li><li><strong>주요 장점</strong>: 단순성, 범용성, 확장성, 이식성.</li><li><strong>운영 위험</strong>: 교착 (Deadlock), 기아 (Starvation), 오버릴리스 (Over-release).</li><li><strong>모범 사례</strong>: FIFO 공정성 모드, 타임아웃 기반 Acquire, 관측성 표준화 (메트릭·로그·트레이싱).</li><li><strong>미래 전망</strong>: AI 기반 자원 스케줄링, 클라우드 네이티브 분산 환경에서의 세마포어 최적화, 에너지 효율성을 고려한 동기화 전략.</li></ul><p>세마포어는 단순한 카운터 구조로 동시성 제어를 가능하게 하며, 로컬과 분산 환경 모두에서 자원 관리에 활용된다. 운영에서는 교착·기아·오버릴리스 방지가 중요하며, 공정성·타임아웃·관측성을 갖춘 설계가 필수다. 향후 AI·클라우드 네이티브·Green IT 환경에서 더욱 지능적이고 효율적인 세마포어 활용이 기대된다.</p><h3 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h3><table><thead><tr><th>Phase</th><th>목표</th><th>학습·실습 항목</th><th>산출물 (체크포인트)</th><th>리스크/주의점</th></tr></thead><tbody><tr><td>1. 기초</td><td>동작 원리 확립</td><td>P/V, 이진/카운팅, 공정성·기아, 오버릴리스</td><td>PC 패턴 (세마포어 전용) 예제</td><td>잘못된 해제·이중 해제 방지 가드</td></tr><tr><td>2. 언어별 실습</td><td>다언어 숙련</td><td>Java/Python/.NET/Go 동일 과제 풀이, 타임아웃/취소</td><td>언어별 샘플·벤치 결과</td><td>공정성 옵션·취소语의 차이 이해</td></tr><tr><td>3. 운영/관측</td><td>운영 안전성</td><td>SLO 기반 타임아웃·Fail-Fast·Fallback, 메트릭/알람</td><td>대시보드·알람 규칙</td><td>과도한 대기→스레드 고갈</td></tr><tr><td>4. 분산 설계</td><td>확장/복원력</td><td>ZooKeeper/Curator, Redis 패턴, 세션·정리·아이디엠포턴시</td><td>장애 주입 시나리오·복구 설계서</td><td>네트워크 분할·클럭 드리프트 가정 명확화</td></tr><tr><td>5. 최적화/고급</td><td>성능·p99</td><td>Weighted, 샤딩, 비동기 획득, 백오프/버스팅</td><td>부하 테스트 리포트 (p50/p95/p99)</td><td>과도 최적화로 공정성 저하 주의</td></tr><tr><td>6. 품질보증/거버넌스</td><td>신뢰성</td><td>TSan/JFR/py-spy, 권한·감사·리밋 변경 절차</td><td>표준 템플릿/체크리스트</td><td>운영자 오남용·권한 일탈 방지</td></tr></tbody></table><ul><li><strong>원리→구현→운영→분산→최적화</strong>의 5 축으로 일관된 스파이럴 학습이 효율적이다.</li><li>같은 문제를 <strong>다언어</strong>로 반복 구현하면 개념이 흔들리지 않는다.</li><li><strong>SLO 기반 관측·알람</strong>과 <strong>장애 주입 테스트</strong>가 실전 체감도를 결정한다.</li><li>분산 세마포어는 <strong>장애 가정</strong>과 <strong>정리·복구 플로우</strong>가 반이다.</li><li>최적화는 <strong>p99 안정화</strong>를 목표로 하고, 공정성·안전성과의 균형을 유지하라.</li></ul><h3 id=학습-항목-매트릭스>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스>#</a></h3><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>설명</th></tr></thead><tbody><tr><td><strong>기초</strong></td><td>1</td><td>개념 정의·역사</td><td>필수</td><td>세마포어의 기원과 동기화 기본 개념</td></tr><tr><td></td><td>1</td><td>P/V 연산</td><td>필수</td><td>자원 점유·반환 원자적 연산</td></tr><tr><td></td><td>1</td><td>Binary vs Counting</td><td>필수</td><td>세마포어 유형과 차이</td></tr><tr><td><strong>이론</strong></td><td>2</td><td>wait/signal 메커니즘</td><td>필수</td><td>OS·언어 계층 동작 방식</td></tr><tr><td></td><td>2</td><td>원자성 보장·공정성·타임아웃·가중치</td><td>필수</td><td>설계 원칙과 성능 특성</td></tr><tr><td></td><td>2</td><td>Deadlock·Starvation</td><td>필수</td><td>발생 원인·예방·해결</td></tr><tr><td><strong>특성</strong></td><td>3</td><td>장·단점 및 트레이드오프</td><td>필수</td><td>성능·안정성·유지보수 측면 비교</td></tr><tr><td><strong>구현</strong></td><td>4,5</td><td>언어별 구현 차이</td><td>권장</td><td>C++·Python·Go·Java 비교</td></tr><tr><td></td><td>4,5</td><td>로컬 & 분산 환경 예시</td><td>필수</td><td>Python/JS/Redis 기반 예제</td></tr><tr><td></td><td>4,5</td><td>실무 패턴 적용</td><td>필수</td><td>커넥션 풀·레이트 리미팅 구현</td></tr><tr><td><strong>운영</strong></td><td>6</td><td>Deadlock 예방·Release 보장</td><td>필수</td><td>자원 순서·타임아웃·finally 블록</td></tr><tr><td></td><td>6</td><td>모니터링·보안</td><td>권장</td><td>Prometheus·우선순위 역전 방지</td></tr><tr><td><strong>고급</strong></td><td>7</td><td>분산·클라우드 적용</td><td>선택</td><td>ZooKeeper·Redis 기반 전역 동시성</td></tr><tr><td></td><td>7</td><td>AI 기반 스케줄링</td><td>선택</td><td>예측 기반 자원 관리</td></tr><tr><td><strong>심화 OS 개념</strong></td><td>7</td><td>메모리 모델·CAS·Memory Barrier</td><td>선택</td><td>하드웨어/컴파일러 수준 동기화 보장</td></tr><tr><td></td><td>7</td><td>Lamport Clock</td><td>선택</td><td>분산 환경 이벤트 순서 제어</td></tr></tbody></table><ul><li><strong>기초</strong>: 세마포어의 역사·P/V 연산·Binary vs Counting 차이를 명확히 이해해야 함</li><li><strong>이론</strong>: wait/signal 동작, 원자성, 공정성, 타임아웃, 가중치, Deadlock/Starvation 메커니즘 숙지</li><li><strong>특성</strong>: 장단점과 트레이드오프 분석으로 상황별 적합한 동기화 도구 선택 가능</li><li><strong>구현</strong>: 언어별 표준 API 와 패턴을 실습하며 로컬 및 분산 환경 코드 작성 능력 확보</li><li><strong>운영</strong>: Deadlock 방지, 릴리스 보장, 모니터링·보안 정책을 통해 안정적인 서비스 운영</li><li><strong>고급</strong>: 분산 세마포어, 클라우드 네이티브 환경, AI 기반 자원 스케줄링으로 확장</li><li><strong>심화 OS 개념</strong>: 하드웨어·메모리 모델 수준까지 이해하면 고성능·고신뢰 동기화 설계 가능</li></ul><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th></tr></thead><tbody><tr><td><strong>기본 개념</strong></td><td>세마포어 (Semaphore)</td><td>허가 수 기반으로 동시 접근을 제어하는 동기화 원시</td><td>Mutex, Lock, Barrier</td></tr><tr><td>기본 개념</td><td>원자적 연산 (Atomic Operation)</td><td>중단 없이 완전히 실행되는 연산</td><td>임계 구역</td></tr><tr><td>기본 개념</td><td>임계 구역 (Critical Section)</td><td>하나의 실행 흐름만 접근 가능한 코드 영역</td><td>Race Condition</td></tr><tr><td>기본 개념</td><td>경쟁 상태 (Race Condition)</td><td>동시 접근으로 예측 불가능한 결과 발생</td><td>동기화</td></tr><tr><td><strong>핵심 연산 및 유형</strong></td><td>P 연산 (Wait/Acquire)</td><td>세마포어 값 감소 후 자원 획득</td><td>Atomic 연산</td></tr><tr><td>핵심 연산 및 유형</td><td>V 연산 (Signal/Release)</td><td>세마포어 값 증가 후 대기 스레드 깨움</td><td>큐 관리</td></tr><tr><td>핵심 연산 및 유형</td><td>Binary Semaphore</td><td>값이 0/1 인 세마포어, 상호 배제 용도</td><td>Mutex</td></tr><tr><td>핵심 연산 및 유형</td><td>Counting Semaphore</td><td>N 개의 동시 접근 허용</td><td>Resource Pool</td></tr><tr><td>핵심 연산 및 유형</td><td>Weighted Semaphore</td><td>요청마다 여러 permit 할당</td><td>Rate Limiting</td></tr><tr><td>핵심 연산 및 유형</td><td>Bounded Semaphore</td><td>release 과다 호출 방지</td><td>데이터 무결성</td></tr><tr><td>핵심 연산 및 유형</td><td>Strong/Weak Semaphore</td><td>FIFO 보장 여부로 구분</td><td>Starvation</td></tr><tr><td><strong>구현·아키텍처</strong></td><td>Named Semaphore</td><td>OS 에서 이름으로 공유 가능</td><td>IPC</td></tr><tr><td>구현·아키텍처</td><td>Unnamed Semaphore</td><td>프로세스 내·스레드 간 사용</td><td>POSIX, pthread</td></tr><tr><td>구현·아키텍처</td><td>Distributed Semaphore</td><td>네트워크 전역 동시성 제어</td><td>ZooKeeper, Redis</td></tr><tr><td>구현·아키텍처</td><td>Spinlock 기반</td><td>busy-waiting 으로 동기화</td><td>Low-latency</td></tr><tr><td>구현·아키텍처</td><td>Sleep-based</td><td>context-switch 로 블로킹</td><td>Low CPU usage</td></tr><tr><td><strong>운영 문제</strong></td><td>Deadlock</td><td>순환 대기로 전체 정지</td><td>자원 할당 순서, Timeout</td></tr><tr><td>운영 문제</td><td>Starvation</td><td>특정 프로세스 무한 대기</td><td>Fairness</td></tr><tr><td>운영 문제</td><td>Priority Inversion</td><td>낮은 우선순위가 높은 우선순위를 블록</td><td>Real-time Systems</td></tr><tr><td>운영 문제</td><td>Over-release</td><td>permit 수 이상 release</td><td>Bounded Semaphore</td></tr><tr><td><strong>관련 동기화 기법</strong></td><td>Mutex</td><td>단일 자원 잠금</td><td>Binary Semaphore</td></tr><tr><td>관련 동기화 기법</td><td>Lock</td><td>임계 구역 접근 제어 장치</td><td>Monitor</td></tr><tr><td>관련 동기화 기법</td><td>Barrier</td><td>스레드 동기화 시점 지정</td><td>Parallel Processing</td></tr><tr><td>관련 동기화 기법</td><td>Producer-Consumer</td><td>동기화 대표 문제</td><td>Queue, Buffer</td></tr><tr><td><strong>최적화·성능</strong></td><td>Busy-waiting</td><td>연산 반복 대기 방식</td><td>Spinlock</td></tr><tr><td>최적화·성능</td><td>Lock-free</td><td>락 없이 원자 연산만으로 동기화</td><td>Wait-free</td></tr><tr><td>최적화·성능</td><td>Wait-free</td><td>모든 연산이 유한 시간 내 완료 보장</td><td>Lock-free</td></tr><tr><td>최적화·성능</td><td>False Sharing</td><td>캐시 라인 충돌로 인한 성능 저하</td><td>CPU Cache</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://en.wikipedia.org/wiki/Semaphore_%28programming%29>Semaphore (programming) - Wikipedia</a></li><li><a href=https://ko.wikipedia.org/wiki/%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4_%28%EC%BB%B4%ED%93%A8%ED%8C%85%29>Semaphore 위키백과 (한국어)</a></li><li><a href=https://www.geeksforgeeks.org/semaphores-in-process-synchronization/>Semaphores in Process Synchronization - GeeksforGeeks</a></li><li><a href=https://www.tutorialspoint.com/operating_system/semaphores_in_os.htm>Operating System - Semaphores (Tutorialspoint)</a></li><li><a href=https://man7.org/linux/man-pages/man7/sem_overview.7.html>POSIX semaphores 문서 (man7.org)</a></li><li><a href=https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/semaphore.h.html>POSIX Semaphore 표준 문서 (The Open Group)</a></li><li><a href=https://www.cs.utexas.edu/users/EWD/ewd01xx/EWD123.PDF>Dijkstra 원본 논문: Cooperating Sequential Processes</a></li><li><a href=https://elixir.bootlin.com/linux/latest/source/kernel/locking/semaphore.c>Linux Kernel Semaphore 구현</a></li><li><a href=https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Semaphore.html>Java <code>java.util.concurrent.Semaphore</code> 공식 문서</a></li><li><a href=https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/Semaphore.html>Java SE 17 <code>Semaphore</code> 문서</a></li><li><a href=https://docs.python.org/3/library/threading.html#semaphore-objects>Python <code>threading</code> — Semaphore 공식 문서</a></li><li><a href=https://docs.python.org/3/library/asyncio-sync.html>Python <code>asyncio</code> Synchronization Primitives 공식 문서</a></li><li><a href=https://pkg.go.dev/golang.org/x/sync/semaphore>Go <code>x/sync/semaphore</code> Weighted Semaphore 문서</a></li><li><a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.semaphoreslim?view=net-9.0">.NET <code>SemaphoreSlim</code> Class 문서</a></li><li><a href=https://learn.microsoft.com/en-us/dotnet/standard/threading/semaphore-and-semaphoreslim>.NET Semaphore & SemaphoreSlim 개요</a></li><li><a href=https://redis.io/docs/latest/develop/clients/patterns/distributed-locks/>Redis Distributed Locks 문서</a></li><li><a href=https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html>How to do Distributed Locking (Martin Kleppmann)</a></li><li><a href=https://zookeeper.apache.org/doc/r3.5.0-alpha/recipes.html>ZooKeeper Recipes & Solutions</a></li><li><a href=https://curator.apache.org/docs/recipes>Apache Curator Recipes</a></li><li><a href=https://blog.skby.net/%EA%B3%84%EC%88%98%ED%98%95-%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4-counting-semaphore/>Counting Semaphore 개념 - 도리의 디지털라이프</a></li><li><a href=https://goodbyeanma.tistory.com/212>세마포어 개념 및 활용 - 신승환의 기술 블로그</a></li><li><a href=https://always-be-wise.tistory.com/225>세마포어란? - Always Be Wise</a></li><li><a href=https://techbless.github.io/2024/12/02/blocking-w-semaphore/>세마포어를 이용한 블로킹 구현 예제 - TechBless</a></li><li><a href=https://velog.io/@hidaehyunlee/Philosophers-%EC%98%88%EC%8B%9C%EC%98%88%EC%A0%9C%EB%A1%9C-%EB%B3%B4%EB%8A%94-%EB%AE%A4%ED%85%8D%EC%8A%A4%EC%99%80-%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4%EC%9D%98-%EC%B0%A8%EC%9D%B4>Philosophers 예시로 보는 Mutex와 Semaphore 차이 - velog</a></li><li><a href=https://gofo-coding.tistory.com/entry/Synchronization-with-OS-Support-Semaphore>Synchronization with OS Support: Semaphore - 혼자하는 코딩</a></li><li><a href=https://www.geeksforgeeks.org/difference-between-mutex-and-semaphore/>Mutex vs Semaphore 차이 - GeeksforGeeks</a></li><li><a href=https://redis.io/docs/manual/patterns/distributed-locks/>Distributed Semaphore with Redis</a></li><li><a href=https://os-book.com/>Operating System Concepts (Silberschatz 외)</a></li><li><a href=https://en.cppreference.com/w/cpp/thread/counting_semaphore>C++ Reference - std::counting_semaphore</a></li><li><a href=https://medium.com/@anton.baksheiev/synchronization-primitives-in-net-c-80196d0485db>Medium - Synchronization Primitives in .NET/C#</a></li><li><a href=https://github.com/groue/Semaphore>AsyncSemaphore for Swift Concurrency (GitHub)</a></li><li><a href=https://www.cncf.io/blog/2024/11/19/emerging-trends-in-the-cloud-native-ecosystem/>CNCF - Emerging Trends in the Cloud Native Ecosystem</a></li><li><a href=https://www.mdpi.com/2079-9292/14/4/677>MDPI - State of the Art in Parallel and Distributed Systems</a></li><li><a href=https://nailyourinterview.org/interview-resources/operating-systems/mutex-vs-semaphore>Mutex vs Semaphore: Key Differences and Use Cases - Nailyourinterview.org</a></li><li><a href=https://techterms.com/definition/semaphore>Semaphore Definition - TechTerms</a></li><li><a href=https://systemdesignschool.io/blog/semaphore>Understanding the Concept of Semaphore in Programming - systemdesignschool.io</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>