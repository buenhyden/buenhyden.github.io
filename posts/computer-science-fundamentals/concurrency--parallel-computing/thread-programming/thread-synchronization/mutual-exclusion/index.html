<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Mutual Exclusion | hyunyoun's Blog</title><meta name=keywords content="Computer-Science-Fundamentals,Operating-systems,Process-Management,Concurrency-and-Parallelism,Synchronization,Mutual-Exclusion,Concurrency-Control,Process-Synchronization"><meta name=description content="**상호 배제(Mutual Exclusion)**는 여러 스레드나 프로세스가 공유 자원에 동시에 접근하지 못하도록 제어하여 데이터 일관성과 시스템 안정성을 보장하는 동시성 제어 기법이다. **임계 구역(Critical Section)**에 한 번에 하나의 실행 단위만 진입하도록 제한하며, **경쟁 상태(Race Condition)**를 방지한다. 구현에는 락(Lock), 세마포어(Semaphore), 뮤텍스(Mutex), 모니터(Monitor) 등이 사용되며, 분산 환경과 실시간 시스템에서도 필수적으로 활용된다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency--parallel-computing/thread-programming/thread-synchronization/mutual-exclusion/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency--parallel-computing/thread-programming/thread-synchronization/mutual-exclusion/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency--parallel-computing/thread-programming/thread-synchronization/mutual-exclusion/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency--parallel-computing/thread-programming/thread-synchronization/mutual-exclusion/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Mutual Exclusion"><meta property="og:description" content="**상호 배제(Mutual Exclusion)**는 여러 스레드나 프로세스가 공유 자원에 동시에 접근하지 못하도록 제어하여 데이터 일관성과 시스템 안정성을 보장하는 동시성 제어 기법이다. **임계 구역(Critical Section)**에 한 번에 하나의 실행 단위만 진입하도록 제한하며, **경쟁 상태(Race Condition)**를 방지한다. 구현에는 락(Lock), 세마포어(Semaphore), 뮤텍스(Mutex), 모니터(Monitor) 등이 사용되며, 분산 환경과 실시간 시스템에서도 필수적으로 활용된다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Mutual Exclusion"><meta name=twitter:description content="**상호 배제(Mutual Exclusion)**는 여러 스레드나 프로세스가 공유 자원에 동시에 접근하지 못하도록 제어하여 데이터 일관성과 시스템 안정성을 보장하는 동시성 제어 기법이다. **임계 구역(Critical Section)**에 한 번에 하나의 실행 단위만 진입하도록 제한하며, **경쟁 상태(Race Condition)**를 방지한다. 구현에는 락(Lock), 세마포어(Semaphore), 뮤텍스(Mutex), 모니터(Monitor) 등이 사용되며, 분산 환경과 실시간 시스템에서도 필수적으로 활용된다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HY's Blog","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Computer Science Fundamentals","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/"},{"@type":"ListItem","position":6,"name":"Mutual Exclusion","item":"https://buenhyden.github.io/posts/computer-science-fundamentals/concurrency--parallel-computing/thread-programming/thread-synchronization/mutual-exclusion/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>HY's Blog</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/computer-science-fundamentals/>Computer Science Fundamentals</a></div><h1>Mutual Exclusion</h1><div class=post-description>**상호 배제(Mutual Exclusion)**는 여러 스레드나 프로세스가 공유 자원에 동시에 접근하지 못하도록 제어하여 데이터 일관성과 시스템 안정성을 보장하는 동시성 제어 기법이다. **임계 구역(Critical Section)**에 한 번에 하나의 실행 단위만 진입하도록 제한하며, **경쟁 상태(Race Condition)**를 방지한다. 구현에는 락(Lock), 세마포어(Semaphore), 뮤텍스(Mutex), 모니터(Monitor) 등이 사용되며, 분산 환경과 실시간 시스템에서도 필수적으로 활용된다.</div></header><div class=post-content><h2 id=mutual-exclusion>Mutual Exclusion<a hidden class=anchor aria-hidden=true href=#mutual-exclusion>#</a></h2><p>**상호 배제 (Mutual Exclusion)**는 병행 및 병렬 환경에서 여러 실행 흐름이 **임계 구역 (Critical Section)**을 동시에 접근하지 못하도록 제어하여 <strong>데이터 무결성과 시스템 안정성</strong>을 보장하는 핵심 동기화 메커니즘이다. 고전적 알고리즘 (Dekker, Peterson, Lamport) 부터 하드웨어 명령어 (Test-and-Set, CAS), 운영체제 도구 (Mutex, Semaphore, Monitor), 분산 시스템의 락 (Redis, etcd, ZooKeeper) 까지 폭넓게 활용된다. 데드락, 기아 상태, 우선순위 역전 같은 문제를 해결하며, <strong>웹 서버, DB, 실시간 처리, 분산 트랜잭션 등</strong> 다양한 시스템에서 필수적인 개념이다.</p><h3 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h3><ul><li>초기 컴퓨터는 단일 프로세스 환경이었으나, 컴퓨터 성능이 향상되며 멀티프로그래밍・멀티프로세싱 등장.</li><li>여러 프로세스가 자원에 동시 접근하며 예상치 못한 오류와 데이터 훼손 발생.</li><li>소프트웨어적 해결책으로 고전적 알고리즘 (1950~70 년대) 들이 제안됨.</li><li>현대에는 하드웨어 지원 (Atomic Operation, CPU 명령어) 에 기반한 동기화 기법도 발전.</li></ul><h4 id=등장-배경>등장 배경<a hidden class=anchor aria-hidden=true href=#등장-배경>#</a></h4><p>단일 프로세스 → 병행 프로세스의 전환</p><table><thead><tr><th>구분</th><th>설명</th></tr></thead><tbody><tr><td>초기 시스템</td><td>단일 프로세스 구조로 자원 충돌이 존재하지 않음</td></tr><tr><td>전환 계기</td><td><strong>멀티프로그래밍</strong> 및 <strong>멀티프로세싱</strong> 시스템 도입 (1950~60 년대 후반)</td></tr><tr><td>문제 발생</td><td>여러 프로세스가 동시에 공유 자원 접근 시 <strong>데이터 레이스, 무결성 훼손</strong> 발생</td></tr><tr><td>최초 제안자</td><td><strong>Edsger W. Dijkstra (1965)</strong>: 논문 <em>&ldquo;Solution of a problem in concurrent programming control&rdquo;</em> 에서 Mutual Exclusion 문제 정의</td></tr></tbody></table><p>→ <strong>병행 시스템에서 자원의 일관성과 안정성을 보장할 동기화 메커니즘의 필요성</strong>이 제기됨</p><h4 id=발전과정>발전과정<a hidden class=anchor aria-hidden=true href=#발전과정>#</a></h4><h5 id=고전-소프트웨어-기반-알고리즘의-등장-19601980-년대>고전 소프트웨어 기반 알고리즘의 등장 (1960~1980 년대)<a hidden class=anchor aria-hidden=true href=#고전-소프트웨어-기반-알고리즘의-등장-19601980-년대>#</a></h5><table><thead><tr><th>시기</th><th>주요 인물 / 알고리즘</th><th>핵심 기여 및 특징</th></tr></thead><tbody><tr><td>1962</td><td><strong>Dekker&rsquo;s Algorithm</strong></td><td>최초의 소프트웨어 기반 상호 배제. <code>flag</code>, <code>turn</code> 사용</td></tr><tr><td>1965</td><td><strong>Dijkstra</strong></td><td>상호 배제 문제 정의 및 공식화</td></tr><tr><td>1974</td><td><strong>Lamport&rsquo;s Bakery Algorithm</strong></td><td><code>choosing</code>, <code>number</code> 를 통해 공정성과 상호 배제 동시 보장</td></tr><tr><td>1981</td><td><strong>Peterson&rsquo;s Algorithm</strong></td><td>Dekker 개선. 간결하고 효율적인 2- 프로세스 상호 배제 구현</td></tr></tbody></table><ul><li>하드웨어 지원 없이 <strong>공유 메모리와 순수 알고리즘</strong>만으로 구현</li></ul><h5 id=하드웨어-기반-기법의-도입-1980-년대-중반-이후>하드웨어 기반 기법의 도입 (1980 년대 중반 이후)<a hidden class=anchor aria-hidden=true href=#하드웨어-기반-기법의-도입-1980-년대-중반-이후>#</a></h5><table><thead><tr><th>기술</th><th>설명</th></tr></thead><tbody><tr><td><strong>Test-and-Set (TAS)</strong></td><td>원자적 플래그 설정을 통해 락 구현. 바쁜 대기 (busy wait) 기반</td></tr><tr><td><strong>Compare-and-Swap (CAS)</strong></td><td>예상 값과 비교 후 교체. lock-free 구조 구현의 핵심</td></tr><tr><td><strong>Fetch-and-Add (FAA)</strong></td><td>순서 보장형 락 구현. 티켓 기반 상호 배제</td></tr></tbody></table><p>→ 하드웨어 명령어를 통해 <strong>효율성, 원자성, 병렬성 보장</strong><br>→ <strong>Lock-Free, Wait-Free</strong> 알고리즘 설계 기반 마련</p><h5 id=운영체제-수준의-동기화-객체-등장>운영체제 수준의 동기화 객체 등장<a hidden class=anchor aria-hidden=true href=#운영체제-수준의-동기화-객체-등장>#</a></h5><table><thead><tr><th>기법</th><th>설명</th></tr></thead><tbody><tr><td><strong>Semaphore (세마포어)</strong></td><td>Dijkstra 에 의해 제안된 시스템 레벨 동기화 객체. <code>P()</code> / <code>V()</code> 연산</td></tr><tr><td><strong>Mutex (뮤텍스)</strong></td><td>바이너리 락. 한 번에 하나만 접근 가능</td></tr><tr><td><strong>Monitor</strong></td><td>조건 변수 + 락 추상화. 언어 수준 (예: Java <code>synchronized</code>) 통합 지원</td></tr></tbody></table><p>→ 프로그래밍 언어 및 OS 차원에서 <strong>추상화된 상호 배제 기법</strong> 보편화됨</p><h5 id=분산-시스템-기반-상호-배제-알고리즘의-발전>분산 시스템 기반 상호 배제 알고리즘의 발전<a hidden class=anchor aria-hidden=true href=#분산-시스템-기반-상호-배제-알고리즘의-발전>#</a></h5><table><thead><tr><th>알고리즘</th><th>설명</th></tr></thead><tbody><tr><td><strong>Lamport&rsquo;s Distributed Mutex</strong></td><td>메시지 타임스탬프 기반</td></tr><tr><td><strong>Ricart-Agrawala</strong></td><td>요청 - 응답 기반. 2(N−1) 메시지 필요</td></tr><tr><td><strong>Suzuki-Kasami</strong></td><td>토큰 기반. 메시지 수 감소</td></tr><tr><td><strong>Raymond, Maekawa</strong></td><td>트리/분할 구조 기반 최적화</td></tr></tbody></table><p>→ <strong>공유 메모리 없이도 네트워크 메시지를 통해</strong> 상호 배제 보장 가능<br>→ 분산 환경, 클러스터 기반 시스템에서 필수적</p><h4 id=현대의-실무-기반-기법>현대의 실무 기반 기법<a hidden class=anchor aria-hidden=true href=#현대의-실무-기반-기법>#</a></h4><table><thead><tr><th>기법</th><th>설명</th></tr></thead><tbody><tr><td><strong>Spinlock</strong></td><td>짧은 경합에 적합한 busy wait 락</td></tr><tr><td><strong>Lock-Free Data Structures</strong></td><td>CAS 기반 동시성 자료구조</td></tr><tr><td><strong>Distributed Lock Service</strong></td><td>Redis, Zookeeper 기반 분산 락. 마이크로서비스, 클라우드 환경에서 사용</td></tr></tbody></table><p>→ <strong>성능 최적화, 고가용성, 분산 처리</strong>를 위한 현대적 요구사항 대응<br>→ 실시간, 고성능 시스템, 클라우드 아키텍처에서 실무 활용도 높음</p><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><h4 id=데이터-보호-및-무결성-보장>데이터 보호 및 무결성 보장<a hidden class=anchor aria-hidden=true href=#데이터-보호-및-무결성-보장>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>데이터 무결성 보장</td><td>동시 접근 시 발생할 수 있는 데이터 손상, 중복 갱신 등을 방지하여 정확한 상태를 유지</td></tr><tr><td>일관성 유지 (Consistency)</td><td>임계 구역 내 자원 접근을 직렬화함으로써 실행 결과의 예측 가능성과 결정성 (Determinism) 을 확보</td></tr><tr><td>경쟁 상태 (Race Condition) 방지</td><td>두 개 이상의 스레드가 동시에 공유 자원에 접근하면서 생기는 비결정적 결과 방지</td></tr></tbody></table><ul><li>공유 자원 (write 또는 read-modify-write) 에 대해 항상 <strong>하나의 주체만 접근하도록 강제</strong>하여 논리적 오류 및 불일치 제거</li></ul><h4 id=시스템-안정성과-신뢰성-확보>시스템 안정성과 신뢰성 확보<a hidden class=anchor aria-hidden=true href=#시스템-안정성과-신뢰성-확보>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>Deadlock 방지</td><td>자원 획득 순서/대기 조건 제어를 통해 교착 상태가 발생하지 않도록 설계</td></tr><tr><td>Starvation 방지</td><td>특정 스레드가 계속해서 임계 구역 진입에 실패하지 않도록 공정한 접근 기회 제공</td></tr><tr><td>예측 가능한 실행 흐름 보장</td><td>프로그램 실행의 순서를 보장하고, 스레드 간 충돌 없이 안정적으로 시스템이 작동하도록 유지</td></tr></tbody></table><ul><li>동시성 환경에서 <strong>프로세스 간의 충돌, 정지, 무한 대기 등 예측 불가능한 상태</strong>를 제거하여 운영의 신뢰성과 품질 확보</li></ul><h4 id=공정성-및-효율성-확보>공정성 및 효율성 확보<a hidden class=anchor aria-hidden=true href=#공정성-및-효율성-확보>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>공정한 자원 할당</td><td>Waiting Queue, Priority 기반 동기화 설계를 통해 특정 스레드가 자원을 독점하지 않도록 보장</td></tr><tr><td>시스템 자원 효율성 향상</td><td>Spinlock, Mutex 등의 동기화 전략을 활용해 busy-wait 이나 context switch 최소화로 성능 확보</td></tr><tr><td>결정적 실행 (Determinism)</td><td>동일 입력에 대해 동일한 출력 결과 보장. 테스트/디버깅/트랜잭션 처리에서 중요</td></tr></tbody></table><ul><li>여러 스레드 간 자원 접근을 <strong>공정하게 분배하고</strong>, 시스템 자원 사용의 효율성과 성능을 극대화</li></ul><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><h4 id=이론적-핵심-개념-정리>이론적 핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#이론적-핵심-개념-정리>#</a></h4><table><thead><tr><th>개념</th><th>정의 및 설명</th></tr></thead><tbody><tr><td><strong>상호 배제 (Mutual Exclusion)</strong></td><td>둘 이상의 프로세스/스레드가 동시에 공유 자원에 접근하지 못하도록 보장하는 동기화 메커니즘</td></tr><tr><td><strong>임계구역 (Critical Section)</strong></td><td>공유 자원에 접근하는 코드 블록. 반드시 상호 배제가 보장되어야 하는 구역</td></tr><tr><td><strong>진입구역 / 해제구역 (Entry/Exit Section)</strong></td><td>임계구역에 들어가기 전후의 진입 조건 검사 및 해제 처리 로직</td></tr><tr><td><strong>경쟁 상태 (Race Condition)</strong></td><td>두 개 이상의 프로세스가 공유 자원에 동시에 접근하며, 실행 순서에 따라 결과가 달라지는 현상</td></tr><tr><td><strong>원자성 (Atomicity)</strong></td><td>연산이 중간에 끊기지 않고 완전하게 실행되는 성질. Lock-Free, Wait-Free 구현에서 핵심</td></tr><tr><td><strong>동시성 vs 병렬성</strong></td><td>- 동시성: 하나의 코어에서 여러 작업을 논리적으로 번갈아 수행 - 병렬성: 여러 코어에서 여러 작업을 동시에 수행</td></tr><tr><td><strong>상호 배제의 3 단계 상태</strong></td><td>- 실행 중 (Executing)- 대기 중 (Waiting)- 비임계 상태 (Non-Critical)</td></tr></tbody></table><h4 id=상호-배제-알고리즘의-요구-조건-정형화된-조건>상호 배제 알고리즘의 요구 조건 (정형화된 조건)<a hidden class=anchor aria-hidden=true href=#상호-배제-알고리즘의-요구-조건-정형화된-조건>#</a></h4><table><thead><tr><th>조건</th><th>설명</th></tr></thead><tbody><tr><td><strong>Mutual Exclusion</strong></td><td>두 프로세스가 동시에 임계구역에 진입할 수 없어야 함</td></tr><tr><td><strong>Progress</strong></td><td>임계구역에 진입할 프로세스가 결정되지 않은 경우, 대기 중이 아닌 프로세스만 판단에 참여해야 함</td></tr><tr><td><strong>Bounded Waiting</strong></td><td>특정 프로세스가 임계구역 진입을 무기한 기다리지 않도록 보장해야 함</td></tr><tr><td><strong>Deadlock Freedom</strong></td><td>프로세스들이 서로 무한히 기다리는 교착 상태가 없어야 함</td></tr><tr><td><strong>Starvation Freedom</strong></td><td>특정 프로세스가 영원히 기회를 받지 못하는 상황을 방지해야 함</td></tr></tbody></table><p>※ 대부분의 알고리즘은 위 조건 중 일부 또는 전부를 만족하며, 어떤 조건을 희생하느냐가 알고리즘 선택 기준이 됨</p><h4 id=실무-적용과의-연관성>실무 적용과의 연관성<a hidden class=anchor aria-hidden=true href=#실무-적용과의-연관성>#</a></h4><table><thead><tr><th>영역</th><th>적용 예시 및 상호 배제 기법</th></tr></thead><tbody><tr><td><strong>운영체제/시스템</strong></td><td>POSIX <code>pthread_mutex</code>, Windows <code>CriticalSection</code> 등</td></tr><tr><td><strong>프로그래밍 언어</strong></td><td><code>Java synchronized</code>, <code>Python threading.Lock</code>, <code>Go sync.Mutex</code></td></tr><tr><td><strong>웹서버</strong></td><td>공유 세션 관리, 캐시 업데이트 시 뮤텍스 필요</td></tr><tr><td><strong>데이터베이스</strong></td><td>트랜잭션 격리 수준 (Isolation Levels), 락 기반 동시성 제어</td></tr><tr><td><strong>분산 시스템</strong></td><td>Zookeeper, etcd, Redis 등을 통한 분산 락 (Leases + TTL)</td></tr><tr><td><strong>클라우드 환경</strong></td><td>Stateless 시스템에서 동기화 필요 시 외부 락 (예: Redis Redlock) 사용</td></tr><tr><td><strong>멀티스레딩 시스템</strong></td><td>락 경합 최소화를 위한 Lock-Free 구조 설계 필요</td></tr></tbody></table><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><table><thead><tr><th>주요 기능</th><th>설명</th><th>주요 역할</th></tr></thead><tbody><tr><td><strong>접근 제어</strong></td><td>임계 구역 (Critical Section) 에 동시에 하나의 프로세스만 접근 허용</td><td>상호 배제 (Mutual Exclusion) 보장</td></tr><tr><td><strong>자원 보호</strong></td><td>공유 자원 (메모리, 파일, 세션 등) 에 대한 무분별한 접근 차단</td><td>데이터 무결성 및 일관성 유지</td></tr><tr><td><strong>프로세스 동기화</strong></td><td>여러 프로세스/스레드 간 실행 순서 제어</td><td>동시성 환경에서 협력 보장, 충돌 방지</td></tr><tr><td><strong>실행 순서 제어</strong></td><td>진입 요청 순서 관리 (예: FIFO, Logical Clock, Priority Queue)</td><td>공정성 (Fairness), Starvation 방지</td></tr><tr><td><strong>상태 추적</strong></td><td>자원 점유 상태, 대기 상태 등 추적을 통한 동작 흐름 관리</td><td>데드락/경쟁 상태 방지, 시스템 안정성 향상</td></tr><tr><td><strong>교착 상태 회피</strong></td><td>Deadlock 발생 조건 회피 (자원 선점, 순환 대기 등)</td><td>시스템 진행 가능성 유지, 비정상 대기 방지</td></tr><tr><td><strong>우선순위 제어</strong></td><td>우선순위 역전 방지 (Priority Inheritance 등 기법 적용)</td><td>실시간 시스템에서 응답 시간 보장</td></tr></tbody></table><h4 id=기능-간-의존성과-흐름>기능 간 의존성과 흐름<a hidden class=anchor aria-hidden=true href=#기능-간-의존성과-흐름>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>[접근 제어] → [자원 보호] → [동기화] → [순서 제어/우선순위 제어] → [시스템 안정성 확보]
</span></span><span class=line><span class=cl>                        ↘︎ [상태 추적] ↗︎
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>접근 제어</strong>는 가장 기본이자 모든 기능의 전제 조건</li><li><strong>자원 보호</strong>와 <strong>동기화</strong>는 실질적인 동작 보장을 위한 쌍</li><li><strong>상태 추적</strong>, <strong>교착 상태 회피</strong>, <strong>우선순위 제어</strong>는 보완 기능이며, 시스템의 공정성과 신뢰성을 높이는 역할</li></ul><h4 id=기능--역할-매핑-도식>기능 ↔ 역할 매핑 도식<a hidden class=anchor aria-hidden=true href=#기능--역할-매핑-도식>#</a></h4><pre class=mermaid>graph TD
    A1[접근 제어] --&gt; R1[상호 배제 보장]
    A2[자원 보호] --&gt; R2[데이터 일관성 유지]
    A3[프로세스 동기화] --&gt; R3[실행 충돌 방지]
    A4[실행 순서 제어] --&gt; R4[공정성 및 Starvation 방지]
    A5[상태 추적] --&gt; R5[시스템 안정성 확보]
    A6[교착 상태 회피] --&gt; R6[진행 가능성 보장]
    A7[우선순위 제어] --&gt; R7[우선순위 역전 방지]

    subgraph 기능
        A1
        A2
        A3
        A4
        A5
        A6
        A7
    end

    subgraph 역할
        R1
        R2
        R3
        R4
        R5
        R6
        R7
    end
</pre><ul><li>각 <strong>기능 (Function)</strong> 이 수행하는 <strong>역할 (Role)</strong> 을 1:1 또는 1:N 매핑으로 시각화한 것으로, 구현 설계 시 책임 분리를 명확히 할 수 있다.</li></ul><h4 id=기능-흐름-및-책임-분리-기반>기능 흐름 및 책임 분리 기반<a hidden class=anchor aria-hidden=true href=#기능-흐름-및-책임-분리-기반>#</a></h4><ul><li><strong>진입 단계</strong>: <code>접근 제어</code> 와 <code>실행 순서 제어</code> 는 <strong>임계 구역 진입 전 조건 판단</strong> 및 순서 공정성 보장을 담당</li><li><strong>실행 단계</strong>: <code>프로세스 동기화</code> 와 <code>자원 보호</code> 는 실제 <strong>임계 구역 내에서의 자원 무결성과 충돌 방지</strong>를 책임</li><li><strong>후속 제어</strong>: <code>상태 추적</code>, <code>교착 상태 회피</code>, <code>우선순위 제어</code> 는 시스템이 <strong>오류 없이 안정적으로 운영</strong>되도록 뒷단에서 지속 관리</li></ul><pre class=mermaid>flowchart TD
    subgraph 진입 단계
        AC[접근 제어]
        SQ[실행 순서 제어]
    end

    subgraph 실행 단계
        RP[자원 보호]
        SY[프로세스 동기화]
    end

    subgraph 후속 제어
        ST[상태 추적]
        DL[교착 상태 회피]
        PR[우선순위 제어]
    end

    AC --&gt; SQ
    SQ --&gt; SY
    SY --&gt; RP
    RP --&gt; ST
    ST --&gt; DL
    DL --&gt; PR

    style AC fill:#e1f5fe,stroke:#0288d1
    style SQ fill:#e1f5fe,stroke:#0288d1
    style RP fill:#ffe0b2,stroke:#f57c00
    style SY fill:#ffe0b2,stroke:#f57c00
    style ST fill:#f3e5f5,stroke:#8e24aa
    style DL fill:#f3e5f5,stroke:#8e24aa
    style PR fill:#f3e5f5,stroke:#8e24aa
</pre><h4 id=실무-시스템-기반-상호-배제-기능-매핑>실무 시스템 기반 상호 배제 기능 매핑<a hidden class=anchor aria-hidden=true href=#실무-시스템-기반-상호-배제-기능-매핑>#</a></h4><pre class=mermaid>graph TD
    subgraph Application Layer
        A1[Business Logic]
        A2[Concurrent Requests]
    end

    subgraph Synchronization Layer
        M1[Mutex / Lock]
        S1[Semaphore]
        R1[Distributed Lock Service]
    end

    subgraph Resource Layer
        DB[(Database)]
        CACHE[(Cache Store)]
        FILE[(File / Session)]

    end

    A1 --&gt;|임계 구역 요청| M1
    A2 --&gt;|동시 요청| S1
    M1 --&gt;|락 획득| DB
    S1 --&gt;|제한 접근| CACHE
    A1 --&gt; R1
    R1 --&gt;|분산 락| DB
    R1 --&gt;|분산 락| FILE
</pre><ul><li>로컬 환경에서는 <code>Mutex</code>, <code>Semaphore</code> 를 활용하여 동시 접근 제어</li><li>분산 환경에서는 Redis, Zookeeper, etcd 등으로 <code>Distributed Lock</code> 구성</li><li>DB 트랜잭션 락, Cache 업데이트, 세션 파일 접근 등 공유 자원에 대한 보호 수행</li></ul><h4 id=기능별-장애-시나리오-및-복구-흐름도>기능별 장애 시나리오 및 복구 흐름도<a hidden class=anchor aria-hidden=true href=#기능별-장애-시나리오-및-복구-흐름도>#</a></h4><pre class=mermaid>flowchart TD
    start[시작: 임계 구역 요청]
    check[락 획득 시도]
    success[락 획득 성공]
    fail[락 획득 실패]
    retry[재시도 또는 대기]
    timeout[타임아웃 발생]
    escalate[우선순위 변경 / 에러 처리]
    critical[임계 구역 진입]
    release[자원 해제]
    complete[정상 종료]

    start --&gt; check
    check --&gt;|가능| success
    check --&gt;|불가능| fail
    fail --&gt; retry
    retry --&gt;|재시도| check
    retry --&gt;|시간 초과| timeout
    timeout --&gt; escalate
    success --&gt; critical
    critical --&gt; release
    release --&gt; complete
</pre><ul><li><strong>락 획득 실패</strong>: 경쟁 상태나 선점으로 실패 → <strong>retry / backoff / 대기</strong></li><li><strong>타임아웃</strong>: 영원한 대기 방지 → <strong>우선순위 상승, 장애 로깅, 대체 흐름 이동</strong></li><li><strong>락 해제 실패</strong>: 다음 프로세스 교착 가능 → <strong>락 모니터링 시스템</strong> 필수</li></ul><blockquote><p>🛠 실시간 서비스에서는 <code>타임아웃 + fallback + 우선순위 정책</code> 이 중요</p></blockquote><h4 id=이벤트-기반-시스템-내-상호-배제-구조>이벤트 기반 시스템 내 상호 배제 구조<a hidden class=anchor aria-hidden=true href=#이벤트-기반-시스템-내-상호-배제-구조>#</a></h4><pre class=mermaid>sequenceDiagram
    participant Producer
    participant EventQueue(Kafka/SQS)
    participant Consumer
    participant LockService(Redis/Zookeeper)
    participant Resource(DB/Cache)

    Producer-&gt;&gt;EventQueue: 이벤트 발행 (OrderCreated)
    Consumer-&gt;&gt;EventQueue: 이벤트 수신
    Consumer-&gt;&gt;LockService: 락 획득 요청
    alt 락 획득 성공
        LockService--&gt;&gt;Consumer: OK
        Consumer-&gt;&gt;Resource: DB/Cache 업데이트
        Consumer-&gt;&gt;LockService: 락 해제
    else 락 획득 실패
        Consumer-&gt;&gt;Consumer: 재시도 / 백오프
    end
</pre><ul><li><strong>Producer</strong>: 도메인 이벤트 발행 (ex. 주문 생성)</li><li><strong>Consumer</strong>: 메시지를 소비하고 <strong>공유 자원 접근 전 분산 락 획득</strong></li><li><strong>Lock Service</strong>: Redis 의 SET NX/EX, Redlock 또는 Zookeeper ephemeral node</li><li><strong>Resource</strong>: 동시성 제어가 필요한 DB, 세션, 전역 상태 등</li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><h4 id=핵심-속성>핵심 속성<a hidden class=anchor aria-hidden=true href=#핵심-속성>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>배타성 (Mutual Exclusivity)</strong></td><td>임계 구역 (Critical Section) 에 동시에 하나의 프로세스/스레드만 접근 가능해야 함</td></tr><tr><td><strong>진행성 (Progress)</strong></td><td>자원이 비어 있고, 어떤 프로세스가 접근을 시도할 경우 반드시 진입할 수 있어야 함</td></tr><tr><td><strong>유한 대기 (Bounded Waiting)</strong></td><td>임계 구역 진입을 기다리는 프로세스가 무한히 기다리는 일이 없어야 함 (기아 상태 방지)</td></tr><tr><td><strong>공정성 (Fairness)</strong></td><td>모든 프로세스가 균등하게 자원을 사용할 수 있는 기회를 가져야 함</td></tr><tr><td><strong>원자성 (Atomicity)</strong></td><td>자원 접근을 위한 상태 변화 (락 획득/해제) 는 분할되지 않고 한 번에 수행되어야 함</td></tr></tbody></table><blockquote><p>🔍 이 다섯 가지는 Mutual Exclusion 알고리즘의 <strong>이론적 핵심 조건</strong>으로, 대부분의 교과서나 OS 논문에서 공통적으로 제시됨 (예: Peterson, Bakery 등은 이 기준을 충족하는지 분석됨)</p></blockquote><h4 id=시스템-관점의-특징>시스템 관점의 특징<a hidden class=anchor aria-hidden=true href=#시스템-관점의-특징>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>동시성 제어 기초</strong></td><td>병행성 환경에서 발생할 수 있는 데이터 충돌을 제어하는 가장 기초적인 동기화 수단</td></tr><tr><td><strong>성능 영향 존재</strong></td><td>락 획득/해제, context switch, busy-wait 등으로 인해 오버헤드가 발생할 수 있음</td></tr><tr><td><strong>확장성 고려 필요</strong></td><td>시스템에 참여하는 스레드/프로세스 수가 많아질수록 구현 방식에 따라 성능 저하나 병목이 발생할 수 있음</td></tr><tr><td><strong>시스템 안정성 기여</strong></td><td>Race condition, deadlock, starvation 을 예방해 신뢰성 높은 시스템 운영 가능</td></tr><tr><td><strong>공유 자원 보호</strong></td><td>임계 구역을 통해 데이터의 무결성과 일관성 보장</td></tr></tbody></table><blockquote><p>🔍 이 부분은 실무적 운영 설계 시 반드시 고려해야 하며, 특히 고성능 시스템에서는 <strong>락 최소화 / lock-free 설계</strong>가 중요하게 고려됨</p></blockquote><hr><h4 id=구현-관점의-특징>구현 관점의 특징<a hidden class=anchor aria-hidden=true href=#구현-관점의-특징>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>다양한 구현 기법 존재</strong></td><td>소프트웨어 (플래그/턴 변수), 하드웨어 (CAS, Test-and-Set), 운영체제 (Mutex, Semaphore), 분산 (Message Passing) 등</td></tr><tr><td><strong>환경 의존성</strong></td><td>Shared memory 기반 vs Message-passing 기반 구현 선택은 시스템 구조에 따라 달라짐</td></tr><tr><td><strong>실현 난이도 차이</strong></td><td>단순한 구현은 데드락/기아 문제를 발생시킬 수 있어 정확한 조건 만족 여부 판단이 필요</td></tr><tr><td><strong>Trade-off 존재</strong></td><td>성능 vs 공정성 vs 복잡성 간 균형을 맞춰야 하며, 완벽한 구현은 불가능할 수도 있음</td></tr><tr><td><strong>실시간 처리 대응성</strong></td><td>우선순위 기반 제어 (Priority Inheritance 등) 없이는 실시간 시스템에서의 정확한 반응성 확보 어려움</td></tr></tbody></table><blockquote><p>🔍 특히 분산 환경에서는 <strong>토큰 기반, 허가 기반, 쿼럼 기반</strong> 등 메시지 전달을 중심으로 하여 <strong>정합성, 메시지 수, 병목성</strong> 등의 문제가 발생할 수 있음</p></blockquote><h4 id=mutual-exclusion-의-주요-트레이드오프>Mutual Exclusion 의 주요 트레이드오프<a hidden class=anchor aria-hidden=true href=#mutual-exclusion-의-주요-트레이드오프>#</a></h4><h5 id=성능-performance-vs-안전성-safety>성능 (Performance) Vs 안전성 (Safety)<a hidden class=anchor aria-hidden=true href=#성능-performance-vs-안전성-safety>#</a></h5><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>Lock-free/Spinlock</strong></td><td>빠른 응답성과 낮은 오버헤드를 제공하지만, 경쟁 상황에서 busy-wait 로 CPU 자원 낭비 가능</td></tr><tr><td><strong>Blocking-based Mutex/Semaphore</strong></td><td>안전성과 공정성을 보장하지만, 컨텍스트 스위치나 스레드 스케줄링 오버헤드가 발생하여 성능 저하 가능</td></tr></tbody></table><blockquote><p>📌 <strong>요점</strong>: 고성능이 필요한 환경에서는 락 - 프리나 스핀락이 유리하지만, 데이터 안정성 보장이 어려워짐. 시스템 안정성이 더 중요한 경우 Mutex 등의 블로킹 기법이 적절함.</p></blockquote><h5 id=공정성-fairness-vs-복잡성-complexity><strong>공정성 (Fairness) Vs 복잡성 (Complexity)</strong><a hidden class=anchor aria-hidden=true href=#공정성-fairness-vs-복잡성-complexity>#</a></h5><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>공정한 큐 기반 락 (e.g., Bakery, Queue-based Mutex)</strong></td><td>starvation 방지와 진입 순서 보장하지만 구현과 디버깅이 복잡함</td></tr><tr><td><strong>간단한 플래그 기반 락 (e.g., Test-and-Set)</strong></td><td>구현이 단순하지만 특정 프로세스가 무한 대기할 수 있음 (공정성 낮음)</td></tr></tbody></table><blockquote><p>📌 <strong>요점</strong>: 공정성을 보장하려면 큐, 시계, 우선순위 등 메커니즘을 추가해야 하며, 이는 코드 복잡성과 유지보수 비용 상승으로 이어짐.</p></blockquote><h5 id=확장성-scalability-vs-자원-소모-resource-overhead><strong>확장성 (Scalability) Vs 자원 소모 (Resource Overhead)</strong><a hidden class=anchor aria-hidden=true href=#확장성-scalability-vs-자원-소모-resource-overhead>#</a></h5><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>Token Ring, Raymond 알고리즘 (분산)</strong></td><td>메시지 수를 줄이고 확장 가능하나, 토큰 분실/회복 처리가 필요</td></tr><tr><td><strong>Centralized Lock Server</strong></td><td>구현이 단순하고 유지보수가 쉬우나, 중앙 서버에 병목 발생 가능 (SPOF)</td></tr></tbody></table><blockquote><p>📌 <strong>요점</strong>: 대규모 분산 환경에서는 확장성 높은 구조가 필요하지만, 정합성 보장 비용과 장애 대응 로직의 복잡도가 증가함.</p></blockquote><h5 id=응답-시간-response-time-vs-결정성-determinism><strong>응답 시간 (Response Time) Vs 결정성 (Determinism)</strong><a hidden class=anchor aria-hidden=true href=#응답-시간-response-time-vs-결정성-determinism>#</a></h5><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>Priority-based Mutex (with Inheritance)</strong></td><td>긴급 처리 스레드에 빠른 접근을 보장하지만 시스템 전체 응답성에 부정적 영향 가능</td></tr><tr><td><strong>FIFO 기반 락</strong></td><td>결정적 진입 순서를 보장하지만, 실시간 처리 요구사항을 충족하기 어려움</td></tr></tbody></table><blockquote><p>📌 <strong>요점</strong>: 실시간 시스템에서는 결정성보다 우선순위 기반 반응성이 중요하지만, 반대로 일반 시스템에서는 예측 가능한 순서가 더 바람직할 수 있음.</p></blockquote><h5 id=단순성-simplicity-vs-장애-대응력-fault-tolerance><strong>단순성 (Simplicity) Vs 장애 대응력 (Fault Tolerance)</strong><a hidden class=anchor aria-hidden=true href=#단순성-simplicity-vs-장애-대응력-fault-tolerance>#</a></h5><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>Single-threaded Mutex (Non-reentrant)</strong></td><td>단순하고 예측 가능하나 스레드 실패 시 락 해제 불가로 Deadlock 가능성</td></tr><tr><td><strong>Watchdog + Timeout + Recovery 기반 락</strong></td><td>복구 전략이 포함되어 장애 내성이 높으나, 타임아웃 조정/복구 로직이 복잡</td></tr></tbody></table><blockquote><p>📌 <strong>요점</strong>: 시스템 신뢰성 확보를 위해서는 복잡성을 감수하고 장애 상황에 대한 대응 로직을 설계해야 함.</p></blockquote><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><h4 id=상호-배제-mutual-exclusion>상호 배제 (Mutual Exclusion)<a hidden class=anchor aria-hidden=true href=#상호-배제-mutual-exclusion>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>정의</td><td>임계 구역 (Critical Section) 에는 한 번에 <strong>하나의 프로세스/스레드</strong>만 진입할 수 있어야 함</td></tr><tr><td>목적</td><td>공유 자원에 대한 <strong>데이터 무결성, 상태 일관성 유지</strong></td></tr><tr><td>실무 적용</td><td>Mutex, Semaphore, Monitor 등 모든 동기화 기법의 가장 기본적인 보장 조건</td></tr><tr><td>위반 시 현상</td><td>데이터 손상 (Race Condition), 상태 불일치, 동기화 실패 발생</td></tr></tbody></table><h4 id=진행성-progress>진행성 (Progress)<a hidden class=anchor aria-hidden=true href=#진행성-progress>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>정의</td><td>임계 구역에 들어가려는 프로세스가 없을 경우, 자원 접근 요청 중인 프로세스 중 <strong>어떤 프로세스라도</strong> 진입이 가능해야 함</td></tr><tr><td>목적</td><td><strong>활성화된 프로세스들이 락을 확보할 수 있도록 보장</strong>하여 시스템이 정지하지 않도록 유지</td></tr><tr><td>실무 적용</td><td>Deadlock 방지 및 응답성 확보, 커널 스케줄러 및 동기화 로직 설계 시 고려</td></tr><tr><td>위반 시 현상</td><td>우선순위 역전 (Priority Inversion), 락 해제 지연 등으로 시스템의 응답성 저하</td></tr></tbody></table><h4 id=유한-대기-bounded-waiting>유한 대기 (Bounded Waiting)<a hidden class=anchor aria-hidden=true href=#유한-대기-bounded-waiting>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>정의</td><td>어떤 프로세스든 임계 구역 진입 요청 이후, <strong>유한한 시간 내에</strong> 접근 기회가 주어져야 함</td></tr><tr><td>목적</td><td>특정 프로세스의 <strong>무한 대기 (Starvation)</strong> 방지</td></tr><tr><td>실무 적용</td><td>락 대기 큐, FIFO 락, 우선순위 제어 등에서 대기 시간 보장을 위한 전략 필요</td></tr><tr><td>위반 시 현상</td><td>특정 스레드가 영원히 자원에 접근하지 못하고 응답 중단 (Starvation) 발생 가능</td></tr></tbody></table><h4 id=공정성-fairness>공정성 (Fairness)<a hidden class=anchor aria-hidden=true href=#공정성-fairness>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>정의</td><td><strong>모든 프로세스</strong>가 동등하게 임계 구역 진입 기회를 가져야 함 (선입선출 또는 우선순위 기반)</td></tr><tr><td>목적</td><td>자원 독점 방지, 시스템 전반의 균형 유지</td></tr><tr><td>실무 적용</td><td>Lock-free 구조, 우선순위 기반 락 (Priority Inheritance), 대기 큐 전략</td></tr><tr><td>위반 시 현상</td><td>특정 프로세스의 독점, 기아 상태, 불균형 자원 분배로 시스템 효율 저하</td></tr></tbody></table><h4 id=속도-독립성-speed-independence--독립성>속도 독립성 (Speed Independence) / 독립성<a hidden class=anchor aria-hidden=true href=#속도-독립성-speed-independence--독립성>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>정의</td><td>알고리즘은 <strong>프로세스의 상대적인 실행 속도에 의존하지 않고</strong> 동작해야 함</td></tr><tr><td>목적</td><td><strong>비결정적 실행 순서</strong>에서도 항상 상호 배제가 보장되도록 설계 필요</td></tr><tr><td>실무 적용</td><td>멀티코어 환경, 분산 시스템에서의 비동기 처리 조건 반영 필요</td></tr><tr><td>위반 시 현상</td><td>빠른 프로세스가 계속해서 진입하여 다른 프로세스를 차단 (우선순위 역전 포함)</td></tr></tbody></table><h4 id=결정성-determinism>결정성 (Determinism)<a hidden class=anchor aria-hidden=true href=#결정성-determinism>#</a></h4><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>정의</td><td>동일한 입력 조건에서 항상 <strong>예측 가능한 결과</strong>를 보장해야 함</td></tr><tr><td>목적</td><td>시스템 검증, 디버깅, 리그레션 테스트 가능성 확보</td></tr><tr><td>실무 적용</td><td>특히 테스트 자동화, 정형 검증 (Formal Verification), 금융/실시간 시스템 설계 시 중요</td></tr><tr><td>위반 시 현상</td><td>상태마다 결과가 달라지는 비결정성 발생 → 재현 불가 버그 유발 가능성 증가</td></tr></tbody></table><h3 id=주요-원리-및-작동-원리>주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#주요-원리-및-작동-원리>#</a></h3><h4 id=핵심-원리>핵심 원리<a hidden class=anchor aria-hidden=true href=#핵심-원리>#</a></h4><table><thead><tr><th>원리</th><th>설명</th></tr></thead><tbody><tr><td><strong>상호 배제 (Mutual Exclusion)</strong></td><td>하나의 프로세스/스레드만 임계구역에 진입 가능해야 함</td></tr><tr><td><strong>원자성 (Atomicity)</strong></td><td>진입 조건 검사가 불가분적이어야 함 (중간 상태 노출 금지)</td></tr><tr><td><strong>진행성 (Progress)</strong></td><td>경쟁 중인 프로세스가 없으면 즉시 진입 결정이 이뤄져야 함</td></tr><tr><td><strong>한정 대기 (Bounded Waiting)</strong></td><td>특정 프로세스가 무한정 기다리지 않도록 보장되어야 함</td></tr></tbody></table><h4 id=기본-구조-및-단계별-작동-방식>기본 구조 및 단계별 작동 방식<a hidden class=anchor aria-hidden=true href=#기본-구조-및-단계별-작동-방식>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>[Entry Section] → [Critical Section] → [Exit Section] → [Remainder Section]
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Entry Section</strong>: 진입 조건 검사 및 자원 획득 시도</li><li><strong>Critical Section</strong>: 공유 자원 접근 (락 획득 상태)</li><li><strong>Exit Section</strong>: 자원 해제 및 다음 프로세스에게 기회 제공</li><li><strong>Remainder Section</strong>: 일반 코드 실행</li></ul><p>→ 이 구조는 소프트웨어/하드웨어/운영체제/분산 방식 모두에 적용됨</p><h4 id=mutual-exclusion-작동-흐름>Mutual Exclusion 작동 흐름<a hidden class=anchor aria-hidden=true href=#mutual-exclusion-작동-흐름>#</a></h4><pre class=mermaid>flowchart TD
    A[프로세스 Pn → 진입 요청] --&gt; B{임계구역 사용 가능?}
    B -- Yes --&gt; C[임계구역 진입]
    B -- No --&gt; D[대기 큐 등록 또는 대기 상태 유지]
    C --&gt; E[공유 자원 접근 및 작업 수행]
    E --&gt; F[임계구역 해제]
    F --&gt; G{대기 중 프로세스 있음?}
    G -- Yes --&gt; H[다음 프로세스에게 권한 부여]
    G -- No --&gt; I[임계구역 유휴 상태]
    D --&gt; J{진입 조건 충족?}
    J -- Yes --&gt; C
    J -- No --&gt; D
</pre><p>→ 이 흐름은 <strong>소프트웨어 기반 (Peterson, Bakery)</strong>, <strong>하드웨어 기반 (TAS, CAS)</strong>, <strong>운영체제 기반 (Mutex, Monitor)</strong>, <strong>분산 기반 (Ricart-Agrawala, Token Ring)</strong> 등 어디에도 적용 가능한 일반적인 작동 모델.</p><h4 id=작동-방식별-구현-전략-구현-방식별-원리-비교>작동 방식별 구현 전략 (구현 방식별 원리 비교)<a hidden class=anchor aria-hidden=true href=#작동-방식별-구현-전략-구현-방식별-원리-비교>#</a></h4><table><thead><tr><th>구현 방식</th><th>주요 작동 원리</th><th>예시 알고리즘/도구</th></tr></thead><tbody><tr><td><strong>소프트웨어 기반</strong></td><td>Flag, Turn 변수로 경쟁 상태 회피</td><td>Peterson, Lamport Bakery</td></tr><tr><td><strong>하드웨어 기반</strong></td><td>원자적 명령어로 Lock 획득 (Test-and-Set 등)</td><td>TAS, CAS, FAA</td></tr><tr><td><strong>운영체제 기반</strong></td><td>OS 커널 지원 동기화 객체 사용</td><td>Mutex, Semaphore, Monitor</td></tr><tr><td><strong>분산 시스템</strong></td><td>메시지 교환/토큰 전달 기반으로 상호 배제 보장</td><td>Ricart-Agrawala, Suzuki-Kasami</td></tr></tbody></table><blockquote><p>각 방식은 진입 조건 확인, 자원 점유 판단, 해제 방식에서 약간씩 차이를 가짐</p></blockquote><h4 id=작동-원리의-주요-고려사항>작동 원리의 주요 고려사항<a hidden class=anchor aria-hidden=true href=#작동-원리의-주요-고려사항>#</a></h4><table><thead><tr><th>고려 요소</th><th>설명</th></tr></thead><tbody><tr><td><strong>락 경합 (Race Condition)</strong></td><td>진입 조건 검사 및 자원 점유 사이에 다른 프로세스가 개입할 수 없음</td></tr><tr><td><strong>Deadlock 방지</strong></td><td>순환 대기, 자원 점유 후 대기 등을 회피하는 설계 필요</td></tr><tr><td><strong>Fairness (공정성)</strong></td><td>FIFO, logical clock 등 공정한 진입 순서 보장</td></tr><tr><td><strong>Scalability (확장성)</strong></td><td>분산 환경에서도 예측 가능하게 작동할 수 있어야 함</td></tr><tr><td><strong>Timeout / Retry 전략</strong></td><td>교착 상태나 무한 대기 방지를 위한 복구 전략 필요</td></tr></tbody></table><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><pre class=mermaid>flowchart TD
    subgraph 프로세스 영역
        P1[프로세스 1]
        P2[프로세스 2]
        Pn[프로세스 n]
    end

    subgraph 상호 배제 시스템
        subgraph 진입 처리
            EP[Entry Protocol]
            AT[원자적 연산 / 시스템 콜]
            SYNC[&#34;동기화 객체 (Mutex / Semaphore / Monitor)&#34;]
        end

        subgraph 대기 및 보조 제어
            WQ[Waiting Queue]
            PM[Priority Manager]
            TM[Timeout Mechanism]
            DL[Deadlock Detection]
        end

        subgraph 임계 영역
            CS[Critical Section]
            SR[공유 자원]
        end

        subgraph 종료 처리
            XP[Exit Protocol]
        end
    end

    %% 프로세스 흐름
    P1 --&gt; EP
    P2 --&gt; EP
    Pn --&gt; EP

    %% 진입 → 임계구역
    EP --&gt; AT --&gt; SYNC
    SYNC --&gt;|성공| CS
    SYNC --&gt;|실패| WQ

    %% 보조 흐름
    WQ --&gt;|우선순위| PM
    WQ --&gt;|타임아웃| TM
    WQ --&gt; DL
    DL --&gt;|재시도| EP

    %% 임계구역 종료
    CS --&gt; SR --&gt; XP --&gt; SYNC

    style CS fill:#ffcccc
    style SYNC fill:#ccffcc
    style WQ fill:#ccccff
    style TM fill:#fff2cc
    style DL fill:#e0e0e0
    style PM fill:#fff0f5
    style XP fill:#d5f5e3
</pre><h4 id=필수-구성-요소>필수 구성 요소<a hidden class=anchor aria-hidden=true href=#필수-구성-요소>#</a></h4><p>Mutual Exclusion 의 핵심은 세 가지 영역 (진입 → 임계 → 해제) 을 명확히 구분하고, 동기화 객체를 통해 진입 권한을 제어하는 것이다. 모든 구현은 이 구조를 바탕으로 작동하며, <strong>Entry/Exit Protocol</strong>은 원자적 실행 보장과 상태 동기화를 반드시 수반해야 한다. 특히 <strong>Critical Section</strong>은 최소 시간 점유 및 병목 최소화가 중요하다.</p><table><thead><tr><th>구성 요소</th><th>기능</th><th>역할</th><th>특성 및 고려사항</th></tr></thead><tbody><tr><td>Entry Protocol</td><td>진입 요청을 초기화 및 상태 설정</td><td>동시 접근을 제어하는 시작 지점</td><td>원자적 연산, 상태 변수 활용, 경쟁 조건 방지 필요</td></tr><tr><td>동기화 객체 (SYNC)</td><td>락/세마포어 등 진입 통제 수단</td><td>상호 배제를 실제로 구현하는 장치</td><td>Mutex, Semaphore, Monitor 등으로 구현 가능</td></tr><tr><td>Critical Section</td><td>공유 자원 접근 코드</td><td>자원 무결성 보장을 위해 단일 프로세스만 접근 가능하게 함</td><td>최대한 짧고 최소화, 병목 최소화 필요</td></tr><tr><td>Exit Protocol</td><td>자원 반환 및 상태 초기화</td><td>다음 대기자 또는 시스템에 신호 전달</td><td>미실행 시 Deadlock, Starvation 발생 가능</td></tr><tr><td>원자적 연산 / 시스템 콜 (AT)</td><td>진입 시 내부 연산 원자성 확보</td><td>CAS, Test-and-Set, futex 등 하드웨어/OS 기반 지원 필요</td><td>Busy-wait 일 경우 성능 저하 유의</td></tr></tbody></table><h4 id=선택-구성-요소>선택 구성 요소<a hidden class=anchor aria-hidden=true href=#선택-구성-요소>#</a></h4><p>선택 요소들은 시스템 확장성, 공정성, 안정성 확보에 필수적이다. <strong>Waiting Queue</strong>는 스케줄링 기반 공정 접근 보장을, <strong>Priority Manager</strong>는 실시간 시스템과 우선순위 제어에 활용된다. <strong>Timeout Mechanism</strong>과 <strong>Deadlock Detection</strong>은 시스템 안정성 확보를 위한 보호 장치로 필수이며, <strong>Monitor</strong>는 동기화를 추상화하고 코드 품질을 향상시키는 고수준 도구로서 유용하다. 또한, <strong>Distributed Lock</strong>은 MSA 나 클러스터 기반 아키텍처에서 다중 노드 간 상호 배제를 실현하는 데 핵심이 된다.</p><table><thead><tr><th>구성 요소</th><th>기능</th><th>역할</th><th>특성 및 고려사항</th></tr></thead><tbody><tr><td>Waiting Queue</td><td>대기 중인 프로세스를 정렬</td><td>공정성 확보 및 순서 보장</td><td>FIFO 또는 Priority Queue, 락 내부 큐 or 외부 구성 가능</td></tr><tr><td>Priority Manager</td><td>우선순위 기반 접근 제어</td><td>실시간 시스템 등에서 응답 지연 최소화</td><td>Priority Inversion 방지를 위한 Inheritance 또는 Ceiling 필요</td></tr><tr><td>Timeout Mechanism</td><td>일정 시간 대기 시 재시도 또는 실패 처리</td><td>무한 대기 방지 및 시스템 응답성 확보</td><td>타이머/Watchdog 기반 구현, 재시도 전략 필요</td></tr><tr><td>Deadlock Detection</td><td>교착 상태 탐지</td><td>상호 대기 상태 발생 시 복구</td><td>자원 그래프 또는 타임아웃 기반 전략 사용</td></tr><tr><td>공유 자원 (SR)</td><td>임계 구역 내 실제 리소스</td><td>동시 접근 대상인 자원, 파일/메모리/DB 등</td><td>자원의 상태 동기화 필요, Race Condition 에 민감</td></tr></tbody></table><h3 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h3><table><thead><tr><th><strong>카테고리</strong></th><th><strong>구현 기법</strong></th><th><strong>핵심 요소</strong></th><th><strong>주요 특징 및 목적</strong></th><th><strong>대표 예시/적용 환경</strong></th></tr></thead><tbody><tr><td>소프트웨어 기반</td><td>Dekker Algorithm</td><td>flag[], turn</td><td>최초의 순수 소프트웨어 해법, busy-wait 기반</td><td>두 스레드 간 상호 배제 예시</td></tr><tr><td></td><td>Peterson Algorithm</td><td>flag[], turn</td><td>간단하고 직관적, bounded waiting 보장</td><td>학술/이론/간단한 실습 구조</td></tr><tr><td></td><td>Lamport Bakery Algorithm</td><td>choosing[], number[]</td><td>다중 프로세스 지원, 공정성 제공</td><td>공정한 접근이 필요한 다중 프로세스 환경</td></tr><tr><td>하드웨어 기반</td><td>Test-and-Set</td><td>atomic test & write</td><td>busy-wait 기반 원자 연산, 간단한 임계 구역에서 사용</td><td>x86 <code>xchg</code>, spinlock 등 커널 수준 구현</td></tr><tr><td></td><td>Compare-and-Swap</td><td>atomic compare & write</td><td>lock-free 구조 지원, 더 강력한 원자 연산</td><td>Java/C++ 의 <code>CAS</code>, 락 프리 자료구조 등</td></tr><tr><td></td><td>Fetch-and-Add (FA)</td><td>원자적 증가 연산</td><td>순서 보장 있는 진입 가능, 공정성 비교적 낮음</td><td>티켓 락 (Ticket Lock), 스핀락 구현</td></tr><tr><td>운영체제 기반</td><td>Semaphore</td><td>값 (integer counter), wait()/signal()</td><td>자원 수 제한 및 대기 큐 기반 접근 제어</td><td>생산자 - 소비자, 임계 구역 제한 등</td></tr><tr><td></td><td>Mutex</td><td>binary lock, owner</td><td>단일 프로세스/스레드 락 제어</td><td>POSIX <code>pthread_mutex</code>, Windows Mutex 등</td></tr><tr><td></td><td>Monitor</td><td>조건 변수 + 락 + 메서드 캡슐화</td><td>객체 단위로 상호 배제 보장, 고수준 추상화 구조</td><td>Java <code>synchronized</code>, Python <code>monitor</code></td></tr><tr><td>분산 시스템 기반</td><td>Lamport Distributed Mutex</td><td>REQUEST, REPLY, RELEASE 메시지</td><td>논리적 시간 기반, 메시지 수 3(N-1)</td><td>분산 환경에서 선형 정렬 보장 필요 시</td></tr><tr><td></td><td>Ricart–Agrawala</td><td>Permission-based with Logical Clock</td><td>2(N-1) 메시지, 중복 메시지 제거 최적화 구조</td><td>논리 시계 기반 분산 동기화 구조</td></tr><tr><td></td><td>Suzuki–Kasami</td><td>Token Passing (Broadcast)</td><td>유일 토큰 기반, 메시지 효율성 우수</td><td>대규모 분산 환경에서의 간단한 토큰 락</td></tr><tr><td></td><td>Raymond</td><td>Token Tree 기반 (Tree Privilege Structure)</td><td>트리 기반 토큰 전파로 O(log N) 메시지 복잡도</td><td>P2P 네트워크, 트리 구조의 분산 시스템</td></tr><tr><td></td><td>Maekawa Algorithm</td><td>Quorum (부분 노드 집합)</td><td>√N 메시지로 효율적이나 deadlock 가능성 존재</td><td>고정된 Quorum 기반의 분산 상호 배제</td></tr><tr><td>기타 현대 기법</td><td>Spinlock</td><td>busy-wait loop</td><td>임계 구역 짧을 때 효과적, context switch 없음</td><td>커널 락, 멀티코어 시스템</td></tr><tr><td></td><td>Lock-Free Data Structures</td><td>atomic primitive (CAS, FAA 등)</td><td>성능 극대화, 상호 배제 없이 동기화</td><td>병렬 큐, 스택, 비차단 동기화 자료구조 등</td></tr><tr><td></td><td>Distributed Lock Services</td><td>External service (Zookeeper, etcd, Redis)</td><td>분산 환경의 상호 배제를 외부 서비스로 위임</td><td>MSA, Kubernetes, Leader Election 등</td></tr></tbody></table><ol><li><p><strong>소프트웨어 기반</strong>:<br>플래그와 순서를 활용한 논리적 동기화 구조로, 하드웨어 지원 없이 구현 가능하나 <strong>busy-waiting</strong>이 필요하며, 일반적으로 <strong>두 개 또는 N 개 프로세스까지 제한적 적용</strong>됨. 공정성과 bounded waiting 보장에 유리하지만 실제 운영 환경보단 교육/연구용에 적합함.</p></li><li><p><strong>하드웨어 기반</strong>:<br>CPU 가 제공하는 원자적 연산을 이용하여 빠르고 간단하게 상호 배제를 구현. 다만 busy-wait 을 유발할 수 있고, <strong>락 프리 구조</strong>나 성능 최적화에 적합. <code>CAS</code>, <code>Test-and-Set</code>, <code>Fetch-and-Add</code> 등의 원자 연산이 대표적이며, 커널 수준에서 활용됨.</p></li><li><p><strong>운영체제 기반</strong>:<br>OS 가 제공하는 고수준 동기화 도구로, <strong>세마포어/뮤텍스/모니터</strong>가 주를 이룸. context switch 를 수반하며 공정하고 안정적이나, 비교적 무거운 비용이 수반됨. 실제 시스템 설계 시 가장 일반적으로 사용되는 기법들임.</p></li><li><p><strong>분산 시스템 기반</strong>:<br>물리적으로 떨어진 노드 간 동기화가 필요한 경우 사용되며, <strong>메시지 기반</strong> 접근이 일반적. Permission-based, Token-based, Quorum-based 방식으로 나뉘며, <strong>메시지 복잡도/공정성/장애 허용성</strong> 등을 기준으로 선택함. 현실에선 Zookeeper/etcd 와 같은 외부 락 서비스가 보편적으로 사용됨.</p></li><li><p><strong>기타 현대 기법</strong>:<br>락 - 프리 자료구조, 스핀락, 외부 락 서비스 등은 <strong>고성능 요구 또는 분산 환경 최적화</strong>에 적합한 방식으로, 컨텍스트 스위칭을 줄이거나 네트워크 기반 분산 락을 활용해 동기화 오버헤드를 줄임.</p></li></ol><h4 id=소프트웨어-기반-알고리즘>소프트웨어 기반 알고리즘<a hidden class=anchor aria-hidden=true href=#소프트웨어-기반-알고리즘>#</a></h4><h5 id=dekkers-algorithm-두-프로세스-간-상호-배제>Dekker&rsquo;s Algorithm (두 프로세스 간 상호 배제)<a hidden class=anchor aria-hidden=true href=#dekkers-algorithm-두-프로세스-간-상호-배제>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>공유 메모리를 이용해 두 프로세스 간 상호 배제를 보장하는 최초의 소프트웨어 알고리즘</td></tr><tr><td>구성</td><td><code>flag[2]</code>, <code>turn</code> 변수</td></tr><tr><td>목적</td><td>동기화 하드웨어 없이 소프트웨어만으로 상호 배제 보장</td></tr><tr><td>핵심 요소</td><td>번갈아가며 접근 (<code>turn</code>), 상호 동의 (<code>flag</code>)</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=p>[</span><span class=kc>False</span><span class=p>,</span> <span class=kc>False</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>turn</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dekker_critical_section</span><span class=p>(</span><span class=nb>id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>turn</span>
</span></span><span class=line><span class=cl>    <span class=n>other</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=nb>id</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=nb>id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>flag</span><span class=p>[</span><span class=n>other</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>turn</span> <span class=o>!=</span> <span class=nb>id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span><span class=p>[</span><span class=nb>id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=n>turn</span> <span class=o>!=</span> <span class=nb>id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span><span class=p>[</span><span class=nb>id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=c1># 🚩 Critical Section</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Process </span><span class=si>{</span><span class=nb>id</span><span class=si>}</span><span class=s2> in critical section&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 🚩 Exit Section</span>
</span></span><span class=line><span class=cl>    <span class=n>turn</span> <span class=o>=</span> <span class=n>other</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=nb>id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=petersons-algorithm-2-개-프로세스용>Peterson&rsquo;s Algorithm (2 개 프로세스용)<a hidden class=anchor aria-hidden=true href=#petersons-algorithm-2-개-프로세스용>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>Dekker 개선. 동시 접근 방지 + 진입 보장</td></tr><tr><td>구성</td><td><code>flag[2]</code>, <code>turn</code> 변수</td></tr><tr><td>목적</td><td>Mutual Exclusion + Bounded Wait 보장</td></tr><tr><td>핵심 요소</td><td>Busy waiting, 소프트웨어 순수 구현</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=p>[</span><span class=kc>False</span><span class=p>,</span> <span class=kc>False</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>turn</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>peterson</span><span class=p>(</span><span class=nb>id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>other</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=nb>id</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=nb>id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=n>turn</span> <span class=o>=</span> <span class=n>other</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>flag</span><span class=p>[</span><span class=n>other</span><span class=p>]</span> <span class=ow>and</span> <span class=n>turn</span> <span class=o>==</span> <span class=n>other</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Process </span><span class=si>{</span><span class=nb>id</span><span class=si>}</span><span class=s2> in critical section&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=nb>id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=lamports-bakery-algorithm-n-개-프로세스용>Lamport&rsquo;s Bakery Algorithm (N 개 프로세스용)<a hidden class=anchor aria-hidden=true href=#lamports-bakery-algorithm-n-개-프로세스용>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>" 빵집 번호표 " 방식. 공정한 진입 순서 보장</td></tr><tr><td>구성</td><td><code>choosing[]</code>, <code>number[]</code></td></tr><tr><td>목적</td><td>공정성 (FIFO) + Mutual Exclusion</td></tr><tr><td>핵심 요소</td><td>번호표 기반 선점 방지</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>choosing</span> <span class=o>=</span> <span class=p>[</span><span class=kc>False</span><span class=p>]</span> <span class=o>*</span> <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=n>number</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=n>N</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bakery</span><span class=p>(</span><span class=n>i</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>choosing</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=n>number</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>+</span> <span class=nb>max</span><span class=p>(</span><span class=n>number</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>choosing</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>choosing</span><span class=p>[</span><span class=n>j</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>number</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>0</span> <span class=ow>and</span> <span class=p>(</span><span class=n>number</span><span class=p>[</span><span class=n>j</span><span class=p>],</span> <span class=n>j</span><span class=p>)</span> <span class=o>&lt;</span> <span class=p>(</span><span class=n>number</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>i</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Process </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2> in critical section&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>number</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=하드웨어-기반-원자-연산>하드웨어 기반 원자 연산<a hidden class=anchor aria-hidden=true href=#하드웨어-기반-원자-연산>#</a></h4><h5 id=test-and-set-tas>Test-and-Set (TAS)<a hidden class=anchor aria-hidden=true href=#test-and-set-tas>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>단일 연산으로 플래그 확인 및 설정</td></tr><tr><td>구성</td><td>공유 변수 <code>lock</code></td></tr><tr><td>목적</td><td>락 획득 여부를 원자적으로 판단</td></tr><tr><td>핵심 요소</td><td>busy wait, atomicity 보장</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_and_set</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>lock</span>
</span></span><span class=line><span class=cl>    <span class=n>prev</span> <span class=o>=</span> <span class=n>lock</span>
</span></span><span class=line><span class=cl>    <span class=n>lock</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>prev</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>critical_section</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>test_and_set</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;In critical section&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>lock</span> <span class=o>=</span> <span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=compare-and-swap-cas>Compare-and-Swap (CAS)<a hidden class=anchor aria-hidden=true href=#compare-and-swap-cas>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>예상 값과 현재 값 비교 후 일치하면 교체</td></tr><tr><td>구성</td><td>CAS 함수 사용</td></tr><tr><td>목적</td><td>원자적 조건부 갱신</td></tr><tr><td>핵심 요소</td><td>무락 (lock-free) 구조 기반</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>AtomicVariable</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>compare_and_swap</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>expected</span><span class=p>,</span> <span class=n>new_val</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>==</span> <span class=n>expected</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>new_val</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>atomic_lock</span> <span class=o>=</span> <span class=n>AtomicVariable</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>cas_lock</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=ow>not</span> <span class=n>atomic_lock</span><span class=o>.</span><span class=n>compare_and_swap</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;In critical section&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>atomic_lock</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=mi>0</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=fetch-and-add-faa>Fetch-and-Add (FAA)<a hidden class=anchor aria-hidden=true href=#fetch-and-add-faa>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>증가 이전 값을 반환하며 증가</td></tr><tr><td>구성</td><td>FAA 연산 함수</td></tr><tr><td>목적</td><td>순차적 접근 제어</td></tr><tr><td>핵심 요소</td><td>순서 보장된 락 큐</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>threading</span> <span class=kn>import</span> <span class=n>Lock</span>
</span></span><span class=line><span class=cl><span class=n>ticket</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>serving</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fetch_and_add</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>ticket</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>val</span> <span class=o>=</span> <span class=n>ticket</span>
</span></span><span class=line><span class=cl>        <span class=n>ticket</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>val</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>faa_lock</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>serving</span>
</span></span><span class=line><span class=cl>    <span class=n>my_ticket</span> <span class=o>=</span> <span class=n>fetch_and_add</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>serving</span> <span class=o>!=</span> <span class=n>my_ticket</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;In critical section&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>serving</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=운영체제-기반>운영체제 기반<a hidden class=anchor aria-hidden=true href=#운영체제-기반>#</a></h4><h5 id=semaphore>Semaphore<a hidden class=anchor aria-hidden=true href=#semaphore>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>P(), V() 연산을 통한 자원 제어</td></tr><tr><td>구성</td><td>정수형 카운터</td></tr><tr><td>목적</td><td>N 개의 프로세스 제어</td></tr><tr><td>핵심 요소</td><td>Blocking, wake-up 관리</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sem</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>semaphore_section</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sem</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;In critical section&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sem</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=mutex>Mutex<a hidden class=anchor aria-hidden=true href=#mutex>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>상호 배제를 보장하는 OS 객체</td></tr><tr><td>구성</td><td>이진 상태 (Locked/Unlocked)</td></tr><tr><td>목적</td><td>두 스레드 간 상호 배제</td></tr><tr><td>핵심 요소</td><td>atomic lock/unlock</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>mutex</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mutex_section</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>mutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;In critical section&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=monitor>Monitor<a hidden class=anchor aria-hidden=true href=#monitor>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>조건 변수와 락을 포함한 고수준 동기화 객체</td></tr><tr><td>구성</td><td>조건 변수 + 락</td></tr><tr><td>목적</td><td>조건 동기화 구현</td></tr><tr><td>핵심 요소</td><td>wait(), notify()</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>monitor</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Condition</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>monitor_section</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>monitor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;In critical section&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=분산-시스템-기반>분산 시스템 기반<a hidden class=anchor aria-hidden=true href=#분산-시스템-기반>#</a></h4><h5 id=ricart-agrawala-algorithm>Ricart-Agrawala Algorithm<a hidden class=anchor aria-hidden=true href=#ricart-agrawala-algorithm>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>분산 노드 간 논리적 시간 기반 요청/응답</td></tr><tr><td>구성</td><td>Request 메시지, Timestamp, Reply</td></tr><tr><td>목적</td><td>중앙 서버 없이 분산 상호 배제</td></tr><tr><td>핵심 요소</td><td>2(N-1) 메시지 필요</td></tr></tbody></table><blockquote><p>🔽 실제 네트워크 시뮬레이션은 복잡하여 아래는 구조 개요 수준</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 단순 구조 시뮬레이션</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Process</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>id</span><span class=p>,</span> <span class=n>clock</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>=</span> <span class=nb>id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>clock</span> <span class=o>=</span> <span class=n>clock</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>request_queue</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>request</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>clock</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Process </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2> requests at </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>clock</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># send request to other nodes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>receive_reply</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># all replies received</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Process </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2> enters critical section&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=suzuki-kasami-token-algorithm>Suzuki-Kasami Token Algorithm<a hidden class=anchor aria-hidden=true href=#suzuki-kasami-token-algorithm>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>토큰 전달 기반의 분산 상호 배제</td></tr><tr><td>구성</td><td>토큰, 요청 큐</td></tr><tr><td>목적</td><td>메시지 수 최소화</td></tr><tr><td>핵심 요소</td><td>토큰 보유 여부</td></tr></tbody></table><h4 id=현대-기법>현대 기법<a hidden class=anchor aria-hidden=true href=#현대-기법>#</a></h4><h5 id=spinlock>Spinlock<a hidden class=anchor aria-hidden=true href=#spinlock>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>락을 busy waiting 방식으로 획득</td></tr><tr><td>구성</td><td>Flag 변수</td></tr><tr><td>목적</td><td>짧은 락 획득 대기</td></tr><tr><td>핵심 요소</td><td>짧은 경합에서 효율적</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8>8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>spinlock_section</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=ow>not</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>blocking</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;In critical section&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=lock-free-data-structure-queue-예>Lock-Free Data Structure (Queue 예)<a hidden class=anchor aria-hidden=true href=#lock-free-data-structure-queue-예>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>락 없이 원자 연산으로 병렬성 확보</td></tr><tr><td>구성</td><td>CAS 기반 원형 큐</td></tr><tr><td>목적</td><td>고성능, 병렬 접근</td></tr><tr><td>핵심 요소</td><td>Compare-and-Swap 활용</td></tr></tbody></table><blockquote><p>실제 구현은 <code>concurrent.futures</code> 또는 <code>queue</code> 라이브러리 기반</p></blockquote><h5 id=distributed-lock-service-예-redis-zookeeper>Distributed Lock Service (예: Redis, Zookeeper)<a hidden class=anchor aria-hidden=true href=#distributed-lock-service-예-redis-zookeeper>#</a></h5><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>정의</td><td>외부 저장소 기반 분산 락</td></tr><tr><td>구성</td><td>Lease, Lock Key, TTL</td></tr><tr><td>목적</td><td>마이크로서비스 간 락 공유</td></tr><tr><td>핵심 요소</td><td>장애 복구, 만료 설정</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Redis 분산 락 예시 (Redis-py 필요)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>lock_key</span> <span class=o>=</span> <span class=s2>&#34;resource_lock&#34;</span>
</span></span><span class=line><span class=cl><span class=n>lock_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span> <span class=n>lock_id</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ex</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Got distributed lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th></th></tr></thead><tbody><tr><td><strong>1. 데이터 무결성과 일관성</strong></td><td>데이터 무결성 보장</td><td>임계 구역 내 공유 자원 보호로 예측 가능한 상태 유지</td><td></td></tr><tr><td></td><td>데이터 일관성 유지</td><td>동시 쓰기 방지로 트랜잭션 간 일관된 결과 보장</td><td></td></tr><tr><td></td><td>경쟁 상태 방지</td><td>race condition 예방으로 비결정적 오류 방지</td><td></td></tr><tr><td><strong>2. 시스템 안전성 및 신뢰성</strong></td><td>시스템 신뢰성 향상</td><td>자원 접근 오류, 충돌, 중복 실행을 방지하여 신뢰도 증가</td><td></td></tr><tr><td></td><td>프로세스 안전화</td><td>데드락, 기아 상태, 라이브락 등 동시성 문제 예방</td><td></td></tr><tr><td></td><td>오류 전파 최소화</td><td>잘못된 동기화로 인한 시스템 전체 오작동 방지</td><td></td></tr><tr><td><strong>3. 성능 및 효율성</strong></td><td>공정성 확보</td><td>bounded waiting 기반 구조 (Peterson, Bakery 등) 으로 starvation 방지</td><td></td></tr><tr><td></td><td>메시지 오버헤드 감소</td><td>token 기반 또는 quorum 기반 알고리즘은 메시지 수가 적어 효율적임</td><td></td></tr><tr><td></td><td>하드웨어 가속 지원</td><td>test-and-set, CAS 등 atomic 연산으로 빠른 임계 구역 진입 가능</td><td></td></tr><tr><td><strong>4. 구조적 유연성</strong></td><td>다양한 구현 방식 지원</td><td>소프트웨어, 하드웨어, 운영체제, 분산 환경 등 다양한 구조에 상호배제 적용 가능</td><td></td></tr><tr><td></td><td>이식성과 확장성</td><td>언어, 플랫폼, 환경에 무관하게 일관된 상호배제 원리 사용 가능</td><td></td></tr><tr><td></td><td>운영 유연성</td><td>busy-wait, blocking, async 등 운영 방식 선택 가능</td><td></td></tr></tbody></table><ol><li><p><strong>데이터 무결성과 일관성</strong><br>상호 배제의 가장 기본적이고 핵심적인 장점은 공유 자원의 동시 접근을 제어함으로써 <strong>데이터 무결성과 일관성을 확보</strong>하는 것이다. race condition 이나 inconsistent state 와 같은 오류가 방지되어 전체 시스템의 안정성이 확보된다.</p></li><li><p><strong>시스템 안전성 및 신뢰성</strong><br>상호 배제는 무한 대기, 데드락, 라이브락 등 복잡한 동시성 오류의 근본 원인을 차단하고, 시스템 전반의 <strong>결함 허용성과 신뢰성</strong>을 향상시킨다. 특히 임계 구역 진입이 잘 관리되면 전체 실행 흐름의 예측 가능성이 높아진다.</p></li><li><p><strong>성능 및 효율성</strong><br>구조에 따라 공정성 (Fairness) 을 보장하고, 메시지 수를 줄이며, 하드웨어 지원을 통해 동기화 속도를 높이는 것이 가능하다. 특히 락 경합이 심한 환경에서는 token 기반, CAS 기반 구조가 성능 면에서 유리하다.</p></li><li><p><strong>구조적 유연성</strong><br>상호 배제는 이론적으로나 실무적으로 매우 유연하게 설계할 수 있다. 운영체제 수준의 락부터, 하드웨어 기반 atomic 연산, 또는 분산 환경에서의 quorum/lease 기반까지 다양한 방식이 존재하며, <strong>플랫폼과 언어에 무관하게 이식성이 높다.</strong></p></li></ol><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점과-해결-방안>단점과 해결 방안<a hidden class=anchor aria-hidden=true href=#단점과-해결-방안>#</a></h4><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>해결 방안</th></tr></thead><tbody><tr><td>성능 오버헤드</td><td>Busy Waiting</td><td>Spinlock 사용 시 CPU 자원을 지속적으로 소모함</td><td>Sleep/Wake 방식 도입, Blocking Lock 사용</td></tr><tr><td>성능 오버헤드</td><td>락 획득/해제 비용</td><td>락 처리 자체가 context switch, 커널 호출 등으로 오버헤드 발생</td><td>임계 구역 최소화, 락 프리/Wait-Free 자료구조 사용</td></tr><tr><td>확장성 제한</td><td>다중 프로세스/노드 환경</td><td>락이 병목이 되어 병렬 처리 및 클러스터 확장에 제한 발생</td><td>분산 락 관리자 (Zookeeper, Redis 등) 활용, 락 세분화</td></tr><tr><td>복잡성 증가</td><td>동기화 코드 구조</td><td>락 사용으로 인해 코드가 얽히고 버그 유발 가능성 증가</td><td>고수준 동기화 추상화 (Lock 객체, Future, STM 등) 사용, 디자인 패턴 활용</td></tr><tr><td>네트워크 의존</td><td>메시지 기반 락 지연</td><td>분산 환경에서 네트워크 지연·오류 시 시스템 반응 시간 증가</td><td>Reliable Channel, 타임아웃/재시도 메커니즘 적용</td></tr></tbody></table><p>Mutual Exclusion 은 시스템의 동기화를 보장하지만 성능과 유지보수성 측면에서 다음과 같은 단점이 존재한다. <strong>Busy-wait 로 인한 CPU 낭비, 임계구역 범위 설정의 비효율성, 락으로 인한 병목 및 확장성 저하</strong>가 주된 문제다. 분산 환경에서는 <strong>메시지 지연, 네트워크 실패 시 처리 지연</strong>도 고려해야 한다. 이를 해결하기 위해선 <strong>락 최소화</strong>, <strong>락 프리 구조</strong>, <strong>고수준 추상화</strong>, <strong>분산 락 프레임워크</strong> 등의 전략이 필요하다.</p><h5 id=busy-waiting>Busy Waiting<a hidden class=anchor aria-hidden=true href=#busy-waiting>#</a></h5><p>CPU 를 낭비하며 루프에서 락을 기다리는 방식으로, 리소스 효율이 낮고 시스템 전체 처리량 저하 발생.</p><p><strong>코드 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>busy_wait_lock</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=ow>not</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=kc>False</span><span class=p>):</span>  <span class=c1># Non-blocking</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>  <span class=c1># Busy spin (비효율적)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Acquired lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>시각화 흐름도</strong>:</p><pre class=mermaid>sequenceDiagram
    participant Thread
    participant Lock

    loop 반복
        Thread-&gt;&gt;Lock: Try Acquire (non-blocking)
        Lock--&gt;&gt;Thread: Denied
    end
    Note over Thread: Busy waiting 반복
</pre><p><strong>장애 시나리오 기반 복구 설계</strong>:</p><ul><li>일정 횟수 이상 busy loop 시 sleep 삽입</li><li>spinlock → blocking lock 전환</li></ul><p><strong>복구 구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3>3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=ow>not</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.001</span><span class=p>)</span>  <span class=c1># Yield CPU</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>테스트 케이스</strong>:</p><table><thead><tr><th>조건</th><th>기대 결과</th></tr></thead><tbody><tr><td>두 스레드가 동시에 락 요청</td><td>하나는 busy loop 반복, CPU 과다 점유</td></tr></tbody></table><p><strong>로그 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1>1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[Thread-A] Spinning on lock for 53ms
</span></span><span class=line><span class=cl>[LockOptimizer] Recommend switching to blocking lock
</span></span></code></pre></td></tr></table></div></div><p><strong>장애 감지 모듈</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>spin_duration</span> <span class=o>&gt;</span> <span class=mi>50</span><span class=p>:</span>  <span class=c1># ms</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&#34;Busy waiting too long&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=성능-오버헤드>성능 오버헤드<a hidden class=anchor aria-hidden=true href=#성능-오버헤드>#</a></h5><p>락 획득/해제 자체의 비용 (context switching, syscall 등) 으로 TPS 감소.</p><p><strong>코드 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2>2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3>3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>heavy_lock_work</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shared_counter</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>시각화 흐름도</strong>:</p><pre class=mermaid>flowchart TD
    A[Thread] --&gt;|Acquire Lock| L[Lock]
    L --&gt;|Critical Section| C[Computation]
    C --&gt;|Release Lock| L
</pre><p><strong>복구 설계</strong>:</p><ul><li>임계 구역 분리, 락 최소화</li><li>CAS 또는 atomic 변수 사용</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1>1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2>2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3>3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>multiprocessing</span> <span class=kn>import</span> <span class=n>Value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>counter</span><span class=o>.</span><span class=n>get_lock</span><span class=p>():</span>  <span class=c1># 내부적으로 atomic</span>
</span></span><span class=line><span class=cl>    <span class=n>counter</span><span class=o>.</span><span class=n>value</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>테스트 케이스</strong>:</p><table><thead><tr><th>조건</th><th>기대 결과</th></tr></thead><tbody><tr><td>수천 회 lock 호출</td><td>성능 저하 비율 측정 가능 (락 없는 버전 대비)</td></tr></tbody></table><p><strong>로그 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1>1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[PerfMonitor] Lock-acquire overhead: 5.8µs avg
</span></span><span class=line><span class=cl>[PerfAlert] Lock contention increasing (QPS degradation 30%)
</span></span></code></pre></td></tr></table></div></div><p><strong>감지 모듈</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1>1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>avg_lock_time</span> <span class=o>&gt;</span> <span class=n>THRESHOLD</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>alert</span><span class=p>(</span><span class=s2>&#34;락 오버헤드 감지&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=복잡성-증가>복잡성 증가<a hidden class=anchor aria-hidden=true href=#복잡성-증가>#</a></h5><p>락이 많아질수록 코드 가독성 저하, 순환 락 구조 발생 가능성 증가.</p><p><strong>코드 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1>1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2>2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3>3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4>4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>update_state</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>lock1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>do_work</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>do_other_work</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>시각화 흐름도</strong>:</p><pre class=mermaid>graph TD
    A[Function A] --&gt; B[Lock1]
    B --&gt; C[Function B]
    C --&gt; D[Lock2]
</pre><p><strong>복구 설계</strong>:</p><ul><li>고수준 동기화 객체 도입 (예: queue, pool)</li><li>디자인 패턴 적용 (ex. Command, State)</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1>1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>queue</span> <span class=kn>import</span> <span class=n>Queue</span>
</span></span><span class=line><span class=cl><span class=c1># Queue로 상태 전환을 비동기 처리</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>테스트 케이스</strong>:</p><table><thead><tr><th>조건</th><th>기대 결과</th></tr></thead><tbody><tr><td>코드 복잡도 증가, 테스트 코드 작성</td><td>단위 테스트 실패율 증가</td></tr></tbody></table><p><strong>로그 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1>1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[LockGraph] Nested locks: 3 levels
</span></span><span class=line><span class=cl>[ComplexityWarning] Potential circular dependency
</span></span></code></pre></td></tr></table></div></div><p><strong>감지 모듈</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1>1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2>2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>detect_lock_nesting</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>depth</span> <span class=o>&gt;</span> <span class=n>MAX_ALLOWED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>alert</span><span class=p>(</span><span class=s2>&#34;락 중첩 과도함&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=확장성-제한>확장성 제한<a hidden class=anchor aria-hidden=true href=#확장성-제한>#</a></h5><p>단일 락 또는 전역 상태 공유로 인해 멀티 스레드 환경의 <strong>스케일링 저하</strong>.</p><p><strong>코드 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1>1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2>2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3>3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4>4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5>5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6>6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>shared_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>increment</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>shared_count</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shared_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>시각화 흐름도</strong>:</p><pre class=mermaid>graph LR
    Thread1 --&gt; L
    Thread2 --&gt; L
    Thread3 --&gt; L
    L --&gt; CriticalSection
</pre><p><strong>복구 설계</strong>:</p><ul><li>락 세분화 또는 샤딩</li><li>쓰기/읽기 분리 (RWLock 등)</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>threading</span> <span class=kn>import</span> <span class=n>RLock</span>  <span class=c1># 또는 read/write lock 구현체</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>테스트 케이스</strong>:</p><table><thead><tr><th>조건</th><th>기대 결과</th></tr></thead><tbody><tr><td>3~4 스레드 이상의 동시에 락 접근</td><td>처리량 급감, 스케일 불능</td></tr></tbody></table><p><strong>로그 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1>1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ScalabilityAlert] Lock contention: 92%
</span></span><span class=line><span class=cl>[Recommendation] Apply lock partitioning strategy
</span></span></code></pre></td></tr></table></div></div><p><strong>감지 모듈</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1>1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>thread_waits</span> <span class=o>/</span> <span class=n>total_threads</span> <span class=o>&gt;</span> <span class=mf>0.8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&#34;스레드 경합 과다&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=네트워크-지연-분산-락>네트워크 지연 (분산 락)<a hidden class=anchor aria-hidden=true href=#네트워크-지연-분산-락>#</a></h5><p>Redis, ZooKeeper 등 외부 락 관리자와의 통신 지연으로 <strong>전체 응답 지연</strong> 발생.</p><p><strong>코드 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1>1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Redis 락 요청이 늦어지는 경우</span>
</span></span><span class=line><span class=cl><span class=n>lock_acquired</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;lock&#34;</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ex</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>시각화 흐름도</strong>:</p><pre class=mermaid>sequenceDiagram
    participant App
    participant Redis

    App-&gt;&gt;Redis: SETNX
    Redis--&gt;&gt;App: Delay…
    App--&gt;&gt;User: Request timeout
</pre><p><strong>복구 설계</strong>:</p><ul><li>타임아웃, 재시도, fallback</li><li>local-fallback 또는 async 처리 도입</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1>1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=ow>not</span> <span class=n>redis</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=o>...</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>fallback_local_queue</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>task</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>테스트 케이스</strong>:</p><table><thead><tr><th>조건</th><th>기대 결과</th></tr></thead><tbody><tr><td>Redis latency 100ms 이상</td><td>전체 응답 시간 증가, 타임아웃 발생</td></tr></tbody></table><p><strong>로그 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1>1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[LockTimeout] Redis lock request exceeded 200ms
</span></span><span class=line><span class=cl>[Failover] fallback to local queue
</span></span></code></pre></td></tr></table></div></div><p><strong>감지 모듈</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-45-1><a class=lnlinks href=#hl-45-1>1</a>
</span><span class=lnt id=hl-45-2><a class=lnlinks href=#hl-45-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>redis_latency</span> <span class=o>&gt;</span> <span class=mi>150</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&#34;분산 락 응답 지연&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=문제점과-해결-방안>문제점과 해결 방안<a hidden class=anchor aria-hidden=true href=#문제점과-해결-방안>#</a></h4><table><thead><tr><th>카테고리</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>동기화 충돌</td><td>경쟁 조건 (Race)</td><td>두 스레드가 동일 자원을 동시 접근하면서 발생</td><td>데이터 불일치, 비정상 동작</td><td>Race Detector, 코드 리뷰</td><td>적절한 락 사용, CAS 등 원자적 연산 사용</td><td>상호 배제 메커니즘 적용</td></tr><tr><td>교착 상태</td><td>Deadlock</td><td>순환 대기, 자원 점유 후 다른 자원 요청</td><td>전체 시스템 또는 스레드 정지</td><td>로그, 대기 그래프, 모니터링 도구 사용</td><td>락 순서화, 타임아웃, 자원 요청 단순화</td><td>타임아웃 기법, Deadlock Detection, 회피 알고리즘</td></tr><tr><td>기아 상태</td><td>Starvation</td><td>우선순위 역전 또는 락 재시도 실패로 낮은 우선순위 프로세스 무한 대기</td><td>특정 작업이 영원히 실행되지 않음</td><td>대기 시간 추적, 응답 시간 모니터링</td><td>Bounded Waiting, Aging, 공정한 스케줄링 적용</td><td>Priority Inheritance, Fair Lock 적용</td></tr><tr><td>우선순위 역전</td><td>Priority Inversion</td><td>낮은 우선순위 스레드가 락을 점유하여 높은 우선순위 스레드가 대기</td><td>실시간 시스템에서 예측 불가한 지연 발생</td><td>Trace 분석, 실시간 스케줄러 분석</td><td>Priority Ceiling, Inheritance Protocol 적용</td><td>Real-Time Mutex, Priority-Aware 락 적용</td></tr><tr><td>시스템 실패</td><td>Crash during Lock</td><td>임계 구역 수행 도중 프로세스가 다운되어 락 해제되지 않음</td><td>자원 고립, 시스템 중단</td><td>Health Check, Failure Event Log</td><td>Timeout, Watchdog Thread</td><td>Recoverable Mutual Exclusion, Fencing Token, 외부 장애 복구 로직</td></tr><tr><td>지속 상태 변경</td><td>Livelock</td><td>충돌 회피 로직이 무한 반복되며 상태 전이만 반복됨</td><td>CPU 낭비, 진전 없음</td><td>상태 전이 모니터링, 경합 로그 분석</td><td>백오프 전략, 재시도 제한</td><td>랜덤 지연, 지수 백오프 (Exponential Backoff), 상태 변화 조건 적용</td></tr></tbody></table><p>Mutual Exclusion 은 잘못된 사용 또는 설계 시 여러 <strong>실행 상의 문제</strong>를 유발한다. 대표적으로는 <strong>Deadlock, Starvation, Livelock, Priority Inversion, Race Condition</strong> 등이 있으며, 이는 시스템 정지, 데이터 불일치, 성능 저하 등의 심각한 결과를 초래할 수 있다. 이러한 문제를 방지하려면 <strong>사전 예방 구조 설계</strong>, <strong>락 순서 정의</strong>, <strong>타임아웃 및 우선순위 정책 적용</strong>, <strong>정기적인 락 상태 진단 도구 사용</strong>이 필요하며, 장애 복구를 위한 <strong>Recoverable Lock 설계와 백오프 전략</strong>도 함께 병행되어야 한다.<br>좋아. 아래는 Mutual Exclusion 에서 자주 발생하는 대표적인 문제점 5 가지에 대해 다음 요소들을 포함해 심화 정리한 자료야:</p><h5 id=deadlock-교착-상태>Deadlock (교착 상태)<a hidden class=anchor aria-hidden=true href=#deadlock-교착-상태>#</a></h5><p>두 개 이상의 스레드가 서로가 소유한 락을 기다리며 <strong>무한 대기</strong> 상태에 빠짐.</p><p><strong>코드 예시</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-46-1><a class=lnlinks href=#hl-46-1> 1</a>
</span><span class=lnt id=hl-46-2><a class=lnlinks href=#hl-46-2> 2</a>
</span><span class=lnt id=hl-46-3><a class=lnlinks href=#hl-46-3> 3</a>
</span><span class=lnt id=hl-46-4><a class=lnlinks href=#hl-46-4> 4</a>
</span><span class=lnt id=hl-46-5><a class=lnlinks href=#hl-46-5> 5</a>
</span><span class=lnt id=hl-46-6><a class=lnlinks href=#hl-46-6> 6</a>
</span><span class=lnt id=hl-46-7><a class=lnlinks href=#hl-46-7> 7</a>
</span><span class=lnt id=hl-46-8><a class=lnlinks href=#hl-46-8> 8</a>
</span><span class=lnt id=hl-46-9><a class=lnlinks href=#hl-46-9> 9</a>
</span><span class=lnt id=hl-46-10><a class=lnlinks href=#hl-46-10>10</a>
</span><span class=lnt id=hl-46-11><a class=lnlinks href=#hl-46-11>11</a>
</span><span class=lnt id=hl-46-12><a class=lnlinks href=#hl-46-12>12</a>
</span><span class=lnt id=hl-46-13><a class=lnlinks href=#hl-46-13>13</a>
</span><span class=lnt id=hl-46-14><a class=lnlinks href=#hl-46-14>14</a>
</span><span class=lnt id=hl-46-15><a class=lnlinks href=#hl-46-15>15</a>
</span><span class=lnt id=hl-46-16><a class=lnlinks href=#hl-46-16>16</a>
</span><span class=lnt id=hl-46-17><a class=lnlinks href=#hl-46-17>17</a>
</span><span class=lnt id=hl-46-18><a class=lnlinks href=#hl-46-18>18</a>
</span><span class=lnt id=hl-46-19><a class=lnlinks href=#hl-46-19>19</a>
</span><span class=lnt id=hl-46-20><a class=lnlinks href=#hl-46-20>20</a>
</span><span class=lnt id=hl-46-21><a class=lnlinks href=#hl-46-21>21</a>
</span><span class=lnt id=hl-46-22><a class=lnlinks href=#hl-46-22>22</a>
</span><span class=lnt id=hl-46-23><a class=lnlinks href=#hl-46-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>lock2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>thread_a</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>lock1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Thread A acquired lock1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>threading</span><span class=o>.</span><span class=n>Event</span><span class=p>()</span><span class=o>.</span><span class=n>wait</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Thread A acquired lock2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>thread_b</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>lock2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Thread B acquired lock2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>threading</span><span class=o>.</span><span class=n>Event</span><span class=p>()</span><span class=o>.</span><span class=n>wait</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Thread B acquired lock1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>thread_a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>thread_b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>b</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>시각화 흐름도</strong></p><pre class=mermaid>sequenceDiagram
    participant A as Thread A
    participant B as Thread B
    participant L1 as Lock1
    participant L2 as Lock2

    A-&gt;&gt;L1: Acquire Lock1
    B-&gt;&gt;L2: Acquire Lock2
    A-&gt;&gt;L2: Wait Lock2 (held by B)
    B-&gt;&gt;L1: Wait Lock1 (held by A)
    Note over A,B: Deadlock 발생
</pre><p><strong>장애 시나리오 기반 복구 설계</strong>:</p><ul><li>Deadlock 감지 로직 주기적 실행</li><li>timeout 설정 후 강제 unlock 또는 watchdog thread 이용</li><li>락 획득 순서 정형화</li></ul><p><strong>복구 설계 구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-48-1><a class=lnlinks href=#hl-48-1> 1</a>
</span><span class=lnt id=hl-48-2><a class=lnlinks href=#hl-48-2> 2</a>
</span><span class=lnt id=hl-48-3><a class=lnlinks href=#hl-48-3> 3</a>
</span><span class=lnt id=hl-48-4><a class=lnlinks href=#hl-48-4> 4</a>
</span><span class=lnt id=hl-48-5><a class=lnlinks href=#hl-48-5> 5</a>
</span><span class=lnt id=hl-48-6><a class=lnlinks href=#hl-48-6> 6</a>
</span><span class=lnt id=hl-48-7><a class=lnlinks href=#hl-48-7> 7</a>
</span><span class=lnt id=hl-48-8><a class=lnlinks href=#hl-48-8> 8</a>
</span><span class=lnt id=hl-48-9><a class=lnlinks href=#hl-48-9> 9</a>
</span><span class=lnt id=hl-48-10><a class=lnlinks href=#hl-48-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>acquired1</span> <span class=o>=</span> <span class=n>lock1</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>acquired2</span> <span class=o>=</span> <span class=n>lock2</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>acquired1</span> <span class=ow>and</span> <span class=n>acquired2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Work done.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>acquired1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>lock1</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>acquired2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>lock2</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>테스트 케이스 설계</strong>:</p><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>시나리오</td><td>두 스레드가 교차 락 획득 (A: lock1→lock2, B: lock2→lock1)</td></tr><tr><td>조건</td><td>락 획득 순서를 의도적으로 다르게 설정</td></tr><tr><td>기대 결과</td><td>두 스레드가 서로 대기하며 진행되지 않음 (Deadlock 발생)</td></tr><tr><td>검증 포인트</td><td>특정 시간 이상 응답 없음, stacktrace 에서 락 대기 상태 확인 가능</td></tr></tbody></table><p><strong>로그 패턴 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1>1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2>2</a>
</span><span class=lnt id=hl-49-3><a class=lnlinks href=#hl-49-3>3</a>
</span><span class=lnt id=hl-49-4><a class=lnlinks href=#hl-49-4>4</a>
</span><span class=lnt id=hl-49-5><a class=lnlinks href=#hl-49-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[Thread-A] Acquired lock1
</span></span><span class=line><span class=cl>[Thread-B] Acquired lock2
</span></span><span class=line><span class=cl>[Thread-A] Waiting for lock2…
</span></span><span class=line><span class=cl>[Thread-B] Waiting for lock1…
</span></span><span class=line><span class=cl>[DeadlockDetector] Potential deadlock detected between Thread-A &lt;-&gt; Thread-B
</span></span></code></pre></td></tr></table></div></div><p><strong>장애 감지 모듈 설계</strong>:</p><ul><li>주기적으로 락 대기 그래프 (Wait-for Graph) 를 수집</li><li>특정 임계 시간 이상 대기 상태인 스레드 탐지</li><li>대기 순환 (사이클) 탐지 시 경고 또는 recovery trigger</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-50-1><a class=lnlinks href=#hl-50-1>1</a>
</span><span class=lnt id=hl-50-2><a class=lnlinks href=#hl-50-2>2</a>
</span><span class=lnt id=hl-50-3><a class=lnlinks href=#hl-50-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>DeadlockDetector</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>detect</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>wait_graph</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>has_cycle</span><span class=p>(</span><span class=n>wait_graph</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=starvation-기아-상태>Starvation (기아 상태)<a hidden class=anchor aria-hidden=true href=#starvation-기아-상태>#</a></h5><p>우선순위 높은 작업 또는 반복된 경합으로 인해 특정 스레드가 <strong>계속 락을 획득하지 못함</strong>.</p><p><strong>코드 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-51-1><a class=lnlinks href=#hl-51-1> 1</a>
</span><span class=lnt id=hl-51-2><a class=lnlinks href=#hl-51-2> 2</a>
</span><span class=lnt id=hl-51-3><a class=lnlinks href=#hl-51-3> 3</a>
</span><span class=lnt id=hl-51-4><a class=lnlinks href=#hl-51-4> 4</a>
</span><span class=lnt id=hl-51-5><a class=lnlinks href=#hl-51-5> 5</a>
</span><span class=lnt id=hl-51-6><a class=lnlinks href=#hl-51-6> 6</a>
</span><span class=lnt id=hl-51-7><a class=lnlinks href=#hl-51-7> 7</a>
</span><span class=lnt id=hl-51-8><a class=lnlinks href=#hl-51-8> 8</a>
</span><span class=lnt id=hl-51-9><a class=lnlinks href=#hl-51-9> 9</a>
</span><span class=lnt id=hl-51-10><a class=lnlinks href=#hl-51-10>10</a>
</span><span class=lnt id=hl-51-11><a class=lnlinks href=#hl-51-11>11</a>
</span><span class=lnt id=hl-51-12><a class=lnlinks href=#hl-51-12>12</a>
</span><span class=lnt id=hl-51-13><a class=lnlinks href=#hl-51-13>13</a>
</span><span class=lnt id=hl-51-14><a class=lnlinks href=#hl-51-14>14</a>
</span><span class=lnt id=hl-51-15><a class=lnlinks href=#hl-51-15>15</a>
</span><span class=lnt id=hl-51-16><a class=lnlinks href=#hl-51-16>16</a>
</span><span class=lnt id=hl-51-17><a class=lnlinks href=#hl-51-17>17</a>
</span><span class=lnt id=hl-51-18><a class=lnlinks href=#hl-51-18>18</a>
</span><span class=lnt id=hl-51-19><a class=lnlinks href=#hl-51-19>19</a>
</span><span class=lnt id=hl-51-20><a class=lnlinks href=#hl-51-20>20</a>
</span><span class=lnt id=hl-51-21><a class=lnlinks href=#hl-51-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>high_priority</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;High priority task running&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>low_priority</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>0.01</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Low priority task got chance!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Low priority starving…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>high_priority</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>low_priority</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>시각화 흐름도</strong></p><pre class=mermaid>sequenceDiagram
    participant H as High Priority
    participant L as Low Priority
    participant Lock

    loop 반복 요청
        H-&gt;&gt;Lock: Acquire
        Lock--&gt;&gt;H: Granted
        L-&gt;&gt;Lock: Try Acquire
        Lock--&gt;&gt;L: Denied
    end
    Note over L: Low priority task starving
</pre><p><strong>장애 시나리오 기반 복구 설계</strong>:</p><ul><li>Bounded waiting 보장 알고리즘 적용</li><li>Lock queue 또는 FIFO 구조 도입</li></ul><p><strong>복구 설계 구현 예시</strong>:</p><ul><li>공정한 락 큐</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-53-1><a class=lnlinks href=#hl-53-1> 1</a>
</span><span class=lnt id=hl-53-2><a class=lnlinks href=#hl-53-2> 2</a>
</span><span class=lnt id=hl-53-3><a class=lnlinks href=#hl-53-3> 3</a>
</span><span class=lnt id=hl-53-4><a class=lnlinks href=#hl-53-4> 4</a>
</span><span class=lnt id=hl-53-5><a class=lnlinks href=#hl-53-5> 5</a>
</span><span class=lnt id=hl-53-6><a class=lnlinks href=#hl-53-6> 6</a>
</span><span class=lnt id=hl-53-7><a class=lnlinks href=#hl-53-7> 7</a>
</span><span class=lnt id=hl-53-8><a class=lnlinks href=#hl-53-8> 8</a>
</span><span class=lnt id=hl-53-9><a class=lnlinks href=#hl-53-9> 9</a>
</span><span class=lnt id=hl-53-10><a class=lnlinks href=#hl-53-10>10</a>
</span><span class=lnt id=hl-53-11><a class=lnlinks href=#hl-53-11>11</a>
</span><span class=lnt id=hl-53-12><a class=lnlinks href=#hl-53-12>12</a>
</span><span class=lnt id=hl-53-13><a class=lnlinks href=#hl-53-13>13</a>
</span><span class=lnt id=hl-53-14><a class=lnlinks href=#hl-53-14>14</a>
</span><span class=lnt id=hl-53-15><a class=lnlinks href=#hl-53-15>15</a>
</span><span class=lnt id=hl-53-16><a class=lnlinks href=#hl-53-16>16</a>
</span><span class=lnt id=hl-53-17><a class=lnlinks href=#hl-53-17>17</a>
</span><span class=lnt id=hl-53-18><a class=lnlinks href=#hl-53-18>18</a>
</span><span class=lnt id=hl-53-19><a class=lnlinks href=#hl-53-19>19</a>
</span><span class=lnt id=hl-53-20><a class=lnlinks href=#hl-53-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>threading</span> <span class=kn>import</span> <span class=n>Lock</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>queue</span> <span class=kn>import</span> <span class=n>Queue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>FairLock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queue</span> <span class=o>=</span> <span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>internal_lock</span> <span class=o>=</span> <span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>entry</span> <span class=o>=</span> <span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>entry</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>qsize</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>entry</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>entry</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>empty</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>queue</span><span class=o>.</span><span class=n>queue</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>테스트 케이스 설계</strong>:</p><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>시나리오</td><td>하나의 락에 대해 높은 우선순위 스레드가 지속적으로 점유</td></tr><tr><td>조건</td><td>낮은 우선순위 스레드가 lock 획득 재시도</td></tr><tr><td>기대 결과</td><td>낮은 우선순위 스레드의 작업이 지속적으로 실패</td></tr><tr><td>검증 포인트</td><td>재시도 로그의 비정상적 누적, 처리량 불균형 감지</td></tr></tbody></table><p><strong>로그 패턴 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-54-1><a class=lnlinks href=#hl-54-1>1</a>
</span><span class=lnt id=hl-54-2><a class=lnlinks href=#hl-54-2>2</a>
</span><span class=lnt id=hl-54-3><a class=lnlinks href=#hl-54-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[LowPriorityTask] Lock attempt failed (retry #17)
</span></span><span class=line><span class=cl>[LowPriorityTask] Lock attempt failed (retry #18)
</span></span><span class=line><span class=cl>[StarvationDetector] Task has not progressed in 2.5s, possible starvation
</span></span></code></pre></td></tr></table></div></div><p><strong>장애 감지 모듈 설계</strong>:</p><ul><li>특정 태스크/스레드의 처리 latency, retry 횟수, queue backlog 분석</li><li>일정 임계값 초과 시 alert 발생</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-55-1><a class=lnlinks href=#hl-55-1>1</a>
</span><span class=lnt id=hl-55-2><a class=lnlinks href=#hl-55-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>retry_count</span> <span class=o>&gt;</span> <span class=n>THRESHOLD</span> <span class=ow>and</span> <span class=n>latency</span> <span class=o>&gt;</span> <span class=n>MAX_WAIT</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Starvation suspected on thread </span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=livelock-라이브락>Livelock (라이브락)<a hidden class=anchor aria-hidden=true href=#livelock-라이브락>#</a></h5><p>서로 양보하려는 로직이 <strong>진전을 만들지 못하고 계속 상태 전이만 반복</strong>함.</p><p><strong>코드 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-56-1><a class=lnlinks href=#hl-56-1> 1</a>
</span><span class=lnt id=hl-56-2><a class=lnlinks href=#hl-56-2> 2</a>
</span><span class=lnt id=hl-56-3><a class=lnlinks href=#hl-56-3> 3</a>
</span><span class=lnt id=hl-56-4><a class=lnlinks href=#hl-56-4> 4</a>
</span><span class=lnt id=hl-56-5><a class=lnlinks href=#hl-56-5> 5</a>
</span><span class=lnt id=hl-56-6><a class=lnlinks href=#hl-56-6> 6</a>
</span><span class=lnt id=hl-56-7><a class=lnlinks href=#hl-56-7> 7</a>
</span><span class=lnt id=hl-56-8><a class=lnlinks href=#hl-56-8> 8</a>
</span><span class=lnt id=hl-56-9><a class=lnlinks href=#hl-56-9> 9</a>
</span><span class=lnt id=hl-56-10><a class=lnlinks href=#hl-56-10>10</a>
</span><span class=lnt id=hl-56-11><a class=lnlinks href=#hl-56-11>11</a>
</span><span class=lnt id=hl-56-12><a class=lnlinks href=#hl-56-12>12</a>
</span><span class=lnt id=hl-56-13><a class=lnlinks href=#hl-56-13>13</a>
</span><span class=lnt id=hl-56-14><a class=lnlinks href=#hl-56-14>14</a>
</span><span class=lnt id=hl-56-15><a class=lnlinks href=#hl-56-15>15</a>
</span><span class=lnt id=hl-56-16><a class=lnlinks href=#hl-56-16>16</a>
</span><span class=lnt id=hl-56-17><a class=lnlinks href=#hl-56-17>17</a>
</span><span class=lnt id=hl-56-18><a class=lnlinks href=#hl-56-18>18</a>
</span><span class=lnt id=hl-56-19><a class=lnlinks href=#hl-56-19>19</a>
</span><span class=lnt id=hl-56-20><a class=lnlinks href=#hl-56-20>20</a>
</span><span class=lnt id=hl-56-21><a class=lnlinks href=#hl-56-21>21</a>
</span><span class=lnt id=hl-56-22><a class=lnlinks href=#hl-56-22>22</a>
</span><span class=lnt id=hl-56-23><a class=lnlinks href=#hl-56-23>23</a>
</span><span class=lnt id=hl-56-24><a class=lnlinks href=#hl-56-24>24</a>
</span><span class=lnt id=hl-56-25><a class=lnlinks href=#hl-56-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag1</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>flag2</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>thread1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>flag1</span><span class=p>,</span> <span class=n>flag2</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>flag2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>flag1</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Thread1 working&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>thread2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>flag1</span><span class=p>,</span> <span class=n>flag2</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>flag1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>flag2</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Thread2 working&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>thread1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>t2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>thread2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>t1</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>t2</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>시각화 흐름도</strong>:</p><pre class=mermaid>sequenceDiagram
    participant T1 as Thread 1
    participant T2 as Thread 2

    loop 양보 반복
        T1-&gt;&gt;T2: Are you done?
        T2-&gt;&gt;T1: Not yet, you go
        T1-&gt;&gt;T2: No you go
    end
    Note over T1,T2: 계속 반복됨 (Livelock)
</pre><p><strong>장애 시나리오 기반 복구 설계</strong>:</p><ul><li>백오프 전략 (Random delay)</li><li>Retry 횟수 제한 후 fallback 처리</li></ul><p><strong>복구 설계 구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-58-1><a class=lnlinks href=#hl-58-1>1</a>
</span><span class=lnt id=hl-58-2><a class=lnlinks href=#hl-58-2>2</a>
</span><span class=lnt id=hl-58-3><a class=lnlinks href=#hl-58-3>3</a>
</span><span class=lnt id=hl-58-4><a class=lnlinks href=#hl-58-4>4</a>
</span><span class=lnt id=hl-58-5><a class=lnlinks href=#hl-58-5>5</a>
</span><span class=lnt id=hl-58-6><a class=lnlinks href=#hl-58-6>6</a>
</span><span class=lnt id=hl-58-7><a class=lnlinks href=#hl-58-7>7</a>
</span><span class=lnt id=hl-58-8><a class=lnlinks href=#hl-58-8>8</a>
</span><span class=lnt id=hl-58-9><a class=lnlinks href=#hl-58-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>retry_with_backoff</span><span class=p>(</span><span class=n>task</span><span class=p>,</span> <span class=n>max_attempts</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_attempts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>success</span> <span class=o>=</span> <span class=n>task</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.01</span><span class=p>,</span> <span class=mf>0.1</span> <span class=o>*</span> <span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>테스트 케이스 설계</strong>:</p><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>시나리오</td><td>두 스레드가 서로 양보하며 lock 을 획득하지 못함</td></tr><tr><td>조건</td><td>flag-based 접근 로직으로 서로 피하는 구조</td></tr><tr><td>기대 결과</td><td>CPU 사용률은 높지만 상태 진전 없음</td></tr><tr><td>검증 포인트</td><td>로그는 반복되지만 상태값은 변하지 않음, 처리량 없음</td></tr></tbody></table><p><strong>로그 패턴 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-59-1><a class=lnlinks href=#hl-59-1>1</a>
</span><span class=lnt id=hl-59-2><a class=lnlinks href=#hl-59-2>2</a>
</span><span class=lnt id=hl-59-3><a class=lnlinks href=#hl-59-3>3</a>
</span><span class=lnt id=hl-59-4><a class=lnlinks href=#hl-59-4>4</a>
</span><span class=lnt id=hl-59-5><a class=lnlinks href=#hl-59-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[Thread1] Waiting for Thread2 to release
</span></span><span class=line><span class=cl>[Thread2] Waiting for Thread1 to release
</span></span><span class=line><span class=cl>[Thread1] Retrying…
</span></span><span class=line><span class=cl>[Thread2] Retrying…
</span></span><span class=line><span class=cl>[LivelockDetector] Live cycle detected, thread pair T1 &lt;-&gt; T2 not making progress
</span></span></code></pre></td></tr></table></div></div><p><strong>장애 감지 모듈 설계</strong>:</p><ul><li>상태 전이 없음, 반복 동작만 지속되는 패턴 탐지</li><li>백오프 카운터 증가 패턴 추적</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-60-1><a class=lnlinks href=#hl-60-1>1</a>
</span><span class=lnt id=hl-60-2><a class=lnlinks href=#hl-60-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>state_change</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>retry_count</span> <span class=o>&gt;</span> <span class=n>LIMIT</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&#34;Possible livelock detected&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=priority-inversion-우선순위-역전>Priority Inversion (우선순위 역전)<a hidden class=anchor aria-hidden=true href=#priority-inversion-우선순위-역전>#</a></h5><p>낮은 우선순위 스레드가 락을 보유하고, 높은 우선순위 스레드가 <strong>기다리는 상황</strong> 발생.</p><p><strong>코드 예시</strong>: (개념적 시뮬레이션)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-61-1><a class=lnlinks href=#hl-61-1>1</a>
</span><span class=lnt id=hl-61-2><a class=lnlinks href=#hl-61-2>2</a>
</span><span class=lnt id=hl-61-3><a class=lnlinks href=#hl-61-3>3</a>
</span><span class=lnt id=hl-61-4><a class=lnlinks href=#hl-61-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 실제 우선순위 조절은 Python에서는 불가하지만 개념 표현 가능</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Low Priority Task acquired lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;High Priority Task waiting on lock…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Medium Priority Task keeps CPU busy (no I/O)&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>시각화 흐름도</strong>:</p><pre class=mermaid>sequenceDiagram
    participant L as Low Priority
    participant H as High Priority
    participant M as Medium Priority

    L-&gt;&gt;Lock: Acquire
    H-&gt;&gt;Lock: Wait (Blocked)
    M-&gt;&gt;CPU: Occupy (CPU-bound)
    Note over H: 응답 지연 (Inversion 발생)
</pre><p><strong>장애 시나리오 기반 복구 설계</strong>:</p><ul><li>Priority Inheritance 또는 Ceiling Protocol 사용</li></ul><p><strong>테스트 케이스 설계</strong>:</p><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>시나리오</td><td>낮은 우선순위 스레드가 lock 보유, 높은 우선순위가 대기</td></tr><tr><td>조건</td><td>중간 우선순위 태스크가 지속 CPU 점유</td></tr><tr><td>기대 결과</td><td>높은 우선순위 태스크가 반응 없음</td></tr><tr><td>검증 포인트</td><td>latency 분석 결과 우선순위 역전 패턴 확인 가능</td></tr></tbody></table><p><strong>로그 패턴 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-63-1><a class=lnlinks href=#hl-63-1>1</a>
</span><span class=lnt id=hl-63-2><a class=lnlinks href=#hl-63-2>2</a>
</span><span class=lnt id=hl-63-3><a class=lnlinks href=#hl-63-3>3</a>
</span><span class=lnt id=hl-63-4><a class=lnlinks href=#hl-63-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[HighPriorityTask] Waiting for lock (held by LowPriorityTask)
</span></span><span class=line><span class=cl>[LowPriorityTask] Executing…
</span></span><span class=line><span class=cl>[MediumPriorityTask] Executing…
</span></span><span class=line><span class=cl>[PriorityInversionDetector] Inversion detected: HighPriority blocked by LowPriority
</span></span></code></pre></td></tr></table></div></div><p><strong>장애 감지 모듈 설계</strong>:</p><ul><li>태스크 우선순위/상태 추적</li><li>높은 우선순위 태스크가 비정상적으로 대기하는 경우 알림</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-64-1><a class=lnlinks href=#hl-64-1>1</a>
</span><span class=lnt id=hl-64-2><a class=lnlinks href=#hl-64-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>high_priority_task</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=s2>&#34;waiting&#34;</span> <span class=ow>and</span> <span class=n>low_priority_task</span><span class=o>.</span><span class=n>holding_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&#34;Priority Inversion Detected&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=crash-during-lock>Crash During Lock<a hidden class=anchor aria-hidden=true href=#crash-during-lock>#</a></h5><p>락을 소유한 프로세스가 <strong>임계 구역 도중 다운</strong>되어 락이 풀리지 않음.</p><p><strong>코드 예시</strong>: Redis 기반</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-65-1><a class=lnlinks href=#hl-65-1>1</a>
</span><span class=lnt id=hl-65-2><a class=lnlinks href=#hl-65-2>2</a>
</span><span class=lnt id=hl-65-3><a class=lnlinks href=#hl-65-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;lock&#34;</span><span class=p>,</span> <span class=s2>&#34;uuid&#34;</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ex</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 작업 도중 crash</span>
</span></span><span class=line><span class=cl><span class=c1># 락이 풀리지 않으면 후속 작업 차단</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>시각화 흐름도</strong>:</p><pre class=mermaid>sequenceDiagram
    participant C1 as Client 1
    participant Redis
    participant C2 as Client 2

    C1-&gt;&gt;Redis: SETNX lock_key
    Redis--&gt;&gt;C1: OK
    C1-&gt;&gt;Redis: 작업 중 (Crash 발생)
    C2-&gt;&gt;Redis: SETNX lock_key
    Redis--&gt;&gt;C2: Denied (Lock not expired)
</pre><p><strong>장애 시나리오 기반 복구 설계</strong>:</p><ul><li>TTL 설정 (ex 옵션)</li><li>락 소유자 검증 후 release (fencing token 활용)</li></ul><p><strong>복구 설계 구현 예시</strong>: Redis + fencing</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-67-1><a class=lnlinks href=#hl-67-1>1</a>
</span><span class=lnt id=hl-67-2><a class=lnlinks href=#hl-67-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>redis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;lock&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=n>my_token</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>redis</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=s2>&#34;lock&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>테스트 케이스 설계</strong>:</p><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>시나리오</td><td>락 보유 중 프로세스가 비정상 종료</td></tr><tr><td>조건</td><td>락 해제가 이루어지지 않음</td></tr><tr><td>기대 결과</td><td>후속 프로세스는 락을 획득할 수 없음</td></tr><tr><td>검증 포인트</td><td>동일 자원에 대한 요청이 계속 실패, TTL 초과 탐지 필요</td></tr></tbody></table><p><strong>로그 패턴 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-68-1><a class=lnlinks href=#hl-68-1>1</a>
</span><span class=lnt id=hl-68-2><a class=lnlinks href=#hl-68-2>2</a>
</span><span class=lnt id=hl-68-3><a class=lnlinks href=#hl-68-3>3</a>
</span><span class=lnt id=hl-68-4><a class=lnlinks href=#hl-68-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ClientA] Acquired lock (token=uuid123)
</span></span><span class=line><span class=cl>[ClientA] Process crashed
</span></span><span class=line><span class=cl>[ClientB] Lock acquisition failed - lock already held
</span></span><span class=line><span class=cl>[LockMonitor] Lock held beyond TTL - suspect owner failure
</span></span></code></pre></td></tr></table></div></div><p><strong>장애 감지 모듈 설계</strong>:</p><ul><li>TTL 기반 분산 락을 사용하고, 만료 시 강제 해제</li><li>fencing token 과 락 소유자 검증 포함</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-69-1><a class=lnlinks href=#hl-69-1>1</a>
</span><span class=lnt id=hl-69-2><a class=lnlinks href=#hl-69-2>2</a>
</span><span class=lnt id=hl-69-3><a class=lnlinks href=#hl-69-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>current_time</span> <span class=o>-</span> <span class=n>lock_acquired_time</span> <span class=o>&gt;</span> <span class=n>TTL</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&#34;Lock timeout detected, assuming crash&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>redis</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><table><thead><tr><th>카테고리</th><th>도전 과제</th><th>설명</th><th>대표 해결 전략 / 기술 예시</th></tr></thead><tbody><tr><td><strong>1. 동기화 안정성</strong></td><td>데드락 (Deadlock) 방지</td><td>상호 점유 자원 대기로 인해 무한 대기 상태 발생</td><td>자원 순서 고정, 타임아웃, deadlock detection 알고리즘</td></tr><tr><td></td><td>기아 상태 (Starvation) 예방</td><td>낮은 우선순위 프로세스가 계속 자원 할당 받지 못하는 현상</td><td>공정성 (Fairness) 락, 우선순위 상속, bounded waiting 알고리즘</td></tr><tr><td></td><td>우선순위 역전 (Priority Inversion) 해결</td><td>낮은 우선순위가 락을 점유해 높은 우선순위가 대기</td><td>Priority Ceiling / Inheritance 프로토콜</td></tr><tr><td></td><td>라이브락 (Livelock)</td><td>계속 상태를 변경하지만 작업 진전이 없음</td><td>백오프 (back-off), 임계 구역 진입 재시도 전략</td></tr><tr><td><strong>2. 성능 및 확장성</strong></td><td>락 경합 및 오버헤드 최소화</td><td>많은 스레드가 동일한 자원을 기다리며 병목 발생</td><td>락 분할 (Lock Striping), 읽기 - 쓰기 락, 락 프리 자료구조</td></tr><tr><td></td><td>멀티코어 확장성</td><td>캐시 코히런시 및 메모리 일관성 문제로 인한 성능 저하</td><td>NUMA 최적화, Memory Barrier, CAS/FAA 기반 락프리 구조</td></tr><tr><td></td><td>실시간 처리 성능 확보</td><td>임계구역 처리 지연 시 시스템 응답 시간 증가</td><td>Real-time mutex, latency 예측 기반 프로파일링</td></tr><tr><td><strong>3. 분산 시스템 대응</strong></td><td>Crash-Recovery 대응</td><td>임계구역 진입 중 노드 장애 발생 시 락 해제 및 복구 구조 설계 필요</td><td>Durable Mutex, fencing token, quorum rollback</td></tr><tr><td></td><td>네트워크 파티션/지연 대응</td><td>메시지 지연 및 네트워크 단절로 인한 일관성 저하</td><td>Consensus 기반 분산 락 (Raft, Paxos), heartbeat 기반 장애 감지</td></tr><tr><td></td><td>스토리지 기반 락 일관성 문제</td><td>Redis/etcd 등 외부 스토리지에 락 상태 위임 시 성능/일관성 trade-off 발생</td><td>fencing token, TTL + auto-renew, transactional locking</td></tr><tr><td></td><td>Quorum 최적화</td><td>메시지 수 감소, 일부 노드 장애 시에도 합의 가능하도록 구성</td><td>Maekawa 알고리즘, Byzantine tolerant quorum</td></tr><tr><td><strong>4. 동시성 보장 기술</strong></td><td>락프리 / 웨이트프리 알고리즘 적용</td><td>락 경합 없이 원자적으로 임계구역 구현 시도</td><td>CAS, STM, FAA 기반 동기화, 논블로킹 자료구조</td></tr><tr><td></td><td>비동기 환경에서의 Fairness 보장</td><td>async/task 기반 환경에서 우선순위 반영 및 기아 상태 방지</td><td>k-mutual exclusion, self-stabilizing 알고리즘 연구</td></tr></tbody></table><ol><li><p><strong>동기화 안정성</strong><br>기본적인 동기화 오류 (데드락, 기아 상태, 우선순위 역전, 라이브락) 는 프로그래밍 오류가 아니라 <strong>구조적 설계 실패</strong>에서 비롯되며, 공정성 (Fairness), 자원 획득 순서 고정, 우선순위 상속 등 구조 기반 해결 전략이 필수다.</p></li><li><p><strong>성능 및 확장성</strong><br>락 경합, 메모리 일관성, NUMA 이슈 등은 멀티코어/멀티스레드 환경에서 동시성의 병목 지점이다. 이를 해결하기 위해선 락을 최소화하는 동시에, CPU 캐시 및 메모리 모델까지 고려한 <strong>저수준 최적화 기법</strong>이 필요하다.</p></li><li><p><strong>분산 시스템 대응</strong><br>단일 머신에서는 문제가 없던 상호배제가 분산 시스템에서는 네트워크 분리, 장애 복구, 일관성 보장 문제로 <strong>복잡성이 급증</strong>한다. fencing token, quorum 구성, failover 로직, 장애 감지 프로토콜이 핵심이다.</p></li><li><p><strong>동시성 보장 기술</strong><br>Lock-Free / Wait-Free 기법은 경합 최소화, throughput 극대화에 필수적이며 특히 실시간 처리나 고성능 시스템에서 점점 필수로 여겨진다. 비동기 환경에서도 Fairness 를 보장하기 위한 <strong>논블로킹 알고리즘의 안정성 확보</strong>가 연구되고 있다.</p></li></ol><h4 id=crash-recovery-환경-대응>Crash-Recovery 환경 대응<a hidden class=anchor aria-hidden=true href=#crash-recovery-환경-대응>#</a></h4><h5 id=crash-recovery-대응-redlock-구조>Crash-Recovery 대응 Redlock 구조<a hidden class=anchor aria-hidden=true href=#crash-recovery-대응-redlock-구조>#</a></h5><pre class=mermaid>sequenceDiagram
    participant App
    participant Redis1
    participant Redis2
    participant Redis3

    App-&gt;&gt;Redis1: SET resource_key &lt;token&gt; NX PX 3000
    App-&gt;&gt;Redis2: SET resource_key &lt;token&gt; NX PX 3000
    App-&gt;&gt;Redis3: SET resource_key &lt;token&gt; NX PX 3000

    Note right of App: majority 성공 시 lock 획득

    App--&gt;&gt;Redis1: periodic lock renewal
    App--&gt;&gt;Redis2: periodic lock renewal
    App--&gt;&gt;Redis3: periodic lock renewal

    App-&gt;&gt;Redis1: DEL if token matches
    App-&gt;&gt;Redis2: DEL if token matches
    App-&gt;&gt;Redis3: DEL if token matches

    Note over App: 장애 시 fencing token으로 중복 방지
</pre><ul><li>핵심 요소:<ul><li><code>NX PX</code>: 존재하지 않으면 설정 + TTL</li><li><code>token</code>: 고유 식별자 (fencing token 역할)</li><li><code>majority</code>: 락 획득 조건</li><li><code>renew</code>: TTL 갱신</li><li><code>DEL</code>: 종료 후 자원 해제</li></ul></li></ul><h5 id=성능-비교표-crash-recovery-고려-시-동기화-기법-비교>성능 비교표: Crash-Recovery 고려 시 동기화 기법 비교<a hidden class=anchor aria-hidden=true href=#성능-비교표-crash-recovery-고려-시-동기화-기법-비교>#</a></h5><table><thead><tr><th>항목</th><th>Mutex (OS)</th><th>Redlock (Redis)</th><th>Durable Mutex (ZK 등)</th><th>Fence Token 기반 분산락</th></tr></thead><tbody><tr><td>복구 가능성</td><td>✕</td><td>TTL 만료 의존</td><td>✅ Persistent Znode 사용</td><td>✅ fencing token ID 로 보호</td></tr><tr><td>네트워크 장애 대응</td><td>✕</td><td>부분 가능</td><td>✅ 리더 선출 자동 복구</td><td>✅ heartbeat 기반 재선출</td></tr><tr><td>락 자동 해제</td><td>✕</td><td>✅ TTL 기반 자동 만료</td><td>✅ 세션 종료 시 자동 해제</td><td>✅ token 만료 시 강제 무효화</td></tr><tr><td>재시도/재진입 안전성</td><td>제한적</td><td>제한적</td><td>✅ 동일 세션 내 idempotent</td><td>✅ fencing token 비교 기반</td></tr><tr><td>일관성 강도</td><td>강함</td><td>중간 (eventual)</td><td>강함 (linearizable)</td><td>강함 (token ordering)</td></tr><tr><td>성능 (latency)</td><td>매우 빠름</td><td>빠름</td><td>중간</td><td>중간 ~ 느림</td></tr><tr><td>장애 발생 시 데이터 안전성</td><td>OS Crash 시 손실</td><td>Redis 복구까지 불안정</td><td>ZK 데이터 유지</td><td>fencing token 으로 중복 방지</td></tr></tbody></table><h5 id=코드-예시>코드 예시<a hidden class=anchor aria-hidden=true href=#코드-예시>#</a></h5><ul><li>Python: Redis 기반 Fencing Token 분산락 (Crash-Recovery 대응)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-71-1><a class=lnlinks href=#hl-71-1> 1</a>
</span><span class=lnt id=hl-71-2><a class=lnlinks href=#hl-71-2> 2</a>
</span><span class=lnt id=hl-71-3><a class=lnlinks href=#hl-71-3> 3</a>
</span><span class=lnt id=hl-71-4><a class=lnlinks href=#hl-71-4> 4</a>
</span><span class=lnt id=hl-71-5><a class=lnlinks href=#hl-71-5> 5</a>
</span><span class=lnt id=hl-71-6><a class=lnlinks href=#hl-71-6> 6</a>
</span><span class=lnt id=hl-71-7><a class=lnlinks href=#hl-71-7> 7</a>
</span><span class=lnt id=hl-71-8><a class=lnlinks href=#hl-71-8> 8</a>
</span><span class=lnt id=hl-71-9><a class=lnlinks href=#hl-71-9> 9</a>
</span><span class=lnt id=hl-71-10><a class=lnlinks href=#hl-71-10>10</a>
</span><span class=lnt id=hl-71-11><a class=lnlinks href=#hl-71-11>11</a>
</span><span class=lnt id=hl-71-12><a class=lnlinks href=#hl-71-12>12</a>
</span><span class=lnt id=hl-71-13><a class=lnlinks href=#hl-71-13>13</a>
</span><span class=lnt id=hl-71-14><a class=lnlinks href=#hl-71-14>14</a>
</span><span class=lnt id=hl-71-15><a class=lnlinks href=#hl-71-15>15</a>
</span><span class=lnt id=hl-71-16><a class=lnlinks href=#hl-71-16>16</a>
</span><span class=lnt id=hl-71-17><a class=lnlinks href=#hl-71-17>17</a>
</span><span class=lnt id=hl-71-18><a class=lnlinks href=#hl-71-18>18</a>
</span><span class=lnt id=hl-71-19><a class=lnlinks href=#hl-71-19>19</a>
</span><span class=lnt id=hl-71-20><a class=lnlinks href=#hl-71-20>20</a>
</span><span class=lnt id=hl-71-21><a class=lnlinks href=#hl-71-21>21</a>
</span><span class=lnt id=hl-71-22><a class=lnlinks href=#hl-71-22>22</a>
</span><span class=lnt id=hl-71-23><a class=lnlinks href=#hl-71-23>23</a>
</span><span class=lnt id=hl-71-24><a class=lnlinks href=#hl-71-24>24</a>
</span><span class=lnt id=hl-71-25><a class=lnlinks href=#hl-71-25>25</a>
</span><span class=lnt id=hl-71-26><a class=lnlinks href=#hl-71-26>26</a>
</span><span class=lnt id=hl-71-27><a class=lnlinks href=#hl-71-27>27</a>
</span><span class=lnt id=hl-71-28><a class=lnlinks href=#hl-71-28>28</a>
</span><span class=lnt id=hl-71-29><a class=lnlinks href=#hl-71-29>29</a>
</span><span class=lnt id=hl-71-30><a class=lnlinks href=#hl-71-30>30</a>
</span><span class=lnt id=hl-71-31><a class=lnlinks href=#hl-71-31>31</a>
</span><span class=lnt id=hl-71-32><a class=lnlinks href=#hl-71-32>32</a>
</span><span class=lnt id=hl-71-33><a class=lnlinks href=#hl-71-33>33</a>
</span><span class=lnt id=hl-71-34><a class=lnlinks href=#hl-71-34>34</a>
</span><span class=lnt id=hl-71-35><a class=lnlinks href=#hl-71-35>35</a>
</span><span class=lnt id=hl-71-36><a class=lnlinks href=#hl-71-36>36</a>
</span><span class=lnt id=hl-71-37><a class=lnlinks href=#hl-71-37>37</a>
</span><span class=lnt id=hl-71-38><a class=lnlinks href=#hl-71-38>38</a>
</span><span class=lnt id=hl-71-39><a class=lnlinks href=#hl-71-39>39</a>
</span><span class=lnt id=hl-71-40><a class=lnlinks href=#hl-71-40>40</a>
</span><span class=lnt id=hl-71-41><a class=lnlinks href=#hl-71-41>41</a>
</span><span class=lnt id=hl-71-42><a class=lnlinks href=#hl-71-42>42</a>
</span><span class=lnt id=hl-71-43><a class=lnlinks href=#hl-71-43>43</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RedisLockWithToken</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>ttl</span><span class=o>=</span><span class=mi>3000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key</span> <span class=o>=</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ttl</span> <span class=o>=</span> <span class=n>ttl</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>token</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>  <span class=c1># fencing token</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fence_counter_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>:fence&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>px</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>ttl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># fence 번호 증가</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>fence_counter_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>fence_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>fence_counter_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>script</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        if redis.call(&#34;get&#34;, KEYS[1]) == ARGV[1] then
</span></span></span><span class=line><span class=cl><span class=s2>            return redis.call(&#34;del&#34;, KEYS[1])
</span></span></span><span class=line><span class=cl><span class=s2>        else
</span></span></span><span class=line><span class=cl><span class=s2>            return 0
</span></span></span><span class=line><span class=cl><span class=s2>        end
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>eval</span><span class=p>(</span><span class=n>script</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>RedisLockWithToken</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=s2>&#34;job:process&#34;</span><span class=p>,</span> <span class=n>ttl</span><span class=o>=</span><span class=mi>3000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Lock acquired with fence ID: </span><span class=si>{</span><span class=n>lock</span><span class=o>.</span><span class=n>fence_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 작업 처리</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Lock acquisition failed&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>특징:<ul><li><code>uuid</code> 기반 token → fencing token 역할</li><li><code>TTL</code> 설정 → 장애 시 자동 만료</li><li><code>eval</code> → 안전한 락 해제</li><li><code>fence_id</code> → 중복 방지 및 순서 보장</li></ul></li></ul><h5 id=실무-적용-시나리오-crash-recovery-대응-락-사용-예>실무 적용 시나리오: Crash-Recovery 대응 락 사용 예<a hidden class=anchor aria-hidden=true href=#실무-적용-시나리오-crash-recovery-대응-락-사용-예>#</a></h5><table><thead><tr><th>시나리오</th><th>설명</th><th>적용 전략</th></tr></thead><tbody><tr><td><strong>E-commerce 결제 중 장애 발생</strong></td><td>사용자가 결제 도중 서버 장애 발생 시 중복 결제 방지 필요</td><td>Redlock + fencing token 사용, fence ID 비교로 중복 차단</td></tr><tr><td><strong>배치 작업 선점 실행</strong></td><td>동일 배치 작업이 여러 서버에서 중복 실행되는 경우 방지</td><td>fencing token 기반 leader only 실행 구조</td></tr><tr><td><strong>파일 업로드 예약 시스템</strong></td><td>예약된 시간에만 하나의 프로세스만 실행 가능하도록 제어</td><td>TTL 기반 락 + periodic renewal, 세션별 UUID 로 재진입 차단</td></tr><tr><td><strong>IoT 센서 중복 제어 방지</strong></td><td>다중 센서가 동일 장비에 명령을 동시에 보내는 경우 충돌 방지</td><td>fencing token 기반 device command serialization</td></tr><tr><td><strong>실시간 처리 시스템 (Kafka + Redis)</strong></td><td>consumer crash 발생 시 job double consume 방지</td><td>Redis 락 → token 기록 → 재기동 시 이전 fence ID 이하 job 무시 처리</td></tr></tbody></table><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>메커니즘 / 예시</th><th>특징 / 설명</th></tr></thead><tbody><tr><td><strong>구현 방식</strong></td><td>소프트웨어 기반</td><td>Dekker, Peterson, Lamport Bakery</td><td>공유 변수/플래그/순번 등을 이용한 상호배제. Busy-wait 방식. 이론적 가치 높음.</td></tr><tr><td></td><td>하드웨어 기반</td><td>Test-and-Set, Compare-and-Swap, Fetch-and-Add</td><td>CPU 명령어 기반 원자적 연산으로 임계 구역 보호. 스핀락/락프리 구조에 활용.</td></tr><tr><td></td><td>운영체제 기반</td><td>Mutex, Semaphore, Monitor</td><td>OS 또는 언어 런타임이 제공하는 동기화 객체. 재진입, 대기, 상태 모니터링 포함.</td></tr><tr><td><strong>프로세스 수</strong></td><td>이진 상호배제 (2- 프로세스)</td><td>Peterson, Dekker</td><td>두 프로세스 전용 구조. 간단하며 기본 원칙 학습에 적합.</td></tr><tr><td></td><td>다중 상호배제 (n- 프로세스)</td><td>Bakery Algorithm</td><td>공정성 (Fairness), Bounded Waiting 보장. 번호표 기반.</td></tr><tr><td><strong>메모리 모델</strong></td><td>Shared-Memory 기반</td><td>Peterson, Bakery</td><td>메모리 공유 기반 busy-wait 방식. 커널 공간 접근 불필요.</td></tr><tr><td></td><td>Message-Passing 기반</td><td>Ricart-Agrawala, Suzuki-Kasami</td><td>네트워크 메시지로 임계 구역 진입 결정. 분산 시스템에 적합.</td></tr><tr><td><strong>동기화 방식</strong></td><td>Permission 기반</td><td>Ricart-Agrawala</td><td>진입 요청 → 다수 노드의 허락 (Reply) 필요. 공정성 우수.</td></tr><tr><td></td><td>Token 기반</td><td>Suzuki-Kasami, Raymond</td><td>토큰을 가진 노드만 임계 구역 진입 가능. 메시지 수 적음.</td></tr><tr><td></td><td>Quorum 기반</td><td>Maekawa</td><td>전체 노드 일부에만 요청. 메시지 수 절감. 일부 장애에도 강건함.</td></tr><tr><td><strong>적용 환경</strong></td><td>로컬 시스템</td><td>Peterson, Bakery, Mutex</td><td>단일 머신, 스레드 기반 구조에 적합. 성능 및 제어 쉬움.</td></tr><tr><td></td><td>분산 시스템</td><td>Ricart-Agrawala, Redlock, ZooKeeper</td><td>네트워크 환경에서 동기화. 장애, 분산 트랜잭션 고려 필요.</td></tr><tr><td><strong>동시성 수준</strong></td><td>K-Mutual Exclusion</td><td>k 프로세스 동시에 진입 허용 구조</td><td>최대 k 개 프로세스까지 임계 구역 진입 가능. 다중 공유자원 접근에 적합.</td></tr><tr><td></td><td>Recoverable Mutex</td><td>Durable Mutex, Transactional Lock</td><td>crash 이후에도 상태 복원. 고가용성 요구 시스템에 적합.</td></tr><tr><td><strong>운영 레벨</strong></td><td>사용자 공간</td><td>사용자 코드에서 구현된 알고리즘들 (ex. Peterson)</td><td>시스템 콜 없이 구현 가능. OS 개입 없음.</td></tr><tr><td></td><td>커널 공간</td><td>OS 가 제공하는 동기화 객체 (ex. mutex, sema)</td><td>스케줄링, IO 블로킹 포함. 성능보다 안정성 중시.</td></tr><tr><td><strong>진입 정책</strong></td><td>선점형 (Preemptive)</td><td>OS 가 강제 컨텍스트 전환</td><td>긴 대기 방지, 우선순위 기반 스케줄링 가능.</td></tr><tr><td></td><td>비선점형 (Non-preemptive)</td><td>자발적 양보 필요</td><td>구현 단순. Starvation 발생 가능성 존재.</td></tr><tr><td><strong>동기화 수준</strong></td><td>동기화 객체</td><td>Mutex, Semaphore, Monitor, Spinlock, RWLock</td><td>실제 시스템에서 사용하는 추상화된 동기화 기법들.</td></tr><tr><td></td><td>락프리/논블로킹 구조</td><td>CAS, FAA, STM 기반 자료구조</td><td>고성능 병렬 환경에 적합. 경합 감소 및 병목 최소화.</td></tr></tbody></table><ol><li><p><strong>구현 방식</strong><br>상호 배제는 크게 <strong>소프트웨어 알고리즘</strong>, <strong>하드웨어 명령어</strong>, <strong>운영체제/언어 지원 동기화 객체</strong>로 나뉜다. 소프트웨어 기반은 학습용에 적합하고, 하드웨어 기반은 성능 최적화에 활용되며, 운영체제 기반은 실무 시스템의 안정성과 범용성을 책임진다.</p></li><li><p><strong>프로세스 수 기준</strong><br>Peterson 은 2- 프로세스 전용이고, Bakery 알고리즘은 N- 프로세스를 지원한다. 이진/다중 구조에 따라 알고리즘 선택이 달라진다.</p></li><li><p><strong>메모리 및 메시지 모델</strong><br>로컬 시스템은 shared-memory 기반 알고리즘이 적합하며, 분산 시스템은 메시지 기반 동기화 모델이 요구된다. 특히, 메시지 방식은 Permission-based, Token-based, Quorum-based 로 나뉜다.</p></li><li><p><strong>적용 환경</strong><br>단일 머신은 일반적인 Mutex, Monitor, Semaphore 로 충분하지만, 분산 환경에서는 장애 허용성과 일관성 유지를 위한 더 복잡한 동기화 구조 (Redlock, ZooKeeper) 가 필요하다.</p></li><li><p><strong>특별 구조 및 상황별 설계</strong><br>Recoverable Mutex 는 장애 이후에도 복구 가능한 환경에 적합하고, K-Mutual Exclusion 은 다수의 동시 진입을 허용해야 할 때 고려한다.</p></li><li><p><strong>운영 수준과 진입 정책</strong><br>동기화 객체는 사용자 공간에서 구현하거나, 커널 공간에서 운영체제 API 를 호출하여 사용할 수 있다. 또한, 선점/비선점 스케줄링 여부에 따라 응답성과 공정성이 좌우된다.</p></li><li><p><strong>고급 구조</strong><br>락프리/논블로킹 구조는 성능과 확장성 요구가 큰 환경에서 주로 사용된다. CAS, STM, FAA 기반 구조는 병목과 컨텍스트 스위칭 비용을 줄이기 위한 효과적인 대안이다.</p></li></ol><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td><strong>설계</strong></td><td>임계 영역 최소화</td><td>과도한 락 범위는 병목의 원인이 됨</td><td>세분화된 락 사용, 필요한 최소 영역에만 적용</td></tr><tr><td></td><td>재진입성 고려</td><td>동일 스레드가 동일 락을 반복 획득 시 deadlock 발생 가능</td><td>Reentrant Lock 사용</td></tr><tr><td></td><td>공유 자원 명확화</td><td>보호 대상이 명확하지 않으면 동기화 실패</td><td>인터페이스 캡슐화, 명확한 자원 식별 구조 사용</td></tr><tr><td><strong>성능</strong></td><td>락 경합 최소화</td><td>다수의 스레드가 자원을 동시에 요청하면 병목 발생</td><td>락 분할, 락 계층화, 읽기/쓰기 락 도입</td></tr><tr><td></td><td>락 오버헤드 관리</td><td>불필요한 락은 전체 시스템 성능에 영향</td><td>락 프리 알고리즘, CAS 기반 원자 연산 활용</td></tr><tr><td></td><td>하드웨어 Memory Ordering</td><td>CPU 명령 재정렬로 인한 동기화 실패 가능</td><td>Memory Barrier, atomic 연산 명시적 사용</td></tr><tr><td><strong>안정성</strong></td><td>데드락 방지</td><td>순환 대기 구조 시 시스템 정지 가능</td><td>락 순서 고정, 타임아웃 설정, deadlock detection 적용</td></tr><tr><td></td><td>기아 상태 방지</td><td>특정 스레드가 영원히 실행되지 않을 수 있음</td><td>공정성 있는 알고리즘 (FIFO 큐, bounded waiting 등) 적용</td></tr><tr><td></td><td>예외 및 비정상 종료 처리</td><td>락 보유 중 예외 발생 시 해제되지 않으면 자원 고립</td><td>try-finally, watchdog, timeout 처리</td></tr><tr><td></td><td>우선순위 반전</td><td>낮은 우선순위 스레드가 락 보유 시 고우선 스레드 지연</td><td>Priority Inheritance 또는 Ceiling 프로토콜 사용</td></tr><tr><td><strong>분산 환경</strong></td><td>메시지 기반 락</td><td>네트워크 환경에서는 메시지 지연·손실 가능성 존재</td><td>ACK/Retry, Timeout, Circuit Breaker 적용</td></tr><tr><td></td><td>분산 락 복구 구조</td><td>노드 장애 시 락 상태 복원 실패 시 시스템 마비 가능</td><td>Recoverable Lock, Fencing Token, 상태 재조정 설계</td></tr><tr><td></td><td>락 관리자 활용</td><td>여러 노드에서 동기화 일관성 보장 어려움</td><td>Zookeeper, Redis, etcd 등 분산 락 관리자 도입</td></tr><tr><td><strong>테스트</strong></td><td>Race Condition 대응</td><td>버그가 비결정적이라 재현이 어려움</td><td>Stress Test, Race Detector, Model Checking 등 활용</td></tr><tr><td></td><td>로깅 및 분석</td><td>원인 분석 어려움, 병목 지점 추적 어려움</td><td>동기화 관련 로깅 활성화, 락 프로파일링 도구 (perf, strace 등) 활용</td></tr></tbody></table><ul><li><strong>설계 측면</strong><br><strong>락의 최소화, 재진입성 확보, 자원 식별의 명확화</strong>가 중요하다. 임계 영역을 불필요하게 넓게 설정하거나 명확하지 않은 자원 보호는 시스템 병목이나 동기화 오류의 주된 원인이 되므로, <strong>세밀한 락 제어 및 책임 분리</strong>가 필요하다.</li></ul><p><strong>성능 측면</strong><br><strong>락 경합 최소화, 불필요한 동기화 제거, 하드웨어 메모리 모델 이해</strong>가 핵심이다. 멀티스레드/멀티코어 환경에서는 <strong>락 경합이 심한 코드 패스에 대한 리팩토링과 병렬성 확보</strong>가 요구되며, 필요에 따라 <strong>락 프리 알고리즘 또는 원자 연산</strong>으로의 전환도 고려되어야 한다.</p><p><strong>안정성 측면</strong><br><strong>데드락·기아 방지, 예외 상황 대응, 우선순위 역전 처리</strong>가 핵심이다. 특히 복합 락 구조에서는 <strong>획득 순서 보장 및 타임아웃 전략</strong>을 반드시 적용해야 하며, <strong>예외 발생 시 자원 회수 로직</strong>도 필수이다.</p><p><strong>분산 환경</strong><br>메시지 기반 통신 지연·실패에 대비한 <strong>복구 메커니즘 및 분산 락 관리자 도입</strong>이 필요하다. 장애 상황에서도 상태 일관성을 유지할 수 있도록 <strong>Recoverable Lock 및 Fencing Token 설계</strong>가 중요하다.</p><p><strong>테스트 및 분석 관점</strong><br><strong>Race Detector, Stress 테스트 도구 활용</strong>이 반드시 필요하며, 실시간 운영 시스템에서는 <strong>락 관련 로그와 병목 추적 도구</strong>를 통한 지속적 진단 체계도 함께 구성해야 한다.</p><p>좋아. Mutual Exclusion 을 실무에서 효과적으로 적용하기 위한 고려사항 중 대표적인 항목에 대해 <strong>Python</strong>과 <strong>Java</strong>를 기준으로 실용적인 코드 예시를 아래에 구성할게. 각 항목별로 간단한 시나리오와 함께 <strong>문제 상황 + 해결 방식</strong>을 보여줄 거야.</p><h4 id=락-범위-최소화>락 범위 최소화<a hidden class=anchor aria-hidden=true href=#락-범위-최소화>#</a></h4><p><strong>나쁜 예</strong>:</p><ul><li>락을 너무 넓게 사용</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-72-1><a class=lnlinks href=#hl-72-1>1</a>
</span><span class=lnt id=hl-72-2><a class=lnlinks href=#hl-72-2>2</a>
</span><span class=lnt id=hl-72-3><a class=lnlinks href=#hl-72-3>3</a>
</span><span class=lnt id=hl-72-4><a class=lnlinks href=#hl-72-4>4</a>
</span><span class=lnt id=hl-72-5><a class=lnlinks href=#hl-72-5>5</a>
</span><span class=lnt id=hl-72-6><a class=lnlinks href=#hl-72-6>6</a>
</span><span class=lnt id=hl-72-7><a class=lnlinks href=#hl-72-7>7</a>
</span><span class=lnt id=hl-72-8><a class=lnlinks href=#hl-72-8>8</a>
</span><span class=lnt id=hl-72-9><a class=lnlinks href=#hl-72-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>update_shared_data</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 불필요한 작업까지 락을 보유</span>
</span></span><span class=line><span class=cl>        <span class=n>do_io_heavy_task</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>shared_resource</span><span class=p>[</span><span class=s1>&#39;count&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>좋은 예</strong>:</p><ul><li>임계구역 최소화</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-73-1><a class=lnlinks href=#hl-73-1>1</a>
</span><span class=lnt id=hl-73-2><a class=lnlinks href=#hl-73-2>2</a>
</span><span class=lnt id=hl-73-3><a class=lnlinks href=#hl-73-3>3</a>
</span><span class=lnt id=hl-73-4><a class=lnlinks href=#hl-73-4>4</a>
</span><span class=lnt id=hl-73-5><a class=lnlinks href=#hl-73-5>5</a>
</span><span class=lnt id=hl-73-6><a class=lnlinks href=#hl-73-6>6</a>
</span><span class=lnt id=hl-73-7><a class=lnlinks href=#hl-73-7>7</a>
</span><span class=lnt id=hl-73-8><a class=lnlinks href=#hl-73-8>8</a>
</span><span class=lnt id=hl-73-9><a class=lnlinks href=#hl-73-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>shared_resource</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;count&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>update_shared_data</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>do_io_heavy_task</span><span class=p>()</span>  <span class=c1># 락 없이 처리 가능</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>shared_resource</span><span class=p>[</span><span class=s1>&#39;count&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>  <span class=c1># 최소한의 영역만 보호</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=deadlock-방지>Deadlock 방지<a hidden class=anchor aria-hidden=true href=#deadlock-방지>#</a></h4><ul><li>락 순서 고정</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-74-1><a class=lnlinks href=#hl-74-1> 1</a>
</span><span class=lnt id=hl-74-2><a class=lnlinks href=#hl-74-2> 2</a>
</span><span class=lnt id=hl-74-3><a class=lnlinks href=#hl-74-3> 3</a>
</span><span class=lnt id=hl-74-4><a class=lnlinks href=#hl-74-4> 4</a>
</span><span class=lnt id=hl-74-5><a class=lnlinks href=#hl-74-5> 5</a>
</span><span class=lnt id=hl-74-6><a class=lnlinks href=#hl-74-6> 6</a>
</span><span class=lnt id=hl-74-7><a class=lnlinks href=#hl-74-7> 7</a>
</span><span class=lnt id=hl-74-8><a class=lnlinks href=#hl-74-8> 8</a>
</span><span class=lnt id=hl-74-9><a class=lnlinks href=#hl-74-9> 9</a>
</span><span class=lnt id=hl-74-10><a class=lnlinks href=#hl-74-10>10</a>
</span><span class=lnt id=hl-74-11><a class=lnlinks href=#hl-74-11>11</a>
</span><span class=lnt id=hl-74-12><a class=lnlinks href=#hl-74-12>12</a>
</span><span class=lnt id=hl-74-13><a class=lnlinks href=#hl-74-13>13</a>
</span><span class=lnt id=hl-74-14><a class=lnlinks href=#hl-74-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock_a</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>lock_b</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>thread1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>lock_a</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock_b</span><span class=p>:</span>  <span class=c1># 항상 A → B 순서</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Thread 1 finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>thread2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>lock_a</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock_b</span><span class=p>:</span>  <span class=c1># 동일 순서로 락 획득</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Thread 2 finished&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>두 스레드 모두 A → B 순서로 락을 획득하므로 데드락 발생을 방지할 수 있다.</li></ul><h4 id=reentrantlock-사용>ReentrantLock 사용<a hidden class=anchor aria-hidden=true href=#reentrantlock-사용>#</a></h4><ul><li>Java</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-75-1><a class=lnlinks href=#hl-75-1> 1</a>
</span><span class=lnt id=hl-75-2><a class=lnlinks href=#hl-75-2> 2</a>
</span><span class=lnt id=hl-75-3><a class=lnlinks href=#hl-75-3> 3</a>
</span><span class=lnt id=hl-75-4><a class=lnlinks href=#hl-75-4> 4</a>
</span><span class=lnt id=hl-75-5><a class=lnlinks href=#hl-75-5> 5</a>
</span><span class=lnt id=hl-75-6><a class=lnlinks href=#hl-75-6> 6</a>
</span><span class=lnt id=hl-75-7><a class=lnlinks href=#hl-75-7> 7</a>
</span><span class=lnt id=hl-75-8><a class=lnlinks href=#hl-75-8> 8</a>
</span><span class=lnt id=hl-75-9><a class=lnlinks href=#hl-75-9> 9</a>
</span><span class=lnt id=hl-75-10><a class=lnlinks href=#hl-75-10>10</a>
</span><span class=lnt id=hl-75-11><a class=lnlinks href=#hl-75-11>11</a>
</span><span class=lnt id=hl-75-12><a class=lnlinks href=#hl-75-12>12</a>
</span><span class=lnt id=hl-75-13><a class=lnlinks href=#hl-75-13>13</a>
</span><span class=lnt id=hl-75-14><a class=lnlinks href=#hl-75-14>14</a>
</span><span class=lnt id=hl-75-15><a class=lnlinks href=#hl-75-15>15</a>
</span><span class=lnt id=hl-75-16><a class=lnlinks href=#hl-75-16>16</a>
</span><span class=lnt id=hl-75-17><a class=lnlinks href=#hl-75-17>17</a>
</span><span class=lnt id=hl-75-18><a class=lnlinks href=#hl-75-18>18</a>
</span><span class=lnt id=hl-75-19><a class=lnlinks href=#hl-75-19>19</a>
</span><span class=lnt id=hl-75-20><a class=lnlinks href=#hl-75-20>20</a>
</span><span class=lnt id=hl-75-21><a class=lnlinks href=#hl-75-21>21</a>
</span><span class=lnt id=hl-75-22><a class=lnlinks href=#hl-75-22>22</a>
</span><span class=lnt id=hl-75-23><a class=lnlinks href=#hl-75-23>23</a>
</span><span class=lnt id=hl-75-24><a class=lnlinks href=#hl-75-24>24</a>
</span><span class=lnt id=hl-75-25><a class=lnlinks href=#hl-75-25>25</a>
</span><span class=lnt id=hl-75-26><a class=lnlinks href=#hl-75-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>java.util.concurrent.locks.ReentrantLock</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Counter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ReentrantLock</span><span class=w> </span><span class=n>lock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ReentrantLock</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>increment</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>lock</span><span class=p>.</span><span class=na>lock</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>count</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 재진입 가능한 코드</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logCount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>lock</span><span class=p>.</span><span class=na>unlock</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>logCount</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>lock</span><span class=p>.</span><span class=na>lock</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Count = &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>count</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>lock</span><span class=p>.</span><span class=na>unlock</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>동일한 스레드가 동일 락을 다시 획득할 수 있는 구조를 ReentrantLock 이 보장.</li></ul><h4 id=락-timeout-설정>락 Timeout 설정<a hidden class=anchor aria-hidden=true href=#락-timeout-설정>#</a></h4><ul><li>Python</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-76-1><a class=lnlinks href=#hl-76-1> 1</a>
</span><span class=lnt id=hl-76-2><a class=lnlinks href=#hl-76-2> 2</a>
</span><span class=lnt id=hl-76-3><a class=lnlinks href=#hl-76-3> 3</a>
</span><span class=lnt id=hl-76-4><a class=lnlinks href=#hl-76-4> 4</a>
</span><span class=lnt id=hl-76-5><a class=lnlinks href=#hl-76-5> 5</a>
</span><span class=lnt id=hl-76-6><a class=lnlinks href=#hl-76-6> 6</a>
</span><span class=lnt id=hl-76-7><a class=lnlinks href=#hl-76-7> 7</a>
</span><span class=lnt id=hl-76-8><a class=lnlinks href=#hl-76-8> 8</a>
</span><span class=lnt id=hl-76-9><a class=lnlinks href=#hl-76-9> 9</a>
</span><span class=lnt id=hl-76-10><a class=lnlinks href=#hl-76-10>10</a>
</span><span class=lnt id=hl-76-11><a class=lnlinks href=#hl-76-11>11</a>
</span><span class=lnt id=hl-76-12><a class=lnlinks href=#hl-76-12>12</a>
</span><span class=lnt id=hl-76-13><a class=lnlinks href=#hl-76-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_acquire_with_timeout</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>got_lock</span> <span class=o>=</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>got_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Lock acquired&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Failed to acquire lock in time&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=락-오버헤드-제거>락 오버헤드 제거<a hidden class=anchor aria-hidden=true href=#락-오버헤드-제거>#</a></h4><ul><li>CAS 기반 원자 연산</li><li>Python 의 <code>multiprocessing.Value</code></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-77-1><a class=lnlinks href=#hl-77-1> 1</a>
</span><span class=lnt id=hl-77-2><a class=lnlinks href=#hl-77-2> 2</a>
</span><span class=lnt id=hl-77-3><a class=lnlinks href=#hl-77-3> 3</a>
</span><span class=lnt id=hl-77-4><a class=lnlinks href=#hl-77-4> 4</a>
</span><span class=lnt id=hl-77-5><a class=lnlinks href=#hl-77-5> 5</a>
</span><span class=lnt id=hl-77-6><a class=lnlinks href=#hl-77-6> 6</a>
</span><span class=lnt id=hl-77-7><a class=lnlinks href=#hl-77-7> 7</a>
</span><span class=lnt id=hl-77-8><a class=lnlinks href=#hl-77-8> 8</a>
</span><span class=lnt id=hl-77-9><a class=lnlinks href=#hl-77-9> 9</a>
</span><span class=lnt id=hl-77-10><a class=lnlinks href=#hl-77-10>10</a>
</span><span class=lnt id=hl-77-11><a class=lnlinks href=#hl-77-11>11</a>
</span><span class=lnt id=hl-77-12><a class=lnlinks href=#hl-77-12>12</a>
</span><span class=lnt id=hl-77-13><a class=lnlinks href=#hl-77-13>13</a>
</span><span class=lnt id=hl-77-14><a class=lnlinks href=#hl-77-14>14</a>
</span><span class=lnt id=hl-77-15><a class=lnlinks href=#hl-77-15>15</a>
</span><span class=lnt id=hl-77-16><a class=lnlinks href=#hl-77-16>16</a>
</span><span class=lnt id=hl-77-17><a class=lnlinks href=#hl-77-17>17</a>
</span><span class=lnt id=hl-77-18><a class=lnlinks href=#hl-77-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>multiprocessing</span> <span class=kn>import</span> <span class=n>Value</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>multiprocessing</span> <span class=kn>import</span> <span class=n>Process</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>counter</span> <span class=o>=</span> <span class=n>Value</span><span class=p>(</span><span class=s1>&#39;i&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>increment</span><span class=p>(</span><span class=n>counter</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>counter</span><span class=o>.</span><span class=n>get_lock</span><span class=p>():</span>  <span class=c1># 내부적으로 atomic</span>
</span></span><span class=line><span class=cl>            <span class=n>counter</span><span class=o>.</span><span class=n>value</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>Process</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>increment</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>counter</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>Process</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>increment</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>counter</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Final count:&#34;</span><span class=p>,</span> <span class=n>counter</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=분산-락-예시>분산 락 예시<a hidden class=anchor aria-hidden=true href=#분산-락-예시>#</a></h4><ul><li>Redis Redlock (Python + Redis)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-78-1><a class=lnlinks href=#hl-78-1> 1</a>
</span><span class=lnt id=hl-78-2><a class=lnlinks href=#hl-78-2> 2</a>
</span><span class=lnt id=hl-78-3><a class=lnlinks href=#hl-78-3> 3</a>
</span><span class=lnt id=hl-78-4><a class=lnlinks href=#hl-78-4> 4</a>
</span><span class=lnt id=hl-78-5><a class=lnlinks href=#hl-78-5> 5</a>
</span><span class=lnt id=hl-78-6><a class=lnlinks href=#hl-78-6> 6</a>
</span><span class=lnt id=hl-78-7><a class=lnlinks href=#hl-78-7> 7</a>
</span><span class=lnt id=hl-78-8><a class=lnlinks href=#hl-78-8> 8</a>
</span><span class=lnt id=hl-78-9><a class=lnlinks href=#hl-78-9> 9</a>
</span><span class=lnt id=hl-78-10><a class=lnlinks href=#hl-78-10>10</a>
</span><span class=lnt id=hl-78-11><a class=lnlinks href=#hl-78-11>11</a>
</span><span class=lnt id=hl-78-12><a class=lnlinks href=#hl-78-12>12</a>
</span><span class=lnt id=hl-78-13><a class=lnlinks href=#hl-78-13>13</a>
</span><span class=lnt id=hl-78-14><a class=lnlinks href=#hl-78-14>14</a>
</span><span class=lnt id=hl-78-15><a class=lnlinks href=#hl-78-15>15</a>
</span><span class=lnt id=hl-78-16><a class=lnlinks href=#hl-78-16>16</a>
</span><span class=lnt id=hl-78-17><a class=lnlinks href=#hl-78-17>17</a>
</span><span class=lnt id=hl-78-18><a class=lnlinks href=#hl-78-18>18</a>
</span><span class=lnt id=hl-78-19><a class=lnlinks href=#hl-78-19>19</a>
</span><span class=lnt id=hl-78-20><a class=lnlinks href=#hl-78-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>lock_key</span> <span class=o>=</span> <span class=s2>&#34;my-distributed-lock&#34;</span>
</span></span><span class=line><span class=cl><span class=n>lock_value</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 락 획득 (5초 동안 유효)</span>
</span></span><span class=line><span class=cl><span class=n>is_locked</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span> <span class=n>lock_value</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ex</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>is_locked</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Lock acquired - doing critical work&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span> <span class=o>==</span> <span class=n>lock_value</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>client</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Lock already held by another process&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>Redlock</code> 알고리즘 기반으로 확장 가능하며, 멀티 Redis 인스턴스에서의 분산 락 보장.</li></ul><h4 id=race-condition-감지-테스트>Race Condition 감지 테스트<a hidden class=anchor aria-hidden=true href=#race-condition-감지-테스트>#</a></h4><ul><li>Python <code>threading</code></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-79-1><a class=lnlinks href=#hl-79-1> 1</a>
</span><span class=lnt id=hl-79-2><a class=lnlinks href=#hl-79-2> 2</a>
</span><span class=lnt id=hl-79-3><a class=lnlinks href=#hl-79-3> 3</a>
</span><span class=lnt id=hl-79-4><a class=lnlinks href=#hl-79-4> 4</a>
</span><span class=lnt id=hl-79-5><a class=lnlinks href=#hl-79-5> 5</a>
</span><span class=lnt id=hl-79-6><a class=lnlinks href=#hl-79-6> 6</a>
</span><span class=lnt id=hl-79-7><a class=lnlinks href=#hl-79-7> 7</a>
</span><span class=lnt id=hl-79-8><a class=lnlinks href=#hl-79-8> 8</a>
</span><span class=lnt id=hl-79-9><a class=lnlinks href=#hl-79-9> 9</a>
</span><span class=lnt id=hl-79-10><a class=lnlinks href=#hl-79-10>10</a>
</span><span class=lnt id=hl-79-11><a class=lnlinks href=#hl-79-11>11</a>
</span><span class=lnt id=hl-79-12><a class=lnlinks href=#hl-79-12>12</a>
</span><span class=lnt id=hl-79-13><a class=lnlinks href=#hl-79-13>13</a>
</span><span class=lnt id=hl-79-14><a class=lnlinks href=#hl-79-14>14</a>
</span><span class=lnt id=hl-79-15><a class=lnlinks href=#hl-79-15>15</a>
</span><span class=lnt id=hl-79-16><a class=lnlinks href=#hl-79-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>race_increment</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>count</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>  <span class=c1># 경쟁 조건 발생 가능</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>=</span> <span class=p>[</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>race_increment</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Expected 400000, Actual:&#34;</span><span class=p>,</span> <span class=n>count</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>이 코드는 race condition 이 발생할 수 있고, 도구 없이도 재현 실험 가능함.</li></ul><h4 id=테스트-시-락-병목-분석>테스트 시 락 병목 분석<a hidden class=anchor aria-hidden=true href=#테스트-시-락-병목-분석>#</a></h4><ul><li>Linux <code>perf lock</code> 활용</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-80-1><a class=lnlinks href=#hl-80-1>1</a>
</span><span class=lnt id=hl-80-2><a class=lnlinks href=#hl-80-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo perf lock record ./your_program
</span></span><span class=line><span class=cl>sudo perf lock report
</span></span></code></pre></td></tr></table></div></div><ul><li>실시간으로 락 대기 시간과 경합 통계를 보여주는 도구. 락 병목 식별에 유용.</li></ul><h3 id=실무-환경아키텍처-기반-mutual-exclusion-적용-전략>실무 환경/아키텍처 기반 Mutual Exclusion 적용 전략<a hidden class=anchor aria-hidden=true href=#실무-환경아키텍처-기반-mutual-exclusion-적용-전략>#</a></h3><h4 id=실시간-시스템에서의-상호-배제>실시간 시스템에서의 상호 배제<a hidden class=anchor aria-hidden=true href=#실시간-시스템에서의-상호-배제>#</a></h4><p>실시간 (Real-Time) 시스템에서 과도한 대기나 블로킹은 치명적일 수 있으므로, 타임아웃, 우선순위 반전 (Priority Inversion) 해결 기법 등 별도 정책 적용이 필수다.</p><h4 id=분산-환경에서의-상호-배제-구조>분산 환경에서의 상호 배제 구조<a hidden class=anchor aria-hidden=true href=#분산-환경에서의-상호-배제-구조>#</a></h4><pre class=mermaid>flowchart LR
    subgraph Cluster1
        A1[App1]
        A2[App2]
    end
    subgraph Cluster2
        B1[App3]
        B2[App4]
    end
    Redis[Redis/Etcd/Zookeeper분산 락 서비스]
    DB[공유 DB/파일시스템]
    A1 --락 요청/해제--&gt; Redis
    A2 --락 요청/해제--&gt; Redis
    B1 --락 요청/해제--&gt; Redis
    B2 --락 요청/해제--&gt; Redis
    Redis --락 허용/거부--&gt; A1
    Redis --락 허용/거부--&gt; B2
    A1 --임계구역 작업--&gt; DB
    B2 --임계구역 작업--&gt; DB
</pre><blockquote><p>여러 애플리케이션 인스턴스가 동일 분산 락 서비스를 통해 락의 소유권을 조정하며, 락 획득 시에만 공유 자원 (DB) 에 접근합니다. 네트워크 장애 등 극한 상황 대비가 중요하다.</p></blockquote><h4 id=컨테이너-기반-환경-kubernetes-docker-등>컨테이너 기반 환경 (Kubernetes, Docker 등)<a hidden class=anchor aria-hidden=true href=#컨테이너-기반-환경-kubernetes-docker-등>#</a></h4><table><thead><tr><th>적용 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>분산 락 기반 리더 선출</strong></td><td>etcd, Redis, ZooKeeper 등 외부 락 시스템을 사용하여 StatefulSet, Operator 등에서 리더 노드 지정</td></tr><tr><td><strong>TTL/세션 기반 락 관리</strong></td><td>컨테이너가 중단되어도 락이 남지 않도록 TTL 과 주기적 heartbeat 를 통한 session 갱신 처리</td></tr><tr><td><strong>장애 복구/스케일 대응</strong></td><td>Pod/Node 장애나 scale-in 상황에서도 락 해제·복구가 일관성 있게 되도록 fencing token, quorum 기법 적용</td></tr></tbody></table><p><strong>보완 포인트</strong>:</p><ul><li>Sidecar 또는 Init Container 를 통해 락 획득/해제 책임을 분리하는 구조도 효과적</li><li>Redlock(Redis 기반 분산 락 알고리즘) 또는 ZAB(ZooKeeper Atomic Broadcast) 와 같은 <strong>다중 인스턴스 락 보장 알고리즘</strong> 사용 필요</li></ul><h4 id=msa-microservices-architecture-기반-시스템>MSA (Microservices Architecture) 기반 시스템<a hidden class=anchor aria-hidden=true href=#msa-microservices-architecture-기반-시스템>#</a></h4><table><thead><tr><th>적용 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>서비스 단위 동기화 분리</strong></td><td>서비스 간 공유 자원/도메인이 다르므로 전역 락과 지역 락을 구분 적용 (e.g., DB 락 vs 캐시 락)</td></tr><tr><td><strong>API 동기화 + 메시지 트랜잭션</strong></td><td>REST API 호출이나 이벤트 처리 시 멱등성 키 + 분산 락을 통해 중복 작업 방지</td></tr><tr><td><strong>Saga 패턴과 보완 연계</strong></td><td>Long-running 트랜잭션에서는 보상 트랜잭션을 통해 락 해제 또는 상태 복구를 구조화</td></tr></tbody></table><p><strong>보완 포인트</strong>:</p><ul><li>분산 트랜잭션 (DB 락) 이 아닌 <strong>Application Level 락</strong> 또는 <strong>Outbox 패턴 + 락</strong> 으로 접근</li><li>Kafka 등 사용 시 <strong>Partition 기반 순서 보장</strong>을 함께 고려하여 상호 배제 간섭 최소화</li></ul><h4 id=serverless--event-driven-architecture>Serverless & Event-driven Architecture<a hidden class=anchor aria-hidden=true href=#serverless--event-driven-architecture>#</a></h4><table><thead><tr><th>적용 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>짧은 함수 호출 간 원자성 보장</strong></td><td>Lambda, Cloud Functions 에서는 실행 단위 간 경합을 막기 위해 Redis/DynamoDB 기반 락 사용</td></tr><tr><td><strong>이벤트 순서/중복 방지</strong></td><td>락과 checkpoint/offset 기반 처리를 통해 메시지 재처리, out-of-order 문제 예방</td></tr><tr><td><strong>락 없이 멱등성 우선 접근</strong></td><td>lock 보다 비용이 적은 key-based 멱등성 검증이 선호되며, 필요시 fallback 구조에 락을 결합 사용</td></tr></tbody></table><p><strong>보완 포인트</strong>:</p><ul><li>Step Functions, Durable Functions 등 <strong>stateful workflow 시스템 내에서 자동 상호 배제 제어</strong> 가능</li><li>락보다는 <strong>큐와 상태머신 조합 + TTL 기반 처리</strong>가 확장성과 비용 측면에서 효과적일 수 있음</li></ul><h4 id=코드-레벨-구현-패턴>코드 레벨 구현 패턴<a hidden class=anchor aria-hidden=true href=#코드-레벨-구현-패턴>#</a></h4><table><thead><tr><th>적용 항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>원자성 보장 API 사용</strong></td><td>Python <code>with threading.Lock()</code>, Java <code>ReentrantLock</code>, JS 에서는 async-mutex 패턴 사용</td></tr><tr><td><strong>락 획득 실패 처리 (Fallback)</strong></td><td>재시도, 타임아웃 후 대체 로직 처리 (알림, 작업 대기 큐, 다른 경로 처리 등)</td></tr><tr><td><strong>락 범위 최소화</strong></td><td>임계 구역 최소화를 통해 성능 병목 줄이고, deadlock 가능성 감소</td></tr></tbody></table><p><strong>보완 포인트</strong>:</p><ul><li>락 분할 (Split Lock), 읽기/쓰기 락 (Read/Write Lock) 등 <strong>락 범위를 논리적으로 최소화하는 리팩토링 패턴 적용</strong></li><li>실시간 처리 필요 시, <strong>락 대기 없는 optimistic lock 구조</strong>도 고려해야 함</li></ul><h4 id=참고할-수-있는-실전-코드-패턴-python-기반>참고할 수 있는 실전 코드 패턴 (Python 기반)<a hidden class=anchor aria-hidden=true href=#참고할-수-있는-실전-코드-패턴-python-기반>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-82-1><a class=lnlinks href=#hl-82-1> 1</a>
</span><span class=lnt id=hl-82-2><a class=lnlinks href=#hl-82-2> 2</a>
</span><span class=lnt id=hl-82-3><a class=lnlinks href=#hl-82-3> 3</a>
</span><span class=lnt id=hl-82-4><a class=lnlinks href=#hl-82-4> 4</a>
</span><span class=lnt id=hl-82-5><a class=lnlinks href=#hl-82-5> 5</a>
</span><span class=lnt id=hl-82-6><a class=lnlinks href=#hl-82-6> 6</a>
</span><span class=lnt id=hl-82-7><a class=lnlinks href=#hl-82-7> 7</a>
</span><span class=lnt id=hl-82-8><a class=lnlinks href=#hl-82-8> 8</a>
</span><span class=lnt id=hl-82-9><a class=lnlinks href=#hl-82-9> 9</a>
</span><span class=lnt id=hl-82-10><a class=lnlinks href=#hl-82-10>10</a>
</span><span class=lnt id=hl-82-11><a class=lnlinks href=#hl-82-11>11</a>
</span><span class=lnt id=hl-82-12><a class=lnlinks href=#hl-82-12>12</a>
</span><span class=lnt id=hl-82-13><a class=lnlinks href=#hl-82-13>13</a>
</span><span class=lnt id=hl-82-14><a class=lnlinks href=#hl-82-14>14</a>
</span><span class=lnt id=hl-82-15><a class=lnlinks href=#hl-82-15>15</a>
</span><span class=lnt id=hl-82-16><a class=lnlinks href=#hl-82-16>16</a>
</span><span class=lnt id=hl-82-17><a class=lnlinks href=#hl-82-17>17</a>
</span><span class=lnt id=hl-82-18><a class=lnlinks href=#hl-82-18>18</a>
</span><span class=lnt id=hl-82-19><a class=lnlinks href=#hl-82-19>19</a>
</span><span class=lnt id=hl-82-20><a class=lnlinks href=#hl-82-20>20</a>
</span><span class=lnt id=hl-82-21><a class=lnlinks href=#hl-82-21>21</a>
</span><span class=lnt id=hl-82-22><a class=lnlinks href=#hl-82-22>22</a>
</span><span class=lnt id=hl-82-23><a class=lnlinks href=#hl-82-23>23</a>
</span><span class=lnt id=hl-82-24><a class=lnlinks href=#hl-82-24>24</a>
</span><span class=lnt id=hl-82-25><a class=lnlinks href=#hl-82-25>25</a>
</span><span class=lnt id=hl-82-26><a class=lnlinks href=#hl-82-26>26</a>
</span><span class=lnt id=hl-82-27><a class=lnlinks href=#hl-82-27>27</a>
</span><span class=lnt id=hl-82-28><a class=lnlinks href=#hl-82-28>28</a>
</span><span class=lnt id=hl-82-29><a class=lnlinks href=#hl-82-29>29</a>
</span><span class=lnt id=hl-82-30><a class=lnlinks href=#hl-82-30>30</a>
</span><span class=lnt id=hl-82-31><a class=lnlinks href=#hl-82-31>31</a>
</span><span class=lnt id=hl-82-32><a class=lnlinks href=#hl-82-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>StrictRedis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>acquire_distributed_lock</span><span class=p>(</span><span class=n>lock_name</span><span class=p>,</span> <span class=n>ttl</span><span class=o>=</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>token</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span> <span class=c1># 고유 토큰</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># setnx + expire = set(key, value, nx, ex)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>lock_name</span><span class=p>,</span> <span class=n>token</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ex</span><span class=o>=</span><span class=n>ttl</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>token</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.05</span><span class=p>)</span> <span class=c1># 짧은 대기 후 재시도</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>release_distributed_lock</span><span class=p>(</span><span class=n>lock_name</span><span class=p>,</span> <span class=n>token</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Lua script로 원자적으로만 해제!</span>
</span></span><span class=line><span class=cl>    <span class=n>script</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    if redis.call(&#39;get&#39;, KEYS[1]) == ARGV[1]
</span></span></span><span class=line><span class=cl><span class=s2>    then
</span></span></span><span class=line><span class=cl><span class=s2>        return redis.call(&#39;del&#39;, KEYS[1])
</span></span></span><span class=line><span class=cl><span class=s2>    else
</span></span></span><span class=line><span class=cl><span class=s2>        return 0
</span></span></span><span class=line><span class=cl><span class=s2>    end
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>eval</span><span class=p>(</span><span class=n>script</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>lock_name</span><span class=p>,</span> <span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>acquire_distributed_lock</span><span class=p>(</span><span class=s2>&#34;mykey&#34;</span><span class=p>,</span> <span class=n>ttl</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 임계구역(critical section)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;임계구역 실행 중&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>release_distributed_lock</span><span class=p>(</span><span class=s2>&#34;mykey&#34;</span><span class=p>,</span> <span class=n>lock</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>락 소유권 검증, TTL, 네트워크 메시지의 원자성 보장을 위해 Lua 스크립트를 활용.</p></blockquote><h3 id=최적화-위한-고려사항-및-주의사항>최적화 위한 고려사항 및 주의사항<a hidden class=anchor aria-hidden=true href=#최적화-위한-고려사항-및-주의사항>#</a></h3><table><thead><tr><th>카테고리</th><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>1. 성능 최적화</strong></td><td>임계 구역 최소화</td><td>락이 보호하는 코드 범위가 클수록 병목 발생</td><td>보호 범위를 최소화하고 순수 계산 로직은 분리</td></tr><tr><td></td><td>Spinlock vs Blocking</td><td>짧은 작업엔 spinlock, 긴 작업은 mutex 적합</td><td>adaptive mutex, 일정 시간 후 블로킹으로 전환</td></tr><tr><td></td><td>경량 락 사용 (Lightweight Lock)</td><td>context switching 오버헤드 줄이기 위함</td><td>Spinlock, optimistic locking 등 활용</td></tr><tr><td></td><td>CAS 활용</td><td>락 대신 Compare-and-Swap 으로 원자성 확보</td><td>CAS 기반 lock-free 자료구조, 비블로킹 알고리즘 적용</td></tr><tr><td></td><td>락 프리 자료구조 활용</td><td>공유 자원 접근에서 락을 제거하여 병렬성 향상</td><td>CAS, FAA 기반 검증된 lock-free 라이브러리 사용</td></tr><tr><td></td><td>Lock Striping</td><td>공유 자원별로 락을 나눠 경합 감소</td><td>세분화된 락 배치로 경합 최소화</td></tr><tr><td><strong>2. 구조적 설계 전략</strong></td><td>읽기/쓰기 분리 (RWLock)</td><td>읽기 작업은 병렬 허용, 쓰기만 단독 허용</td><td>read-heavy 상황에 적합, 읽기 병렬화 유도</td></tr><tr><td></td><td>우선순위 관리</td><td>우선순위 역전 방지</td><td>Priority Inheritance, Ceiling Protocol 등 적용</td></tr><tr><td></td><td>병렬성 증대</td><td>락이 병렬 처리 방해하지 않도록 구조 설계</td><td>작업 파티셔닝, lock 분리, 분할 정복 기반 병렬화</td></tr><tr><td></td><td>낙관적 동시성 제어</td><td>충돌 확률 낮을 경우 락 없이 먼저 실행, 실패 시 롤백</td><td>Try-Commit-Abort(TCA), 버전 관리 기반 접근</td></tr><tr><td><strong>3. 분산 시스템 환경</strong></td><td>메시지 오버헤드 최소화</td><td>분산 환경에선 메시지 수가 지연과 부하 초래</td><td>quorum, token 기반 알고리즘 활용</td></tr><tr><td></td><td>네트워크 장애 대응</td><td>분산 락에서 network partition 시 전체 hang 가능</td><td>fencing token, 타임아웃, 리더 선출 재시도 등 failover 설계 적용</td></tr><tr><td></td><td>동적 트래픽 대응</td><td>고정된 락 정책은 부하 변화에 취약</td><td>adaptive locking (Singhal&rsquo;s 등), contention-based strategy 적용</td></tr><tr><td><strong>4. 동적 적응성/하이브리드</strong></td><td>Adaptive Mutex</td><td>부하에 따라 spin ↔ block 전환</td><td>락 보유 시간, 대기열 길이, 트래픽 기반 조건부 전환 로직</td></tr><tr><td></td><td>Hybrid Locking 전략</td><td>하나의 정책만으론 모든 상황에 비효율</td><td>workload 따라 다단계 락 전략 적용</td></tr><tr><td><strong>5. 검증/모니터링</strong></td><td>락 경합/데드락 모니터링</td><td>런타임 중 병목 지점 파악 위해 필요</td><td>경합 추적 도구, Deadlock analyzer, 로그 기반 분석 도구 도입</td></tr><tr><td></td><td>타임아웃 적용</td><td>무한 대기 방지, 실패 시 재시도/회복 가능</td><td>임계 구역 진입 시 timeout 제한 및 retry 정책 적용</td></tr><tr><td></td><td>스트레스/퍼지 테스트</td><td>동시성 오류 재현은 비결정성으로 인해 어려움</td><td>fuzzing, model checker, race condition 검출 도구 활용</td></tr><tr><td></td><td>동시성 프로파일링</td><td>병목 위치와 락 사용 분석</td><td>lock profiler, tracing, latency 시각화 도구 활용</td></tr></tbody></table><ol><li><p><strong>성능 최적화</strong><br>임계 구역을 가능한 작게 유지하고, spinlock 이나 CAS 기반 락프리 기법을 적절히 사용하면 context switch 나 thread contention 을 줄일 수 있다. 락 오버헤드를 줄이기 위해 Lock Striping, CAS 연산 기반 자료구조를 적극 활용한다.</p></li><li><p><strong>구조적 설계 전략</strong><br>락 경합을 줄이기 위해 읽기/쓰기 분리, 우선순위 기반 락 정책, 파티셔닝 기반 병렬화 등을 고려해야 한다. 특히 읽기 중심 시스템은 RWLock 을 활용해 효율성을 높이며, 충돌 가능성이 낮은 시스템은 낙관적 동시성 제어 기법으로 락 자체를 줄일 수 있다.</p></li><li><p><strong>분산 시스템 환경</strong><br>분산 환경에서는 락을 위한 메시지 수가 성능 저하로 이어질 수 있으므로 token 기반 또는 quorum 기반의 알고리즘을 활용하고, 네트워크 장애에 대비해 fencing token 및 failover 정책이 필수적이다. 또한 트래픽 변화에 대응할 수 있는 동적 알고리즘이 중요하다.</p></li><li><p><strong>동적 적응성/하이브리드</strong><br>하나의 락 정책으로 모든 상황에 대응하기 어렵기 때문에, 시스템 상황에 따라 적응적으로 spin ↔ block 을 전환하는 Adaptive Mutex 나 Hybrid Locking 전략이 매우 효과적이다.</p></li><li><p><strong>검증/모니터링</strong><br>락 병목, 데드락 등의 이슈는 런타임 분석과 로그 기반 추적이 핵심이다. APM 도구, 락 분석 도구, 동시성 퍼징 테스트 등을 통해 동시성 이슈를 미리 식별하고 구조적으로 보완해야 한다. 테스트 시에는 race condition 발생 가능성에 대비한 정형 검증과 자동화된 퍼징이 유용하다.</p></li></ol><h4 id=spinlock-vs-mutex>Spinlock Vs Mutex<a hidden class=anchor aria-hidden=true href=#spinlock-vs-mutex>#</a></h4><ul><li>짧은 임계구역 → Spinlock</li><li>긴 임계구역 → Mutex</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-83-1><a class=lnlinks href=#hl-83-1> 1</a>
</span><span class=lnt id=hl-83-2><a class=lnlinks href=#hl-83-2> 2</a>
</span><span class=lnt id=hl-83-3><a class=lnlinks href=#hl-83-3> 3</a>
</span><span class=lnt id=hl-83-4><a class=lnlinks href=#hl-83-4> 4</a>
</span><span class=lnt id=hl-83-5><a class=lnlinks href=#hl-83-5> 5</a>
</span><span class=lnt id=hl-83-6><a class=lnlinks href=#hl-83-6> 6</a>
</span><span class=lnt id=hl-83-7><a class=lnlinks href=#hl-83-7> 7</a>
</span><span class=lnt id=hl-83-8><a class=lnlinks href=#hl-83-8> 8</a>
</span><span class=lnt id=hl-83-9><a class=lnlinks href=#hl-83-9> 9</a>
</span><span class=lnt id=hl-83-10><a class=lnlinks href=#hl-83-10>10</a>
</span><span class=lnt id=hl-83-11><a class=lnlinks href=#hl-83-11>11</a>
</span><span class=lnt id=hl-83-12><a class=lnlinks href=#hl-83-12>12</a>
</span><span class=lnt id=hl-83-13><a class=lnlinks href=#hl-83-13>13</a>
</span><span class=lnt id=hl-83-14><a class=lnlinks href=#hl-83-14>14</a>
</span><span class=lnt id=hl-83-15><a class=lnlinks href=#hl-83-15>15</a>
</span><span class=lnt id=hl-83-16><a class=lnlinks href=#hl-83-16>16</a>
</span><span class=lnt id=hl-83-17><a class=lnlinks href=#hl-83-17>17</a>
</span><span class=lnt id=hl-83-18><a class=lnlinks href=#hl-83-18>18</a>
</span><span class=lnt id=hl-83-19><a class=lnlinks href=#hl-83-19>19</a>
</span><span class=lnt id=hl-83-20><a class=lnlinks href=#hl-83-20>20</a>
</span><span class=lnt id=hl-83-21><a class=lnlinks href=#hl-83-21>21</a>
</span><span class=lnt id=hl-83-22><a class=lnlinks href=#hl-83-22>22</a>
</span><span class=lnt id=hl-83-23><a class=lnlinks href=#hl-83-23>23</a>
</span><span class=lnt id=hl-83-24><a class=lnlinks href=#hl-83-24>24</a>
</span><span class=lnt id=hl-83-25><a class=lnlinks href=#hl-83-25>25</a>
</span><span class=lnt id=hl-83-26><a class=lnlinks href=#hl-83-26>26</a>
</span><span class=lnt id=hl-83-27><a class=lnlinks href=#hl-83-27>27</a>
</span><span class=lnt id=hl-83-28><a class=lnlinks href=#hl-83-28>28</a>
</span><span class=lnt id=hl-83-29><a class=lnlinks href=#hl-83-29>29</a>
</span><span class=lnt id=hl-83-30><a class=lnlinks href=#hl-83-30>30</a>
</span><span class=lnt id=hl-83-31><a class=lnlinks href=#hl-83-31>31</a>
</span><span class=lnt id=hl-83-32><a class=lnlinks href=#hl-83-32>32</a>
</span><span class=lnt id=hl-83-33><a class=lnlinks href=#hl-83-33>33</a>
</span><span class=lnt id=hl-83-34><a class=lnlinks href=#hl-83-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Spinlock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>locked</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>locked</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>locked</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.0001</span><span class=p>)</span>  <span class=c1># CPU 낭비 줄이기 위해 sleep</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>locked</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 예제: 짧은 작업에 Spinlock 사용</span>
</span></span><span class=line><span class=cl><span class=n>spin</span> <span class=o>=</span> <span class=n>Spinlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>critical_section_with_spin</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>spin</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> entered&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 짧은 임계 구역</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>spin</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> exited&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 스레드 실행</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>critical_section_with_spin</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=cas-기반-lock-free-stack>CAS 기반 Lock-Free Stack<a hidden class=anchor aria-hidden=true href=#cas-기반-lock-free-stack>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-84-1><a class=lnlinks href=#hl-84-1> 1</a>
</span><span class=lnt id=hl-84-2><a class=lnlinks href=#hl-84-2> 2</a>
</span><span class=lnt id=hl-84-3><a class=lnlinks href=#hl-84-3> 3</a>
</span><span class=lnt id=hl-84-4><a class=lnlinks href=#hl-84-4> 4</a>
</span><span class=lnt id=hl-84-5><a class=lnlinks href=#hl-84-5> 5</a>
</span><span class=lnt id=hl-84-6><a class=lnlinks href=#hl-84-6> 6</a>
</span><span class=lnt id=hl-84-7><a class=lnlinks href=#hl-84-7> 7</a>
</span><span class=lnt id=hl-84-8><a class=lnlinks href=#hl-84-8> 8</a>
</span><span class=lnt id=hl-84-9><a class=lnlinks href=#hl-84-9> 9</a>
</span><span class=lnt id=hl-84-10><a class=lnlinks href=#hl-84-10>10</a>
</span><span class=lnt id=hl-84-11><a class=lnlinks href=#hl-84-11>11</a>
</span><span class=lnt id=hl-84-12><a class=lnlinks href=#hl-84-12>12</a>
</span><span class=lnt id=hl-84-13><a class=lnlinks href=#hl-84-13>13</a>
</span><span class=lnt id=hl-84-14><a class=lnlinks href=#hl-84-14>14</a>
</span><span class=lnt id=hl-84-15><a class=lnlinks href=#hl-84-15>15</a>
</span><span class=lnt id=hl-84-16><a class=lnlinks href=#hl-84-16>16</a>
</span><span class=lnt id=hl-84-17><a class=lnlinks href=#hl-84-17>17</a>
</span><span class=lnt id=hl-84-18><a class=lnlinks href=#hl-84-18>18</a>
</span><span class=lnt id=hl-84-19><a class=lnlinks href=#hl-84-19>19</a>
</span><span class=lnt id=hl-84-20><a class=lnlinks href=#hl-84-20>20</a>
</span><span class=lnt id=hl-84-21><a class=lnlinks href=#hl-84-21>21</a>
</span><span class=lnt id=hl-84-22><a class=lnlinks href=#hl-84-22>22</a>
</span><span class=lnt id=hl-84-23><a class=lnlinks href=#hl-84-23>23</a>
</span><span class=lnt id=hl-84-24><a class=lnlinks href=#hl-84-24>24</a>
</span><span class=lnt id=hl-84-25><a class=lnlinks href=#hl-84-25>25</a>
</span><span class=lnt id=hl-84-26><a class=lnlinks href=#hl-84-26>26</a>
</span><span class=lnt id=hl-84-27><a class=lnlinks href=#hl-84-27>27</a>
</span><span class=lnt id=hl-84-28><a class=lnlinks href=#hl-84-28>28</a>
</span><span class=lnt id=hl-84-29><a class=lnlinks href=#hl-84-29>29</a>
</span><span class=lnt id=hl-84-30><a class=lnlinks href=#hl-84-30>30</a>
</span><span class=lnt id=hl-84-31><a class=lnlinks href=#hl-84-31>31</a>
</span><span class=lnt id=hl-84-32><a class=lnlinks href=#hl-84-32>32</a>
</span><span class=lnt id=hl-84-33><a class=lnlinks href=#hl-84-33>33</a>
</span><span class=lnt id=hl-84-34><a class=lnlinks href=#hl-84-34>34</a>
</span><span class=lnt id=hl-84-35><a class=lnlinks href=#hl-84-35>35</a>
</span><span class=lnt id=hl-84-36><a class=lnlinks href=#hl-84-36>36</a>
</span><span class=lnt id=hl-84-37><a class=lnlinks href=#hl-84-37>37</a>
</span><span class=lnt id=hl-84-38><a class=lnlinks href=#hl-84-38>38</a>
</span><span class=lnt id=hl-84-39><a class=lnlinks href=#hl-84-39>39</a>
</span><span class=lnt id=hl-84-40><a class=lnlinks href=#hl-84-40>40</a>
</span><span class=lnt id=hl-84-41><a class=lnlinks href=#hl-84-41>41</a>
</span><span class=lnt id=hl-84-42><a class=lnlinks href=#hl-84-42>42</a>
</span><span class=lnt id=hl-84-43><a class=lnlinks href=#hl-84-43>43</a>
</span><span class=lnt id=hl-84-44><a class=lnlinks href=#hl-84-44>44</a>
</span><span class=lnt id=hl-84-45><a class=lnlinks href=#hl-84-45>45</a>
</span><span class=lnt id=hl-84-46><a class=lnlinks href=#hl-84-46>46</a>
</span><span class=lnt id=hl-84-47><a class=lnlinks href=#hl-84-47>47</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Node</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>next_node</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>next</span> <span class=o>=</span> <span class=n>next_node</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LockFreeStack</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>top</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Node</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>push</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>  <span class=c1># 실제 환경에선 CAS 사용해야 함 (Python은 GIL로 제약)</span>
</span></span><span class=line><span class=cl>                <span class=n>new_node</span> <span class=o>=</span> <span class=n>Node</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>top</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>top</span> <span class=o>=</span> <span class=n>new_node</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>pop</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>top</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>                <span class=n>value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>top</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>top</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>top</span><span class=o>.</span><span class=n>next</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>stack</span> <span class=o>=</span> <span class=n>LockFreeStack</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>push_worker</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>stack</span><span class=o>.</span><span class=n>push</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pop_worker</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Popped: </span><span class=si>{</span><span class=n>stack</span><span class=o>.</span><span class=n>pop</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>push_worker</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>t2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>pop_worker</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>t2</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>t1</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>t2</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=rwlock-구현-읽기쓰기-분리>RWLock 구현 (읽기/쓰기 분리)<a hidden class=anchor aria-hidden=true href=#rwlock-구현-읽기쓰기-분리>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-85-1><a class=lnlinks href=#hl-85-1> 1</a>
</span><span class=lnt id=hl-85-2><a class=lnlinks href=#hl-85-2> 2</a>
</span><span class=lnt id=hl-85-3><a class=lnlinks href=#hl-85-3> 3</a>
</span><span class=lnt id=hl-85-4><a class=lnlinks href=#hl-85-4> 4</a>
</span><span class=lnt id=hl-85-5><a class=lnlinks href=#hl-85-5> 5</a>
</span><span class=lnt id=hl-85-6><a class=lnlinks href=#hl-85-6> 6</a>
</span><span class=lnt id=hl-85-7><a class=lnlinks href=#hl-85-7> 7</a>
</span><span class=lnt id=hl-85-8><a class=lnlinks href=#hl-85-8> 8</a>
</span><span class=lnt id=hl-85-9><a class=lnlinks href=#hl-85-9> 9</a>
</span><span class=lnt id=hl-85-10><a class=lnlinks href=#hl-85-10>10</a>
</span><span class=lnt id=hl-85-11><a class=lnlinks href=#hl-85-11>11</a>
</span><span class=lnt id=hl-85-12><a class=lnlinks href=#hl-85-12>12</a>
</span><span class=lnt id=hl-85-13><a class=lnlinks href=#hl-85-13>13</a>
</span><span class=lnt id=hl-85-14><a class=lnlinks href=#hl-85-14>14</a>
</span><span class=lnt id=hl-85-15><a class=lnlinks href=#hl-85-15>15</a>
</span><span class=lnt id=hl-85-16><a class=lnlinks href=#hl-85-16>16</a>
</span><span class=lnt id=hl-85-17><a class=lnlinks href=#hl-85-17>17</a>
</span><span class=lnt id=hl-85-18><a class=lnlinks href=#hl-85-18>18</a>
</span><span class=lnt id=hl-85-19><a class=lnlinks href=#hl-85-19>19</a>
</span><span class=lnt id=hl-85-20><a class=lnlinks href=#hl-85-20>20</a>
</span><span class=lnt id=hl-85-21><a class=lnlinks href=#hl-85-21>21</a>
</span><span class=lnt id=hl-85-22><a class=lnlinks href=#hl-85-22>22</a>
</span><span class=lnt id=hl-85-23><a class=lnlinks href=#hl-85-23>23</a>
</span><span class=lnt id=hl-85-24><a class=lnlinks href=#hl-85-24>24</a>
</span><span class=lnt id=hl-85-25><a class=lnlinks href=#hl-85-25>25</a>
</span><span class=lnt id=hl-85-26><a class=lnlinks href=#hl-85-26>26</a>
</span><span class=lnt id=hl-85-27><a class=lnlinks href=#hl-85-27>27</a>
</span><span class=lnt id=hl-85-28><a class=lnlinks href=#hl-85-28>28</a>
</span><span class=lnt id=hl-85-29><a class=lnlinks href=#hl-85-29>29</a>
</span><span class=lnt id=hl-85-30><a class=lnlinks href=#hl-85-30>30</a>
</span><span class=lnt id=hl-85-31><a class=lnlinks href=#hl-85-31>31</a>
</span><span class=lnt id=hl-85-32><a class=lnlinks href=#hl-85-32>32</a>
</span><span class=lnt id=hl-85-33><a class=lnlinks href=#hl-85-33>33</a>
</span><span class=lnt id=hl-85-34><a class=lnlinks href=#hl-85-34>34</a>
</span><span class=lnt id=hl-85-35><a class=lnlinks href=#hl-85-35>35</a>
</span><span class=lnt id=hl-85-36><a class=lnlinks href=#hl-85-36>36</a>
</span><span class=lnt id=hl-85-37><a class=lnlinks href=#hl-85-37>37</a>
</span><span class=lnt id=hl-85-38><a class=lnlinks href=#hl-85-38>38</a>
</span><span class=lnt id=hl-85-39><a class=lnlinks href=#hl-85-39>39</a>
</span><span class=lnt id=hl-85-40><a class=lnlinks href=#hl-85-40>40</a>
</span><span class=lnt id=hl-85-41><a class=lnlinks href=#hl-85-41>41</a>
</span><span class=lnt id=hl-85-42><a class=lnlinks href=#hl-85-42>42</a>
</span><span class=lnt id=hl-85-43><a class=lnlinks href=#hl-85-43>43</a>
</span><span class=lnt id=hl-85-44><a class=lnlinks href=#hl-85-44>44</a>
</span><span class=lnt id=hl-85-45><a class=lnlinks href=#hl-85-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RWLock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>readers</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>writelock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire_read</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>readers</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>readers</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>writelock</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release_read</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>readers</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>readers</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>writelock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire_write</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>writelock</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release_write</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>writelock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 예제</span>
</span></span><span class=line><span class=cl><span class=n>rwlock</span> <span class=o>=</span> <span class=n>RWLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>reader</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>rwlock</span><span class=o>.</span><span class=n>acquire_read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> reading&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rwlock</span><span class=o>.</span><span class=n>release_read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>writer</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>rwlock</span><span class=o>.</span><span class=n>acquire_write</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> writing&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rwlock</span><span class=o>.</span><span class=n>release_write</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>reader</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>writer</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=timeout-기반-데드락-회피>Timeout 기반 데드락 회피<a hidden class=anchor aria-hidden=true href=#timeout-기반-데드락-회피>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-86-1><a class=lnlinks href=#hl-86-1> 1</a>
</span><span class=lnt id=hl-86-2><a class=lnlinks href=#hl-86-2> 2</a>
</span><span class=lnt id=hl-86-3><a class=lnlinks href=#hl-86-3> 3</a>
</span><span class=lnt id=hl-86-4><a class=lnlinks href=#hl-86-4> 4</a>
</span><span class=lnt id=hl-86-5><a class=lnlinks href=#hl-86-5> 5</a>
</span><span class=lnt id=hl-86-6><a class=lnlinks href=#hl-86-6> 6</a>
</span><span class=lnt id=hl-86-7><a class=lnlinks href=#hl-86-7> 7</a>
</span><span class=lnt id=hl-86-8><a class=lnlinks href=#hl-86-8> 8</a>
</span><span class=lnt id=hl-86-9><a class=lnlinks href=#hl-86-9> 9</a>
</span><span class=lnt id=hl-86-10><a class=lnlinks href=#hl-86-10>10</a>
</span><span class=lnt id=hl-86-11><a class=lnlinks href=#hl-86-11>11</a>
</span><span class=lnt id=hl-86-12><a class=lnlinks href=#hl-86-12>12</a>
</span><span class=lnt id=hl-86-13><a class=lnlinks href=#hl-86-13>13</a>
</span><span class=lnt id=hl-86-14><a class=lnlinks href=#hl-86-14>14</a>
</span><span class=lnt id=hl-86-15><a class=lnlinks href=#hl-86-15>15</a>
</span><span class=lnt id=hl-86-16><a class=lnlinks href=#hl-86-16>16</a>
</span><span class=lnt id=hl-86-17><a class=lnlinks href=#hl-86-17>17</a>
</span><span class=lnt id=hl-86-18><a class=lnlinks href=#hl-86-18>18</a>
</span><span class=lnt id=hl-86-19><a class=lnlinks href=#hl-86-19>19</a>
</span><span class=lnt id=hl-86-20><a class=lnlinks href=#hl-86-20>20</a>
</span><span class=lnt id=hl-86-21><a class=lnlinks href=#hl-86-21>21</a>
</span><span class=lnt id=hl-86-22><a class=lnlinks href=#hl-86-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_lock_with_timeout</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>got_lock</span> <span class=o>=</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>got_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> acquired lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> released lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> timeout waiting for lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>try_lock_with_timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>t2</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>try_lock_with_timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t1</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>  <span class=c1># 락 선점 시간 차이 유도</span>
</span></span><span class=line><span class=cl><span class=n>t2</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=adaptive-mutex-시뮬레이션>Adaptive Mutex 시뮬레이션<a hidden class=anchor aria-hidden=true href=#adaptive-mutex-시뮬레이션>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-87-1><a class=lnlinks href=#hl-87-1> 1</a>
</span><span class=lnt id=hl-87-2><a class=lnlinks href=#hl-87-2> 2</a>
</span><span class=lnt id=hl-87-3><a class=lnlinks href=#hl-87-3> 3</a>
</span><span class=lnt id=hl-87-4><a class=lnlinks href=#hl-87-4> 4</a>
</span><span class=lnt id=hl-87-5><a class=lnlinks href=#hl-87-5> 5</a>
</span><span class=lnt id=hl-87-6><a class=lnlinks href=#hl-87-6> 6</a>
</span><span class=lnt id=hl-87-7><a class=lnlinks href=#hl-87-7> 7</a>
</span><span class=lnt id=hl-87-8><a class=lnlinks href=#hl-87-8> 8</a>
</span><span class=lnt id=hl-87-9><a class=lnlinks href=#hl-87-9> 9</a>
</span><span class=lnt id=hl-87-10><a class=lnlinks href=#hl-87-10>10</a>
</span><span class=lnt id=hl-87-11><a class=lnlinks href=#hl-87-11>11</a>
</span><span class=lnt id=hl-87-12><a class=lnlinks href=#hl-87-12>12</a>
</span><span class=lnt id=hl-87-13><a class=lnlinks href=#hl-87-13>13</a>
</span><span class=lnt id=hl-87-14><a class=lnlinks href=#hl-87-14>14</a>
</span><span class=lnt id=hl-87-15><a class=lnlinks href=#hl-87-15>15</a>
</span><span class=lnt id=hl-87-16><a class=lnlinks href=#hl-87-16>16</a>
</span><span class=lnt id=hl-87-17><a class=lnlinks href=#hl-87-17>17</a>
</span><span class=lnt id=hl-87-18><a class=lnlinks href=#hl-87-18>18</a>
</span><span class=lnt id=hl-87-19><a class=lnlinks href=#hl-87-19>19</a>
</span><span class=lnt id=hl-87-20><a class=lnlinks href=#hl-87-20>20</a>
</span><span class=lnt id=hl-87-21><a class=lnlinks href=#hl-87-21>21</a>
</span><span class=lnt id=hl-87-22><a class=lnlinks href=#hl-87-22>22</a>
</span><span class=lnt id=hl-87-23><a class=lnlinks href=#hl-87-23>23</a>
</span><span class=lnt id=hl-87-24><a class=lnlinks href=#hl-87-24>24</a>
</span><span class=lnt id=hl-87-25><a class=lnlinks href=#hl-87-25>25</a>
</span><span class=lnt id=hl-87-26><a class=lnlinks href=#hl-87-26>26</a>
</span><span class=lnt id=hl-87-27><a class=lnlinks href=#hl-87-27>27</a>
</span><span class=lnt id=hl-87-28><a class=lnlinks href=#hl-87-28>28</a>
</span><span class=lnt id=hl-87-29><a class=lnlinks href=#hl-87-29>29</a>
</span><span class=lnt id=hl-87-30><a class=lnlinks href=#hl-87-30>30</a>
</span><span class=lnt id=hl-87-31><a class=lnlinks href=#hl-87-31>31</a>
</span><span class=lnt id=hl-87-32><a class=lnlinks href=#hl-87-32>32</a>
</span><span class=lnt id=hl-87-33><a class=lnlinks href=#hl-87-33>33</a>
</span><span class=lnt id=hl-87-34><a class=lnlinks href=#hl-87-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AdaptiveMutex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>start_time</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>got_lock</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>got_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_time</span> <span class=o>&gt;</span> <span class=mf>0.05</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.0001</span><span class=p>)</span>  <span class=c1># spin</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>adaptive_mutex</span> <span class=o>=</span> <span class=n>AdaptiveMutex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>critical_section</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>adaptive_mutex</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> acquired&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.02</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>adaptive_mutex</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> released&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>critical_section</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=redis-기반-redlock-구현-예시>Redis 기반 Redlock 구현 예시<a hidden class=anchor aria-hidden=true href=#redis-기반-redlock-구현-예시>#</a></h4><p><strong>Redlock 은 다중 Redis 인스턴스를 활용하여 분산 락을 구현하는 알고리즘이다.</strong><br>아래는 <code>redis-py</code> 라이브러리와 <code>redlock-py</code> 를 사용한 <strong>간단한 분산 락 구현 예시</strong>이다.</p><h5 id=설치-필요>설치 필요<a hidden class=anchor aria-hidden=true href=#설치-필요>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-88-1><a class=lnlinks href=#hl-88-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install redis redlock-py
</span></span></code></pre></td></tr></table></div></div><h5 id=예제-코드>예제 코드<a hidden class=anchor aria-hidden=true href=#예제-코드>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-89-1><a class=lnlinks href=#hl-89-1> 1</a>
</span><span class=lnt id=hl-89-2><a class=lnlinks href=#hl-89-2> 2</a>
</span><span class=lnt id=hl-89-3><a class=lnlinks href=#hl-89-3> 3</a>
</span><span class=lnt id=hl-89-4><a class=lnlinks href=#hl-89-4> 4</a>
</span><span class=lnt id=hl-89-5><a class=lnlinks href=#hl-89-5> 5</a>
</span><span class=lnt id=hl-89-6><a class=lnlinks href=#hl-89-6> 6</a>
</span><span class=lnt id=hl-89-7><a class=lnlinks href=#hl-89-7> 7</a>
</span><span class=lnt id=hl-89-8><a class=lnlinks href=#hl-89-8> 8</a>
</span><span class=lnt id=hl-89-9><a class=lnlinks href=#hl-89-9> 9</a>
</span><span class=lnt id=hl-89-10><a class=lnlinks href=#hl-89-10>10</a>
</span><span class=lnt id=hl-89-11><a class=lnlinks href=#hl-89-11>11</a>
</span><span class=lnt id=hl-89-12><a class=lnlinks href=#hl-89-12>12</a>
</span><span class=lnt id=hl-89-13><a class=lnlinks href=#hl-89-13>13</a>
</span><span class=lnt id=hl-89-14><a class=lnlinks href=#hl-89-14>14</a>
</span><span class=lnt id=hl-89-15><a class=lnlinks href=#hl-89-15>15</a>
</span><span class=lnt id=hl-89-16><a class=lnlinks href=#hl-89-16>16</a>
</span><span class=lnt id=hl-89-17><a class=lnlinks href=#hl-89-17>17</a>
</span><span class=lnt id=hl-89-18><a class=lnlinks href=#hl-89-18>18</a>
</span><span class=lnt id=hl-89-19><a class=lnlinks href=#hl-89-19>19</a>
</span><span class=lnt id=hl-89-20><a class=lnlinks href=#hl-89-20>20</a>
</span><span class=lnt id=hl-89-21><a class=lnlinks href=#hl-89-21>21</a>
</span><span class=lnt id=hl-89-22><a class=lnlinks href=#hl-89-22>22</a>
</span><span class=lnt id=hl-89-23><a class=lnlinks href=#hl-89-23>23</a>
</span><span class=lnt id=hl-89-24><a class=lnlinks href=#hl-89-24>24</a>
</span><span class=lnt id=hl-89-25><a class=lnlinks href=#hl-89-25>25</a>
</span><span class=lnt id=hl-89-26><a class=lnlinks href=#hl-89-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redlock</span> <span class=kn>import</span> <span class=n>Redlock</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Redis 인스턴스 여러 개 구성 (실무에선 서로 다른 호스트를 지정해야 함)</span>
</span></span><span class=line><span class=cl><span class=n>dlm</span> <span class=o>=</span> <span class=n>Redlock</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=s2>&#34;port&#34;</span><span class=p>:</span> <span class=mi>6379</span><span class=p>,</span> <span class=s2>&#34;db&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=s2>&#34;port&#34;</span><span class=p>:</span> <span class=mi>6380</span><span class=p>,</span> <span class=s2>&#34;db&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=s2>&#34;port&#34;</span><span class=p>:</span> <span class=mi>6381</span><span class=p>,</span> <span class=s2>&#34;db&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>critical_section_with_lock</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>lock</span> <span class=o>=</span> <span class=n>dlm</span><span class=o>.</span><span class=n>lock</span><span class=p>(</span><span class=s2>&#34;resource_name&#34;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>  <span class=c1># 1000ms TTL</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> acquired lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>dlm</span><span class=o>.</span><span class=n>unlock</span><span class=p>(</span><span class=n>lock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> released lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> failed to acquire lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 여러 스레드 시뮬레이션</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>critical_section_with_lock</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>Redlock</code> 객체는 여러 Redis 인스턴스를 연결하고 <strong>Quorum(다수 노드 동의)</strong> 기반으로 락을 획득해.</li><li>락은 <strong>TTL(Time-To-Live)</strong> 을 기반으로 설정되며 자동 만료 가능.</li><li>락 획득 실패 시에는 리트라이 로직 또는 fallback 경로를 설계해야 해.</li></ul><p>실무에서는 Redis Sentinel 또는 Redis Cluster 와 함께 사용하고, Redis 장애 대비 fencing token, TTL auto-renewal 전략도 병행되어야 한다.</p><h3 id=실무-적용-예시>실무 적용 예시<a hidden class=anchor aria-hidden=true href=#실무-적용-예시>#</a></h3><table><thead><tr><th>분야</th><th>적용 사례</th><th>사용 기법/기술</th><th>목적/효과</th></tr></thead><tbody><tr><td><strong>운영체제</strong></td><td>커널 임계구역 동기화</td><td>Mutex, Spinlock, Semaphore (POSIX)</td><td>커널 자원의 안정적 보호 및 race condition 방지</td></tr><tr><td><strong>웹 서버</strong></td><td>세션 관리, 커넥션 제한</td><td>Mutex, Redis SETNX, 세마포어</td><td>동시 사용자 세션 일관성 유지 및 동시 접속 처리 보호</td></tr><tr><td><strong>데이터베이스</strong></td><td>트랜잭션 처리, 인덱스 갱신</td><td>Lock Manager, Two-Phase Locking, MVCC</td><td>데이터 정합성 확보 및 ACID 보장</td></tr><tr><td><strong>분산 시스템</strong></td><td>리더 선출, 분산 파일 접근</td><td>Zookeeper, etcd, Quorum, Paxos, Raft</td><td>클러스터 노드 간 일관성 유지 및 충돌 방지</td></tr><tr><td><strong>캐시 시스템</strong></td><td>캐시 일관성 보장</td><td>Write-through, Write-back, Redis Lock</td><td>캐시 무결성 보장 및 race condition 방지</td></tr><tr><td><strong>클라우드 인프라</strong></td><td>리소스 프로비저닝</td><td>Distributed Lock (ZK, Redis, DynamoDB)</td><td>중복 할당 방지 및 자원 충돌 방지</td></tr><tr><td><strong>멀티스레드 앱</strong></td><td>공유 메모리 접근</td><td>세마포어, Monitor, Atomic Operation</td><td>동기화 성능 최적화, 공유 데이터 정합성 유지</td></tr><tr><td><strong>IoT/임베디드</strong></td><td>센서 데이터 수집, 공유 버퍼 보호</td><td>경량 뮤텍스, CAS, Lock-Free</td><td>경량 자원 보호, 고속 응답 보장, 무결성 유지</td></tr><tr><td><strong>마이크로서비스</strong></td><td>서비스 디스커버리, 리더 선출</td><td>Distributed Lock, Leader Election</td><td>서비스 등록/탐색의 일관성 보장 및 클러스터 안정성 유지</td></tr><tr><td><strong>메시징 시스템</strong></td><td>메시지 큐 동기화</td><td>Monitor, Semaphore</td><td>메시지 중복 방지 및 순서 보장</td></tr></tbody></table><ul><li><strong>운영체제</strong>에서는 커널 수준에서의 임계 구역 보호를 위해 저수준 락이 필수적으로 사용되며, POSIX 표준의 mutex 나 spinlock 은 프로세스 간 또는 커널 간 동기화를 안정적으로 보장한다.</li><li><strong>웹 서버</strong>는 다수의 클라이언트가 동시에 세션, 캐시 등에 접근할 수 있기 때문에, redis 기반 분산 락이나 세마포어를 통해 동시성을 제어하고 race condition 을 방지하는 것이 중요하다.</li><li><strong>데이터베이스</strong>는 트랜잭션 일관성 보장을 위해 row-level, table-level 락 또는 MVCC 와 같은 고급 동시성 제어 전략을 사용하며, Two-Phase Locking(2PL) 은 전통적인 접근 방식으로 널리 활용된다.</li><li><strong>분산 시스템</strong>에서는 파일 시스템이나 서비스 리더 선출 등 분산 자원 접근에 있어 일관성 유지를 위한 쿼럼 기반 알고리즘 (Raft, Paxos) 과 분산 락 관리자 (ZooKeeper 등) 가 핵심이다.</li><li><strong>캐시 시스템</strong>에서는 병렬 요청 환경에서 데이터 일관성 유지를 위한 write-through, write-back 정책과 분산 락을 결합하여 race condition 을 방지하며, 고성능 처리를 보장한다.</li><li><strong>클라우드 인프라</strong>는 자원 할당 과정에서 중복을 방지하기 위해 분산 락 (DynamoDB Lock, Redis SETNX 등) 을 적용하여 자원의 상태와 접근을 동기화한다.</li><li><strong>멀티스레드 애플리케이션</strong>은 메모리 공유로 인한 충돌을 피하기 위해 thread-safe 구조를 설계하며, 모니터, atomic 연산 등을 통해 정밀한 동기화를 구현한다.</li><li><strong>IoT 및 임베디드 시스템</strong>은 자원 제약이 크기 때문에 경량 락이나 CAS 와 같은 락프리 구조가 선호되며, 실시간성 및 자원 효율성을 동시에 달성하는 것이 관건이다.</li><li><strong>마이크로서비스</strong>는 서비스 디스커버리와 같은 분산 구성 요소 관리에 분산 락과 리더 선출 알고리즘을 사용하며, 이는 장애 복구와 확장성 확보에 중요한 역할을 한다.</li><li><strong>메시징 시스템</strong>에서는 메시지 중복 수신이나 순서 꼬임 방지를 위해 내부적으로 락이나 동기화 큐를 통해 안정적인 메시지 처리가 이루어진다.</li></ul><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=사례-1-분산-시스템에서-redis레디스-기반-분산-락>사례 1: 분산 시스템에서 Redis(레디스) 기반 분산 락<a hidden class=anchor aria-hidden=true href=#사례-1-분산-시스템에서-redis레디스-기반-분산-락>#</a></h4><p><strong>시나리오</strong>: 분산 시스템에서 Redis(레디스) 기반 분산 락을 적용해 다수의 웹 서비스 인스턴스가 특정 자원을 동시에 수정하지 못하도록 상호 배제 구현</p><p><strong>시스템 구성</strong>:</p><ul><li>여러 웹 애플리케이션 인스턴스</li><li>공유 자원 (예: 재고 수량 DB)</li><li>Redis 인스턴스 (분산 락 저장소)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TD
    subgraph Application Layer
        A1(Web Instance 1)
        A2(Web Instance 2)
        A3(Web Instance 3)
    end
    subgraph SharedResource
        DB[Database]
    end
    Redis[(Redis Lock Service)]
    A1 -- Request Lock --&gt; Redis
    A2 -- Request Lock --&gt; Redis
    A3 -- Request Lock --&gt; Redis
    Redis -- Grant Lock --&gt; A1
    Redis -- Grant Lock --&gt; A2
    Redis -- Grant Lock --&gt; A3
    A1 -- Access --&gt; DB
</pre><p><strong>Workflow</strong>:</p><ul><li>각 인스턴스는 임계 작업 전 Redis 에 락 획득 요청</li><li>Redis 에서 락을 가진 인스턴스만 임계구역 (공유 자원) 접근</li><li>임계구역 작업 후 락 해제</li></ul><p><strong>역할</strong>:</p><ul><li>Redis: 락의 소유권 관리 (분산 환경에서도 원자적 동작 보장)</li><li>각 Web 인스턴스: 임계구역 진입 관리</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>상호 배제 미적용 시: 재고 수량 중복 변경, 데이터 불일치 가능</li><li>적용 시: 한 인스턴스만 접근, 데이터 정합성 보장</li></ul><p><strong>구현 예시 (Python)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-91-1><a class=lnlinks href=#hl-91-1> 1</a>
</span><span class=lnt id=hl-91-2><a class=lnlinks href=#hl-91-2> 2</a>
</span><span class=lnt id=hl-91-3><a class=lnlinks href=#hl-91-3> 3</a>
</span><span class=lnt id=hl-91-4><a class=lnlinks href=#hl-91-4> 4</a>
</span><span class=lnt id=hl-91-5><a class=lnlinks href=#hl-91-5> 5</a>
</span><span class=lnt id=hl-91-6><a class=lnlinks href=#hl-91-6> 6</a>
</span><span class=lnt id=hl-91-7><a class=lnlinks href=#hl-91-7> 7</a>
</span><span class=lnt id=hl-91-8><a class=lnlinks href=#hl-91-8> 8</a>
</span><span class=lnt id=hl-91-9><a class=lnlinks href=#hl-91-9> 9</a>
</span><span class=lnt id=hl-91-10><a class=lnlinks href=#hl-91-10>10</a>
</span><span class=lnt id=hl-91-11><a class=lnlinks href=#hl-91-11>11</a>
</span><span class=lnt id=hl-91-12><a class=lnlinks href=#hl-91-12>12</a>
</span><span class=lnt id=hl-91-13><a class=lnlinks href=#hl-91-13>13</a>
</span><span class=lnt id=hl-91-14><a class=lnlinks href=#hl-91-14>14</a>
</span><span class=lnt id=hl-91-15><a class=lnlinks href=#hl-91-15>15</a>
</span><span class=lnt id=hl-91-16><a class=lnlinks href=#hl-91-16>16</a>
</span><span class=lnt id=hl-91-17><a class=lnlinks href=#hl-91-17>17</a>
</span><span class=lnt id=hl-91-18><a class=lnlinks href=#hl-91-18>18</a>
</span><span class=lnt id=hl-91-19><a class=lnlinks href=#hl-91-19>19</a>
</span><span class=lnt id=hl-91-20><a class=lnlinks href=#hl-91-20>20</a>
</span><span class=lnt id=hl-91-21><a class=lnlinks href=#hl-91-21>21</a>
</span><span class=lnt id=hl-91-22><a class=lnlinks href=#hl-91-22>22</a>
</span><span class=lnt id=hl-91-23><a class=lnlinks href=#hl-91-23>23</a>
</span><span class=lnt id=hl-91-24><a class=lnlinks href=#hl-91-24>24</a>
</span><span class=lnt id=hl-91-25><a class=lnlinks href=#hl-91-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Redis 기반 분산 락 구현 예시</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>StrictRedis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>acquire_lock</span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 락을 얻으려고 시도 </span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>r</span><span class=o>.</span><span class=n>setnx</span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>expire</span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span> <span class=n>timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>release_lock</span><span class=p>(</span><span class=n>lock_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>critical_section</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 임계구역 코드(예: 재고 변경)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Critical section 실행&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lock_key</span> <span class=o>=</span> <span class=s2>&#34;resource:lock&#34;</span>
</span></span><span class=line><span class=cl><span class=n>acquire_lock</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>critical_section</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>release_lock</span><span class=p>(</span><span class=n>lock_key</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-2-zookeeper-기반-리더-선출-및-mutual-exclusion>사례 2: ZooKeeper 기반 리더 선출 및 Mutual Exclusion<a hidden class=anchor aria-hidden=true href=#사례-2-zookeeper-기반-리더-선출-및-mutual-exclusion>#</a></h4><p><strong>시나리오</strong>: 분산 마이크로서비스 아키텍처에서 하나의 서비스가 Leader 역할을 수행하며 특정 critical task 수행. ZooKeeper 의 <code>create(ephemeral sequential)</code> 기반 락으로 leader 선출.</p><p><strong>시스템 구성</strong>:</p><ul><li>여러 서비스 인스턴스, ZooKeeper 클러스터</li><li>ZooKeeper 에 <code>/leader-lock</code> 폴더 사용</li></ul><pre class=mermaid>graph LR
  A(Service1) --&gt; Z(ZooKeeper Cluster)
  B(Service2) --&gt; Z
  C(Service3) --&gt; Z
  Z --&gt;|순차적 ephemeral znodes| L(Leader)
</pre><p><strong>Workflow</strong>:</p><ul><li>각 인스턴스는 <code>/leader-lock/n_</code> 이라는 시퀀셜 ephemeral node 생성</li><li>가장 낮은 숫자 노드를 갖는 인스턴스가 Leader</li><li>Leader 인스턴스 장애 시 znode 자동 삭제 → 다음 순서 leader 자동 승계</li></ul><p><strong>역할</strong>:</p><ul><li>Leader: exclusive 작업 수행</li><li>Followers: Leader 선출 참여, task 실행 대기</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>Mutual Exclusion 적용</strong> 시: Leader 는 단독 작업 수행, 일관성 있고 무결성 확보</li><li><strong>미적용 시</strong>: 두 인스턴스가 동시에 수행해 데이터 충돌 또는 중복 처리 발생</li></ul><p><strong>구현 예시</strong>: JavaScript, Node.js</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-93-1><a class=lnlinks href=#hl-93-1> 1</a>
</span><span class=lnt id=hl-93-2><a class=lnlinks href=#hl-93-2> 2</a>
</span><span class=lnt id=hl-93-3><a class=lnlinks href=#hl-93-3> 3</a>
</span><span class=lnt id=hl-93-4><a class=lnlinks href=#hl-93-4> 4</a>
</span><span class=lnt id=hl-93-5><a class=lnlinks href=#hl-93-5> 5</a>
</span><span class=lnt id=hl-93-6><a class=lnlinks href=#hl-93-6> 6</a>
</span><span class=lnt id=hl-93-7><a class=lnlinks href=#hl-93-7> 7</a>
</span><span class=lnt id=hl-93-8><a class=lnlinks href=#hl-93-8> 8</a>
</span><span class=lnt id=hl-93-9><a class=lnlinks href=#hl-93-9> 9</a>
</span><span class=lnt id=hl-93-10><a class=lnlinks href=#hl-93-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// create ephemeral sequential node
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>zk</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;node-zookeeper-client&#39;</span><span class=p>).</span><span class=nx>createClient</span><span class=p>(</span><span class=s1>&#39;localhost:2181&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>zk</span><span class=p>.</span><span class=nx>once</span><span class=p>(</span><span class=s1>&#39;connected&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>zk</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;/leader-lock/lock-&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>ZooKeeper</span><span class=p>.</span><span class=nx>CreateMode</span><span class=p>.</span><span class=nx>EPHEMERAL_SEQUENTIAL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>path</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 이후 siblings 목록, 가장 낮은 path 선택해서 leader 여부 판단
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-3-전자상거래-플랫폼의-재고-관리-시스템>사례 3: 전자상거래 플랫폼의 재고 관리 시스템<a hidden class=anchor aria-hidden=true href=#사례-3-전자상거래-플랫폼의-재고-관리-시스템>#</a></h4><p><strong>시나리오</strong>: 전자상거래 플랫폼의 재고 관리 시스템</p><p><strong>시스템 구성</strong>:</p><ul><li>Redis 분산 락을 활용한 재고 동시성 제어</li><li>마이크로서비스 아키텍처 환경</li><li>다중 인스턴스 주문 처리 서비스</li></ul><pre class=mermaid>graph TB
    subgraph &#34;클라이언트 계층&#34;
        C1[고객 A]
        C2[고객 B]
        C3[고객 C]
    end
    
    subgraph &#34;로드 밸런서&#34;
        LB[Load Balancer]
    end
    
    subgraph &#34;주문 서비스 인스턴스&#34;
        OS1[Order Service 1]
        OS2[Order Service 2]
        OS3[Order Service 3]
    end
    
    subgraph &#34;분산 락 시스템&#34;
        Redis[(Redis Cluster)]
        DL[Distributed Lock]
    end
    
    subgraph &#34;데이터베이스&#34;
        DB[(Inventory DB)]
        Cache[(Cache Layer)]
    end
    
    C1 --&gt; LB
    C2 --&gt; LB
    C3 --&gt; LB
    
    LB --&gt; OS1
    LB --&gt; OS2
    LB --&gt; OS3
    
    OS1 --&gt; DL
    OS2 --&gt; DL
    OS3 --&gt; DL
    
    DL --&gt; Redis
    
    OS1 --&gt; Cache
    OS2 --&gt; Cache
    OS3 --&gt; Cache
    
    Cache --&gt; DB
    
    style Redis fill:#ff9999
    style DL fill:#99ccff
    style DB fill:#99ff99
</pre><p><strong>Workflow</strong>:</p><ol><li>고객이 상품 주문 요청</li><li>로드 밸런서가 주문 서비스 인스턴스에 분산</li><li>각 서비스가 Redis 분산 락 획득 시도</li><li>락 획득 성공한 서비스만 재고 확인 및 차감</li><li>트랜잭션 완료 후 락 해제</li><li>다음 대기 서비스가 락 획득</li></ol><p><strong>역할</strong>:</p><ul><li><strong>Redis 분산 락</strong>: 재고 수정 작업의 원자성 보장</li><li><strong>주문 서비스</strong>: 비즈니스 로직 처리 및 락 관리</li><li><strong>캐시 레이어</strong>: 성능 향상을 위한 빠른 데이터 접근</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>상호 배제 있음</strong>: 정확한 재고 관리, 오버셀링 방지, 데이터 일관성 보장</li><li><strong>상호 배제 없음</strong>: 재고 초과 판매, 데이터 불일치, 고객 신뢰도 하락</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-95-1><a class=lnlinks href=#hl-95-1> 1</a>
</span><span class=lnt id=hl-95-2><a class=lnlinks href=#hl-95-2> 2</a>
</span><span class=lnt id=hl-95-3><a class=lnlinks href=#hl-95-3> 3</a>
</span><span class=lnt id=hl-95-4><a class=lnlinks href=#hl-95-4> 4</a>
</span><span class=lnt id=hl-95-5><a class=lnlinks href=#hl-95-5> 5</a>
</span><span class=lnt id=hl-95-6><a class=lnlinks href=#hl-95-6> 6</a>
</span><span class=lnt id=hl-95-7><a class=lnlinks href=#hl-95-7> 7</a>
</span><span class=lnt id=hl-95-8><a class=lnlinks href=#hl-95-8> 8</a>
</span><span class=lnt id=hl-95-9><a class=lnlinks href=#hl-95-9> 9</a>
</span><span class=lnt id=hl-95-10><a class=lnlinks href=#hl-95-10>10</a>
</span><span class=lnt id=hl-95-11><a class=lnlinks href=#hl-95-11>11</a>
</span><span class=lnt id=hl-95-12><a class=lnlinks href=#hl-95-12>12</a>
</span><span class=lnt id=hl-95-13><a class=lnlinks href=#hl-95-13>13</a>
</span><span class=lnt id=hl-95-14><a class=lnlinks href=#hl-95-14>14</a>
</span><span class=lnt id=hl-95-15><a class=lnlinks href=#hl-95-15>15</a>
</span><span class=lnt id=hl-95-16><a class=lnlinks href=#hl-95-16>16</a>
</span><span class=lnt id=hl-95-17><a class=lnlinks href=#hl-95-17>17</a>
</span><span class=lnt id=hl-95-18><a class=lnlinks href=#hl-95-18>18</a>
</span><span class=lnt id=hl-95-19><a class=lnlinks href=#hl-95-19>19</a>
</span><span class=lnt id=hl-95-20><a class=lnlinks href=#hl-95-20>20</a>
</span><span class=lnt id=hl-95-21><a class=lnlinks href=#hl-95-21>21</a>
</span><span class=lnt id=hl-95-22><a class=lnlinks href=#hl-95-22>22</a>
</span><span class=lnt id=hl-95-23><a class=lnlinks href=#hl-95-23>23</a>
</span><span class=lnt id=hl-95-24><a class=lnlinks href=#hl-95-24>24</a>
</span><span class=lnt id=hl-95-25><a class=lnlinks href=#hl-95-25>25</a>
</span><span class=lnt id=hl-95-26><a class=lnlinks href=#hl-95-26>26</a>
</span><span class=lnt id=hl-95-27><a class=lnlinks href=#hl-95-27>27</a>
</span><span class=lnt id=hl-95-28><a class=lnlinks href=#hl-95-28>28</a>
</span><span class=lnt id=hl-95-29><a class=lnlinks href=#hl-95-29>29</a>
</span><span class=lnt id=hl-95-30><a class=lnlinks href=#hl-95-30>30</a>
</span><span class=lnt id=hl-95-31><a class=lnlinks href=#hl-95-31>31</a>
</span><span class=lnt id=hl-95-32><a class=lnlinks href=#hl-95-32>32</a>
</span><span class=lnt id=hl-95-33><a class=lnlinks href=#hl-95-33>33</a>
</span><span class=lnt id=hl-95-34><a class=lnlinks href=#hl-95-34>34</a>
</span><span class=lnt id=hl-95-35><a class=lnlinks href=#hl-95-35>35</a>
</span><span class=lnt id=hl-95-36><a class=lnlinks href=#hl-95-36>36</a>
</span><span class=lnt id=hl-95-37><a class=lnlinks href=#hl-95-37>37</a>
</span><span class=lnt id=hl-95-38><a class=lnlinks href=#hl-95-38>38</a>
</span><span class=lnt id=hl-95-39><a class=lnlinks href=#hl-95-39>39</a>
</span><span class=lnt id=hl-95-40><a class=lnlinks href=#hl-95-40>40</a>
</span><span class=lnt id=hl-95-41><a class=lnlinks href=#hl-95-41>41</a>
</span><span class=lnt id=hl-95-42><a class=lnlinks href=#hl-95-42>42</a>
</span><span class=lnt id=hl-95-43><a class=lnlinks href=#hl-95-43>43</a>
</span><span class=lnt id=hl-95-44><a class=lnlinks href=#hl-95-44>44</a>
</span><span class=lnt id=hl-95-45><a class=lnlinks href=#hl-95-45>45</a>
</span><span class=lnt id=hl-95-46><a class=lnlinks href=#hl-95-46>46</a>
</span><span class=lnt id=hl-95-47><a class=lnlinks href=#hl-95-47>47</a>
</span><span class=lnt id=hl-95-48><a class=lnlinks href=#hl-95-48>48</a>
</span><span class=lnt id=hl-95-49><a class=lnlinks href=#hl-95-49>49</a>
</span><span class=lnt id=hl-95-50><a class=lnlinks href=#hl-95-50>50</a>
</span><span class=lnt id=hl-95-51><a class=lnlinks href=#hl-95-51>51</a>
</span><span class=lnt id=hl-95-52><a class=lnlinks href=#hl-95-52>52</a>
</span><span class=lnt id=hl-95-53><a class=lnlinks href=#hl-95-53>53</a>
</span><span class=lnt id=hl-95-54><a class=lnlinks href=#hl-95-54>54</a>
</span><span class=lnt id=hl-95-55><a class=lnlinks href=#hl-95-55>55</a>
</span><span class=lnt id=hl-95-56><a class=lnlinks href=#hl-95-56>56</a>
</span><span class=lnt id=hl-95-57><a class=lnlinks href=#hl-95-57>57</a>
</span><span class=lnt id=hl-95-58><a class=lnlinks href=#hl-95-58>58</a>
</span><span class=lnt id=hl-95-59><a class=lnlinks href=#hl-95-59>59</a>
</span><span class=lnt id=hl-95-60><a class=lnlinks href=#hl-95-60>60</a>
</span><span class=lnt id=hl-95-61><a class=lnlinks href=#hl-95-61>61</a>
</span><span class=lnt id=hl-95-62><a class=lnlinks href=#hl-95-62>62</a>
</span><span class=lnt id=hl-95-63><a class=lnlinks href=#hl-95-63>63</a>
</span><span class=lnt id=hl-95-64><a class=lnlinks href=#hl-95-64>64</a>
</span><span class=lnt id=hl-95-65><a class=lnlinks href=#hl-95-65>65</a>
</span><span class=lnt id=hl-95-66><a class=lnlinks href=#hl-95-66>66</a>
</span><span class=lnt id=hl-95-67><a class=lnlinks href=#hl-95-67>67</a>
</span><span class=lnt id=hl-95-68><a class=lnlinks href=#hl-95-68>68</a>
</span><span class=lnt id=hl-95-69><a class=lnlinks href=#hl-95-69>69</a>
</span><span class=lnt id=hl-95-70><a class=lnlinks href=#hl-95-70>70</a>
</span><span class=lnt id=hl-95-71><a class=lnlinks href=#hl-95-71>71</a>
</span><span class=lnt id=hl-95-72><a class=lnlinks href=#hl-95-72>72</a>
</span><span class=lnt id=hl-95-73><a class=lnlinks href=#hl-95-73>73</a>
</span><span class=lnt id=hl-95-74><a class=lnlinks href=#hl-95-74>74</a>
</span><span class=lnt id=hl-95-75><a class=lnlinks href=#hl-95-75>75</a>
</span><span class=lnt id=hl-95-76><a class=lnlinks href=#hl-95-76>76</a>
</span><span class=lnt id=hl-95-77><a class=lnlinks href=#hl-95-77>77</a>
</span><span class=lnt id=hl-95-78><a class=lnlinks href=#hl-95-78>78</a>
</span><span class=lnt id=hl-95-79><a class=lnlinks href=#hl-95-79>79</a>
</span><span class=lnt id=hl-95-80><a class=lnlinks href=#hl-95-80>80</a>
</span><span class=lnt id=hl-95-81><a class=lnlinks href=#hl-95-81>81</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DistributedLock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;lock:</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=n>timeout</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;분산 락 획득을 위한 컨텍스트 매니저&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 락 획득 시도 (SET if Not Exists with expiration)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                             <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ex</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>timeout</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=kc>True</span>  <span class=c1># 락 획득 성공</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=kc>False</span>  <span class=c1># 락 획득 실패</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 락 해제 (자신이 획득한 락만 해제)</span>
</span></span><span class=line><span class=cl>            <span class=n>script</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            if redis.call(&#34;get&#34;, KEYS[1]) == ARGV[1] then
</span></span></span><span class=line><span class=cl><span class=s2>                return redis.call(&#34;del&#34;, KEYS[1])
</span></span></span><span class=line><span class=cl><span class=s2>            else
</span></span></span><span class=line><span class=cl><span class=s2>                return 0
</span></span></span><span class=line><span class=cl><span class=s2>            end
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>eval</span><span class=p>(</span><span class=n>script</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>InventoryService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>,</span> <span class=n>db_client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db</span> <span class=o>=</span> <span class=n>db_client</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>,</span> <span class=n>quantity</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;상호 배제를 사용한 주문 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>lock</span> <span class=o>=</span> <span class=n>DistributedLock</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;inventory:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span> <span class=k>as</span> <span class=n>acquired</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>acquired</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;Unable to acquire lock&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 현재 재고 확인</span>
</span></span><span class=line><span class=cl>            <span class=n>current_stock</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_current_stock</span><span class=p>(</span><span class=n>product_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current_stock</span> <span class=o>&gt;=</span> <span class=n>quantity</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 재고 차감</span>
</span></span><span class=line><span class=cl>                <span class=n>new_stock</span> <span class=o>=</span> <span class=n>current_stock</span> <span class=o>-</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>update_stock</span><span class=p>(</span><span class=n>product_id</span><span class=p>,</span> <span class=n>new_stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;Order processed. Remaining: </span><span class=si>{</span><span class=n>new_stock</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;Insufficient stock&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_current_stock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;현재 재고 조회&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>db</span><span class=o>.</span><span class=n>get_stock</span><span class=p>(</span><span class=n>product_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>update_stock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>,</span> <span class=n>new_stock</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 업데이트&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db</span><span class=o>.</span><span class=n>update_stock</span><span class=p>(</span><span class=n>product_id</span><span class=p>,</span> <span class=n>new_stock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 캐시도 업데이트</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;stock:</span><span class=si>{</span><span class=n>product_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>new_stock</span><span class=p>,</span> <span class=n>ex</span><span class=o>=</span><span class=mi>300</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>inventory_service</span> <span class=o>=</span> <span class=n>InventoryService</span><span class=p>(</span><span class=n>redis_client</span><span class=p>,</span> <span class=n>db_client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 동시 주문 처리</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>inventory_service</span><span class=o>.</span><span class=n>process_order</span><span class=p>(</span><span class=n>product_id</span><span class=o>=</span><span class=s2>&#34;PROD123&#34;</span><span class=p>,</span> <span class=n>quantity</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=사례-4-분산-락-distributed-lock>사례 4: 분산 락 (Distributed Lock)<a hidden class=anchor aria-hidden=true href=#사례-4-분산-락-distributed-lock>#</a></h4><p><strong>시스템 구조도</strong></p><ul><li>Redis Redlock 기반</li></ul><pre class=mermaid>flowchart LR
    A[Client 1] --&gt;|SETNX Lock Request| R[(Redis Cluster)]
    B[Client 2] --&gt;|SETNX Lock Request| R
    R --&gt;|Lock Granted/Denied| A
    R --&gt;|Lock Granted/Denied| B
    A --&gt;|Work in Critical Section| S1[Service 1]
    B --&gt;|Wait/Retry| S2[Service 2]
    S1 --&gt;|DEL Lock Release| R
    B --&gt;|Acquire Lock after release| R
</pre><ul><li><strong>Redis Cluster</strong>가 중앙화된 락 관리자로 동작.</li><li><strong>Client 1</strong>이 락을 먼저 획득하면 <strong>Client 2</strong>는 대기 혹은 타임아웃 후 재시도.</li><li>락은 유효시간 (EXPIRE) 을 설정해 장애 시 락이 풀리지 않는 문제를 방지.</li></ul><p><strong>동작 흐름도</strong>:</p><ul><li>Lock Acquisition & Release</li></ul><pre class=mermaid>sequenceDiagram
    participant C1 as Client 1
    participant C2 as Client 2
    participant R as Redis Cluster

    C1-&gt;&gt;R: SETNX lock_key token EX 5
    R--&gt;&gt;C1: OK (Lock Acquired)
    C2-&gt;&gt;R: SETNX lock_key token EX 5
    R--&gt;&gt;C2: Fail (Already locked)
    C1-&gt;&gt;C1: Critical Section 작업
    C1-&gt;&gt;R: DEL lock_key (Lock Release)
    C2-&gt;&gt;R: Retry SETNX lock_key token EX 5
    R--&gt;&gt;C2: OK (Lock Acquired)
</pre><p><strong>실제 코드 구현</strong>:</p><ul><li>Python 예시: Redis + Redlock</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-98-1><a class=lnlinks href=#hl-98-1> 1</a>
</span><span class=lnt id=hl-98-2><a class=lnlinks href=#hl-98-2> 2</a>
</span><span class=lnt id=hl-98-3><a class=lnlinks href=#hl-98-3> 3</a>
</span><span class=lnt id=hl-98-4><a class=lnlinks href=#hl-98-4> 4</a>
</span><span class=lnt id=hl-98-5><a class=lnlinks href=#hl-98-5> 5</a>
</span><span class=lnt id=hl-98-6><a class=lnlinks href=#hl-98-6> 6</a>
</span><span class=lnt id=hl-98-7><a class=lnlinks href=#hl-98-7> 7</a>
</span><span class=lnt id=hl-98-8><a class=lnlinks href=#hl-98-8> 8</a>
</span><span class=lnt id=hl-98-9><a class=lnlinks href=#hl-98-9> 9</a>
</span><span class=lnt id=hl-98-10><a class=lnlinks href=#hl-98-10>10</a>
</span><span class=lnt id=hl-98-11><a class=lnlinks href=#hl-98-11>11</a>
</span><span class=lnt id=hl-98-12><a class=lnlinks href=#hl-98-12>12</a>
</span><span class=lnt id=hl-98-13><a class=lnlinks href=#hl-98-13>13</a>
</span><span class=lnt id=hl-98-14><a class=lnlinks href=#hl-98-14>14</a>
</span><span class=lnt id=hl-98-15><a class=lnlinks href=#hl-98-15>15</a>
</span><span class=lnt id=hl-98-16><a class=lnlinks href=#hl-98-16>16</a>
</span><span class=lnt id=hl-98-17><a class=lnlinks href=#hl-98-17>17</a>
</span><span class=lnt id=hl-98-18><a class=lnlinks href=#hl-98-18>18</a>
</span><span class=lnt id=hl-98-19><a class=lnlinks href=#hl-98-19>19</a>
</span><span class=lnt id=hl-98-20><a class=lnlinks href=#hl-98-20>20</a>
</span><span class=lnt id=hl-98-21><a class=lnlinks href=#hl-98-21>21</a>
</span><span class=lnt id=hl-98-22><a class=lnlinks href=#hl-98-22>22</a>
</span><span class=lnt id=hl-98-23><a class=lnlinks href=#hl-98-23>23</a>
</span><span class=lnt id=hl-98-24><a class=lnlinks href=#hl-98-24>24</a>
</span><span class=lnt id=hl-98-25><a class=lnlinks href=#hl-98-25>25</a>
</span><span class=lnt id=hl-98-26><a class=lnlinks href=#hl-98-26>26</a>
</span><span class=lnt id=hl-98-27><a class=lnlinks href=#hl-98-27>27</a>
</span><span class=lnt id=hl-98-28><a class=lnlinks href=#hl-98-28>28</a>
</span><span class=lnt id=hl-98-29><a class=lnlinks href=#hl-98-29>29</a>
</span><span class=lnt id=hl-98-30><a class=lnlinks href=#hl-98-30>30</a>
</span><span class=lnt id=hl-98-31><a class=lnlinks href=#hl-98-31>31</a>
</span><span class=lnt id=hl-98-32><a class=lnlinks href=#hl-98-32>32</a>
</span><span class=lnt id=hl-98-33><a class=lnlinks href=#hl-98-33>33</a>
</span><span class=lnt id=hl-98-34><a class=lnlinks href=#hl-98-34>34</a>
</span><span class=lnt id=hl-98-35><a class=lnlinks href=#hl-98-35>35</a>
</span><span class=lnt id=hl-98-36><a class=lnlinks href=#hl-98-36>36</a>
</span><span class=lnt id=hl-98-37><a class=lnlinks href=#hl-98-37>37</a>
</span><span class=lnt id=hl-98-38><a class=lnlinks href=#hl-98-38>38</a>
</span><span class=lnt id=hl-98-39><a class=lnlinks href=#hl-98-39>39</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RedisDistributedLock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_client</span><span class=p>,</span> <span class=n>lock_key</span><span class=p>,</span> <span class=n>expiry</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>redis</span> <span class=o>=</span> <span class=n>redis_client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock_key</span> <span class=o>=</span> <span class=n>lock_key</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>expiry</span> <span class=o>=</span> <span class=n>expiry</span>  <span class=c1># Lock TTL (seconds)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock_value</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>retry_interval</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span> <span class=o>&lt;</span> <span class=n>timeout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Try to set the lock with NX (only if key does not exist)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lock_key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_value</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ex</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>expiry</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>lock_value</span><span class=si>}</span><span class=s2>] Lock acquired&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>retry_interval</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>lock_value</span><span class=si>}</span><span class=s2>] Failed to acquire lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Release lock only if this client owns it</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lock_key</span><span class=p>)</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock_value</span><span class=o>.</span><span class=n>encode</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>redis</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lock_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>lock_value</span><span class=si>}</span><span class=s2>] Lock released&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Redis 클라이언트 연결</span>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>RedisDistributedLock</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=s2>&#34;critical_section_lock&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 임계 구역 (Critical Section)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Processing critical work…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=주목할-내용>주목할 내용<a hidden class=anchor aria-hidden=true href=#주목할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제/항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>1. 알고리즘</strong></td><td>Peterson&rsquo;s Algorithm</td><td>두 스레드 간 상호 배제 보장. Bounded Waiting 가능. 이론적으로 중요함.</td></tr><tr><td></td><td>Lamport Bakery Algorithm</td><td>N 개의 프로세스에서도 Bounded Waiting 보장. 번호표 기반 알고리즘.</td></tr><tr><td></td><td>Ricart–Agrawala Algorithm</td><td>메시지 기반 분산 상호배제 알고리즘. Logical Clock 사용.</td></tr><tr><td></td><td>Suzuki–Kasami Token Algorithm</td><td>토큰 기반 분산 상호배제. 메시지 오버헤드 낮음.</td></tr><tr><td></td><td>Lock-Free / Wait-Free Algorithm</td><td>병목, 데드락 없이 동시성 최적화. 비블로킹 구조.</td></tr><tr><td><strong>2. 구현 객체 및 기술</strong></td><td>Mutex / Semaphore / Monitor</td><td>운영체제/언어 수준에서 지원하는 동기화 객체. 상황에 따라 선택적으로 사용.</td></tr><tr><td></td><td>ReentrantLock (Java 등)</td><td>동일 스레드의 중복 진입을 허용하는 유연한 락 구현.</td></tr><tr><td></td><td>Spinlock</td><td>바쁜 대기 기반 락. 락 보유 시간 짧을 때 유리.</td></tr><tr><td></td><td>Adaptive Mutex</td><td>부하 상황에 따라 Spin ↔ Block 전환.</td></tr><tr><td><strong>3. 하드웨어 기술</strong></td><td>Test-and-Set / Compare-and-Swap (CAS)</td><td>원자적 동기화를 위한 CPU 명령어. 저수준 락 구현에 활용됨.</td></tr><tr><td></td><td>Memory Barrier</td><td>CPU 의 명령어 순서 재정렬 방지. 일관성 보장.</td></tr><tr><td></td><td>Hardware Transactional Memory (HTM)</td><td>하드웨어 수준에서 트랜잭션 기반 동기화. 인텔 TSX, IBM POWER 등.</td></tr><tr><td><strong>4. 분산 시스템</strong></td><td>Redlock (Redis 기반)</td><td>분산 락 구현 알고리즘. 시간 동기화 기반으로 다중 노드간 락 보장.</td></tr><tr><td></td><td>ZooKeeper Recipes</td><td>Zookeeper 기반 분산 락, 리더 선출 구현 패턴. ephemeral znode 사용.</td></tr><tr><td></td><td>Quorum 기반 합의</td><td>과반수 응답을 통한 분산 락/합의 구성. PBFT, Raft 등과 연계됨.</td></tr><tr><td></td><td>Leader Election</td><td>단일 노드에 책임을 부여해 중복/경합 방지. Zookeeper 등에서 사용.</td></tr><tr><td><strong>5. 성능 최적화 및 보장</strong></td><td>NUMA / Memory Locality</td><td>병렬 시스템에서 캐시/메모리 접근 최적화. 성능 병목 방지.</td></tr><tr><td></td><td>Starvation 방지 (Fairness)</td><td>순서 보장, 우선순위 상속 등으로 기아 상태 예방.</td></tr><tr><td></td><td>Priority Inversion 해결</td><td>우선순위 상속 (PIP), Ceiling 등으로 역전 문제 방지.</td></tr><tr><td></td><td>Lock Striping</td><td>자원 단위로 락 분할하여 경합 최소화.</td></tr><tr><td><strong>6. 디버깅 및 복구</strong></td><td>Recoverable Mutex</td><td>장애 발생 후에도 상태 복원 가능한 락 구현 기법.</td></tr><tr><td></td><td>Deadlock Analyzer</td><td>교착 상태 탐지 및 해소 도구.</td></tr><tr><td></td><td>동시성 퍼저 / 정적 분석 도구</td><td>비결정적 버그 및 경합 조건 자동 탐지.</td></tr><tr><td></td><td>Timeout / Bounded Waiting</td><td>대기 시간 제한을 통한 데드락 회피.</td></tr><tr><td><strong>7. 언어 및 프로그래밍 패턴</strong></td><td>구조화된 동시성</td><td>비동기 코드에서 동기화 흐름을 직관적으로 구성. Python Trio 등.</td></tr><tr><td></td><td>선언적 동기화</td><td>언어 자체에서 동기화 패턴을 추상화하여 선언적 방식으로 표현 가능.</td></tr><tr><td></td><td>락프리 메모리 할당자</td><td>고성능 환경에서 동기화 없는 동적 메모리 관리 기법. jemalloc 등.</td></tr></tbody></table><ol><li><p><strong>알고리즘</strong><br>이론적 근간을 이루는 상호배제 알고리즘들은 프로세스 수 (n) 에 따른 확장성과 메시지 복잡도 최적화 측면에서 다양하게 발전해왔으며, 이들은 동시성의 기본 원리를 이해하는 데 매우 중요하다.</p></li><li><p><strong>구현 객체 및 기술</strong><br>운영체제 및 프로그래밍 언어에서 제공하는 동기화 도구들은 실무 적용의 기초이다. 각 객체는 용도와 사용 조건 (재진입성, 우선순위, 경합도) 에 따라 선택되어야 하며, 상황에 따라 하이브리드 객체 (Adaptive Mutex 등) 도 고려된다.</p></li><li><p><strong>하드웨어 기술</strong><br>현대 CPU 는 원자적 연산을 직접 지원하며, 이를 활용한 동기화 구조는 락 없는 병렬 처리를 가능하게 한다. HTM 은 고성능 시스템에서 병렬성과 원자성을 동시에 만족하는 새로운 접근 방식이다.</p></li><li><p><strong>분산 시스템</strong><br>상호배제가 단일 노드를 넘어서야 할 경우, Zookeeper, Redlock, Quorum 등 분산 동기화 패턴이 필수적이다. 이는 장애 허용성과 네트워크 환경을 고려한 정교한 설계가 필요하다.</p></li><li><p><strong>성능 최적화 및 보장</strong><br>락 경합 최소화와 응답 지연 감소는 고성능 시스템에서 핵심이다. Lock Striping, NUMA 최적화, Priority Inversion 해결책 등은 실무에서 동시성 문제 해결에 반드시 고려되어야 한다.</p></li><li><p><strong>디버깅 및 복구</strong><br>교착상태와 경합 조건은 동시성 프로그래밍의 대표적인 오류다. 퍼지 테스트, 정형 검증 도구, Recoverable Mutex 등은 시스템의 신뢰성을 높이기 위한 핵심 기술 요소이다.</p></li><li><p><strong>언어 및 프로그래밍 패턴</strong><br>동시성은 언어 및 프레임워크에 따라 다르게 추상화된다. 구조화된 동시성과 선언적 동기화는 코드 가독성과 유지보수성을 향상시키며, 락프리 메모리 할당자는 실시간 시스템에서 성능을 극대화할 수 있는 기반이다.</p></li></ol><h3 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목/알고리즘/도구</th><th>설명</th></tr></thead><tbody><tr><td><strong>기초 이론 및 모델</strong></td><td>상호 배제 (Mutual Exclusion)</td><td>임계 구역 (Critical Section), Race Condition</td><td>동시성 문제를 방지하기 위한 기본 개념 및 조건</td></tr><tr><td></td><td>동시성 모델</td><td>Actor Model, CSP, Shared Memory Model</td><td>프로세스 간 통신 및 상태 관리 모델</td></tr><tr><td><strong>고전 동기화 알고리즘</strong></td><td>소프트웨어 기반 알고리즘</td><td>Dekker, Peterson, Lamport&rsquo;s Bakery Algorithm</td><td>하드웨어 지원 없이 동기화 보장하는 초기 알고리즘</td></tr><tr><td></td><td>하드웨어 명령 기반 알고리즘</td><td>Test-and-Set, Compare-And-Swap(CAS), LL/SC</td><td>원자적 연산으로 락 구현</td></tr><tr><td><strong>운영체제 동기화</strong></td><td>동기화 객체</td><td>Mutex, Semaphore, Monitor, Barrier</td><td>프로세스/스레드 동기화를 위한 OS 수준 객체</td></tr><tr><td></td><td>데드락 처리</td><td>예방, 회피, 탐지, 회복</td><td>동기화 중 발생하는 교착 상태의 해결 전략</td></tr><tr><td></td><td>스케줄링과 동기화</td><td>Priority Inversion, Priority Inheritance</td><td>스케줄러와 동기화 간의 상호작용 문제</td></tr><tr><td><strong>고급 동기화 전략</strong></td><td>락 최적화 기법</td><td>Spinlock, Blocking Lock, RWLock, ReentrantLock</td><td>CPU 사용률과 경합 상황에 따른 전략</td></tr><tr><td></td><td>락프리/논블로킹 알고리즘</td><td>Lock-free, Wait-free, Obstruction-free</td><td>시스템 병목 완화를 위한 비동기적 동기화</td></tr><tr><td></td><td>트랜잭션 메모리</td><td>STM(Software), HTM(Hardware)</td><td>명시적 락 없이 트랜잭션 기반 동기화 구현</td></tr><tr><td><strong>분산 환경</strong></td><td>분산 상호 배제</td><td>Ricart–Agrawala, Suzuki–Kasami, Raymond</td><td>메시지 기반의 분산 락 알고리즘</td></tr><tr><td></td><td>합의 알고리즘</td><td>Paxos, Raft</td><td>분산된 노드 간 상태 일관성 유지</td></tr><tr><td></td><td>분산 락 구현 도구</td><td>Zookeeper, etcd, Redis Redlock, DynamoDB Lock</td><td>클러스터 환경에서 분산 자원 동기화</td></tr><tr><td><strong>클라우드 및 실시간</strong></td><td>실시간 시스템 동기화</td><td>Priority Ceiling, Real-time Lock</td><td>실시간 태스크의 predictability 보장</td></tr><tr><td></td><td>클라우드 락 서비스</td><td>AWS DynamoDB Lock, GCP Firestore Lock</td><td>클라우드 환경에서 동기화 API</td></tr><tr><td><strong>테스트 및 분석 도구</strong></td><td>동시성 테스트 전략</td><td>유닛 + Race Test, Fault Injection</td><td>오류 발생 조건을 유도하고 검증</td></tr><tr><td></td><td>동시성 분석 도구</td><td>ThreadSanitizer, Helgrind, Java Concurrency Tools</td><td>경합, 데드락 추적 및 시각화</td></tr><tr><td></td><td>Lock Profiling</td><td>perf-lock, contention 분석</td><td>락 병목 원인 분석 및 성능 최적화</td></tr></tbody></table><ol><li><p><strong>기초 이론 및 모델</strong>:<br>Mutual Exclusion 은 동시성 환경에서 공유 자원 접근을 제어하는 핵심 원리로, 임계 구역 보호 및 경합 방지를 목적으로 한다. 다양한 동시성 모델 (Actor, CSP 등) 이 존재하며, 이를 기반으로 구현 방식이 나뉜다.</p></li><li><p><strong>고전 동기화 알고리즘</strong>:<br>초기에는 Dekker, Peterson, Lamport 알고리즘과 같이 소프트웨어만으로 구현 가능한 동기화 방법이 연구되었으며, 이후 CAS, Test-and-Set 같은 하드웨어 명령이 추가되어 효율적인 락 구현이 가능해졌다.</p></li><li><p><strong>운영체제 동기화</strong>:<br>운영체제는 Mutex, Semaphore, Monitor 등 다양한 동기화 도구를 제공하고, 데드락 처리를 위한 전략도 필수로 적용된다. 또한 우선순위 반전과 같은 스케줄링 관련 문제도 주요 이슈다.</p></li><li><p><strong>고급 동기화 전략</strong>:<br>스핀락, 읽기/쓰기 락, 재진입 락과 같은 전략은 상황에 따라 적절히 선택되어야 하며, 락프리 또는 트랜잭션 메모리 방식은 병렬성 향상 및 병목 최소화를 위한 대안으로 중요하다.</p></li><li><p><strong>분산 환경</strong>:<br>단일 시스템을 넘어서는 경우에는 Ricart–Agrawala, Paxos, Zookeeper 등 분산 락 및 합의 알고리즘이 필요하며, 상태 일관성을 보장하기 위한 구조가 핵심이다.</p></li><li><p><strong>클라우드 및 실시간 시스템</strong>:<br>클라우드 환경에서는 분산 락을 관리하는 API 서비스 (AWS, GCP 등) 를 활용하며, 실시간 시스템에서는 predictability 를 유지하기 위한 별도 락 정책이 필요하다.</p></li><li><p><strong>테스트 및 분석 도구</strong>:<br>멀티스레딩 환경에서는 동시성 버그 탐지를 위해 전용 테스트 전략과 분석 도구가 반드시 사용되어야 하며, 병목 분석을 위한 락 프로파일링 도구도 중요하다.</p></li></ol><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어 (한글/영어)</th><th>설명</th></tr></thead><tbody><tr><td><strong>기본 개념</strong></td><td>임계 구역 (Critical Section)</td><td>공유 자원에 접근하는 코드 영역으로, 동시에 하나의 실행 흐름만 접근 가능해야 함.</td></tr><tr><td></td><td>상호 배제 (Mutual Exclusion)</td><td>여러 실행 흐름이 동시에 임계 구역에 진입하지 않도록 보장하는 원칙.</td></tr><tr><td></td><td>경쟁 상태 (Race Condition)</td><td>동시 실행 시 실행 순서에 따라 결과가 달라지는 현상.</td></tr><tr><td></td><td>원자적 연산 (Atomic Operation)</td><td>중간에 끼어들 수 없는, 완전히 실행되거나 실행되지 않는 연산.</td></tr><tr><td></td><td>우선순위 역전 (Priority Inversion)</td><td>낮은 우선순위의 프로세스가 락을 점유해 높은 우선순위의 프로세스가 블로킹되는 현상.</td></tr><tr><td></td><td>기아 상태 (Starvation)</td><td>특정 실행 흐름이 자원을 계속 획득하지 못하는 현상.</td></tr><tr><td></td><td>교착 상태 (Deadlock)</td><td>둘 이상의 실행 흐름이 서로가 가진 자원을 기다리며 무한 대기하는 상태.</td></tr><tr><td></td><td>라이브락 (Livelock)</td><td>프로세스들이 상태를 계속 변경하지만 작업이 진전되지 않는 상태.</td></tr><tr><td><strong>동기화 객체</strong></td><td>뮤텍스 (Mutex)</td><td>한 번에 하나의 실행 흐름만 자원에 접근할 수 있도록 보장하는 이진 락 객체.</td></tr><tr><td></td><td>세마포어 (Semaphore)</td><td>카운팅 가능한 동기화 객체로, 특정 수의 실행 흐름까지 자원 접근을 허용.</td></tr><tr><td></td><td>스핀락 (Spinlock)</td><td>락 해제를 기다리며 바쁜 대기를 수행하는 락. CPU 자원을 소비하지만 빠른 획득 가능.</td></tr><tr><td></td><td>재진입 락 (Reentrant Lock)</td><td>동일 스레드가 이미 획득한 락을 재진입 가능하게 허용하는 구조.</td></tr><tr><td></td><td>읽기 - 쓰기 락 (Read-Write Lock)</td><td>다수의 읽기 접근은 허용하고, 쓰기 접근은 배타적으로 제한하는 락 구조.</td></tr><tr><td><strong>알고리즘/기법</strong></td><td>Test-and-Set</td><td>CPU 가 제공하는 원자적 읽기 - 쓰기 명령어. 간단한 락 구현에 활용됨.</td></tr><tr><td></td><td>Compare-and-Swap (CAS)</td><td>특정 조건을 만족할 때만 원자적으로 값을 교체하는 명령어. lock-free 동기화 구현에 활용.</td></tr><tr><td></td><td>Peterson&rsquo;s Algorithm</td><td>두 프로세스 간 상호 배제를 보장하는 고전적 알고리즘.</td></tr><tr><td></td><td>Token-based Algorithm</td><td>하나의 토큰을 통해 임계 구역 접근을 제어하는 분산 알고리즘.</td></tr><tr><td></td><td>Logical Clock</td><td>분산 시스템에서 이벤트 순서를 추적하기 위한 논리적 타임스탬프.</td></tr><tr><td></td><td>Bounded Waiting</td><td>각 프로세스가 유한한 시간 내 임계 구역에 진입할 수 있도록 보장.</td></tr><tr><td><strong>락 회피 기법</strong></td><td>락 - 프리 (Lock-Free)</td><td>전체 시스템의 진행은 보장되지만, 개별 스레드의 완료는 보장하지 않는 구조.</td></tr><tr><td></td><td>웨이트 - 프리 (Wait-Free)</td><td>모든 스레드가 제한 시간 내에 반드시 작업을 완료할 수 있도록 보장하는 구조.</td></tr><tr><td></td><td>STM (Software Transactional Memory)</td><td>동기화 코드를 트랜잭션 단위로 처리하며 충돌 발생 시 롤백 및 재시도 수행.</td></tr><tr><td></td><td>Lock Striping</td><td>자원을 분할하여 다수의 락을 배치해 병렬성과 성능을 높이는 방식.</td></tr><tr><td><strong>분산 동기화</strong></td><td>분산 락 (Distributed Lock)</td><td>여러 노드 간 동기화를 위해 사용하는 락. Redis, Zookeeper 등을 통해 구현.</td></tr><tr><td></td><td>Redlock</td><td>Redis 기반 분산 락 알고리즘. 네트워크 분리 및 장애 복원에 강건하도록 설계됨.</td></tr><tr><td></td><td>Zookeeper Recipe</td><td>Apache Zookeeper 에서 제공하는 동기화 패턴 모음. 락, 리더 선출 등에 사용.</td></tr><tr><td></td><td>Quorum (쿼럼)</td><td>분산 시스템에서 과반수 이상의 노드 승인이 필요한 원칙.</td></tr><tr><td></td><td>Leader Election (리더 선출)</td><td>클러스터 노드 중 하나를 리더로 지정하는 분산 알고리즘.</td></tr><tr><td></td><td>Token</td><td>임계 구역 진입 권한을 가지는 고유 객체. 분산 시스템에서 접근 제어용으로 사용됨.</td></tr><tr><td><strong>복구/관찰/운영</strong></td><td>Heartbeat</td><td>노드 간 생존 상태 확인을 위한 주기적 신호. 장애 복구 및 세션 유지에 사용됨.</td></tr><tr><td></td><td>Checkpointing</td><td>현재 시스템 상태를 주기적으로 저장해 장애 복구 시 재시작 지점으로 사용.</td></tr><tr><td></td><td>Fencing Token</td><td>락의 소유권을 명확히 식별하기 위한 고유 토큰. 중복 실행/충돌 방지.</td></tr><tr><td></td><td>Timeout (타임아웃)</td><td>임계 구역 대기 시간이 초과되면 작업을 중단해 데드락 예방.</td></tr><tr><td></td><td>Auto Healing (오토 힐링)</td><td>시스템 장애 발생 시 자동으로 복구하거나 재시작하는 메커니즘.</td></tr><tr><td></td><td>Observability (관찰 가능성)</td><td>시스템의 락 상태, 경합, 타임아웃 등을 실시간으로 관찰하고 분석하는 역량.</td></tr><tr><td><strong>실무 도구</strong></td><td>ZooKeeper</td><td>분산 시스템을 위한 coordination 서비스. 분산 락, 리더 선출 등에 활용.</td></tr><tr><td></td><td>Redis SETNX</td><td>Redis 의 원자적 키 설정 명령어. 간단한 분산 락 구현에 사용.</td></tr><tr><td></td><td>Deadlock Analyzer</td><td>교착 상태 탐지 및 분석을 위한 도구 또는 기법.</td></tr><tr><td><strong>성능/언어 특성</strong></td><td>GIL (Global Interpreter Lock)</td><td>Python 의 CPython 인터프리터에서 하나의 스레드만 실행 가능한 구조로, 병렬성 제한 요소.</td></tr><tr><td></td><td>Memory Barrier</td><td>CPU 명령의 재정렬을 방지하여 메모리 일관성을 보장하는 기술.</td></tr><tr><td></td><td>Busy Waiting</td><td>락이 해제될 때까지 반복적으로 조건을 검사하는 방식으로 CPU 자원을 소비.</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://en.wikipedia.org/wiki/Mutual_exclusion>Mutual exclusion – Wikipedia</a></li><li><a href=https://en.wikipedia.org/wiki/Peterson%27s_algorithm>Peterson’s algorithm – Wikipedia</a></li><li><a href=https://en.wikipedia.org/wiki/Suzuki%E2%80%93Kasami_algorithm>Suzuki–Kasami algorithm – Wikipedia</a></li><li><a href=https://en.wikipedia.org/wiki/Ricart%E2%80%93Agrawala_algorithm>Ricart–Agrawala algorithm – Wikipedia</a></li><li><a href=https://en.wikipedia.org/wiki/Dekker%27s_algorithm>Dekker’s algorithm – Wikipedia</a></li><li><a href=https://en.wikipedia.org/wiki/Lamport%27s_bakery_algorithm>Lamport’s bakery algorithm – Wikipedia</a></li><li><a href=https://www.cs.uic.edu/~ajayk/Chapter9.pdf>Distributed Mutual Exclusion Algorithms – CS UIC</a></li><li><a href=https://arxiv.org/html/2502.04708v1>Survey on Token‑Based Distributed Mutual Exclusion Algorithms – arXiv</a></li><li><a href=https://www.sciencedirect.com/science/article/abs/pii/S0920548902001058>A survey of permission‑based distributed mutual exclusion algorithms – ScienceDirect</a></li><li><a href=https://uwaterloo.ca/distributed-algorithms-systems-lab/sites/default/files/uploads/files/rme_journal.pdf>Recoverable Mutual Exclusion – University of Waterloo</a></li><li><a href=https://www.numberanalytics.com/blog/ultimate-guide-mutual-exclusion-distributed-algorithms>Mastering Mutual Exclusion in Distributed Systems – Number Analytics</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>