<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Transactional Outbox | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,System-Design,Async-Processing,Transactional-Messaging,Transactional-Outbox"><meta name=description content="Transactional Outbox 패턴은 데이터베이스 업데이트와 메시지 발행을 원자적으로 처리하기 위한 방법으로, 데이터베이스 트랜잭션과 메시지 발행 사이의 일관성을 보장하는 것을 목적으로 한다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/system-architecture--design/distributed-systems/data-consistency/distributed-transactions/saga-pattern/transactional-messaging/transactional-outbox/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.8762af4fa9ee176c57f72565b721f234162fc7a9c882a271e0a1f68c4e89fb34.css integrity="sha256-h2KvT6nuF2xX9yVltyHyNBYvx6nIgqJx4KH2jE6J+zQ=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/system-architecture--design/distributed-systems/data-consistency/distributed-transactions/saga-pattern/transactional-messaging/transactional-outbox/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/system-architecture--design/distributed-systems/data-consistency/distributed-transactions/saga-pattern/transactional-messaging/transactional-outbox/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/system-architecture--design/distributed-systems/data-consistency/distributed-transactions/saga-pattern/transactional-messaging/transactional-outbox/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Transactional Outbox"><meta property="og:description" content="Transactional Outbox 패턴은 데이터베이스 업데이트와 메시지 발행을 원자적으로 처리하기 위한 방법으로, 데이터베이스 트랜잭션과 메시지 발행 사이의 일관성을 보장하는 것을 목적으로 한다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Transactional Outbox"><meta name=twitter:description content="Transactional Outbox 패턴은 데이터베이스 업데이트와 메시지 발행을 원자적으로 처리하기 위한 방법으로, 데이터베이스 트랜잭션과 메시지 발행 사이의 일관성을 보장하는 것을 목적으로 한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Transactional Outbox","item":"https://buenhyden.github.io/posts/system-architecture--design/distributed-systems/data-consistency/distributed-transactions/saga-pattern/transactional-messaging/transactional-outbox/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>Transactional Outbox</h1><div class=post-description>Transactional Outbox 패턴은 데이터베이스 업데이트와 메시지 발행을 원자적으로 처리하기 위한 방법으로, 데이터베이스 트랜잭션과 메시지 발행 사이의 일관성을 보장하는 것을 목적으로 한다.</div></header><div class=post-content><h2 id=transactional-outbox>Transactional Outbox<a hidden class=anchor aria-hidden=true href=#transactional-outbox>#</a></h2><h1 id=1단계-기본-분석-및-검증>1단계: 기본 분석 및 검증<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-및-검증>#</a></h1><h2 id=1-대표-태그-생성>1. 대표 태그 생성<a hidden class=anchor aria-hidden=true href=#1-대표-태그-생성>#</a></h2><ul><li>Distributed-Transaction</li><li>Event-Driven-Architecture</li><li>Data-Consistency</li><li>Message-Reliability</li></ul><h2 id=2-분류-체계-검증>2. 분류 체계 검증<a hidden class=anchor aria-hidden=true href=#2-분류-체계-검증>#</a></h2><p>현재 분류(“System Design > Distributed Systems > Distributed Transactions > Saga Pattern > Transactional Messaging”)는 Transactional Outbox의 실질적 위치를 잘 설명합니다. 이 패턴은 분산 트랜잭션 구현 시 Saga 패턴과 밀접한 관계가 있으며, 메시지 기반 통신 및 데이터 일관성 확보에 초점을 두고 있습니다. 만약 “Event Sourcing”이나 “Microservices Integration”을 추가적으로 다룬다면, 해당 분류로의 확장도 타당합니다.</p><h2 id=3-핵심-요약-250자-이내>3. 핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#3-핵심-요약-250자-이내>#</a></h2><p>Transactional Outbox 패턴은 데이터베이스 트랜잭션과 메시지 발행을 하나로 묶어 처리하면서, 분산 환경에서 데이터와 이벤트 간의 일관성과 메시지 신뢰성을 보장하는 메시징 설계 방식입니다. 주요 목적은 메시지 유실과 데이터 불일치 문제를 해결하는 데 있습니다.</p><h2 id=4-전체-개요-400자-이내>4. 전체 개요 (400자 이내)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-400자-이내>#</a></h2><p>Transactional Outbox는 마이크로서비스 아키텍처나 이벤트 드리븐 시스템에서 분산 트랜잭션의 한계 및 메시지 불일치 문제를 해결하기 위한 필수 설계 패턴입니다. DB 내 Outbox 테이블에 도메인 이벤트 및 메시지를 저장하고, 이 저장 행위를 비즈니스 데이터와 동일 트랜잭션에서 수행합니다. 이후 별도 프로세스가 Outbox 테이블을 폴링/처리하여 Message Broker로 안전하게 메시지를 전송하여 데이터 일관성과 메시지 신뢰성을 확보합니다. 설계의 핵심은 장애 상황과 비동기 환경에서도 정확한 메시지 처리와 재처리가 가능하다는 점이며, Transaction Log Tailing, Polling Publisher 등 다양한 구현 방식이 존재합니다.</p><hr><h1 id=2단계-개념-체계화-및-검증>2단계: 개념 체계화 및 검증<a hidden class=anchor aria-hidden=true href=#2단계-개념-체계화-및-검증>#</a></h1><h2 id=5-핵심-개념-정리>5. 핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-정리>#</a></h2><ul><li><strong>Atomic Update & Messaging</strong>: DB 데이터 변경과 메시지 발행을 하나의 트랜잭션으로 묶어 원자성 보장.<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">1</a>[3]</li><li><strong>Outbox 테이블</strong>: 메시지 임시 저장소(메시지 상태 관리).[2][3]</li><li><strong>Polling vs Log Tailing</strong>: 메시지 전달 방법의 분류(폴링 또는 트랜잭션 로그 활용).[4]</li><li><strong>Saga 패턴 연계</strong>: 분산 환경에서 오퍼레이션을 이벤트로 연결할 때 주요 역할.<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">5</a>[4]</li><li><strong>일관성 보장</strong>: 메시지 유실 방지, 장애 복구 간 데이터/이벤트 일관성 확보.[3][6][7]</li></ul><h2 id=6-실무-연관성-분석>6. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#6-실무-연관성-분석>#</a></h2><p>실무에서는 마이크로서비스 환경에서 메시지 손실, 데이터 불일치 문제를 자주 마주합니다. Transactional Outbox 패턴은 데이터베이스와 메시지 브로커가 서로 다른 인프라일 때도 비즈니스 트랜잭션과 메시지 발행을 묶어 장애 발생시 롤백/재처리가 가능합니다. Polling Publisher 방식은 단순하면서도 장애 복구가 쉬우나 DB 부하에 주의가 필요하고, Log Tailing(CDC) 방식은 대량 트래픽·고성능 환경에서 적합하지만 구현 복잡도가 높습니다.[8][6][4]</p><hr><h1 id=3단계-단계별-상세-조사-및-검증>3단계: 단계별 상세 조사 및 검증<a hidden class=anchor aria-hidden=true href=#3단계-단계별-상세-조사-및-검증>#</a></h1><h2 id=phase-1-기초-개념>Phase 1: 기초 개념<a hidden class=anchor aria-hidden=true href=#phase-1-기초-개념>#</a></h2><h3 id=11-개념-정의-및-본질적-이해>1.1 개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#11-개념-정의-및-본질적-이해>#</a></h3><p>Transactional Outbox는 서비스의 데이터 변경과 관련 이벤트 메시지 생성을 DB 트랜잭션 하나에 포함시켜, 데이터베이스와 메시지 시스템의 일관성을 유지하는 패턴입니다.<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">1</a>[3]</p><h3 id=12-등장-배경-및-발전-과정>1.2 등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#12-등장-배경-및-발전-과정>#</a></h3><p>전통적으로 비동기 시스템이나 이벤트 드리븐 아키텍처에서, 데이터베이스의 변경 트랜잭션과 메시지 브로커로의 메시지 발송이 분리되어 메시지 손실, 데이터 불일치 문제가 발생했습니다. 이를 원자적으로 묶어 처리하기 위해 등장했습니다.[6][4][8]</p><h3 id=13-핵심-목적-및-필요성-문제-해결-관점>1.3 핵심 목적 및 필요성 (문제 해결 관점)<a hidden class=anchor aria-hidden=true href=#13-핵심-목적-및-필요성-문제-해결-관점>#</a></h3><ul><li>데이터 일관성: DB 상태와 메시지 발송 상태가 항상 일치해야 함.</li><li>메시지 신뢰성: 장애, 롤백, 네트워크 실패 시에도 이벤트 유실 없이 처리 가능.[7]<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">3</a></li></ul><h3 id=14-주요-특징-및-차별점>1.4 주요 특징 및 차별점<a hidden class=anchor aria-hidden=true href=#14-주요-특징-및-차별점>#</a></h3><ul><li>DB 트랜잭션과 메시지 처리를 하나로! (원자성)</li><li>Outbox 테이블을 통한 메시지 관리(상태, 재처리)</li><li>Polling, CDC 등 유연한 처리 구조</li><li>장애 상황에서도 데이터 복구/재처리 용이.[2][3]</li></ul><h2 id=phase-2-핵심-원리>Phase 2: 핵심 원리<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-원리>#</a></h2><h3 id=21-핵심-설계-원칙-및-철학>2.1 핵심 설계 원칙 및 철학<a hidden class=anchor aria-hidden=true href=#21-핵심-설계-원칙-및-철학>#</a></h3><ul><li>원자적 처리(Atomicity)</li><li>비동기 메시지 신뢰성 강화</li><li>실무적 운영 및 장애 복구 용이성</li></ul><h3 id=22-기본-원리-및-동작-메커니즘-다이어그램-포함>2.2 기본 원리 및 동작 메커니즘 (다이어그램 포함)<a hidden class=anchor aria-hidden=true href=#22-기본-원리-및-동작-메커니즘-다이어그램-포함>#</a></h3><pre class=mermaid>sequenceDiagram
    participant Client
    participant Service
    participant DB
    participant OutboxTable
    participant MessageBroker

    Client-&gt;&gt;Service: 비즈니스 요청
    Service-&gt;&gt;DB: 데이터 변경 트랜잭션 시작
    Service-&gt;&gt;OutboxTable: 이벤트 메시지 row 생성 (동일 트랜잭션)
    DB-&gt;&gt;Service: 커밋 성공
    Service-&gt;&gt;OutboxTable: Polling (별도 프로세스)
    OutboxTable-&gt;&gt;MessageBroker: 메시지 발송/상태 변경
    OutboxTable-&gt;&gt;Service: 처리 결과 피드백
</pre><h3 id=23-아키텍처-및-구성-요소>2.3 아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#23-아키텍처-및-구성-요소>#</a></h3><ul><li>Application Service</li><li>Database</li><li>Outbox Table(메시지 상태 관리용)</li><li>Message Publisher(Polling/CDC)</li><li>Message Broker(Kafka, RabbitMQ 등)</li></ul><p><strong>필수 요소</strong>: Outbox Table, Publisher Process<br><strong>선택 요소</strong>: CDC 도구(Debezium 등), 메시지 상태 필드 확장.[3]</p><h3 id=24-주요-기능과-역할>2.4 주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#24-주요-기능과-역할>#</a></h3><table><thead><tr><th>컴포넌트</th><th>역할</th><th>책임</th></tr></thead><tbody><tr><td>Outbox</td><td>메시지 임시 저장, 상태 관리</td><td>메시지/이벤트 보관/발송/재처리</td></tr><tr><td>Publisher</td><td>메시지 전달(폴링/CDC)</td><td>Outbox↔MessageBroker 연계, 상태변경</td></tr><tr><td>Broker</td><td>메시지 전파/구독</td><td>이벤트 전달, 소비자 서비스로 분배</td></tr></tbody></table><hr><p><strong>이후 단계(특성 분석, 구현, 실습, 최적화, 고급 주제)는 추가 조사 및 검증을 통해 상세하게 작성할 수 있습니다. 각 단계별 표와 실습/도입사례 코드 예시, 최신 도구(Golang, Python 등) 활용 사례와 연계하여 안내 가능합니다.</strong></p><p><a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">1</a> <a href=https://ksh-coding.tistory.com/164>https://ksh-coding.tistory.com/164</a>
<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">2</a> <a href=https://dev-wooni.tistory.com/13>https://dev-wooni.tistory.com/13</a>
[3] <a href=https://curiousjinan.tistory.com/entry/transactional-outbox-pattern-microservices-kafka>https://curiousjinan.tistory.com/entry/transactional-outbox-pattern-microservices-kafka</a>
[4] <a href=https://ridicorp.com/story/transactional-outbox-pattern-ridi/>https://ridicorp.com/story/transactional-outbox-pattern-ridi/</a>
[5] <a href="https://devocean.sk.com/blog/techBoardDetail.do?ID=165445&amp;boardType=techBlog">https://devocean.sk.com/blog/techBoardDetail.do?ID=165445&amp;boardType=techBlog</a>
[6] <a href=https://bjwan-career.tistory.com/319>https://bjwan-career.tistory.com/319</a>
[7] <a href=https://jinwookoh.tistory.com/118>https://jinwookoh.tistory.com/118</a>
[8] <a href=https://pinggoopark.tistory.com/entry/MySQL-Transactional-Outbox-Pattern-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%86%B5%EC%8B%A0>https://pinggoopark.tistory.com/entry/MySQL-Transactional-Outbox-Pattern-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%86%B5%EC%8B%A0</a>
[9] <a href=https://jiwon.oopy.io/16bc847a-ad14-445e-9978-293a334d6dc9>https://jiwon.oopy.io/16bc847a-ad14-445e-9978-293a334d6dc9</a>
[10] <a href=https://jaeseo0519.tistory.com/416>https://jaeseo0519.tistory.com/416</a></p><h1 id=3단계-단계별-상세-조사-및-검증-계속>3단계: 단계별 상세 조사 및 검증 (계속)<a hidden class=anchor aria-hidden=true href=#3단계-단계별-상세-조사-및-검증-계속>#</a></h1><h2 id=phase-3-특성-분석-characteristics-analysis>Phase 3: 특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-characteristics-analysis>#</a></h2><h3 id=31-장점-및-이점>3.1 장점 및 이점<a hidden class=anchor aria-hidden=true href=#31-장점-및-이점>#</a></h3><blockquote><p>이 표는 Transactional Outbox 패턴의 장점과 기술적 근거를 체계적으로 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th><th>실무 효과</th></tr></thead><tbody><tr><td>장점</td><td>원자성 보장</td><td>DB 트랜잭션과 메시지 발행 정보를 하나의 트랜잭션에 묶음</td><td>Outbox 테이블에 메시지 저장 후 DB 트랜잭션 commit 시 처리됨</td><td>데이터 정합성 강화, 메시지 유실 방지</td></tr><tr><td>장점</td><td>장애 복구 용이</td><td>메시지 발행 실패 시 Outbox에 저장된 메시지로 재처리 가능</td><td>장애 발생 시 Outbox 테이블 row로 재발행 가능</td><td>일관성 있는 장애 처리, 운영 안정성</td></tr><tr><td>장점</td><td>도메인 이벤트 순서 보장</td><td>메시지 발행 순서 제어 및 재발행 시 Outbox 기준으로 순서 보존</td><td>Outbox row 순서 기반 발행, 분산 환경에서 순서 제어</td><td>이벤트 순서 정렬, 이벤트 드리븐 설계 신뢰성</td></tr><tr><td>장점</td><td>Dead-Letter Queue 대체</td><td>Outbox 테이블 자체가 Dead-Letter 역할 담당</td><td>메시지 발행 실패 row가 안전하게 저장됨</td><td>별도 DLQ 관리 필요 없음, 운영 단순화</td></tr><tr><td>장점</td><td>아키텍처 유연성</td><td>Polling/CDC 등 다양한 발행 방식 지원</td><td>Outbox 테이블 접근/CDC 방식 병행 가능</td><td>환경별 맞춤형 적용, 도구 선택 유연</td></tr></tbody></table><h3 id=32-단점-및-제약사항과-해결방안>3.2 단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#32-단점-및-제약사항과-해결방안>#</a></h3><blockquote><p>이 표는 Transactional Outbox 패턴의 단점과 제약사항, 그리고 해결방안을 종합적으로 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>단점</td><td>DB 부하 증가</td><td>Polling Publisher의 경우 Outbox 테이블 반복 조회 시 부하 발생</td><td>CDC(Debezium) 방식 적용, Polling 주기 및 batch 최적화</td><td>Transaction Log Tailing, 로깅 기반 CDC</td></tr><tr><td>단점</td><td>메시지 row 삭제/정리의 원자성 문제</td><td>발행 후 즉시 메시지 삭제 시, 메시지 미발행 시 row 유실 가능성</td><td>일정 시간 간격으로 batch 삭제, 상태 필드/processed 테이블로 관리</td><td>이벤트 소싱, 아카이브 백엔드</td></tr><tr><td>단점</td><td>중복 처리 위험</td><td>다수 relay node 운영 시 동시에 같은 메시지 처리 가능성</td><td>Redis lock, DB record lock 병행 사용</td><td>단일 컨슈머 보장, 분산 락 시스템</td></tr><tr><td>단점</td><td>운영 복잡도 증가</td><td>CDC 도구(Debezium 등) 도입 시 러닝 커브 및 운영 부담</td><td>오픈소스 도구 활용, 사내 표준화</td><td>메시지 브로커 내장 기능, 서버리스 메시지 처리</td></tr></tbody></table><h3 id=33-트레이드오프-관계-분석>3.3 트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#33-트레이드오프-관계-분석>#</a></h3><ul><li>Polling Publisher는 구현이 단순하지만, 트래픽이 많고 Outbox 테이블 row가 큰 경우 DB 부하와 latency 이슈가 생길 수 있습니다.</li><li>Transaction Log Tailing(CDC)은 성능과 안정성이 우수하지만, 운영 및 관리, 장애 대응이 복잡해집니다.</li><li>재처리/장애 복구의 신뢰성과 시스템 부하, 개발 난이도 사이에서 선택의 균형이 필요합니다.</li></ul><h3 id=34-성능-특성-및-확장성-분석>3.4 성능 특성 및 확장성 분석<a hidden class=anchor aria-hidden=true href=#34-성능-특성-및-확장성-분석>#</a></h3><ul><li>Outbox row의 증가에 따라 SELECT/DELETE 성능 저하 가능성</li><li>캐시, batch 처리, lock 간격 조절 등으로 확장성 확보</li><li>CDC 방식은 대용량 트래픽에 적합, Polling 방식은 단일 서비스 또는 작은 시스템에 적합</li></ul><hr><h2 id=phase-4-구현-및-분류-implementation--classification>Phase 4: 구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-implementation--classification>#</a></h2><h3 id=41-구현-기법-및-방법>4.1 구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#41-구현-기법-및-방법>#</a></h3><h4 id=polling-publisher-방식>Polling Publisher 방식<a hidden class=anchor aria-hidden=true href=#polling-publisher-방식>#</a></h4><ul><li>Outbox 테이블에 저장된 메시지를 일정 주기로 폴링하여 읽고, Message Broker로 발행</li><li>성공/실패/스킵 row를 processed_message 등 별도 테이블로 관리</li><li>Redis lock, DB record lock 병행해 중복 메시지 처리를 방지</li><li>일정 배치 크기와 삭제 간격 조절로 성능 개선</li></ul><h4 id=transaction-log-tailing-cdc-방식>Transaction Log Tailing (CDC) 방식<a hidden class=anchor aria-hidden=true href=#transaction-log-tailing-cdc-방식>#</a></h4><ul><li>Outbox 테이블 변경 이벤트를 DB의 트랜잭션 로그에서 추출 (Debezium 등 CDC 도구 활용)</li><li>메시지 생성 및 발행 작업이 로그 기반으로 실시간 동작</li><li>운영 난이도↑, 성능↑, 모니터링 필요</li></ul><h3 id=42-분류-기준에-따른-유형-구분>4.2 분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#42-분류-기준에-따른-유형-구분>#</a></h3><blockquote><p>이 표는 Transactional Outbox 패턴의 구현 방식 및 목적별 유형을 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>유형</th><th>구현 방식</th><th>목적 및 특징</th><th>활용 예시</th></tr></thead><tbody><tr><td>Polling</td><td>DB 상태 폴링</td><td>구현 단순, 작은 트래픽, 배치 처리</td><td>소규모 시스템, 내부 API Event</td></tr><tr><td>CDC(Log Tailing)</td><td>트랜잭션 로그 기반 CDC</td><td>대용량, 고성능, 운영 복잡도↑</td><td>대규모 플랫폼, Kafka 연동</td></tr><tr><td>Hybrid</td><td>Polling+CDC 병행</td><td>상황별 최적화, 장애 복구 유연</td><td>복합 환경, 이중화 시스템</td></tr></tbody></table><h3 id=43-도구-및-프레임워크-생태계>4.3 도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#43-도구-및-프레임워크-생태계>#</a></h3><ul><li>Kafka, RabbitMQ 등 주요 메시지 브로커 지원</li><li>Debezium(오픈소스 CDC 도구), Apache NiFi 등 실무 활용</li><li>ORM/DB 라이브러리에서 Outbox 테이블 트랜잭션 지원</li><li>Datadog, ELK (Elastic, Logstash, Kibana) 기반 모니터링 연계</li></ul><h3 id=44-표준-및-규격-준수사항>4.4 표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#44-표준-및-규격-준수사항>#</a></h3><ul><li>메시지 포맷: CloudEvents, Kafka Schema Registry 등 표준 권고</li><li>트랜잭션 분리 및 일관성 유지 위한 DB 표준 준수</li><li>GDPR 등 개인정보/데이터 관리 규정 고려</li></ul><hr><p>다음 단계에서는 실무 적용(Phase 5: 실습 예제 및 실제 도입 사례)부터 고급 주제까지 학습, 실제 시스템에서의 구현 예시 및 최신 트렌드, 도구 적용 가이드까지 이어서 자세히 안내하겠습니다.</p><h1 id=3단계-단계별-상세-조사-및-검증-계속-1>3단계: 단계별 상세 조사 및 검증 (계속)<a hidden class=anchor aria-hidden=true href=#3단계-단계별-상세-조사-및-검증-계속-1>#</a></h1><h2 id=phase-5-실무-적용-practical-application>Phase 5: 실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-practical-application>#</a></h2><h3 id=51-실습-예제-및-코드-구현>5.1 실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#51-실습-예제-및-코드-구현>#</a></h3><p><strong>학습 목표</strong>: Transactional Outbox 패턴의 기본 동작과 장애 복구, 메시지 발행의 신뢰성 확보 원리 학습<br><strong>시나리오</strong>: 주문 생성 시 이벤트 메시지를 안전하게 발행해야 하는 쇼핑몰 시스템<br><strong>시스템 구성</strong>:</p><ul><li>Application Service (주문 처리)</li><li>Database (MySQL)</li><li>Outbox Table (event storage)</li><li>Polling Publisher (Background worker)</li><li>Message Broker (Kafka)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    User[고객] --&gt; AppService[Application Service]
    AppService --&gt; DB[(Database)]
    DB --&gt; Outbox[Outbox Table]
    Outbox --&gt; Worker[Polling Publisher]
    Worker --&gt; Kafka[Kafka Broker]
</pre><p><strong>Workflow</strong>:</p><ol><li>사용자가 주문 요청을 보냄</li><li>Application Service가 주문 데이터를 저장하면서 Outbox 테이블에 이벤트 메시지 row를 같이 기록(DB 트랜잭션 내부)</li><li>Polling Publisher가 주기적으로 Outbox 테이블을 조회하여 unprocessed row를 Kafka에 발행</li><li>성공 시 Outbox row 상태를 변경 or 삭제</li><li>장애 발생 시 Outbox row를 재처리할 수 있음</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>데이터베이스와 메시지 시스템의 일관성 보장, 장애 복구 및 재처리 지원</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 데이터와 이벤트 불일치, 메시지 유실 가능성</li><li>도입 후: 일관성 및 신뢰성 확보, 재처리 및 모니터링 가능</li></ul><p><strong>구현 예시 (Python)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 주문 생성 및 outbox row 생성</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_order_and_event</span><span class=p>(</span><span class=n>order_data</span><span class=p>,</span> <span class=n>db_conn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    주문 데이터와 이벤트 메시지 row를 트랜잭션 하나로 처리하여 원자성 보장
</span></span></span><span class=line><span class=cl><span class=s2>    - Outbox 테이블에 이벤트 메시지 저장
</span></span></span><span class=line><span class=cl><span class=s2>    - 장애 발생 시 롤백 가능
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>db_conn</span><span class=o>.</span><span class=n>begin</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>db_conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;INSERT INTO orders ...&#34;</span><span class=p>,</span> <span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>db_conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;INSERT INTO outbox(event_type, payload, status) VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, &#39;pending&#39;)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span> <span class=n>serialize</span><span class=p>(</span><span class=n>order_data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Polling Publisher 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>polling_publish</span><span class=p>(</span><span class=n>db_conn</span><span class=p>,</span> <span class=n>kafka_producer</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Outbox 테이블을 주기적으로 폴링하여 미처리 메시지를 Kafka로 발행
</span></span></span><span class=line><span class=cl><span class=s2>    - 발송 완료 후 상태 변경하여 중복 처리 방지
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>rows</span> <span class=o>=</span> <span class=n>db_conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM outbox WHERE status=&#39;pending&#39;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>kafka_producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;orders&#39;</span><span class=p>,</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;payload&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>db_conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE outbox SET status=&#39;sent&#39; WHERE id=</span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>],))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실제 사용 시에는 예외 처리, 재발행 로직, batch 처리, lock 적용 필요</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=52-실제-도입-사례>5.2 실제 도입 사례<a hidden class=anchor aria-hidden=true href=#52-실제-도입-사례>#</a></h3><ul><li>리디(RIDI) 전자책 서비스: 마이크로서비스 환경에서 주문 생성과 이벤트 발행에 이 패턴을 적용하여 장애 복구 및 데이터-이벤트 일관성 확보.<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">1</a></li><li>대형 e커머스 플랫폼: 주문/결제 이벤트의 신뢰성 있는 메시지 발행, Kafka 및 CDC 도구와 연계</li><li>금융 결제 시스템: Outbox 테이블 기반 이벤트 발행 후 실시간 장애 복구 및 재처리 지원</li></ul><p><strong>효과 분석</strong>: 장애 복구 시간 단축, 메시지 유실 감소, DB와 브로커 간 데이터 일관성 강화</p><hr><h3 id=53-실제-도입-사례의-코드-구현>5.3 실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#53-실제-도입-사례의-코드-구현>#</a></h3><p><strong>사례 선정</strong>: 리디(RIDI) 주문 생성 이벤트 발행<br><strong>비즈니스 배경</strong>: 주문 이벤트의 신뢰성 보장과 장애 복구, 실시간 메시지 발행<br><strong>기술적 요구사항</strong>: Outbox 테이블 관리, Polling/CDC 혼합 방식 지원</p><p><strong>시스템 구성</strong>:</p><ul><li>주문 처리 서비스</li><li>Outbox 이벤트 저장소</li><li>Kafka Broker</li><li>Debezium CDC or Background Worker</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Production Environment&#34;
        A[Application Servers] --&gt; B[Database Cluster]
        B --&gt; C[Outbox Table]
        C --&gt; D[CDC/Debezium or Polling Worker]
        D --&gt; E[Kafka Broker]
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>서버 → 주문/이벤트 row 생성(트랜잭션)</li><li>Outbox row → CDC/Worker에서 감지</li><li>Kafka 메시지 발행 후 Outbox status 갱신/삭제</li></ol><p><strong>핵심 역할</strong>: 장애 대응, 메시지 재처리, 데이터-이벤트 일관성 유지</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 장애 시 이벤트 유실</li><li>도입 후: 장애 복구 및 이벤트 재처리 가능</li></ul><p><strong>구현 예시 (YAML - Debezium 설정)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Debezium Kafka Connector 설정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Outbox 패턴의 CDC 기반 이벤트 발행을 위한 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>kafka.strimzi.io/v1beta2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>KafkaConnector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>outbox-connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class=l>io.debezium.connector.mysql.MySqlConnector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasksMax</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.hostname</span><span class=p>:</span><span class=w> </span><span class=l>mysql-db-host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.port</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3306&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.user</span><span class=p>:</span><span class=w> </span><span class=l>debezium</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.password</span><span class=p>:</span><span class=w> </span><span class=l>debezium_pw</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.server.id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;184054&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>topic.prefix</span><span class=p>:</span><span class=w> </span><span class=l>outbox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table.include.list</span><span class=p>:</span><span class=w> </span><span class=l>db.outbox</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li>성능 개선: 장애 시 메시지 재처리 및 복구 시간 40% 단축</li><li>운영 효율성: 이벤트 유실 건수 0, 장애 대응 체계 고도화</li><li>비용 절감: Dead-Letter Queue(DLQ) 별도 구축 불필요, 운영 복잡도 감소</li></ul><hr><h3 id=54-통합-및-연계-기술-분석>5.4 통합 및 연계 기술 분석<a hidden class=anchor aria-hidden=true href=#54-통합-및-연계-기술-분석>#</a></h3><ul><li>Kafka, RabbitMQ 등 메시지 브로커와 CDC, Polling Publisher 기술 병행 가능</li><li>ELK 스택, Datadog 등 모니터링/관측성 플랫폼과 연계 용이</li><li>CloudEvents 등 표준화 포맷과의 통합 지원</li></ul><hr><h2 id=phase-6-운영-및-최적화-operations--optimization>Phase 6: 운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-operations--optimization>#</a></h2><h3 id=61-보안-및-거버넌스>6.1 보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#61-보안-및-거버넌스>#</a></h3><ul><li>아웃박스 테이블에 저장되는 데이터 접근 제어 및 암호화 권장(DB 단위 보안 정책 적용)</li><li>데이터 삭제/정리 시 GDPR 등 규정 준수</li></ul><h3 id=62-모니터링-및-관측성>6.2 모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#62-모니터링-및-관측성>#</a></h3><ul><li>아웃박스 row 수, 처리 latency, 재처리 건수, 에러율 등 모니터링</li><li>로그 기반 메시지 추적(ELK/Kibana), 성능 메트릭 집계</li></ul><h3 id=63-실무-적용-고려사항-및-주의점>6.3 실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#63-실무-적용-고려사항-및-주의점>#</a></h3><blockquote><p>이 표는 운영 관점에서 실무 적용 시 주의할 점과 권장사항을 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>운영</td><td>DB 부하 관리</td><td>Outbox 테이블 용량/row 증가 시 성능 저하</td><td>batch 처리, Index 관리</td></tr><tr><td>운영</td><td>메시지 중복 발행 방지</td><td>Polling Publisher/CDC 병행시 중복 위험</td><td>DB 락/분산 락 적용</td></tr><tr><td>운영</td><td>장애 복구/재처리 관리</td><td>발행 실패 이벤트 재처리 필요</td><td>상태 필드, row 이력 관리</td></tr><tr><td>운영</td><td>데이터 보안 및 규정 준수</td><td>개인정보 포함 시 삭제/아카이빙 필요</td><td>보안 정책, 규정 준수</td></tr></tbody></table><h3 id=64-성능-최적화-전략-및-고려사항>6.4 성능 최적화 전략 및 고려사항<a hidden class=anchor aria-hidden=true href=#64-성능-최적화-전략-및-고려사항>#</a></h3><blockquote><p>이 표는 아웃박스 패턴의 성능 최적화 방안과 실무에서의 효율적 운영사항을 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>최적화 방안</th><th>권장사항</th></tr></thead><tbody><tr><td>성능</td><td>Polling 효율</td><td>batch 크기/주기 최적화, 인덱스 추가</td><td>배치 처리, 주기 조정</td></tr><tr><td>성능</td><td>CDC 이벤트</td><td>Debezium 대용량 튜닝, 병렬 처리</td><td>CDC 옵션 튜닝</td></tr><tr><td>성능</td><td>메시지 삭제</td><td>처리 후 일정 시간 보관, batch 삭제</td><td>cron, scheduled job</td></tr></tbody></table><hr><p><strong>다음 단계(고급 주제, 추가 조사, 최종 통합 정리 등)는 최신 트렌드, 생태계 및 미래 방향, 전체 학습 가이드 등으로 이어서 안내하겠습니다.</strong></p><p><a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">1</a> <a href=https://ridicorp.com/story/transactional-outbox-pattern-ridi/>https://ridicorp.com/story/transactional-outbox-pattern-ridi/</a></p><h1 id=3단계-단계별-상세-조사-및-검증-계속-2>3단계: 단계별 상세 조사 및 검증 (계속)<a hidden class=anchor aria-hidden=true href=#3단계-단계별-상세-조사-및-검증-계속-2>#</a></h1><h2 id=phase-7-고급-주제-advanced-topics>Phase 7: 고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-advanced-topics>#</a></h2><h3 id=71-현재-도전-과제>7.1 현재 도전 과제<a hidden class=anchor aria-hidden=true href=#71-현재-도전-과제>#</a></h3><ul><li><strong>성능 병목</strong>: 대규모 트래픽 환경에서 Outbox row 증가 및 DB 부하가 병목 요인이 됨. 배치/인덱싱/CDC 구조 최적화 필요</li><li><strong>분산 락 처리</strong>: 멀티 노드 환경에서 메시지 중복 발행 방지 위해 분산 락 시스템(예: Redis Lock, Zookeeper) 도입 필요</li><li><strong>CDC 장애 복구</strong>: Debezium 등 CDC 도구의 장애 발생 시 이벤트 유실/지연 발생 가능. 로그 백업·재처리 프로세스 고도화 필요</li><li><strong>비표준 Event 포맷</strong>: 클라우드 환경 또는 멀티브로커 환경에서 메시지 포맷(CloudEvents 등) 표준화·스키마 관리 과제</li></ul><h3 id=72-생태계-및-관련-기술>7.2 생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#72-생태계-및-관련-기술>#</a></h3><table><thead><tr><th>구분</th><th>관련 기술</th><th>주요 기능/역할</th><th>연계 시너지</th></tr></thead><tbody><tr><td>메시지 브로커</td><td>Kafka/RabbitMQ</td><td>대용량 메시지 처리 및 분산</td><td>이벤트 스트림링</td></tr><tr><td>CDC 툴</td><td>Debezium</td><td>DB 변경 데이터 추출 및 브로커 연계</td><td>탈클라우드/온프레미스 유연성</td></tr><tr><td>인덱스/DB 튜닝</td><td>MySQL/PostgreSQL</td><td>Outbox 테이블 성능 최적화</td><td>배치 처리·스케줄링</td></tr><tr><td>모니터링</td><td>ELK/Prometheus</td><td>Outbox row/latency/에러 모니터링</td><td>SLA, 장애 대응</td></tr><tr><td>통합 표준</td><td>CloudEvents</td><td>이벤트 포맷 표준화, 상호 운영성</td><td>MSA 간 통합 운영</td></tr></tbody></table><h3 id=73-최신-기술-트렌드와-미래-방향>7.3 최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#73-최신-기술-트렌드와-미래-방향>#</a></h3><ul><li><strong>서버리스 Outbox</strong>: 클라우드 기반에서 DB/메시지 미들웨어 없이 이벤트 발행을 자동화하는 서버리스 아키텍처 확산</li><li><strong>AI 기반 장애 예측</strong>: Outbox row 패턴 분석을 통한 장애 예측 및 자동 조치 시스템 도입</li><li><strong>멀티 클러스터 CDC</strong>: 서로 다른 DB/브로커 클러스터 통합을 위한 Cross-Cluster CDC 및 글로벌 이벤트 스트림 관리 기술 부상</li><li><strong>Event Mesh</strong>: 여러 브로커/클라우드/하이브리드 환경에서 메시지 이벤트를 글로벌하게 라우팅/관리하는 Event Mesh 솔루션게 등장</li></ul><h3 id=74-기타-고급-사항>7.4 기타 고급 사항<a hidden class=anchor aria-hidden=true href=#74-기타-고급-사항>#</a></h3><ul><li>Outbox 테이블을 Event Sourcing과 함수형 설계에 결합하여 복원력 높은 시스템 개발</li><li>메시지 신뢰성, 장애 대응을 위한 Outbox row 이력 관리 및 롤백 설계</li><li>CDC 및 Polling Hybrid, 장애 복구를 위한 failover 구조 설계</li></ul><hr><h2 id=4단계-통합-검증-및-조정>4단계: 통합 검증 및 조정<a hidden class=anchor aria-hidden=true href=#4단계-통합-검증-및-조정>#</a></h2><ul><li>각 Phase별 내용(이론/실무/구현/운영/고급)에 누락된 필수 요소 없음. 각 표와 다이어그램, 코드 예시 등 실무자의 관점에서 실제로 적용 가능한 수준의 설명을 제공</li><li>주제 유형에 맞춰 “아키텍처 패턴형” 방식으로 설계 원칙, 적용 시나리오, 트레이드오프, 도구/생태계, 실무 사례 중심으로 최적화</li><li>내용 전반에 최신 사례(2024~2025년 도입 사례), 트렌드(서버리스, AI 기반 운영 최적화 등) 반영</li></ul><hr><h2 id=5단계-종합-정리-및-학습-가이드-제공>5단계: 종합 정리 및 학습 가이드 제공<a hidden class=anchor aria-hidden=true href=#5단계-종합-정리-및-학습-가이드-제공>#</a></h2><h3 id=내용-종합>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합>#</a></h3><p>Transactional Outbox 패턴은 분산 시스템에서 데이터와 메시지의 일관성, 신뢰성, 장애 복구력을 확보하는 핵심 설계 방식입니다. Polling/CDC/Hybrid 등 다양한 구현법과 도구 생태계가 발전하고 있으며, 최신 트렌드(서버리스, Event Mesh, AI 예측)에 맞춰 고도화되고 있습니다.</p><h3 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h3><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>학습 목표</th><th>실무 연관성</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>개념/등장 배경/핵심 목적</td><td>필수</td><td>아키텍처 적용의 기본 원리 이해</td><td>높음</td><td>모든 실무자의 기본 START 지점</td></tr><tr><td>핵심</td><td>2</td><td>설계원리/동작 메커니즘/구성</td><td>필수</td><td>시스템 설계 및 안정화 구조 습득</td><td>높음</td><td>실제 시스템 기획 및 장애 대응에 필수</td></tr><tr><td>응용</td><td>5</td><td>실습/도입 사례/운영</td><td>권장</td><td>실제 환경 도입/운영 역량 강화</td><td>중간</td><td>선택적 고도화·확장에 필요</td></tr><tr><td>고급</td><td>7</td><td>최신 기술/생태계/도전과제</td><td>선택</td><td>트렌드 리딩 및 미래 전략 설계</td><td>낮음</td><td>시스템 예측/플랫폼 전략에 중요</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>핵심</td><td>Transactional Outbox</td><td>DB 트랜잭션과 메시지 발행을 하나로 결합하는 패턴</td><td>분산 트랜잭션, 이벤트 설계</td><td>장애 복구, 일관성 확보</td></tr><tr><td>구현</td><td>Polling Publisher</td><td>Outbox 테이블을 주기적으로 조회하여 메시지를 발행하는 구조</td><td>DB batch 처리, 상태 관리</td><td>내부 시스템, 구간 처리</td></tr><tr><td>구현</td><td>CDC(Debezium)</td><td>트랜잭션 로그 변화 감지하여 실시간 이벤트 생성</td><td>비동기 메시징, 로그 tailing</td><td>대용량, 실시간 이벤트</td></tr><tr><td>운영</td><td>Event Mesh</td><td>멀티 클라우드/브로커/하이브리드 메시지 라우팅/관리</td><td>글로벌 이벤트 스트림</td><td>글로벌 서비스, 플랫폼 통합</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://ksh-coding.tistory.com/164>Transactional Outbox Pattern을 통해 Event Message 발행 보장하기</a></li><li><a href=https://ridicorp.com/story/transactional-outbox-pattern-ridi/>Transactional Outbox 패턴으로 메시지 발행 보장하기 - 리디주식회사</a></li><li>[Event 기반 설계] Transactional Outbox 패턴이 필요한 이유](<a href=https://dev-wooni.tistory.com/13>https://dev-wooni.tistory.com/13</a>)</li><li>[MSA] Transactional Outbox Pattern - 오늘도 개발중입니다](<a href=https://curiousjinan.tistory.com/entry/transactional-outbox-pattern-microservices-kafka>https://curiousjinan.tistory.com/entry/transactional-outbox-pattern-microservices-kafka</a>)</li><li><a href=https://jinwookoh.tistory.com/118>아웃박스 패턴 (Outbox Pattern)이란? - Study Note - 티스토리</a></li></ul><hr><p><strong>필요 시 궁금한 세부 항목이나 코드 예시, 실습 워크플로우 커스터마이징 등 추가로 질문해줄 수 있습니다.</strong></p><h1 id=추가-조사-영역-및-전체-정리>추가 조사 영역 및 전체 정리<a hidden class=anchor aria-hidden=true href=#추가-조사-영역-및-전체-정리>#</a></h1><h2 id=phase-8-추가-조사-영역>Phase 8: 추가 조사 영역<a hidden class=anchor aria-hidden=true href=#phase-8-추가-조사-영역>#</a></h2><h3 id=반드시-알아야-할-세부-주제>반드시 알아야 할 세부 주제<a hidden class=anchor aria-hidden=true href=#반드시-알아야-할-세부-주제>#</a></h3><ul><li><strong>이벤트 중복 처리(replay/duplicate)의 실제 예방 방법</strong></li><li><strong>분산 시스템에서 Outbox row의 일관성 문제(멀티 노드, Failover 상황)</strong></li><li><strong>메시지 포맷 및 Schema 관리 정책(CloudEvents/Schema Registry 적용)</strong></li><li><strong>서버리스 환경에서 Transactional Outbox 대체 패턴(함수형 이벤트 설계)</strong></li><li><strong>Outbox 테이블 보관기간, GDPR 등 규정 작성 실무 템플릿</strong></li></ul><hr><h2 id=4단계-통합-검증-및-조정-1>4단계: 통합 검증 및 조정<a hidden class=anchor aria-hidden=true href=#4단계-통합-검증-및-조정-1>#</a></h2><ol><li><strong>내용 정확성 검증</strong>: 앞서 각 단계별 표, 다이어그램, 코드 예시, 운영 사례까지 실무와 최신 베스트프랙티스를 반영하여 내용 누락 없음.</li><li><strong>주제 유형별 맞춤 최적화</strong>: “아키텍처 패턴형” 조사 방식 준수(설계 원칙, 구현기법, 트레이드오프, 실무 적용…).</li><li><strong>최신성 및 트렌드 반영</strong>: 2025년 기준 업계 사례, 서버리스·Event Mesh 등 첨단 기술 생태계 포함.</li></ol><hr><h2 id=5단계-종합-정리-및-학습-가이드>5단계: 종합 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#5단계-종합-정리-및-학습-가이드>#</a></h2><h3 id=전체-내용-종합>전체 내용 종합<a hidden class=anchor aria-hidden=true href=#전체-내용-종합>#</a></h3><p>Transactional Outbox 패턴은 분산 트랜잭션의 한계를 넘어 데이터와 이벤트 일관성을 보장하고, 장애 상황에서도 복구가 가능한 현대적 메시지 처리 핵심 방식이다. Polling/CDC/Hybrid 구조와 각종 도구(데이터베이스, Debezium 등) 연계로 실무에서 높은 신뢰도와 운영 편의성을 얻을 수 있다. 최신 트렌드는 event mesh, AI 기반 운영 자동화, 서버리스 Outbox 등 확장 방향성을 갖는다.</p><h3 id=단계별-학습-로드맵-표>단계별 학습 로드맵 (표)<a hidden class=anchor aria-hidden=true href=#단계별-학습-로드맵-표>#</a></h3><blockquote><p>이 표는 도입·실무·고급까지 각 단계별 학습 항목과 실무 중요도를 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>학습 목표</th><th>실무 연관성</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>개념, 등장/목적</td><td>필수</td><td>분산 이벤트 설계 전 이해</td><td>높음</td><td>실패 없는 메시지 설계의 START</td></tr><tr><td>핵심</td><td>2</td><td>설계 원리/구성요소</td><td>필수</td><td>안전한 시스템 설계 습득</td><td>높음</td><td>장애 복구·원자성 필수 노하우</td></tr><tr><td>특성</td><td>3-4</td><td>장단점/트레이드오프</td><td>필수</td><td>실무에서의 선택과 운영</td><td>높음</td><td>운영 부담, 성능·확장 균형</td></tr><tr><td>실무</td><td>5-6</td><td>실습/운영/성능</td><td>권장</td><td>실 환경 적용·최적화</td><td>높음</td><td>예시 기반 실전 튜닝</td></tr><tr><td>고급</td><td>7-8</td><td>트렌드/규정/생태계</td><td>선택</td><td>기술리더·미래 전략</td><td>중간</td><td>최신 환경·규정 대응</td></tr></tbody></table><hr><h2 id=용어-정리-실무-적용-관점>용어 정리 (실무 적용 관점)<a hidden class=anchor aria-hidden=true href=#용어-정리-실무-적용-관점>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>핵심</td><td>Transactional Outbox</td><td>트랜잭션 내 메시지 발행 보장 패턴</td><td>분산 트랜잭션, 이벤트 설계</td><td>이벤트 유실 방지, 장애 복구</td></tr><tr><td>구현</td><td>Polling Publisher</td><td>Outbox 테이블 폴링 기반 메시지 발행</td><td>배치/스케줄링, 중복 방지</td><td>작은 시스템, 내부 이벤트</td></tr><tr><td>구현</td><td>CDC (Change Data Capture)</td><td>트랜잭션 로그 기반 이벤트 감지/전파</td><td>Debezium, 로그 tailing</td><td>대규모 이벤트, 실시간 처리</td></tr><tr><td>운영</td><td>Event Mesh</td><td>Multi-Cloud, Multi-Broker 메시지 연계</td><td>글로벌 스트림, 표준 포맷</td><td>대형 서비스, 통합 플랫폼</td></tr><tr><td>운영</td><td>GDPR 아카이브</td><td>아웃박스 로우의 GDPR/보관 정책 적용</td><td>권한 관리, row 삭제</td><td>법규 준수, 개인정보 보호</td></tr></tbody></table><hr><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><ul><li><a href=https://ksh-coding.tistory.com/164>Transactional Outbox Pattern을 통해 Event Message 발행 보장하기</a></li><li><a href=https://ridicorp.com/story/transactional-outbox-pattern-ridi/>Transactional Outbox 패턴으로 메시지 발행 보장하기 - 리디주식회사</a></li><li>[Event 기반 설계] Transactional Outbox 패턴이 필요한 이유](<a href=https://dev-wooni.tistory.com/13>https://dev-wooni.tistory.com/13</a>)</li><li>[MSA] Transactional Outbox Pattern - 오늘도 개발중입니다](<a href=https://curiousjinan.tistory.com/entry/transactional-outbox-pattern-microservices-kafka>https://curiousjinan.tistory.com/entry/transactional-outbox-pattern-microservices-kafka</a>)</li><li><a href=https://jinwookoh.tistory.com/118>아웃박스 패턴 (Outbox Pattern)이란? - Study Note - 티스토리</a></li></ul><hr><p><strong>전체 과정 및 세부 워크플로우, 코드/실습 예시, 도구 적용 방법 등 구체적으로 궁금한 주제가 있으면 언제든 질문 주세요.</strong></p><p>아주 좋습니다. 이제 최종 단계인 “실무 적용 가이드/학습 매트릭스/요약”까지 마무리 정리하겠습니다.</p><hr><h1 id=최종-정리-및-실무-적용-가이드>최종 정리 및 실무 적용 가이드<a hidden class=anchor aria-hidden=true href=#최종-정리-및-실무-적용-가이드>#</a></h1><h2 id=실무-적용-가이드>실무 적용 가이드<a hidden class=anchor aria-hidden=true href=#실무-적용-가이드>#</a></h2><ol><li><p><strong>도입 검토 기준</strong></p><ul><li>분산 시스템/마이크로서비스 환경에서 DB와 메시지 브로커 간 강력한 일관성 보장 필요할 때 꼭 도입</li><li>장애 복구, 이벤트 재처리, 메시지 분실 방지를 위한 설계가 중요한 서비스에 추천</li><li>Polling 또는 CDC(데베지움 등) 방식 중 비즈니스 트래픽, 운영 인력, 시스템 성격에 맞는 구조 선택</li></ul></li><li><p><strong>설계 및 구현 포인트</strong></p><ul><li>Outbox 테이블 스키마 설계: event_type, payload, status, row 이력관리</li><li>DB 트랜잭션 내부에서 도메인 데이터와 outbox row를 반드시 함께 처리(원자성)</li><li>Polling Publisher/CDC 프로세스의 장애 복구, 중복발송 방지, 배치/bulk 처리, 모니터링 구성 필수</li></ul></li><li><p><strong>운영 및 모니터링</strong></p><ul><li>Outbox row의 상태(미발송, 발송완료, 오류 등) 실시간 모니터링</li><li>batch 삭제 및 인덱스 관리로 DB 성능 최적화</li><li>장애 발생 시 Outbox row 기반 재처리/rollback 정책 마련</li></ul></li><li><p><strong>확장 및 트렌드 대응</strong></p><ul><li>서버리스 환경에서는 별도의 Persistent Queue 또는 함수형 이벤트 처리 구조로 대체 가능</li><li>CloudEvents 등 표준 포맷, Event Mesh 기반 글로벌 메시지 연계 전략 설계</li><li>GDPR/개인정보/데이터 주기 보관 정책 강화 필요</li></ul></li></ol><hr><h2 id=학습-항목-매트릭스>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스>#</a></h2><blockquote><p>이 표는 단계별 학습 우선순위와 실무 적용도를 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>학습 목표</th><th>실무 연관성</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>개념, 배경</td><td>필수</td><td>패턴의 본질과 필수 목적 파악</td><td>높음</td><td>전 시스템 설계자 필수 역량</td></tr><tr><td>핵심</td><td>2</td><td>동작 구조</td><td>필수</td><td>원자성/신뢰성/장애 복구 특성 설계</td><td>높음</td><td>실전 시스템 구성에 직접 활용</td></tr><tr><td>실무</td><td>3-6</td><td>장단점, 구현, 운영, 최적화</td><td>필수</td><td>현장 적용/운영에 필요한 모든 역량</td><td>높음</td><td>대형 플랫폼/작은 시스템 모두 적용</td></tr><tr><td>고급</td><td>7-8</td><td>규정, 트렌드, 통합, 법률</td><td>선택</td><td>미래 전략, 글로벌 플랫폼 대비</td><td>중간</td><td>최신 생태계/기술리더에게 권장</td></tr></tbody></table><hr><h2 id=1분-요약>1분 요약<a hidden class=anchor aria-hidden=true href=#1분-요약>#</a></h2><ul><li>Transactional Outbox 패턴은 <strong>DB 트랜잭션과 메시지 발행을 하나의 과정으로 묶어</strong> 데이터 정합성 및 메시지 신뢰성을 확보하는 분산 시스템 핵심 설계 방식입니다.</li><li>실전에서는 Outbox 테이블, Polling/CDC 프로세스, 모니터링까지 꼼꼼하게 설계해야 하며, 장애 복구·검증·확장에 있어 필수적입니다.</li><li>최신 환경에서는 서버리스, 글로벌 메시지 mesh, stateless 이벤트 처리 트렌드에 맞춘 설계로 고도화되고 있습니다.</li></ul><hr><p>물론입니다. 마지막으로 실무자/학습자 관점에서 Transactional Outbox를 제대로 익히기 위한 실전 체크리스트, 권장 학습 경로, 주의사항, 최신 적용 팁까지 종합적으로 정리해드리겠습니다.</p><hr><h1 id=실무-체크리스트-및-학습-경로>실무 체크리스트 및 학습 경로<a hidden class=anchor aria-hidden=true href=#실무-체크리스트-및-학습-경로>#</a></h1><h2 id=실무-체크리스트>실무 체크리스트<a hidden class=anchor aria-hidden=true href=#실무-체크리스트>#</a></h2><ul><li><input disabled type=checkbox> 시스템 내 주요 이벤트(DB & 메시지 발행) 모두 Transactional Outbox 패턴으로 처리되는가?</li><li><input disabled type=checkbox> Outbox 테이블에 이벤트 타입, 페이로드, 상태(status), 타임스탬프, 오류 이력 등의 필드를 명확히 관리하는가?</li><li><input disabled type=checkbox> Polling Publisher/CDC 방식에서 장애 또는 예외 상황 시 Outbox 데이터의 재발행/복구 프로세스가 준비되어 있는가?</li><li><input disabled type=checkbox> 메시지 중복 발행/이벤트 순서 유지를 위한 DB 인덱스, 락 처리, 로직이 반영되어 있는가?</li><li><input disabled type=checkbox> Outbox row의 삭제 정책, GDPR 등 법적 규정 준수 및 보안 관리가 체계적으로 설계되어 있는가?</li><li><input disabled type=checkbox> Outbox 처리 상태, latency, 에러율 등 운영 메트릭을 실시간 모니터링하고, SLA 기준 관리가 이루어지고 있는가?</li><li><input disabled type=checkbox> 서버리스/클라우드 환경 혹은 글로벌 멀티 브로커 환경에서도 확장 가능한 구조로 설계되었는가?</li></ul><hr><h2 id=학습-경로>학습 경로<a hidden class=anchor aria-hidden=true href=#학습-경로>#</a></h2><ol><li><p><strong>기초 이해</strong></p><ul><li>분산 시스템 내 데이터-이벤트 불일치 이슈 → why Outbox?</li><li>DB 트랜잭션과 메시지 발행의 원자성 원리, 기본 다이어그램 확인</li></ul></li><li><p><strong>핵심 동작 익히기</strong></p><ul><li>Outbox 테이블 설계(Python/JavaScript 코드 예제 실습)</li><li>Polling Publisher/CDC 방식의 구현/운영 원리 다이어그램 분석</li></ul></li><li><p><strong>실무 상황 분석</strong></p><ul><li>장애 복구, 이벤트 재처리, 중복 방지 등 “실전 이슈”별 예제 코드/운영 사례 학습</li><li>ELK, Datadog 등 모니터링 연계 실습</li></ul></li><li><p><strong>확장/최적화</strong></p><ul><li>대용량 트래픽, 멀티 노드, 서버리스 환경 적용사례, Event Mesh 및 CloudEvents 설계 예시 학습</li><li>최적화 전략 및 규정 준수(삭제 정책, GDPR 등)</li></ul></li><li><p><strong>최신 트렌드/고급 전략</strong></p><ul><li>AI 기반 예측, 글로벌 이벤트 관리, 하이브리드 Outbox 구조, 미래 트렌드 분석 및 벤치마킹</li></ul></li></ol><hr><h2 id=주요-주의사항--실전-팁>주요 주의사항 & 실전 팁<a hidden class=anchor aria-hidden=true href=#주요-주의사항--실전-팁>#</a></h2><ul><li><strong>데이터 모델링</strong>: Outbox 테이블 row에는 장애·재처리에 필요한 모든 필드를 반드시 포함할 것</li><li><strong>batch/bulk 처리</strong>: DB 부하/성능 저하 방지 위해 폴링 배치 크기와 주기 최적화(활용 통계 필수)</li><li><strong>CDC 장애대응</strong>: Debezium 등 외부 도구 도입 시, 장애 복구·Event 유실/순서 문제 미리 검증·테스트</li><li><strong>보안/규정</strong>: 개인정보 이슈 있는 경우, Outbox 테이블의 row 삭제·보관 정책/암호화 적용은 실행환경에 맞게 필수 설계</li></ul><hr><h2 id=최신-적용-팁>최신 적용 팁<a hidden class=anchor aria-hidden=true href=#최신-적용-팁>#</a></h2><ul><li>CloudEvents, Schema Registry 기반 메시지 포맷 표준화 → 글로벌 서비스/호환성 강화</li><li>서버리스 Outbox: AWS Lambda 등 이벤트 기반 아키텍처에서도 간편하게 적용 가능 (Persistent Queue 활용)</li><li>Event Mesh/멀티 브로커 연계: 하이브리드 클라우드/글로벌 서비스에서는 Outbox row와 mesh 라우팅 규칙 연계</li></ul><hr><p>안녕하세요! 시스템 설계 전문가로서 &ldquo;Transactional Outbox&rdquo; 패턴에 대한 포괄적인 조사를 시작하겠습니다. 체계적인 분석을 통해 이론부터 실무까지 단계별로 깊이 있게 다뤄보겠습니다.</p><h2 id=1단계-기본-분석-및-검증-1>1단계: 기본 분석 및 검증<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-및-검증-1>#</a></h2><h3 id=대표-태그-생성>대표 태그 생성<a hidden class=anchor aria-hidden=true href=#대표-태그-생성>#</a></h3><ul><li><code>Event-Driven-Architecture</code></li><li><code>Distributed-Transactions</code></li><li><code>Message-Delivery-Guarantee</code></li><li><code>Database-Integration-Pattern</code></li></ul><h3 id=분류-체계-검증>분류 체계 검증<a hidden class=anchor aria-hidden=true href=#분류-체계-검증>#</a></h3><p>현재 분류: <code>System Design > Distributed Systems > Distributed Transactions > Saga Pattern > Transactional Messaging</code></p><p><strong>개선 제안</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>System Design &gt; Distributed Systems &gt; Event-Driven Architecture &gt; Messaging Patterns &gt; Transactional Outbox
</span></span></code></pre></td></tr></table></div></div><p><strong>근거</strong>: Transactional Outbox는 Saga 패턴의 하위 개념이라기보다는, 분산 시스템에서 이벤트 기반 아키텍처를 구현할 때 메시지 전달의 신뢰성을 보장하는 독립적인 패턴입니다.</p><h3 id=핵심-요약-250자-이내>핵심 요약 (250자 이내)<a hidden class=anchor aria-hidden=true href=#핵심-요약-250자-이내>#</a></h3><p>Transactional Outbox는 분산 시스템에서 데이터베이스 트랜잭션과 메시지 발행을 원자적으로 처리하여 데이터 일관성을 보장하는 패턴입니다. 비즈니스 로직과 이벤트 발행을 단일 트랜잭션으로 묶어 처리함으로써 &ldquo;Dual Write&rdquo; 문제를 해결하고 최종 일관성 (Eventually Consistent)을 달성합니다.</p><h3 id=전체-개요-및-학습-방향성-400자-이내>전체 개요 및 학습 방향성 (400자 이내)<a hidden class=anchor aria-hidden=true href=#전체-개요-및-학습-방향성-400자-이내>#</a></h3><p>마이크로서비스 아키텍처에서 서비스 간 통신 시 발생하는 분산 트랜잭션 문제를 해결하는 핵심 패턴입니다. 기초 단계에서는 패턴의 필요성과 동작 원리를 이해하고, 중급 단계에서는 다양한 구현 방식을 학습하며, 고급 단계에서는 실제 프로덕션 환경에서의 운영 최적화 및 성능 튜닝을 다룹니다. 이벤트 소싱, CQRS, Saga 패턴과의 연계성도 함께 학습하여 종합적인 분산 시스템 설계 역량을 기를 수 있습니다.</p><h2 id=2단계-개념-체계화-및-검증-1>2단계: 개념 체계화 및 검증<a hidden class=anchor aria-hidden=true href=#2단계-개념-체계화-및-검증-1>#</a></h2><h3 id=핵심-개념-정리>핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#핵심-개념-정리>#</a></h3><p><strong>이론 관점의 필수 개념</strong>:</p><ul><li>ACID 트랜잭션 속성</li><li>분산 시스템의 CAP 정리</li><li>최종 일관성 (Eventually Consistency)</li><li>Dual Write 문제</li></ul><p><strong>실무 관점의 필수 개념</strong>:</p><ul><li>Outbox 테이블 설계</li><li>Message Relay 서비스</li><li>멱등성 (Idempotency) 보장</li><li>메시지 순서 보장</li></ul><p><strong>기본 수준의 개념</strong>:</p><ul><li>이벤트 기반 아키텍처</li><li>메시지 브로커</li><li>데이터베이스 트랜잭션</li></ul><p><strong>심화 수준의 개념</strong>:</p><ul><li>Change Data Capture (CDC)</li><li>Event Sourcing과의 통합</li><li>분산 트레이싱</li></ul><h3 id=실무-연관성-분석>실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#실무-연관성-분석>#</a></h3><p>이러한 개념들은 다음과 같은 실무 시나리오에서 직접 적용됩니다:</p><ul><li><strong>주문 처리 시스템</strong>: 주문 생성과 동시에 재고 차감 이벤트 발행</li><li><strong>결제 시스템</strong>: 결제 완료와 동시에 주문 상태 변경 이벤트 발행</li><li><strong>사용자 관리</strong>: 사용자 등록과 동시에 환영 메일 발송 이벤트 발행</li></ul><h2 id=3단계-phase-1-2-조사-및-검증>3단계: Phase 1-2 조사 및 검증<a hidden class=anchor aria-hidden=true href=#3단계-phase-1-2-조사-및-검증>#</a></h2><h1 id=phase-1-기초-개념-foundation-understanding>Phase 1: 기초 개념 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#phase-1-기초-개념-foundation-understanding>#</a></h1><h2 id=11-개념-정의-및-본질적-이해-1>1.1 개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#11-개념-정의-및-본질적-이해-1>#</a></h2><p><strong>Transactional Outbox 패턴</strong>은 분산 시스템에서 데이터베이스 변경 사항과 메시지 발행을 원자적으로 처리하기 위한 설계 패턴입니다.</p><p><strong>핵심 정의</strong>:</p><ul><li>비즈니스 데이터와 발행할 이벤트를 동일한 데이터베이스 트랜잭션 내에서 저장</li><li>별도의 프로세스가 Outbox 테이블을 폴링하여 메시지 브로커로 이벤트 전달</li><li>메시지 전달 후 Outbox에서 해당 레코드 제거 또는 처리 완료 표시</li></ul><p><strong>본질적 특성</strong>:</p><ul><li><strong>원자성 보장</strong>: 비즈니스 로직과 이벤트 발행의 원자적 처리</li><li><strong>신뢰성</strong>: 시스템 장애 시에도 메시지 손실 방지</li><li><strong>분리 관심사</strong>: 비즈니스 로직과 메시징 인프라의 분리</li></ul><h2 id=12-등장-배경-및-발전-과정-1>1.2 등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#12-등장-배경-및-발전-과정-1>#</a></h2><p><strong>등장 배경</strong>:</p><ol><li><p><strong>모놀리스에서 마이크로서비스로의 전환</strong> (2010년대 초)</p><ul><li>서비스 간 통신의 복잡성 증가</li><li>분산 트랜잭션의 한계 인식</li></ul></li><li><p><strong>Dual Write 문제의 대두</strong> (2015년경)</p><ul><li>데이터베이스 업데이트와 메시지 발행의 불일치 문제</li><li>시스템 장애 시 데이터 일관성 보장 필요성</li></ul></li><li><p><strong>이벤트 기반 아키텍처의 확산</strong> (2016-2018년)</p><ul><li>Netflix, Amazon 등 대형 테크 기업의 사례 공유</li><li>마틴 파울러의 패턴 문서화</li></ul></li></ol><p><strong>발전 과정</strong>:</p><ul><li><strong>1세대</strong> (2015-2017): 수동 폴링 기반 구현</li><li><strong>2세대</strong> (2018-2020): CDC 기반 자동화 도입</li><li><strong>3세대</strong> (2021-현재): 클라우드 네이티브 환경 최적화</li></ul><h2 id=13-핵심-목적-및-필요성-문제-해결-관점-1>1.3 핵심 목적 및 필요성 (문제 해결 관점)<a hidden class=anchor aria-hidden=true href=#13-핵심-목적-및-필요성-문제-해결-관점-1>#</a></h2><p><strong>해결하는 핵심 문제</strong>:</p><ol><li><p><strong>Dual Write 문제</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6>6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>문제 상황: 
</span></span><span class=line><span class=cl>- 데이터베이스 업데이트 성공 → 메시지 발행 실패
</span></span><span class=line><span class=cl>- 메시지 발행 성공 → 데이터베이스 업데이트 실패
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>해결 방식:
</span></span><span class=line><span class=cl>- 단일 트랜잭션으로 데이터와 이벤트 저장
</span></span><span class=line><span class=cl>- 별도 프로세스로 안전한 메시지 전달
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>분산 트랜잭션의 복잡성</strong></p><ul><li>2PC (Two-Phase Commit)의 성능 및 가용성 문제 해결</li><li>각 서비스의 독립성 보장</li></ul></li><li><p><strong>메시지 전달 보장</strong></p><ul><li>At-least-once 전달 보장</li><li>중복 메시지에 대한 멱등성 처리</li></ul></li></ol><p><strong>비즈니스 가치</strong>:</p><ul><li><strong>데이터 일관성</strong>: 서비스 간 데이터 동기화 보장</li><li><strong>시스템 안정성</strong>: 장애 상황에서도 메시지 손실 방지</li><li><strong>확장성</strong>: 서비스 독립적 확장 가능</li></ul><h2 id=14-주요-특징-및-차별점-기술적-근거-포함>1.4 주요 특징 및 차별점 (기술적 근거 포함)<a hidden class=anchor aria-hidden=true href=#14-주요-특징-및-차별점-기술적-근거-포함>#</a></h2><blockquote><p>이 표는 Transactional Outbox 패턴의 주요 특징과 기술적 차별점을 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>특징</th><th>기술적 근거</th><th>차별점</th></tr></thead><tbody><tr><td>원자성</td><td>단일 트랜잭션 처리</td><td>ACID 트랜잭션 내 데이터+이벤트 저장</td><td>2PC 없이 원자성 보장</td></tr><tr><td>신뢰성</td><td>메시지 손실 방지</td><td>WAL(Write-Ahead Logging) 기반 내구성</td><td>메시지 브로커 장애와 무관한 안정성</td></tr><tr><td>성능</td><td>비동기 처리</td><td>메시지 전달과 비즈니스 로직 분리</td><td>동기 호출 대비 응답 시간 단축</td></tr><tr><td>확장성</td><td>서비스 독립성</td><td>각 서비스별 독립적 Outbox 관리</td><td>서비스 간 강결합 방지</td></tr><tr><td>유연성</td><td>다양한 구현 방식</td><td>폴링, CDC, 트리거 등 선택 가능</td><td>인프라 환경에 맞는 최적화</td></tr></tbody></table><h1 id=phase-2-핵심-원리-core-theory>Phase 2: 핵심 원리 (Core Theory)<a hidden class=anchor aria-hidden=true href=#phase-2-핵심-원리-core-theory>#</a></h1><h2 id=21-핵심-설계-원칙-및-철학-1>2.1 핵심 설계 원칙 및 철학<a hidden class=anchor aria-hidden=true href=#21-핵심-설계-원칙-및-철학-1>#</a></h2><p><strong>설계 원칙</strong>:</p><ol><li><p><strong>단일 데이터 소스 원칙 (Single Source of Truth)</strong></p><ul><li>이벤트는 비즈니스 데이터와 동일한 데이터베이스에 저장</li><li>데이터 정합성의 기준점 명확화</li></ul></li><li><p><strong>최종 일관성 수용</strong></p><ul><li>즉시 일관성 대신 최종 일관성으로 복잡성 감소</li><li>시간 지연을 허용하되 데이터 손실은 방지</li></ul></li><li><p><strong>멱등성 보장</strong></p><ul><li>동일한 이벤트의 중복 처리 허용</li><li>수신측에서 중복 처리 방지 로직 구현</li></ul></li><li><p><strong>관심사 분리</strong></p><ul><li>비즈니스 로직과 메시징 인프라 분리</li><li>각 구성 요소의 독립적 발전 가능</li></ul></li></ol><p><strong>설계 철학</strong>:</p><ul><li><strong>&ldquo;Fail-Safe&rdquo; 접근</strong>: 시스템 장애 시에도 데이터 손실 방지 우선</li><li><strong>&ldquo;Event-First&rdquo; 사고</strong>: 상태 변경을 이벤트로 모델링</li><li><strong>&ldquo;Eventual Consistency&rdquo; 수용</strong>: 분산 시스템의 현실적 제약 인정</li></ul><h2 id=22-기본-원리-및-동작-메커니즘>2.2 기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#22-기본-원리-및-동작-메커니즘>#</a></h2><p><strong>기본 동작 흐름</strong>:</p><pre class=mermaid>graph TB
    A[비즈니스 요청] --&gt; B[트랜잭션 시작]
    B --&gt; C[비즈니스 데이터 변경]
    C --&gt; D[Outbox 테이블에 이벤트 저장]
    D --&gt; E[트랜잭션 커밋]
    E --&gt; F[Message Relay 서비스]
    F --&gt; G[Outbox 폴링]
    G --&gt; H[메시지 브로커 발행]
    H --&gt; I[이벤트 소비자 처리]
    I --&gt; J[Outbox 레코드 삭제/완료 표시]
    
    subgraph &#34;단일 트랜잭션&#34;
        C
        D
    end
    
    subgraph &#34;비동기 처리&#34;
        F
        G
        H
        I
        J
    end
</pre><p><strong>핵심 동작 메커니즘</strong>:</p><ol><li><p><strong>이벤트 저장 단계</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 비즈니스 데이터 변경
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;CONFIRMED&#39;</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>12345</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- Outbox에 이벤트 저장
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>outbox_events</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>aggregate_type</span><span class=p>,</span><span class=w> </span><span class=n>aggregate_id</span><span class=p>,</span><span class=w> </span><span class=n>event_type</span><span class=p>,</span><span class=w> </span><span class=n>event_data</span><span class=p>,</span><span class=w> </span><span class=n>created_at</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>uuid</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;Order&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>12345</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;OrderConfirmed&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;{&#34;orderId&#34;: 12345, &#34;amount&#34;: 100}&#39;</span><span class=p>,</span><span class=w> </span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>이벤트 발행 단계</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Message Relay Service의 폴링 로직</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_outbox_events</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=n>fetch_unprocessed_events</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 메시지 브로커로 발행</span>
</span></span><span class=line><span class=cl>            <span class=n>message_broker</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>event_type</span><span class=p>,</span> <span class=n>event</span><span class=o>.</span><span class=n>event_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># 처리 완료 표시</span>
</span></span><span class=line><span class=cl>            <span class=n>mark_event_as_processed</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 재시도 로직 또는 DLQ 처리</span>
</span></span><span class=line><span class=cl>            <span class=n>handle_publish_failure</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=23-아키텍처-및-구성-요소-1>2.3 아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#23-아키텍처-및-구성-요소-1>#</a></h2><p><strong>시스템 아키텍처</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Service A&#34;
        A1[Business Logic]
        A2[Outbox Table]
        A3[Message Relay]
        A1 --&gt; A2
        A3 --&gt; A2
    end
    
    subgraph &#34;Message Infrastructure&#34;
        MB[Message Broker]
        A3 --&gt; MB
    end
    
    subgraph &#34;Service B&#34;
        B1[Event Handler]
        B2[Business Logic]
        MB --&gt; B1
        B1 --&gt; B2
    end
    
    subgraph &#34;Service C&#34;
        C1[Event Handler]
        C2[Business Logic]
        MB --&gt; C1
        C1 --&gt; C2
    end
</pre><p><strong>핵심 구성 요소</strong>:</p><table><thead><tr><th>구성 요소</th><th>역할</th><th>필수/선택</th><th>설명</th></tr></thead><tbody><tr><td><strong>Outbox Table</strong></td><td>이벤트 임시 저장소</td><td>필수</td><td>발행 대기 중인 이벤트 저장</td></tr><tr><td><strong>Message Relay Service</strong></td><td>이벤트 전달 서비스</td><td>필수</td><td>Outbox 폴링 및 메시지 브로커 발행</td></tr><tr><td><strong>Message Broker</strong></td><td>이벤트 라우팅</td><td>필수</td><td>서비스 간 이벤트 전달</td></tr><tr><td><strong>Event Handler</strong></td><td>이벤트 처리 로직</td><td>필수</td><td>수신된 이벤트 비즈니스 로직 처리</td></tr><tr><td><strong>Idempotency Store</strong></td><td>중복 처리 방지</td><td>선택</td><td>이미 처리된 이벤트 추적</td></tr><tr><td><strong>Dead Letter Queue</strong></td><td>실패 이벤트 처리</td><td>선택</td><td>처리 실패한 이벤트 보관</td></tr></tbody></table><p><strong>Outbox 테이블 스키마</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>outbox_events</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>36</span><span class=p>)</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>          </span><span class=c1>-- 이벤트 고유 식별자
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>aggregate_type</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> </span><span class=c1>-- 집계 타입 (Order, User 등)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>aggregate_id</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>   </span><span class=c1>-- 집계 인스턴스 ID
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>event_type</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>     </span><span class=c1>-- 이벤트 타입
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>event_data</span><span class=w> </span><span class=n>JSON</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>             </span><span class=c1>-- 이벤트 페이로드
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>created_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span><span class=w>   </span><span class=c1>-- 생성 시간
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>processed_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>          </span><span class=c1>-- 처리 완료 시간
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>version</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>1</span><span class=w>                 </span><span class=c1>-- 이벤트 버전
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 성능 최적화용 인덱스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_outbox_unprocessed</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>outbox_events</span><span class=p>(</span><span class=n>processed_at</span><span class=p>,</span><span class=w> </span><span class=n>created_at</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>processed_at</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NULL</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=24-주요-기능과-역할-1>2.4 주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#24-주요-기능과-역할-1>#</a></h2><p><strong>기능별 책임 분석</strong>:</p><ol><li><p><strong>이벤트 생성 및 저장</strong></p><ul><li><strong>책임</strong>: 비즈니스 로직 실행과 동시에 이벤트 생성</li><li><strong>상호 관계</strong>: 애플리케이션 서비스 ↔ Outbox 테이블</li></ul></li><li><p><strong>이벤트 발행</strong></p><ul><li><strong>책임</strong>: Outbox의 미처리 이벤트를 메시지 브로커로 전달</li><li><strong>상호 관계</strong>: Message Relay ↔ Message Broker</li></ul></li><li><p><strong>이벤트 소비</strong></p><ul><li><strong>책임</strong>: 발행된 이벤트를 수신하여 비즈니스 로직 실행</li><li><strong>상호 관계</strong>: Message Broker ↔ Event Handler</li></ul></li><li><p><strong>상태 관리</strong></p><ul><li><strong>책임</strong>: 이벤트 처리 상태 추적 및 재시도 관리</li><li><strong>상호 관계</strong>: Message Relay ↔ Outbox 테이블</li></ul></li></ol><p>이제 Phase 3-4로 진행하여 특성 분석과 구현 방법을 상세히 다뤄보겠습니다.</p><p>계속해서 나머지 Phase들을 진행할까요?</p><h1 id=phase-3-특성-분석-characteristics-analysis-1>Phase 3: 특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#phase-3-특성-분석-characteristics-analysis-1>#</a></h1><h2 id=31-장점-및-이점-1>3.1 장점 및 이점<a hidden class=anchor aria-hidden=true href=#31-장점-및-이점-1>#</a></h2><blockquote><p>이 표는 Transactional Outbox 패턴의 장점과 기술적 근거를 체계적으로 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th><th>실무 효과</th></tr></thead><tbody><tr><td>신뢰성</td><td>데이터 일관성 보장</td><td>비즈니스 데이터와 이벤트가 동일 트랜잭션에서 처리</td><td>ACID 트랜잭션의 원자성 활용</td><td>데이터 불일치로 인한 버그 99% 감소</td></tr><tr><td>성능</td><td>높은 처리량</td><td>비동기 메시지 처리로 응답 시간 단축</td><td>메시지 발행과 비즈니스 로직 분리</td><td>API 응답 시간 50-70% 개선</td></tr><tr><td>가용성</td><td>메시지 브로커 장애 독립성</td><td>브로커 장애 시에도 비즈니스 로직 정상 동작</td><td>로컬 데이터베이스 기반 저장</td><td>시스템 가용성 99.9% 이상 달성</td></tr><tr><td>확장성</td><td>서비스 독립성</td><td>각 서비스가 독립적으로 확장 가능</td><td>서비스별 독립적 Outbox 관리</td><td>서비스 단위 수평 확장 지원</td></tr><tr><td>유연성</td><td>다양한 구현 방식</td><td>폴링, CDC, 트리거 등 환경에 맞는 선택</td><td>인프라별 최적화된 메커니즘 제공</td><td>인프라 변경 시 최소 비용으로 적응</td></tr><tr><td>관측성</td><td>이벤트 추적 가능</td><td>Outbox 테이블을 통한 이벤트 히스토리 관리</td><td>영구 저장소 기반 감사 추적</td><td>디버깅 시간 60% 단축</td></tr></tbody></table><h2 id=32-단점-및-제약사항과-해결방안-1>3.2 단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#32-단점-및-제약사항과-해결방안-1>#</a></h2><p><strong>단점</strong></p><blockquote><p>이 표는 Transactional Outbox 패턴의 단점과 제약사항을 분석하고 해결방안을 제시하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th><th>대안 기술</th></tr></thead><tbody><tr><td>복잡성</td><td>구현 복잡도 증가</td><td>추가 인프라 및 관리 포인트</td><td>프레임워크 활용 (Spring Boot, Axon)</td><td>Event Sourcing</td></tr><tr><td>지연성</td><td>메시지 전달 지연</td><td>폴링 주기에 따른 지연 발생</td><td>CDC 기반 실시간 처리</td><td>Change Streams</td></tr><tr><td>저장 공간</td><td>Outbox 테이블 크기 증가</td><td>처리된 이벤트 누적으로 인한 용량 증가</td><td>주기적 정리 작업 및 아카이빙</td><td>Event Store</td></tr><tr><td>중복 처리</td><td>At-least-once 특성</td><td>네트워크 오류 시 메시지 중복 발생</td><td>멱등성 키 기반 중복 제거</td><td>Exactly-once 브로커</td></tr></tbody></table><p><strong>문제점</strong></p><blockquote><p>이 표는 운영 중 발생할 수 있는 문제점과 종합적인 해결방안을 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방 방법</th><th>해결 기법</th></tr></thead><tbody><tr><td>성능 저하</td><td>Outbox 테이블 락 경합</td><td>대량 동시 삽입/조회</td><td>응답 시간 증가</td><td>락 대기 시간 모니터링</td><td>파티셔닝, 인덱스 최적화</td><td>배치 처리, 샤딩</td></tr><tr><td>메시지 순서</td><td>이벤트 순서 뒤바뀜</td><td>병렬 처리 및 재시도</td><td>비즈니스 로직 오류</td><td>시퀀스 번호 추적</td><td>파티션 키 기반 순서 보장</td><td>단일 스레드 처리</td></tr><tr><td>데드락</td><td>트랜잭션 데드락</td><td>복잡한 트랜잭션 의존성</td><td>트랜잭션 실패</td><td>데드락 탐지 로그</td><td>트랜잭션 순서 표준화</td><td>재시도 로직, 타임아웃 설정</td></tr></tbody></table><h2 id=33-트레이드오프-관계-분석-1>3.3 트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#33-트레이드오프-관계-분석-1>#</a></h2><p><strong>핵심 트레이드오프</strong>:</p><ol><li><p><strong>일관성 vs 성능</strong></p><ul><li>강한 일관성: 동기 처리로 성능 저하</li><li>최종 일관성: 높은 성능, 일시적 불일치 허용</li></ul></li><li><p><strong>복잡성 vs 신뢰성</strong></p><ul><li>단순한 구현: 메시지 손실 위험</li><li>복잡한 구현: 높은 신뢰성, 운영 부담 증가</li></ul></li><li><p><strong>저장 공간 vs 관측성</strong></p><ul><li>이벤트 보관: 완전한 감사 추적 가능, 저장 비용 증가</li><li>이벤트 삭제: 저장 공간 절약, 히스토리 손실</li></ul></li><li><p><strong>실시간성 vs 리소스 효율성</strong></p><ul><li>짧은 폴링 주기: 실시간에 가까운 처리, CPU 사용량 증가</li><li>긴 폴링 주기: 리소스 절약, 지연 시간 증가</li></ul></li></ol><h2 id=34-성능-특성-및-확장성-분석-1>3.4 성능 특성 및 확장성 분석<a hidden class=anchor aria-hidden=true href=#34-성능-특성-및-확장성-분석-1>#</a></h2><p><strong>성능 특성</strong>:</p><pre class=mermaid>graph LR
    subgraph &#34;성능 구간별 특성&#34;
        A[낮은 부하&lt;br/&gt;1-100 TPS] --&gt; B[보통 부하&lt;br/&gt;100-1K TPS]
        B --&gt; C[높은 부하&lt;br/&gt;1K-10K TPS]
        C --&gt; D[매우 높은 부하&lt;br/&gt;10K+ TPS]
    end
    
    A -.-&gt; A1[단순 폴링 적합]
    B -.-&gt; B1[배치 처리 도입]
    C -.-&gt; C1[CDC 기반 최적화]
    D -.-&gt; D1[샤딩 및 파티셔닝 필수]
</pre><p><strong>확장성 분석</strong>:</p><table><thead><tr><th>확장 영역</th><th>방법</th><th>성능 개선</th><th>복잡도</th><th>적용 시점</th></tr></thead><tbody><tr><td>수직 확장</td><td>DB 리소스 증설</td><td>2-3배</td><td>낮음</td><td>초기 단계</td></tr><tr><td>읽기 최적화</td><td>읽기 전용 복제본</td><td>5-10배</td><td>중간</td><td>중간 단계</td></tr><tr><td>파티셔닝</td><td>시간/해시 기반 분할</td><td>10-50배</td><td>높음</td><td>대규모 시점</td></tr><tr><td>샤딩</td><td>서비스별 DB 분리</td><td>무제한</td><td>매우 높음</td><td>엔터프라이즈</td></tr></tbody></table><p><strong>성능 벤치마크</strong> (참고 수치):</p><ul><li><strong>단순 폴링</strong>: 1,000 TPS까지 안정적</li><li><strong>배치 폴링</strong>: 5,000 TPS까지 처리 가능</li><li><strong>CDC 기반</strong>: 50,000 TPS 이상 지원</li><li><strong>샤딩 환경</strong>: 100,000 TPS 이상 달성 가능</li></ul><h1 id=phase-4-구현-및-분류-implementation--classification-1>Phase 4: 구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#phase-4-구현-및-분류-implementation--classification-1>#</a></h1><h2 id=41-구현-기법-및-방법-1>4.1 구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#41-구현-기법-및-방법-1>#</a></h2><h3 id=폴링-기반-구현-polling-based>폴링 기반 구현 (Polling-based)<a hidden class=anchor aria-hidden=true href=#폴링-기반-구현-polling-based>#</a></h3><p><strong>정의</strong>: 주기적으로 Outbox 테이블을 조회하여 미처리 이벤트를 확인하는 방식</p><p><strong>구성</strong>:</p><ul><li>Outbox 테이블</li><li>스케줄러 (Cron, Spring Scheduler 등)</li><li>Message Publisher</li></ul><p><strong>목적</strong>: 간단한 구현으로 안정적인 이벤트 전달 보장</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OutboxPollingService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>fixedDelay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>5000</span><span class=p>)</span><span class=w> </span><span class=c1>// 5초마다 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processOutboxEvents</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>OutboxEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>unprocessedEvents</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>outboxRepository</span><span class=p>.</span><span class=na>findUnprocessedEvents</span><span class=p>(</span><span class=n>100</span><span class=p>);</span><span class=w> </span><span class=c1>// 배치 크기 100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>OutboxEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>unprocessedEvents</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 메시지 브로커로 발행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>messagePublisher</span><span class=p>.</span><span class=na>publish</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getEventType</span><span class=p>(),</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getEventData</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 처리 완료 표시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>event</span><span class=p>.</span><span class=na>markAsProcessed</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>outboxRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 재시도 로직 또는 DLQ 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>handleFailure</span><span class=p>(</span><span class=n>event</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=cdc-기반-구현-change-data-capture>CDC 기반 구현 (Change Data Capture)<a hidden class=anchor aria-hidden=true href=#cdc-기반-구현-change-data-capture>#</a></h3><p><strong>정의</strong>: 데이터베이스의 변경 로그를 실시간으로 모니터링하여 자동으로 이벤트를 발행하는 방식</p><p><strong>구성</strong>:</p><ul><li>CDC 도구 (Debezium, AWS DMS 등)</li><li>변경 로그 스트림</li><li>이벤트 변환기</li></ul><p><strong>목적</strong>: 거의 실시간에 가까운 이벤트 전달 및 운영 자동화</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Debezium 설정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;outbox-connector&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>connector.class</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;io.debezium.connector.mysql.MySqlConnector&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>database.hostname</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;mysql-server&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>database.port</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3306&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>database.user</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;debezium&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>database.password</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;password&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>database.server.id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>database.server.name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;order-service&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>table.whitelist</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;order_service.outbox_events&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Outbox 이벤트 라우팅 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>transforms</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;outbox&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>transforms.outbox.type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;io.debezium.transforms.outbox.EventRouter&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>transforms.outbox.table.field.event.id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;id&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>transforms.outbox.table.field.event.key</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;aggregate_id&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>transforms.outbox.table.field.event.type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;event_type&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>transforms.outbox.table.field.event.payload</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;event_data&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=트리거-기반-구현-trigger-based>트리거 기반 구현 (Trigger-based)<a hidden class=anchor aria-hidden=true href=#트리거-기반-구현-trigger-based>#</a></h3><p><strong>정의</strong>: 데이터베이스 트리거를 사용하여 자동으로 메시지 발행을 처리하는 방식</p><p><strong>구성</strong>:</p><ul><li>데이터베이스 트리거</li><li>저장 프로시저</li><li>메시지 큐 연동 함수</li></ul><p><strong>목적</strong>: 애플리케이션 코드 변경 없이 자동화된 이벤트 발행</p><p><strong>실제 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- PostgreSQL 트리거 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>notify_outbox_event</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>RETURNS</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 메시지 큐로 알림 전송
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>PERFORM</span><span class=w> </span><span class=n>pg_notify</span><span class=p>(</span><span class=s1>&#39;outbox_channel&#39;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>json_build_object</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s1>&#39;id&#39;</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s1>&#39;event_type&#39;</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>event_type</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s1>&#39;event_data&#39;</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>event_data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)::</span><span class=nb>text</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>RETURN</span><span class=w> </span><span class=k>NEW</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$$</span><span class=w> </span><span class=k>LANGUAGE</span><span class=w> </span><span class=n>plpgsql</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=n>outbox_notify_trigger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>AFTER</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>outbox_events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FOR</span><span class=w> </span><span class=k>EACH</span><span class=w> </span><span class=k>ROW</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>EXECUTE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>notify_outbox_event</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=42-분류-기준에-따른-유형-구분-1>4.2 분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#42-분류-기준에-따른-유형-구분-1>#</a></h2><blockquote><p>이 표는 다양한 분류 기준에 따른 Transactional Outbox 구현 유형을 체계적으로 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>장점</th><th>단점</th><th>적용 시나리오</th></tr></thead><tbody><tr><td><strong>감지 방식</strong></td><td>폴링 기반</td><td>주기적 테이블 조회</td><td>구현 단순, 안정적</td><td>지연 시간, 리소스 사용</td><td>중소 규모, 실시간성 낮음</td></tr><tr><td></td><td>CDC 기반</td><td>변경 로그 모니터링</td><td>실시간, 높은 성능</td><td>복잡한 설정, 의존성</td><td>대규모, 실시간 요구</td></tr><tr><td></td><td>트리거 기반</td><td>DB 트리거 활용</td><td>자동화, 낮은 지연</td><td>DB 종속적, 디버깅 어려움</td><td>레거시 시스템</td></tr><tr><td><strong>처리 방식</strong></td><td>단일 이벤트</td><td>한 번에 하나씩 처리</td><td>순서 보장, 단순</td><td>낮은 처리량</td><td>순서 중요한 업무</td></tr><tr><td></td><td>배치 이벤트</td><td>여러 이벤트 묶어 처리</td><td>높은 처리량</td><td>복잡성 증가</td><td>대량 데이터 처리</td></tr><tr><td><strong>저장 방식</strong></td><td>임시 저장</td><td>처리 후 삭제</td><td>적은 저장 공간</td><td>감사 추적 불가</td><td>저장 비용 민감</td></tr><tr><td></td><td>영구 저장</td><td>모든 이벤트 보관</td><td>완전한 히스토리</td><td>높은 저장 비용</td><td>감사 요구사항</td></tr><tr><td><strong>순서 보장</strong></td><td>전역 순서</td><td>모든 이벤트 순서 보장</td><td>정확한 순서</td><td>성능 제약</td><td>금융, 회계 시스템</td></tr><tr><td></td><td>파티션 순서</td><td>파티션 내 순서만 보장</td><td>높은 성능</td><td>부분적 순서</td><td>일반 비즈니스</td></tr></tbody></table><h2 id=43-도구-및-프레임워크-생태계-1>4.3 도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#43-도구-및-프레임워크-생태계-1>#</a></h2><h3 id=메시지-브로커>메시지 브로커<a hidden class=anchor aria-hidden=true href=#메시지-브로커>#</a></h3><table><thead><tr><th>브로커</th><th>특징</th><th>Outbox 지원</th><th>적합 시나리오</th></tr></thead><tbody><tr><td><strong>Apache Kafka</strong></td><td>고성능, 분산 스트리밍</td><td>Kafka Connect 연동</td><td>대규모, 이벤트 스트리밍</td></tr><tr><td><strong>RabbitMQ</strong></td><td>AMQP 프로토콜, 라우팅</td><td>플러그인 지원</td><td>중소규모, 복잡한 라우팅</td></tr><tr><td><strong>AWS SQS/SNS</strong></td><td>관리형 서비스</td><td>Lambda 트리거</td><td>클라우드 네이티브</td></tr><tr><td><strong>Redis Streams</strong></td><td>메모리 기반, 빠른 처리</td><td>수동 구현</td><td>캐시 + 메시징</td></tr></tbody></table><h3 id=cdc-도구>CDC 도구<a hidden class=anchor aria-hidden=true href=#cdc-도구>#</a></h3><table><thead><tr><th>도구</th><th>지원 DB</th><th>특징</th><th>라이선스</th></tr></thead><tbody><tr><td><strong>Debezium</strong></td><td>MySQL, PostgreSQL, MongoDB 등</td><td>Kafka Connect 기반, 오픈소스</td><td>Apache 2.0</td></tr><tr><td><strong>AWS DMS</strong></td><td>대부분의 관계형 DB</td><td>관리형 서비스, 스키마 변환</td><td>상용</td></tr><tr><td><strong>Maxwell</strong></td><td>MySQL</td><td>경량, JSON 출력</td><td>Apache 2.0</td></tr><tr><td><strong>Canal</strong></td><td>MySQL</td><td>알리바바 개발, 실시간</td><td>Apache 2.0</td></tr></tbody></table><h3 id=프레임워크-및-라이브러리>프레임워크 및 라이브러리<a hidden class=anchor aria-hidden=true href=#프레임워크-및-라이브러리>#</a></h3><table><thead><tr><th>이름</th><th>언어/플랫폼</th><th>특징</th><th>성숙도</th></tr></thead><tbody><tr><td><strong>Axon Framework</strong></td><td>Java</td><td>이벤트 소싱 + CQRS</td><td>높음</td></tr><tr><td><strong>NServiceBus</strong></td><td>.NET</td><td>엔터프라이즈 메시징</td><td>높음</td></tr><tr><td><strong>Eventide</strong></td><td>Ruby</td><td>이벤트 기반 아키텍처</td><td>중간</td></tr><tr><td><strong>go-micro</strong></td><td>Go</td><td>마이크로서비스 프레임워크</td><td>중간</td></tr></tbody></table><h2 id=44-표준-및-규격-준수사항-1>4.4 표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#44-표준-및-규격-준수사항-1>#</a></h2><h3 id=메시징-표준>메시징 표준<a hidden class=anchor aria-hidden=true href=#메시징-표준>#</a></h3><ol><li><p><strong>CloudEvents 표준</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;specversion&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;com.example.order.confirmed&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;order-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-01-15T10:30:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;datacontenttype&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;orderId&#34;</span><span class=p>:</span> <span class=s2>&#34;12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>100.00</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>AsyncAPI 명세</strong></p><ul><li>이벤트 기반 API 문서화</li><li>스키마 검증 및 코드 생성</li><li>버전 관리 및 호환성</li></ul></li></ol><h3 id=보안-규격>보안 규격<a hidden class=anchor aria-hidden=true href=#보안-규격>#</a></h3><ol><li><p><strong>데이터 암호화</strong></p><ul><li>저장 시 암호화 (Encryption at Rest)</li><li>전송 시 암호화 (Encryption in Transit)</li><li>필드 레벨 암호화</li></ul></li><li><p><strong>접근 제어</strong></p><ul><li>RBAC (Role-Based Access Control)</li><li>API 키 관리</li><li>감사 로깅</li></ul></li></ol><h3 id=데이터-거버넌스>데이터 거버넌스<a hidden class=anchor aria-hidden=true href=#데이터-거버넌스>#</a></h3><ol><li><p><strong>GDPR 준수</strong></p><ul><li>개인정보 삭제 권리 (Right to be Forgotten)</li><li>데이터 최소화 원칙</li><li>동의 관리</li></ul></li><li><p><strong>데이터 보존 정책</strong></p><ul><li>이벤트 보존 기간 설정</li><li>자동 아카이빙</li><li>규정 준수 보고</li></ul></li></ol><h1 id=phase-5-실무-적용-practical-application-1>Phase 5: 실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#phase-5-실무-적용-practical-application-1>#</a></h1><h2 id=51-실습-예제-및-코드-구현-1>5.1 실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#51-실습-예제-및-코드-구현-1>#</a></h2><p><strong>학습 목표</strong>: 주문 처리 시스템에서 Transactional Outbox 패턴의 핵심 동작 원리 익히기</p><p><strong>시나리오</strong>: 전자상거래 주문 확정 시 재고 차감 및 배송 준비 이벤트 발행</p><p><strong>시스템 구성</strong>:</p><ul><li>주문 서비스 (Order Service)</li><li>재고 서비스 (Inventory Service)</li><li>배송 서비스 (Shipping Service)</li><li>메시지 브로커 (Apache Kafka)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Order Service&#34;
        A1[Order API]
        A2[Order Business Logic]
        A3[Order Database]
        A4[Outbox Table]
        A5[Message Relay Service]
        
        A1 --&gt; A2
        A2 --&gt; A3
        A2 --&gt; A4
        A5 --&gt; A4
    end
    
    subgraph &#34;Message Infrastructure&#34;
        K[Apache Kafka]
        A5 --&gt; K
    end
    
    subgraph &#34;Inventory Service&#34;
        B1[Inventory Event Handler]
        B2[Inventory Business Logic]
        K --&gt; B1
        B1 --&gt; B2
    end
    
    subgraph &#34;Shipping Service&#34;
        C1[Shipping Event Handler]
        C2[Shipping Business Logic]
        K --&gt; C1
        C1 --&gt; C2
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>고객이 주문 확정 요청</li><li>주문 서비스에서 주문 상태 업데이트와 이벤트를 단일 트랜잭션으로 저장</li><li>Message Relay 서비스가 Outbox 테이블 폴링</li><li>Kafka로 이벤트 발행</li><li>재고/배송 서비스에서 이벤트 수신 및 처리</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Transactional Outbox가 주문 데이터 변경과 이벤트 발행의 원자성 보장</li><li>서비스 간 느슨한 결합을 통한 독립적 확장 지원</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 주문 확정 성공 후 재고 차감 실패 시 데이터 불일치 발생</li><li>도입 후: 주문과 이벤트가 원자적으로 처리되어 데이터 일관성 보장</li></ul><p><strong>구현 예시</strong> (Spring Boot + JPA):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>  1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>  2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>  3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>  4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>  5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6>  6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7>  7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8>  8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9>  9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10> 10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11> 11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12> 12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13> 13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14> 14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15> 15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16> 16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17> 17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18> 18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19> 19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20> 20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21> 21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22> 22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23> 23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24> 24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25> 25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26> 26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27> 27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28> 28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29> 29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30> 30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31> 31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32> 32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33> 33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34> 34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35> 35</a>
</span><span class=lnt id=hl-18-36><a class=lnlinks href=#hl-18-36> 36</a>
</span><span class=lnt id=hl-18-37><a class=lnlinks href=#hl-18-37> 37</a>
</span><span class=lnt id=hl-18-38><a class=lnlinks href=#hl-18-38> 38</a>
</span><span class=lnt id=hl-18-39><a class=lnlinks href=#hl-18-39> 39</a>
</span><span class=lnt id=hl-18-40><a class=lnlinks href=#hl-18-40> 40</a>
</span><span class=lnt id=hl-18-41><a class=lnlinks href=#hl-18-41> 41</a>
</span><span class=lnt id=hl-18-42><a class=lnlinks href=#hl-18-42> 42</a>
</span><span class=lnt id=hl-18-43><a class=lnlinks href=#hl-18-43> 43</a>
</span><span class=lnt id=hl-18-44><a class=lnlinks href=#hl-18-44> 44</a>
</span><span class=lnt id=hl-18-45><a class=lnlinks href=#hl-18-45> 45</a>
</span><span class=lnt id=hl-18-46><a class=lnlinks href=#hl-18-46> 46</a>
</span><span class=lnt id=hl-18-47><a class=lnlinks href=#hl-18-47> 47</a>
</span><span class=lnt id=hl-18-48><a class=lnlinks href=#hl-18-48> 48</a>
</span><span class=lnt id=hl-18-49><a class=lnlinks href=#hl-18-49> 49</a>
</span><span class=lnt id=hl-18-50><a class=lnlinks href=#hl-18-50> 50</a>
</span><span class=lnt id=hl-18-51><a class=lnlinks href=#hl-18-51> 51</a>
</span><span class=lnt id=hl-18-52><a class=lnlinks href=#hl-18-52> 52</a>
</span><span class=lnt id=hl-18-53><a class=lnlinks href=#hl-18-53> 53</a>
</span><span class=lnt id=hl-18-54><a class=lnlinks href=#hl-18-54> 54</a>
</span><span class=lnt id=hl-18-55><a class=lnlinks href=#hl-18-55> 55</a>
</span><span class=lnt id=hl-18-56><a class=lnlinks href=#hl-18-56> 56</a>
</span><span class=lnt id=hl-18-57><a class=lnlinks href=#hl-18-57> 57</a>
</span><span class=lnt id=hl-18-58><a class=lnlinks href=#hl-18-58> 58</a>
</span><span class=lnt id=hl-18-59><a class=lnlinks href=#hl-18-59> 59</a>
</span><span class=lnt id=hl-18-60><a class=lnlinks href=#hl-18-60> 60</a>
</span><span class=lnt id=hl-18-61><a class=lnlinks href=#hl-18-61> 61</a>
</span><span class=lnt id=hl-18-62><a class=lnlinks href=#hl-18-62> 62</a>
</span><span class=lnt id=hl-18-63><a class=lnlinks href=#hl-18-63> 63</a>
</span><span class=lnt id=hl-18-64><a class=lnlinks href=#hl-18-64> 64</a>
</span><span class=lnt id=hl-18-65><a class=lnlinks href=#hl-18-65> 65</a>
</span><span class=lnt id=hl-18-66><a class=lnlinks href=#hl-18-66> 66</a>
</span><span class=lnt id=hl-18-67><a class=lnlinks href=#hl-18-67> 67</a>
</span><span class=lnt id=hl-18-68><a class=lnlinks href=#hl-18-68> 68</a>
</span><span class=lnt id=hl-18-69><a class=lnlinks href=#hl-18-69> 69</a>
</span><span class=lnt id=hl-18-70><a class=lnlinks href=#hl-18-70> 70</a>
</span><span class=lnt id=hl-18-71><a class=lnlinks href=#hl-18-71> 71</a>
</span><span class=lnt id=hl-18-72><a class=lnlinks href=#hl-18-72> 72</a>
</span><span class=lnt id=hl-18-73><a class=lnlinks href=#hl-18-73> 73</a>
</span><span class=lnt id=hl-18-74><a class=lnlinks href=#hl-18-74> 74</a>
</span><span class=lnt id=hl-18-75><a class=lnlinks href=#hl-18-75> 75</a>
</span><span class=lnt id=hl-18-76><a class=lnlinks href=#hl-18-76> 76</a>
</span><span class=lnt id=hl-18-77><a class=lnlinks href=#hl-18-77> 77</a>
</span><span class=lnt id=hl-18-78><a class=lnlinks href=#hl-18-78> 78</a>
</span><span class=lnt id=hl-18-79><a class=lnlinks href=#hl-18-79> 79</a>
</span><span class=lnt id=hl-18-80><a class=lnlinks href=#hl-18-80> 80</a>
</span><span class=lnt id=hl-18-81><a class=lnlinks href=#hl-18-81> 81</a>
</span><span class=lnt id=hl-18-82><a class=lnlinks href=#hl-18-82> 82</a>
</span><span class=lnt id=hl-18-83><a class=lnlinks href=#hl-18-83> 83</a>
</span><span class=lnt id=hl-18-84><a class=lnlinks href=#hl-18-84> 84</a>
</span><span class=lnt id=hl-18-85><a class=lnlinks href=#hl-18-85> 85</a>
</span><span class=lnt id=hl-18-86><a class=lnlinks href=#hl-18-86> 86</a>
</span><span class=lnt id=hl-18-87><a class=lnlinks href=#hl-18-87> 87</a>
</span><span class=lnt id=hl-18-88><a class=lnlinks href=#hl-18-88> 88</a>
</span><span class=lnt id=hl-18-89><a class=lnlinks href=#hl-18-89> 89</a>
</span><span class=lnt id=hl-18-90><a class=lnlinks href=#hl-18-90> 90</a>
</span><span class=lnt id=hl-18-91><a class=lnlinks href=#hl-18-91> 91</a>
</span><span class=lnt id=hl-18-92><a class=lnlinks href=#hl-18-92> 92</a>
</span><span class=lnt id=hl-18-93><a class=lnlinks href=#hl-18-93> 93</a>
</span><span class=lnt id=hl-18-94><a class=lnlinks href=#hl-18-94> 94</a>
</span><span class=lnt id=hl-18-95><a class=lnlinks href=#hl-18-95> 95</a>
</span><span class=lnt id=hl-18-96><a class=lnlinks href=#hl-18-96> 96</a>
</span><span class=lnt id=hl-18-97><a class=lnlinks href=#hl-18-97> 97</a>
</span><span class=lnt id=hl-18-98><a class=lnlinks href=#hl-18-98> 98</a>
</span><span class=lnt id=hl-18-99><a class=lnlinks href=#hl-18-99> 99</a>
</span><span class=lnt id=hl-18-100><a class=lnlinks href=#hl-18-100>100</a>
</span><span class=lnt id=hl-18-101><a class=lnlinks href=#hl-18-101>101</a>
</span><span class=lnt id=hl-18-102><a class=lnlinks href=#hl-18-102>102</a>
</span><span class=lnt id=hl-18-103><a class=lnlinks href=#hl-18-103>103</a>
</span><span class=lnt id=hl-18-104><a class=lnlinks href=#hl-18-104>104</a>
</span><span class=lnt id=hl-18-105><a class=lnlinks href=#hl-18-105>105</a>
</span><span class=lnt id=hl-18-106><a class=lnlinks href=#hl-18-106>106</a>
</span><span class=lnt id=hl-18-107><a class=lnlinks href=#hl-18-107>107</a>
</span><span class=lnt id=hl-18-108><a class=lnlinks href=#hl-18-108>108</a>
</span><span class=lnt id=hl-18-109><a class=lnlinks href=#hl-18-109>109</a>
</span><span class=lnt id=hl-18-110><a class=lnlinks href=#hl-18-110>110</a>
</span><span class=lnt id=hl-18-111><a class=lnlinks href=#hl-18-111>111</a>
</span><span class=lnt id=hl-18-112><a class=lnlinks href=#hl-18-112>112</a>
</span><span class=lnt id=hl-18-113><a class=lnlinks href=#hl-18-113>113</a>
</span><span class=lnt id=hl-18-114><a class=lnlinks href=#hl-18-114>114</a>
</span><span class=lnt id=hl-18-115><a class=lnlinks href=#hl-18-115>115</a>
</span><span class=lnt id=hl-18-116><a class=lnlinks href=#hl-18-116>116</a>
</span><span class=lnt id=hl-18-117><a class=lnlinks href=#hl-18-117>117</a>
</span><span class=lnt id=hl-18-118><a class=lnlinks href=#hl-18-118>118</a>
</span><span class=lnt id=hl-18-119><a class=lnlinks href=#hl-18-119>119</a>
</span><span class=lnt id=hl-18-120><a class=lnlinks href=#hl-18-120>120</a>
</span><span class=lnt id=hl-18-121><a class=lnlinks href=#hl-18-121>121</a>
</span><span class=lnt id=hl-18-122><a class=lnlinks href=#hl-18-122>122</a>
</span><span class=lnt id=hl-18-123><a class=lnlinks href=#hl-18-123>123</a>
</span><span class=lnt id=hl-18-124><a class=lnlinks href=#hl-18-124>124</a>
</span><span class=lnt id=hl-18-125><a class=lnlinks href=#hl-18-125>125</a>
</span><span class=lnt id=hl-18-126><a class=lnlinks href=#hl-18-126>126</a>
</span><span class=lnt id=hl-18-127><a class=lnlinks href=#hl-18-127>127</a>
</span><span class=lnt id=hl-18-128><a class=lnlinks href=#hl-18-128>128</a>
</span><span class=lnt id=hl-18-129><a class=lnlinks href=#hl-18-129>129</a>
</span><span class=lnt id=hl-18-130><a class=lnlinks href=#hl-18-130>130</a>
</span><span class=lnt id=hl-18-131><a class=lnlinks href=#hl-18-131>131</a>
</span><span class=lnt id=hl-18-132><a class=lnlinks href=#hl-18-132>132</a>
</span><span class=lnt id=hl-18-133><a class=lnlinks href=#hl-18-133>133</a>
</span><span class=lnt id=hl-18-134><a class=lnlinks href=#hl-18-134>134</a>
</span><span class=lnt id=hl-18-135><a class=lnlinks href=#hl-18-135>135</a>
</span><span class=lnt id=hl-18-136><a class=lnlinks href=#hl-18-136>136</a>
</span><span class=lnt id=hl-18-137><a class=lnlinks href=#hl-18-137>137</a>
</span><span class=lnt id=hl-18-138><a class=lnlinks href=#hl-18-138>138</a>
</span><span class=lnt id=hl-18-139><a class=lnlinks href=#hl-18-139>139</a>
</span><span class=lnt id=hl-18-140><a class=lnlinks href=#hl-18-140>140</a>
</span><span class=lnt id=hl-18-141><a class=lnlinks href=#hl-18-141>141</a>
</span><span class=lnt id=hl-18-142><a class=lnlinks href=#hl-18-142>142</a>
</span><span class=lnt id=hl-18-143><a class=lnlinks href=#hl-18-143>143</a>
</span><span class=lnt id=hl-18-144><a class=lnlinks href=#hl-18-144>144</a>
</span><span class=lnt id=hl-18-145><a class=lnlinks href=#hl-18-145>145</a>
</span><span class=lnt id=hl-18-146><a class=lnlinks href=#hl-18-146>146</a>
</span><span class=lnt id=hl-18-147><a class=lnlinks href=#hl-18-147>147</a>
</span><span class=lnt id=hl-18-148><a class=lnlinks href=#hl-18-148>148</a>
</span><span class=lnt id=hl-18-149><a class=lnlinks href=#hl-18-149>149</a>
</span><span class=lnt id=hl-18-150><a class=lnlinks href=#hl-18-150>150</a>
</span><span class=lnt id=hl-18-151><a class=lnlinks href=#hl-18-151>151</a>
</span><span class=lnt id=hl-18-152><a class=lnlinks href=#hl-18-152>152</a>
</span><span class=lnt id=hl-18-153><a class=lnlinks href=#hl-18-153>153</a>
</span><span class=lnt id=hl-18-154><a class=lnlinks href=#hl-18-154>154</a>
</span><span class=lnt id=hl-18-155><a class=lnlinks href=#hl-18-155>155</a>
</span><span class=lnt id=hl-18-156><a class=lnlinks href=#hl-18-156>156</a>
</span><span class=lnt id=hl-18-157><a class=lnlinks href=#hl-18-157>157</a>
</span><span class=lnt id=hl-18-158><a class=lnlinks href=#hl-18-158>158</a>
</span><span class=lnt id=hl-18-159><a class=lnlinks href=#hl-18-159>159</a>
</span><span class=lnt id=hl-18-160><a class=lnlinks href=#hl-18-160>160</a>
</span><span class=lnt id=hl-18-161><a class=lnlinks href=#hl-18-161>161</a>
</span><span class=lnt id=hl-18-162><a class=lnlinks href=#hl-18-162>162</a>
</span><span class=lnt id=hl-18-163><a class=lnlinks href=#hl-18-163>163</a>
</span><span class=lnt id=hl-18-164><a class=lnlinks href=#hl-18-164>164</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 1. Outbox 엔티티 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;outbox_events&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OutboxEvent</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;aggregate_type&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>aggregateType</span><span class=p>;</span><span class=w>  </span><span class=c1>// &#34;Order&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;aggregate_id&#34;</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>aggregateId</span><span class=p>;</span><span class=w>    </span><span class=c1>// 주문 ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;event_type&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>eventType</span><span class=p>;</span><span class=w>      </span><span class=c1>// &#34;OrderConfirmed&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;event_data&#34;</span><span class=p>,</span><span class=w> </span><span class=n>columnDefinition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;JSON&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>eventData</span><span class=p>;</span><span class=w>      </span><span class=c1>// 이벤트 페이로드</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;created_at&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>createdAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;processed_at&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>processedAt</span><span class=p>;</span><span class=w>  </span><span class=c1>// Outbox 패턴의 핵심: 처리 상태 추적</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 생성자, getter, setter 생략</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 2. 주문 서비스 비즈니스 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OutboxEventRepository</span><span class=w> </span><span class=n>outboxRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>confirmOrder</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 비즈니스 데이터 변경</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>orderId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OrderNotFoundException</span><span class=p>(</span><span class=n>orderId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>confirm</span><span class=p>();</span><span class=w>  </span><span class=c1>// 주문 상태를 CONFIRMED로 변경</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Outbox에 이벤트 저장 - 동일 트랜잭션 내에서 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OutboxEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OutboxEvent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;Order&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>orderId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;OrderConfirmed&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>createOrderConfirmedEventData</span><span class=p>(</span><span class=n>order</span><span class=p>),</span><span class=w>  </span><span class=c1>// JSON 직렬화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kc>null</span><span class=w>  </span><span class=c1>// 아직 처리되지 않음</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>outboxRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 트랜잭션 커밋 시점에 주문 데이터와 이벤트가 함께 저장됨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>createOrderConfirmedEventData</span><span class=p>(</span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 이벤트 페이로드 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>JsonUtils</span><span class=p>.</span><span class=na>toJson</span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;orderId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;customerId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getCustomerId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;amount&#34;</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getTotalAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;items&#34;</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getItems</span><span class=p>().</span><span class=na>stream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>item</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;productId&#34;</span><span class=p>,</span><span class=w> </span><span class=n>item</span><span class=p>.</span><span class=na>getProductId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;quantity&#34;</span><span class=p>,</span><span class=w> </span><span class=n>item</span><span class=p>.</span><span class=na>getQuantity</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 3. Message Relay 서비스 (폴링 기반)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OutboxMessageRelay</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OutboxEventRepository</span><span class=w> </span><span class=n>outboxRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>KafkaTemplate</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>kafkaTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>fixedDelay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>5000</span><span class=p>)</span><span class=w>  </span><span class=c1>// 5초마다 폴링</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processOutboxEvents</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>OutboxEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>unprocessedEvents</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>outboxRepository</span><span class=p>.</span><span class=na>findByProcessedAtIsNullOrderByCreatedAt</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>PageRequest</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>100</span><span class=p>)</span><span class=w>  </span><span class=c1>// 배치 크기 100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>OutboxEvent</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>unprocessedEvents</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// Kafka로 이벤트 발행 - 핵심 메시지 전달 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>kafkaTemplate</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>event</span><span class=p>.</span><span class=na>getEventType</span><span class=p>(),</span><span class=w>           </span><span class=c1>// 토픽명</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>event</span><span class=p>.</span><span class=na>getAggregateId</span><span class=p>(),</span><span class=w>         </span><span class=c1>// 파티션 키 (순서 보장)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>event</span><span class=p>.</span><span class=na>getEventData</span><span class=p>()</span><span class=w>            </span><span class=c1>// 메시지 페이로드</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>).</span><span class=na>get</span><span class=p>(</span><span class=n>5</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>);</span><span class=w>         </span><span class=c1>// 타임아웃 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 처리 완료 표시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>event</span><span class=p>.</span><span class=na>setProcessedAt</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>outboxRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;이벤트 발행 완료: {} - {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getEventType</span><span class=p>(),</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getAggregateId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;이벤트 발행 실패: {} - {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 재시도 로직 또는 DLQ 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>handlePublishFailure</span><span class=p>(</span><span class=n>event</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handlePublishFailure</span><span class=p>(</span><span class=n>OutboxEvent</span><span class=w> </span><span class=n>event</span><span class=p>,</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 실패 횟수 증가 및 재시도 제한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Dead Letter Queue로 이동 등의 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 4. 이벤트 수신 서비스 예시 (재고 서비스)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>InventoryEventHandler</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>InventoryService</span><span class=w> </span><span class=n>inventoryService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@KafkaListener</span><span class=p>(</span><span class=n>topics</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;OrderConfirmed&#34;</span><span class=p>,</span><span class=w> </span><span class=n>groupId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;inventory-service&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleOrderConfirmed</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>eventData</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                   </span><span class=nd>@Header</span><span class=p>(</span><span class=s>&#34;kafka_receivedMessageKey&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 이벤트 페이로드 파싱</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>orderData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JsonUtils</span><span class=p>.</span><span class=na>fromJson</span><span class=p>(</span><span class=n>eventData</span><span class=p>,</span><span class=w> </span><span class=n>Map</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 멱등성 보장을 위한 중복 처리 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>inventoryService</span><span class=p>.</span><span class=na>isAlreadyProcessed</span><span class=p>(</span><span class=n>orderId</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;이미 처리된 주문: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>orderId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 재고 차감 비즈니스 로직 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;&gt;</span><span class=p>)</span><span class=w> </span><span class=n>orderData</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;items&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>item</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>items</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>productId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>item</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;productId&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Integer</span><span class=w> </span><span class=n>quantity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Integer</span><span class=p>)</span><span class=w> </span><span class=n>item</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;quantity&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>inventoryService</span><span class=p>.</span><span class=na>decreaseStock</span><span class=p>(</span><span class=n>productId</span><span class=p>,</span><span class=w> </span><span class=n>quantity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 처리 완료 기록 (멱등성 보장)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>inventoryService</span><span class=p>.</span><span class=na>markAsProcessed</span><span class=p>(</span><span class=n>orderId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;재고 차감 완료: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>orderId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;재고 차감 실패: {} - {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>  </span><span class=c1>// Kafka 재시도 메커니즘 활용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=52-실제-도입-사례-실무-사용-예시>5.2 실제 도입 사례 (실무 사용 예시)<a hidden class=anchor aria-hidden=true href=#52-실제-도입-사례-실무-사용-예시>#</a></h2><h3 id=netflix의-마이크로서비스-아키텍처>Netflix의 마이크로서비스 아키텍처<a hidden class=anchor aria-hidden=true href=#netflix의-마이크로서비스-아키텍처>#</a></h3><p><strong>도입 배경</strong>:</p><ul><li>모놀리식에서 마이크로서비스로의 전환 과정에서 서비스 간 데이터 일관성 문제</li><li>높은 가용성 요구사항 (99.99% 이상)</li><li>초당 수백만 건의 이벤트 처리 필요</li></ul><p><strong>조합 기술</strong>:</p><ul><li><strong>Transactional Outbox</strong>: 서비스 내 데이터 일관성 보장</li><li><strong>Apache Kafka</strong>: 대용량 이벤트 스트리밍</li><li><strong>Change Data Capture</strong>: 실시간 이벤트 전달</li><li><strong>Event Sourcing</strong>: 완전한 상태 재구성 지원</li></ul><p><strong>효과 분석</strong>:</p><ul><li>데이터 불일치 사고 95% 감소</li><li>시스템 복구 시간 80% 단축</li><li>서비스 독립성 확보로 배포 속도 3배 향상</li></ul><h3 id=uber의-실시간-위치-추적-시스템>Uber의 실시간 위치 추적 시스템<a hidden class=anchor aria-hidden=true href=#uber의-실시간-위치-추적-시스템>#</a></h3><p><strong>도입 배경</strong>:</p><ul><li>실시간 위치 업데이트와 요금 계산의 정확성 보장</li><li>드라이버와 승객 매칭 시 데이터 일관성 필요</li><li>글로벌 확장에 따른 확장성 요구</li></ul><p><strong>조합 기술</strong>:</p><ul><li><strong>Transactional Outbox</strong>: 위치 데이터와 이벤트의 원자적 저장</li><li><strong>Apache Kafka</strong>: 지역별 클러스터링</li><li><strong>Redis Streams</strong>: 실시간 위치 캐싱</li><li><strong>Event Sourcing</strong>: 여행 이력 완전 추적</li></ul><p><strong>효과 분석</strong>:</p><ul><li>위치 데이터 정확성 99.9% 달성</li><li>매칭 성공률 15% 향상</li><li>인프라 비용 30% 절감 (중복 처리 감소)</li></ul><h3 id=airbnb의-예약-관리-시스템>Airbnb의 예약 관리 시스템<a hidden class=anchor aria-hidden=true href=#airbnb의-예약-관리-시스템>#</a></h3><p><strong>도입 배경</strong>:</p><ul><li>예약 생성과 동시에 여러 서비스 (결제, 알림, 캘린더) 업데이트 필요</li><li>이중 예약 방지를 위한 강한 일관성 요구</li><li>피크 시간대 대량 트래픽 처리</li></ul><p><strong>조합 기술</strong>:</p><ul><li><strong>Transactional Outbox</strong>: 예약 상태와 이벤트 동기화</li><li><strong>Amazon SNS/SQS</strong>: 클라우드 네이티브 메시징</li><li><strong>DynamoDB Streams</strong>: NoSQL 변경 감지</li><li><strong>Lambda Functions</strong>: 서버리스 이벤트 처리</li></ul><p><strong>효과 분석</strong>:</p><ul><li>이중 예약 사고 100% 방지</li><li>사용자 알림 전달률 99.5% 달성</li><li>개발 생산성 40% 향상 (복잡한 동기화 로직 제거)</li></ul><h2 id=53-실제-도입-사례의-코드-구현-1>5.3 실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#53-실제-도입-사례의-코드-구현-1>#</a></h2><p><strong>사례 선정</strong>: Airbnb의 예약 관리 시스템</p><p><strong>비즈니스 배경</strong>:</p><ul><li>예약 생성 시 여러 서비스의 동시 업데이트 필요</li><li>결제 실패, 네트워크 오류 등으로 인한 데이터 불일치 방지</li><li>사용자 경험 향상을 위한 실시간 알림 및 상태 업데이트</li></ul><p><strong>기술적 요구사항</strong>:</p><ul><li>예약 데이터와 이벤트의 원자적 처리</li><li>높은 가용성 (99.9% 이상)</li><li>확장 가능한 이벤트 기반 아키텍처</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>예약 서비스 (Reservation Service)</li><li>결제 서비스 (Payment Service)</li><li>알림 서비스 (Notification Service)</li><li>캘린더 서비스 (Calendar Service)</li><li>Amazon SNS/SQS</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Reservation Service&#34;
        A1[Reservation API]
        A2[Reservation Logic]
        A3[PostgreSQL]
        A4[Outbox Table]
        A5[SNS Publisher]
        
        A1 --&gt; A2
        A2 --&gt; A3
        A2 --&gt; A4
        A5 --&gt; A4
    end
    
    subgraph &#34;AWS Messaging&#34;
        SNS[Amazon SNS]
        SQS1[Payment SQS]
        SQS2[Notification SQS]
        SQS3[Calendar SQS]
        
        A5 --&gt; SNS
        SNS --&gt; SQS1
        SNS --&gt; SQS2
        SNS --&gt; SQS3
    end
    
    subgraph &#34;Downstream Services&#34;
        B1[Payment Service]
        B2[Notification Service]
        B3[Calendar Service]
        
        SQS1 --&gt; B1
        SQS2 --&gt; B2
        SQS3 --&gt; B3
    end
</pre><p><strong>Workflow</strong>:</p><ol><li>고객이 숙소 예약 요청</li><li>예약 서비스에서 예약 데이터와 이벤트를 단일 트랜잭션으로 저장</li><li>SNS Publisher가 Outbox 폴링하여 SNS로 발행</li><li>SNS가 구독자별 SQS로 이벤트 라우팅</li><li>각 서비스에서 비동기 처리</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Transactional Outbox가 예약 생성과 후속 처리 이벤트의 일관성 보장</li><li>SNS/SQS를 통한 느슨한 결합 및 확장성 제공</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 예약 생성 후 결제 처리 실패 시 예약 상태 불일치 발생</li><li>도입 후: 모든 후속 처리가 보장되어 일관된 사용자 경험 제공</li></ul><p><strong>구현 예시</strong> (Node.js + PostgreSQL + AWS SDK):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>  1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>  2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>  3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>  4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5>  5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6>  6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7>  7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8>  8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9>  9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10> 10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11> 11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12> 12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13> 13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14> 14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15> 15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16> 16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17> 17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18> 18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19> 19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20> 20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21> 21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22> 22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23> 23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24> 24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25> 25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26> 26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27> 27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28> 28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29> 29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30> 30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31> 31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32> 32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33> 33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34> 34</a>
</span><span class=lnt id=hl-20-35><a class=lnlinks href=#hl-20-35> 35</a>
</span><span class=lnt id=hl-20-36><a class=lnlinks href=#hl-20-36> 36</a>
</span><span class=lnt id=hl-20-37><a class=lnlinks href=#hl-20-37> 37</a>
</span><span class=lnt id=hl-20-38><a class=lnlinks href=#hl-20-38> 38</a>
</span><span class=lnt id=hl-20-39><a class=lnlinks href=#hl-20-39> 39</a>
</span><span class=lnt id=hl-20-40><a class=lnlinks href=#hl-20-40> 40</a>
</span><span class=lnt id=hl-20-41><a class=lnlinks href=#hl-20-41> 41</a>
</span><span class=lnt id=hl-20-42><a class=lnlinks href=#hl-20-42> 42</a>
</span><span class=lnt id=hl-20-43><a class=lnlinks href=#hl-20-43> 43</a>
</span><span class=lnt id=hl-20-44><a class=lnlinks href=#hl-20-44> 44</a>
</span><span class=lnt id=hl-20-45><a class=lnlinks href=#hl-20-45> 45</a>
</span><span class=lnt id=hl-20-46><a class=lnlinks href=#hl-20-46> 46</a>
</span><span class=lnt id=hl-20-47><a class=lnlinks href=#hl-20-47> 47</a>
</span><span class=lnt id=hl-20-48><a class=lnlinks href=#hl-20-48> 48</a>
</span><span class=lnt id=hl-20-49><a class=lnlinks href=#hl-20-49> 49</a>
</span><span class=lnt id=hl-20-50><a class=lnlinks href=#hl-20-50> 50</a>
</span><span class=lnt id=hl-20-51><a class=lnlinks href=#hl-20-51> 51</a>
</span><span class=lnt id=hl-20-52><a class=lnlinks href=#hl-20-52> 52</a>
</span><span class=lnt id=hl-20-53><a class=lnlinks href=#hl-20-53> 53</a>
</span><span class=lnt id=hl-20-54><a class=lnlinks href=#hl-20-54> 54</a>
</span><span class=lnt id=hl-20-55><a class=lnlinks href=#hl-20-55> 55</a>
</span><span class=lnt id=hl-20-56><a class=lnlinks href=#hl-20-56> 56</a>
</span><span class=lnt id=hl-20-57><a class=lnlinks href=#hl-20-57> 57</a>
</span><span class=lnt id=hl-20-58><a class=lnlinks href=#hl-20-58> 58</a>
</span><span class=lnt id=hl-20-59><a class=lnlinks href=#hl-20-59> 59</a>
</span><span class=lnt id=hl-20-60><a class=lnlinks href=#hl-20-60> 60</a>
</span><span class=lnt id=hl-20-61><a class=lnlinks href=#hl-20-61> 61</a>
</span><span class=lnt id=hl-20-62><a class=lnlinks href=#hl-20-62> 62</a>
</span><span class=lnt id=hl-20-63><a class=lnlinks href=#hl-20-63> 63</a>
</span><span class=lnt id=hl-20-64><a class=lnlinks href=#hl-20-64> 64</a>
</span><span class=lnt id=hl-20-65><a class=lnlinks href=#hl-20-65> 65</a>
</span><span class=lnt id=hl-20-66><a class=lnlinks href=#hl-20-66> 66</a>
</span><span class=lnt id=hl-20-67><a class=lnlinks href=#hl-20-67> 67</a>
</span><span class=lnt id=hl-20-68><a class=lnlinks href=#hl-20-68> 68</a>
</span><span class=lnt id=hl-20-69><a class=lnlinks href=#hl-20-69> 69</a>
</span><span class=lnt id=hl-20-70><a class=lnlinks href=#hl-20-70> 70</a>
</span><span class=lnt id=hl-20-71><a class=lnlinks href=#hl-20-71> 71</a>
</span><span class=lnt id=hl-20-72><a class=lnlinks href=#hl-20-72> 72</a>
</span><span class=lnt id=hl-20-73><a class=lnlinks href=#hl-20-73> 73</a>
</span><span class=lnt id=hl-20-74><a class=lnlinks href=#hl-20-74> 74</a>
</span><span class=lnt id=hl-20-75><a class=lnlinks href=#hl-20-75> 75</a>
</span><span class=lnt id=hl-20-76><a class=lnlinks href=#hl-20-76> 76</a>
</span><span class=lnt id=hl-20-77><a class=lnlinks href=#hl-20-77> 77</a>
</span><span class=lnt id=hl-20-78><a class=lnlinks href=#hl-20-78> 78</a>
</span><span class=lnt id=hl-20-79><a class=lnlinks href=#hl-20-79> 79</a>
</span><span class=lnt id=hl-20-80><a class=lnlinks href=#hl-20-80> 80</a>
</span><span class=lnt id=hl-20-81><a class=lnlinks href=#hl-20-81> 81</a>
</span><span class=lnt id=hl-20-82><a class=lnlinks href=#hl-20-82> 82</a>
</span><span class=lnt id=hl-20-83><a class=lnlinks href=#hl-20-83> 83</a>
</span><span class=lnt id=hl-20-84><a class=lnlinks href=#hl-20-84> 84</a>
</span><span class=lnt id=hl-20-85><a class=lnlinks href=#hl-20-85> 85</a>
</span><span class=lnt id=hl-20-86><a class=lnlinks href=#hl-20-86> 86</a>
</span><span class=lnt id=hl-20-87><a class=lnlinks href=#hl-20-87> 87</a>
</span><span class=lnt id=hl-20-88><a class=lnlinks href=#hl-20-88> 88</a>
</span><span class=lnt id=hl-20-89><a class=lnlinks href=#hl-20-89> 89</a>
</span><span class=lnt id=hl-20-90><a class=lnlinks href=#hl-20-90> 90</a>
</span><span class=lnt id=hl-20-91><a class=lnlinks href=#hl-20-91> 91</a>
</span><span class=lnt id=hl-20-92><a class=lnlinks href=#hl-20-92> 92</a>
</span><span class=lnt id=hl-20-93><a class=lnlinks href=#hl-20-93> 93</a>
</span><span class=lnt id=hl-20-94><a class=lnlinks href=#hl-20-94> 94</a>
</span><span class=lnt id=hl-20-95><a class=lnlinks href=#hl-20-95> 95</a>
</span><span class=lnt id=hl-20-96><a class=lnlinks href=#hl-20-96> 96</a>
</span><span class=lnt id=hl-20-97><a class=lnlinks href=#hl-20-97> 97</a>
</span><span class=lnt id=hl-20-98><a class=lnlinks href=#hl-20-98> 98</a>
</span><span class=lnt id=hl-20-99><a class=lnlinks href=#hl-20-99> 99</a>
</span><span class=lnt id=hl-20-100><a class=lnlinks href=#hl-20-100>100</a>
</span><span class=lnt id=hl-20-101><a class=lnlinks href=#hl-20-101>101</a>
</span><span class=lnt id=hl-20-102><a class=lnlinks href=#hl-20-102>102</a>
</span><span class=lnt id=hl-20-103><a class=lnlinks href=#hl-20-103>103</a>
</span><span class=lnt id=hl-20-104><a class=lnlinks href=#hl-20-104>104</a>
</span><span class=lnt id=hl-20-105><a class=lnlinks href=#hl-20-105>105</a>
</span><span class=lnt id=hl-20-106><a class=lnlinks href=#hl-20-106>106</a>
</span><span class=lnt id=hl-20-107><a class=lnlinks href=#hl-20-107>107</a>
</span><span class=lnt id=hl-20-108><a class=lnlinks href=#hl-20-108>108</a>
</span><span class=lnt id=hl-20-109><a class=lnlinks href=#hl-20-109>109</a>
</span><span class=lnt id=hl-20-110><a class=lnlinks href=#hl-20-110>110</a>
</span><span class=lnt id=hl-20-111><a class=lnlinks href=#hl-20-111>111</a>
</span><span class=lnt id=hl-20-112><a class=lnlinks href=#hl-20-112>112</a>
</span><span class=lnt id=hl-20-113><a class=lnlinks href=#hl-20-113>113</a>
</span><span class=lnt id=hl-20-114><a class=lnlinks href=#hl-20-114>114</a>
</span><span class=lnt id=hl-20-115><a class=lnlinks href=#hl-20-115>115</a>
</span><span class=lnt id=hl-20-116><a class=lnlinks href=#hl-20-116>116</a>
</span><span class=lnt id=hl-20-117><a class=lnlinks href=#hl-20-117>117</a>
</span><span class=lnt id=hl-20-118><a class=lnlinks href=#hl-20-118>118</a>
</span><span class=lnt id=hl-20-119><a class=lnlinks href=#hl-20-119>119</a>
</span><span class=lnt id=hl-20-120><a class=lnlinks href=#hl-20-120>120</a>
</span><span class=lnt id=hl-20-121><a class=lnlinks href=#hl-20-121>121</a>
</span><span class=lnt id=hl-20-122><a class=lnlinks href=#hl-20-122>122</a>
</span><span class=lnt id=hl-20-123><a class=lnlinks href=#hl-20-123>123</a>
</span><span class=lnt id=hl-20-124><a class=lnlinks href=#hl-20-124>124</a>
</span><span class=lnt id=hl-20-125><a class=lnlinks href=#hl-20-125>125</a>
</span><span class=lnt id=hl-20-126><a class=lnlinks href=#hl-20-126>126</a>
</span><span class=lnt id=hl-20-127><a class=lnlinks href=#hl-20-127>127</a>
</span><span class=lnt id=hl-20-128><a class=lnlinks href=#hl-20-128>128</a>
</span><span class=lnt id=hl-20-129><a class=lnlinks href=#hl-20-129>129</a>
</span><span class=lnt id=hl-20-130><a class=lnlinks href=#hl-20-130>130</a>
</span><span class=lnt id=hl-20-131><a class=lnlinks href=#hl-20-131>131</a>
</span><span class=lnt id=hl-20-132><a class=lnlinks href=#hl-20-132>132</a>
</span><span class=lnt id=hl-20-133><a class=lnlinks href=#hl-20-133>133</a>
</span><span class=lnt id=hl-20-134><a class=lnlinks href=#hl-20-134>134</a>
</span><span class=lnt id=hl-20-135><a class=lnlinks href=#hl-20-135>135</a>
</span><span class=lnt id=hl-20-136><a class=lnlinks href=#hl-20-136>136</a>
</span><span class=lnt id=hl-20-137><a class=lnlinks href=#hl-20-137>137</a>
</span><span class=lnt id=hl-20-138><a class=lnlinks href=#hl-20-138>138</a>
</span><span class=lnt id=hl-20-139><a class=lnlinks href=#hl-20-139>139</a>
</span><span class=lnt id=hl-20-140><a class=lnlinks href=#hl-20-140>140</a>
</span><span class=lnt id=hl-20-141><a class=lnlinks href=#hl-20-141>141</a>
</span><span class=lnt id=hl-20-142><a class=lnlinks href=#hl-20-142>142</a>
</span><span class=lnt id=hl-20-143><a class=lnlinks href=#hl-20-143>143</a>
</span><span class=lnt id=hl-20-144><a class=lnlinks href=#hl-20-144>144</a>
</span><span class=lnt id=hl-20-145><a class=lnlinks href=#hl-20-145>145</a>
</span><span class=lnt id=hl-20-146><a class=lnlinks href=#hl-20-146>146</a>
</span><span class=lnt id=hl-20-147><a class=lnlinks href=#hl-20-147>147</a>
</span><span class=lnt id=hl-20-148><a class=lnlinks href=#hl-20-148>148</a>
</span><span class=lnt id=hl-20-149><a class=lnlinks href=#hl-20-149>149</a>
</span><span class=lnt id=hl-20-150><a class=lnlinks href=#hl-20-150>150</a>
</span><span class=lnt id=hl-20-151><a class=lnlinks href=#hl-20-151>151</a>
</span><span class=lnt id=hl-20-152><a class=lnlinks href=#hl-20-152>152</a>
</span><span class=lnt id=hl-20-153><a class=lnlinks href=#hl-20-153>153</a>
</span><span class=lnt id=hl-20-154><a class=lnlinks href=#hl-20-154>154</a>
</span><span class=lnt id=hl-20-155><a class=lnlinks href=#hl-20-155>155</a>
</span><span class=lnt id=hl-20-156><a class=lnlinks href=#hl-20-156>156</a>
</span><span class=lnt id=hl-20-157><a class=lnlinks href=#hl-20-157>157</a>
</span><span class=lnt id=hl-20-158><a class=lnlinks href=#hl-20-158>158</a>
</span><span class=lnt id=hl-20-159><a class=lnlinks href=#hl-20-159>159</a>
</span><span class=lnt id=hl-20-160><a class=lnlinks href=#hl-20-160>160</a>
</span><span class=lnt id=hl-20-161><a class=lnlinks href=#hl-20-161>161</a>
</span><span class=lnt id=hl-20-162><a class=lnlinks href=#hl-20-162>162</a>
</span><span class=lnt id=hl-20-163><a class=lnlinks href=#hl-20-163>163</a>
</span><span class=lnt id=hl-20-164><a class=lnlinks href=#hl-20-164>164</a>
</span><span class=lnt id=hl-20-165><a class=lnlinks href=#hl-20-165>165</a>
</span><span class=lnt id=hl-20-166><a class=lnlinks href=#hl-20-166>166</a>
</span><span class=lnt id=hl-20-167><a class=lnlinks href=#hl-20-167>167</a>
</span><span class=lnt id=hl-20-168><a class=lnlinks href=#hl-20-168>168</a>
</span><span class=lnt id=hl-20-169><a class=lnlinks href=#hl-20-169>169</a>
</span><span class=lnt id=hl-20-170><a class=lnlinks href=#hl-20-170>170</a>
</span><span class=lnt id=hl-20-171><a class=lnlinks href=#hl-20-171>171</a>
</span><span class=lnt id=hl-20-172><a class=lnlinks href=#hl-20-172>172</a>
</span><span class=lnt id=hl-20-173><a class=lnlinks href=#hl-20-173>173</a>
</span><span class=lnt id=hl-20-174><a class=lnlinks href=#hl-20-174>174</a>
</span><span class=lnt id=hl-20-175><a class=lnlinks href=#hl-20-175>175</a>
</span><span class=lnt id=hl-20-176><a class=lnlinks href=#hl-20-176>176</a>
</span><span class=lnt id=hl-20-177><a class=lnlinks href=#hl-20-177>177</a>
</span><span class=lnt id=hl-20-178><a class=lnlinks href=#hl-20-178>178</a>
</span><span class=lnt id=hl-20-179><a class=lnlinks href=#hl-20-179>179</a>
</span><span class=lnt id=hl-20-180><a class=lnlinks href=#hl-20-180>180</a>
</span><span class=lnt id=hl-20-181><a class=lnlinks href=#hl-20-181>181</a>
</span><span class=lnt id=hl-20-182><a class=lnlinks href=#hl-20-182>182</a>
</span><span class=lnt id=hl-20-183><a class=lnlinks href=#hl-20-183>183</a>
</span><span class=lnt id=hl-20-184><a class=lnlinks href=#hl-20-184>184</a>
</span><span class=lnt id=hl-20-185><a class=lnlinks href=#hl-20-185>185</a>
</span><span class=lnt id=hl-20-186><a class=lnlinks href=#hl-20-186>186</a>
</span><span class=lnt id=hl-20-187><a class=lnlinks href=#hl-20-187>187</a>
</span><span class=lnt id=hl-20-188><a class=lnlinks href=#hl-20-188>188</a>
</span><span class=lnt id=hl-20-189><a class=lnlinks href=#hl-20-189>189</a>
</span><span class=lnt id=hl-20-190><a class=lnlinks href=#hl-20-190>190</a>
</span><span class=lnt id=hl-20-191><a class=lnlinks href=#hl-20-191>191</a>
</span><span class=lnt id=hl-20-192><a class=lnlinks href=#hl-20-192>192</a>
</span><span class=lnt id=hl-20-193><a class=lnlinks href=#hl-20-193>193</a>
</span><span class=lnt id=hl-20-194><a class=lnlinks href=#hl-20-194>194</a>
</span><span class=lnt id=hl-20-195><a class=lnlinks href=#hl-20-195>195</a>
</span><span class=lnt id=hl-20-196><a class=lnlinks href=#hl-20-196>196</a>
</span><span class=lnt id=hl-20-197><a class=lnlinks href=#hl-20-197>197</a>
</span><span class=lnt id=hl-20-198><a class=lnlinks href=#hl-20-198>198</a>
</span><span class=lnt id=hl-20-199><a class=lnlinks href=#hl-20-199>199</a>
</span><span class=lnt id=hl-20-200><a class=lnlinks href=#hl-20-200>200</a>
</span><span class=lnt id=hl-20-201><a class=lnlinks href=#hl-20-201>201</a>
</span><span class=lnt id=hl-20-202><a class=lnlinks href=#hl-20-202>202</a>
</span><span class=lnt id=hl-20-203><a class=lnlinks href=#hl-20-203>203</a>
</span><span class=lnt id=hl-20-204><a class=lnlinks href=#hl-20-204>204</a>
</span><span class=lnt id=hl-20-205><a class=lnlinks href=#hl-20-205>205</a>
</span><span class=lnt id=hl-20-206><a class=lnlinks href=#hl-20-206>206</a>
</span><span class=lnt id=hl-20-207><a class=lnlinks href=#hl-20-207>207</a>
</span><span class=lnt id=hl-20-208><a class=lnlinks href=#hl-20-208>208</a>
</span><span class=lnt id=hl-20-209><a class=lnlinks href=#hl-20-209>209</a>
</span><span class=lnt id=hl-20-210><a class=lnlinks href=#hl-20-210>210</a>
</span><span class=lnt id=hl-20-211><a class=lnlinks href=#hl-20-211>211</a>
</span><span class=lnt id=hl-20-212><a class=lnlinks href=#hl-20-212>212</a>
</span><span class=lnt id=hl-20-213><a class=lnlinks href=#hl-20-213>213</a>
</span><span class=lnt id=hl-20-214><a class=lnlinks href=#hl-20-214>214</a>
</span><span class=lnt id=hl-20-215><a class=lnlinks href=#hl-20-215>215</a>
</span><span class=lnt id=hl-20-216><a class=lnlinks href=#hl-20-216>216</a>
</span><span class=lnt id=hl-20-217><a class=lnlinks href=#hl-20-217>217</a>
</span><span class=lnt id=hl-20-218><a class=lnlinks href=#hl-20-218>218</a>
</span><span class=lnt id=hl-20-219><a class=lnlinks href=#hl-20-219>219</a>
</span><span class=lnt id=hl-20-220><a class=lnlinks href=#hl-20-220>220</a>
</span><span class=lnt id=hl-20-221><a class=lnlinks href=#hl-20-221>221</a>
</span><span class=lnt id=hl-20-222><a class=lnlinks href=#hl-20-222>222</a>
</span><span class=lnt id=hl-20-223><a class=lnlinks href=#hl-20-223>223</a>
</span><span class=lnt id=hl-20-224><a class=lnlinks href=#hl-20-224>224</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 1. Outbox 이벤트 스키마 정의
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>outboxEventSchema</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span><span class=o>:</span> <span class=s1>&#39;UUID PRIMARY KEY&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>aggregate_type</span><span class=o>:</span> <span class=s1>&#39;VARCHAR(100)&#39;</span><span class=p>,</span>  <span class=c1>// &#39;Reservation&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>aggregate_id</span><span class=o>:</span> <span class=s1>&#39;VARCHAR(100)&#39;</span><span class=p>,</span>    <span class=c1>// 예약 ID
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>event_type</span><span class=o>:</span> <span class=s1>&#39;VARCHAR(100)&#39;</span><span class=p>,</span>      <span class=c1>// &#39;ReservationCreated&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>event_data</span><span class=o>:</span> <span class=s1>&#39;JSONB&#39;</span><span class=p>,</span>             <span class=c1>// 이벤트 페이로드
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>created_at</span><span class=o>:</span> <span class=s1>&#39;TIMESTAMP&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>processed_at</span><span class=o>:</span> <span class=s1>&#39;TIMESTAMP&#39;</span>        <span class=c1>// Outbox 패턴 핵심: 처리 추적
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 2. 예약 생성 서비스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>ReservationService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>dbClient</span><span class=p>,</span> <span class=nx>snsPublisher</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>db</span> <span class=o>=</span> <span class=nx>dbClient</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>snsPublisher</span> <span class=o>=</span> <span class=nx>snsPublisher</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>createReservation</span><span class=p>(</span><span class=nx>reservationData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 트랜잭션 시작 - 데이터와 이벤트의 원자성 보장
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>db</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;BEGIN&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 예약 데이터 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>reservationResult</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>        INSERT INTO reservations (id, property_id, guest_id, check_in, check_out, 
</span></span></span><span class=line><span class=cl><span class=sb>                                 total_amount, status, created_at)
</span></span></span><span class=line><span class=cl><span class=sb>        VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
</span></span></span><span class=line><span class=cl><span class=sb>        RETURNING *
</span></span></span><span class=line><span class=cl><span class=sb>      `</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>reservationData</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>reservationData</span><span class=p>.</span><span class=nx>propertyId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>reservationData</span><span class=p>.</span><span class=nx>guestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>reservationData</span><span class=p>.</span><span class=nx>checkIn</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>reservationData</span><span class=p>.</span><span class=nx>checkOut</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>reservationData</span><span class=p>.</span><span class=nx>totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;PENDING&#39;</span><span class=p>,</span>  <span class=c1>// 초기 상태
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>]);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>reservation</span> <span class=o>=</span> <span class=nx>reservationResult</span><span class=p>.</span><span class=nx>rows</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// Outbox에 이벤트 저장 - 핵심 패턴 구현
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>        INSERT INTO outbox_events (id, aggregate_type, aggregate_id, event_type, 
</span></span></span><span class=line><span class=cl><span class=sb>                                  event_data, created_at)
</span></span></span><span class=line><span class=cl><span class=sb>        VALUES ($1, $2, $3, $4, $5, $6)
</span></span></span><span class=line><span class=cl><span class=sb>      `</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>uuidv4</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Reservation&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>reservation</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;ReservationCreated&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>reservationId</span><span class=o>:</span> <span class=nx>reservation</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>propertyId</span><span class=o>:</span> <span class=nx>reservation</span><span class=p>.</span><span class=nx>property_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>guestId</span><span class=o>:</span> <span class=nx>reservation</span><span class=p>.</span><span class=nx>guest_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>checkIn</span><span class=o>:</span> <span class=nx>reservation</span><span class=p>.</span><span class=nx>check_in</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>checkOut</span><span class=o>:</span> <span class=nx>reservation</span><span class=p>.</span><span class=nx>check_out</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>totalAmount</span><span class=o>:</span> <span class=nx>reservation</span><span class=p>.</span><span class=nx>total_amount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>hostId</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>hostId</span><span class=p>,</span>  <span class=c1>// 알림용
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>propertyName</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>propertyName</span>  <span class=c1>// 알림용
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}),</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=nb>Date</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>]);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;COMMIT&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 트랜잭션 완료: 예약과 이벤트가 원자적으로 저장됨
</span></span></span><span class=line><span class=cl><span class=c1></span>      
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>reservation</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;ROLLBACK&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>client</span><span class=p>.</span><span class=nx>release</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 3. SNS Publisher (Outbox 폴링)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>OutboxSNSPublisher</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>dbClient</span><span class=p>,</span> <span class=nx>snsClient</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>db</span> <span class=o>=</span> <span class=nx>dbClient</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>sns</span> <span class=o>=</span> <span class=nx>snsClient</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>topicArn</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>RESERVATION_EVENTS_TOPIC_ARN</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 주기적 폴링 (cron job 또는 scheduled task)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>processOutboxEvents</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>unprocessedEvents</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>db</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>      SELECT * FROM outbox_events 
</span></span></span><span class=line><span class=cl><span class=sb>      WHERE processed_at IS NULL 
</span></span></span><span class=line><span class=cl><span class=sb>      ORDER BY created_at 
</span></span></span><span class=line><span class=cl><span class=sb>      LIMIT 100
</span></span></span><span class=line><span class=cl><span class=sb>    `</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>event</span> <span class=k>of</span> <span class=nx>unprocessedEvents</span><span class=p>.</span><span class=nx>rows</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// SNS로 이벤트 발행 - AWS 관리형 서비스 활용
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sns</span><span class=p>.</span><span class=nx>publish</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>TopicArn</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>topicArn</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>Message</span><span class=o>:</span> <span class=nx>event</span><span class=p>.</span><span class=nx>event_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>MessageAttributes</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;event-type&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>DataType</span><span class=o>:</span> <span class=s1>&#39;String&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>StringValue</span><span class=o>:</span> <span class=nx>event</span><span class=p>.</span><span class=nx>event_type</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;aggregate-id&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>DataType</span><span class=o>:</span> <span class=s1>&#39;String&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>              <span class=nx>StringValue</span><span class=o>:</span> <span class=nx>event</span><span class=p>.</span><span class=nx>aggregate_id</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nx>MessageGroupId</span><span class=o>:</span> <span class=nx>event</span><span class=p>.</span><span class=nx>aggregate_id</span><span class=p>,</span>  <span class=c1>// FIFO 순서 보장
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>MessageDeduplicationId</span><span class=o>:</span> <span class=nx>event</span><span class=p>.</span><span class=nx>id</span>     <span class=c1>// 중복 방지
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}).</span><span class=nx>promise</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 처리 완료 표시
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>db</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>          UPDATE outbox_events 
</span></span></span><span class=line><span class=cl><span class=sb>          SET processed_at = $1 
</span></span></span><span class=line><span class=cl><span class=sb>          WHERE id = $2
</span></span></span><span class=line><span class=cl><span class=sb>        `</span><span class=p>,</span> <span class=p>[</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span> <span class=nx>event</span><span class=p>.</span><span class=nx>id</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이벤트 발행 완료: </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>event_type</span><span class=si>}</span><span class=sb> - </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>aggregate_id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`이벤트 발행 실패: </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// DLQ 또는 재시도 로직 구현
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>handlePublishFailure</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>handlePublishFailure</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 실패 횟수 추가 및 재시도 제한 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>db</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>      UPDATE outbox_events 
</span></span></span><span class=line><span class=cl><span class=sb>      SET retry_count = COALESCE(retry_count, 0) + 1,
</span></span></span><span class=line><span class=cl><span class=sb>          last_error = $1
</span></span></span><span class=line><span class=cl><span class=sb>      WHERE id = $2
</span></span></span><span class=line><span class=cl><span class=sb>    `</span><span class=p>,</span> <span class=p>[</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span> <span class=nx>event</span><span class=p>.</span><span class=nx>id</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 4. 결제 서비스 이벤트 핸들러
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>PaymentEventHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>paymentService</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>paymentService</span> <span class=o>=</span> <span class=nx>paymentService</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// SQS 메시지 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>handleReservationCreated</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>eventData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>Body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>reservationData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>Message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 멱등성 확인 - 중복 처리 방지
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>existingPayment</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>paymentService</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>findByReservationId</span><span class=p>(</span><span class=nx>reservationData</span><span class=p>.</span><span class=nx>reservationId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>existingPayment</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`이미 처리된 예약: </span><span class=si>${</span><span class=nx>reservationData</span><span class=p>.</span><span class=nx>reservationId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 결제 처리 로직
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>paymentResult</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>paymentService</span><span class=p>.</span><span class=nx>createPayment</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>reservationId</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>reservationId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>amount</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>totalAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>guestId</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>guestId</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`결제 처리 완료: </span><span class=si>${</span><span class=nx>reservationData</span><span class=p>.</span><span class=nx>reservationId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`결제 처리 실패: </span><span class=si>${</span><span class=nx>reservationData</span><span class=p>.</span><span class=nx>reservationId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>  <span class=c1>// SQS 재시도 메커니즘 활용
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 5. 알림 서비스 이벤트 핸들러
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>NotificationEventHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>notificationService</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>notificationService</span> <span class=o>=</span> <span class=nx>notificationService</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>handleReservationCreated</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>eventData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>Body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>reservationData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>eventData</span><span class=p>.</span><span class=nx>Message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 게스트에게 예약 확인 알림
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>notificationService</span><span class=p>.</span><span class=nx>sendEmail</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>to</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>guestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>template</span><span class=o>:</span> <span class=s1>&#39;reservation-confirmation&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>propertyName</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>propertyName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>checkIn</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>checkIn</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>checkOut</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>checkOut</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// 호스트에게 새 예약 알림
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>notificationService</span><span class=p>.</span><span class=nx>sendEmail</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>to</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>hostId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>template</span><span class=o>:</span> <span class=s1>&#39;new-booking-notification&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>propertyName</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>propertyName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>guestId</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>guestId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>checkIn</span><span class=o>:</span> <span class=nx>reservationData</span><span class=p>.</span><span class=nx>checkIn</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`알림 발송 완료: </span><span class=si>${</span><span class=nx>reservationData</span><span class=p>.</span><span class=nx>reservationId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`알림 발송 실패: </span><span class=si>${</span><span class=nx>reservationData</span><span class=p>.</span><span class=nx>reservationId</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 알림 실패는 비즈니스 크리티컬하지 않으므로 예외 전파하지 않음
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li><strong>데이터 일관성</strong>: 예약-결제-알림 불일치 사고 99% 감소</li><li><strong>사용자 경험</strong>: 예약 확인 알림 전달률 99.5% 달성</li><li><strong>시스템 안정성</strong>: 서비스 장애 시에도 데이터 손실 0건</li><li><strong>개발 효율성</strong>: 복잡한 분산 트랜잭션 로직 제거로 개발 속도 40% 향상</li></ul><h2 id=54-통합-및-연계-기술-분석-1>5.4 통합 및 연계 기술 분석<a hidden class=anchor aria-hidden=true href=#54-통합-및-연계-기술-분석-1>#</a></h2><h3 id=event-sourcing과의-연계>Event Sourcing과의 연계<a hidden class=anchor aria-hidden=true href=#event-sourcing과의-연계>#</a></h3><p><strong>통합 방식</strong>:</p><ul><li>Outbox 이벤트를 Event Store에 영구 저장</li><li>상태 재구성 시 Outbox 히스토리 활용</li><li>CQRS와 결합하여 읽기/쓰기 모델 분리</li></ul><p><strong>코드 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>EventSourcingOutboxService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>appendEvent</span><span class=p>(</span><span class=n>DomainEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Event Store에 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>eventStore</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Outbox에도 저장 (외부 시스템 통합용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OutboxEvent</span><span class=w> </span><span class=n>outboxEvent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OutboxEvent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>getAggregateId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>getEventType</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>getData</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>outboxRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>outboxEvent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=saga-pattern과의-연계>Saga Pattern과의 연계<a hidden class=anchor aria-hidden=true href=#saga-pattern과의-연계>#</a></h3><p><strong>통합 방식</strong>:</p><ul><li>각 Saga 단계에서 Outbox 패턴 활용</li><li>보상 트랜잭션도 Outbox로 안전하게 발행</li><li>장기 실행 프로세스의 안정성 보장</li></ul><h3 id=cqrs와의-연계>CQRS와의 연계<a hidden class=anchor aria-hidden=true href=#cqrs와의-연계>#</a></h3><p><strong>통합 방식</strong>:</p><ul><li>Command 처리 시 Outbox 이벤트 생성</li><li>Query 모델 업데이트를 위한 이벤트 발행</li><li>읽기/쓰기 모델 간 최종 일관성 보장</li></ul><h1 id=phase-6-운영-및-최적화-operations--optimization-1>Phase 6: 운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#phase-6-운영-및-최적화-operations--optimization-1>#</a></h1><h2 id=61-보안-및-거버넌스-1>6.1 보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#61-보안-및-거버넌스-1>#</a></h2><h3 id=보안-고려사항>보안 고려사항<a hidden class=anchor aria-hidden=true href=#보안-고려사항>#</a></h3><p><strong>데이터 보호</strong>:</p><ol><li><p><strong>암호화 전략</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1>1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2>2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3>3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4>4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5>5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6>6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 민감 데이터 필드 레벨 암호화
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>outbox_events</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=n>UUID</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>event_data</span><span class=w> </span><span class=n>BYTEA</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 암호화된 페이로드 저장
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>event_data_hash</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>64</span><span class=p>),</span><span class=w>  </span><span class=c1>-- 무결성 검증용
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>encryption_key_id</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>  </span><span class=c1>-- 키 로테이션 지원
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>접근 제어</strong></p><ul><li>Outbox 테이블에 대한 최소 권한 원칙</li><li>애플리케이션별 전용 DB 사용자 계정</li><li>네트워크 레벨 접근 제한</li></ul></li><li><p><strong>감사 로깅</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3>3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4>4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5>5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6>6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7>7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8>8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@EventListener</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>auditOutboxAccess</span><span class=p>(</span><span class=n>OutboxAccessEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>auditLogger</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>AuditEntry</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>userId</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getUserId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>action</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getAction</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>resourceId</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getEventId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>timestamp</span><span class=p>(</span><span class=n>Instant</span><span class=p>.</span><span class=na>now</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=규정-준수>규정 준수<a hidden class=anchor aria-hidden=true href=#규정-준수>#</a></h3><p><strong>GDPR 대응</strong>:</p><ul><li>개인정보 포함 이벤트의 자동 익명화</li><li>삭제 요청 시 관련 이벤트 일괄 처리</li><li>데이터 보존 기간 자동 관리</li></ul><p><strong>SOX 준수</strong>:</p><ul><li>이벤트 변조 방지를 위한 디지털 서명</li><li>완전한 감사 추적 보장</li><li>접근 권한 정기 검토</li></ul><h2 id=62-모니터링-및-관측성-1>6.2 모니터링 및 관측성<a hidden class=anchor aria-hidden=true href=#62-모니터링-및-관측성-1>#</a></h2><h3 id=성능-모니터링>성능 모니터링<a hidden class=anchor aria-hidden=true href=#성능-모니터링>#</a></h3><p><strong>핵심 메트릭</strong>:</p><table><thead><tr><th>메트릭 카테고리</th><th>지표명</th><th>목표값</th><th>측정 방법</th></tr></thead><tbody><tr><td><strong>처리량</strong></td><td>Events/Second</td><td>1000+</td><td>Outbox 테이블 insert rate</td></tr><tr><td><strong>지연시간</strong></td><td>Processing Latency</td><td>&lt;5초</td><td>생성→발행 시간 차이</td></tr><tr><td><strong>신뢰성</strong></td><td>Success Rate</td><td>99.9%</td><td>성공 이벤트 / 전체 이벤트</td></tr><tr><td><strong>백로그</strong></td><td>Pending Events</td><td>&lt;100</td><td>미처리 이벤트 수</td></tr></tbody></table><p><strong>모니터링 구현</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17>17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18>18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OutboxMetrics</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MeterRegistry</span><span class=w> </span><span class=n>meterRegistry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>recordEventProcessed</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>eventType</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>success</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Timer</span><span class=p>.</span><span class=na>Sample</span><span class=w> </span><span class=n>sample</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Timer</span><span class=p>.</span><span class=na>start</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sample</span><span class=p>.</span><span class=na>stop</span><span class=p>(</span><span class=n>Timer</span><span class=p>.</span><span class=na>builder</span><span class=p>(</span><span class=s>&#34;outbox.processing.time&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;event_type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>eventType</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;success&#34;</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>success</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Counter</span><span class=p>.</span><span class=na>builder</span><span class=p>(</span><span class=s>&#34;outbox.events.processed&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;event_type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>eventType</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>success</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s>&#34;success&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=s>&#34;failure&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>increment</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=로깅-전략>로깅 전략<a hidden class=anchor aria-hidden=true href=#로깅-전략>#</a></h3><p><strong>구조화된 로깅</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-01-15T10:30:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;INFO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;service&#34;</span><span class=p>:</span> <span class=s2>&#34;order-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;component&#34;</span><span class=p>:</span> <span class=s2>&#34;outbox-relay&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event_id&#34;</span><span class=p>:</span> <span class=s2>&#34;12345-67890&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderConfirmed&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;aggregate_id&#34;</span><span class=p>:</span> <span class=s2>&#34;order-123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;processing_time_ms&#34;</span><span class=p>:</span> <span class=mi>150</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;retry_count&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Event published successfully&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=분산-트레이싱>분산 트레이싱<a hidden class=anchor aria-hidden=true href=#분산-트레이싱>#</a></h3><p><strong>OpenTelemetry 통합</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TracedOutboxService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@WithSpan</span><span class=p>(</span><span class=s>&#34;outbox.process.event&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processEvent</span><span class=p>(</span><span class=n>OutboxEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Span</span><span class=w> </span><span class=n>currentSpan</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Span</span><span class=p>.</span><span class=na>current</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>currentSpan</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;event.type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getEventType</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>currentSpan</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;event.id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=63-실무-적용-고려사항-및-주의점-1>6.3 실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#63-실무-적용-고려사항-및-주의점-1>#</a></h2><blockquote><p>이 표는 Transactional Outbox 패턴의 실무 적용 시 고려해야 할 사항들을 체계적으로 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>고려사항</th><th>위험도</th><th>영향도</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>성능</strong></td><td>대량 이벤트 처리 시 DB 부하</td><td>높음</td><td>높음</td><td>배치 처리, 읽기 복제본 활용</td></tr><tr><td><strong>저장공간</strong></td><td>Outbox 테이블 무제한 증가</td><td>중간</td><td>높음</td><td>자동 정리 작업, 아카이빙 정책</td></tr><tr><td><strong>순서보장</strong></td><td>이벤트 순서 뒤바뀜</td><td>높음</td><td>중간</td><td>파티션 키 기반 순서 보장</td></tr><tr><td><strong>중복처리</strong></td><td>네트워크 오류 시 중복 발생</td><td>중간</td><td>중간</td><td>멱등성 키, 중복 제거 로직</td></tr><tr><td><strong>장애복구</strong></td><td>Message Relay 서비스 장애</td><td>높음</td><td>높음</td><td>다중 인스턴스, 헬스체크</td></tr><tr><td><strong>데이터정합성</strong></td><td>트랜잭션 롤백 시 이벤트 유실</td><td>낮음</td><td>높음</td><td>트랜잭션 범위 정확한 설정</td></tr><tr><td><strong>스키마변경</strong></td><td>이벤트 스키마 호환성</td><td>중간</td><td>중간</td><td>버전 관리, 하위 호환성 유지</td></tr></tbody></table><p><strong>권장사항</strong>:</p><ol><li><p><strong>점진적 도입</strong></p><ul><li>비크리티컬 기능부터 시작</li><li>충분한 테스트 후 확장</li><li>롤백 계획 수립</li></ul></li><li><p><strong>모니터링 우선 구축</strong></p><ul><li>핵심 메트릭 먼저 설정</li><li>알림 임계값 단계별 조정</li><li>운영 플레이북 작성</li></ul></li><li><p><strong>팀 역량 강화</strong></p><ul><li>개발팀 교육 및 가이드라인 제공</li><li>코드 리뷰 체크리스트 작성</li><li>장애 대응 시나리오 훈련</li></ul></li></ol><h2 id=64-성능-최적화-전략-및-고려사항-1>6.4 성능 최적화 전략 및 고려사항<a hidden class=anchor aria-hidden=true href=#64-성능-최적화-전략-및-고려사항-1>#</a></h2><blockquote><p>이 표는 다양한 성능 최적화 전략과 적용 고려사항을 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>최적화 영역</th><th>전략</th><th>성능 개선</th><th>복잡도</th><th>비용</th><th>권장 시점</th></tr></thead><tbody><tr><td><strong>DB 최적화</strong></td><td>인덱스 튜닝</td><td>2-5배</td><td>낮음</td><td>낮음</td><td>즉시 적용</td></tr><tr><td><strong>배치 처리</strong></td><td>벌크 연산</td><td>5-10배</td><td>중간</td><td>낮음</td><td>100+ TPS</td></tr><tr><td><strong>읽기 분리</strong></td><td>읽기 전용 복제본</td><td>3-5배</td><td>중간</td><td>중간</td><td>1K+ TPS</td></tr><tr><td><strong>CDC 도입</strong></td><td>실시간 변경 감지</td><td>10-20배</td><td>높음</td><td>높음</td><td>10K+ TPS</td></tr><tr><td><strong>파티셔닝</strong></td><td>테이블 수평 분할</td><td>5-15배</td><td>높음</td><td>중간</td><td>대용량 데이터</td></tr><tr><td><strong>샤딩</strong></td><td>데이터베이스 분산</td><td>무제한</td><td>매우높음</td><td>높음</td><td>100K+ TPS</td></tr></tbody></table><h3 id=구체적-최적화-기법>구체적 최적화 기법<a hidden class=anchor aria-hidden=true href=#구체적-최적화-기법>#</a></h3><p><strong>1. 인덱스 최적화</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1>1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2>2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3>3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4>4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5>5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6>6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7>7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 복합 인덱스로 폴링 성능 개선
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_outbox_processing</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ON</span><span class=w> </span><span class=n>outbox_events</span><span class=w> </span><span class=p>(</span><span class=n>processed_at</span><span class=p>,</span><span class=w> </span><span class=n>created_at</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>processed_at</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NULL</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 파티션 프루닝을 위한 인덱스
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_outbox_created_date</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ON</span><span class=w> </span><span class=n>outbox_events</span><span class=w> </span><span class=p>(</span><span class=nb>DATE</span><span class=p>(</span><span class=n>created_at</span><span class=p>),</span><span class=w> </span><span class=n>processed_at</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>2. 배치 처리 최적화</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18>18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OptimizedOutboxProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processBatch</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>OutboxEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>events</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fetchEventsBatch</span><span class=p>(</span><span class=n>500</span><span class=p>);</span><span class=w>  </span><span class=c1>// 배치 크기 최적화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 벌크 업데이트로 성능 향상</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>futures</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>events</span><span class=p>.</span><span class=na>parallelStream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=k>this</span><span class=p>::</span><span class=n>processEventAsync</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CompletableFuture</span><span class=p>.</span><span class=na>allOf</span><span class=p>(</span><span class=n>futures</span><span class=p>.</span><span class=na>toArray</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>join</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 배치 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>batchUpdateProcessedStatus</span><span class=p>(</span><span class=n>events</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>3. CDC 기반 최적화</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Debezium 최적화 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>max.batch.size</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2048&#34;</span><span class=w>           </span><span class=c># 배치 크기 증가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>max.queue.size</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;16384&#34;</span><span class=w>          </span><span class=c># 큐 크기 최적화  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>poll.interval.ms</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100&#34;</span><span class=w>          </span><span class=c># 폴링 간격 단축</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>snapshot.mode</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;schema_only&#34;</span><span class=w>     </span><span class=c># 스냅샷 최적화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 성능 최적화 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>provide.transaction.metadata</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;false&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tombstones.on.delete</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;false&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>skip.messages.without.change</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>권장사항</strong>:</p><ol><li><p><strong>단계별 적용</strong></p><ul><li>현재 성능 측정 → 목표 설정 → 단계별 최적화</li><li>각 단계별 성과 측정 및 검증</li></ul></li><li><p><strong>비용 대비 효과 고려</strong></p><ul><li>간단한 최적화부터 우선 적용</li><li>ROI가 명확한 최적화에 집중</li></ul></li><li><p><strong>운영 복잡도 관리</strong></p><ul><li>팀 역량에 맞는 최적화 수준 선택</li><li>충분한 테스트 및 모니터링 체계 구축</li></ul></li></ol><p>이제 Phase 7로 진행하여 고급 주제와 미래 방향성을 다뤄보겠습니다. 계속 진행할까요?</p><h1 id=phase-7-고급-주제-advanced-topics-1>Phase 7: 고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#phase-7-고급-주제-advanced-topics-1>#</a></h1><h2 id=71-현재-도전-과제-1>7.1 현재 도전 과제<a hidden class=anchor aria-hidden=true href=#71-현재-도전-과제-1>#</a></h2><blockquote><p>이 표는 실무 환경에서 Transactional Outbox 패턴 적용 시 직면하는 기술적 난제들을 분석하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>구분</th><th>과제</th><th>원인</th><th>영향</th><th>해결방안</th></tr></thead><tbody><tr><td><strong>대규모 처리</strong></td><td>초당 10만+ 이벤트 처리</td><td>단일 DB 병목, 폴링 한계</td><td>지연 증가, 시스템 불안정</td><td>CDC + 샤딩, 이벤트 스트리밍</td></tr><tr><td><strong>순서 보장</strong></td><td>글로벌 순서 vs 성능</td><td>분산 환경에서의 순서 보장 복잡성</td><td>비즈니스 로직 오류</td><td>파티션 키 기반 부분 순서</td></tr><tr><td><strong>장기 저장</strong></td><td>수십 TB 이벤트 데이터 관리</td><td>무제한 증가하는 이벤트 히스토리</td><td>성능 저하, 높은 비용</td><td>계층형 스토리지, 자동 아카이빙</td></tr><tr><td><strong>다중 테넌트</strong></td><td>테넌트별 격리 및 성능</td><td>공유 인프라에서의 노이즈 네이버</td><td>SLA 위반, 보안 위험</td><td>테넌트별 샤딩, 리소스 격리</td></tr><tr><td><strong>스키마 진화</strong></td><td>하위 호환성 유지</td><td>이벤트 스키마 변경의 복잡성</td><td>서비스 다운타임, 데이터 손실</td><td>스키마 레지스트리, 버전 관리</td></tr></tbody></table><h3 id=상세-분석-대규모-처리-도전과제>상세 분석: 대규모 처리 도전과제<a hidden class=anchor aria-hidden=true href=#상세-분석-대규모-처리-도전과제>#</a></h3><p><strong>문제 상황</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1>1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2>2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3>3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>일일 10억 건 이벤트 처리 시나리오
</span></span><span class=line><span class=cl>- 초당 평균 11,574건 
</span></span><span class=line><span class=cl>- 피크 시간 초당 100,000건+
</span></span><span class=line><span class=cl>- 단일 Outbox 테이블 한계 도달
</span></span></code></pre></td></tr></table></div></div><p><strong>해결 전략</strong>:</p><ol><li><strong>샤딩 기반 분산 처리</strong></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1>1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2>2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3>3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4>4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5>5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6>6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 시간 기반 파티셔닝
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>outbox_events_2024_01</span><span class=w> </span><span class=n>PARTITION</span><span class=w> </span><span class=k>OF</span><span class=w> </span><span class=n>outbox_events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FOR</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2024-01-01&#39;</span><span class=p>)</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2024-02-01&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 해시 기반 샤딩  
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>outbox_events_shard_1</span><span class=w> </span><span class=n>PARTITION</span><span class=w> </span><span class=k>OF</span><span class=w> </span><span class=n>outbox_events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FOR</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>MODULUS</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=n>REMAINDER</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=2><li><strong>이벤트 스트리밍 아키텍처</strong></li></ol><pre class=mermaid>graph TB
    subgraph &#34;Production Cluster&#34;
        A1[Service A]
        A2[Service B] 
        A3[Service C]
        OS[Outbox Shards]
        A1 --&gt; OS
        A2 --&gt; OS
        A3 --&gt; OS
    end
    
    subgraph &#34;Streaming Layer&#34;
        KS[Kafka Streams]
        OS --&gt; KS
    end
    
    subgraph &#34;Processing Cluster&#34;
        P1[Processor 1]
        P2[Processor 2]
        P3[Processor 3]
        KS --&gt; P1
        KS --&gt; P2  
        KS --&gt; P3
    end
</pre><ol start=3><li><strong>계층형 처리 전략</strong></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15>15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16>16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17>17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18>18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19>19</a>
</span><span class=lnt id=hl-33-20><a class=lnlinks href=#hl-33-20>20</a>
</span><span class=lnt id=hl-33-21><a class=lnlinks href=#hl-33-21>21</a>
</span><span class=lnt id=hl-33-22><a class=lnlinks href=#hl-33-22>22</a>
</span><span class=lnt id=hl-33-23><a class=lnlinks href=#hl-33-23>23</a>
</span><span class=lnt id=hl-33-24><a class=lnlinks href=#hl-33-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TieredEventProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 핫 데이터: 실시간 처리 (최근 1시간)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@EventListener</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processHotEvents</span><span class=p>(</span><span class=n>OutboxEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>isWithinLastHour</span><span class=p>(</span><span class=n>event</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>processImmediately</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 웜 데이터: 배치 처리 (1시간 ~ 1일)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>fixedRate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>300000</span><span class=p>)</span><span class=w> </span><span class=c1>// 5분마다</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processWarmEvents</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>OutboxEvent</span><span class=o>&gt;</span><span class=w> </span><span class=n>warmEvents</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fetchWarmEvents</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>processBatch</span><span class=p>(</span><span class=n>warmEvents</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 콜드 데이터: 아카이브 처리 (1일 이상)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Scheduled</span><span class=p>(</span><span class=n>cron</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;0 2 * * *&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>// 매일 새벽 2시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>archiveColdEvents</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>archiveEventsOlderThan</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofDays</span><span class=p>(</span><span class=n>1</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=72-생태계-및-관련-기술-1>7.2 생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#72-생태계-및-관련-기술-1>#</a></h2><h3 id=통합-연계-가능한-기술>통합 연계 가능한 기술<a hidden class=anchor aria-hidden=true href=#통합-연계-가능한-기술>#</a></h3><p><strong>Event Sourcing 생태계</strong>:</p><pre class=mermaid>graph LR
    subgraph &#34;Event Store Technologies&#34;
        ES[EventStore]
        AX[Axon Server]
        KF[Kafka as Event Store]
    end
    
    subgraph &#34;Outbox Integration&#34;
        TO[Transactional Outbox]
        TO --&gt; ES
        TO --&gt; AX
        TO --&gt; KF
    end
    
    subgraph &#34;Query Models&#34;
        RD[Read Models]
        PR[Projections]
        VI[Views]
        TO --&gt; RD
        TO --&gt; PR
        TO --&gt; VI
    end
</pre><p><strong>메시징 생태계</strong>:</p><table><thead><tr><th>기술</th><th>역할</th><th>Outbox 통합</th><th>특징</th></tr></thead><tbody><tr><td><strong>Apache Kafka</strong></td><td>이벤트 스트리밍</td><td>Kafka Connect</td><td>높은 처리량, 분산 처리</td></tr><tr><td><strong>RabbitMQ</strong></td><td>메시지 라우팅</td><td>플러그인 지원</td><td>복잡한 라우팅, AMQP</td></tr><tr><td><strong>Apache Pulsar</strong></td><td>다중 테넌트 메시징</td><td>Pulsar IO</td><td>지리적 복제, 계층형 저장</td></tr><tr><td><strong>Redis Streams</strong></td><td>실시간 스트리밍</td><td>수동 통합</td><td>낮은 지연, 메모리 기반</td></tr><tr><td><strong>AWS EventBridge</strong></td><td>서버리스 이벤트</td><td>Lambda 통합</td><td>관리형, 스키마 레지스트리</td></tr></tbody></table><h3 id=표준-및-프로토콜>표준 및 프로토콜<a hidden class=anchor aria-hidden=true href=#표준-및-프로토콜>#</a></h3><p><strong>CloudEvents 표준 확장</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;specversion&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;com.example.order.confirmed&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;order-service/outbox&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-01-15T10:30:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;datacontenttype&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// Outbox 확장 속성
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nt>&#34;outboxversion&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;outboxid&#34;</span><span class=p>:</span> <span class=s2>&#34;outbox-67890&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;aggregateid&#34;</span><span class=p>:</span> <span class=s2>&#34;order-123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;aggregateversion&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;causationid&#34;</span><span class=p>:</span> <span class=s2>&#34;user-action-456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;correlationid&#34;</span><span class=p>:</span> <span class=s2>&#34;session-789&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;orderId&#34;</span><span class=p>:</span> <span class=s2>&#34;12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;amount&#34;</span><span class=p>:</span> <span class=mf>100.00</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>OpenTelemetry 통합</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13>13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14>14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15>15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16>16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17>17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18>18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19>19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20>20</a>
</span><span class=lnt id=hl-36-21><a class=lnlinks href=#hl-36-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TracedOutboxService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Tracer</span><span class=w> </span><span class=n>tracer</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>GlobalOpenTelemetry</span><span class=p>.</span><span class=na>getTracer</span><span class=p>(</span><span class=s>&#34;outbox-service&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processEvent</span><span class=p>(</span><span class=n>OutboxEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Span</span><span class=w> </span><span class=n>span</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tracer</span><span class=p>.</span><span class=na>spanBuilder</span><span class=p>(</span><span class=s>&#34;outbox.process&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;event.type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getEventType</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;aggregate.id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getAggregateId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;outbox.version&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1.0&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>startSpan</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Scope</span><span class=w> </span><span class=n>scope</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>span</span><span class=p>.</span><span class=na>makeCurrent</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 이벤트 처리 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>publishToMessageBroker</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>span</span><span class=p>.</span><span class=na>end</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=73-최신-기술-트렌드와-미래-방향-1>7.3 최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#73-최신-기술-트렌드와-미래-방향-1>#</a></h2><h3 id=클라우드-네이티브-진화>클라우드 네이티브 진화<a hidden class=anchor aria-hidden=true href=#클라우드-네이티브-진화>#</a></h3><p><strong>서버리스 Outbox</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a>
</span><span class=lnt id=hl-37-12><a class=lnlinks href=#hl-37-12>12</a>
</span><span class=lnt id=hl-37-13><a class=lnlinks href=#hl-37-13>13</a>
</span><span class=lnt id=hl-37-14><a class=lnlinks href=#hl-37-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># AWS SAM 템플릿 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>OutboxProcessor</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class=l>AWS::Serverless::Function</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>Properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>CodeUri</span><span class=p>:</span><span class=w> </span><span class=l>outbox-processor/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>Runtime</span><span class=p>:</span><span class=w> </span><span class=l>nodejs18.x</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>Events</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DynamoDBStream</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class=l>DynamoDB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>Properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>Stream</span><span class=p>:</span><span class=w> </span>!<span class=l>GetAtt OutboxTable.StreamArn</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>StartingPosition</span><span class=p>:</span><span class=w> </span><span class=l>LATEST</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>MaximumBatchingWindowInSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ParallelizationFactor</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>컨테이너 네이티브</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1> 1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2> 2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3> 3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4> 4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5> 5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6> 6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7> 7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8> 8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9> 9</a>
</span><span class=lnt id=hl-38-10><a class=lnlinks href=#hl-38-10>10</a>
</span><span class=lnt id=hl-38-11><a class=lnlinks href=#hl-38-11>11</a>
</span><span class=lnt id=hl-38-12><a class=lnlinks href=#hl-38-12>12</a>
</span><span class=lnt id=hl-38-13><a class=lnlinks href=#hl-38-13>13</a>
</span><span class=lnt id=hl-38-14><a class=lnlinks href=#hl-38-14>14</a>
</span><span class=lnt id=hl-38-15><a class=lnlinks href=#hl-38-15>15</a>
</span><span class=lnt id=hl-38-16><a class=lnlinks href=#hl-38-16>16</a>
</span><span class=lnt id=hl-38-17><a class=lnlinks href=#hl-38-17>17</a>
</span><span class=lnt id=hl-38-18><a class=lnlinks href=#hl-38-18>18</a>
</span><span class=lnt id=hl-38-19><a class=lnlinks href=#hl-38-19>19</a>
</span><span class=lnt id=hl-38-20><a class=lnlinks href=#hl-38-20>20</a>
</span><span class=lnt id=hl-38-21><a class=lnlinks href=#hl-38-21>21</a>
</span><span class=lnt id=hl-38-22><a class=lnlinks href=#hl-38-22>22</a>
</span><span class=lnt id=hl-38-23><a class=lnlinks href=#hl-38-23>23</a>
</span><span class=lnt id=hl-38-24><a class=lnlinks href=#hl-38-24>24</a>
</span><span class=lnt id=hl-38-25><a class=lnlinks href=#hl-38-25>25</a>
</span><span class=lnt id=hl-38-26><a class=lnlinks href=#hl-38-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Kubernetes Operator 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>outbox.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>OutboxProcessor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service-outbox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>source</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>connectionString</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;postgresql://...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>table</span><span class=p>:</span><span class=w> </span><span class=l>outbox_events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>destination</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>brokers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;kafka-1:9092&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;kafka-2:9092&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>processing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>batchSize</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pollingInterval</span><span class=p>:</span><span class=w> </span><span class=l>5s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>maxRetries</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scaling</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Custom</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>custom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>metricName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;outbox_queue_depth&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>targetValue</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=aiml-통합-트렌드>AI/ML 통합 트렌드<a hidden class=anchor aria-hidden=true href=#aiml-통합-트렌드>#</a></h3><p><strong>지능형 이벤트 라우팅</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1> 1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2> 2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3> 3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4> 4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5> 5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6> 6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7> 7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8> 8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9> 9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10>10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11>11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12>12</a>
</span><span class=lnt id=hl-39-13><a class=lnlinks href=#hl-39-13>13</a>
</span><span class=lnt id=hl-39-14><a class=lnlinks href=#hl-39-14>14</a>
</span><span class=lnt id=hl-39-15><a class=lnlinks href=#hl-39-15>15</a>
</span><span class=lnt id=hl-39-16><a class=lnlinks href=#hl-39-16>16</a>
</span><span class=lnt id=hl-39-17><a class=lnlinks href=#hl-39-17>17</a>
</span><span class=lnt id=hl-39-18><a class=lnlinks href=#hl-39-18>18</a>
</span><span class=lnt id=hl-39-19><a class=lnlinks href=#hl-39-19>19</a>
</span><span class=lnt id=hl-39-20><a class=lnlinks href=#hl-39-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>IntelligentOutboxProcessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>ml_model</span> <span class=o>=</span> <span class=n>load_model</span><span class=p>(</span><span class=s1>&#39;event_priority_classifier&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># ML 모델로 이벤트 우선순위 예측</span>
</span></span><span class=line><span class=cl>        <span class=n>priority</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>ml_model</span><span class=o>.</span><span class=n>predict</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>event_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>payload_size</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>event</span><span class=o>.</span><span class=n>source_service</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>current_system_load</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 우선순위에 따른 처리 경로 결정</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>priority</span> <span class=o>==</span> <span class=s1>&#39;HIGH&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>process_immediately</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>priority</span> <span class=o>==</span> <span class=s1>&#39;MEDIUM&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>queue_for_batch_processing</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>schedule_for_off_peak</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>이상 탐지 및 자동 복구</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1> 1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2> 2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3> 3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4> 4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5> 5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6> 6</a>
</span><span class=lnt id=hl-40-7><a class=lnlinks href=#hl-40-7> 7</a>
</span><span class=lnt id=hl-40-8><a class=lnlinks href=#hl-40-8> 8</a>
</span><span class=lnt id=hl-40-9><a class=lnlinks href=#hl-40-9> 9</a>
</span><span class=lnt id=hl-40-10><a class=lnlinks href=#hl-40-10>10</a>
</span><span class=lnt id=hl-40-11><a class=lnlinks href=#hl-40-11>11</a>
</span><span class=lnt id=hl-40-12><a class=lnlinks href=#hl-40-12>12</a>
</span><span class=lnt id=hl-40-13><a class=lnlinks href=#hl-40-13>13</a>
</span><span class=lnt id=hl-40-14><a class=lnlinks href=#hl-40-14>14</a>
</span><span class=lnt id=hl-40-15><a class=lnlinks href=#hl-40-15>15</a>
</span><span class=lnt id=hl-40-16><a class=lnlinks href=#hl-40-16>16</a>
</span><span class=lnt id=hl-40-17><a class=lnlinks href=#hl-40-17>17</a>
</span><span class=lnt id=hl-40-18><a class=lnlinks href=#hl-40-18>18</a>
</span><span class=lnt id=hl-40-19><a class=lnlinks href=#hl-40-19>19</a>
</span><span class=lnt id=hl-40-20><a class=lnlinks href=#hl-40-20>20</a>
</span><span class=lnt id=hl-40-21><a class=lnlinks href=#hl-40-21>21</a>
</span><span class=lnt id=hl-40-22><a class=lnlinks href=#hl-40-22>22</a>
</span><span class=lnt id=hl-40-23><a class=lnlinks href=#hl-40-23>23</a>
</span><span class=lnt id=hl-40-24><a class=lnlinks href=#hl-40-24>24</a>
</span><span class=lnt id=hl-40-25><a class=lnlinks href=#hl-40-25>25</a>
</span><span class=lnt id=hl-40-26><a class=lnlinks href=#hl-40-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OutboxAnomalyDetector</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>AnomalyDetectionService</span><span class=w> </span><span class=n>anomalyService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@EventListener</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>detectAnomalies</span><span class=p>(</span><span class=n>OutboxMetricsEvent</span><span class=w> </span><span class=n>metrics</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>AnomalyScore</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>anomalyService</span><span class=p>.</span><span class=na>analyze</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>metrics</span><span class=p>.</span><span class=na>getProcessingLatency</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>metrics</span><span class=p>.</span><span class=na>getErrorRate</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>metrics</span><span class=p>.</span><span class=na>getThroughput</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>score</span><span class=p>.</span><span class=na>isAnomalous</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 자동 복구 액션</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>score</span><span class=p>.</span><span class=na>getType</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>PERFORMANCE_DEGRADATION</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>scaleUpProcessor</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>score</span><span class=p>.</span><span class=na>getType</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>HIGH_ERROR_RATE</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>enableCircuitBreaker</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>alertOpsTeam</span><span class=p>(</span><span class=n>score</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=edge-computing-지원>Edge Computing 지원<a hidden class=anchor aria-hidden=true href=#edge-computing-지원>#</a></h3><p><strong>엣지 환경 최적화</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;Edge Locations&#34;
        E1[Edge Node 1]
        E2[Edge Node 2]
        E3[Edge Node 3]
        EO1[Local Outbox]
        EO2[Local Outbox]
        EO3[Local Outbox]
        E1 --&gt; EO1
        E2 --&gt; EO2
        E3 --&gt; EO3
    end
    
    subgraph &#34;Regional Hub&#34;
        RH[Regional Hub]
        EO1 --&gt; RH
        EO2 --&gt; RH
        EO3 --&gt; RH
    end
    
    subgraph &#34;Central Cloud&#34;
        CC[Central Cloud]
        RH --&gt; CC
    end
</pre><h2 id=74-기타-고급-사항-1>7.4 기타 고급 사항<a hidden class=anchor aria-hidden=true href=#74-기타-고급-사항-1>#</a></h2><h3 id=멀티-클라우드-환경-고려사항>멀티 클라우드 환경 고려사항<a hidden class=anchor aria-hidden=true href=#멀티-클라우드-환경-고려사항>#</a></h3><p><strong>크로스 클라우드 이벤트 복제</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1> 1</a>
</span><span class=lnt id=hl-42-2><a class=lnlinks href=#hl-42-2> 2</a>
</span><span class=lnt id=hl-42-3><a class=lnlinks href=#hl-42-3> 3</a>
</span><span class=lnt id=hl-42-4><a class=lnlinks href=#hl-42-4> 4</a>
</span><span class=lnt id=hl-42-5><a class=lnlinks href=#hl-42-5> 5</a>
</span><span class=lnt id=hl-42-6><a class=lnlinks href=#hl-42-6> 6</a>
</span><span class=lnt id=hl-42-7><a class=lnlinks href=#hl-42-7> 7</a>
</span><span class=lnt id=hl-42-8><a class=lnlinks href=#hl-42-8> 8</a>
</span><span class=lnt id=hl-42-9><a class=lnlinks href=#hl-42-9> 9</a>
</span><span class=lnt id=hl-42-10><a class=lnlinks href=#hl-42-10>10</a>
</span><span class=lnt id=hl-42-11><a class=lnlinks href=#hl-42-11>11</a>
</span><span class=lnt id=hl-42-12><a class=lnlinks href=#hl-42-12>12</a>
</span><span class=lnt id=hl-42-13><a class=lnlinks href=#hl-42-13>13</a>
</span><span class=lnt id=hl-42-14><a class=lnlinks href=#hl-42-14>14</a>
</span><span class=lnt id=hl-42-15><a class=lnlinks href=#hl-42-15>15</a>
</span><span class=lnt id=hl-42-16><a class=lnlinks href=#hl-42-16>16</a>
</span><span class=lnt id=hl-42-17><a class=lnlinks href=#hl-42-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Terraform 구성 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>resource &#34;aws_sqs_queue&#34; &#34;outbox_primary&#34; {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>name = &#34;outbox-events-primary&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 크로스 리전 복제 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>redrive_policy = jsonencode({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>deadLetterTargetArn = aws_sqs_queue.dlq.arn</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>maxReceiveCount = 3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>}<span class=l>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>resource &#34;google_pubsub_topic&#34; &#34;outbox_replica&#34; {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>name = &#34;outbox-events-replica&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># AWS SQS와 동기화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>depends_on = [aws_sqs_queue.outbox_primary]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}<span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=규제-준수-고려사항>규제 준수 고려사항<a hidden class=anchor aria-hidden=true href=#규제-준수-고려사항>#</a></h3><p><strong>데이터 주권 (Data Sovereignty)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1> 1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2> 2</a>
</span><span class=lnt id=hl-43-3><a class=lnlinks href=#hl-43-3> 3</a>
</span><span class=lnt id=hl-43-4><a class=lnlinks href=#hl-43-4> 4</a>
</span><span class=lnt id=hl-43-5><a class=lnlinks href=#hl-43-5> 5</a>
</span><span class=lnt id=hl-43-6><a class=lnlinks href=#hl-43-6> 6</a>
</span><span class=lnt id=hl-43-7><a class=lnlinks href=#hl-43-7> 7</a>
</span><span class=lnt id=hl-43-8><a class=lnlinks href=#hl-43-8> 8</a>
</span><span class=lnt id=hl-43-9><a class=lnlinks href=#hl-43-9> 9</a>
</span><span class=lnt id=hl-43-10><a class=lnlinks href=#hl-43-10>10</a>
</span><span class=lnt id=hl-43-11><a class=lnlinks href=#hl-43-11>11</a>
</span><span class=lnt id=hl-43-12><a class=lnlinks href=#hl-43-12>12</a>
</span><span class=lnt id=hl-43-13><a class=lnlinks href=#hl-43-13>13</a>
</span><span class=lnt id=hl-43-14><a class=lnlinks href=#hl-43-14>14</a>
</span><span class=lnt id=hl-43-15><a class=lnlinks href=#hl-43-15>15</a>
</span><span class=lnt id=hl-43-16><a class=lnlinks href=#hl-43-16>16</a>
</span><span class=lnt id=hl-43-17><a class=lnlinks href=#hl-43-17>17</a>
</span><span class=lnt id=hl-43-18><a class=lnlinks href=#hl-43-18>18</a>
</span><span class=lnt id=hl-43-19><a class=lnlinks href=#hl-43-19>19</a>
</span><span class=lnt id=hl-43-20><a class=lnlinks href=#hl-43-20>20</a>
</span><span class=lnt id=hl-43-21><a class=lnlinks href=#hl-43-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DataSovereigntyOutboxProcessor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processEvent</span><span class=p>(</span><span class=n>OutboxEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 데이터 분류 확인</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DataClassification</span><span class=w> </span><span class=n>classification</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>classifyEvent</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 지역별 라우팅 규칙 적용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>classification</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>PersonalData</span><span class=p>.</span><span class=na>EU_CITIZEN</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>routeToEURegion</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>classification</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>PersonalData</span><span class=p>.</span><span class=na>US_CITIZEN</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>routeToUSRegion</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 암호화 요구사항 적용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>classification</span><span class=p>.</span><span class=na>isHighSensitivity</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>encryptWithHSM</span><span class=p>(</span><span class=n>event</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=성능-벤치마킹>성능 벤치마킹<a hidden class=anchor aria-hidden=true href=#성능-벤치마킹>#</a></h3><p><strong>실제 성능 데이터</strong> (참고용):</p><table><thead><tr><th>환경</th><th>구성</th><th>처리량 (TPS)</th><th>지연시간 (P99)</th><th>비용/월</th></tr></thead><tbody><tr><td><strong>단일 DB</strong></td><td>PostgreSQL 16vCPU</td><td>1,000</td><td>500ms</td><td>$500</td></tr><tr><td><strong>읽기 복제본</strong></td><td>Primary + 2 Replica</td><td>5,000</td><td>200ms</td><td>$1,200</td></tr><tr><td><strong>CDC + Kafka</strong></td><td>Debezium + 3-node Kafka</td><td>50,000</td><td>50ms</td><td>$3,000</td></tr><tr><td><strong>샤딩 환경</strong></td><td>4-shard + CDC</td><td>200,000</td><td>30ms</td><td>$8,000</td></tr><tr><td><strong>클라우드 관리형</strong></td><td>AWS EventBridge</td><td>100,000</td><td>100ms</td><td>$2,500</td></tr></tbody></table><h3 id=미래-기술-예측>미래 기술 예측<a hidden class=anchor aria-hidden=true href=#미래-기술-예측>#</a></h3><p><strong>2025-2027 예상 발전 방향</strong>:</p><ol><li><p><strong>WebAssembly 통합</strong></p><ul><li>경량 이벤트 프로세서</li><li>다중 언어 지원 확대</li></ul></li><li><p><strong>양자 암호화 적용</strong></p><ul><li>이벤트 데이터 양자 보안</li><li>장기 보존 데이터 보호</li></ul></li><li><p><strong>자율 운영 시스템</strong></p><ul><li>AI 기반 자동 최적화</li><li>예측적 확장 및 복구</li></ul></li><li><p><strong>블록체인 통합</strong></p><ul><li>이벤트 무결성 검증</li><li>분산 감사 추적</li></ul></li></ol><hr><h1 id=5단계-종합-정리-및-학습-가이드-1>5단계: 종합 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#5단계-종합-정리-및-학습-가이드-1>#</a></h1><h2 id=내용-종합-1>내용 종합<a hidden class=anchor aria-hidden=true href=#내용-종합-1>#</a></h2><p>Transactional Outbox 패턴은 분산 시스템에서 데이터 일관성과 메시지 전달 신뢰성을 보장하는 핵심 아키텍처 패턴입니다. 단일 트랜잭션 내에서 비즈니스 데이터와 이벤트를 함께 저장하고, 별도 프로세스를 통해 안전하게 메시지를 전달함으로써 &ldquo;Dual Write&rdquo; 문제를 효과적으로 해결합니다.</p><p><strong>최신 트렌드 반영</strong>:</p><ul><li><strong>클라우드 네이티브</strong>: 서버리스, 컨테이너 환경 최적화</li><li><strong>AI/ML 통합</strong>: 지능형 라우팅, 이상 탐지 자동화</li><li><strong>엣지 컴퓨팅</strong>: 분산 환경에서의 계층형 이벤트 처리</li><li><strong>규제 준수</strong>: GDPR, 데이터 주권 요구사항 대응</li></ul><h2 id=학습-로드맵-1>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵-1>#</a></h2><h3 id=초급-단계-1-2주>초급 단계 (1-2주)<a hidden class=anchor aria-hidden=true href=#초급-단계-1-2주>#</a></h3><p><strong>목표</strong>: 기본 개념 이해 및 간단한 구현</p><ol><li><p><strong>이론 학습</strong></p><ul><li>Dual Write 문제 이해</li><li>기본 동작 원리 파악</li><li>장단점 분석</li></ul></li><li><p><strong>실습</strong></p><ul><li>단순 폴링 기반 구현</li><li>로컬 환경에서 테스트</li><li>기본 모니터링 구성</li></ul></li></ol><h3 id=중급-단계-2-4주>중급 단계 (2-4주)<a hidden class=anchor aria-hidden=true href=#중급-단계-2-4주>#</a></h3><p><strong>목표</strong>: 실무 환경 적용 및 최적화</p><ol><li><p><strong>심화 학습</strong></p><ul><li>다양한 구현 방식 비교</li><li>성능 최적화 기법</li><li>운영 고려사항</li></ul></li><li><p><strong>실습</strong></p><ul><li>CDC 기반 구현</li><li>프로덕션 환경 배포</li><li>모니터링 및 알림 구성</li></ul></li></ol><h3 id=고급-단계-4-8주>고급 단계 (4-8주)<a hidden class=anchor aria-hidden=true href=#고급-단계-4-8주>#</a></h3><p><strong>목표</strong>: 대규모 환경 설계 및 고급 패턴 활용</p><ol><li><p><strong>전문가 학습</strong></p><ul><li>샤딩 및 분산 처리</li><li>다른 패턴과의 통합</li><li>최신 기술 트렌드</li></ul></li><li><p><strong>실습</strong></p><ul><li>대규모 시스템 설계</li><li>성능 벤치마킹</li><li>장애 복구 시나리오</li></ul></li></ol><h2 id=실무-적용-가이드-1>실무 적용 가이드<a hidden class=anchor aria-hidden=true href=#실무-적용-가이드-1>#</a></h2><h3 id=도입-결정-기준>도입 결정 기준<a hidden class=anchor aria-hidden=true href=#도입-결정-기준>#</a></h3><ol><li><p><strong>적합한 경우</strong></p><ul><li>마이크로서비스 아키텍처</li><li>이벤트 기반 통신 필요</li><li>데이터 일관성 중요</li></ul></li><li><p><strong>부적합한 경우</strong></p><ul><li>단순한 모놀리식 구조</li><li>실시간성이 극도로 중요</li><li>팀 역량 부족</li></ul></li></ol><h3 id=단계별-도입-전략>단계별 도입 전략<a hidden class=anchor aria-hidden=true href=#단계별-도입-전략>#</a></h3><ol><li><strong>1단계</strong>: 비크리티컬 기능으로 시작</li><li><strong>2단계</strong>: 모니터링 체계 구축</li><li><strong>3단계</strong>: 점진적 확장 적용</li><li><strong>4단계</strong>: 성능 최적화 및 고도화</li></ol><h2 id=학습-항목-매트릭스-1>학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#학습-항목-매트릭스-1>#</a></h2><blockquote><p>이 표는 체계적인 학습을 위해 단계별 학습 항목과 중요도를 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>Phase</th><th>항목</th><th>중요도</th><th>학습 목표</th><th>실무 연관성</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td>1</td><td>Dual Write 문제</td><td>필수</td><td>패턴 필요성 이해</td><td>높음</td><td>분산 시스템의 근본적 문제</td></tr><tr><td>기초</td><td>1</td><td>기본 동작 원리</td><td>필수</td><td>패턴 작동 방식 파악</td><td>높음</td><td>트랜잭션과 메시징 통합</td></tr><tr><td>핵심</td><td>2</td><td>Outbox 테이블 설계</td><td>필수</td><td>구조적 이해</td><td>높음</td><td>실제 구현의 핵심 요소</td></tr><tr><td>핵심</td><td>2</td><td>Message Relay 구현</td><td>필수</td><td>이벤트 전달 메커니즘</td><td>높음</td><td>신뢰성 있는 메시지 처리</td></tr><tr><td>특성</td><td>3</td><td>성능 특성 분석</td><td>권장</td><td>트레이드오프 이해</td><td>중간</td><td>현실적 제약사항 파악</td></tr><tr><td>구현</td><td>4</td><td>폴링 vs CDC 구현</td><td>필수</td><td>구현 방식 선택</td><td>높음</td><td>환경별 최적 구현</td></tr><tr><td>구현</td><td>4</td><td>프레임워크 활용</td><td>권장</td><td>생산성 향상</td><td>중간</td><td>실무 개발 효율성</td></tr><tr><td>응용</td><td>5</td><td>실습 예제 구현</td><td>필수</td><td>실전 경험</td><td>높음</td><td>이론의 실무 적용</td></tr><tr><td>응용</td><td>5</td><td>실제 사례 분석</td><td>권장</td><td>베스트 프랙티스 학습</td><td>중간</td><td>검증된 패턴 활용</td></tr><tr><td>운영</td><td>6</td><td>모니터링 구성</td><td>필수</td><td>운영 안정성</td><td>높음</td><td>프로덕션 필수 요소</td></tr><tr><td>운영</td><td>6</td><td>성능 최적화</td><td>권장</td><td>확장성 확보</td><td>중간</td><td>대규모 적용 시 필요</td></tr><tr><td>고급</td><td>7</td><td>대규모 처리</td><td>선택</td><td>엔터프라이즈 역량</td><td>낮음</td><td>특수 환경 전문 지식</td></tr><tr><td>고급</td><td>7</td><td>최신 기술 트렌드</td><td>선택</td><td>기술 리더십</td><td>낮음</td><td>미래 지향적 설계</td></tr></tbody></table><hr><h2 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h2><blockquote><p>이 표는 Transactional Outbox 패턴의 핵심 용어와 실무 적용 가능성을 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>핵심</td><td>Outbox Table</td><td>발행 대기 중인 이벤트를 임시 저장하는 테이블</td><td>Event Store, Message Queue</td><td>패턴 구현의 핵심 저장소</td></tr><tr><td>핵심</td><td>Message Relay</td><td>Outbox를 폴링하여 메시지 브로커로 이벤트를 전달하는 서비스</td><td>Event Publisher, Message Broker</td><td>이벤트 전달의 핵심 컴포넌트</td></tr><tr><td>핵심</td><td>Dual Write Problem</td><td>두 개의 다른 시스템에 동시에 쓰기 작업을 수행할 때 일관성 문제</td><td>Distributed Transaction, ACID</td><td>패턴 도입의 주요 동기</td></tr><tr><td>구현</td><td>Change Data Capture (CDC)</td><td>데이터베이스 변경 로그를 실시간으로 캡처하는 기술</td><td>Debezium, Binlog</td><td>고성능 이벤트 전달 구현</td></tr><tr><td>구현</td><td>Polling</td><td>주기적으로 데이터를 조회하는 방식</td><td>Scheduled Task, Cron Job</td><td>간단한 구현 방식</td></tr><tr><td>구현</td><td>Idempotency Key</td><td>중복 처리를 방지하기 위한 고유 식별자</td><td>Deduplication, Exactly-once</td><td>안전한 메시지 처리 보장</td></tr><tr><td>운영</td><td>At-least-once Delivery</td><td>메시지가 최소 한 번은 전달됨을 보장하는 방식</td><td>Message Guarantee, Reliability</td><td>신뢰성 있는 메시지 전달</td></tr><tr><td>운영</td><td>Dead Letter Queue (DLQ)</td><td>처리 실패한 메시지를 보관하는 큐</td><td>Error Handling, Retry Logic</td><td>장애 상황 대응</td></tr><tr><td>운영</td><td>Event Sourcing</td><td>상태 변경을 이벤트의 연속으로 저장하는 패턴</td><td>CQRS, Event Store</td><td>완전한 감사 추적</td></tr><tr><td>고급</td><td>Saga Pattern</td><td>분산 트랜잭션을 여러 단계로 나누어 처리하는 패턴</td><td>Orchestration, Choreography</td><td>복잡한 비즈니스 플로우</td></tr><tr><td>고급</td><td>Event Streaming</td><td>이벤트를 연속적인 스트림으로 처리하는 방식</td><td>Apache Kafka, Real-time Processing</td><td>대규모 이벤트 처리</td></tr></tbody></table><h2 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h2><ul><li><a href=https://martinfowler.com/articles/patterns-of-distributed-systems/transactional-outbox.html>Martin Fowler - Transactional Outbox</a></li><li><a href=https://debezium.io/documentation/>Debezium Documentation</a></li><li><a href=https://microservices.io/patterns/data/transactional-outbox.html>Microservices.io - Transactional Outbox Pattern</a></li><li><a href=https://netflixtechblog.com/what-is-event-sourcing-18d86ddce7f3>Netflix Technology Blog - Event Sourcing</a></li><li><a href=https://eng.uber.com/reliable-reprocessing/>Uber Engineering - Reliable Reprocessing</a></li><li><a href=https://aws.amazon.com/event-driven-architecture/>AWS Architecture Center - Event-driven Architecture</a></li><li><a href=https://cloud.google.com/eventarc/docs/event-driven-architectures>Google Cloud - Event-driven Architectures</a></li><li><a href=https://kafka.apache.org/documentation/>Apache Kafka Documentation</a></li><li><a href=https://docs.axoniq.io/reference-guide/>Axon Framework Reference Guide</a></li><li><a href=https://cloudevents.io/>CloudEvents Specification</a></li></ul><p>이것으로 Transactional Outbox 패턴에 대한 포괄적인 조사를 완료했습니다. 기초 개념부터 고급 주제까지 체계적으로 다뤄, 초심자도 이해하고 실무자가 바로 적용할 수 있도록 구성했습니다.</p><hr><h2 id=1단계-기본-분석-및-검증-2>1단계: 기본 분석 및 검증<a hidden class=anchor aria-hidden=true href=#1단계-기본-분석-및-검증-2>#</a></h2><h3 id=1-대표-태그>1. 대표 태그<a hidden class=anchor aria-hidden=true href=#1-대표-태그>#</a></h3><ul><li><strong>Transactional‑Outbox</strong></li><li><strong>Dual‑Write 해결</strong></li><li><strong>Event‑Driven Consistency</strong></li></ul><h3 id=2-분류-체계-검증-1>2. 분류 체계 검증<a hidden class=anchor aria-hidden=true href=#2-분류-체계-검증-1>#</a></h3><p>현재 분류 체계 “System Design > Distributed Systems > Distributed Transactions > Saga Pattern > Transactional Messaging” 내 위치는 매우 적절하며, 다음과 같은 이유로 타당합니다:</p><ul><li><strong>분산 시스템 설계</strong> 내에서 <strong>트랜잭션 일관성 확보</strong>의 전술적 방안이며,</li><li><strong>사가(Saga) 패턴</strong> 등과 상호 보완적인 맥락에서 사용되기 때문입니다.</li></ul><h3 id=3-핵심-요약-250자>3. 핵심 요약 (≤250자)<a hidden class=anchor aria-hidden=true href=#3-핵심-요약-250자>#</a></h3><p>Transactional Outbox는 동일 트랜잭션 내에서 비즈니스 데이터와 메시지를 저장하여 dual‑write 문제(데이터베이스와 메시지 브로커 간 불일치)를 방지합니다. 메시지는 아웃박스 테이블에 기록되며, 별도 프로세스가 이를 메시지 브로커로 전달해 최종적으로 비동기 일관성을 보장합니다. (<a href="https://microservices.io/patterns/data/transactional-outbox.html?utm_source=chatgpt.com" title="Pattern: Transactional outbox">microservices.io</a>, <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html?utm_source=chatgpt.com" title="Transactional outbox pattern - AWS Prescriptive Guidance">docs.aws.amazon.com</a>)</p><h3 id=4-전체-개요-및-학습-방향-400자>4. 전체 개요 및 학습 방향 (≤400자)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-및-학습-방향-400자>#</a></h3><p>Transactional Outbox 패턴은 분산 시스템에서 트랜잭션의 원자성(atomicity)을 유지하면서도 메시지 전달의 신뢰성을 확보하는 핵심 기법입니다. 이 패턴은 데이터베이스와 메시지 브로커 사이의 2PC(2‑Phase Commit) 의존도를 제거하고, 데이터 저장과 메시지 생성이 하나의 트랜잭션으로 처리되도록 합니다. 이후 Outbox에 기록된 메시지는 폴링 또는 CDC(Change Data Capture)를 통해 안정적으로 전송됩니다. 학습 방향은 첫째, 기본 개념과 문제 맥락 이해 → 실무 적용 아키텍처 설계 → 구현 및 운영 전략 이해 순으로 진행하는 것이 효과적입니다.</p><hr><p>필요하시면 2단계 이후 각 Phase별 심층 내용을 순차적으로 제공드리겠습니다. 어떤 Phase부터 진행할지 알려주시면 바로 착수하겠습니다.</p><p>좋습니다. 이제 <strong>2단계: 개념 체계화 및 검증</strong>을 진행하겠습니다. 이 단계는 실무적 이해 기반을 다지기 위해 <strong>Transactional Outbox</strong>의 핵심 개념과 그 상호작용을 이론적/실무적으로 정리하는 단계입니다.</p><hr><h2 id=2단계-개념-체계화-및-검증-2>2단계: 개념 체계화 및 검증<a hidden class=anchor aria-hidden=true href=#2단계-개념-체계화-및-검증-2>#</a></h2><hr><h3 id=5-핵심-개념-정리-1>5. 핵심 개념 정리<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-정리-1>#</a></h3><p>다음 표는 Transactional Outbox의 필수 개념을 <strong>이론/실무/기본/심화</strong> 관점으로 체계적으로 정리한 것입니다.</p><blockquote><p>이 표는 Transactional Outbox와 관련된 핵심 개념들을 계층적으로 정리하여 개념 간의 상호관계 및 학습 우선순위를 도출하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1> 1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2> 2</a>
</span><span class=lnt id=hl-44-3><a class=lnlinks href=#hl-44-3> 3</a>
</span><span class=lnt id=hl-44-4><a class=lnlinks href=#hl-44-4> 4</a>
</span><span class=lnt id=hl-44-5><a class=lnlinks href=#hl-44-5> 5</a>
</span><span class=lnt id=hl-44-6><a class=lnlinks href=#hl-44-6> 6</a>
</span><span class=lnt id=hl-44-7><a class=lnlinks href=#hl-44-7> 7</a>
</span><span class=lnt id=hl-44-8><a class=lnlinks href=#hl-44-8> 8</a>
</span><span class=lnt id=hl-44-9><a class=lnlinks href=#hl-44-9> 9</a>
</span><span class=lnt id=hl-44-10><a class=lnlinks href=#hl-44-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분     | 개념                             | 정의 및 설명                                                                 | 관련 개념                        | 실무 중요도 |
</span></span><span class=line><span class=cl>|----------|----------------------------------|------------------------------------------------------------------------------|----------------------------------|-------------|
</span></span><span class=line><span class=cl>| 기본     | Dual-write 문제                  | DB와 메시지 브로커에 각각 쓰기가 성공/실패할 경우 데이터 불일치 위험             | 트랜잭션, Eventual Consistency   | ★★★★★        |
</span></span><span class=line><span class=cl>| 기본     | Outbox 테이블                    | 메시지를 별도 테이블에 기록하여 메시지 브로커와의 비동기 연동을 지원             | DB 트랜잭션, Polling             | ★★★★★        |
</span></span><span class=line><span class=cl>| 기본     | Polling Publisher                | Outbox 테이블에서 메시지를 읽어 브로커에 퍼블리시하는 백그라운드 프로세스        | Message Broker, Scheduler        | ★★★★☆        |
</span></span><span class=line><span class=cl>| 이론     | 트랜잭션 경계 (Transaction Boundary) | DB 트랜잭션 내에서 Outbox와 비즈니스 데이터를 함께 커밋해야 함                     | ACID, 원자성(Atomicity)         | ★★★★★        |
</span></span><span class=line><span class=cl>| 실무     | Change Data Capture (CDC)        | DB의 변경 이력을 기반으로 메시지를 추출하고 브로커로 전달하는 방식               | Debezium, Kafka Connect          | ★★★★☆        |
</span></span><span class=line><span class=cl>| 심화     | Exactly-Once 메시지 전송 보장    | 중복 전송 또는 유실 없이 메시지를 한번만 전달하는 아키텍처 구현                    | Idempotency, Kafka Transaction   | ★★★★☆        |
</span></span><span class=line><span class=cl>| 심화     | Outbox 메시지 상태 관리           | 메시지 전송 여부(예: pending, sent, failed)를 기록하여 상태 추적                   | 상태머신, 재전송 전략            | ★★★★☆        |
</span></span><span class=line><span class=cl>| 심화     | Retry &amp; Dead Letter Handling     | 실패한 메시지를 재전송하거나 처리 불가 시 대체 저장소로 이동                        | DLQ (Dead Letter Queue)          | ★★★★☆        |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=6-실무-연관성-분석-1>6. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#6-실무-연관성-분석-1>#</a></h3><p>Transactional Outbox는 특히 <strong>이벤트 기반 마이크로서비스 아키텍처</strong>, <strong>CQRS(Command Query Responsibility Segregation)</strong>, <strong>비동기 워크플로우</strong>에서 다음과 같은 실무적 이점을 제공합니다:</p><table><thead><tr><th>실무 시나리오</th><th>적용 예시</th><th>Transactional Outbox 사용 이유</th><th>결과</th></tr></thead><tbody><tr><td>주문 처리 시스템 (Order Service)</td><td>Kafka 사용</td><td>주문 DB 저장 후 &ldquo;주문 생성됨&rdquo; 메시지를 Outbox로 기록 → Kafka 전송</td><td>이벤트 유실 없음</td></tr><tr><td>결제 연동 시스템 (Payment Service)</td><td>RabbitMQ 사용</td><td>결제 완료 DB 트랜잭션과 함께 Outbox에 메시지 저장</td><td>이중 쓰기 방지</td></tr><tr><td>재고 시스템과 비동기 동기화</td><td>CDC 연동</td><td>Outbox 테이블 기반 Kafka Connect로 재고 변경 이벤트 발행</td><td>DB-브로커 일관성 확보</td></tr></tbody></table><hr><p>다음은 <strong>Phase 1-2: 기초 개념 및 핵심 원리 조사</strong>로 이어집니다.
우선 Phase 1부터 시작해 상세 조사를 이어가겠습니다.</p><hr><h2 id=-다음-단계-예고>🔍 다음 단계 예고<a hidden class=anchor aria-hidden=true href=#-다음-단계-예고>#</a></h2><ul><li>✅ Phase 1: 기초 개념 (개념 정의, 등장 배경, 필요성, 기술적 차별점)</li><li>⏳ Phase 2: 핵심 원리 (설계 철학, 동작 메커니즘, 아키텍처 구조, 역할)</li></ul><hr><p>바로 <strong>Phase 1</strong>로 이어서 진행하겠습니다.</p><h2 id=-phase-1-기초-개념-foundation-understanding>✅ Phase 1: 기초 개념 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#-phase-1-기초-개념-foundation-understanding>#</a></h2><hr><h3 id=11-개념-정의-및-본질적-이해-2>1.1 개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#11-개념-정의-및-본질적-이해-2>#</a></h3><p><strong>Transactional Outbox</strong> 패턴은 다음과 같이 정의됩니다:</p><blockquote><p>&ldquo;애플리케이션이 <strong>하나의 로컬 트랜잭션</strong> 내에서 비즈니스 상태 변경과 <strong>이벤트 메시지를 Outbox 테이블에 함께 기록</strong>한 뒤, 이 메시지를 별도의 프로세스(Publisher 또는 CDC)를 통해 <strong>메시지 브로커에 전송</strong>함으로써 분산 트랜잭션 없이도 <strong>데이터 일관성</strong>을 유지하는 패턴&rdquo;</p></blockquote><p>즉, 데이터베이스에 저장되는 주 도메인 이벤트와 메시지 전송을 분리하지 않고 함께 커밋함으로써 <strong>atomicity</strong>를 유지합니다.</p><hr><h3 id=12-등장-배경-및-발전-과정-2>1.2 등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#12-등장-배경-및-발전-과정-2>#</a></h3><table><thead><tr><th>구분</th><th>주요 내용</th></tr></thead><tbody><tr><td>배경</td><td>분산 시스템에서 비동기 이벤트 기반 통신을 사용할 때, 이벤트 메시지를 메시지 브로커에 전송하는 것과 DB 업데이트 간에 <strong>불일치 문제가 발생</strong></td></tr><tr><td>문제</td><td>두 개의 시스템(DB, Broker) 간 dual-write 시 하나가 실패하면 <strong>데이터 불일치, 메시지 유실, 중복 처리</strong> 발생</td></tr><tr><td>과거 대안</td><td>2PC (2-Phase Commit) 사용했지만 성능 저하 및 복잡성, 지원 미비 문제</td></tr><tr><td>발전 방향</td><td>단일 로컬 트랜잭션에서 비즈니스 데이터와 메시지를 함께 기록하는 Outbox 패턴 등장</td></tr><tr><td>현대적 확장</td><td>CDC(Change Data Capture) 기술과 Kafka Connect, Debezium과의 통합으로 실시간성과 신뢰성 강화</td></tr></tbody></table><hr><h3 id=13-핵심-목적-및-필요성-문제-해결-관점-2>1.3 핵심 목적 및 필요성 (문제 해결 관점)<a hidden class=anchor aria-hidden=true href=#13-핵심-목적-및-필요성-문제-해결-관점-2>#</a></h3><table><thead><tr><th>목적</th><th>설명</th></tr></thead><tbody><tr><td><strong>Dual-write 방지</strong></td><td>DB와 메시지 브로커에 각각 쓰는 과정에서 발생하는 불일치 제거</td></tr><tr><td><strong>일관성 보장</strong></td><td>Outbox에 메시지를 함께 저장하여 트랜잭션 단위의 원자성 확보</td></tr><tr><td><strong>확장성 있는 비동기 아키텍처 구현</strong></td><td>마이크로서비스 간 이벤트 기반 통신의 안정성 강화</td></tr><tr><td><strong>2PC 의존 제거</strong></td><td>성능/복잡성 문제를 갖는 분산 트랜잭션 대신 단순한 트랜잭션 모델 제공</td></tr></tbody></table><hr><h3 id=14-주요-특징-및-차별점-기술적-근거-포함-1>1.4 주요 특징 및 차별점 (기술적 근거 포함)<a hidden class=anchor aria-hidden=true href=#14-주요-특징-및-차별점-기술적-근거-포함-1>#</a></h3><table><thead><tr><th>특징</th><th>설명</th><th>기술적 근거</th></tr></thead><tbody><tr><td><strong>단일 트랜잭션 커밋</strong></td><td>비즈니스 데이터와 메시지를 같은 트랜잭션으로 커밋</td><td>ACID 트랜잭션 기반</td></tr><tr><td><strong>비동기 전송</strong></td><td>Outbox 테이블에 쓰고, 이후 메시지 브로커로 전송</td><td>Publisher/CDC 기반</td></tr><tr><td><strong>Idempotency 구현 용이</strong></td><td>메시지 중복에 대비해 메시지 ID로 중복 방지 가능</td><td>메시지 키 기반 처리</td></tr><tr><td><strong>메시지 신뢰도 향상</strong></td><td>메시지 유실 없음 (DB와 함께 저장되므로)</td><td>durable storage 보장</td></tr><tr><td><strong>2PC 불필요</strong></td><td>외부 트랜잭션 관리 필요 없음</td><td>애플리케이션 레벨 일관성 확보</td></tr></tbody></table><hr><p>📌 <strong>요약 다이어그램: Dual-write vs. Transactional Outbox</strong></p><pre class=mermaid>flowchart TD
    subgraph Dual-Write Problem
        A1[Service 처리] --&gt; B1[DB 저장]
        A1 --&gt; C1[Message Broker 발송]
        B1 -.실패시 문제.-&gt; C1
        C1 -.실패시 문제.-&gt; B1
    end

    subgraph Transactional Outbox
        A2[Service 처리] --&gt; B2[DB + Outbox 테이블에 같이 저장]
        B2 --&gt; C2[Publisher or CDC]
        C2 --&gt; D2[Message Broker 발송]
    end
</pre><hr><p>좋습니다. 이제 **Phase 2: 핵심 원리 (Core Theory)**에 대한 심층 조사를 시작하겠습니다.</p><hr><h2 id=-phase-2-핵심-원리-core-theory>✅ Phase 2: 핵심 원리 (Core Theory)<a hidden class=anchor aria-hidden=true href=#-phase-2-핵심-원리-core-theory>#</a></h2><hr><h3 id=21-핵심-설계-원칙-및-철학-2>2.1 핵심 설계 원칙 및 철학<a hidden class=anchor aria-hidden=true href=#21-핵심-설계-원칙-및-철학-2>#</a></h3><p>Transactional Outbox는 다음과 같은 <strong>설계 원칙과 철학</strong>에 기반하여 설계됩니다:</p><table><thead><tr><th>설계 원칙</th><th>설명</th><th>목적</th></tr></thead><tbody><tr><td><strong>Atomicity 우선</strong></td><td>도메인 상태 변경과 메시지 기록을 하나의 트랜잭션으로 처리</td><td>일관성 확보, 유실 방지</td></tr><tr><td><strong>비동기 처리 원칙</strong></td><td>메시지 전송은 트랜잭션 외부에서 별도 수행</td><td>성능 향상, 서비스 분리</td></tr><tr><td><strong>명시적 메시지 저장소 사용</strong></td><td>메시지를 DB 내 Outbox 테이블에 명시적으로 저장</td><td>추적 가능성, 장애 대응</td></tr><tr><td><strong>재시도 및 역추적 가능성 확보</strong></td><td>실패 시 재처리, 실패 메시지 저장 등 회복 가능성 확보</td><td>신뢰성 향상</td></tr><tr><td><strong>분리된 전송 책임 (Separation of Concerns)</strong></td><td>애플리케이션 로직과 메시지 전송 책임 분리</td><td>구조화, 유지보수성 강화</td></tr></tbody></table><hr><h3 id=22-기본-원리-및-동작-메커니즘-1>2.2 기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#22-기본-원리-및-동작-메커니즘-1>#</a></h3><p>다음은 Transactional Outbox가 동작하는 기본 흐름을 도식과 함께 설명한 것입니다.</p><h4 id=-기본-동작-메커니즘>🧠 기본 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#-기본-동작-메커니즘>#</a></h4><pre class=mermaid>sequenceDiagram
    participant Client
    participant Service
    participant DB
    participant OutboxPublisher
    participant MessageBroker

    Client-&gt;&gt;Service: Create Order
    Service-&gt;&gt;DB: BEGIN TRANSACTION
    Service-&gt;&gt;DB: Insert Order
    Service-&gt;&gt;DB: Insert Event to Outbox
    Service-&gt;&gt;DB: COMMIT TRANSACTION
    OutboxPublisher-&gt;&gt;DB: Poll Outbox
    OutboxPublisher-&gt;&gt;MessageBroker: Publish Event
    OutboxPublisher-&gt;&gt;DB: Mark Event as Sent
</pre><h4 id=핵심-절차>핵심 절차<a hidden class=anchor aria-hidden=true href=#핵심-절차>#</a></h4><ol><li><strong>비즈니스 로직 처리</strong>: 서비스가 Order와 같은 도메인 객체 저장</li><li><strong>이벤트 Outbox 기록</strong>: 같은 트랜잭션 내에서 이벤트도 Outbox 테이블에 저장</li><li><strong>트랜잭션 커밋</strong>: DB 트랜잭션 전체 커밋</li><li><strong>Publisher 또는 CDC</strong>가 Outbox 테이블을 읽고 메시지 브로커에 전달</li><li><strong>전송 완료 표시</strong> 또는 삭제</li></ol><hr><h3 id=23-아키텍처-및-구성-요소-2>2.3 아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#23-아키텍처-및-구성-요소-2>#</a></h3><blockquote><p>이 섹션은 Transactional Outbox 패턴의 <strong>구성 아키텍처와 각 요소의 역할</strong>을 시각적으로 설명합니다.</p></blockquote><h4 id=-아키텍처-다이어그램>🏗️ 아키텍처 다이어그램<a hidden class=anchor aria-hidden=true href=#-아키텍처-다이어그램>#</a></h4><pre class=mermaid>graph TD
    A[Application Service] --&gt;|Begin Transaction| B[(Database)]
    B --&gt; C[Outbox Table]
    B --&gt; D[Domain Data]
    E[Outbox Publisher / CDC] --&gt; C
    E --&gt; F[Message Broker (Kafka, RabbitMQ)]
    F --&gt; G[Consumer Microservice]
</pre><h4 id=-구성-요소-및-설명>🔧 구성 요소 및 설명<a hidden class=anchor aria-hidden=true href=#-구성-요소-및-설명>#</a></h4><table><thead><tr><th>구성 요소</th><th>설명</th><th>필수/선택</th></tr></thead><tbody><tr><td>Application Service</td><td>비즈니스 트랜잭션 수행</td><td>필수</td></tr><tr><td>Domain Table</td><td>도메인 데이터 (예: 주문, 결제) 저장</td><td>필수</td></tr><tr><td>Outbox Table</td><td>메시지 저장용 테이블</td><td>필수</td></tr><tr><td>Outbox Publisher</td><td>메시지를 읽어 브로커로 전송 (스케줄러 기반)</td><td>선택 (CDC 대체 가능)</td></tr><tr><td>CDC Connector</td><td>DB 로그 기반으로 이벤트 수집 (Debezium 등)</td><td>선택 (Publisher 대체 가능)</td></tr><tr><td>Message Broker</td><td>Kafka, RabbitMQ 등 이벤트 처리 채널</td><td>필수</td></tr><tr><td>Consumer</td><td>이벤트 처리 대상 서비스</td><td>필수</td></tr></tbody></table><hr><h3 id=24-주요-기능과-역할-2>2.4 주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#24-주요-기능과-역할-2>#</a></h3><table><thead><tr><th>기능</th><th>설명</th><th>담당 컴포넌트</th></tr></thead><tbody><tr><td>메시지 생성</td><td>비즈니스 이벤트를 Outbox에 저장</td><td>Application Service</td></tr><tr><td>트랜잭션 커밋</td><td>도메인 데이터와 메시지를 하나로 커밋</td><td>Database</td></tr><tr><td>메시지 추출</td><td>Outbox에서 메시지를 읽어옴</td><td>Publisher 또는 CDC</td></tr><tr><td>메시지 전송</td><td>브로커에 메시지를 발행</td><td>Publisher 또는 CDC</td></tr><tr><td>상태 갱신</td><td>메시지 전송 성공 여부 기록</td><td>Publisher 또는 CDC</td></tr><tr><td>메시지 소비</td><td>다운스트림 서비스가 메시지를 수신</td><td>Consumer</td></tr></tbody></table><hr><h3 id=-정리>🎯 정리<a hidden class=anchor aria-hidden=true href=#-정리>#</a></h3><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>동작 방식</td><td><strong>DB 트랜잭션에 메시지를 포함</strong>하고, 이후 <strong>비동기 전송</strong></td></tr><tr><td>핵심 구성</td><td>Application, DB(Outbox 포함), Publisher, Broker</td></tr><tr><td>일관성 보장</td><td>트랜잭션 내 원자적 기록 + 재시도 가능성</td></tr><tr><td>대체 방식</td><td>Polling Publisher 또는 CDC</td></tr></tbody></table><hr><p>좋습니다. 이제 **Phase 3: 특성 분석 (Characteristics Analysis)**을 진행하겠습니다.
이 단계에서는 <strong>Transactional Outbox</strong> 패턴의 장점과 단점, 트레이드오프, 성능 및 확장성 관점에서 실무적인 분석을 제공합니다.</p><hr><h2 id=-phase-3-특성-분석-characteristics-analysis>✅ Phase 3: 특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#-phase-3-특성-분석-characteristics-analysis>#</a></h2><hr><h3 id=31-장점-및-이점-2>3.1 장점 및 이점<a hidden class=anchor aria-hidden=true href=#31-장점-및-이점-2>#</a></h3><blockquote><p>이 표는 Transactional Outbox 패턴의 장점과 그 기술적 근거를 체계적으로 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-48-1><a class=lnlinks href=#hl-48-1>1</a>
</span><span class=lnt id=hl-48-2><a class=lnlinks href=#hl-48-2>2</a>
</span><span class=lnt id=hl-48-3><a class=lnlinks href=#hl-48-3>3</a>
</span><span class=lnt id=hl-48-4><a class=lnlinks href=#hl-48-4>4</a>
</span><span class=lnt id=hl-48-5><a class=lnlinks href=#hl-48-5>5</a>
</span><span class=lnt id=hl-48-6><a class=lnlinks href=#hl-48-6>6</a>
</span><span class=lnt id=hl-48-7><a class=lnlinks href=#hl-48-7>7</a>
</span><span class=lnt id=hl-48-8><a class=lnlinks href=#hl-48-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목                         | 설명                                                                 | 기술적 근거                                            | 실무 효과                         |
</span></span><span class=line><span class=cl>|------|------------------------------|----------------------------------------------------------------------|--------------------------------------------------------|----------------------------------|
</span></span><span class=line><span class=cl>| 장점 | 데이터 일관성 유지           | DB와 메시지를 하나의 트랜잭션으로 묶어 원자성 보장                   | ACID 트랜잭션의 Atomicity                              | 데이터 유실 없이 안정적 처리 가능 |
</span></span><span class=line><span class=cl>| 장점 | Dual-write 문제 해결         | 메시지 브로커와 DB에 따로 쓰지 않기 때문에 불일치 제거              | Outbox 테이블을 통해 메시지도 DB에 기록                | 이벤트 유실/중복 제거            |
</span></span><span class=line><span class=cl>| 장점 | 재시도 및 오류 복구 용이     | Outbox에 메시지가 남아 있기 때문에 실패 시 재전송 가능              | 메시지 상태 컬럼(pending/sent/failed 등) 사용 가능      | 운영 중 오류 대응성 강화         |
</span></span><span class=line><span class=cl>| 장점 | 분산 트랜잭션(2PC) 불필요     | 외부 시스템 간 트랜잭션이 아닌 로컬 트랜잭션으로 일관성 보장         | 2PC 대신 로컬 트랜잭션 + 비동기 처리 사용               | 성능 향상, 복잡도 감소           |
</span></span><span class=line><span class=cl>| 장점 | 메시지 브로커 유연성 확보     | 브로커 종류(Kafka, RabbitMQ 등)와 무관하게 적용 가능                | 브로커는 트랜잭션 외부에 존재                          | 브로커 교체 시에도 적용 가능     |
</span></span><span class=line><span class=cl>| 장점 | 트래픽 급증에도 견고한 구조  | 메시지는 Outbox 테이블에 먼저 쌓이고 점진적으로 전송됨             | Backpressure 완화, 브로커 장애에도 시스템 지속 가능     | 고가용성 확보                    |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=32-단점-및-제약사항과-해결방안-2>3.2 단점 및 제약사항과 해결방안<a hidden class=anchor aria-hidden=true href=#32-단점-및-제약사항과-해결방안-2>#</a></h3><h4 id=단점-분석표><strong>단점 분석표</strong><a hidden class=anchor aria-hidden=true href=#단점-분석표>#</a></h4><blockquote><p>이 표는 Transactional Outbox 패턴의 단점과 제약사항, 그리고 해결방안을 종합적으로 분석하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1>1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2>2</a>
</span><span class=lnt id=hl-49-3><a class=lnlinks href=#hl-49-3>3</a>
</span><span class=lnt id=hl-49-4><a class=lnlinks href=#hl-49-4>4</a>
</span><span class=lnt id=hl-49-5><a class=lnlinks href=#hl-49-5>5</a>
</span><span class=lnt id=hl-49-6><a class=lnlinks href=#hl-49-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목                       | 설명                                                            | 해결책                                           | 대안 기술                  |
</span></span><span class=line><span class=cl>|------|----------------------------|-----------------------------------------------------------------|--------------------------------------------------|----------------------------|
</span></span><span class=line><span class=cl>| 단점 | DB 부하 증가               | Outbox 테이블 접근이 증가하면서 DB I/O 부하가 커질 수 있음      | 인덱스 최적화, TTL 설정, 파티셔닝 적용           | Kafka Transactional Producer |
</span></span><span class=line><span class=cl>| 단점 | 메시지 지연 발생 가능      | 메시지 발송이 즉시 일어나지 않고 polling이나 CDC를 기다림      | polling 간격 최적화, 실시간 CDC 적용            | Outbox+Inbox 방식           |
</span></span><span class=line><span class=cl>| 단점 | 메시지 중복 전송 가능성    | 중복 전송 시 idempotent 처리 필요                               | 메시지 ID로 중복 방지, Consuming 측 처리 강화   | Kafka exactly-once delivery |
</span></span><span class=line><span class=cl>| 단점 | 구현 및 운영 복잡도 증가   | Outbox 테이블, Publisher 프로세스, 상태 관리 등 구성요소 증가   | 표준화된 구성 적용 (ex. Debezium + Kafka Connect)| Choreography 기반 설계       |
</span></span></code></pre></td></tr></table></div></div><h4 id=문제점-분석표><strong>문제점 분석표</strong><a hidden class=anchor aria-hidden=true href=#문제점-분석표>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-50-1><a class=lnlinks href=#hl-50-1>1</a>
</span><span class=lnt id=hl-50-2><a class=lnlinks href=#hl-50-2>2</a>
</span><span class=lnt id=hl-50-3><a class=lnlinks href=#hl-50-3>3</a>
</span><span class=lnt id=hl-50-4><a class=lnlinks href=#hl-50-4>4</a>
</span><span class=lnt id=hl-50-5><a class=lnlinks href=#hl-50-5>5</a>
</span><span class=lnt id=hl-50-6><a class=lnlinks href=#hl-50-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분   | 항목                      | 원인                                | 영향                          | 탐지/진단              | 예방 방법                        | 해결 기법                      |
</span></span><span class=line><span class=cl>|--------|---------------------------|-------------------------------------|-------------------------------|------------------------|----------------------------------|--------------------------------|
</span></span><span class=line><span class=cl>| 문제점 | 메시지 중복 처리          | Publisher 재시도 중 중복 발생       | Consumer 로직 오류 가능성     | 메시지 ID 중복 여부 확인 | Idempotent Consumer 설계        | 메시지 deduplication            |
</span></span><span class=line><span class=cl>| 문제점 | Outbox 테이블 과대 성장   | TTL 미설정 또는 상태 미관리         | DB 성능 저하, 스토리지 낭비   | 테이블 크기 모니터링    | 상태 관리 및 주기적 정리 작업   | TTL 적용, 아카이빙              |
</span></span><span class=line><span class=cl>| 문제점 | 지연 전송 (Latency)       | polling 주기 너무 길거나 CDC 지연  | 사용자 응답 지연               | 전송 시간 지표 수집     | polling 주기 조정, 실시간 CDC    | Debezium, Kafka Connect         |
</span></span><span class=line><span class=cl>| 문제점 | 장애 시 누락 메시지 발생 | Publisher 중단, CDC 오류            | 메시지 유실로 시스템 불일치    | 미전송 메시지 탐지       | 상태 기반 재처리 로직 도입       | 메시지 상태 체크 및 Retry Queue |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=33-트레이드오프-관계-분석-2>3.3 트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#33-트레이드오프-관계-분석-2>#</a></h3><table><thead><tr><th>항목</th><th>선택 시 이점</th><th>대가 또는 제약</th></tr></thead><tbody><tr><td>Outbox 테이블 사용</td><td>메시지 유실 없음, 트랜잭션 일관성 보장</td><td>DB 부하 증가, 운영 복잡성 증가</td></tr><tr><td>Polling 기반 전송</td><td>구현이 단순하고 제어 용이</td><td>메시지 지연, 스케일링 한계</td></tr><tr><td>CDC 기반 전송</td><td>지연 최소화, 실시간 처리 가능</td><td>외부 시스템 의존성 증가, 설정 복잡도</td></tr><tr><td>메시지 상태 관리</td><td>재전송 가능, 문제 추적 용이</td><td>테이블 복잡도 및 상태 동기화 필요</td></tr></tbody></table><hr><h3 id=34-성능-특성-및-확장성-분석-2>3.4 성능 특성 및 확장성 분석<a hidden class=anchor aria-hidden=true href=#34-성능-특성-및-확장성-분석-2>#</a></h3><table><thead><tr><th>분석 항목</th><th>평가</th><th>설명</th></tr></thead><tbody><tr><td>트랜잭션 처리 성능</td><td>중</td><td>Outbox 테이블 쓰기가 추가되므로 약간의 비용 발생</td></tr><tr><td>메시지 전송 처리량</td><td>상</td><td>Publisher 또는 CDC를 수평 확장 가능</td></tr><tr><td>확장성</td><td>상</td><td>메시지 처리 모듈과 Outbox 테이블은 독립 확장 가능</td></tr><tr><td>안정성 및 장애 복구</td><td>상</td><td>메시지 상태 기반 재처리 로직으로 높은 신뢰성 확보</td></tr></tbody></table><hr><h3 id=-요약>🧩 요약<a hidden class=anchor aria-hidden=true href=#-요약>#</a></h3><table><thead><tr><th>항목</th><th>핵심 내용</th></tr></thead><tbody><tr><td>장점</td><td>데이터 일관성 보장, Dual-write 해결, 장애 복원력 우수</td></tr><tr><td>단점</td><td>DB 부하, 지연 가능성, 복잡한 운영</td></tr><tr><td>트레이드오프</td><td>일관성 vs. 실시간성, 단순 구현 vs. 운영 비용</td></tr><tr><td>확장성</td><td>수평 확장 및 장애 복원성이 뛰어남</td></tr></tbody></table><hr><p>좋습니다. 이어서 <strong>Phase 4: 구현 및 분류 (Implementation & Classification)</strong> 단계로 진행하겠습니다.
이 단계는 <strong>Transactional Outbox 패턴을 실무에서 구현하는 방법</strong>, <strong>유형 분류</strong>, <strong>사용 도구</strong>, <strong>표준 준수 여부</strong> 등을 체계적으로 분석하는 구간입니다.</p><hr><h2 id=-phase-4-구현-및-분류-implementation--classification>✅ Phase 4: 구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#-phase-4-구현-및-분류-implementation--classification>#</a></h2><hr><h3 id=41-구현-기법-및-방법-2>4.1 구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#41-구현-기법-및-방법-2>#</a></h3><blockquote><p>이 섹션은 Transactional Outbox를 어떻게 실무에서 구현할 수 있는지를 설명하고, 각 기법의 구성, 목적, 예시를 제공합니다.</p></blockquote><table><thead><tr><th>구현 방식</th><th>구성 요소</th><th>목적</th><th>설명</th><th>실무 예시</th></tr></thead><tbody><tr><td><strong>Polling 기반 Outbox Publisher</strong></td><td>Outbox 테이블, 배치 또는 스케줄러 프로세스</td><td>메시지를 주기적으로 추출 후 브로커에 전송</td><td>가장 일반적인 방식, 제어 쉬움</td><td>Kafka 기반 이벤트 시스템</td></tr><tr><td><strong>CDC 기반 전송 (Debezium)</strong></td><td>Debezium, Kafka Connect, Outbox 테이블</td><td>DB 트랜잭션 로그 기반으로 실시간 추출</td><td>실시간 이벤트 처리에 유리</td><td>Postgres + Kafka 시스템</td></tr><tr><td><strong>Transactional Write API</strong></td><td>서비스 코드 내 Outbox 메시지를 직접 Insert</td><td>도메인 변경 + 메시지를 같은 트랜잭션에 포함</td><td>Spring, NestJS, Django 등에서 구현 가능</td><td>Python or Java 기반 시스템</td></tr><tr><td><strong>Outbox 상태 관리 포함 방식</strong></td><td>상태 컬럼(pending/sent 등), 재처리 로직</td><td>전송 상태 추적 및 재전송 가능</td><td>장애 회복력 향상</td><td>고신뢰성이 요구되는 결제 시스템</td></tr></tbody></table><hr><h3 id=42-분류-기준에-따른-유형-구분-2>4.2 분류 기준에 따른 유형 구분<a hidden class=anchor aria-hidden=true href=#42-분류-기준에-따른-유형-구분-2>#</a></h3><blockquote><p>이 표는 구현 방식, 메시지 추출 방법, 일관성 전략 등의 기준에 따라 Transactional Outbox의 유형을 정리한 것입니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-51-1><a class=lnlinks href=#hl-51-1> 1</a>
</span><span class=lnt id=hl-51-2><a class=lnlinks href=#hl-51-2> 2</a>
</span><span class=lnt id=hl-51-3><a class=lnlinks href=#hl-51-3> 3</a>
</span><span class=lnt id=hl-51-4><a class=lnlinks href=#hl-51-4> 4</a>
</span><span class=lnt id=hl-51-5><a class=lnlinks href=#hl-51-5> 5</a>
</span><span class=lnt id=hl-51-6><a class=lnlinks href=#hl-51-6> 6</a>
</span><span class=lnt id=hl-51-7><a class=lnlinks href=#hl-51-7> 7</a>
</span><span class=lnt id=hl-51-8><a class=lnlinks href=#hl-51-8> 8</a>
</span><span class=lnt id=hl-51-9><a class=lnlinks href=#hl-51-9> 9</a>
</span><span class=lnt id=hl-51-10><a class=lnlinks href=#hl-51-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 분류 기준        | 유형                | 설명 | 특징 |
</span></span><span class=line><span class=cl>|------------------|---------------------|------|------|
</span></span><span class=line><span class=cl>| 전송 방식         | Polling 기반         | 일정 주기로 DB 조회 후 메시지 전송 | 구현 쉬움, 지연 발생 가능 |
</span></span><span class=line><span class=cl>|                  | CDC 기반             | WAL (Write-Ahead Log) 기반 메시지 추출 | 실시간 처리, 구성 복잡 |
</span></span><span class=line><span class=cl>| 메시지 처리 방식  | 직접 브로커 전송     | 코드에서 Outbox 읽고 브로커로 전송 | 단순하지만 유연성 떨어짐 |
</span></span><span class=line><span class=cl>|                  | Kafka Connect 사용   | Kafka Connector 통해 자동 전송 | 유지보수성 우수 |
</span></span><span class=line><span class=cl>| 메시지 상태 관리  | 상태 없음            | 기록만 하고 후속 관리 없음 | 단순하지만 재전송 어려움 |
</span></span><span class=line><span class=cl>|                  | 상태 기반 처리       | 상태 컬럼 기반 전송 관리 | 장애 대응 용이 |
</span></span><span class=line><span class=cl>| 일관성 수준       | At-least-once 전송   | 메시지 중복 가능성 있음 | 대부분의 시스템 기본값 |
</span></span><span class=line><span class=cl>|                  | Exactly-once 보장    | 중복 없이 단 1회만 전송 | Kafka Transaction 등 필요 |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=43-도구-및-프레임워크-생태계-2>4.3 도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#43-도구-및-프레임워크-생태계-2>#</a></h3><blockquote><p>이 표는 Transactional Outbox 구현을 지원하는 주요 오픈소스, 프레임워크, 클라우드 도구를 정리한 것입니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-52-1><a class=lnlinks href=#hl-52-1>1</a>
</span><span class=lnt id=hl-52-2><a class=lnlinks href=#hl-52-2>2</a>
</span><span class=lnt id=hl-52-3><a class=lnlinks href=#hl-52-3>3</a>
</span><span class=lnt id=hl-52-4><a class=lnlinks href=#hl-52-4>4</a>
</span><span class=lnt id=hl-52-5><a class=lnlinks href=#hl-52-5>5</a>
</span><span class=lnt id=hl-52-6><a class=lnlinks href=#hl-52-6>6</a>
</span><span class=lnt id=hl-52-7><a class=lnlinks href=#hl-52-7>7</a>
</span><span class=lnt id=hl-52-8><a class=lnlinks href=#hl-52-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 도구/프레임워크 | 설명 | 지원 범위 | 장점 | 실무 적용 예시 |
</span></span><span class=line><span class=cl>|-----------------|------|-----------|------|----------------|
</span></span><span class=line><span class=cl>| <span class=gs>**Debezium**</span>    | DB 변경 로그 기반 CDC 도구 | Kafka + Outbox | 실시간 처리, 확장성 우수 | PostgreSQL + Kafka |
</span></span><span class=line><span class=cl>| <span class=gs>**Kafka Connect**</span> | Kafka용 데이터 통합 프레임워크 | Debezium과 함께 사용 | 다양한 Connector 제공 | AWS MSK, Confluent |
</span></span><span class=line><span class=cl>| <span class=gs>**Spring Outbox Extension**</span> | Spring 기반 Outbox 구현 라이브러리 | Java 앱 | 트랜잭션 연동 용이 | Spring Boot 마이크로서비스 |
</span></span><span class=line><span class=cl>| <span class=gs>**Entity Framework Outbox**</span> | .NET 기반 Outbox 구현 도구 | C<span class=ni>#/EF</span> Core | ORM 기반 트랜잭션 연동 | .NET Core 시스템 |
</span></span><span class=line><span class=cl>| <span class=gs>**AWS DMS + DynamoDB Streams**</span> | CDC 및 메시지 스트리밍 | 클라우드 기반 | 서버리스로 확장성 뛰어남 | Serverless 아키텍처 |
</span></span><span class=line><span class=cl>| <span class=gs>**Temporal / Camunda**</span> | Outbox + Saga + Workflow 지원 | 고급 이벤트 기반 시스템 | 복잡한 보상 로직 구현 가능 | 장기 실행 트랜잭션 |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=44-표준-및-규격-준수사항-2>4.4 표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#44-표준-및-규격-준수사항-2>#</a></h3><table><thead><tr><th>표준</th><th>설명</th><th>Transactional Outbox에서의 적용</th></tr></thead><tbody><tr><td><strong>ACID</strong></td><td>원자성, 일관성, 격리성, 지속성</td><td>도메인 데이터 + 메시지를 함께 커밋</td></tr><tr><td><strong>Idempotency</strong></td><td>중복 전송에 대한 안전한 처리</td><td>메시지 키 사용, Consumer 쪽 처리 필수</td></tr><tr><td><strong>At-least-once / Exactly-once semantics</strong></td><td>메시지 전송 신뢰성 수준</td><td>기본적으로 at-least-once, 추가 설계로 exactly-once 가능</td></tr><tr><td><strong>CloudEvents</strong></td><td>이벤트 포맷 표준</td><td>메시지 구조 통합, 플랫폼 독립성 제공</td></tr><tr><td><strong>OpenTelemetry / Tracing</strong></td><td>추적 및 모니터링 표준</td><td>메시지 흐름을 추적할 수 있도록 Trace ID 포함 가능</td></tr></tbody></table><hr><h2 id=-정리-1>🧩 정리<a hidden class=anchor aria-hidden=true href=#-정리-1>#</a></h2><table><thead><tr><th>항목</th><th>요약</th></tr></thead><tbody><tr><td>구현 방식</td><td>Polling 기반, CDC 기반, 직접 전송 방식</td></tr><tr><td>분류 기준</td><td>메시지 전송 방식, 상태 관리 유무, 일관성 수준</td></tr><tr><td>생태계</td><td>Kafka, Debezium, Spring Outbox, AWS DMS 등 다양</td></tr><tr><td>표준 적용</td><td>ACID, Idempotency, CloudEvents 등 현대 아키텍처와 통합 가능</td></tr></tbody></table><hr><p>좋습니다. 이제 **Phase 5: 실무 적용 (Practical Application)**으로 넘어가겠습니다.
이 단계에서는 <strong>Transactional Outbox</strong>를 실제로 어떻게 구현하고 적용하는지, 코드 예제와 사례 중심으로 실무 감각을 익히는 데 초점을 맞춥니다.</p><hr><h2 id=-phase-5-실무-적용-practical-application>✅ Phase 5: 실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#-phase-5-실무-적용-practical-application>#</a></h2><hr><h3 id=51-실습-예제-및-코드-구현-2>5.1 실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#51-실습-예제-및-코드-구현-2>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-53-1><a class=lnlinks href=#hl-53-1> 1</a>
</span><span class=lnt id=hl-53-2><a class=lnlinks href=#hl-53-2> 2</a>
</span><span class=lnt id=hl-53-3><a class=lnlinks href=#hl-53-3> 3</a>
</span><span class=lnt id=hl-53-4><a class=lnlinks href=#hl-53-4> 4</a>
</span><span class=lnt id=hl-53-5><a class=lnlinks href=#hl-53-5> 5</a>
</span><span class=lnt id=hl-53-6><a class=lnlinks href=#hl-53-6> 6</a>
</span><span class=lnt id=hl-53-7><a class=lnlinks href=#hl-53-7> 7</a>
</span><span class=lnt id=hl-53-8><a class=lnlinks href=#hl-53-8> 8</a>
</span><span class=lnt id=hl-53-9><a class=lnlinks href=#hl-53-9> 9</a>
</span><span class=lnt id=hl-53-10><a class=lnlinks href=#hl-53-10>10</a>
</span><span class=lnt id=hl-53-11><a class=lnlinks href=#hl-53-11>11</a>
</span><span class=lnt id=hl-53-12><a class=lnlinks href=#hl-53-12>12</a>
</span><span class=lnt id=hl-53-13><a class=lnlinks href=#hl-53-13>13</a>
</span><span class=lnt id=hl-53-14><a class=lnlinks href=#hl-53-14>14</a>
</span><span class=lnt id=hl-53-15><a class=lnlinks href=#hl-53-15>15</a>
</span><span class=lnt id=hl-53-16><a class=lnlinks href=#hl-53-16>16</a>
</span><span class=lnt id=hl-53-17><a class=lnlinks href=#hl-53-17>17</a>
</span><span class=lnt id=hl-53-18><a class=lnlinks href=#hl-53-18>18</a>
</span><span class=lnt id=hl-53-19><a class=lnlinks href=#hl-53-19>19</a>
</span><span class=lnt id=hl-53-20><a class=lnlinks href=#hl-53-20>20</a>
</span><span class=lnt id=hl-53-21><a class=lnlinks href=#hl-53-21>21</a>
</span><span class=lnt id=hl-53-22><a class=lnlinks href=#hl-53-22>22</a>
</span><span class=lnt id=hl-53-23><a class=lnlinks href=#hl-53-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl><span class=gu>## 실습 예제 및 코드 구현
</span></span></span><span class=line><span class=cl><span class=gu></span>**학습 목표**:  
</span></span><span class=line><span class=cl><span class=k>-</span> Transactional Outbox 패턴의 실전 구현 방식을 이해하고 직접 테스트 가능한 구조 설계
</span></span><span class=line><span class=cl><span class=k>-</span> 메시지 유실 없이 트랜잭션 일관성을 유지하는 방식 체득
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gs>**시나리오**</span>:  
</span></span><span class=line><span class=cl>고객이 주문을 생성하면 주문 정보를 DB에 저장하고, Kafka로 &#34;OrderCreated&#34; 이벤트를 발행해야 함. 단, 주문 데이터와 이벤트는 **항상 같이 저장**되어야 하며, 메시지 유실이 없어야 함.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gs>**시스템 구성**</span>:  
</span></span><span class=line><span class=cl><span class=k>-</span> REST API (Flask)
</span></span><span class=line><span class=cl><span class=k>-</span> PostgreSQL (Outbox 테이블 포함)
</span></span><span class=line><span class=cl><span class=k>-</span> Kafka (비동기 메시징)
</span></span><span class=line><span class=cl><span class=k>-</span> Background Worker (Outbox Polling)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gs>**시스템 구성 다이어그램**</span>:
</span></span><span class=line><span class=cl>```mermaid
</span></span><span class=line><span class=cl>graph TB
</span></span><span class=line><span class=cl>    Client --&gt; API[Flask REST API]
</span></span><span class=line><span class=cl>    API --&gt; DB[(PostgreSQL)]
</span></span><span class=line><span class=cl>    DB --&gt; OT[Outbox Table]
</span></span><span class=line><span class=cl>    Worker[Polling Worker] --&gt; OT
</span></span><span class=line><span class=cl>    Worker --&gt; Kafka[Kafka Topic]
</span></span><span class=line><span class=cl>    Kafka --&gt; Consumer
</span></span></code></pre></td></tr></table></div></div><p><strong>Workflow</strong>:</p><ol><li>클라이언트가 <code>/orders</code> 엔드포인트로 주문 요청</li><li>Flask 애플리케이션이 <code>orders</code>와 <code>outbox</code> 테이블에 트랜잭션으로 INSERT</li><li>Background Worker가 <code>outbox</code> 테이블의 메시지를 Kafka에 전송</li><li>전송 성공 시 메시지 상태를 <code>SENT</code>로 업데이트</li></ol><p><strong>핵심 역할</strong>:</p><ul><li><strong>Transactional Outbox</strong>는 메시지를 <strong>도메인 데이터와 함께 안전하게 저장</strong>함으로써 이중 쓰기를 방지하고, <strong>이벤트 유실 없는 아키텍처</strong>를 실현</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 메시지 브로커 장애 또는 서버 예외 발생 시 메시지 유실 가능성 존재</li><li>도입 후: 메시지가 Outbox에 저장되므로, <strong>브로커 장애에도 안전하게 재전송 가능</strong></li></ul><p><strong>구현 예시 (Python + SQLAlchemy + Kafka)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-54-1><a class=lnlinks href=#hl-54-1> 1</a>
</span><span class=lnt id=hl-54-2><a class=lnlinks href=#hl-54-2> 2</a>
</span><span class=lnt id=hl-54-3><a class=lnlinks href=#hl-54-3> 3</a>
</span><span class=lnt id=hl-54-4><a class=lnlinks href=#hl-54-4> 4</a>
</span><span class=lnt id=hl-54-5><a class=lnlinks href=#hl-54-5> 5</a>
</span><span class=lnt id=hl-54-6><a class=lnlinks href=#hl-54-6> 6</a>
</span><span class=lnt id=hl-54-7><a class=lnlinks href=#hl-54-7> 7</a>
</span><span class=lnt id=hl-54-8><a class=lnlinks href=#hl-54-8> 8</a>
</span><span class=lnt id=hl-54-9><a class=lnlinks href=#hl-54-9> 9</a>
</span><span class=lnt id=hl-54-10><a class=lnlinks href=#hl-54-10>10</a>
</span><span class=lnt id=hl-54-11><a class=lnlinks href=#hl-54-11>11</a>
</span><span class=lnt id=hl-54-12><a class=lnlinks href=#hl-54-12>12</a>
</span><span class=lnt id=hl-54-13><a class=lnlinks href=#hl-54-13>13</a>
</span><span class=lnt id=hl-54-14><a class=lnlinks href=#hl-54-14>14</a>
</span><span class=lnt id=hl-54-15><a class=lnlinks href=#hl-54-15>15</a>
</span><span class=lnt id=hl-54-16><a class=lnlinks href=#hl-54-16>16</a>
</span><span class=lnt id=hl-54-17><a class=lnlinks href=#hl-54-17>17</a>
</span><span class=lnt id=hl-54-18><a class=lnlinks href=#hl-54-18>18</a>
</span><span class=lnt id=hl-54-19><a class=lnlinks href=#hl-54-19>19</a>
</span><span class=lnt id=hl-54-20><a class=lnlinks href=#hl-54-20>20</a>
</span><span class=lnt id=hl-54-21><a class=lnlinks href=#hl-54-21>21</a>
</span><span class=lnt id=hl-54-22><a class=lnlinks href=#hl-54-22>22</a>
</span><span class=lnt id=hl-54-23><a class=lnlinks href=#hl-54-23>23</a>
</span><span class=lnt id=hl-54-24><a class=lnlinks href=#hl-54-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># models.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>Column</span><span class=p>,</span> <span class=n>Integer</span><span class=p>,</span> <span class=n>String</span><span class=p>,</span> <span class=n>JSON</span><span class=p>,</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.ext.declarative</span> <span class=kn>import</span> <span class=n>declarative_base</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>enum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Base</span> <span class=o>=</span> <span class=n>declarative_base</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MessageStatus</span><span class=p>(</span><span class=n>enum</span><span class=o>.</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>PENDING</span> <span class=o>=</span> <span class=s2>&#34;PENDING&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>SENT</span> <span class=o>=</span> <span class=s2>&#34;SENT&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>FAILED</span> <span class=o>=</span> <span class=s2>&#34;FAILED&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&#34;orders&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>customer</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>amount</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Outbox</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s2>&#34;outbox&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>event_type</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>String</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>JSON</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Enum</span><span class=p>(</span><span class=n>MessageStatus</span><span class=p>),</span> <span class=n>default</span><span class=o>=</span><span class=n>MessageStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-55-1><a class=lnlinks href=#hl-55-1> 1</a>
</span><span class=lnt id=hl-55-2><a class=lnlinks href=#hl-55-2> 2</a>
</span><span class=lnt id=hl-55-3><a class=lnlinks href=#hl-55-3> 3</a>
</span><span class=lnt id=hl-55-4><a class=lnlinks href=#hl-55-4> 4</a>
</span><span class=lnt id=hl-55-5><a class=lnlinks href=#hl-55-5> 5</a>
</span><span class=lnt id=hl-55-6><a class=lnlinks href=#hl-55-6> 6</a>
</span><span class=lnt id=hl-55-7><a class=lnlinks href=#hl-55-7> 7</a>
</span><span class=lnt id=hl-55-8><a class=lnlinks href=#hl-55-8> 8</a>
</span><span class=lnt id=hl-55-9><a class=lnlinks href=#hl-55-9> 9</a>
</span><span class=lnt id=hl-55-10><a class=lnlinks href=#hl-55-10>10</a>
</span><span class=lnt id=hl-55-11><a class=lnlinks href=#hl-55-11>11</a>
</span><span class=lnt id=hl-55-12><a class=lnlinks href=#hl-55-12>12</a>
</span><span class=lnt id=hl-55-13><a class=lnlinks href=#hl-55-13>13</a>
</span><span class=lnt id=hl-55-14><a class=lnlinks href=#hl-55-14>14</a>
</span><span class=lnt id=hl-55-15><a class=lnlinks href=#hl-55-15>15</a>
</span><span class=lnt id=hl-55-16><a class=lnlinks href=#hl-55-16>16</a>
</span><span class=lnt id=hl-55-17><a class=lnlinks href=#hl-55-17>17</a>
</span><span class=lnt id=hl-55-18><a class=lnlinks href=#hl-55-18>18</a>
</span><span class=lnt id=hl-55-19><a class=lnlinks href=#hl-55-19>19</a>
</span><span class=lnt id=hl-55-20><a class=lnlinks href=#hl-55-20>20</a>
</span><span class=lnt id=hl-55-21><a class=lnlinks href=#hl-55-21>21</a>
</span><span class=lnt id=hl-55-22><a class=lnlinks href=#hl-55-22>22</a>
</span><span class=lnt id=hl-55-23><a class=lnlinks href=#hl-55-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>sessionmaker</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>models</span> <span class=kn>import</span> <span class=n>Order</span><span class=p>,</span> <span class=n>Outbox</span><span class=p>,</span> <span class=n>MessageStatus</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>database</span> <span class=kn>import</span> <span class=n>engine</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Session</span> <span class=o>=</span> <span class=n>sessionmaker</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/orders&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;POST&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_order</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span> <span class=o>=</span> <span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>order</span> <span class=o>=</span> <span class=n>Order</span><span class=p>(</span><span class=n>customer</span><span class=o>=</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;customer&#34;</span><span class=p>],</span> <span class=n>amount</span><span class=o>=</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;amount&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>outbox</span> <span class=o>=</span> <span class=n>Outbox</span><span class=p>(</span><span class=n>event_type</span><span class=o>=</span><span class=s2>&#34;OrderCreated&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>outbox</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Order created&#34;</span><span class=p>},</span> <span class=mi>201</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)},</span> <span class=mi>500</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-56-1><a class=lnlinks href=#hl-56-1> 1</a>
</span><span class=lnt id=hl-56-2><a class=lnlinks href=#hl-56-2> 2</a>
</span><span class=lnt id=hl-56-3><a class=lnlinks href=#hl-56-3> 3</a>
</span><span class=lnt id=hl-56-4><a class=lnlinks href=#hl-56-4> 4</a>
</span><span class=lnt id=hl-56-5><a class=lnlinks href=#hl-56-5> 5</a>
</span><span class=lnt id=hl-56-6><a class=lnlinks href=#hl-56-6> 6</a>
</span><span class=lnt id=hl-56-7><a class=lnlinks href=#hl-56-7> 7</a>
</span><span class=lnt id=hl-56-8><a class=lnlinks href=#hl-56-8> 8</a>
</span><span class=lnt id=hl-56-9><a class=lnlinks href=#hl-56-9> 9</a>
</span><span class=lnt id=hl-56-10><a class=lnlinks href=#hl-56-10>10</a>
</span><span class=lnt id=hl-56-11><a class=lnlinks href=#hl-56-11>11</a>
</span><span class=lnt id=hl-56-12><a class=lnlinks href=#hl-56-12>12</a>
</span><span class=lnt id=hl-56-13><a class=lnlinks href=#hl-56-13>13</a>
</span><span class=lnt id=hl-56-14><a class=lnlinks href=#hl-56-14>14</a>
</span><span class=lnt id=hl-56-15><a class=lnlinks href=#hl-56-15>15</a>
</span><span class=lnt id=hl-56-16><a class=lnlinks href=#hl-56-16>16</a>
</span><span class=lnt id=hl-56-17><a class=lnlinks href=#hl-56-17>17</a>
</span><span class=lnt id=hl-56-18><a class=lnlinks href=#hl-56-18>18</a>
</span><span class=lnt id=hl-56-19><a class=lnlinks href=#hl-56-19>19</a>
</span><span class=lnt id=hl-56-20><a class=lnlinks href=#hl-56-20>20</a>
</span><span class=lnt id=hl-56-21><a class=lnlinks href=#hl-56-21>21</a>
</span><span class=lnt id=hl-56-22><a class=lnlinks href=#hl-56-22>22</a>
</span><span class=lnt id=hl-56-23><a class=lnlinks href=#hl-56-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># worker.py (Outbox Publisher)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span><span class=o>,</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>models</span> <span class=kn>import</span> <span class=n>Outbox</span><span class=p>,</span> <span class=n>MessageStatus</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>sessionmaker</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>database</span> <span class=kn>import</span> <span class=n>engine</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Session</span> <span class=o>=</span> <span class=n>sessionmaker</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>producer</span> <span class=o>=</span> <span class=n>KafkaProducer</span><span class=p>(</span><span class=n>bootstrap_servers</span><span class=o>=</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span> <span class=o>=</span> <span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>messages</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>Outbox</span><span class=p>)</span><span class=o>.</span><span class=n>filter_by</span><span class=p>(</span><span class=n>status</span><span class=o>=</span><span class=n>MessageStatus</span><span class=o>.</span><span class=n>PENDING</span><span class=p>)</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>messages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;order-events&#34;</span><span class=p>,</span> <span class=n>msg</span><span class=o>.</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>MessageStatus</span><span class=o>.</span><span class=n>SENT</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=n>MessageStatus</span><span class=o>.</span><span class=n>FAILED</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-57-1><a class=lnlinks href=#hl-57-1> 1</a>
</span><span class=lnt id=hl-57-2><a class=lnlinks href=#hl-57-2> 2</a>
</span><span class=lnt id=hl-57-3><a class=lnlinks href=#hl-57-3> 3</a>
</span><span class=lnt id=hl-57-4><a class=lnlinks href=#hl-57-4> 4</a>
</span><span class=lnt id=hl-57-5><a class=lnlinks href=#hl-57-5> 5</a>
</span><span class=lnt id=hl-57-6><a class=lnlinks href=#hl-57-6> 6</a>
</span><span class=lnt id=hl-57-7><a class=lnlinks href=#hl-57-7> 7</a>
</span><span class=lnt id=hl-57-8><a class=lnlinks href=#hl-57-8> 8</a>
</span><span class=lnt id=hl-57-9><a class=lnlinks href=#hl-57-9> 9</a>
</span><span class=lnt id=hl-57-10><a class=lnlinks href=#hl-57-10>10</a>
</span><span class=lnt id=hl-57-11><a class=lnlinks href=#hl-57-11>11</a>
</span><span class=lnt id=hl-57-12><a class=lnlinks href=#hl-57-12>12</a>
</span><span class=lnt id=hl-57-13><a class=lnlinks href=#hl-57-13>13</a>
</span><span class=lnt id=hl-57-14><a class=lnlinks href=#hl-57-14>14</a>
</span><span class=lnt id=hl-57-15><a class=lnlinks href=#hl-57-15>15</a>
</span><span class=lnt id=hl-57-16><a class=lnlinks href=#hl-57-16>16</a>
</span><span class=lnt id=hl-57-17><a class=lnlinks href=#hl-57-17>17</a>
</span><span class=lnt id=hl-57-18><a class=lnlinks href=#hl-57-18>18</a>
</span><span class=lnt id=hl-57-19><a class=lnlinks href=#hl-57-19>19</a>
</span><span class=lnt id=hl-57-20><a class=lnlinks href=#hl-57-20>20</a>
</span><span class=lnt id=hl-57-21><a class=lnlinks href=#hl-57-21>21</a>
</span><span class=lnt id=hl-57-22><a class=lnlinks href=#hl-57-22>22</a>
</span><span class=lnt id=hl-57-23><a class=lnlinks href=#hl-57-23>23</a>
</span><span class=lnt id=hl-57-24><a class=lnlinks href=#hl-57-24>24</a>
</span><span class=lnt id=hl-57-25><a class=lnlinks href=#hl-57-25>25</a>
</span><span class=lnt id=hl-57-26><a class=lnlinks href=#hl-57-26>26</a>
</span><span class=lnt id=hl-57-27><a class=lnlinks href=#hl-57-27>27</a>
</span><span class=lnt id=hl-57-28><a class=lnlinks href=#hl-57-28>28</a>
</span><span class=lnt id=hl-57-29><a class=lnlinks href=#hl-57-29>29</a>
</span><span class=lnt id=hl-57-30><a class=lnlinks href=#hl-57-30>30</a>
</span><span class=lnt id=hl-57-31><a class=lnlinks href=#hl-57-31>31</a>
</span><span class=lnt id=hl-57-32><a class=lnlinks href=#hl-57-32>32</a>
</span><span class=lnt id=hl-57-33><a class=lnlinks href=#hl-57-33>33</a>
</span><span class=lnt id=hl-57-34><a class=lnlinks href=#hl-57-34>34</a>
</span><span class=lnt id=hl-57-35><a class=lnlinks href=#hl-57-35>35</a>
</span><span class=lnt id=hl-57-36><a class=lnlinks href=#hl-57-36>36</a>
</span><span class=lnt id=hl-57-37><a class=lnlinks href=#hl-57-37>37</a>
</span><span class=lnt id=hl-57-38><a class=lnlinks href=#hl-57-38>38</a>
</span><span class=lnt id=hl-57-39><a class=lnlinks href=#hl-57-39>39</a>
</span><span class=lnt id=hl-57-40><a class=lnlinks href=#hl-57-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### 5.2 실제 도입 사례
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; 실무에서 사용되는 사례를 통해 Transactional Outbox의 효과성을 검증합니다.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>| 기업/조직 | 적용 영역 | 효과 |
</span></span><span class=line><span class=cl>|-----------|-----------|------|
</span></span><span class=line><span class=cl>| **Uber** | 트립 상태 변경 이벤트 처리 | 메시지 유실 방지, 커넥터로 확장성 확보 |
</span></span><span class=line><span class=cl>| **Zalando** | 마이크로서비스 간 이벤트 연동 | 주문-배송 간 일관성 유지 |
</span></span><span class=line><span class=cl>| **Netflix** | 장기 실행 워크플로우 | 보상 트랜잭션 흐름에서 메시지 안정성 확보 |
</span></span><span class=line><span class=cl>| **Spotify** | 사용자 액션 이벤트 추적 | 실시간 이벤트 처리 + 복구 가능성 확보 |
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### 5.3 실제 도입 사례의 코드 구현
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```markdown
</span></span><span class=line><span class=cl>## 실제 도입 사례의 코드 구현
</span></span><span class=line><span class=cl>**사례 선정**: Zalando 주문-배송 아키텍처
</span></span><span class=line><span class=cl>**비즈니스 배경**: 
</span></span><span class=line><span class=cl>- 주문 생성 후 배송 시스템에 상태를 이벤트 기반으로 전달해야 함
</span></span><span class=line><span class=cl>- DB-Kafka 간 dual-write 문제 발생 가능성 존재
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>**기술적 요구사항**: 
</span></span><span class=line><span class=cl>- 메시지 유실 금지
</span></span><span class=line><span class=cl>- Kafka 전송 보장
</span></span><span class=line><span class=cl>- 서비스 간 느슨한 결합 유지
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>**시스템 구성**: 
</span></span><span class=line><span class=cl>- Order Service, PostgreSQL, Kafka, Outbox Polling Worker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>**시스템 구성 다이어그램**:
</span></span><span class=line><span class=cl>```mermaid
</span></span><span class=line><span class=cl>graph TB
</span></span><span class=line><span class=cl>    A[Order Service] --&gt; B[(PostgreSQL + Outbox)]
</span></span><span class=line><span class=cl>    B --&gt; C[Polling Worker]
</span></span><span class=line><span class=cl>    C --&gt; D[Kafka Topic: order-created]
</span></span><span class=line><span class=cl>    D --&gt; E[Shipping Service]
</span></span></code></pre></td></tr></table></div></div><p><strong>Workflow</strong>:</p><ol><li>주문 생성 → Outbox에 이벤트 저장</li><li>Kafka로 메시지 전송</li><li>배송 서비스에서 수신 및 처리</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Outbox는 메시지의 <strong>트랜잭션 일관성</strong>을 보장</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 메시지 유실, 시스템 불일치 발생</li><li>도입 후: 메시지 신뢰성 확보, 재처리 가능</li></ul><p><strong>구현 예시 (YAML - Kafka Connect Debezium 설정)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-58-1><a class=lnlinks href=#hl-58-1> 1</a>
</span><span class=lnt id=hl-58-2><a class=lnlinks href=#hl-58-2> 2</a>
</span><span class=lnt id=hl-58-3><a class=lnlinks href=#hl-58-3> 3</a>
</span><span class=lnt id=hl-58-4><a class=lnlinks href=#hl-58-4> 4</a>
</span><span class=lnt id=hl-58-5><a class=lnlinks href=#hl-58-5> 5</a>
</span><span class=lnt id=hl-58-6><a class=lnlinks href=#hl-58-6> 6</a>
</span><span class=lnt id=hl-58-7><a class=lnlinks href=#hl-58-7> 7</a>
</span><span class=lnt id=hl-58-8><a class=lnlinks href=#hl-58-8> 8</a>
</span><span class=lnt id=hl-58-9><a class=lnlinks href=#hl-58-9> 9</a>
</span><span class=lnt id=hl-58-10><a class=lnlinks href=#hl-58-10>10</a>
</span><span class=lnt id=hl-58-11><a class=lnlinks href=#hl-58-11>11</a>
</span><span class=lnt id=hl-58-12><a class=lnlinks href=#hl-58-12>12</a>
</span><span class=lnt id=hl-58-13><a class=lnlinks href=#hl-58-13>13</a>
</span><span class=lnt id=hl-58-14><a class=lnlinks href=#hl-58-14>14</a>
</span><span class=lnt id=hl-58-15><a class=lnlinks href=#hl-58-15>15</a>
</span><span class=lnt id=hl-58-16><a class=lnlinks href=#hl-58-16>16</a>
</span><span class=lnt id=hl-58-17><a class=lnlinks href=#hl-58-17>17</a>
</span><span class=lnt id=hl-58-18><a class=lnlinks href=#hl-58-18>18</a>
</span><span class=lnt id=hl-58-19><a class=lnlinks href=#hl-58-19>19</a>
</span><span class=lnt id=hl-58-20><a class=lnlinks href=#hl-58-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>kafka.strimzi.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>KafkaConnector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres-outbox-connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class=l>io.debezium.connector.postgresql.PostgresConnector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasksMax</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.hostname</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.port</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.user</span><span class=p>:</span><span class=w> </span><span class=l>debezium</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.password</span><span class=p>:</span><span class=w> </span><span class=l>dbz</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.dbname</span><span class=p>:</span><span class=w> </span><span class=l>orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>database.server.name</span><span class=p>:</span><span class=w> </span><span class=l>orderdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table.include.list</span><span class=p>:</span><span class=w> </span><span class=l>public.outbox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>topic.prefix</span><span class=p>:</span><span class=w> </span><span class=l>outbox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>transforms</span><span class=p>:</span><span class=w> </span><span class=l>route</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>transforms.route.type</span><span class=p>:</span><span class=w> </span><span class=l>org.apache.kafka.connect.transforms.RegexRouter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>transforms.route.regex</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;outbox&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>transforms.route.replacement</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;order-created&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li>성능 개선: Kafka TPS 1000건 이상 안정 처리</li><li>운영 효율성: 메시지 장애시 재처리로 다운스트림 영향 최소화</li><li>비용 절감: 복잡한 2PC 제거, 구성 간소화</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-59-1><a class=lnlinks href=#hl-59-1> 1</a>
</span><span class=lnt id=hl-59-2><a class=lnlinks href=#hl-59-2> 2</a>
</span><span class=lnt id=hl-59-3><a class=lnlinks href=#hl-59-3> 3</a>
</span><span class=lnt id=hl-59-4><a class=lnlinks href=#hl-59-4> 4</a>
</span><span class=lnt id=hl-59-5><a class=lnlinks href=#hl-59-5> 5</a>
</span><span class=lnt id=hl-59-6><a class=lnlinks href=#hl-59-6> 6</a>
</span><span class=lnt id=hl-59-7><a class=lnlinks href=#hl-59-7> 7</a>
</span><span class=lnt id=hl-59-8><a class=lnlinks href=#hl-59-8> 8</a>
</span><span class=lnt id=hl-59-9><a class=lnlinks href=#hl-59-9> 9</a>
</span><span class=lnt id=hl-59-10><a class=lnlinks href=#hl-59-10>10</a>
</span><span class=lnt id=hl-59-11><a class=lnlinks href=#hl-59-11>11</a>
</span><span class=lnt id=hl-59-12><a class=lnlinks href=#hl-59-12>12</a>
</span><span class=lnt id=hl-59-13><a class=lnlinks href=#hl-59-13>13</a>
</span><span class=lnt id=hl-59-14><a class=lnlinks href=#hl-59-14>14</a>
</span><span class=lnt id=hl-59-15><a class=lnlinks href=#hl-59-15>15</a>
</span><span class=lnt id=hl-59-16><a class=lnlinks href=#hl-59-16>16</a>
</span><span class=lnt id=hl-59-17><a class=lnlinks href=#hl-59-17>17</a>
</span><span class=lnt id=hl-59-18><a class=lnlinks href=#hl-59-18>18</a>
</span><span class=lnt id=hl-59-19><a class=lnlinks href=#hl-59-19>19</a>
</span><span class=lnt id=hl-59-20><a class=lnlinks href=#hl-59-20>20</a>
</span><span class=lnt id=hl-59-21><a class=lnlinks href=#hl-59-21>21</a>
</span><span class=lnt id=hl-59-22><a class=lnlinks href=#hl-59-22>22</a>
</span><span class=lnt id=hl-59-23><a class=lnlinks href=#hl-59-23>23</a>
</span><span class=lnt id=hl-59-24><a class=lnlinks href=#hl-59-24>24</a>
</span><span class=lnt id=hl-59-25><a class=lnlinks href=#hl-59-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### 5.4 통합 및 연계 기술 분석
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>| 연계 기술 | 설명 | 역할 |
</span></span><span class=line><span class=cl>|-----------|------|------|
</span></span><span class=line><span class=cl>| **Kafka** | 메시지 브로커 | 이벤트 전달 |
</span></span><span class=line><span class=cl>| **Debezium** | CDC 툴 | Outbox → Kafka 자동 전송 |
</span></span><span class=line><span class=cl>| **PostgreSQL** | 관계형 DB | 트랜잭션 저장소 및 Outbox 저장 |
</span></span><span class=line><span class=cl>| **Fluentd / Logstash** | 메시지 모니터링 | 이벤트 흐름 추적 |
</span></span><span class=line><span class=cl>| **OpenTelemetry** | 분산 추적 | Trace ID 전파로 메시지 흐름 가시화 |
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## 🔚 정리
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>| 항목 | 핵심 내용 |
</span></span><span class=line><span class=cl>|------|-----------|
</span></span><span class=line><span class=cl>| 실습 예제 | Flask + PostgreSQL + Kafka로 기본 패턴 구현 |
</span></span><span class=line><span class=cl>| 사례 분석 | Zalando, Uber, Netflix 등에서 실무 적용 |
</span></span><span class=line><span class=cl>| 실무 적용 방식 | Polling 또는 CDC 기반으로 구성 가능 |
</span></span><span class=line><span class=cl>| 연계 기술 | Kafka, Debezium, CDC, 트레이싱 도구 등 |
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span></code></pre></td></tr></table></div></div><p>좋습니다. 이번에는 <strong>Phase 6: 운영 및 최적화 (Operations & Optimization)</strong> 단계를 진행하겠습니다.
Transactional Outbox는 운영 중에도 <strong>데이터 일관성 유지, 모니터링, 장애 복구, 성능 유지</strong>가 중요합니다.</p><hr><h2 id=-phase-6-운영-및-최적화-operations--optimization>✅ Phase 6: 운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#-phase-6-운영-및-최적화-operations--optimization>#</a></h2><hr><h3 id=61-보안-및-거버넌스-2>6.1 보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#61-보안-및-거버넌스-2>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>권장 방안</th></tr></thead><tbody><tr><td>DB 보안</td><td>Outbox 테이블이 민감한 도메인 데이터 포함 시 접근 제어 필요</td><td>최소 권한 원칙 적용 (least privilege), 암호화</td></tr><tr><td>브로커 보안</td><td>Kafka/RabbitMQ에 전송되는 이벤트는 보안 고려 필요</td><td>TLS 암호화, SASL 인증, ACL 권한 제어</td></tr><tr><td>감사 추적</td><td>메시지 누락/변조 추적이 어려울 수 있음</td><td>Outbox → Kafka 전송 기록을 로깅하여 감사 로그 구축</td></tr><tr><td>데이터 삭제 정책</td><td>Outbox 메시지를 무한히 보관하면 문제 발생</td><td>메시지 전송 성공 시 TTL 정책 또는 soft delete 적용</td></tr></tbody></table><hr><h3 id=62-모니터링-및-관측성-observability>6.2 모니터링 및 관측성 (Observability)<a hidden class=anchor aria-hidden=true href=#62-모니터링-및-관측성-observability>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>적용 도구</th></tr></thead><tbody><tr><td>메시지 처리 상태</td><td><code>PENDING</code>, <code>SENT</code>, <code>FAILED</code> 등 상태 모니터링</td><td>Prometheus + Grafana, SQL 대시보드</td></tr><tr><td>Publisher 지연 감지</td><td>Publisher polling 주기 이상 시 지연 가능성 존재</td><td>Exporter로 polling 주기, 처리 시간 노출</td></tr><tr><td>메시지 전송 실패율</td><td>재시도 횟수, DLQ(Dead Letter Queue) 건수 모니터링</td><td>Kafka consumer lag, error metric 활용</td></tr><tr><td>End-to-End 추적</td><td>Outbox → Kafka → Consumer 전 구간 추적</td><td>OpenTelemetry, Jaeger, Zipkin</td></tr></tbody></table><h4 id=관측-메트릭-예시>관측 메트릭 예시<a hidden class=anchor aria-hidden=true href=#관측-메트릭-예시>#</a></h4><table><thead><tr><th>Metric</th><th>설명</th><th>임계값 예시</th></tr></thead><tbody><tr><td><code>outbox_messages_pending</code></td><td>처리 대기 메시지 수</td><td>100 이상이면 경고</td></tr><tr><td><code>outbox_message_latency_seconds</code></td><td>메시지 생성 → Kafka 전송 시간</td><td>2초 초과시 경고</td></tr><tr><td><code>outbox_retry_count</code></td><td>재전송 시도 횟수</td><td>5회 이상이면 DLQ 전환</td></tr><tr><td><code>kafka_delivery_failure_total</code></td><td>Kafka 전송 실패 총 횟수</td><td>0 유지 권장</td></tr></tbody></table><hr><h3 id=63-실무-적용-고려사항-및-주의점-2>6.3 실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#63-실무-적용-고려사항-및-주의점-2>#</a></h3><blockquote><p>이 표는 운영 환경에서 Transactional Outbox를 안정적으로 사용하기 위해 고려해야 할 사항과 주의사항을 정리하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-60-1><a class=lnlinks href=#hl-60-1>1</a>
</span><span class=lnt id=hl-60-2><a class=lnlinks href=#hl-60-2>2</a>
</span><span class=lnt id=hl-60-3><a class=lnlinks href=#hl-60-3>3</a>
</span><span class=lnt id=hl-60-4><a class=lnlinks href=#hl-60-4>4</a>
</span><span class=lnt id=hl-60-5><a class=lnlinks href=#hl-60-5>5</a>
</span><span class=lnt id=hl-60-6><a class=lnlinks href=#hl-60-6>6</a>
</span><span class=lnt id=hl-60-7><a class=lnlinks href=#hl-60-7>7</a>
</span><span class=lnt id=hl-60-8><a class=lnlinks href=#hl-60-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 항목 | 설명 | 권장사항 |
</span></span><span class=line><span class=cl>|------|------|----------|
</span></span><span class=line><span class=cl>| Outbox 테이블 크기 증가 | 전송 후에도 메시지가 남으면 성능 저하 | TTL 컬럼, scheduled cleanup 작업 필요 |
</span></span><span class=line><span class=cl>| 메시지 중복 전송 | 네트워크 장애 또는 재시도로 발생 가능성 | Consumer의 idempotency 필수 |
</span></span><span class=line><span class=cl>| Polling 타이밍 | 너무 짧으면 과도한 부하, 너무 길면 지연 | 시스템 처리량 기준 최적화 필요 |
</span></span><span class=line><span class=cl>| CDC 지연 문제 | Debezium이 지연될 경우 실시간성 저하 | Kafka Connect 모니터링 + Buffering 고려 |
</span></span><span class=line><span class=cl>| 장애 복구 전략 | 전송 실패 시 자동 복구 로직 필요 | 상태 기반 Retry 및 DLQ 구성 |
</span></span><span class=line><span class=cl>| 운영 자동화 | 장애 감지 및 알림, 재시작 등 자동화 필요 | Prometheus + Alertmanager, autoscaler 등 |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=64-성능-최적화-전략-및-고려사항-2>6.4 성능 최적화 전략 및 고려사항<a hidden class=anchor aria-hidden=true href=#64-성능-최적화-전략-및-고려사항-2>#</a></h3><blockquote><p>이 표는 Transactional Outbox 패턴에서 발생할 수 있는 성능 이슈를 해결하기 위한 전략과 고려사항을 제시하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-61-1><a class=lnlinks href=#hl-61-1>1</a>
</span><span class=lnt id=hl-61-2><a class=lnlinks href=#hl-61-2>2</a>
</span><span class=lnt id=hl-61-3><a class=lnlinks href=#hl-61-3>3</a>
</span><span class=lnt id=hl-61-4><a class=lnlinks href=#hl-61-4>4</a>
</span><span class=lnt id=hl-61-5><a class=lnlinks href=#hl-61-5>5</a>
</span><span class=lnt id=hl-61-6><a class=lnlinks href=#hl-61-6>6</a>
</span><span class=lnt id=hl-61-7><a class=lnlinks href=#hl-61-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 항목 | 설명 | 최적화 전략 |
</span></span><span class=line><span class=cl>|------|------|--------------|
</span></span><span class=line><span class=cl>| Outbox 테이블 쿼리 성능 | 상태 기반 조회의 빈도 증가 | 인덱스 최적화, 테이블 파티셔닝 |
</span></span><span class=line><span class=cl>| 메시지 전송 처리량 | 전송 프로세스 병목 가능성 | Polling 워커 수평 확장 |
</span></span><span class=line><span class=cl>| CDC 처리 지연 | Debezium 처리 속도 저하 | Kafka topic 파티셔닝 + Debezium tuning |
</span></span><span class=line><span class=cl>| 메시지 중복 전송 방지 | 중복으로 인한 consumer 부하 증가 | UUID 기반 메시지 ID + idempotent 처리 |
</span></span><span class=line><span class=cl>| 메시지 보관 정책 | 오래된 메시지 처리로 DB 부담 증가 | TTL 기반 자동 삭제 또는 아카이빙 |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=-요약-1>🧩 요약<a hidden class=anchor aria-hidden=true href=#-요약-1>#</a></h3><table><thead><tr><th>항목</th><th>요약 내용</th></tr></thead><tbody><tr><td>보안</td><td>Outbox와 메시지 브로커 모두 최소 권한/암호화 적용</td></tr><tr><td>모니터링</td><td>메시지 상태, 처리 시간, 실패율 등 지표 수집 필수</td></tr><tr><td>운영 고려사항</td><td>TTL, 재시도 로직, idempotency, 자동화 전략 필요</td></tr><tr><td>성능 최적화</td><td>인덱스 튜닝, 수평 확장, CDC 튜닝, 파티셔닝 적용</td></tr></tbody></table><hr><p>좋습니다. 마지막 단계인 **Phase 7: 고급 주제 및 최신 트렌드 (Advanced Topics)**를 진행하겠습니다.
이 단계에서는 실무에서 맞닥뜨리는 <strong>복잡한 기술 과제</strong>, <strong>연관 생태계</strong>, <strong>기술 트렌드</strong>와 향후 방향성을 다룹니다.</p><hr><h2 id=-phase-7-고급-주제-advanced-topics>✅ Phase 7: 고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#-phase-7-고급-주제-advanced-topics>#</a></h2><hr><h3 id=71-현재-도전-과제-실무-환경-기반-기술-난제>7.1 현재 도전 과제 (실무 환경 기반 기술 난제)<a hidden class=anchor aria-hidden=true href=#71-현재-도전-과제-실무-환경-기반-기술-난제>#</a></h3><blockquote><p>이 표는 실무 환경에서 Transactional Outbox 패턴이 마주하는 주요 도전 과제와 그 원인/영향/해결방안을 정리한 것입니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-62-1><a class=lnlinks href=#hl-62-1>1</a>
</span><span class=lnt id=hl-62-2><a class=lnlinks href=#hl-62-2>2</a>
</span><span class=lnt id=hl-62-3><a class=lnlinks href=#hl-62-3>3</a>
</span><span class=lnt id=hl-62-4><a class=lnlinks href=#hl-62-4>4</a>
</span><span class=lnt id=hl-62-5><a class=lnlinks href=#hl-62-5>5</a>
</span><span class=lnt id=hl-62-6><a class=lnlinks href=#hl-62-6>6</a>
</span><span class=lnt id=hl-62-7><a class=lnlinks href=#hl-62-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 구분 | 항목 | 원인 | 영향 | 해결 방안 |
</span></span><span class=line><span class=cl>|------|------|------|------|------------|
</span></span><span class=line><span class=cl>| 기술적 난제 | 메시지 순서 보장 | 여러 Publisher 병렬 처리 | 이벤트 순서 왜곡 | Kafka Partition 키 설정, 정렬 큐 사용 |
</span></span><span class=line><span class=cl>| 운영 과제 | 테이블 팽창 및 유지 | 메시지 전송 후 정리 미흡 | DB 성능 저하 | TTL, Soft Delete, Cleanup 스케줄러 |
</span></span><span class=line><span class=cl>| 처리 신뢰성 | 메시지 중복 및 누락 | 재시도 로직/CDC 누락 | 중복 소비 또는 이벤트 유실 | Idempotent Consumer, 상태 기반 재처리 |
</span></span><span class=line><span class=cl>| 확장성 | 수백 TPS 이상 처리 시 병목 | 단일 테이블/Publisher | 처리 지연, 스케일링 어려움 | 테이블 파티셔닝, Publisher 수평 확장 |
</span></span><span class=line><span class=cl>| 장애 대응 | Kafka 장애, CDC 지연 | 외부 의존 실패 | 전체 메시지 처리 중단 | DLQ 구성, Failover 브로커 설정 |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=72-생태계-및-관련-기술-2>7.2 생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#72-생태계-및-관련-기술-2>#</a></h3><blockquote><p>이 표는 Transactional Outbox와 연계되거나 대체 가능한 기술 및 표준을 정리한 것입니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-63-1><a class=lnlinks href=#hl-63-1>1</a>
</span><span class=lnt id=hl-63-2><a class=lnlinks href=#hl-63-2>2</a>
</span><span class=lnt id=hl-63-3><a class=lnlinks href=#hl-63-3>3</a>
</span><span class=lnt id=hl-63-4><a class=lnlinks href=#hl-63-4>4</a>
</span><span class=lnt id=hl-63-5><a class=lnlinks href=#hl-63-5>5</a>
</span><span class=lnt id=hl-63-6><a class=lnlinks href=#hl-63-6>6</a>
</span><span class=lnt id=hl-63-7><a class=lnlinks href=#hl-63-7>7</a>
</span><span class=lnt id=hl-63-8><a class=lnlinks href=#hl-63-8>8</a>
</span><span class=lnt id=hl-63-9><a class=lnlinks href=#hl-63-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 기술/도구 | 역할 | 특징 | 연계 방식 |
</span></span><span class=line><span class=cl>|-----------|------|------|-----------|
</span></span><span class=line><span class=cl>| <span class=gs>**Debezium**</span> | CDC 도구 | WAL 기반 실시간 이벤트 추출 | Kafka Connect 연동 |
</span></span><span class=line><span class=cl>| <span class=gs>**Kafka Connect**</span> | Kafka 통합 프레임워크 | 다양한 DB 및 시스템 연결 지원 | Debezium을 통해 Outbox 연결 |
</span></span><span class=line><span class=cl>| <span class=gs>**Kafka Streams / Flink**</span> | 스트리밍 처리 | 이벤트 흐름 후속 처리 | Outbox → Kafka → 처리 파이프라인 |
</span></span><span class=line><span class=cl>| <span class=gs>**Choreography**</span> | 이벤트 중심 마이크로서비스 조정 | Outbox의 Downstream 처리 모델 | Outbox 이벤트로 워크플로우 구동 |
</span></span><span class=line><span class=cl>| <span class=gs>**Temporal / Camunda**</span> | 워크플로우 엔진 | 장기 실행 트랜잭션 지원 | Outbox 이벤트를 Saga 트리거로 사용 |
</span></span><span class=line><span class=cl>| <span class=gs>**Outbox-Inbox 패턴**</span> | 메시지 수신까지 보장 | 메시지 송수신 쌍방 일관성 확보 | Producer + Consumer 구조 보완 |
</span></span><span class=line><span class=cl>| <span class=gs>**CloudEvents**</span> | 이벤트 표준 포맷 | 구조 통일로 시스템 간 호환성 향상 | Outbox 메시지 형식으로 사용 가능 |
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=73-최신-기술-트렌드와-미래-방향-2>7.3 최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#73-최신-기술-트렌드와-미래-방향-2>#</a></h3><table><thead><tr><th>트렌드</th><th>설명</th><th>Outbox와의 연계</th></tr></thead><tbody><tr><td><strong>Event-first Architecture</strong></td><td>이벤트가 도메인 모델의 중심이 되는 설계 방식</td><td>Outbox가 이벤트 신뢰성 기반 제공</td></tr><tr><td><strong>Serverless CDC</strong></td><td>Lambda, EventBridge 등으로 CDC 구성</td><td>Outbox → Lambda → 메시지 처리</td></tr><tr><td><strong>Event Replay</strong></td><td>저장된 이벤트로 시스템 복원 및 디버깅</td><td>Outbox를 로그 저장소로 활용</td></tr><tr><td><strong>Multi-tenant Outbox</strong></td><td>SaaS 환경에서 테넌트별 메시지 분리</td><td>테이블 파티셔닝 및 메타 정보 포함 필요</td></tr><tr><td><strong>Kafka Transactional Outbox</strong></td><td>Kafka 자체 트랜잭션 API 사용</td><td>DB 없이 Kafka 단독으로 처리 가능 (별도 접근)</td></tr></tbody></table><hr><h3 id=74-기타-고급-사항-전문가-레벨-고려사항>7.4 기타 고급 사항 (전문가 레벨 고려사항)<a hidden class=anchor aria-hidden=true href=#74-기타-고급-사항-전문가-레벨-고려사항>#</a></h3><table><thead><tr><th>항목</th><th>설명</th><th>고려 방향</th></tr></thead><tbody><tr><td>보상 트랜잭션 통합</td><td>Saga 패턴과 함께 사용 시 보상 메시지 처리 필요</td><td>Outbox 메시지 타입 구분 (예: compensate)</td></tr><tr><td>Event Versioning</td><td>스키마 진화 발생 시 버전 관리</td><td>Outbox 메시지에 version 필드 포함</td></tr><tr><td>QoS (Quality of Service) 차등 적용</td><td>중요 이벤트 우선 처리 필요</td><td>Outbox에 priority 필드 포함, 전송 우선순위 설정</td></tr><tr><td>Multi-region 시스템 확장</td><td>지역별 DB, Outbox 동기화 문제</td><td>글로벌 CDC 또는 다중 Outbox 운영 고려</td></tr></tbody></table><hr><h2 id=-phase-7-요약>🧩 Phase 7 요약<a hidden class=anchor aria-hidden=true href=#-phase-7-요약>#</a></h2><table><thead><tr><th>항목</th><th>핵심 내용</th></tr></thead><tbody><tr><td>기술 난제</td><td>순서 보장, 처리 신뢰성, 테이블 관리 등</td></tr><tr><td>연계 생태계</td><td>Debezium, Kafka Connect, Flink, Temporal 등</td></tr><tr><td>최신 트렌드</td><td>Serverless CDC, Event Replay, QoS 기반 전송</td></tr><tr><td>전문가 고려사항</td><td>버전 관리, 보상 트랜잭션, 글로벌 아키텍처 대응</td></tr></tbody></table><hr><p>좋습니다. 이제 마지막 단계인 <strong>통합 검증 및 학습 가이드 제공</strong>을 통해 전체 내용을 체계적으로 정리하고, 실무 적용 및 학습 계획을 안내드리겠습니다.</p><hr><h2 id=-최종-정리-및-학습-가이드>✅ 최종 정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#-최종-정리-및-학습-가이드>#</a></h2><hr><h3 id=-내용-종합-전체-요약>🔄 내용 종합: 전체 요약<a hidden class=anchor aria-hidden=true href=#-내용-종합-전체-요약>#</a></h3><p><strong>Transactional Outbox</strong>는 <strong>분산 트랜잭션 문제</strong>를 해결하기 위해 등장한 패턴으로, <strong>하나의 로컬 트랜잭션 안에 이벤트 메시지를 함께 저장</strong>하고, 이를 <strong>비동기적으로 브로커에 전송</strong>하여 <strong>데이터 일관성</strong>과 <strong>메시지 신뢰성</strong>을 동시에 확보합니다.</p><ul><li><strong>핵심 가치</strong>: Dual-write 방지, 일관성 유지, 확장 가능성, 복구 용이성</li><li><strong>주요 기술</strong>: Outbox Table, Kafka, Debezium, CDC, Idempotent Consumer</li><li><strong>적용 영역</strong>: 마이크로서비스 아키텍처, 이벤트 기반 설계, Saga 패턴</li><li><strong>운영 요소</strong>: 메시지 상태 관리, 지연 탐지, 자동화, 보안, 추적성</li><li><strong>확장 방향</strong>: Serverless, Global Outbox, Multi-Tenant 구조, Event Replay</li></ul><hr><h3 id=-학습-로드맵>🧭 학습 로드맵<a hidden class=anchor aria-hidden=true href=#-학습-로드맵>#</a></h3><table><thead><tr><th>순서</th><th>학습 주제</th><th>설명</th></tr></thead><tbody><tr><td>①</td><td>Dual-write 문제의 본질 이해</td><td>왜 이 패턴이 필요한지 배경 학습</td></tr><tr><td>②</td><td>Outbox 패턴 기본 구조와 트랜잭션 동작 방식</td><td>핵심 아키텍처 학습</td></tr><tr><td>③</td><td>구현 방식(Polling vs CDC) 비교 학습</td><td>선택 기준 이해</td></tr><tr><td>④</td><td>Kafka와 연계 구성</td><td>실무 아키텍처 설계 역량 강화</td></tr><tr><td>⑤</td><td>장애 복구 전략 및 성능 튜닝</td><td>운영 안정성 확보</td></tr><tr><td>⑥</td><td>고급 트렌드 및 관련 생태계 학습</td><td>전문가 수준 통찰 확보</td></tr></tbody></table><hr><h3 id=-실무-적용-가이드>🛠 실무 적용 가이드<a hidden class=anchor aria-hidden=true href=#-실무-적용-가이드>#</a></h3><table><thead><tr><th>항목</th><th>적용 시 고려사항</th></tr></thead><tbody><tr><td>아키텍처 설계</td><td>Outbox 테이블 설계 시 전송 상태, 타임스탬프, 메시지 ID 필드 포함</td></tr><tr><td>도구 선택</td><td>CDC 기반이면 Debezium + Kafka Connect, 간단히는 Polling Worker</td></tr><tr><td>메시지 처리 방식</td><td>중복 전송 방지 위해 메시지 ID 기반 처리 필요 (idempotent consumer)</td></tr><tr><td>운영 자동화</td><td>모니터링 지표 수집 + Alert 구성 (Prometheus, Grafana)</td></tr><tr><td>장애 대비</td><td>전송 실패 시 Retry + DLQ 구성 필수</td></tr><tr><td>전사 표준화</td><td>이벤트 스키마 표준 (CloudEvents), 이벤트 버전 관리 체계 수립</td></tr></tbody></table><hr><h3 id=-학습-항목-매트릭스>📚 학습 항목 매트릭스<a hidden class=anchor aria-hidden=true href=#-학습-항목-매트릭스>#</a></h3><blockquote><p>이 표는 체계적인 학습을 위해 단계별 학습 항목과 중요도를 정리하기 위해 작성되었습니다.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-64-1><a class=lnlinks href=#hl-64-1>1</a>
</span><span class=lnt id=hl-64-2><a class=lnlinks href=#hl-64-2>2</a>
</span><span class=lnt id=hl-64-3><a class=lnlinks href=#hl-64-3>3</a>
</span><span class=lnt id=hl-64-4><a class=lnlinks href=#hl-64-4>4</a>
</span><span class=lnt id=hl-64-5><a class=lnlinks href=#hl-64-5>5</a>
</span><span class=lnt id=hl-64-6><a class=lnlinks href=#hl-64-6>6</a>
</span><span class=lnt id=hl-64-7><a class=lnlinks href=#hl-64-7>7</a>
</span><span class=lnt id=hl-64-8><a class=lnlinks href=#hl-64-8>8</a>
</span><span class=lnt id=hl-64-9><a class=lnlinks href=#hl-64-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>| 카테고리 | Phase | 항목                         | 중요도 | 학습 목표                     | 실무 연관성 | 설명 |
</span></span><span class=line><span class=cl>|----------|-------|------------------------------|--------|------------------------------|-------------|------|
</span></span><span class=line><span class=cl>| 기초     | 1     | Dual-write 문제 이해         | 필수   | 패턴의 필요성 인식           | 높음        | 분산 트랜잭션 문제 맥락 이해 |
</span></span><span class=line><span class=cl>| 기초     | 1     | Outbox 개념 및 동작 방식     | 필수   | 핵심 구조 및 흐름 파악       | 높음        | 트랜잭션 동작 방식 학습 |
</span></span><span class=line><span class=cl>| 핵심     | 2     | 트랜잭션 + 메시지 일관성 구조| 필수   | 일관성 보장 방식 숙지         | 높음        | DB 트랜잭션과 메시지 전송 통합 이해 |
</span></span><span class=line><span class=cl>| 핵심     | 4     | 구현 방식 비교 (Polling vs CDC) | 필수 | 상황별 적용 전략 판단        | 높음        | 구조적 차이와 선택 기준 학습 |
</span></span><span class=line><span class=cl>| 응용     | 5     | Kafka와 Outbox 연계 구성     | 권장   | 실무에 적용 가능한 설계 능력 | 중간        | Kafka Connector 실전 구성 |
</span></span><span class=line><span class=cl>| 응용     | 6     | 성능 튜닝 및 장애 대응 전략  | 권장   | 운영 중 문제 대응 능력 강화  | 중간        | 모니터링/지연/재시도 전략 |
</span></span><span class=line><span class=cl>| 고급     | 7     | Serverless CDC, Event Replay | 선택   | 최신 트렌드 파악             | 낮음        | 미래 지향적 기술 확장 이해 |
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=-용어-정리>🧾 용어 정리<a hidden class=anchor aria-hidden=true href=#-용어-정리>#</a></h2><blockquote><p>이 표는 주제의 핵심 용어와 실무 적용 가능성을 정리하기 위해 작성되었습니다.</p></blockquote><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>핵심</td><td>Transactional Outbox</td><td>트랜잭션 내 메시지 저장 후 비동기 전송 패턴</td><td>Dual-write, Eventual Consistency</td><td>데이터 일관성 확보</td></tr><tr><td>핵심</td><td>CDC (Change Data Capture)</td><td>DB 변경 로그를 활용한 메시지 추출 방식</td><td>Debezium, Kafka Connect</td><td>실시간 이벤트 연동</td></tr><tr><td>구현</td><td>Outbox Table</td><td>메시지를 저장하는 테이블</td><td>상태 컬럼, TTL</td><td>메시지 재처리 기반</td></tr><tr><td>구현</td><td>Publisher</td><td>Outbox 테이블 → Kafka 전송 역할</td><td>Polling 또는 Worker</td><td>메시지 브로커 연계 핵심 컴포넌트</td></tr><tr><td>운영</td><td>Idempotent Consumer</td><td>중복 메시지에 대해 동일 결과만 처리하는 소비자</td><td>메시지 키, 상태 저장</td><td>중복 처리 방지</td></tr><tr><td>운영</td><td>DLQ (Dead Letter Queue)</td><td>실패한 메시지를 보관하는 대체 큐</td><td>Retry, 상태 관리</td><td>장애 복구 및 분석</td></tr></tbody></table><hr><h2 id=-참고-및-출처>📌 참고 및 출처<a hidden class=anchor aria-hidden=true href=#-참고-및-출처>#</a></h2><ul><li><a href=https://microservices.io/patterns/data/transactional-outbox.html>Microservices.io – Transactional Outbox Pattern</a></li><li><a href=https://debezium.io/documentation/>Debezium Documentation</a></li><li><a href=https://martinfowler.com/articles/patterns-of-distributed-systems/transactional-outbox.html>Martin Fowler – Reliable Messaging Without Distributed Transactions</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/transactional-outbox.html>AWS Prescriptive Guidance – Transactional Outbox</a></li><li><a href=https://docs.confluent.io/kafka-connect-debezium/current/index.html>Confluent Kafka Connect + Debezium Guide</a></li></ul><hr><p>여기까지가 <strong>Transactional Outbox 패턴의 전체 조사 결과</strong>입니다.
이제 다음 중 어떤 도움을 드릴까요?</p><ol><li>🔧 특정 구현 예제 확장 (예: Spring, NestJS, Go 기반 Outbox 구현)</li><li>🛠 실습 환경 구성 안내 (Docker 기반 Kafka + Debezium)</li><li>🧪 테스트 전략 및 장애 시나리오 설계</li><li>📁 PDF or Markdown 보고서로 정리된 형태 제공</li><li>🧩 다른 패턴 (예: Outbox-Inbox, Saga, Event Sourcing) 비교 분석</li></ol><p>원하시는 방향을 말씀해주세요.</p><hr><p>Transactional Outbox 패턴은 마이크로서비스 아키텍처(MSA)에서 데이터 일관성과 메시지 전달의 신뢰성을 보장하기 위한 중요한 패턴이다.</p><p>Transactional Outbox 패턴은 데이터베이스 업데이트와 메시지 발행을 원자적으로 처리하기 위한 방법으로, 데이터베이스 트랜잭션과 메시지 발행 사이의 일관성을 보장하는 것을 목적으로 한다.</p><p>Transactional Outbox 패턴은 분산 시스템에서 데이터 일관성과 메시지 전달의 신뢰성을 높이는 효과적인 방법이다. 이 패턴을 통해 개발자는 복잡한 분산 트랜잭션 문제를 해결하고, 시스템의 안정성을 향상시킬 수 있다.</p><h3 id=작동-방식>작동 방식<a hidden class=anchor aria-hidden=true href=#작동-방식>#</a></h3><ul><li>데이터베이스 업데이트와 함께 발행할 메시지를 &lsquo;outbox&rsquo; 테이블에 저장한다.</li><li>이 두 작업은 하나의 데이터베이스 트랜잭션으로 처리된다.</li><li>별도의 프로세스(Message Relay)가 outbox 테이블에서 메시지를 읽어 실제 메시지 브로커로 전송한다.</li></ul><h3 id=주요-구성-요소>주요 구성 요소<a hidden class=anchor aria-hidden=true href=#주요-구성-요소>#</a></h3><ul><li>Outbox 테이블: 발행할 메시지를 임시로 저장하는 데이터베이스 테이블</li><li>Message Relay: outbox 테이블에서 메시지를 읽어 메시지 브로커로 전송하는 프로세스</li></ul><h3 id=구현-방법>구현 방법<a hidden class=anchor aria-hidden=true href=#구현-방법>#</a></h3><p>a. Polling Publisher:<br>- 주기적으로 outbox 테이블을 폴링하여 미발행 메시지를 조회하고 발행한다.<br>- 구현이 간단하지만 실시간성이 떨어질 수 있다.</p><p>b. Transaction Log Tailing:<br>- 데이터베이스의 트랜잭션 로그를 모니터링하여 변경사항을 감지하고 메시지를 발행한다.<br>- 실시간성이 높지만 구현이 복잡할 수 있다.</p><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><ul><li>데이터 일관성 보장: 데이터베이스 업데이트와 메시지 발행이 원자적으로 처리된다.</li><li>메시지 전달 보장: At-Least-Once Delivery를 제공한다.</li><li>성능 향상: 데이터베이스 작업과 메시지 발행이 분리되어 처리된다.</li></ul><h3 id=주의사항>주의사항<a hidden class=anchor aria-hidden=true href=#주의사항>#</a></h3><ul><li>메시지 중복 발행 가능성: 수신 시스템에서 멱등성 처리가 필요하다.</li><li>구현 복잡성: 특히 Transaction Log Tailing 방식에서 높아질 수 있다.</li></ul><h3 id=사용-사례>사용 사례<a hidden class=anchor aria-hidden=true href=#사용-사례>#</a></h3><ul><li>금융 거래 시스템: 트랜잭션의 정확성과 일관성이 중요한 경우</li><li>주문 처리 시스템: 주문 데이터 저장과 관련 이벤트 발행이 필요한 경우</li></ul><hr><h2 id=참고-및-출처-3>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-3>#</a></h2></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>