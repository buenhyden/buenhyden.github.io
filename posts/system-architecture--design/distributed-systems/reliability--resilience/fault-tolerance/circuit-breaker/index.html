<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Circuit Breaker | hyunyoun's Blog</title><meta name=keywords content="System-Architecture-and-Design,Distributed-Systems,Reliability-and-Resilience,Fault-Tolerance,Circuit-Breaker"><meta name=description content="서킷 브레이커 패턴(Circuit Breaker Pattern)은 마이크로서비스 아키텍처에서 시스템의 안정성과 복원력을 향상시키기 위해 사용되는 디자인 패턴이다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/system-architecture--design/distributed-systems/reliability--resilience/fault-tolerance/circuit-breaker/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.d522c866f0cc9c20ae4fa73a0a8c07f0af4c36af75bcbcd3e90558446f681077.css integrity="sha256-1SLIZvDMnCCuT6c6CowH8K9MNq91vLzT6QVYRG9oEHc=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/system-architecture--design/distributed-systems/reliability--resilience/fault-tolerance/circuit-breaker/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/system-architecture--design/distributed-systems/reliability--resilience/fault-tolerance/circuit-breaker/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/system-architecture--design/distributed-systems/reliability--resilience/fault-tolerance/circuit-breaker/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Circuit Breaker"><meta property="og:description" content="서킷 브레이커 패턴(Circuit Breaker Pattern)은 마이크로서비스 아키텍처에서 시스템의 안정성과 복원력을 향상시키기 위해 사용되는 디자인 패턴이다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Circuit Breaker"><meta name=twitter:description content="서킷 브레이커 패턴(Circuit Breaker Pattern)은 마이크로서비스 아키텍처에서 시스템의 안정성과 복원력을 향상시키기 위해 사용되는 디자인 패턴이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Circuit Breaker","item":"https://buenhyden.github.io/posts/system-architecture--design/distributed-systems/reliability--resilience/fault-tolerance/circuit-breaker/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1>Circuit Breaker</h1><div class=post-description>서킷 브레이커 패턴(Circuit Breaker Pattern)은 마이크로서비스 아키텍처에서 시스템의 안정성과 복원력을 향상시키기 위해 사용되는 디자인 패턴이다.</div></header><div class=post-content><h2 id=circuit-breaker>Circuit Breaker<a hidden class=anchor aria-hidden=true href=#circuit-breaker>#</a></h2><p>아래는 &ldquo;Circuit Breaker Pattern(서킷 브레이커 패턴)&rdquo; 에 대한 체계적이고 심층적인 조사, 분석, 정리입니다.</p><hr><h2 id=1-태그-tag>1. 태그 (Tag)<a hidden class=anchor aria-hidden=true href=#1-태그-tag>#</a></h2><ul><li><strong>Resilience-Pattern</strong></li><li><strong>Fault-Tolerance</strong></li><li><strong>Distributed-Systems</strong></li><li><strong>Error-Handling</strong></li></ul><hr><h2 id=2-분류-구조-적합성-분석>2. 분류 구조 적합성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-적합성-분석>#</a></h2><p><strong>현재 분류 구조</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Computer Science and Engineering
</span></span><span class=line><span class=cl>└─ Software Engineering
</span></span><span class=line><span class=cl>   └─ Design and Architecture
</span></span><span class=line><span class=cl>      └─ Architecture Patterns
</span></span><span class=line><span class=cl>         └─ Resilience Patterns
</span></span></code></pre></td></tr></table></div></div><p><strong>분석 및 근거</strong><br>Circuit Breaker Pattern 은 시스템의 내결함성 (Resilience) 과 신뢰성을 높이기 위해, 장애 발생 시 일정 시간 동안 요청을 차단하여 시스템의 자원 고갈과 장애 전파를 방지하는 설계 패턴입니다.<br>이 패턴은 &ldquo;Architecture Patterns > Resilience Patterns&rdquo; 에 포함되어야 하며, &ldquo;Software Engineering > Design and Architecture&rdquo; 계층 아래에 위치하는 것이 적절합니다.<br>따라서, 현재 분류 구조는 주제의 특성과 실무적 중요성 모두를 반영하고 있습니다.</p><hr><h2 id=3-요약-200-자-내외>3. 요약 (200 자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-200-자-내외>#</a></h2><p>Circuit Breaker Pattern 은 장애 발생 시 일정 시간 동안 요청을 차단하여, 불필요한 자원 낭비와 장애 전파를 방지하는 내결함성 설계 패턴입니다.</p><hr><h2 id=4-개요-250-자-내외>4. 개요 (250 자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요-250-자-내외>#</a></h2><p>Circuit Breaker Pattern 은 외부 시스템 호출, 데이터베이스 쿼리 등에서 장애가 반복적으로 발생할 때, 일정 시간 동안 요청을 차단하여 시스템의 자원 고갈과 장애 전파를 방지하는 내결함성 및 신뢰성 향상 패턴입니다.<br>주로 분산 시스템, 마이크로서비스 환경에서 사용됩니다.</p><hr><h2 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h2><ul><li><strong>정의 및 목적</strong><ul><li>Circuit Breaker Pattern 은 장애가 반복적으로 발생할 때, 일정 시간 동안 요청을 차단하여 불필요한 자원 낭비와 장애 전파를 방지하는 패턴입니다.</li><li>목적은 시스템의 신뢰성, 내결함성, 자원 효율성, 그리고 장애 전파 방지입니다.</li></ul></li><li><strong>실무 연관성</strong><ul><li>실무에서는 외부 API 호출, 데이터베이스 쿼리, 분산 시스템 간 통신 등 다양한 작업에 적용됩니다.</li><li>내결함성, 신뢰성, 서비스 품질 향상에 필수적인 요소로 작용합니다.</li></ul></li></ul><hr><h2 id=6-세부-조사-내용>6. 세부 조사 내용<a hidden class=anchor aria-hidden=true href=#6-세부-조사-내용>#</a></h2><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><ul><li><strong>분산 시스템의 복잡성 증가</strong><ul><li>여러 서비스가 상호작용하는 환경에서 장애가 연쇄적으로 전파될 위험이 높아졌습니다.</li></ul></li><li><strong>불필요한 자원 낭비</strong><ul><li>장애 상황에서도 계속 요청을 시도하면 자원 (스레드, 메모리 등) 이 불필요하게 소모됩니다.</li></ul></li></ul><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><ul><li><strong>장애 전파 방지</strong><ul><li>장애가 연쇄적으로 전파되는 것을 방지하여 시스템 전체의 안정성을 높입니다.</li></ul></li><li><strong>자원 효율성</strong><ul><li>불필요한 자원 소모를 줄여 시스템의 효율성을 높입니다.</li></ul></li><li><strong>신뢰성 및 내결함성</strong><ul><li>시스템의 신뢰성과 내결함성을 높여 사용자 경험을 개선합니다.</li></ul></li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><ul><li><strong>요청 차단</strong><ul><li>장애가 반복적으로 발생하면 일정 시간 동안 요청을 차단합니다.</li></ul></li><li><strong>자동 복구</strong><ul><li>일정 시간이 지나면 요청을 다시 허용하여 시스템이 복구되었는지 확인합니다.</li></ul></li><li><strong>장애 전파 방지</strong><ul><li>장애가 다른 서비스나 시스템에 전파되는 것을 방지합니다.</li></ul></li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><ul><li><strong>상태 기반</strong><ul><li>CLOSED(정상), OPEN(차단), HALF-OPEN(부분 복구) 상태로 동작합니다.</li></ul></li><li><strong>자동화</strong><ul><li>장애 감지, 요청 차단, 복구 시도 등이 자동으로 이루어집니다.</li></ul></li><li><strong>Low-risk(저위험)</strong><ul><li>불필요한 자원 낭비와 장애 전파를 방지하여 시스템 전체의 위험을 줄입니다.</li></ul></li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><ul><li><strong>Fail Fast(빠른 실패)</strong><ul><li>장애 발생 시 즉시 실패 처리를 하여 시스템의 복잡성과 장애 전파를 방지합니다.</li></ul></li><li><strong>Graceful Degradation(우아한 성능 저하)</strong><ul><li>장애 발생 시 핵심 기능은 유지하면서 일부 기능만 저하시키는 방식으로 동작합니다.</li></ul></li><li><strong>Resource Management(자원 관리)</strong><ul><li>자원을 효율적으로 관리하여 시스템의 확장성과 안정성을 높입니다.</li></ul></li></ul><h3 id=주요-원리-및-작동-원리>주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#주요-원리-및-작동-원리>#</a></h3><p><strong>다이어그램 (Text)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>stateDiagram-v2
</span></span><span class=line><span class=cl>    [*] --&gt; CLOSED
</span></span><span class=line><span class=cl>    CLOSED --&gt; OPEN: 장애 발생(임계치 초과)
</span></span><span class=line><span class=cl>    OPEN --&gt; HALF_OPEN: 일정 시간 후
</span></span><span class=line><span class=cl>    HALF_OPEN --&gt; CLOSED: 요청 성공
</span></span><span class=line><span class=cl>    HALF_OPEN --&gt; OPEN: 요청 실패
</span></span><span class=line><span class=cl>    HALF_OPEN --&gt; [*]: 장애 지속
</span></span><span class=line><span class=cl>    CLOSED --&gt; [*]: 정상 종료
</span></span></code></pre></td></tr></table></div></div><p><strong>설명</strong></p><ul><li><strong>CLOSED</strong>: 정상 상태, 요청 허용</li><li><strong>OPEN</strong>: 장애 발생, 요청 차단</li><li><strong>HALF-OPEN</strong>: 일정 시간 후 요청을 다시 허용하여 시스템이 복구되었는지 확인</li><li><strong>CLOSED</strong>: 요청이 성공하면 다시 정상 상태로 전환</li><li><strong>OPEN</strong>: 요청이 실패하면 다시 차단 상태로 전환</li></ul><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><p><strong>구성 요소</strong></p><table><thead><tr><th>항목</th><th>기능 및 역할</th></tr></thead><tbody><tr><td>Client</td><td>요청을 시작하고, 결과 또는 실패를 처리하는 주체</td></tr><tr><td>Operation</td><td>실제로 실행되는 작업 (예: 외부 API 호출, 데이터베이스 쿼리 등)</td></tr><tr><td>CircuitBreaker</td><td>장애 감지, 요청 차단, 복구 시도 등 Circuit Breaker 상태 관리</td></tr></tbody></table><p><strong>필수 구성요소</strong></p><ul><li><strong>Client</strong>: 요청을 시작하고 결과를 처리</li><li><strong>Operation</strong>: 실제 작업 수행</li><li><strong>CircuitBreaker</strong>: 장애 감지 및 요청 차단, 복구 시도</li></ul><p><strong>선택 구성요소</strong></p><ul><li><strong>Fallback Handler</strong>: 요청 차단 시 대체 동작을 수행하는 핸들러</li><li><strong>Logging Module</strong>: 장애, 요청 차단, 복구 등 이벤트 로그 기록</li></ul><p><strong>구조 다이어그램 (Text)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>+---------------------+
</span></span><span class=line><span class=cl>|      Client         |
</span></span><span class=line><span class=cl>+----------+----------+
</span></span><span class=line><span class=cl>           |
</span></span><span class=line><span class=cl>           v
</span></span><span class=line><span class=cl>+---------------------+
</span></span><span class=line><span class=cl>|   CircuitBreaker    |
</span></span><span class=line><span class=cl>+----------+----------+
</span></span><span class=line><span class=cl>           |
</span></span><span class=line><span class=cl>           v
</span></span><span class=line><span class=cl>+---------------------+
</span></span><span class=line><span class=cl>|     Operation       |
</span></span><span class=line><span class=cl>+---------------------+
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=7-구현-기법>7. 구현 기법<a hidden class=anchor aria-hidden=true href=#7-구현-기법>#</a></h2><table><thead><tr><th>기법</th><th>정의 및 목적</th><th>예시 (시스템 구성, 시나리오)</th></tr></thead><tbody><tr><td>상태 기반</td><td>CLOSED, OPEN, HALF-OPEN 상태로 동작</td><td>외부 API 호출 시 장애 발생 시 요청 차단</td></tr><tr><td>임계치 설정</td><td>장애 발생 임계치 (예: 실패 횟수, 실패율) 설정</td><td>5 회 연속 실패 시 OPEN 상태로 전환</td></tr><tr><td>복구 시도</td><td>일정 시간 후 HALF-OPEN 상태로 전환하여 복구 시도</td><td>30 초 후 HALF-OPEN 상태로 전환, 요청 재시도</td></tr><tr><td>Polly 라이브러리</td><td>.NET 환경에서 Circuit Breaker 를 쉽게 구현할 수 있는 라이브러리</td><td>Polly 의 AddCircuitBreaker 사용</td></tr></tbody></table><hr><h2 id=8-장점>8. 장점<a hidden class=anchor aria-hidden=true href=#8-장점>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>장애 전파 방지</td><td>장애가 연쇄적으로 전파되는 것을 방지하여 시스템 전체의 안정성 향상</td></tr><tr><td></td><td>자원 효율성</td><td>불필요한 자원 소모를 줄여 시스템의 효율성 향상</td></tr><tr><td></td><td>신뢰성 및 내결함성</td><td>시스템의 신뢰성과 내결함성을 높여 사용자 경험 개선</td></tr><tr><td></td><td>빠른 복구</td><td>장애 발생 시 빠르게 요청을 차단하여 시스템이 빠르게 복구할 수 있음</td></tr></tbody></table><hr><h2 id=9-단점과-문제점-그리고-해결방안>9. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#9-단점과-문제점-그리고-해결방안>#</a></h2><h3 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>과도한 차단</td><td>장애 감지가 민감할 경우 불필요한 요청 차단이 발생할 수 있음</td><td>장애 감지 기준 조정</td></tr><tr><td></td><td>대체 동작 필요</td><td>요청 차단 시 대체 동작이 없으면 서비스 품질 저하 가능</td><td>Fallback Pattern 적용</td></tr></tbody></table><h3 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>장애 감지 오류</td><td>장애 감지 기준이 부적절</td><td>불필요한 요청 차단</td><td>로그, 모니터링</td><td>장애 감지 기준 튜닝</td><td>동적 장애 감지 기준 적용</td></tr><tr><td></td><td>대체 동작 미구현</td><td>대체 동작 미구현</td><td>서비스 품질 저하</td><td>테스트, 모니터링</td><td>대체 동작 구현</td><td>Fallback Pattern 적용</td></tr></tbody></table><hr><h2 id=10-도전-과제>10. 도전 과제<a hidden class=anchor aria-hidden=true href=#10-도전-과제>#</a></h2><table><thead><tr><th>과제</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>동적 장애 감지 기준</td><td>시스템 환경 변화</td><td>불필요한 요청 차단</td><td>모니터링, 로그</td><td>동적 장애 감지 기준 적용</td><td>머신러닝, 통계 기반 적용</td></tr><tr><td>대체 동작 표준화</td><td>비즈니스 요구 다양</td><td>서비스 품질 저하</td><td>테스트, 모니터링</td><td>표준화된 대체 동작 정의</td><td>프레임워크, 라이브러리화</td></tr></tbody></table><hr><h2 id=11-분류-기준에-따른-종류-및-유형>11. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#11-분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>적용 대상</td><td>네트워크 호출</td><td>외부 API, 서비스 호출 시 적용</td></tr><tr><td></td><td>데이터베이스 쿼리</td><td>데이터베이스 쿼리 시 적용</td></tr><tr><td></td><td>파일 I/O</td><td>파일 읽기/쓰기 시 적용</td></tr><tr><td>구현 방식</td><td>상태 기반</td><td>CLOSED, OPEN, HALF-OPEN 상태로 동작</td></tr><tr><td></td><td>임계치 기반</td><td>실패 횟수, 실패율 등 임계치 설정</td></tr></tbody></table><hr><h2 id=12-실무-사용-예시>12. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#12-실무-사용-예시>#</a></h2><table><thead><tr><th>사용 예시</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>외부 API 호출</td><td>장애 전파 방지</td><td>서비스 신뢰성 향상</td></tr><tr><td>데이터베이스 쿼리</td><td>자원 효율성</td><td>데이터 가용성 향상</td></tr><tr><td>파일 I/O</td><td>장애 전파 방지</td><td>파일 접근성 향상</td></tr></tbody></table><hr><h2 id=13-활용-사례>13. 활용 사례<a hidden class=anchor aria-hidden=true href=#13-활용-사례>#</a></h2><p><strong>사례: 온라인 결제 서비스</strong></p><ul><li><strong>시스템 구성</strong><ul><li>결제 서비스 → 외부 결제 게이트웨이 호출</li></ul></li><li><strong>Workflow</strong><ol><li>결제 요청 발생</li><li>결제 서비스가 결제 게이트웨이 호출</li><li>연속 실패 시 Circuit Breaker 가 OPEN 상태로 전환, 요청 차단</li><li>일정 시간 후 HALF-OPEN 상태로 전환, 요청 재시도</li><li>요청 성공 시 CLOSED 상태로 복구, 실패 시 다시 OPEN 상태로 전환</li></ol></li><li><strong>Circuit Breaker Pattern 의 역할</strong><ul><li>결제 게이트웨이 장애 시 요청 차단 및 장애 전파 방지</li><li>결제 서비스의 신뢰성 및 사용자 경험 향상</li></ul></li><li><strong>유무에 따른 차이</strong><ul><li>Circuit Breaker Pattern 미적용 시: 장애가 연쇄적으로 전파되어 전체 시스템 장애 가능</li><li>Circuit Breaker Pattern 적용 시: 장애 전파 방지 및 시스템 신뢰성 향상</li></ul></li></ul><hr><h2 id=14-구현-예시>14. 구현 예시<a hidden class=anchor aria-hidden=true href=#14-구현-예시>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29>29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30>30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31>31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32>32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33>33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34>34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35>35</a>
</span><span class=lnt id=hl-3-36><a class=lnlinks href=#hl-3-36>36</a>
</span><span class=lnt id=hl-3-37><a class=lnlinks href=#hl-3-37>37</a>
</span><span class=lnt id=hl-3-38><a class=lnlinks href=#hl-3-38>38</a>
</span><span class=lnt id=hl-3-39><a class=lnlinks href=#hl-3-39>39</a>
</span><span class=lnt id=hl-3-40><a class=lnlinks href=#hl-3-40>40</a>
</span><span class=lnt id=hl-3-41><a class=lnlinks href=#hl-3-41>41</a>
</span><span class=lnt id=hl-3-42><a class=lnlinks href=#hl-3-42>42</a>
</span><span class=lnt id=hl-3-43><a class=lnlinks href=#hl-3-43>43</a>
</span><span class=lnt id=hl-3-44><a class=lnlinks href=#hl-3-44>44</a>
</span><span class=lnt id=hl-3-45><a class=lnlinks href=#hl-3-45>45</a>
</span><span class=lnt id=hl-3-46><a class=lnlinks href=#hl-3-46>46</a>
</span><span class=lnt id=hl-3-47><a class=lnlinks href=#hl-3-47>47</a>
</span><span class=lnt id=hl-3-48><a class=lnlinks href=#hl-3-48>48</a>
</span><span class=lnt id=hl-3-49><a class=lnlinks href=#hl-3-49>49</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Circuit Breaker Pattern 구현 예시 (JavaScript)
</span></span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>CircuitBreaker</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>failureThreshold</span><span class=p>,</span> <span class=nx>recoveryTimeout</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>failureThreshold</span> <span class=o>=</span> <span class=nx>failureThreshold</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>recoveryTimeout</span> <span class=o>=</span> <span class=nx>recoveryTimeout</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>failures</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=s1>&#39;CLOSED&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>nextAttempt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>execute</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s1>&#39;OPEN&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>nextAttempt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=s1>&#39;HALF_OPEN&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Circuit breaker is OPEN&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>request</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>failures</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=s1>&#39;CLOSED&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>failures</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>failures</span> <span class=o>&gt;=</span> <span class=k>this</span><span class=p>.</span><span class=nx>failureThreshold</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=s1>&#39;OPEN&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>nextAttempt</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>recoveryTimeout</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 사용 예시
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>breaker</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CircuitBreaker</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>10000</span><span class=p>);</span> <span class=c1>// 3회 실패 시 10초 차단
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>fetchUserData</span><span class=p>(</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>breaker</span><span class=p>.</span><span class=nx>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`/api/users/</span><span class=si>${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 실패 시 대체 동작
</span></span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=nx>userId</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Default User&#39;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=15-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>15. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#15-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>장애 감지 기준</td><td>환경, 네트워크 상황에 맞는 장애 감지 기준 설정</td><td>모니터링, 튜닝</td></tr><tr><td>대체 동작 구현</td><td>요청 차단 시 대체 동작 (예: 기본값 반환, 로그 기록) 구현</td><td>표준화된 대체 동작 정의</td></tr><tr><td>로깅 및 모니터링</td><td>장애, 요청 차단, 복구 등 이벤트 로그, 메트릭 수집</td><td>로그, 메트릭 수집</td></tr></tbody></table><hr><h2 id=16-최적화하기-위한-고려사항-및-주의할-점>16. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#16-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>항목</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td>동적 장애 감지 기준</td><td>시스템 상태, 네트워크 상황에 따라 장애 감지 기준 자동 조정</td><td>동적 장애 감지 기준 적용</td></tr><tr><td>자원 낭비 최소화</td><td>불필요한 요청은 최대한 빨리 차단하여 자원 낭비 최소화</td><td>요청 차단 로직 강화</td></tr><tr><td>대체 동작 최적화</td><td>요청 차단 시 대체 동작이 서비스 품질에 미치는 영향 최소화</td><td>대체 동작 품질 관리</td></tr></tbody></table><hr><h2 id=17-주제와-관련하여-주목할-내용>17. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#17-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>내결함성</td><td>Resilience</td><td>Circuit Breaker</td><td>장애 전파 방지 및 신뢰성 향상</td></tr><tr><td>분산 시스템</td><td>Microservices</td><td>Fault Tolerance</td><td>서비스 간 통신 시 장애 대응 및 회복력 강화</td></tr><tr><td>비동기 처리</td><td>Async/Await</td><td>상태 관리</td><td>비동기 작업에 Circuit Breaker 적용 예시</td></tr><tr><td>실무 적용</td><td>실무 예시</td><td>결제 서비스</td><td>외부 API 호출 시 Circuit Breaker 적용으로 장애 전파 방지</td></tr></tbody></table><hr><h2 id=18-반드시-학습해야할-내용>18. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#18-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>내결함성</td><td>Resilience Pattern</td><td>Retry Pattern</td><td>Circuit Breaker 와 함께 사용되는 내결함성 패턴</td></tr><tr><td>분산 시스템</td><td>Microservices</td><td>Timeout Pattern</td><td>Circuit Breaker 와 함께 사용되는 타임아웃 패턴</td></tr><tr><td>비동기 처리</td><td>Async Programming</td><td>Promise, Async/Await</td><td>비동기 작업에 Circuit Breaker 적용 방법</td></tr><tr><td>실무 적용</td><td>실무 예시</td><td>Fallback Pattern</td><td>Circuit Breaker 후에도 실패 시 대체 동작 구현 방법</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>내결함성</td><td>Resilience</td><td>시스템이 장애 상황에서도 정상적으로 동작하는 능력</td></tr><tr><td>분산 시스템</td><td>Microservices</td><td>여러 서비스가 네트워크를 통해 상호작용하는 시스템 구조</td></tr><tr><td>실패 전파</td><td>Failure Propagation</td><td>장애가 한 시스템에서 다른 시스템으로 전파되는 현상</td></tr><tr><td>실무 적용</td><td>Circuit Breaker</td><td>장애 발생 시 요청을 차단하여 장애 전파와 자원 낭비를 방지</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://docs.microsoft.com/en-us/azure/architecture/patterns/circuit-breaker>Circuit Breaker Pattern (Microsoft Docs)</a></li><li><a href=https://martinfowler.com/bliki/CircuitBreaker.html>Circuit Breaker Pattern (Martin Fowler)</a></li><li><a href=https://patterns.arc42.org/patterns/circuit-breaker/>Circuit Breaker Pattern (Patterns for Resilient Architecture)</a></li><li><a href=https://dev.to/vipulkumarsviit/circuit-breaker-pattern-in-microservices-2m5c>Circuit Breaker Pattern in Microservices (dev.to)</a></li><li><a href=https://www.pollydocs.org/strategies/circuit-breaker>Polly Circuit Breaker Documentation</a></li></ul><p>아래는 <strong>Circuit Breaker Pattern</strong>에 대한 1~5 단계 정리입니다. 이후 단계도 준비 완료되어 있습니다!</p><hr><h2 id=1-태그-tags>1. 태그 (Tags)<a hidden class=anchor aria-hidden=true href=#1-태그-tags>#</a></h2><p>Circuit-Breaker-Pattern<br>Resilience-Patterns<br>Fault-Tolerance<br>Distributed-Systems</p><hr><h2 id=2-분류-구조-적절성-검토>2. 분류 구조 적절성 검토<a hidden class=anchor aria-hidden=true href=#2-분류-구조-적절성-검토>#</a></h2><p>&ldquo;Circuit Breaker Pattern&rdquo; 은 <strong>Software Engineering > Design and Architecture > Architecture Patterns > Resilience Patterns</strong> 안에 정확히 자리 잡는 패턴입니다.</p><ul><li><strong>근거</strong>: 마이크로서비스나 분산 시스템에서 외부 호출 장애가 전체 시스템에 확산되는 것을 방지하며, 오류 상태에 따라 호출을 차단하거나 회복 테스트를 진행하는 탄력성 원칙의 핵심 구성 요소입니다 (<a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">geeksforgeeks.org</a>, <a href="https://arxiv.org/abs/1708.07422?utm_source=chatgpt.com" title="Resilience Design Patterns: A Structured Approach to Resilience at Extreme Scale">arxiv.org</a>).</li></ul><hr><h2 id=3-요약-200-자>3. 요약 (200 자)<a hidden class=anchor aria-hidden=true href=#3-요약-200-자>#</a></h2><p>Circuit Breaker Pattern 은 외부 서비스 호출 실패가 발생하면 설정된 임계치까지 실패를 감지한 후 차단 (Open) 상태로 전환하여 추가 호출을 막습니다. 이후 일정 시간 (Wait duration) 후 Half‑Open 상태에서 일부 호출을 재시도하며, 성공 시 Closed 상태로 복귀하고, 실패 시 다시 Open 상태로 되돌아갑니다. 이를 통해 장애 확산을 방지하고 시스템 회복을 유도할 수 있습니다 (<a href="https://mobisoftinfotech.com/resources/blog/microservices/resilience4j-circuit-breaker-retry-bulkhead-spring-boot?utm_source=chatgpt.com" title="Resilience4j Circuit Breaker, Retry & Bulkhead Tutorial">mobisoftinfotech.com</a>).</p><hr><h2 id=4-개요-250-자>4. 개요 (250 자)<a hidden class=anchor aria-hidden=true href=#4-개요-250-자>#</a></h2><p>Circuit Breaker Pattern 은 고장난 외부 서비스 호출을 보호하고 장애 확산 (cascading failure) 을 방지하기 위해 설계된 탄력성 구조입니다. Closed, Open, Half‑Open 의 세 상태를 통해 호출 흐름을 제어하며, 실패율 기반 트리거, 재시도 확인, 폴백 (fallback) 연계 기능을 제공합니다. Resilience4j, Hystrix, Istio, Polly 등 다양한 프레임워크와 통합되어 마이크로서비스, 분산 시스템, API 게이트웨이 환경에서 성능과 안정성을 강화합니다 (<a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">geeksforgeeks.org</a>).</p><hr><h2 id=5-핵심-개념-core-concepts>5. 핵심 개념 (Core Concepts)<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-core-concepts>#</a></h2><ul><li><strong>Closed 상태</strong>: 호출 허용, failure count 모니터링 (<a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">geeksforgeeks.org</a>)</li><li><strong>Open 상태</strong>: failure threshold 이상 시 즉시 실패 대응, 호출 차단 (<a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">geeksforgeeks.org</a>)</li><li><strong>Half‑Open 상태</strong>: Open 이후 일정 시간 경과 후 일부 호출을 테스트한 뒤 상태 복귀 결정 (<a href="https://www.graphapp.ai/blog/understanding-the-circuit-breaker-pattern-a-comprehensive-guide?utm_source=chatgpt.com" title="Understanding the Circuit Breaker Pattern: A Comprehensive Guide">graphapp.ai</a>)</li><li><strong>Failure Threshold</strong>: 실패율 (logic-errors/timeouts) 초과 기준</li><li><strong>Wait Duration</strong>: Open 유지 시간 (<a href="https://mobisoftinfotech.com/resources/blog/microservices/resilience4j-circuit-breaker-retry-bulkhead-spring-boot?utm_source=chatgpt.com" title="Resilience4j Circuit Breaker, Retry & Bulkhead Tutorial">mobisoftinfotech.com</a>)</li><li><strong>Permitted Calls in Half‑Open</strong>: 복귀 시도 제한 횟수 (<a href="https://mobisoftinfotech.com/resources/blog/microservices/resilience4j-circuit-breaker-retry-bulkhead-spring-boot?utm_source=chatgpt.com" title="Resilience4j Circuit Breaker, Retry & Bulkhead Tutorial">mobisoftinfotech.com</a>)</li><li><strong>Fallback</strong>: Circuit Open 또는 호출 실패 시 대체 로직 제공</li><li><strong>Metrics & Monitoring</strong>: 상태, 실패율, 호출 상태 등 실시간 수집 필수 (<a href="https://www.graphapp.ai/blog/understanding-the-circuit-breaker-pattern-a-comprehensive-guide?utm_source=chatgpt.com" title="Understanding the Circuit Breaker Pattern: A Comprehensive Guide">graphapp.ai</a>)</li></ul><h3 id=실무-연관성>실무 연관성<a hidden class=anchor aria-hidden=true href=#실무-연관성>#</a></h3><ul><li><strong>Resilience4j / Spring Boot</strong>: 세밀한 설정 및 actuator 통합 지원 (<a href="https://www.javacodegeeks.com/2024/11/improving-application-resilience-with-circuit-breaker-patterns-in-spring-boot.html?utm_source=chatgpt.com" title="Improving Application Resilience with Circuit Breaker Patterns in …">javacodegeeks.com</a>)</li><li><strong>Istio 등 서비스 메시</strong>: 인프라 레벨에서 호출 차단/복귀 제어</li><li><strong>Polly (.NET)</strong>: Circuit Breaker 전략 + Retry/Fallback 쉽게 구성 가능 (<a href="https://www.graphapp.ai/blog/understanding-the-circuit-breaker-pattern-a-comprehensive-guide?utm_source=chatgpt.com" title="Understanding the Circuit Breaker Pattern: A Comprehensive Guide">graphapp.ai</a>)</li></ul><hr><p>이제 다음 단계—<strong>배경 · 목적 · 특징</strong>, <strong>작동 원리 (다이어그램 포함)</strong>, <strong>구조 및 구성 요소</strong>, <strong>구현 기법</strong>, <strong>장단점 및 해결방안</strong>, <strong>도전 과제</strong>, <strong>분류 기준</strong>, <strong>실무 예시</strong>, <strong>활용 사례</strong>, <strong>코드 구현</strong>, <strong>최적화 · 주의사항</strong>, <strong>용어정리 · 참고/출처</strong>—로 바로 이어가겠습니다. 어떤 항목부터 시작하면 좋을까요?</p><p>이어서 <strong>Circuit Breaker Pattern</strong>의 다음 단계를 정리합니다: <strong>배경·목적·특징</strong>, <strong>작동 원리 다이어그램</strong>, <strong>구조 및 구성요소</strong>, <strong>구현 기법</strong>, <strong>장단점 및 해결방안</strong>, <strong>도전 과제</strong>.</p><hr><h2 id=6-배경-background>6. 배경 (Background)<a hidden class=anchor aria-hidden=true href=#6-배경-background>#</a></h2><ul><li>분산 시스템에서는 장애가 전파되어 전체 서비스에 악영향을 주는 **cascading failure(연쇄 장애)** 가 빈발합니다 (<a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">harsh05.medium.com</a>, <a href="https://arxiv.org/abs/1708.07422?utm_source=chatgpt.com" title="Resilience Design Patterns: A Structured Approach to Resilience at Extreme Scale">en.wikipedia.org</a>).</li><li>Circuit Breaker 는 이런 장애 확산을 방지하고 호출 대상이 회복할 시간을 제공하기 위해 고안된 패턴입니다.</li></ul><hr><h2 id=7-목적-및-필요성-purpose--need>7. 목적 및 필요성 (Purpose & Need)<a hidden class=anchor aria-hidden=true href=#7-목적-및-필요성-purpose--need>#</a></h2><ul><li><strong>장애 확산 방지</strong>: 실패하는 종속 서비스가 전체 시스템에 영향을 주는 것을 막습니다.</li><li><strong>리소스 보호</strong>: 비정상적 호출을 차단해 스레드풀이나 DB 연결 고갈 방지 (<a href="https://mobisoftinfotech.com/resources/blog/microservices/resilience4j-circuit-breaker-retry-bulkhead-spring-boot?utm_source=chatgpt.com" title="Resilience4j Circuit Breaker, Retry & Bulkhead Tutorial">dzone.com</a>)</li><li><strong>성능 안정성 확보</strong>: 장애 발생 시 응답 지연 없이 즉시 실패 처리로 UX 영향 최소화 (<a href="https://www.graphapp.ai/blog/understanding-the-circuit-breaker-pattern-a-comprehensive-guide?utm_source=chatgpt.com" title="Understanding the Circuit Breaker Pattern: A Comprehensive Guide">graphapp.ai</a>).</li><li><strong>복구 지원</strong>: Half‑Open 상태를 통해 일정 요청만 허용해 복구 판단 (<a href="https://www.javacodegeeks.com/2024/11/improving-application-resilience-with-circuit-breaker-patterns-in-spring-boot.html?utm_source=chatgpt.com" title="Improving Application Resilience with Circuit Breaker Patterns in …">resilience4j.readme.io</a>).</li></ul><hr><h2 id=8-특징-characteristics>8. 특징 (Characteristics)<a hidden class=anchor aria-hidden=true href=#8-특징-characteristics>#</a></h2><ul><li><strong>3 단계 상태 머신</strong>: Closed → Open → Half‑Open 전이 기반 호출 제어 (<a href="https://www.javacodegeeks.com/2024/11/improving-application-resilience-with-circuit-breaker-patterns-in-spring-boot.html?utm_source=chatgpt.com" title="Improving Application Resilience with Circuit Breaker Patterns in …">resilience4j.readme.io</a>).</li><li><strong>Sliding Window 기반 실패율 판단</strong>: 최근 호출 결과 집계로 threshold 초과 시 Open State 전환 (<a href="https://www.javacodegeeks.com/2024/11/improving-application-resilience-with-circuit-breaker-patterns-in-spring-boot.html?utm_source=chatgpt.com" title="Improving Application Resilience with Circuit Breaker Patterns in …">resilience4j.readme.io</a>).</li><li><strong>Fallback 지원</strong>: Open 또는 실패 시 백업 로직 수행 가능.</li><li><strong>프레임워크 및 서비스 메시 지원</strong>: Resilience4j, Hystrix, Polly, Istio 등 광범위하게 사용 (<a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">geeksforgeeks.org</a>).</li></ul><hr><h2 id=9-핵심-원리-및-작동-원리-operation--diagram>9. 핵심 원리 및 작동 원리 (Operation & Diagram)<a hidden class=anchor aria-hidden=true href=#9-핵심-원리-및-작동-원리-operation--diagram>#</a></h2><pre class=mermaid>stateDiagram-v2
    [*] --&gt; Closed
    Closed --&gt; Open : failureRate &gt; threshold
    Open --&gt; HalfOpen : waitDuration elapsed
    HalfOpen --&gt; Closed : testCalls succeed
    HalfOpen --&gt; Open : testCalls fail
</pre><ul><li><strong>Closed</strong>: 정상 호출, 실패 모니터링</li><li><strong>Open</strong>: 즉시 실패, 호출 차단</li><li><strong>Half‑Open</strong>: 제한된 테스트 호출 허용 후 상태 전환</li></ul><hr><h2 id=10-구조-및-구성요소-structure--components>10. 구조 및 구성요소 (Structure & Components)<a hidden class=anchor aria-hidden=true href=#10-구조-및-구성요소-structure--components>#</a></h2><table><thead><tr><th>유형</th><th>구성 요소</th><th>역할</th></tr></thead><tbody><tr><td>필수</td><td>CircuitBreaker</td><td>상태 머신 + threshold, window 설정</td></tr><tr><td></td><td>SlidingWindow</td><td>호출 결과 집계 및 통계 계산</td></tr><tr><td></td><td>CallInterceptor</td><td>호출 가로채고 상태에 따라 차단 또는 실행</td></tr><tr><td></td><td>StateTransitionManager</td><td>상태 전이 및 reset 예약 타이머</td></tr><tr><td>선택</td><td>FallbackHandler</td><td>실패 시 대체 동작 제공</td></tr><tr><td></td><td>MetricsCollector</td><td>state 변경, 실패율, 성공/실패 카운트 등 수집</td></tr><tr><td></td><td>AdminControl</td><td>강제 Open/Close 조작 가능</td></tr></tbody></table><p><strong>아키텍처 다이어그램:</strong></p><pre class=mermaid>classDiagram
class CircuitBreaker {
  +state
  +isCallPermitted()
  +onSuccess()
  +onFailure()
}
class SlidingWindow {
  +record(success)
  +failureRate()
}
class CallInterceptor {
  +invoke(callable)
}
class StateTransitionManager {
  +scheduleHalfOpen()
}
class FallbackHandler
class MetricsCollector
class AdminControl

CircuitBreaker --&gt; SlidingWindow
CircuitBreaker --&gt; StateTransitionManager
CallInterceptor --&gt; CircuitBreaker
CircuitBreaker --&gt; FallbackHandler
CircuitBreaker --&gt; MetricsCollector
AdminControl ..|&gt; CircuitBreaker
</pre><hr><h2 id=11-구현-기법-implementation-techniques>11. 구현 기법 (Implementation Techniques)<a hidden class=anchor aria-hidden=true href=#11-구현-기법-implementation-techniques>#</a></h2><ul><li><strong>Resilience4j + Spring Boot</strong><ul><li><code>CircuitBreakerConfig.custom()…build()</code> 방식 설정 후 <code>CircuitBreakerRegistry</code> 에 등록 (<a href="https://anshulgautam.in/blog/circuit-breaker-pattern-annotations/?utm_source=chatgpt.com" title="Circuit Breaker Pattern using Resilience4j Annotations">anshulgautam.in</a>, <a href="https://mobisoftinfotech.com/resources/blog/microservices/resilience4j-circuit-breaker-retry-bulkhead-spring-boot?utm_source=chatgpt.com" title="Resilience4j Circuit Breaker, Retry & Bulkhead Tutorial">dzone.com</a>)</li><li><code>@CircuitBreaker(name="…", fallbackMethod="…")</code> 어노테이션 사용</li></ul></li><li><strong>Polly (.NET)</strong><ul><li><code>Policy.Handle&lt;Exception>().CircuitBreakerAsync(…)</code> 형태 구성, <code>onBreak</code>, <code>onReset</code> 이벤트 핸들링</li></ul></li><li><strong>Istio Service Mesh</strong><ul><li>VirtualService 설정에 <code>circuitBreaker</code> 구성으로 트래픽 관리 가능 (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/circuit-breaker?utm_source=chatgpt.com" title="Circuit Breaker Pattern - Azure Architecture Center | Microsoft Learn">learn.microsoft.com</a>)</li></ul></li><li><strong>AWS Step Functions + DynamoDB</strong><ul><li>상태며 <code>CircuitStatus</code> 관리 후 Open 시 호출 중단 및 fallback 흐름 실행 (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/circuit-breaker.html?utm_source=chatgpt.com" title="Circuit breaker pattern - AWS Prescriptive Guidance">docs.aws.amazon.com</a>)</li></ul></li></ul><hr><h2 id=12-장점-benefits>12. 장점 (Benefits)<a hidden class=anchor aria-hidden=true href=#12-장점-benefits>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>장애 확산 방지</td><td>cascading failure 예방 (<a href="https://arxiv.org/abs/1708.07422?utm_source=chatgpt.com" title="Resilience Design Patterns: A Structured Approach to Resilience at Extreme Scale">en.wikipedia.org</a>)</td></tr><tr><td></td><td>리소스 절약</td><td>비정상 호출로부터 스레드/커넥션 보호</td></tr><tr><td></td><td>빠른 피드백</td><td>즉시 실패 처리로 응답 시간 지연 방지</td></tr><tr><td></td><td>graceful recovery</td><td>Half‑Open 상태 통해 서비스 회복 감지 및 복귀</td></tr></tbody></table><hr><h2 id=13-단점--문제점-및-해결방안>13. 단점 & 문제점 및 해결방안<a hidden class=anchor aria-hidden=true href=#13-단점--문제점-및-해결방안>#</a></h2><h3 id=단점-1>단점<a hidden class=anchor aria-hidden=true href=#단점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>민감도 설정 어려움</td><td>threshold 또는 window size 부적절 시 과잉 차단 또는 감지 실패</td><td>모니터링 기반 정책 조정</td></tr><tr><td></td><td>지연 문제 발생</td><td>Half‑Open 대기 중 잠정 실패 발생</td><td>test call 수 제한, fallback 로직</td></tr><tr><td></td><td>복잡성 증가</td><td>상태 추적 및 fallback 로직 구현 부담</td><td>프레임워크 사용, 구성 자동화</td></tr></tbody></table><h3 id=문제점-1>문제점<a hidden class=anchor aria-hidden=true href=#문제점-1>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방</th><th>해결 기법</th></tr></thead><tbody><tr><td>문제점</td><td>오인 차단</td><td>burst 오류 또는 env glitch</td><td>정상 요청 차단</td><td>호출 실패율 분석</td><td>fallback, rate limiter 조합</td><td>circuit breaker 및 fallback 분리</td></tr><tr><td></td><td>상태 불일관성</td><td>다중 인스턴스에서 상태 sync 안됨</td><td>일부만 차단, others 호출 허용</td><td>분산 tracing</td><td>shared registry / config sync</td><td>중앙 상태 저장</td></tr></tbody></table><hr><h2 id=14-도전-과제-challenges>14. 도전 과제 (Challenges)<a hidden class=anchor aria-hidden=true href=#14-도전-과제-challenges>#</a></h2><ul><li><strong>Threshold 자동 조정</strong>: 환경 변화에 따라 실시간 정책 수정 필요</li><li><strong>분산 상태 공유</strong>: 여러 인스턴스간 CB 상태 동기화</li><li><strong>Fallback 복잡성</strong>: 복합 서비스 호출 시 대체 처리 설계</li><li><strong>관측성 확보</strong>: state 전이, 호출 실패율 등 관찰 위한 모니터링 필요</li></ul><hr><p>다음 단계로 <strong>분류 기준에 따른 유형</strong>, <strong>실무 사용 예시</strong>, <strong>활용 사례 다이어그램</strong>, <strong>코드 구현 (Python/JS)</strong>, <strong>최적화 고려사항</strong>, <strong>용어정리 + 참고 및 출처</strong>까지 바로 이어서 작성하겠습니다! 어떤 항목을 먼저 시작할까요?</p><p>이어서 <strong>Circuit Breaker Pattern</strong>의 나머지 항목들—분류 유형, 실무 예시, 활용 사례, 코드 구현, 최적화 고려사항, 용어 및 참고—를 정리합니다.</p><hr><h2 id=16-분류-기준에-따른-유형-classification-types>16. 분류 기준에 따른 유형 (Classification Types)<a hidden class=anchor aria-hidden=true href=#16-분류-기준에-따른-유형-classification-types>#</a></h2><table><thead><tr><th>기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>구현 위치</td><td>Application-level</td><td>Resilience4j·Hystrix 등 라이브러리 사용</td></tr><tr><td></td><td>Infrastructure-level</td><td>Istio, Envoy 등 서비스 메쉬 단</td></tr><tr><td>동작 방식</td><td>Time-based</td><td>고정 또는 점증 오픈 유지 시간</td></tr><tr><td></td><td>Count-based</td><td>실패 횟수 기준 트리거</td></tr><tr><td>조합 전략</td><td>단독 사용</td><td>Fallback 없이 차단만 수행</td></tr><tr><td></td><td>복합 전략</td><td>Retry, Fallback 등과 함께 사용</td></tr></tbody></table><p><strong>설명</strong></p><ul><li><em>Application-level</em>은 코드에서 직접 구성, <em>Infrastructure-level</em>은 네트워크 레이어에서 자동 제어</li><li><em>Time-based</em>는 시간 기반 상태 전이, <em>Count-based</em>는 실패 카운팅 기반</li><li><em>Combining</em>은 시스템 회복력 강화를 위한 패턴 통합 (<a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">geeksforgeeks.org</a>, <a href="https://arxiv.org/abs/1708.07422?utm_source=chatgpt.com" title="Resilience Design Patterns: A Structured Approach to Resilience at Extreme Scale">numberanalytics.com</a>, <a href="https://mobisoftinfotech.com/resources/blog/microservices/resilience4j-circuit-breaker-retry-bulkhead-spring-boot?utm_source=chatgpt.com" title="Resilience4j Circuit Breaker, Retry & Bulkhead Tutorial">squash.io</a>)</li></ul><hr><h2 id=17-실무-사용-예시>17. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#17-실무-사용-예시>#</a></h2><table><thead><tr><th>주체</th><th>목적</th><th>구현 방식</th><th>효과</th></tr></thead><tbody><tr><td>Spring Boot + Resilience4j</td><td>외부 결제 API 장애 방지</td><td><code>@CircuitBreaker</code>, Fallback</td><td>호출 실패 즉시 대체 응답 제공</td></tr><tr><td>.NET Polly</td><td>외부 HTTP 호출 보호</td><td><code>Policy.Handle&lt;Exception>().CircuitBreakerAsync(…)</code></td><td>재시도 반복 유도 방지 (<a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">geeksforgeeks.org</a>, <a href="https://www.graphapp.ai/blog/understanding-the-circuit-breaker-pattern-a-comprehensive-guide?utm_source=chatgpt.com" title="Understanding the Circuit Breaker Pattern: A Comprehensive Guide">graphapp.ai</a>, <a href="https://www.javacodegeeks.com/2024/11/improving-application-resilience-with-circuit-breaker-patterns-in-spring-boot.html?utm_source=chatgpt.com" title="Improving Application Resilience with Circuit Breaker Patterns in …">docs.aws.amazon.com</a>)</td></tr><tr><td>Istio Service Mesh</td><td>네트워크 호출 보호</td><td>VirtualService 내 <code>circuitBreaker</code> 설정</td><td>메시 전체에 장애 전파 방지</td></tr><tr><td>Python Flask + pybreaker</td><td>외부 API 장애 관리</td><td><code>CircuitBreaker</code> 클래스 사용</td><td>오류 시 기본 응답으로 우아한 종료</td></tr></tbody></table><hr><h2 id=18-활용-사례>18. 활용 사례<a hidden class=anchor aria-hidden=true href=#18-활용-사례>#</a></h2><h3 id=a-결제-서비스-장애-대응>A. 결제 서비스 장애 대응<a hidden class=anchor aria-hidden=true href=#a-결제-서비스-장애-대응>#</a></h3><ul><li><strong>시나리오</strong>: 결제 API 지연 또는 오류가 발생할 때, 주문 시스템 전체가 지연되는 문제</li><li><strong>구성 요소</strong>:<ul><li>Circuit Breaker 설정:<ul><li>실패 임계치 5 회</li><li>Open 상태 유지 60 초</li><li>Half‑Open 시도 3 회</li></ul></li><li>Fallback 로직: " 결제 지연 중입니다 " 메시지 반환</li></ul></li><li><strong>Workflow</strong>:</li></ul><pre class=mermaid>sequenceDiagram
  participant OrderService
  participant CB as CircuitBreaker
  participant PaymentAPI
  participant Fallback
  OrderService-&gt;&gt;CB: processPayment()
  CB-&gt;&gt;PaymentAPI: 호출
  alt 성공
    PaymentAPI--&gt;&gt;CB: OK
    CB--&gt;&gt;OrderService: 성공
  else 실패 반복
    CB 켜짐(Open)
    CB--&gt;&gt;Fallback: fallback()
    Fallback--&gt;&gt;OrderService: 지연 응답
  end
</pre><ul><li><strong>비교</strong>:<ul><li><strong>미도입</strong>: 무한 재시도로 API 병목 및 주문 지연 발생</li><li><strong>도입</strong>: Open 상태에서 즉시 대체 응답으로 UX 유지</li></ul></li></ul><hr><h2 id=19-구현-예시-python--javascript>19. 구현 예시 (Python & JavaScript)<a hidden class=anchor aria-hidden=true href=#19-구현-예시-python--javascript>#</a></h2><h3 id=python-pybreaker-활용>Python (pybreaker 활용)<a hidden class=anchor aria-hidden=true href=#python-pybreaker-활용>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pybreaker</span> <span class=kn>import</span> <span class=n>CircuitBreaker</span><span class=p>,</span> <span class=n>CircuitBreakerError</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cb</span> <span class=o>=</span> <span class=n>CircuitBreaker</span><span class=p>(</span><span class=n>fail_max</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>reset_timeout</span><span class=o>=</span><span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>call_payment</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cb</span><span class=o>.</span><span class=n>call</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;https://pay/api&#34;</span><span class=p>,</span> <span class=n>json</span><span class=o>=...</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>CircuitBreakerError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span><span class=s2>&#34;pending&#34;</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span><span class=s2>&#34;지연 중입니다.&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=javascript-opossum>JavaScript (Opossum)<a hidden class=anchor aria-hidden=true href=#javascript-opossum>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5>5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>CircuitBreaker</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@redhat/opossum&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>timeout</span><span class=o>:</span><span class=mi>2000</span><span class=p>,</span> <span class=nx>errorThresholdPercentage</span><span class=o>:</span><span class=mi>50</span><span class=p>,</span> <span class=nx>resetTimeout</span><span class=o>:</span><span class=mi>60000</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>breaker</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CircuitBreaker</span><span class=p>(</span><span class=nx>paymentCall</span><span class=p>,</span> <span class=nx>options</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>breaker</span><span class=p>.</span><span class=nx>fallback</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>({</span> <span class=nx>status</span><span class=o>:</span><span class=s1>&#39;pending&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=o>:</span><span class=s1>&#39;지연 중입니다.&#39;</span> <span class=p>}));</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=20-실무에서-효과적인-적용-고려사항-및-주의점>20. 실무에서 효과적인 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#20-실무에서-효과적인-적용-고려사항-및-주의점>#</a></h2><table><thead><tr><th>항목</th><th>고려 사항</th><th>권장사항</th></tr></thead><tbody><tr><td>Threshold 설정</td><td>임계치가 너무 낮거나 높으면 의미 상실</td><td>실제 실패율 기준 튜닝</td></tr><tr><td>Fallback 구현</td><td>단순 오류 숨기기만 하면 분석 어려움</td><td>사용자 경험 및 로깅 포함</td></tr><tr><td>Half‑Open 전략</td><td>테스트 호출 과할 경우 연쇄 실패 가능</td><td>소수 요청만 허용</td></tr><tr><td>모니터링</td><td>상태 전이/호출 수 기록이 없으면 운영 어려움</td><td>상태 이벤트 및 메트릭 수집</td></tr><tr><td>분산 환경</td><td>다수 인스턴스 CB 상태 동기화 필요</td><td>공유 저장소 또는 메시 동기화</td></tr></tbody></table><hr><h2 id=21-최적화-고려사항-및-주의점>21. 최적화 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#21-최적화-고려사항-및-주의점>#</a></h2><table><thead><tr><th>항목</th><th>고려 사항</th><th>권장사항</th></tr></thead><tbody><tr><td>자동 튜닝</td><td>고정 설정은 장기 운영에서 비효율</td><td>메트릭 기반 threshold 자동 조정</td></tr><tr><td>상태 동기화</td><td>스레드/프로세스 별 CB 상태 차이로 오작동 가능</td><td>중앙 저장소 또는 시그널 서비스 활용</td></tr><tr><td>이벤트 폭주</td><td>상태 전이 이벤트가 많으면 모니터링 시스템 부담</td><td>이벤트 sampling 적용</td></tr><tr><td>정책 조합</td><td>Retry/Fallback 연계 시 영향 주의</td><td>흐름 순서 명확히 구성</td></tr></tbody></table><hr><h2 id=22-용어-정리>22. 용어 정리<a hidden class=anchor aria-hidden=true href=#22-용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>Resilience</td><td>Closed</td><td>정상 호출 상태</td></tr><tr><td>Resilience</td><td>Open</td><td>장애 차단 상태</td></tr><tr><td>Resilience</td><td>Half‑Open</td><td>복귀 시도 상태</td></tr><tr><td>Resilience</td><td>Failure Threshold</td><td>실패율 임계치</td></tr><tr><td>Resilience</td><td>Reset Timeout (Wait Duration)</td><td>Open 유지 시간</td></tr><tr><td>Resilience</td><td>Permitted Calls</td><td>Half‑Open 상태에서 허용 요청 수</td></tr><tr><td>Resilience</td><td>Fallback</td><td>실패 시 대체 응답</td></tr></tbody></table><hr><h2 id=23-참고-및-출처>23. 참고 및 출처<a hidden class=anchor aria-hidden=true href=#23-참고-및-출처>#</a></h2><ul><li>[Azure Architecture Center: Circuit Breaker] (<a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">en.wikipedia.org</a>, <a href="https://anshulgautam.in/blog/circuit-breaker-pattern-annotations/?utm_source=chatgpt.com" title="Circuit Breaker Pattern using Resilience4j Annotations">learn.microsoft.com</a>, <a href="https://arxiv.org/abs/1708.07422?utm_source=chatgpt.com" title="Resilience Design Patterns: A Structured Approach to Resilience at Extreme Scale">numberanalytics.com</a>, <a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">geeksforgeeks.org</a>, <a href="https://www.graphapp.ai/blog/understanding-the-circuit-breaker-pattern-a-comprehensive-guide?utm_source=chatgpt.com" title="Understanding the Circuit Breaker Pattern: A Comprehensive Guide">graphapp.ai</a>)</li><li>[GeeksforGeeks: Circuit Breaker in Microservices] (<a href="https://www.geeksforgeeks.org/what-is-circuit-breaker-pattern-in-microservices/?utm_source=chatgpt.com" title="What is Circuit Breaker Pattern in Microservices? - GeeksforGeeks">geeksforgeeks.org</a>)</li><li>[Wikipedia: Circuit breaker design pattern] (<a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/circuit-breaker?utm_source=chatgpt.com" title="Circuit Breaker Pattern - Azure Architecture Center | Microsoft Learn">en.wikipedia.org</a>)</li><li>[Polly Documentation: Circuit Breaker Strategy] (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/circuit-breaker.html?utm_source=chatgpt.com" title="Circuit breaker pattern - AWS Prescriptive Guidance">pollydocs.org</a>)</li><li>[Medium: Enhancing Microservice Resilience with Circuit Breaker] (<a href="https://medium.com/%40sarkarpabitra1999/enhancing-microservice-resilience-with-the-circuit-breaker-pattern-in-python-and-java-f04395e07b99?utm_source=chatgpt.com" title="Enhancing Microservice Resilience with the Circuit Breaker Pattern …">medium.com</a>)</li><li>[Microsoft Learn: Implementing Circuit Breaker in.NET] (<a href="https://learn.microsoft.com/en-us/dotnet/architecture/microservices/implement-resilient-applications/implement-circuit-breaker-pattern?utm_source=chatgpt.com" title="Implementing the Circuit Breaker pattern -.NET | Microsoft Learn">learn.microsoft.com</a>)</li><li>[Number Analytics: Mastering Circuit Breaker Pattern] (<a href="https://arxiv.org/abs/1708.07422?utm_source=chatgpt.com" title="Resilience Design Patterns: A Structured Approach to Resilience at Extreme Scale">numberanalytics.com</a>)</li></ul><hr><p>원하시는 <strong>추가 심화 예시</strong>나 <strong>도구/언어 커스텀 코드</strong>, <strong>정책 자동화 방법</strong> 관련 요청 있으시면 알려주세요!</p><p>이어서 <strong>Circuit Breaker Pattern</strong>의 마지막 주요 항목들을 정리했습니다:</p><hr><h2 id=-24-통합-패턴-비교-및-조합-전략>🚀 24. 통합 패턴 비교 및 조합 전략<a hidden class=anchor aria-hidden=true href=#-24-통합-패턴-비교-및-조합-전략>#</a></h2><p>다른 회복성 패턴과 <strong>Circuit Breaker</strong>를 비교하고, 효율적으로 조합하는 전략을 정리했습니다.</p><table><thead><tr><th>패턴</th><th>역할</th><th>조합 전략 예시</th></tr></thead><tbody><tr><td><strong>Retry</strong></td><td>일시적 오류에 반복 시도 시도</td><td>Circuit Breaker → Retry → Fallback 순으로 구성 (<code>CB</code> 가 닫혀 있을 때만 재시도)</td></tr><tr><td><strong>Hedging</strong></td><td>지연 및 불확실성에서 빠른 응답 확보</td><td>Circuit Breaker 내부/외부에서 핸들 가능, <code>Open</code> 상태에서는 헤징 호출 차단</td></tr><tr><td><strong>Fallback</strong></td><td>오류 시 대체 로직 제공</td><td>Circuit Open 또는 호출 실패 시 로직 실행, <code>Retry/Hedging</code> 보다 선행 적용</td></tr><tr><td><strong>Timeout</strong></td><td>응답 지연에 대해 빠른 종료 처리</td><td>Circuit Breaker 와 함께 동작 → Timeout 실패 시 CB 에 기록</td></tr></tbody></table><p><strong>설명</strong></p><ul><li>개별 패턴만 사용할 때보다 조합 시 시스템 안정성과 사용자 경험을 균형 있게 확보할 수 있습니다.</li><li><strong>예시 워크플로우</strong>:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[Request] → [Circuit Breaker] → [Timeout] → [Retry] → [Fallback]
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=-25-정책-자동화--튜닝-가이드>🎯 25. 정책 자동화 & 튜닝 가이드<a hidden class=anchor aria-hidden=true href=#-25-정책-자동화--튜닝-가이드>#</a></h2><ul><li><strong>Adaptive Thresholding</strong>: 실패율 증가 시 threshold 자동 확대, 감소 시 축소하는 로직 적용</li><li><strong>Auto-scaling & CB</strong>: 트래픽 증가 시 CB threshold 를 동적으로 조정하여 과도 차단 방지</li><li><strong>ML 기반 anomaly detection</strong>: 통계 기반 CB 설정 시 비정상 패턴 탐지에 적용</li></ul><hr><h2 id=-최종-요약--추천>📌 최종 요약 & 추천<a hidden class=anchor aria-hidden=true href=#-최종-요약--추천>#</a></h2><ul><li><strong>Circuit Breaker</strong>는 분산 시스템에서 장애 확산을 방지하고 서비스 안정성과 신뢰성을 확보하는 핵심 패턴입니다.</li><li>적절한 <strong>threshold</strong> 및 <strong>재복귀 전략 (Half‑Open)</strong> 설정이 관건이며, <strong>Retry/Hedging/Fallback/Timeout</strong> 등 다른 패턴과 조합하면 회복성과 사용자 경험을 극대화할 수 있습니다.</li><li>실시간 <strong>모니터링</strong>, <strong>정책 자동 조정</strong>, <strong>분산 상태 동기화</strong>는 운영 환경에서 안정화의 핵심 요소입니다.</li></ul><hr><p>원하시는 추가 항목 (예: <strong>ML 기반 정책 조정 예시</strong>, <strong>Go 언어 기반 구현 예시</strong>, <strong>Policy 중심 대시보드 설계</strong>) 있으시면 언제든 요청해 주세요!</p><p>네, Circuit Breaker Pattern 에 대해 체계적으로 조사하고 분석해보겠습니다. 먼저 최신 정보를 수집하기 위해 웹 검색을 진행하겠습니다.</p><h2 id=circuit-breaker-pattern-종합-분석>Circuit Breaker Pattern 종합 분석<a hidden class=anchor aria-hidden=true href=#circuit-breaker-pattern-종합-분석>#</a></h2><h3 id=1-태그-tags-1>1. 태그 (Tags)<a hidden class=anchor aria-hidden=true href=#1-태그-tags-1>#</a></h3><ul><li><strong>Circuit-Breaker-Pattern</strong></li><li><strong>Microservices-Resilience</strong></li><li><strong>Fault-Tolerance</strong></li><li><strong>Distributed-Systems</strong></li></ul><h3 id=2-분류-구조-검증>2. 분류 구조 검증<a hidden class=anchor aria-hidden=true href=#2-분류-구조-검증>#</a></h3><p>제시된 분류 &ldquo;Computer Science and Engineering > Software Engineering > Design and Architecture > Architecture Patterns > Resilience Patterns&rdquo; 는 <strong>매우 적절</strong>합니다.</p><p><strong>근거:</strong></p><ul><li>Circuit Breaker Pattern 은 소프트웨어 아키텍처 설계 패턴의 한 종류</li><li>특히 분산 시스템의 복원력 (Resilience) 을 강화하는 패턴</li><li>마이크로서비스 아키텍처에서 장애 전파 방지를 위한 핵심 패턴</li><li>시스템의 안정성과 내결함성을 향상시키는 아키텍처 패턴</li></ul><h3 id=3-요약-설명-200-자-내외>3. 요약 설명 (200 자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-설명-200-자-내외>#</a></h3><p>Circuit Breaker Pattern 은 분산 시스템에서 서비스 간 통신 실패를 감지하고 관리하는 디자인 패턴입니다. 전기 회로 차단기처럼 작동하여 장애가 발생한 서비스에 대한 요청을 일시적으로 차단함으로써 연쇄 장애를 방지하고 시스템의 전체적인 안정성과 복원력을 향상시킵니다.</p><h3 id=4-전체-개요-250-자-내외>4. 전체 개요 (250 자 내외)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-250-자-내외>#</a></h3><p>Circuit Breaker Pattern 은 마이크로서비스 아키텍처에서 필수적인 복원력 패턴으로, Closed, Open, Half-Open 의 세 가지 상태를 통해 장애 상황을 관리합니다. 장애가 발생한 서비스로의 반복적인 요청을 차단하여 리소스 낭비를 방지하고, Fallback 메커니즘을 통해 우아한 성능 저하 (Graceful Degradation) 를 제공합니다. Netflix Hystrix, Resilience4j 등의 라이브러리로 구현 가능하며, 현대 클라우드 네이티브 애플리케이션의 핵심 구성 요소입니다.</p><hr><h2 id=5-핵심-개념-1>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념-1>#</a></h2><h3 id=51-기본-개념>5.1 기본 개념<a hidden class=anchor aria-hidden=true href=#51-기본-개념>#</a></h3><ul><li><strong>Circuit Breaker (회로 차단기)</strong>: 전기 회로 차단기에서 영감을 받은 소프트웨어 디자인 패턴</li><li><strong>Fault Tolerance (내결함성)</strong>: 시스템이 장애에도 불구하고 계속 작동할 수 있는 능력</li><li><strong>Cascading Failure (연쇄 장애)</strong>: 하나의 장애가 다른 시스템으로 전파되어 전체 시스템 장애를 일으키는 현상</li><li><strong>Resilience (복원력)</strong>: 시스템이 장애로부터 빠르게 회복할 수 있는 능력</li><li><strong>Graceful Degradation (우아한 성능 저하)</strong>: 일부 기능이 실패해도 핵심 기능은 유지하는 설계 원칙</li></ul><h3 id=52-실무-구현을-위한-연관-개념>5.2 실무 구현을 위한 연관 개념<a hidden class=anchor aria-hidden=true href=#52-실무-구현을-위한-연관-개념>#</a></h3><ul><li><strong>State Machine (상태 머신)</strong>: Closed, Open, Half-Open 상태 관리</li><li><strong>Threshold Configuration (임계값 설정)</strong>: 장애 감지를 위한 기준값 설정</li><li><strong>Timeout Management (타임아웃 관리)</strong>: 응답 시간 기반 장애 판단</li><li><strong>Fallback Mechanism (대체 메커니즘)</strong>: 장애 시 대안 동작 정의</li><li><strong>Monitoring and Metrics (모니터링 및 메트릭)</strong>: 시스템 상태 추적 및 분석</li></ul><hr><h2 id=6-주제와-관련하여-조사할-내용>6. 주제와 관련하여 조사할 내용<a hidden class=anchor aria-hidden=true href=#6-주제와-관련하여-조사할-내용>#</a></h2><h3 id=61-배경>6.1 배경<a hidden class=anchor aria-hidden=true href=#61-배경>#</a></h3><p>Circuit Breaker Pattern 은 <strong>Michael Nygard</strong>가 저서 &ldquo;Release It!&rdquo; 에서 처음 체계화한 패턴으로, 분산 시스템의 복잡성이 증가하면서 필수적인 패턴이 되었습니다. 마이크로서비스 아키텍처의 확산과 함께 <strong>Netflix</strong>에서 Hystrix 라이브러리를 통해 실용화되었으며, 현재는 클라우드 네이티브 애플리케이션의 표준 패턴으로 자리잡았습니다.</p><h3 id=62-목적-및-필요성>6.2 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#62-목적-및-필요성>#</a></h3><p><strong>주요 목적:</strong></p><ul><li>연쇄 장애 (Cascading Failure) 방지</li><li>시스템 자원 보호 및 효율적 활용</li><li>빠른 실패 (Fail-Fast) 구현을 통한 응답성 향상</li><li>장애 서비스의 복구 시간 확보</li></ul><p><strong>필요성:</strong></p><ul><li>분산 시스템에서 서비스 간 의존성으로 인한 장애 전파 위험</li><li>네트워크 지연, 타임아웃으로 인한 리소스 고갈 방지</li><li>사용자 경험 개선을 위한 안정적인 서비스 제공</li><li>마이크로서비스 환경에서의 복원력 강화</li></ul><h3 id=63-주요-기능-및-역할>6.3 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#63-주요-기능-및-역할>#</a></h3><p><strong>핵심 기능:</strong></p><ul><li><strong>장애 감지</strong>: 연속적인 실패 모니터링</li><li><strong>요청 차단</strong>: 장애 서비스로의 요청 임시 중단</li><li><strong>상태 관리</strong>: 세 가지 상태 (Closed, Open, Half-Open) 전환</li><li><strong>자동 복구</strong>: 서비스 상태 확인 후 정상 운영 재개</li><li><strong>Fallback 실행</strong>: 대체 동작 수행</li></ul><p><strong>시스템에서의 역할:</strong></p><ul><li><strong>Proxy 역할</strong>: 서비스 호출을 감싸는 래퍼 기능</li><li><strong>Guard 역할</strong>: 시스템 보호를 위한 방어막</li><li><strong>Monitor 역할</strong>: 서비스 상태 지속적 감시</li><li><strong>Decision Maker 역할</strong>: 요청 허용/차단 결정</li></ul><h3 id=64-특징>6.4 특징<a hidden class=anchor aria-hidden=true href=#64-특징>#</a></h3><ul><li><strong>상태 기반 동작</strong>: 명확한 상태 전환 로직</li><li><strong>설정 가능한 임계값</strong>: 비즈니스 요구사항에 맞는 조정 가능</li><li><strong>실시간 모니터링</strong>: 지속적인 서비스 상태 추적</li><li><strong>자동화된 복구</strong>: 수동 개입 없는 자동 상태 전환</li><li><strong>경량화</strong>: 최소한의 오버헤드로 구현 가능</li></ul><h3 id=65-핵심-원칙>6.5 핵심 원칙<a hidden class=anchor aria-hidden=true href=#65-핵심-원칙>#</a></h3><ol><li><strong>Fail Fast</strong>: 장애 상황에서 빠른 실패 제공</li><li><strong>Isolation</strong>: 장애 격리를 통한 전파 방지</li><li><strong>Monitoring</strong>: 지속적인 상태 감시</li><li><strong>Recovery</strong>: 자동 복구 메커니즘</li><li><strong>Fallback</strong>: 대체 동작 제공</li></ol><h3 id=66-주요-원리>6.6 주요 원리<a hidden class=anchor aria-hidden=true href=#66-주요-원리>#</a></h3><p><strong>상태 전환 원리:</strong></p><pre class=mermaid>stateDiagram-v2
    [*] --&gt; Closed
    Closed --&gt; Open : 임계값 초과 실패
    Open --&gt; HalfOpen : 타임아웃 후
    HalfOpen --&gt; Closed : 성공
    HalfOpen --&gt; Open : 실패
    Open --&gt; [*]
    Closed --&gt; [*]
    HalfOpen --&gt; [*]
</pre><p><strong>동작 원리:</strong></p><ol><li><strong>정상 상태 (Closed)</strong>: 모든 요청 통과, 실패율 모니터링</li><li><strong>실패 감지</strong>: 설정된 임계값 초과 시 상태 전환</li><li><strong>차단 상태 (Open)</strong>: 모든 요청 즉시 실패 반환</li><li><strong>복구 확인 (Half-Open)</strong>: 제한된 테스트 요청 허용</li><li><strong>상태 결정</strong>: 테스트 결과에 따른 최종 상태 전환</li></ol><h3 id=67-작동-원리>6.7 작동 원리<a hidden class=anchor aria-hidden=true href=#67-작동-원리>#</a></h3><p><strong>Circuit Breaker 작동 플로우:</strong></p><pre class=mermaid>flowchart TD
    A[서비스 호출 요청] --&gt; B{Circuit Breaker 상태 확인}
    B --&gt;|Closed| C[실제 서비스 호출]
    B --&gt;|Open| D[즉시 Fallback 실행]
    B --&gt;|Half-Open| E[제한된 테스트 호출]
    
    C --&gt; F{호출 성공?}
    F --&gt;|성공| G[응답 반환]
    F --&gt;|실패| H[실패 카운트 증가]
    
    H --&gt; I{임계값 초과?}
    I --&gt;|예| J[Open 상태로 전환]
    I --&gt;|아니오| G
    
    E --&gt; K{테스트 호출 성공?}
    K --&gt;|성공| L[Closed 상태로 전환]
    K --&gt;|실패| M[Open 상태로 전환]
    
    D --&gt; N[Fallback 응답 반환]
    J --&gt; O[타임아웃 타이머 시작]
    O --&gt; P[Half-Open으로 전환]
</pre><h3 id=68-구조-및-아키텍처>6.8 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#68-구조-및-아키텍처>#</a></h3><p><strong>필수 구성요소:</strong></p><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th></tr></thead><tbody><tr><td><strong>State Manager</strong></td><td>상태 관리</td><td>Closed/Open/Half-Open 상태 전환 및 유지</td></tr><tr><td><strong>Failure Counter</strong></td><td>실패 추적</td><td>연속 실패 횟수 및 실패율 계산</td></tr><tr><td><strong>Timer</strong></td><td>시간 관리</td><td>타임아웃 및 대기 시간 관리</td></tr><tr><td><strong>Configuration</strong></td><td>설정 관리</td><td>임계값, 타임아웃 등 파라미터 설정</td></tr></tbody></table><p><strong>선택 구성요소:</strong></p><table><thead><tr><th>구성요소</th><th>기능</th><th>역할</th></tr></thead><tbody><tr><td><strong>Metrics Collector</strong></td><td>메트릭 수집</td><td>성능 지표 및 통계 데이터 수집</td></tr><tr><td><strong>Fallback Handler</strong></td><td>대체 처리</td><td>장애 시 대안 동작 수행</td></tr><tr><td><strong>Event Listener</strong></td><td>이벤트 처리</td><td>상태 변경 시 알림 및 로깅</td></tr><tr><td><strong>Health Check</strong></td><td>상태 확인</td><td>서비스 건강 상태 주기적 점검</td></tr></tbody></table><p><strong>시스템 아키텍처:</strong></p><pre class=mermaid>graph TB
    subgraph &#34;Client Application&#34;
        A[Service Call]
    end
    
    subgraph &#34;Circuit Breaker&#34;
        B[Request Interceptor]
        C[State Manager]
        D[Failure Counter]
        E[Timer]
        F[Configuration]
        G[Fallback Handler]
    end
    
    subgraph &#34;Target Service&#34;
        H[External Service]
    end
    
    A --&gt; B
    B --&gt; C
    C --&gt; D
    C --&gt; E
    C --&gt; F
    C --&gt; G
    B --&gt; H
    B --&gt; G
</pre><h3 id=69-구현-기법>6.9 구현 기법<a hidden class=anchor aria-hidden=true href=#69-구현-기법>#</a></h3><p><strong>1. Library-based 구현</strong></p><ul><li><strong>정의</strong>: 기존 라이브러리를 활용한 구현 방식</li><li><strong>구성</strong>: Hystrix, Resilience4j, Polly 등 활용</li><li><strong>목적</strong>: 빠른 구현과 검증된 기능 활용</li><li><strong>실제 예시</strong>: Spring Boot + Resilience4j 조합</li></ul><p><strong>2. Custom 구현</strong></p><ul><li><strong>정의</strong>: 직접 구현하는 방식</li><li><strong>구성</strong>: 상태 머신, 카운터, 타이머 직접 구현</li><li><strong>목적</strong>: 특수한 요구사항 충족</li><li><strong>실제 예시</strong>: 특정 프로토콜이나 프레임워크에 최적화된 구현</li></ul><p><strong>3. Infrastructure 기반 구현</strong></p><ul><li><strong>정의</strong>: 인프라스트럭처 레벨에서 구현</li><li><strong>구성</strong>: Service Mesh(Istio), API Gateway 활용</li><li><strong>목적</strong>: 애플리케이션 코드 변경 없이 적용</li><li><strong>실제 예시</strong>: Istio Envoy Proxy 의 Circuit Breaker 기능</li></ul><p><strong>4. Annotation 기반 구현</strong></p><ul><li><strong>정의</strong>: 어노테이션을 통한 선언적 구현</li><li><strong>구성</strong>: Spring AOP, AspectJ 활용</li><li><strong>목적</strong>: 코드 침투성 최소화</li><li><strong>실제 예시</strong>: @CircuitBreaker 어노테이션 사용</li></ul><h3 id=610-장점>6.10 장점<a hidden class=anchor aria-hidden=true href=#610-장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td><strong>연쇄 장애 방지</strong></td><td>하나의 서비스 장애가 전체 시스템으로 전파되는 것을 차단하여 시스템 안정성 확보</td></tr><tr><td></td><td><strong>빠른 실패 제공</strong></td><td>장애 상황에서 즉시 실패를 반환하여 응답 시간 단축 및 사용자 경험 개선</td></tr><tr><td></td><td><strong>리소스 보호</strong></td><td>장애 서비스로의 불필요한 요청을 차단하여 CPU, 메모리, 네트워크 리소스 절약</td></tr><tr><td></td><td><strong>자동 복구</strong></td><td>서비스 복구 시 자동으로 정상 상태로 전환하여 수동 개입 없이 서비스 재개</td></tr><tr><td></td><td><strong>우아한 성능 저하</strong></td><td>Fallback 메커니즘을 통해 핵심 기능은 유지하면서 부가 기능만 제한적으로 제공</td></tr><tr><td></td><td><strong>모니터링 강화</strong></td><td>실시간 상태 추적을 통해 시스템 건강 상태 파악 및 예방적 조치 가능</td></tr></tbody></table><h3 id=611-단점과-문제점-그리고-해결방안>6.11 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#611-단점과-문제점-그리고-해결방안>#</a></h3><p><strong>단점:</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td><strong>복잡성 증가</strong></td><td>시스템에 추가적인 로직과 상태 관리가 필요하여 복잡도 상승</td><td>검증된 라이브러리 사용, 명확한 설계 문서화</td></tr><tr><td></td><td><strong>잘못된 트리핑</strong></td><td>임시적 장애를 영구적 장애로 오판하여 불필요한 서비스 차단</td><td>적절한 임계값 설정, 동적 임계값 조정</td></tr><tr><td></td><td><strong>설정 어려움</strong></td><td>임계값, 타임아웃 등 파라미터 최적화의 복잡성</td><td>모니터링 데이터 기반 조정, A/B 테스트</td></tr><tr><td></td><td><strong>Fallback 한계</strong></td><td>모든 상황에 대한 적절한 대체 동작 정의의 어려움</td><td>비즈니스 우선순위 기반 Fallback 전략 수립</td></tr></tbody></table><p><strong>문제점:</strong></p><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td><strong>False Positive</strong></td><td>부적절한 임계값 설정</td><td>정상 서비스 차단</td><td>메트릭 분석, 알람 설정</td><td>적응형 임계값 사용</td><td>동적 조정 알고리즘 적용</td></tr><tr><td></td><td><strong>State Synchronization</strong></td><td>다중 인스턴스 환경에서 상태 불일치</td><td>일관성 없는 동작</td><td>분산 모니터링</td><td>중앙화된 상태 관리</td><td>Redis, Hazelcast 등 활용</td></tr><tr><td></td><td><strong>Performance Overhead</strong></td><td>추가적인 처리 로직</td><td>응답 시간 증가</td><td>성능 테스트</td><td>효율적인 알고리즘 사용</td><td>비동기 처리, 캐싱</td></tr><tr><td></td><td><strong>Configuration Drift</strong></td><td>환경별 설정 차이</td><td>예상과 다른 동작</td><td>설정 검증</td><td>환경별 설정 표준화</td><td>Infrastructure as Code</td></tr></tbody></table><h3 id=612-도전-과제>6.12 도전 과제<a hidden class=anchor aria-hidden=true href=#612-도전-과제>#</a></h3><p><strong>1. 마이크로서비스 환경에서의 복잡성</strong></p><ul><li><strong>원인</strong>: 서비스 간 복잡한 의존 관계</li><li><strong>영향</strong>: 최적 설정 어려움, 디버깅 복잡성</li><li><strong>해결방안</strong>: Service Mesh 활용, 의존성 맵핑</li></ul><p><strong>2. 클라우드 네이티브 환경 적응</strong></p><ul><li><strong>원인</strong>: 동적 스케일링, 컨테이너 환경</li><li><strong>영향</strong>: 상태 관리 어려움, 설정 복잡성</li><li><strong>해결방안</strong>: 클라우드 네이티브 라이브러리 사용</li></ul><p><strong>3. AI/ML 기반 적응형 Circuit Breaker</strong></p><ul><li><strong>원인</strong>: 정적 임계값의 한계</li><li><strong>영향</strong>: 최적화되지 않은 성능</li><li><strong>해결방안</strong>: 머신러닝 기반 동적 조정</li></ul><h3 id=613-분류-기준에-따른-종류-및-유형>6.13 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#613-분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>적용 사례</th></tr></thead><tbody><tr><td><strong>구현 방식</strong></td><td>Library-based</td><td>기존 라이브러리 활용</td><td>Hystrix, Resilience4j</td></tr><tr><td></td><td>Custom</td><td>직접 구현</td><td>특수 요구사항 대응</td></tr><tr><td></td><td>Infrastructure</td><td>인프라 레벨 구현</td><td>Istio, API Gateway</td></tr><tr><td><strong>상태 관리</strong></td><td>Simple</td><td>기본 3-state</td><td>대부분의 구현</td></tr><tr><td></td><td>Extended</td><td>추가 상태 포함</td><td>METRICS_ONLY, DISABLED</td></tr><tr><td><strong>트리거 방식</strong></td><td>Count-based</td><td>실패 횟수 기반</td><td>간단한 환경</td></tr><tr><td></td><td>Rate-based</td><td>실패율 기반</td><td>복잡한 환경</td></tr><tr><td></td><td>Time-based</td><td>시간 창 기반</td><td>실시간 요구사항</td></tr><tr><td><strong>스코프</strong></td><td>Service-level</td><td>서비스 단위</td><td>마이크로서비스</td></tr><tr><td></td><td>Method-level</td><td>메서드 단위</td><td>세밀한 제어</td></tr><tr><td></td><td>Global</td><td>전역 적용</td><td>시스템 전체 보호</td></tr></tbody></table><h3 id=614-실무-사용-예시>6.14 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#614-실무-사용-예시>#</a></h3><table><thead><tr><th>사용 목적</th><th>함께 사용하는 기술</th><th>효과</th></tr></thead><tbody><tr><td><strong>API Gateway 보호</strong></td><td>Kong, Zuul, Spring Cloud Gateway</td><td>백엔드 서비스 장애 시 게이트웨이 안정성 확보</td></tr><tr><td><strong>데이터베이스 연결 보호</strong></td><td>Connection Pool, JPA, MyBatis</td><td>DB 장애 시 애플리케이션 리소스 보호</td></tr><tr><td><strong>외부 서비스 호출</strong></td><td>HTTP Client, gRPC, Message Queue</td><td>외부 의존성 장애로부터 격리</td></tr><tr><td><strong>마이크로서비스 통신</strong></td><td>Spring Boot, Docker, Kubernetes</td><td>서비스 간 장애 전파 방지</td></tr><tr><td><strong>클라우드 서비스 연동</strong></td><td>AWS SDK, Azure SDK, GCP Client</td><td>클라우드 서비스 장애 대응</td></tr></tbody></table><h3 id=615-활용-사례>6.15 활용 사례<a hidden class=anchor aria-hidden=true href=#615-활용-사례>#</a></h3><p><strong>Netflix 스트리밍 서비스 사례</strong></p><p><strong>시스템 구성:</strong></p><ul><li>추천 서비스, 사용자 서비스, 콘텐츠 서비스, 결제 서비스</li><li>API Gateway 를 통한 마이크로서비스 통신</li><li>Hystrix Circuit Breaker 적용</li></ul><p><strong>시스템 구성 다이어그램:</strong></p><pre class=mermaid>graph TB
    subgraph &#34;Netflix Platform&#34;
        A[API Gateway]
        B[추천 서비스]
        C[사용자 서비스]
        D[콘텐츠 서비스]
        E[결제 서비스]
        F[Circuit Breaker Dashboard]
    end
    
    subgraph &#34;External Services&#34;
        G[추천 알고리즘 서비스]
        H[결제 처리 서비스]
    end
    
    A --&gt; B
    A --&gt; C
    A --&gt; D
    A --&gt; E
    B --&gt; G
    E --&gt; H
    F --&gt; A
</pre><p><strong>Workflow:</strong></p><ol><li>사용자가 Netflix 앱에서 영화 추천 요청</li><li>API Gateway 가 추천 서비스로 요청 전달</li><li>추천 서비스가 외부 알고리즘 서비스 호출</li><li>외부 서비스 장애 시 Circuit Breaker 활성화</li><li>Fallback 으로 캐시된 추천 목록 반환</li><li>사용자는 지연 없이 추천 콘텐츠 확인</li></ol><p><strong>Circuit Breaker 역할:</strong></p><ul><li>외부 추천 알고리즘 서비스 장애 감지</li><li>장애 시 캐시된 추천 목록으로 Fallback</li><li>서비스 복구 시 자동으로 정상 모드 전환</li></ul><p><strong>유무에 따른 차이점:</strong></p><ul><li><strong>Circuit Breaker 적용 시</strong>: 외부 서비스 장애에도 기본 추천 제공</li><li><strong>미적용 시</strong>: 외부 서비스 장애로 전체 추천 기능 중단</li></ul><h3 id=616-구현-예시>6.16 구현 예시<a hidden class=anchor aria-hidden=true href=#616-구현-예시>#</a></h3><p><strong>Python 을 이용한 Circuit Breaker 구현:</strong>### 6.17 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점</p><table><thead><tr><th>구분</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>설정 관리</strong></td><td>적절한 임계값 설정</td><td>너무 민감하거나 둔감한 설정</td><td>모니터링 데이터 기반 점진적 조정</td></tr><tr><td><strong>모니터링</strong></td><td>실시간 상태 추적</td><td>알람 피로도</td><td>중요도별 알람 분류, 대시보드 구성</td></tr><tr><td><strong>테스트</strong></td><td>장애 상황 시뮬레이션</td><td>프로덕션 환경 영향</td><td>Chaos Engineering, Canary 배포</td></tr><tr><td><strong>문서화</strong></td><td>설정 근거 기록</td><td>설정 변경 이력 누락</td><td>설정 변경 시 반드시 문서 업데이트</td></tr><tr><td><strong>팀 교육</strong></td><td>운영진 이해도 향상</td><td>잘못된 수동 개입</td><td>정기적인 교육, 플레이북 작성</td></tr><tr><td><strong>의존성 관리</strong></td><td>서비스 간 의존성 파악</td><td>순환 의존성</td><td>의존성 맵 작성, 정기적 검토</td></tr><tr><td><strong>Fallback 전략</strong></td><td>비즈니스 로직 반영</td><td>일관성 없는 대체 로직</td><td>비즈니스 팀과 협의한 우선순위</td></tr><tr><td><strong>성능 영향</strong></td><td>오버헤드 최소화</td><td>과도한 모니터링 로직</td><td>비동기 처리, 샘플링 활용</td></tr></tbody></table><h3 id=618-최적화하기-위한-고려사항-및-주의할-점>6.18 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#618-최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>구분</th><th>최적화 방안</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>알고리즘</strong></td><td>적응형 임계값</td><td>과도한 복잡성</td><td>점진적 도입, A/B 테스트</td></tr><tr><td><strong>상태 동기화</strong></td><td>분산 상태 관리</td><td>네트워크 지연</td><td>Redis Cluster, 일관성 수준 조정</td></tr><tr><td><strong>메모리 사용</strong></td><td>통계 데이터 최적화</td><td>메모리 누수</td><td>순환 버퍼, 정기적 가비지 컬렉션</td></tr><tr><td><strong>네트워크</strong></td><td>배치 처리</td><td>지연 시간 증가</td><td>적절한 배치 크기, 비동기 전송</td></tr><tr><td><strong>캐싱</strong></td><td>Fallback 데이터 캐싱</td><td>데이터 일관성</td><td>TTL 설정, 캐시 무효화 전략</td></tr><tr><td><strong>스케일링</strong></td><td>수평 확장 대응</td><td>상태 불일치</td><td>Stateless 설계, 외부 상태 저장소</td></tr><tr><td><strong>설정 동적 변경</strong></td><td>런타임 설정 변경</td><td>설정 충돌</td><td>중앙화된 설정 관리, 검증 로직</td></tr><tr><td><strong>로그 최적화</strong></td><td>구조화된 로그</td><td>로그 오버플로우</td><td>로그 레벨 조정, 로그 로테이션</td></tr></tbody></table><hr><h2 id=7-주제와-관련하여-주목할-내용>7. 주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#7-주제와-관련하여-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>라이브러리</strong></td><td>Resilience4j</td><td>차세대 Circuit Breaker</td><td>Hystrix 대체제, 함수형 프로그래밍 지원</td></tr><tr><td></td><td>Netflix Hystrix</td><td>레거시 라이브러리</td><td>현재 유지보수 모드, 안정적이지만 새 프로젝트 비권장</td></tr><tr><td></td><td>Polly (.NET)</td><td>.NET 생태계</td><td>C# 환경에서 가장 인기 있는 복원력 라이브러리</td></tr><tr><td><strong>클라우드</strong></td><td>Service Mesh</td><td>인프라 수준 구현</td><td>Istio, Linkerd 를 통한 코드 변경 없는 적용</td></tr><tr><td></td><td>API Gateway</td><td>진입점 보호</td><td>Kong, Zuul 에서 제공하는 Circuit Breaker 기능</td></tr><tr><td></td><td>Serverless</td><td>FaaS 환경 적용</td><td>AWS Lambda, Azure Functions 에서의 구현 고려사항</td></tr><tr><td><strong>모니터링</strong></td><td>Metrics</td><td>성능 지표 수집</td><td>Prometheus, Grafana 를 통한 시각화</td></tr><tr><td></td><td>Alerting</td><td>실시간 알림</td><td>PagerDuty, Slack 연동을 통한 즉시 대응</td></tr><tr><td></td><td>Tracing</td><td>분산 추적</td><td>Jaeger, Zipkin 을 통한 요청 흐름 추적</td></tr><tr><td><strong>패턴</strong></td><td>Bulkhead</td><td>격리 패턴</td><td>리소스 풀 분리를 통한 장애 격리</td></tr><tr><td></td><td>Retry</td><td>재시도 패턴</td><td>Circuit Breaker 와 조합하여 효과적인 복원력 구현</td></tr><tr><td></td><td>Timeout</td><td>시간 제한</td><td>무한 대기 방지, Circuit Breaker 와 상호 보완</td></tr></tbody></table><hr><h2 id=8-반드시-학습해야-할-내용>8. 반드시 학습해야 할 내용<a hidden class=anchor aria-hidden=true href=#8-반드시-학습해야-할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>기초 이론</strong></td><td>분산 시스템</td><td>CAP 정리</td><td>일관성, 가용성, 분할 내성의 트레이드오프 이해</td></tr><tr><td></td><td>장애 유형</td><td>Byzantine Failure</td><td>분산 시스템에서 발생하는 다양한 장애 패턴</td></tr><tr><td></td><td>복원력 공학</td><td>Resilience Engineering</td><td>시스템의 적응력과 복구력에 대한 체계적 접근</td></tr><tr><td><strong>설계 패턴</strong></td><td>Microservices</td><td>Service Design</td><td>서비스 경계 설정, 데이터 일관성 관리</td></tr><tr><td></td><td>Event-Driven</td><td>Asynchronous Messaging</td><td>이벤트 기반 아키텍처에서의 Circuit Breaker 적용</td></tr><tr><td></td><td>CQRS</td><td>Command Query Separation</td><td>읽기/쓰기 분리 시 Circuit Breaker 적용 방안</td></tr><tr><td><strong>운영 기술</strong></td><td>Observability</td><td>관찰 가능성</td><td>로그, 메트릭, 트레이스를 통한 시스템 상태 파악</td></tr><tr><td></td><td>Chaos Engineering</td><td>장애 주입</td><td>의도적 장애를 통한 시스템 복원력 검증</td></tr><tr><td></td><td>SRE</td><td>Site Reliability Engineering</td><td>신뢰성 중심의 운영 방법론과 Circuit Breaker 통합</td></tr></tbody></table><hr><h2 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td><strong>아키텍처</strong></td><td>Microservices Architecture</td><td>대규모 애플리케이션을 독립적으로 배포 가능한 작은 서비스들로 분해하는 아키텍처 패턴</td></tr><tr><td></td><td>Service Mesh</td><td>마이크로서비스 간 통신을 관리하는 인프라스트럭처 계층</td></tr><tr><td></td><td>API Gateway</td><td>클라이언트와 백엔드 서비스 사이의 진입점 역할을 하는 서버</td></tr><tr><td><strong>복원력</strong></td><td>Fault Tolerance</td><td>시스템이 일부 구성 요소의 장애에도 불구하고 정상적으로 작동할 수 있는 능력</td></tr><tr><td></td><td>Graceful Degradation</td><td>시스템의 일부가 실패할 때 핵심 기능을 유지하면서 부가 기능을 점진적으로 제한하는 설계 원칙</td></tr><tr><td></td><td>Fail-Fast</td><td>오류 상황에서 빠르게 실패를 보고하여 전체 시스템의 안정성을 보장하는 설계 원칙</td></tr><tr><td><strong>상태 관리</strong></td><td>State Machine</td><td>유한한 수의 상태와 상태 간 전환 규칙을 정의한 계산 모델</td></tr><tr><td></td><td>Circuit Breaker State</td><td>Closed(정상), Open(차단), Half-Open(반개방) 세 가지 주요 상태</td></tr><tr><td><strong>모니터링</strong></td><td>Metrics</td><td>시스템의 성능과 동작을 측정하는 수치 데이터</td></tr><tr><td></td><td>SLA (Service Level Agreement)</td><td>서비스 제공자와 고객 간의 서비스 수준 합의</td></tr><tr><td></td><td>SLO (Service Level Objective)</td><td>SLA 달성을 위한 구체적이고 측정 가능한 목표</td></tr><tr><td><strong>구현 기술</strong></td><td>Hystrix</td><td>Netflix 에서 개발한 Circuit Breaker 라이브러리 (현재 유지보수 모드)</td></tr><tr><td></td><td>Resilience4j</td><td>현대적인 Java 기반 복원력 라이브러리, Hystrix 의 후속작</td></tr><tr><td></td><td>Polly</td><td>.NET 환경을 위한 복원력 라이브러리</td></tr></tbody></table><hr><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><ul><li><a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/circuit-breaker>Circuit Breaker Pattern - Azure Architecture Center</a></li><li><a href=https://www.baeldung.com/cs/microservices-circuit-breaker-pattern>Circuit Breaker Pattern in Microservices - Baeldung</a></li><li><a href=https://resilience4j.readme.io/docs/circuitbreaker>Resilience4j Official Documentation</a></li><li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/circuit-breaker.html>AWS Circuit Breaker Pattern Guide</a></li><li><a href=https://microservices.io/patterns/reliability/circuit-breaker.html>Microservices Pattern: Circuit Breaker</a></li><li><a href=https://netflixtechblog.com/>Netflix Technology Blog</a></li><li><a href=https://www.geeksforgeeks.org/spring-boot-circuit-breaker-pattern-with-resilience4j/>Spring Boot Circuit Breaker with Resilience4J - GeeksforGeeks</a></li></ul><hr><p>서킷 브레이커 패턴 (Circuit Breaker Pattern) 은 마이크로서비스 아키텍처에서 시스템의 안정성과 복원력을 향상시키기 위해 사용되는 디자인 패턴이다.<br>이 패턴의 주요 목적은 서비스 간 장애 전파를 방지하고, 시스템의 전반적인 안정성을 유지하는 것이다.</p><p>서킷 브레이커 패턴은 전기 회로의 차단기에서 착안한 개념이다.<br>전기 회로에서 과부하가 발생하면 차단기가 작동하여 전류를 차단하듯이, 소프트웨어 시스템에서도 특정 서비스에 문제가 발생했을 때 해당 서비스로의 호출을 차단한다.</p><p>서킷 브레이커 패턴을 효과적으로 사용하면 마이크로서비스 아키텍처에서 장애의 전파를 방지하고, 시스템의 전반적인 안정성과 복원력을 크게 향상시킬 수 있다. 이 패턴은 특히 외부 서비스에 의존성이 높은 시스템에서 매우 유용하며, 적절히 구현하면 사용자 경험을 크게 개선할 수 있다.</p><p><figure><img alt="Circuit Breaker Pattern" loading=lazy src=/img/1_yZHLhbM0q1bjfLbuaKU2TA.webp><figcaption>https://blog.bitsrc.io/circuit-breaker-pattern-3389a7b259f1</figcaption></figure></p><h3 id=서킷-브레이커의-상태>서킷 브레이커의 상태<a hidden class=anchor aria-hidden=true href=#서킷-브레이커의-상태>#</a></h3><p>서킷 브레이커는 일반적으로 다음 세 가지 상태를 가진다:</p><ol><li><strong>Closed (닫힘)</strong>: 정상 상태로, 모든 요청이 외부 서비스로 전달된다.</li><li><strong>Open (열림)</strong>: 요청 실패 횟수가 임계치를 초과한 상태로, 외부 서비스로의 요청을 차단한다.</li><li><strong>Half-Open (반열림)</strong>: 일정 시간이 지난 후, 일부 요청을 보내어 외부 서비스가 회복되었는지 확인한다.</li></ol><h3 id=동작-원리>동작 원리<a hidden class=anchor aria-hidden=true href=#동작-원리>#</a></h3><ol><li><p><strong>정상 상태 (Closed)</strong>: 서비스가 정상적으로 동작하는 상태이다.</p></li><li><p><strong>장애 감지 (Open 으로 전환)</strong>:</p><ul><li>서비스 호출 실패율이 설정된 임계치를 초과하면 서킷 브레이커가 Open 상태로 전환된다.</li><li>이 상태에서는 외부 서비스로의 호출을 즉시 차단하고, 빠른 실패 (Fail Fast) 응답을 반환한다.</li></ul></li><li><p><strong>복구 시도 (Half-Open)</strong>:</p><ul><li>Open 상태가 일정 시간 지속된 후, Half-Open 상태로 전환된다.</li><li>이 상태에서는 제한된 수의 요청만 외부 서비스로 전달하여 서비스의 회복 여부를 확인한다.</li></ul></li><li><p><strong>상태 전이</strong>:</p><ul><li>Half-Open 상태에서 요청이 성공하면 Closed 상태로 돌아간다.</li><li>실패하면 다시 Open 상태로 전환된다.</li></ul></li></ol><h3 id=구현-방법>구현 방법<a hidden class=anchor aria-hidden=true href=#구현-방법>#</a></h3><p>서킷 브레이커 패턴을 구현하는 방법은 여러 가지가 있다.<br>대표적인 방법으로는 다음과 같은 것들이 있다:</p><ol><li><p><strong>Resilience4j 사용</strong>: Java 에서 널리 사용되는 라이브러리로, 스프링 부트와 통합이 쉽다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4>4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5>5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6>6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>CircuitBreakerConfig</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CircuitBreakerConfig</span><span class=p>.</span><span class=na>custom</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>failureRateThreshold</span><span class=p>(</span><span class=n>50</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>waitDurationInOpenState</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofMillis</span><span class=p>(</span><span class=n>1000</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>slidingWindowSize</span><span class=p>(</span><span class=n>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CircuitBreakerRegistry</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>config</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;myCircuitBreaker&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>Spring Cloud Circuit Breaker</strong>: 스프링 클라우드에서 제공하는 추상화 계층을 사용할 수 있다.</p></li><li><p><strong>Istio 와 같은 서비스 메시 사용</strong>: 쿠버네티스 환경에서는 Istio 를 통해 서킷 브레이커를 구현할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.istio.io/v1alpha3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>DestinationRule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>circuit-breaker-for-httpbin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>httpbin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trafficPolicy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>connectionPool</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tcp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>maxConnections</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>http1MaxPendingRequests</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>maxRequestsPerConnection</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>outlierDetection</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>consecutiveErrors</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>1s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>baseEjectionTime</span><span class=p>:</span><span class=w> </span><span class=l>3m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>maxEjectionPercent</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=주의사항-및-고려사항>주의사항 및 고려사항<a hidden class=anchor aria-hidden=true href=#주의사항-및-고려사항>#</a></h3><ol><li><strong>임계값 설정</strong>: 실패 임계값과 시간 간격을 적절히 설정해야 합니다. 너무 낮으면 불필요한 차단이, 너무 높으면 장애 전파를 막지 못할 수 있다.</li><li><strong>폴백 메커니즘</strong>: 서킷이 열렸을 때 대체 응답을 제공하는 폴백 로직을 구현해야 한다.</li><li><strong>모니터링</strong>: 서킷 브레이커의 상태와 성능을 지속적으로 모니터링해야 한다.</li><li><strong>테스트</strong>: 다양한 장애 시나리오에 대한 테스트를 수행하여 서킷 브레이커가 예상대로 동작하는지 확인해야 한다.</li></ol><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33>33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34>34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35>35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36>36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37>37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38>38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39>39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40>40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41>41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42>42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43>43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44>44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45>45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46>46</a>
</span><span class=lnt id=hl-16-47><a class=lnlinks href=#hl-16-47>47</a>
</span><span class=lnt id=hl-16-48><a class=lnlinks href=#hl-16-48>48</a>
</span><span class=lnt id=hl-16-49><a class=lnlinks href=#hl-16-49>49</a>
</span><span class=lnt id=hl-16-50><a class=lnlinks href=#hl-16-50>50</a>
</span><span class=lnt id=hl-16-51><a class=lnlinks href=#hl-16-51>51</a>
</span><span class=lnt id=hl-16-52><a class=lnlinks href=#hl-16-52>52</a>
</span><span class=lnt id=hl-16-53><a class=lnlinks href=#hl-16-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>State</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>CLOSED</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>OPEN</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>HALF_OPEN</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CircuitBreaker</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>failure_threshold</span><span class=p>,</span> <span class=n>recovery_time</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>failure_threshold</span> <span class=o>=</span> <span class=n>failure_threshold</span>  <span class=c1># 허용되는 최대 실패 횟수</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>recovery_time</span> <span class=o>=</span> <span class=n>recovery_time</span>  <span class=c1># Open 상태에서 Half-Open 상태로 전환되기까지의 시간</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>State</span><span class=o>.</span><span class=n>CLOSED</span>  <span class=c1># 초기 상태는 Closed</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># 실패 횟수 초기화</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_failure_time</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># 마지막 실패 시간 초기화</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>call</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>State</span><span class=o>.</span><span class=n>OPEN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_failure_time</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>recovery_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>State</span><span class=o>.</span><span class=n>HALF_OPEN</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Circuit is open. Request blocked.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>last_failure_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>failure_threshold</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>State</span><span class=o>.</span><span class=n>OPEN</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>e</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>State</span><span class=o>.</span><span class=n>HALF_OPEN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>State</span><span class=o>.</span><span class=n>CLOSED</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>failure_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>unstable_service</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 이 함수는 불안정한 서비스를 시뮬레이션합니다.</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Service failure&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;Service success&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>circuit_breaker</span> <span class=o>=</span> <span class=n>CircuitBreaker</span><span class=p>(</span><span class=n>failure_threshold</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>recovery_time</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>circuit_breaker</span><span class=o>.</span><span class=n>call</span><span class=p>(</span><span class=n>unstable_service</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=circuit-breaker-1>Circuit Breaker<a hidden class=anchor aria-hidden=true href=#circuit-breaker-1>#</a></h2><p><strong>Circuit Breaker</strong>는 분산 시스템에서 장애가 발생하거나 과부하 상태일 때 서비스의 안정성을 유지하기 위한 디자인 패턴이다. 이는 전기 회로의 차단기에서 영감을 받아, 연속적인 실패 시 추가적인 장애 전파를 방지하고 시스템을 보호한다. 특히 마이그레이션 과정에서 서비스 간 의존성이 높은 환경에서 필수적으로 적용된다.</p><h3 id=서킷-브레이커-패턴의-기본-개념>서킷 브레이커 패턴의 기본 개념<a hidden class=anchor aria-hidden=true href=#서킷-브레이커-패턴의-기본-개념>#</a></h3><p>서킷 브레이커 패턴은 전기 회로의 차단기에서 영감을 받은 소프트웨어 디자인 패턴으로, 가정용 전기 차단기가 과부하 시 전기를 차단하여 화재를 방지하는 것처럼, 소프트웨어 서킷 브레이커는 장애가 발생한 서비스에 대한 호출을 일시적으로 중단하여 시스템 전체의 안정성을 보호한다.</p><h4 id=핵심-목적>핵심 목적<a hidden class=anchor aria-hidden=true href=#핵심-목적>#</a></h4><ol><li><strong>연쇄 장애(Cascading Failures) 방지</strong>: 한 서비스의 장애가 다른 서비스로 전파되는 것을 막는다.</li><li><strong>빠른 실패(Fail Fast)</strong>: 실패할 것이 명백한 요청을 즉시 거부하여 시스템 자원을 절약한다.</li><li><strong>자가 회복(Self-Healing)</strong>: 장애 상황에서 자동으로 복구될 수 있는 메커니즘을 제공한다.</li><li><strong>우아한 성능 저하(Graceful Degradation)</strong>: 전체 시스템이 중단되지 않고 부분적으로 기능을 유지할 수 있게 한다.</li></ol><h3 id=상태-전이-메커니즘><strong>상태 전이 메커니즘</strong><a hidden class=anchor aria-hidden=true href=#상태-전이-메커니즘>#</a></h3><p>서킷 브레이커는 일반적으로 세 가지 상태로 동작한다:</p><table><thead><tr><th>상태</th><th>설명</th><th>동작 방식</th></tr></thead><tbody><tr><td><strong>Closed</strong></td><td>정상 작동 상태</td><td>모든 요청 허용, 실패 시 카운트 증가</td></tr><tr><td><strong>Open</strong></td><td>장애 발생 상태</td><td>즉시 실패 반환, 일정 시간 대기</td></tr><tr><td><strong>Half-Open</strong></td><td>복구 테스트 상태</td><td>제한된 요청 허용, 성공 시 Closed로 전환</td></tr></tbody></table><h4 id=닫힘-상태closed>닫힘 상태(Closed)<a hidden class=anchor aria-hidden=true href=#닫힘-상태closed>#</a></h4><ul><li>정상 작동 상태.</li><li>모든 요청이 대상 서비스로 전달된다.</li><li>실패 횟수를 지속적으로 모니터링한다.</li><li>설정된 임계값(threshold)을 초과하면 열림 상태로 전환된다.</li></ul><h4 id=열림-상태open>열림 상태(Open)<a hidden class=anchor aria-hidden=true href=#열림-상태open>#</a></h4><ul><li>장애 상태로 판단하여 모든 요청을 즉시 거부한다.</li><li>실제 서비스 호출을 시도하지 않고 예외나 대체 응답을 반환한다.</li><li>설정된 타임아웃 기간이 지나면 반열림 상태로 전환된다.</li></ul><h4 id=반열림-상태half-open>반열림 상태(Half-Open)<a hidden class=anchor aria-hidden=true href=#반열림-상태half-open>#</a></h4><ul><li>제한된 수의 요청만 서비스로 전달하여 회복 여부를 테스트한다.</li><li>이 상태에서의 성공/실패율에 따라 닫힘 또는 열림 상태로 전환된다.</li><li>성공 비율이 높으면 닫힘 상태로, 실패 비율이 높으면 다시 열림 상태로 돌아간다.</li></ul><h3 id=작동-원리><strong>작동 원리</strong><a hidden class=anchor aria-hidden=true href=#작동-원리>#</a></h3><ol><li><p><strong>초기 상태(Closed)</strong>:</p><ul><li>모든 요청이 백엔드 서비스로 전달된다.</li><li>실패 횟수가 임계값(예: 5회)을 초과하면 Open 상태로 전환된다.</li></ul></li><li><p><strong>차단 상태(Open)</strong>:</p><ul><li>모든 요청이 즉시 차단되며, 사전 정의된 타임아웃(예: 30초) 동안 유지된다.</li><li>클라이언트에게 빠른 실패 응답(HTTP 503)을 반환하여 자원 낭비를 방지한다.</li></ul></li><li><p><strong>테스트 상태(Half-Open)</strong>:</p><ul><li>타임아웃 종료 후 소량의 요청(예: 10%)을 허용하여 서비스 복구 여부를 확인한다.</li><li>성공 시 Closed 상태로 복귀, 실패 시 Open 상태 재진입.</li></ul></li></ol><h3 id=서킷-브레이커-패턴의-구현-방법>서킷 브레이커 패턴의 구현 방법<a hidden class=anchor aria-hidden=true href=#서킷-브레이커-패턴의-구현-방법>#</a></h3><h4 id=직접-구현-예시-java>직접 구현 예시 (Java)<a hidden class=anchor aria-hidden=true href=#직접-구현-예시-java>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25>25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26>26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27>27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28>28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29>29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30>30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31>31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32>32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33>33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34>34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35>35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36>36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37>37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38>38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39>39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40>40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41>41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42>42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43>43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44>44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45>45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46>46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47>47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48>48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49>49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50>50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51>51</a>
</span><span class=lnt id=hl-17-52><a class=lnlinks href=#hl-17-52>52</a>
</span><span class=lnt id=hl-17-53><a class=lnlinks href=#hl-17-53>53</a>
</span><span class=lnt id=hl-17-54><a class=lnlinks href=#hl-17-54>54</a>
</span><span class=lnt id=hl-17-55><a class=lnlinks href=#hl-17-55>55</a>
</span><span class=lnt id=hl-17-56><a class=lnlinks href=#hl-17-56>56</a>
</span><span class=lnt id=hl-17-57><a class=lnlinks href=#hl-17-57>57</a>
</span><span class=lnt id=hl-17-58><a class=lnlinks href=#hl-17-58>58</a>
</span><span class=lnt id=hl-17-59><a class=lnlinks href=#hl-17-59>59</a>
</span><span class=lnt id=hl-17-60><a class=lnlinks href=#hl-17-60>60</a>
</span><span class=lnt id=hl-17-61><a class=lnlinks href=#hl-17-61>61</a>
</span><span class=lnt id=hl-17-62><a class=lnlinks href=#hl-17-62>62</a>
</span><span class=lnt id=hl-17-63><a class=lnlinks href=#hl-17-63>63</a>
</span><span class=lnt id=hl-17-64><a class=lnlinks href=#hl-17-64>64</a>
</span><span class=lnt id=hl-17-65><a class=lnlinks href=#hl-17-65>65</a>
</span><span class=lnt id=hl-17-66><a class=lnlinks href=#hl-17-66>66</a>
</span><span class=lnt id=hl-17-67><a class=lnlinks href=#hl-17-67>67</a>
</span><span class=lnt id=hl-17-68><a class=lnlinks href=#hl-17-68>68</a>
</span><span class=lnt id=hl-17-69><a class=lnlinks href=#hl-17-69>69</a>
</span><span class=lnt id=hl-17-70><a class=lnlinks href=#hl-17-70>70</a>
</span><span class=lnt id=hl-17-71><a class=lnlinks href=#hl-17-71>71</a>
</span><span class=lnt id=hl-17-72><a class=lnlinks href=#hl-17-72>72</a>
</span><span class=lnt id=hl-17-73><a class=lnlinks href=#hl-17-73>73</a>
</span><span class=lnt id=hl-17-74><a class=lnlinks href=#hl-17-74>74</a>
</span><span class=lnt id=hl-17-75><a class=lnlinks href=#hl-17-75>75</a>
</span><span class=lnt id=hl-17-76><a class=lnlinks href=#hl-17-76>76</a>
</span><span class=lnt id=hl-17-77><a class=lnlinks href=#hl-17-77>77</a>
</span><span class=lnt id=hl-17-78><a class=lnlinks href=#hl-17-78>78</a>
</span><span class=lnt id=hl-17-79><a class=lnlinks href=#hl-17-79>79</a>
</span><span class=lnt id=hl-17-80><a class=lnlinks href=#hl-17-80>80</a>
</span><span class=lnt id=hl-17-81><a class=lnlinks href=#hl-17-81>81</a>
</span><span class=lnt id=hl-17-82><a class=lnlinks href=#hl-17-82>82</a>
</span><span class=lnt id=hl-17-83><a class=lnlinks href=#hl-17-83>83</a>
</span><span class=lnt id=hl-17-84><a class=lnlinks href=#hl-17-84>84</a>
</span><span class=lnt id=hl-17-85><a class=lnlinks href=#hl-17-85>85</a>
</span><span class=lnt id=hl-17-86><a class=lnlinks href=#hl-17-86>86</a>
</span><span class=lnt id=hl-17-87><a class=lnlinks href=#hl-17-87>87</a>
</span><span class=lnt id=hl-17-88><a class=lnlinks href=#hl-17-88>88</a>
</span><span class=lnt id=hl-17-89><a class=lnlinks href=#hl-17-89>89</a>
</span><span class=lnt id=hl-17-90><a class=lnlinks href=#hl-17-90>90</a>
</span><span class=lnt id=hl-17-91><a class=lnlinks href=#hl-17-91>91</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CircuitBreaker</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>State</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CLOSED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OPEN</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HALF_OPEN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>State</span><span class=w> </span><span class=n>state</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>failureThreshold</span><span class=p>;</span><span class=w>   </span><span class=c1>// 실패 임계값</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>successThreshold</span><span class=p>;</span><span class=w>   </span><span class=c1>// 성공 임계값</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>openTimeout</span><span class=p>;</span><span class=w>       </span><span class=c1>// 열림 상태 유지 시간(ms)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>failureCount</span><span class=p>;</span><span class=w>       </span><span class=c1>// 현재 실패 카운트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>successCount</span><span class=p>;</span><span class=w>       </span><span class=c1>// 반열림 상태에서의 성공 카운트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>lastFailureTime</span><span class=p>;</span><span class=w>   </span><span class=c1>// 마지막 실패 시간</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>CircuitBreaker</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>failureThreshold</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>successThreshold</span><span class=p>,</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>openTimeout</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>CLOSED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>failureThreshold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>failureThreshold</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>successThreshold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>successThreshold</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>openTimeout</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>openTimeout</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>failureCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>successCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=nf>execute</span><span class=p>(</span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>action</span><span class=p>,</span><span class=w> </span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>fallback</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 현재 회로 상태에 따라 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>OPEN</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 타임아웃 체크 - 설정된 시간이 지났으면 반열림 상태로 전환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>lastFailureTime</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>openTimeout</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>HALF_OPEN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Circuit switched to HALF_OPEN&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 아직 타임아웃이 지나지 않았으면 대체 로직 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>fallback</span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 실제 동작 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>T</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>action</span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 성공 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>handleSuccess</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 실패 처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>handleFailure</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>fallback</span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleSuccess</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>HALF_OPEN</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>successCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>successCount</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>successThreshold</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 성공 임계값에 도달하면 닫힘 상태로 전환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>CLOSED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>successCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>failureCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Circuit switched to CLOSED&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>CLOSED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 닫힘 상태에서는 실패 카운트 초기화</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>failureCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleFailure</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>lastFailureTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>HALF_OPEN</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 반열림 상태에서 실패 시 즉시 열림 상태로 전환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>OPEN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>successCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Circuit switched back to OPEN&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>CLOSED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>failureCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>failureCount</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>failureThreshold</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 실패 임계값에 도달하면 열림 상태로 전환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>State</span><span class=p>.</span><span class=na>OPEN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Circuit switched to OPEN&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 현재 상태 조회 메서드</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>State</span><span class=w> </span><span class=nf>getState</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>state</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=spring-cloud-circuit-breaker-사용-예시>Spring Cloud Circuit Breaker 사용 예시<a hidden class=anchor aria-hidden=true href=#spring-cloud-circuit-breaker-사용-예시>#</a></h4><p>Spring Cloud를 사용하는 환경에서는 Resilience4j, Hystrix 등의 라이브러리를 활용할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18>18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19>19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20>20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21>21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22>22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23>23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24>24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ProductService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreakerFactory</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ProductService</span><span class=p>(</span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>,</span><span class=w> </span><span class=n>CircuitBreakerFactory</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>restTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreakerFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=nf>getProductById</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerFactory</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=s>&#34;productService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>run</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForObject</span><span class=p>(</span><span class=s>&#34;/products/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Product</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>throwable</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>getProductFallback</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=nf>getProductFallback</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 대체 로직 - 캐시에서 조회, 기본 응답 생성 등</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Product</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Fallback Product&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;This is a fallback response&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=nodejs-opossum-라이브러리-사용-예시>Node.js Opossum 라이브러리 사용 예시<a hidden class=anchor aria-hidden=true href=#nodejs-opossum-라이브러리-사용-예시>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18>18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19>19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20>20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21>21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22>22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23>23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24>24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25>25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26>26</a>
</span><span class=lnt id=hl-19-27><a class=lnlinks href=#hl-19-27>27</a>
</span><span class=lnt id=hl-19-28><a class=lnlinks href=#hl-19-28>28</a>
</span><span class=lnt id=hl-19-29><a class=lnlinks href=#hl-19-29>29</a>
</span><span class=lnt id=hl-19-30><a class=lnlinks href=#hl-19-30>30</a>
</span><span class=lnt id=hl-19-31><a class=lnlinks href=#hl-19-31>31</a>
</span><span class=lnt id=hl-19-32><a class=lnlinks href=#hl-19-32>32</a>
</span><span class=lnt id=hl-19-33><a class=lnlinks href=#hl-19-33>33</a>
</span><span class=lnt id=hl-19-34><a class=lnlinks href=#hl-19-34>34</a>
</span><span class=lnt id=hl-19-35><a class=lnlinks href=#hl-19-35>35</a>
</span><span class=lnt id=hl-19-36><a class=lnlinks href=#hl-19-36>36</a>
</span><span class=lnt id=hl-19-37><a class=lnlinks href=#hl-19-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>CircuitBreaker</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;opossum&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 서킷 브레이커 설정
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>failureThreshold</span><span class=o>:</span> <span class=mi>50</span><span class=p>,</span>         <span class=c1>// 50% 이상 실패시 열림
</span></span></span><span class=line><span class=cl>  <span class=nx>resetTimeout</span><span class=o>:</span> <span class=mi>10000</span><span class=p>,</span>          <span class=c1>// 10초 후 반열림 상태로 전환
</span></span></span><span class=line><span class=cl>  <span class=nx>timeout</span><span class=o>:</span> <span class=mi>3000</span><span class=p>,</span>                <span class=c1>// 3초 타임아웃
</span></span></span><span class=line><span class=cl>  <span class=nx>errorThresholdPercentage</span><span class=o>:</span> <span class=mi>50</span>  <span class=c1>// 50% 이상 에러 발생시 열림
</span></span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 대상 함수
</span></span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>fetchUserData</span><span class=p>(</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`https://api.example.com/users/</span><span class=si>${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>response</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;API 요청 실패&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 서킷 브레이커 생성
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>breaker</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CircuitBreaker</span><span class=p>(</span><span class=nx>fetchUserData</span><span class=p>,</span> <span class=nx>options</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 이벤트 리스너 등록
</span></span></span><span class=line><span class=cl><span class=nx>breaker</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;서킷 브레이커가 열렸습니다&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>breaker</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;halfOpen&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;서킷 브레이커가 반열림 상태입니다&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>breaker</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;서킷 브레이커가 닫혔습니다&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>breaker</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;fallback&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;폴백 함수가 실행되었습니다&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 대체 응답 설정
</span></span></span><span class=line><span class=cl><span class=nx>breaker</span><span class=p>.</span><span class=nx>fallback</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>({</span> <span class=nx>id</span><span class=o>:</span> <span class=s1>&#39;unknown&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;사용할 수 없음&#39;</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 실행
</span></span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getUserData</span><span class=p>(</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>breaker</span><span class=p>.</span><span class=nx>fire</span><span class=p>(</span><span class=nx>userId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>data</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;오류 발생:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=서킷-브레이커의-주요-설정-매개변수>서킷 브레이커의 주요 설정 매개변수<a hidden class=anchor aria-hidden=true href=#서킷-브레이커의-주요-설정-매개변수>#</a></h3><p>서킷 브레이커의 효과적인 구현을 위해 다양한 매개변수를 조정할 수 있다:</p><h4 id=기본-설정-매개변수>기본 설정 매개변수<a hidden class=anchor aria-hidden=true href=#기본-설정-매개변수>#</a></h4><ul><li><strong>실패 임계값(Failure Threshold)</strong>: 열림 상태로 전환되기 위한 실패 수 또는 실패율</li><li><strong>성공 임계값(Success Threshold)</strong>: 반열림 상태에서 닫힘 상태로 전환되기 위한 성공 수</li><li><strong>타임아웃(Timeout)</strong>: 대상 서비스의 응답 제한 시간</li><li><strong>개방 지속 시간(Open Duration)</strong>: 열림 상태에서 반열림 상태로 전환되기까지의 시간</li><li><strong>볼륨 임계값(Volume Threshold)</strong>: 서킷 브레이커가 활성화되기 위한 최소 요청 수</li></ul><h4 id=고급-설정-매개변수>고급 설정 매개변수<a hidden class=anchor aria-hidden=true href=#고급-설정-매개변수>#</a></h4><ul><li><strong>슬라이딩 윈도우(Sliding Window)</strong>: 실패율 계산에 사용되는 시간 또는 호출 수 기반 윈도우</li><li><strong>버킷 크기(Bucket Size)</strong>: 슬라이딩 윈도우 내 버킷 수</li><li><strong>실패 예외 유형(Failure Exception Types)</strong>: 실패로 간주할 예외 유형 목록</li><li><strong>무시 예외 유형(Ignored Exception Types)</strong>: 실패로 간주하지 않을 예외 유형 목록</li></ul><h3 id=서킷-브레이커-패턴의-실제-적용-시나리오>서킷 브레이커 패턴의 실제 적용 시나리오<a hidden class=anchor aria-hidden=true href=#서킷-브레이커-패턴의-실제-적용-시나리오>#</a></h3><h4 id=api-게이트웨이>API 게이트웨이<a hidden class=anchor aria-hidden=true href=#api-게이트웨이>#</a></h4><p>API 게이트웨이에서 서킷 브레이커를 적용하여 다운스트림 서비스의 장애가 전체 시스템에 영향을 미치지 않도록 보호한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Spring Cloud Gateway 설정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spring</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cloud</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gateway</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>routes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>product-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>uri</span><span class=p>:</span><span class=w> </span><span class=l>lb://product-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>predicates</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>Path=/products/**</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>filters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>CircuitBreaker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>args</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>productServiceCircuitBreaker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>fallbackUri</span><span class=p>:</span><span class=w> </span><span class=l>forward:/fallback/products</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=마이크로서비스-간-통신>마이크로서비스 간 통신<a hidden class=anchor aria-hidden=true href=#마이크로서비스-간-통신>#</a></h4><p>마이크로서비스 아키텍처에서 서비스 간 통신 시 서킷 브레이커를 적용하여 한 서비스의 장애가 다른 서비스로 전파되는 것을 방지한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17>17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18>18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19>19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20>20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21>21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22>22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23>23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24>24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25>25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26>26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27>27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28>28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29>29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30>30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31>31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32>32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33>33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34>34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35>35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ResilienceConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Customizer</span><span class=o>&lt;</span><span class=n>Resilience4JCircuitBreakerFactory</span><span class=o>&gt;</span><span class=w> </span><span class=nf>defaultCustomizer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 서킷 브레이커 기본 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>factory</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>factory</span><span class=p>.</span><span class=na>configureDefault</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Resilience4JConfigBuilder</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>circuitBreakerConfig</span><span class=p>(</span><span class=n>CircuitBreakerConfig</span><span class=p>.</span><span class=na>custom</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>slidingWindowType</span><span class=p>(</span><span class=n>SlidingWindowType</span><span class=p>.</span><span class=na>COUNT_BASED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>slidingWindowSize</span><span class=p>(</span><span class=n>10</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>failureRateThreshold</span><span class=p>(</span><span class=n>50</span><span class=p>.</span><span class=na>0f</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>waitDurationInOpenState</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>10</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>permittedNumberOfCallsInHalfOpenState</span><span class=p>(</span><span class=n>5</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>automaticTransitionFromOpenToHalfOpenEnabled</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>timeLimiterConfig</span><span class=p>(</span><span class=n>TimeLimiterConfig</span><span class=p>.</span><span class=na>custom</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>timeoutDuration</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>3</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 서비스별 커스텀 설정도 가능</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Customizer</span><span class=o>&lt;</span><span class=n>Resilience4JCircuitBreakerFactory</span><span class=o>&gt;</span><span class=w> </span><span class=nf>paymentServiceCustomizer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>factory</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>factory</span><span class=p>.</span><span class=na>configure</span><span class=p>(</span><span class=n>builder</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>builder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>circuitBreakerConfig</span><span class=p>(</span><span class=n>CircuitBreakerConfig</span><span class=p>.</span><span class=na>custom</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>failureRateThreshold</span><span class=p>(</span><span class=n>30</span><span class=p>.</span><span class=na>0f</span><span class=p>)</span><span class=w>  </span><span class=c1>// 결제 서비스는 더 민감하게 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>waitDurationInOpenState</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>20</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>},</span><span class=w> </span><span class=s>&#34;paymentService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=데이터베이스-액세스>데이터베이스 액세스<a hidden class=anchor aria-hidden=true href=#데이터베이스-액세스>#</a></h4><p>데이터베이스 연결 풀과 쿼리 실행에 서킷 브레이커를 적용하여 데이터베이스 장애 시 시스템 보호:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span><span class=lnt id=hl-22-17><a class=lnlinks href=#hl-22-17>17</a>
</span><span class=lnt id=hl-22-18><a class=lnlinks href=#hl-22-18>18</a>
</span><span class=lnt id=hl-22-19><a class=lnlinks href=#hl-22-19>19</a>
</span><span class=lnt id=hl-22-20><a class=lnlinks href=#hl-22-20>20</a>
</span><span class=lnt id=hl-22-21><a class=lnlinks href=#hl-22-21>21</a>
</span><span class=lnt id=hl-22-22><a class=lnlinks href=#hl-22-22>22</a>
</span><span class=lnt id=hl-22-23><a class=lnlinks href=#hl-22-23>23</a>
</span><span class=lnt id=hl-22-24><a class=lnlinks href=#hl-22-24>24</a>
</span><span class=lnt id=hl-22-25><a class=lnlinks href=#hl-22-25>25</a>
</span><span class=lnt id=hl-22-26><a class=lnlinks href=#hl-22-26>26</a>
</span><span class=lnt id=hl-22-27><a class=lnlinks href=#hl-22-27>27</a>
</span><span class=lnt id=hl-22-28><a class=lnlinks href=#hl-22-28>28</a>
</span><span class=lnt id=hl-22-29><a class=lnlinks href=#hl-22-29>29</a>
</span><span class=lnt id=hl-22-30><a class=lnlinks href=#hl-22-30>30</a>
</span><span class=lnt id=hl-22-31><a class=lnlinks href=#hl-22-31>31</a>
</span><span class=lnt id=hl-22-32><a class=lnlinks href=#hl-22-32>32</a>
</span><span class=lnt id=hl-22-33><a class=lnlinks href=#hl-22-33>33</a>
</span><span class=lnt id=hl-22-34><a class=lnlinks href=#hl-22-34>34</a>
</span><span class=lnt id=hl-22-35><a class=lnlinks href=#hl-22-35>35</a>
</span><span class=lnt id=hl-22-36><a class=lnlinks href=#hl-22-36>36</a>
</span><span class=lnt id=hl-22-37><a class=lnlinks href=#hl-22-37>37</a>
</span><span class=lnt id=hl-22-38><a class=lnlinks href=#hl-22-38>38</a>
</span><span class=lnt id=hl-22-39><a class=lnlinks href=#hl-22-39>39</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ProductRepository</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JdbcTemplate</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ProductRepository</span><span class=p>(</span><span class=n>JdbcTemplate</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>,</span><span class=w> </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>jdbcTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;databaseCircuitBreaker&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findById</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Resilience4j 함수형 인터페이스 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>databaseCall</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT * FROM products WHERE id = ?&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>query</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>sql</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=p>{</span><span class=n>id</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>(</span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>rowNum</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Product</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rs</span><span class=p>.</span><span class=na>getLong</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rs</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;name&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rs</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;description&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>products</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>()</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>Optional</span><span class=p>.</span><span class=na>empty</span><span class=p>()</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>products</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>0</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 대체 로직 (캐시에서 조회 또는 기본값 반환)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Function</span><span class=o>&lt;</span><span class=n>Throwable</span><span class=p>,</span><span class=w> </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>fallback</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>throwable</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 로깅</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;데이터베이스 쿼리 실패&#34;</span><span class=p>,</span><span class=w> </span><span class=n>throwable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 캐시에서 조회 시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>cacheService</span><span class=p>.</span><span class=na>getProductFromCache</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 서킷 브레이커 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>decorateSupplier</span><span class=p>(</span><span class=n>databaseCall</span><span class=p>).</span><span class=na>recover</span><span class=p>(</span><span class=n>fallback</span><span class=p>).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=서킷-브레이커의-모니터링-및-관리>서킷 브레이커의 모니터링 및 관리<a hidden class=anchor aria-hidden=true href=#서킷-브레이커의-모니터링-및-관리>#</a></h3><p>효과적인 서킷 브레이커 구현을 위해서는 적절한 모니터링과 관리가 필수적이다.</p><h4 id=핵심-메트릭>핵심 메트릭<a hidden class=anchor aria-hidden=true href=#핵심-메트릭>#</a></h4><ul><li><strong>호출 성공률/실패율</strong>: 서비스 호출의 성공 및 실패 비율</li><li><strong>응답 시간</strong>: 서비스 호출의 평균, 중앙값, 최대 응답 시간</li><li><strong>서킷 브레이커 상태</strong>: 현재 상태(닫힘, 열림, 반열림)와 상태 전환 횟수</li><li><strong>요청 볼륨</strong>: 단위 시간당 요청 수</li><li><strong>거부 요청 수</strong>: 열림 상태에서 거부된 요청 수</li></ul><h4 id=모니터링-도구>모니터링 도구<a hidden class=anchor aria-hidden=true href=#모니터링-도구>#</a></h4><ol><li><p><strong>Prometheus + Grafana</strong>: 메트릭 수집 및 시각화</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3>3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4>4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Resilience4j Prometheus 설정 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>resilience4j.prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>Actuator + Spring Boot Admin</strong>: 서킷 브레이커 상태 및 메트릭 확인</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1>1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2>2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3>3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4>4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5>5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6>6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7>7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>management</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>endpoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exposure</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>health,info,circuitbreakers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>circuitbreakers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong>AWS CloudWatch</strong>: AWS 환경에서의 모니터링</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// CloudWatch 메트릭 게시 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>CloudWatchAsyncClient</span><span class=w> </span><span class=n>cloudWatchClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CloudWatchAsyncClient</span><span class=p>.</span><span class=na>create</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>MetricDatum</span><span class=w> </span><span class=n>datum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MetricDatum</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>metricName</span><span class=p>(</span><span class=s>&#34;CircuitBreakerStateChange&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>dimensions</span><span class=p>(</span><span class=n>Dimension</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>name</span><span class=p>(</span><span class=s>&#34;ServiceName&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>value</span><span class=p>(</span><span class=s>&#34;ProductService&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>value</span><span class=p>(</span><span class=n>state</span><span class=p>.</span><span class=na>ordinal</span><span class=p>())</span><span class=w>  </span><span class=c1>// 0: 닫힘, 1: 열림, 2: 반열림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>timestamp</span><span class=p>(</span><span class=n>Instant</span><span class=p>.</span><span class=na>now</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>unit</span><span class=p>(</span><span class=n>StandardUnit</span><span class=p>.</span><span class=na>COUNT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>cloudWatchClient</span><span class=p>.</span><span class=na>putMetricData</span><span class=p>(</span><span class=n>PutMetricDataRequest</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>namespace</span><span class=p>(</span><span class=s>&#34;MyApplication/CircuitBreakers&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>metricData</span><span class=p>(</span><span class=n>datum</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=서킷-브레이커-패턴의-발전과-활용>서킷 브레이커 패턴의 발전과 활용<a hidden class=anchor aria-hidden=true href=#서킷-브레이커-패턴의-발전과-활용>#</a></h3><h4 id=벌크헤드-패턴bulkhead-pattern과의-결합>벌크헤드 패턴(Bulkhead Pattern)과의 결합<a hidden class=anchor aria-hidden=true href=#벌크헤드-패턴bulkhead-pattern과의-결합>#</a></h4><p>벌크헤드 패턴은 시스템을 격리된 구획으로 나누어 한 부분의 장애가 다른 부분에 영향을 미치지 않도록 하는 패턴이다. 서킷 브레이커와 함께 사용하면 시스템 안정성을 더욱 강화할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1> 1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2> 2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3> 3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4> 4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5> 5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6> 6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7> 7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8> 8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9> 9</a>
</span><span class=lnt id=hl-26-10><a class=lnlinks href=#hl-26-10>10</a>
</span><span class=lnt id=hl-26-11><a class=lnlinks href=#hl-26-11>11</a>
</span><span class=lnt id=hl-26-12><a class=lnlinks href=#hl-26-12>12</a>
</span><span class=lnt id=hl-26-13><a class=lnlinks href=#hl-26-13>13</a>
</span><span class=lnt id=hl-26-14><a class=lnlinks href=#hl-26-14>14</a>
</span><span class=lnt id=hl-26-15><a class=lnlinks href=#hl-26-15>15</a>
</span><span class=lnt id=hl-26-16><a class=lnlinks href=#hl-26-16>16</a>
</span><span class=lnt id=hl-26-17><a class=lnlinks href=#hl-26-17>17</a>
</span><span class=lnt id=hl-26-18><a class=lnlinks href=#hl-26-18>18</a>
</span><span class=lnt id=hl-26-19><a class=lnlinks href=#hl-26-19>19</a>
</span><span class=lnt id=hl-26-20><a class=lnlinks href=#hl-26-20>20</a>
</span><span class=lnt id=hl-26-21><a class=lnlinks href=#hl-26-21>21</a>
</span><span class=lnt id=hl-26-22><a class=lnlinks href=#hl-26-22>22</a>
</span><span class=lnt id=hl-26-23><a class=lnlinks href=#hl-26-23>23</a>
</span><span class=lnt id=hl-26-24><a class=lnlinks href=#hl-26-24>24</a>
</span><span class=lnt id=hl-26-25><a class=lnlinks href=#hl-26-25>25</a>
</span><span class=lnt id=hl-26-26><a class=lnlinks href=#hl-26-26>26</a>
</span><span class=lnt id=hl-26-27><a class=lnlinks href=#hl-26-27>27</a>
</span><span class=lnt id=hl-26-28><a class=lnlinks href=#hl-26-28>28</a>
</span><span class=lnt id=hl-26-29><a class=lnlinks href=#hl-26-29>29</a>
</span><span class=lnt id=hl-26-30><a class=lnlinks href=#hl-26-30>30</a>
</span><span class=lnt id=hl-26-31><a class=lnlinks href=#hl-26-31>31</a>
</span><span class=lnt id=hl-26-32><a class=lnlinks href=#hl-26-32>32</a>
</span><span class=lnt id=hl-26-33><a class=lnlinks href=#hl-26-33>33</a>
</span><span class=lnt id=hl-26-34><a class=lnlinks href=#hl-26-34>34</a>
</span><span class=lnt id=hl-26-35><a class=lnlinks href=#hl-26-35>35</a>
</span><span class=lnt id=hl-26-36><a class=lnlinks href=#hl-26-36>36</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Resilience4j의 벌크헤드 패턴 구현 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>UserService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Bulkhead</span><span class=w> </span><span class=n>bulkhead</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>UserService</span><span class=p>(</span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                       </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>circuitBreakerRegistry</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                       </span><span class=n>BulkheadRegistry</span><span class=w> </span><span class=n>bulkheadRegistry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>restTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerRegistry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;userService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>bulkhead</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bulkheadRegistry</span><span class=p>.</span><span class=na>bulkhead</span><span class=p>(</span><span class=s>&#34;userService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=nf>getUserById</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 벌크헤드와 서킷 브레이커 조합</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>decoratedSupplier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Bulkhead</span><span class=p>.</span><span class=na>decorateSupplier</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>bulkhead</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CircuitBreaker</span><span class=p>.</span><span class=na>decorateSupplier</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>circuitBreaker</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForObject</span><span class=p>(</span><span class=s>&#34;/users/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 폴백 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Try</span><span class=p>.</span><span class=na>ofSupplier</span><span class=p>(</span><span class=n>decoratedSupplier</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>recover</span><span class=p>(</span><span class=n>throwable</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>getFallbackUser</span><span class=p>(</span><span class=n>id</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=nf>getFallbackUser</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Unknown&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;unknown@example.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=레이트-리미터rate-limiter와의-결합>레이트 리미터(Rate Limiter)와의 결합<a hidden class=anchor aria-hidden=true href=#레이트-리미터rate-limiter와의-결합>#</a></h4><p>레이트 리미터는 특정 시간 내에 수행할 수 있는 요청 수를 제한하는 패턴이다. 서킷 브레이커와 함께 사용하면 시스템 과부하를 효과적으로 방지할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17>17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18>18</a>
</span><span class=lnt id=hl-27-19><a class=lnlinks href=#hl-27-19>19</a>
</span><span class=lnt id=hl-27-20><a class=lnlinks href=#hl-27-20>20</a>
</span><span class=lnt id=hl-27-21><a class=lnlinks href=#hl-27-21>21</a>
</span><span class=lnt id=hl-27-22><a class=lnlinks href=#hl-27-22>22</a>
</span><span class=lnt id=hl-27-23><a class=lnlinks href=#hl-27-23>23</a>
</span><span class=lnt id=hl-27-24><a class=lnlinks href=#hl-27-24>24</a>
</span><span class=lnt id=hl-27-25><a class=lnlinks href=#hl-27-25>25</a>
</span><span class=lnt id=hl-27-26><a class=lnlinks href=#hl-27-26>26</a>
</span><span class=lnt id=hl-27-27><a class=lnlinks href=#hl-27-27>27</a>
</span><span class=lnt id=hl-27-28><a class=lnlinks href=#hl-27-28>28</a>
</span><span class=lnt id=hl-27-29><a class=lnlinks href=#hl-27-29>29</a>
</span><span class=lnt id=hl-27-30><a class=lnlinks href=#hl-27-30>30</a>
</span><span class=lnt id=hl-27-31><a class=lnlinks href=#hl-27-31>31</a>
</span><span class=lnt id=hl-27-32><a class=lnlinks href=#hl-27-32>32</a>
</span><span class=lnt id=hl-27-33><a class=lnlinks href=#hl-27-33>33</a>
</span><span class=lnt id=hl-27-34><a class=lnlinks href=#hl-27-34>34</a>
</span><span class=lnt id=hl-27-35><a class=lnlinks href=#hl-27-35>35</a>
</span><span class=lnt id=hl-27-36><a class=lnlinks href=#hl-27-36>36</a>
</span><span class=lnt id=hl-27-37><a class=lnlinks href=#hl-27-37>37</a>
</span><span class=lnt id=hl-27-38><a class=lnlinks href=#hl-27-38>38</a>
</span><span class=lnt id=hl-27-39><a class=lnlinks href=#hl-27-39>39</a>
</span><span class=lnt id=hl-27-40><a class=lnlinks href=#hl-27-40>40</a>
</span><span class=lnt id=hl-27-41><a class=lnlinks href=#hl-27-41>41</a>
</span><span class=lnt id=hl-27-42><a class=lnlinks href=#hl-27-42>42</a>
</span><span class=lnt id=hl-27-43><a class=lnlinks href=#hl-27-43>43</a>
</span><span class=lnt id=hl-27-44><a class=lnlinks href=#hl-27-44>44</a>
</span><span class=lnt id=hl-27-45><a class=lnlinks href=#hl-27-45>45</a>
</span><span class=lnt id=hl-27-46><a class=lnlinks href=#hl-27-46>46</a>
</span><span class=lnt id=hl-27-47><a class=lnlinks href=#hl-27-47>47</a>
</span><span class=lnt id=hl-27-48><a class=lnlinks href=#hl-27-48>48</a>
</span><span class=lnt id=hl-27-49><a class=lnlinks href=#hl-27-49>49</a>
</span><span class=lnt id=hl-27-50><a class=lnlinks href=#hl-27-50>50</a>
</span><span class=lnt id=hl-27-51><a class=lnlinks href=#hl-27-51>51</a>
</span><span class=lnt id=hl-27-52><a class=lnlinks href=#hl-27-52>52</a>
</span><span class=lnt id=hl-27-53><a class=lnlinks href=#hl-27-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Resilience4j의 레이트 리미터 구현 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ResilienceConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>RateLimiterRegistry</span><span class=w> </span><span class=nf>rateLimiterRegistry</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RateLimiterConfig</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RateLimiterConfig</span><span class=p>.</span><span class=na>custom</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>limitRefreshPeriod</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>1</span><span class=p>))</span><span class=w>  </span><span class=c1>// 1초마다 갱신</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>limitForPeriod</span><span class=p>(</span><span class=n>100</span><span class=p>)</span><span class=w>                        </span><span class=c1>// 초당 100개 요청 허용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>timeoutDuration</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofMillis</span><span class=p>(</span><span class=n>500</span><span class=p>))</span><span class=w>    </span><span class=c1>// 500ms 대기 후 거부</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>RateLimiterRegistry</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>config</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>RateLimiter</span><span class=w> </span><span class=nf>apiRateLimiter</span><span class=p>(</span><span class=n>RateLimiterRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>rateLimiter</span><span class=p>(</span><span class=s>&#34;apiRateLimiter&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ApiService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RateLimiter</span><span class=w> </span><span class=n>rateLimiter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ApiService</span><span class=p>(</span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                      </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>circuitBreakerRegistry</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                      </span><span class=n>RateLimiter</span><span class=w> </span><span class=n>rateLimiter</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>restTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerRegistry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;apiService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>rateLimiter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rateLimiter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ApiResponse</span><span class=w> </span><span class=nf>callExternalApi</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 레이트 리미터 + 서킷 브레이커 조합</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>ApiResponse</span><span class=o>&gt;</span><span class=w> </span><span class=n>decoratedSupplier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RateLimiter</span><span class=p>.</span><span class=na>decorateSupplier</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>rateLimiter</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CircuitBreaker</span><span class=p>.</span><span class=na>decorateSupplier</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>circuitBreaker</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>postForObject</span><span class=p>(</span><span class=s>&#34;/api&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>ApiResponse</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Try</span><span class=p>.</span><span class=na>ofSupplier</span><span class=p>(</span><span class=n>decoratedSupplier</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>recover</span><span class=p>(</span><span class=n>RequestNotPermitted</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ApiResponse</span><span class=p>(</span><span class=s>&#34;Rate limited&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>recover</span><span class=p>(</span><span class=n>CallNotPermittedException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ApiResponse</span><span class=p>(</span><span class=s>&#34;Circuit open&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>recover</span><span class=p>(</span><span class=n>throwable</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ApiResponse</span><span class=p>(</span><span class=s>&#34;Generic error: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>throwable</span><span class=p>.</span><span class=na>getMessage</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=타임아웃timeout-패턴과의-결합>타임아웃(Timeout) 패턴과의 결합<a hidden class=anchor aria-hidden=true href=#타임아웃timeout-패턴과의-결합>#</a></h4><p>타임아웃 패턴은 응답이 지연될 경우 일정 시간 후 요청을 취소하는 패턴이다. 서킷 브레이커와 함께 사용하면 시스템 리소스를 효율적으로 관리할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18>18</a>
</span><span class=lnt id=hl-28-19><a class=lnlinks href=#hl-28-19>19</a>
</span><span class=lnt id=hl-28-20><a class=lnlinks href=#hl-28-20>20</a>
</span><span class=lnt id=hl-28-21><a class=lnlinks href=#hl-28-21>21</a>
</span><span class=lnt id=hl-28-22><a class=lnlinks href=#hl-28-22>22</a>
</span><span class=lnt id=hl-28-23><a class=lnlinks href=#hl-28-23>23</a>
</span><span class=lnt id=hl-28-24><a class=lnlinks href=#hl-28-24>24</a>
</span><span class=lnt id=hl-28-25><a class=lnlinks href=#hl-28-25>25</a>
</span><span class=lnt id=hl-28-26><a class=lnlinks href=#hl-28-26>26</a>
</span><span class=lnt id=hl-28-27><a class=lnlinks href=#hl-28-27>27</a>
</span><span class=lnt id=hl-28-28><a class=lnlinks href=#hl-28-28>28</a>
</span><span class=lnt id=hl-28-29><a class=lnlinks href=#hl-28-29>29</a>
</span><span class=lnt id=hl-28-30><a class=lnlinks href=#hl-28-30>30</a>
</span><span class=lnt id=hl-28-31><a class=lnlinks href=#hl-28-31>31</a>
</span><span class=lnt id=hl-28-32><a class=lnlinks href=#hl-28-32>32</a>
</span><span class=lnt id=hl-28-33><a class=lnlinks href=#hl-28-33>33</a>
</span><span class=lnt id=hl-28-34><a class=lnlinks href=#hl-28-34>34</a>
</span><span class=lnt id=hl-28-35><a class=lnlinks href=#hl-28-35>35</a>
</span><span class=lnt id=hl-28-36><a class=lnlinks href=#hl-28-36>36</a>
</span><span class=lnt id=hl-28-37><a class=lnlinks href=#hl-28-37>37</a>
</span><span class=lnt id=hl-28-38><a class=lnlinks href=#hl-28-38>38</a>
</span><span class=lnt id=hl-28-39><a class=lnlinks href=#hl-28-39>39</a>
</span><span class=lnt id=hl-28-40><a class=lnlinks href=#hl-28-40>40</a>
</span><span class=lnt id=hl-28-41><a class=lnlinks href=#hl-28-41>41</a>
</span><span class=lnt id=hl-28-42><a class=lnlinks href=#hl-28-42>42</a>
</span><span class=lnt id=hl-28-43><a class=lnlinks href=#hl-28-43>43</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Resilience4j의 타임리미터 구현 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>TimeLimiter</span><span class=w> </span><span class=n>timeLimiter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>OrderService</span><span class=p>(</span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>circuitBreakerRegistry</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>TimeLimiterRegistry</span><span class=w> </span><span class=n>timeLimiterRegistry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>restTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerRegistry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;orderService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>timeLimiter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>timeLimiterRegistry</span><span class=p>.</span><span class=na>timeLimiter</span><span class=p>(</span><span class=s>&#34;orderService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>createOrder</span><span class=p>(</span><span class=n>OrderRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 타임리미터 + 서킷 브레이커 조합</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>futureSupplier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>CompletableFuture</span><span class=p>.</span><span class=na>supplyAsync</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>postForObject</span><span class=p>(</span><span class=s>&#34;/orders&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>Order</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>decoratedSupplier</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>TimeLimiter</span><span class=p>.</span><span class=na>decorateFutureSupplier</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>timeLimiter</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>CircuitBreaker</span><span class=p>.</span><span class=na>decorateSupplier</span><span class=p>(</span><span class=n>circuitBreaker</span><span class=p>,</span><span class=w> </span><span class=n>futureSupplier</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Try</span><span class=p>.</span><span class=na>ofSupplier</span><span class=p>(</span><span class=n>decoratedSupplier</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>recover</span><span class=p>(</span><span class=n>TimeoutException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>CompletableFuture</span><span class=p>.</span><span class=na>completedFuture</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>new</span><span class=w> </span><span class=n>Order</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s>&#34;TIMEOUT&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;주문 처리 시간 초과&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>recover</span><span class=p>(</span><span class=n>CallNotPermittedException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>CompletableFuture</span><span class=p>.</span><span class=na>completedFuture</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>new</span><span class=w> </span><span class=n>Order</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s>&#34;CIRCUIT_OPEN&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;서비스 일시적으로 사용 불가&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>recover</span><span class=p>(</span><span class=n>throwable</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>CompletableFuture</span><span class=p>.</span><span class=na>completedFuture</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>new</span><span class=w> </span><span class=n>Order</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s>&#34;ERROR&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;주문 처리 중 오류 발생&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=서킷-브레이커-패턴의-장단점>서킷 브레이커 패턴의 장단점<a hidden class=anchor aria-hidden=true href=#서킷-브레이커-패턴의-장단점>#</a></h3><h4 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h4><ol><li><strong>시스템 안정성 향상</strong>: 연쇄 장애 방지 및 시스템 복원력 증가</li><li><strong>리소스 최적화</strong>: 실패할 것이 명백한 요청 차단으로 리소스 절약</li><li><strong>사용자 경험 개선</strong>: 빠른 실패 응답으로 사용자 대기 시간 감소</li><li><strong>장애 격리</strong>: 문제가 있는 서비스를 격리하여 전체 시스템 보호</li><li><strong>자동 복구</strong>: 시스템 자가 회복 메커니즘 제공</li></ol><h4 id=단점-2>단점<a hidden class=anchor aria-hidden=true href=#단점-2>#</a></h4><ol><li><strong>구현 복잡성</strong>: 적절한 임계값과 타임아웃 설정이 어려울 수 있음</li><li><strong>오버헤드</strong>: 각 요청에 대한 추가 처리 로직 필요</li><li><strong>폴백 설계 난이도</strong>: 적절한 대체 응답 설계가 어려울 수 있음</li><li><strong>테스트 어려움</strong>: 다양한 장애 상황 시뮬레이션 필요</li><li><strong>임계값 설정 문제</strong>: 너무 민감하거나 둔감한 설정이 시스템에 영향을 줄 수 있음</li></ol><h3 id=서킷-브레이커-패턴-구현-시-모범-사례>서킷 브레이커 패턴 구현 시 모범 사례<a hidden class=anchor aria-hidden=true href=#서킷-브레이커-패턴-구현-시-모범-사례>#</a></h3><ul><li><p>설계 모범 사례</p><ol><li><strong>서비스별 맞춤 설정</strong>: 각 서비스의 특성에 맞게 임계값과 타임아웃 설정</li><li><strong>점진적 도입</strong>: 중요도가 낮은 서비스부터 시작하여 점진적으로 확대</li><li><strong>폴백 전략 구체화</strong>: 서비스 특성에 맞는 의미 있는 대체 응답 설계</li><li><strong>로깅 및 알림 통합</strong>: 서킷 브레이커 상태 변화를 로깅하고 알림 설정</li></ol></li><li><p>구현 모범 사례</p><ol><li><strong>처리 시간 제한</strong>: 타임아웃 설정으로 응답 지연 방지</li><li><strong>점진적 복구</strong>: 반열림 상태에서 요청 수를 점진적으로 증가시켜 안정성 확보</li><li><strong>상태 저장소 분리</strong>: 서킷 브레이커 상태를 분산 저장소에 저장하여 다중 인스턴스 환경 지원</li><li><strong>실패 유형 구분</strong>: 모든 오류를 동일하게 취급하지 않고 일시적/영구적 오류 구분</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13>13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14>14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15>15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16>16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 실패 유형 구분 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>CircuitBreakerConfig</span><span class=w> </span><span class=n>circuitBreakerConfig</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CircuitBreakerConfig</span><span class=p>.</span><span class=na>custom</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>failureRateThreshold</span><span class=p>(</span><span class=n>50</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>waitDurationInOpenState</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofMillis</span><span class=p>(</span><span class=n>1000</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>permittedNumberOfCallsInHalfOpenState</span><span class=p>(</span><span class=n>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 일시적 오류로 간주할 예외 유형 지정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>recordExceptions</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>IOException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>TimeoutException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HttpServerErrorException</span><span class=p>.</span><span class=na>class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 영구적 오류로 간주하여 카운트하지 않을 예외 유형 지정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>ignoreExceptions</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HttpClientErrorException</span><span class=p>.</span><span class=na>BadRequest</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>IllegalArgumentException</span><span class=p>.</span><span class=na>class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=실제-환경에서의-서킷-브레이커-적용-전략>실제 환경에서의 서킷 브레이커 적용 전략<a hidden class=anchor aria-hidden=true href=#실제-환경에서의-서킷-브레이커-적용-전략>#</a></h3><p>서킷 브레이커는 이론적으로는 단순하지만, 실제 환경에서 효과적으로 구현하려면 세심한 계획과 전략이 필요하다.</p><h4 id=마이크로서비스-아키텍처에서의-적용>마이크로서비스 아키텍처에서의 적용<a hidden class=anchor aria-hidden=true href=#마이크로서비스-아키텍처에서의-적용>#</a></h4><p>마이크로서비스 아키텍처에서는 서비스 간 통신이 빈번하게 발생하므로 서킷 브레이커가 특히 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12>12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13>13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14>14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15>15</a>
</span><span class=lnt id=hl-30-16><a class=lnlinks href=#hl-30-16>16</a>
</span><span class=lnt id=hl-30-17><a class=lnlinks href=#hl-30-17>17</a>
</span><span class=lnt id=hl-30-18><a class=lnlinks href=#hl-30-18>18</a>
</span><span class=lnt id=hl-30-19><a class=lnlinks href=#hl-30-19>19</a>
</span><span class=lnt id=hl-30-20><a class=lnlinks href=#hl-30-20>20</a>
</span><span class=lnt id=hl-30-21><a class=lnlinks href=#hl-30-21>21</a>
</span><span class=lnt id=hl-30-22><a class=lnlinks href=#hl-30-22>22</a>
</span><span class=lnt id=hl-30-23><a class=lnlinks href=#hl-30-23>23</a>
</span><span class=lnt id=hl-30-24><a class=lnlinks href=#hl-30-24>24</a>
</span><span class=lnt id=hl-30-25><a class=lnlinks href=#hl-30-25>25</a>
</span><span class=lnt id=hl-30-26><a class=lnlinks href=#hl-30-26>26</a>
</span><span class=lnt id=hl-30-27><a class=lnlinks href=#hl-30-27>27</a>
</span><span class=lnt id=hl-30-28><a class=lnlinks href=#hl-30-28>28</a>
</span><span class=lnt id=hl-30-29><a class=lnlinks href=#hl-30-29>29</a>
</span><span class=lnt id=hl-30-30><a class=lnlinks href=#hl-30-30>30</a>
</span><span class=lnt id=hl-30-31><a class=lnlinks href=#hl-30-31>31</a>
</span><span class=lnt id=hl-30-32><a class=lnlinks href=#hl-30-32>32</a>
</span><span class=lnt id=hl-30-33><a class=lnlinks href=#hl-30-33>33</a>
</span><span class=lnt id=hl-30-34><a class=lnlinks href=#hl-30-34>34</a>
</span><span class=lnt id=hl-30-35><a class=lnlinks href=#hl-30-35>35</a>
</span><span class=lnt id=hl-30-36><a class=lnlinks href=#hl-30-36>36</a>
</span><span class=lnt id=hl-30-37><a class=lnlinks href=#hl-30-37>37</a>
</span><span class=lnt id=hl-30-38><a class=lnlinks href=#hl-30-38>38</a>
</span><span class=lnt id=hl-30-39><a class=lnlinks href=#hl-30-39>39</a>
</span><span class=lnt id=hl-30-40><a class=lnlinks href=#hl-30-40>40</a>
</span><span class=lnt id=hl-30-41><a class=lnlinks href=#hl-30-41>41</a>
</span><span class=lnt id=hl-30-42><a class=lnlinks href=#hl-30-42>42</a>
</span><span class=lnt id=hl-30-43><a class=lnlinks href=#hl-30-43>43</a>
</span><span class=lnt id=hl-30-44><a class=lnlinks href=#hl-30-44>44</a>
</span><span class=lnt id=hl-30-45><a class=lnlinks href=#hl-30-45>45</a>
</span><span class=lnt id=hl-30-46><a class=lnlinks href=#hl-30-46>46</a>
</span><span class=lnt id=hl-30-47><a class=lnlinks href=#hl-30-47>47</a>
</span><span class=lnt id=hl-30-48><a class=lnlinks href=#hl-30-48>48</a>
</span><span class=lnt id=hl-30-49><a class=lnlinks href=#hl-30-49>49</a>
</span><span class=lnt id=hl-30-50><a class=lnlinks href=#hl-30-50>50</a>
</span><span class=lnt id=hl-30-51><a class=lnlinks href=#hl-30-51>51</a>
</span><span class=lnt id=hl-30-52><a class=lnlinks href=#hl-30-52>52</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 마이크로서비스 환경에서의 서킷 브레이커 구성 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MicroserviceResilienceConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=nf>circuitBreakerRegistry</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 기본 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CircuitBreakerConfig</span><span class=w> </span><span class=n>defaultConfig</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CircuitBreakerConfig</span><span class=p>.</span><span class=na>custom</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>failureRateThreshold</span><span class=p>(</span><span class=n>50</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>slowCallRateThreshold</span><span class=p>(</span><span class=n>50</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>slowCallDurationThreshold</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>2</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>permittedNumberOfCallsInHalfOpenState</span><span class=p>(</span><span class=n>10</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>slidingWindowSize</span><span class=p>(</span><span class=n>100</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>minimumNumberOfCalls</span><span class=p>(</span><span class=n>10</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>waitDurationInOpenState</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>60</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 서비스별 맞춤 설정 지도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>CircuitBreakerConfig</span><span class=o>&gt;</span><span class=w> </span><span class=n>configs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 결제 서비스 - 매우 중요한 서비스이므로 더 관대한 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>configs</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;paymentService&#34;</span><span class=p>,</span><span class=w> </span><span class=n>CircuitBreakerConfig</span><span class=p>.</span><span class=na>custom</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>failureRateThreshold</span><span class=p>(</span><span class=n>70</span><span class=p>)</span><span class=w>  </span><span class=c1>// 70% 실패율에서만 열림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>waitDurationInOpenState</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>30</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 알림 서비스 - 덜 중요한 서비스이므로 더 엄격한 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>configs</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;notificationService&#34;</span><span class=p>,</span><span class=w> </span><span class=n>CircuitBreakerConfig</span><span class=p>.</span><span class=na>custom</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>failureRateThreshold</span><span class=p>(</span><span class=n>30</span><span class=p>)</span><span class=w>  </span><span class=c1>// 30% 실패율에서 열림</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>waitDurationInOpenState</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>120</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 레지스트리 생성 및 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>CircuitBreakerRegistry</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>defaultConfig</span><span class=p>,</span><span class=w> </span><span class=n>configs</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 각 서비스별 CircuitBreaker 빈 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=nf>paymentCircuitBreaker</span><span class=p>(</span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;paymentService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=nf>notificationCircuitBreaker</span><span class=p>(</span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;notificationService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=nf>inventoryCircuitBreaker</span><span class=p>(</span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;inventoryService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=클라우드-네이티브-환경에서의-구현>클라우드 네이티브 환경에서의 구현<a hidden class=anchor aria-hidden=true href=#클라우드-네이티브-환경에서의-구현>#</a></h4><p>쿠버네티스와 같은 클라우드 네이티브 환경에서는 서킷 브레이커를 효과적으로 관리하기 위한 추가 전략이 필요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10>10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11>11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12>12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13>13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14>14</a>
</span><span class=lnt id=hl-31-15><a class=lnlinks href=#hl-31-15>15</a>
</span><span class=lnt id=hl-31-16><a class=lnlinks href=#hl-31-16>16</a>
</span><span class=lnt id=hl-31-17><a class=lnlinks href=#hl-31-17>17</a>
</span><span class=lnt id=hl-31-18><a class=lnlinks href=#hl-31-18>18</a>
</span><span class=lnt id=hl-31-19><a class=lnlinks href=#hl-31-19>19</a>
</span><span class=lnt id=hl-31-20><a class=lnlinks href=#hl-31-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Istio 서비스 메시를 사용한 서킷 브레이커 구현 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.istio.io/v1alpha3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>DestinationRule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>order-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trafficPolicy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>connectionPool</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tcp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>maxConnections</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>connectTimeout</span><span class=p>:</span><span class=w> </span><span class=l>30ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>http1MaxPendingRequests</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>maxRequestsPerConnection</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>outlierDetection</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>consecutiveErrors</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>baseEjectionTime</span><span class=p>:</span><span class=w> </span><span class=l>60s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>maxEjectionPercent</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=대규모-시스템에서의-서킷-브레이커-계층화>대규모 시스템에서의 서킷 브레이커 계층화<a hidden class=anchor aria-hidden=true href=#대규모-시스템에서의-서킷-브레이커-계층화>#</a></h4><p>대규모 시스템에서는 다양한 수준에서 서킷 브레이커를 계층화하여 더 정교한 장애 관리가 가능하다.</p><ol><li><strong>API 게이트웨이 수준</strong>:<ul><li>클라이언트에서 들어오는 요청 관리</li><li>전체 서비스 가용성 보호</li></ul></li><li><strong>서비스 간 통신 수준</strong>:<ul><li>마이크로서비스 간 통신 보호</li><li>장애 격리</li></ul></li><li><strong>리소스 액세스 수준</strong>:<ul><li>데이터베이스, 캐시, 메시지 큐 등 리소스 연결 보호</li><li>백엔드 리소스 과부하 방지</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10>10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11>11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12>12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13>13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14>14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15>15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16>16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17>17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18>18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19>19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20>20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21>21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22>22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23>23</a>
</span><span class=lnt id=hl-32-24><a class=lnlinks href=#hl-32-24>24</a>
</span><span class=lnt id=hl-32-25><a class=lnlinks href=#hl-32-25>25</a>
</span><span class=lnt id=hl-32-26><a class=lnlinks href=#hl-32-26>26</a>
</span><span class=lnt id=hl-32-27><a class=lnlinks href=#hl-32-27>27</a>
</span><span class=lnt id=hl-32-28><a class=lnlinks href=#hl-32-28>28</a>
</span><span class=lnt id=hl-32-29><a class=lnlinks href=#hl-32-29>29</a>
</span><span class=lnt id=hl-32-30><a class=lnlinks href=#hl-32-30>30</a>
</span><span class=lnt id=hl-32-31><a class=lnlinks href=#hl-32-31>31</a>
</span><span class=lnt id=hl-32-32><a class=lnlinks href=#hl-32-32>32</a>
</span><span class=lnt id=hl-32-33><a class=lnlinks href=#hl-32-33>33</a>
</span><span class=lnt id=hl-32-34><a class=lnlinks href=#hl-32-34>34</a>
</span><span class=lnt id=hl-32-35><a class=lnlinks href=#hl-32-35>35</a>
</span><span class=lnt id=hl-32-36><a class=lnlinks href=#hl-32-36>36</a>
</span><span class=lnt id=hl-32-37><a class=lnlinks href=#hl-32-37>37</a>
</span><span class=lnt id=hl-32-38><a class=lnlinks href=#hl-32-38>38</a>
</span><span class=lnt id=hl-32-39><a class=lnlinks href=#hl-32-39>39</a>
</span><span class=lnt id=hl-32-40><a class=lnlinks href=#hl-32-40>40</a>
</span><span class=lnt id=hl-32-41><a class=lnlinks href=#hl-32-41>41</a>
</span><span class=lnt id=hl-32-42><a class=lnlinks href=#hl-32-42>42</a>
</span><span class=lnt id=hl-32-43><a class=lnlinks href=#hl-32-43>43</a>
</span><span class=lnt id=hl-32-44><a class=lnlinks href=#hl-32-44>44</a>
</span><span class=lnt id=hl-32-45><a class=lnlinks href=#hl-32-45>45</a>
</span><span class=lnt id=hl-32-46><a class=lnlinks href=#hl-32-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 계층화된 서킷 브레이커 예시 (데이터베이스 액세스 레벨)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderRepository</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JdbcTemplate</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>readCircuitBreaker</span><span class=p>;</span><span class=w>   </span><span class=c1>// 읽기 작업용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>writeCircuitBreaker</span><span class=p>;</span><span class=w>  </span><span class=c1>// 쓰기 작업용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>OrderRepository</span><span class=p>(</span><span class=n>JdbcTemplate</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>,</span><span class=w> </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>jdbcTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 읽기 작업은 더 관대한 설정(더 많은 실패 허용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>readCircuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;orderDbRead&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 쓰기 작업은 더 엄격한 설정(적은 실패만 허용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>writeCircuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;orderDbWrite&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findById</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>readCircuitBreaker</span><span class=p>.</span><span class=na>executeSupplier</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 읽기 작업 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT * FROM orders WHERE id = ?&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>query</span><span class=p>(</span><span class=n>sql</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=p>{</span><span class=n>id</span><span class=p>},</span><span class=w> </span><span class=p>(</span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>rowNum</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 결과 매핑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Order</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rs</span><span class=p>.</span><span class=na>getLong</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rs</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;status&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rs</span><span class=p>.</span><span class=na>getBigDecimal</span><span class=p>(</span><span class=s>&#34;total_amount&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}).</span><span class=na>stream</span><span class=p>().</span><span class=na>findFirst</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>writeCircuitBreaker</span><span class=p>.</span><span class=na>executeRunnable</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 쓰기 작업 실행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 신규 주문 생성</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;INSERT INTO orders (status, total_amount) VALUES (?, ?)&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=n>sql</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getStatus</span><span class=p>(),</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getTotalAmount</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 기존 주문 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;UPDATE orders SET status = ?, total_amount = ? WHERE id = ?&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=n>sql</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getStatus</span><span class=p>(),</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getTotalAmount</span><span class=p>(),</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=서킷-브레이커와-관련된-다른-안정성-패턴>서킷 브레이커와 관련된 다른 안정성 패턴<a hidden class=anchor aria-hidden=true href=#서킷-브레이커와-관련된-다른-안정성-패턴>#</a></h3><p>서킷 브레이커는 다른 안정성 패턴들과 함께 사용될 때 더 효과적이다. 이러한 패턴들을 조합하여 종합적인 안정성 전략을 구축할 수 있다.</p><h4 id=재시도retry-패턴>재시도(Retry) 패턴<a hidden class=anchor aria-hidden=true href=#재시도retry-패턴>#</a></h4><p>일시적인 오류가 발생할 경우 즉시 실패하지 않고 몇 번의 재시도를 통해 성공할 기회를 제공한다. 서킷 브레이커와 함께 사용할 경우, 재시도는 서킷이 열리기 전에 적용되어야 한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15>15</a>
</span><span class=lnt id=hl-33-16><a class=lnlinks href=#hl-33-16>16</a>
</span><span class=lnt id=hl-33-17><a class=lnlinks href=#hl-33-17>17</a>
</span><span class=lnt id=hl-33-18><a class=lnlinks href=#hl-33-18>18</a>
</span><span class=lnt id=hl-33-19><a class=lnlinks href=#hl-33-19>19</a>
</span><span class=lnt id=hl-33-20><a class=lnlinks href=#hl-33-20>20</a>
</span><span class=lnt id=hl-33-21><a class=lnlinks href=#hl-33-21>21</a>
</span><span class=lnt id=hl-33-22><a class=lnlinks href=#hl-33-22>22</a>
</span><span class=lnt id=hl-33-23><a class=lnlinks href=#hl-33-23>23</a>
</span><span class=lnt id=hl-33-24><a class=lnlinks href=#hl-33-24>24</a>
</span><span class=lnt id=hl-33-25><a class=lnlinks href=#hl-33-25>25</a>
</span><span class=lnt id=hl-33-26><a class=lnlinks href=#hl-33-26>26</a>
</span><span class=lnt id=hl-33-27><a class=lnlinks href=#hl-33-27>27</a>
</span><span class=lnt id=hl-33-28><a class=lnlinks href=#hl-33-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Resilience4j를 사용한 재시도 + 서킷 브레이커 패턴</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PaymentService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Retry</span><span class=w> </span><span class=n>retry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>PaymentService</span><span class=p>(</span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>circuitBreakerRegistry</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>RetryRegistry</span><span class=w> </span><span class=n>retryRegistry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>restTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakerRegistry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;paymentService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>retry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>retryRegistry</span><span class=p>.</span><span class=na>retry</span><span class=p>(</span><span class=s>&#34;paymentRetry&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PaymentResponse</span><span class=w> </span><span class=nf>processPayment</span><span class=p>(</span><span class=n>PaymentRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재시도 + 서킷 브레이커 조합 (주의: 순서가 중요)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>PaymentResponse</span><span class=o>&gt;</span><span class=w> </span><span class=n>paymentSupplier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>postForObject</span><span class=p>(</span><span class=s>&#34;/process&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>PaymentResponse</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 재시도는 내부에, 서킷 브레이커는 외부에 위치</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 이렇게 하면 재시도 후에도 실패하면 서킷 브레이커에 기록됨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>executeSupplier</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Retry</span><span class=p>.</span><span class=na>decorateSupplier</span><span class=p>(</span><span class=n>retry</span><span class=p>,</span><span class=w> </span><span class=n>paymentSupplier</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=폴백fallback-패턴>폴백(Fallback) 패턴<a hidden class=anchor aria-hidden=true href=#폴백fallback-패턴>#</a></h4><p>서비스 호출이 실패할 경우 대체 응답을 제공하는 패턴이다. 서킷 브레이커와 함께 사용하여 서킷이 열렸을 때 의미 있는 대체 응답을 제공할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1> 1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2> 2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3> 3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4> 4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5> 5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6> 6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7> 7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8> 8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9> 9</a>
</span><span class=lnt id=hl-34-10><a class=lnlinks href=#hl-34-10>10</a>
</span><span class=lnt id=hl-34-11><a class=lnlinks href=#hl-34-11>11</a>
</span><span class=lnt id=hl-34-12><a class=lnlinks href=#hl-34-12>12</a>
</span><span class=lnt id=hl-34-13><a class=lnlinks href=#hl-34-13>13</a>
</span><span class=lnt id=hl-34-14><a class=lnlinks href=#hl-34-14>14</a>
</span><span class=lnt id=hl-34-15><a class=lnlinks href=#hl-34-15>15</a>
</span><span class=lnt id=hl-34-16><a class=lnlinks href=#hl-34-16>16</a>
</span><span class=lnt id=hl-34-17><a class=lnlinks href=#hl-34-17>17</a>
</span><span class=lnt id=hl-34-18><a class=lnlinks href=#hl-34-18>18</a>
</span><span class=lnt id=hl-34-19><a class=lnlinks href=#hl-34-19>19</a>
</span><span class=lnt id=hl-34-20><a class=lnlinks href=#hl-34-20>20</a>
</span><span class=lnt id=hl-34-21><a class=lnlinks href=#hl-34-21>21</a>
</span><span class=lnt id=hl-34-22><a class=lnlinks href=#hl-34-22>22</a>
</span><span class=lnt id=hl-34-23><a class=lnlinks href=#hl-34-23>23</a>
</span><span class=lnt id=hl-34-24><a class=lnlinks href=#hl-34-24>24</a>
</span><span class=lnt id=hl-34-25><a class=lnlinks href=#hl-34-25>25</a>
</span><span class=lnt id=hl-34-26><a class=lnlinks href=#hl-34-26>26</a>
</span><span class=lnt id=hl-34-27><a class=lnlinks href=#hl-34-27>27</a>
</span><span class=lnt id=hl-34-28><a class=lnlinks href=#hl-34-28>28</a>
</span><span class=lnt id=hl-34-29><a class=lnlinks href=#hl-34-29>29</a>
</span><span class=lnt id=hl-34-30><a class=lnlinks href=#hl-34-30>30</a>
</span><span class=lnt id=hl-34-31><a class=lnlinks href=#hl-34-31>31</a>
</span><span class=lnt id=hl-34-32><a class=lnlinks href=#hl-34-32>32</a>
</span><span class=lnt id=hl-34-33><a class=lnlinks href=#hl-34-33>33</a>
</span><span class=lnt id=hl-34-34><a class=lnlinks href=#hl-34-34>34</a>
</span><span class=lnt id=hl-34-35><a class=lnlinks href=#hl-34-35>35</a>
</span><span class=lnt id=hl-34-36><a class=lnlinks href=#hl-34-36>36</a>
</span><span class=lnt id=hl-34-37><a class=lnlinks href=#hl-34-37>37</a>
</span><span class=lnt id=hl-34-38><a class=lnlinks href=#hl-34-38>38</a>
</span><span class=lnt id=hl-34-39><a class=lnlinks href=#hl-34-39>39</a>
</span><span class=lnt id=hl-34-40><a class=lnlinks href=#hl-34-40>40</a>
</span><span class=lnt id=hl-34-41><a class=lnlinks href=#hl-34-41>41</a>
</span><span class=lnt id=hl-34-42><a class=lnlinks href=#hl-34-42>42</a>
</span><span class=lnt id=hl-34-43><a class=lnlinks href=#hl-34-43>43</a>
</span><span class=lnt id=hl-34-44><a class=lnlinks href=#hl-34-44>44</a>
</span><span class=lnt id=hl-34-45><a class=lnlinks href=#hl-34-45>45</a>
</span><span class=lnt id=hl-34-46><a class=lnlinks href=#hl-34-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 다양한 폴백 전략 구현 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ProductCatalogService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Cache</span><span class=o>&lt;</span><span class=n>Long</span><span class=p>,</span><span class=w> </span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=n>productCache</span><span class=p>;</span><span class=w>  </span><span class=c1>// 로컬 캐시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ProductCatalogService</span><span class=p>(</span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>Cache</span><span class=o>&lt;</span><span class=n>Long</span><span class=p>,</span><span class=w> </span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=n>productCache</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>restTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;productService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>productCache</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>productCache</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=nf>getProductDetails</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>productId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 폴백 체인 구현</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Try</span><span class=p>.</span><span class=na>ofSupplier</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 1. 기본 경로: 서킷 브레이커를 통한 서비스 호출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>executeSupplier</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForObject</span><span class=p>(</span><span class=s>&#34;/products/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Product</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>productId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>).</span><span class=na>recover</span><span class=p>(</span><span class=n>CallNotPermittedException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 2. 서킷이 열렸을 때: 캐시에서 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;서킷 열림, 캐시에서 상품 정보 조회: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>productId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Product</span><span class=w> </span><span class=n>cachedProduct</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>productCache</span><span class=p>.</span><span class=na>getIfPresent</span><span class=p>(</span><span class=n>productId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cachedProduct</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 캐시 데이터가 있으면 반환하되 캐시 데이터임을 표시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>cachedProduct</span><span class=p>.</span><span class=na>setSource</span><span class=p>(</span><span class=s>&#34;cache&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>cachedProduct</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 캐시에도 없으면 다음 폴백으로</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=s>&#34;캐시에서 상품을 찾을 수 없음&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}).</span><span class=na>recover</span><span class=p>(</span><span class=n>Exception</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 3. 최종 폴백: 기본 상품 정보 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;상품 정보 조회 실패, 기본 정보 반환: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>productId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Product</span><span class=w> </span><span class=n>defaultProduct</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Product</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>defaultProduct</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>productId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>defaultProduct</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;상품 정보 일시적으로 이용 불가&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>defaultProduct</span><span class=p>.</span><span class=na>setPrice</span><span class=p>(</span><span class=n>BigDecimal</span><span class=p>.</span><span class=na>ZERO</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>defaultProduct</span><span class=p>.</span><span class=na>setSource</span><span class=p>(</span><span class=s>&#34;fallback&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>defaultProduct</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=캐시cache-패턴>캐시(Cache) 패턴<a hidden class=anchor aria-hidden=true href=#캐시cache-패턴>#</a></h4><p>자주 사용되는 데이터를 캐싱하여 서비스 호출을 줄이는 패턴이다. 서킷 브레이커와 함께 사용하면 서킷이 열렸을 때 캐시된 데이터를 폴백으로 사용할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span><span class=lnt id=hl-35-26><a class=lnlinks href=#hl-35-26>26</a>
</span><span class=lnt id=hl-35-27><a class=lnlinks href=#hl-35-27>27</a>
</span><span class=lnt id=hl-35-28><a class=lnlinks href=#hl-35-28>28</a>
</span><span class=lnt id=hl-35-29><a class=lnlinks href=#hl-35-29>29</a>
</span><span class=lnt id=hl-35-30><a class=lnlinks href=#hl-35-30>30</a>
</span><span class=lnt id=hl-35-31><a class=lnlinks href=#hl-35-31>31</a>
</span><span class=lnt id=hl-35-32><a class=lnlinks href=#hl-35-32>32</a>
</span><span class=lnt id=hl-35-33><a class=lnlinks href=#hl-35-33>33</a>
</span><span class=lnt id=hl-35-34><a class=lnlinks href=#hl-35-34>34</a>
</span><span class=lnt id=hl-35-35><a class=lnlinks href=#hl-35-35>35</a>
</span><span class=lnt id=hl-35-36><a class=lnlinks href=#hl-35-36>36</a>
</span><span class=lnt id=hl-35-37><a class=lnlinks href=#hl-35-37>37</a>
</span><span class=lnt id=hl-35-38><a class=lnlinks href=#hl-35-38>38</a>
</span><span class=lnt id=hl-35-39><a class=lnlinks href=#hl-35-39>39</a>
</span><span class=lnt id=hl-35-40><a class=lnlinks href=#hl-35-40>40</a>
</span><span class=lnt id=hl-35-41><a class=lnlinks href=#hl-35-41>41</a>
</span><span class=lnt id=hl-35-42><a class=lnlinks href=#hl-35-42>42</a>
</span><span class=lnt id=hl-35-43><a class=lnlinks href=#hl-35-43>43</a>
</span><span class=lnt id=hl-35-44><a class=lnlinks href=#hl-35-44>44</a>
</span><span class=lnt id=hl-35-45><a class=lnlinks href=#hl-35-45>45</a>
</span><span class=lnt id=hl-35-46><a class=lnlinks href=#hl-35-46>46</a>
</span><span class=lnt id=hl-35-47><a class=lnlinks href=#hl-35-47>47</a>
</span><span class=lnt id=hl-35-48><a class=lnlinks href=#hl-35-48>48</a>
</span><span class=lnt id=hl-35-49><a class=lnlinks href=#hl-35-49>49</a>
</span><span class=lnt id=hl-35-50><a class=lnlinks href=#hl-35-50>50</a>
</span><span class=lnt id=hl-35-51><a class=lnlinks href=#hl-35-51>51</a>
</span><span class=lnt id=hl-35-52><a class=lnlinks href=#hl-35-52>52</a>
</span><span class=lnt id=hl-35-53><a class=lnlinks href=#hl-35-53>53</a>
</span><span class=lnt id=hl-35-54><a class=lnlinks href=#hl-35-54>54</a>
</span><span class=lnt id=hl-35-55><a class=lnlinks href=#hl-35-55>55</a>
</span><span class=lnt id=hl-35-56><a class=lnlinks href=#hl-35-56>56</a>
</span><span class=lnt id=hl-35-57><a class=lnlinks href=#hl-35-57>57</a>
</span><span class=lnt id=hl-35-58><a class=lnlinks href=#hl-35-58>58</a>
</span><span class=lnt id=hl-35-59><a class=lnlinks href=#hl-35-59>59</a>
</span><span class=lnt id=hl-35-60><a class=lnlinks href=#hl-35-60>60</a>
</span><span class=lnt id=hl-35-61><a class=lnlinks href=#hl-35-61>61</a>
</span><span class=lnt id=hl-35-62><a class=lnlinks href=#hl-35-62>62</a>
</span><span class=lnt id=hl-35-63><a class=lnlinks href=#hl-35-63>63</a>
</span><span class=lnt id=hl-35-64><a class=lnlinks href=#hl-35-64>64</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 캐시와 서킷 브레이커 통합 예시 (Caffeine 캐시 사용)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CacheConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Cache</span><span class=o>&lt;</span><span class=n>Long</span><span class=p>,</span><span class=w> </span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>productCache</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Caffeine</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>maximumSize</span><span class=p>(</span><span class=n>10000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>expireAfterWrite</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>HOURS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CachingProductService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Cache</span><span class=o>&lt;</span><span class=n>Long</span><span class=p>,</span><span class=w> </span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=n>productCache</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>CachingProductService</span><span class=p>(</span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                               </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                               </span><span class=n>Cache</span><span class=o>&lt;</span><span class=n>Long</span><span class=p>,</span><span class=w> </span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=n>productCache</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>restTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;productService&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>productCache</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>productCache</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=nf>getProduct</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 1. 먼저 캐시에서 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Product</span><span class=w> </span><span class=n>cachedProduct</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>productCache</span><span class=p>.</span><span class=na>getIfPresent</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cachedProduct</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>debug</span><span class=p>(</span><span class=s>&#34;캐시에서 상품 정보 조회: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>cachedProduct</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 2. 캐시에 없으면 서킷 브레이커를 통해 서비스 호출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>executeSupplier</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>debug</span><span class=p>(</span><span class=s>&#34;상품 서비스에서 상품 정보 조회: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForObject</span><span class=p>(</span><span class=s>&#34;/products/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Product</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 3. 성공적으로 조회했으면 캐시에 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>product</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>productCache</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>product</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>product</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 캐시 사용 폴백 전략</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Function</span><span class=o>&lt;</span><span class=n>Throwable</span><span class=p>,</span><span class=w> </span><span class=n>Product</span><span class=o>&gt;</span><span class=w> </span><span class=nf>createCacheFallback</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>throwable</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Product</span><span class=w> </span><span class=n>cachedProduct</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>productCache</span><span class=p>.</span><span class=na>getIfPresent</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cachedProduct</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>log</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;서비스 호출 실패, 캐시에서 상품 정보 반환: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>cachedProduct</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;서비스 호출 실패, 캐시에도 없음: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=s>&#34;상품 정보를 가져올 수 없습니다.&#34;</span><span class=p>,</span><span class=w> </span><span class=n>throwable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=마이그레이션-관점에서의-서킷-브레이커-도입-전략>마이그레이션 관점에서의 서킷 브레이커 도입 전략<a hidden class=anchor aria-hidden=true href=#마이그레이션-관점에서의-서킷-브레이커-도입-전략>#</a></h3><p>기존 시스템에 서킷 브레이커 패턴을 도입하는 것은 중요한 마이그레이션 작업이다.</p><h4 id=단계적-도입-프로세스>단계적 도입 프로세스<a hidden class=anchor aria-hidden=true href=#단계적-도입-프로세스>#</a></h4><p>서킷 브레이커를 도입할 때는 다음과 같은 단계적 접근이 효과적:</p><ol><li><strong>현황 분석</strong>: 장애 발생 빈도가 높은 서비스와 의존성을 파악한다.</li><li><strong>우선순위 설정</strong>: 중요도가 낮지만 장애 가능성이 높은 서비스부터 적용한다.</li><li><strong>테스트 환경 구현</strong>: 프로덕션 환경과 유사한 테스트 환경에서 먼저 검증한다.</li><li><strong>모니터링 체계 구축</strong>: 서킷 브레이커 동작을 모니터링할 수 있는 체계를 구축한다.</li><li><strong>점진적 롤아웃</strong>: 한 번에 모든 서비스에 적용하지 않고 점진적으로 확대한다.</li><li><strong>피드백 및 최적화</strong>: 실제 운영 데이터를 기반으로 설정을 지속적으로 최적화한다.</li></ol><h4 id=기존-코드에-서킷-브레이커-추가-전략>기존 코드에 서킷 브레이커 추가 전략<a hidden class=anchor aria-hidden=true href=#기존-코드에-서킷-브레이커-추가-전략>#</a></h4><p>기존 코드에 서킷 브레이커를 추가하는 방법은 여러 가지가 있다:</p><h5 id=데코레이터-패턴-사용>데코레이터 패턴 사용<a hidden class=anchor aria-hidden=true href=#데코레이터-패턴-사용>#</a></h5><p>기존 코드를 수정하지 않고 서킷 브레이커를 적용할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13>13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14>14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15>15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16>16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17>17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18>18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19>19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20>20</a>
</span><span class=lnt id=hl-36-21><a class=lnlinks href=#hl-36-21>21</a>
</span><span class=lnt id=hl-36-22><a class=lnlinks href=#hl-36-22>22</a>
</span><span class=lnt id=hl-36-23><a class=lnlinks href=#hl-36-23>23</a>
</span><span class=lnt id=hl-36-24><a class=lnlinks href=#hl-36-24>24</a>
</span><span class=lnt id=hl-36-25><a class=lnlinks href=#hl-36-25>25</a>
</span><span class=lnt id=hl-36-26><a class=lnlinks href=#hl-36-26>26</a>
</span><span class=lnt id=hl-36-27><a class=lnlinks href=#hl-36-27>27</a>
</span><span class=lnt id=hl-36-28><a class=lnlinks href=#hl-36-28>28</a>
</span><span class=lnt id=hl-36-29><a class=lnlinks href=#hl-36-29>29</a>
</span><span class=lnt id=hl-36-30><a class=lnlinks href=#hl-36-30>30</a>
</span><span class=lnt id=hl-36-31><a class=lnlinks href=#hl-36-31>31</a>
</span><span class=lnt id=hl-36-32><a class=lnlinks href=#hl-36-32>32</a>
</span><span class=lnt id=hl-36-33><a class=lnlinks href=#hl-36-33>33</a>
</span><span class=lnt id=hl-36-34><a class=lnlinks href=#hl-36-34>34</a>
</span><span class=lnt id=hl-36-35><a class=lnlinks href=#hl-36-35>35</a>
</span><span class=lnt id=hl-36-36><a class=lnlinks href=#hl-36-36>36</a>
</span><span class=lnt id=hl-36-37><a class=lnlinks href=#hl-36-37>37</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 데코레이터 패턴을 사용한 서킷 브레이커 적용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CircuitBreakerDecorator</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>PaymentGateway</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PaymentGateway</span><span class=w> </span><span class=n>originalGateway</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>CircuitBreakerDecorator</span><span class=p>(</span><span class=n>PaymentGateway</span><span class=w> </span><span class=n>originalGateway</span><span class=p>,</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>originalGateway</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>originalGateway</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PaymentResult</span><span class=w> </span><span class=nf>processPayment</span><span class=p>(</span><span class=n>PaymentRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>executeSupplier</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>originalGateway</span><span class=p>.</span><span class=na>processPayment</span><span class=p>(</span><span class=n>request</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PaymentStatus</span><span class=w> </span><span class=nf>checkStatus</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>paymentId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>executeSupplier</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>originalGateway</span><span class=p>.</span><span class=na>checkStatus</span><span class=p>(</span><span class=n>paymentId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>RefundResult</span><span class=w> </span><span class=nf>refund</span><span class=p>(</span><span class=n>RefundRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>executeSupplier</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>originalGateway</span><span class=p>.</span><span class=na>refund</span><span class=p>(</span><span class=n>request</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 사용 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PaymentConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PaymentGateway</span><span class=w> </span><span class=nf>paymentGateway</span><span class=p>(</span><span class=n>PaymentGateway</span><span class=w> </span><span class=n>originalGateway</span><span class=p>,</span><span class=w> </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>circuitBreaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=s>&#34;paymentGateway&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CircuitBreakerDecorator</span><span class=p>(</span><span class=n>originalGateway</span><span class=p>,</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=aopaspect-oriented-programming-활용>AOP(Aspect-Oriented Programming) 활용<a hidden class=anchor aria-hidden=true href=#aopaspect-oriented-programming-활용>#</a></h5><p>공통 관심사로 서킷 브레이커를 적용하여 코드 중복을 줄일 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a>
</span><span class=lnt id=hl-37-12><a class=lnlinks href=#hl-37-12>12</a>
</span><span class=lnt id=hl-37-13><a class=lnlinks href=#hl-37-13>13</a>
</span><span class=lnt id=hl-37-14><a class=lnlinks href=#hl-37-14>14</a>
</span><span class=lnt id=hl-37-15><a class=lnlinks href=#hl-37-15>15</a>
</span><span class=lnt id=hl-37-16><a class=lnlinks href=#hl-37-16>16</a>
</span><span class=lnt id=hl-37-17><a class=lnlinks href=#hl-37-17>17</a>
</span><span class=lnt id=hl-37-18><a class=lnlinks href=#hl-37-18>18</a>
</span><span class=lnt id=hl-37-19><a class=lnlinks href=#hl-37-19>19</a>
</span><span class=lnt id=hl-37-20><a class=lnlinks href=#hl-37-20>20</a>
</span><span class=lnt id=hl-37-21><a class=lnlinks href=#hl-37-21>21</a>
</span><span class=lnt id=hl-37-22><a class=lnlinks href=#hl-37-22>22</a>
</span><span class=lnt id=hl-37-23><a class=lnlinks href=#hl-37-23>23</a>
</span><span class=lnt id=hl-37-24><a class=lnlinks href=#hl-37-24>24</a>
</span><span class=lnt id=hl-37-25><a class=lnlinks href=#hl-37-25>25</a>
</span><span class=lnt id=hl-37-26><a class=lnlinks href=#hl-37-26>26</a>
</span><span class=lnt id=hl-37-27><a class=lnlinks href=#hl-37-27>27</a>
</span><span class=lnt id=hl-37-28><a class=lnlinks href=#hl-37-28>28</a>
</span><span class=lnt id=hl-37-29><a class=lnlinks href=#hl-37-29>29</a>
</span><span class=lnt id=hl-37-30><a class=lnlinks href=#hl-37-30>30</a>
</span><span class=lnt id=hl-37-31><a class=lnlinks href=#hl-37-31>31</a>
</span><span class=lnt id=hl-37-32><a class=lnlinks href=#hl-37-32>32</a>
</span><span class=lnt id=hl-37-33><a class=lnlinks href=#hl-37-33>33</a>
</span><span class=lnt id=hl-37-34><a class=lnlinks href=#hl-37-34>34</a>
</span><span class=lnt id=hl-37-35><a class=lnlinks href=#hl-37-35>35</a>
</span><span class=lnt id=hl-37-36><a class=lnlinks href=#hl-37-36>36</a>
</span><span class=lnt id=hl-37-37><a class=lnlinks href=#hl-37-37>37</a>
</span><span class=lnt id=hl-37-38><a class=lnlinks href=#hl-37-38>38</a>
</span><span class=lnt id=hl-37-39><a class=lnlinks href=#hl-37-39>39</a>
</span><span class=lnt id=hl-37-40><a class=lnlinks href=#hl-37-40>40</a>
</span><span class=lnt id=hl-37-41><a class=lnlinks href=#hl-37-41>41</a>
</span><span class=lnt id=hl-37-42><a class=lnlinks href=#hl-37-42>42</a>
</span><span class=lnt id=hl-37-43><a class=lnlinks href=#hl-37-43>43</a>
</span><span class=lnt id=hl-37-44><a class=lnlinks href=#hl-37-44>44</a>
</span><span class=lnt id=hl-37-45><a class=lnlinks href=#hl-37-45>45</a>
</span><span class=lnt id=hl-37-46><a class=lnlinks href=#hl-37-46>46</a>
</span><span class=lnt id=hl-37-47><a class=lnlinks href=#hl-37-47>47</a>
</span><span class=lnt id=hl-37-48><a class=lnlinks href=#hl-37-48>48</a>
</span><span class=lnt id=hl-37-49><a class=lnlinks href=#hl-37-49>49</a>
</span><span class=lnt id=hl-37-50><a class=lnlinks href=#hl-37-50>50</a>
</span><span class=lnt id=hl-37-51><a class=lnlinks href=#hl-37-51>51</a>
</span><span class=lnt id=hl-37-52><a class=lnlinks href=#hl-37-52>52</a>
</span><span class=lnt id=hl-37-53><a class=lnlinks href=#hl-37-53>53</a>
</span><span class=lnt id=hl-37-54><a class=lnlinks href=#hl-37-54>54</a>
</span><span class=lnt id=hl-37-55><a class=lnlinks href=#hl-37-55>55</a>
</span><span class=lnt id=hl-37-56><a class=lnlinks href=#hl-37-56>56</a>
</span><span class=lnt id=hl-37-57><a class=lnlinks href=#hl-37-57>57</a>
</span><span class=lnt id=hl-37-58><a class=lnlinks href=#hl-37-58>58</a>
</span><span class=lnt id=hl-37-59><a class=lnlinks href=#hl-37-59>59</a>
</span><span class=lnt id=hl-37-60><a class=lnlinks href=#hl-37-60>60</a>
</span><span class=lnt id=hl-37-61><a class=lnlinks href=#hl-37-61>61</a>
</span><span class=lnt id=hl-37-62><a class=lnlinks href=#hl-37-62>62</a>
</span><span class=lnt id=hl-37-63><a class=lnlinks href=#hl-37-63>63</a>
</span><span class=lnt id=hl-37-64><a class=lnlinks href=#hl-37-64>64</a>
</span><span class=lnt id=hl-37-65><a class=lnlinks href=#hl-37-65>65</a>
</span><span class=lnt id=hl-37-66><a class=lnlinks href=#hl-37-66>66</a>
</span><span class=lnt id=hl-37-67><a class=lnlinks href=#hl-37-67>67</a>
</span><span class=lnt id=hl-37-68><a class=lnlinks href=#hl-37-68>68</a>
</span><span class=lnt id=hl-37-69><a class=lnlinks href=#hl-37-69>69</a>
</span><span class=lnt id=hl-37-70><a class=lnlinks href=#hl-37-70>70</a>
</span><span class=lnt id=hl-37-71><a class=lnlinks href=#hl-37-71>71</a>
</span><span class=lnt id=hl-37-72><a class=lnlinks href=#hl-37-72>72</a>
</span><span class=lnt id=hl-37-73><a class=lnlinks href=#hl-37-73>73</a>
</span><span class=lnt id=hl-37-74><a class=lnlinks href=#hl-37-74>74</a>
</span><span class=lnt id=hl-37-75><a class=lnlinks href=#hl-37-75>75</a>
</span><span class=lnt id=hl-37-76><a class=lnlinks href=#hl-37-76>76</a>
</span><span class=lnt id=hl-37-77><a class=lnlinks href=#hl-37-77>77</a>
</span><span class=lnt id=hl-37-78><a class=lnlinks href=#hl-37-78>78</a>
</span><span class=lnt id=hl-37-79><a class=lnlinks href=#hl-37-79>79</a>
</span><span class=lnt id=hl-37-80><a class=lnlinks href=#hl-37-80>80</a>
</span><span class=lnt id=hl-37-81><a class=lnlinks href=#hl-37-81>81</a>
</span><span class=lnt id=hl-37-82><a class=lnlinks href=#hl-37-82>82</a>
</span><span class=lnt id=hl-37-83><a class=lnlinks href=#hl-37-83>83</a>
</span><span class=lnt id=hl-37-84><a class=lnlinks href=#hl-37-84>84</a>
</span><span class=lnt id=hl-37-85><a class=lnlinks href=#hl-37-85>85</a>
</span><span class=lnt id=hl-37-86><a class=lnlinks href=#hl-37-86>86</a>
</span><span class=lnt id=hl-37-87><a class=lnlinks href=#hl-37-87>87</a>
</span><span class=lnt id=hl-37-88><a class=lnlinks href=#hl-37-88>88</a>
</span><span class=lnt id=hl-37-89><a class=lnlinks href=#hl-37-89>89</a>
</span><span class=lnt id=hl-37-90><a class=lnlinks href=#hl-37-90>90</a>
</span><span class=lnt id=hl-37-91><a class=lnlinks href=#hl-37-91>91</a>
</span><span class=lnt id=hl-37-92><a class=lnlinks href=#hl-37-92>92</a>
</span><span class=lnt id=hl-37-93><a class=lnlinks href=#hl-37-93>93</a>
</span><span class=lnt id=hl-37-94><a class=lnlinks href=#hl-37-94>94</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// AOP를 사용한 서킷 브레이커 적용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Aspect</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CircuitBreakerAspect</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>CircuitBreaker</span><span class=o>&gt;</span><span class=w> </span><span class=n>circuitBreakers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ConcurrentHashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>CircuitBreakerAspect</span><span class=p>(</span><span class=n>CircuitBreakerRegistry</span><span class=w> </span><span class=n>registry</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>registry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>registry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Around</span><span class=p>(</span><span class=s>&#34;@annotation(circuitBreaker)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>applyCircuitBreaker</span><span class=p>(</span><span class=n>ProceedingJoinPoint</span><span class=w> </span><span class=n>joinPoint</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                     </span><span class=n>CircuitBreakerAnnotation</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>name</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CircuitBreaker</span><span class=w> </span><span class=n>breaker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreakers</span><span class=p>.</span><span class=na>computeIfAbsent</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>k</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>registry</span><span class=p>.</span><span class=na>circuitBreaker</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>breaker</span><span class=p>.</span><span class=na>executeSupplier</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>proceed</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>t</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>throw</span><span class=w> </span><span class=p>(</span><span class=n>RuntimeException</span><span class=p>)</span><span class=w> </span><span class=n>t</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>CallNotPermittedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 서킷 브레이커가 열린 상태</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>handleFallback</span><span class=p>(</span><span class=n>joinPoint</span><span class=p>,</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>handleFallback</span><span class=p>(</span><span class=n>ProceedingJoinPoint</span><span class=w> </span><span class=n>joinPoint</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>CircuitBreakerAnnotation</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>fallbackMethod</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>circuitBreaker</span><span class=p>.</span><span class=na>fallbackMethod</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>fallbackMethod</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 폴백 메서드 호출</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Method</span><span class=w> </span><span class=n>method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>findFallbackMethod</span><span class=p>(</span><span class=n>joinPoint</span><span class=p>,</span><span class=w> </span><span class=n>fallbackMethod</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>method</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getTarget</span><span class=p>(),</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getArgs</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Method</span><span class=w> </span><span class=nf>findFallbackMethod</span><span class=p>(</span><span class=n>ProceedingJoinPoint</span><span class=w> </span><span class=n>joinPoint</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>fallbackMethod</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>throws</span><span class=w> </span><span class=n>NoSuchMethodException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 폴백 메서드 찾기 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>targetClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getTarget</span><span class=p>().</span><span class=na>getClass</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Method</span><span class=w> </span><span class=n>method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getSignature</span><span class=p>()</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>MethodSignature</span><span class=w> </span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>((</span><span class=n>MethodSignature</span><span class=p>)</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getSignature</span><span class=p>()).</span><span class=na>getMethod</span><span class=p>()</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>method</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&#34;메서드 시그니처를 가져올 수 없습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>targetClass</span><span class=p>.</span><span class=na>getMethod</span><span class=p>(</span><span class=n>fallbackMethod</span><span class=p>,</span><span class=w> </span><span class=n>method</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 애노테이션 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=nd>@interface</span><span class=w> </span><span class=n>CircuitBreakerAnnotation</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=nf>name</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=nf>fallbackMethod</span><span class=p>()</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 사용 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ExternalServiceClient</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ExternalServiceClient</span><span class=p>(</span><span class=n>RestTemplate</span><span class=w> </span><span class=n>restTemplate</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>restTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@CircuitBreakerAnnotation</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;externalService&#34;</span><span class=p>,</span><span class=w> </span><span class=n>fallbackMethod</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;getDataFallback&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ExternalData</span><span class=w> </span><span class=nf>getData</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForObject</span><span class=p>(</span><span class=s>&#34;/api/data/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ExternalData</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ExternalData</span><span class=w> </span><span class=nf>getDataFallback</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 폴백 로직</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ExternalData</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=s>&#34;일시적으로 이용 불가&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Collections</span><span class=p>.</span><span class=na>emptyList</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=레거시-시스템-마이그레이션-전략>레거시 시스템 마이그레이션 전략<a hidden class=anchor aria-hidden=true href=#레거시-시스템-마이그레이션-전략>#</a></h4><p>레거시 시스템에 서킷 브레이커를 도입할 때는 추가적인 고려사항이 있다:</p><ol><li><strong>프록시 계층 추가</strong>: 레거시 코드를 수정하지 않고 프록시 계층을 추가하여 서킷 브레이커 적용</li><li><strong>API 게이트웨이 활용</strong>: 레거시 시스템 앞에 API 게이트웨이를 배치하여 게이트웨이 수준에서 서킷 브레이커 구현</li><li><strong>사이드카 패턴</strong>: 서비스 메시 아키텍처를 활용하여 사이드카 컨테이너로 서킷 브레이커 기능 제공</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1> 1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2> 2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3> 3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4> 4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5> 5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6> 6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7> 7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8> 8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9> 9</a>
</span><span class=lnt id=hl-38-10><a class=lnlinks href=#hl-38-10>10</a>
</span><span class=lnt id=hl-38-11><a class=lnlinks href=#hl-38-11>11</a>
</span><span class=lnt id=hl-38-12><a class=lnlinks href=#hl-38-12>12</a>
</span><span class=lnt id=hl-38-13><a class=lnlinks href=#hl-38-13>13</a>
</span><span class=lnt id=hl-38-14><a class=lnlinks href=#hl-38-14>14</a>
</span><span class=lnt id=hl-38-15><a class=lnlinks href=#hl-38-15>15</a>
</span><span class=lnt id=hl-38-16><a class=lnlinks href=#hl-38-16>16</a>
</span><span class=lnt id=hl-38-17><a class=lnlinks href=#hl-38-17>17</a>
</span><span class=lnt id=hl-38-18><a class=lnlinks href=#hl-38-18>18</a>
</span><span class=lnt id=hl-38-19><a class=lnlinks href=#hl-38-19>19</a>
</span><span class=lnt id=hl-38-20><a class=lnlinks href=#hl-38-20>20</a>
</span><span class=lnt id=hl-38-21><a class=lnlinks href=#hl-38-21>21</a>
</span><span class=lnt id=hl-38-22><a class=lnlinks href=#hl-38-22>22</a>
</span><span class=lnt id=hl-38-23><a class=lnlinks href=#hl-38-23>23</a>
</span><span class=lnt id=hl-38-24><a class=lnlinks href=#hl-38-24>24</a>
</span><span class=lnt id=hl-38-25><a class=lnlinks href=#hl-38-25>25</a>
</span><span class=lnt id=hl-38-26><a class=lnlinks href=#hl-38-26>26</a>
</span><span class=lnt id=hl-38-27><a class=lnlinks href=#hl-38-27>27</a>
</span><span class=lnt id=hl-38-28><a class=lnlinks href=#hl-38-28>28</a>
</span><span class=lnt id=hl-38-29><a class=lnlinks href=#hl-38-29>29</a>
</span><span class=lnt id=hl-38-30><a class=lnlinks href=#hl-38-30>30</a>
</span><span class=lnt id=hl-38-31><a class=lnlinks href=#hl-38-31>31</a>
</span><span class=lnt id=hl-38-32><a class=lnlinks href=#hl-38-32>32</a>
</span><span class=lnt id=hl-38-33><a class=lnlinks href=#hl-38-33>33</a>
</span><span class=lnt id=hl-38-34><a class=lnlinks href=#hl-38-34>34</a>
</span><span class=lnt id=hl-38-35><a class=lnlinks href=#hl-38-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Istio 서비스 메시를 사용한 레거시 시스템 보호 예시</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.istio.io/v1alpha3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>VirtualService</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>legacy-service-route</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>legacy-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>destination</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>legacy-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>5s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>attempts</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>perTryTimeout</span><span class=p>:</span><span class=w> </span><span class=l>2s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.istio.io/v1alpha3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>DestinationRule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>legacy-service-circuit-breaker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>legacy-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trafficPolicy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>connectionPool</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tcp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>maxConnections</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>http1MaxPendingRequests</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>maxRequestsPerConnection</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>outlierDetection</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>consecutiveErrors</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>baseEjectionTime</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=용어-정리-2>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-2>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h2></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2026 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>