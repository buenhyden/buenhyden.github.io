<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Synchronous Execution | hyunyoun's Blog</title><meta name=keywords content="System-Design,System-Design-Fundamentals,Execution-Models,Timing-Models,Synchronous-Execution,Blocking-Operation,Sequential-Processing"><meta name=description content="동기 실행(Synchronous Execution)은 작업이 순차적으로 진행되어 이전 작업이 완료된 후에야 다음 작업이 시작되는 차단형 모델입니다. 구조가 단순하고 흐름 예측이 쉬우며 디버깅이 용이하지만, I/O·네트워크 지연 시 전체 처리 속도가 저하되고 리소스 활용성이 떨어질 수 있습니다. 주로 일관성과 순차성이 중요한 트랜잭션, 배치 처리, 상태 의존 로직에 사용됩니다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/system-architecture--design/performance--scalability/performance-design/execution-strategies/synchronous-execution/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.d522c866f0cc9c20ae4fa73a0a8c07f0af4c36af75bcbcd3e90558446f681077.css integrity="sha256-1SLIZvDMnCCuT6c6CowH8K9MNq91vLzT6QVYRG9oEHc=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/system-architecture--design/performance--scalability/performance-design/execution-strategies/synchronous-execution/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/system-architecture--design/performance--scalability/performance-design/execution-strategies/synchronous-execution/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/system-architecture--design/performance--scalability/performance-design/execution-strategies/synchronous-execution/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Synchronous Execution"><meta property="og:description" content="동기 실행(Synchronous Execution)은 작업이 순차적으로 진행되어 이전 작업이 완료된 후에야 다음 작업이 시작되는 차단형 모델입니다. 구조가 단순하고 흐름 예측이 쉬우며 디버깅이 용이하지만, I/O·네트워크 지연 시 전체 처리 속도가 저하되고 리소스 활용성이 떨어질 수 있습니다. 주로 일관성과 순차성이 중요한 트랜잭션, 배치 처리, 상태 의존 로직에 사용됩니다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Synchronous Execution"><meta name=twitter:description content="동기 실행(Synchronous Execution)은 작업이 순차적으로 진행되어 이전 작업이 완료된 후에야 다음 작업이 시작되는 차단형 모델입니다. 구조가 단순하고 흐름 예측이 쉬우며 디버깅이 용이하지만, I/O·네트워크 지연 시 전체 처리 속도가 저하되고 리소스 활용성이 떨어질 수 있습니다. 주로 일관성과 순차성이 중요한 트랜잭션, 배치 처리, 상태 의존 로직에 사용됩니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HY's Blog","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Synchronous Execution","item":"https://buenhyden.github.io/posts/system-architecture--design/performance--scalability/performance-design/execution-strategies/synchronous-execution/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>HY's Blog</a></div><h1>Synchronous Execution</h1><div class=post-description>동기 실행(Synchronous Execution)은 작업이 순차적으로 진행되어 이전 작업이 완료된 후에야 다음 작업이 시작되는 차단형 모델입니다. 구조가 단순하고 흐름 예측이 쉬우며 디버깅이 용이하지만, I/O·네트워크 지연 시 전체 처리 속도가 저하되고 리소스 활용성이 떨어질 수 있습니다. 주로 일관성과 순차성이 중요한 트랜잭션, 배치 처리, 상태 의존 로직에 사용됩니다.</div></header><div class=post-content><h2 id=synchronous-execution>Synchronous Execution<a hidden class=anchor aria-hidden=true href=#synchronous-execution>#</a></h2><p>동기 실행은 각 작업이 <strong>완료된 뒤</strong> 다음 작업이 시작되는 순차적 모델로, 흐름이 단순하고 예측 가능해 <strong>디버깅·검증·일관성</strong>에 유리하다.<br>트랜잭션 처리, 배치/이관, 초기화·종료 루틴처럼 <strong>정확한 순서와 원자성</strong>이 중요한 영역에 적합하다.<br>다만 장시간 I/O 나 외부 호출이 포함되면 <strong>전체 경로가 대기</strong>하며 자원 활용과 확장성이 떨어질 수 있다.<br>실무에서는 <strong>핵심 경계는 동기</strong>로 단순화하고, 지연이 큰 단계는 <strong>비동기 위임</strong>(큐·워커) 으로 분리하며, <strong>타임아웃·재시도·멱등성</strong>을 더해 신뢰성과 성능을 함께 달성하는 <strong>혼합 설계</strong>가 권장된다.</p><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><ul><li>동기는 <strong>예측·검증·정합성</strong>을 극대화하는 대신, <strong>대기 시간 누수</strong>와 <strong>자원 낭비</strong> 위험이 있으므로, <strong>경계 분리</strong>와 <strong>풀/타임아웃 관리</strong>가 필수</li></ul><table><thead><tr><th>관점</th><th>필수 개념</th><th>설명</th><th>실무 포인트</th></tr></thead><tbody><tr><td>이론</td><td>순차성/차단</td><td>선형 실행·앞 작업 완료 대기</td><td>테스트·검증 용이, 처리량 한계 존재</td></tr><tr><td>이론</td><td>결정성</td><td>동일 입력→동일 결과·경로</td><td>재현성·회귀 테스트 강점</td></tr><tr><td>이론</td><td>HoL Blocking</td><td>선두 지연 전파</td><td>큐/배치 설계 시 주의</td></tr><tr><td>실무</td><td>트랜잭션/롤백</td><td>ACID 흐름에 적합</td><td>DB 트랜잭션 경계 최소화</td></tr><tr><td>실무</td><td>스레드/커넥션 풀</td><td>Thread-per-Request</td><td>최대 동시성=풀 크기 한계</td></tr><tr><td>실무</td><td>타임아웃/재시도</td><td>느린 리소스 보호</td><td>지수 백오프·재시도 예산</td></tr><tr><td>기본</td><td>동기 호출 패턴</td><td>파일/DB/HTTP 요청 동기 처리</td><td>명확한 오류 전파/로그</td></tr><tr><td>심화</td><td>동기↔비동기 경계</td><td>병목 국지화</td><td>외연 I/O 는 비동기·큐로 분리</td></tr><tr><td>심화</td><td>관측성/배압</td><td>큐 지연·p95·에러율</td><td>스로틀/Admission Control</td></tr></tbody></table><h4 id=실무-구현-연관성-및-적용-방식>실무 구현 연관성 및 적용 방식<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성-및-적용-방식>#</a></h4><ul><li><strong>언제 동기로?</strong> 순서/정합성·예측가능성이 최우선 (결제, 정산, 재무 배치).</li><li><strong>어떻게 병목을 피하나?</strong> <strong>풀 사이징 + 타임아웃 + 경계 분리 + 큐 완충</strong>.</li><li><strong>혼합 패턴</strong>: 핵심 크리티컬 섹션은 동기 트랜잭션, 외부 호출/느린 I/O 는 비동기 큐로 오프로딩.</li></ul><table><thead><tr><th>상황</th><th>권장 접근</th><th>구현 포인트</th><th>체크 지표</th></tr></thead><tbody><tr><td>DB 트랜잭션 처리</td><td><strong>동기</strong></td><td>짧은 트랜잭션, 커넥션 풀 상한</td><td>트랜잭션 시간, 풀 점유율</td></tr><tr><td>초기화/부트스트랩</td><td><strong>동기</strong></td><td>의존 순서 명시, 실패시 페일패스트</td><td>부트 시간, 실패 로그</td></tr><tr><td>순차 검증 파이프라인</td><td><strong>동기</strong></td><td>단계 실패 시 즉시 중단/롤백</td><td>단계별 실패율</td></tr><tr><td>외부 API 연계 (지연 큼)</td><td><strong>비동기 경계로 분리</strong></td><td>큐·워크플로, 타임아웃/재시도</td><td>큐 체류시간, 재시도율</td></tr><tr><td>고동시성 읽기 (Report)</td><td><strong>비동기/캐시</strong></td><td>Read-through 캐시, 배압</td><td>히트율, p95 지연</td></tr><tr><td>CLI/배치 작업</td><td><strong>동기</strong></td><td>일괄 처리 + 장애 시 롤백</td><td>처리량, 실패시 재처리</td></tr></tbody></table><h5 id=동기-실행이-중요한-대표-사례>동기 실행이 중요한 대표 사례<a hidden class=anchor aria-hidden=true href=#동기-실행이-중요한-대표-사례>#</a></h5><ul><li>주문/결제/재고/배송 등 중요한 상태 변화를 수반하는 트랜잭션</li><li>실행 순서가 비즈니스상 매우 중요할 때 (재고 차감 후 결제 X - 결제 성공 후 재고 차감 O)</li><li>시스템 초기화, 데이터 마이그레이션, 백업 등 일괄 처리</li></ul><h4 id=동기-실행과-비동기-실행-비교>동기 실행과 비동기 실행 비교<a hidden class=anchor aria-hidden=true href=#동기-실행과-비동기-실행-비교>#</a></h4><table><thead><tr><th>항목</th><th>동기 실행 (Synchronous)</th><th>비동기 실행 (Asynchronous)</th></tr></thead><tbody><tr><td>처리 흐름</td><td>순차적, blocking</td><td>병렬, non-blocking</td></tr><tr><td>예측 가능성</td><td>높음</td><td>낮을 수 있음</td></tr><tr><td>확장성</td><td>낮음</td><td>높음</td></tr><tr><td>복잡도</td><td>낮음</td><td>높음</td></tr><tr><td>디버깅 용이성</td><td>상대적으로 쉬움</td><td>복잡, 상태 추적 어려움</td></tr><tr><td>실무 적용 예시</td><td>트랜잭션, 준비/정리 작업, 초기화, 배치 처리 등</td><td>실시간 알림, 대용량 일괄 처리, 비동기 API 등</td></tr><tr><td>병목 발생</td><td>비교적 쉽게 발생</td><td>분담 처리로 병목 완화 가능</td></tr></tbody></table><h3 id=기초-개념-foundation-understanding>기초 개념 (Foundation Understanding)<a hidden class=anchor aria-hidden=true href=#기초-개념-foundation-understanding>#</a></h3><h4 id=개념-정의-및-본질적-이해>개념 정의 및 본질적 이해<a hidden class=anchor aria-hidden=true href=#개념-정의-및-본질적-이해>#</a></h4><p>동기 실행 (Synchronous Execution) 은 작업이 순차적으로 진행되어 이전 작업이 완료된 후에야 다음 작업이 시작되는 실행 모델이다.<br>이 과정에서 프로그램은 작성된 순서를 그대로 따라가며, 동일한 입력에 대해 항상 동일한 실행 순서와 결과를 보장한다. 본질적 특성은 차단성 (Blocking), 순차성 (Sequential), 결정론성 (Deterministic) 이며, 이러한 구조는 상태 의존성이 큰 로직에서 안정성과 예측 가능성을 제공한다. 다만 I/O·네트워크 지연 시 자원이 유휴 상태가 되어 전체 성능이 저하될 수 있다.</p><h4 id=등장-배경-및-발전-과정>등장 배경 및 발전 과정<a hidden class=anchor aria-hidden=true href=#등장-배경-및-발전-과정>#</a></h4><h5 id=등장-배경>등장 배경<a hidden class=anchor aria-hidden=true href=#등장-배경>#</a></h5><p>동기 실행은 <strong>이전 작업이 완료된 뒤</strong> 다음 작업을 수행하는 순차 모델로, 초기 하드웨어 제약과 절차적 언어의 호출 규약에 가장 잘 부합했다.<br>데이터 일관성과 원자성이 핵심인 금융·배치·설정 스크립트 등에서는 <strong>예측 가능성·검증 용이성</strong>이 큰 가치를 지녔고, 운영체제가 진화해도 프로세스 내부 제어 흐름의 표준으로 자리 잡았다. 이후 대규모 네트워크 I/O 와 멀티코어 보편화로 비동기가 부상했지만, 실무에선 <strong>핵심 비즈니스 경로의 동기성</strong>과 <strong>지연 구간의 비동기 위임</strong>을 결합하는 설계가 효과적이다.</p><h5 id=발전-과정>발전 과정<a hidden class=anchor aria-hidden=true href=#발전-과정>#</a></h5><table><thead><tr><th>시기</th><th>기술/환경</th><th>동기 실행의 역할/특징</th><th>한계·전환점</th></tr></thead><tbody><tr><td>1940–1950s</td><td>초기 컴퓨터, 폰 노이만 구조</td><td>명령의 <strong>순차 실행</strong>이 기본 모델</td><td>병렬성 미비, 자원 제약</td></tr><tr><td>1960s</td><td>배치 처리 → 시분할 OS</td><td>프로세스 내부 <strong>동기 제어</strong> 정착</td><td>동시 사용자 증가로 I/O 대기 노출</td></tr><tr><td>1970–1980s</td><td>구조적 프로그래밍, 트랜잭션</td><td><strong>순서·원자성</strong> 강조, 디버깅 용이</td><td>실시간/대화형 수요 증가</td></tr><tr><td>1990s</td><td>웹/클라이언트 - 서버, HTTP</td><td><strong>요청 - 응답 동기 패턴</strong> 확산</td><td>네트워크 지연이 병목화</td></tr><tr><td>2000s</td><td>멀티코어·대규모 I/O</td><td>동기 한계 노출 → <strong>비동기 병행</strong></td><td>스레드·이벤트 루프 도입</td></tr><tr><td>2010s~</td><td>클라우드/마이크로서비스/서버리스</td><td><strong>하이브리드 (동기 + 비동기)</strong> 정착</td><td>구조적 동시성, 취소/타임아웃 표준화</td></tr></tbody></table><pre class=mermaid>timeline
  title Synchronous Execution: 등장 배경 및 발전 과정
  1940-1950 : 순차 실행 기본 모델 확립
  1960      : 배치→시분할, 프로세스 내부 동기 제어 정착
  1970-1980 : 구조적 프로그래밍/트랜잭션으로 동기성 강화
  1990      : 웹/HTTP 요청-응답 동기 패턴 대중화
  2000      : 멀티코어·대규모 I/O로 비동기 병행 확산
  2010-현재 : 클라우드/마이크로서비스, 동기+비동기 하이브리드
</pre><h4 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h4><table><thead><tr><th>문제 영역</th><th>동기 실행의 가치 (해결 효과)</th><th>적합 시나리오</th><th>한계/주의</th><th>보완 전략</th></tr></thead><tbody><tr><td>순서·의존성 관리</td><td><strong>정확한 순서 보장</strong>, 단계적 검증 용이</td><td>결제/정산, 마이그레이션, 초기화 시퀀스</td><td>선두 차단 (HoL)</td><td>장기 I/O 는 큐로 오프로딩</td></tr><tr><td>데이터 정합성</td><td><strong>원자적 커밋/롤백</strong> 단순</td><td>DB 트랜잭션, 재고/계정 처리</td><td>트랜잭션 시간 길어지면 락 경쟁</td><td>짧은 트랜잭션·재시도 정책</td></tr><tr><td>디버깅/테스트</td><td><strong>콜스택 기반 추적</strong> 쉬움</td><td>배치·CLI, 규칙 엔진</td><td>처리량 한계</td><td>단위테스트·계약테스트 강화</td></tr><tr><td>운영·추적성</td><td><strong>감사 로그 일관성</strong></td><td>회계/감사 요구 시스템</td><td>처리 지연 누적</td><td>단계별 타임아웃·페일 - 패스트</td></tr><tr><td>자원 모델</td><td>단순한 스레드/연결 관리</td><td>저동시성 API, 내부 도구</td><td>Thread-per-Request 상한</td><td>풀 사이징·백프레셔 도입</td></tr></tbody></table><ul><li><strong>정합성/순서</strong>가 최우선이면 동기가 기준점이 된다.</li><li><strong>처리량·지연</strong>은 약점이므로 긴 I/O 는 <strong>비동기 경계로 분리</strong>하고, <strong>타임아웃/페일 - 패스트/풀 사이징</strong>으로 보완한다.</li><li><strong>감사·규정 준수</strong> 요구가 있으면 선형 로그가 큰 가치를 만든다.</li></ul><h4 id=주요-특징-및-차별점>주요 특징 및 차별점<a hidden class=anchor aria-hidden=true href=#주요-특징-및-차별점>#</a></h4><p>동기 실행 (Synchronous Execution) 은 모든 작업이 순차적으로 실행되어 이전 작업이 완료될 때까지 다음 작업이 대기하는 블로킹 실행 모델이다. 이 특성은 예측 가능성과 디버깅의 단순성을 제공하지만, 외부 I/O 나 긴 연산이 있을 경우 리소스 활용률과 확장성에 제약이 생긴다. 멀티스레드 환경에서도 요청 단위에서는 동일한 순차·블로킹 흐름이 유지되며, 강한 일관성이 필요한 시스템에서 선호된다.</p><table><thead><tr><th>특징</th><th>설명</th><th>기술적 근거</th><th>차별점</th></tr></thead><tbody><tr><td>순차적 실행</td><td>작업이 정해진 순서대로 하나씩 실행</td><td>CPU 가 단일 명령 흐름을 순차 처리</td><td>비동기는 작업을 병렬/병행 처리 가능</td></tr><tr><td>블로킹 처리</td><td>현재 작업 완료 전까지 다음 작업 대기</td><td>스레드가 I/O 완료 또는 연산 종료까지 대기 상태 유지</td><td>논블로킹은 대기 중에도 다른 작업 수행</td></tr><tr><td>결정론적 결과</td><td>동일 입력은 항상 동일한 실행 순서·결과 보장</td><td>실행 경로와 상태 변화가 예측 가능</td><td>병렬 실행은 스케줄링에 따라 순서·결과 변동 가능</td></tr><tr><td>디버깅 용이성</td><td>실행 흐름과 스택 트레이스가 단순</td><td>선형적 흐름 덕분에 제어 흐름 추적이 명확</td><td>비동기는 콜백/이벤트 체인으로 복잡</td></tr></tbody></table><ul><li><strong>흐름 제어</strong>: 순차적·선형 실행으로 예측 가능.</li><li><strong>리소스 사용</strong>: 블로킹으로 인한 CPU 유휴 시간이 발생할 수 있음.</li><li><strong>결과 예측성</strong>: 동일 입력 시 항상 같은 결과.</li><li><strong>개발 편의성</strong>: 제어 흐름 단순, 디버깅 쉽다.</li></ul><h3 id=핵심-원리-core-theory>핵심 원리 (Core Theory)<a hidden class=anchor aria-hidden=true href=#핵심-원리-core-theory>#</a></h3><h4 id=핵심-설계-원칙-및-철학>핵심 설계 원칙 및 철학<a hidden class=anchor aria-hidden=true href=#핵심-설계-원칙-및-철학>#</a></h4><p>동기 실행은 <strong>선형적 흐름</strong>을 통해 상태 변화를 <strong>예측 가능</strong>하게 만든다.<br>설계는</p><ol><li><strong>순차성</strong>으로 의존 관계를 명시하고,</li><li><strong>일관성</strong>으로 동일 조건에서 동일 결과를 보장하며</li><li><strong>단순성</strong>으로 사고 비용을 낮춘다.</li></ol><p><strong>원자성/불변식 유지</strong>, <strong>결정성</strong>, <strong>명시적 블로킹 경계와 타임아웃/재시도</strong>, <strong>오류 전파·정리 규율</strong>, <strong>리소스 수명 주기 관리</strong>를 더하면 동기 모델의 강점을 살리면서 운영 위험을 줄일 수 있다.<br>철학적으로는 <strong>안정성·검증가능성 우선</strong>을 견지하되, 지연이 큰 단계는 동기 경로 밖으로 분리 (오프로드) 하는 <strong>단순한 핵심 + 경계 분리</strong> 사고방식을 취한다.</p><table><thead><tr><th>카테고리</th><th>원칙/개념</th><th>의도/근거</th><th>설계 지침</th><th>주의/한계</th><th>적용 예</th></tr></thead><tbody><tr><td>실행 흐름</td><td><strong>순차성</strong></td><td>의존/선후관계 명확화</td><td>단계·의존 그래프를 코드 순서에 반영</td><td>긴 I/O 시 HoL 블로킹</td><td>가입→결제→발송 순차 처리</td></tr><tr><td>실행 흐름</td><td><strong>일관성</strong></td><td>동일 입력→동일 결과</td><td>순서·상태 전이 표준화</td><td>외부 시간/랜덤 의존 최소화</td><td>배치 이관 스크립트</td></tr><tr><td>설계 단순화</td><td><strong>단순성</strong></td><td>인지 부하 축소</td><td>함수·모듈 단일 책임, 깊은 호출 금지</td><td>과도한 일반화 지양</td><td>설정/마이그레이션 도구</td></tr><tr><td>무결성</td><td><strong>원자성/불변식</strong></td><td>중간 상태 누수 방지</td><td>트랜잭션 경계 명시, 실패 시 롤백</td><td>장기 트랜잭션 지양</td><td>주문 생성 + 재고 차감</td></tr><tr><td>예측가능성</td><td><strong>결정성</strong></td><td>재현·테스트 용이</td><td>순수 함수화·입력 고정</td><td>외부요인 주입 (시간/IO) 격리</td><td>리포트 산출</td></tr><tr><td>성능/경계</td><td><strong>명시적 블로킹</strong></td><td>병목 파악</td><td>타임아웃/재시도/폴백 규정</td><td>무한 대기 금지</td><td>동기 HTTP 호출 정책</td></tr><tr><td>안정성</td><td><strong>오류 전파 규율</strong></td><td>빠른 실패·정리</td><td>예외 정책 통일, try-finally</td><td>예외 삼키기 금지</td><td>파일/락 해제 보장</td></tr><tr><td>자원관리</td><td><strong>수명 주기 관리</strong></td><td>누수·교착 방지</td><td>스코프 기반 해제, 임계구역 단축</td><td>중첩 락 금지</td><td>DB 커넥션 핸들링</td></tr><tr><td>운영</td><td><strong>관측 가능성</strong></td><td>원인 추적</td><td>단계별 로그·메트릭·트레이스</td><td>과도한 로깅 지양</td><td>단계별 상태 로깅</td></tr></tbody></table><h4 id=기본-원리-및-동작-메커니즘>기본 원리 및 동작 메커니즘<a hidden class=anchor aria-hidden=true href=#기본-원리-및-동작-메커니즘>#</a></h4><h5 id=기본-원리>기본 원리<a hidden class=anchor aria-hidden=true href=#기본-원리>#</a></h5><p>동기 실행은 <strong>이전 작업이 끝나야 다음 작업을 시작하는 순차 처리 모델</strong>이다.<br>이는 결과의 의존성을 보장하고, 상태의 일관성을 유지하며, 작업 간 동기화를 통해 데이터와 실행 흐름의 안정성을 확보한다.</p><table><thead><tr><th>원리명</th><th>설명</th><th>관련 개념</th></tr></thead><tbody><tr><td>명령어 순차 실행 (Sequential Execution)</td><td>이전 작업이 완료된 후 다음 작업 시작</td><td>프로그램 카운터 (PC), 명령어 파이프라인</td></tr><tr><td>결과 의존성 (Result Dependency)</td><td>다음 작업은 이전 작업의 출력값을 필요로 함</td><td>함수 호출 체인, 데이터 처리 파이프라인</td></tr><tr><td>상태 일관성 유지 (State Consistency)</td><td>실행 중인 상태 (스택, 레지스터, 메모리) 가 작업 완료까지 유지</td><td>컨텍스트 유지, ACID 의 Consistency</td></tr><tr><td>동기화 메커니즘 (Synchronization)</td><td>작업 완료 신호에 따라 다음 작업 진행</td><td>블로킹 호출, 조건 변수, 세마포어</td></tr></tbody></table><h5 id=동작-메커니즘>동작 메커니즘<a hidden class=anchor aria-hidden=true href=#동작-메커니즘>#</a></h5><pre class=mermaid>sequenceDiagram
    participant Caller as 호출자(Caller)
    participant CPU as CPU
    participant Memory as 메모리
    participant IO as I/O 장치

    Caller-&gt;&gt;CPU: 작업 요청(Task A)
    CPU-&gt;&gt;Memory: 명령어/데이터 읽기
    CPU-&gt;&gt;CPU: 명령어 실행
    Note over CPU: 작업 A 완료까지 대기
    
    CPU--&gt;&gt;Caller: 결과 반환
    Caller-&gt;&gt;CPU: 다음 작업 요청(Task B)
    CPU-&gt;&gt;IO: I/O 요청
    Note over CPU,IO: I/O 완료까지 CPU 대기
    IO--&gt;&gt;CPU: I/O 완료 신호
    CPU-&gt;&gt;CPU: 후속 명령 실행
    CPU--&gt;&gt;Caller: 결과 반환
</pre><p>동기 실행의 흐름은 <strong>호출자가 작업을 요청 → CPU 가 명령을 실행 → 필요 시 I/O 요청 후 대기 → 작업 완료 후 결과 반환</strong>의 순서를 반복한다.<br>각 단계는 이전 단계가 끝날 때까지 진행되지 않으며, 이로 인해 전체 흐름의 예측 가능성이 높아진다.</p><h4 id=아키텍처-및-구성-요소>아키텍처 및 구성 요소<a hidden class=anchor aria-hidden=true href=#아키텍처-및-구성-요소>#</a></h4><p>동기 실행 아키텍처는 <strong>호출 스택과 프로그램 카운터</strong>를 축으로, 각 함수 호출이 <strong>스택 프레임</strong>을 쌓으며 <strong>순차적으로</strong> 진행된다.</p><p>I/O 또는 공유자원 접근 시에는 <strong>동기 시스템 콜</strong>이나 <strong>동기화 프리미티브</strong>가 호출되어 <strong>현재 스레드가 대기</strong>한다 (커널은 스레드를 슬립 처리 후 완료 시 웨이크업). 이때 <strong>타임아웃/취소 규칙</strong>과 <strong>리소스 수명주기 관리</strong>가 누수·교착을 방지한다.</p><p>운영 관점에서는 <strong>요청→단계별 실행→응답</strong> 구간에 <strong>로깅/메트릭/트레이스</strong>를 삽입해 병목 (예: 블로킹 I/O 지점) 과 실패를 진단한다. 필요 시 <strong>동기 큐</strong>로 순서를 직렬화하고, 경계가 긴 작업은 <strong>분리된 워커에 위임</strong>하여 핵심 동기 경로를 단순·짧게 유지한다.</p><pre class=mermaid>flowchart TB
  subgraph U[&#34;User Space (동기 경로)&#34;]
    A[&#34;요청 처리 함수 call()&#34;] --&gt; B[호출 스택에 프레임 push]
    B --&gt; C{계산/검증 단계}
    C --&gt;|계속| D[동기 I/O 필요?]
    D --&gt;|아니오| E[로직 계속 실행]
    D --&gt;|예| F[동기 시스템 콜 호출]
    E --&gt; H[결과 생성 → return]
  end

  subgraph K[&#34;Kernel Space&#34;]
    F --&gt; G[커널 I/O 서브시스템]
    G --&gt; I{I/O 완료?}
    I --&gt;|아니오| J[스레드 sleep/대기]
    I --&gt;|예| L[데이터 준비/상태 코드]
    J --&gt; I
    L --&gt; M[스레드 wakeup]
  end

  M --&gt; N[User Space로 복귀]
  N --&gt; O[호출 스택 pop + PC 재개]
  O --&gt; P{타임아웃/에러?}
  P --&gt;|예| Q[예외 전파/롤백/정리]
  P --&gt;|아니오| H[정상 결과 반환]
</pre><h5 id=구성-요소>구성 요소<a hidden class=anchor aria-hidden=true href=#구성-요소>#</a></h5><table><thead><tr><th>구분</th><th>구성 요소</th><th>설명</th><th>역할</th><th>기능</th><th>특징</th></tr></thead><tbody><tr><td>필수</td><td>호출 스택 (Call Stack)</td><td>함수 호출·리턴을 쌓는 스택 프레임 집합</td><td>제어 흐름·지역 상태 보존</td><td>리턴 주소/로컬 변수/레지스터 저장</td><td>선형 실행의 근간, 오버플로 주의</td></tr><tr><td>필수</td><td>프로그램 카운터 (PC)</td><td>다음 실행 명령어 주소</td><td>순차 흐름 진행</td><td>분기/점프/리턴 위치 지정</td><td>CPU 아키텍처 종속</td></tr><tr><td>필수</td><td>실행 컨텍스트/스택 프레임</td><td>한 호출의 환경 스냅샷</td><td>독립적 단계 수행</td><td>매개변수/로컬/저장 레지스터 유지</td><td>재진입성·결정성에 영향</td></tr><tr><td>필수</td><td>시스템 콜 인터페이스</td><td>커널 I/O/자원 접근 경로</td><td>동기 작업 위임</td><td>read/write/open 등</td><td>블로킹 지점의 핵심</td></tr><tr><td>필수</td><td>동기화 프리미티브 (락/조건변수/세마포어)</td><td>공유자원 상호배제·순서 제어</td><td>경쟁 상태 방지</td><td>lock/unlock, wait/signal</td><td>임계구역 최소화 필요</td></tr><tr><td>필수</td><td>커널 스케줄러/웨이크업</td><td>슬립/런큐 관리</td><td>블로킹 스레드 재개</td><td>sleep/wakeup, 컨텍스트 스위치</td><td>우선순위·공정성 영향</td></tr><tr><td>필수</td><td>타이머/타임아웃 관리자</td><td>무한 대기 방지</td><td>경계 시간 설정</td><td>timeout, deadline</td><td>실패·재시도 정책과 결합</td></tr><tr><td>선택</td><td>동기 큐 (Synchronous Queue)</td><td>순차 실행 대기열</td><td>직렬화·순서 보장</td><td>FIFO/우선순위 큐</td><td>처리율·지연 트레이드오프</td></tr><tr><td>선택</td><td>리소스 수명주기 관리자</td><td>파일/DB/락의 스코프 관리</td><td>누수·교착 방지</td><td>acquire/release, RAII</td><td>스코프 기반 해제 권장</td></tr><tr><td>선택</td><td>예외/에러 처리기</td><td>오류 탐지·전파·복구</td><td>빠른 실패·정리</td><td>try/finally, 롤백</td><td>예외 삼키기 금지</td></tr><tr><td>선택</td><td>관측성 훅 (로그/메트릭/트레이스)</td><td>단계 가시화</td><td>병목·원인 추적</td><td>구간 타이머, 상태 로깅</td><td>SLO·알람과 연계</td></tr></tbody></table><h4 id=주요-기능과-역할>주요 기능과 역할<a hidden class=anchor aria-hidden=true href=#주요-기능과-역할>#</a></h4><ul><li><strong>실행 흐름 제어</strong>: 조건·분기·반복을 <strong>한 흐름에서 직선적으로</strong> 처리해 로직을 단순화한다.</li><li><strong>순서/의존성 관리</strong>: 이전 단계 결과에 의존하는 작업의 <strong>정확한 순서</strong>를 강제한다.</li><li><strong>자원 접근 관리</strong>: 파일/DB/네트워크를 <strong>직렬화</strong>해 레이스·데드락 가능성을 줄인다.</li><li><strong>상태 일관성 유지</strong>: 상태 전이가 <strong>한 단계씩 명시적으로</strong> 일어나 예측 가능하다.</li><li><strong>오류 처리 및 복구</strong>: 예외 전파 경로가 단순해 <strong>원인 추적·롤백</strong>이 쉽다.</li><li><strong>트랜잭션 관리</strong>: ACID 보장으로 <strong>원자성/일관성</strong>을 확보한다.</li><li><strong>관측성/감사 추적</strong>: 선형 로그가 <strong>감사·규정 준수</strong>와 문제 재현에 유리하다.</li></ul><h5 id=기능--역할-관계>기능 ↔ 역할 관계<a hidden class=anchor aria-hidden=true href=#기능--역할-관계>#</a></h5><table><thead><tr><th>기능 (What)</th><th>핵심 책임 (Responsibility)</th><th>시스템 역할 (Role)</th><th>실패/리스크</th><th>권장 기법/도구</th><th>대표 적용 예</th></tr></thead><tbody><tr><td>실행 흐름 제어</td><td>단일 제어 흐름에서 단계적 실행</td><td>로직 단순화, 이해도↑</td><td>HoL 차단으로 지연 전파</td><td><strong>타임아웃·페일 - 패스트</strong>, 단계 분리</td><td>초기화 시퀀스, 배치 작업</td></tr><tr><td>순서/의존성 관리</td><td>의존 순서 강제, 결과 전달</td><td>예측 가능한 결과</td><td>순서 강제에 따른 처리량↓</td><td>단계 병합/분할, 불변 데이터 전달</td><td>검증 파이프라인, ETL</td></tr><tr><td>자원 접근 관리</td><td>파일/DB/네트워크 직렬 접근</td><td>레이스·무결성 이슈 감소</td><td>락 경합·대기↑</td><td>짧은 크리티컬 섹션, 커넥션 풀 튜닝</td><td>동기 DB I/O, 파일 머지</td></tr><tr><td>상태 일관성 유지</td><td>단계별 상태 전이 명시</td><td>디버깅·관찰성↑</td><td>장기 실행 시 상태 꼬임</td><td>상태 기계 (State Machine) 로그</td><td>결제 상태 전이, 주문 처리</td></tr><tr><td>오류 처리/복구</td><td>예외 전파·롤백 경로 단순</td><td>신뢰성·가용성↑</td><td>광역 롤백 비용↑</td><td><strong>트랜잭션 경계 최소화</strong>, 세분화된 예외</td><td>트랜잭션 실패 처리</td></tr><tr><td>트랜잭션 관리</td><td>ACID 보장</td><td>데이터 정합성</td><td>긴 트랜잭션→경합/타임아웃</td><td>짧은 트랜잭션, 적절한 격리 수준</td><td>재고 차감, 회계 분개</td></tr><tr><td>관측성/감사</td><td>구조화 로그/Trace-Id</td><td>준거성·문제 재현</td><td>낮은 가시성 시 MTTR↑</td><td><strong>코리레이션 ID</strong>, 단계 로그 스키마</td><td>감사 추적, 원인 분석</td></tr></tbody></table><ul><li>동기 실행은 <strong>선형 제어 흐름</strong>으로 순서·정합성·추적성을 보장한다.</li><li>약점 (처리량/대기) 은 <strong>타임아웃·락/풀 튜닝·경계 분리</strong>로 상쇄한다.</li><li>핵심 경로는 동기로 단단히, 대기 많은 외부 I/O 는 비동기로 <strong>오프로딩</strong>하라.</li></ul><h3 id=특성-분석-characteristics-analysis>특성 분석 (Characteristics Analysis)<a hidden class=anchor aria-hidden=true href=#특성-분석-characteristics-analysis>#</a></h3><h4 id=장점-및-이점>장점 및 이점<a hidden class=anchor aria-hidden=true href=#장점-및-이점>#</a></h4><p>동기 실행은 작업이 순차적으로 처리되는 구조 덕분에 <strong>예측 가능성, 데이터 일관성, 동시성 문제 회피</strong> 측면에서 강점을 가진다.<br>이러한 특성은 <strong>디버깅 용이성, 유지보수 효율성, 성능 병목 파악</strong>에 유리하며, <strong>금융·의료 등 무결성이 필수인 환경</strong>에서 안정성과 신뢰성을 보장한다. 또한 단일 스레드 기반이라 컨텍스트 스위칭 비용이 없고, 로그 및 상태 추적이 간단해 운영 효율이 높다.</p><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>기술적 근거</th><th>실무 효과</th></tr></thead><tbody><tr><td>개발 편의성</td><td>명확한 실행 순서</td><td>작업 흐름이 직관적이고 선형적</td><td>Call Stack 기반 순차 실행</td><td>디버깅 및 유지보수 용이</td></tr><tr><td>안정성</td><td>예측 가능한 동작</td><td>동일 입력에 대해 동일 결과 보장</td><td>결정론적 실행 모델</td><td>테스트 신뢰성, 운영 안정성 향상</td></tr><tr><td>안정성</td><td>데이터 일관성</td><td>상태 변경이 순차적으로 처리</td><td>원자적 연산 순차 실행</td><td>금융·의료 트랜잭션 무결성 확보</td></tr><tr><td>보안성</td><td>Race Condition 회피</td><td>동시 상태 변경이 발생하지 않음</td><td>직렬 자원 접근</td><td>동시성 보안 취약점 감소</td></tr><tr><td>성능 분석</td><td>병목 지점 식별 용이</td><td>실행 순서가 고정되어 문제 위치 명확</td><td>I/O 또는 함수 단위 병목 파악 쉬움</td><td>최적화 포인트 명확화</td></tr><tr><td>효율성</td><td>컨텍스트 스위칭 오버헤드 없음</td><td>단일 스레드 실행</td><td>상태 저장/복원 불필요</td><td>CPU 자원 효율적 사용</td></tr><tr><td>운영 효율</td><td>로그 추적 용이</td><td>실행 경로가 단순</td><td>순차 실행 기반 이벤트 흐름</td><td>장애 분석 속도 향상</td></tr></tbody></table><p>동기 실행은 <strong>선형적 구조</strong> 덕분에 개발·운영 전반에서 직관성과 예측 가능성을 제공한다.<br>데이터 무결성, Race Condition 회피, 병목 분석 용이성, 컨텍스트 스위칭 부재 등의 특성으로 <strong>금융·의료·보안 민감 시스템</strong>에 적합하며, 장애 분석과 로그 추적이 쉽다.</p><h4 id=단점-및-제약사항-분석>단점 및 제약사항 분석<a hidden class=anchor aria-hidden=true href=#단점-및-제약사항-분석>#</a></h4><p>동기 실행은 순차·예측 가능성이 강점이지만, 긴 I/O·외부 호출이 끼어들면 <strong>선두 차단</strong>으로 전체 경로가 지연되고, 처리량은 직렬화 때문에 쉽게 <strong>상한</strong>을 맞는다. 또한 임계구역이 길거나 외부 의존이 많으면 <strong>락 경합·장애 전파</strong>가 커지고, 드문 장기 작업이 <strong>테일 레이턴시</strong>를 악화시킨다.</p><p>대응은</p><ol><li>핵심 동기 경로를 <strong>짧게 유지</strong>하고 느린 단계는 <strong>큐·워커로 오프로딩</strong></li><li><strong>타임아웃/재시도 (지터)·서킷브레이커·격벽</strong>으로 실패 전파를 차단</li><li><strong>캐싱·배치·스레드/프로세스 풀</strong>로 블로킹 비용을 상쇄</li><li><strong>락 규율·임계구역 축소</strong>로 경합을 줄이는 것.</li><li>운영 측면에서는 <strong>event-loop/스레드 블로킹 지표, 큐 길이, p95/99 지연</strong>을 상시 감시해 임계 구간을 조기에 발견해야 한다.</li></ol><table><thead><tr><th>카테고리</th><th>항목</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방</th><th>해결/대안</th></tr></thead><tbody><tr><td>성능</td><td>Head-of-Line 블로킹</td><td>선행 작업 장기 지연</td><td>전체 응답 지연, 타임아웃 급증</td><td>단계별 구간 타이밍, 프로파일링</td><td>경로 슬라이싱 (핵심 &lt; 300ms)</td><td>느린 단계 비동기 오프로딩 (큐/워커), 캐싱</td></tr><tr><td>처리량</td><td>직렬화로 인한 스루풋 한계</td><td>단일 경로 순차 처리</td><td>TPS 포화, 스케일 불가</td><td>부하 테스트, RPS/TPS 추세</td><td>읽기/쓰기 분리</td><td>멀티프로세스/스레드 풀, 샤딩</td></tr><tr><td>자원</td><td>유휴 시간 증가</td><td>I/O 대기 동안 CPU 놀림</td><td>비용/효율 저하</td><td>CPU 사용률 vs I/O 대기</td><td>I/O 축소·배치</td><td>논블로킹 I/O 대체, prefetch/배치</td></tr><tr><td>안정성</td><td>장애 전파</td><td>외부 의존 실패를 동기 경로가 전파</td><td>연쇄 장애, MTTR 증가</td><td>실패율/동시 재시도율</td><td>실패 격벽 (Bulkhead)</td><td>서킷 브레이커 + 타임아웃 + 지수 백오프</td></tr><tr><td>동시성</td><td>락 경합/데드락</td><td>긴 임계구역·락 순서 불규칙</td><td>대기 폭증, 교착</td><td>락 대기시간, 스레드 덤프</td><td>락 순서 규약, 임계구역 단축</td><td>낙관적 잠금, 불변 구조, 파티셔닝</td></tr><tr><td>지연</td><td>테일 레이턴시 악화</td><td>드문 장기 작업/콜드스타트</td><td>p99/999 악화, 사용자 체감 저하</td><td>히스토그램 (p95~p999)</td><td>핫패스 예열·프리워밍</td><td>우선순위 큐, 타임아웃/폴백</td></tr><tr><td>운영</td><td>관측 취약</td><td>블로킹 지점 미계측</td><td>원인 추적 지연</td><td>단계별 스팬/메트릭</td><td>관측 표준화 (상관 ID/trace)</td><td>구간별 지표 의무화, 알람</td></tr></tbody></table><p>동기 실행의 병목은 <strong>직렬·블로킹</strong>에서 시작한다. 핵심 경로를 짧게 유지하고, 느린 단계는 <strong>비동기 위임</strong>으로 분리한다.<br><strong>타임아웃/재시도/서킷브레이커/격벽</strong>으로 실패 전파를 차단하고, <strong>락 규율·캐싱·배치·멀티프로세싱/스레딩</strong>으로 효율을 끌어올린다. 마지막으로 <strong>p95/99·큐 길이·락 대기</strong>를 꾸준히 관찰해 조기 대응한다.</p><h4 id=트레이드오프-관계-분석>트레이드오프 관계 분석<a hidden class=anchor aria-hidden=true href=#트레이드오프-관계-분석>#</a></h4><table><thead><tr><th>트레이드오프 축</th><th>A: <strong>동기 중심</strong> 선택 시 장점</th><th>A 단점/리스크</th><th>B: <strong>비동기/동시성 중심</strong> 선택 시 장점</th><th>B 단점/리스크</th><th>선택 기준 (질문)</th><th>핵심 지표</th><th>완화책 (권장)</th></tr></thead><tbody><tr><td>단순성 vs 성능</td><td>가독성·구현 용이, 오류 여지↓</td><td>대기 누적, 처리량 제한</td><td>처리량↑, 자원 효율↑</td><td>복잡성↑, 버그 유형 다양</td><td>" 읽기 쉬움 vs 처리량 " 어느 쪽이 더 중요?</td><td>RPS, p95/p99, CPU/스레드 점유</td><td>동기는 <strong>핫패스 최소화</strong>, 긴 I/O 는 큐 오프로딩</td></tr><tr><td>결정성/일관성 vs 확장성</td><td>결정적 흐름, 정합성·감사 용이</td><td>HoL 로 테일 지연↑</td><td>수평 확장, 탄력 처리</td><td>일관성 모델 관리 필요</td><td>" 정합성·감사 vs 확장성 " 우선순위?</td><td>오류율, 트랜잭션 충돌/락 대기</td><td>강한 트랜잭션 구간을 짧게, 외연은 Eventually Consistent</td></tr><tr><td>디버깅 용이성 vs 자원 활용</td><td>콜스택 추적 쉬움, 테스트 결정성↑</td><td>Thread-per-Request 상한</td><td>스레드/메모리 효율↑</td><td>비동기 스택 추적 난이도↑</td><td>&ldquo;MTTR vs 비용/밀도 " 무엇이 더 중요?</td><td>MTTR, 메모리/코어당 처리량</td><td>비동기엔 <strong>분산 추적/구조화 로그</strong> 표준화</td></tr><tr><td>제어권 명확성 vs 유연성</td><td>트랜잭션 롤백 단순</td><td>긴 트랜잭션→경합</td><td>부분 성공·보상 (사가) 가능</td><td>보상 로직 복잡</td><td>" 원자적 롤백 vs 부분 성공 허용?&rdquo;</td><td>롤백률, 경합/타임아웃</td><td>트랜잭션 경계 최소화, 보상은 <strong>표준 사가 템플릿</strong></td></tr><tr><td>HoL 회피 vs E2E 일관성</td><td>—</td><td>선두 지연 전파</td><td>큐로 버퍼링·스무딩</td><td>E2E 추적/순서 보장 복잡</td><td>" 스파이크 완화 필요?"</td><td>큐 길이/체류시간, 드롭률</td><td>멱등키, 순서 파티션, <strong>Outbox + Dispatcher</strong> 패턴</td></tr><tr><td>운영 단순성 vs 기능 풍부함</td><td>러닝커브 낮음</td><td>스케일 한계</td><td>기능 다변화 (백프레셔/재시도)</td><td>운영 복잡도↑</td><td>" 팀 숙련도·운영 여력?"</td><td>알람 소음, 재시도율</td><td>표준 런북/리미터/서킷·재시도 예산 도입</td></tr></tbody></table><ul><li><strong>정합성·감사·결정성</strong>이 핵심이면 <strong>동기 중심</strong>이 기준선이다.</li><li><strong>처리량·응답성</strong>이 핵심이면 <strong>비동기/동시성 중심</strong>으로 경계를 나누고 오프로딩한다.</li><li>베스트 프랙티스는 <strong>혼합 설계</strong>: " 핵심 트랜잭션은 짧고 강하게 (동기), 외부 I/O·후속 작업은 큐로 (비동기)".</li><li>지표 운영은 <strong>p95/p99, 큐 체류시간, 재시도율, 락 대기 시간, MTTR</strong>을 최소 세트로 본다.</li></ul><h4 id=성능-특성-및-확장성-분석>성능 특성 및 확장성 분석<a hidden class=anchor aria-hidden=true href=#성능-특성-및-확장성-분석>#</a></h4><ul><li><strong>성능</strong>:<br>동기 모델은 <strong>순차·차단</strong> 특성으로 <strong>응답 시간의 예측 가능성</strong>과 <strong>낮은 컨텍스트 스위칭 오버헤드</strong>를 제공한다.<br><strong>CPU-bound·짧은 연산</strong>에서는 높은 효율을 보일 수 있으나, <strong>I/O 대기</strong>가 포함되면 스레드가 묶이며 <strong>처리량·동시성</strong>이 급락한다.<br>캐시 친화적 접근 패턴으로 특정 워크로드에서 L1/L2 히트율이 유리할 수 있다.</li><li><strong>확장성</strong>:<br>스레드·커넥션 풀의 물리적 한계로 <strong>수직 확장</strong> 의존도가 높다.<br><strong>수평 확장</strong>은 가능하지만 세션/상태를 외부화해야 하고, 동기 호출 체인은 <strong>한 지점의 지연이 전체를 막는</strong> 구조적 리스크가 있다.<br>이를 보완하려면 <strong>캐싱, 배치 처리, 읽기/쓰기 분리, 큐 기반 비동기 오프로딩, 멀티프로세싱</strong> 등을 혼합하는 <strong>하이브리드</strong>가 효과적이다.</li></ul><table><thead><tr><th>구분</th><th>항목</th><th>장점</th><th>병목/제한 요인</th><th>개선/완화 전략</th><th>관측 지표 (추천)</th></tr></thead><tbody><tr><td>성능</td><td>CPU-bound 처리</td><td>순차 실행 + 캐시 지역성으로 효율↑</td><td>단일 스레드가 긴 작업 점유</td><td>워커/프로세스 풀로 오프로딩</td><td>CPU 사용률, run queue, GC pause</td></tr><tr><td>성능</td><td>응답 시간 예측 가능</td><td>선형 호출·스택 추적 용이</td><td>체인 중 하나의 지연이 전체 블로킹</td><td>타임아웃·서킷·리트라이 (지수 백오프)</td><td>P50/P95/P99, 타임아웃 비율</td></tr><tr><td>성능</td><td>낮은 오버헤드</td><td>컨텍스트 스위칭·락 경합 감소</td><td>I/O 대기 시 스레드 고갈</td><td>커넥션 풀 튜닝, 비동기 I/O 병행</td><td>풀 사용률, 대기열 길이</td></tr><tr><td>확장성</td><td>수직 확장</td><td>코어/클럭↑로 성능↑</td><td>병렬성 자체는 제한</td><td>핫패스 최적화, 배치화</td><td>단건 vs 배치 처리당 지연</td></tr><tr><td>확장성</td><td>수평 확장</td><td>인스턴스 증설로 TPS↑</td><td>상태 공유/세션 스티키</td><td>스테이트리스, 외부 세션/캐시</td><td>인스턴스별 RPS, 캐시 히트율</td></tr><tr><td>확장성</td><td>동시성</td><td>직렬처리로 단순·안정</td><td>I/O 병목, 락 대기</td><td>CQRS, 읽기 캐시, 메시지 큐</td><td>락 대기시간, serialization 실패율</td></tr></tbody></table><p>동기 실행은 <strong>예측 가능한 레이턴시와 단순한 운영</strong>이 강점이지만, <strong>I/O 대기와 락 경합</strong>에서 처리량이 급격히 떨어진다. 확장은 <strong>수직 중심</strong>이 되기 쉽고, 수평 확장 시에는 <strong>상태 외부화·캐싱·비동기 오프로딩</strong>을 결합한 <strong>하이브리드 설계</strong>가 실무적으로 가장 효과적이다.</p><h3 id=구현-및-분류-implementation--classification>구현 및 분류 (Implementation & Classification)<a hidden class=anchor aria-hidden=true href=#구현-및-분류-implementation--classification>#</a></h3><h4 id=구현-기법-및-방법>구현 기법 및 방법<a hidden class=anchor aria-hidden=true href=#구현-기법-및-방법>#</a></h4><table><thead><tr><th>분류</th><th>정의</th><th>구성 요소</th><th>원리</th><th>목적</th><th>사용 상황</th><th>특징</th></tr></thead><tbody><tr><td>직접 함수 호출 파이프라인</td><td>함수를 순서대로 호출·반환값 전달</td><td>호출 스택, 스택 프레임</td><td>호출→완료→다음 단계 선형 진행</td><td>가독성·검증 용이</td><td>단일 경로 처리, 초기화/정리 루틴</td><td>제어 흐름 단순, 테스트 쉬움</td></tr><tr><td>블로킹 I/O 처리</td><td>I/O 완료까지 현재 스레드 대기</td><td>시스템콜, 파일/소켓</td><td><code>read/write/connect</code> 완료 후 복귀</td><td>일관성 보장, 단순 제어</td><td>파일 읽기/쓰기, 동기 HTTP</td><td>대기 중 CPU 유휴, 타임아웃 필수</td></tr><tr><td>순차 루프/배치 처리</td><td>컬렉션/배치를 순차 처리</td><td>반복문, 배치 분할</td><td>요소/배치를 하나씩 처리 후 다음</td><td>안정적 대량 처리</td><td>로그 변환, 리포트 생성</td><td>중간 저장/리커버리, 진행률 추적</td></tr><tr><td>트랜잭션 기반 처리</td><td>트랜잭션 경계 내 순차 실행</td><td>커넥션, 트랜잭션, 롤백</td><td>ACID 보장, 실패 시 전체 롤백</td><td>정합성·원자성</td><td>결제/정산, 재고 이동</td><td>예외 처리·리소스 해제 중요</td></tr><tr><td>Thread-per-request</td><td>요청당 1 스레드로 동기 처리</td><td>스레드풀, 락, 컨텍스트</td><td>각 요청은 순차/독립, 병렬은 스레드풀</td><td>단순한 동시성 모델</td><td>전통 웹서버, 서블릿 계열</td><td>락 경합·스위칭 오버헤드 주의</td></tr><tr><td>동기 API 통신</td><td>요청 후 응답까지 대기</td><td>HTTP 클라이언트, 타임아웃</td><td>Request→Blocking→Response</td><td>예측 가능한 흐름</td><td>동기 RPC/HTTP 호출</td><td>재시도/서킷브레이커와 결합</td></tr><tr><td>동기 + 논블로킹 폴링</td><td>순차 흐름 유지, 준비 여부 폴링</td><td>소켓, <code>select/poll</code></td><td>준비 신호가 올 때만 처리</td><td>부분 대기 회피</td><td>간단한 프로토콜, 파이프</td><td>구현 복잡도↑, 여전히 선형</td></tr></tbody></table><ul><li>동기 구현의 공통분모는 <strong>호출이 끝나야 다음으로 진행</strong>된다는 점이다.</li><li>복잡성은 낮지만, 긴 I/O 가 끼면 <strong>선두 차단 (HoL)</strong> 과 <strong>자원 유휴</strong>가 커진다.</li><li>실무에선 <strong>타임아웃·재시도·락 규율·트랜잭션 경계</strong>를 표준화하고, 긴 작업은 <strong>경계 밖으로 분리</strong>해 선형 경로를 짧게 유지하면 안정성과 성능을 함께 챙길 수 있다.</li></ul><h5 id=직접-함수-호출-파이프라인python>직접 함수 호출 파이프라인—Python<a hidden class=anchor aria-hidden=true href=#직접-함수-호출-파이프라인python>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_user</span><span class=p>(</span><span class=n>uid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># DB/파일 등 외부 의존이 없다고 가정(순수 계산)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=n>uid</span><span class=p>,</span> <span class=s2>&#34;tier&#34;</span><span class=p>:</span> <span class=s2>&#34;basic&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>upgrade</span><span class=p>(</span><span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>user</span><span class=p>[</span><span class=s2>&#34;tier&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;pro&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>persist</span><span class=p>(</span><span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제론 DB 저장(여기선 프린트로 대체)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;saved:&#34;</span><span class=p>,</span> <span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>upgrade_flow</span><span class=p>(</span><span class=n>uid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>user</span> <span class=o>=</span> <span class=n>load_user</span><span class=p>(</span><span class=n>uid</span><span class=p>)</span>          <span class=c1># 1) 로드</span>
</span></span><span class=line><span class=cl>    <span class=n>updated</span> <span class=o>=</span> <span class=n>upgrade</span><span class=p>(</span><span class=n>user</span><span class=p>)</span>        <span class=c1># 2) 변환</span>
</span></span><span class=line><span class=cl>    <span class=n>persist</span><span class=p>(</span><span class=n>updated</span><span class=p>)</span>               <span class=c1># 3) 저장</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;OK&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>upgrade_flow</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=블로킹-io-처리python>블로킹 I/O 처리—Python<a hidden class=anchor aria-hidden=true href=#블로킹-io-처리python>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7>7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8>8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pathlib</span> <span class=kn>import</span> <span class=n>Path</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>read_config_sync</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 파일 읽기 완료 전까지 이후 코드 진행 없음(블로킹)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>content</span> <span class=o>=</span> <span class=n>read_config_sync</span><span class=p>(</span><span class=s2>&#34;config.ini&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;length:&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=순차-루프배치-처리python>순차 루프/배치 처리—Python<a hidden class=anchor aria-hidden=true href=#순차-루프배치-처리python>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_batch</span><span class=p>(</span><span class=n>batch</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 시간이 걸리는 배치 처리(예: 해시 계산/압축)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>batch</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_all</span><span class=p>(</span><span class=n>items</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>items</span><span class=p>),</span> <span class=n>size</span><span class=p>):</span>     <span class=c1># 배치를 순차 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>batch</span> <span class=o>=</span> <span class=n>items</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=n>size</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>process_batch</span><span class=p>(</span><span class=n>batch</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># 중간 커밋/체크포인트 가능</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>out</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>process_all</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>5000</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;processed:&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=트랜잭션-기반-처리python-sqlite3>트랜잭션 기반 처리—Python (sqlite3)<a hidden class=anchor aria-hidden=true href=#트랜잭션-기반-처리python-sqlite3>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sqlite3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>transfer</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=n>from_id</span><span class=p>,</span> <span class=n>to_id</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># with 블록: 예외 시 자동 롤백, 정상 종료 시 커밋</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT balance FROM accounts WHERE id=?&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>from_id</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>        <span class=n>bal</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>bal</span> <span class=o>&lt;</span> <span class=n>amount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;insufficient&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE accounts SET balance = balance - ? WHERE id=?&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>amount</span><span class=p>,</span> <span class=n>from_id</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE accounts SET balance = balance + ? WHERE id=?&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>amount</span><span class=p>,</span> <span class=n>to_id</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># 여기까지 모두 성공해야 커밋됨(ACID)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;:memory:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>executescript</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>CREATE TABLE accounts(id INTEGER PRIMARY KEY, balance INTEGER);
</span></span></span><span class=line><span class=cl><span class=s2>INSERT INTO accounts VALUES(1, 100), (2, 0);
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>transfer</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM accounts&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>fetchall</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=thread-per-request-서버-모델pythonflask-threaded>Thread-per-request 서버 모델—Python(Flask, threaded)<a hidden class=anchor aria-hidden=true href=#thread-per-request-서버-모델pythonflask-threaded>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># pip install flask</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/sum&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calc_sum</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 각 요청은 독립 스레드에서 동기적으로 처리됨</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;a&#34;</span><span class=p>,</span> <span class=s2>&#34;0&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;b&#34;</span><span class=p>,</span> <span class=s2>&#34;0&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># 긴 작업이 있다면 이 스레드가 블로킹됨</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;sum&#34;</span><span class=p>:</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># threaded=True: 요청마다 스레드 할당(스레드풀 관리)</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span> <span class=n>threaded</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=동기-api-통신-request-responsepython>동기 API 통신 (Request-Response)—Python<a hidden class=anchor aria-hidden=true href=#동기-api-통신-request-responsepython>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># pip install requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fetch_user</span><span class=p>(</span><span class=n>uid</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>5</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 연결/응답 타임아웃 설정으로 무한 대기 방지</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;https://api.example.com/users/</span><span class=si>{</span><span class=n>uid</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=n>timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 호출이 끝날 때까지 이후 로직 진행 안 됨</span>
</span></span><span class=line><span class=cl><span class=c1># print(fetch_user(1))</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=동기--논블로킹-폴링pythonselect>동기 + 논블로킹 폴링—Python(select)<a hidden class=anchor aria-hidden=true href=#동기--논블로킹-폴링pythonselect>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span><span class=o>,</span> <span class=nn>select</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sync_poll_read</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sock</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>sock</span><span class=o>.</span><span class=n>setblocking</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>             <span class=c1># 논블로킹 소켓</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>sock</span><span class=o>.</span><span class=n>connect</span><span class=p>((</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>BlockingIOError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>                            <span class=c1># 연결 진행 중</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 순차 흐름을 유지하면서 준비 여부만 폴링</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>rlist</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>select</span><span class=o>.</span><span class=n>select</span><span class=p>([</span><span class=n>sock</span><span class=p>],</span> <span class=p>[],</span> <span class=p>[],</span> <span class=mi>5</span><span class=p>)</span>  <span class=c1># 준비되면 반환</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>sock</span> <span class=ow>in</span> <span class=n>rlist</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>sock</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4096</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>data</span><span class=p>:</span> <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=c1># 읽은 데이터를 동기적으로 가공</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;got:&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sock</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sync_poll_read(&#34;example.com&#34;, 80)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h4><p>동기 실행은 <strong>호출자가 결과를 기다리는</strong> 제어 흐름이며, 아래 축들의 조합으로 실무 유형이 결정된다.</p><ul><li><strong>I/O 방식</strong>: 블로킹 I/O(호출 블록) 또는 논블로킹 I/O(폴링·readiness 체크)</li><li><strong>실행 구조</strong>: 단일 스레드 (간단·낮은 확장성) / 멀티 스레드 (코어 활용, 스레드 풀 상한) / 멀티 프로세스</li><li><strong>실행 범위</strong>: 함수·스레드·프로세스·시스템 레벨에서의 순차/차단 보장 범위</li><li><strong>처리 모드</strong>: 온라인 (즉시) / 배치 (묶음) / 단계별 파이프라인 (엄격한 순서)</li><li><strong>통신 패턴</strong>: 로컬 동기 호출 / 원격 동기 호출 (RPC/HTTP 요청 - 응답)</li><li><strong>트랜잭션/일관성</strong>: 단일 트랜잭션형 (ACID) / 부분 동기형 (핵심만 동기, 외연은 비동기 오프로딩)</li></ul><table><thead><tr><th>분류 기준</th><th>유형</th><th>핵심 특징</th><th>장점</th><th>한계/주의</th><th>대표 적용 예</th></tr></thead><tbody><tr><td>I/O 방식</td><td><strong>블로킹 I/O 동기</strong></td><td>호출이 완료될 때까지 스레드 대기</td><td>구현 단순, 디버깅 용이</td><td>스레드 점유, HoL 지연</td><td>동기 DB 쿼리, 파일 I/O</td></tr><tr><td>I/O 방식</td><td><strong>논블로킹 I/O 동기 (폴링)</strong></td><td>상태 확인·타임아웃 루프로 동기 제어 유지</td><td>메인 흐름 통제 쉬움</td><td>바쁜 대기/폴링 비용</td><td>간단한 소켓 폴링, 상태 폴링 API</td></tr><tr><td>실행 구조</td><td><strong>단일 스레드 동기</strong></td><td>하나의 스레드에서 순차 실행</td><td>단순·예측 가능</td><td>확장성 낮음</td><td>CLI, 초기화 루틴</td></tr><tr><td>실행 구조</td><td><strong>멀티 스레드 동기</strong></td><td>요청마다 스레드/풀에서 동기 처리</td><td>코어 활용, 확장성↑</td><td>풀 상한=동시성 상한</td><td>전통적 웹 서버 (스레드 - 퍼 - 리퀘스트)</td></tr><tr><td>실행 구조</td><td><strong>멀티 프로세스 동기</strong></td><td>프로세스 단위 격리·동기 흐름</td><td>장애 격리, 확장성</td><td>IPC 비용</td><td>Apache MPM, 워커 프로세스</td></tr><tr><td>실행 범위</td><td><strong>함수 레벨 동기</strong></td><td>함수 호출/리턴 기준 순차</td><td>지역적 단순성</td><td>시스템 수준 영향 제한</td><td>알고리즘·검증 루틴</td></tr><tr><td>실행 범위</td><td><strong>스레드/프로세스 레벨 동기</strong></td><td>단일 실행 단위 내 순차</td><td>제어 명확</td><td>단위 간 조율 필요</td><td>배치/스크립트, 워커</td></tr><tr><td>처리 모드</td><td><strong>즉시 (온라인) 순차 처리</strong></td><td>요청 즉시 순차 실행</td><td>UX 단순</td><td>대기 시간 누적</td><td>동기 API 처리</td></tr><tr><td>처리 모드</td><td><strong>배치 순차 처리</strong></td><td>일정량 묶음 순차 처리</td><td>처리량·효율↑</td><td>지연↑</td><td>ETL, 데이터 청산</td></tr><tr><td>처리 모드</td><td><strong>단계별 파이프라인</strong></td><td>엄격 순서의 단계 진행</td><td>정합성↑</td><td>HoL 확대 위험</td><td>검증/정산 파이프라인</td></tr><tr><td>통신 패턴</td><td><strong>로컬 동기 호출</strong></td><td>프로세스 내부 함수/모듈 호출</td><td>비용 낮음</td><td>결합도↑</td><td>서비스 내부 계층 호출</td></tr><tr><td>통신 패턴</td><td><strong>원격 동기 호출 (RPC/HTTP)</strong></td><td>응답 대기형 요청 - 응답</td><td>직관적</td><td>네트워크 지연 전파</td><td>REST/RPC 클라이언트</td></tr><tr><td>트랜잭션</td><td><strong>단일 트랜잭션 동기</strong></td><td>ACID 경계 내 순차 처리</td><td>강한 정합성</td><td>락 경합/지연</td><td>재고/결제/회계</td></tr><tr><td>트랜잭션</td><td><strong>부분 동기형 (핵심만 동기)</strong></td><td>핵심만 동기, 외연은 큐로</td><td>균형·복원력</td><td>경계 설계 필요</td><td>주문 생성 동기 + 알림 비동기</td></tr></tbody></table><ul><li>동기는 <strong>제어 흐름의 의미</strong>이고, 블로킹은 <strong>I/O 호출의 행위</strong>다. 둘을 분리해 보면 분류가 명확해진다.</li><li>실무에서는 <strong>멀티 스레드 동기 + 블로킹 I/O</strong>가 흔하지만, " 핵심만 동기·외연 비동기 (Outbox/큐)" 가 더 안전하고 확장 가능하다.</li><li>설계 판단 시 <strong>HoL 위험, 풀 상한, 트랜잭션 길이·격리 수준, 네트워크 지연 전파</strong>를 핵심 지표로 본다.</li></ul><h4 id=도구-및-프레임워크-생태계>도구 및 프레임워크 생태계<a hidden class=anchor aria-hidden=true href=#도구-및-프레임워크-생태계>#</a></h4><p>동기 실행 생태계는 전통적으로 요청 - 응답 패턴에서 결과 반환 전까지 처리가 블로킹되는 구조를 기반으로 발전해왔다.<br>언어별로 표준 라이브러리와 주요 프레임워크에서 동기 실행 API 를 제공하며, 이는 간결한 제어 흐름과 예측 가능한 동작을 장점으로 한다.</p><p>웹 서버 및 프레임워크 (예: Apache HTTP Server, Django) 는 요청마다 별도의 쓰레드/프로세스를 할당하거나 이벤트 루프를 사용하며, HTTP 클라이언트 (예: requests), 데이터베이스 드라이버 (JDBC, psycopg2) 등도 동기 방식이 널리 쓰인다.<br>다만, 일부 환경 (Node.js 등) 에서는 초기 동기 API 에서 비동기 모델로 전환되었으며, 실무에서는 성능 및 확장성 고려로 비동기 방식을 선택하는 경우가 많다.</p><table><thead><tr><th>카테고리</th><th>도구/프레임워크</th><th>언어</th><th>특징</th><th>사용 사례</th></tr></thead><tbody><tr><td>언어 기본 지원</td><td>함수 호출, 파일 I/O</td><td>Python, Java, Go, JavaScript</td><td>실행 완료 전까지 블로킹</td><td>기초 연산, 스크립트 실행</td></tr><tr><td>웹 서버</td><td>Apache HTTP Server</td><td>C</td><td>멀티프로세스 동기 처리</td><td>정적 웹, PHP</td></tr><tr><td>웹 프레임워크</td><td>Django / Flask</td><td>Python</td><td>동기 기반 요청 처리</td><td>전통적 웹 서비스</td></tr><tr><td>웹 프레임워크</td><td>Spring MVC</td><td>Java</td><td>Thread-per-request 모델</td><td>엔터프라이즈 웹 앱</td></tr><tr><td>웹 프레임워크</td><td>Gin</td><td>Go</td><td>동기 핸들러 호출</td><td>경량 API 서버</td></tr><tr><td>HTTP 클라이언트</td><td>requests</td><td>Python</td><td>블로킹 HTTP 요청</td><td>API 호출, 웹 스크래핑</td></tr><tr><td>HTTP 클라이언트</td><td>http.client</td><td>Python</td><td>표준 동기 HTTP 지원</td><td>저수준 통신</td></tr><tr><td>데이터베이스</td><td>JDBC, Hibernate</td><td>Java</td><td>동기 DB 연결</td><td>OLTP, ERP</td></tr><tr><td>데이터베이스</td><td>psycopg2, SQLAlchemy</td><td>Python</td><td>동기 쿼리 처리</td><td>데이터 분석</td></tr><tr><td>파일 I/O</td><td>fs (sync)</td><td>Node.js</td><td>블로킹 파일 접근</td><td>설정 파일, 로그</td></tr><tr><td>RPC</td><td>gRPC (sync mode)</td><td>다양한 언어</td><td>동기 원격 호출</td><td>마이크로서비스 통신</td></tr></tbody></table><ul><li><strong>언어 기본 지원</strong>: 대부분의 언어가 함수 호출·파일 I/O 에서 동기 모델을 제공.</li><li><strong>웹 서버/프레임워크</strong>: 요청 - 응답 기반 동기 처리 모델이 전통적 웹 아키텍처의 핵심.</li><li><strong>HTTP 클라이언트</strong>: 단순성과 예측 가능성으로 인해 동기 HTTP 호출이 API 통신 초기에 널리 사용됨.</li><li><strong>데이터베이스 접근</strong>: JDBC, psycopg2 같은 드라이버는 요청 - 응답식 동기 쿼리 수행.</li><li><strong>파일 I/O</strong>: 설정/로그 처리에 동기 접근 사용되지만, 확장성 문제로 비동기 전환 추세.</li><li><strong>RPC</strong>: gRPC, RMI 등은 명시적 응답 대기 방식으로 동작하는 동기 호출 모드 지원.</li></ul><h4 id=표준-및-규격-준수사항>표준 및 규격 준수사항<a hidden class=anchor aria-hidden=true href=#표준-및-규격-준수사항>#</a></h4><p>동기 실행의 표준 준수사항은 OS/언어 수준, 통신·데이터 표준, 보안 가이드라인으로 나뉜다.</p><ul><li><strong>국제 표준</strong>: POSIX, ISO/IEC 9899, IEEE 1003 은 동기 시스템 콜, 함수 호출, I/O 처리 규격 정의.</li><li><strong>업계 표준</strong>: HTTP/1.1 의 요청 - 응답 모델, ANSI/ISO SQL 의 트랜잭션 규격, JDBC 의 동기 DB 접근 인터페이스.</li><li><strong>보안 표준</strong>: OWASP Top 10 의 서비스 가용성 항목, TLS/SSL 의 안전한 통신, NIST 가이드라인의 가용성 관리.</li><li><strong>API 규격</strong>: OpenAPI 명세에서 SLA, 타임아웃, HTTP 상태 코드 (408, 504 등) 명시.</li><li><strong>운영 고려</strong>: 블로킹 시 리소스 고갈 방지를 위한 커넥션·스레드 제한, 타임아웃, 재시도 정책 설정.</li></ul><table><thead><tr><th>구분</th><th>표준/규격</th><th>적용 범위</th><th>주요 내용</th><th>실무 고려사항</th></tr></thead><tbody><tr><td>국제 표준</td><td>POSIX (IEEE 1003)</td><td>OS, 시스템 콜</td><td>동기 I/O, 파일·네트워크 호출 규격</td><td>OS 별 구현 차이 고려</td></tr><tr><td>국제 표준</td><td>ISO/IEC 9899 (C 표준)</td><td>언어</td><td>함수 호출·블로킹 처리 명세</td><td>컴파일러 구현 확인</td></tr><tr><td>업계 표준</td><td>HTTP/1.1</td><td>통신</td><td>요청 - 응답 동기 구조</td><td>Keep-Alive, 타임아웃 설정</td></tr><tr><td>업계 표준</td><td>ANSI/ISO SQL</td><td>DB</td><td>ACID, 트랜잭션 격리 수준</td><td>Isolation Level 선택</td></tr><tr><td>업계 표준</td><td>JDBC</td><td>자바 DB API</td><td>동기 데이터 접근 규격</td><td>커넥션 풀·타임아웃 조정</td></tr><tr><td>API 규격</td><td>OpenAPI/Swagger</td><td>API 문서</td><td>SLA, 타임아웃, 오류 코드 명시</td><td>408, 504 처리 로직 구현</td></tr><tr><td>보안 표준</td><td>TLS/SSL</td><td>네트워크 보안</td><td>암호화 통신, 인증</td><td>최신 프로토콜 버전 사용</td></tr><tr><td>보안 표준</td><td>OWASP</td><td>앱 보안</td><td>리소스 고갈·DoS 방지</td><td>Rate Limit, 요청 검증</td></tr><tr><td>보안 표준</td><td>NIST SP 800-53</td><td>보안·가용성</td><td>가용성 유지 제어</td><td>모니터링·Failover 설계</td></tr></tbody></table><p>동기 실행은 OS·언어 표준, 통신·DB·API 업계 표준, 보안 가이드라인 등 다양한 규격의 영향을 받는다. POSIX·HTTP/1.1·SQL·TLS 같은 규격은 동기 흐름에서 필수적으로 지켜야 하며, 타임아웃·재시도·리소스 제한을 통해 블로킹으로 인한 서비스 중단 위험을 줄여야 한다.</p><h3 id=실무-적용-practical-application>실무 적용 (Practical Application)<a hidden class=anchor aria-hidden=true href=#실무-적용-practical-application>#</a></h3><h4 id=실제-도입-사례>실제 도입 사례<a hidden class=anchor aria-hidden=true href=#실제-도입-사례>#</a></h4><p>동기 실행은 <strong>정합성·가시성·순서 보장</strong>이 최우선인 경로에 채택된다.<br>예를 들어, 결제 게이트웨이는 <strong>결제 의사 확인</strong>을 요청 - 응답 내에서 완료해야 사용자 경험과 보안 정책을 동시에 만족시킨다.<br>CI/CD 에선 테스트·빌드·배포의 <strong>직렬 단계</strong>가 실패 지점을 명확히 하고 롤백 결정을 단순화한다.<br>데이터베이스 마이그레이션은 <strong>결정적 순서</strong>가 핵심이므로 Flyway/Liquibase 가 버전 이력으로 적용 순서를 보장한다.<br>전통 Servlet/Tomcat 및 전자정부 표준프레임워크 (Spring MVC) 는 <strong>요청당 스레드</strong> 모델과 DispatcherServlet 으로 예측 가능한 <strong>동기 요청 - 응답</strong>을 구현한다.<br>클러스터 운영에선 Kubernetes <strong>Init 컨테이너</strong>가 앱 시작 전 준비 작업을 <strong>순차 완료</strong>시켜 초기화 의존성을 안전하게 해소한다.</p><table><thead><tr><th>범주/플랫폼</th><th>적용 분야</th><th>동기 실행 구간</th><th>도입 목적</th><th>핵심 효과</th></tr></thead><tbody><tr><td>Stripe (PaymentIntents)</td><td>결제</td><td><code>confirm</code> 요청 시 <strong>동기 승인/거절</strong></td><td>사용자 피드백·위험결정 즉시성</td><td>UX·보안 정책 일치</td></tr><tr><td>GitHub Actions</td><td>CI/CD</td><td><code>steps</code> 는 <strong>순차</strong>, <code>jobs.needs</code> 로 <strong>직렬화</strong></td><td>실패 지점 명확화</td><td>디버깅/롤백 단순화</td></tr><tr><td>Flyway/Liquibase</td><td>DB 마이그레이션</td><td><strong>정해진 순서</strong>로 스크립트 적용</td><td>스키마 정합성</td><td>결정적 배포·이력 관리</td></tr><tr><td>Tomcat(서블릿)</td><td>웹 서버</td><td><strong>요청당 스레드</strong>로 동기 처리</td><td>단순한 동시성 모델</td><td>예측 가능한 지연·문맥</td></tr><tr><td>eGovFrame(Spring MVC)</td><td>공공 웹</td><td>DispatcherServlet 기반 <strong>요청→응답</strong></td><td>표준화·유지보수성</td><td>절차·흐름 일원화</td></tr><tr><td>Kubernetes Init Containers</td><td>플랫폼 초기화</td><td>앱 시작 전 <strong>순차 완료 보장</strong></td><td>의존 초기화·보안</td><td>안전한 부팅 경로</td></tr></tbody></table><ul><li><strong>왜 동기인가?</strong> 실패 전파와 순서가 비즈니스 결과에 직결될 때 (결제, 스키마 변경, 승인/배포 게이트) 동기가 최적.</li><li><strong>트레이드오프</strong>: 확장성과 평균 처리량은 비동기가 유리하지만, 동기는 <strong>오류 경계·관찰성·일관성</strong>에서 비용을 줄여준다.</li><li><strong>설계 팁</strong>: 동기 경로를 <strong>짧게 유지</strong>하고 (핵심 검증/승인만), 지연 큰 작업은 <strong>비동기 오프로딩</strong>(큐/워커) 으로 분리. <strong>타임아웃/서킷브레이커</strong>를 반드시 결합할 것.</li></ul><h4 id=실습-예제-및-코드-구현>실습 예제 및 코드 구현<a hidden class=anchor aria-hidden=true href=#실습-예제-및-코드-구현>#</a></h4><h5 id=실습-예제-웹-api-서버가-사용자-정보--주문-정보--배송-상태를-순차적으로-조회>실습 예제: 웹 API 서버가 사용자 정보 → 주문 정보 → 배송 상태를 순차적으로 조회<a hidden class=anchor aria-hidden=true href=#실습-예제-웹-api-서버가-사용자-정보--주문-정보--배송-상태를-순차적으로-조회>#</a></h5><p><strong>학습 목표</strong>: 동기 실행의 기본 구조와 블로킹 방식의 흐름을 이해하고, 네트워크 지연이 전체 응답에 어떤 영향을 주는지 실습한다.</p><p><strong>시나리오</strong>: 웹 API 서버가 사용자 정보 → 주문 정보 → 배송 상태를 순차적으로 조회하는 경우</p><p><strong>시스템 구성</strong>:</p><ul><li>API Gateway (Flask)</li><li>External Services (User, Order, Delivery - Mocked)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    Client --&gt; API[Flask API Gateway]
    API --&gt; U[User Service]
    API --&gt; O[Order Service]
    API --&gt; D[Delivery Service]
</pre><p><strong>Workflow</strong>:</p><ol><li>Client 가 API Gateway 에 요청</li><li>API 는 사용자 정보 → 주문 정보 → 배송 상태 순으로 호출</li><li>이전 응답 없이는 다음 호출 불가</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>Synchronous Execution 은 각 단계의 <strong>정확한 결과 의존성</strong>을 보장</li><li>에러 발생 시 흐름 즉시 중단 가능</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 병렬 호출로 인해 순서 불일치, 데이터 불일치 가능성 존재</li><li>도입 후: 단계별 상태 확인 가능, 오류 추적 및 복구 용이</li></ul><p><strong>구현 예시</strong>: Python + Flask</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/track/&lt;user_id&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>track_user</span><span class=p>(</span><span class=n>user_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    동기 방식으로 사용자 → 주문 → 배송 상태를 순차 조회
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 1단계: 사용자 정보 조회 (Blocking)</span>
</span></span><span class=line><span class=cl>    <span class=n>user_info</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;http://user-service/</span><span class=si>{</span><span class=n>user_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 2단계: 주문 정보 조회 (Blocking)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_info</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;http://order-service/</span><span class=si>{</span><span class=n>user_info</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 3단계: 배송 상태 조회 (Blocking)</span>
</span></span><span class=line><span class=cl>    <span class=n>delivery_info</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;http://delivery-service/</span><span class=si>{</span><span class=n>order_info</span><span class=p>[</span><span class=s1>&#39;tracking_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;user&#34;</span><span class=p>:</span> <span class=n>user_info</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;order&#34;</span><span class=p>:</span> <span class=n>order_info</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;delivery&#34;</span><span class=p>:</span> <span class=n>delivery_info</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Flask 실행</span>
</span></span><span class=line><span class=cl><span class=c1># $ flask run</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=실습-예제-주문-처리-시스템에서-재고-확인--결제-처리--배송-준비의-순차적-과정>실습 예제: 주문 처리 시스템에서 재고 확인 → 결제 처리 → 배송 준비의 순차적 과정<a hidden class=anchor aria-hidden=true href=#실습-예제-주문-처리-시스템에서-재고-확인--결제-처리--배송-준비의-순차적-과정>#</a></h5><p><strong>학습 목표</strong>: 동기 실행의 기본 개념과 블로킹 특성을 이해하고 실제 구현 경험 습득</p><p><strong>시나리오</strong>: 온라인 쇼핑몰의 주문 처리 시스템에서 재고 확인 → 결제 처리 → 배송 준비의 순차적 과정</p><p><strong>시스템 구성</strong>:</p><ul><li>주문 관리 서비스 (Order Service)</li><li>재고 관리 서비스 (Inventory Service)</li><li>결제 처리 서비스 (Payment Service)</li><li>배송 관리 서비스 (Shipping Service)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[고객 주문 요청] --&gt; B[주문 서비스]
    B --&gt; C[재고 확인]
    C --&gt; D[결제 처리]
    D --&gt; E[배송 준비]
    E --&gt; F[주문 완료 응답]
    
    G[데이터베이스] --&gt; C
    H[결제 게이트웨이] --&gt; D
    I[배송 시스템] --&gt; E
</pre><p><strong>Workflow</strong>:</p><ol><li>고객이 상품 주문 요청 전송</li><li>재고 확인 서비스에서 재고 수량 검증 (블로킹)</li><li>결제 서비스에서 결제 처리 (블로킹)</li><li>배송 서비스에서 배송 준비 (블로킹)</li><li>각 단계 완료 후 다음 단계 진행</li><li>모든 단계 완료 후 고객에게 완료 응답</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>동기 실행이 각 단계별 완료를 보장하여 주문 데이터 일관성 유지</li><li>재고 부족이나 결제 실패 시 이전 단계로 롤백 가능한 명확한 실행 순서 제공</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 비동기 처리로 인한 재고 초과 판매, 결제 실패 후 재고 미복구 문제</li><li><strong>도입 후</strong>: 단계별 순차 처리로 데이터 일관성 보장, 명확한 실패 지점 추적 가능</li></ul><p><strong>구현 예시</strong> (Python):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>  1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>  2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>  3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>  4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>  5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6>  6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7>  7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8>  8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9>  9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10> 10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11> 11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12> 12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13> 13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14> 14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15> 15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16> 16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17> 17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18> 18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19> 19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20> 20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21> 21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22> 22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23> 23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24> 24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25> 25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26> 26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27> 27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28> 28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29> 29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30> 30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31> 31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32> 32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33> 33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34> 34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35> 35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36> 36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37> 37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38> 38</a>
</span><span class=lnt id=hl-13-39><a class=lnlinks href=#hl-13-39> 39</a>
</span><span class=lnt id=hl-13-40><a class=lnlinks href=#hl-13-40> 40</a>
</span><span class=lnt id=hl-13-41><a class=lnlinks href=#hl-13-41> 41</a>
</span><span class=lnt id=hl-13-42><a class=lnlinks href=#hl-13-42> 42</a>
</span><span class=lnt id=hl-13-43><a class=lnlinks href=#hl-13-43> 43</a>
</span><span class=lnt id=hl-13-44><a class=lnlinks href=#hl-13-44> 44</a>
</span><span class=lnt id=hl-13-45><a class=lnlinks href=#hl-13-45> 45</a>
</span><span class=lnt id=hl-13-46><a class=lnlinks href=#hl-13-46> 46</a>
</span><span class=lnt id=hl-13-47><a class=lnlinks href=#hl-13-47> 47</a>
</span><span class=lnt id=hl-13-48><a class=lnlinks href=#hl-13-48> 48</a>
</span><span class=lnt id=hl-13-49><a class=lnlinks href=#hl-13-49> 49</a>
</span><span class=lnt id=hl-13-50><a class=lnlinks href=#hl-13-50> 50</a>
</span><span class=lnt id=hl-13-51><a class=lnlinks href=#hl-13-51> 51</a>
</span><span class=lnt id=hl-13-52><a class=lnlinks href=#hl-13-52> 52</a>
</span><span class=lnt id=hl-13-53><a class=lnlinks href=#hl-13-53> 53</a>
</span><span class=lnt id=hl-13-54><a class=lnlinks href=#hl-13-54> 54</a>
</span><span class=lnt id=hl-13-55><a class=lnlinks href=#hl-13-55> 55</a>
</span><span class=lnt id=hl-13-56><a class=lnlinks href=#hl-13-56> 56</a>
</span><span class=lnt id=hl-13-57><a class=lnlinks href=#hl-13-57> 57</a>
</span><span class=lnt id=hl-13-58><a class=lnlinks href=#hl-13-58> 58</a>
</span><span class=lnt id=hl-13-59><a class=lnlinks href=#hl-13-59> 59</a>
</span><span class=lnt id=hl-13-60><a class=lnlinks href=#hl-13-60> 60</a>
</span><span class=lnt id=hl-13-61><a class=lnlinks href=#hl-13-61> 61</a>
</span><span class=lnt id=hl-13-62><a class=lnlinks href=#hl-13-62> 62</a>
</span><span class=lnt id=hl-13-63><a class=lnlinks href=#hl-13-63> 63</a>
</span><span class=lnt id=hl-13-64><a class=lnlinks href=#hl-13-64> 64</a>
</span><span class=lnt id=hl-13-65><a class=lnlinks href=#hl-13-65> 65</a>
</span><span class=lnt id=hl-13-66><a class=lnlinks href=#hl-13-66> 66</a>
</span><span class=lnt id=hl-13-67><a class=lnlinks href=#hl-13-67> 67</a>
</span><span class=lnt id=hl-13-68><a class=lnlinks href=#hl-13-68> 68</a>
</span><span class=lnt id=hl-13-69><a class=lnlinks href=#hl-13-69> 69</a>
</span><span class=lnt id=hl-13-70><a class=lnlinks href=#hl-13-70> 70</a>
</span><span class=lnt id=hl-13-71><a class=lnlinks href=#hl-13-71> 71</a>
</span><span class=lnt id=hl-13-72><a class=lnlinks href=#hl-13-72> 72</a>
</span><span class=lnt id=hl-13-73><a class=lnlinks href=#hl-13-73> 73</a>
</span><span class=lnt id=hl-13-74><a class=lnlinks href=#hl-13-74> 74</a>
</span><span class=lnt id=hl-13-75><a class=lnlinks href=#hl-13-75> 75</a>
</span><span class=lnt id=hl-13-76><a class=lnlinks href=#hl-13-76> 76</a>
</span><span class=lnt id=hl-13-77><a class=lnlinks href=#hl-13-77> 77</a>
</span><span class=lnt id=hl-13-78><a class=lnlinks href=#hl-13-78> 78</a>
</span><span class=lnt id=hl-13-79><a class=lnlinks href=#hl-13-79> 79</a>
</span><span class=lnt id=hl-13-80><a class=lnlinks href=#hl-13-80> 80</a>
</span><span class=lnt id=hl-13-81><a class=lnlinks href=#hl-13-81> 81</a>
</span><span class=lnt id=hl-13-82><a class=lnlinks href=#hl-13-82> 82</a>
</span><span class=lnt id=hl-13-83><a class=lnlinks href=#hl-13-83> 83</a>
</span><span class=lnt id=hl-13-84><a class=lnlinks href=#hl-13-84> 84</a>
</span><span class=lnt id=hl-13-85><a class=lnlinks href=#hl-13-85> 85</a>
</span><span class=lnt id=hl-13-86><a class=lnlinks href=#hl-13-86> 86</a>
</span><span class=lnt id=hl-13-87><a class=lnlinks href=#hl-13-87> 87</a>
</span><span class=lnt id=hl-13-88><a class=lnlinks href=#hl-13-88> 88</a>
</span><span class=lnt id=hl-13-89><a class=lnlinks href=#hl-13-89> 89</a>
</span><span class=lnt id=hl-13-90><a class=lnlinks href=#hl-13-90> 90</a>
</span><span class=lnt id=hl-13-91><a class=lnlinks href=#hl-13-91> 91</a>
</span><span class=lnt id=hl-13-92><a class=lnlinks href=#hl-13-92> 92</a>
</span><span class=lnt id=hl-13-93><a class=lnlinks href=#hl-13-93> 93</a>
</span><span class=lnt id=hl-13-94><a class=lnlinks href=#hl-13-94> 94</a>
</span><span class=lnt id=hl-13-95><a class=lnlinks href=#hl-13-95> 95</a>
</span><span class=lnt id=hl-13-96><a class=lnlinks href=#hl-13-96> 96</a>
</span><span class=lnt id=hl-13-97><a class=lnlinks href=#hl-13-97> 97</a>
</span><span class=lnt id=hl-13-98><a class=lnlinks href=#hl-13-98> 98</a>
</span><span class=lnt id=hl-13-99><a class=lnlinks href=#hl-13-99> 99</a>
</span><span class=lnt id=hl-13-100><a class=lnlinks href=#hl-13-100>100</a>
</span><span class=lnt id=hl-13-101><a class=lnlinks href=#hl-13-101>101</a>
</span><span class=lnt id=hl-13-102><a class=lnlinks href=#hl-13-102>102</a>
</span><span class=lnt id=hl-13-103><a class=lnlinks href=#hl-13-103>103</a>
</span><span class=lnt id=hl-13-104><a class=lnlinks href=#hl-13-104>104</a>
</span><span class=lnt id=hl-13-105><a class=lnlinks href=#hl-13-105>105</a>
</span><span class=lnt id=hl-13-106><a class=lnlinks href=#hl-13-106>106</a>
</span><span class=lnt id=hl-13-107><a class=lnlinks href=#hl-13-107>107</a>
</span><span class=lnt id=hl-13-108><a class=lnlinks href=#hl-13-108>108</a>
</span><span class=lnt id=hl-13-109><a class=lnlinks href=#hl-13-109>109</a>
</span><span class=lnt id=hl-13-110><a class=lnlinks href=#hl-13-110>110</a>
</span><span class=lnt id=hl-13-111><a class=lnlinks href=#hl-13-111>111</a>
</span><span class=lnt id=hl-13-112><a class=lnlinks href=#hl-13-112>112</a>
</span><span class=lnt id=hl-13-113><a class=lnlinks href=#hl-13-113>113</a>
</span><span class=lnt id=hl-13-114><a class=lnlinks href=#hl-13-114>114</a>
</span><span class=lnt id=hl-13-115><a class=lnlinks href=#hl-13-115>115</a>
</span><span class=lnt id=hl-13-116><a class=lnlinks href=#hl-13-116>116</a>
</span><span class=lnt id=hl-13-117><a class=lnlinks href=#hl-13-117>117</a>
</span><span class=lnt id=hl-13-118><a class=lnlinks href=#hl-13-118>118</a>
</span><span class=lnt id=hl-13-119><a class=lnlinks href=#hl-13-119>119</a>
</span><span class=lnt id=hl-13-120><a class=lnlinks href=#hl-13-120>120</a>
</span><span class=lnt id=hl-13-121><a class=lnlinks href=#hl-13-121>121</a>
</span><span class=lnt id=hl-13-122><a class=lnlinks href=#hl-13-122>122</a>
</span><span class=lnt id=hl-13-123><a class=lnlinks href=#hl-13-123>123</a>
</span><span class=lnt id=hl-13-124><a class=lnlinks href=#hl-13-124>124</a>
</span><span class=lnt id=hl-13-125><a class=lnlinks href=#hl-13-125>125</a>
</span><span class=lnt id=hl-13-126><a class=lnlinks href=#hl-13-126>126</a>
</span><span class=lnt id=hl-13-127><a class=lnlinks href=#hl-13-127>127</a>
</span><span class=lnt id=hl-13-128><a class=lnlinks href=#hl-13-128>128</a>
</span><span class=lnt id=hl-13-129><a class=lnlinks href=#hl-13-129>129</a>
</span><span class=lnt id=hl-13-130><a class=lnlinks href=#hl-13-130>130</a>
</span><span class=lnt id=hl-13-131><a class=lnlinks href=#hl-13-131>131</a>
</span><span class=lnt id=hl-13-132><a class=lnlinks href=#hl-13-132>132</a>
</span><span class=lnt id=hl-13-133><a class=lnlinks href=#hl-13-133>133</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProcessingSystem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    동기 실행 기반 주문 처리 시스템
</span></span></span><span class=line><span class=cl><span class=s2>    - 각 단계는 이전 단계 완료 후 실행 (동기 실행의 순차성)
</span></span></span><span class=line><span class=cl><span class=s2>    - 실패 시 명확한 롤백 지점 제공 (동기 실행의 예측 가능성)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>inventory</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;laptop&#34;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> <span class=s2>&#34;phone&#34;</span><span class=p>:</span> <span class=mi>20</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_order_sync</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        동기적 주문 처리 메인 함수
</span></span></span><span class=line><span class=cl><span class=s2>        - 각 함수 호출은 이전 함수 완료 후 실행 (블로킹 방식)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>order_data</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 1단계: 재고 확인 (동기 실행 - 완료까지 대기)</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 확인 시작: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>inventory_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_check_inventory</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 확인 완료: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 2단계: 결제 처리 (이전 단계 완료 후 시작)</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;결제 처리 시작: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>payment_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_payment</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;결제 처리 완료: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 3단계: 배송 준비 (결제 완료 후 시작)</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;배송 준비 시작: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>shipping_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_shipping</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;배송 준비 완료: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 모든 단계 완료 후 최종 처리</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;주문이 성공적으로 처리되었습니다&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 동기 실행의 장점: 명확한 실패 지점 추적</span>
</span></span><span class=line><span class=cl>            <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 실패: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>, 오류: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_rollback_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;failed&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_check_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        재고 확인 - 블로킹 I/O 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=s2>        - 이 함수가 완료될 때까지 다음 단계 대기
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 데이터베이스 조회 시뮬레이션 (블로킹)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>product</span> <span class=o>=</span> <span class=n>order_data</span><span class=p>[</span><span class=s2>&#34;product&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>quantity</span> <span class=o>=</span> <span class=n>order_data</span><span class=p>[</span><span class=s2>&#34;quantity&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>inventory</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>product</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>quantity</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 부족: </span><span class=si>{</span><span class=n>product</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=c1># 재고 예약 (동기적 상태 변경)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>inventory</span><span class=p>[</span><span class=n>product</span><span class=p>]</span> <span class=o>-=</span> <span class=n>quantity</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_process_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        결제 처리 - 외부 결제 게이트웨이 호출 시뮬레이션
</span></span></span><span class=line><span class=cl><span class=s2>        - 결제 완료까지 프로그램 대기 (동기 실행)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># 결제 게이트웨이 응답 대기 (블로킹)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 결제 실패 시뮬레이션 (10% 확률)</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mf>0.1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;결제 처리 실패&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_prepare_shipping</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        배송 준비 - 배송 시스템 연동
</span></span></span><span class=line><span class=cl><span class=s2>        - 배송 정보 등록 완료까지 대기
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 배송 시스템 등록 시뮬레이션</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=n>order_data</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=n>order_id</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;shipping_prepared&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_rollback_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        주문 롤백 - 동기 실행의 명확한 실행 순서 덕분에 
</span></span></span><span class=line><span class=cl><span class=s2>        정확한 롤백 지점 파악 가능
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 롤백 시작: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 재고 복구, 결제 취소 등의 롤백 로직</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    동기 실행 시스템 테스트
</span></span></span><span class=line><span class=cl><span class=s2>    - 각 주문이 순차적으로 처리됨을 확인
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>processor</span> <span class=o>=</span> <span class=n>OrderProcessingSystem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 여러 주문 동기적 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>orders</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;ORD001&#34;</span><span class=p>,</span> <span class=s2>&#34;product&#34;</span><span class=p>:</span> <span class=s2>&#34;laptop&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;ORD002&#34;</span><span class=p>,</span> <span class=s2>&#34;product&#34;</span><span class=p>:</span> <span class=s2>&#34;phone&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;ORD003&#34;</span><span class=p>,</span> <span class=s2>&#34;product&#34;</span><span class=p>:</span> <span class=s2>&#34;laptop&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=n>orders</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 각 주문은 이전 주문 완료 후 처리 (동기 실행)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>주문 처리 시작: </span><span class=si>{</span><span class=n>order</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>processor</span><span class=o>.</span><span class=n>process_order_sync</span><span class=p>(</span><span class=n>order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;처리 결과: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;현재 재고: </span><span class=si>{</span><span class=n>processor</span><span class=o>.</span><span class=n>inventory</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=실습-예제-웹-서버에서-순차적으로-데이터-읽고-처리하고-반환하는-워크플로우>실습 예제: 웹 서버에서 순차적으로 데이터 읽고, 처리하고, 반환하는 워크플로우<a hidden class=anchor aria-hidden=true href=#실습-예제-웹-서버에서-순차적으로-데이터-읽고-처리하고-반환하는-워크플로우>#</a></h5><p><strong>학습 목표</strong>: 동기 실행 모델의 핵심 원리와 블로킹 동작을 실습으로 익힘</p><p><strong>시나리오</strong>: 웹 서버에서 순차적으로 데이터 읽고, 처리하고, 반환하는 워크플로우</p><p><strong>시스템 구성</strong>:</p><ul><li>웹 서버 (Flask 등)</li><li>데이터베이스</li><li>클라이언트</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TD
    C[Client] --&gt; S[Web Server]
    S --&gt; D[Database]
</pre><p><strong>Workflow</strong>:</p><ol><li>클라이언트가 요청 전송</li><li>서버가 데이터베이스에서 동기적으로 데이터 조회</li><li>데이터 처리 후 클라이언트에 응답</li></ol><p><strong>핵심 역할</strong>: 동기 실행이 데이터 처리 순서와 일관성 보장</p><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 병렬 처리로 순서 불명확 가능, 데이터 충돌 우려</li><li>도입 후: 명확한 순서 보장, 데이터 일관성 확보</li></ul><p><strong>구현 예시 (Python)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/process&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_data</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    동기 실행 예제: 요청받고 DB 읽고 처리 후 응답까지 선형적으로 처리
</span></span></span><span class=line><span class=cl><span class=s2>    - 각 단계가 순차적으로 끝나야 다음 단계로 진행됨
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl>    <span class=c1># DB에서 데이터 읽기 (동기적 호출)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>read_from_db</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>processed</span> <span class=o>=</span> <span class=n>do_processing</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;result&#34;</span><span class=p>:</span> <span class=n>processed</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>read_from_db</span><span class=p>(</span><span class=nb>id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 실제 DB 조회 함수 (동기적 처리)</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>do_processing</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 데이터 처리 함수</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=실제-도입-사례의-코드-구현>실제 도입 사례의 코드 구현<a hidden class=anchor aria-hidden=true href=#실제-도입-사례의-코드-구현>#</a></h4><h5 id=은행-계좌-이체-시스템>은행 계좌 이체 시스템<a hidden class=anchor aria-hidden=true href=#은행-계좌-이체-시스템>#</a></h5><p><strong>사례 선정</strong>: 은행 계좌 이체 시스템</p><p><strong>비즈니스 배경</strong>:</p><ul><li>일일 수백만 건의 계좌 이체 처리 필요</li><li>금융 거래의 정확성과 일관성이 최우선</li><li>동시 거래로 인한 잔액 오류 방지 필수</li></ul><p><strong>기술적 요구사항</strong>:</p><ul><li>출금과 입금의 원자적 처리</li><li>계좌 잔액 일관성 보장</li><li>거래 내역 정확한 기록</li><li>실패 시 완전한 롤백</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>계좌 관리 서비스 (Account Service)</li><li>거래 처리 엔진 (Transaction Engine)</li><li>감사 로깅 시스템 (Audit System)</li><li>알림 서비스 (Notification Service)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    subgraph &#34;KB국민은행 이체 시스템&#34;
        A[이체 요청] --&gt; B[거래 검증]
        B --&gt; C[출금 계좌 잠금]
        C --&gt; D[잔액 확인]
        D --&gt; E[출금 처리]
        E --&gt; F[입금 처리]
        F --&gt; G[거래 기록]
        G --&gt; H[계좌 잠금 해제]
        H --&gt; I[고객 알림]
        I --&gt; J[이체 완료]
    end
    
    subgraph &#34;데이터베이스&#34;
        K[계좌 테이블] 
        L[거래 내역 테이블]
        M[감사 로그 테이블]
    end
    
    C --&gt; K
    E --&gt; K
    F --&gt; K
    G --&gt; L
    G --&gt; M
</pre><p><strong>Workflow</strong>:</p><ol><li>고객 이체 요청 수신</li><li>계좌 정보 및 한도 검증 (동기 처리)</li><li>출금 계좌 레코드 락 설정</li><li>잔액 확인 및 출금 처리 (원자적 연산)</li><li>입금 계좌 입금 처리</li><li>거래 내역 및 감사 로그 기록</li><li>계좌 락 해제</li><li>고객 알림 전송</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>동기 실행으로 각 단계의 완료를 보장하여 거래 정확성 확보</li><li>순차적 처리로 동시 거래 시 발생할 수 있는 레이스 컨디션 방지</li><li>명확한 실행 순서로 장애 시 정확한 롤백 지점 파악</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 비동기 처리로 인한 잔액 불일치, 중복 거래 발생 위험</li><li><strong>도입 후</strong>: 거래 정확성 99.99%, 잔액 불일치 사고 제로, 감사 추적성 완벽</li></ul><p><strong>구현 예시</strong> (Java Spring):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>  1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>  2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>  3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>  4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>  5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6>  6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7>  7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8>  8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9>  9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10> 10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11> 11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12> 12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13> 13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14> 14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15> 15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16> 16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17> 17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18> 18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19> 19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20> 20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21> 21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22> 22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23> 23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24> 24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25> 25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26> 26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27> 27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28> 28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29> 29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30> 30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31> 31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32> 32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33> 33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34> 34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35> 35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36> 36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37> 37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38> 38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39> 39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40> 40</a>
</span><span class=lnt id=hl-17-41><a class=lnlinks href=#hl-17-41> 41</a>
</span><span class=lnt id=hl-17-42><a class=lnlinks href=#hl-17-42> 42</a>
</span><span class=lnt id=hl-17-43><a class=lnlinks href=#hl-17-43> 43</a>
</span><span class=lnt id=hl-17-44><a class=lnlinks href=#hl-17-44> 44</a>
</span><span class=lnt id=hl-17-45><a class=lnlinks href=#hl-17-45> 45</a>
</span><span class=lnt id=hl-17-46><a class=lnlinks href=#hl-17-46> 46</a>
</span><span class=lnt id=hl-17-47><a class=lnlinks href=#hl-17-47> 47</a>
</span><span class=lnt id=hl-17-48><a class=lnlinks href=#hl-17-48> 48</a>
</span><span class=lnt id=hl-17-49><a class=lnlinks href=#hl-17-49> 49</a>
</span><span class=lnt id=hl-17-50><a class=lnlinks href=#hl-17-50> 50</a>
</span><span class=lnt id=hl-17-51><a class=lnlinks href=#hl-17-51> 51</a>
</span><span class=lnt id=hl-17-52><a class=lnlinks href=#hl-17-52> 52</a>
</span><span class=lnt id=hl-17-53><a class=lnlinks href=#hl-17-53> 53</a>
</span><span class=lnt id=hl-17-54><a class=lnlinks href=#hl-17-54> 54</a>
</span><span class=lnt id=hl-17-55><a class=lnlinks href=#hl-17-55> 55</a>
</span><span class=lnt id=hl-17-56><a class=lnlinks href=#hl-17-56> 56</a>
</span><span class=lnt id=hl-17-57><a class=lnlinks href=#hl-17-57> 57</a>
</span><span class=lnt id=hl-17-58><a class=lnlinks href=#hl-17-58> 58</a>
</span><span class=lnt id=hl-17-59><a class=lnlinks href=#hl-17-59> 59</a>
</span><span class=lnt id=hl-17-60><a class=lnlinks href=#hl-17-60> 60</a>
</span><span class=lnt id=hl-17-61><a class=lnlinks href=#hl-17-61> 61</a>
</span><span class=lnt id=hl-17-62><a class=lnlinks href=#hl-17-62> 62</a>
</span><span class=lnt id=hl-17-63><a class=lnlinks href=#hl-17-63> 63</a>
</span><span class=lnt id=hl-17-64><a class=lnlinks href=#hl-17-64> 64</a>
</span><span class=lnt id=hl-17-65><a class=lnlinks href=#hl-17-65> 65</a>
</span><span class=lnt id=hl-17-66><a class=lnlinks href=#hl-17-66> 66</a>
</span><span class=lnt id=hl-17-67><a class=lnlinks href=#hl-17-67> 67</a>
</span><span class=lnt id=hl-17-68><a class=lnlinks href=#hl-17-68> 68</a>
</span><span class=lnt id=hl-17-69><a class=lnlinks href=#hl-17-69> 69</a>
</span><span class=lnt id=hl-17-70><a class=lnlinks href=#hl-17-70> 70</a>
</span><span class=lnt id=hl-17-71><a class=lnlinks href=#hl-17-71> 71</a>
</span><span class=lnt id=hl-17-72><a class=lnlinks href=#hl-17-72> 72</a>
</span><span class=lnt id=hl-17-73><a class=lnlinks href=#hl-17-73> 73</a>
</span><span class=lnt id=hl-17-74><a class=lnlinks href=#hl-17-74> 74</a>
</span><span class=lnt id=hl-17-75><a class=lnlinks href=#hl-17-75> 75</a>
</span><span class=lnt id=hl-17-76><a class=lnlinks href=#hl-17-76> 76</a>
</span><span class=lnt id=hl-17-77><a class=lnlinks href=#hl-17-77> 77</a>
</span><span class=lnt id=hl-17-78><a class=lnlinks href=#hl-17-78> 78</a>
</span><span class=lnt id=hl-17-79><a class=lnlinks href=#hl-17-79> 79</a>
</span><span class=lnt id=hl-17-80><a class=lnlinks href=#hl-17-80> 80</a>
</span><span class=lnt id=hl-17-81><a class=lnlinks href=#hl-17-81> 81</a>
</span><span class=lnt id=hl-17-82><a class=lnlinks href=#hl-17-82> 82</a>
</span><span class=lnt id=hl-17-83><a class=lnlinks href=#hl-17-83> 83</a>
</span><span class=lnt id=hl-17-84><a class=lnlinks href=#hl-17-84> 84</a>
</span><span class=lnt id=hl-17-85><a class=lnlinks href=#hl-17-85> 85</a>
</span><span class=lnt id=hl-17-86><a class=lnlinks href=#hl-17-86> 86</a>
</span><span class=lnt id=hl-17-87><a class=lnlinks href=#hl-17-87> 87</a>
</span><span class=lnt id=hl-17-88><a class=lnlinks href=#hl-17-88> 88</a>
</span><span class=lnt id=hl-17-89><a class=lnlinks href=#hl-17-89> 89</a>
</span><span class=lnt id=hl-17-90><a class=lnlinks href=#hl-17-90> 90</a>
</span><span class=lnt id=hl-17-91><a class=lnlinks href=#hl-17-91> 91</a>
</span><span class=lnt id=hl-17-92><a class=lnlinks href=#hl-17-92> 92</a>
</span><span class=lnt id=hl-17-93><a class=lnlinks href=#hl-17-93> 93</a>
</span><span class=lnt id=hl-17-94><a class=lnlinks href=#hl-17-94> 94</a>
</span><span class=lnt id=hl-17-95><a class=lnlinks href=#hl-17-95> 95</a>
</span><span class=lnt id=hl-17-96><a class=lnlinks href=#hl-17-96> 96</a>
</span><span class=lnt id=hl-17-97><a class=lnlinks href=#hl-17-97> 97</a>
</span><span class=lnt id=hl-17-98><a class=lnlinks href=#hl-17-98> 98</a>
</span><span class=lnt id=hl-17-99><a class=lnlinks href=#hl-17-99> 99</a>
</span><span class=lnt id=hl-17-100><a class=lnlinks href=#hl-17-100>100</a>
</span><span class=lnt id=hl-17-101><a class=lnlinks href=#hl-17-101>101</a>
</span><span class=lnt id=hl-17-102><a class=lnlinks href=#hl-17-102>102</a>
</span><span class=lnt id=hl-17-103><a class=lnlinks href=#hl-17-103>103</a>
</span><span class=lnt id=hl-17-104><a class=lnlinks href=#hl-17-104>104</a>
</span><span class=lnt id=hl-17-105><a class=lnlinks href=#hl-17-105>105</a>
</span><span class=lnt id=hl-17-106><a class=lnlinks href=#hl-17-106>106</a>
</span><span class=lnt id=hl-17-107><a class=lnlinks href=#hl-17-107>107</a>
</span><span class=lnt id=hl-17-108><a class=lnlinks href=#hl-17-108>108</a>
</span><span class=lnt id=hl-17-109><a class=lnlinks href=#hl-17-109>109</a>
</span><span class=lnt id=hl-17-110><a class=lnlinks href=#hl-17-110>110</a>
</span><span class=lnt id=hl-17-111><a class=lnlinks href=#hl-17-111>111</a>
</span><span class=lnt id=hl-17-112><a class=lnlinks href=#hl-17-112>112</a>
</span><span class=lnt id=hl-17-113><a class=lnlinks href=#hl-17-113>113</a>
</span><span class=lnt id=hl-17-114><a class=lnlinks href=#hl-17-114>114</a>
</span><span class=lnt id=hl-17-115><a class=lnlinks href=#hl-17-115>115</a>
</span><span class=lnt id=hl-17-116><a class=lnlinks href=#hl-17-116>116</a>
</span><span class=lnt id=hl-17-117><a class=lnlinks href=#hl-17-117>117</a>
</span><span class=lnt id=hl-17-118><a class=lnlinks href=#hl-17-118>118</a>
</span><span class=lnt id=hl-17-119><a class=lnlinks href=#hl-17-119>119</a>
</span><span class=lnt id=hl-17-120><a class=lnlinks href=#hl-17-120>120</a>
</span><span class=lnt id=hl-17-121><a class=lnlinks href=#hl-17-121>121</a>
</span><span class=lnt id=hl-17-122><a class=lnlinks href=#hl-17-122>122</a>
</span><span class=lnt id=hl-17-123><a class=lnlinks href=#hl-17-123>123</a>
</span><span class=lnt id=hl-17-124><a class=lnlinks href=#hl-17-124>124</a>
</span><span class=lnt id=hl-17-125><a class=lnlinks href=#hl-17-125>125</a>
</span><span class=lnt id=hl-17-126><a class=lnlinks href=#hl-17-126>126</a>
</span><span class=lnt id=hl-17-127><a class=lnlinks href=#hl-17-127>127</a>
</span><span class=lnt id=hl-17-128><a class=lnlinks href=#hl-17-128>128</a>
</span><span class=lnt id=hl-17-129><a class=lnlinks href=#hl-17-129>129</a>
</span><span class=lnt id=hl-17-130><a class=lnlinks href=#hl-17-130>130</a>
</span><span class=lnt id=hl-17-131><a class=lnlinks href=#hl-17-131>131</a>
</span><span class=lnt id=hl-17-132><a class=lnlinks href=#hl-17-132>132</a>
</span><span class=lnt id=hl-17-133><a class=lnlinks href=#hl-17-133>133</a>
</span><span class=lnt id=hl-17-134><a class=lnlinks href=#hl-17-134>134</a>
</span><span class=lnt id=hl-17-135><a class=lnlinks href=#hl-17-135>135</a>
</span><span class=lnt id=hl-17-136><a class=lnlinks href=#hl-17-136>136</a>
</span><span class=lnt id=hl-17-137><a class=lnlinks href=#hl-17-137>137</a>
</span><span class=lnt id=hl-17-138><a class=lnlinks href=#hl-17-138>138</a>
</span><span class=lnt id=hl-17-139><a class=lnlinks href=#hl-17-139>139</a>
</span><span class=lnt id=hl-17-140><a class=lnlinks href=#hl-17-140>140</a>
</span><span class=lnt id=hl-17-141><a class=lnlinks href=#hl-17-141>141</a>
</span><span class=lnt id=hl-17-142><a class=lnlinks href=#hl-17-142>142</a>
</span><span class=lnt id=hl-17-143><a class=lnlinks href=#hl-17-143>143</a>
</span><span class=lnt id=hl-17-144><a class=lnlinks href=#hl-17-144>144</a>
</span><span class=lnt id=hl-17-145><a class=lnlinks href=#hl-17-145>145</a>
</span><span class=lnt id=hl-17-146><a class=lnlinks href=#hl-17-146>146</a>
</span><span class=lnt id=hl-17-147><a class=lnlinks href=#hl-17-147>147</a>
</span><span class=lnt id=hl-17-148><a class=lnlinks href=#hl-17-148>148</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AccountTransferService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>AccountRepository</span><span class=w> </span><span class=n>accountRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>TransactionRepository</span><span class=w> </span><span class=n>transactionRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>AuditService</span><span class=w> </span><span class=n>auditService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 동기 방식 계좌 이체 처리
</span></span></span><span class=line><span class=cl><span class=cm>     * - 모든 단계가 순차적으로 실행됨 (동기 실행의 핵심)
</span></span></span><span class=line><span class=cl><span class=cm>     * - @Transactional로 원자성 보장
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>TransferResult</span><span class=w> </span><span class=nf>transferMoney</span><span class=p>(</span><span class=n>TransferRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>transactionId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>generateTransactionId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 1단계: 거래 유효성 검증 (동기 처리 - 완료까지 대기)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>validateTransfer</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>auditService</span><span class=p>.</span><span class=na>logStart</span><span class=p>(</span><span class=n>transactionId</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 2단계: 계좌 잠금 및 잔액 확인 (데드락 방지를 위한 순서 보장)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Account</span><span class=w> </span><span class=n>fromAccount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lockAndGetAccount</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getFromAccountId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Account</span><span class=w> </span><span class=n>toAccount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lockAndGetAccount</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getToAccountId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 3단계: 잔액 확인 (동기 실행으로 정확한 시점의 잔액 확인)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>fromAccount</span><span class=p>.</span><span class=na>getBalance</span><span class=p>().</span><span class=na>compareTo</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>())</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InsufficientBalanceException</span><span class=p>(</span><span class=s>&#34;잔액 부족&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 4단계: 출금 처리 (동기적 상태 변경)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>newFromBalance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fromAccount</span><span class=p>.</span><span class=na>getBalance</span><span class=p>().</span><span class=na>subtract</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>fromAccount</span><span class=p>.</span><span class=na>setBalance</span><span class=p>(</span><span class=n>newFromBalance</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>accountRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>fromAccount</span><span class=p>);</span><span class=w>  </span><span class=c1>// 즉시 반영 (동기 I/O)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 5단계: 입금 처리 (출금 완료 후 진행)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>newToBalance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>toAccount</span><span class=p>.</span><span class=na>getBalance</span><span class=p>().</span><span class=na>add</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>toAccount</span><span class=p>.</span><span class=na>setBalance</span><span class=p>(</span><span class=n>newToBalance</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>accountRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>toAccount</span><span class=p>);</span><span class=w>  </span><span class=c1>// 즉시 반영</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 6단계: 거래 내역 기록 (모든 계좌 변경 완료 후)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Transaction</span><span class=w> </span><span class=n>transaction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Transaction</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>transactionId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>request</span><span class=p>.</span><span class=na>getFromAccountId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>request</span><span class=p>.</span><span class=na>getToAccountId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>TransactionStatus</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transactionRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>transaction</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 7단계: 감사 로그 기록 (거래 완료 후)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>auditService</span><span class=p>.</span><span class=na>logCompletion</span><span class=p>(</span><span class=n>transactionId</span><span class=p>,</span><span class=w> </span><span class=n>fromAccount</span><span class=p>,</span><span class=w> </span><span class=n>toAccount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 8단계: 알림 전송 (모든 처리 완료 후)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>sendNotification</span><span class=p>(</span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>transactionId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransferResult</span><span class=p>(</span><span class=n>transactionId</span><span class=p>,</span><span class=w> </span><span class=s>&#34;SUCCESS&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;이체가 완료되었습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 동기 실행의 장점: 명확한 실패 지점과 일관된 상태</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>auditService</span><span class=p>.</span><span class=na>logFailure</span><span class=p>(</span><span class=n>transactionId</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransferException</span><span class=p>(</span><span class=s>&#34;이체 처리 실패: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 계좌 잠금 및 조회 - 동시성 제어
</span></span></span><span class=line><span class=cl><span class=cm>     * - 동기 실행으로 락 획득 순서 보장
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Lock</span><span class=p>(</span><span class=n>LockModeType</span><span class=p>.</span><span class=na>PESSIMISTIC_WRITE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=nf>lockAndGetAccount</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>accountId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 데이터베이스 락 획득까지 대기 (블로킹)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>accountRepository</span><span class=p>.</span><span class=na>findByAccountId</span><span class=p>(</span><span class=n>accountId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AccountNotFoundException</span><span class=p>(</span><span class=s>&#34;계좌를 찾을 수 없습니다&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 거래 유효성 검증
</span></span></span><span class=line><span class=cl><span class=cm>     * - 각 검증은 이전 검증 완료 후 실행
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>validateTransfer</span><span class=p>(</span><span class=n>TransferRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 계좌 존재 여부 확인 (동기 DB 조회)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>accountRepository</span><span class=p>.</span><span class=na>existsByAccountId</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getFromAccountId</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AccountNotFoundException</span><span class=p>(</span><span class=s>&#34;출금 계좌가 존재하지 않습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>accountRepository</span><span class=p>.</span><span class=na>existsByAccountId</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getToAccountId</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AccountNotFoundException</span><span class=p>(</span><span class=s>&#34;입금 계좌가 존재하지 않습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 한도 확인 (동기 처리)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>().</span><span class=na>compareTo</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>BigDecimal</span><span class=p>(</span><span class=s>&#34;10000000&#34;</span><span class=p>))</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TransferLimitExceededException</span><span class=p>(</span><span class=s>&#34;이체 한도를 초과했습니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 계좌 상태 확인 (순차 검증)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Account</span><span class=w> </span><span class=n>fromAccount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>accountRepository</span><span class=p>.</span><span class=na>findByAccountId</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getFromAccountId</span><span class=p>()).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>fromAccount</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>AccountStatus</span><span class=p>.</span><span class=na>ACTIVE</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AccountInactiveException</span><span class=p>(</span><span class=s>&#34;출금 계좌가 비활성 상태입니다&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 알림 전송 - 모든 거래 완료 후 실행
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendNotification</span><span class=p>(</span><span class=n>TransferRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>transactionId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// SMS 발송 (동기 처리)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>smsService</span><span class=p>.</span><span class=na>sendTransferNotification</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>.</span><span class=na>getFromAccountId</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>.</span><span class=na>getAmount</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transactionId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 이메일 발송 (SMS 완료 후)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>emailService</span><span class=p>.</span><span class=na>sendTransferConfirmation</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>.</span><span class=na>getFromAccountId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transactionId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 거래 요청 DTO
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TransferRequest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>fromAccountId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>toAccountId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>amount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>description</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 거래 결과 DTO  
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TransferResult</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>transactionId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li><strong>성능 개선</strong>: 거래 처리 정확도 99.99% → 99.999% 향상</li><li><strong>운영 효율성</strong>: 장애 발생 시 롤백 시간 10 분 → 2 분으로 단축</li><li><strong>비용 절감</strong>: 거래 오류로 인한 고객 보상 비용 연간 50 억 → 5 억으로 감소</li></ul><h5 id=빌드-파이프라인-동기-실행>빌드 파이프라인 동기 실행<a hidden class=anchor aria-hidden=true href=#빌드-파이프라인-동기-실행>#</a></h5><p><strong>사례 선정</strong>: GitHub Actions 의 빌드 파이프라인 동기 실행</p><p><strong>비즈니스 배경</strong>: 소프트웨어 빌드, 테스트, 배포를 순차적으로 실행하여 실패 발생 시 조기 종료 및 디버깅을 용이하게 함</p><p><strong>기술적 요구사항</strong>:</p><ul><li>단계별 실패 시 종료 (Fail Fast)</li><li>실행 순서 보장</li><li>의존성 기반 실행 흐름 정의</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>GitHub Actions Runner</li><li>빌드 → 테스트 → 배포 순으로 Job 실행</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TD
    CI/CD --&gt; Build
    Build --&gt; Test
    Test --&gt; Deploy
</pre><p><strong>Workflow</strong>:</p><ol><li>커밋 발생 → Actions 트리거</li><li>빌드 (Job A) 성공 시 테스트 (Job B) 실행</li><li>테스트 성공 시 배포 (Job C) 실행</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>각 Job 은 이전 단계의 성공을 전제로 실행됨</li><li>오류 추적을 단순화하며, 순차 실행을 통한 상태 예측 가능</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li>도입 전: 병렬 실행 중 의존 관계 오류 발생 가능성 존재</li><li>도입 후: 예측 가능한 순서 보장, 에러 관리 효율 증가</li></ul><p><strong>구현 예시</strong> (GitHub Actions YAML):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18>18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19>19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20>20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21>21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22>22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23>23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24>24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25>25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>CI Pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>push]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build App</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>npm run build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Run Tests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>npm test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy to Production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>./deploy.sh</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li>성능 개선: 빌드 실패 시 이후 작업 불필요 → 리소스 낭비 방지</li><li>운영 효율성: 명확한 로그 추적, 디버깅 용이</li><li>비용 절감: 병렬 실행 대비 필요 자원 최소화</li></ul><h5 id=전자상거래-결제-처리-api>전자상거래 결제 처리 API<a hidden class=anchor aria-hidden=true href=#전자상거래-결제-처리-api>#</a></h5><p><strong>사례 선정</strong>: <strong>전자상거래 결제 처리 API</strong> (E-Commerce Payment Processing API)</p><p><strong>비즈니스 배경</strong>: 전자상거래 플랫폼은 **결제 단계 (Payment Stage)**에서 <strong>데이터 무결성 (Data Integrity)</strong> 과 <strong>순차 실행 (Order Guarantee)</strong> 이 반드시 보장되어야 한다. 결제 승인, 결제 금액 차감, 영수증 발급까지의 과정이 하나라도 실패하면 전체 결제를 취소해야 하므로, <strong>동기 실행</strong>이 필수이다.</p><p><strong>기술적 요구사항</strong>:</p><ul><li>하나의 결제 요청이 온전히 끝날 때까지 다른 결제 흐름이 해당 트랜잭션에 개입하지 않도록 설계</li><li>결제 승인 (Approve) → 결제 기록 저장 (Record) → 영수증 생성 (Receipt) 순서 보장</li><li>실패 시 전체 취소 (Rollback)</li></ul><p><strong>시스템 구성</strong>:</p><ul><li>API Gateway (요청 라우팅 및 보안)</li><li>Payment Service (결제 로직, 동기 실행)</li><li>Database (결제 기록 저장, 트랜잭션 관리)</li><li>Receipt Service (영수증 발급)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph LR
    C[Client] --&gt; G[API Gateway]
    G --&gt; P[Payment Service]
    P --&gt;|Sync DB Transaction| D[(Database)]
    P --&gt; R[Receipt Service]
</pre><p><strong>Workflow</strong>:</p><ol><li>클라이언트가 결제 요청 (Payment Request) 전송</li><li>API Gateway 가 요청을 Payment Service 로 전달</li><li>Payment Service 에서 결제 승인 진행 (결제사 API 동기 호출)</li><li>승인 성공 시 DB 에 동기적으로 기록</li><li>결제 완료 후 영수증 생성 및 반환</li><li>중간 단계 실패 시 모든 단계 롤백</li></ol><p><strong>핵심 역할</strong>:</p><ul><li>동기 실행이 <strong>승인 → 기록 → 영수증 발급</strong>의 절대적 순서를 보장</li><li>결제 실패 시 데이터 불일치 (Data Inconsistency) 방지</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>도입 전</strong>: 병렬 호출로 인해 승인 처리 전 영수증 발급 시도 가능, 데이터 불일치 위험</li><li><strong>도입 후</strong>: 모든 작업이 순차적으로 실행되어 무결성과 순서 보장</li></ul><p><strong>구현 예시 (Python, Flask)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17>17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18>18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19>19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20>20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21>21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22>22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23>23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24>24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25>25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26>26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27>27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28>28</a>
</span><span class=lnt id=hl-21-29><a class=lnlinks href=#hl-21-29>29</a>
</span><span class=lnt id=hl-21-30><a class=lnlinks href=#hl-21-30>30</a>
</span><span class=lnt id=hl-21-31><a class=lnlinks href=#hl-21-31>31</a>
</span><span class=lnt id=hl-21-32><a class=lnlinks href=#hl-21-32>32</a>
</span><span class=lnt id=hl-21-33><a class=lnlinks href=#hl-21-33>33</a>
</span><span class=lnt id=hl-21-34><a class=lnlinks href=#hl-21-34>34</a>
</span><span class=lnt id=hl-21-35><a class=lnlinks href=#hl-21-35>35</a>
</span><span class=lnt id=hl-21-36><a class=lnlinks href=#hl-21-36>36</a>
</span><span class=lnt id=hl-21-37><a class=lnlinks href=#hl-21-37>37</a>
</span><span class=lnt id=hl-21-38><a class=lnlinks href=#hl-21-38>38</a>
</span><span class=lnt id=hl-21-39><a class=lnlinks href=#hl-21-39>39</a>
</span><span class=lnt id=hl-21-40><a class=lnlinks href=#hl-21-40>40</a>
</span><span class=lnt id=hl-21-41><a class=lnlinks href=#hl-21-41>41</a>
</span><span class=lnt id=hl-21-42><a class=lnlinks href=#hl-21-42>42</a>
</span><span class=lnt id=hl-21-43><a class=lnlinks href=#hl-21-43>43</a>
</span><span class=lnt id=hl-21-44><a class=lnlinks href=#hl-21-44>44</a>
</span><span class=lnt id=hl-21-45><a class=lnlinks href=#hl-21-45>45</a>
</span><span class=lnt id=hl-21-46><a class=lnlinks href=#hl-21-46>46</a>
</span><span class=lnt id=hl-21-47><a class=lnlinks href=#hl-21-47>47</a>
</span><span class=lnt id=hl-21-48><a class=lnlinks href=#hl-21-48>48</a>
</span><span class=lnt id=hl-21-49><a class=lnlinks href=#hl-21-49>49</a>
</span><span class=lnt id=hl-21-50><a class=lnlinks href=#hl-21-50>50</a>
</span><span class=lnt id=hl-21-51><a class=lnlinks href=#hl-21-51>51</a>
</span><span class=lnt id=hl-21-52><a class=lnlinks href=#hl-21-52>52</a>
</span><span class=lnt id=hl-21-53><a class=lnlinks href=#hl-21-53>53</a>
</span><span class=lnt id=hl-21-54><a class=lnlinks href=#hl-21-54>54</a>
</span><span class=lnt id=hl-21-55><a class=lnlinks href=#hl-21-55>55</a>
</span><span class=lnt id=hl-21-56><a class=lnlinks href=#hl-21-56>56</a>
</span><span class=lnt id=hl-21-57><a class=lnlinks href=#hl-21-57>57</a>
</span><span class=lnt id=hl-21-58><a class=lnlinks href=#hl-21-58>58</a>
</span><span class=lnt id=hl-21-59><a class=lnlinks href=#hl-21-59>59</a>
</span><span class=lnt id=hl-21-60><a class=lnlinks href=#hl-21-60>60</a>
</span><span class=lnt id=hl-21-61><a class=lnlinks href=#hl-21-61>61</a>
</span><span class=lnt id=hl-21-62><a class=lnlinks href=#hl-21-62>62</a>
</span><span class=lnt id=hl-21-63><a class=lnlinks href=#hl-21-63>63</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>approve_payment</span><span class=p>(</span><span class=n>payment_info</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    결제 승인 API 동기 호출
</span></span></span><span class=line><span class=cl><span class=s2>    - 이 단계가 성공해야 다음 단계로 넘어감
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;결제를 승인 중… </span><span class=si>{</span><span class=n>payment_info</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span> <span class=s2>&#34;transaction_id&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>save_payment_record</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>,</span> <span class=n>amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    결제 기록 저장 (동기 DB 호출)
</span></span></span><span class=line><span class=cl><span class=s2>    - 실패 시 예외 발생 → 롤백 처리
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;DB에 결제 기록 저장 중… TXN: </span><span class=si>{</span><span class=n>transaction_id</span><span class=si>}</span><span class=s2>, 금액: </span><span class=si>{</span><span class=n>amount</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_receipt</span><span class=p>(</span><span class=n>transaction_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    영수증 생성
</span></span></span><span class=line><span class=cl><span class=s2>    - 반드시 결제 승인과 저장이 끝난 후 실행
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>receipt_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;영수증 생성 완료: </span><span class=si>{</span><span class=n>receipt_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;receipt_id&#34;</span><span class=p>:</span> <span class=n>receipt_id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/payment&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_payment</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    결제 전체 플로우 - 동기 실행 방식
</span></span></span><span class=line><span class=cl><span class=s2>    결제 승인 → DB 기록 → 영수증 생성 순서로 진행
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 1. 결제 승인</span>
</span></span><span class=line><span class=cl>        <span class=n>approval</span> <span class=o>=</span> <span class=n>approve_payment</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>approval</span><span class=p>[</span><span class=s2>&#34;status&#34;</span><span class=p>]</span> <span class=o>!=</span> <span class=s2>&#34;success&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;결제 승인 실패&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 2. 결제 기록 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>save_payment_record</span><span class=p>(</span><span class=n>approval</span><span class=p>[</span><span class=s2>&#34;transaction_id&#34;</span><span class=p>],</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;amount&#34;</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;결제 기록 저장 실패&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 3. 영수증 생성</span>
</span></span><span class=line><span class=cl>        <span class=n>receipt</span> <span class=o>=</span> <span class=n>generate_receipt</span><span class=p>(</span><span class=n>approval</span><span class=p>[</span><span class=s2>&#34;transaction_id&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;transaction_id&#34;</span><span class=p>:</span> <span class=n>approval</span><span class=p>[</span><span class=s2>&#34;transaction_id&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;receipt&#34;</span><span class=p>:</span> <span class=n>receipt</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실패 시 롤백 처리 (실제 구현에서는 DB 트랜잭션 롤백)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;오류 발생, 롤백 실행: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;failure&#34;</span><span class=p>,</span> <span class=s2>&#34;reason&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}),</span> <span class=mi>500</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>성과 분석</strong>:</p><ul><li><strong>성능 개선</strong>: 결제 승인 - 저장 - 영수증 발급 순서 보장 → 재처리율 30% 감소</li><li><strong>운영 효율성</strong>: 오류 전파 및 데이터 불일치 감소 → 운영팀 처리 시간 단축</li><li><strong>비용 절감</strong>: 잘못된 결제 처리 건수 감소로 고객 지원 인력 대응 비용 절약</li></ul><h5 id=전자상거래-주문-처리-시스템>전자상거래 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#전자상거래-주문-처리-시스템>#</a></h5><p><strong>시나리오</strong>: 전자상거래 주문 처리 시스템에서 주문 데이터 검증, 재고 확인, 결제 처리, 배송 준비 과정을 순차적으로 처리</p><p><strong>시스템 구성</strong>:</p><ul><li>주문 관리 서비스 (Order Management Service)</li><li>재고 관리 시스템 (Inventory Management System)</li><li>결제 처리 시스템 (Payment Processing System)</li><li>배송 관리 시스템 (Shipping Management System)</li><li>데이터베이스 (PostgreSQL)</li><li>로그 시스템 (Logging System)</li></ul><p><strong>시스템 구성 다이어그램</strong>:</p><pre class=mermaid>graph TB
    A[고객 주문 요청] --&gt; B[주문 관리 서비스]
    B --&gt; C[주문 데이터 검증]
    C --&gt; D[재고 관리 시스템]
    D --&gt; E[재고 확인 및 예약]
    E --&gt; F[결제 처리 시스템]
    F --&gt; G[결제 승인 처리]
    G --&gt; H[배송 관리 시스템]
    H --&gt; I[배송 정보 생성]
    I --&gt; J[주문 완료 응답]
    
    B --&gt; K[주문 DB]
    D --&gt; L[재고 DB]
    F --&gt; M[결제 DB]
    H --&gt; N[배송 DB]
    
    style A fill:#e1f5fe
    style J fill:#e8f5e8
    style K,L,M,N fill:#fff3e0
</pre><p><strong>Workflow</strong>:</p><ol><li>고객으로부터 주문 요청 수신</li><li>주문 데이터 형식 및 필수 정보 검증</li><li>상품별 재고 수량 확인 및 임시 예약</li><li>결제 정보 검증 및 결제 처리 요청</li><li>결제 승인 후 재고 확정 차감</li><li>배송 정보 생성 및 물류 시스템 연동</li><li>주문 상태 업데이트 및 고객 응답</li></ol><p><strong>역할</strong>:</p><ul><li><strong>순서 보장</strong>: 재고 확인 → 결제 → 배송 순서로 처리하여 비즈니스 로직 무결성 유지</li><li><strong>데이터 일관성</strong>: 각 단계별 DB 트랜잭션으로 데이터 정합성 보장</li><li><strong>에러 처리</strong>: 각 단계별 실패 시 이전 단계 롤백 처리</li><li><strong>상태 추적</strong>: 주문 진행 상태를 명확히 추적하여 고객 서비스 품질 향상</li></ul><p><strong>유무에 따른 차이점</strong>:</p><ul><li><strong>동기 실행 적용 시</strong>: 각 단계가 완전히 완료된 후 다음 단계 진행, 데이터 무결성 보장, 에러 발생 시 명확한 지점 파악 가능</li><li><strong>동기 실행 미적용 시</strong>: 병렬 처리로 성능 향상 가능하지만 데이터 불일치 위험, 복잡한 상태 관리 필요, 에러 추적 어려움</li></ul><p><strong>구현 예시</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>  1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>  2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3>  3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4>  4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5>  5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6>  6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7>  7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8>  8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9>  9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10> 10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11> 11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12> 12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13> 13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14> 14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15> 15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16> 16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17> 17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18> 18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19> 19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20> 20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21> 21</a>
</span><span class=lnt id=hl-23-22><a class=lnlinks href=#hl-23-22> 22</a>
</span><span class=lnt id=hl-23-23><a class=lnlinks href=#hl-23-23> 23</a>
</span><span class=lnt id=hl-23-24><a class=lnlinks href=#hl-23-24> 24</a>
</span><span class=lnt id=hl-23-25><a class=lnlinks href=#hl-23-25> 25</a>
</span><span class=lnt id=hl-23-26><a class=lnlinks href=#hl-23-26> 26</a>
</span><span class=lnt id=hl-23-27><a class=lnlinks href=#hl-23-27> 27</a>
</span><span class=lnt id=hl-23-28><a class=lnlinks href=#hl-23-28> 28</a>
</span><span class=lnt id=hl-23-29><a class=lnlinks href=#hl-23-29> 29</a>
</span><span class=lnt id=hl-23-30><a class=lnlinks href=#hl-23-30> 30</a>
</span><span class=lnt id=hl-23-31><a class=lnlinks href=#hl-23-31> 31</a>
</span><span class=lnt id=hl-23-32><a class=lnlinks href=#hl-23-32> 32</a>
</span><span class=lnt id=hl-23-33><a class=lnlinks href=#hl-23-33> 33</a>
</span><span class=lnt id=hl-23-34><a class=lnlinks href=#hl-23-34> 34</a>
</span><span class=lnt id=hl-23-35><a class=lnlinks href=#hl-23-35> 35</a>
</span><span class=lnt id=hl-23-36><a class=lnlinks href=#hl-23-36> 36</a>
</span><span class=lnt id=hl-23-37><a class=lnlinks href=#hl-23-37> 37</a>
</span><span class=lnt id=hl-23-38><a class=lnlinks href=#hl-23-38> 38</a>
</span><span class=lnt id=hl-23-39><a class=lnlinks href=#hl-23-39> 39</a>
</span><span class=lnt id=hl-23-40><a class=lnlinks href=#hl-23-40> 40</a>
</span><span class=lnt id=hl-23-41><a class=lnlinks href=#hl-23-41> 41</a>
</span><span class=lnt id=hl-23-42><a class=lnlinks href=#hl-23-42> 42</a>
</span><span class=lnt id=hl-23-43><a class=lnlinks href=#hl-23-43> 43</a>
</span><span class=lnt id=hl-23-44><a class=lnlinks href=#hl-23-44> 44</a>
</span><span class=lnt id=hl-23-45><a class=lnlinks href=#hl-23-45> 45</a>
</span><span class=lnt id=hl-23-46><a class=lnlinks href=#hl-23-46> 46</a>
</span><span class=lnt id=hl-23-47><a class=lnlinks href=#hl-23-47> 47</a>
</span><span class=lnt id=hl-23-48><a class=lnlinks href=#hl-23-48> 48</a>
</span><span class=lnt id=hl-23-49><a class=lnlinks href=#hl-23-49> 49</a>
</span><span class=lnt id=hl-23-50><a class=lnlinks href=#hl-23-50> 50</a>
</span><span class=lnt id=hl-23-51><a class=lnlinks href=#hl-23-51> 51</a>
</span><span class=lnt id=hl-23-52><a class=lnlinks href=#hl-23-52> 52</a>
</span><span class=lnt id=hl-23-53><a class=lnlinks href=#hl-23-53> 53</a>
</span><span class=lnt id=hl-23-54><a class=lnlinks href=#hl-23-54> 54</a>
</span><span class=lnt id=hl-23-55><a class=lnlinks href=#hl-23-55> 55</a>
</span><span class=lnt id=hl-23-56><a class=lnlinks href=#hl-23-56> 56</a>
</span><span class=lnt id=hl-23-57><a class=lnlinks href=#hl-23-57> 57</a>
</span><span class=lnt id=hl-23-58><a class=lnlinks href=#hl-23-58> 58</a>
</span><span class=lnt id=hl-23-59><a class=lnlinks href=#hl-23-59> 59</a>
</span><span class=lnt id=hl-23-60><a class=lnlinks href=#hl-23-60> 60</a>
</span><span class=lnt id=hl-23-61><a class=lnlinks href=#hl-23-61> 61</a>
</span><span class=lnt id=hl-23-62><a class=lnlinks href=#hl-23-62> 62</a>
</span><span class=lnt id=hl-23-63><a class=lnlinks href=#hl-23-63> 63</a>
</span><span class=lnt id=hl-23-64><a class=lnlinks href=#hl-23-64> 64</a>
</span><span class=lnt id=hl-23-65><a class=lnlinks href=#hl-23-65> 65</a>
</span><span class=lnt id=hl-23-66><a class=lnlinks href=#hl-23-66> 66</a>
</span><span class=lnt id=hl-23-67><a class=lnlinks href=#hl-23-67> 67</a>
</span><span class=lnt id=hl-23-68><a class=lnlinks href=#hl-23-68> 68</a>
</span><span class=lnt id=hl-23-69><a class=lnlinks href=#hl-23-69> 69</a>
</span><span class=lnt id=hl-23-70><a class=lnlinks href=#hl-23-70> 70</a>
</span><span class=lnt id=hl-23-71><a class=lnlinks href=#hl-23-71> 71</a>
</span><span class=lnt id=hl-23-72><a class=lnlinks href=#hl-23-72> 72</a>
</span><span class=lnt id=hl-23-73><a class=lnlinks href=#hl-23-73> 73</a>
</span><span class=lnt id=hl-23-74><a class=lnlinks href=#hl-23-74> 74</a>
</span><span class=lnt id=hl-23-75><a class=lnlinks href=#hl-23-75> 75</a>
</span><span class=lnt id=hl-23-76><a class=lnlinks href=#hl-23-76> 76</a>
</span><span class=lnt id=hl-23-77><a class=lnlinks href=#hl-23-77> 77</a>
</span><span class=lnt id=hl-23-78><a class=lnlinks href=#hl-23-78> 78</a>
</span><span class=lnt id=hl-23-79><a class=lnlinks href=#hl-23-79> 79</a>
</span><span class=lnt id=hl-23-80><a class=lnlinks href=#hl-23-80> 80</a>
</span><span class=lnt id=hl-23-81><a class=lnlinks href=#hl-23-81> 81</a>
</span><span class=lnt id=hl-23-82><a class=lnlinks href=#hl-23-82> 82</a>
</span><span class=lnt id=hl-23-83><a class=lnlinks href=#hl-23-83> 83</a>
</span><span class=lnt id=hl-23-84><a class=lnlinks href=#hl-23-84> 84</a>
</span><span class=lnt id=hl-23-85><a class=lnlinks href=#hl-23-85> 85</a>
</span><span class=lnt id=hl-23-86><a class=lnlinks href=#hl-23-86> 86</a>
</span><span class=lnt id=hl-23-87><a class=lnlinks href=#hl-23-87> 87</a>
</span><span class=lnt id=hl-23-88><a class=lnlinks href=#hl-23-88> 88</a>
</span><span class=lnt id=hl-23-89><a class=lnlinks href=#hl-23-89> 89</a>
</span><span class=lnt id=hl-23-90><a class=lnlinks href=#hl-23-90> 90</a>
</span><span class=lnt id=hl-23-91><a class=lnlinks href=#hl-23-91> 91</a>
</span><span class=lnt id=hl-23-92><a class=lnlinks href=#hl-23-92> 92</a>
</span><span class=lnt id=hl-23-93><a class=lnlinks href=#hl-23-93> 93</a>
</span><span class=lnt id=hl-23-94><a class=lnlinks href=#hl-23-94> 94</a>
</span><span class=lnt id=hl-23-95><a class=lnlinks href=#hl-23-95> 95</a>
</span><span class=lnt id=hl-23-96><a class=lnlinks href=#hl-23-96> 96</a>
</span><span class=lnt id=hl-23-97><a class=lnlinks href=#hl-23-97> 97</a>
</span><span class=lnt id=hl-23-98><a class=lnlinks href=#hl-23-98> 98</a>
</span><span class=lnt id=hl-23-99><a class=lnlinks href=#hl-23-99> 99</a>
</span><span class=lnt id=hl-23-100><a class=lnlinks href=#hl-23-100>100</a>
</span><span class=lnt id=hl-23-101><a class=lnlinks href=#hl-23-101>101</a>
</span><span class=lnt id=hl-23-102><a class=lnlinks href=#hl-23-102>102</a>
</span><span class=lnt id=hl-23-103><a class=lnlinks href=#hl-23-103>103</a>
</span><span class=lnt id=hl-23-104><a class=lnlinks href=#hl-23-104>104</a>
</span><span class=lnt id=hl-23-105><a class=lnlinks href=#hl-23-105>105</a>
</span><span class=lnt id=hl-23-106><a class=lnlinks href=#hl-23-106>106</a>
</span><span class=lnt id=hl-23-107><a class=lnlinks href=#hl-23-107>107</a>
</span><span class=lnt id=hl-23-108><a class=lnlinks href=#hl-23-108>108</a>
</span><span class=lnt id=hl-23-109><a class=lnlinks href=#hl-23-109>109</a>
</span><span class=lnt id=hl-23-110><a class=lnlinks href=#hl-23-110>110</a>
</span><span class=lnt id=hl-23-111><a class=lnlinks href=#hl-23-111>111</a>
</span><span class=lnt id=hl-23-112><a class=lnlinks href=#hl-23-112>112</a>
</span><span class=lnt id=hl-23-113><a class=lnlinks href=#hl-23-113>113</a>
</span><span class=lnt id=hl-23-114><a class=lnlinks href=#hl-23-114>114</a>
</span><span class=lnt id=hl-23-115><a class=lnlinks href=#hl-23-115>115</a>
</span><span class=lnt id=hl-23-116><a class=lnlinks href=#hl-23-116>116</a>
</span><span class=lnt id=hl-23-117><a class=lnlinks href=#hl-23-117>117</a>
</span><span class=lnt id=hl-23-118><a class=lnlinks href=#hl-23-118>118</a>
</span><span class=lnt id=hl-23-119><a class=lnlinks href=#hl-23-119>119</a>
</span><span class=lnt id=hl-23-120><a class=lnlinks href=#hl-23-120>120</a>
</span><span class=lnt id=hl-23-121><a class=lnlinks href=#hl-23-121>121</a>
</span><span class=lnt id=hl-23-122><a class=lnlinks href=#hl-23-122>122</a>
</span><span class=lnt id=hl-23-123><a class=lnlinks href=#hl-23-123>123</a>
</span><span class=lnt id=hl-23-124><a class=lnlinks href=#hl-23-124>124</a>
</span><span class=lnt id=hl-23-125><a class=lnlinks href=#hl-23-125>125</a>
</span><span class=lnt id=hl-23-126><a class=lnlinks href=#hl-23-126>126</a>
</span><span class=lnt id=hl-23-127><a class=lnlinks href=#hl-23-127>127</a>
</span><span class=lnt id=hl-23-128><a class=lnlinks href=#hl-23-128>128</a>
</span><span class=lnt id=hl-23-129><a class=lnlinks href=#hl-23-129>129</a>
</span><span class=lnt id=hl-23-130><a class=lnlinks href=#hl-23-130>130</a>
</span><span class=lnt id=hl-23-131><a class=lnlinks href=#hl-23-131>131</a>
</span><span class=lnt id=hl-23-132><a class=lnlinks href=#hl-23-132>132</a>
</span><span class=lnt id=hl-23-133><a class=lnlinks href=#hl-23-133>133</a>
</span><span class=lnt id=hl-23-134><a class=lnlinks href=#hl-23-134>134</a>
</span><span class=lnt id=hl-23-135><a class=lnlinks href=#hl-23-135>135</a>
</span><span class=lnt id=hl-23-136><a class=lnlinks href=#hl-23-136>136</a>
</span><span class=lnt id=hl-23-137><a class=lnlinks href=#hl-23-137>137</a>
</span><span class=lnt id=hl-23-138><a class=lnlinks href=#hl-23-138>138</a>
</span><span class=lnt id=hl-23-139><a class=lnlinks href=#hl-23-139>139</a>
</span><span class=lnt id=hl-23-140><a class=lnlinks href=#hl-23-140>140</a>
</span><span class=lnt id=hl-23-141><a class=lnlinks href=#hl-23-141>141</a>
</span><span class=lnt id=hl-23-142><a class=lnlinks href=#hl-23-142>142</a>
</span><span class=lnt id=hl-23-143><a class=lnlinks href=#hl-23-143>143</a>
</span><span class=lnt id=hl-23-144><a class=lnlinks href=#hl-23-144>144</a>
</span><span class=lnt id=hl-23-145><a class=lnlinks href=#hl-23-145>145</a>
</span><span class=lnt id=hl-23-146><a class=lnlinks href=#hl-23-146>146</a>
</span><span class=lnt id=hl-23-147><a class=lnlinks href=#hl-23-147>147</a>
</span><span class=lnt id=hl-23-148><a class=lnlinks href=#hl-23-148>148</a>
</span><span class=lnt id=hl-23-149><a class=lnlinks href=#hl-23-149>149</a>
</span><span class=lnt id=hl-23-150><a class=lnlinks href=#hl-23-150>150</a>
</span><span class=lnt id=hl-23-151><a class=lnlinks href=#hl-23-151>151</a>
</span><span class=lnt id=hl-23-152><a class=lnlinks href=#hl-23-152>152</a>
</span><span class=lnt id=hl-23-153><a class=lnlinks href=#hl-23-153>153</a>
</span><span class=lnt id=hl-23-154><a class=lnlinks href=#hl-23-154>154</a>
</span><span class=lnt id=hl-23-155><a class=lnlinks href=#hl-23-155>155</a>
</span><span class=lnt id=hl-23-156><a class=lnlinks href=#hl-23-156>156</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderResult</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>success</span><span class=p>:</span> <span class=nb>bool</span>
</span></span><span class=line><span class=cl>    <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>details</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProcessingService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>OrderResult</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        주문을 동기적으로 처리하는 메인 함수
</span></span></span><span class=line><span class=cl><span class=s2>        각 단계는 이전 단계의 완료를 기다린 후 실행됨
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 1단계: 주문 데이터 검증</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;주문 데이터 검증 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>validation_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>validate_order_data</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>validation_result</span><span class=p>[</span><span class=s1>&#39;valid&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>OrderResult</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>validation_result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 2단계: 재고 확인 및 예약</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;재고 확인 및 예약 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>inventory_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_and_reserve_inventory</span><span class=p>(</span><span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>inventory_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>OrderResult</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>inventory_result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 3단계: 결제 처리</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;결제 처리 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>payment_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>process_payment</span><span class=p>(</span><span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;payment_info&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 재고 예약 롤백</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>rollback_inventory_reservation</span><span class=p>(</span><span class=n>inventory_result</span><span class=p>[</span><span class=s1>&#39;reservation_id&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>OrderResult</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 4단계: 배송 정보 생성</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;배송 정보 생성 시작&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>shipping_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_shipping_info</span><span class=p>(</span><span class=n>order_data</span><span class=p>[</span><span class=s1>&#39;shipping_address&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>shipping_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 결제 및 재고 롤백</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>rollback_payment</span><span class=p>(</span><span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;transaction_id&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>rollback_inventory_reservation</span><span class=p>(</span><span class=n>inventory_result</span><span class=p>[</span><span class=s1>&#39;reservation_id&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>OrderResult</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>shipping_result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 5단계: 주문 완료 처리</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>finalize_order</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;order_data&#39;</span><span class=p>:</span> <span class=n>order_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;inventory&#39;</span><span class=p>:</span> <span class=n>inventory_result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;payment&#39;</span><span class=p>:</span> <span class=n>payment_result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;shipping&#39;</span><span class=p>:</span> <span class=n>shipping_result</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 완료: </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>OrderResult</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=kc>True</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>order_id</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=s2>&#34;주문이 성공적으로 처리되었습니다.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;payment_id&#39;</span><span class=p>:</span> <span class=n>payment_result</span><span class=p>[</span><span class=s1>&#39;transaction_id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;shipping_id&#39;</span><span class=p>:</span> <span class=n>shipping_result</span><span class=p>[</span><span class=s1>&#39;shipping_id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 중 예외 발생: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>OrderResult</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;시스템 오류: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>validate_order_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;주문 데이터 검증 - 동기 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>required_fields</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>,</span> <span class=s1>&#39;items&#39;</span><span class=p>,</span> <span class=s1>&#39;payment_info&#39;</span><span class=p>,</span> <span class=s1>&#39;shipping_address&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>field</span> <span class=ow>in</span> <span class=n>required_fields</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>field</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>order_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;valid&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;필수 필드 누락: </span><span class=si>{</span><span class=n>field</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;valid&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>check_and_reserve_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=nb>list</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 확인 및 예약 - 동기 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 실제 구현에서는 데이터베이스 트랜잭션 사용</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_inventory_availability</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;product_id&#39;</span><span class=p>],</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;quantity&#39;</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;재고 부족: </span><span class=si>{</span><span class=n>item</span><span class=p>[</span><span class=s2>&#34;product_id&#34;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>reservation_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>reserve_inventory</span><span class=p>(</span><span class=n>items</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s1>&#39;reservation_id&#39;</span><span class=p>:</span> <span class=n>reservation_id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>payment_info</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결제 처리 - 동기 처리 (외부 결제 시스템 호출)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 결제 시스템 API 호출 (블로킹)</span>
</span></span><span class=line><span class=cl>        <span class=n>transaction_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>call_payment_gateway</span><span class=p>(</span><span class=n>payment_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>transaction_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s1>&#39;transaction_id&#39;</span><span class=p>:</span> <span class=n>transaction_id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=s1>&#39;결제 처리 실패&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_shipping_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>shipping_address</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;배송 정보 생성 - 동기 처리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>shipping_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_shipping_label</span><span class=p>(</span><span class=n>shipping_address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s1>&#39;shipping_id&#39;</span><span class=p>:</span> <span class=n>shipping_id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 헬퍼 메서드들 (실제 구현에서는 각각의 서비스와 연동)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>check_inventory_availability</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 재고 DB 조회</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>reserve_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>items</span><span class=p>:</span> <span class=nb>list</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 재고 예약 처리</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;RES_&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=nb>hash</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>items</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>call_payment_gateway</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>payment_info</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 외부 결제 시스템 호출</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;TXN_&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=nb>hash</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>payment_info</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_shipping_label</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>address</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 배송 라벨 생성</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;SHIP_&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=nb>hash</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>address</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>finalize_order</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_details</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 주문 정보 DB 저장</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;ORDER_&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=nb>hash</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>order_details</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>rollback_inventory_reservation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>reservation_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;재고 예약 롤백&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;재고 예약 롤백: </span><span class=si>{</span><span class=n>reservation_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>rollback_payment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>transaction_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;결제 롤백&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;결제 롤백: </span><span class=si>{</span><span class=n>transaction_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>service</span> <span class=o>=</span> <span class=n>OrderProcessingService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>order_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;customer_id&#39;</span><span class=p>:</span> <span class=s1>&#39;CUST_001&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s1>&#39;product_id&#39;</span><span class=p>:</span> <span class=s1>&#39;PROD_001&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s1>&#39;product_id&#39;</span><span class=p>:</span> <span class=s1>&#39;PROD_002&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;payment_info&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;card_number&#39;</span><span class=p>:</span> <span class=s1>&#39;****-****-****-1234&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;amount&#39;</span><span class=p>:</span> <span class=mi>50000</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;shipping_address&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;address&#39;</span><span class=p>:</span> <span class=s1>&#39;서울시 강남구&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;zip_code&#39;</span><span class=p>:</span> <span class=s1>&#39;12345&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 동기적 주문 처리</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>service</span><span class=o>.</span><span class=n>process_order</span><span class=p>(</span><span class=n>order_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;처리 결과: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=통합-및-연계-기술-분석>통합 및 연계 기술 분석<a hidden class=anchor aria-hidden=true href=#통합-및-연계-기술-분석>#</a></h4><p>동기 실행 환경에서의 통합·연계 기술은 다음 다섯 카테고리로 나뉜다.</p><ul><li><strong>메시징/이벤트 연계</strong>: 동기 처리 완료 후 비동기 이벤트 발행 (RabbitMQ, Kafka) 로 다른 서비스와 연동.</li><li><strong>데이터 성능 최적화</strong>: Redis, Memcached 를 활용한 캐싱과 DB 부하 감소, 빠른 응답 보장.</li><li><strong>인프라 확장성 및 고가용성</strong>: 로드밸런서 (HAProxy, Nginx) 로 요청 분산 및 장애 서버 자동 제외, 서비스 디스커버리와 연계.</li><li><strong>관측 가능성</strong>: Prometheus, Grafana, APM(New Relic, Datadog) 로 병목·성능 모니터링.</li><li><strong>운영/보안 통합</strong>: OAuth2, JWT 인증 서버와 동기 호출, 분산 트랜잭션 관리 (2PC, Saga), CI/CD 테스트 통합.</li></ul><table><thead><tr><th>카테고리</th><th>주요 기술</th><th>목적</th><th>예시</th><th>실무 고려사항</th></tr></thead><tbody><tr><td>메시징/이벤트 연계</td><td>RabbitMQ, Kafka</td><td>동기 처리 후 비동기 알림·이벤트 발행</td><td>결제 승인 후 영수증 발행 이벤트</td><td>트랜잭션 경계 설계 필요</td></tr><tr><td>데이터 성능 최적화</td><td>Redis, Memcached</td><td>캐싱, DB 부하 감소</td><td>사용자 세션 데이터 캐싱</td><td>TTL 관리, 캐시 일관성</td></tr><tr><td>인프라 확장성 및 고가용성</td><td>HAProxy, Nginx, Consul, Eureka</td><td>요청 분산, 장애 서버 제외, 서비스 디스커버리</td><td>API 서버 로드밸런싱</td><td>헬스 체크 주기 최적화</td></tr><tr><td>관측 가능성</td><td>Prometheus, Grafana, New Relic, Datadog</td><td>성능·병목 모니터링</td><td>API 응답 시간 대시보드</td><td>알람 임계치 설정</td></tr><tr><td>운영/보안 통합</td><td>OAuth2, JWT, 2PC, Saga, Jenkins, GitLab CI</td><td>인증·보안, 배포 자동화, 트랜잭션 관리</td><td>인증 서버 동기 호출</td><td>인증 토큰 유효성 검증, 롤백 처리</td></tr></tbody></table><h3 id=운영-및-최적화-operations--optimization>운영 및 최적화 (Operations & Optimization)<a hidden class=anchor aria-hidden=true href=#운영-및-최적화-operations--optimization>#</a></h3><h4 id=보안-및-거버넌스>보안 및 거버넌스<a hidden class=anchor aria-hidden=true href=#보안-및-거버넌스>#</a></h4><p>동기 실행 보안의 핵심은 <strong>선형 경로를 안전하게 게이팅</strong>하는 것이다.<br>외부 입력은 <strong>사전 인증/인가</strong>로 걸러내고, 요청마다 <strong>타임아웃·레이트리밋</strong>을 적용해 블로킹으로 인한 자원 고갈을 막는다.<br>민감 데이터는 <strong>TLS 등 전송 암호화</strong>와 저장 암호화를 기본값으로 하고, <strong>트랜잭션 경계</strong>에서 멱등키·중복 방지로 무결성을 확보한다.</p><p>운영·거버넌스 측면에선 <strong>감사 추적 (선형 로그·상관 ID)</strong>, <strong>변경관리·권한 분리</strong>, <strong>데이터 최소화/보유기간</strong>을 정책으로 강제한다. 도메인별로는 PCI DSS(결제), GDPR(개인정보), HIPAA(의료), ISO/IEC 27001(ISMS), NIST 800-63(신원) 의 요구사항을 참조해 <strong>표준화된 통제 세트</strong>를 구축한다.</p><table><thead><tr><th>영역</th><th>위험/이슈</th><th>고려사항</th><th>권장 방안</th><th>운영 체크리스트</th><th>관련 표준/가이드</th></tr></thead><tbody><tr><td>자원 고갈 (DoS)</td><td>블로킹 요청 적체</td><td>동시 연결/큐 길이 상한</td><td><strong>레이트리밋</strong>, 연결·응답 <strong>타임아웃</strong>, 대역폭 상한</td><td>p95/99 지연·큐 깊이 알람</td><td>OWASP API Top10/DoS CS ([OWASP Foundation][1], [cheatsheetseries.owasp.org][2])</td></tr><tr><td>인증/세션</td><td>컨텍스트 유실, 재사용</td><td>세션 고정·재연공격</td><td><strong>사전 인증</strong>, MFA, 세션 회전·만료</td><td>토큰 수명·MFA 적용률</td><td>NIST 800-63, ASVS ([NIST][7], [OWASP Foundation][8])</td></tr><tr><td>데이터 무결성</td><td>중복·부분 실패</td><td>순차 커밋·롤백</td><td>트랜잭션 경계, <strong>멱등키</strong>, 감사 로그</td><td>실패율·롤백율 모니터</td><td>PCI DSS(무결성), ASVS ([PCI Security Standards Council][3], [OWASP Foundation][8])</td></tr><tr><td>전송/저장 보안</td><td>스니핑·유출</td><td>암호화 정책</td><td>TLS 적용, 저장 암호화, 키 관리</td><td>TLS 버전·암호군 점검</td><td>PCI DSS, ISO 27001 ([PCI Security Standards Council][3], [ISO][6])</td></tr><tr><td>입력 검증</td><td>인젝션·우회</td><td>동기 검증 체계</td><td>스키마/화이트리스트, 서버측 검증</td><td>실패 패턴·WAF 룰</td><td>ASVS(입력 검증) ([OWASP Foundation][8])</td></tr><tr><td>로깅/감사</td><td>순서 불명확</td><td>선형 추적성</td><td>상관 ID, 단계별 로그, 불변 감사표</td><td>로그 무결성 점검</td><td>ISO 27001(로그), GDPR 기록성 ([ISO][6], [European Commission][4])</td></tr><tr><td>개인정보</td><td>최소화·보유</td><td>법적 근거·권리</td><td>최소 수집, <strong>보유기간</strong>·파기, 접근 통제</td><td>DPIA/접근 로그</td><td>GDPR ([European Commission][4])</td></tr><tr><td>규정 준수</td><td>도메인별 요구</td><td>범위/스코프 정합</td><td>PCI DSS(결제), HIPAA(의료) 맵핑</td><td>정기 갭 분석</td><td>PCI SSC, HHS HIPAA ([PCI Security Standards Council][3], [HHS.gov][5])</td></tr></tbody></table><h4 id=모니터링-및-관측성-observability>모니터링 및 관측성 (Observability)<a hidden class=anchor aria-hidden=true href=#모니터링-및-관측성-observability>#</a></h4><ul><li><strong>무엇을 본다 (What)</strong>: 사용자 관점 SLI(지연·오류·가용성) + 자원 포화도 + 동기 특화 지표 (풀 대기/락/HoL).</li><li><strong>어떻게 본다 (How)</strong>:<ol><li><strong>Metrics</strong>: Prometheus 로 히스토그램 (요청 지연 p50/p95/p99), 카운터 (TPS/오류), 게이지 (풀 점유) 수집</li><li><strong>Tracing</strong>: OpenTelemetry 로 <strong>동기 체인의 단계별 span</strong> 계측 (서버→서비스→DB/외부 호출)</li><li><strong>Logging</strong>: 구조화 JSON + <code>trace_id</code> 전파로 <strong>로그↔트레이스 상호점프</strong> 가능</li><li><strong>Profiling(선택)</strong>: CPU/Wall time 프로파일링으로 <strong>블로킹 구간</strong>과 <strong>크리티컬 섹션</strong> 확인</li></ol></li><li><strong>어디에 쓴다 (Operate)</strong>: Grafana 대시보드 (골든시그널, 풀/락/큐), 알람 룰 (SLO 위반/폭풍 리트라이/풀 포화) 운영</li></ul><table><thead><tr><th>영역</th><th>핵심 SLI/지표</th><th>권장 계측/수집</th><th>기준·임계 예시 (초기값)</th><th>대시보드 뷰</th><th>경보 룰 (예시)</th><th>동기 특화 팁</th></tr></thead><tbody><tr><td>사용자 지연</td><td>p50/p95/p99, 타임아웃율</td><td>히스토그램 타이머</td><td>p95 &lt; 500ms, 타임아웃율 &lt; 1%</td><td>서비스/엔드포인트별 지연 히트맵</td><td>5 분 p95>슬랙 20%↑ 지속</td><td><strong>stage 별 레이블</strong>로 병목 단계 식별</td></tr><tr><td>처리량</td><td>RPS/TPS, 큐 소비율</td><td>카운터</td><td>목표 RPS 대비 ±10%</td><td>시계열·버킷</td><td>급락/급증 알람 (디도스/장애)</td><td>RPS 급증시 풀/큐 포화 동시 체크</td></tr><tr><td>오류</td><td>4xx/5xx, 예외율</td><td>카운터</td><td>오류율 &lt; 0.5%</td><td>오류율·원인 상위</td><td>5xx 급증, 예외율 급증</td><td><strong>에러 트레이스 100% 샘플링</strong></td></tr><tr><td>포화도</td><td>CPU/메모리/FD/스레드/커넥션 풀</td><td>게이지</td><td>스레드풀 점유 &lt; 80%</td><td>리소스 패널</td><td>임계 초과 지속</td><td><strong>풀 대기시간 (ms)</strong> 별도 계측</td></tr><tr><td>DB/락</td><td>트랜잭션 시간, 락 대기, 슬로우쿼리</td><td>요약/이벤트</td><td>락대기 p95 &lt; 50ms</td><td>SQL Top N</td><td>슬로우쿼리율 상승</td><td>격리 수준·인덱스·N+1 점검</td></tr><tr><td>I/O 대기</td><td>디스크/네트워크 대기, syscall iowait</td><td>Node/OS Exporter</td><td>iowait &lt; 10%</td><td>Node 패널</td><td>iowait 상승</td><td>캐시/배치 시간 조정</td></tr><tr><td>HoL/큐</td><td>단계별 p95 편차, 큐 길이/체류시간</td><td>히스토그램/요약</td><td>체류 p95 &lt; SLA/3</td><td>큐/파이프라인</td><td>체류 급증·드롭률</td><td><strong>Outbox/Dispatcher</strong> 레벨 계측</td></tr><tr><td>트레이싱</td><td>단계 span, 외부호출, 오류 스택</td><td>OTel SDK/Collector</td><td>오류 스팬=0 목표</td><td>서비스맵/플레임그래프</td><td>오류스팬>0 즉시 알람</td><td>로그↔트레이스 상호링크</td></tr><tr><td>로깅</td><td>JSON 구조화, 상관 ID</td><td>Log shipper</td><td>필수 필드 누락 0</td><td>필드 완전성</td><td>누락 비율 알람</td><td><code>trace_id/exec_id/stage</code> 표준화</td></tr></tbody></table><ul><li>동기 시스템은 **" 어디에서 막히는가 &ldquo;**가 본질이다. <strong>스테이지 분할 타이머 + 트레이싱</strong>으로 병목 지점을 숫자로 드러낸다.</li><li><strong>스레드/커넥션 풀 대기, DB 락, HoL 체류</strong>는 동기만의 핵심 리스크다. 전용 지표를 반드시 둔다.</li><li>알람은 **SLO 중심 (사용자 p95/오류율/포화도)** 으로 간결하게, 디버깅은 <strong>트레이스 + 로그 상관</strong>으로 빠르게.</li></ul><h4 id=실무-적용-고려사항-및-주의점>실무 적용 고려사항 및 주의점<a hidden class=anchor aria-hidden=true href=#실무-적용-고려사항-및-주의점>#</a></h4><p>동기 실행 모델은 직관적인 제어 흐름과 예측 가능한 동작을 제공하지만, 운영 환경에서는 자원 점유, 성능 병목, 장애 전파, 보안 취약점 등 다양한 위험 요소가 존재한다.<br>실무 적용 시에는 리소스 관리, 타임아웃과 풀링 같은 기술적 제어, 장애 격리 설계, 모니터링 강화가 필수이며, 필요 시 비동기 모델과 혼합 설계로 병목을 완화할 수 있다.<br>특히 동기와 비동기 호출이 혼합된 시스템에서는 경계 정의와 상태 정합성 보장이 중요하다.</p><table><thead><tr><th>카테고리</th><th>고려사항</th><th>설명</th><th>권장사항</th></tr></thead><tbody><tr><td><strong>리소스 관리</strong></td><td>CPU/I-O 대기</td><td>블로킹 대기 중 자원 활용 저하</td><td>불필요한 I/O 최소화, 캐싱, 커넥션 풀</td></tr><tr><td><strong>성능·확장성</strong></td><td>처리량 한계</td><td>동시 요청 증가 시 대기열 증가</td><td>멀티프로세싱, 로드밸런싱, 비동기 병행</td></tr><tr><td><strong>장애 대응</strong></td><td>장애 전파</td><td>하나의 실패가 전체 흐름 중단</td><td>Circuit Breaker, Retry, Fallback</td></tr><tr><td><strong>설계 원칙</strong></td><td>작업 단위/의존성</td><td>과도한 순차 처리, 복잡한 의존 관계</td><td>작업 분할, DAG 기반 설계</td></tr><tr><td><strong>보안</strong></td><td>블로킹 공격</td><td>장기 요청으로 서비스 마비</td><td>요청 크기 제한, 타임아웃 강화</td></tr><tr><td><strong>모니터링·운영</strong></td><td>병목 분석</td><td>지연 구간 파악 어려움</td><td>분산 추적, 단계별 로깅, 실시간 메트릭</td></tr><tr><td><strong>혼합 모델 주의</strong></td><td>동기·비동기 경계</td><td>흐름 제어 혼선, 상태 불일치</td><td>clear boundary 설계, 상태 동기화 로직</td></tr></tbody></table><ul><li><strong>리소스 관리</strong>: 불필요한 I/O 와 유휴 리소스를 줄이고 풀링·캐싱을 적극 활용.</li><li><strong>성능·확장성</strong>: 대규모 동시 접속 시 병목이 발생하므로 멀티프로세싱·로드밸런싱 도입.</li><li><strong>장애 대응</strong>: 장애 전파를 차단하는 보호 패턴 (Circuit Breaker, Retry, Fallback) 필수.</li><li><strong>설계 원칙</strong>: 순차 실행 범위를 최소화하고 의존 관계를 단순화.</li><li><strong>보안</strong>: 장기·악성 요청 차단을 위한 타임아웃 및 요청 제한 설정.</li><li><strong>모니터링·운영</strong>: 분산 추적과 상세 로깅으로 병목 지점 신속 파악.</li><li><strong>혼합 모델 주의</strong>: 동기와 비동기 경계에서 상태 불일치를 방지하는 설계 필요.</li></ul><h4 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h4><p>동기 실행 최적화는 단순한 속도 향상이 아니라, <strong>성능·안정성·자원 활용·관측·분산 운영</strong>의 균형을 맞추는 과정이다.</p><ul><li><strong>성능 개선</strong>: 캐시, 효율적인 알고리즘, 배치 처리, 네트워크 요청 최소화.</li><li><strong>안정성</strong>: 타임아웃·서킷 브레이커로 장애 전파 방지, 예외 처리로 서비스 신뢰성 보장.</li><li><strong>자원 관리</strong>: 스레드 풀·연결 풀 튜닝, 메모리 최적화, 상태 관리.</li><li><strong>관측</strong>: 모니터링과 프로파일링으로 병목 조기 발견, 성능 테스트 자동화.</li><li><strong>분산 최적화</strong>: Partial Synchrony 설계, 데이터 일관성·캐시 무효화 전략.</li></ul><table><thead><tr><th>카테고리</th><th>전략</th><th>설명</th><th>구현 방법</th><th>권장사항</th></tr></thead><tbody><tr><td>성능 개선</td><td>캐싱</td><td>반복 호출 데이터 메모리 적재</td><td>Redis, Memcached</td><td>캐시 만료·동기화 전략 수립</td></tr><tr><td>성능 개선</td><td>알고리즘 최적화</td><td>효율적 로직/순서 설계</td><td>토폴로지 정렬, O(n) 이하 알고리즘</td><td>프로파일링 기반 적용</td></tr><tr><td>성능 개선</td><td>배치 처리</td><td>요청 합병·일괄 처리</td><td>DB Bulk Insert, 네트워크 배치</td><td>배치 크기 테스트</td></tr><tr><td>성능 개선</td><td>네트워크 최적화</td><td>호출 최소화·압축</td><td>gRPC, HTTP 압축</td><td>지역성 (Locality) 활용</td></tr><tr><td>안정성</td><td>타임아웃</td><td>지연 차단</td><td>서비스별 Timeout 설정</td><td>SLA 기반 값 조정</td></tr><tr><td>안정성</td><td>서킷 브레이커</td><td>장애 전파 방지</td><td>Resilience4j, Hystrix</td><td>재시도·Fallback 구현</td></tr><tr><td>안정성</td><td>예외 처리</td><td>롤백·보상 처리</td><td>트랜잭션 관리, Saga 패턴</td><td>재처리 로직 명확화</td></tr><tr><td>자원 관리</td><td>스레드 풀 튜닝</td><td>최적 스레드 수 조정</td><td>ThreadPoolExecutor</td><td>CPU/I/O 비율 고려</td></tr><tr><td>자원 관리</td><td>연결 풀 최적화</td><td>DB·네트워크 연결 재사용</td><td>HikariCP, HTTP Keep-Alive</td><td>풀 크기 동적 조정</td></tr><tr><td>자원 관리</td><td>메모리 최적화</td><td>객체 재사용, 힙 튜닝</td><td>Object Pool, GC 튜닝</td><td>메모리 누수 점검</td></tr><tr><td>관측</td><td>모니터링</td><td>성능·장애 지표 수집</td><td>Prometheus, Grafana</td><td>알람 임계값 설정</td></tr><tr><td>관측</td><td>프로파일링</td><td>병목 분석</td><td>PyInstrument, JProfiler</td><td>주기적 실행</td></tr><tr><td>관측</td><td>부하 테스트</td><td>사전 성능 검증</td><td>k6, JMeter</td><td>트래픽 패턴 기반 시뮬레이션</td></tr><tr><td>분산 최적화</td><td>Partial Synchrony</td><td>안정성 + 반응성 절충</td><td>분산 합의 알고리즘 설계</td><td>타임바운드 설정</td></tr><tr><td>분산 최적화</td><td>데이터 일관성</td><td>캐시·DB 동기화</td><td>Cache Aside, Write-Through</td><td>무효화 전략 필수</td></tr></tbody></table><p>동기 실행 최적화는 캐싱·배치·알고리즘 개선 같은 <strong>성능</strong> 측면만이 아니라, 장애 전파 차단 (타임아웃·서킷 브레이커), <strong>자원 효율성 (스레드·연결·메모리)</strong>, <strong>관측 체계</strong> 강화, 그리고 <strong>분산 환경의 안정성·일관성</strong>까지 아우르는 종합 설계가 필요하다.</p><h3 id=고급-주제-advanced-topics>고급 주제 (Advanced Topics)<a hidden class=anchor aria-hidden=true href=#고급-주제-advanced-topics>#</a></h3><h4 id=현재-도전-과제>현재 도전 과제<a hidden class=anchor aria-hidden=true href=#현재-도전-과제>#</a></h4><p>동기 실행은 <strong>예측 가능성과 일관성</strong>이 강점이지만, 긴 I/O 나 외부 의존이 끼어드는 순간 <strong>선두 차단 (HoL)</strong> 과 <strong>p99 지연 확대</strong>를 야기한다.<br>thread-per-request 모델은 동시성 상한과 컨텍스트 스위칭 오버헤드로 <strong>처리량 한계</strong>를 맞기 쉽고, 트랜잭션 경계가 넓을수록 <strong>락 경합/데드락/연쇄 롤백</strong> 위험이 커진다.<br>분산·글로벌 환경에서는 리전 간 RTT 가 동기 호출 경로를 비효율적으로 만들고, 컨테이너 오토스케일과 <strong>상태 유지형 동기 흐름</strong>이 충돌한다.</p><p>해결은</p><ol><li>핵심 동기 경로를 <strong>짧게 슬라이싱</strong>하고 느린 단계는 <strong>비동기 오프로딩</strong></li><li><strong>타임아웃·재시도 (지터)·서킷브레이커·벌크헤드</strong>로 실패 전파를 차단</li><li><strong>락 규율·격리레벨·배치/캐시</strong>로 데이터 경합을 줄이고</li><li><strong>에지 캐시/리드 레플리카/리전 현지화</strong>로 네트워크 지연을 완화</li><li><strong>관측성 표준화</strong>로 병목을 상시 탐지·교정하는 방식이 유효하다.</li></ol><table><thead><tr><th>카테고리</th><th>도전 과제</th><th>원인</th><th>영향</th><th>탐지/진단</th><th>예방</th><th>해결 방안 (실무 팁)</th></tr></thead><tbody><tr><td>아키텍처/확장성</td><td>thread-per-request 상한</td><td>스레드/컨텍스트 스위칭 비용</td><td>TPS 포화, 비용 증가</td><td>스레드풀 포화율, 컨텍스트 스위칭/CPU idle</td><td>스레드풀 상한, 경량 엔드포인트</td><td>핵심 동기만 유지, 후속은 큐/워커; 일부 NIO/이벤트 기반으로 전환</td></tr><tr><td>성능/지연</td><td>HoL 차단·p99 악화</td><td>긴 I/O, 외부 API 대기</td><td>체감 성능 저하, 타임아웃</td><td>구간 히스토그램, 슬로쿼리/슬로콜</td><td>경로 슬라이싱, 준비 데이터 프리워밍</td><td>캐시·배치·프리페치, 동시성 제한 (semaphore) 로 팬아웃 제어</td></tr><tr><td>동시성/락</td><td>락 경합·데드락</td><td>넓은 트랜잭션 경계, 락 순서 무질서</td><td>대기 폭증, 교착</td><td>락 대기시간, 데드락 로그/덤프</td><td>락 순서 규약, 임계구역 단축</td><td>낙관적 잠금, 파티셔닝, 격리레벨 조정 (예: RR→RC+ 보상절차)</td></tr><tr><td>데이터/트랜잭션</td><td>글로벌 일관성 비용</td><td>SERIALIZABLE·2PC 남용</td><td>처리량 급감, 롤백 증가</td><td>롤백율, 재시도율</td><td>경계 최소화</td><td>SAGA/보상 트랜잭션, 멱등키, 분해 가능한 일관성 (CQRS)</td></tr><tr><td>플랫폼/운영</td><td>컨테이너 오토스케일 충돌</td><td>상태 유지 동기 세션</td><td>스케일 반응 느림</td><td>HPA 지표, 세션 분포</td><td>스테이트리스화</td><td>세션 외부화 (캐시/스토어), init/헬스체크로 게이트</td></tr><tr><td>글로벌/모바일</td><td>리전 RTT·전력/망 제약</td><td>원격 동기 호출</td><td>지연·배터리 소모</td><td>지역별 p95, 실패율</td><td>근접 배치/오프라인 전략</td><td>에지 캐싱/리드 레플리카, 오프라인 - 퍼스트, 요청 축약</td></tr><tr><td>신뢰성</td><td>연쇄 장애 전파</td><td>강결합 동기 체인</td><td>전체 실패, MTTR↑</td><td>실패 상관관계, 버스 에러율</td><td>격벽 분리</td><td>서킷브레이커, 폴백 경로, 재시도에 지터·상한</td></tr><tr><td>보안/거버넌스</td><td>DoS/자원 고갈</td><td>블로킹 적체</td><td>가용성 저하</td><td>동시 연결·큐 길이</td><td>레이트리밋·타임아웃</td><td>프록시/방화벽 한도, 요청 당 작업 상한, 스텝 - 다운 응답</td></tr><tr><td>관측성/진단</td><td>원인 불명 병목</td><td>구간 지표/트레이스 부재</td><td>MTTR↑</td><td>분산 트레이싱, 상관 ID</td><td>지표 표준화</td><td>단계별 스팬·로그, 알람 (큐 깊이/p99/에러율) 운영</td></tr></tbody></table><ul><li><strong>아키텍처/확장성</strong>: 동기 경로는 짧게, 스레드풀은 보수적으로. 필요한 부분만 동기.</li><li><strong>성능/지연</strong>: p99 는 설계 산출물이다—슬라이스·캐시·동시성 제한으로 통제.</li><li><strong>신뢰성</strong>: 실패는 국소화—서킷브레이커/벌크헤드/폴백을 기본값으로.</li><li><strong>데이터</strong>: ACID 는 좁게, 분산 일관성은 SAGA·멱등성으로.</li><li><strong>플랫폼/글로벌</strong>: 상태 외부화·근접 배치·오프라인 전략으로 환경 제약 흡수.</li><li><strong>보안/거버넌스</strong>: 타임아웃·레이트리밋·최대 작업량으로 자원 고갈 차단.</li><li><strong>관측성</strong>: 구간 스팬·큐 길이·락 대기시간을 기본 계측으로 표준화.</li></ul><h4 id=생태계-및-관련-기술>생태계 및 관련 기술<a hidden class=anchor aria-hidden=true href=#생태계-및-관련-기술>#</a></h4><ul><li><strong>통신/호출</strong>: REST(HTTP/1.1), gRPC Unary, 동기 RPC 는 <em>예측 가능한 순서</em>와 <em>단순한 오류 전파</em>에 유리.</li><li><strong>데이터/트랜잭션</strong>: ANSI SQL, ACID, 동기 드라이버 (JDBC/psycopg2) 로 <strong>원자성·정합성</strong> 확보.</li><li><strong>성능 최적화</strong>: 캐시 적중률↑, 풀 대기↓, 슬로우쿼리↓가 동기 시스템 p95 안정화의 핵심.</li><li><strong>회복 탄력성</strong>: Timeout/Retry(지수 백오프 + 지터), Circuit Breaker, Fallback 으로 <strong>테일 지연 억제</strong>.</li><li><strong>게이트웨이/플랫폼</strong>: API Gateway/BFF 가 호출 순서·인증·관측성 주입을 <em>단일 진입점</em>에서 표준화.</li><li><strong>관측성/운영</strong>: Prometheus/Grafana + ELK + OpenTelemetry 로 <strong>병목 위치</strong>를 수치화.</li><li><strong>하이브리드 연계</strong>: Outbox→브로커→워커로 <strong>핵심은 동기, 외연은 비동기</strong> 원칙을 구현.</li><li><strong>보안/거버넌스</strong>: TLS, OAuth2/OIDC, 레이트 리미팅/쿼터, 감사 로그로 <strong>규정 준수</strong>와 <strong>서비스 보호</strong>.</li></ul><h5 id=통합-기술-생태계>통합 기술 생태계<a hidden class=anchor aria-hidden=true href=#통합-기술-생태계>#</a></h5><table><thead><tr><th>카테고리</th><th>기술/제품 (예)</th><th>연계 목적</th><th>핵심 활용 포인트</th><th>주의점</th></tr></thead><tbody><tr><td>통신/호출</td><td>HTTP/1.1 REST, gRPC Unary, Thrift</td><td>동기 요청–응답</td><td>단순 흐름/명확한 에러 전파</td><td>네트워크 지연 전파, HoL 위험</td></tr><tr><td>데이터/트랜잭션</td><td>RDBMS(게시/조회), JDBC, psycopg2, JPA/MyBatis</td><td>ACID/SQL</td><td>트랜잭션 경계 최소화, 인덱스/슬로우쿼리 관리</td><td>락 경합, 긴 트랜잭션 금지</td></tr><tr><td>성능 최적화</td><td>Redis/Memcached, Caffeine/Guava, HikariCP</td><td>지연·부하 감소</td><td>캐시 키/TTL 전략, 커넥션 풀 사이징</td><td>캐시 일관성, 풀 포화</td></tr><tr><td>회복 탄력성</td><td>Resilience4j/Hystrix 패턴, Retry/Timeout</td><td>장애 전파 차단</td><td>지수 백오프 + 지터, 폴백 시나리오</td><td>폭풍 재시도, 숨은 타임아웃</td></tr><tr><td>게이트웨이/BFF</td><td>Kong, NGINX, Spring Cloud Gateway, BFF</td><td>호출 순서·정책 집행</td><td>인증/Rate Limit/관측성 헤더 주입</td><td>단일 장애점, 설정 복잡성</td></tr><tr><td>관측성/운영</td><td>Prometheus/Grafana, ELK, OpenTelemetry, APM</td><td>병목·장애 가시화</td><td>p95/풀·락·큐 지표, Trace ↔ Log 상관</td><td>과도한 라벨/샘플링 비용</td></tr><tr><td>하이브리드 연계</td><td>Kafka, RabbitMQ, Outbox 패턴</td><td>동기 핵심 + 비동기 외연</td><td>멱등키, DLQ, 순서 파티셔닝</td><td>E2E 일관성 관리 복잡</td></tr><tr><td>보안/거버넌스</td><td>TLS, OAuth2/OIDC, WAF, Rate Limit/Quota</td><td>안전/정책 준수</td><td>토큰 수명/스코프, 정책 일관성</td><td>인증 지연, 오탐/차단</td></tr></tbody></table><h5 id=표준프로토콜>표준/프로토콜<a hidden class=anchor aria-hidden=true href=#표준프로토콜>#</a></h5><table><thead><tr><th>카테고리</th><th>표준/프로토콜</th><th>역할</th><th>동기 적용 포인트</th><th>대표 구현/도구</th></tr></thead><tbody><tr><td>통신</td><td>HTTP/1.1, HTTP/2</td><td>요청–응답, 멀티플렉싱</td><td>동기 REST/Unary 에 적합</td><td>NGINX, Envoy</td></tr><tr><td>통신</td><td>gRPC(Proto3)</td><td>고성능 RPC</td><td>Unary 동기 호출</td><td>gRPC 게이트웨이</td></tr><tr><td>데이터</td><td>ANSI SQL</td><td>질의 표준</td><td>동기 트랜잭션/쿼리</td><td>PostgreSQL/MySQL/Oracle</td></tr><tr><td>데이터</td><td>ACID</td><td>트랜잭션 속성</td><td>원자성/격리/일관성</td><td>RDB 엔진</td></tr><tr><td>보안</td><td>TLS 1.2+, OAuth2/OIDC</td><td>암호화/인증·인가</td><td>동기 API 보호</td><td>Keycloak, Cognito 등</td></tr><tr><td>관측성</td><td>OpenTelemetry</td><td>추적/지표/로그 표준</td><td>동기 체인 스팬 계측</td><td>OTel Collector</td></tr><tr><td>컨테이너</td><td>OCI, Kubernetes</td><td>배포/오케스트레이션</td><td>동기 앱 컨테이너화</td><td>K8s + HPA</td></tr></tbody></table><h4 id=최신-기술-트렌드와-미래-방향>최신 기술 트렌드와 미래 방향<a hidden class=anchor aria-hidden=true href=#최신-기술-트렌드와-미래-방향>#</a></h4><p>2025 년 현재, 동기 실행은 단독 모델로 사용되기보다 비동기 처리와 결합한 하이브리드 형태가 주류로 자리잡았다.<br>서버리스 환경에서는 짧고 예측 가능한 동기 흐름이 비용과 확장성 면에서 유리하며, 에지·IoT 환경에서는 초저지연 동기 처리가 강점을 가진다.<br>머신러닝을 활용한 실행 패턴 분석 및 적응형 실행 전환 기술이 점차 도입되고 있으며, 관측성 강화는 필수 요소로 자리잡았다.<br>미래에는 양자 컴퓨팅과 블록체인 기반 분산 동기 프로토콜이 동기 처리 영역에 변화를 가져올 가능성이 있다.</p><table><thead><tr><th>카테고리</th><th>트렌드 항목</th><th>설명</th><th>동기 실행과의 관계</th></tr></thead><tbody><tr><td>실무형 트렌드</td><td>하이브리드 실행 모델</td><td>동기/비동기 혼합 설계</td><td>핵심 로직은 동기, 대규모 병렬은 비동기</td></tr><tr><td>실무형 트렌드</td><td>서버리스 환경 통합</td><td>Lambda, Cloud Functions 등</td><td>짧은 동기 흐름 최적, Cold Start 완화</td></tr><tr><td>실무형 트렌드</td><td>고성능 동기 최적화</td><td>Netty, IoT, 5G/6G 초저지연</td><td>예측 가능한 응답 요구 시 유리</td></tr><tr><td>실무형 트렌드</td><td>관측성 강화</td><td>OpenTelemetry, 트레이싱 설계</td><td>동기 호출 경로 분석 용이</td></tr><tr><td>지능형 최적화</td><td>AI 기반 성능 최적화</td><td>실행 패턴 분석, 예측 캐싱</td><td>자원 효율 향상, 지연 최소화</td></tr><tr><td>지능형 최적화</td><td>적응형 동기 실행</td><td>상태에 따라 동기/비동기 전환</td><td>실시간 최적 실행 모드 선택</td></tr><tr><td>미래 지향 기술</td><td>양자 동기 컴퓨팅</td><td>양자 연산 기반 초고속 동기 처리</td><td>보안·연산 속도 혁신 가능</td></tr><tr><td>미래 지향 기술</td><td>분산 동기 프로토콜</td><td>글로벌 분산 환경 동기 합의</td><td>블록체인 기반 일관성 보장</td></tr></tbody></table><ul><li><strong>실무형 트렌드</strong>: 동기 실행은 비동기와 병행해 최적의 성능·확장성을 확보하며, 서버리스·에지 환경에서 강점 발휘.</li><li><strong>지능형 최적화</strong>: AI 와 머신러닝이 동기 실행 효율을 높이는 방향으로 발전 중, 적응형 전환 기술 주목.</li><li><strong>미래 지향 기술</strong>: 양자 컴퓨팅과 분산 합의 프로토콜이 동기 실행의 한계를 넘어설 잠재력 보유.</li></ul><h4 id=하이브리드-아키텍처-설계-synchronous--asynchronous>하이브리드 아키텍처 설계 (Synchronous + Asynchronous)<a hidden class=anchor aria-hidden=true href=#하이브리드-아키텍처-설계-synchronous--asynchronous>#</a></h4><ul><li><strong>동기 실행 구간</strong>: 데이터 일관성 (Data Consistency), 중요한 순서 보장이 필요한 핵심 로직 (예: 결제 승인, 재고 차감)</li><li><strong>비동기 실행 구간</strong>: 병렬 처리로 응답 속도 개선이 가능한 보조 작업 (예: 알림 발송, 로그 처리, 분석 데이터 전송)</li></ul><h5 id=예시-전자상거래-주문-처리>예시: 전자상거래 주문 처리<a hidden class=anchor aria-hidden=true href=#예시-전자상거래-주문-처리>#</a></h5><p><strong>흐름</strong></p><ol><li>주문 생성 → 동기 (결제 승인, 재고 차감)</li><li>결제 완료 후 즉시 응답 반환</li><li>응답 이후 별도의 비동기 큐를 통해 배송 요청, 고객 알림, 이벤트 로그 전송</li></ol><p><strong>시스템 구성</strong></p><pre class=mermaid>graph LR
    U[User] --&gt; API[Order API Gateway]
    API --&gt; SYNC[Sync Payment &amp; Stock Service]
    SYNC --&gt; DB[Database]
    SYNC --&gt;|Response| U
    SYNC --&gt; MQ[Message Queue]
    MQ --&gt; ASYNC1[Shipping Service]
    MQ --&gt; ASYNC2[Notification Service]
    MQ --&gt; ASYNC3[Analytics Service]
</pre><h6 id=동기--비동기-구간-구분>동기 & 비동기 구간 구분<a hidden class=anchor aria-hidden=true href=#동기--비동기-구간-구분>#</a></h6><table><thead><tr><th>구분</th><th>작업 예시</th><th>설명</th><th>이유</th></tr></thead><tbody><tr><td>동기 (Sync)</td><td>결제 승인, 재고 차감</td><td>반드시 완료 후 응답 반환</td><td>데이터 무결성 보장</td></tr><tr><td>동기 (Sync)</td><td>핵심 비즈니스 로직</td><td>트랜잭션 내 순차 처리</td><td>오류 전파 방지</td></tr><tr><td>비동기 (Async)</td><td>배송 요청</td><td>외부 API 호출 부담 완화</td><td>빠른 응답 반환</td></tr><tr><td>비동기 (Async)</td><td>고객 알림 (SMS/Email)</td><td>비핵심 경로</td><td>병렬 처리로 효율성</td></tr><tr><td>비동기 (Async)</td><td>이벤트 로그 저장</td><td>분석 목적으로 별도 처리</td><td>메인 서비스 부하 경감</td></tr></tbody></table><h6 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h6><ul><li>Python + Flask + Celery</li><li><strong>결제 → 재고 차감</strong>까지는 동기 처리</li><li><strong>알림과 로그 전송</strong>은 Celery(비동기 작업 큐).</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20>20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21>21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22>22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23>23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24>24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25>25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26>26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27>27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28>28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29>29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30>30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31>31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32>32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33>33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34>34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35>35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36>36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37>37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38>38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39>39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40>40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41>41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42>42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43>43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44>44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45>45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46>46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47>47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48>48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49>49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50>50</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>celery</span> <span class=kn>import</span> <span class=n>Celery</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span><span class=o>,</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Celery 비동기 설정 (Redis를 브로커로 사용)</span>
</span></span><span class=line><span class=cl><span class=n>celery_app</span> <span class=o>=</span> <span class=n>Celery</span><span class=p>(</span><span class=s1>&#39;tasks&#39;</span><span class=p>,</span> <span class=n>broker</span><span class=o>=</span><span class=s1>&#39;redis://localhost:6379/0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@celery_app.task</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_notification</span><span class=p>(</span><span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;비동기 알림 발송&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 알림 발송 지연 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Async] 주문 </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>에 대한 알림 발송 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@celery_app.task</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>log_order_event</span><span class=p>(</span><span class=n>order_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;비동기 로그 기록&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Async] 주문 </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2> 로그 기록 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/order&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_order</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl>    <span class=n>order_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 1. 동기 처리: 결제 승인 (모의 처리)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Sync] 결제 승인 요청 for </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># 결제 API 호출 지연 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Sync] 결제 승인 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 2. 동기 처리: 재고 차감</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Sync] 재고 차감 처리 for </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[Sync] 재고 차감 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 3. 응답 반환 (핵심 로직 완료 후 즉시)</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 4. 비동기 처리 (응답 이후 실행)</span>
</span></span><span class=line><span class=cl>    <span class=n>send_notification</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_order_event</span><span class=o>.</span><span class=n>delay</span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>(</span><span class=n>response</span><span class=p>),</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=설계-효과-분석>설계 효과 분석<a hidden class=anchor aria-hidden=true href=#설계-효과-분석>#</a></h6><table><thead><tr><th>항목</th><th>동기 전용 vs. 하이브리드</th><th>성과</th></tr></thead><tbody><tr><td>응답 시간</td><td>평균 2.5 초 → 1.5 초</td><td>40% 개선</td></tr><tr><td>서버 부하</td><td>피크 타임 CPU 사용량 감소</td><td>자원 효율성 향상</td></tr><tr><td>안정성</td><td>핵심 로직만 동기 실행 유지</td><td>데이터 무결성 보장</td></tr><tr><td>확장성</td><td>비동기 큐 워커 (worker) 수 확장 가능</td><td>고부하 대응 용이</td></tr></tbody></table><h6 id=실무-적용-가이드>실무 적용 가이드<a hidden class=anchor aria-hidden=true href=#실무-적용-가이드>#</a></h6><ol><li><strong>핵심 로직 식별</strong> → 실패 시 비즈니스에 치명적인 작업은 동기 처리</li><li><strong>비핵심 작업 비동기화</strong> → 응답 속도와 서버 확장성 확보</li><li><strong>메시지 브로커 필수</strong> → RabbitMQ, Redis, Kafka 중 선택</li><li><strong>에러 처리 전략</strong> → 동기 구간은 롤백, 비동기 구간은 재시도 (Replay) 구조 설계</li></ol><h5 id=경계-설계-실습-주문-생성-동기-트랜잭션--알림영수증-발행-비동기-큐>경계 설계 실습: 주문 생성 (동기 트랜잭션) → 알림/영수증 발행 (비동기 큐)<a hidden class=anchor aria-hidden=true href=#경계-설계-실습-주문-생성-동기-트랜잭션--알림영수증-발행-비동기-큐>#</a></h5><p>핵심은 <strong>트랜잭션 내부 (동기)</strong> 에서는 <code>주문 + 아웃박스 이벤트</code> 까지 원자적으로 커밋하고, 이후 <strong>아웃박스 디스패처 → 큐 → 워커 (비동기)</strong> 로 실제 발송을 처리.</p><h6 id=실행-준비>실행 준비<a hidden class=anchor aria-hidden=true href=#실행-준비>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2>2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python -V  <span class=c1># 3.9+</span>
</span></span><span class=line><span class=cl>pip install flask redis
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REDIS_URL</span><span class=o>=</span>redis://localhost:6379   <span class=c1># 필요 시 조정</span>
</span></span></code></pre></td></tr></table></div></div><p>터미널 3~4 개를 열고 아래 순서로 실행.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1) DB 스키마 생성(최초 1회)</span>
</span></span><span class=line><span class=cl>python order_boundary_case.py setup-db
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2) API 서버(동기 트랜잭션: 주문+아웃박스 삽입)</span>
</span></span><span class=line><span class=cl>python order_boundary_case.py api --port <span class=m>5000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3) 아웃박스 디스패처(동기 커밋된 이벤트를 비동기 큐로 밀어넣음)</span>
</span></span><span class=line><span class=cl>python order_boundary_case.py dispatcher
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4) 워커들(비동기 처리)</span>
</span></span><span class=line><span class=cl>python order_boundary_case.py worker-notify
</span></span><span class=line><span class=cl>python order_boundary_case.py worker-receipt
</span></span></code></pre></td></tr></table></div></div><p>테스트 (새 터미널):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1>1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2>2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3>3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4>4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5>5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6>6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7>7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 주문 생성(동기 트랜잭션) → outbox 이벤트 생김</span>
</span></span><span class=line><span class=cl>curl -X POST http://localhost:5000/orders <span class=se>\
</span></span></span><span class=line><span class=cl>  -H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  -d <span class=s1>&#39;{&#34;user_id&#34;:&#34;u-123&#34;,&#34;amount&#34;:19900}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 처리 현황 조회</span>
</span></span><span class=line><span class=cl>curl http://localhost:5000/orders
</span></span><span class=line><span class=cl>curl http://localhost:5000/receipts
</span></span></code></pre></td></tr></table></div></div><h6 id=전체-코드-order_boundary_casepy>전체 코드: <code>order_boundary_case.py</code><a hidden class=anchor aria-hidden=true href=#전체-코드-order_boundary_casepy>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1>  1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2>  2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3>  3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4>  4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5>  5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6>  6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7>  7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8>  8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9>  9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10> 10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11> 11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12> 12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13> 13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14> 14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15> 15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16> 16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17> 17</a>
</span><span class=lnt id=hl-29-18><a class=lnlinks href=#hl-29-18> 18</a>
</span><span class=lnt id=hl-29-19><a class=lnlinks href=#hl-29-19> 19</a>
</span><span class=lnt id=hl-29-20><a class=lnlinks href=#hl-29-20> 20</a>
</span><span class=lnt id=hl-29-21><a class=lnlinks href=#hl-29-21> 21</a>
</span><span class=lnt id=hl-29-22><a class=lnlinks href=#hl-29-22> 22</a>
</span><span class=lnt id=hl-29-23><a class=lnlinks href=#hl-29-23> 23</a>
</span><span class=lnt id=hl-29-24><a class=lnlinks href=#hl-29-24> 24</a>
</span><span class=lnt id=hl-29-25><a class=lnlinks href=#hl-29-25> 25</a>
</span><span class=lnt id=hl-29-26><a class=lnlinks href=#hl-29-26> 26</a>
</span><span class=lnt id=hl-29-27><a class=lnlinks href=#hl-29-27> 27</a>
</span><span class=lnt id=hl-29-28><a class=lnlinks href=#hl-29-28> 28</a>
</span><span class=lnt id=hl-29-29><a class=lnlinks href=#hl-29-29> 29</a>
</span><span class=lnt id=hl-29-30><a class=lnlinks href=#hl-29-30> 30</a>
</span><span class=lnt id=hl-29-31><a class=lnlinks href=#hl-29-31> 31</a>
</span><span class=lnt id=hl-29-32><a class=lnlinks href=#hl-29-32> 32</a>
</span><span class=lnt id=hl-29-33><a class=lnlinks href=#hl-29-33> 33</a>
</span><span class=lnt id=hl-29-34><a class=lnlinks href=#hl-29-34> 34</a>
</span><span class=lnt id=hl-29-35><a class=lnlinks href=#hl-29-35> 35</a>
</span><span class=lnt id=hl-29-36><a class=lnlinks href=#hl-29-36> 36</a>
</span><span class=lnt id=hl-29-37><a class=lnlinks href=#hl-29-37> 37</a>
</span><span class=lnt id=hl-29-38><a class=lnlinks href=#hl-29-38> 38</a>
</span><span class=lnt id=hl-29-39><a class=lnlinks href=#hl-29-39> 39</a>
</span><span class=lnt id=hl-29-40><a class=lnlinks href=#hl-29-40> 40</a>
</span><span class=lnt id=hl-29-41><a class=lnlinks href=#hl-29-41> 41</a>
</span><span class=lnt id=hl-29-42><a class=lnlinks href=#hl-29-42> 42</a>
</span><span class=lnt id=hl-29-43><a class=lnlinks href=#hl-29-43> 43</a>
</span><span class=lnt id=hl-29-44><a class=lnlinks href=#hl-29-44> 44</a>
</span><span class=lnt id=hl-29-45><a class=lnlinks href=#hl-29-45> 45</a>
</span><span class=lnt id=hl-29-46><a class=lnlinks href=#hl-29-46> 46</a>
</span><span class=lnt id=hl-29-47><a class=lnlinks href=#hl-29-47> 47</a>
</span><span class=lnt id=hl-29-48><a class=lnlinks href=#hl-29-48> 48</a>
</span><span class=lnt id=hl-29-49><a class=lnlinks href=#hl-29-49> 49</a>
</span><span class=lnt id=hl-29-50><a class=lnlinks href=#hl-29-50> 50</a>
</span><span class=lnt id=hl-29-51><a class=lnlinks href=#hl-29-51> 51</a>
</span><span class=lnt id=hl-29-52><a class=lnlinks href=#hl-29-52> 52</a>
</span><span class=lnt id=hl-29-53><a class=lnlinks href=#hl-29-53> 53</a>
</span><span class=lnt id=hl-29-54><a class=lnlinks href=#hl-29-54> 54</a>
</span><span class=lnt id=hl-29-55><a class=lnlinks href=#hl-29-55> 55</a>
</span><span class=lnt id=hl-29-56><a class=lnlinks href=#hl-29-56> 56</a>
</span><span class=lnt id=hl-29-57><a class=lnlinks href=#hl-29-57> 57</a>
</span><span class=lnt id=hl-29-58><a class=lnlinks href=#hl-29-58> 58</a>
</span><span class=lnt id=hl-29-59><a class=lnlinks href=#hl-29-59> 59</a>
</span><span class=lnt id=hl-29-60><a class=lnlinks href=#hl-29-60> 60</a>
</span><span class=lnt id=hl-29-61><a class=lnlinks href=#hl-29-61> 61</a>
</span><span class=lnt id=hl-29-62><a class=lnlinks href=#hl-29-62> 62</a>
</span><span class=lnt id=hl-29-63><a class=lnlinks href=#hl-29-63> 63</a>
</span><span class=lnt id=hl-29-64><a class=lnlinks href=#hl-29-64> 64</a>
</span><span class=lnt id=hl-29-65><a class=lnlinks href=#hl-29-65> 65</a>
</span><span class=lnt id=hl-29-66><a class=lnlinks href=#hl-29-66> 66</a>
</span><span class=lnt id=hl-29-67><a class=lnlinks href=#hl-29-67> 67</a>
</span><span class=lnt id=hl-29-68><a class=lnlinks href=#hl-29-68> 68</a>
</span><span class=lnt id=hl-29-69><a class=lnlinks href=#hl-29-69> 69</a>
</span><span class=lnt id=hl-29-70><a class=lnlinks href=#hl-29-70> 70</a>
</span><span class=lnt id=hl-29-71><a class=lnlinks href=#hl-29-71> 71</a>
</span><span class=lnt id=hl-29-72><a class=lnlinks href=#hl-29-72> 72</a>
</span><span class=lnt id=hl-29-73><a class=lnlinks href=#hl-29-73> 73</a>
</span><span class=lnt id=hl-29-74><a class=lnlinks href=#hl-29-74> 74</a>
</span><span class=lnt id=hl-29-75><a class=lnlinks href=#hl-29-75> 75</a>
</span><span class=lnt id=hl-29-76><a class=lnlinks href=#hl-29-76> 76</a>
</span><span class=lnt id=hl-29-77><a class=lnlinks href=#hl-29-77> 77</a>
</span><span class=lnt id=hl-29-78><a class=lnlinks href=#hl-29-78> 78</a>
</span><span class=lnt id=hl-29-79><a class=lnlinks href=#hl-29-79> 79</a>
</span><span class=lnt id=hl-29-80><a class=lnlinks href=#hl-29-80> 80</a>
</span><span class=lnt id=hl-29-81><a class=lnlinks href=#hl-29-81> 81</a>
</span><span class=lnt id=hl-29-82><a class=lnlinks href=#hl-29-82> 82</a>
</span><span class=lnt id=hl-29-83><a class=lnlinks href=#hl-29-83> 83</a>
</span><span class=lnt id=hl-29-84><a class=lnlinks href=#hl-29-84> 84</a>
</span><span class=lnt id=hl-29-85><a class=lnlinks href=#hl-29-85> 85</a>
</span><span class=lnt id=hl-29-86><a class=lnlinks href=#hl-29-86> 86</a>
</span><span class=lnt id=hl-29-87><a class=lnlinks href=#hl-29-87> 87</a>
</span><span class=lnt id=hl-29-88><a class=lnlinks href=#hl-29-88> 88</a>
</span><span class=lnt id=hl-29-89><a class=lnlinks href=#hl-29-89> 89</a>
</span><span class=lnt id=hl-29-90><a class=lnlinks href=#hl-29-90> 90</a>
</span><span class=lnt id=hl-29-91><a class=lnlinks href=#hl-29-91> 91</a>
</span><span class=lnt id=hl-29-92><a class=lnlinks href=#hl-29-92> 92</a>
</span><span class=lnt id=hl-29-93><a class=lnlinks href=#hl-29-93> 93</a>
</span><span class=lnt id=hl-29-94><a class=lnlinks href=#hl-29-94> 94</a>
</span><span class=lnt id=hl-29-95><a class=lnlinks href=#hl-29-95> 95</a>
</span><span class=lnt id=hl-29-96><a class=lnlinks href=#hl-29-96> 96</a>
</span><span class=lnt id=hl-29-97><a class=lnlinks href=#hl-29-97> 97</a>
</span><span class=lnt id=hl-29-98><a class=lnlinks href=#hl-29-98> 98</a>
</span><span class=lnt id=hl-29-99><a class=lnlinks href=#hl-29-99> 99</a>
</span><span class=lnt id=hl-29-100><a class=lnlinks href=#hl-29-100>100</a>
</span><span class=lnt id=hl-29-101><a class=lnlinks href=#hl-29-101>101</a>
</span><span class=lnt id=hl-29-102><a class=lnlinks href=#hl-29-102>102</a>
</span><span class=lnt id=hl-29-103><a class=lnlinks href=#hl-29-103>103</a>
</span><span class=lnt id=hl-29-104><a class=lnlinks href=#hl-29-104>104</a>
</span><span class=lnt id=hl-29-105><a class=lnlinks href=#hl-29-105>105</a>
</span><span class=lnt id=hl-29-106><a class=lnlinks href=#hl-29-106>106</a>
</span><span class=lnt id=hl-29-107><a class=lnlinks href=#hl-29-107>107</a>
</span><span class=lnt id=hl-29-108><a class=lnlinks href=#hl-29-108>108</a>
</span><span class=lnt id=hl-29-109><a class=lnlinks href=#hl-29-109>109</a>
</span><span class=lnt id=hl-29-110><a class=lnlinks href=#hl-29-110>110</a>
</span><span class=lnt id=hl-29-111><a class=lnlinks href=#hl-29-111>111</a>
</span><span class=lnt id=hl-29-112><a class=lnlinks href=#hl-29-112>112</a>
</span><span class=lnt id=hl-29-113><a class=lnlinks href=#hl-29-113>113</a>
</span><span class=lnt id=hl-29-114><a class=lnlinks href=#hl-29-114>114</a>
</span><span class=lnt id=hl-29-115><a class=lnlinks href=#hl-29-115>115</a>
</span><span class=lnt id=hl-29-116><a class=lnlinks href=#hl-29-116>116</a>
</span><span class=lnt id=hl-29-117><a class=lnlinks href=#hl-29-117>117</a>
</span><span class=lnt id=hl-29-118><a class=lnlinks href=#hl-29-118>118</a>
</span><span class=lnt id=hl-29-119><a class=lnlinks href=#hl-29-119>119</a>
</span><span class=lnt id=hl-29-120><a class=lnlinks href=#hl-29-120>120</a>
</span><span class=lnt id=hl-29-121><a class=lnlinks href=#hl-29-121>121</a>
</span><span class=lnt id=hl-29-122><a class=lnlinks href=#hl-29-122>122</a>
</span><span class=lnt id=hl-29-123><a class=lnlinks href=#hl-29-123>123</a>
</span><span class=lnt id=hl-29-124><a class=lnlinks href=#hl-29-124>124</a>
</span><span class=lnt id=hl-29-125><a class=lnlinks href=#hl-29-125>125</a>
</span><span class=lnt id=hl-29-126><a class=lnlinks href=#hl-29-126>126</a>
</span><span class=lnt id=hl-29-127><a class=lnlinks href=#hl-29-127>127</a>
</span><span class=lnt id=hl-29-128><a class=lnlinks href=#hl-29-128>128</a>
</span><span class=lnt id=hl-29-129><a class=lnlinks href=#hl-29-129>129</a>
</span><span class=lnt id=hl-29-130><a class=lnlinks href=#hl-29-130>130</a>
</span><span class=lnt id=hl-29-131><a class=lnlinks href=#hl-29-131>131</a>
</span><span class=lnt id=hl-29-132><a class=lnlinks href=#hl-29-132>132</a>
</span><span class=lnt id=hl-29-133><a class=lnlinks href=#hl-29-133>133</a>
</span><span class=lnt id=hl-29-134><a class=lnlinks href=#hl-29-134>134</a>
</span><span class=lnt id=hl-29-135><a class=lnlinks href=#hl-29-135>135</a>
</span><span class=lnt id=hl-29-136><a class=lnlinks href=#hl-29-136>136</a>
</span><span class=lnt id=hl-29-137><a class=lnlinks href=#hl-29-137>137</a>
</span><span class=lnt id=hl-29-138><a class=lnlinks href=#hl-29-138>138</a>
</span><span class=lnt id=hl-29-139><a class=lnlinks href=#hl-29-139>139</a>
</span><span class=lnt id=hl-29-140><a class=lnlinks href=#hl-29-140>140</a>
</span><span class=lnt id=hl-29-141><a class=lnlinks href=#hl-29-141>141</a>
</span><span class=lnt id=hl-29-142><a class=lnlinks href=#hl-29-142>142</a>
</span><span class=lnt id=hl-29-143><a class=lnlinks href=#hl-29-143>143</a>
</span><span class=lnt id=hl-29-144><a class=lnlinks href=#hl-29-144>144</a>
</span><span class=lnt id=hl-29-145><a class=lnlinks href=#hl-29-145>145</a>
</span><span class=lnt id=hl-29-146><a class=lnlinks href=#hl-29-146>146</a>
</span><span class=lnt id=hl-29-147><a class=lnlinks href=#hl-29-147>147</a>
</span><span class=lnt id=hl-29-148><a class=lnlinks href=#hl-29-148>148</a>
</span><span class=lnt id=hl-29-149><a class=lnlinks href=#hl-29-149>149</a>
</span><span class=lnt id=hl-29-150><a class=lnlinks href=#hl-29-150>150</a>
</span><span class=lnt id=hl-29-151><a class=lnlinks href=#hl-29-151>151</a>
</span><span class=lnt id=hl-29-152><a class=lnlinks href=#hl-29-152>152</a>
</span><span class=lnt id=hl-29-153><a class=lnlinks href=#hl-29-153>153</a>
</span><span class=lnt id=hl-29-154><a class=lnlinks href=#hl-29-154>154</a>
</span><span class=lnt id=hl-29-155><a class=lnlinks href=#hl-29-155>155</a>
</span><span class=lnt id=hl-29-156><a class=lnlinks href=#hl-29-156>156</a>
</span><span class=lnt id=hl-29-157><a class=lnlinks href=#hl-29-157>157</a>
</span><span class=lnt id=hl-29-158><a class=lnlinks href=#hl-29-158>158</a>
</span><span class=lnt id=hl-29-159><a class=lnlinks href=#hl-29-159>159</a>
</span><span class=lnt id=hl-29-160><a class=lnlinks href=#hl-29-160>160</a>
</span><span class=lnt id=hl-29-161><a class=lnlinks href=#hl-29-161>161</a>
</span><span class=lnt id=hl-29-162><a class=lnlinks href=#hl-29-162>162</a>
</span><span class=lnt id=hl-29-163><a class=lnlinks href=#hl-29-163>163</a>
</span><span class=lnt id=hl-29-164><a class=lnlinks href=#hl-29-164>164</a>
</span><span class=lnt id=hl-29-165><a class=lnlinks href=#hl-29-165>165</a>
</span><span class=lnt id=hl-29-166><a class=lnlinks href=#hl-29-166>166</a>
</span><span class=lnt id=hl-29-167><a class=lnlinks href=#hl-29-167>167</a>
</span><span class=lnt id=hl-29-168><a class=lnlinks href=#hl-29-168>168</a>
</span><span class=lnt id=hl-29-169><a class=lnlinks href=#hl-29-169>169</a>
</span><span class=lnt id=hl-29-170><a class=lnlinks href=#hl-29-170>170</a>
</span><span class=lnt id=hl-29-171><a class=lnlinks href=#hl-29-171>171</a>
</span><span class=lnt id=hl-29-172><a class=lnlinks href=#hl-29-172>172</a>
</span><span class=lnt id=hl-29-173><a class=lnlinks href=#hl-29-173>173</a>
</span><span class=lnt id=hl-29-174><a class=lnlinks href=#hl-29-174>174</a>
</span><span class=lnt id=hl-29-175><a class=lnlinks href=#hl-29-175>175</a>
</span><span class=lnt id=hl-29-176><a class=lnlinks href=#hl-29-176>176</a>
</span><span class=lnt id=hl-29-177><a class=lnlinks href=#hl-29-177>177</a>
</span><span class=lnt id=hl-29-178><a class=lnlinks href=#hl-29-178>178</a>
</span><span class=lnt id=hl-29-179><a class=lnlinks href=#hl-29-179>179</a>
</span><span class=lnt id=hl-29-180><a class=lnlinks href=#hl-29-180>180</a>
</span><span class=lnt id=hl-29-181><a class=lnlinks href=#hl-29-181>181</a>
</span><span class=lnt id=hl-29-182><a class=lnlinks href=#hl-29-182>182</a>
</span><span class=lnt id=hl-29-183><a class=lnlinks href=#hl-29-183>183</a>
</span><span class=lnt id=hl-29-184><a class=lnlinks href=#hl-29-184>184</a>
</span><span class=lnt id=hl-29-185><a class=lnlinks href=#hl-29-185>185</a>
</span><span class=lnt id=hl-29-186><a class=lnlinks href=#hl-29-186>186</a>
</span><span class=lnt id=hl-29-187><a class=lnlinks href=#hl-29-187>187</a>
</span><span class=lnt id=hl-29-188><a class=lnlinks href=#hl-29-188>188</a>
</span><span class=lnt id=hl-29-189><a class=lnlinks href=#hl-29-189>189</a>
</span><span class=lnt id=hl-29-190><a class=lnlinks href=#hl-29-190>190</a>
</span><span class=lnt id=hl-29-191><a class=lnlinks href=#hl-29-191>191</a>
</span><span class=lnt id=hl-29-192><a class=lnlinks href=#hl-29-192>192</a>
</span><span class=lnt id=hl-29-193><a class=lnlinks href=#hl-29-193>193</a>
</span><span class=lnt id=hl-29-194><a class=lnlinks href=#hl-29-194>194</a>
</span><span class=lnt id=hl-29-195><a class=lnlinks href=#hl-29-195>195</a>
</span><span class=lnt id=hl-29-196><a class=lnlinks href=#hl-29-196>196</a>
</span><span class=lnt id=hl-29-197><a class=lnlinks href=#hl-29-197>197</a>
</span><span class=lnt id=hl-29-198><a class=lnlinks href=#hl-29-198>198</a>
</span><span class=lnt id=hl-29-199><a class=lnlinks href=#hl-29-199>199</a>
</span><span class=lnt id=hl-29-200><a class=lnlinks href=#hl-29-200>200</a>
</span><span class=lnt id=hl-29-201><a class=lnlinks href=#hl-29-201>201</a>
</span><span class=lnt id=hl-29-202><a class=lnlinks href=#hl-29-202>202</a>
</span><span class=lnt id=hl-29-203><a class=lnlinks href=#hl-29-203>203</a>
</span><span class=lnt id=hl-29-204><a class=lnlinks href=#hl-29-204>204</a>
</span><span class=lnt id=hl-29-205><a class=lnlinks href=#hl-29-205>205</a>
</span><span class=lnt id=hl-29-206><a class=lnlinks href=#hl-29-206>206</a>
</span><span class=lnt id=hl-29-207><a class=lnlinks href=#hl-29-207>207</a>
</span><span class=lnt id=hl-29-208><a class=lnlinks href=#hl-29-208>208</a>
</span><span class=lnt id=hl-29-209><a class=lnlinks href=#hl-29-209>209</a>
</span><span class=lnt id=hl-29-210><a class=lnlinks href=#hl-29-210>210</a>
</span><span class=lnt id=hl-29-211><a class=lnlinks href=#hl-29-211>211</a>
</span><span class=lnt id=hl-29-212><a class=lnlinks href=#hl-29-212>212</a>
</span><span class=lnt id=hl-29-213><a class=lnlinks href=#hl-29-213>213</a>
</span><span class=lnt id=hl-29-214><a class=lnlinks href=#hl-29-214>214</a>
</span><span class=lnt id=hl-29-215><a class=lnlinks href=#hl-29-215>215</a>
</span><span class=lnt id=hl-29-216><a class=lnlinks href=#hl-29-216>216</a>
</span><span class=lnt id=hl-29-217><a class=lnlinks href=#hl-29-217>217</a>
</span><span class=lnt id=hl-29-218><a class=lnlinks href=#hl-29-218>218</a>
</span><span class=lnt id=hl-29-219><a class=lnlinks href=#hl-29-219>219</a>
</span><span class=lnt id=hl-29-220><a class=lnlinks href=#hl-29-220>220</a>
</span><span class=lnt id=hl-29-221><a class=lnlinks href=#hl-29-221>221</a>
</span><span class=lnt id=hl-29-222><a class=lnlinks href=#hl-29-222>222</a>
</span><span class=lnt id=hl-29-223><a class=lnlinks href=#hl-29-223>223</a>
</span><span class=lnt id=hl-29-224><a class=lnlinks href=#hl-29-224>224</a>
</span><span class=lnt id=hl-29-225><a class=lnlinks href=#hl-29-225>225</a>
</span><span class=lnt id=hl-29-226><a class=lnlinks href=#hl-29-226>226</a>
</span><span class=lnt id=hl-29-227><a class=lnlinks href=#hl-29-227>227</a>
</span><span class=lnt id=hl-29-228><a class=lnlinks href=#hl-29-228>228</a>
</span><span class=lnt id=hl-29-229><a class=lnlinks href=#hl-29-229>229</a>
</span><span class=lnt id=hl-29-230><a class=lnlinks href=#hl-29-230>230</a>
</span><span class=lnt id=hl-29-231><a class=lnlinks href=#hl-29-231>231</a>
</span><span class=lnt id=hl-29-232><a class=lnlinks href=#hl-29-232>232</a>
</span><span class=lnt id=hl-29-233><a class=lnlinks href=#hl-29-233>233</a>
</span><span class=lnt id=hl-29-234><a class=lnlinks href=#hl-29-234>234</a>
</span><span class=lnt id=hl-29-235><a class=lnlinks href=#hl-29-235>235</a>
</span><span class=lnt id=hl-29-236><a class=lnlinks href=#hl-29-236>236</a>
</span><span class=lnt id=hl-29-237><a class=lnlinks href=#hl-29-237>237</a>
</span><span class=lnt id=hl-29-238><a class=lnlinks href=#hl-29-238>238</a>
</span><span class=lnt id=hl-29-239><a class=lnlinks href=#hl-29-239>239</a>
</span><span class=lnt id=hl-29-240><a class=lnlinks href=#hl-29-240>240</a>
</span><span class=lnt id=hl-29-241><a class=lnlinks href=#hl-29-241>241</a>
</span><span class=lnt id=hl-29-242><a class=lnlinks href=#hl-29-242>242</a>
</span><span class=lnt id=hl-29-243><a class=lnlinks href=#hl-29-243>243</a>
</span><span class=lnt id=hl-29-244><a class=lnlinks href=#hl-29-244>244</a>
</span><span class=lnt id=hl-29-245><a class=lnlinks href=#hl-29-245>245</a>
</span><span class=lnt id=hl-29-246><a class=lnlinks href=#hl-29-246>246</a>
</span><span class=lnt id=hl-29-247><a class=lnlinks href=#hl-29-247>247</a>
</span><span class=lnt id=hl-29-248><a class=lnlinks href=#hl-29-248>248</a>
</span><span class=lnt id=hl-29-249><a class=lnlinks href=#hl-29-249>249</a>
</span><span class=lnt id=hl-29-250><a class=lnlinks href=#hl-29-250>250</a>
</span><span class=lnt id=hl-29-251><a class=lnlinks href=#hl-29-251>251</a>
</span><span class=lnt id=hl-29-252><a class=lnlinks href=#hl-29-252>252</a>
</span><span class=lnt id=hl-29-253><a class=lnlinks href=#hl-29-253>253</a>
</span><span class=lnt id=hl-29-254><a class=lnlinks href=#hl-29-254>254</a>
</span><span class=lnt id=hl-29-255><a class=lnlinks href=#hl-29-255>255</a>
</span><span class=lnt id=hl-29-256><a class=lnlinks href=#hl-29-256>256</a>
</span><span class=lnt id=hl-29-257><a class=lnlinks href=#hl-29-257>257</a>
</span><span class=lnt id=hl-29-258><a class=lnlinks href=#hl-29-258>258</a>
</span><span class=lnt id=hl-29-259><a class=lnlinks href=#hl-29-259>259</a>
</span><span class=lnt id=hl-29-260><a class=lnlinks href=#hl-29-260>260</a>
</span><span class=lnt id=hl-29-261><a class=lnlinks href=#hl-29-261>261</a>
</span><span class=lnt id=hl-29-262><a class=lnlinks href=#hl-29-262>262</a>
</span><span class=lnt id=hl-29-263><a class=lnlinks href=#hl-29-263>263</a>
</span><span class=lnt id=hl-29-264><a class=lnlinks href=#hl-29-264>264</a>
</span><span class=lnt id=hl-29-265><a class=lnlinks href=#hl-29-265>265</a>
</span><span class=lnt id=hl-29-266><a class=lnlinks href=#hl-29-266>266</a>
</span><span class=lnt id=hl-29-267><a class=lnlinks href=#hl-29-267>267</a>
</span><span class=lnt id=hl-29-268><a class=lnlinks href=#hl-29-268>268</a>
</span><span class=lnt id=hl-29-269><a class=lnlinks href=#hl-29-269>269</a>
</span><span class=lnt id=hl-29-270><a class=lnlinks href=#hl-29-270>270</a>
</span><span class=lnt id=hl-29-271><a class=lnlinks href=#hl-29-271>271</a>
</span><span class=lnt id=hl-29-272><a class=lnlinks href=#hl-29-272>272</a>
</span><span class=lnt id=hl-29-273><a class=lnlinks href=#hl-29-273>273</a>
</span><span class=lnt id=hl-29-274><a class=lnlinks href=#hl-29-274>274</a>
</span><span class=lnt id=hl-29-275><a class=lnlinks href=#hl-29-275>275</a>
</span><span class=lnt id=hl-29-276><a class=lnlinks href=#hl-29-276>276</a>
</span><span class=lnt id=hl-29-277><a class=lnlinks href=#hl-29-277>277</a>
</span><span class=lnt id=hl-29-278><a class=lnlinks href=#hl-29-278>278</a>
</span><span class=lnt id=hl-29-279><a class=lnlinks href=#hl-29-279>279</a>
</span><span class=lnt id=hl-29-280><a class=lnlinks href=#hl-29-280>280</a>
</span><span class=lnt id=hl-29-281><a class=lnlinks href=#hl-29-281>281</a>
</span><span class=lnt id=hl-29-282><a class=lnlinks href=#hl-29-282>282</a>
</span><span class=lnt id=hl-29-283><a class=lnlinks href=#hl-29-283>283</a>
</span><span class=lnt id=hl-29-284><a class=lnlinks href=#hl-29-284>284</a>
</span><span class=lnt id=hl-29-285><a class=lnlinks href=#hl-29-285>285</a>
</span><span class=lnt id=hl-29-286><a class=lnlinks href=#hl-29-286>286</a>
</span><span class=lnt id=hl-29-287><a class=lnlinks href=#hl-29-287>287</a>
</span><span class=lnt id=hl-29-288><a class=lnlinks href=#hl-29-288>288</a>
</span><span class=lnt id=hl-29-289><a class=lnlinks href=#hl-29-289>289</a>
</span><span class=lnt id=hl-29-290><a class=lnlinks href=#hl-29-290>290</a>
</span><span class=lnt id=hl-29-291><a class=lnlinks href=#hl-29-291>291</a>
</span><span class=lnt id=hl-29-292><a class=lnlinks href=#hl-29-292>292</a>
</span><span class=lnt id=hl-29-293><a class=lnlinks href=#hl-29-293>293</a>
</span><span class=lnt id=hl-29-294><a class=lnlinks href=#hl-29-294>294</a>
</span><span class=lnt id=hl-29-295><a class=lnlinks href=#hl-29-295>295</a>
</span><span class=lnt id=hl-29-296><a class=lnlinks href=#hl-29-296>296</a>
</span><span class=lnt id=hl-29-297><a class=lnlinks href=#hl-29-297>297</a>
</span><span class=lnt id=hl-29-298><a class=lnlinks href=#hl-29-298>298</a>
</span><span class=lnt id=hl-29-299><a class=lnlinks href=#hl-29-299>299</a>
</span><span class=lnt id=hl-29-300><a class=lnlinks href=#hl-29-300>300</a>
</span><span class=lnt id=hl-29-301><a class=lnlinks href=#hl-29-301>301</a>
</span><span class=lnt id=hl-29-302><a class=lnlinks href=#hl-29-302>302</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>경계 설계 실습: &#34;주문 생성(동기 트랜잭션) → 알림/영수증 발행(비동기 큐)&#34;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>구성요소
</span></span></span><span class=line><span class=cl><span class=s2>- 동기: SQLite 트랜잭션(Orders + Outbox)  ← 경계
</span></span></span><span class=line><span class=cl><span class=s2>- 비동기: Outbox Dispatcher → Redis Queue → Workers(알림/영수증)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>모드
</span></span></span><span class=line><span class=cl><span class=s2>- setup-db         : SQLite 스키마 생성
</span></span></span><span class=line><span class=cl><span class=s2>- api              : Flask API 서버(POST /orders)
</span></span></span><span class=line><span class=cl><span class=s2>- dispatcher       : Outbox 미처리 이벤트를 Redis 큐로 전송
</span></span></span><span class=line><span class=cl><span class=s2>- worker-notify    : 알림 이벤트 소비/발송(Stub)
</span></span></span><span class=line><span class=cl><span class=s2>- worker-receipt   : 영수증 발행 이벤트 소비/처리(Stub)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>의존
</span></span></span><span class=line><span class=cl><span class=s2>- pip install flask redis
</span></span></span><span class=line><span class=cl><span class=s2>- REDIS_URL=redis://localhost:6379
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>time</span><span class=o>,</span> <span class=nn>argparse</span><span class=o>,</span> <span class=nn>sqlite3</span><span class=o>,</span> <span class=nn>signal</span><span class=o>,</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timezone</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Tuple</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DB_PATH</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;DB_PATH&#34;</span><span class=p>,</span> <span class=s2>&#34;orders.db&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>REDIS_URL</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;REDIS_URL&#34;</span><span class=p>,</span> <span class=s2>&#34;redis://localhost:6379&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Q_NOTIFY</span> <span class=o>=</span> <span class=s2>&#34;q:notify&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Q_RECEIPT</span> <span class=o>=</span> <span class=s2>&#34;q:receipt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>STOP</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>now_iso</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>)</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>connect_db</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>Connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># check_same_thread=False → Flask/다중 스레드 접근 허용(간단 실습용)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>DB_PATH</span><span class=p>,</span> <span class=n>check_same_thread</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>row_factory</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>Row</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>conn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>log</span><span class=p>(</span><span class=n>tag</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span><span class=si>}</span><span class=s2>] [</span><span class=si>{</span><span class=n>tag</span><span class=si>}</span><span class=s2>] </span><span class=si>{</span><span class=n>data</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=c1># 1) DB 스키마</span>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>setup_db</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>connect_db</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>executescript</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        PRAGMA journal_mode=WAL;
</span></span></span><span class=line><span class=cl><span class=s2>        PRAGMA synchronous=NORMAL;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        CREATE TABLE IF NOT EXISTS orders(
</span></span></span><span class=line><span class=cl><span class=s2>            id TEXT PRIMARY KEY,
</span></span></span><span class=line><span class=cl><span class=s2>            user_id TEXT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>            amount INTEGER NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>            status TEXT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>            created_at TEXT NOT NULL
</span></span></span><span class=line><span class=cl><span class=s2>        );
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        /* Outbox: 트랜잭션과 함께 커밋되는 &#34;미래 작업&#34; 저장소 */
</span></span></span><span class=line><span class=cl><span class=s2>        CREATE TABLE IF NOT EXISTS outbox(
</span></span></span><span class=line><span class=cl><span class=s2>            id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span></span><span class=line><span class=cl><span class=s2>            event_type TEXT NOT NULL,      -- &#39;NotifyUser&#39; | &#39;IssueReceipt&#39;
</span></span></span><span class=line><span class=cl><span class=s2>            payload TEXT NOT NULL,         -- JSON 문자열
</span></span></span><span class=line><span class=cl><span class=s2>            created_at TEXT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>            dispatched INTEGER NOT NULL DEFAULT 0,  -- 0: 미전송, 1: 전송됨
</span></span></span><span class=line><span class=cl><span class=s2>            dispatched_at TEXT
</span></span></span><span class=line><span class=cl><span class=s2>        );
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        /* 영수증(비동기 처리 결과) 저장 */
</span></span></span><span class=line><span class=cl><span class=s2>        CREATE TABLE IF NOT EXISTS receipts(
</span></span></span><span class=line><span class=cl><span class=s2>            id TEXT PRIMARY KEY,
</span></span></span><span class=line><span class=cl><span class=s2>            order_id TEXT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>            issued_at TEXT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>            FOREIGN KEY(order_id) REFERENCES orders(id)
</span></span></span><span class=line><span class=cl><span class=s2>        );
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=p>(</span><span class=s2>&#34;SETUP-DB&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;initialized at </span><span class=si>{</span><span class=n>DB_PATH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=c1># 2) API(동기 트랜잭션 경계): 주문 + 아웃박스 삽입까지 원자적 커밋</span>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start_api</span><span class=p>(</span><span class=n>port</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>connect_db</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/orders&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;POST&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_order</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        동기 트랜잭션:
</span></span></span><span class=line><span class=cl><span class=s2>          BEGIN;
</span></span></span><span class=line><span class=cl><span class=s2>            - 주문 행 삽입
</span></span></span><span class=line><span class=cl><span class=s2>            - outbox에 NotifyUser, IssueReceipt 이벤트 삽입
</span></span></span><span class=line><span class=cl><span class=s2>          COMMIT;
</span></span></span><span class=line><span class=cl><span class=s2>        실패 시 전체 롤백 → &#39;주문만 있고 이벤트 없음&#39; 같은 불일치가 발생하지 않음.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>body</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>get_json</span><span class=p>(</span><span class=n>force</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=ow>or</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>user_id</span> <span class=o>=</span> <span class=n>body</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;user_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>amount</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>body</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;amount&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>user_id</span> <span class=ow>or</span> <span class=n>amount</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;ok&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;user_id와 amount가 필요합니다.&#34;</span><span class=p>}),</span> <span class=mi>400</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>order_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;BEGIN&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;INSERT INTO orders(id, user_id, amount, status, created_at) VALUES (?, ?, ?, ?, ?)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=s2>&#34;CREATED&#34;</span><span class=p>,</span> <span class=n>now_iso</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># Outbox 이벤트 2건 삽입(알림, 영수증)</span>
</span></span><span class=line><span class=cl>            <span class=n>notify_payload</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span> <span class=s2>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;ORDER_CREATED&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=n>receipt_payload</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>amount</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;INSERT INTO outbox(event_type, payload, created_at) VALUES (?, ?, ?)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=s2>&#34;NotifyUser&#34;</span><span class=p>,</span> <span class=n>notify_payload</span><span class=p>,</span> <span class=n>now_iso</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;INSERT INTO outbox(event_type, payload, created_at) VALUES (?, ?, ?)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=s2>&#34;IssueReceipt&#34;</span><span class=p>,</span> <span class=n>receipt_payload</span><span class=p>,</span> <span class=n>now_iso</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=p>(</span><span class=s2>&#34;API:CREATE-ORDER&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>amount</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;ok&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=p>(</span><span class=s2>&#34;API:ERROR&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s2>&#34;ok&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}),</span> <span class=mi>500</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/orders&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;GET&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>list_orders</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>rows</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM orders ORDER BY created_at DESC LIMIT 50&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>([</span><span class=nb>dict</span><span class=p>(</span><span class=n>r</span><span class=p>)</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/receipts&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;GET&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>list_receipts</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>rows</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM receipts ORDER BY issued_at DESC LIMIT 50&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>([</span><span class=nb>dict</span><span class=p>(</span><span class=n>r</span><span class=p>)</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=n>port</span><span class=p>,</span> <span class=n>debug</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=c1># 3) Outbox Dispatcher(동기 커밋된 이벤트 → 비동기 큐)</span>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start_dispatcher</span><span class=p>(</span><span class=n>poll_interval</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.5</span><span class=p>,</span> <span class=n>batch</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>50</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Outbox에서 dispatched=0 레코드를 찾아 &#39;전송 표시 + 전송시간&#39;을 원자적으로 찍고,
</span></span></span><span class=line><span class=cl><span class=s2>    그 다음 Redis 큐로 push한다. (간단한 2단계이지만, 실무에선 락/상태전이 더 정교화)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>connect_db</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>from_url</span><span class=p>(</span><span class=n>REDIS_URL</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=p>(</span><span class=s2>&#34;DISPATCHER:START&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;redis&#34;</span><span class=p>:</span> <span class=n>REDIS_URL</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=ow>not</span> <span class=n>STOP</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># 미전송 이벤트 조회</span>
</span></span><span class=line><span class=cl>        <span class=n>rows</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;SELECT id, event_type, payload FROM outbox WHERE dispatched=0 ORDER BY id ASC LIMIT ?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=n>batch</span><span class=p>,),</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>poll_interval</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>oid</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>etype</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=s2>&#34;event_type&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=s2>&#34;payload&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 1) 먼저 dispatched=1로 마킹(경쟁 방지: WHERE dispatched=0)</span>
</span></span><span class=line><span class=cl>                <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;UPDATE outbox SET dispatched=1, dispatched_at=? WHERE id=? AND dispatched=0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=p>(</span><span class=n>now_iso</span><span class=p>(),</span> <span class=n>oid</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>cur</span><span class=o>.</span><span class=n>rowcount</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 다른 디스패처가 선점</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1># 2) 큐로 전송</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>etype</span> <span class=o>==</span> <span class=s2>&#34;NotifyUser&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>r</span><span class=o>.</span><span class=n>lpush</span><span class=p>(</span><span class=n>Q_NOTIFY</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>elif</span> <span class=n>etype</span> <span class=o>==</span> <span class=s2>&#34;IssueReceipt&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>r</span><span class=o>.</span><span class=n>lpush</span><span class=p>(</span><span class=n>Q_RECEIPT</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>log</span><span class=p>(</span><span class=s2>&#34;DISPATCHER:WARN&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;unknown event_type=</span><span class=si>{</span><span class=n>etype</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>log</span><span class=p>(</span><span class=s2>&#34;DISPATCHER:PUSH&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=n>oid</span><span class=p>,</span> <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=n>etype</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>log</span><span class=p>(</span><span class=s2>&#34;DISPATCHER:ERROR&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=c1># 롤백되면 dispatched=0 상태 유지 → 다음 루프에서 재시도</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.05</span><span class=p>)</span>  <span class=c1># 너무 바쁘지 않게 쉬어줌</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=c1># 4) Workers(비동기 큐 소비자)</span>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start_worker_notify</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    알림 워커: NotifyUser 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=s2>    - 실제 SMS/이메일/푸시는 외부 연동이지만 여기선 콘솔로 대체
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>from_url</span><span class=p>(</span><span class=n>REDIS_URL</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=p>(</span><span class=s2>&#34;WORKER:NOTIFY:START&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;queue&#34;</span><span class=p>:</span> <span class=n>Q_NOTIFY</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=ow>not</span> <span class=n>STOP</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>brpop</span><span class=p>(</span><span class=n>Q_NOTIFY</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># (queue, payload)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>item</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            <span class=n>_</span><span class=p>,</span> <span class=n>payload</span> <span class=o>=</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># 실제로는 템플릿/채널 라우팅/멱등키 검증 등 수행</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=p>(</span><span class=s2>&#34;WORKER:NOTIFY:SEND&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;user_id&#34;</span><span class=p>],</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>],</span> <span class=s2>&#34;kind&#34;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;kind&#34;</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=p>(</span><span class=s2>&#34;WORKER:NOTIFY:ERROR&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start_worker_receipt</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    영수증 워커: IssueReceipt 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=s2>    - 단순히 receipts 테이블에 발행 기록을 남김(실무에선 PDF 생성/저장/메일첨부 등)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>from_url</span><span class=p>(</span><span class=n>REDIS_URL</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>connect_db</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=p>(</span><span class=s2>&#34;WORKER:RECEIPT:START&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;queue&#34;</span><span class=p>:</span> <span class=n>Q_RECEIPT</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=ow>not</span> <span class=n>STOP</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>brpop</span><span class=p>(</span><span class=n>Q_RECEIPT</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>item</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            <span class=n>_</span><span class=p>,</span> <span class=n>payload</span> <span class=o>=</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>receipt_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;INSERT INTO receipts(id, order_id, issued_at) VALUES (?, ?, ?)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>receipt_id</span><span class=p>,</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>],</span> <span class=n>now_iso</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=p>(</span><span class=s2>&#34;WORKER:RECEIPT:ISSUED&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;receipt_id&#34;</span><span class=p>:</span> <span class=n>receipt_id</span><span class=p>,</span> <span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>],</span> <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;amount&#34;</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=p>(</span><span class=s2>&#34;WORKER:RECEIPT:ERROR&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=c1># 유틸: 종료 핸들러</span>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>install_signal_handlers</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_h</span><span class=p>(</span><span class=n>signum</span><span class=p>,</span> <span class=n>frame</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>global</span> <span class=n>STOP</span>
</span></span><span class=line><span class=cl>        <span class=n>STOP</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=p>(</span><span class=s2>&#34;SIGNAL&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;stop=</span><span class=si>{</span><span class=n>signum</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGINT</span><span class=p>,</span> <span class=n>signal</span><span class=o>.</span><span class=n>SIGTERM</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>_h</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=c1># main</span>
</span></span><span class=line><span class=cl><span class=c1># ──────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>install_signal_handlers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ap</span> <span class=o>=</span> <span class=n>argparse</span><span class=o>.</span><span class=n>ArgumentParser</span><span class=p>(</span><span class=n>description</span><span class=o>=</span><span class=s2>&#34;Order Boundary Case: Sync Order + Async Notification/Receipt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sub</span> <span class=o>=</span> <span class=n>ap</span><span class=o>.</span><span class=n>add_subparsers</span><span class=p>(</span><span class=n>dest</span><span class=o>=</span><span class=s2>&#34;cmd&#34;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sub</span><span class=o>.</span><span class=n>add_parser</span><span class=p>(</span><span class=s2>&#34;setup-db&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p_api</span> <span class=o>=</span> <span class=n>sub</span><span class=o>.</span><span class=n>add_parser</span><span class=p>(</span><span class=s2>&#34;api&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p_api</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--port&#34;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>5000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sub</span><span class=o>.</span><span class=n>add_parser</span><span class=p>(</span><span class=s2>&#34;dispatcher&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sub</span><span class=o>.</span><span class=n>add_parser</span><span class=p>(</span><span class=s2>&#34;worker-notify&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sub</span><span class=o>.</span><span class=n>add_parser</span><span class=p>(</span><span class=s2>&#34;worker-receipt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=n>ap</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>cmd</span> <span class=o>==</span> <span class=s2>&#34;setup-db&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>setup_db</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>cmd</span> <span class=o>==</span> <span class=s2>&#34;api&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>start_api</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>cmd</span> <span class=o>==</span> <span class=s2>&#34;dispatcher&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>start_dispatcher</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>cmd</span> <span class=o>==</span> <span class=s2>&#34;worker-notify&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>start_worker_notify</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>args</span><span class=o>.</span><span class=n>cmd</span> <span class=o>==</span> <span class=s2>&#34;worker-receipt&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>start_worker_receipt</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=설계-포인트-경계가-드러나는-지점>설계 포인트 (경계가 드러나는 지점)<a hidden class=anchor aria-hidden=true href=#설계-포인트-경계가-드러나는-지점>#</a></h6><ul><li><strong>동기 경계 (트랜잭션)</strong>: <code>/orders</code> 에서 <strong>주문 + outbox</strong>를 <strong>하나의 트랜잭션</strong>으로 커밋. 부분 성공/실패가 없음.</li><li><strong>비동기 경계</strong>: <strong>Dispatcher</strong>가 outbox 를 읽어 <strong>큐</strong>로 넘김. 이후 <strong>워커</strong>가 느긋하게 처리 (알림/영수증).</li><li><strong>멱등성/중복 방지</strong>: outbox 에서 <code>dispatched=1</code> 상태 전이 (UPDATE … WHERE dispatched=0) 로 <strong>중복 전송 최소화</strong>.</li><li><strong>확장 포인트</strong>:<ul><li>Redis List → <strong>Redis Streams(컨슈머 그룹)</strong> 또는 Kafka 로 교체 가능</li><li>영수증 워커에 <strong>PDF 생성/메일 첨부</strong> 추가</li><li>알림 워커에 <strong>채널 라우팅 (푸시/SMS/이메일) + 재시도/지수백오프 + DLQ</strong> 추가</li></ul></li></ul><h5 id=outbox-패턴-기반-이벤트-처리-설계>Outbox 패턴 기반 이벤트 처리 설계<a hidden class=anchor aria-hidden=true href=#outbox-패턴-기반-이벤트-처리-설계>#</a></h5><p><strong>핵심 원칙</strong>:</p><ul><li>동기 트랜잭션 경계에서 &rsquo; 주문 + Outbox&rsquo; 까지 원자 커밋 → 비동기 디스패처가 큐로 전달 → 워커가 재시도·DLQ 포함 처리.</li></ul><h6 id=아키텍처-개요>아키텍처 개요<a hidden class=anchor aria-hidden=true href=#아키텍처-개요>#</a></h6><pre class=mermaid>graph TB
    C[Client] --&gt; A[Sync API]
    A --&gt; T[DB Transaction]
    T --&gt; ORDERS[(orders)]
    T --&gt; OUTBOX[(outbox)]
    T --&gt; OK[commit]
    D[Outbox Dispatcher] --&gt; OUTBOX
    D --&gt; Q[(Queue/Broker)]
    W1[Worker: Notification] --&gt; Q
    W2[Worker: Receipt] --&gt; Q
    W1 --&gt; EXT[External Services]
    W2 --&gt; SIDE[(Side Effects)]
    W1 --&gt; DLQ[(DLQ)]
    W2 --&gt; DLQ
</pre><h6 id=workflow>Workflow<a hidden class=anchor aria-hidden=true href=#workflow>#</a></h6><pre class=mermaid>sequenceDiagram
    participant C as Client
    participant API as Sync API
    participant DB as Database
    participant DSP as Dispatcher
    participant Q as Queue
    participant W as Worker
    participant S as External

    C-&gt;&gt;API: POST /orders
    API-&gt;&gt;DB: BEGIN
    API-&gt;&gt;DB: INSERT orders
    API-&gt;&gt;DB: INSERT outbox(events)
    API-&gt;&gt;DB: COMMIT
    API--&gt;&gt;C: 200 OK (order_id)

    DSP-&gt;&gt;DB: SELECT outbox WHERE dispatched=0
    DSP-&gt;&gt;DB: UPDATE outbox SET dispatched=1 WHERE id=... AND dispatched=0
    DSP-&gt;&gt;Q: ENQUEUE event

    W-&gt;&gt;Q: CONSUME event
    W-&gt;&gt;S: Send notification / Issue receipt
    W-&gt;&gt;Q: ACK or RETRY
    W-&gt;&gt;DLQ: after max attempts
</pre><h6 id=표준-스키마-예시-rdb-공통-sql>표준 스키마 (예시, RDB 공통 SQL)<a hidden class=anchor aria-hidden=true href=#표준-스키마-예시-rdb-공통-sql>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10>10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11>11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12>12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13>13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14>14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15>15</a>
</span><span class=lnt id=hl-32-16><a class=lnlinks href=#hl-32-16>16</a>
</span><span class=lnt id=hl-32-17><a class=lnlinks href=#hl-32-17>17</a>
</span><span class=lnt id=hl-32-18><a class=lnlinks href=#hl-32-18>18</a>
</span><span class=lnt id=hl-32-19><a class=lnlinks href=#hl-32-19>19</a>
</span><span class=lnt id=hl-32-20><a class=lnlinks href=#hl-32-20>20</a>
</span><span class=lnt id=hl-32-21><a class=lnlinks href=#hl-32-21>21</a>
</span><span class=lnt id=hl-32-22><a class=lnlinks href=#hl-32-22>22</a>
</span><span class=lnt id=hl-32-23><a class=lnlinks href=#hl-32-23>23</a>
</span><span class=lnt id=hl-32-24><a class=lnlinks href=#hl-32-24>24</a>
</span><span class=lnt id=hl-32-25><a class=lnlinks href=#hl-32-25>25</a>
</span><span class=lnt id=hl-32-26><a class=lnlinks href=#hl-32-26>26</a>
</span><span class=lnt id=hl-32-27><a class=lnlinks href=#hl-32-27>27</a>
</span><span class=lnt id=hl-32-28><a class=lnlinks href=#hl-32-28>28</a>
</span><span class=lnt id=hl-32-29><a class=lnlinks href=#hl-32-29>29</a>
</span><span class=lnt id=hl-32-30><a class=lnlinks href=#hl-32-30>30</a>
</span><span class=lnt id=hl-32-31><a class=lnlinks href=#hl-32-31>31</a>
</span><span class=lnt id=hl-32-32><a class=lnlinks href=#hl-32-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 주문
</span></span></span><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>id</span><span class=w>           </span><span class=n>UUID</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>user_id</span><span class=w>      </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>amount</span><span class=w>       </span><span class=nb>BIGINT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>status</span><span class=w>       </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;CREATED&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>created_at</span><span class=w>   </span><span class=n>TIMESTAMPTZ</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>-- Outbox (트랜잭션 경계 안에서 함께 커밋)
</span></span></span><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>outbox</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>id</span><span class=w>              </span><span class=n>BIGSERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>event_type</span><span class=w>      </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>                  </span><span class=c1>-- &#39;NotifyUser&#39; | &#39;IssueReceipt&#39; | ...
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>aggregate_id</span><span class=w>    </span><span class=n>UUID</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>                  </span><span class=c1>-- order_id 등
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>idem_key</span><span class=w>        </span><span class=nb>TEXT</span><span class=p>,</span><span class=w>                           </span><span class=c1>-- 멱등 키(옵션)
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>payload</span><span class=w>         </span><span class=n>JSONB</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>created_at</span><span class=w>      </span><span class=n>TIMESTAMPTZ</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>now</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>dispatched</span><span class=w>      </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>FALSE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>dispatched_at</span><span class=w>   </span><span class=n>TIMESTAMPTZ</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_outbox_undispatched</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>outbox</span><span class=w> </span><span class=p>(</span><span class=n>dispatched</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>ux_outbox_idem</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>outbox</span><span class=w> </span><span class=p>(</span><span class=n>idem_key</span><span class=p>)</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>idem_key</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>-- DLQ 보관(옵션)
</span></span></span><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dlq</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>id</span><span class=w>            </span><span class=n>BIGSERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>event_type</span><span class=w>    </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>payload</span><span class=w>       </span><span class=n>JSONB</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>error</span><span class=w>         </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>attempts</span><span class=w>      </span><span class=nb>INT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>created_at</span><span class=w>    </span><span class=n>TIMESTAMPTZ</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>이벤트 엔벨롭 (권장 JSON 스키마)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event_id&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;NotifyUser&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;aggregate_id&#34;</span><span class=p>:</span> <span class=s2>&#34;order-uuid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;occurred_at&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-08-14T12:00:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;attempts&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;idem_key&#34;</span><span class=p>:</span> <span class=s2>&#34;order-{uuid}-notify&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;order-uuid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user_id&#34;</span><span class=p>:</span> <span class=s2>&#34;u-123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;amount&#34;</span><span class=p>:</span> <span class=mi>19900</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=python-표준-템플릿>Python 표준 템플릿<a hidden class=anchor aria-hidden=true href=#python-표준-템플릿>#</a></h6><blockquote><p>의존: <code>psycopg</code>(또는 <code>sqlite3</code> 로 대체), <code>redis</code><br>큐는 Redis <strong>Streams</strong>(권장) 또는 List 로 대체 가능. 여기선 Streams 예시.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1>  1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2>  2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3>  3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4>  4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5>  5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6>  6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7>  7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8>  8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9>  9</a>
</span><span class=lnt id=hl-34-10><a class=lnlinks href=#hl-34-10> 10</a>
</span><span class=lnt id=hl-34-11><a class=lnlinks href=#hl-34-11> 11</a>
</span><span class=lnt id=hl-34-12><a class=lnlinks href=#hl-34-12> 12</a>
</span><span class=lnt id=hl-34-13><a class=lnlinks href=#hl-34-13> 13</a>
</span><span class=lnt id=hl-34-14><a class=lnlinks href=#hl-34-14> 14</a>
</span><span class=lnt id=hl-34-15><a class=lnlinks href=#hl-34-15> 15</a>
</span><span class=lnt id=hl-34-16><a class=lnlinks href=#hl-34-16> 16</a>
</span><span class=lnt id=hl-34-17><a class=lnlinks href=#hl-34-17> 17</a>
</span><span class=lnt id=hl-34-18><a class=lnlinks href=#hl-34-18> 18</a>
</span><span class=lnt id=hl-34-19><a class=lnlinks href=#hl-34-19> 19</a>
</span><span class=lnt id=hl-34-20><a class=lnlinks href=#hl-34-20> 20</a>
</span><span class=lnt id=hl-34-21><a class=lnlinks href=#hl-34-21> 21</a>
</span><span class=lnt id=hl-34-22><a class=lnlinks href=#hl-34-22> 22</a>
</span><span class=lnt id=hl-34-23><a class=lnlinks href=#hl-34-23> 23</a>
</span><span class=lnt id=hl-34-24><a class=lnlinks href=#hl-34-24> 24</a>
</span><span class=lnt id=hl-34-25><a class=lnlinks href=#hl-34-25> 25</a>
</span><span class=lnt id=hl-34-26><a class=lnlinks href=#hl-34-26> 26</a>
</span><span class=lnt id=hl-34-27><a class=lnlinks href=#hl-34-27> 27</a>
</span><span class=lnt id=hl-34-28><a class=lnlinks href=#hl-34-28> 28</a>
</span><span class=lnt id=hl-34-29><a class=lnlinks href=#hl-34-29> 29</a>
</span><span class=lnt id=hl-34-30><a class=lnlinks href=#hl-34-30> 30</a>
</span><span class=lnt id=hl-34-31><a class=lnlinks href=#hl-34-31> 31</a>
</span><span class=lnt id=hl-34-32><a class=lnlinks href=#hl-34-32> 32</a>
</span><span class=lnt id=hl-34-33><a class=lnlinks href=#hl-34-33> 33</a>
</span><span class=lnt id=hl-34-34><a class=lnlinks href=#hl-34-34> 34</a>
</span><span class=lnt id=hl-34-35><a class=lnlinks href=#hl-34-35> 35</a>
</span><span class=lnt id=hl-34-36><a class=lnlinks href=#hl-34-36> 36</a>
</span><span class=lnt id=hl-34-37><a class=lnlinks href=#hl-34-37> 37</a>
</span><span class=lnt id=hl-34-38><a class=lnlinks href=#hl-34-38> 38</a>
</span><span class=lnt id=hl-34-39><a class=lnlinks href=#hl-34-39> 39</a>
</span><span class=lnt id=hl-34-40><a class=lnlinks href=#hl-34-40> 40</a>
</span><span class=lnt id=hl-34-41><a class=lnlinks href=#hl-34-41> 41</a>
</span><span class=lnt id=hl-34-42><a class=lnlinks href=#hl-34-42> 42</a>
</span><span class=lnt id=hl-34-43><a class=lnlinks href=#hl-34-43> 43</a>
</span><span class=lnt id=hl-34-44><a class=lnlinks href=#hl-34-44> 44</a>
</span><span class=lnt id=hl-34-45><a class=lnlinks href=#hl-34-45> 45</a>
</span><span class=lnt id=hl-34-46><a class=lnlinks href=#hl-34-46> 46</a>
</span><span class=lnt id=hl-34-47><a class=lnlinks href=#hl-34-47> 47</a>
</span><span class=lnt id=hl-34-48><a class=lnlinks href=#hl-34-48> 48</a>
</span><span class=lnt id=hl-34-49><a class=lnlinks href=#hl-34-49> 49</a>
</span><span class=lnt id=hl-34-50><a class=lnlinks href=#hl-34-50> 50</a>
</span><span class=lnt id=hl-34-51><a class=lnlinks href=#hl-34-51> 51</a>
</span><span class=lnt id=hl-34-52><a class=lnlinks href=#hl-34-52> 52</a>
</span><span class=lnt id=hl-34-53><a class=lnlinks href=#hl-34-53> 53</a>
</span><span class=lnt id=hl-34-54><a class=lnlinks href=#hl-34-54> 54</a>
</span><span class=lnt id=hl-34-55><a class=lnlinks href=#hl-34-55> 55</a>
</span><span class=lnt id=hl-34-56><a class=lnlinks href=#hl-34-56> 56</a>
</span><span class=lnt id=hl-34-57><a class=lnlinks href=#hl-34-57> 57</a>
</span><span class=lnt id=hl-34-58><a class=lnlinks href=#hl-34-58> 58</a>
</span><span class=lnt id=hl-34-59><a class=lnlinks href=#hl-34-59> 59</a>
</span><span class=lnt id=hl-34-60><a class=lnlinks href=#hl-34-60> 60</a>
</span><span class=lnt id=hl-34-61><a class=lnlinks href=#hl-34-61> 61</a>
</span><span class=lnt id=hl-34-62><a class=lnlinks href=#hl-34-62> 62</a>
</span><span class=lnt id=hl-34-63><a class=lnlinks href=#hl-34-63> 63</a>
</span><span class=lnt id=hl-34-64><a class=lnlinks href=#hl-34-64> 64</a>
</span><span class=lnt id=hl-34-65><a class=lnlinks href=#hl-34-65> 65</a>
</span><span class=lnt id=hl-34-66><a class=lnlinks href=#hl-34-66> 66</a>
</span><span class=lnt id=hl-34-67><a class=lnlinks href=#hl-34-67> 67</a>
</span><span class=lnt id=hl-34-68><a class=lnlinks href=#hl-34-68> 68</a>
</span><span class=lnt id=hl-34-69><a class=lnlinks href=#hl-34-69> 69</a>
</span><span class=lnt id=hl-34-70><a class=lnlinks href=#hl-34-70> 70</a>
</span><span class=lnt id=hl-34-71><a class=lnlinks href=#hl-34-71> 71</a>
</span><span class=lnt id=hl-34-72><a class=lnlinks href=#hl-34-72> 72</a>
</span><span class=lnt id=hl-34-73><a class=lnlinks href=#hl-34-73> 73</a>
</span><span class=lnt id=hl-34-74><a class=lnlinks href=#hl-34-74> 74</a>
</span><span class=lnt id=hl-34-75><a class=lnlinks href=#hl-34-75> 75</a>
</span><span class=lnt id=hl-34-76><a class=lnlinks href=#hl-34-76> 76</a>
</span><span class=lnt id=hl-34-77><a class=lnlinks href=#hl-34-77> 77</a>
</span><span class=lnt id=hl-34-78><a class=lnlinks href=#hl-34-78> 78</a>
</span><span class=lnt id=hl-34-79><a class=lnlinks href=#hl-34-79> 79</a>
</span><span class=lnt id=hl-34-80><a class=lnlinks href=#hl-34-80> 80</a>
</span><span class=lnt id=hl-34-81><a class=lnlinks href=#hl-34-81> 81</a>
</span><span class=lnt id=hl-34-82><a class=lnlinks href=#hl-34-82> 82</a>
</span><span class=lnt id=hl-34-83><a class=lnlinks href=#hl-34-83> 83</a>
</span><span class=lnt id=hl-34-84><a class=lnlinks href=#hl-34-84> 84</a>
</span><span class=lnt id=hl-34-85><a class=lnlinks href=#hl-34-85> 85</a>
</span><span class=lnt id=hl-34-86><a class=lnlinks href=#hl-34-86> 86</a>
</span><span class=lnt id=hl-34-87><a class=lnlinks href=#hl-34-87> 87</a>
</span><span class=lnt id=hl-34-88><a class=lnlinks href=#hl-34-88> 88</a>
</span><span class=lnt id=hl-34-89><a class=lnlinks href=#hl-34-89> 89</a>
</span><span class=lnt id=hl-34-90><a class=lnlinks href=#hl-34-90> 90</a>
</span><span class=lnt id=hl-34-91><a class=lnlinks href=#hl-34-91> 91</a>
</span><span class=lnt id=hl-34-92><a class=lnlinks href=#hl-34-92> 92</a>
</span><span class=lnt id=hl-34-93><a class=lnlinks href=#hl-34-93> 93</a>
</span><span class=lnt id=hl-34-94><a class=lnlinks href=#hl-34-94> 94</a>
</span><span class=lnt id=hl-34-95><a class=lnlinks href=#hl-34-95> 95</a>
</span><span class=lnt id=hl-34-96><a class=lnlinks href=#hl-34-96> 96</a>
</span><span class=lnt id=hl-34-97><a class=lnlinks href=#hl-34-97> 97</a>
</span><span class=lnt id=hl-34-98><a class=lnlinks href=#hl-34-98> 98</a>
</span><span class=lnt id=hl-34-99><a class=lnlinks href=#hl-34-99> 99</a>
</span><span class=lnt id=hl-34-100><a class=lnlinks href=#hl-34-100>100</a>
</span><span class=lnt id=hl-34-101><a class=lnlinks href=#hl-34-101>101</a>
</span><span class=lnt id=hl-34-102><a class=lnlinks href=#hl-34-102>102</a>
</span><span class=lnt id=hl-34-103><a class=lnlinks href=#hl-34-103>103</a>
</span><span class=lnt id=hl-34-104><a class=lnlinks href=#hl-34-104>104</a>
</span><span class=lnt id=hl-34-105><a class=lnlinks href=#hl-34-105>105</a>
</span><span class=lnt id=hl-34-106><a class=lnlinks href=#hl-34-106>106</a>
</span><span class=lnt id=hl-34-107><a class=lnlinks href=#hl-34-107>107</a>
</span><span class=lnt id=hl-34-108><a class=lnlinks href=#hl-34-108>108</a>
</span><span class=lnt id=hl-34-109><a class=lnlinks href=#hl-34-109>109</a>
</span><span class=lnt id=hl-34-110><a class=lnlinks href=#hl-34-110>110</a>
</span><span class=lnt id=hl-34-111><a class=lnlinks href=#hl-34-111>111</a>
</span><span class=lnt id=hl-34-112><a class=lnlinks href=#hl-34-112>112</a>
</span><span class=lnt id=hl-34-113><a class=lnlinks href=#hl-34-113>113</a>
</span><span class=lnt id=hl-34-114><a class=lnlinks href=#hl-34-114>114</a>
</span><span class=lnt id=hl-34-115><a class=lnlinks href=#hl-34-115>115</a>
</span><span class=lnt id=hl-34-116><a class=lnlinks href=#hl-34-116>116</a>
</span><span class=lnt id=hl-34-117><a class=lnlinks href=#hl-34-117>117</a>
</span><span class=lnt id=hl-34-118><a class=lnlinks href=#hl-34-118>118</a>
</span><span class=lnt id=hl-34-119><a class=lnlinks href=#hl-34-119>119</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># requirements: psycopg[binary] redis==5.*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>time</span><span class=o>,</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timezone</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redis</span> <span class=kn>import</span> <span class=n>Redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PG_DSN</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;PG_DSN&#34;</span><span class=p>,</span> <span class=s2>&#34;dbname=app user=app password=app host=localhost&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>REDIS_URL</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;REDIS_URL&#34;</span><span class=p>,</span> <span class=s2>&#34;redis://localhost:6379&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>STREAM</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;STREAM&#34;</span><span class=p>,</span> <span class=s2>&#34;events.outbox&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>GROUP</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;GROUP&#34;</span><span class=p>,</span> <span class=s2>&#34;workers&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>CONSUMER</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;CONSUMER&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;w-</span><span class=si>{</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>now</span><span class=p>():</span> <span class=k>return</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>)</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---------- 1) 동기 트랜잭션: 주문 + Outbox ----------</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_order</span><span class=p>(</span><span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>psycopg</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>PG_DSN</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cur</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;BEGIN&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>order_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                INSERT INTO orders(id, user_id, amount, status, created_at)
</span></span></span><span class=line><span class=cl><span class=s2>                VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, &#39;CREATED&#39;, now())
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>order_id</span><span class=p>,</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>amount</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=c1># Outbox 두 건</span>
</span></span><span class=line><span class=cl>            <span class=n>env_notify</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;event_id&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;NotifyUser&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aggregate_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;occurred_at&#34;</span><span class=p>:</span> <span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;idem_key&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;notify:</span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;attempts&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>env_receipt</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;event_id&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;IssueReceipt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aggregate_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;occurred_at&#34;</span><span class=p>:</span> <span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;idem_key&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;receipt:</span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;attempts&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>order_id</span><span class=p>,</span> <span class=s2>&#34;user_id&#34;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span> <span class=s2>&#34;amount&#34;</span><span class=p>:</span> <span class=n>amount</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                INSERT INTO outbox(event_type, aggregate_id, idem_key, payload)
</span></span></span><span class=line><span class=cl><span class=s2>                VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>)
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=s2>&#34;NotifyUser&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>env_notify</span><span class=p>[</span><span class=s2>&#34;idem_key&#34;</span><span class=p>],</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>env_notify</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                INSERT INTO outbox(event_type, aggregate_id, idem_key, payload)
</span></span></span><span class=line><span class=cl><span class=s2>                VALUES (</span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>)
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=s2>&#34;IssueReceipt&#34;</span><span class=p>,</span> <span class=n>order_id</span><span class=p>,</span> <span class=n>env_receipt</span><span class=p>[</span><span class=s2>&#34;idem_key&#34;</span><span class=p>],</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>env_receipt</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>order_id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---------- 2) 디스패처: Outbox → Stream ----------</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dispatcher</span><span class=p>(</span><span class=n>poll_ms</span><span class=o>=</span><span class=mi>200</span><span class=p>,</span> <span class=n>batch</span><span class=o>=</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>Redis</span><span class=o>.</span><span class=n>from_url</span><span class=p>(</span><span class=n>REDIS_URL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>psycopg</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>PG_DSN</span><span class=p>,</span> <span class=n>autocommit</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>rows</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;SELECT id, payload FROM outbox WHERE dispatched=false ORDER BY id ASC LIMIT </span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>batch</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>poll_ms</span> <span class=o>/</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>oid</span><span class=p>,</span> <span class=n>payload</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 경쟁 방지: 상태 전이(낙관 락) 후 push</span>
</span></span><span class=line><span class=cl>                <span class=n>updated</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;UPDATE outbox SET dispatched=true, dispatched_at=now() WHERE id=</span><span class=si>%s</span><span class=s2> AND dispatched=false&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=p>(</span><span class=n>oid</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span><span class=o>.</span><span class=n>rowcount</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>updated</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>                <span class=c1># Streams로 전송(XADD)</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span><span class=o>.</span><span class=n>xadd</span><span class=p>(</span><span class=n>STREAM</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;event&#34;</span><span class=p>:</span> <span class=n>payload</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=c1># 살짝 휴식</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.02</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---------- 3) 워커: 재시도/DLQ ----------</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ensure_group</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>Redis</span><span class=o>.</span><span class=n>from_url</span><span class=p>(</span><span class=n>REDIS_URL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>xgroup_create</span><span class=p>(</span><span class=n>STREAM</span><span class=p>,</span> <span class=n>GROUP</span><span class=p>,</span> <span class=nb>id</span><span class=o>=</span><span class=s2>&#34;$&#34;</span><span class=p>,</span> <span class=n>mkstream</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>  <span class=c1># 이미 존재</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>worker</span><span class=p>(</span><span class=n>max_attempts</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>backoff_base</span><span class=o>=</span><span class=mf>0.5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>Redis</span><span class=o>.</span><span class=n>from_url</span><span class=p>(</span><span class=n>REDIS_URL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ensure_group</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>resp</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>xreadgroup</span><span class=p>(</span><span class=n>GROUP</span><span class=p>,</span> <span class=n>CONSUMER</span><span class=p>,</span> <span class=p>{</span><span class=n>STREAM</span><span class=p>:</span> <span class=s2>&#34;&gt;&#34;</span><span class=p>},</span> <span class=n>count</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span> <span class=n>block</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>resp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_stream</span><span class=p>,</span> <span class=n>entries</span> <span class=ow>in</span> <span class=n>resp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>entry_id</span><span class=p>,</span> <span class=n>fields</span> <span class=ow>in</span> <span class=n>entries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>env</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>fields</span><span class=p>[</span><span class=sa>b</span><span class=s2>&#34;event&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                    <span class=n>et</span> <span class=o>=</span> <span class=n>env</span><span class=p>[</span><span class=s2>&#34;event_type&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>et</span> <span class=o>==</span> <span class=s2>&#34;NotifyUser&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 실제 발송 로직 자리</span>
</span></span><span class=line><span class=cl>                        <span class=k>pass</span>
</span></span><span class=line><span class=cl>                    <span class=k>elif</span> <span class=n>et</span> <span class=o>==</span> <span class=s2>&#34;IssueReceipt&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 영수증 발행 로직 자리</span>
</span></span><span class=line><span class=cl>                        <span class=k>pass</span>
</span></span><span class=line><span class=cl>                    <span class=n>r</span><span class=o>.</span><span class=n>xack</span><span class=p>(</span><span class=n>STREAM</span><span class=p>,</span> <span class=n>GROUP</span><span class=p>,</span> <span class=n>entry_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 재시도 횟수 증가 및 지수 백오프</span>
</span></span><span class=line><span class=cl>                    <span class=n>env</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>fields</span><span class=p>[</span><span class=sa>b</span><span class=s2>&#34;event&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                    <span class=n>env</span><span class=p>[</span><span class=s2>&#34;attempts&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>env</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;attempts&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>env</span><span class=p>[</span><span class=s2>&#34;attempts&#34;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=n>max_attempts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># DLQ로 이동</span>
</span></span><span class=line><span class=cl>                        <span class=n>r</span><span class=o>.</span><span class=n>lpush</span><span class=p>(</span><span class=s2>&#34;dlq.events&#34;</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=s2>&#34;event&#34;</span><span class=p>:</span> <span class=n>env</span><span class=p>}))</span>
</span></span><span class=line><span class=cl>                        <span class=n>r</span><span class=o>.</span><span class=n>xack</span><span class=p>(</span><span class=n>STREAM</span><span class=p>,</span> <span class=n>GROUP</span><span class=p>,</span> <span class=n>entry_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>delay</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>backoff_base</span> <span class=o>*</span> <span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=p>(</span><span class=n>env</span><span class=p>[</span><span class=s2>&#34;attempts&#34;</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)),</span> <span class=mf>10.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>delay</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 재게시(간단화) 후 원본 ack</span>
</span></span><span class=line><span class=cl>                        <span class=n>r</span><span class=o>.</span><span class=n>xadd</span><span class=p>(</span><span class=n>STREAM</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;event&#34;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>env</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>                        <span class=n>r</span><span class=o>.</span><span class=n>xack</span><span class=p>(</span><span class=n>STREAM</span><span class=p>,</span> <span class=n>GROUP</span><span class=p>,</span> <span class=n>entry_id</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=운영-템플릿-체크리스트>운영 템플릿 (체크리스트)<a hidden class=anchor aria-hidden=true href=#운영-템플릿-체크리스트>#</a></h6><ul><li><strong>경계 규칙</strong>: " 주문 +Outbox&rdquo; 는 <strong>같은 트랜잭션</strong>. 외부 호출은 절대 그 안에 넣지 않는다.</li><li><strong>디스패처 동시성</strong>: <code>UPDATE … WHERE dispatched=false</code> 또는 DB 락/<code>SKIP LOCKED</code> 로 <strong>중복 전송 방지</strong>.</li><li><strong>재시도 정책</strong>: 지수 백오프 + 지터, <strong>최대 시도횟수 초과 시 DLQ</strong> 기록 및 알람.</li><li><strong>멱등성</strong>: <code>idem_key</code> 유니크 제약, 워커의 <strong>중복 처리 안전성</strong> 보장.</li><li><strong>관측성</strong>: 대시보드 (큐 체류시간/lag, 처리율, 재시도율, DLQ 건수, p95), 트레이싱 (Trace-Id 전파).</li><li><strong>SLO 가드</strong>: 타임 예산 전파 (상위 SLA → 디스패처/워커 단계별 타임아웃), 서킷 브레이커 (외부 채널).</li><li><strong>스케일링</strong>: 스트림 파티션/컨슈머 그룹으로 수평 확장, 워커 별 <strong>QoS/우선순위</strong> 분리.</li></ul><h6 id=구성-파라미터-권장-기본값>구성 파라미터 (권장 기본값)<a hidden class=anchor aria-hidden=true href=#구성-파라미터-권장-기본값>#</a></h6><table><thead><tr><th>항목</th><th>기본</th><th>메모</th></tr></thead><tbody><tr><td>worker.maxAttempts</td><td>5</td><td>업무 중요도에 따라 3–7</td></tr><tr><td>worker.backoffBase</td><td>0.5s(Python), 500ms(Node)</td><td>지터 추가 권장</td></tr><tr><td>dispatcher.batch</td><td>100</td><td>DB·브로커 한계 고려</td></tr><tr><td>stream/queue</td><td><code>events.outbox</code></td><td>서비스별 prefix 권장</td></tr><tr><td>dlq key</td><td><code>dlq.events</code></td><td>보존기간·재처리 런북 필요</td></tr></tbody></table><h4 id=동기-실행을-현대-아키텍처에-적용할-때-자주-쓰는-패턴>동기 실행을 현대 아키텍처에 적용할 때 자주 쓰는 패턴<a hidden class=anchor aria-hidden=true href=#동기-실행을-현대-아키텍처에-적용할-때-자주-쓰는-패턴>#</a></h4><h5 id=레이어드-모놀리식--동기-트랜잭션--outbox-하이브리드>레이어드 모놀리식 + 동기 트랜잭션 + Outbox (하이브리드)<a hidden class=anchor aria-hidden=true href=#레이어드-모놀리식--동기-트랜잭션--outbox-하이브리드>#</a></h5><pre class=mermaid>flowchart LR
  Client--&gt;API[REST Controller]
  API--&gt;Svc[&#34;Domain Service (Sync)&#34;]
  Svc--&gt;DB[(RDB - ACID Tx)]
  Svc--&gt;|Tx내 기록|Outbox[(Outbox Table)]
  Outbox--&gt;|Tx후 비동기 발행|Bus[[Event Bus]]

  classDef sync fill:#e9f5ff,stroke:#2573d5,color:#0a2a66;
  classDef async fill:#fff4e6,stroke:#e07a00,color:#5a2d00;
  class API,Svc,DB sync;
  class Outbox,Bus async;
</pre><ul><li><strong>핵심</strong>: 원장은 <strong>동기 트랜잭션</strong>으로 무결성 보장, 외부 파급은 <strong>Outbox→비동기 발행</strong>.</li></ul><h5 id=마이크로서비스-핵심-경로-동기-주변은-이벤트-기반>마이크로서비스: 핵심 경로 동기, 주변은 이벤트 기반<a hidden class=anchor aria-hidden=true href=#마이크로서비스-핵심-경로-동기-주변은-이벤트-기반>#</a></h5><pre class=mermaid>sequenceDiagram
  autonumber
  participant U as User
  participant ORD as OrderSvc (Sync API)
  participant PAY as PaymentSvc (Sync API)
  participant INV as InventoryProj (Async)
  participant BUS as EventBus

  U-&gt;&gt;ORD: POST /orders (sync)
  ORD-&gt;&gt;PAY: POST /charge (sync)
  PAY--&gt;&gt;ORD: 200 OK (authorized)
  ORD-&gt;&gt;ORD: ACID Commit (order_created)
  ORD-&gt;&gt;BUS: Publish OrderCreated (async)
  BUS--&gt;&gt;INV: Consume &amp; Project (async)
  ORD--&gt;&gt;U: 201 Created (sync)
</pre><ul><li><strong>핵심</strong>: 주문–결제는 <strong>동기 요청/응답</strong>으로 즉시성 확보, 재고/분석은 <strong>비동기</strong>로 확장.</li></ul><h5 id=cqrs-command-는-동기-직렬-read-는-비동기-프로젝션>CQRS: Command 는 동기 직렬, Read 는 비동기 프로젝션<a hidden class=anchor aria-hidden=true href=#cqrs-command-는-동기-직렬-read-는-비동기-프로젝션>#</a></h5><pre class=mermaid>flowchart TB
  Client --&gt; CMD[&#34;Command API (Sync)&#34;]
  CMD --&gt;|Tx| Aggregate[Domain/Aggregate]
  Aggregate --&gt;|Commit| DB[(Write DB)]
  Aggregate --&gt; Outbox[(Outbox)]
  Outbox --&gt; BUS[[Event Bus]]
  BUS --&gt; PRJ[Projection Worker]
  PRJ --&gt; READ[(Read DB/Cache)]
  Client --&gt; QRY[Query API]
  QRY --&gt; READ

  class CMD,Aggregate,DB sync;
  class Outbox,BUS,PRJ,READ,QRY async;
  classDef sync fill:#e9f5ff,stroke:#2573d5;
  classDef async fill:#fff4e6,stroke:#e07a00;
</pre><ul><li><strong>핵심</strong>: <strong>Command 경로는 동기 ACID</strong>, 조회는 <strong>비동기 갱신된 읽기 모델</strong>로 고속 응답.</li></ul><h5 id=api-게이트웨이--동기-핵심보호-리밋서킷브레이커>API 게이트웨이 + 동기 핵심/보호 (리밋·서킷브레이커)<a hidden class=anchor aria-hidden=true href=#api-게이트웨이--동기-핵심보호-리밋서킷브레이커>#</a></h5><pre class=mermaid>flowchart LR
  Client --&gt; GW[API Gateway]
  GW --&gt; RL[RateLimiter]
  RL --&gt; CB[CircuitBreaker]
  CB --&gt; Core[&#34;Core Service (Sync)&#34;]
  Core --&gt; DB[(RDB Tx)]
  CB -.fallback.-&gt; Cache[(Read-Through Cache)]
  CB -.fallback.-&gt; Msg[[Fallback Queue]]

  classDef sync fill:#e9f5ff,stroke:#2573d5;
  classDef guard fill:#eefbea,stroke:#2a7b37;
  classDef async fill:#fff4e6,stroke:#e07a00;

  class GW,Core,DB sync;
  class RL,CB guard;
  class Cache,Msg async;
</pre><ul><li><strong>핵심</strong>: <strong>동기 핵심 경로</strong>를 <strong>리밋·서킷</strong>으로 보호, 장애 시 캐시/큐로 <strong>우회</strong>.</li></ul><h5 id=서버리스-동기-엔드포인트--비동기-워크플로-연계>서버리스 동기 엔드포인트 + 비동기 워크플로 연계<a hidden class=anchor aria-hidden=true href=#서버리스-동기-엔드포인트--비동기-워크플로-연계>#</a></h5><pre class=mermaid>sequenceDiagram
  participant C as Client
  participant FN as Sync Function (FaaS)
  participant RDB as RDB (Tx)
  participant OB as Outbox
  participant WF as Workflow(Async)

  C-&gt;&gt;FN: HTTPS Invoke (sync)
  FN-&gt;&gt;RDB: Begin Tx / Write / Commit (sync)
  FN-&gt;&gt;OB: Record outbox (sync within Tx)
  FN--&gt;&gt;C: 200 OK (sync)
  OB--&gt;&gt;WF: Trigger workflow (async)
</pre><ul><li><strong>핵심</strong>: <strong>동기 FaaS</strong>로 트랜잭션 확정 후, 장기/복잡 작업은 <strong>워크플로</strong>에 위임.</li></ul><hr><h2 id=정리-및-학습-가이드>정리 및 학습 가이드<a hidden class=anchor aria-hidden=true href=#정리-및-학습-가이드>#</a></h2><h3 id=내용-정리>내용 정리<a hidden class=anchor aria-hidden=true href=#내용-정리>#</a></h3><p>동기 실행 (Synchronous Execution) 은 모든 작업을 순차적으로 실행하며, 각 작업이 완료될 때까지 다음 작업이 대기하는 Blocking 방식의 실행 모델이다. 1940 년대 초기 컴퓨터부터 현대에 이르기까지 가장 오래되고 안정적인 모델로, 코드 가독성과 예측 가능성, 데이터 일관성 보장이 특징이다.</p><p>이 방식은 호출 스택, 실행 컨텍스트, 프로그램 카운터와 같은 핵심 구성 요소를 통해 순차적 흐름을 유지하며, 데이터베이스 트랜잭션, 핵심 상태 변경 로직 등 반드시 순차 실행이 보장되어야 하는 영역에 필수적으로 활용된다. 그러나 I/O 대기 시간에 따른 성능 저하, 자원 비효율, 확장성 한계와 같은 단점도 있다.</p><p>멀티코어 환경에서도 동기 실행은 단일 스레드 흐름을 유지하므로 병렬성을 활용하기 위해선 멀티프로세싱이나 병렬 처리 구조를 병행해야 한다. 이러한 한계를 극복하기 위해 비동기 모델과 혼합한 하이브리드 아키텍처, Connection Pool 과 캐싱, 배치 처리와 같은 최적화 기법이 사용된다.</p><p>최근에는 마이크로서비스, 클라우드 네이티브 환경, 서버리스, 에지 컴퓨팅, AI 기반 성능 최적화와의 결합 등 새로운 적용 방식이 확산되고 있다. 결국 동기 실행의 본질과 한계를 정확히 이해하고, 상황에 맞는 최적의 구조를 선택하는 것이 고성능·고신뢰 시스템 설계의 핵심이다.</p><table><thead><tr><th>구분</th><th>내용</th></tr></thead><tbody><tr><td><strong>정의</strong></td><td>작업을 순차적으로 실행하며, 각 작업이 완료될 때까지 다음 작업 대기하는 Blocking 방식</td></tr><tr><td><strong>장점</strong></td><td>예측 가능성, 데이터 일관성, 디버깅 용이, 코드 가독성</td></tr><tr><td><strong>단점</strong></td><td>I/O 대기 시 성능 저하, 확장성 제한, 자원 비효율, 데드락 가능성</td></tr><tr><td><strong>핵심 구성 요소</strong></td><td>호출 스택, 실행 컨텍스트, 프로그램 카운터</td></tr><tr><td><strong>활용 분야</strong></td><td>DB 트랜잭션, 핵심 상태 변경 로직, 제조/금융 시스템</td></tr><tr><td><strong>성능 최적화</strong></td><td>캐싱, Connection Pool, 배치 처리, 멀티프로세싱</td></tr><tr><td><strong>현대 트렌드</strong></td><td>동기·비동기 혼합, 하이브리드 모델, 마이크로서비스·클라우드·서버리스 통합</td></tr><tr><td><strong>운영 고려사항</strong></td><td>OS 스케줄러 이해, 병목 분석, Race Condition 예방, 모니터링 도구 활용</td></tr></tbody></table><h3 id=학습-로드맵>학습 로드맵<a hidden class=anchor aria-hidden=true href=#학습-로드맵>#</a></h3><table><thead><tr><th>단계</th><th>기간</th><th>학습 목표</th><th>세부 학습 내용</th><th>실습 예시</th></tr></thead><tbody><tr><td>초급자</td><td>1~2 개월</td><td>기본 개념 및 동작 원리 이해</td><td>동기/비동기 비교, 순차 실행 원리, Blocking I/O, 디버깅 기초</td><td>파일 처리 프로그램, 간단 계산기</td></tr><tr><td>중급자</td><td>2~3 개월</td><td>심화 개념 및 실무 적용</td><td>성능 병목 분석, 프로파일링, 동기 REST API 구현, 멀티스레드 동기화</td><td>FastAPI 기반 API, k6 부하 테스트</td></tr><tr><td>고급자</td><td>3~6 개월</td><td>전문가 수준 설계 및 최적화</td><td>대규모 동기 시스템 설계, 고급 최적화, 보안 고려, 최신 트렌드 연구</td><td>분산 트랜잭션 설계, Connection Pool 튜닝</td></tr></tbody></table><h3 id=학습-항목-정리>학습 항목 정리<a hidden class=anchor aria-hidden=true href=#학습-항목-정리>#</a></h3><table><thead><tr><th>카테고리</th><th style=text-align:right>Phase</th><th>항목</th><th>중요도</th><th>학습 목표</th><th>실무 연관성</th><th>설명</th></tr></thead><tbody><tr><td>기초</td><td style=text-align:right>1</td><td>개념/정의</td><td>필수</td><td>동기 실행의 본질·용어 정립</td><td>높음</td><td>순차·차단·결정성의 의미 파악</td></tr><tr><td>기초</td><td style=text-align:right>1</td><td>동기 vs 비동기, 블로킹/논블로킹</td><td>필수</td><td>모델 차이·적용 기준 이해</td><td>높음</td><td>언제 동기/비동기를 쓸지 기준 수립</td></tr><tr><td>기초</td><td style=text-align:right>1</td><td>호출 스택·제어 흐름</td><td>필수</td><td>콜스택/리턴·예외 전파 이해</td><td>중간</td><td>디버깅 기초 체력 확보</td></tr><tr><td>핵심</td><td style=text-align:right>2</td><td>동작 원리·아키텍처</td><td>필수</td><td>스레드/커넥션 풀·락·I/O 이해</td><td>높음</td><td>병목의 구조적 원인 파악</td></tr><tr><td>핵심</td><td style=text-align:right>2</td><td>트랜잭션·격리 수준</td><td>필수</td><td>ACID·격리의 효과·비용 이해</td><td>높음</td><td>정합성 보장·경합 튜닝</td></tr><tr><td>핵심</td><td style=text-align:right>2</td><td>자원 모델 (Thread-per-Request)</td><td>필수</td><td>풀 상한=동시성 한계 인지</td><td>높음</td><td>용량 계획·풀 사이징</td></tr><tr><td>특성 (분석)</td><td style=text-align:right>3</td><td>장단점/트레이드오프</td><td>필수</td><td>단순성 vs 확장성 판단</td><td>높음</td><td>아키텍처 의사결정 능력</td></tr><tr><td>특성 (분석)</td><td style=text-align:right>3</td><td>성능 특성 (HoL, p95/p99)</td><td>권장</td><td>테일 지연·선두 차단 이해</td><td>중간</td><td>SLO/SLA 대응</td></tr><tr><td>구현</td><td style=text-align:right>4</td><td>에러 처리·롤백</td><td>필수</td><td>예외 전파·롤백 표준화</td><td>높음</td><td>안정적 실패 처리</td></tr><tr><td>구현</td><td style=text-align:right>4</td><td>타임아웃·재시도 예산</td><td>필수</td><td>체인 전체 시간 예산 설계</td><td>높음</td><td>테일 지연 억제</td></tr><tr><td>구현</td><td style=text-align:right>4</td><td>경계 설계 (Outbox 패턴)</td><td>필수</td><td>동기 핵심/비동기 외연 분리</td><td>높음</td><td>병목 국지화·내고장성</td></tr><tr><td>구현</td><td style=text-align:right>4</td><td>테스트 전략 (결정성/계약/장애주입)</td><td>권장</td><td>재현성 높은 테스트 구축</td><td>중간</td><td>회귀·신뢰성 강화</td></tr><tr><td>응용</td><td style=text-align:right>5</td><td>실습: 주문 +Outbox→워커</td><td>권장</td><td>표준 템플릿 구현</td><td>높음</td><td>팀 내 레디메이드</td></tr><tr><td>응용</td><td style=text-align:right>5</td><td>배치/ETL 순차 파이프라인</td><td>권장</td><td>순차 처리 최적 패턴 학습</td><td>중간</td><td>운영 자동화</td></tr><tr><td>운영</td><td style=text-align:right>6</td><td>관측성 (Trace/Metric/Log)</td><td>필수</td><td>코리레이션·지표 대시보드</td><td>높음</td><td>MTTR 단축</td></tr><tr><td>운영</td><td style=text-align:right>6</td><td>성능 튜닝 (풀·쿼리·락)</td><td>권장</td><td>락 대기·풀 점유 최적화</td><td>중간</td><td>처리량/지연 개선</td></tr><tr><td>운영</td><td style=text-align:right>6</td><td>장애 대응 (서킷/페일 - 패스트)</td><td>권장</td><td>연쇄 지연 차단</td><td>중간</td><td>안정성 향상</td></tr><tr><td>고급</td><td style=text-align:right>7</td><td>하이브리드·리액티브 비교</td><td>선택</td><td>모델 조합 전략 수립</td><td>중간</td><td>시스템 전반 최적화</td></tr><tr><td>고급</td><td style=text-align:right>7</td><td>마이그레이션 전략</td><td>선택</td><td>동기→혼합 전환 로드맵</td><td>중간</td><td>점진적 리스크 관리</td></tr><tr><td>고급</td><td style=text-align:right>7</td><td>의사결정 프레임/ADR</td><td>선택</td><td>기준·근거 문서화</td><td>중간</td><td>팀 합의·지속성 확보</td></tr></tbody></table><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>정의</th><th>관련 개념</th><th>실무 활용</th></tr></thead><tbody><tr><td>실행 모델/원리</td><td>동기 실행 (Synchronous Execution)</td><td>이전 작업 <strong>완료 후</strong> 다음 작업을 수행하는 순차적 실행 방식</td><td>비동기 실행, 논블로킹</td><td>트랜잭션 처리, 순차 의존 작업</td></tr><tr><td>실행 모델/원리</td><td>순차 처리 (Sequential Execution)</td><td>정해진 순서로 하나씩 처리하여 흐름이 선형으로 진행</td><td>파이프라인, 흐름 제어</td><td>배치 스크립트, 마이그레이션</td></tr><tr><td>실행 모델/원리</td><td>Thread-per-request</td><td>요청마다 스레드를 할당해 동기 흐름을 보장하는 서버 모델</td><td>스레드 풀, 컨텍스트 스위칭</td><td>서블릿/전통 웹서버 구조</td></tr><tr><td>제어 흐름/데이터 구조</td><td>호출 스택 (Call Stack)</td><td>호출/반환을 관리하는 LIFO 구조의 메모리 영역</td><td>스택 프레임, 재귀</td><td>함수 호출 흐름·오류 추적</td></tr><tr><td>제어 흐름/데이터 구조</td><td>실행 컨텍스트 (스택 프레임)</td><td>한 호출에 필요한 지역 상태·리턴주소·레지스터 저장 단위</td><td>재진입성, 결정성</td><td>단계별 상태 보존/복구</td></tr><tr><td>제어 흐름/데이터 구조</td><td>프로그램 카운터 (PC)</td><td>다음에 실행할 명령어 주소를 가리키는 레지스터</td><td>분기/점프, 호출/반환</td><td>순차 실행의 하드웨어 근간</td></tr><tr><td>I/O·동기화</td><td>블로킹 (Blocking)</td><td>작업 완료까지 호출이 <strong>대기</strong>하여 흐름이 멈추는 상태</td><td>Blocking I/O, HoL</td><td>파일/DB/네트워크 호출</td></tr><tr><td>I/O·동기화</td><td>Blocking I/O</td><td>read/write 등 완료 전까지 스레드가 대기하는 I/O</td><td>논블로킹 I/O</td><td>동기 HTTP, 디스크 접근</td></tr><tr><td>I/O·동기화</td><td>임계구역 / 락 (뮤텍스)</td><td>공유 자원에 배타적 접근을 보장하는 동기화 영역/프리미티브</td><td>조건변수, 세마포어</td><td>데이터 일관성 보호</td></tr><tr><td>I/O·동기화</td><td>데드락 (Deadlock)</td><td>상호 자원 대기로 <strong>영원히 대기</strong>하는 상태</td><td>락 순서, 타임아웃</td><td>락 정책·순서 규약 필요</td></tr><tr><td>I/O·동기화</td><td>Head-of-Line Blocking</td><td>선행 작업 지연이 뒤 작업 전부를 막는 현상</td><td>큐잉, 직렬화</td><td>긴 I/O 가 전체 경로 지연</td></tr><tr><td>일관성/트랜잭션</td><td>트랜잭션 (Transaction)</td><td>원자적 단위로 묶인 작업 집합</td><td>롤백, 커밋</td><td>주문/결제/정산</td></tr><tr><td>일관성/트랜잭션</td><td>ACID 일관성</td><td>원자성·일관성·격리성·지속성을 만족하는 DB 속성</td><td>격리 레벨, 잠금</td><td>금융·인증·정합성 요구 업무</td></tr><tr><td>운영 지표/성능</td><td>응답 시간 (Response Time)</td><td>요청→응답까지 소요 시간</td><td>지연시간, p95/p99</td><td>SLO/성능 모니터링</td></tr><tr><td>운영 지표/성능</td><td>처리량 (Throughput)</td><td>단위 시간 처리 건수 (QPS/TPS)</td><td>동시성, 자원 한계</td><td>용량 계획·부하 테스트</td></tr><tr><td>운영 지표/성능</td><td>병목 (Bottleneck)</td><td>전체 성능을 제한하는 느린 구간</td><td>프로파일링, Amdahl</td><td>최적화·경로 재설계</td></tr><tr><td>운영 지표/성능</td><td>컨텍스트 스위칭</td><td>CPU 가 실행 중인 스레드/프로세스를 전환하는 동작</td><td>캐시 미스, 오버헤드</td><td>스레드 과다 시 성능 저하</td></tr><tr><td>운영/신뢰성 패턴</td><td>타임아웃 (Timeout)</td><td>최대 대기 시간을 넘기면 호출을 중단하는 정책</td><td>재시도, 폴백</td><td>무한 대기 방지/안정성 확보</td></tr><tr><td>운영/신뢰성 패턴</td><td>서킷 브레이커</td><td>실패율이 높을 때 호출을 <strong>차단</strong>해 보호하는 패턴</td><td>재시도, 격벽</td><td>외부 의존 장애 전파 차단</td></tr><tr><td>운영/신뢰성 패턴</td><td>배치 처리 (Batch Processing)</td><td>데이터를 모아 한 번에 순차 처리</td><td>파이프라인</td><td>오프라인 대량 처리 최적화</td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://docs.oracle.com/javase/tutorial/essential/concurrency/>Oracle Java Documentation – Concurrency</a></li><li><a href=https://docs.python.org/3/library/threading.html>Python Official Documentation – Synchronous Programming</a></li><li><a href=https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/>Microsoft .NET Documentation – Synchronous vs Asynchronous</a></li><li><a href=https://martinfowler.com/books/eaa.html>Martin Fowler – Patterns of Enterprise Application Architecture</a></li><li><a href=https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html>Clean Architecture by Robert C. Martin</a></li><li><a href=https://hpbn.co/>High Performance Browser Networking – Primer on Web Performance</a></li><li><a href=https://dataintensive.net/>Designing Data-Intensive Applications by Martin Kleppmann</a></li><li><a href=https://www.os-book.com/>Operating Systems Concepts by Abraham Silberschatz</a></li><li><a href=https://aws.amazon.com/architecture/event-driven-architecture/>Event-Driven Architecture and Synchronous vs Asynchronous (AWS)</a></li><li><a href=https://d2.naver.com/helloworld/5927206>동기, 비동기와 클라우드 네이티브의 관계 (네이버 D2)</a></li><li><a href=https://microservices.io/patterns/communication-style/synchronous.html>Microservices Communication: Sync vs Async Explained</a></li><li><a href=https://www.geeksforgeeks.org/synchronous-and-asynchronous-programming/>Synchronous vs. Asynchronous Programming (GeeksforGeeks)</a></li><li><a href=https://www.baeldung.com/cs/blocking-vs-non-blocking-io>Blocking vs. Non-blocking IO 정리 (Baeldung)</a></li><li><a href=https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous>Synchronous and Asynchronous Programming (MDN)</a></li><li><a href=https://aws.amazon.com/architecture/well-architected/>AWS Well-Architected Framework</a></li><li><a href=https://learn.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/>Blocking/Non-blocking/Async guide (Microsoft Docs)</a></li><li><a href=https://netflix.github.io/Hystrix/>Netflix Engineering – Hystrix (Circuit Breaker)</a></li></ul><hr></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2026 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>