<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Connection Pooling | hyunyoun's Blog</title><meta name=keywords content="Software-Engineering,Design-and-Architecture,Architecture-Styles-and-Patterns,Architecture-Patterns,Performance-Patterns,Connection-Pooling"><meta name=description content="Connection Pooling은 데이터베이스 연결을 재사용 가능한 형태로 캐시하는 메커니즘이다.  이는 애플리케이션이 데이터베이스에 연결할 때마다 새로운 연결을 생성하는 대신, 미리 생성된 연결을 사용할 수 있게 해준다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/system-architecture--design/performance--scalability/performance-design/data-access-optimization/connection-pooling/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://buenhyden.github.io/posts/system-architecture--design/performance--scalability/performance-design/data-access-optimization/connection-pooling/index.xml><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/system-architecture--design/performance--scalability/performance-design/data-access-optimization/connection-pooling/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/system-architecture--design/performance--scalability/performance-design/data-access-optimization/connection-pooling/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="Connection Pooling"><meta property="og:description" content="Connection Pooling은 데이터베이스 연결을 재사용 가능한 형태로 캐시하는 메커니즘이다.  이는 애플리케이션이 데이터베이스에 연결할 때마다 새로운 연결을 생성하는 대신, 미리 생성된 연결을 사용할 수 있게 해준다."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="Connection Pooling"><meta name=twitter:description content="Connection Pooling은 데이터베이스 연결을 재사용 가능한 형태로 캐시하는 메커니즘이다.  이는 애플리케이션이 데이터베이스에 연결할 때마다 새로운 연결을 생성하는 대신, 미리 생성된 연결을 사용할 수 있게 해준다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HY's Blog","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Connection Pooling","item":"https://buenhyden.github.io/posts/system-architecture--design/performance--scalability/performance-design/data-access-optimization/connection-pooling/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>HY's Blog</a></div><h1>Connection Pooling</h1><div class=post-description>Connection Pooling은 데이터베이스 연결을 재사용 가능한 형태로 캐시하는 메커니즘이다. 이는 애플리케이션이 데이터베이스에 연결할 때마다 새로운 연결을 생성하는 대신, 미리 생성된 연결을 사용할 수 있게 해준다.</div></header><div class=post-content><h2 id=connection-pooling>Connection Pooling<a hidden class=anchor aria-hidden=true href=#connection-pooling>#</a></h2><h3 id=1-부-태그-분류-구조-요약-및-개요>1 부. 태그, 분류 구조, 요약 및 개요<a hidden class=anchor aria-hidden=true href=#1-부-태그-분류-구조-요약-및-개요>#</a></h3><h4 id=1-태그-tag>1. 태그 (Tag)<a hidden class=anchor aria-hidden=true href=#1-태그-tag>#</a></h4><p>Connection-Pool, Database-Integration, Resource-Management, Performance-Optimization</p><h4 id=2-분류-구조의-적합성-분석>2. 분류 구조의 적합성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조의-적합성-분석>#</a></h4><p>&ldquo;Systems and Infrastructure > Database Systems > Database Integration&rdquo; 분류는 커넥션 풀 (Connection Pool) 의 본질을 잘 반영합니다. 커넥션 풀은 데이터베이스와 애플리케이션 간의 효율적인 통합과 리소스 관리를 담당하는 핵심 기술로, 데이터베이스 통합 (Database Integration) 카테고리에서 다루는 것이 타당합니다.</p><h4 id=3-200-자-내외-요약>3. 200 자 내외 요약<a hidden class=anchor aria-hidden=true href=#3-200-자-내외-요약>#</a></h4><p>커넥션 풀 (Connection Pool) 은 데이터베이스 연결을 미리 생성해 풀 (pool) 로 관리하고, 필요 시 재사용함으로써 연결 생성·해제에 따른 오버헤드를 줄이고 애플리케이션의 성능과 확장성을 높이는 핵심 기술입니다. 대규모 트래픽 처리와 리소스 효율화에 필수적입니다.</p><h4 id=4-250-자-내외-개요>4. 250 자 내외 개요<a hidden class=anchor aria-hidden=true href=#4-250-자-내외-개요>#</a></h4><p>커넥션 풀 (Connection Pool) 은 데이터베이스 연결을 미리 여러 개 생성해두고, 애플리케이션에서 필요할 때마다 이를 할당·반환하는 방식으로 동작합니다. 이 구조는 데이터베이스 연결의 빈번한 생성과 해제에 따른 비용을 줄이고, 동시 접속 처리량을 높이며, 시스템의 안정성과 성능을 크게 향상시킵니다. 웹 서비스, API 서버 등 다양한 환경에서 표준적으로 사용되며, 효율적인 리소스 관리와 장애 대응에도 중요한 역할을 합니다.</p><h3 id=2-부-커넥션-풀-심층-분석>2 부. 커넥션 풀 심층 분석<a hidden class=anchor aria-hidden=true href=#2-부-커넥션-풀-심층-분석>#</a></h3><h4 id=1-핵심-개념>1. 핵심 개념<a hidden class=anchor aria-hidden=true href=#1-핵심-개념>#</a></h4><ul><li><strong>커넥션 풀 (Connection Pool)</strong>: 데이터베이스 연결을 미리 생성해 풀로 관리하고, 필요 시 할당·반환하여 재사용하는 자원 관리 기법</li><li><strong>풀 (Pool)</strong>: 미리 생성된 연결 (커넥션) 객체의 집합</li><li><strong>할당 (Allocation)</strong>: 애플리케이션이 풀에서 커넥션을 가져오는 과정</li><li><strong>반환 (Return/Release)</strong>: 사용이 끝난 커넥션을 풀로 돌려보내는 과정</li></ul><h4 id=2-실무-연관성-분석>2. 실무 연관성 분석<a hidden class=anchor aria-hidden=true href=#2-실무-연관성-분석>#</a></h4><ul><li>대규모 트래픽 환경에서 데이터베이스 연결 효율화</li><li>연결 생성/해제 오버헤드 감소로 성능 향상</li><li>연결 수 제한 및 리소스 관리로 장애 예방</li><li>다양한 언어와 프레임워크에서 표준적으로 사용</li></ul><h4 id=3-배경>3. 배경<a hidden class=anchor aria-hidden=true href=#3-배경>#</a></h4><ul><li>데이터베이스 연결 생성/해제 비용이 높고, 빈번한 연결 관리가 서버 성능 저하의 주요 원인</li><li>동시 사용자 증가에 따라 효율적인 연결 관리 필요성 대두</li></ul><h4 id=4-목적-및-필요성>4. 목적 및 필요성<a hidden class=anchor aria-hidden=true href=#4-목적-및-필요성>#</a></h4><ul><li>데이터베이스 연결 관리의 효율화 및 최적화</li><li>시스템 성능 및 확장성 확보</li><li>장애 예방 및 리소스 고갈 방지</li></ul><h4 id=5-주요-기능-및-역할>5. 주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#5-주요-기능-및-역할>#</a></h4><ul><li>미리 연결 생성 및 재사용</li><li>최대/최소 커넥션 수 관리</li><li>커넥션 유휴 시간 관리 및 자동 종료</li><li>장애 커넥션 감지 및 복구</li></ul><h4 id=6-특징>6. 특징<a hidden class=anchor aria-hidden=true href=#6-특징>#</a></h4><ul><li>연결 재사용</li><li>동시성 및 확장성 강화</li><li>리소스 효율화</li><li>자동 장애 감지 및 복구</li></ul><h4 id=7-핵심-원칙>7. 핵심 원칙<a hidden class=anchor aria-hidden=true href=#7-핵심-원칙>#</a></h4><ul><li>연결의 재사용과 효율적 관리</li><li>최대/최소 풀 크기 설정</li><li>커넥션 상태 모니터링 및 복구</li></ul><h4 id=8-주요-원리-및-작동-원리>8. 주요 원리 및 작동 원리<a hidden class=anchor aria-hidden=true href=#8-주요-원리-및-작동-원리>#</a></h4><pre class=mermaid>flowchart TD
    A[애플리케이션 요청] --&gt; B{풀에 사용 가능한 커넥션이 있는가?}
    B -- 예 --&gt; C[커넥션 할당]
    B -- 아니오 --&gt; D{최대 커넥션 수 미달인가?}
    D -- 예 --&gt; E[새 커넥션 생성 및 할당]
    D -- 아니오 --&gt; F[대기 또는 예외 발생]
    C &amp; E --&gt; G[작업 수행]
    G --&gt; H[커넥션 반환]
    H --&gt; B
</pre><ul><li><strong>설명</strong>: 애플리케이션이 데이터베이스 작업을 요청하면, 커넥션 풀에서 사용 가능한 커넥션을 할당하고, 작업이 끝나면 커넥션을 반환합니다. 풀에 여유가 없으면 새로 생성하거나 대기하게 됩니다.</li></ul><h4 id=9-구조-및-아키텍처>9. 구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#9-구조-및-아키텍처>#</a></h4><table><thead><tr><th>구성 요소</th><th>기능</th><th>역할</th></tr></thead><tbody><tr><td>커넥션 풀 관리자</td><td>풀 전체 관리</td><td>커넥션 생성, 할당, 반환, 종료</td></tr><tr><td>커넥션 객체</td><td>DB 연결 관리</td><td>실제 데이터베이스 연결</td></tr><tr><td>풀 큐/리스트</td><td>커넥션 저장</td><td>사용/미사용 커넥션 관리</td></tr><tr><td>모니터링 모듈</td><td>상태 감시</td><td>유휴 커넥션, 장애 감지</td></tr><tr><td>설정 모듈</td><td>파라미터 관리</td><td>최대/최소 크기, 타임아웃 등</td></tr></tbody></table><h5 id=선택-구성요소>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소>#</a></h5><table><thead><tr><th>구성 요소</th><th>기능</th><th>역할</th></tr></thead><tbody><tr><td>로깅 모듈</td><td>이벤트 기록</td><td>풀 동작 이력 관리</td></tr><tr><td>알림 시스템</td><td>장애 알림</td><td>비정상 상황 실시간 통보</td></tr></tbody></table><h3 id=3-부-구현-기법-장단점-실무-활용>3 부. 구현 기법, 장단점, 실무 활용<a hidden class=anchor aria-hidden=true href=#3-부-구현-기법-장단점-실무-활용>#</a></h3><h4 id=1-구현-기법>1. 구현 기법<a hidden class=anchor aria-hidden=true href=#1-구현-기법>#</a></h4><ul><li><strong>Fixed Pool(고정 크기 풀)</strong>: 풀 크기를 고정하여 관리</li><li><strong>Dynamic Pool(동적 크기 풀)</strong>: 부하에 따라 풀 크기 자동 조정</li><li><strong>Timeout 관리</strong>: 유휴 커넥션 자동 종료</li><li><strong>Health Check(상태 점검)</strong>: 커넥션 유효성 주기적 검사</li></ul><h4 id=2-장점>2. 장점<a hidden class=anchor aria-hidden=true href=#2-장점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>성능 향상</td><td>연결 생성/해제 오버헤드 감소</td></tr><tr><td>장점</td><td>자원 효율화</td><td>불필요한 연결 최소화</td></tr><tr><td>장점</td><td>확장성</td><td>동시 접속 처리량 증가</td></tr><tr><td>장점</td><td>안정성</td><td>리소스 고갈 및 장애 예방</td></tr></tbody></table><h4 id=3-단점과-문제점-그리고-해결방안>3. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#3-단점과-문제점-그리고-해결방안>#</a></h4><h5 id=단점>단점<a hidden class=anchor aria-hidden=true href=#단점>#</a></h5><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>설정 복잡성</td><td>최적 풀 크기 산정 어려움</td><td>트래픽 분석 통한 튜닝</td></tr><tr><td>단점</td><td>자원 고갈</td><td>풀 크기 초과 시 대기/예외</td><td>적절한 타임아웃, 알림 도입</td></tr><tr><td>단점</td><td>유휴 커넥션</td><td>장시간 미사용 커넥션 존재</td><td>유휴 커넥션 종료 정책</td></tr></tbody></table><h5 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h5><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>풀 고갈</td><td>동시 접속 폭증</td><td>서비스 지연/장애</td><td>풀 사용률 모니터링</td><td>최대 크기 조정</td><td>자동 확장/알림</td></tr><tr><td>문제점</td><td>유휴 커넥션 누수</td><td>반환 누락/풀 관리 미흡</td><td>리소스 낭비</td><td>유휴 커넥션 감시</td><td>자동 종료</td><td>타임아웃 설정</td></tr><tr><td>문제점</td><td>비정상 커넥션</td><td>네트워크 장애 등</td><td>작업 실패/데이터 손실</td><td>상태 점검</td><td>정기적 Health Check</td><td>비정상 커넥션 자동 제거</td></tr></tbody></table><h4 id=4-도전-과제>4. 도전 과제<a hidden class=anchor aria-hidden=true href=#4-도전-과제>#</a></h4><ul><li>대규모 분산 환경에서의 풀 관리 자동화</li><li>트래픽 급증 시 동적 확장 최적화</li><li>장애 상황에서의 빠른 복구 및 알림 체계 강화</li></ul><h4 id=5-분류-기준에-따른-종류-및-유형>5. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#5-분류-기준에-따른-종류-및-유형>#</a></h4><table><thead><tr><th>분류 기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>풀 크기</td><td>고정형 (Fixed)</td><td>최대/최소 크기 고정</td></tr><tr><td>풀 크기</td><td>동적형 (Dynamic)</td><td>부하에 따라 자동 조정</td></tr><tr><td>구현 방식</td><td>내장형</td><td>프레임워크/라이브러리 내장</td></tr><tr><td>구현 방식</td><td>외부형</td><td>별도 미들웨어로 운영</td></tr></tbody></table><h4 id=6-실무-사용-예시>6. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#6-실무-사용-예시>#</a></h4><table><thead><tr><th>사용 분야</th><th>함께 사용하는 시스템</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>웹 서비스</td><td>Spring Boot, HikariCP</td><td>대규모 트래픽 처리</td><td>성능, 안정성 향상</td></tr><tr><td>API 서버</td><td>Node.js, node-postgres</td><td>동시 요청 처리</td><td>응답 속도 개선</td></tr><tr><td>엔터프라이즈</td><td>Java EE, Tomcat JDBC Pool</td><td>대용량 트랜잭션 관리</td><td>리소스 최적화</td></tr></tbody></table><h4 id=7-활용-사례>7. 활용 사례<a hidden class=anchor aria-hidden=true href=#7-활용-사례>#</a></h4><ul><li><strong>웹 서비스 트래픽 급증 대응</strong><ul><li>Spring Boot + HikariCP 환경에서 커넥션 풀을 활용해 동시 요청 폭증 시에도 빠른 응답과 안정적인 서비스 유지</li><li>커넥션 풀 미적용 시: 연결 생성/해제 병목, 서비스 지연 및 장애</li><li>커넥션 풀 적용 시: 미리 생성된 커넥션 재사용, 부하 분산 및 성능 극대화</li></ul></li></ul><pre class=mermaid>flowchart TD
    User[사용자] --&gt; WebApp[웹 애플리케이션]
    WebApp --&gt; Pool[커넥션 풀]
    Pool --&gt; DB[데이터베이스]
</pre><h4 id=8-구현-예시-python-psycopg2--connection-pool>8. 구현 예시 (Python, Psycopg2 + Connection pool)<a hidden class=anchor aria-hidden=true href=#8-구현-예시-python-psycopg2--connection-pool>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># psycopg2의 SimpleConnectionPool을 활용한 PostgreSQL 커넥션 풀 예시</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>psycopg2</span> <span class=kn>import</span> <span class=n>pool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 커넥션 풀 생성 (최소 1, 최대 10개 커넥션)</span>
</span></span><span class=line><span class=cl><span class=n>connection_pool</span> <span class=o>=</span> <span class=n>pool</span><span class=o>.</span><span class=n>SimpleConnectionPool</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>user</span><span class=o>=</span><span class=s2>&#34;dbuser&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span><span class=o>=</span><span class=s2>&#34;password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>port</span><span class=o>=</span><span class=s2>&#34;5432&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>database</span><span class=o>=</span><span class=s2>&#34;mydb&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 커넥션 할당 및 사용</span>
</span></span><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>connection_pool</span><span class=o>.</span><span class=n>getconn</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cur</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM users;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>rows</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>rows</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 커넥션 반환</span>
</span></span><span class=line><span class=cl>    <span class=n>connection_pool</span><span class=o>.</span><span class=n>putconn</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>설명</strong>: 커넥션 풀에서 커넥션을 할당받아 사용 후 반환함으로써, 연결 생성/해제 오버헤드를 줄이고 효율적으로 리소스를 관리합니다.</li></ul><h4 id=9-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>9. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#9-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>설계</td><td>최적 풀 크기 산정</td><td>트래픽/DB 리소스 분석 필요</td></tr><tr><td>운영</td><td>유휴 커넥션 관리</td><td>자동 종료, 상태 점검</td></tr><tr><td>확장성</td><td>동적 확장 지원</td><td>트래픽 변화에 따른 조정</td></tr><tr><td>모니터링</td><td>풀 사용률 감시</td><td>풀 고갈/누수 실시간 감시</td></tr></tbody></table><ul><li><strong>권장사항</strong>: 트래픽 패턴 분석 후 풀 크기 설정, 정기적 Health Check, 자동 알림 시스템 도입</li></ul><h4 id=10-최적화하기-위한-고려사항-및-주의할-점>10. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#10-최적화하기-위한-고려사항-및-주의할-점>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>성능</td><td>풀 크기 튜닝</td><td>최대/최소 크기 조정</td></tr><tr><td>운영</td><td>타임아웃 설정</td><td>대기/유휴 커넥션 관리</td></tr><tr><td>모니터링</td><td>상태 감시 자동화</td><td>풀/커넥션 상태 실시간 체크</td></tr><tr><td>장애 대응</td><td>비정상 커넥션 제거</td><td>자동 복구 정책 도입</td></tr></tbody></table><ul><li><strong>권장사항</strong>: 부하 테스트 기반 튜닝, 자동화된 모니터링 및 복구 시스템 구축</li></ul><h3 id=4-부-주제별-주목할-내용-및-학습-필수-항목>4 부. 주제별 주목할 내용 및 학습 필수 항목<a hidden class=anchor aria-hidden=true href=#4-부-주제별-주목할-내용-및-학습-필수-항목>#</a></h3><h4 id=1-주제별-주목할-내용>1. 주제별 주목할 내용<a hidden class=anchor aria-hidden=true href=#1-주제별-주목할-내용>#</a></h4><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>리소스 관리</td><td>커넥션 풀</td><td>재사용/최적화</td><td>DB 연결 효율화</td></tr><tr><td>운영</td><td>Health Check</td><td>상태 점검</td><td>비정상 커넥션 자동 제거</td></tr><tr><td>확장성</td><td>동적 확장</td><td>풀 크기 자동 조정</td><td>트래픽 변화 대응</td></tr><tr><td>모니터링</td><td>풀 사용률</td><td>실시간 감시</td><td>장애 예방</td></tr></tbody></table><h4 id=2-반드시-학습해야할-내용>2. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#2-반드시-학습해야할-내용>#</a></h4><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>리소스 관리</td><td>커넥션 풀 원리</td><td>풀 구조/동작 방식</td><td>기본 구조와 관리 원리</td></tr><tr><td>운영</td><td>풀 튜닝</td><td>최적 크기/타임아웃</td><td>성능 최적화 기법</td></tr><tr><td>모니터링</td><td>상태 점검/알림</td><td>풀/커넥션 상태 감시</td><td>실시간 장애 대응</td></tr><tr><td>확장성</td><td>동적 확장</td><td>트래픽 기반 자동 조정</td><td>부하 분산 및 안정성 확보</td></tr></tbody></table><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>리소스 관리</td><td>커넥션 풀 (Connection Pool)</td><td>DB 연결을 미리 생성해 풀로 관리, 필요 시 재사용하는 기법</td></tr><tr><td>리소스 관리</td><td>풀 (Pool)</td><td>여러 커넥션 객체의 집합</td></tr><tr><td>운영</td><td>Health Check(상태 점검)</td><td>커넥션 유효성 주기적 검사</td></tr><tr><td>운영</td><td>타임아웃 (Timeout)</td><td>대기/유휴 커넥션의 최대 허용 시간</td></tr><tr><td>운영</td><td>풀 고갈 (Pool Exhaustion)</td><td>풀 내 사용 가능한 커넥션이 모두 소진된 상태</td></tr></tbody></table><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><ul><li><a href=https://en.wikipedia.org/wiki/Connection_pool>커넥션 풀 개념 및 아키텍처</a></li><li><a href=https://github.com/brettwooldridge/HikariCP>Spring HikariCP 공식 문서</a></li><li><a href=https://www.psycopg.org/docs/pool.html>psycopg2 커넥션 풀 사용법</a></li><li><a href=https://www.baeldung.com/java-connection-pooling>커넥션 풀 튜닝 및 모니터링</a></li><li><a href=https://node-postgres.com/features/pooling>Node.js 커넥션 풀 활용법</a></li></ul><hr><h2 id=1-태그-tags>1. 태그 (Tags)<a hidden class=anchor aria-hidden=true href=#1-태그-tags>#</a></h2><ul><li>Connection-Pooling</li><li>Database-Integration</li><li>Systems-Infrastructure</li><li>Resource-Management</li></ul><hr><h2 id=2-분류-적절성-분석>2. 분류 적절성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-적절성-분석>#</a></h2><p>현재 구조에는 <strong>Systems and Infrastructure → Database Systems → Database Integration</strong>에 속하도록 배치되어 있습니다.<br><strong>근거</strong>:</p><ul><li>Connection Pool 은 <strong>데이터베이스와 애플리케이션 통합</strong> 시 자주 등장하는 핵심 패턴이고,</li><li>데이터베이스 연결 관리를 위한 <strong>시스템 인프라적 메커니즘</strong>이므로 분류가 적절합니다.</li></ul><hr><h2 id=3-요약-200-자-내외>3. 요약 (200 자 내외)<a hidden class=anchor aria-hidden=true href=#3-요약-200-자-내외>#</a></h2><p>Connection Pool 은 데이터베이스 연결의 생성·소멸 비용을 줄이기 위해 재사용 가능한 연결 집합을 유지하는 기술입니다. 성능 향상, 리소스 절약, 동시성 제어 등의 이점을 제공하며, 클라이언트‑사이드 라이브러리 또는 PgBouncer 같은 외부 미들웨어로 구현됩니다.</p><hr><h2 id=4-개요-250-자-내외>4. 개요 (250 자 내외)<a hidden class=anchor aria-hidden=true href=#4-개요-250-자-내외>#</a></h2><p>Connection Pool 은 애플리케이션이 데이터베이스와 효율적으로 연동하도록 돕는 핵심 패턴입니다. 초기 연결 비용을 회피하고 반복 요청 시 연결을 재사용하여 응답 시간을 줄이며, 데이터베이스의 동시 연결 수 제한 문제를 완화합니다. 클라이언트 라이브러리 (HikariCP, pg-pool 등) 나 PgBouncer/pgpool-II 같은 프록시 미들웨어로 구현 가능하며, 동적 확장, 유휴 관리, 장애 조치 등 다양한 기능을 제공해 고부하 환경에서도 안정성과 성능을 유지할 수 있습니다.</p><hr><h2 id=5-핵심-개념>5. 핵심 개념<a hidden class=anchor aria-hidden=true href=#5-핵심-개념>#</a></h2><ul><li><strong>Connection Pool</strong>: 미리 만든 연결 모음, 사용 후 반환하여 재사용</li><li><strong>Client-side pooling</strong>: HikariCP, pg-pool, ADO.NET 클라이언트에서 구현 (<a href="https://www.cockroachlabs.com/blog/what-is-connection-pooling/?utm_source=chatgpt.com" title="What is connection pooling, and why should you care - CockroachDB">cockroachlabs.com</a>, <a href="https://cloudnative-pg.io/documentation/1.15/connection_pooling/?utm_source=chatgpt.com" title="Connection Pooling - CloudNativePG">cloudnative-pg.io</a>, <a href="https://scalegrid.io/blog/postgresql-connection-pooling-part-1-pros-and-cons/?utm_source=chatgpt.com" title="PostgreSQL Connection Pooling: Part 1 - Pros & Cons - ScaleGrid">ScaleGrid</a>, <a href="https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/sql-server-connection-pooling?utm_source=chatgpt.com" title="SQL Server Connection Pooling - ADO.NET - Learn Microsoft">Microsoft Learn</a>)</li><li><strong>External pooling</strong>: PgBouncer, pgpool-II 같은 프록시 방식</li><li><strong>풀 설정</strong>: 최소/최대 사이즈, 유휴 시간, 타임아웃 설정 필요</li><li><strong>Pooling Mode</strong>: session, transaction, statement 방식 (<a href="https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-connection-pooling-best-practices?utm_source=chatgpt.com" title="Connection pooling best practices - Azure Database for PostgreSQL …">Microsoft Learn</a>)</li><li><strong>Wrapper Connection</strong>: Close 시 실제 종료가 아닌 반환 처리 (<a href="https://en.wikipedia.org/wiki/Database_connection?utm_source=chatgpt.com" title="Database connection">위키백과</a>)</li></ul><h3 id=51-실무-연관성>5.1 실무 연관성<a hidden class=anchor aria-hidden=true href=#51-실무-연관성>#</a></h3><ul><li><strong>성능 최적화</strong>: 연결 비용이 큰 환경에서 지연 최소화</li><li><strong>리소스 관리</strong>: DB 동시연결 제한 내에서 유휴 연결 제어</li><li><strong>장애 대응</strong>: 연결 끊김 시 재시도/교체 로직 포함</li><li><strong>구성 유연성</strong>: 각 모듈 별 또는 중앙 집중형 pool 설정</li></ul><hr><h2 id=6--6-주제와-관련하여-조사할-내용--반영>6. &ldquo;## 6. 주제와 관련하여 조사할 내용 " 반영<a hidden class=anchor aria-hidden=true href=#6--6-주제와-관련하여-조사할-내용--반영>#</a></h2><p>다음 항목들을 조사했으며, 이후 상세 분석 시 각각의 헤더에 맞춰 확장해 다루겠습니다:</p><ul><li>배경, 목적 및 필요성</li><li>주요 기능 및 역할</li><li>특징, 핵심 원칙</li><li>주요 원리·작동 방식 (diagram 포함)</li><li>구조·아키텍처 및 구성 요소 (필수/선택 구성 요소 구분)</li><li>구현 기법 (client-side vs external)</li><li>장/단점 및 해결책 (표 포함)</li><li>도전과제</li><li>분류 기준 → 종류/유형 (표 포함)</li><li>실무 사용 예시 및 활용 사례 (diagram, 코드)</li><li>구현 예시 (Python 또는 JS)</li><li>실무 적용 고려사항, 최적화 시 주의점 (표 + 권장사항)</li></ul><hr><h2 id=9-주목할-내용>9. 주목할 내용<a hidden class=anchor aria-hidden=true href=#9-주목할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>Architecture</td><td>Pooling Mode</td><td>session/transaction/statement</td><td>Connection 반환 시점을 결정, 기능/성능 영향</td></tr><tr><td>Middleware</td><td>External vs Client-side</td><td>PgBouncer vs HikariCP</td><td>중앙집중 vs 모듈단위 제어 방식의 차이</td></tr><tr><td>Configuration</td><td>Pool Size 설정</td><td>최소·최대 크기</td><td>동시성·리소스 균형 유지를 위한 핵심 변수</td></tr><tr><td>Resilience</td><td>Connection Health</td><td>idle/recycle/timeout</td><td>안정성을 위한 연결 유효성 관리</td></tr></tbody></table><hr><h2 id=10-반드시-학습해야할-내용>10. 반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#10-반드시-학습해야할-내용>#</a></h2><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>Performance</td><td>Latency 분석</td><td>connection acq./release</td><td>연결 재사용 전후 퍼포먼스 비교</td></tr><tr><td>Reliability</td><td>Connection Leak</td><td>감지/해결 기법</td><td>커넥션 반환 누락 문제 대응</td></tr><tr><td>Scaling</td><td>초당 요청·동시연결</td><td>동적 pool 조정</td><td>부하 변화에 따른 크기 조정 전략</td></tr><tr><td>Security</td><td>Credential Isolation</td><td>pooling 환경 보안 설정</td><td>사용자 격리, 인증 관리</td></tr><tr><td>Monitoring</td><td>Metrics & Alerts</td><td>pool 사용률, 대기시간</td><td>운영 시 필수 모니터링 지표</td></tr></tbody></table><hr><hr><h2 id=용어-정리-1>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-1>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>구성요소</td><td>Pool Mode</td><td>session/transaction/statement 방식</td></tr><tr><td>구성요소</td><td>Wrapper Connection</td><td>실제 DB 연결을 캡슐화한 객체</td></tr><tr><td>구성요소</td><td>Max Pool Size</td><td>최대 연결 수 설정값</td></tr><tr><td>운영</td><td>Connection Leak</td><td>반환되지 않고 유실된 연결</td></tr><tr><td>운영</td><td>Idle Timeout</td><td>유휴 연결을 닫는 기준 시간</td></tr></tbody></table><hr><h2 id=참고-및-출처-1>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-1>#</a></h2><ul><li>[CockroachDB: What is connection pooling] (<a href="https://scalegrid.io/blog/postgresql-connection-pooling-part-1-pros-and-cons/?utm_source=chatgpt.com" title="PostgreSQL Connection Pooling: Part 1 - Pros & Cons - ScaleGrid">ScaleGrid</a>, <a href="https://www.cockroachlabs.com/blog/what-is-connection-pooling/?utm_source=chatgpt.com" title="What is connection pooling, and why should you care - CockroachDB">cockroachlabs.com</a>, <a href="https://www.prisma.io/dataguide/database-tools/connection-pooling?utm_source=chatgpt.com" title="What is connection pooling in database management? - Prisma">Prisma</a>, <a href="https://scalegrid.io/blog/postgresql-connection-pooling-part-2-pgbouncer/?utm_source=chatgpt.com" title="PostgreSQL Connection Pooling: Part 2–PgBouncer - ScaleGrid">ScaleGrid</a>, <a href="https://en.wikipedia.org/wiki/Connection_pool?utm_source=chatgpt.com" title="Connection pool">위키백과</a>, <a href="https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/sql-server-connection-pooling?utm_source=chatgpt.com" title="SQL Server Connection Pooling - ADO.NET - Learn Microsoft">Microsoft Learn</a>)</li><li>[Medium: Connection pool 기본 개념]</li><li>[ScaleGrid: PgBouncer/pgpool-II 비교] (<a href="https://stackoverflow.blog/2020/10/14/improve-database-performance-with-connection-pooling/?utm_source=chatgpt.com" title="Improve database performance with connection pooling">stackoverflow.blog</a>)</li><li>[Prisma: internal vs external pooling] (<a href="https://www.prisma.io/dataguide/database-tools/connection-pooling?utm_source=chatgpt.com" title="What is connection pooling in database management? - Prisma">Prisma</a>)</li><li>[Vlad Mihalcea: Pool 아키텍처] (<a href="https://vladmihalcea.com/the-anatomy-of-connection-pooling/?utm_source=chatgpt.com" title="The anatomy of Connection Pooling - Vlad Mihalcea">Vlad Mihalcea</a>)</li><li>[StackOverflow: 구현 흐름 diagram] (<a href="https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-connection-pooling-best-practices?utm_source=chatgpt.com" title="Connection pooling best practices - Azure Database for PostgreSQL …">Microsoft Learn</a>)</li><li>[Azure Docs: pooling patterns & modes] (<a href="https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-connection-pooling-best-practices?utm_source=chatgpt.com" title="Connection pooling best practices - Azure Database for PostgreSQL …">Microsoft Learn</a>)</li><li>[ScaleGrid: PgBouncer 상세] (<a href="https://scalegrid.io/blog/postgresql-connection-pooling-part-2-pgbouncer/?utm_source=chatgpt.com" title="PostgreSQL Connection Pooling: Part 2–PgBouncer - ScaleGrid">ScaleGrid</a>)</li></ul><hr><p>필요하신 이후 항목 (arch., 구현, 코드, 사례 등) 추가 분석 및 도식 작업은 요청해 주세요.</p><p><a href=https://cloudnative-pg.io/documentation/current/connection_pooling/><figure><img alt="Connection pooling - CloudNativePG v1.25" loading=lazy src="https://tse1.mm.bing.net/th/id/OIP.uIGOm3vyYtBQKnqQDwfAtQHaFX?r=0\\&pid=Api"></figure></a></p><hr><h2 id=7-주요-원리--작동-방식-core-principles--mechanics->7. <strong>주요 원리 & 작동 방식 (Core Principles & Mechanics)</strong> 📌<a hidden class=anchor aria-hidden=true href=#7-주요-원리--작동-방식-core-principles--mechanics->#</a></h2><h3 id=-주요-원리>✅ 주요 원리<a hidden class=anchor aria-hidden=true href=#-주요-원리>#</a></h3><ol><li><p><strong>연결 재사용</strong></p><ul><li>초기 연결 생성 비용을 절감하고, 요청 시 기존 연결을 빌려 사용</li></ul></li><li><p><strong>풀링 모드 방식</strong></p><ul><li><strong>Session</strong>: 세션 종료 시 반환</li><li><strong>Transaction</strong>: 트랜잭션 종료 시 반환</li><li><strong>Statement</strong>: 쿼리 실행 후 즉시 반환 (<a href="https://www.cockroachlabs.com/blog/what-is-connection-pooling/?utm_source=chatgpt.com" title="What is connection pooling, and why should you care - CockroachDB">Medium</a>, <a href="https://cloudnative-pg.io/documentation/1.15/connection_pooling/?utm_source=chatgpt.com" title="Connection Pooling - CloudNativePG">위키백과</a>, <a href="https://scalegrid.io/blog/postgresql-connection-pooling-part-1-pros-and-cons/?utm_source=chatgpt.com" title="PostgreSQL Connection Pooling: Part 1 - Pros & Cons - ScaleGrid">ScaleGrid</a>)</li></ul></li><li><p><strong>정상화 절차 (Reset queries)</strong></p><ul><li>PgBouncer 등은 반환 시 상태 또는 세션 변수를 초기화 (<a href="https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/sql-server-connection-pooling?utm_source=chatgpt.com" title="SQL Server Connection Pooling - ADO.NET - Learn Microsoft">ScaleGrid</a>)</li></ul></li></ol><h3 id=-작동-다이어그램>✅ 작동 다이어그램<a hidden class=anchor aria-hidden=true href=#-작동-다이어그램>#</a></h3><pre class=mermaid>sequenceDiagram
    participant App
    participant Pool
    participant DB
    App-&gt;&gt;Pool: getConnection()
    Pool--&gt;&gt;App: WrapperConn
    App-&gt;&gt;App: execute SQL
    App-&gt;&gt;WrapperConn: close()
    WrapperConn-&gt;&gt;Pool: 반환
    alt Connection invalid?
        Pool-&gt;&gt;DB: 새로운 Connection 생성
    else
        Pool-&gt;&gt;App: 재사용
    end
</pre><ul><li><strong>WrapperConn</strong>: 실제 연결 대신 반환 시 풀로 돌려보내는 래퍼</li><li><strong>Pool 사이즈</strong>: min/max, idle timeout, health check 설정 필요</li></ul><hr><h2 id=8-구조--아키텍처-architecture--components>8. <strong>구조 & 아키텍처 (Architecture & Components)</strong><a hidden class=anchor aria-hidden=true href=#8-구조--아키텍처-architecture--components>#</a></h2><h3 id=-구성-요소-구분>🧩 구성 요소 구분<a hidden class=anchor aria-hidden=true href=#-구성-요소-구분>#</a></h3><table><thead><tr><th>구성 범주</th><th>필수 구성 요소</th><th>선택 구성 요소</th><th>역할 및 기능</th></tr></thead><tbody><tr><td>Core</td><td>Pool Manager</td><td>Connection Health Checker</td><td>연결 생성, 재사용, 반환, 유휴 관리</td></tr><tr><td></td><td>Connection Wrapper</td><td>Metrics & Logging</td><td>Close 이벤트 캡처, 사용자에게 래퍼 제공</td></tr><tr><td></td><td>Connection Factory</td><td>Prepared Statement Cache</td><td>물리 DB 연결 생성, Prepared SQL 캐싱 등</td></tr><tr><td>External</td><td>Client Connection Listener</td><td>Load Balancer Integration</td><td>앱의 연결 요청 수신, 로드 밸런서 앞단 배치</td></tr><tr><td></td><td>DB Connection Dispatcher</td><td>High availability watcher</td><td>DB 로의 실제 연결 라우팅, failover 감지 및 클러스터 대응</td></tr><tr><td>UI/Config</td><td>Configuration Loader</td><td>Admin Interface</td><td>설정 불러오기, runtime 조정, 통계 조회</td></tr></tbody></table><h4 id=-아키텍처-그림-pgbouncer-기준>🔧 아키텍처 그림 (PgBouncer 기준)<a hidden class=anchor aria-hidden=true href=#-아키텍처-그림-pgbouncer-기준>#</a></h4><pre class=mermaid>flowchart LR
  subgraph App Cluster
    A1[App1]
    A2[App2]
  end
  subgraph PgBouncer Pooler
    PL(Pool Manager)
    WL[Wrapper Conn]
    HL[Health Checker]
  end
  DB[(PostgreSQL)]
  A1 --&gt; PL
  A2 --&gt; PL
  PL --&gt; DB
  PL --&gt; HL
  HL --&gt; PL
</pre><ul><li><strong>PoolManager</strong>: 요청 처리 (빌려주고 반납)</li><li><strong>Health Checker</strong>: 유휴 연결 테스트, 유효하지 않은 연결 교체</li><li><strong>Wrapper Conn</strong>: 반환 시 wrap 된 연결을 PoolManager 에게 전달</li><li><strong>Prepared Cache</strong> 등은 선택 구성 요소로 추가 성능 개선 가능</li></ul><hr><h2 id=9-구조---구성요소-요약>9. <strong>구조 - 구성요소 요약</strong><a hidden class=anchor aria-hidden=true href=#9-구조---구성요소-요약>#</a></h2><table><thead><tr><th>구성 요소</th><th>필수/선택</th><th>역할 및 기능</th></tr></thead><tbody><tr><td>Pool Manager</td><td>필수</td><td>연결 할당/반환 로직, 크기 제어, 큐 관리</td></tr><tr><td>Connection Wrapper</td><td>필수</td><td>실제 Close 대신의 반환 메커니즘</td></tr><tr><td>Connection Factory</td><td>필수</td><td>신규 연결 생성, 접속 파라미터 관리</td></tr><tr><td>Health Checker</td><td>선택</td><td>주기적 연결 유효성 검사 및 재생성</td></tr><tr><td>Metrics Logger</td><td>선택</td><td>Connection 수, 대기 시간, 누수 감지 등</td></tr><tr><td>Prepared Cache</td><td>선택</td><td>Prepared Statement 재사용으로 성능 향상</td></tr><tr><td>External Listener</td><td>선택</td><td>외부 Pooler 에 필요한 연결 수신</td></tr><tr><td>HA Watcher & LB Integration</td><td>선택</td><td>HA 구성을 위한 failover, 로드 밸런싱 기능</td></tr></tbody></table><hr><p>이어서 <strong>구현 기법 비교</strong>, <strong>장단점 표</strong>, <strong>실무 예시 및 코드 구현</strong>, <strong>도전 과제 등</strong> 상세 분석이 필요하면 말씀해 주세요! 😊</p><p>이어서 <strong>Connection Pool</strong>에 대한 심화 내용을 구조적으로 분석하겠습니다.</p><hr><h2 id=10-구현-기법-implementation-techniques>10. 구현 기법 (Implementation Techniques)<a hidden class=anchor aria-hidden=true href=#10-구현-기법-implementation-techniques>#</a></h2><h3 id=-1-구현-기법의-분류>🎯 1) 구현 기법의 분류<a hidden class=anchor aria-hidden=true href=#-1-구현-기법의-분류>#</a></h3><table><thead><tr><th>구분</th><th>구현 방식</th><th>설명</th></tr></thead><tbody><tr><td>클라이언트 측 구현 (Client-side)</td><td>애플리케이션 내부에 Pool 포함</td><td>Spring + HikariCP, Node.js + pg-pool 등</td></tr><tr><td>미들웨어 구현 (External Pooler)</td><td>DB 와 애플리케이션 사이에 별도 Pool 구성</td><td>PgBouncer, pgpool-II, ProxySQL 등</td></tr><tr><td>커스텀 구현 (Custom Embedded)</td><td>직접 Pool 로직 구현 (주로 실험적)</td><td>Thread-safe queue 와 연결 객체 관리 등</td></tr></tbody></table><hr><h3 id=-2-주요-구현-기법-분석>🎯 2) 주요 구현 기법 분석<a hidden class=anchor aria-hidden=true href=#-2-주요-구현-기법-분석>#</a></h3><h4 id=-hikaricp-java-기반>✅ HikariCP (Java 기반)<a hidden class=anchor aria-hidden=true href=#-hikaricp-java-기반>#</a></h4><ul><li><strong>기능</strong>: 최대 성능에 최적화된 connection pool, Java 진영에서 표준</li><li><strong>특징</strong>:<ul><li>낮은 latency (borrow/return 평균 &lt; 50ns)</li><li>fail-fast 전략</li><li>leak detection, auto retry</li></ul></li><li><strong>예시 코드</strong> (Spring Boot 기반)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DBConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=nf>dataSource</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HikariConfig</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HikariConfig</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setJdbcUrl</span><span class=p>(</span><span class=s>&#34;jdbc:postgresql://localhost:5432/mydb&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;pass&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setMaximumPoolSize</span><span class=p>(</span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>config</span><span class=p>.</span><span class=na>setIdleTimeout</span><span class=p>(</span><span class=n>30000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HikariDataSource</span><span class=p>(</span><span class=n>config</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=-pg-pool-nodejs-기반>✅ Pg-pool (Node.js 기반)<a hidden class=anchor aria-hidden=true href=#-pg-pool-nodejs-기반>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>Pool</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;pg&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>pool</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Pool</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>max</span><span class=o>:</span> <span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>idleTimeoutMillis</span><span class=o>:</span> <span class=mi>30000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>connectionTimeoutMillis</span><span class=o>:</span> <span class=mi>2000</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>pool</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;SELECT NOW()&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>pool</span><span class=p>.</span><span class=nx>end</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-pgbouncer-external-pooler>✅ PgBouncer (External Pooler)<a hidden class=anchor aria-hidden=true href=#-pgbouncer-external-pooler>#</a></h4><ul><li><strong>설정 예시</strong> (<code>pgbouncer.ini</code>)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4>4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5>5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6>6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7>7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[databases]</span>
</span></span><span class=line><span class=cl><span class=na>mydb</span> <span class=o>=</span> <span class=s>host=127.0.0.1 port=5432 dbname=mydb</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[pgbouncer]</span>
</span></span><span class=line><span class=cl><span class=na>listen_port</span> <span class=o>=</span> <span class=s>6432</span>
</span></span><span class=line><span class=cl><span class=na>pool_mode</span> <span class=o>=</span> <span class=s>transaction</span>
</span></span><span class=line><span class=cl><span class=na>max_client_conn</span> <span class=o>=</span> <span class=s>100</span>
</span></span><span class=line><span class=cl><span class=na>default_pool_size</span> <span class=o>=</span> <span class=s>20</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=11-장점-정리>11. 장점 정리<a hidden class=anchor aria-hidden=true href=#11-장점-정리>#</a></h2><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>연결 비용 절감</td><td>연결 재사용으로 TCP 핸드쉐이크 등 초기 오버헤드 제거</td></tr><tr><td></td><td>성능 향상</td><td>대기 없는 빠른 연결 획득으로 TPS 향상</td></tr><tr><td></td><td>DB 보호</td><td>max_connections 제한 내에서 연결 제어 가능</td></tr><tr><td></td><td>장애 복원성 강화</td><td>연결 실패 시 자동 재시도 또는 교체 가능</td></tr><tr><td></td><td>모니터링 가능</td><td>연결 수, 사용률, 지연 시간 등 지표 수집 가능</td></tr><tr><td></td><td>유연한 확장성</td><td>Pool size 조정으로 수평적 확장 대응</td></tr></tbody></table><hr><h2 id=12-단점과-문제점-그리고-해결방안>12. 단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#12-단점과-문제점-그리고-해결방안>#</a></h2><h3 id=-단점>❌ 단점<a hidden class=anchor aria-hidden=true href=#-단점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>설정 복잡도</td><td>풀 사이즈, 타임아웃 등 미세 튜닝 필요</td><td>모니터링 도구 및 초기 벤치마크 필요</td></tr><tr><td></td><td>커넥션 누수 위험</td><td>Close 누락 시 연결 고갈 가능</td><td>try-with-resources 또는 middleware 사용</td></tr><tr><td></td><td>오히려 과부하 유발 가능</td><td>풀 사이즈가 너무 크면 DB 가 처리 불가</td><td>DB max_connections 기준 설정</td></tr></tbody></table><hr><h3 id=-문제점>❗ 문제점<a hidden class=anchor aria-hidden=true href=#-문제점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>커넥션 누수</td><td>close() 누락</td><td>pool 고갈, deadlock</td><td>timeout alert, pool stat 확인</td><td>try-finally 구조, connection proxy 사용</td><td>leakDetectionThreshold 설정 (Hikari)</td></tr><tr><td>문제점</td><td>pool starvation</td><td>요청이 pool 보다 많음</td><td>성능 저하, 대기 시간 증가</td><td>queue 길이, CPU 사용률 증가</td><td>autoscaling, queueing mechanism</td><td>minIdle 조정, backpressure 적용</td></tr><tr><td>문제점</td><td>stale connection</td><td>네트워크 장애 후 회복 불가</td><td>쿼리 실패, 예외 발생</td><td>health check, ping timeout</td><td>heartbeat 또는 validation query</td><td>연결 유효성 검사 (validationQuery) 사용</td></tr></tbody></table><hr><h2 id=13-도전-과제>13. 도전 과제<a hidden class=anchor aria-hidden=true href=#13-도전-과제>#</a></h2><table><thead><tr><th>카테고리</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>Scale</td><td>수요 급증 시 Pool 한계</td><td>고정된 pool size</td><td>처리량 제한</td><td>TPS 모니터링</td><td>autoscaling 기반 pool 조정</td><td>dynamic pool resize 구현</td></tr><tr><td>Observability</td><td>모니터링 부재</td><td>메트릭 수집 누락</td><td>장애 원인 파악 어려움</td><td>pool usage 그래프</td><td>통합 모니터링 도구 연동</td><td>Grafana, Prometheus 연계</td></tr><tr><td>Security</td><td>공유 pool 사용자 인증 문제</td><td>모든 사용자 동일 계정 사용</td><td>감사/추적 어려움</td><td>audit log 미확인</td><td>사용자 기반 연결 풀 분리</td><td>RBAC (역할 기반 접근 제어)</td></tr></tbody></table><hr><h2 id=14-분류-기준에-따른-종류-및-유형>14. 분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#14-분류-기준에-따른-종류-및-유형>#</a></h2><table><thead><tr><th>기준</th><th>유형</th><th>설명</th></tr></thead><tbody><tr><td>배치 위치</td><td>내부 (Client-side)</td><td>라이브러리 기반 구현 (e.g., HikariCP)</td></tr><tr><td></td><td>외부 (Proxy-type)</td><td>미들웨어 방식 (e.g., PgBouncer)</td></tr><tr><td>반환 방식</td><td>Session 기반</td><td>세션 종료 시 반환</td></tr><tr><td></td><td>Transaction 기반</td><td>트랜잭션 단위로 반환</td></tr><tr><td></td><td>Statement 기반</td><td>쿼리 실행 후 바로 반환</td></tr><tr><td>연결 처리</td><td>Lazy 연결</td><td>요청 시 연결 생성</td></tr><tr><td></td><td>Eager 연결</td><td>사전 연결 생성</td></tr></tbody></table><hr><h2 id=15-실무-사용-예시>15. 실무 사용 예시<a hidden class=anchor aria-hidden=true href=#15-실무-사용-예시>#</a></h2><table><thead><tr><th>시스템</th><th>사용 대상</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>Spring Boot API</td><td>HikariCP</td><td>빠른 연결 획득 및 안정성 확보</td><td>TPS 30% 향상, 연결 누수 방지</td></tr><tr><td>Node.js Backend</td><td>pg-pool</td><td>요청 처리 최적화</td><td>Pool size tuning 으로 처리량 증가</td></tr><tr><td>PostgreSQL Cluster</td><td>PgBouncer</td><td>DB 보호 및 트래픽 분산</td><td>연결 수 80% 절감, 대기시간 감소</td></tr></tbody></table><hr><h2 id=16-활용-사례-pgbouncer-기반의-postgresql-고부하-처리>16. 활용 사례 (PgBouncer 기반의 PostgreSQL 고부하 처리)<a hidden class=anchor aria-hidden=true href=#16-활용-사례-pgbouncer-기반의-postgresql-고부하-처리>#</a></h2><h3 id=-시스템-구성>🎯 시스템 구성<a hidden class=anchor aria-hidden=true href=#-시스템-구성>#</a></h3><pre class=mermaid>graph LR
A[Client App] --&gt; B[PgBouncer]
B --&gt; C[PostgreSQL Primary]
</pre><h3 id=-workflow>🔧 Workflow<a hidden class=anchor aria-hidden=true href=#-workflow>#</a></h3><ol><li>클라이언트 요청 시 PgBouncer 가 연결을 대신 받아 대기열 관리</li><li>PgBouncer 는 풀링된 연결 중 하나를 사용해 DB 에 요청 전달</li><li>결과 반환 후 연결은 pool 로 복귀</li></ol><h3 id=-connection-pool-의-역할>📌 Connection Pool 의 역할<a hidden class=anchor aria-hidden=true href=#-connection-pool-의-역할>#</a></h3><ul><li><strong>DB 에 대한 부하 완화</strong>: 직접 연결 횟수 감소</li><li><strong>Failover 처리</strong>: 연결 실패 시 다른 노드 자동 재시도</li><li><strong>Transaction-level pooling</strong>으로 connection leak 차단</li></ul><hr><p>이어서 <strong>Connection Pool</strong> 주제의 나머지 심화 항목들을 완성합니다.</p><hr><h2 id=17-구현-예시-python-기반>17. 구현 예시 (Python 기반)<a hidden class=anchor aria-hidden=true href=#17-구현-예시-python-기반>#</a></h2><h3 id=-구현-시나리오>✅ 구현 시나리오<a hidden class=anchor aria-hidden=true href=#-구현-시나리오>#</a></h3><p>Python 애플리케이션에서 <code>psycopg2</code> 와 <code>psycopg2.pool</code> 모듈을 활용해 PostgreSQL 용 커넥션 풀을 구현합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22>22</a>
</span><span class=lnt id=hl-9-23><a class=lnlinks href=#hl-9-23>23</a>
</span><span class=lnt id=hl-9-24><a class=lnlinks href=#hl-9-24>24</a>
</span><span class=lnt id=hl-9-25><a class=lnlinks href=#hl-9-25>25</a>
</span><span class=lnt id=hl-9-26><a class=lnlinks href=#hl-9-26>26</a>
</span><span class=lnt id=hl-9-27><a class=lnlinks href=#hl-9-27>27</a>
</span><span class=lnt id=hl-9-28><a class=lnlinks href=#hl-9-28>28</a>
</span><span class=lnt id=hl-9-29><a class=lnlinks href=#hl-9-29>29</a>
</span><span class=lnt id=hl-9-30><a class=lnlinks href=#hl-9-30>30</a>
</span><span class=lnt id=hl-9-31><a class=lnlinks href=#hl-9-31>31</a>
</span><span class=lnt id=hl-9-32><a class=lnlinks href=#hl-9-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># db_pool.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>psycopg2</span> <span class=kn>import</span> <span class=n>pool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># PostgreSQL 연결 풀 생성</span>
</span></span><span class=line><span class=cl><span class=n>connection_pool</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>pool</span><span class=o>.</span><span class=n>SimpleConnectionPool</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>minconn</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>           <span class=c1># 최소 커넥션 수</span>
</span></span><span class=line><span class=cl>    <span class=n>maxconn</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>          <span class=c1># 최대 커넥션 수</span>
</span></span><span class=line><span class=cl>    <span class=n>user</span><span class=o>=</span><span class=s2>&#34;dbuser&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span><span class=o>=</span><span class=s2>&#34;dbpass&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>port</span><span class=o>=</span><span class=s2>&#34;5432&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>database</span><span class=o>=</span><span class=s2>&#34;mydb&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 커넥션 가져오기</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fetch_data</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 커넥션 풀에서 하나 가져오기</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span> <span class=o>=</span> <span class=n>connection_pool</span><span class=o>.</span><span class=n>getconn</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>cursor</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM users;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>rows</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>rows</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;DB Error:&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 사용한 커넥션 반환</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cursor</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>connection_pool</span><span class=o>.</span><span class=n>putconn</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-역할과-기능-요약>🔍 역할과 기능 요약<a hidden class=anchor aria-hidden=true href=#-역할과-기능-요약>#</a></h3><table><thead><tr><th>요소</th><th>기능</th></tr></thead><tbody><tr><td><code>SimpleConnectionPool</code></td><td>기본 풀 클래스 (스레드 안전)</td></tr><tr><td><code>getconn()</code></td><td>연결 획득</td></tr><tr><td><code>putconn()</code></td><td>연결 반환</td></tr><tr><td>예외 처리</td><td>실패 시 connection 반환 누락 방지</td></tr></tbody></table><hr><h2 id=18-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>18. 실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#18-실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>고려 항목</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td>Pool Size 설정</td><td>너무 작으면 대기 큐 발생, 너무 크면 DB 과부하</td><td>TPS 기준 + DB <code>max_connections</code> 대비 70~80%</td></tr><tr><td>Timeout 관리</td><td>무한 대기 시 서버 hang 가능</td><td><code>connection_timeout</code>, <code>idle_timeout</code> 설정</td></tr><tr><td>커넥션 유효성 검사</td><td>Stale connection 문제 방지</td><td><code>validationQuery</code> 또는 ping 사용</td></tr><tr><td>커넥션 누수 방지</td><td>Close 누락 시 pool 고갈</td><td>finally 블록 사용 또는 AOP 트래킹 적용</td></tr><tr><td>트랜잭션 모드 사용</td><td>불필요한 커넥션 고정 방지</td><td><code>transaction</code> 또는 <code>statement</code> 모드 설정 권장</td></tr></tbody></table><hr><h2 id=19-최적화하기-위한-고려사항-및-주의할-점>19. 최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#19-최적화하기-위한-고려사항-및-주의할-점>#</a></h2><table><thead><tr><th>최적화 항목</th><th>설명</th><th>권장 사항</th></tr></thead><tbody><tr><td>Autotuning</td><td>부하 기반 pool 크기 조정</td><td>모니터링 연동 자동 스케일링 구현</td></tr><tr><td>Prepared Statement Cache</td><td>반복 쿼리 속도 향상</td><td>캐시 크기와 TTL 관리</td></tr><tr><td>모니터링 및 알림 설정</td><td>누수, 지연, 실패 탐지</td><td>Prometheus, Grafana 와 통합</td></tr><tr><td>연결 분산 전략</td><td>단일 DB 집중 부하 분산</td><td>Read Replica + Load Balancer 연동</td></tr><tr><td>Idle 연결 제거</td><td>리소스 낭비 방지</td><td><code>idleTimeout</code> 또는 LRU 전략 적용</td></tr></tbody></table><hr><h2 id=20-결론-요약>20. 결론 요약<a hidden class=anchor aria-hidden=true href=#20-결론-요약>#</a></h2><p>Connection Pool 은 고성능 애플리케이션에서 데이터베이스 연결 비용을 줄이고 동시 처리 효율을 높이기 위한 핵심 기술입니다. 클라이언트 라이브러리 또는 미들웨어를 통해 구현할 수 있으며, 풀링 전략 (Session, Transaction 등), 연결 유효성 관리, 누수 방지, 모니터링 체계를 잘 설계해야 합니다. 성능 개선뿐 아니라 운영 안정성 확보를 위해서는 구성 요소 간 역할 이해와 환경에 맞는 최적화 전략이 필수입니다.</p><hr><h2 id=용어-정리-2>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-2>#</a></h2><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>Pooling Mode</td><td>Session, Transaction, Statement</td><td>연결 반환 시점에 따라 분류되는 연결 재사용 방식</td></tr><tr><td>Stale Connection</td><td>오래된 연결</td><td>유휴 또는 네트워크 오류로 인해 사용 불가 상태인 연결</td></tr><tr><td>Wrapper Connection</td><td>래퍼 커넥션</td><td>연결 반환을 감추는 객체로 실제 종료 대신 풀에 반환</td></tr><tr><td>Leak Detection</td><td>누수 탐지</td><td>반환되지 않은 연결을 감지하는 기법</td></tr><tr><td>PgBouncer</td><td>외부 커넥션 풀러</td><td>PostgreSQL 에 대한 경량 미들웨어 기반 Pool 솔루션</td></tr></tbody></table><hr><h2 id=참고-및-출처-2>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-2>#</a></h2><ul><li><a href="https://www.cockroachlabs.com/blog/what-is-connection-pooling/?utm_source=chatgpt.com">What is Connection Pooling - Cockroach Labs</a></li><li><a href="https://scalegrid.io/blog/postgresql-connection-pooling-part-1-pros-and-cons/?utm_source=chatgpt.com">PostgreSQL Connection Pooling - ScaleGrid</a></li><li><a href="https://www.pgbouncer.org/config.html?utm_source=chatgpt.com">PgBouncer Docs</a></li><li><a href="https://www.prisma.io/dataguide/database-tools/connection-pooling?utm_source=chatgpt.com">Prisma Guide - Connection Pooling</a></li><li><a href="https://github.com/brettwooldridge/HikariCP?utm_source=chatgpt.com">HikariCP 공식 문서</a></li><li><a href="https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/sql-server-connection-pooling?utm_source=chatgpt.com">Microsoft ADO.NET Connection Pooling</a></li></ul><hr><p>안녕하세요! Connection Pool 에 대한 종합적인 조사와 분석을 단계별로 진행하겠습니다.</p><h2 id=1-주제-태그>1. 주제 태그<a hidden class=anchor aria-hidden=true href=#1-주제-태그>#</a></h2><ul><li><code>Connection-Pool</code></li><li><code>Database-Management</code></li><li><code>Resource-Pooling</code></li><li><code>Performance-Optimization</code></li></ul><h2 id=2-분류-구조-적절성-분석>2. 분류 구조 적절성 분석<a hidden class=anchor aria-hidden=true href=#2-분류-구조-적절성-분석>#</a></h2><p>제시된 분류 &ldquo;Systems and Infrastructure > Database Systems > Database Integration&rdquo; 는 적절합니다.</p><p><strong>근거:</strong></p><ul><li>Connection Pool 은 데이터베이스 연결 관리를 위한 인프라 구성 요소</li><li>애플리케이션과 데이터베이스 시스템 간의 통합을 담당</li><li>시스템 리소스 관리와 성능 최적화에 핵심적 역할</li></ul><h2 id=3-주제-요약-설명-200-자-내외>3. 주제 요약 설명 (200 자 내외)<a hidden class=anchor aria-hidden=true href=#3-주제-요약-설명-200-자-내외>#</a></h2><p>Connection Pool 은 애플리케이션과 데이터베이스 간의 연결을 미리 생성하여 재사용하는 소프트웨어 패턴입니다. 연결 생성/해제 비용을 줄이고, 동시 연결 수를 제어하여 시스템 리소스를 효율적으로 관리하며, 데이터베이스 성능과 확장성을 향상시키는 핵심 기술입니다.</p><h2 id=4-전체-개요-250-자-내외>4. 전체 개요 (250 자 내외)<a hidden class=anchor aria-hidden=true href=#4-전체-개요-250-자-내외>#</a></h2><p>Connection Pool 은 현대 웹 애플리케이션에서 필수적인 데이터베이스 연결 관리 기술로, 미리 생성된 연결들을 풀 (Pool) 에 보관하고 재사용합니다. 연결 생성 오버헤드 감소, 리소스 사용량 제어, 성능 향상을 통해 대용량 트래픽 처리를 가능하게 하며, 다양한 구현 기법과 최적화 전략을 통해 시스템의 안정성과 확장성을 보장하는 핵심 인프라 구성 요소입니다.</p><hr><h2 id=connection-pool-종합-분석>Connection Pool 종합 분석<a hidden class=anchor aria-hidden=true href=#connection-pool-종합-분석>#</a></h2><h3 id=핵심-개념>핵심 개념<a hidden class=anchor aria-hidden=true href=#핵심-개념>#</a></h3><p>Connection Pool 은 데이터베이스 연결을 효율적으로 관리하기 위한 소프트웨어 디자인 패턴입니다.</p><h4 id=주요-핵심-개념들>주요 핵심 개념들<a hidden class=anchor aria-hidden=true href=#주요-핵심-개념들>#</a></h4><p><strong>1. 풀링 메커니즘 (Pooling Mechanism)</strong></p><ul><li>미리 생성된 연결 객체들을 메모리에 보관</li><li>요청 시 기존 연결을 대여하고 사용 후 반환</li><li>연결의 생명주기 관리</li></ul><p><strong>2. 연결 재사용 (Connection Reuse)</strong></p><ul><li>TCP 핸드셰이크 비용 절약</li><li>데이터베이스 인증 과정 생략</li><li>연결 초기화 오버헤드 감소</li></ul><p><strong>3. 리소스 제한 (Resource Limitation)</strong></p><ul><li>최대 연결 수 제어</li><li>메모리 사용량 관리</li><li>데이터베이스 부하 조절</li></ul><h4 id=실무-구현-연관성>실무 구현 연관성<a hidden class=anchor aria-hidden=true href=#실무-구현-연관성>#</a></h4><p><strong>성능 측면:</strong></p><ul><li>응답 시간 단축: 연결 생성 시간 제거로 즉시 쿼리 실행</li><li>처리량 증가: 동시 처리 가능한 요청 수 향상</li><li>리소스 효율성: 메모리와 CPU 사용량 최적화</li></ul><p><strong>안정성 측면:</strong></p><ul><li>연결 검증: 사용 전 연결 상태 확인</li><li>장애 격리: 불량 연결 자동 제거 및 복구</li><li>부하 제어: 과도한 연결 요청 차단</li></ul><p><strong>확장성 측면:</strong></p><ul><li>동적 크기 조정: 트래픽에 따른 풀 크기 변경</li><li>분산 환경 지원: 여러 서버 간 연결 분배</li><li>모니터링: 연결 상태 및 성능 지표 추적</li></ul><h3 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h3><p>Connection Pool 의 등장 배경은 전통적인 데이터베이스 연결 방식의 한계에서 시작됩니다.</p><p><strong>기존 방식의 문제점:</strong></p><ul><li>매 요청마다 새로운 연결 생성/해제</li><li>TCP 소켓 생성 및 인증 과정의 반복적 수행</li><li>높은 오버헤드로 인한 성능 저하</li><li>동시 연결 수 제한으로 인한 확장성 문제</li></ul><p><strong>기술적 진화:</strong></p><ol><li><strong>1990 년대</strong>: 웹 애플리케이션 확산과 함께 연결 관리 필요성 대두</li><li><strong>2000 년대</strong>: J2EE,.NET 등 엔터프라이즈 플랫폼에서 표준화</li><li><strong>2010 년대</strong>: 클라우드 환경과 마이크로서비스 아키텍처에서 중요성 증대</li><li><strong>현재</strong>: 컨테이너 환경과 서버리스 아키텍처에서 핵심 기술</li></ol><h3 id=목적-및-필요성>목적 및 필요성<a hidden class=anchor aria-hidden=true href=#목적-및-필요성>#</a></h3><h4 id=주요-목적>주요 목적<a hidden class=anchor aria-hidden=true href=#주요-목적>#</a></h4><p><strong>1. 성능 최적화</strong></p><ul><li>연결 생성 시간 단축</li><li>응답 속도 향상</li><li>처리량 증대</li></ul><p><strong>2. 리소스 관리</strong></p><ul><li>메모리 사용량 제어</li><li>데이터베이스 부하 분산</li><li>시스템 안정성 확보</li></ul><p><strong>3. 확장성 지원</strong></p><ul><li>대량 동시 접속 처리</li><li>트래픽 급증 대응</li><li>시스템 용량 증대</li></ul><h4 id=필요성>필요성<a hidden class=anchor aria-hidden=true href=#필요성>#</a></h4><p><strong>비즈니스 관점:</strong></p><ul><li>사용자 경험 개선</li><li>운영 비용 절감</li><li>서비스 가용성 향상</li></ul><p><strong>기술적 관점:</strong></p><ul><li>시스템 부하 감소</li><li>장애 발생률 저하</li><li>유지보수 용이성</li></ul><h3 id=주요-기능-및-역할>주요 기능 및 역할<a hidden class=anchor aria-hidden=true href=#주요-기능-및-역할>#</a></h3><h4 id=핵심-기능>핵심 기능<a hidden class=anchor aria-hidden=true href=#핵심-기능>#</a></h4><p><strong>1. 연결 생성 및 관리 (Connection Creation & Management)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>초기화 → 연결 생성 → 풀 등록 → 대여 → 반환 → 정리
</span></span></code></pre></td></tr></table></div></div><p><strong>2. 연결 풀 모니터링 (Pool Monitoring)</strong></p><ul><li>활성 연결 수 추적</li><li>유휴 연결 관리</li><li>성능 메트릭 수집</li></ul><p><strong>3. 연결 검증 (Connection Validation)</strong></p><ul><li>연결 상태 확인</li><li>타임아웃 처리</li><li>장애 연결 복구</li></ul><h4 id=주요-역할>주요 역할<a hidden class=anchor aria-hidden=true href=#주요-역할>#</a></h4><p><strong>애플리케이션 계층:</strong></p><ul><li>데이터베이스 접근 추상화</li><li>연결 관리 자동화</li><li>개발 복잡성 감소</li></ul><p><strong>데이터베이스 계층:</strong></p><ul><li>연결 수 제한</li><li>부하 분산</li><li>리소스 보호</li></ul><h3 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h3><h4 id=핵심-특징>핵심 특징<a hidden class=anchor aria-hidden=true href=#핵심-특징>#</a></h4><p><strong>1. 사전 할당 (Pre-allocation)</strong></p><ul><li>애플리케이션 시작 시 연결 미리 생성</li><li>즉시 사용 가능한 연결 확보</li><li>초기 지연 시간 제거</li></ul><p><strong>2. 재사용성 (Reusability)</strong></p><ul><li>연결 객체의 반복 사용</li><li>생성/해제 비용 최소화</li><li>메모리 효율성 향상</li></ul><p><strong>3. 동시성 제어 (Concurrency Control)</strong></p><ul><li>스레드 안전한 연결 관리</li><li>동시 접근 제어</li><li>데드락 방지</li></ul><p><strong>4. 자동 복구 (Auto Recovery)</strong></p><ul><li>장애 연결 자동 감지</li><li>새로운 연결 자동 생성</li><li>시스템 자가 치유</li></ul><h3 id=핵심-원칙>핵심 원칙<a hidden class=anchor aria-hidden=true href=#핵심-원칙>#</a></h3><h4 id=설계-원칙>설계 원칙<a hidden class=anchor aria-hidden=true href=#설계-원칙>#</a></h4><p><strong>1. 효율성 (Efficiency)</strong></p><ul><li>최소한의 오버헤드</li><li>최대한의 재사용</li><li>최적화된 리소스 활용</li></ul><p><strong>2. 안정성 (Reliability)</strong></p><ul><li>장애 내성</li><li>자동 복구</li><li>일관된 성능</li></ul><p><strong>3. 확장성 (Scalability)</strong></p><ul><li>동적 크기 조정</li><li>부하 분산</li><li>수평 확장 지원</li></ul><p><strong>4. 관리성 (Manageability)</strong></p><ul><li>모니터링 기능</li><li>설정 유연성</li><li>진단 도구</li></ul><h3 id=주요-원리>주요 원리<a hidden class=anchor aria-hidden=true href=#주요-원리>#</a></h3><h4 id=작동-원리>작동 원리<a hidden class=anchor aria-hidden=true href=#작동-원리>#</a></h4><pre class=mermaid>sequenceDiagram
    participant App as Application
    participant Pool as Connection Pool
    participant DB as Database
    
    Note over Pool: 초기화 시 연결 미리 생성
    Pool-&gt;&gt;DB: 연결 생성 (최소 크기)
    DB--&gt;&gt;Pool: 연결 반환
    
    App-&gt;&gt;Pool: 연결 요청
    Pool-&gt;&gt;Pool: 사용 가능한 연결 확인
    Pool--&gt;&gt;App: 연결 대여
    
    App-&gt;&gt;DB: 쿼리 실행
    DB--&gt;&gt;App: 결과 반환
    
    App-&gt;&gt;Pool: 연결 반환
    Pool-&gt;&gt;Pool: 연결 상태 검증
    
    Note over Pool: 유휴 시간 초과 시
    Pool-&gt;&gt;DB: 연결 해제
</pre><h4 id=핵심-원리-설명>핵심 원리 설명<a hidden class=anchor aria-hidden=true href=#핵심-원리-설명>#</a></h4><p><strong>1. 지연 초기화 vs 즉시 초기화</strong></p><ul><li>즉시 초기화: 애플리케이션 시작 시 최소 연결 생성</li><li>지연 초기화: 첫 요청 시 연결 생성</li><li>하이브리드: 최소 연결은 즉시, 추가 연결은 지연</li></ul><p><strong>2. 연결 수명 주기 관리</strong></p><ul><li>생성: 풀 크기에 따른 연결 생성</li><li>검증: 사용 전후 연결 상태 확인</li><li>갱신: 주기적 연결 재생성</li><li>제거: 장애 또는 만료된 연결 정리</li></ul><h3 id=작동-원리-및-방식>작동 원리 및 방식<a hidden class=anchor aria-hidden=true href=#작동-원리-및-방식>#</a></h3><h4 id=상세-작동-방식>상세 작동 방식<a hidden class=anchor aria-hidden=true href=#상세-작동-방식>#</a></h4><p><strong>1. 풀 초기화 단계</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6>6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7>7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8>8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>애플리케이션 시작
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>설정 로드 (최소/최대 크기, 타임아웃 등)
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>최소 연결 수만큼 연결 생성
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>풀에 연결 등록
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>모니터링 스레드 시작
</span></span></code></pre></td></tr></table></div></div><p><strong>2. 연결 요청 처리</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>연결 요청 수신
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>사용 가능한 연결 검색
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>연결 존재 여부 확인
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>[존재] 연결 대여 → 상태 변경 (IDLE → ACTIVE)
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>[부재] 새 연결 생성 (최대 크기 내) 또는 대기
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>연결 반환
</span></span></code></pre></td></tr></table></div></div><p><strong>3. 연결 반환 처리</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4>4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5>5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6>6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7>7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8>8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>연결 반환 요청
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>연결 상태 검증
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>[정상] 상태 변경 (ACTIVE → IDLE)
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>[비정상] 연결 제거 후 새 연결 생성
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>풀에 연결 등록
</span></span></code></pre></td></tr></table></div></div><h4 id=동시성-처리-방식>동시성 처리 방식<a hidden class=anchor aria-hidden=true href=#동시성-처리-방식>#</a></h4><p><strong>스레드 안전성:</strong></p><ul><li>동기화된 컬렉션 사용</li><li>원자적 연산을 통한 상태 관리</li><li>락 (Lock) 최소화를 통한 성능 최적화</li></ul><h3 id=구조-및-아키텍처>구조 및 아키텍처<a hidden class=anchor aria-hidden=true href=#구조-및-아키텍처>#</a></h3><h4 id=전체-아키텍처>전체 아키텍처<a hidden class=anchor aria-hidden=true href=#전체-아키텍처>#</a></h4><pre class=mermaid>graph TB
    subgraph &#34;Application Layer&#34;
        A1[Web Application]
        A2[Business Logic]
        A3[Data Access Layer]
    end
    
    subgraph &#34;Connection Pool&#34;
        P1[Pool Manager]
        P2[Connection Validator]
        P3[Monitoring Service]
        P4[Connection Queue]
        
        subgraph &#34;Connection Objects&#34;
            C1[Connection 1]
            C2[Connection 2]
            C3[Connection 3]
            C4[...]
        end
    end
    
    subgraph &#34;Database Layer&#34;
        D1[Database Server]
        D2[Connection Handler]
    end
    
    A3 --&gt; P1
    P1 --&gt; P4
    P4 --&gt; C1
    P4 --&gt; C2
    P4 --&gt; C3
    P4 --&gt; C4
    
    P1 --&gt; P2
    P1 --&gt; P3
    
    C1 --&gt; D2
    C2 --&gt; D2
    C3 --&gt; D2
    C4 --&gt; D2
    D2 --&gt; D1
</pre><h4 id=필수-구성요소>필수 구성요소<a hidden class=anchor aria-hidden=true href=#필수-구성요소>#</a></h4><p><strong>1. Pool Manager (풀 매니저)</strong></p><ul><li><strong>기능</strong>: 전체 풀의 생명주기 관리</li><li><strong>역할</strong>: 연결 생성, 분배, 회수, 정리</li><li><strong>특징</strong>: 중앙 집중식 제어, 스레드 안전성 보장</li></ul><p><strong>2. Connection Objects (연결 객체)</strong></p><ul><li><strong>기능</strong>: 실제 데이터베이스 연결 캡슐화</li><li><strong>역할</strong>: 쿼리 실행 인터페이스 제공</li><li><strong>특징</strong>: 상태 정보 포함, 재사용 가능</li></ul><p><strong>3. Connection Queue (연결 큐)</strong></p><ul><li><strong>기능</strong>: 사용 가능한 연결들의 저장소</li><li><strong>역할</strong>: FIFO/LIFO 방식으로 연결 관리</li><li><strong>특징</strong>: 동시성 제어, 크기 제한</li></ul><p><strong>4. Configuration Manager (설정 매니저)</strong></p><ul><li><strong>기능</strong>: 풀 동작 파라미터 관리</li><li><strong>역할</strong>: 런타임 설정 변경 지원</li><li><strong>특징</strong>: 동적 재설정, 검증 기능</li></ul><h4 id=선택-구성요소-1>선택 구성요소<a hidden class=anchor aria-hidden=true href=#선택-구성요소-1>#</a></h4><p><strong>1. Connection Validator (연결 검증기)</strong></p><ul><li><strong>기능</strong>: 연결 상태 검증</li><li><strong>역할</strong>: 장애 연결 감지 및 복구</li><li><strong>특징</strong>: 주기적 검사, 자동 복구</li></ul><p><strong>2. Monitoring Service (모니터링 서비스)</strong></p><ul><li><strong>기능</strong>: 풀 상태 모니터링</li><li><strong>역할</strong>: 성능 메트릭 수집, 알람 발생</li><li><strong>특징</strong>: 실시간 모니터링, 통계 제공</li></ul><p><strong>3. Load Balancer (로드 밸런서)</strong></p><ul><li><strong>기능</strong>: 여러 데이터베이스 간 부하 분산</li><li><strong>역할</strong>: 연결 분배, 장애 조치</li><li><strong>특징</strong>: 다중 데이터베이스 지원</li></ul><p><strong>4. Metrics Collector (메트릭 수집기)</strong></p><ul><li><strong>기능</strong>: 성능 데이터 수집</li><li><strong>역할</strong>: 분석 데이터 제공</li><li><strong>특징</strong>: 실시간 통계, 히스토리 관리</li></ul><h3 id=구현-기법>구현 기법<a hidden class=anchor aria-hidden=true href=#구현-기법>#</a></h3><h4 id=주요-구현-기법들>주요 구현 기법들<a hidden class=anchor aria-hidden=true href=#주요-구현-기법들>#</a></h4><p><strong>1. Lazy Initialization (지연 초기화)</strong></p><ul><li><strong>정의</strong>: 첫 요청 시점에 연결 생성</li><li><strong>구성</strong>: 요청 감지 → 연결 생성 → 풀 등록</li><li><strong>목적</strong>: 초기 메모리 사용량 최소화</li><li><strong>실제 예시</strong>:<ul><li><strong>시스템 구성</strong>: 마이크로서비스 환경에서 서비스별 독립적 풀 관리</li><li><strong>시나리오</strong>: 트래픽이 적은 서비스는 필요시에만 연결 생성</li></ul></li></ul><p><strong>2. Eager Initialization (즉시 초기화)</strong></p><ul><li><strong>정의</strong>: 애플리케이션 시작 시 모든 연결 생성</li><li><strong>구성</strong>: 시작 → 설정 로드 → 연결 생성 → 풀 준비</li><li><strong>목적</strong>: 첫 요청의 응답 시간 최적화</li><li><strong>실제 예시</strong>:<ul><li><strong>시스템 구성</strong>: 대용량 트래픽 처리 웹 서버</li><li><strong>시나리오</strong>: 온라인 쇼핑몰의 상품 조회 시스템</li></ul></li></ul><p><strong>3. Dynamic Sizing (동적 크기 조정)</strong></p><ul><li><strong>정의</strong>: 부하에 따른 풀 크기 자동 조정</li><li><strong>구성</strong>: 모니터링 → 부하 측정 → 크기 조정 → 성능 확인</li><li><strong>목적</strong>: 리소스 효율성과 성능의 균형</li><li><strong>실제 예시</strong>:<ul><li><strong>시스템 구성</strong>: 클라우드 기반 오토스케일링 환경</li><li><strong>시나리오</strong>: 시간대별 트래픽 변동이 큰 뉴스 사이트</li></ul></li></ul><p><strong>4. Connection Validation (연결 검증)</strong></p><ul><li><strong>정의</strong>: 연결 사용 전후 상태 확인</li><li><strong>구성</strong>: 검증 쿼리 → 응답 확인 → 상태 판단 → 조치</li><li><strong>목적</strong>: 장애 연결 사용 방지</li><li><strong>실제 예시</strong>:<ul><li><strong>시스템 구성</strong>: 고가용성이 요구되는 금융 시스템</li><li><strong>시나리오</strong>: 데이터베이스 장애 발생 시 자동 복구</li></ul></li></ul><p><strong>5. Connection Pooling with Failover (장애 조치가 포함된 풀링)</strong></p><ul><li><strong>정의</strong>: 주 데이터베이스 장애 시 보조 데이터베이스로 전환</li><li><strong>구성</strong>: 주 DB 연결 → 장애 감지 → 보조 DB 연결 → 서비스 계속</li><li><strong>목적</strong>: 서비스 가용성 보장</li><li><strong>실제 예시</strong>:<ul><li><strong>시스템 구성</strong>: Master-Slave 구조의 데이터베이스 클러스터</li><li><strong>시나리오</strong>: 주 데이터베이스 서버 다운 시 무중단 서비스 제공</li></ul></li></ul><h3 id=장점>장점<a hidden class=anchor aria-hidden=true href=#장점>#</a></h3><table><thead><tr><th>구분</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>장점</td><td>성능 향상</td><td>연결 생성/해제 오버헤드 제거로 응답 시간 단축 및 처리량 증가</td></tr><tr><td>장점</td><td>리소스 효율성</td><td>미리 생성된 연결 재사용으로 메모리 및 CPU 사용량 최적화</td></tr><tr><td>장점</td><td>확장성 개선</td><td>동시 연결 수 제어를 통한 대량 트래픽 처리 능력 향상</td></tr><tr><td>장점</td><td>시스템 안정성</td><td>연결 수 제한으로 데이터베이스 과부하 방지 및 장애 격리</td></tr><tr><td>장점</td><td>개발 편의성</td><td>연결 관리 자동화로 개발자의 복잡성 감소</td></tr><tr><td>장점</td><td>비용 절감</td><td>서버 리소스 효율적 사용으로 인프라 비용 절약</td></tr></tbody></table><h3 id=단점과-문제점-그리고-해결방안>단점과 문제점 그리고 해결방안<a hidden class=anchor aria-hidden=true href=#단점과-문제점-그리고-해결방안>#</a></h3><h4 id=단점-1>단점<a hidden class=anchor aria-hidden=true href=#단점-1>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>설명</th><th>해결책</th></tr></thead><tbody><tr><td>단점</td><td>메모리 사용량 증가</td><td>미리 생성된 연결들이 지속적으로 메모리 점유</td><td>동적 크기 조정 및 유휴 연결 정리 정책 적용</td></tr><tr><td>단점</td><td>초기 지연 시간</td><td>애플리케이션 시작 시 연결 생성으로 인한 지연</td><td>백그라운드 초기화 및 지연 로딩 조합 사용</td></tr><tr><td>단점</td><td>설정 복잡성</td><td>최적 풀 크기 결정의 어려움</td><td>모니터링 기반 자동 튜닝 도구 활용</td></tr><tr><td>단점</td><td>연결 누수 위험</td><td>반환되지 않은 연결로 인한 풀 고갈</td><td>타임아웃 설정 및 연결 추적 메커니즘 구현</td></tr></tbody></table><h4 id=문제점-1>문제점<a hidden class=anchor aria-hidden=true href=#문제점-1>#</a></h4><table><thead><tr><th>구분</th><th>항목</th><th>원인</th><th>영향</th><th>탐지 및 진단</th><th>예방 방법</th><th>해결 방법 및 기법</th></tr></thead><tbody><tr><td>문제점</td><td>연결 고갈</td><td>높은 부하 또는 연결 누수</td><td>새로운 요청 처리 불가</td><td>풀 사용률 모니터링</td><td>적절한 최대 크기 설정</td><td>연결 타임아웃 및 강제 회수</td></tr><tr><td>문제점</td><td>데드 커넥션</td><td>네트워크 장애 또는 DB 재시작</td><td>쿼리 실행 실패</td><td>연결 검증 쿼리 실행</td><td>주기적 연결 검증</td><td>장애 연결 제거 및 재생성</td></tr><tr><td>문제점</td><td>성능 저하</td><td>부적절한 풀 크기 설정</td><td>응답 시간 증가</td><td>응답 시간 및 대기 시간 측정</td><td>부하 테스트 기반 튜닝</td><td>동적 크기 조정 알고리즘</td></tr><tr><td>문제점</td><td>메모리 누수</td><td>연결 객체의 부적절한 정리</td><td>시스템 메모리 부족</td><td>메모리 사용량 모니터링</td><td>적절한 가비지 컬렉션 설정</td><td>연결 객체 명시적 해제</td></tr></tbody></table><h3 id=도전-과제>도전 과제<a hidden class=anchor aria-hidden=true href=#도전-과제>#</a></h3><h4 id=현재-해결해야-하는-과제들>현재 해결해야 하는 과제들<a hidden class=anchor aria-hidden=true href=#현재-해결해야-하는-과제들>#</a></h4><p><strong>1. 클라우드 네이티브 환경 적응</strong></p><ul><li><strong>원인</strong>: 컨테이너화 및 서버리스 환경의 특성</li><li><strong>영향</strong>: 기존 풀링 전략의 효율성 저하</li><li><strong>탐지 및 진단</strong>: 컨테이너 생명주기 추적, 콜드 스타트 측정</li><li><strong>예방 방법</strong>: 컨테이너별 최적화된 풀 설정</li><li><strong>해결 방법</strong>: 컨테이너 인식 풀링, 서버리스 친화적 설계</li></ul><p><strong>2. 다중 데이터베이스 환경 관리</strong></p><ul><li><strong>원인</strong>: 마이크로서비스 아키텍처에서 다양한 데이터 저장소 사용</li><li><strong>영향</strong>: 복잡한 연결 관리 및 일관성 문제</li><li><strong>탐지 및 진단</strong>: 분산 트레이싱, 데이터베이스별 성능 모니터링</li><li><strong>예방 방법</strong>: 통합 풀 관리 솔루션 도입</li><li><strong>해결 방법</strong>: 데이터베이스 추상화 계층, 연합된 풀 관리</li></ul><p><strong>3. 실시간 성능 최적화</strong></p><ul><li><strong>원인</strong>: 동적 트래픽 패턴과 실시간 성능 요구사항</li><li><strong>영향</strong>: 고정된 풀 설정의 한계</li><li><strong>탐지 및 진단</strong>: AI 기반 패턴 분석, 실시간 메트릭 수집</li><li><strong>예방 방법</strong>: 머신러닝 기반 예측 모델 활용</li><li><strong>해결 방법</strong>: 적응형 풀 크기 조정, 자동화된 튜닝</li></ul><p><strong>4. 보안 강화</strong></p><ul><li><strong>원인</strong>: 증가하는 사이버 보안 위협</li><li><strong>영향</strong>: 연결 정보 노출 위험</li><li><strong>탐지 및 진단</strong>: 보안 스캔, 연결 암호화 상태 확인</li><li><strong>예방 방법</strong>: 암호화된 연결, 인증서 관리</li><li><strong>해결 방법</strong>: 제로 트러스트 아키텍처, 동적 인증</li></ul><h3 id=분류-기준에-따른-종류-및-유형>분류 기준에 따른 종류 및 유형<a hidden class=anchor aria-hidden=true href=#분류-기준에-따른-종류-및-유형>#</a></h3><table><thead><tr><th>분류 기준</th><th>유형</th><th>특징</th><th>적용 사례</th></tr></thead><tbody><tr><td>크기 관리 방식</td><td>고정 크기 풀</td><td>일정한 연결 수 유지</td><td>안정적 부하 환경</td></tr><tr><td></td><td>동적 크기 풀</td><td>부하에 따른 크기 조정</td><td>가변적 트래픽 환경</td></tr><tr><td></td><td>하이브리드 풀</td><td>최소/최대 범위 내 조정</td><td>대부분의 실무 환경</td></tr><tr><td>연결 생성 시점</td><td>즉시 초기화</td><td>시작 시 모든 연결 생성</td><td>고성능 요구 시스템</td></tr><tr><td></td><td>지연 초기화</td><td>필요 시점에 연결 생성</td><td>리소스 효율성 우선 시스템</td></tr><tr><td>검증 방식</td><td>사용 시 검증</td><td>연결 사용 직전 검증</td><td>안정성 우선 환경</td></tr><tr><td></td><td>주기적 검증</td><td>정해진 간격으로 검증</td><td>성능과 안정성 균형</td></tr><tr><td></td><td>검증 없음</td><td>검증 과정 생략</td><td>초고성능 요구 환경</td></tr><tr><td>분산 방식</td><td>단일 풀</td><td>하나의 데이터베이스 전용</td><td>단순한 아키텍처</td></tr><tr><td></td><td>다중 풀</td><td>여러 데이터베이스별 풀</td><td>마이크로서비스 환경</td></tr><tr><td></td><td>연합 풀</td><td>통합 관리되는 다중 풀</td><td>복잡한 분산 시스템</td></tr></tbody></table><h3 id=실무-사용-예시>실무 사용 예시<a hidden class=anchor aria-hidden=true href=#실무-사용-예시>#</a></h3><table><thead><tr><th>사용 맥락</th><th>함께 사용되는 기술</th><th>목적</th><th>효과</th></tr></thead><tbody><tr><td>웹 애플리케이션</td><td>Spring Boot, Hibernate</td><td>트랜잭션 처리 최적화</td><td>응답 시간 50% 단축</td></tr><tr><td>마이크로서비스</td><td>Docker, Kubernetes</td><td>컨테이너별 리소스 관리</td><td>메모리 사용량 30% 절약</td></tr><tr><td>배치 처리 시스템</td><td>Apache Spark, ETL 도구</td><td>대량 데이터 처리</td><td>처리 속도 200% 향상</td></tr><tr><td>API 게이트웨이</td><td>Kong, Spring Cloud Gateway</td><td>API 요청 처리</td><td>동시 처리량 300% 증가</td></tr><tr><td>메시징 시스템</td><td>RabbitMQ, Apache Kafka</td><td>메시지 영속성 관리</td><td>메시지 처리 지연 감소</td></tr><tr><td>실시간 분석</td><td>Apache Flink, Redis</td><td>스트림 데이터 저장</td><td>실시간 처리 성능 향상</td></tr></tbody></table><h3 id=활용-사례>활용 사례<a hidden class=anchor aria-hidden=true href=#활용-사례>#</a></h3><h4 id=대규모-전자상거래-플랫폼의-주문-처리-시스템>대규모 전자상거래 플랫폼의 주문 처리 시스템<a hidden class=anchor aria-hidden=true href=#대규모-전자상거래-플랫폼의-주문-처리-시스템>#</a></h4><p><strong>시스템 구성:</strong></p><ul><li>프론트엔드: React SPA</li><li>API 게이트웨이: Spring Cloud Gateway</li><li>마이크로서비스: Spring Boot 기반 주문/결제/재고 서비스</li><li>데이터베이스: PostgreSQL 클러스터 (Master-Slave)</li><li>캐시: Redis Cluster</li><li>메시지 큐: Apache Kafka</li></ul><p><strong>시스템 구성 다이어그램:</strong></p><pre class=mermaid>graph TB
    subgraph &#34;Client Layer&#34;
        C1[Web Browser]
        C2[Mobile App]
    end
    
    subgraph &#34;API Gateway&#34;
        G1[Spring Cloud Gateway]
        G2[Connection Pool]
    end
    
    subgraph &#34;Microservices&#34;
        S1[Order Service]
        S2[Payment Service]
        S3[Inventory Service]
        
        P1[Order DB Pool]
        P2[Payment DB Pool]
        P3[Inventory DB Pool]
    end
    
    subgraph &#34;Database Layer&#34;
        D1[PostgreSQL Master]
        D2[PostgreSQL Slave]
    end
    
    C1 --&gt; G1
    C2 --&gt; G1
    G1 --&gt; G2
    G2 --&gt; S1
    G2 --&gt; S2
    G2 --&gt; S3
    
    S1 --&gt; P1
    S2 --&gt; P2
    S3 --&gt; P3
    
    P1 --&gt; D1
    P2 --&gt; D1
    P3 --&gt; D1
    D1 --&gt; D2
</pre><p><strong>Workflow:</strong></p><pre class=mermaid>sequenceDiagram
    participant User as 사용자
    participant Gateway as API Gateway
    participant Order as Order Service
    participant Pool as Connection Pool
    participant DB as Database
    
    User-&gt;&gt;Gateway: 주문 요청
    Gateway-&gt;&gt;Order: 주문 처리 요청
    Order-&gt;&gt;Pool: 데이터베이스 연결 요청
    Pool-&gt;&gt;Pool: 사용 가능한 연결 확인
    Pool--&gt;&gt;Order: 연결 반환
    Order-&gt;&gt;DB: 주문 데이터 저장
    DB--&gt;&gt;Order: 저장 완료
    Order-&gt;&gt;Pool: 연결 반환
    Pool-&gt;&gt;Pool: 연결 상태 검증 후 풀에 반환
    Order--&gt;&gt;Gateway: 주문 완료 응답
    Gateway--&gt;&gt;User: 주문 확인
</pre><p><strong>Connection Pool 의 역할:</strong></p><ol><li><strong>성능 최적화</strong>: 초당 10,000 건의 주문 요청을 평균 50ms 내 처리</li><li><strong>리소스 관리</strong>: 서비스별 독립적인 풀로 장애 격리</li><li><strong>부하 분산</strong>: Master-Slave 구조에서 읽기/쓰기 연결 분리</li><li><strong>모니터링</strong>: 실시간 풀 상태 추적 및 알람</li></ol><p><strong>Connection Pool 유무에 따른 차이점:</strong></p><p><strong>Connection Pool 적용 전:</strong></p><ul><li>주문 처리 시간: 평균 200ms</li><li>최대 동시 처리: 2,000 건/초</li><li>데이터베이스 연결 수: 불규칙적으로 급증</li><li>메모리 사용량: 연결 생성/해제로 인한 가비지 컬렉션 빈발</li></ul><p><strong>Connection Pool 적용 후:</strong></p><ul><li>주문 처리 시간: 평균 50ms (75% 개선)</li><li>최대 동시 처리: 10,000 건/초 (400% 개선)</li><li>데이터베이스 연결 수: 안정적으로 제어</li><li>메모리 사용량: 30% 절약 및 가비지 컬렉션 부하 감소</li></ul><h3 id=구현-예시>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시>#</a></h3><p><strong>Python 을 사용한 Connection Pool 구현:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>  1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>  2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>  3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>  4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>  5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6>  6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7>  7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8>  8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9>  9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10> 10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11> 11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12> 12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13> 13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14> 14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15> 15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16> 16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17> 17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18> 18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19> 19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20> 20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21> 21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22> 22</a>
</span><span class=lnt id=hl-18-23><a class=lnlinks href=#hl-18-23> 23</a>
</span><span class=lnt id=hl-18-24><a class=lnlinks href=#hl-18-24> 24</a>
</span><span class=lnt id=hl-18-25><a class=lnlinks href=#hl-18-25> 25</a>
</span><span class=lnt id=hl-18-26><a class=lnlinks href=#hl-18-26> 26</a>
</span><span class=lnt id=hl-18-27><a class=lnlinks href=#hl-18-27> 27</a>
</span><span class=lnt id=hl-18-28><a class=lnlinks href=#hl-18-28> 28</a>
</span><span class=lnt id=hl-18-29><a class=lnlinks href=#hl-18-29> 29</a>
</span><span class=lnt id=hl-18-30><a class=lnlinks href=#hl-18-30> 30</a>
</span><span class=lnt id=hl-18-31><a class=lnlinks href=#hl-18-31> 31</a>
</span><span class=lnt id=hl-18-32><a class=lnlinks href=#hl-18-32> 32</a>
</span><span class=lnt id=hl-18-33><a class=lnlinks href=#hl-18-33> 33</a>
</span><span class=lnt id=hl-18-34><a class=lnlinks href=#hl-18-34> 34</a>
</span><span class=lnt id=hl-18-35><a class=lnlinks href=#hl-18-35> 35</a>
</span><span class=lnt id=hl-18-36><a class=lnlinks href=#hl-18-36> 36</a>
</span><span class=lnt id=hl-18-37><a class=lnlinks href=#hl-18-37> 37</a>
</span><span class=lnt id=hl-18-38><a class=lnlinks href=#hl-18-38> 38</a>
</span><span class=lnt id=hl-18-39><a class=lnlinks href=#hl-18-39> 39</a>
</span><span class=lnt id=hl-18-40><a class=lnlinks href=#hl-18-40> 40</a>
</span><span class=lnt id=hl-18-41><a class=lnlinks href=#hl-18-41> 41</a>
</span><span class=lnt id=hl-18-42><a class=lnlinks href=#hl-18-42> 42</a>
</span><span class=lnt id=hl-18-43><a class=lnlinks href=#hl-18-43> 43</a>
</span><span class=lnt id=hl-18-44><a class=lnlinks href=#hl-18-44> 44</a>
</span><span class=lnt id=hl-18-45><a class=lnlinks href=#hl-18-45> 45</a>
</span><span class=lnt id=hl-18-46><a class=lnlinks href=#hl-18-46> 46</a>
</span><span class=lnt id=hl-18-47><a class=lnlinks href=#hl-18-47> 47</a>
</span><span class=lnt id=hl-18-48><a class=lnlinks href=#hl-18-48> 48</a>
</span><span class=lnt id=hl-18-49><a class=lnlinks href=#hl-18-49> 49</a>
</span><span class=lnt id=hl-18-50><a class=lnlinks href=#hl-18-50> 50</a>
</span><span class=lnt id=hl-18-51><a class=lnlinks href=#hl-18-51> 51</a>
</span><span class=lnt id=hl-18-52><a class=lnlinks href=#hl-18-52> 52</a>
</span><span class=lnt id=hl-18-53><a class=lnlinks href=#hl-18-53> 53</a>
</span><span class=lnt id=hl-18-54><a class=lnlinks href=#hl-18-54> 54</a>
</span><span class=lnt id=hl-18-55><a class=lnlinks href=#hl-18-55> 55</a>
</span><span class=lnt id=hl-18-56><a class=lnlinks href=#hl-18-56> 56</a>
</span><span class=lnt id=hl-18-57><a class=lnlinks href=#hl-18-57> 57</a>
</span><span class=lnt id=hl-18-58><a class=lnlinks href=#hl-18-58> 58</a>
</span><span class=lnt id=hl-18-59><a class=lnlinks href=#hl-18-59> 59</a>
</span><span class=lnt id=hl-18-60><a class=lnlinks href=#hl-18-60> 60</a>
</span><span class=lnt id=hl-18-61><a class=lnlinks href=#hl-18-61> 61</a>
</span><span class=lnt id=hl-18-62><a class=lnlinks href=#hl-18-62> 62</a>
</span><span class=lnt id=hl-18-63><a class=lnlinks href=#hl-18-63> 63</a>
</span><span class=lnt id=hl-18-64><a class=lnlinks href=#hl-18-64> 64</a>
</span><span class=lnt id=hl-18-65><a class=lnlinks href=#hl-18-65> 65</a>
</span><span class=lnt id=hl-18-66><a class=lnlinks href=#hl-18-66> 66</a>
</span><span class=lnt id=hl-18-67><a class=lnlinks href=#hl-18-67> 67</a>
</span><span class=lnt id=hl-18-68><a class=lnlinks href=#hl-18-68> 68</a>
</span><span class=lnt id=hl-18-69><a class=lnlinks href=#hl-18-69> 69</a>
</span><span class=lnt id=hl-18-70><a class=lnlinks href=#hl-18-70> 70</a>
</span><span class=lnt id=hl-18-71><a class=lnlinks href=#hl-18-71> 71</a>
</span><span class=lnt id=hl-18-72><a class=lnlinks href=#hl-18-72> 72</a>
</span><span class=lnt id=hl-18-73><a class=lnlinks href=#hl-18-73> 73</a>
</span><span class=lnt id=hl-18-74><a class=lnlinks href=#hl-18-74> 74</a>
</span><span class=lnt id=hl-18-75><a class=lnlinks href=#hl-18-75> 75</a>
</span><span class=lnt id=hl-18-76><a class=lnlinks href=#hl-18-76> 76</a>
</span><span class=lnt id=hl-18-77><a class=lnlinks href=#hl-18-77> 77</a>
</span><span class=lnt id=hl-18-78><a class=lnlinks href=#hl-18-78> 78</a>
</span><span class=lnt id=hl-18-79><a class=lnlinks href=#hl-18-79> 79</a>
</span><span class=lnt id=hl-18-80><a class=lnlinks href=#hl-18-80> 80</a>
</span><span class=lnt id=hl-18-81><a class=lnlinks href=#hl-18-81> 81</a>
</span><span class=lnt id=hl-18-82><a class=lnlinks href=#hl-18-82> 82</a>
</span><span class=lnt id=hl-18-83><a class=lnlinks href=#hl-18-83> 83</a>
</span><span class=lnt id=hl-18-84><a class=lnlinks href=#hl-18-84> 84</a>
</span><span class=lnt id=hl-18-85><a class=lnlinks href=#hl-18-85> 85</a>
</span><span class=lnt id=hl-18-86><a class=lnlinks href=#hl-18-86> 86</a>
</span><span class=lnt id=hl-18-87><a class=lnlinks href=#hl-18-87> 87</a>
</span><span class=lnt id=hl-18-88><a class=lnlinks href=#hl-18-88> 88</a>
</span><span class=lnt id=hl-18-89><a class=lnlinks href=#hl-18-89> 89</a>
</span><span class=lnt id=hl-18-90><a class=lnlinks href=#hl-18-90> 90</a>
</span><span class=lnt id=hl-18-91><a class=lnlinks href=#hl-18-91> 91</a>
</span><span class=lnt id=hl-18-92><a class=lnlinks href=#hl-18-92> 92</a>
</span><span class=lnt id=hl-18-93><a class=lnlinks href=#hl-18-93> 93</a>
</span><span class=lnt id=hl-18-94><a class=lnlinks href=#hl-18-94> 94</a>
</span><span class=lnt id=hl-18-95><a class=lnlinks href=#hl-18-95> 95</a>
</span><span class=lnt id=hl-18-96><a class=lnlinks href=#hl-18-96> 96</a>
</span><span class=lnt id=hl-18-97><a class=lnlinks href=#hl-18-97> 97</a>
</span><span class=lnt id=hl-18-98><a class=lnlinks href=#hl-18-98> 98</a>
</span><span class=lnt id=hl-18-99><a class=lnlinks href=#hl-18-99> 99</a>
</span><span class=lnt id=hl-18-100><a class=lnlinks href=#hl-18-100>100</a>
</span><span class=lnt id=hl-18-101><a class=lnlinks href=#hl-18-101>101</a>
</span><span class=lnt id=hl-18-102><a class=lnlinks href=#hl-18-102>102</a>
</span><span class=lnt id=hl-18-103><a class=lnlinks href=#hl-18-103>103</a>
</span><span class=lnt id=hl-18-104><a class=lnlinks href=#hl-18-104>104</a>
</span><span class=lnt id=hl-18-105><a class=lnlinks href=#hl-18-105>105</a>
</span><span class=lnt id=hl-18-106><a class=lnlinks href=#hl-18-106>106</a>
</span><span class=lnt id=hl-18-107><a class=lnlinks href=#hl-18-107>107</a>
</span><span class=lnt id=hl-18-108><a class=lnlinks href=#hl-18-108>108</a>
</span><span class=lnt id=hl-18-109><a class=lnlinks href=#hl-18-109>109</a>
</span><span class=lnt id=hl-18-110><a class=lnlinks href=#hl-18-110>110</a>
</span><span class=lnt id=hl-18-111><a class=lnlinks href=#hl-18-111>111</a>
</span><span class=lnt id=hl-18-112><a class=lnlinks href=#hl-18-112>112</a>
</span><span class=lnt id=hl-18-113><a class=lnlinks href=#hl-18-113>113</a>
</span><span class=lnt id=hl-18-114><a class=lnlinks href=#hl-18-114>114</a>
</span><span class=lnt id=hl-18-115><a class=lnlinks href=#hl-18-115>115</a>
</span><span class=lnt id=hl-18-116><a class=lnlinks href=#hl-18-116>116</a>
</span><span class=lnt id=hl-18-117><a class=lnlinks href=#hl-18-117>117</a>
</span><span class=lnt id=hl-18-118><a class=lnlinks href=#hl-18-118>118</a>
</span><span class=lnt id=hl-18-119><a class=lnlinks href=#hl-18-119>119</a>
</span><span class=lnt id=hl-18-120><a class=lnlinks href=#hl-18-120>120</a>
</span><span class=lnt id=hl-18-121><a class=lnlinks href=#hl-18-121>121</a>
</span><span class=lnt id=hl-18-122><a class=lnlinks href=#hl-18-122>122</a>
</span><span class=lnt id=hl-18-123><a class=lnlinks href=#hl-18-123>123</a>
</span><span class=lnt id=hl-18-124><a class=lnlinks href=#hl-18-124>124</a>
</span><span class=lnt id=hl-18-125><a class=lnlinks href=#hl-18-125>125</a>
</span><span class=lnt id=hl-18-126><a class=lnlinks href=#hl-18-126>126</a>
</span><span class=lnt id=hl-18-127><a class=lnlinks href=#hl-18-127>127</a>
</span><span class=lnt id=hl-18-128><a class=lnlinks href=#hl-18-128>128</a>
</span><span class=lnt id=hl-18-129><a class=lnlinks href=#hl-18-129>129</a>
</span><span class=lnt id=hl-18-130><a class=lnlinks href=#hl-18-130>130</a>
</span><span class=lnt id=hl-18-131><a class=lnlinks href=#hl-18-131>131</a>
</span><span class=lnt id=hl-18-132><a class=lnlinks href=#hl-18-132>132</a>
</span><span class=lnt id=hl-18-133><a class=lnlinks href=#hl-18-133>133</a>
</span><span class=lnt id=hl-18-134><a class=lnlinks href=#hl-18-134>134</a>
</span><span class=lnt id=hl-18-135><a class=lnlinks href=#hl-18-135>135</a>
</span><span class=lnt id=hl-18-136><a class=lnlinks href=#hl-18-136>136</a>
</span><span class=lnt id=hl-18-137><a class=lnlinks href=#hl-18-137>137</a>
</span><span class=lnt id=hl-18-138><a class=lnlinks href=#hl-18-138>138</a>
</span><span class=lnt id=hl-18-139><a class=lnlinks href=#hl-18-139>139</a>
</span><span class=lnt id=hl-18-140><a class=lnlinks href=#hl-18-140>140</a>
</span><span class=lnt id=hl-18-141><a class=lnlinks href=#hl-18-141>141</a>
</span><span class=lnt id=hl-18-142><a class=lnlinks href=#hl-18-142>142</a>
</span><span class=lnt id=hl-18-143><a class=lnlinks href=#hl-18-143>143</a>
</span><span class=lnt id=hl-18-144><a class=lnlinks href=#hl-18-144>144</a>
</span><span class=lnt id=hl-18-145><a class=lnlinks href=#hl-18-145>145</a>
</span><span class=lnt id=hl-18-146><a class=lnlinks href=#hl-18-146>146</a>
</span><span class=lnt id=hl-18-147><a class=lnlinks href=#hl-18-147>147</a>
</span><span class=lnt id=hl-18-148><a class=lnlinks href=#hl-18-148>148</a>
</span><span class=lnt id=hl-18-149><a class=lnlinks href=#hl-18-149>149</a>
</span><span class=lnt id=hl-18-150><a class=lnlinks href=#hl-18-150>150</a>
</span><span class=lnt id=hl-18-151><a class=lnlinks href=#hl-18-151>151</a>
</span><span class=lnt id=hl-18-152><a class=lnlinks href=#hl-18-152>152</a>
</span><span class=lnt id=hl-18-153><a class=lnlinks href=#hl-18-153>153</a>
</span><span class=lnt id=hl-18-154><a class=lnlinks href=#hl-18-154>154</a>
</span><span class=lnt id=hl-18-155><a class=lnlinks href=#hl-18-155>155</a>
</span><span class=lnt id=hl-18-156><a class=lnlinks href=#hl-18-156>156</a>
</span><span class=lnt id=hl-18-157><a class=lnlinks href=#hl-18-157>157</a>
</span><span class=lnt id=hl-18-158><a class=lnlinks href=#hl-18-158>158</a>
</span><span class=lnt id=hl-18-159><a class=lnlinks href=#hl-18-159>159</a>
</span><span class=lnt id=hl-18-160><a class=lnlinks href=#hl-18-160>160</a>
</span><span class=lnt id=hl-18-161><a class=lnlinks href=#hl-18-161>161</a>
</span><span class=lnt id=hl-18-162><a class=lnlinks href=#hl-18-162>162</a>
</span><span class=lnt id=hl-18-163><a class=lnlinks href=#hl-18-163>163</a>
</span><span class=lnt id=hl-18-164><a class=lnlinks href=#hl-18-164>164</a>
</span><span class=lnt id=hl-18-165><a class=lnlinks href=#hl-18-165>165</a>
</span><span class=lnt id=hl-18-166><a class=lnlinks href=#hl-18-166>166</a>
</span><span class=lnt id=hl-18-167><a class=lnlinks href=#hl-18-167>167</a>
</span><span class=lnt id=hl-18-168><a class=lnlinks href=#hl-18-168>168</a>
</span><span class=lnt id=hl-18-169><a class=lnlinks href=#hl-18-169>169</a>
</span><span class=lnt id=hl-18-170><a class=lnlinks href=#hl-18-170>170</a>
</span><span class=lnt id=hl-18-171><a class=lnlinks href=#hl-18-171>171</a>
</span><span class=lnt id=hl-18-172><a class=lnlinks href=#hl-18-172>172</a>
</span><span class=lnt id=hl-18-173><a class=lnlinks href=#hl-18-173>173</a>
</span><span class=lnt id=hl-18-174><a class=lnlinks href=#hl-18-174>174</a>
</span><span class=lnt id=hl-18-175><a class=lnlinks href=#hl-18-175>175</a>
</span><span class=lnt id=hl-18-176><a class=lnlinks href=#hl-18-176>176</a>
</span><span class=lnt id=hl-18-177><a class=lnlinks href=#hl-18-177>177</a>
</span><span class=lnt id=hl-18-178><a class=lnlinks href=#hl-18-178>178</a>
</span><span class=lnt id=hl-18-179><a class=lnlinks href=#hl-18-179>179</a>
</span><span class=lnt id=hl-18-180><a class=lnlinks href=#hl-18-180>180</a>
</span><span class=lnt id=hl-18-181><a class=lnlinks href=#hl-18-181>181</a>
</span><span class=lnt id=hl-18-182><a class=lnlinks href=#hl-18-182>182</a>
</span><span class=lnt id=hl-18-183><a class=lnlinks href=#hl-18-183>183</a>
</span><span class=lnt id=hl-18-184><a class=lnlinks href=#hl-18-184>184</a>
</span><span class=lnt id=hl-18-185><a class=lnlinks href=#hl-18-185>185</a>
</span><span class=lnt id=hl-18-186><a class=lnlinks href=#hl-18-186>186</a>
</span><span class=lnt id=hl-18-187><a class=lnlinks href=#hl-18-187>187</a>
</span><span class=lnt id=hl-18-188><a class=lnlinks href=#hl-18-188>188</a>
</span><span class=lnt id=hl-18-189><a class=lnlinks href=#hl-18-189>189</a>
</span><span class=lnt id=hl-18-190><a class=lnlinks href=#hl-18-190>190</a>
</span><span class=lnt id=hl-18-191><a class=lnlinks href=#hl-18-191>191</a>
</span><span class=lnt id=hl-18-192><a class=lnlinks href=#hl-18-192>192</a>
</span><span class=lnt id=hl-18-193><a class=lnlinks href=#hl-18-193>193</a>
</span><span class=lnt id=hl-18-194><a class=lnlinks href=#hl-18-194>194</a>
</span><span class=lnt id=hl-18-195><a class=lnlinks href=#hl-18-195>195</a>
</span><span class=lnt id=hl-18-196><a class=lnlinks href=#hl-18-196>196</a>
</span><span class=lnt id=hl-18-197><a class=lnlinks href=#hl-18-197>197</a>
</span><span class=lnt id=hl-18-198><a class=lnlinks href=#hl-18-198>198</a>
</span><span class=lnt id=hl-18-199><a class=lnlinks href=#hl-18-199>199</a>
</span><span class=lnt id=hl-18-200><a class=lnlinks href=#hl-18-200>200</a>
</span><span class=lnt id=hl-18-201><a class=lnlinks href=#hl-18-201>201</a>
</span><span class=lnt id=hl-18-202><a class=lnlinks href=#hl-18-202>202</a>
</span><span class=lnt id=hl-18-203><a class=lnlinks href=#hl-18-203>203</a>
</span><span class=lnt id=hl-18-204><a class=lnlinks href=#hl-18-204>204</a>
</span><span class=lnt id=hl-18-205><a class=lnlinks href=#hl-18-205>205</a>
</span><span class=lnt id=hl-18-206><a class=lnlinks href=#hl-18-206>206</a>
</span><span class=lnt id=hl-18-207><a class=lnlinks href=#hl-18-207>207</a>
</span><span class=lnt id=hl-18-208><a class=lnlinks href=#hl-18-208>208</a>
</span><span class=lnt id=hl-18-209><a class=lnlinks href=#hl-18-209>209</a>
</span><span class=lnt id=hl-18-210><a class=lnlinks href=#hl-18-210>210</a>
</span><span class=lnt id=hl-18-211><a class=lnlinks href=#hl-18-211>211</a>
</span><span class=lnt id=hl-18-212><a class=lnlinks href=#hl-18-212>212</a>
</span><span class=lnt id=hl-18-213><a class=lnlinks href=#hl-18-213>213</a>
</span><span class=lnt id=hl-18-214><a class=lnlinks href=#hl-18-214>214</a>
</span><span class=lnt id=hl-18-215><a class=lnlinks href=#hl-18-215>215</a>
</span><span class=lnt id=hl-18-216><a class=lnlinks href=#hl-18-216>216</a>
</span><span class=lnt id=hl-18-217><a class=lnlinks href=#hl-18-217>217</a>
</span><span class=lnt id=hl-18-218><a class=lnlinks href=#hl-18-218>218</a>
</span><span class=lnt id=hl-18-219><a class=lnlinks href=#hl-18-219>219</a>
</span><span class=lnt id=hl-18-220><a class=lnlinks href=#hl-18-220>220</a>
</span><span class=lnt id=hl-18-221><a class=lnlinks href=#hl-18-221>221</a>
</span><span class=lnt id=hl-18-222><a class=lnlinks href=#hl-18-222>222</a>
</span><span class=lnt id=hl-18-223><a class=lnlinks href=#hl-18-223>223</a>
</span><span class=lnt id=hl-18-224><a class=lnlinks href=#hl-18-224>224</a>
</span><span class=lnt id=hl-18-225><a class=lnlinks href=#hl-18-225>225</a>
</span><span class=lnt id=hl-18-226><a class=lnlinks href=#hl-18-226>226</a>
</span><span class=lnt id=hl-18-227><a class=lnlinks href=#hl-18-227>227</a>
</span><span class=lnt id=hl-18-228><a class=lnlinks href=#hl-18-228>228</a>
</span><span class=lnt id=hl-18-229><a class=lnlinks href=#hl-18-229>229</a>
</span><span class=lnt id=hl-18-230><a class=lnlinks href=#hl-18-230>230</a>
</span><span class=lnt id=hl-18-231><a class=lnlinks href=#hl-18-231>231</a>
</span><span class=lnt id=hl-18-232><a class=lnlinks href=#hl-18-232>232</a>
</span><span class=lnt id=hl-18-233><a class=lnlinks href=#hl-18-233>233</a>
</span><span class=lnt id=hl-18-234><a class=lnlinks href=#hl-18-234>234</a>
</span><span class=lnt id=hl-18-235><a class=lnlinks href=#hl-18-235>235</a>
</span><span class=lnt id=hl-18-236><a class=lnlinks href=#hl-18-236>236</a>
</span><span class=lnt id=hl-18-237><a class=lnlinks href=#hl-18-237>237</a>
</span><span class=lnt id=hl-18-238><a class=lnlinks href=#hl-18-238>238</a>
</span><span class=lnt id=hl-18-239><a class=lnlinks href=#hl-18-239>239</a>
</span><span class=lnt id=hl-18-240><a class=lnlinks href=#hl-18-240>240</a>
</span><span class=lnt id=hl-18-241><a class=lnlinks href=#hl-18-241>241</a>
</span><span class=lnt id=hl-18-242><a class=lnlinks href=#hl-18-242>242</a>
</span><span class=lnt id=hl-18-243><a class=lnlinks href=#hl-18-243>243</a>
</span><span class=lnt id=hl-18-244><a class=lnlinks href=#hl-18-244>244</a>
</span><span class=lnt id=hl-18-245><a class=lnlinks href=#hl-18-245>245</a>
</span><span class=lnt id=hl-18-246><a class=lnlinks href=#hl-18-246>246</a>
</span><span class=lnt id=hl-18-247><a class=lnlinks href=#hl-18-247>247</a>
</span><span class=lnt id=hl-18-248><a class=lnlinks href=#hl-18-248>248</a>
</span><span class=lnt id=hl-18-249><a class=lnlinks href=#hl-18-249>249</a>
</span><span class=lnt id=hl-18-250><a class=lnlinks href=#hl-18-250>250</a>
</span><span class=lnt id=hl-18-251><a class=lnlinks href=#hl-18-251>251</a>
</span><span class=lnt id=hl-18-252><a class=lnlinks href=#hl-18-252>252</a>
</span><span class=lnt id=hl-18-253><a class=lnlinks href=#hl-18-253>253</a>
</span><span class=lnt id=hl-18-254><a class=lnlinks href=#hl-18-254>254</a>
</span><span class=lnt id=hl-18-255><a class=lnlinks href=#hl-18-255>255</a>
</span><span class=lnt id=hl-18-256><a class=lnlinks href=#hl-18-256>256</a>
</span><span class=lnt id=hl-18-257><a class=lnlinks href=#hl-18-257>257</a>
</span><span class=lnt id=hl-18-258><a class=lnlinks href=#hl-18-258>258</a>
</span><span class=lnt id=hl-18-259><a class=lnlinks href=#hl-18-259>259</a>
</span><span class=lnt id=hl-18-260><a class=lnlinks href=#hl-18-260>260</a>
</span><span class=lnt id=hl-18-261><a class=lnlinks href=#hl-18-261>261</a>
</span><span class=lnt id=hl-18-262><a class=lnlinks href=#hl-18-262>262</a>
</span><span class=lnt id=hl-18-263><a class=lnlinks href=#hl-18-263>263</a>
</span><span class=lnt id=hl-18-264><a class=lnlinks href=#hl-18-264>264</a>
</span><span class=lnt id=hl-18-265><a class=lnlinks href=#hl-18-265>265</a>
</span><span class=lnt id=hl-18-266><a class=lnlinks href=#hl-18-266>266</a>
</span><span class=lnt id=hl-18-267><a class=lnlinks href=#hl-18-267>267</a>
</span><span class=lnt id=hl-18-268><a class=lnlinks href=#hl-18-268>268</a>
</span><span class=lnt id=hl-18-269><a class=lnlinks href=#hl-18-269>269</a>
</span><span class=lnt id=hl-18-270><a class=lnlinks href=#hl-18-270>270</a>
</span><span class=lnt id=hl-18-271><a class=lnlinks href=#hl-18-271>271</a>
</span><span class=lnt id=hl-18-272><a class=lnlinks href=#hl-18-272>272</a>
</span><span class=lnt id=hl-18-273><a class=lnlinks href=#hl-18-273>273</a>
</span><span class=lnt id=hl-18-274><a class=lnlinks href=#hl-18-274>274</a>
</span><span class=lnt id=hl-18-275><a class=lnlinks href=#hl-18-275>275</a>
</span><span class=lnt id=hl-18-276><a class=lnlinks href=#hl-18-276>276</a>
</span><span class=lnt id=hl-18-277><a class=lnlinks href=#hl-18-277>277</a>
</span><span class=lnt id=hl-18-278><a class=lnlinks href=#hl-18-278>278</a>
</span><span class=lnt id=hl-18-279><a class=lnlinks href=#hl-18-279>279</a>
</span><span class=lnt id=hl-18-280><a class=lnlinks href=#hl-18-280>280</a>
</span><span class=lnt id=hl-18-281><a class=lnlinks href=#hl-18-281>281</a>
</span><span class=lnt id=hl-18-282><a class=lnlinks href=#hl-18-282>282</a>
</span><span class=lnt id=hl-18-283><a class=lnlinks href=#hl-18-283>283</a>
</span><span class=lnt id=hl-18-284><a class=lnlinks href=#hl-18-284>284</a>
</span><span class=lnt id=hl-18-285><a class=lnlinks href=#hl-18-285>285</a>
</span><span class=lnt id=hl-18-286><a class=lnlinks href=#hl-18-286>286</a>
</span><span class=lnt id=hl-18-287><a class=lnlinks href=#hl-18-287>287</a>
</span><span class=lnt id=hl-18-288><a class=lnlinks href=#hl-18-288>288</a>
</span><span class=lnt id=hl-18-289><a class=lnlinks href=#hl-18-289>289</a>
</span><span class=lnt id=hl-18-290><a class=lnlinks href=#hl-18-290>290</a>
</span><span class=lnt id=hl-18-291><a class=lnlinks href=#hl-18-291>291</a>
</span><span class=lnt id=hl-18-292><a class=lnlinks href=#hl-18-292>292</a>
</span><span class=lnt id=hl-18-293><a class=lnlinks href=#hl-18-293>293</a>
</span><span class=lnt id=hl-18-294><a class=lnlinks href=#hl-18-294>294</a>
</span><span class=lnt id=hl-18-295><a class=lnlinks href=#hl-18-295>295</a>
</span><span class=lnt id=hl-18-296><a class=lnlinks href=#hl-18-296>296</a>
</span><span class=lnt id=hl-18-297><a class=lnlinks href=#hl-18-297>297</a>
</span><span class=lnt id=hl-18-298><a class=lnlinks href=#hl-18-298>298</a>
</span><span class=lnt id=hl-18-299><a class=lnlinks href=#hl-18-299>299</a>
</span><span class=lnt id=hl-18-300><a class=lnlinks href=#hl-18-300>300</a>
</span><span class=lnt id=hl-18-301><a class=lnlinks href=#hl-18-301>301</a>
</span><span class=lnt id=hl-18-302><a class=lnlinks href=#hl-18-302>302</a>
</span><span class=lnt id=hl-18-303><a class=lnlinks href=#hl-18-303>303</a>
</span><span class=lnt id=hl-18-304><a class=lnlinks href=#hl-18-304>304</a>
</span><span class=lnt id=hl-18-305><a class=lnlinks href=#hl-18-305>305</a>
</span><span class=lnt id=hl-18-306><a class=lnlinks href=#hl-18-306>306</a>
</span><span class=lnt id=hl-18-307><a class=lnlinks href=#hl-18-307>307</a>
</span><span class=lnt id=hl-18-308><a class=lnlinks href=#hl-18-308>308</a>
</span><span class=lnt id=hl-18-309><a class=lnlinks href=#hl-18-309>309</a>
</span><span class=lnt id=hl-18-310><a class=lnlinks href=#hl-18-310>310</a>
</span><span class=lnt id=hl-18-311><a class=lnlinks href=#hl-18-311>311</a>
</span><span class=lnt id=hl-18-312><a class=lnlinks href=#hl-18-312>312</a>
</span><span class=lnt id=hl-18-313><a class=lnlinks href=#hl-18-313>313</a>
</span><span class=lnt id=hl-18-314><a class=lnlinks href=#hl-18-314>314</a>
</span><span class=lnt id=hl-18-315><a class=lnlinks href=#hl-18-315>315</a>
</span><span class=lnt id=hl-18-316><a class=lnlinks href=#hl-18-316>316</a>
</span><span class=lnt id=hl-18-317><a class=lnlinks href=#hl-18-317>317</a>
</span><span class=lnt id=hl-18-318><a class=lnlinks href=#hl-18-318>318</a>
</span><span class=lnt id=hl-18-319><a class=lnlinks href=#hl-18-319>319</a>
</span><span class=lnt id=hl-18-320><a class=lnlinks href=#hl-18-320>320</a>
</span><span class=lnt id=hl-18-321><a class=lnlinks href=#hl-18-321>321</a>
</span><span class=lnt id=hl-18-322><a class=lnlinks href=#hl-18-322>322</a>
</span><span class=lnt id=hl-18-323><a class=lnlinks href=#hl-18-323>323</a>
</span><span class=lnt id=hl-18-324><a class=lnlinks href=#hl-18-324>324</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>psycopg2</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>queue</span> <span class=kn>import</span> <span class=n>Queue</span><span class=p>,</span> <span class=n>Empty</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DatabaseConnectionPool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    데이터베이스 연결 풀 구현
</span></span></span><span class=line><span class=cl><span class=s2>    - 스레드 안전한 연결 관리
</span></span></span><span class=line><span class=cl><span class=s2>    - 동적 크기 조정 지원
</span></span></span><span class=line><span class=cl><span class=s2>    - 연결 검증 및 자동 복구
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>min_connections</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span><span class=p>,</span> <span class=n>max_connections</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>20</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=n>connection_params</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        연결 풀 초기화
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            min_connections: 최소 연결 수
</span></span></span><span class=line><span class=cl><span class=s2>            max_connections: 최대 연결 수  
</span></span></span><span class=line><span class=cl><span class=s2>            connection_params: 데이터베이스 연결 파라미터
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>min_connections</span> <span class=o>=</span> <span class=n>min_connections</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>max_connections</span> <span class=o>=</span> <span class=n>max_connections</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection_params</span> <span class=o>=</span> <span class=n>connection_params</span> <span class=ow>or</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 스레드 안전한 연결 큐</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span> <span class=o>=</span> <span class=n>Queue</span><span class=p>(</span><span class=n>maxsize</span><span class=o>=</span><span class=n>max_connections</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>RLock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 풀 상태 추적</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_created_connections</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_active_connections</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 초기 연결 생성</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_pool</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 백그라운드 관리 스레드 시작</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_maintenance_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_maintain_pool</span><span class=p>,</span> <span class=n>daemon</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_maintenance_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_create_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        새로운 데이터베이스 연결 생성
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            psycopg2.connection: 데이터베이스 연결 객체
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>connection</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>connection_params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>connection</span><span class=o>.</span><span class=n>autocommit</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>connection</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;연결 생성 실패: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_initialize_pool</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        풀 초기화 - 최소 연결 수만큼 미리 생성
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>min_connections</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_created_connections</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_validate_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        연결 상태 검증
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            connection: 검증할 연결 객체
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            bool: 연결이 유효한지 여부
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>connection</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cursor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT 1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_maintain_pool</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        백그라운드에서 풀 상태 관리
</span></span></span><span class=line><span class=cl><span class=s2>        - 유휴 연결 정리
</span></span></span><span class=line><span class=cl><span class=s2>        - 최소 연결 수 유지
</span></span></span><span class=line><span class=cl><span class=s2>        - 장애 연결 제거
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>  <span class=c1># 30초마다 유지보수 실행</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_cleanup_invalid_connections</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_ensure_minimum_connections</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;풀 유지보수 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_cleanup_invalid_connections</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        유효하지 않은 연결들을 풀에서 제거
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>connections_to_remove</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=n>temp_connections</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 큐에서 모든 연결을 꺼내서 검증</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>empty</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>conn</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>get_nowait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_validate_connection</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=n>temp_connections</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>connections_to_remove</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=n>Empty</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 유효한 연결들을 다시 큐에 넣기</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>conn</span> <span class=ow>in</span> <span class=n>temp_connections</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 유효하지 않은 연결들 정리</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>conn</span> <span class=ow>in</span> <span class=n>connections_to_remove</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span><span class=o>.</span><span class=n>discard</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_created_connections</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_ensure_minimum_connections</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        최소 연결 수 보장
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>current_available</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>qsize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current_available</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>min_connections</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>needed</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>min_connections</span> <span class=o>-</span> <span class=n>current_available</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>needed</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_created_connections</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_connections</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>conn</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=bp>self</span><span class=o>.</span><span class=n>_created_connections</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@contextmanager</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        연결 대여 (컨텍스트 매니저)
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            timeout: 연결 대기 시간 (초)
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Yields:
</span></span></span><span class=line><span class=cl><span class=s2>            psycopg2.connection: 데이터베이스 연결
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>connection</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 연결 획득 시도</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>connection</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=n>timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=n>Empty</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 사용 가능한 연결이 없고 최대 크기에 도달하지 않은 경우 새 연결 생성</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_created_connections</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_connections</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>connection</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=bp>self</span><span class=o>.</span><span class=n>_created_connections</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;연결 풀이 고갈되었습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;연결을 생성할 수 없습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 연결 검증</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_validate_connection</span><span class=p>(</span><span class=n>connection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=c1># 유효하지 않은 연결인 경우 새로 생성</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span>
</span></span><span class=line><span class=cl>                <span class=n>connection</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;유효한 연결을 생성할 수 없습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>_active_connections</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>connection</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 연결 반환</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>connection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_active_connections</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 연결을 다시 검증한 후 풀에 반환</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_validate_connection</span><span class=p>(</span><span class=n>connection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 유효하지 않은 연결은 제거</span>
</span></span><span class=line><span class=cl>                    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>pass</span>
</span></span><span class=line><span class=cl>                    <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span><span class=o>.</span><span class=n>discard</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>_created_connections</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_pool_status</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        현재 풀 상태 정보 반환
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            dict: 풀 상태 정보
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;total_connections&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_created_connections</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;available_connections&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>qsize</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;active_connections&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_active_connections</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;max_connections&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_connections</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;min_connections&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>min_connections</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>close_all</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        모든 연결 종료 및 풀 정리
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 사용 가능한 연결들 종료</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>empty</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>conn</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_available_connections</span><span class=o>.</span><span class=n>get_nowait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 모든 연결 종료</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>conn</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_all_connections</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_created_connections</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_active_connections</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 사용 예시</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 연결 풀 설정</span>
</span></span><span class=line><span class=cl>    <span class=n>connection_params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;host&#39;</span><span class=p>:</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;database&#39;</span><span class=p>:</span> <span class=s1>&#39;mydb&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;user&#39;</span><span class=p>:</span> <span class=s1>&#39;myuser&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;password&#39;</span><span class=p>:</span> <span class=s1>&#39;mypassword&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;port&#39;</span><span class=p>:</span> <span class=mi>5432</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 연결 풀 생성</span>
</span></span><span class=line><span class=cl>    <span class=n>pool</span> <span class=o>=</span> <span class=n>DatabaseConnectionPool</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>min_connections</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>max_connections</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>connection_params</span><span class=o>=</span><span class=n>connection_params</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 연결 사용 예시</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_order</span><span class=p>(</span><span class=n>order_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        주문 처리 함수 - 연결 풀 사용
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=n>pool</span><span class=o>.</span><span class=n>get_connection</span><span class=p>()</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cursor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 주문 정보 조회</span>
</span></span><span class=line><span class=cl>                    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;SELECT * FROM orders WHERE id = </span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=n>order_id</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>order</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>order</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=c1># 주문 상태 업데이트</span>
</span></span><span class=line><span class=cl>                        <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;UPDATE orders SET status = </span><span class=si>%s</span><span class=s2> WHERE id = </span><span class=si>%s</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=p>(</span><span class=s1>&#39;processed&#39;</span><span class=p>,</span> <span class=n>order_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2> 처리 완료&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 </span><span class=si>{</span><span class=n>order_id</span><span class=si>}</span><span class=s2>를 찾을 수 없습니다&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주문 처리 오류: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 동시 요청 시뮬레이션</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>concurrent.futures</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>concurrent</span><span class=o>.</span><span class=n>futures</span><span class=o>.</span><span class=n>ThreadPoolExecutor</span><span class=p>(</span><span class=n>max_workers</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span> <span class=k>as</span> <span class=n>executor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 100개의 주문을 동시에 처리</span>
</span></span><span class=line><span class=cl>        <span class=n>futures</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>executor</span><span class=o>.</span><span class=n>submit</span><span class=p>(</span><span class=n>process_order</span><span class=p>,</span> <span class=n>order_id</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>order_id</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>101</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모든 작업 완료 대기</span>
</span></span><span class=line><span class=cl>        <span class=n>concurrent</span><span class=o>.</span><span class=n>futures</span><span class=o>.</span><span class=n>wait</span><span class=p>(</span><span class=n>futures</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 풀 상태 확인</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;풀 상태:&#34;</span><span class=p>,</span> <span class=n>pool</span><span class=o>.</span><span class=n>get_pool_status</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 풀 정리</span>
</span></span><span class=line><span class=cl>    <span class=n>pool</span><span class=o>.</span><span class=n>close_all</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>이 구현은 Connection Pool 의 핵심 기능들을 모두 포함하고 있습니다:</p><ul><li>스레드 안전한 연결 관리</li><li>동적 크기 조정</li><li>연결 검증 및 자동 복구</li><li>백그라운드 유지보수</li><li>컨텍스트 매니저를 통한 안전한 연결 사용</li></ul><h3 id=실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>실무에서 효과적으로 적용하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#실무에서-효과적으로-적용하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td>크기 설정</td><td>부하 테스트 기반 최적 크기 결정</td><td>과도한 크기 설정으로 인한 리소스 낭비</td><td>최소 5 개, 최대는 동시 사용자 수의 1.5 배</td></tr><tr><td>타임아웃 설정</td><td>적절한 연결 및 쿼리 타임아웃 설정</td><td>너무 긴 타임아웃으로 인한 리소스 점유</td><td>연결: 30 초, 쿼리: 60 초 이내</td></tr><tr><td>검증 전략</td><td>성능과 안정성의 균형점 찾기</td><td>과도한 검증으로 인한 성능 저하</td><td>유휴 시간 기반 검증 (5 분 간격)</td></tr><tr><td>모니터링</td><td>실시간 풀 상태 및 성능 지표 추적</td><td>모니터링 부재로 인한 문제 발견 지연</td><td>Prometheus + Grafana 조합 활용</td></tr><tr><td>장애 처리</td><td>데이터베이스 장애 시 자동 복구 방안</td><td>장애 상황에서 연결 누수 발생</td><td>Circuit Breaker 패턴 적용</td></tr><tr><td>보안 설정</td><td>연결 정보 암호화 및 접근 제어</td><td>평문 연결 정보 노출 위험</td><td>환경 변수 및 시크릿 관리 도구 사용</td></tr></tbody></table><h3 id=최적화하기-위한-고려사항-및-주의할-점>최적화하기 위한 고려사항 및 주의할 점<a hidden class=anchor aria-hidden=true href=#최적화하기-위한-고려사항-및-주의할-점>#</a></h3><table><thead><tr><th>카테고리</th><th>고려사항</th><th>주의할 점</th><th>권장사항</th></tr></thead><tbody><tr><td>성능 튜닝</td><td>JVM 힙 크기 및 GC 설정 최적화</td><td>메모리 부족으로 인한 성능 저하</td><td>힙 크기는 물리 메모리의 50% 이내</td></tr><tr><td>연결 분산</td><td>읽기/쓰기 연결 분리 및 로드 밸런싱</td><td>단일 연결 포인트로 인한 병목</td><td>Master-Slave 구조에서 분리된 풀 운영</td></tr><tr><td>캐싱 전략</td><td>자주 사용되는 연결 정보 캐싱</td><td>캐시 무효화 누락으로 인한 오류</td><td>Redis 기반 분산 캐시 활용</td></tr><tr><td>배치 처리</td><td>대량 작업 시 별도 풀 운영</td><td>배치 작업으로 인한 온라인 서비스 영향</td><td>시간대별 풀 크기 동적 조정</td></tr><tr><td>연결 재사용</td><td>Keep-Alive 설정 및 연결 재활용</td><td>장시간 유지되는 연결의 리소스 점유</td><td>유휴 연결 정리 정책 (30 분 이내)</td></tr><tr><td>네트워크 최적화</td><td>TCP 소켓 옵션 및 버퍼 크기 조정</td><td>네트워크 지연으로 인한 성능 저하</td><td>TCP_NODELAY 및 적절한 버퍼 크기 설정</td></tr></tbody></table><hr><h3 id=주제와-관련하여-주목할-내용>주제와 관련하여 주목할 내용<a hidden class=anchor aria-hidden=true href=#주제와-관련하여-주목할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>성능 최적화</td><td>HikariCP</td><td>고성능 JDBC 연결 풀</td><td>바이트코드 최적화를 통한 초고속 성능 제공</td></tr><tr><td>클라우드 환경</td><td>AWS RDS Proxy</td><td>관리형 연결 풀링</td><td>서버리스 환경에서 자동 연결 관리</td></tr><tr><td>모니터링</td><td>Micrometer</td><td>메트릭 수집 프레임워크</td><td>연결 풀 상태의 표준화된 메트릭 제공</td></tr><tr><td>확장성</td><td>Sharding</td><td>데이터베이스 분할 기법</td><td>다중 데이터베이스 환경에서 풀 관리</td></tr><tr><td>장애 처리</td><td>Circuit Breaker</td><td>장애 격리 패턴</td><td>데이터베이스 장애 시 빠른 실패 처리</td></tr><tr><td>보안</td><td>TLS/SSL</td><td>암호화 연결</td><td>데이터 전송 구간 보안 강화</td></tr><tr><td>컨테이너화</td><td>Kubernetes</td><td>오케스트레이션 플랫폼</td><td>컨테이너 환경에서 동적 풀 관리</td></tr><tr><td>개발 도구</td><td>Spring Boot</td><td>자동 설정 프레임워크</td><td>Connection Pool 자동 구성 및 관리</td></tr></tbody></table><h3 id=반드시-학습해야할-내용>반드시 학습해야할 내용<a hidden class=anchor aria-hidden=true href=#반드시-학습해야할-내용>#</a></h3><table><thead><tr><th>카테고리</th><th>주제</th><th>항목</th><th>설명</th></tr></thead><tbody><tr><td>데이터베이스 기초</td><td>JDBC</td><td>Java Database Connectivity</td><td>Connection Pool 의 기반이 되는 데이터베이스 연결 표준</td></tr><tr><td>동시성 제어</td><td>Thread Pool</td><td>스레드 풀링 패턴</td><td>Connection Pool 과 유사한 리소스 관리 패턴</td></tr><tr><td>네트워크</td><td>TCP/IP</td><td>전송 제어 프로토콜</td><td>데이터베이스 연결의 기반 네트워크 프로토콜</td></tr><tr><td>성능 측정</td><td>APM 도구</td><td>애플리케이션 성능 모니터링</td><td>풀 성능 측정 및 최적화를 위한 도구</td></tr><tr><td>메모리 관리</td><td>GC 튜닝</td><td>가비지 컬렉션 최적화</td><td>메모리 효율적인 풀 운영을 위한 필수 지식</td></tr><tr><td>설계 패턴</td><td>Object Pool Pattern</td><td>객체 풀 패턴</td><td>Connection Pool 의 이론적 기반</td></tr><tr><td>트랜잭션</td><td>ACID 속성</td><td>트랜잭션 특성</td><td>데이터베이스 연결과 밀접한 관련이 있는 개념</td></tr><tr><td>부하 테스트</td><td>JMeter/Artillery</td><td>성능 테스트 도구</td><td>적절한 풀 크기 결정을 위한 테스트 방법</td></tr><tr><td>구성 관리</td><td>Configuration Management</td><td>설정 관리</td><td>환경별 풀 설정 관리 방법</td></tr><tr><td>장애 처리</td><td>Resilience Pattern</td><td>회복력 패턴</td><td>시스템 안정성을 위한 설계 패턴들</td></tr></tbody></table><hr><h3 id=용어-정리-3>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리-3>#</a></h3><table><thead><tr><th>카테고리</th><th>용어</th><th>설명</th></tr></thead><tbody><tr><td>풀 관리</td><td>Pool Size</td><td>연결 풀에서 관리하는 총 연결 수</td></tr><tr><td>풀 관리</td><td>Active Connection</td><td>현재 사용 중인 연결</td></tr><tr><td>풀 관리</td><td>Idle Connection</td><td>사용 가능한 대기 상태의 연결</td></tr><tr><td>풀 관리</td><td>Connection Lease</td><td>연결을 애플리케이션에 대여하는 행위</td></tr><tr><td>풀 관리</td><td>Connection Return</td><td>사용 완료된 연결을 풀에 반환하는 행위</td></tr><tr><td>성능 지표</td><td>Connection Overhead</td><td>연결 생성/해제에 필요한 시간과 리소스 비용</td></tr><tr><td>성능 지표</td><td>Pool Exhaustion</td><td>사용 가능한 연결이 모두 고갈된 상태</td></tr><tr><td>성능 지표</td><td>Connection Timeout</td><td>연결 획득 대기 시간 초과</td></tr><tr><td>검증 메커니즘</td><td>Validation Query</td><td>연결 상태를 확인하기 위한 간단한 SQL 쿼리</td></tr><tr><td>검증 메커니즘</td><td>Connection Validation</td><td>연결이 유효한지 확인하는 과정</td></tr><tr><td>검증 메커니즘</td><td>Stale Connection</td><td>더 이상 유효하지 않은 연결</td></tr><tr><td>라이프사이클</td><td>Connection Lifecycle</td><td>연결의 생성부터 소멸까지의 전체 과정</td></tr><tr><td>라이프사이클</td><td>Pool Initialization</td><td>애플리케이션 시작 시 풀을 초기화하는 과정</td></tr><tr><td>라이프사이클</td><td>Connection Aging</td><td>연결이 생성된 후 경과된 시간</td></tr><tr><td>설정 옵션</td><td>Min Pool Size</td><td>풀에서 유지할 최소 연결 수</td></tr><tr><td>설정 옵션</td><td>Max Pool Size</td><td>풀에서 생성할 수 있는 최대 연결 수</td></tr><tr><td>설정 옵션</td><td>Connection TTL</td><td>연결의 최대 생존 시간</td></tr><tr><td>설정 옵션</td><td>Idle Timeout</td><td>유휴 연결이 제거되기까지의 시간</td></tr></tbody></table><hr><h3 id=참고-및-출처-3>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-3>#</a></h3><ul><li><a href=https://github.com/brettwooldridge/HikariCP>HikariCP 공식 문서</a></li><li><a href=https://commons.apache.org/proper/commons-dbcp/>Apache Commons DBCP 가이드</a></li><li><a href=https://docs.spring.io/spring-boot/docs/current/reference/html/data.html>Spring Boot Database 설정 가이드</a></li><li><a href=https://www.postgresql.org/docs/current/runtime-config-connection.html>PostgreSQL Connection Pooling 가이드</a></li><li><a href=https://docs.oracle.com/en/database/oracle/oracle-database/19/jjucp/>Oracle Universal Connection Pool 문서</a></li><li><a href=https://docs.mongodb.com/manual/administration/connection-pool-overview/>MongoDB Connection Pool 모범 사례</a></li><li><a href=https://redis.io/topics/clients>Redis Connection Pooling 가이드</a></li><li><a href=https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/rds-proxy.html>AWS RDS Proxy 문서</a></li></ul><hr><p>Connection pool(연결 풀) 은 데이터베이스 연결을 효율적으로 관리하기 위한 기술이다.<br>이 기술은 애플리케이션의 성능을 향상시키고 리소스 사용을 최적화하는 데 중요한 역할을 한다.</p><p>Connection pool 은 데이터베이스 연결을 재사용 가능한 형태로 캐시하는 메커니즘이다.<br>이는 애플리케이션이 데이터베이스에 연결할 때마다 새로운 연결을 생성하는 대신, 미리 생성된 연결을 사용할 수 있게 해준다.</p><p>Connection pool 은 현대 데이터베이스 애플리케이션에서 필수적인 기술로, 적절히 구현 및 설정될 경우 애플리케이션의 성능과 안정성을 크게 향상시킬 수 있다.</p><p><figure><img alt="Connection Pool" loading=lazy src=/img/1_nU2n5j4EuBrApI1DWBp1TQ.webp><figcaption>https://medium.com/@sujoy.swe/database-connection-pool-647843dd250b</figcaption></figure></p><h4 id=connection-pool-의-작동-원리>Connection Pool 의 작동 원리<a hidden class=anchor aria-hidden=true href=#connection-pool-의-작동-원리>#</a></h4><ol><li>초기화: 애플리케이션 시작 시 미리 정해진 수의 데이터베이스 연결을 생성하여 풀에 저장한다.</li><li>연결 요청: 클라이언트가 데이터베이스 작업을 요청하면, 풀에서 사용 가능한 연결을 가져온다.</li><li>연결 사용: 클라이언트는 가져온 연결을 사용하여 데이터베이스 작업을 수행한다.</li><li>연결 반환: 작업이 완료되면 연결은 풀로 다시 반환된다.</li><li>연결 관리: 풀은 연결의 수명주기를 관리하며, 필요에 따라 새로운 연결을 생성하거나 오래된 연결을 제거한다.</li></ol><h4 id=connection-pool-의-주요-설정-파라미터>Connection Pool 의 주요 설정 파라미터<a hidden class=anchor aria-hidden=true href=#connection-pool-의-주요-설정-파라미터>#</a></h4><ol><li><p>초기 연결 수 (initialSize):</p><ul><li>pool 생성 시 초기에 만들어두는 연결의 개수</li><li>애플리케이션 시작 시간과 초기 메모리 사용량에 영향</li></ul></li><li><p>최대 연결 수 (maxActive/maxTotal):</p><ul><li>pool 이 관리할 수 있는 최대 연결 개수</li><li>서버의 리소스 상황을 고려하여 설정</li></ul></li><li><p>최소 유휴 연결 수 (minIdle):</p><ul><li>pool 에서 유지할 최소한의 유휴 연결 개수</li><li>갑작스러운 요청 증가에 대비</li></ul></li><li><p>최대 대기 시간 (maxWait):</p><ul><li>사용 가능한 연결이 없을 때 대기할 최대 시간</li><li>타임아웃 설정으로 무한 대기 방지</li></ul></li></ol><h4 id=connection-pool-의-장점>Connection Pool 의 장점<a hidden class=anchor aria-hidden=true href=#connection-pool-의-장점>#</a></h4><ol><li>성능 향상: 연결 생성 및 해제에 따른 오버헤드를 줄여 애플리케이션의 응답 시간을 개선한다.</li><li>리소스 효율성: 제한된 수의 연결을 재사용함으로써 데이터베이스 서버의 리소스 사용을 최적화한다.</li><li>확장성: 동시에 처리할 수 있는 요청의 수를 증가시켜 애플리케이션의 확장성을 향상시킨다.</li><li>연결 관리: 연결의 수명주기를 자동으로 관리하여 개발자의 부담을 줄인다.</li></ol><h4 id=connection-pool-설정-시-고려사항>Connection Pool 설정 시 고려사항<a hidden class=anchor aria-hidden=true href=#connection-pool-설정-시-고려사항>#</a></h4><ol><li>풀 크기: 동시에 유지할 연결의 최소 및 최대 수를 적절히 설정해야 한다.</li><li>연결 수명: 연결의 최대 유지 시간을 설정하여 오래된 연결을 관리한다.</li><li>검증 쿼리: 주기적으로 연결의 유효성을 검사하는 쿼리를 설정한다.</li><li>대기 시간: 모든 연결이 사용 중일 때 새로운 연결 요청의 최대 대기 시간을 설정한다.</li></ol><h4 id=connection-pool-의-구현>Connection Pool 의 구현<a hidden class=anchor aria-hidden=true href=#connection-pool-의-구현>#</a></h4><p>Connection pool 은 다양한 방식으로 구현될 수 있다.<br>주로 사용되는 방식은 내부 풀링, 외부 풀링, 컨테이너 관리 세 가지가 있다.</p><p>각 방식은 고유한 장단점을 가지고 있으며, 애플리케이션의 요구사항과 운영 환경에 따라 적절한 방식을 선택해야 한다.<br>특히 애플리케이션의 규모가 커질수록 더 강력한 관리 기능과 확장성을 제공하는 방식을 고려해야 한다.</p><table><thead><tr><th>비교 기준</th><th>내부 풀링</th><th>외부 풀링</th><th>컨테이너 관리</th></tr></thead><tbody><tr><td>구현 복잡도</td><td>낮음</td><td>중간</td><td>높음</td></tr><tr><td>설정 용이성</td><td>매우 쉬움</td><td>중간</td><td>복잡함</td></tr><tr><td>확장성</td><td>제한적</td><td>높음</td><td>매우 높음</td></tr><tr><td>모니터링 기능</td><td>기본적</td><td>풍부함</td><td>매우 풍부함</td></tr><tr><td>리소스 관리</td><td>개별 관리</td><td>독립적 관리</td><td>중앙 집중식</td></tr><tr><td>유지보수</td><td>쉬움</td><td>중간</td><td>복잡함</td></tr><tr><td>성능 최적화</td><td>중간</td><td>높음</td><td>매우 높음</td></tr><tr><td>장애 복구</td><td>제한적</td><td>우수함</td><td>매우 우수함</td></tr><tr><td>트랜잭션 지원</td><td>기본적</td><td>풍부함</td><td>완벽한 지원</td></tr><tr><td>보안 통합</td><td>제한적</td><td>중간</td><td>강력함</td></tr><tr><td>배포 복잡도</td><td>낮음</td><td>중간</td><td>높음</td></tr><tr><td>리소스 사용량</td><td>낮음</td><td>중간</td><td>높음</td></tr><tr><td>다중 데이터소스 지원</td><td>제한적</td><td>우수함</td><td>매우 우수함</td></tr><tr><td>커스터마이징</td><td>제한적</td><td>높음</td><td>매우 높음</td></tr></tbody></table><p>각 방식의 선택 기준:</p><ol><li><p>내부 풀링 선택 시기:</p><ul><li>작은 규모의 애플리케이션</li><li>단순한 데이터베이스 연결 요구사항</li><li>빠른 개발이 필요한 경우</li></ul></li><li><p>외부 풀링 선택 시기:</p><ul><li>중간 규모의 애플리케이션</li><li>세밀한 풀링 제어가 필요한 경우</li><li>다양한 환경에서의 재사용성이 중요한 경우</li></ul></li><li><p>컨테이너 관리 선택 시기:</p><ul><li>대규모 엔터프라이즈 애플리케이션</li><li>고가용성이 요구되는 환경</li><li>중앙 집중식 관리가 필요한 경우</li></ul></li></ol><h5 id=내부-풀링-internal-pooling>내부 풀링 (Internal Pooling)<a hidden class=anchor aria-hidden=true href=#내부-풀링-internal-pooling>#</a></h5><p>커넥션 풀의 " 내부 풀링 (Internal Pooling)&rdquo; 은 <strong>애플리케이션 내부에서 직접 연결 풀을 관리하는 방식</strong>으로, 주로 데이터베이스 드라이버나 ORM(Object-Relational Mapping) 프레임워크에 내장된 기능을 통해 구현된다.<br>이 방식은 외부 의존성 없이 애플리케이션 자체에서 연결 재사용을 최적화한다.</p><p>내부 풀링은 <strong>간편성과 통합성</strong>을 중시하는 환경에 적합하다.<br>ORM 이나 데이터베이스 드라이버에 내장된 기능을 활용해 빠르게 구현할 수 있으나, 대규모 분산 시스템에서는 연결 관리의 비효율성이 발생할 수 있다.<br>Hibernate 의 C3P0 통합이나 MySQL Connector/J 의 자체 풀링이 대표적 예시이며, <code>minSize</code> 와 <code>maxSize</code> 를 트래픽 패턴에 맞게 조정하는 것이 성능 개선의 핵심이다.</p><h6 id=내부-풀링의-핵심-동작-원리>내부 풀링의 핵심 동작 원리<a hidden class=anchor aria-hidden=true href=#내부-풀링의-핵심-동작-원리>#</a></h6><ol><li><p><strong>풀 초기화</strong></p><ul><li>애플리케이션 시작 시 <code>minSize</code> 설정값에 따라 초기 연결을 생성한다.</li><li>예: Hibernate 는 기본적으로 5 개의 연결을 풀에 미리 생성한다.</li></ul></li><li><p><strong>연결 할당</strong></p><ul><li>애플리케이션 요청 시 풀에서 사용 가능한 연결을 제공한다.</li><li>모든 연결이 사용 중이면 <code>maxWait</code> 시간 동안 대기 후 예외 발생.</li></ul></li><li><p><strong>연결 반환</strong></p><ul><li><code>Connection.close()</code> 호출 시 실제로 연결을 닫지 않고 풀로 반환한다.</li></ul></li><li><p><strong>상태 검증</strong></p><ul><li><code>validationQuery</code>(예: <code>SELECT 1</code>) 로 주기적 연결 검증 수행.</li><li>손상된 연결은 자동 제거 후 새 연결로 교체된다.</li></ul></li></ol><h6 id=주요-특징>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징>#</a></h6><ol><li><p><strong>프레임워크 통합</strong></p><ul><li>ORM(Hibernate, EclipseLink) 이나 데이터베이스 드라이버 (MySQL Connector/J) 에 내장.</li><li>별도 라이브러리 없이 간편하게 설정 가능.</li></ul></li><li><p><strong>설정 간소화</strong></p><ul><li>연결 문자열에 파라미터 추가만으로 활성화.</li><li>예: JDBC URL 에 <code>useUnicode=true&amp;pooling=true</code> 추가.</li></ul></li><li><p><strong>애플리케이션 레벨 관리</strong></p><ul><li>각 애플리케이션 인스턴스가 독립적인 풀을 유지.</li><li>클라우드 환경에서 인스턴스 증가 시 연결 낭비 가능성 있음.</li></ul></li><li><p><strong>트랜잭션 지원</strong></p><ul><li>트랜잭션 컨텍스트에 따라 연결을 분리 관리.</li></ul></li></ol><h6 id=구현-예시-1>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시-1>#</a></h6><p>Hibernate 기준</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Hibernate 설정 파일 (hibernate.cfg.xml)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>property</span><span class=w> </span><span class=n>name</span><span class=o>=</span><span class=s>&#34;hibernate.connection.provider_class&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>org</span><span class=p>.</span><span class=na>hibernate</span><span class=p>.</span><span class=na>connection</span><span class=p>.</span><span class=na>C3P0ConnectionProvider</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;/</span><span class=n>property</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>property</span><span class=w> </span><span class=n>name</span><span class=o>=</span><span class=s>&#34;hibernate.c3p0.min_size&#34;</span><span class=o>&gt;</span><span class=n>5</span><span class=o>&lt;/</span><span class=n>property</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>property</span><span class=w> </span><span class=n>name</span><span class=o>=</span><span class=s>&#34;hibernate.c3p0.max_size&#34;</span><span class=o>&gt;</span><span class=n>50</span><span class=o>&lt;/</span><span class=n>property</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>property</span><span class=w> </span><span class=n>name</span><span class=o>=</span><span class=s>&#34;hibernate.c3p0.timeout&#34;</span><span class=o>&gt;</span><span class=n>300</span><span class=o>&lt;/</span><span class=n>property</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>property</span><span class=w> </span><span class=n>name</span><span class=o>=</span><span class=s>&#34;hibernate.c3p0.idle_test_period&#34;</span><span class=o>&gt;</span><span class=n>150</span><span class=o>&lt;/</span><span class=n>property</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>SQLAlchemy</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># SQLAlchemy 내장 풀 구현 예시</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>sessionmaker</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DatabaseManager</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 엔진 생성 및 풀 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;mysql://user:password@localhost/mydb&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>pool_size</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>               <span class=c1># 초기 풀 크기</span>
</span></span><span class=line><span class=cl>            <span class=n>max_overflow</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>           <span class=c1># 추가 생성 가능한 최대 연결 수</span>
</span></span><span class=line><span class=cl>            <span class=n>pool_timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>           <span class=c1># 연결 대기 시간</span>
</span></span><span class=line><span class=cl>            <span class=n>pool_recycle</span><span class=o>=</span><span class=mi>3600</span><span class=p>,</span>         <span class=c1># 연결 재사용 주기</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span><span class=o>=</span><span class=kc>True</span>                  <span class=c1># SQL 로깅 활성화</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 세션 팩토리 생성</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>Session</span> <span class=o>=</span> <span class=n>sessionmaker</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>engine</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_session</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Sequelize</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span><span class=lnt id=hl-21-17><a class=lnlinks href=#hl-21-17>17</a>
</span><span class=lnt id=hl-21-18><a class=lnlinks href=#hl-21-18>18</a>
</span><span class=lnt id=hl-21-19><a class=lnlinks href=#hl-21-19>19</a>
</span><span class=lnt id=hl-21-20><a class=lnlinks href=#hl-21-20>20</a>
</span><span class=lnt id=hl-21-21><a class=lnlinks href=#hl-21-21>21</a>
</span><span class=lnt id=hl-21-22><a class=lnlinks href=#hl-21-22>22</a>
</span><span class=lnt id=hl-21-23><a class=lnlinks href=#hl-21-23>23</a>
</span><span class=lnt id=hl-21-24><a class=lnlinks href=#hl-21-24>24</a>
</span><span class=lnt id=hl-21-25><a class=lnlinks href=#hl-21-25>25</a>
</span><span class=lnt id=hl-21-26><a class=lnlinks href=#hl-21-26>26</a>
</span><span class=lnt id=hl-21-27><a class=lnlinks href=#hl-21-27>27</a>
</span><span class=lnt id=hl-21-28><a class=lnlinks href=#hl-21-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Sequelize 내장 풀 구현 예시
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>Sequelize</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;sequelize&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>SequelizeManager</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>sequelize</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Sequelize</span><span class=p>(</span><span class=s1>&#39;mydb&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;password&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>dialect</span><span class=o>:</span> <span class=s1>&#39;mysql&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 풀 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>pool</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>max</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span>        <span class=c1>// 최대 연결 수
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nx>min</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>        <span class=c1>// 최소 연결 수
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nx>acquire</span><span class=o>:</span> <span class=mi>30000</span><span class=p>,</span><span class=c1>// 연결 획득 타임아웃
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nx>idle</span><span class=o>:</span> <span class=mi>10000</span>    <span class=c1>// 유휴 시간
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>testConnection</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>sequelize</span><span class=p>.</span><span class=nx>authenticate</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;데이터베이스 연결 성공&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;데이터베이스 연결 실패:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=장점과-단점>장점과 단점<a hidden class=anchor aria-hidden=true href=#장점과-단점>#</a></h6><table><thead><tr><th>구분</th><th>설명</th></tr></thead><tbody><tr><td><strong>장점</strong></td><td>- <strong>설치/설정 간편</strong>: 별도 서비스 구성 불필요<br>- <strong>낮은 지연 시간</strong>: 애플리케이션 내부에서 직접 관리<br>- <strong>ORM 최적화</strong>: 프레임워크 특성에 맞춘 튜닝 가능</td></tr><tr><td><strong>단점</strong></td><td>- <strong>확장성 제한</strong>: 인스턴스 증가 시 연결 중복 생성<br>- <strong>기능 제한</strong>: 외부 풀링 대비 모니터링/튜닝 옵션 적음<br>- <strong>리소스 경합</strong>: 고트래픽 시 단일 애플리케이션 풀 포화 가능성</td></tr></tbody></table><h6 id=주요-사용-사례>주요 사용 사례<a hidden class=anchor aria-hidden=true href=#주요-사용-사례>#</a></h6><ol><li><strong>소규모 애플리케이션</strong><ul><li>빠른 개발 및 간단한 설정이 우선인 경우.</li></ul></li><li><strong>ORM 기반 프로젝트</strong><ul><li>Hibernate, EclipseLink 등 ORM 의 내장 풀 활용 시.</li></ul></li><li><strong>임베디드 데이터베이스</strong><ul><li>H2, SQLite 등 경량 DB 와의 통합 환경.</li></ul></li></ol><h5 id=외부-풀링-external-pooling>외부 풀링 (External Pooling)<a hidden class=anchor aria-hidden=true href=#외부-풀링-external-pooling>#</a></h5><p>외부 풀링 (External Pooling) 은 데이터베이스 연결 관리를 위해 <strong>독립적인 라이브러리나 미들웨어를 활용하는 방식</strong>으로, 애플리케이션 코드나 서버 인프라와 분리되어 유연성과 성능을 균형 있게 제공한다.<br>내부 풀링이나 컨테이너 관리 방식과 달리 특정 환경에 종속되지 않으며, 다양한 애플리케이션 환경에 적용 가능하다.</p><p>외부 풀링은 <strong>복잡한 엔터프라이즈 환경</strong>에서 연결 관리의 효율성을 극대화하는 최적의 선택이다.<br>HikariCP 와 같은 라이브러리는 검증된 성능으로 Spring Boot 2.0+ 에서 기본 채택되었으며, <code>maxPoolSize</code> 와 <code>idleTimeout</code> 을 서버 부하에 맞게 동적으로 조절하는 것이 성능 향상의 핵심이다.<br>다만, 초기 설정과 모니터링을 통해 연결 누수나 과도한 풀 크기로 인한 자원 낭비를 방지해야 한다.</p><h6 id=외부-풀링의-핵심-특징>외부 풀링의 핵심 특징<a hidden class=anchor aria-hidden=true href=#외부-풀링의-핵심-특징>#</a></h6><ol><li><p><strong>독립적 라이브러리 기반</strong></p><ul><li>HikariCP, Apache DBCP, c3p0 등의 오픈소스 라이브러리를 사용한다.</li><li>애플리케이션 코드와 분리되어 별도로 설정 및 관리된다.</li></ul></li><li><p><strong>고성능 최적화</strong></p><ul><li>연결 생성/해제 오버헤드를 최소화하여 초당 수만 건의 쿼리 처리 가능 (예: HikariCP 는 마이크로초 단위의 응답 시간을 지원).</li><li>경량화된 아키텍처로 리소스 사용 효율성이 높다.</li></ul></li><li><p><strong>세밀한 설정 조절</strong></p><ul><li>최대 연결 수 (<code>maxPoolSize</code>), 유휴 연결 유지 시간 (<code>idleTimeout</code>), 연결 검증 쿼리 (<code>validationQuery</code>) 등을 세부적으로 설정 가능하다.</li></ul></li><li><p><strong>다중 환경 지원</strong></p><ul><li>클라우드, 온프레미스, 멀티티어 아키텍처 등 다양한 환경에서 통합적으로 사용 가능하다.</li></ul></li></ol><h6 id=동작-원리>동작 원리<a hidden class=anchor aria-hidden=true href=#동작-원리>#</a></h6><ol><li><p><strong>풀 초기화</strong></p><ul><li>애플리케이션 시작 시 <code>maxPoolSize</code> 에 지정된 수만큼 연결을 미리 생성한다.</li><li>예: HikariCP 는 기본적으로 10 개의 연결을 생성한다.</li></ul></li><li><p><strong>연결 할당</strong></p><ul><li>애플리케이션 요청 시 풀에서 사용 가능한 연결을 제공한다.</li><li>모든 연결이 사용 중일 경우 <code>connectionTimeout</code> 동안 대기한다.</li></ul></li><li><p><strong>연결 반환</strong></p><ul><li>작업 완료 후 <code>connection.close()</code> 호출 시 실제로 연결을 닫지 않고 풀로 반환한다.</li></ul></li><li><p><strong>상태 모니터링</strong></p><ul><li><code>leakDetectionThreshold</code> 를 통해 연결 누수 감지, <code>healthCheck</code> 로 연결 상태 주기적으로 검증한다.</li></ul></li></ol><h6 id=구현-예시-hikaricp-기준>구현 예시 (HikariCP 기준)<a hidden class=anchor aria-hidden=true href=#구현-예시-hikaricp-기준>#</a></h6><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// HikariCP 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>HikariConfig</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HikariConfig</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>config</span><span class=p>.</span><span class=na>setJdbcUrl</span><span class=p>(</span><span class=s>&#34;jdbc:mysql://localhost:3306/mydb&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>config</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>config</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>config</span><span class=p>.</span><span class=na>setMaximumPoolSize</span><span class=p>(</span><span class=n>20</span><span class=p>);</span><span class=w>      </span><span class=c1>// 최대 연결 수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>config</span><span class=p>.</span><span class=na>setMinimumIdle</span><span class=p>(</span><span class=n>5</span><span class=p>);</span><span class=w>           </span><span class=c1>// 최소 유휴 연결 수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>config</span><span class=p>.</span><span class=na>setIdleTimeout</span><span class=p>(</span><span class=n>30000</span><span class=p>);</span><span class=w>      </span><span class=c1>// 유휴 연결 유지 시간(30초)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>config</span><span class=p>.</span><span class=na>setConnectionTestQuery</span><span class=p>(</span><span class=s>&#34;SELECT 1&#34;</span><span class=p>);</span><span class=w> </span><span class=c1>// 검증 쿼리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>HikariDataSource</span><span class=w> </span><span class=n>dataSource</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HikariDataSource</span><span class=p>(</span><span class=n>config</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 연결 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Connection</span><span class=w> </span><span class=n>conn</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dataSource</span><span class=p>.</span><span class=na>getConnection</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 데이터베이스 작업 수행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h6 id=장점과-단점-1>장점과 단점<a hidden class=anchor aria-hidden=true href=#장점과-단점-1>#</a></h6><table><thead><tr><th>구분</th><th>설명</th></tr></thead><tbody><tr><td><strong>장점</strong></td><td>- <strong>높은 성능</strong>: 최적화된 알고리즘으로 초고속 처리<br>- <strong>유연한 설정</strong>: 세부 파라미터 조절 가능<br>- <strong>다중 프레임워크 호환</strong>: Spring, Jakarta EE 등 다양한 환경 지원<br>- <strong>WAS 독립성</strong>: 서버 변경 시 재구성 불필요</td></tr><tr><td><strong>단점</strong></td><td>- <strong>설정 복잡성</strong>: 튜닝을 위한 전문 지식 필요<br>- <strong>추가 의존성</strong>: 라이브러리 업데이트 및 보안 관리 필요<br>- <strong>초기 학습 곡선</strong>: 내부 풀링 대비 구현 난이도 상승</td></tr></tbody></table><h6 id=주요-사용-사례-1>주요 사용 사례<a hidden class=anchor aria-hidden=true href=#주요-사용-사례-1>#</a></h6><ol><li><strong>고트래픽 웹 서비스</strong><ul><li>동시 접속자 수가 많은 환경에서 연결 재사용률을 극대화한다.</li></ul></li><li><strong>마이크로서비스 아키텍처</strong><ul><li>분산된 서비스들이 독립적인 풀을 유지하며 자원 경합을 방지한다.</li></ul></li><li><strong>배치 처리 시스템</strong><ul><li>대량의 데이터 처리 시 연결 생성 비용을 절감한다.</li></ul></li></ol><h5 id=컨테이너-관리-container-managed-pooling>컨테이너 관리 (Container-Managed Pooling)<a hidden class=anchor aria-hidden=true href=#컨테이너-관리-container-managed-pooling>#</a></h5><p>커넥션 풀의 " 컨테이너 관리 (Container-Managed Pooling)" 방식은 웹 애플리케이션 서버 (WAS) 가 직접 연결 풀을 생성하고 관리하는 방식을 의미한다.<br>이 방식은 서버 인프라와 긴밀하게 통합되어 있어 개발자의 관리 부담을 줄여주는 특징을 가진다.</p><h6 id=컨테이너-관리-커넥션-풀의-핵심-개념>컨테이너 관리 커넥션 풀의 핵심 개념<a hidden class=anchor aria-hidden=true href=#컨테이너-관리-커넥션-풀의-핵심-개념>#</a></h6><ol><li><p><strong>WAS 주도 관리</strong></p><ul><li>웹 컨테이너 (WAS: Tomcat, JBoss, WebLogic 등) 가 애플리케이션 구동 시점에 DB 연결을 초기화하고 풀을 생성한다.</li><li>연결의 라이프사이클을 WAS 가 전적으로 관리한다.</li></ul></li><li><p><strong>중앙 집중식 설정</strong></p><ul><li><code>context.xml</code> 또는 서버 전용 설정 파일 (예: JEUSMain.xml) 에서 풀의 속성을 정의한다.</li><li>애플리케이션 코드와 분리되어 인프라 수준에서 관리된다.</li></ul></li><li><p><strong>서버 리소스 통합</strong></p><ul><li>WAS 의 스레드 풀, 메모리 관리 시스템과 통합되어 안정적인 자원 할당이 가능하다.</li></ul></li></ol><h6 id=동작-원리-1>동작 원리<a hidden class=anchor aria-hidden=true href=#동작-원리-1>#</a></h6><ol><li><p><strong>풀 초기화</strong></p><ul><li>WAS 시작 시 <code>maxActive</code>, <code>minIdle</code> 등의 설정값을 기반으로 초기 연결을 생성한다.</li><li>예: Tomcat 은 <code>org.apache.tomcat.jdbc.pool</code> 을 내장 풀로 사용한다.</li></ul></li><li><p><strong>연결 할당</strong></p><ul><li>애플리케이션은 JNDI(Java Naming and Directory Interface) 를 통해 <code>DataSource</code> 객체를 조회한다.</li><li>풀에서 유휴 상태의 연결을 가져와 사용한다.</li></ul></li><li><p><strong>연결 반환</strong></p><ul><li>작업 완료 후 <code>Connection.close()</code> 호출 시 실제로 연결이 종료되지 않고 풀로 반환된다.</li></ul></li><li><p><strong>상태 검증</strong></p><ul><li><code>validationQuery</code>(예: <code>SELECT 1</code>) 를 주기적으로 실행하여 연결의 유효성을 확인한다.</li><li>손상된 연결은 자동으로 제거되고 새 연결로 대체된다.</li></ul></li></ol><h6 id=구체적인-설정-예시>구체적인 설정 예시<a hidden class=anchor aria-hidden=true href=#구체적인-설정-예시>#</a></h6><p>Tomcat 기준</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- context.xml --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;Resource</span> 
</span></span><span class=line><span class=cl>  <span class=na>name=</span><span class=s>&#34;jdbc/myDB&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>auth=</span><span class=s>&#34;Container&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>type=</span><span class=s>&#34;javax.sql.DataSource&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>driverClassName=</span><span class=s>&#34;com.mysql.cj.jdbc.Driver&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>url=</span><span class=s>&#34;jdbc:mysql://localhost:3306/mydb&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>username=</span><span class=s>&#34;user&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>password=</span><span class=s>&#34;password&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>maxTotal=</span><span class=s>&#34;100&#34;</span>          <span class=err>&lt;!--</span> <span class=err>최대</span> <span class=err>연결</span> <span class=err>수</span> <span class=err>--</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  maxIdle=&#34;20&#34;            <span class=c>&lt;!-- 유휴 연결 최대 수 --&gt;</span>
</span></span><span class=line><span class=cl>  minIdle=&#34;5&#34;             <span class=c>&lt;!-- 유휴 연결 최소 수 --&gt;</span>
</span></span><span class=line><span class=cl>  maxWaitMillis=&#34;30000&#34;   <span class=c>&lt;!-- 연결 대기 시간(30초) --&gt;</span>
</span></span><span class=line><span class=cl>  validationQuery=&#34;SELECT 1&#34;
</span></span><span class=line><span class=cl>  testOnBorrow=&#34;true&#34;     <span class=c>&lt;!-- 사용 전 연결 검증 --&gt;</span>
</span></span><span class=line><span class=cl>/&gt;
</span></span></code></pre></td></tr></table></div></div><h6 id=장점과-단점-2><strong>장점과 단점</strong><a hidden class=anchor aria-hidden=true href=#장점과-단점-2>#</a></h6><table><thead><tr><th>구분</th><th>설명</th></tr></thead><tbody><tr><td><strong>장점</strong></td><td>- <strong>서버 통합 관리</strong>: WAS 의 모니터링 도구와 연동해 실시간 상태 추적 가능<br>- <strong>간편한 설정</strong>: XML/관리 콘솔에서 중앙 집중식 설정<br>- <strong>안정성</strong>: WAS 의 안정성 보장 메커니즘 (예: 장애 시 자동 재연결) 적용<br>- <strong>성능 최적화</strong>: 서버 레벨에서 연결 풀을 최적화하여 고성능 유지</td></tr><tr><td><strong>단점</strong></td><td>- <strong>WAS 종속성</strong>: 서버 변경 시 설정 재구성 필요<br>- <strong>유연성 부족</strong>: 외부 라이브러리 (HikariCP 등) 보다 고급 기능 제한적<br>- <strong>확장성 제한</strong>: 클라우드 환경에서의 탄력적 확장에 어려움</td></tr></tbody></table><h6 id=사용-사례>사용 사례<a hidden class=anchor aria-hidden=true href=#사용-사례>#</a></h6><ol><li><strong>전통적인 엔터프라이즈 환경</strong><ul><li>JBoss, WebLogic 등에서 JNDI 기반의 풀 관리가 필수적인 경우.</li></ul></li><li><strong>레거시 시스템 통합</strong><ul><li>기존 인프라와의 호환성을 유지해야 하는 환경.</li></ul></li><li><strong>간편한 설정 우선</strong><ul><li>소규모 애플리케이션에서 별도 라이브러리 도입 없이 빠르게 구성할 때.</li></ul></li></ol><h4 id=구현-예시-2>구현 예시<a hidden class=anchor aria-hidden=true href=#구현-예시-2>#</a></h4><h5 id=python>Python<a hidden class=anchor aria-hidden=true href=#python>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1>  1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2>  2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3>  3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4>  4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5>  5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6>  6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7>  7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8>  8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9>  9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10> 10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11> 11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12> 12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13> 13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14> 14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15> 15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16> 16</a>
</span><span class=lnt id=hl-24-17><a class=lnlinks href=#hl-24-17> 17</a>
</span><span class=lnt id=hl-24-18><a class=lnlinks href=#hl-24-18> 18</a>
</span><span class=lnt id=hl-24-19><a class=lnlinks href=#hl-24-19> 19</a>
</span><span class=lnt id=hl-24-20><a class=lnlinks href=#hl-24-20> 20</a>
</span><span class=lnt id=hl-24-21><a class=lnlinks href=#hl-24-21> 21</a>
</span><span class=lnt id=hl-24-22><a class=lnlinks href=#hl-24-22> 22</a>
</span><span class=lnt id=hl-24-23><a class=lnlinks href=#hl-24-23> 23</a>
</span><span class=lnt id=hl-24-24><a class=lnlinks href=#hl-24-24> 24</a>
</span><span class=lnt id=hl-24-25><a class=lnlinks href=#hl-24-25> 25</a>
</span><span class=lnt id=hl-24-26><a class=lnlinks href=#hl-24-26> 26</a>
</span><span class=lnt id=hl-24-27><a class=lnlinks href=#hl-24-27> 27</a>
</span><span class=lnt id=hl-24-28><a class=lnlinks href=#hl-24-28> 28</a>
</span><span class=lnt id=hl-24-29><a class=lnlinks href=#hl-24-29> 29</a>
</span><span class=lnt id=hl-24-30><a class=lnlinks href=#hl-24-30> 30</a>
</span><span class=lnt id=hl-24-31><a class=lnlinks href=#hl-24-31> 31</a>
</span><span class=lnt id=hl-24-32><a class=lnlinks href=#hl-24-32> 32</a>
</span><span class=lnt id=hl-24-33><a class=lnlinks href=#hl-24-33> 33</a>
</span><span class=lnt id=hl-24-34><a class=lnlinks href=#hl-24-34> 34</a>
</span><span class=lnt id=hl-24-35><a class=lnlinks href=#hl-24-35> 35</a>
</span><span class=lnt id=hl-24-36><a class=lnlinks href=#hl-24-36> 36</a>
</span><span class=lnt id=hl-24-37><a class=lnlinks href=#hl-24-37> 37</a>
</span><span class=lnt id=hl-24-38><a class=lnlinks href=#hl-24-38> 38</a>
</span><span class=lnt id=hl-24-39><a class=lnlinks href=#hl-24-39> 39</a>
</span><span class=lnt id=hl-24-40><a class=lnlinks href=#hl-24-40> 40</a>
</span><span class=lnt id=hl-24-41><a class=lnlinks href=#hl-24-41> 41</a>
</span><span class=lnt id=hl-24-42><a class=lnlinks href=#hl-24-42> 42</a>
</span><span class=lnt id=hl-24-43><a class=lnlinks href=#hl-24-43> 43</a>
</span><span class=lnt id=hl-24-44><a class=lnlinks href=#hl-24-44> 44</a>
</span><span class=lnt id=hl-24-45><a class=lnlinks href=#hl-24-45> 45</a>
</span><span class=lnt id=hl-24-46><a class=lnlinks href=#hl-24-46> 46</a>
</span><span class=lnt id=hl-24-47><a class=lnlinks href=#hl-24-47> 47</a>
</span><span class=lnt id=hl-24-48><a class=lnlinks href=#hl-24-48> 48</a>
</span><span class=lnt id=hl-24-49><a class=lnlinks href=#hl-24-49> 49</a>
</span><span class=lnt id=hl-24-50><a class=lnlinks href=#hl-24-50> 50</a>
</span><span class=lnt id=hl-24-51><a class=lnlinks href=#hl-24-51> 51</a>
</span><span class=lnt id=hl-24-52><a class=lnlinks href=#hl-24-52> 52</a>
</span><span class=lnt id=hl-24-53><a class=lnlinks href=#hl-24-53> 53</a>
</span><span class=lnt id=hl-24-54><a class=lnlinks href=#hl-24-54> 54</a>
</span><span class=lnt id=hl-24-55><a class=lnlinks href=#hl-24-55> 55</a>
</span><span class=lnt id=hl-24-56><a class=lnlinks href=#hl-24-56> 56</a>
</span><span class=lnt id=hl-24-57><a class=lnlinks href=#hl-24-57> 57</a>
</span><span class=lnt id=hl-24-58><a class=lnlinks href=#hl-24-58> 58</a>
</span><span class=lnt id=hl-24-59><a class=lnlinks href=#hl-24-59> 59</a>
</span><span class=lnt id=hl-24-60><a class=lnlinks href=#hl-24-60> 60</a>
</span><span class=lnt id=hl-24-61><a class=lnlinks href=#hl-24-61> 61</a>
</span><span class=lnt id=hl-24-62><a class=lnlinks href=#hl-24-62> 62</a>
</span><span class=lnt id=hl-24-63><a class=lnlinks href=#hl-24-63> 63</a>
</span><span class=lnt id=hl-24-64><a class=lnlinks href=#hl-24-64> 64</a>
</span><span class=lnt id=hl-24-65><a class=lnlinks href=#hl-24-65> 65</a>
</span><span class=lnt id=hl-24-66><a class=lnlinks href=#hl-24-66> 66</a>
</span><span class=lnt id=hl-24-67><a class=lnlinks href=#hl-24-67> 67</a>
</span><span class=lnt id=hl-24-68><a class=lnlinks href=#hl-24-68> 68</a>
</span><span class=lnt id=hl-24-69><a class=lnlinks href=#hl-24-69> 69</a>
</span><span class=lnt id=hl-24-70><a class=lnlinks href=#hl-24-70> 70</a>
</span><span class=lnt id=hl-24-71><a class=lnlinks href=#hl-24-71> 71</a>
</span><span class=lnt id=hl-24-72><a class=lnlinks href=#hl-24-72> 72</a>
</span><span class=lnt id=hl-24-73><a class=lnlinks href=#hl-24-73> 73</a>
</span><span class=lnt id=hl-24-74><a class=lnlinks href=#hl-24-74> 74</a>
</span><span class=lnt id=hl-24-75><a class=lnlinks href=#hl-24-75> 75</a>
</span><span class=lnt id=hl-24-76><a class=lnlinks href=#hl-24-76> 76</a>
</span><span class=lnt id=hl-24-77><a class=lnlinks href=#hl-24-77> 77</a>
</span><span class=lnt id=hl-24-78><a class=lnlinks href=#hl-24-78> 78</a>
</span><span class=lnt id=hl-24-79><a class=lnlinks href=#hl-24-79> 79</a>
</span><span class=lnt id=hl-24-80><a class=lnlinks href=#hl-24-80> 80</a>
</span><span class=lnt id=hl-24-81><a class=lnlinks href=#hl-24-81> 81</a>
</span><span class=lnt id=hl-24-82><a class=lnlinks href=#hl-24-82> 82</a>
</span><span class=lnt id=hl-24-83><a class=lnlinks href=#hl-24-83> 83</a>
</span><span class=lnt id=hl-24-84><a class=lnlinks href=#hl-24-84> 84</a>
</span><span class=lnt id=hl-24-85><a class=lnlinks href=#hl-24-85> 85</a>
</span><span class=lnt id=hl-24-86><a class=lnlinks href=#hl-24-86> 86</a>
</span><span class=lnt id=hl-24-87><a class=lnlinks href=#hl-24-87> 87</a>
</span><span class=lnt id=hl-24-88><a class=lnlinks href=#hl-24-88> 88</a>
</span><span class=lnt id=hl-24-89><a class=lnlinks href=#hl-24-89> 89</a>
</span><span class=lnt id=hl-24-90><a class=lnlinks href=#hl-24-90> 90</a>
</span><span class=lnt id=hl-24-91><a class=lnlinks href=#hl-24-91> 91</a>
</span><span class=lnt id=hl-24-92><a class=lnlinks href=#hl-24-92> 92</a>
</span><span class=lnt id=hl-24-93><a class=lnlinks href=#hl-24-93> 93</a>
</span><span class=lnt id=hl-24-94><a class=lnlinks href=#hl-24-94> 94</a>
</span><span class=lnt id=hl-24-95><a class=lnlinks href=#hl-24-95> 95</a>
</span><span class=lnt id=hl-24-96><a class=lnlinks href=#hl-24-96> 96</a>
</span><span class=lnt id=hl-24-97><a class=lnlinks href=#hl-24-97> 97</a>
</span><span class=lnt id=hl-24-98><a class=lnlinks href=#hl-24-98> 98</a>
</span><span class=lnt id=hl-24-99><a class=lnlinks href=#hl-24-99> 99</a>
</span><span class=lnt id=hl-24-100><a class=lnlinks href=#hl-24-100>100</a>
</span><span class=lnt id=hl-24-101><a class=lnlinks href=#hl-24-101>101</a>
</span><span class=lnt id=hl-24-102><a class=lnlinks href=#hl-24-102>102</a>
</span><span class=lnt id=hl-24-103><a class=lnlinks href=#hl-24-103>103</a>
</span><span class=lnt id=hl-24-104><a class=lnlinks href=#hl-24-104>104</a>
</span><span class=lnt id=hl-24-105><a class=lnlinks href=#hl-24-105>105</a>
</span><span class=lnt id=hl-24-106><a class=lnlinks href=#hl-24-106>106</a>
</span><span class=lnt id=hl-24-107><a class=lnlinks href=#hl-24-107>107</a>
</span><span class=lnt id=hl-24-108><a class=lnlinks href=#hl-24-108>108</a>
</span><span class=lnt id=hl-24-109><a class=lnlinks href=#hl-24-109>109</a>
</span><span class=lnt id=hl-24-110><a class=lnlinks href=#hl-24-110>110</a>
</span><span class=lnt id=hl-24-111><a class=lnlinks href=#hl-24-111>111</a>
</span><span class=lnt id=hl-24-112><a class=lnlinks href=#hl-24-112>112</a>
</span><span class=lnt id=hl-24-113><a class=lnlinks href=#hl-24-113>113</a>
</span><span class=lnt id=hl-24-114><a class=lnlinks href=#hl-24-114>114</a>
</span><span class=lnt id=hl-24-115><a class=lnlinks href=#hl-24-115>115</a>
</span><span class=lnt id=hl-24-116><a class=lnlinks href=#hl-24-116>116</a>
</span><span class=lnt id=hl-24-117><a class=lnlinks href=#hl-24-117>117</a>
</span><span class=lnt id=hl-24-118><a class=lnlinks href=#hl-24-118>118</a>
</span><span class=lnt id=hl-24-119><a class=lnlinks href=#hl-24-119>119</a>
</span><span class=lnt id=hl-24-120><a class=lnlinks href=#hl-24-120>120</a>
</span><span class=lnt id=hl-24-121><a class=lnlinks href=#hl-24-121>121</a>
</span><span class=lnt id=hl-24-122><a class=lnlinks href=#hl-24-122>122</a>
</span><span class=lnt id=hl-24-123><a class=lnlinks href=#hl-24-123>123</a>
</span><span class=lnt id=hl-24-124><a class=lnlinks href=#hl-24-124>124</a>
</span><span class=lnt id=hl-24-125><a class=lnlinks href=#hl-24-125>125</a>
</span><span class=lnt id=hl-24-126><a class=lnlinks href=#hl-24-126>126</a>
</span><span class=lnt id=hl-24-127><a class=lnlinks href=#hl-24-127>127</a>
</span><span class=lnt id=hl-24-128><a class=lnlinks href=#hl-24-128>128</a>
</span><span class=lnt id=hl-24-129><a class=lnlinks href=#hl-24-129>129</a>
</span><span class=lnt id=hl-24-130><a class=lnlinks href=#hl-24-130>130</a>
</span><span class=lnt id=hl-24-131><a class=lnlinks href=#hl-24-131>131</a>
</span><span class=lnt id=hl-24-132><a class=lnlinks href=#hl-24-132>132</a>
</span><span class=lnt id=hl-24-133><a class=lnlinks href=#hl-24-133>133</a>
</span><span class=lnt id=hl-24-134><a class=lnlinks href=#hl-24-134>134</a>
</span><span class=lnt id=hl-24-135><a class=lnlinks href=#hl-24-135>135</a>
</span><span class=lnt id=hl-24-136><a class=lnlinks href=#hl-24-136>136</a>
</span><span class=lnt id=hl-24-137><a class=lnlinks href=#hl-24-137>137</a>
</span><span class=lnt id=hl-24-138><a class=lnlinks href=#hl-24-138>138</a>
</span><span class=lnt id=hl-24-139><a class=lnlinks href=#hl-24-139>139</a>
</span><span class=lnt id=hl-24-140><a class=lnlinks href=#hl-24-140>140</a>
</span><span class=lnt id=hl-24-141><a class=lnlinks href=#hl-24-141>141</a>
</span><span class=lnt id=hl-24-142><a class=lnlinks href=#hl-24-142>142</a>
</span><span class=lnt id=hl-24-143><a class=lnlinks href=#hl-24-143>143</a>
</span><span class=lnt id=hl-24-144><a class=lnlinks href=#hl-24-144>144</a>
</span><span class=lnt id=hl-24-145><a class=lnlinks href=#hl-24-145>145</a>
</span><span class=lnt id=hl-24-146><a class=lnlinks href=#hl-24-146>146</a>
</span><span class=lnt id=hl-24-147><a class=lnlinks href=#hl-24-147>147</a>
</span><span class=lnt id=hl-24-148><a class=lnlinks href=#hl-24-148>148</a>
</span><span class=lnt id=hl-24-149><a class=lnlinks href=#hl-24-149>149</a>
</span><span class=lnt id=hl-24-150><a class=lnlinks href=#hl-24-150>150</a>
</span><span class=lnt id=hl-24-151><a class=lnlinks href=#hl-24-151>151</a>
</span><span class=lnt id=hl-24-152><a class=lnlinks href=#hl-24-152>152</a>
</span><span class=lnt id=hl-24-153><a class=lnlinks href=#hl-24-153>153</a>
</span><span class=lnt id=hl-24-154><a class=lnlinks href=#hl-24-154>154</a>
</span><span class=lnt id=hl-24-155><a class=lnlinks href=#hl-24-155>155</a>
</span><span class=lnt id=hl-24-156><a class=lnlinks href=#hl-24-156>156</a>
</span><span class=lnt id=hl-24-157><a class=lnlinks href=#hl-24-157>157</a>
</span><span class=lnt id=hl-24-158><a class=lnlinks href=#hl-24-158>158</a>
</span><span class=lnt id=hl-24-159><a class=lnlinks href=#hl-24-159>159</a>
</span><span class=lnt id=hl-24-160><a class=lnlinks href=#hl-24-160>160</a>
</span><span class=lnt id=hl-24-161><a class=lnlinks href=#hl-24-161>161</a>
</span><span class=lnt id=hl-24-162><a class=lnlinks href=#hl-24-162>162</a>
</span><span class=lnt id=hl-24-163><a class=lnlinks href=#hl-24-163>163</a>
</span><span class=lnt id=hl-24-164><a class=lnlinks href=#hl-24-164>164</a>
</span><span class=lnt id=hl-24-165><a class=lnlinks href=#hl-24-165>165</a>
</span><span class=lnt id=hl-24-166><a class=lnlinks href=#hl-24-166>166</a>
</span><span class=lnt id=hl-24-167><a class=lnlinks href=#hl-24-167>167</a>
</span><span class=lnt id=hl-24-168><a class=lnlinks href=#hl-24-168>168</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>queue</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>mysql.connector</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>List</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PooledConnection</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span><span class=p>:</span> <span class=n>mysql</span><span class=o>.</span><span class=n>connector</span><span class=o>.</span><span class=n>MySQLConnection</span>
</span></span><span class=line><span class=cl>    <span class=n>last_used</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>created_at</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>is_busy</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ConnectionPool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>user</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>database</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>min_connections</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>max_connections</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>connection_timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>idle_timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>validation_interval</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl>    <span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 기본 설정 초기화</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=n>host</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user&#34;</span><span class=p>:</span> <span class=n>user</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;password&#34;</span><span class=p>:</span> <span class=n>password</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;database&#34;</span><span class=p>:</span> <span class=n>database</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>min_connections</span> <span class=o>=</span> <span class=n>min_connections</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>max_connections</span> <span class=o>=</span> <span class=n>max_connections</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>connection_timeout</span> <span class=o>=</span> <span class=n>connection_timeout</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>idle_timeout</span> <span class=o>=</span> <span class=n>idle_timeout</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>validation_interval</span> <span class=o>=</span> <span class=n>validation_interval</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 연결 풀 및 잠금 장치 초기화</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=p>:</span> <span class=n>queue</span><span class=o>.</span><span class=n>Queue</span> <span class=o>=</span> <span class=n>queue</span><span class=o>.</span><span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>active_connections</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>PooledConnection</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>last_validation</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 모니터링을 위한 메트릭 초기화</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;total_connections&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;active_connections&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;waiting_requests&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 로깅 설정</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 초기 연결 생성</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_pool</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_initialize_pool</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;초기 연결 풀 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>min_connections</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_add_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_add_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>PooledConnection</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;새로운 데이터베이스 연결 생성&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>connection</span> <span class=o>=</span> <span class=n>mysql</span><span class=o>.</span><span class=n>connector</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>db_config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>pooled_conn</span> <span class=o>=</span> <span class=n>PooledConnection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>connection</span><span class=o>=</span><span class=n>connection</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>last_used</span><span class=o>=</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=n>created_at</span><span class=o>=</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>pooled_conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>active_connections</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>pooled_conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s2>&#34;total_connections&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>pooled_conn</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;연결 생성 실패: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_validate_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>conn</span><span class=p>:</span> <span class=n>PooledConnection</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;연결 유효성 검사&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>ping</span><span class=p>(</span><span class=n>reconnect</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>PooledConnection</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;풀에서 연결 획득&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s2>&#34;waiting_requests&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 연결 검증 주기 확인</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_validation</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>validation_interval</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_validate_all_connections</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>connection_timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># 연결 상태 검증</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_validate_connection</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_remove_connection</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>active_connections</span><span class=p>)</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_connections</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>_add_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>is_busy</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>last_used</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s2>&#34;active_connections&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s2>&#34;waiting_requests&#34;</span><span class=p>]</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>conn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=n>queue</span><span class=o>.</span><span class=n>Empty</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 타임아웃 발생 시 새 연결 생성 시도</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>active_connections</span><span class=p>)</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_connections</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>new_conn</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_add_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>new_conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>continue</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection_timeout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;연결 획득 타임아웃&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s2>&#34;waiting_requests&#34;</span><span class=p>]</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>release_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>conn</span><span class=p>:</span> <span class=n>PooledConnection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;연결 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>is_busy</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s2>&#34;active_connections&#34;</span><span class=p>]</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_validate_all_connections</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;모든 연결의 유효성 검사&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>last_validation</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>conn</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_connections</span><span class=p>[:]:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_validate_connection</span><span class=p>(</span><span class=n>conn</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_remove_connection</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_remove_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>conn</span><span class=p>:</span> <span class=n>PooledConnection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;손상된 연결 제거&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>active_connections</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>[</span><span class=s2>&#34;total_connections&#34;</span><span class=p>]</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>cleanup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;오래된 유휴 연결 정리&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>current_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>conn</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_connections</span><span class=p>[:]:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=ow>not</span> <span class=n>conn</span><span class=o>.</span><span class=n>is_busy</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>                    <span class=n>current_time</span> <span class=o>-</span> <span class=n>conn</span><span class=o>.</span><span class=n>last_used</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>idle_timeout</span> <span class=ow>and</span> 
</span></span><span class=line><span class=cl>                    <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>active_connections</span><span class=p>)</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>min_connections</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>_remove_connection</span><span class=p>(</span><span class=n>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;풀 상태 메트릭 반환&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;pool_size&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>active_connections</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;available_connections&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=o>.</span><span class=n>qsize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=javascript>Javascript<a hidden class=anchor aria-hidden=true href=#javascript>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>  1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2>  2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3>  3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4>  4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5>  5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6>  6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7>  7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8>  8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9>  9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10> 10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11> 11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12> 12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13> 13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14> 14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15> 15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16> 16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17> 17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18> 18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19> 19</a>
</span><span class=lnt id=hl-25-20><a class=lnlinks href=#hl-25-20> 20</a>
</span><span class=lnt id=hl-25-21><a class=lnlinks href=#hl-25-21> 21</a>
</span><span class=lnt id=hl-25-22><a class=lnlinks href=#hl-25-22> 22</a>
</span><span class=lnt id=hl-25-23><a class=lnlinks href=#hl-25-23> 23</a>
</span><span class=lnt id=hl-25-24><a class=lnlinks href=#hl-25-24> 24</a>
</span><span class=lnt id=hl-25-25><a class=lnlinks href=#hl-25-25> 25</a>
</span><span class=lnt id=hl-25-26><a class=lnlinks href=#hl-25-26> 26</a>
</span><span class=lnt id=hl-25-27><a class=lnlinks href=#hl-25-27> 27</a>
</span><span class=lnt id=hl-25-28><a class=lnlinks href=#hl-25-28> 28</a>
</span><span class=lnt id=hl-25-29><a class=lnlinks href=#hl-25-29> 29</a>
</span><span class=lnt id=hl-25-30><a class=lnlinks href=#hl-25-30> 30</a>
</span><span class=lnt id=hl-25-31><a class=lnlinks href=#hl-25-31> 31</a>
</span><span class=lnt id=hl-25-32><a class=lnlinks href=#hl-25-32> 32</a>
</span><span class=lnt id=hl-25-33><a class=lnlinks href=#hl-25-33> 33</a>
</span><span class=lnt id=hl-25-34><a class=lnlinks href=#hl-25-34> 34</a>
</span><span class=lnt id=hl-25-35><a class=lnlinks href=#hl-25-35> 35</a>
</span><span class=lnt id=hl-25-36><a class=lnlinks href=#hl-25-36> 36</a>
</span><span class=lnt id=hl-25-37><a class=lnlinks href=#hl-25-37> 37</a>
</span><span class=lnt id=hl-25-38><a class=lnlinks href=#hl-25-38> 38</a>
</span><span class=lnt id=hl-25-39><a class=lnlinks href=#hl-25-39> 39</a>
</span><span class=lnt id=hl-25-40><a class=lnlinks href=#hl-25-40> 40</a>
</span><span class=lnt id=hl-25-41><a class=lnlinks href=#hl-25-41> 41</a>
</span><span class=lnt id=hl-25-42><a class=lnlinks href=#hl-25-42> 42</a>
</span><span class=lnt id=hl-25-43><a class=lnlinks href=#hl-25-43> 43</a>
</span><span class=lnt id=hl-25-44><a class=lnlinks href=#hl-25-44> 44</a>
</span><span class=lnt id=hl-25-45><a class=lnlinks href=#hl-25-45> 45</a>
</span><span class=lnt id=hl-25-46><a class=lnlinks href=#hl-25-46> 46</a>
</span><span class=lnt id=hl-25-47><a class=lnlinks href=#hl-25-47> 47</a>
</span><span class=lnt id=hl-25-48><a class=lnlinks href=#hl-25-48> 48</a>
</span><span class=lnt id=hl-25-49><a class=lnlinks href=#hl-25-49> 49</a>
</span><span class=lnt id=hl-25-50><a class=lnlinks href=#hl-25-50> 50</a>
</span><span class=lnt id=hl-25-51><a class=lnlinks href=#hl-25-51> 51</a>
</span><span class=lnt id=hl-25-52><a class=lnlinks href=#hl-25-52> 52</a>
</span><span class=lnt id=hl-25-53><a class=lnlinks href=#hl-25-53> 53</a>
</span><span class=lnt id=hl-25-54><a class=lnlinks href=#hl-25-54> 54</a>
</span><span class=lnt id=hl-25-55><a class=lnlinks href=#hl-25-55> 55</a>
</span><span class=lnt id=hl-25-56><a class=lnlinks href=#hl-25-56> 56</a>
</span><span class=lnt id=hl-25-57><a class=lnlinks href=#hl-25-57> 57</a>
</span><span class=lnt id=hl-25-58><a class=lnlinks href=#hl-25-58> 58</a>
</span><span class=lnt id=hl-25-59><a class=lnlinks href=#hl-25-59> 59</a>
</span><span class=lnt id=hl-25-60><a class=lnlinks href=#hl-25-60> 60</a>
</span><span class=lnt id=hl-25-61><a class=lnlinks href=#hl-25-61> 61</a>
</span><span class=lnt id=hl-25-62><a class=lnlinks href=#hl-25-62> 62</a>
</span><span class=lnt id=hl-25-63><a class=lnlinks href=#hl-25-63> 63</a>
</span><span class=lnt id=hl-25-64><a class=lnlinks href=#hl-25-64> 64</a>
</span><span class=lnt id=hl-25-65><a class=lnlinks href=#hl-25-65> 65</a>
</span><span class=lnt id=hl-25-66><a class=lnlinks href=#hl-25-66> 66</a>
</span><span class=lnt id=hl-25-67><a class=lnlinks href=#hl-25-67> 67</a>
</span><span class=lnt id=hl-25-68><a class=lnlinks href=#hl-25-68> 68</a>
</span><span class=lnt id=hl-25-69><a class=lnlinks href=#hl-25-69> 69</a>
</span><span class=lnt id=hl-25-70><a class=lnlinks href=#hl-25-70> 70</a>
</span><span class=lnt id=hl-25-71><a class=lnlinks href=#hl-25-71> 71</a>
</span><span class=lnt id=hl-25-72><a class=lnlinks href=#hl-25-72> 72</a>
</span><span class=lnt id=hl-25-73><a class=lnlinks href=#hl-25-73> 73</a>
</span><span class=lnt id=hl-25-74><a class=lnlinks href=#hl-25-74> 74</a>
</span><span class=lnt id=hl-25-75><a class=lnlinks href=#hl-25-75> 75</a>
</span><span class=lnt id=hl-25-76><a class=lnlinks href=#hl-25-76> 76</a>
</span><span class=lnt id=hl-25-77><a class=lnlinks href=#hl-25-77> 77</a>
</span><span class=lnt id=hl-25-78><a class=lnlinks href=#hl-25-78> 78</a>
</span><span class=lnt id=hl-25-79><a class=lnlinks href=#hl-25-79> 79</a>
</span><span class=lnt id=hl-25-80><a class=lnlinks href=#hl-25-80> 80</a>
</span><span class=lnt id=hl-25-81><a class=lnlinks href=#hl-25-81> 81</a>
</span><span class=lnt id=hl-25-82><a class=lnlinks href=#hl-25-82> 82</a>
</span><span class=lnt id=hl-25-83><a class=lnlinks href=#hl-25-83> 83</a>
</span><span class=lnt id=hl-25-84><a class=lnlinks href=#hl-25-84> 84</a>
</span><span class=lnt id=hl-25-85><a class=lnlinks href=#hl-25-85> 85</a>
</span><span class=lnt id=hl-25-86><a class=lnlinks href=#hl-25-86> 86</a>
</span><span class=lnt id=hl-25-87><a class=lnlinks href=#hl-25-87> 87</a>
</span><span class=lnt id=hl-25-88><a class=lnlinks href=#hl-25-88> 88</a>
</span><span class=lnt id=hl-25-89><a class=lnlinks href=#hl-25-89> 89</a>
</span><span class=lnt id=hl-25-90><a class=lnlinks href=#hl-25-90> 90</a>
</span><span class=lnt id=hl-25-91><a class=lnlinks href=#hl-25-91> 91</a>
</span><span class=lnt id=hl-25-92><a class=lnlinks href=#hl-25-92> 92</a>
</span><span class=lnt id=hl-25-93><a class=lnlinks href=#hl-25-93> 93</a>
</span><span class=lnt id=hl-25-94><a class=lnlinks href=#hl-25-94> 94</a>
</span><span class=lnt id=hl-25-95><a class=lnlinks href=#hl-25-95> 95</a>
</span><span class=lnt id=hl-25-96><a class=lnlinks href=#hl-25-96> 96</a>
</span><span class=lnt id=hl-25-97><a class=lnlinks href=#hl-25-97> 97</a>
</span><span class=lnt id=hl-25-98><a class=lnlinks href=#hl-25-98> 98</a>
</span><span class=lnt id=hl-25-99><a class=lnlinks href=#hl-25-99> 99</a>
</span><span class=lnt id=hl-25-100><a class=lnlinks href=#hl-25-100>100</a>
</span><span class=lnt id=hl-25-101><a class=lnlinks href=#hl-25-101>101</a>
</span><span class=lnt id=hl-25-102><a class=lnlinks href=#hl-25-102>102</a>
</span><span class=lnt id=hl-25-103><a class=lnlinks href=#hl-25-103>103</a>
</span><span class=lnt id=hl-25-104><a class=lnlinks href=#hl-25-104>104</a>
</span><span class=lnt id=hl-25-105><a class=lnlinks href=#hl-25-105>105</a>
</span><span class=lnt id=hl-25-106><a class=lnlinks href=#hl-25-106>106</a>
</span><span class=lnt id=hl-25-107><a class=lnlinks href=#hl-25-107>107</a>
</span><span class=lnt id=hl-25-108><a class=lnlinks href=#hl-25-108>108</a>
</span><span class=lnt id=hl-25-109><a class=lnlinks href=#hl-25-109>109</a>
</span><span class=lnt id=hl-25-110><a class=lnlinks href=#hl-25-110>110</a>
</span><span class=lnt id=hl-25-111><a class=lnlinks href=#hl-25-111>111</a>
</span><span class=lnt id=hl-25-112><a class=lnlinks href=#hl-25-112>112</a>
</span><span class=lnt id=hl-25-113><a class=lnlinks href=#hl-25-113>113</a>
</span><span class=lnt id=hl-25-114><a class=lnlinks href=#hl-25-114>114</a>
</span><span class=lnt id=hl-25-115><a class=lnlinks href=#hl-25-115>115</a>
</span><span class=lnt id=hl-25-116><a class=lnlinks href=#hl-25-116>116</a>
</span><span class=lnt id=hl-25-117><a class=lnlinks href=#hl-25-117>117</a>
</span><span class=lnt id=hl-25-118><a class=lnlinks href=#hl-25-118>118</a>
</span><span class=lnt id=hl-25-119><a class=lnlinks href=#hl-25-119>119</a>
</span><span class=lnt id=hl-25-120><a class=lnlinks href=#hl-25-120>120</a>
</span><span class=lnt id=hl-25-121><a class=lnlinks href=#hl-25-121>121</a>
</span><span class=lnt id=hl-25-122><a class=lnlinks href=#hl-25-122>122</a>
</span><span class=lnt id=hl-25-123><a class=lnlinks href=#hl-25-123>123</a>
</span><span class=lnt id=hl-25-124><a class=lnlinks href=#hl-25-124>124</a>
</span><span class=lnt id=hl-25-125><a class=lnlinks href=#hl-25-125>125</a>
</span><span class=lnt id=hl-25-126><a class=lnlinks href=#hl-25-126>126</a>
</span><span class=lnt id=hl-25-127><a class=lnlinks href=#hl-25-127>127</a>
</span><span class=lnt id=hl-25-128><a class=lnlinks href=#hl-25-128>128</a>
</span><span class=lnt id=hl-25-129><a class=lnlinks href=#hl-25-129>129</a>
</span><span class=lnt id=hl-25-130><a class=lnlinks href=#hl-25-130>130</a>
</span><span class=lnt id=hl-25-131><a class=lnlinks href=#hl-25-131>131</a>
</span><span class=lnt id=hl-25-132><a class=lnlinks href=#hl-25-132>132</a>
</span><span class=lnt id=hl-25-133><a class=lnlinks href=#hl-25-133>133</a>
</span><span class=lnt id=hl-25-134><a class=lnlinks href=#hl-25-134>134</a>
</span><span class=lnt id=hl-25-135><a class=lnlinks href=#hl-25-135>135</a>
</span><span class=lnt id=hl-25-136><a class=lnlinks href=#hl-25-136>136</a>
</span><span class=lnt id=hl-25-137><a class=lnlinks href=#hl-25-137>137</a>
</span><span class=lnt id=hl-25-138><a class=lnlinks href=#hl-25-138>138</a>
</span><span class=lnt id=hl-25-139><a class=lnlinks href=#hl-25-139>139</a>
</span><span class=lnt id=hl-25-140><a class=lnlinks href=#hl-25-140>140</a>
</span><span class=lnt id=hl-25-141><a class=lnlinks href=#hl-25-141>141</a>
</span><span class=lnt id=hl-25-142><a class=lnlinks href=#hl-25-142>142</a>
</span><span class=lnt id=hl-25-143><a class=lnlinks href=#hl-25-143>143</a>
</span><span class=lnt id=hl-25-144><a class=lnlinks href=#hl-25-144>144</a>
</span><span class=lnt id=hl-25-145><a class=lnlinks href=#hl-25-145>145</a>
</span><span class=lnt id=hl-25-146><a class=lnlinks href=#hl-25-146>146</a>
</span><span class=lnt id=hl-25-147><a class=lnlinks href=#hl-25-147>147</a>
</span><span class=lnt id=hl-25-148><a class=lnlinks href=#hl-25-148>148</a>
</span><span class=lnt id=hl-25-149><a class=lnlinks href=#hl-25-149>149</a>
</span><span class=lnt id=hl-25-150><a class=lnlinks href=#hl-25-150>150</a>
</span><span class=lnt id=hl-25-151><a class=lnlinks href=#hl-25-151>151</a>
</span><span class=lnt id=hl-25-152><a class=lnlinks href=#hl-25-152>152</a>
</span><span class=lnt id=hl-25-153><a class=lnlinks href=#hl-25-153>153</a>
</span><span class=lnt id=hl-25-154><a class=lnlinks href=#hl-25-154>154</a>
</span><span class=lnt id=hl-25-155><a class=lnlinks href=#hl-25-155>155</a>
</span><span class=lnt id=hl-25-156><a class=lnlinks href=#hl-25-156>156</a>
</span><span class=lnt id=hl-25-157><a class=lnlinks href=#hl-25-157>157</a>
</span><span class=lnt id=hl-25-158><a class=lnlinks href=#hl-25-158>158</a>
</span><span class=lnt id=hl-25-159><a class=lnlinks href=#hl-25-159>159</a>
</span><span class=lnt id=hl-25-160><a class=lnlinks href=#hl-25-160>160</a>
</span><span class=lnt id=hl-25-161><a class=lnlinks href=#hl-25-161>161</a>
</span><span class=lnt id=hl-25-162><a class=lnlinks href=#hl-25-162>162</a>
</span><span class=lnt id=hl-25-163><a class=lnlinks href=#hl-25-163>163</a>
</span><span class=lnt id=hl-25-164><a class=lnlinks href=#hl-25-164>164</a>
</span><span class=lnt id=hl-25-165><a class=lnlinks href=#hl-25-165>165</a>
</span><span class=lnt id=hl-25-166><a class=lnlinks href=#hl-25-166>166</a>
</span><span class=lnt id=hl-25-167><a class=lnlinks href=#hl-25-167>167</a>
</span><span class=lnt id=hl-25-168><a class=lnlinks href=#hl-25-168>168</a>
</span><span class=lnt id=hl-25-169><a class=lnlinks href=#hl-25-169>169</a>
</span><span class=lnt id=hl-25-170><a class=lnlinks href=#hl-25-170>170</a>
</span><span class=lnt id=hl-25-171><a class=lnlinks href=#hl-25-171>171</a>
</span><span class=lnt id=hl-25-172><a class=lnlinks href=#hl-25-172>172</a>
</span><span class=lnt id=hl-25-173><a class=lnlinks href=#hl-25-173>173</a>
</span><span class=lnt id=hl-25-174><a class=lnlinks href=#hl-25-174>174</a>
</span><span class=lnt id=hl-25-175><a class=lnlinks href=#hl-25-175>175</a>
</span><span class=lnt id=hl-25-176><a class=lnlinks href=#hl-25-176>176</a>
</span><span class=lnt id=hl-25-177><a class=lnlinks href=#hl-25-177>177</a>
</span><span class=lnt id=hl-25-178><a class=lnlinks href=#hl-25-178>178</a>
</span><span class=lnt id=hl-25-179><a class=lnlinks href=#hl-25-179>179</a>
</span><span class=lnt id=hl-25-180><a class=lnlinks href=#hl-25-180>180</a>
</span><span class=lnt id=hl-25-181><a class=lnlinks href=#hl-25-181>181</a>
</span><span class=lnt id=hl-25-182><a class=lnlinks href=#hl-25-182>182</a>
</span><span class=lnt id=hl-25-183><a class=lnlinks href=#hl-25-183>183</a>
</span><span class=lnt id=hl-25-184><a class=lnlinks href=#hl-25-184>184</a>
</span><span class=lnt id=hl-25-185><a class=lnlinks href=#hl-25-185>185</a>
</span><span class=lnt id=hl-25-186><a class=lnlinks href=#hl-25-186>186</a>
</span><span class=lnt id=hl-25-187><a class=lnlinks href=#hl-25-187>187</a>
</span><span class=lnt id=hl-25-188><a class=lnlinks href=#hl-25-188>188</a>
</span><span class=lnt id=hl-25-189><a class=lnlinks href=#hl-25-189>189</a>
</span><span class=lnt id=hl-25-190><a class=lnlinks href=#hl-25-190>190</a>
</span><span class=lnt id=hl-25-191><a class=lnlinks href=#hl-25-191>191</a>
</span><span class=lnt id=hl-25-192><a class=lnlinks href=#hl-25-192>192</a>
</span><span class=lnt id=hl-25-193><a class=lnlinks href=#hl-25-193>193</a>
</span><span class=lnt id=hl-25-194><a class=lnlinks href=#hl-25-194>194</a>
</span><span class=lnt id=hl-25-195><a class=lnlinks href=#hl-25-195>195</a>
</span><span class=lnt id=hl-25-196><a class=lnlinks href=#hl-25-196>196</a>
</span><span class=lnt id=hl-25-197><a class=lnlinks href=#hl-25-197>197</a>
</span><span class=lnt id=hl-25-198><a class=lnlinks href=#hl-25-198>198</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mysql</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;mysql2/promise&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>EventEmitter</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ConnectionPool</span> <span class=kr>extends</span> <span class=nx>EventEmitter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 기본 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>host</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>host</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>user</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>user</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>password</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>password</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>database</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>database</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>minConnections</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>minConnections</span> <span class=o>||</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>maxConnections</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>maxConnections</span> <span class=o>||</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>connectionTimeout</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>connectionTimeout</span> <span class=o>||</span> <span class=mi>30000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>idleTimeout</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>idleTimeout</span> <span class=o>||</span> <span class=mi>300000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>validationInterval</span><span class=o>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>validationInterval</span> <span class=o>||</span> <span class=mi>60000</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 풀 상태 관리
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>pool</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>waiting</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>totalConnections</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>activeConnections</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>waitingRequests</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 초기화
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>initialize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 주기적인 작업 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>validateConnections</span><span class=p>(),</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>validationInterval</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>cleanup</span><span class=p>(),</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>idleTimeout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>initialize</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 초기 연결 생성
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>minConnections</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>createConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;풀 초기화 실패:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>createConnection</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>connection</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>mysql</span><span class=p>.</span><span class=nx>createConnection</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 연결 객체 래핑
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>pooledConnection</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>connection</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>lastUsed</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=nx>createdAt</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=nx>isBusy</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>pooledConnection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>totalConnections</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// 연결 이벤트 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>connection</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;연결 오류:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>removeConnection</span><span class=p>(</span><span class=nx>pooledConnection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>createConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>pooledConnection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;연결 생성 실패:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getConnection</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 대기 요청 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>waitingRequests</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 사용 가능한 연결 찾기
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>connection</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=nx>conn</span> <span class=p>=&gt;</span> <span class=o>!</span><span class=nx>conn</span><span class=p>.</span><span class=nx>isBusy</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>connection</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>prepareConnection</span><span class=p>(</span><span class=nx>connection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// 새 연결 생성 가능 여부 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>maxConnections</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>newConnection</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>createConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>prepareConnection</span><span class=p>(</span><span class=nx>newConnection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// 연결 대기
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>timeout</span> <span class=o>=</span> <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>this</span><span class=p>.</span><span class=nx>waiting</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>waiting</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>w</span> <span class=p>=&gt;</span> <span class=nx>w</span><span class=p>.</span><span class=nx>resolve</span> <span class=o>!==</span> <span class=nx>resolve</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>waitingRequests</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=nx>reject</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;연결 타임아웃&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>connectionTimeout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>this</span><span class=p>.</span><span class=nx>waiting</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>,</span> <span class=nx>timeout</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>waitingRequests</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>prepareConnection</span><span class=p>(</span><span class=nx>pooledConnection</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 연결 유효성 검사
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>validateConnection</span><span class=p>(</span><span class=nx>pooledConnection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nx>pooledConnection</span><span class=p>.</span><span class=nx>isBusy</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>pooledConnection</span><span class=p>.</span><span class=nx>lastUsed</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>activeConnections</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>pooledConnection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>removeConnection</span><span class=p>(</span><span class=nx>pooledConnection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>releaseConnection</span><span class=p>(</span><span class=nx>pooledConnection</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>pooledConnection</span><span class=p>.</span><span class=nx>isBusy</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>pooledConnection</span><span class=p>.</span><span class=nx>lastUsed</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>activeConnections</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 대기 중인 요청 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>waiting</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=p>{</span> <span class=nx>resolve</span><span class=p>,</span> <span class=nx>timeout</span> <span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>waiting</span><span class=p>.</span><span class=nx>shift</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>timeout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>resolve</span><span class=p>(</span><span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>prepareConnection</span><span class=p>(</span><span class=nx>pooledConnection</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>validateConnection</span><span class=p>(</span><span class=nx>pooledConnection</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>pooledConnection</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s1>&#39;SELECT 1&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;연결 검증 실패&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>validateConnections</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;연결 유효성 검사 시작&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>connection</span> <span class=k>of</span> <span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>connection</span><span class=p>.</span><span class=nx>isBusy</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>validateConnection</span><span class=p>(</span><span class=nx>connection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>removeConnection</span><span class=p>(</span><span class=nx>connection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>removeConnection</span><span class=p>(</span><span class=nx>pooledConnection</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>pooledConnection</span><span class=p>.</span><span class=nx>connection</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;연결 종료 실패:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>pool</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>conn</span> <span class=p>=&gt;</span> <span class=nx>conn</span> <span class=o>!==</span> <span class=nx>pooledConnection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>.</span><span class=nx>totalConnections</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 최소 연결 수 유지
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>minConnections</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>createConnection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>cleanup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>idleConnections</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>conn</span> <span class=p>=&gt;</span> <span class=o>!</span><span class=nx>conn</span><span class=p>.</span><span class=nx>isBusy</span> <span class=o>&amp;&amp;</span> 
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nx>now</span> <span class=o>-</span> <span class=nx>conn</span><span class=p>.</span><span class=nx>lastUsed</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>idleTimeout</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>minConnections</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>connection</span> <span class=k>of</span> <span class=nx>idleConnections</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>removeConnection</span><span class=p>(</span><span class=nx>connection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>getMetrics</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=err>…</span><span class=k>this</span><span class=p>.</span><span class=nx>metrics</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>poolSize</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>.</span><span class=nx>length</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>availableConnections</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>pool</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>conn</span> <span class=p>=&gt;</span> <span class=o>!</span><span class=nx>conn</span><span class=p>.</span><span class=nx>isBusy</span><span class=p>).</span><span class=nx>length</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=참고-및-출처-4>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처-4>#</a></h3></div></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>