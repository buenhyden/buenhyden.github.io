<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>uvicorn | hyunyoun's Blog</title><meta name=keywords content="Programming-Languages,Python,Library,Web-Application-Server,uvicorn"><meta name=description content="Uvicorn은 Python용 ASGI(Asynchronous Server Gateway Interface) 웹 서버 구현체이다."><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/programming-languages/python/library/web-application-server/uvicorn/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/programming-languages/python/library/web-application-server/uvicorn/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/programming-languages/python/library/web-application-server/uvicorn/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="uvicorn"><meta property="og:description" content="Uvicorn은 Python용 ASGI(Asynchronous Server Gateway Interface) 웹 서버 구현체이다."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-30T08:44:00+00:00"><meta property="article:modified_time" content="2024-11-30T08:44:00+00:00"><meta property="article:tag" content="Programming-Languages"><meta property="article:tag" content="Python"><meta property="article:tag" content="Library"><meta property="article:tag" content="Web-Application-Server"><meta property="article:tag" content="Uvicorn"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="uvicorn"><meta name=twitter:description content="Uvicorn은 Python용 ASGI(Asynchronous Server Gateway Interface) 웹 서버 구현체이다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Computer Science and Engineering","item":"https://buenhyden.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Programming Languages","item":""},{"@type":"ListItem","position":3,"name":"Python","item":"https://buenhyden.github.io/posts/programming-languages/python/"},{"@type":"ListItem","position":4,"name":"Libraries of Python","item":""},{"@type":"ListItem","position":5,"name":"Python Web Application Server","item":"https://buenhyden.github.io/posts/programming-languages/python/library/web-application-server/"},{"@type":"ListItem","position":6,"name":"uvicorn","item":"https://buenhyden.github.io/posts/programming-languages/python/library/web-application-server/uvicorn/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"uvicorn","name":"uvicorn","description":"Uvicorn은 Python용 ASGI(Asynchronous Server Gateway Interface) 웹 서버 구현체이다.","keywords":["Programming-Languages","Python","Library","Web-Application-Server","uvicorn"],"articleBody":"Uvicorn Uvicorn은 Python용 ASGI(Asynchronous Server Gateway Interface) 웹 서버 구현체이다.\nUvicorn은 비동기 Python 웹 애플리케이션을 위한 고성능 서버이다.\nASGI 프로토콜을 지원하여 HTTP, HTTP2, WebSocket 등의 프로토콜을 처리할 수 있다.\n주요 특징 비동기 처리: asyncio를 기반으로 하여 비동기 코드를 효율적으로 실행한다. 고성능: uvloop와 httptools를 사용하여 빠른 속도를 제공한다. 경량화: 최소한의 의존성으로 설치 가능하다. 개발 편의성: 자동 리로드 기능을 제공하여 개발 시 편리하다. ASGI 호환성: ASGI 표준을 준수하여 다양한 ASGI 프레임워크와 호환된다. FastAPI와의 통합 Uvicorn은 FastAPI의 기본 웹 서버로 사용된다.\nFastAPI는 Uvicorn의 비동기 처리 능력을 활용하여 고성능 API를 구현할 수 있다.\n최적화 Uvicorn은 uvloop를 사용하여 asyncio의 성능을 2-4배 향상시킬 수 있다.\n또한 httptools를 사용하여 HTTP 파싱 속도를 개선한다.\nUvloop uvloop는 Cython으로 작성된 매우 빠른 Python 이벤트 루프 구현체이다.\nlibuv(Node.js가 사용하는 동일한 이벤트 루프 엔진)를 기반으로 하여 Python의 기본 asyncio 이벤트 루프를 대체한다.\n기본적인 사용방법:\n1 2 3 4 5 6 7 8 9 10 11 12 13 import uvloop import asyncio # uvloop를 기본 이벤트 루프로 설정 asyncio.set_event_loop_policy(uvloop.EventLoopPolicy()) async def main(): # 비동기 작업 수행 await asyncio.sleep(1) print(\"Hello, uvloop!\") # 이벤트 루프 실행 asyncio.run(main()) 주요 특징:\n성능: uvloop는 Node.js의 libuv를 기반으로 하며, 기본 asyncio 이벤트 루프보다 2-4배 빠른 성능을 제공한다. 구현: Cython으로 작성되어 C 수준의 성능을 제공한다. 호환성: asyncio와 완벽하게 호환되며, 기존 asyncio 코드를 수정하지 않고도 사용할 수 있다. 플랫폼 지원: Linux, macOS, FreeBSD에서 사용 가능하지만, Windows에서는 지원되지 않는다. uvloop가 제공하는 주요 성능 향상 요소:\n향상된 I/O 처리:\n1 2 3 4 5 6 async def handle_connection(reader, writer): # uvloop는 이러한 I/O 작업을 매우 효율적으로 처리합니다 data = await reader.read(100) writer.write(data) await writer.drain() writer.close() 타이머 최적화:\n1 2 3 4 5 6 async def timed_operation(): # uvloop는 타이머 처리도 더 효율적으로 수행합니다 start = asyncio.get_event_loop().time() await asyncio.sleep(0.1) end = asyncio.get_event_loop().time() return end - start 시스템 콜 최적화:\n1 2 3 4 5 async def file_operations(): # 파일 시스템 작업도 더 빠르게 처리됩니다 async with aiofiles.open('file.txt', mode='r') as f: contents = await f.read() return contents Httptools httptools는 Node.js의 http-parser를 Python에 바인딩한 고성능 HTTP 파싱 라이브러리.\n이는 Python의 기본 HTTP 파서보다 훨씬 빠른 성능을 제공한다.\nhttptools의 기본 사용법:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 from httptools import HttpRequestParser class RequestParser: def __init__(self): self.parser = HttpRequestParser(self) self.headers = {} self.body = bytearray() def on_header(self, name: bytes, value: bytes): # 헤더를 파싱할 때 호출됩니다 self.headers[name.decode()] = value.decode() def on_body(self, body: bytes): # 요청 본문을 파싱할 때 호출됩니다 self.body.extend(body) httptools의 주요 특징과 장점들:\n성능: Nginx의 HTTP 파서를 기반으로 하여 매우 빠른 파싱 속도를 제공한다.\n구현: C로 작성되어 있어 높은 성능을 보장한다.\n비동기 지원: 비동기 프로그래밍 모델과 잘 맞아 Uvicorn과 같은 비동기 서버에서 효과적으로 사용된다.\n메모리 효율성: 스트리밍 파싱을 지원하여 메모리 사용을 최적화한다.\n스트리밍 파싱:\n1 2 3 4 5 6 7 class HTTPProtocol: def data_received(self, data): # 데이터가 도착하는 대로 점진적으로 파싱 try: self.parser.feed_data(data) except Exception as exc: print(f\"파싱 에러: {exc}\") 고성능 URL 파싱:\n1 2 3 4 5 6 7 8 9 10 11 from httptools import parse_url def parse_request_url(url: bytes): parsed = parse_url(url) return { 'schema': parsed.schema, 'host': parsed.host, 'port': parsed.port, 'path': parsed.path, 'query': parsed.query } Uvloop와 Httptools의 통합 Uvicorn에서 이 두 구성요소가 어떻게 함께 작동하는지 살펴보자:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 import uvicorn from fastapi import FastAPI app = FastAPI() if __name__ == \"__main__\": uvicorn.run( app, host=\"0.0.0.0\", port=8000, loop=\"uvloop\", # uvloop 사용 http=\"httptools\", # httptools 사용 workers=4 # 워커 프로세스 수 ) 이러한 구성요소들의 조합은 다음과 같은 이점을 제공한다:\n향상된 처리량: uvloop와 httptools의 조합은 기존 Python 웹 서버보다 훨씬 높은 요청 처리량을 달성할 수 있다. 낮은 지연 시간: 최적화된 이벤트 루프와 HTTP 파싱으로 인해 각 요청의 처리 시간이 단축된다. 메모리 효율성: C 기반의 구현으로 인해 메모리 사용이 더 효율적이다. 안정성: 널리 검증된 libuv와 http-parser를 기반으로 하므로 안정적인 성능을 제공한다.\n이러한 특성들은 Uvicorn이 고성능 Python 웹 애플리케이션을 구축하는 데 이상적인 선택이 되게 한다.\n특히 FastAPI나 Starlette와 같은 현대적인 비동기 웹 프레임워크와 함께 사용할 때 그 장점이 더욱 두드러진다. 설치 및 사용 Uvicorn은 pip를 통해 쉽게 설치할 수 있다:\n1 pip install uvicorn 기본 사용 예시:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import uvicorn async def app(scope, receive, send): await send({ 'type': 'http.response.start', 'status': 200, 'headers': [ [b'content-type', b'text/plain'], ], }) await send({ 'type': 'http.response.body', 'body': b'Hello, world!', }) if __name__ == \"__main__\": uvicorn.run(\"main:app\", host=\"127.0.0.1\", port=8000, log_level=\"info\") Uvicorn 환경 설정 다양한 설정 옵션 실제 운영 환경에서는 설정들을 서버의 특성과 요구사항에 맞게 조정해야 한다.\n특히 다음과 같은 점들을 고려해야 한다:\n서버의 하드웨어 리소스 (CPU, 메모리)에 맞춘 워커 수와 동시성 제한 설정 예상되는 트래픽 패턴에 따른 타임아웃과 버퍼 크기 조정 보안 요구사항에 맞는 SSL/TLS 설정 모니터링과 디버깅을 위한 적절한 로깅 레벨 설정\n이러한 설정들은 실제 부하 테스트를 통해 최적화되어야 하며, 운영 중에도 지속적인 모니터링과 튜닝이 필요하다. uvicorn의 설정 옵션들을 체계적으로 설명해드리겠습니다. 각 카테고리별로 설정의 목적과 영향을 자세히 살펴보며, 실제 운영 환경에서 어떻게 활용할 수 있는지도 함께 알아보겠습니다.\n서버 기본 설정 서버의 가장 기본적인 동작을 제어하는 핵심 설정.\n이러한 설정들은 uvicorn이 어떻게 요청을 받고 처리할지를 결정한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import uvicorn config = { # 애플리케이션 설정 \"app\": \"main:app\", # 실행할 애플리케이션의 경로 \"host\": \"0.0.0.0\", # 바인딩할 호스트 주소 \"port\": 8000, # 리스닝할 포트 번호 \"uds\": None, # Unix 도메인 소켓 경로 (선택적) \"fd\": None, # 파일 디스크립터 (선택적) \"loop\": \"auto\", # 이벤트 루프 선택 (auto, asyncio, uvloop) \"http\": \"auto\", # HTTP 프로토콜 구현체 (auto, h11, httptools) \"ws\": \"auto\", # WebSocket 프로토콜 구현체 (auto, none, websockets) \"lifespan\": \"auto\", # 수명 주기 이벤트 처리 (auto, on, off) \"env_file\": \".env\" # 환경 변수 파일 경로 } 최적화 설정 서버의 성능과 리소스 사용에 직접적인 영향을 미치는 설정.\n이러한 설정들은 실제 운영 환경에서 매우 중요하다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 performance_config = { # 프로세스 설정 \"workers\": 4, # 워커 프로세스 수 \"limit_concurrency\": 1000, # 동시 연결 제한 \"limit_max_requests\": 10000, # 워커 재시작 전 최대 요청 수 \"backlog\": 2048, # 연결 대기열 크기 # 타임아웃 설정 \"timeout_keep_alive\": 5, # keep-alive 연결 타임아웃 (초) \"timeout_notify\": 30, # 종료 전 알림 대기 시간 (초) # 버퍼 설정 \"buffer_size\": 16384, # 요청/응답 버퍼 크기 (바이트) } 보안 설정 서버의 보안을 강화하기 위한 설정.\nSSL/TLS 설정과 프록시 관련 설정이 포함된다.\n1 2 3 4 5 6 7 8 9 10 11 security_config = { # SSL/TLS 설정 \"ssl_keyfile\": \"/path/to/key.pem\", # SSL 키 파일 경로 \"ssl_certfile\": \"/path/to/cert.pem\", # SSL 인증서 파일 경로 \"ssl_keyfile_password\": None, # SSL 키 파일 암호 \"ssl_version\": 2, # SSL/TLS 버전 # 프록시 설정 \"proxy_headers\": True, # X-Forwarded-* 헤더 처리 \"forwarded_allow_ips\": \"*\", # 신뢰할 수 있는 프록시 IP } 로깅 설정 서버의 동작을 모니터링하고 문제를 진단하기 위한 로깅 관련 설정.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 logging_config = { # 로그 레벨 설정 \"log_level\": \"info\", # 로그 레벨 (critical, error, warning, info, debug, trace) \"access_log\": True, # 접근 로그 활성화 \"use_colors\": True, # 컬러 로그 사용 # 로그 포맷 설정 \"log_config\": { \"version\": 1, \"disable_existing_loggers\": False, \"formatters\": { \"default\": { \"format\": \"%(asctime)s - %(name)s - %(levelname)s - %(message)s\" } }, \"handlers\": { \"default\": { \"formatter\": \"default\", \"class\": \"logging.StreamHandler\", \"stream\": \"ext://sys.stdout\" } }, \"loggers\": { \"uvicorn\": { \"handlers\": [\"default\"], \"level\": \"INFO\" } } } } 개발 설정 개발 환경에서 유용한 설정.\n코드 변경 감지와 디버깅을 위한 옵션들이 포함된다.\n1 2 3 4 5 6 7 8 9 10 development_config = { # 리로드 설정 \"reload\": True, # 코드 변경 감지 및 자동 리로드 \"reload_dirs\": [\"app\", \"config\"], # 리로드를 감시할 디렉토리 \"reload_delay\": 0.25, # 리로드 지연 시간 (초) # 디버깅 설정 \"debug\": True, # 디버그 모드 활성화 \"log_level\": \"debug\", # 상세한 로깅 } 리소스 관리 설정 서버의 리소스 사용을 제어하는 설정.\n메모리와 CPU 사용량을 관리하는 데 도움이 된다.\n1 2 3 4 5 6 7 8 resource_config = { # 프로세스 제한 설정 \"limit_max_requests\": 10000, # 워커 재시작 전 최대 요청 수 \"limit_concurrency\": 1000, # 동시 연결 제한 # 메모리 관리 \"buffer_size\": 16384, # 버퍼 크기 (바이트) } 시스템 서비스 등록 Systemd 서비스 파일을 작성 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 [Unit] Description=Uvicorn instance to serve FastAPI application After=network.target # 데이터베이스 의존성이 있다면 다음과 같이 추가할 수 있습니다 # Requires=postgresql.service # After=postgresql.service [Service] # 서비스를 실행할 사용자와 그룹을 지정합니다 User=www-data Group=www-data # 작업 디렉토리를 지정합니다 WorkingDirectory=/path/to/your/fastapi/app # 환경 변수 설정 Environment=\"PATH=/path/to/your/virtualenv/bin\" Environment=\"PYTHONPATH=/path/to/your/fastapi/app\" Environment=\"LOG_LEVEL=info\" # 실행 명령을 지정합니다 ExecStart=/path/to/your/virtualenv/bin/uvicorn \\ main:app \\ --host 0.0.0.0 \\ --port 8000 \\ --workers 4 \\ --loop uvloop \\ --http httptools \\ --log-level info \\ --access-log \\ --use-colors \\ --proxy-headers \\ --forwarded-allow-ips='*' # 프로세스 관리 설정 Restart=always RestartSec=10 StartLimitInterval=0 # 보안 관련 설정 PrivateTmp=true NoNewPrivileges=true [Install] WantedBy=multi-user.target 서비스 파일을 시스템에 등록하고 활성화하는 방법 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 서비스 파일 복사 sudo cp uvicorn.service /etc/systemd/system/ # systemd 데몬 리로드 sudo systemctl daemon-reload # 서비스 시작 sudo systemctl start uvicorn # 부팅 시 자동 시작 설정 sudo systemctl enable uvicorn # 서비스 상태 확인 sudo systemctl status uvicorn 배포 프로덕션 환경에서는 Gunicorn과 함께 Uvicorn을 사용하는 것이 권장된다.\nGunicorn은 프로세스 관리와 로드 밸런싱을 제공하며, Uvicorn은 워커로 동작하여 높은 성능을 발휘한다.\n예시 장점들을 살펴보면:\nNginx는 리버스 프록시로서 SSL 종료, 정적 파일 서빙, 로드 밸런싱을 처리한다. Gunicorn은 프로세스 관리자로서 워커 프로세스의 생명주기를 관리한다. Uvicorn은 ASGI 서버로서 비동기 Python 애플리케이션을 효율적으로 실행한다.\n이 구성은 높은 성능과 안정성을 제공하며, 각 구성 요소의 장점을 최대한 활용할 수 있다.\n실제 운영 환경에서는 서버의 리소스와 트래픽 패턴에 따라 워커 수와 타임아웃 설정 등을 적절히 조정해야 한다. 서비스 아키텍처는 다음과 같다:\nNginx(리버스 프록시) → Gunicorn(프로세스 관리자) → Uvicorn(ASGI 서버) → FastAPI/Django 애플리케이션\n먼저 Nginx 설정 파일을 작성한다.\n/etc/nginx/sites-available/fastapi_app:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 server { listen 80; server_name example.com; access_log /var/log/nginx/app-access.log; error_log /var/log/nginx/app-error.log; location / { proxy_pass http://unix:/run/gunicorn.sock; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket 지원을 위한 설정 proxy_read_timeout 300s; proxy_connect_timeout 75s; } } Gunicorn 설정 파일을 작성한다.\n`` /etc/gunicorn/conf.py`:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # Gunicorn 설정 파일 import multiprocessing from uvicorn.workers import UvicornWorker # 기본 설정 bind = \"unix:/run/gunicorn.sock\" workers = multiprocessing.cpu_count() * 2 + 1 worker_class = \"uvicorn.workers.UvicornWorker\" max_requests = 1000 max_requests_jitter = 50 # Uvicorn 워커 설정 class CustomUvicornWorker(UvicornWorker): CONFIG_KWARGS = { \"loop\": \"uvloop\", \"http\": \"httptools\", \"lifespan\": \"on\", \"access_log\": True, \"use_colors\": False, \"timeout_keep_alive\": 5, } # 로깅 설정 accesslog = \"/var/log/gunicorn/access.log\" errorlog = \"/var/log/gunicorn/error.log\" loglevel = \"info\" systemd 서비스 파일을 작성한다.\n`` /etc/systemd/system/gunicorn.service`:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 [Unit] Description=Gunicorn with Uvicorn workers for FastAPI application After=network.target Requires=nginx.service After=nginx.service [Service] User=www-data Group=www-data WorkingDirectory=/path/to/your/app Environment=\"PATH=/path/to/your/virtualenv/bin\" Environment=\"PYTHONPATH=/path/to/your/app\" Environment=\"PYTHONUNBUFFERED=1\" # 환경 변수 파일 포함 EnvironmentFile=/etc/default/gunicorn # Gunicorn 실행 명령 ExecStart=/path/to/your/virtualenv/bin/gunicorn \\ --config /etc/gunicorn/conf.py \\ main:app # 프로세스 관리 Restart=always RestartSec=10 StartLimitInterval=0 # 보안 설정 NoNewPrivileges=true PrivateTmp=true ProtectSystem=full # 리소스 제한 LimitNOFILE=65535 TimeoutStopSec=5 [Install] WantedBy=multi-user.target 환경 변수를 관리하기 위한 파일을 생성한다.\n/etc/default/gunicorn:\n1 2 3 4 5 # Gunicorn 환경 변수 PYTHONPATH=/path/to/your/app DATABASE_URL=postgresql://user:password@localhost/dbname REDIS_URL=redis://localhost:6379/0 LOG_LEVEL=info 필요한 디렉토리와 권한을 설정한다\n1 2 3 4 5 6 # 로그 디렉토리 생성 sudo mkdir -p /var/log/gunicorn sudo chown -R www-data:www-data /var/log/gunicorn # 소켓 디렉토리 권한 설정 sudo chown www-data:www-data /run 서비스를 활성화하고 시작한다:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Nginx 설정 심볼릭 링크 생성 sudo ln -s /etc/nginx/sites-available/fastapi_app /etc/nginx/sites-enabled/ # Nginx 설정 테스트 sudo nginx -t # systemd 데몬 리로드 sudo systemctl daemon-reload # 서비스 시작 sudo systemctl start gunicorn sudo systemctl start nginx # 부팅 시 자동 시작 설정 sudo systemctl enable gunicorn sudo systemctl enable nginx 참고 및 출처 Uvicorn\n","wordCount":"2016","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2024-11-30T08:44:00Z","dateModified":"2024-11-30T08:44:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/programming-languages/python/library/web-application-server/uvicorn/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/>Computer Science and Engineering</a>&nbsp;»&nbsp;<a href>Programming Languages</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/programming-languages/python/>Python</a>&nbsp;»&nbsp;<a href>Libraries of Python</a>&nbsp;»&nbsp;<a href=https://buenhyden.github.io/posts/programming-languages/python/library/web-application-server/>Python Web Application Server</a></div><h1 class="post-title entry-hint-parent">uvicorn</h1><div class=post-description>Uvicorn은 Python용 ASGI(Asynchronous Server Gateway Interface) 웹 서버 구현체이다.</div><div class=post-meta><span title='2024-11-30 08:44:00 +0000 UTC'>November 30, 2024</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/Programming%20Languages/Python/Library/Web%20Application%20Server/uvicorn.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#uvicorn>Uvicorn</a><ul><li><a href=#주요-특징>주요 특징</a></li><li><a href=#fastapi와의-통합>FastAPI와의 통합</a></li><li><a href=#최적화>최적화</a></li><li><a href=#설치-및-사용>설치 및 사용</a></li><li><a href=#uvicorn-환경-설정>Uvicorn 환경 설정</a></li><li><a href=#배포>배포</a></li></ul></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=uvicorn>Uvicorn<a hidden class=anchor aria-hidden=true href=#uvicorn>#</a></h2><p>Uvicorn은 Python용 ASGI(Asynchronous Server Gateway Interface) 웹 서버 구현체이다.</p><p>Uvicorn은 비동기 Python 웹 애플리케이션을 위한 고성능 서버이다.<br>ASGI 프로토콜을 지원하여 HTTP, HTTP2, WebSocket 등의 프로토콜을 처리할 수 있다.</p><h3 id=주요-특징>주요 특징<a hidden class=anchor aria-hidden=true href=#주요-특징>#</a></h3><ol><li><strong>비동기 처리</strong>: asyncio를 기반으로 하여 비동기 코드를 효율적으로 실행한다.</li><li><strong>고성능</strong>: uvloop와 httptools를 사용하여 빠른 속도를 제공한다.</li><li><strong>경량화</strong>: 최소한의 의존성으로 설치 가능하다.</li><li><strong>개발 편의성</strong>: 자동 리로드 기능을 제공하여 개발 시 편리하다.</li><li><strong>ASGI 호환성</strong>: ASGI 표준을 준수하여 다양한 ASGI 프레임워크와 호환된다.</li></ol><h3 id=fastapi와의-통합>FastAPI와의 통합<a hidden class=anchor aria-hidden=true href=#fastapi와의-통합>#</a></h3><p>Uvicorn은 FastAPI의 기본 웹 서버로 사용된다.<br>FastAPI는 Uvicorn의 비동기 처리 능력을 활용하여 고성능 API를 구현할 수 있다.</p><h3 id=최적화>최적화<a hidden class=anchor aria-hidden=true href=#최적화>#</a></h3><p>Uvicorn은 uvloop를 사용하여 asyncio의 성능을 2-4배 향상시킬 수 있다.<br>또한 httptools를 사용하여 HTTP 파싱 속도를 개선한다.</p><h4 id=uvloop>Uvloop<a hidden class=anchor aria-hidden=true href=#uvloop>#</a></h4><p>uvloop는 Cython으로 작성된 매우 빠른 Python 이벤트 루프 구현체이다.<br>libuv(Node.js가 사용하는 동일한 이벤트 루프 엔진)를 기반으로 하여 Python의 기본 asyncio 이벤트 루프를 대체한다.</p><p>기본적인 사용방법:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uvloop</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># uvloop를 기본 이벤트 루프로 설정</span>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>set_event_loop_policy</span><span class=p>(</span><span class=n>uvloop</span><span class=o>.</span><span class=n>EventLoopPolicy</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 비동기 작업 수행</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hello, uvloop!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이벤트 루프 실행</span>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><p>주요 특징:</p><ol><li><strong>성능</strong>: uvloop는 Node.js의 libuv를 기반으로 하며, 기본 asyncio 이벤트 루프보다 2-4배 빠른 성능을 제공한다.</li><li><strong>구현</strong>: Cython으로 작성되어 C 수준의 성능을 제공한다.</li><li><strong>호환성</strong>: asyncio와 완벽하게 호환되며, 기존 asyncio 코드를 수정하지 않고도 사용할 수 있다.</li><li><strong>플랫폼 지원</strong>: Linux, macOS, FreeBSD에서 사용 가능하지만, Windows에서는 지원되지 않는다.</li></ol><p>uvloop가 제공하는 주요 성능 향상 요소:</p><ol><li><p>향상된 I/O 처리:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>handle_connection</span><span class=p>(</span><span class=n>reader</span><span class=p>,</span> <span class=n>writer</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># uvloop는 이러한 I/O 작업을 매우 효율적으로 처리합니다</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=k>await</span> <span class=n>reader</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>writer</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>writer</span><span class=o>.</span><span class=n>drain</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>writer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>타이머 최적화:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3>3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4>4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5>5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>timed_operation</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># uvloop는 타이머 처리도 더 효율적으로 수행합니다</span>
</span></span><span class=line><span class=cl>    <span class=n>start</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>end</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>end</span> <span class=o>-</span> <span class=n>start</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>시스템 콜 최적화:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>file_operations</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 파일 시스템 작업도 더 빠르게 처리됩니다</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>aiofiles</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s1>&#39;file.txt&#39;</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>contents</span> <span class=o>=</span> <span class=k>await</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>contents</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=httptools>Httptools<a hidden class=anchor aria-hidden=true href=#httptools>#</a></h4><p>httptools는 Node.js의 http-parser를 Python에 바인딩한 고성능 HTTP 파싱 라이브러리.<br>이는 Python의 기본 HTTP 파서보다 훨씬 빠른 성능을 제공한다.</p><p>httptools의 기본 사용법:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>httptools</span> <span class=kn>import</span> <span class=n>HttpRequestParser</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RequestParser</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>parser</span> <span class=o>=</span> <span class=n>HttpRequestParser</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>headers</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>body</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>on_header</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 헤더를 파싱할 때 호출됩니다</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=n>name</span><span class=o>.</span><span class=n>decode</span><span class=p>()]</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>on_body</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>body</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 요청 본문을 파싱할 때 호출됩니다</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>body</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>httptools의 주요 특징과 장점들:</p><ol><li><p><strong>성능</strong>: Nginx의 HTTP 파서를 기반으로 하여 매우 빠른 파싱 속도를 제공한다.</p></li><li><p><strong>구현</strong>: C로 작성되어 있어 높은 성능을 보장한다.</p></li><li><p><strong>비동기 지원</strong>: 비동기 프로그래밍 모델과 잘 맞아 Uvicorn과 같은 비동기 서버에서 효과적으로 사용된다.</p></li><li><p><strong>메모리 효율성</strong>: 스트리밍 파싱을 지원하여 메모리 사용을 최적화한다.</p></li><li><p>스트리밍 파싱:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5>5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6>6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>HTTPProtocol</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>data_received</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 데이터가 도착하는 대로 점진적으로 파싱</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>parser</span><span class=o>.</span><span class=n>feed_data</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;파싱 에러: </span><span class=si>{</span><span class=n>exc</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>고성능 URL 파싱:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>httptools</span> <span class=kn>import</span> <span class=n>parse_url</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse_request_url</span><span class=p>(</span><span class=n>url</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>parsed</span> <span class=o>=</span> <span class=n>parse_url</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;schema&#39;</span><span class=p>:</span> <span class=n>parsed</span><span class=o>.</span><span class=n>schema</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;host&#39;</span><span class=p>:</span> <span class=n>parsed</span><span class=o>.</span><span class=n>host</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;port&#39;</span><span class=p>:</span> <span class=n>parsed</span><span class=o>.</span><span class=n>port</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;path&#39;</span><span class=p>:</span> <span class=n>parsed</span><span class=o>.</span><span class=n>path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;query&#39;</span><span class=p>:</span> <span class=n>parsed</span><span class=o>.</span><span class=n>query</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=uvloop와-httptools의-통합>Uvloop와 Httptools의 통합<a hidden class=anchor aria-hidden=true href=#uvloop와-httptools의-통합>#</a></h4><p>Uvicorn에서 이 두 구성요소가 어떻게 함께 작동하는지 살펴보자:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uvicorn</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>uvicorn</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>app</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>host</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>port</span><span class=o>=</span><span class=mi>8000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>loop</span><span class=o>=</span><span class=s2>&#34;uvloop&#34;</span><span class=p>,</span>     <span class=c1># uvloop 사용</span>
</span></span><span class=line><span class=cl>        <span class=n>http</span><span class=o>=</span><span class=s2>&#34;httptools&#34;</span><span class=p>,</span>  <span class=c1># httptools 사용</span>
</span></span><span class=line><span class=cl>        <span class=n>workers</span><span class=o>=</span><span class=mi>4</span>          <span class=c1># 워커 프로세스 수</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>이러한 구성요소들의 조합은 다음과 같은 이점을 제공한다:</p><ol><li>향상된 처리량: uvloop와 httptools의 조합은 기존 Python 웹 서버보다 훨씬 높은 요청 처리량을 달성할 수 있다.</li><li>낮은 지연 시간: 최적화된 이벤트 루프와 HTTP 파싱으로 인해 각 요청의 처리 시간이 단축된다.</li><li>메모리 효율성: C 기반의 구현으로 인해 메모리 사용이 더 효율적이다.</li><li>안정성: 널리 검증된 libuv와 http-parser를 기반으로 하므로 안정적인 성능을 제공한다.<br>이러한 특성들은 Uvicorn이 고성능 Python 웹 애플리케이션을 구축하는 데 이상적인 선택이 되게 한다.<br>특히 FastAPI나 Starlette와 같은 현대적인 비동기 웹 프레임워크와 함께 사용할 때 그 장점이 더욱 두드러진다.</li></ol><h3 id=설치-및-사용>설치 및 사용<a hidden class=anchor aria-hidden=true href=#설치-및-사용>#</a></h3><p>Uvicorn은 pip를 통해 쉽게 설치할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install uvicorn
</span></span></code></pre></td></tr></table></div></div><p>기본 사용 예시:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uvicorn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>app</span><span class=p>(</span><span class=n>scope</span><span class=p>,</span> <span class=n>receive</span><span class=p>,</span> <span class=n>send</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>send</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=s1>&#39;http.response.start&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;headers&#39;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=sa>b</span><span class=s1>&#39;content-type&#39;</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;text/plain&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=n>send</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=s1>&#39;http.response.body&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;body&#39;</span><span class=p>:</span> <span class=sa>b</span><span class=s1>&#39;Hello, world!&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>uvicorn</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&#34;main:app&#34;</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>8000</span><span class=p>,</span> <span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;info&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=uvicorn-환경-설정>Uvicorn 환경 설정<a hidden class=anchor aria-hidden=true href=#uvicorn-환경-설정>#</a></h3><h4 id=다양한-설정-옵션>다양한 설정 옵션<a hidden class=anchor aria-hidden=true href=#다양한-설정-옵션>#</a></h4><p>실제 운영 환경에서는 설정들을 서버의 특성과 요구사항에 맞게 조정해야 한다.<br>특히 다음과 같은 점들을 고려해야 한다:</p><ol><li>서버의 하드웨어 리소스 (CPU, 메모리)에 맞춘 워커 수와 동시성 제한 설정</li><li>예상되는 트래픽 패턴에 따른 타임아웃과 버퍼 크기 조정</li><li>보안 요구사항에 맞는 SSL/TLS 설정</li><li>모니터링과 디버깅을 위한 적절한 로깅 레벨 설정<br>이러한 설정들은 실제 부하 테스트를 통해 최적화되어야 하며, 운영 중에도 지속적인 모니터링과 튜닝이 필요하다.</li></ol><p>uvicorn의 설정 옵션들을 체계적으로 설명해드리겠습니다. 각 카테고리별로 설정의 목적과 영향을 자세히 살펴보며, 실제 운영 환경에서 어떻게 활용할 수 있는지도 함께 알아보겠습니다.</p><h5 id=서버-기본-설정>서버 기본 설정<a hidden class=anchor aria-hidden=true href=#서버-기본-설정>#</a></h5><p>서버의 가장 기본적인 동작을 제어하는 핵심 설정.<br>이러한 설정들은 uvicorn이 어떻게 요청을 받고 처리할지를 결정한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uvicorn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># 애플리케이션 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;app&#34;</span><span class=p>:</span> <span class=s2>&#34;main:app&#34;</span><span class=p>,</span>          <span class=c1># 실행할 애플리케이션의 경로</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>         <span class=c1># 바인딩할 호스트 주소</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;port&#34;</span><span class=p>:</span> <span class=mi>8000</span><span class=p>,</span>              <span class=c1># 리스닝할 포트 번호</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;uds&#34;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>               <span class=c1># Unix 도메인 소켓 경로 (선택적)</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;fd&#34;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>                <span class=c1># 파일 디스크립터 (선택적)</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;loop&#34;</span><span class=p>:</span> <span class=s2>&#34;auto&#34;</span><span class=p>,</span>            <span class=c1># 이벤트 루프 선택 (auto, asyncio, uvloop)</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;http&#34;</span><span class=p>:</span> <span class=s2>&#34;auto&#34;</span><span class=p>,</span>            <span class=c1># HTTP 프로토콜 구현체 (auto, h11, httptools)</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ws&#34;</span><span class=p>:</span> <span class=s2>&#34;auto&#34;</span><span class=p>,</span>              <span class=c1># WebSocket 프로토콜 구현체 (auto, none, websockets)</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;lifespan&#34;</span><span class=p>:</span> <span class=s2>&#34;auto&#34;</span><span class=p>,</span>        <span class=c1># 수명 주기 이벤트 처리 (auto, on, off)</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;env_file&#34;</span><span class=p>:</span> <span class=s2>&#34;.env&#34;</span>         <span class=c1># 환경 변수 파일 경로</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=최적화-설정>최적화 설정<a hidden class=anchor aria-hidden=true href=#최적화-설정>#</a></h5><p>서버의 성능과 리소스 사용에 직접적인 영향을 미치는 설정.<br>이러한 설정들은 실제 운영 환경에서 매우 중요하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>performance_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># 프로세스 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;workers&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>                    <span class=c1># 워커 프로세스 수</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;limit_concurrency&#34;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span>       <span class=c1># 동시 연결 제한</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;limit_max_requests&#34;</span><span class=p>:</span> <span class=mi>10000</span><span class=p>,</span>     <span class=c1># 워커 재시작 전 최대 요청 수</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;backlog&#34;</span><span class=p>:</span> <span class=mi>2048</span><span class=p>,</span>                 <span class=c1># 연결 대기열 크기</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 타임아웃 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timeout_keep_alive&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>         <span class=c1># keep-alive 연결 타임아웃 (초)</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timeout_notify&#34;</span><span class=p>:</span> <span class=mi>30</span><span class=p>,</span>            <span class=c1># 종료 전 알림 대기 시간 (초)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 버퍼 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;buffer_size&#34;</span><span class=p>:</span> <span class=mi>16384</span><span class=p>,</span>            <span class=c1># 요청/응답 버퍼 크기 (바이트)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=보안-설정>보안 설정<a hidden class=anchor aria-hidden=true href=#보안-설정>#</a></h5><p>서버의 보안을 강화하기 위한 설정.<br>SSL/TLS 설정과 프록시 관련 설정이 포함된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>security_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># SSL/TLS 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ssl_keyfile&#34;</span><span class=p>:</span> <span class=s2>&#34;/path/to/key.pem&#34;</span><span class=p>,</span>      <span class=c1># SSL 키 파일 경로</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ssl_certfile&#34;</span><span class=p>:</span> <span class=s2>&#34;/path/to/cert.pem&#34;</span><span class=p>,</span>    <span class=c1># SSL 인증서 파일 경로</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ssl_keyfile_password&#34;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>           <span class=c1># SSL 키 파일 암호</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ssl_version&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>                       <span class=c1># SSL/TLS 버전</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 프록시 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;proxy_headers&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>                  <span class=c1># X-Forwarded-* 헤더 처리</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;forwarded_allow_ips&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span><span class=p>,</span>            <span class=c1># 신뢰할 수 있는 프록시 IP</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=로깅-설정>로깅 설정<a hidden class=anchor aria-hidden=true href=#로깅-설정>#</a></h5><p>서버의 동작을 모니터링하고 문제를 진단하기 위한 로깅 관련 설정.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27>27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28>28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29>29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>logging_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># 로그 레벨 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;log_level&#34;</span><span class=p>:</span> <span class=s2>&#34;info&#34;</span><span class=p>,</span>                   <span class=c1># 로그 레벨 (critical, error, warning, info, debug, trace)</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;access_log&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>                    <span class=c1># 접근 로그 활성화</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;use_colors&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>                    <span class=c1># 컬러 로그 사용</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 로그 포맷 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;log_config&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;disable_existing_loggers&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;formatters&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;default&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;</span><span class=si>%(asctime)s</span><span class=s2> - </span><span class=si>%(name)s</span><span class=s2> - </span><span class=si>%(levelname)s</span><span class=s2> - </span><span class=si>%(message)s</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;handlers&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;default&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;formatter&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;class&#34;</span><span class=p>:</span> <span class=s2>&#34;logging.StreamHandler&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;stream&#34;</span><span class=p>:</span> <span class=s2>&#34;ext://sys.stdout&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;loggers&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;uvicorn&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;handlers&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;default&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;INFO&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=개발-설정>개발 설정<a hidden class=anchor aria-hidden=true href=#개발-설정>#</a></h5><p>개발 환경에서 유용한 설정.<br>코드 변경 감지와 디버깅을 위한 옵션들이 포함된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>development_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># 리로드 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;reload&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>                        <span class=c1># 코드 변경 감지 및 자동 리로드</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;reload_dirs&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;app&#34;</span><span class=p>,</span> <span class=s2>&#34;config&#34;</span><span class=p>],</span>      <span class=c1># 리로드를 감시할 디렉토리</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;reload_delay&#34;</span><span class=p>:</span> <span class=mf>0.25</span><span class=p>,</span>                  <span class=c1># 리로드 지연 시간 (초)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 디버깅 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;debug&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>                         <span class=c1># 디버그 모드 활성화</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;log_level&#34;</span><span class=p>:</span> <span class=s2>&#34;debug&#34;</span><span class=p>,</span>                  <span class=c1># 상세한 로깅</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=리소스-관리-설정>리소스 관리 설정<a hidden class=anchor aria-hidden=true href=#리소스-관리-설정>#</a></h5><p>서버의 리소스 사용을 제어하는 설정.<br>메모리와 CPU 사용량을 관리하는 데 도움이 된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>resource_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># 프로세스 제한 설정</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;limit_max_requests&#34;</span><span class=p>:</span> <span class=mi>10000</span><span class=p>,</span>           <span class=c1># 워커 재시작 전 최대 요청 수</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;limit_concurrency&#34;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span>             <span class=c1># 동시 연결 제한</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 메모리 관리</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;buffer_size&#34;</span><span class=p>:</span> <span class=mi>16384</span><span class=p>,</span>                  <span class=c1># 버퍼 크기 (바이트)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=시스템-서비스-등록>시스템 서비스 등록<a hidden class=anchor aria-hidden=true href=#시스템-서비스-등록>#</a></h4><h5 id=systemd-서비스-파일을-작성>Systemd 서비스 파일을 작성<a hidden class=anchor aria-hidden=true href=#systemd-서비스-파일을-작성>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33>33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34>34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35>35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36>36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37>37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38>38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39>39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40>40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41>41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42>42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43>43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44>44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Uvicorn instance to serve FastAPI application</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl><span class=c1># 데이터베이스 의존성이 있다면 다음과 같이 추가할 수 있습니다</span>
</span></span><span class=line><span class=cl><span class=c1># Requires=postgresql.service</span>
</span></span><span class=line><span class=cl><span class=c1># After=postgresql.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=c1># 서비스를 실행할 사용자와 그룹을 지정합니다</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>www-data</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>www-data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 작업 디렉토리를 지정합니다</span>
</span></span><span class=line><span class=cl><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/path/to/your/fastapi/app</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 환경 변수 설정</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>&#34;PATH=/path/to/your/virtualenv/bin&#34;</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>&#34;PYTHONPATH=/path/to/your/fastapi/app&#34;</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>&#34;LOG_LEVEL=info&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실행 명령을 지정합니다</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/path/to/your/virtualenv/bin/uvicorn \
</span></span></span><span class=line><span class=cl><span class=s>    main:app \
</span></span></span><span class=line><span class=cl><span class=s>    --host 0.0.0.0 \
</span></span></span><span class=line><span class=cl><span class=s>    --port 8000 \
</span></span></span><span class=line><span class=cl><span class=s>    --workers 4 \
</span></span></span><span class=line><span class=cl><span class=s>    --loop uvloop \
</span></span></span><span class=line><span class=cl><span class=s>    --http httptools \
</span></span></span><span class=line><span class=cl><span class=s>    --log-level info \
</span></span></span><span class=line><span class=cl><span class=s>    --access-log \
</span></span></span><span class=line><span class=cl><span class=s>    --use-colors \
</span></span></span><span class=line><span class=cl><span class=s>    --proxy-headers \
</span></span></span><span class=line><span class=cl><span class=s>    --forwarded-allow-ips=&#39;*&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 프로세스 관리 설정</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>always</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl><span class=na>StartLimitInterval</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 보안 관련 설정</span>
</span></span><span class=line><span class=cl><span class=na>PrivateTmp</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=서비스-파일을-시스템에-등록하고-활성화하는-방법>서비스 파일을 시스템에 등록하고 활성화하는 방법<a hidden class=anchor aria-hidden=true href=#서비스-파일을-시스템에-등록하고-활성화하는-방법>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 서비스 파일 복사</span>
</span></span><span class=line><span class=cl>sudo cp uvicorn.service /etc/systemd/system/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># systemd 데몬 리로드</span>
</span></span><span class=line><span class=cl>sudo systemctl daemon-reload
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 서비스 시작</span>
</span></span><span class=line><span class=cl>sudo systemctl start uvicorn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 부팅 시 자동 시작 설정</span>
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> uvicorn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 서비스 상태 확인</span>
</span></span><span class=line><span class=cl>sudo systemctl status uvicorn
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=배포>배포<a hidden class=anchor aria-hidden=true href=#배포>#</a></h3><p>프로덕션 환경에서는 Gunicorn과 함께 Uvicorn을 사용하는 것이 권장된다.<br>Gunicorn은 프로세스 관리와 로드 밸런싱을 제공하며, Uvicorn은 워커로 동작하여 높은 성능을 발휘한다.</p><h4 id=예시>예시<a hidden class=anchor aria-hidden=true href=#예시>#</a></h4><p>장점들을 살펴보면:</p><ol><li>Nginx는 리버스 프록시로서 SSL 종료, 정적 파일 서빙, 로드 밸런싱을 처리한다.</li><li>Gunicorn은 프로세스 관리자로서 워커 프로세스의 생명주기를 관리한다.</li><li>Uvicorn은 ASGI 서버로서 비동기 Python 애플리케이션을 효율적으로 실행한다.<br>이 구성은 높은 성능과 안정성을 제공하며, 각 구성 요소의 장점을 최대한 활용할 수 있다.<br>실제 운영 환경에서는 서버의 리소스와 트래픽 패턴에 따라 워커 수와 타임아웃 설정 등을 적절히 조정해야 한다.</li></ol><p>서비스 아키텍처는 다음과 같다:<br><code>Nginx(리버스 프록시) → Gunicorn(프로세스 관리자) → Uvicorn(ASGI 서버) → FastAPI/Django 애플리케이션</code></p><ol><li><p>먼저 Nginx 설정 파일을 작성한다.<br><code>/etc/nginx/sites-available/fastapi_app</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span><span class=lnt id=hl-18-18><a class=lnlinks href=#hl-18-18>18</a>
</span><span class=lnt id=hl-18-19><a class=lnlinks href=#hl-18-19>19</a>
</span><span class=lnt id=hl-18-20><a class=lnlinks href=#hl-18-20>20</a>
</span><span class=lnt id=hl-18-21><a class=lnlinks href=#hl-18-21>21</a>
</span><span class=lnt id=hl-18-22><a class=lnlinks href=#hl-18-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>example.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>access_log</span> <span class=s>/var/log/nginx/app-access.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>error_log</span> <span class=s>/var/log/nginx/app-error.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://unix:/run/gunicorn.sock</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Upgrade</span> <span class=nv>$http_upgrade</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Connection</span> <span class=s>&#34;upgrade&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-Proto</span> <span class=nv>$scheme</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># WebSocket 지원을 위한 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kn>proxy_read_timeout</span> <span class=s>300s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_connect_timeout</span> <span class=s>75s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Gunicorn 설정 파일을 작성한다.<br>`` /etc/gunicorn/conf.py`:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a>
</span><span class=lnt id=hl-19-18><a class=lnlinks href=#hl-19-18>18</a>
</span><span class=lnt id=hl-19-19><a class=lnlinks href=#hl-19-19>19</a>
</span><span class=lnt id=hl-19-20><a class=lnlinks href=#hl-19-20>20</a>
</span><span class=lnt id=hl-19-21><a class=lnlinks href=#hl-19-21>21</a>
</span><span class=lnt id=hl-19-22><a class=lnlinks href=#hl-19-22>22</a>
</span><span class=lnt id=hl-19-23><a class=lnlinks href=#hl-19-23>23</a>
</span><span class=lnt id=hl-19-24><a class=lnlinks href=#hl-19-24>24</a>
</span><span class=lnt id=hl-19-25><a class=lnlinks href=#hl-19-25>25</a>
</span><span class=lnt id=hl-19-26><a class=lnlinks href=#hl-19-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Gunicorn 설정 파일</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>multiprocessing</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>uvicorn.workers</span> <span class=kn>import</span> <span class=n>UvicornWorker</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 기본 설정</span>
</span></span><span class=line><span class=cl><span class=n>bind</span> <span class=o>=</span> <span class=s2>&#34;unix:/run/gunicorn.sock&#34;</span>
</span></span><span class=line><span class=cl><span class=n>workers</span> <span class=o>=</span> <span class=n>multiprocessing</span><span class=o>.</span><span class=n>cpu_count</span><span class=p>()</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>worker_class</span> <span class=o>=</span> <span class=s2>&#34;uvicorn.workers.UvicornWorker&#34;</span>
</span></span><span class=line><span class=cl><span class=n>max_requests</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl><span class=n>max_requests_jitter</span> <span class=o>=</span> <span class=mi>50</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Uvicorn 워커 설정</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CustomUvicornWorker</span><span class=p>(</span><span class=n>UvicornWorker</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>CONFIG_KWARGS</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;loop&#34;</span><span class=p>:</span> <span class=s2>&#34;uvloop&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;http&#34;</span><span class=p>:</span> <span class=s2>&#34;httptools&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;lifespan&#34;</span><span class=p>:</span> <span class=s2>&#34;on&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;access_log&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;use_colors&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;timeout_keep_alive&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 로깅 설정</span>
</span></span><span class=line><span class=cl><span class=n>accesslog</span> <span class=o>=</span> <span class=s2>&#34;/var/log/gunicorn/access.log&#34;</span>
</span></span><span class=line><span class=cl><span class=n>errorlog</span> <span class=o>=</span> <span class=s2>&#34;/var/log/gunicorn/error.log&#34;</span>
</span></span><span class=line><span class=cl><span class=n>loglevel</span> <span class=o>=</span> <span class=s2>&#34;info&#34;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>systemd 서비스 파일을 작성한다.<br>`` /etc/systemd/system/gunicorn.service`:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22>22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23>23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24>24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25>25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26>26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27>27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28>28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29>29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30>30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31>31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32>32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33>33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34>34</a>
</span><span class=lnt id=hl-20-35><a class=lnlinks href=#hl-20-35>35</a>
</span><span class=lnt id=hl-20-36><a class=lnlinks href=#hl-20-36>36</a>
</span><span class=lnt id=hl-20-37><a class=lnlinks href=#hl-20-37>37</a>
</span><span class=lnt id=hl-20-38><a class=lnlinks href=#hl-20-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Gunicorn with Uvicorn workers for FastAPI application</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>nginx.service</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>nginx.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>www-data</span>
</span></span><span class=line><span class=cl><span class=na>Group</span><span class=o>=</span><span class=s>www-data</span>
</span></span><span class=line><span class=cl><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/path/to/your/app</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>&#34;PATH=/path/to/your/virtualenv/bin&#34;</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>&#34;PYTHONPATH=/path/to/your/app&#34;</span>
</span></span><span class=line><span class=cl><span class=na>Environment</span><span class=o>=</span><span class=s>&#34;PYTHONUNBUFFERED=1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 환경 변수 파일 포함</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/etc/default/gunicorn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Gunicorn 실행 명령</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/path/to/your/virtualenv/bin/gunicorn \
</span></span></span><span class=line><span class=cl><span class=s>    --config /etc/gunicorn/conf.py \
</span></span></span><span class=line><span class=cl><span class=s>    main:app</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 프로세스 관리</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>always</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl><span class=na>StartLimitInterval</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 보안 설정</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>PrivateTmp</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>ProtectSystem</span><span class=o>=</span><span class=s>full</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 리소스 제한</span>
</span></span><span class=line><span class=cl><span class=na>LimitNOFILE</span><span class=o>=</span><span class=s>65535</span>
</span></span><span class=line><span class=cl><span class=na>TimeoutStopSec</span><span class=o>=</span><span class=s>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>환경 변수를 관리하기 위한 파일을 생성한다.<br><code>/etc/default/gunicorn</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Gunicorn 환경 변수</span>
</span></span><span class=line><span class=cl><span class=nv>PYTHONPATH</span><span class=o>=</span>/path/to/your/app
</span></span><span class=line><span class=cl><span class=nv>DATABASE_URL</span><span class=o>=</span>postgresql://user:password@localhost/dbname
</span></span><span class=line><span class=cl><span class=nv>REDIS_URL</span><span class=o>=</span>redis://localhost:6379/0
</span></span><span class=line><span class=cl><span class=nv>LOG_LEVEL</span><span class=o>=</span>info
</span></span></code></pre></td></tr></table></div></div></li><li><p>필요한 디렉토리와 권한을 설정한다</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1>1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2>2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3>3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4>4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5>5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 로그 디렉토리 생성</span>
</span></span><span class=line><span class=cl>sudo mkdir -p /var/log/gunicorn
</span></span><span class=line><span class=cl>sudo chown -R www-data:www-data /var/log/gunicorn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 소켓 디렉토리 권한 설정</span>
</span></span><span class=line><span class=cl>sudo chown www-data:www-data /run
</span></span></code></pre></td></tr></table></div></div></li><li><p>서비스를 활성화하고 시작한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Nginx 설정 심볼릭 링크 생성</span>
</span></span><span class=line><span class=cl>sudo ln -s /etc/nginx/sites-available/fastapi_app /etc/nginx/sites-enabled/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Nginx 설정 테스트</span>
</span></span><span class=line><span class=cl>sudo nginx -t
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># systemd 데몬 리로드</span>
</span></span><span class=line><span class=cl>sudo systemctl daemon-reload
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 서비스 시작</span>
</span></span><span class=line><span class=cl>sudo systemctl start gunicorn
</span></span><span class=line><span class=cl>sudo systemctl start nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 부팅 시 자동 시작 설정</span>
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> gunicorn
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> nginx
</span></span></code></pre></td></tr></table></div></div></li></ol><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2><p><a href=https://www.uvicorn.org/>Uvicorn</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/programming-languages/>Programming-Languages</a></li><li><a href=https://buenhyden.github.io/tags/python/>Python</a></li><li><a href=https://buenhyden.github.io/tags/library/>Library</a></li><li><a href=https://buenhyden.github.io/tags/web-application-server/>Web-Application-Server</a></li><li><a href=https://buenhyden.github.io/tags/uvicorn/>Uvicorn</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/programming-languages/python/library/web-application-server/daphne/><span class=title>« Prev</span><br><span>daphne</span>
</a><a class=next href=https://buenhyden.github.io/posts/programming-languages/python/library/web-application-server/gunicorn/><span class=title>Next »</span><br><span>gunicorn</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>