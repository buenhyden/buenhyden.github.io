<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>select_related | hyunyoun's Blog</title><meta name=keywords content="Programming-Languages,Python,Web-Framework,Django,ORM,QuerySet,Optimization,select_related"><meta name=description content="SQL의 JOIN 연산을 활용하여 외래 키(Foreign Key) 관계가 있는 객체를 단일 쿼리로 함께 가져오는 메서드"><meta name=author content="Me"><link rel=canonical href=https://buenhyden.github.io/posts/programming-languages/python/ecosystem--practice/web-frameworks/django/orm/queryset/optimization/select_related/><meta name=google-site-verification content="googlee06938ebbfcbac49.html"><link crossorigin=anonymous href=/assets/css/stylesheet.a9863521b3bd3c240bc506f46b95e3c06ccef2ae37f529d5f99bdaef442bccce.css integrity="sha256-qYY1IbO9PCQLxQb0a5XjwGzO8q439SnV+Zva70QrzM4=" rel="preload stylesheet" as=style><link rel=icon href=https://buenhyden.github.io/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://buenhyden.github.io/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://buenhyden.github.io/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><link rel=mask-icon href=https://buenhyden.github.io/favicons/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://buenhyden.github.io/posts/programming-languages/python/ecosystem--practice/web-frameworks/django/orm/queryset/optimization/select_related/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3156423099418350" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W8XTMYPTLC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W8XTMYPTLC")}</script><meta property="og:url" content="https://buenhyden.github.io/posts/programming-languages/python/ecosystem--practice/web-frameworks/django/orm/queryset/optimization/select_related/"><meta property="og:site_name" content="hyunyoun's Blog"><meta property="og:title" content="select_related"><meta property="og:description" content="SQL의 JOIN 연산을 활용하여 외래 키(Foreign Key) 관계가 있는 객체를 단일 쿼리로 함께 가져오는 메서드"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-08T02:39:00+00:00"><meta property="article:modified_time" content="2025-02-08T02:39:00+00:00"><meta property="article:tag" content="Programming-Languages"><meta property="article:tag" content="Python"><meta property="article:tag" content="Web-Framework"><meta property="article:tag" content="Django"><meta property="article:tag" content="ORM"><meta property="article:tag" content="QuerySet"><meta property="og:image" content="https://buenhyden.github.io/images"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://buenhyden.github.io/images"><meta name=twitter:title content="select_related"><meta name=twitter:description content="SQL의 JOIN 연산을 활용하여 외래 키(Foreign Key) 관계가 있는 객체를 단일 쿼리로 함께 가져오는 메서드"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"select_related","item":"https://buenhyden.github.io/posts/programming-languages/python/ecosystem--practice/web-frameworks/django/orm/queryset/optimization/select_related/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"select_related","name":"select_related","description":"SQL의 JOIN 연산을 활용하여 외래 키(Foreign Key) 관계가 있는 객체를 단일 쿼리로 함께 가져오는 메서드","keywords":["Programming-Languages","Python","Web-Framework","Django","ORM","QuerySet","Optimization","select_related"],"articleBody":"select_related select_related는 SQL의 JOIN 연산을 활용하여 외래 키(Foreign Key) 관계가 있는 객체를 단일 쿼리로 함께 가져오는 메서드이다.\n이는 “many-to-one” 관계(ForeignKey)나 “one-to-one” 관계(OneToOneField)에서 특히 유용하다.\n1 2 3 4 5 # 기본 사용법 book = Book.objects.select_related('publisher').get(id=1) # 이제 book.publisher에 접근할 때 추가 쿼리 없이 바로 접근 가능 publisher_name = book.publisher.name # 추가 데이터베이스 호출 없음 Django의 select_related는 관계형 데이터를 효율적으로 가져오기 위한 필수적인 도구이다.\n올바르게 사용하면 애플리케이션의 성능을 크게 향상시킬 수 있다. 특히 ForeignKey와 OneToOneField 관계에서 N+1 쿼리 문제를 해결하는 데 탁월하다.\n효과적인 사용을 위해서는:\n관계의 유형을 이해하고 적절한 메서드(select_related 또는 prefetch_related)를 선택해야 한다. 실제로 필요한 관계만 선택하여 불필요한 JOIN을 피해야 한다. 큰 데이터셋에서는 필드 제한과 결합하여 메모리 사용량을 최적화해야 한다. Django Debug Toolbar와 같은 도구를 활용하여 쿼리 성능을 모니터링해야 한다. 이러한 최적화 전략을 따르면, Django 애플리케이션의 데이터베이스 접근 패턴이 크게 개선되어 사용자 경험이 향상되고 서버 리소스를 효율적으로 활용할 수 있다.\nN+1 쿼리 문제와 해결 N+1 쿼리 문제는 관계형 데이터를 다룰 때 자주 발생하는 성능 저하의 원인이다:\n1 2 3 4 # N+1 문제가 발생하는 코드 books = Book.objects.all() # 첫 번째 쿼리로 모든 책 가져오기 for book in books: print(book.publisher.name) # 각 책마다 publisher를 가져오는 추가 쿼리 발생 select_related가 없는 코드:\n1 2 3 4 5 6 7 -- 첫 번째 쿼리 SELECT * FROM books; -- 각 책마다 실행되는 추가 쿼리 SELECT * FROM publishers WHERE id = 1; SELECT * FROM publishers WHERE id = 2; … 위 코드는 책이 100권이라면 총 101개의 쿼리가 발생한다. select_related를 사용하면 이 문제를 한 번의 쿼리로 해결할 수 있다:\n1 2 3 4 # select_related로 최적화된 코드 books = Book.objects.select_related('publisher').all() # JOIN을 사용한 단일 쿼리 for book in books: print(book.publisher.name) # 추가 쿼리 없음 select_related를 사용한 코드:\n1 2 3 4 -- 단일 JOIN 쿼리 SELECT books.*, publishers.* FROM books INNER JOIN publishers ON books.publisher_id = publishers.id; select_related와 prefetch_related의 차이점 두 메서드 모두 관련 객체를 미리 가져오는 목적이지만, 작동 방식과 적합한 관계 유형이 다르다:\nselect_related: SQL JOIN을 사용하여 한 번의 데이터베이스 쿼리로 처리 ForeignKey(many-to-one)와 OneToOneField(one-to-one) 관계에 적합 데이터베이스 수준에서 JOIN 처리 prefetch_related: 별도의 쿼리를 실행한 후 Python에서 JOIN 처리 ManyToManyField(many-to-many)와 역참조 관계(one-to-many)에 적합 각 관계마다 별도의 쿼리를 실행하고 메모리에서 결합 1 2 3 4 5 6 # 비교 예시 # select_related: 책과 그 출판사 (many-to-one) book = Book.objects.select_related('publisher').get(id=1) # prefetch_related: 책과 그 저자들 (many-to-many) book = Book.objects.prefetch_related('authors').get(id=1) select_related의 고급 사용법 중첩 관계 가져오기 select_related는 이중 밑줄(__)을 사용하여 여러 수준의 관계를 따라갈 수 있다:\n1 2 3 4 5 # 책 -\u003e 출판사 -\u003e 국가 정보까지 한 번에 가져오기 book = Book.objects.select_related('publisher__country').get(id=1) # 이제 추가 쿼리 없이 다음과 같이 접근 가능 country_name = book.publisher.country.name 여러 관계 동시에 가져오기 한 번에 여러 관계를 select_related로 가져올 수 있다:\n1 2 # 책의 출판사와 저작권 정보를 동시에 가져오기 book = Book.objects.select_related('publisher', 'copyright').get(id=1) 필드 제한하기 select_related와 함께 only() 또는 defer()를 사용하여 가져올 필드를 제한할 수 있다:\n1 2 3 4 # 책의 제목과 출판사의 이름만 가져오기 book = Book.objects.select_related('publisher').only( 'title', 'publisher__name' ).get(id=1) 쿼리셋 체이닝 Django ORM의 메서드 체이닝을 활용할 수 있다:\n1 2 3 4 # 출판 연도가 2020년 이후인 책과 그 출판사 정보 가져오기 recent_books = Book.objects.filter( publication_year__gte=2020 ).select_related('publisher').order_by('-publication_year') 모든 외래 키 관계 가져오기 인자 없이 select_related()를 호출하면 모든 non-null 외래 키 관계를 가져온다:\n1 2 3 4 # 모든 외래 키 관계 가져오기 (Django 1.7 이전 버전) book = Book.objects.select_related().get(id=1) # 주의: 이 기능은 Django 1.8부터 더 이상 사용되지 않음 실제 사용 사례와 코드 패턴 복잡한 블로그 애플리케이션 예시 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 모델 정의 class Country(models.Model): name = models.CharField(max_length=100) class Publisher(models.Model): name = models.CharField(max_length=200) country = models.ForeignKey(Country, on_delete=models.CASCADE) class Author(models.Model): name = models.CharField(max_length=100) bio = models.TextField() class Book(models.Model): title = models.CharField(max_length=200) publisher = models.ForeignKey(Publisher, on_delete=models.CASCADE) authors = models.ManyToManyField(Author) published_date = models.DateField() 최적화된 쿼리 패턴:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # select_related와 prefetch_related 함께 사용하기 books = Book.objects.select_related( 'publisher', 'publisher__country' ).prefetch_related( 'authors' ).filter( published_date__year=2023 ) # 이제 다음 코드는 추가 쿼리 없이 실행됨 for book in books: print(f\"책 제목: {book.title}\") print(f\"출판사: {book.publisher.name}\") print(f\"출판 국가: {book.publisher.country.name}\") print(f\"저자들: {', '.join(author.name for author in book.authors.all())}\") 뷰에서 사용하는 패턴 1 2 3 4 5 6 7 8 # Django 뷰에서 select_related 활용하기 class BookDetailView(DetailView): model = Book template_name = 'books/detail.html' def get_queryset(self): # 기본 쿼리셋에 select_related 적용 return super().get_queryset().select_related('publisher', 'publisher__country') Django Rest Framework에서의 활용 1 2 3 4 5 6 7 8 9 10 # DRF 시리얼라이저에서 최적화하기 class BookViewSet(viewsets.ModelViewSet): serializer_class = BookSerializer def get_queryset(self): return Book.objects.select_related( 'publisher' ).prefetch_related( 'authors' ) 성능 측정 및 모니터링 Django Debug Toolbar 활용 Django Debug Toolbar는 SQL 쿼리를 모니터링하고 select_related의 효과를 시각적으로 확인하는 데 유용하다:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # settings.py INSTALLED_APPS = [ # … 'debug_toolbar', ] MIDDLEWARE = [ # … 'debug_toolbar.middleware.DebugToolbarMiddleware', ] INTERNAL_IPS = [ '127.0.0.1', ] 성능 테스트 코드 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import time from django.test import TestCase class QueryPerformanceTest(TestCase): def test_select_related_performance(self): # 일반 쿼리 성능 측정 start_time = time.time() books = list(Book.objects.all()) for book in books: publisher = book.publisher normal_query_time = time.time() - start_time # select_related 쿼리 성능 측정 start_time = time.time() books = list(Book.objects.select_related('publisher').all()) for book in books: publisher = book.publisher optimized_query_time = time.time() - start_time print(f\"일반 쿼리 시간: {normal_query_time:f}초\") print(f\"최적화 쿼리 시간: {optimized_query_time:f}초\") print(f\"성능 향상: {(1 - optimized_query_time/normal_query_time) * 100:f}%\") 주의사항 및 제한 사항 메모리 사용량 증가 select_related는 JOIN을 통해 더 많은 데이터를 한 번에 가져오므로, 큰 테이블을 다룰 때 메모리 사용량이 증가할 수 있다:\n1 2 3 4 # 필요한 필드만 선택하여 메모리 사용량 최적화 books = Book.objects.select_related('publisher').only( 'id', 'title', 'publisher__name' ).all() ManyToMany 관계에는 사용 불가 select_related는 “many-to-many” 관계에 사용할 수 없다. 대신 prefetch_related를 사용해야 한다:\n1 2 3 4 5 # 잘못된 예 - 작동하지 않음 books = Book.objects.select_related('authors').all() # 오류 발생 # 올바른 예 books = Book.objects.prefetch_related('authors').all() 불필요한 조인 주의 모든 관계에 무조건 select_related를 적용하면 불필요한 JOIN이 발생하여 오히려 성능이 저하될 수 있다:\n1 2 3 4 5 6 7 # 불필요한 JOIN이 많은 비효율적인 예 book = Book.objects.select_related( 'publisher', 'editor', 'designer', 'printer', 'distributor' ).get(id=1) # 실제로 필요한 관계만 선택하는 효율적인 예 book = Book.objects.select_related('publisher').get(id=1) NULL 외래 키 처리 외래 키가 NULL일 수 있는 경우, select_related를 사용해도 해당 관계는 None으로 설정된다:\n1 2 3 4 # editor가 NULL인 경우 book = Book.objects.select_related('editor').get(id=1) if book.editor is None: print(\"편집자 정보가 없습니다.\") 실전 최적화 전략 select_related와 prefetch_related 조합 복잡한 데이터 구조에서는 두 메서드를 함께 사용하여 최적의 성능을 얻을 수 있다:\n1 2 3 4 5 6 7 8 # 최적화된 쿼리 예시 articles = Article.objects.select_related( 'author', 'category' # 외래 키 관계 ).prefetch_related( 'tags', 'comments' # many-to-many 및 역참조 관계 ).filter( status='published' ) 데이터베이스 인덱스 활용 select_related와 함께 관련 외래 키 필드에 인덱스를 추가하면 추가적인 성능 향상을 얻을 수 있다:\n1 2 3 4 5 6 7 8 # 모델 정의에 인덱스 추가 class Book(models.Model): title = models.CharField(max_length=200) publisher = models.ForeignKey( Publisher, on_delete=models.CASCADE, db_index=True # 외래 키에 인덱스 추가 ) 애플리케이션 수준의 캐싱 자주 접근하는 데이터는 Django의 캐싱 시스템을 활용하여 추가적인 성능 향상을 얻을 수 있다:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 from django.core.cache import cache def get_book_with_details(book_id): cache_key = f'book_details_{book_id}' book_data = cache.get(cache_key) if not book_data: book = Book.objects.select_related( 'publisher', 'publisher__country' ).get(id=book_id) book_data = { 'title': book.title, 'publisher': book.publisher.name, 'country': book.publisher.country.name } # 1시간 동안 캐싱 cache.set(cache_key, book_data, 60 * 60) return book_data 용어 정리 용어 설명 참고 및 출처 ","wordCount":"1232","inLanguage":"en","image":"https://buenhyden.github.io/images","datePublished":"2025-02-08T02:39:00Z","dateModified":"2025-02-08T02:39:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://buenhyden.github.io/posts/programming-languages/python/ecosystem--practice/web-frameworks/django/orm/queryset/optimization/select_related/"},"publisher":{"@type":"Organization","name":"hyunyoun's Blog","logo":{"@type":"ImageObject","url":"https://buenhyden.github.io/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://buenhyden.github.io/ accesskey=h title="Hy's Blog (Alt + H)"><img src=https://buenhyden.github.io/favicons/apple-touch-icon.png alt aria-label=logo height=35>Hy's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buenhyden.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://buenhyden.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://buenhyden.github.io/til/ title="Today I Learned"><span>Today I Learned</span></a></li><li><a href=https://buenhyden.github.io/coding-test/ title="Coding Test"><span>Coding Test</span></a></li><li><a href=https://buenhyden.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://buenhyden.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://buenhyden.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://buenhyden.github.io/>Home</a></div><h1 class="post-title entry-hint-parent">select_related</h1><div class=post-description>SQL의 JOIN 연산을 활용하여 외래 키(Foreign Key) 관계가 있는 객체를 단일 쿼리로 함께 가져오는 메서드</div><div class=post-meta><span title='2025-02-08 02:39:00 +0000 UTC'>February 8, 2025</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/buenhyden/blog-data/main/content/posts/Programming%20Languages/Python/Ecosystem%20&%20Practice/Web%20Frameworks/Django/ORM/QuerySet/Optimization/select_related.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#select_related>select_related</a><ul><li><a href=#n1-쿼리-문제와-해결>N+1 쿼리 문제와 해결</a></li><li><a href=#select_related와-prefetch_related의-차이점>select_related와 prefetch_related의 차이점</a></li><li><a href=#select_related의-고급-사용법>select_related의 고급 사용법</a></li><li><a href=#실제-사용-사례와-코드-패턴>실제 사용 사례와 코드 패턴</a></li><li><a href=#성능-측정-및-모니터링>성능 측정 및 모니터링</a></li><li><a href=#주의사항-및-제한-사항>주의사항 및 제한 사항</a></li><li><a href=#실전-최적화-전략>실전 최적화 전략</a></li></ul></li><li><a href=#용어-정리>용어 정리</a></li><li><a href=#참고-및-출처>참고 및 출처</a></li></ul></nav></div></details></div><div class=post-content><h2 id=select_related>select_related<a hidden class=anchor aria-hidden=true href=#select_related>#</a></h2><p><code>select_related</code>는 SQL의 JOIN 연산을 활용하여 외래 키(Foreign Key) 관계가 있는 객체를 단일 쿼리로 함께 가져오는 메서드이다.<br>이는 &ldquo;many-to-one&rdquo; 관계(ForeignKey)나 &ldquo;one-to-one&rdquo; 관계(OneToOneField)에서 특히 유용하다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 기본 사용법</span>
</span></span><span class=line><span class=cl><span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이제 book.publisher에 접근할 때 추가 쿼리 없이 바로 접근 가능</span>
</span></span><span class=line><span class=cl><span class=n>publisher_name</span> <span class=o>=</span> <span class=n>book</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>name</span>  <span class=c1># 추가 데이터베이스 호출 없음</span>
</span></span></code></pre></td></tr></table></div></div><p>Django의 <code>select_related</code>는 관계형 데이터를 효율적으로 가져오기 위한 필수적인 도구이다.<br>올바르게 사용하면 애플리케이션의 성능을 크게 향상시킬 수 있다. 특히 ForeignKey와 OneToOneField 관계에서 N+1 쿼리 문제를 해결하는 데 탁월하다.</p><p>효과적인 사용을 위해서는:</p><ol><li>관계의 유형을 이해하고 적절한 메서드(<code>select_related</code> 또는 <code>prefetch_related</code>)를 선택해야 한다.</li><li>실제로 필요한 관계만 선택하여 불필요한 JOIN을 피해야 한다.</li><li>큰 데이터셋에서는 필드 제한과 결합하여 메모리 사용량을 최적화해야 한다.</li><li>Django Debug Toolbar와 같은 도구를 활용하여 쿼리 성능을 모니터링해야 한다.</li></ol><p>이러한 최적화 전략을 따르면, Django 애플리케이션의 데이터베이스 접근 패턴이 크게 개선되어 사용자 경험이 향상되고 서버 리소스를 효율적으로 활용할 수 있다.</p><h3 id=n1-쿼리-문제와-해결>N+1 쿼리 문제와 해결<a hidden class=anchor aria-hidden=true href=#n1-쿼리-문제와-해결>#</a></h3><p>N+1 쿼리 문제는 관계형 데이터를 다룰 때 자주 발생하는 성능 저하의 원인이다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># N+1 문제가 발생하는 코드</span>
</span></span><span class=line><span class=cl><span class=n>books</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>  <span class=c1># 첫 번째 쿼리로 모든 책 가져오기</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>book</span> <span class=ow>in</span> <span class=n>books</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>book</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>  <span class=c1># 각 책마다 publisher를 가져오는 추가 쿼리 발생</span>
</span></span></code></pre></td></tr></table></div></div><p><code>select_related</code>가 없는 코드:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3>3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4>4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5>5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6>6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 첫 번째 쿼리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>books</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 각 책마다 실행되는 추가 쿼리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>publishers</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>publishers</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>…</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>위 코드는 책이 100권이라면 총 101개의 쿼리가 발생한다. <code>select_related</code>를 사용하면 이 문제를 한 번의 쿼리로 해결할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># select_related로 최적화된 코드</span>
</span></span><span class=line><span class=cl><span class=n>books</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>  <span class=c1># JOIN을 사용한 단일 쿼리</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>book</span> <span class=ow>in</span> <span class=n>books</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>book</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>  <span class=c1># 추가 쿼리 없음</span>
</span></span></code></pre></td></tr></table></div></div><p><code>select_related</code>를 사용한 코드:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 단일 JOIN 쿼리
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>books</span><span class=p>.</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>publishers</span><span class=p>.</span><span class=o>*</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>books</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>publishers</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>books</span><span class=p>.</span><span class=n>publisher_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>publishers</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=select_related와-prefetch_related의-차이점>select_related와 prefetch_related의 차이점<a hidden class=anchor aria-hidden=true href=#select_related와-prefetch_related의-차이점>#</a></h3><p>두 메서드 모두 관련 객체를 미리 가져오는 목적이지만, 작동 방식과 적합한 관계 유형이 다르다:</p><ol><li><strong>select_related</strong>:<ul><li>SQL JOIN을 사용하여 한 번의 데이터베이스 쿼리로 처리</li><li>ForeignKey(many-to-one)와 OneToOneField(one-to-one) 관계에 적합</li><li>데이터베이스 수준에서 JOIN 처리</li></ul></li><li><strong>prefetch_related</strong>:<ul><li>별도의 쿼리를 실행한 후 Python에서 JOIN 처리</li><li>ManyToManyField(many-to-many)와 역참조 관계(one-to-many)에 적합</li><li>각 관계마다 별도의 쿼리를 실행하고 메모리에서 결합</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5>5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 비교 예시</span>
</span></span><span class=line><span class=cl><span class=c1># select_related: 책과 그 출판사 (many-to-one)</span>
</span></span><span class=line><span class=cl><span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># prefetch_related: 책과 그 저자들 (many-to-many)</span>
</span></span><span class=line><span class=cl><span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>prefetch_related</span><span class=p>(</span><span class=s1>&#39;authors&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=select_related의-고급-사용법>select_related의 고급 사용법<a hidden class=anchor aria-hidden=true href=#select_related의-고급-사용법>#</a></h3><h4 id=중첩-관계-가져오기>중첩 관계 가져오기<a hidden class=anchor aria-hidden=true href=#중첩-관계-가져오기>#</a></h4><p><code>select_related</code>는 이중 밑줄(<code>__</code>)을 사용하여 여러 수준의 관계를 따라갈 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 책 -&gt; 출판사 -&gt; 국가 정보까지 한 번에 가져오기</span>
</span></span><span class=line><span class=cl><span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher__country&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이제 추가 쿼리 없이 다음과 같이 접근 가능</span>
</span></span><span class=line><span class=cl><span class=n>country_name</span> <span class=o>=</span> <span class=n>book</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>country</span><span class=o>.</span><span class=n>name</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=여러-관계-동시에-가져오기>여러 관계 동시에 가져오기<a hidden class=anchor aria-hidden=true href=#여러-관계-동시에-가져오기>#</a></h4><p>한 번에 여러 관계를 <code>select_related</code>로 가져올 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 책의 출판사와 저작권 정보를 동시에 가져오기</span>
</span></span><span class=line><span class=cl><span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher&#39;</span><span class=p>,</span> <span class=s1>&#39;copyright&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=필드-제한하기>필드 제한하기<a hidden class=anchor aria-hidden=true href=#필드-제한하기>#</a></h4><p><code>select_related</code>와 함께 <code>only()</code> 또는 <code>defer()</code>를 사용하여 가져올 필드를 제한할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 책의 제목과 출판사의 이름만 가져오기</span>
</span></span><span class=line><span class=cl><span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>only</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=s1>&#39;publisher__name&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=쿼리셋-체이닝>쿼리셋 체이닝<a hidden class=anchor aria-hidden=true href=#쿼리셋-체이닝>#</a></h4><p>Django ORM의 메서드 체이닝을 활용할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 출판 연도가 2020년 이후인 책과 그 출판사 정보 가져오기</span>
</span></span><span class=line><span class=cl><span class=n>recent_books</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>publication_year__gte</span><span class=o>=</span><span class=mi>2020</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>order_by</span><span class=p>(</span><span class=s1>&#39;-publication_year&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=모든-외래-키-관계-가져오기>모든 외래 키 관계 가져오기<a hidden class=anchor aria-hidden=true href=#모든-외래-키-관계-가져오기>#</a></h4><p>인자 없이 <code>select_related()</code>를 호출하면 모든 non-null 외래 키 관계를 가져온다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 모든 외래 키 관계 가져오기 (Django 1.7 이전 버전)</span>
</span></span><span class=line><span class=cl><span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 주의: 이 기능은 Django 1.8부터 더 이상 사용되지 않음</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=실제-사용-사례와-코드-패턴>실제 사용 사례와 코드 패턴<a hidden class=anchor aria-hidden=true href=#실제-사용-사례와-코드-패턴>#</a></h3><h4 id=복잡한-블로그-애플리케이션-예시>복잡한 블로그 애플리케이션 예시<a hidden class=anchor aria-hidden=true href=#복잡한-블로그-애플리케이션-예시>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 모델 정의</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Country</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Publisher</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>country</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=n>Country</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Author</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>bio</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Book</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>publisher</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=n>Publisher</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>authors</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ManyToManyField</span><span class=p>(</span><span class=n>Author</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>published_date</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateField</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>최적화된 쿼리 패턴:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># select_related와 prefetch_related 함께 사용하기</span>
</span></span><span class=line><span class=cl><span class=n>books</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;publisher&#39;</span><span class=p>,</span> <span class=s1>&#39;publisher__country&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>prefetch_related</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;authors&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>published_date__year</span><span class=o>=</span><span class=mi>2023</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 이제 다음 코드는 추가 쿼리 없이 실행됨</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>book</span> <span class=ow>in</span> <span class=n>books</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;책 제목: </span><span class=si>{</span><span class=n>book</span><span class=o>.</span><span class=n>title</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;출판사: </span><span class=si>{</span><span class=n>book</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;출판 국가: </span><span class=si>{</span><span class=n>book</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>country</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;저자들: </span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>author</span><span class=o>.</span><span class=n>name</span> <span class=k>for</span> <span class=n>author</span> <span class=ow>in</span> <span class=n>book</span><span class=o>.</span><span class=n>authors</span><span class=o>.</span><span class=n>all</span><span class=p>())</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=뷰에서-사용하는-패턴>뷰에서 사용하는 패턴<a hidden class=anchor aria-hidden=true href=#뷰에서-사용하는-패턴>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5>5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6>6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7>7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Django 뷰에서 select_related 활용하기</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BookDetailView</span><span class=p>(</span><span class=n>DetailView</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span> <span class=o>=</span> <span class=n>Book</span>
</span></span><span class=line><span class=cl>    <span class=n>template_name</span> <span class=o>=</span> <span class=s1>&#39;books/detail.html&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_queryset</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 기본 쿼리셋에 select_related 적용</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>get_queryset</span><span class=p>()</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher&#39;</span><span class=p>,</span> <span class=s1>&#39;publisher__country&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=django-rest-framework에서의-활용>Django Rest Framework에서의 활용<a hidden class=anchor aria-hidden=true href=#django-rest-framework에서의-활용>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># DRF 시리얼라이저에서 최적화하기</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BookViewSet</span><span class=p>(</span><span class=n>viewsets</span><span class=o>.</span><span class=n>ModelViewSet</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>serializer_class</span> <span class=o>=</span> <span class=n>BookSerializer</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_queryset</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;publisher&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span><span class=o>.</span><span class=n>prefetch_related</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;authors&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=성능-측정-및-모니터링>성능 측정 및 모니터링<a hidden class=anchor aria-hidden=true href=#성능-측정-및-모니터링>#</a></h3><h4 id=django-debug-toolbar-활용>Django Debug Toolbar 활용<a hidden class=anchor aria-hidden=true href=#django-debug-toolbar-활용>#</a></h4><p>Django Debug Toolbar는 SQL 쿼리를 모니터링하고 <code>select_related</code>의 효과를 시각적으로 확인하는 데 유용하다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># settings.py</span>
</span></span><span class=line><span class=cl><span class=n>INSTALLED_APPS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=c1># …</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;debug_toolbar&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>MIDDLEWARE</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=c1># …</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;debug_toolbar.middleware.DebugToolbarMiddleware&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>INTERNAL_IPS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=성능-테스트-코드>성능 테스트 코드<a hidden class=anchor aria-hidden=true href=#성능-테스트-코드>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.test</span> <span class=kn>import</span> <span class=n>TestCase</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>QueryPerformanceTest</span><span class=p>(</span><span class=n>TestCase</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_select_related_performance</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 일반 쿼리 성능 측정</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>books</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>book</span> <span class=ow>in</span> <span class=n>books</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>publisher</span> <span class=o>=</span> <span class=n>book</span><span class=o>.</span><span class=n>publisher</span>
</span></span><span class=line><span class=cl>        <span class=n>normal_query_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># select_related 쿼리 성능 측정</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>books</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>book</span> <span class=ow>in</span> <span class=n>books</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>publisher</span> <span class=o>=</span> <span class=n>book</span><span class=o>.</span><span class=n>publisher</span>
</span></span><span class=line><span class=cl>        <span class=n>optimized_query_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;일반 쿼리 시간: </span><span class=si>{</span><span class=n>normal_query_time</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>초&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;최적화 쿼리 시간: </span><span class=si>{</span><span class=n>optimized_query_time</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>초&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;성능 향상: </span><span class=si>{</span><span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>optimized_query_time</span><span class=o>/</span><span class=n>normal_query_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span><span class=si>:</span><span class=s2>f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=주의사항-및-제한-사항>주의사항 및 제한 사항<a hidden class=anchor aria-hidden=true href=#주의사항-및-제한-사항>#</a></h3><h4 id=메모리-사용량-증가>메모리 사용량 증가<a hidden class=anchor aria-hidden=true href=#메모리-사용량-증가>#</a></h4><p><code>select_related</code>는 JOIN을 통해 더 많은 데이터를 한 번에 가져오므로, 큰 테이블을 다룰 때 메모리 사용량이 증가할 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 필요한 필드만 선택하여 메모리 사용량 최적화</span>
</span></span><span class=line><span class=cl><span class=n>books</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>only</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=s1>&#39;publisher__name&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=manytomany-관계에는-사용-불가>ManyToMany 관계에는 사용 불가<a hidden class=anchor aria-hidden=true href=#manytomany-관계에는-사용-불가>#</a></h4><p><code>select_related</code>는 &ldquo;many-to-many&rdquo; 관계에 사용할 수 없다. 대신 <code>prefetch_related</code>를 사용해야 한다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 잘못된 예 - 작동하지 않음</span>
</span></span><span class=line><span class=cl><span class=n>books</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;authors&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>  <span class=c1># 오류 발생</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 올바른 예</span>
</span></span><span class=line><span class=cl><span class=n>books</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>prefetch_related</span><span class=p>(</span><span class=s1>&#39;authors&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=불필요한-조인-주의>불필요한 조인 주의<a hidden class=anchor aria-hidden=true href=#불필요한-조인-주의>#</a></h4><p>모든 관계에 무조건 <code>select_related</code>를 적용하면 불필요한 JOIN이 발생하여 오히려 성능이 저하될 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 불필요한 JOIN이 많은 비효율적인 예</span>
</span></span><span class=line><span class=cl><span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;publisher&#39;</span><span class=p>,</span> <span class=s1>&#39;editor&#39;</span><span class=p>,</span> <span class=s1>&#39;designer&#39;</span><span class=p>,</span> <span class=s1>&#39;printer&#39;</span><span class=p>,</span> <span class=s1>&#39;distributor&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 실제로 필요한 관계만 선택하는 효율적인 예</span>
</span></span><span class=line><span class=cl><span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;publisher&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=null-외래-키-처리>NULL 외래 키 처리<a hidden class=anchor aria-hidden=true href=#null-외래-키-처리>#</a></h4><p>외래 키가 NULL일 수 있는 경우, <code>select_related</code>를 사용해도 해당 관계는 None으로 설정된다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># editor가 NULL인 경우</span>
</span></span><span class=line><span class=cl><span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span><span class=s1>&#39;editor&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>book</span><span class=o>.</span><span class=n>editor</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;편집자 정보가 없습니다.&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=실전-최적화-전략>실전 최적화 전략<a hidden class=anchor aria-hidden=true href=#실전-최적화-전략>#</a></h3><h4 id=select_related와-prefetch_related-조합>select_related와 prefetch_related 조합<a hidden class=anchor aria-hidden=true href=#select_related와-prefetch_related-조합>#</a></h4><p>복잡한 데이터 구조에서는 두 메서드를 함께 사용하여 최적의 성능을 얻을 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3>3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4>4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5>5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6>6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7>7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 최적화된 쿼리 예시</span>
</span></span><span class=line><span class=cl><span class=n>articles</span> <span class=o>=</span> <span class=n>Article</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;author&#39;</span><span class=p>,</span> <span class=s1>&#39;category&#39;</span>  <span class=c1># 외래 키 관계</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>prefetch_related</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;tags&#39;</span><span class=p>,</span> <span class=s1>&#39;comments&#39;</span>  <span class=c1># many-to-many 및 역참조 관계</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span><span class=o>=</span><span class=s1>&#39;published&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=데이터베이스-인덱스-활용>데이터베이스 인덱스 활용<a hidden class=anchor aria-hidden=true href=#데이터베이스-인덱스-활용>#</a></h4><p><code>select_related</code>와 함께 관련 외래 키 필드에 인덱스를 추가하면 추가적인 성능 향상을 얻을 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1>1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2>2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3>3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4>4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5>5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6>6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7>7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 모델 정의에 인덱스 추가</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Book</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>publisher</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>Publisher</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>db_index</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># 외래 키에 인덱스 추가</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=애플리케이션-수준의-캐싱>애플리케이션 수준의 캐싱<a hidden class=anchor aria-hidden=true href=#애플리케이션-수준의-캐싱>#</a></h4><p>자주 접근하는 데이터는 Django의 캐싱 시스템을 활용하여 추가적인 성능 향상을 얻을 수 있다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span><span class=lnt id=hl-23-17><a class=lnlinks href=#hl-23-17>17</a>
</span><span class=lnt id=hl-23-18><a class=lnlinks href=#hl-23-18>18</a>
</span><span class=lnt id=hl-23-19><a class=lnlinks href=#hl-23-19>19</a>
</span><span class=lnt id=hl-23-20><a class=lnlinks href=#hl-23-20>20</a>
</span><span class=lnt id=hl-23-21><a class=lnlinks href=#hl-23-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.core.cache</span> <span class=kn>import</span> <span class=n>cache</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_book_with_details</span><span class=p>(</span><span class=n>book_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cache_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;book_details_</span><span class=si>{</span><span class=n>book_id</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>book_data</span> <span class=o>=</span> <span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cache_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>book_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>select_related</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;publisher&#39;</span><span class=p>,</span> <span class=s1>&#39;publisher__country&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=n>book_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>book_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;title&#39;</span><span class=p>:</span> <span class=n>book</span><span class=o>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;publisher&#39;</span><span class=p>:</span> <span class=n>book</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;country&#39;</span><span class=p>:</span> <span class=n>book</span><span class=o>.</span><span class=n>publisher</span><span class=o>.</span><span class=n>country</span><span class=o>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 1시간 동안 캐싱</span>
</span></span><span class=line><span class=cl>        <span class=n>cache</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>cache_key</span><span class=p>,</span> <span class=n>book_data</span><span class=p>,</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>book_data</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=용어-정리>용어 정리<a hidden class=anchor aria-hidden=true href=#용어-정리>#</a></h2><table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><h2 id=참고-및-출처>참고 및 출처<a hidden class=anchor aria-hidden=true href=#참고-및-출처>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://buenhyden.github.io/tags/programming-languages/>Programming-Languages</a></li><li><a href=https://buenhyden.github.io/tags/python/>Python</a></li><li><a href=https://buenhyden.github.io/tags/web-framework/>Web-Framework</a></li><li><a href=https://buenhyden.github.io/tags/django/>Django</a></li><li><a href=https://buenhyden.github.io/tags/orm/>ORM</a></li><li><a href=https://buenhyden.github.io/tags/queryset/>QuerySet</a></li><li><a href=https://buenhyden.github.io/tags/optimization/>Optimization</a></li><li><a href=https://buenhyden.github.io/tags/select_related/>Select_related</a></li></ul><nav class=paginav><a class=prev href=https://buenhyden.github.io/posts/programming-languages/foundations/programming-paradigms/imperative-vs-declarative-programming/><span class=title>« Prev</span><br><span>명령형 (Imperative) vs. 선언적 (Declarative) 프로그래밍</span>
</a><a class=next href=https://buenhyden.github.io/posts/software-development--engineering/platform-development/backend-development/api-development/token-based-authentication/token-formats/jwt/rfc-7519/><span class=title>Next »</span><br><span>RFC 7519</span></a></nav></footer><div class=comments><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const n={src:"https://giscus.app/client.js","data-repo":"buenhyden/buenhyden.github.io","data-repo-id":"R_kgDONsSnFQ","data-category":"General","data-category-id":"DIC_kwDONsSnFc4CmK-R","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(n).forEach(([t,n])=>e.setAttribute(t,n)),console.log(e),document.querySelector(".comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme)})</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://buenhyden.github.io/>hyunyoun's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>